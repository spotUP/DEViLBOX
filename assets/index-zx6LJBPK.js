const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BuzzmachineSynth-VtTC1x0h.js","assets/vendor-react-DkDaD07v.js","assets/vendor-utils-XMmR-oGw.js","assets/vendor-tone-CADp_hfL.js","assets/vendor-ui-uomqNFY-.js","assets/index-R3wesNBw.js","assets/utilities-Bso9tjJg.js","assets/index-DVZIckso.js","assets/index-Bfh3Z1G8.js","assets/index-WUZHuUYq.js","assets/index-CHnF7Z66.js","assets/OktalyzerParser-CvdIxak4.js","assets/MEDParser-Cvlqop0f.js","assets/SoundFXParser-CqtV9caO.js","assets/SoundMonParser-10KzVYhW.js","assets/JamCrackerParser-Dj4gIqAE.js","assets/QuadraComposerParser-CEl0y8K6.js","assets/instrumentFactory-CRsYYbpw.js","assets/TD3PatternTranslator-RYXvH-yI.js","assets/HelpModal-G-WAjT1N.js","assets/ExportDialog-Bl7IxzWy.js","assets/EditInstrumentModal-DO-M7Dyz.js","assets/EffectChain-C3LgFJxX.js","assets/useVisualizationAnimation-D37DdYyX.js","assets/sortable.esm-Nw3Rboz6.js","assets/index-5JaimClt.js","assets/MasterEffectsModal-BHri30Qv.js","assets/guitarMLRegistry-Ct9uudVS.js","assets/TD3PatternDialog-C6ylbC_9.js","assets/TD3PatternLoader-C1bZAG-1.js","assets/DrumpadEditorModal-oMQCn_Qr.js","assets/DrumPadManager-mLJZGJqo.js","assets/NoteRepeatEngine-CA535fLg.js","assets/MpcResamplerDSP-nORj9P5z.js","assets/AudioContextSingleton-BmUieoGD.js","assets/SamplePackBrowser-DCTJS2h_.js","assets/TipOfTheDay-B57bBGw-.js","assets/PatternManagement-Ns0SZgVJ.js","assets/InstrumentEditorPopout-DGOI8LI2.js","assets/OscilloscopePopout-BZlVD_YC.js","assets/index-DE3MEJ6A.js","assets/ArrangementKeyboardShortcuts-DvPf7hcZ.js","assets/DJView-B1pcUmTm.js","assets/react-three-fiber.esm-DUbY8J_y.js","assets/DJKeyboardHandler-Dzr29xNs.js","assets/parseModuleToSong-BCo4MrbT.js","assets/ReadOnlyPatternCanvas-D4F3fqwn.js","assets/VJView-BexYXGXr.js","assets/PixiApp-DUEXYeX_.js","assets/WebGLModalBridge-B6kbYQta.js","assets/CollaborationSplitView-DPanIWgj.js","assets/mame-DBY166sQ.js","assets/buzzmachines-CJU8WvZr.js","assets/vstbridge-DYZP6QEW.js","assets/wam-DELNkYAq.js","assets/harmonicsynth-Bgwe5x15.js","assets/misc-hGmsZdPj.js","assets/modularsynth-COgZrdOd.js","assets/modularPresets-CRQ9c6cZ.js","assets/buzzmachine-DD8thLIo.js","assets/wam-DTKGnm2P.js","assets/neural-D-Q2m66m.js"])))=>i.map(i=>d[i]);
import{r as e,a as t,g as n,b as s}from"./vendor-react-DkDaD07v.js";import{R as a,p as o,b as r,c as i,r as l,d as c,e as u}from"./vendor-utils-XMmR-oGw.js";import{ToneAudioNode as d,Gain as m,WaveShaper as p,Filter as h,EQ3 as f,Delay as g,Reverb as b,Distortion as v,LFO as y,Phaser as x,getContext as N,Compressor as w,Meter as E,getTransport as k,Time as D,Loop as S,Volume as M,FeedbackDelay as C,Oscillator as V,Signal as P,FMSynth as _,Noise as O,AmplitudeEnvelope as T,Envelope as L,start as A,StereoWidener as B,JCReverb as I,PitchShift as F,PingPongDelay as U,FrequencyShifter as R,Chebyshev as j,AutoWah as X,AutoPanner as z,AutoFilter as G,Vibrato as H,Tremolo as W,Chorus as q,PolySynth as K,Synth as $,now as Y,MonoSynth as J,DuoSynth as Q,AMSynth as Z,PluckSynth as ee,MetalSynth as te,MembraneSynth as ne,NoiseSynth as se,dbToGain as ae,Sampler as oe,Player as re,GrainPlayer as ie,Frequency as le,BitCrusher as ce,Panner as ue,FrequencyEnvelope as de,connect as me,Analyser as pe,FFT as he,setContext as fe,Channel as ge,loaded as be,context as ve,immediate as ye,ToneAudioBuffer as xe,gainToDb as Ne,Offline as we,Part as Ee,Draw as ke}from"./vendor-tone-CADp_hfL.js";import{f as De,a_ as Se,a$ as Me,X as Ce,R as Ve,n as Pe,m as _e,Z as Oe,d as Te,v as Le,c as Ae,I as Be,T as Ie,aS as Fe,an as Ue,b0 as Re,b1 as je,b2 as Xe,b3 as ze,a1 as Ge,J as He,b4 as We,b5 as qe,aO as Ke,ad as $e,ac as Ye,j as Je,aG as Qe,b6 as Ze,b7 as et,b8 as tt,l as nt,b9 as st,a8 as at,ba as ot,aE as rt,S as it,bb as lt,aX as ct,bc as ut,U as dt,aQ as mt,bd as pt,p as ht,A as ft,V as gt,aZ as bt,aM as vt,$ as yt,a0 as xt,i as Nt,aK as wt,aB as Et,be as kt,e as Dt,bf as St,bg as Mt,W as Ct,bh as Vt,ax as Pt,x as _t,bi as Ot,bj as Tt,aJ as Lt,bk as At,bl as Bt,L as It,k as Ft,C as Ut,bm as Rt,g as jt,ab as Xt,u as zt,H as Gt,bn as Ht,a5 as Wt,P as qt,Q as Kt,z as $t,a6 as Yt,M as Jt,bo as Qt,bp as Zt,E as en,O as tn,bq as nn,br as sn,K as an,ao as on,G as rn,bs as ln,a7 as cn,bt as un,bu as dn,bv as mn,N as pn,Y as hn,_ as fn,bw as gn,aN as bn,h as vn,a4 as yn,az as xn,bx as Nn,a as wn,by as En,aT as kn,ai as Dn,aq as Sn,aL as Mn,ay as Cn,aA as Vn,at as Pn,au as _n,b as On,as as Tn,bz as Ln,ah as An,bA as Bn,ae as In,af as Fn,ag as Un}from"./vendor-ui-uomqNFY-.js";function Rn(e,t){for(var n=0;n<t.length;n++){const s=t[n];if("string"!=typeof s&&!Array.isArray(s))for(const t in s)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(s,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>s[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var jn,Xn,zn={exports:{}},Gn={};function Hn(){return jn||(jn=1,function(){function t(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===D?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case h:return"Fragment";case g:return"Profiler";case f:return"StrictMode";case x:return"Suspense";case N:return"SuspenseList";case k:return"Activity"}if("object"==typeof e)switch(e.tag,e.$$typeof){case p:return"Portal";case v:return e.displayName||"Context";case b:return(e._context.displayName||"Context")+".Consumer";case y:var n=e.render;return(e=e.displayName)||(e=""!==(e=n.displayName||n.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case w:return null!==(n=e.displayName||null)?n:t(e.type)||"Memo";case E:n=e._payload,e=e._init;try{return t(e(n))}catch(s){}}return null}function n(e){return""+e}function s(e){try{n(e);var t=!1}catch(o){t=!0}if(t){var s=(t=console).error,a="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return s.call(t,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",a),n(e)}}function a(e){if(e===h)return"<>";if("object"==typeof e&&null!==e&&e.$$typeof===E)return"<...>";try{var n=t(e);return n?"<"+n+">":"<...>"}catch(s){return"<...>"}}function o(){return Error("react-stack-top-frame")}function r(){var e=t(this.type);return P[e]||(P[e]=!0),void 0!==(e=this.props.ref)?e:null}function i(e,n,a,o,i,c){var d,p=n.children;if(void 0!==p)if(o){if(C(p)){for(o=0;o<p.length;o++)l(p[o]);Object.freeze&&Object.freeze(p)}}else l(p);if(M.call(n,"key")){p=t(e);var h=Object.keys(n).filter(function(e){return"key"!==e});o=0<h.length?"{key: someKey, "+h.join(": ..., ")+": ...}":"{key: someKey}",T[p+o]||(h=0<h.length?"{"+h.join(": ..., ")+": ...}":"{}",T[p+o]=!0)}if(p=null,void 0!==a&&(s(a),p=""+a),function(e){if(M.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(n)&&(s(n.key),p=""+n.key),"key"in n)for(var f in a={},n)"key"!==f&&(a[f]=n[f]);else a=n;return p&&function(e){function t(){u||(u=!0)}t.isReactWarning=!0,Object.defineProperty(e,"key",{get:t,configurable:!0})}(a,"function"==typeof e&&(e.displayName||e.name)),function(e,t,n,s,a,o){var i=n.ref;return e={$$typeof:m,type:e,key:t,props:n,_owner:s},null!==(void 0!==i?i:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:r}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:a}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:o}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(e,p,a,null===(d=S.A)?null:d.getOwner(),i,c)}function l(e){c(e)?e._store&&(e._store.validated=1):"object"==typeof e&&null!==e&&e.$$typeof===E&&("fulfilled"===e._payload.status?c(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function c(e){return"object"==typeof e&&null!==e&&e.$$typeof===m}var u,d=e(),m=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),v=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),D=Symbol.for("react.client.reference"),S=d.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=Object.prototype.hasOwnProperty,C=Array.isArray,V=console.createTask?console.createTask:function(){return null},P={},_=(d={react_stack_bottom_frame:function(e){return e()}}).react_stack_bottom_frame.bind(d,o)(),O=V(a(o)),T={};Gn.Fragment=h,Gn.jsxDEV=function(e,t,n,s){var o=1e4>S.recentlyCreatedOwnerStacks++;return i(e,t,n,s,o?Error("react-stack-top-frame"):_,o?V(a(e)):O)}}()),Gn}var Wn,qn,Kn,$n,Yn=(Xn||(Xn=1,zn.exports=Hn()),zn.exports),Jn={exports:{}},Qn={},Zn={exports:{}},es={};function ts(){return qn||(qn=1,Zn.exports=(Wn||(Wn=1,e=es,function(){function t(){if(N=!1,D){var t=e.unstable_now();C=t;var n=!0;try{e:{y=!1,x&&(x=!1,E(S),S=-1),v=!0;var o=b;try{t:{for(r(t),g=s(p);null!==g&&!(g.expirationTime>t&&l());){var u=g.callback;if("function"==typeof u){g.callback=null,b=g.priorityLevel;var d=u(g.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof d){g.callback=d,r(t),n=!0;break t}g===s(p)&&a(p),r(t)}else a(p);g=s(p)}if(null!==g)n=!0;else{var m=s(h);null!==m&&c(i,m.startTime-t),n=!1}}break e}finally{g=null,b=o,v=!1}n=void 0}}finally{n?V():D=!1}}}function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var s=n-1>>>1,a=e[s];if(!(0<o(a,t)))break e;e[s]=t,e[n]=a,n=s}}function s(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var s=0,a=e.length,r=a>>>1;s<r;){var i=2*(s+1)-1,l=e[i],c=i+1,u=e[c];if(0>o(l,n))c<a&&0>o(u,l)?(e[s]=u,e[c]=n,s=c):(e[s]=l,e[i]=n,s=i);else{if(!(c<a&&0>o(u,n)))break e;e[s]=u,e[c]=n,s=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}function r(e){for(var t=s(h);null!==t;){if(null===t.callback)a(h);else{if(!(t.startTime<=e))break;a(h),t.sortIndex=t.expirationTime,n(p,t)}t=s(h)}}function i(e){if(x=!1,r(e),!y)if(null!==s(p))y=!0,D||(D=!0,V());else{var t=s(h);null!==t&&c(i,t.startTime-e)}}function l(){return!(!N&&e.unstable_now()-C<M)}function c(t,n){S=w(function(){t(e.unstable_now())},n)}if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error()),e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var u=performance;e.unstable_now=function(){return u.now()}}else{var d=Date,m=d.now();e.unstable_now=function(){return d.now()-m}}var p=[],h=[],f=1,g=null,b=3,v=!1,y=!1,x=!1,N=!1,w="function"==typeof setTimeout?setTimeout:null,E="function"==typeof clearTimeout?clearTimeout:null,k="undefined"!=typeof setImmediate?setImmediate:null,D=!1,S=-1,M=5,C=-1;if("function"==typeof k)var V=function(){k(t)};else if("undefined"!=typeof MessageChannel){var P=new MessageChannel,_=P.port2;P.port1.onmessage=t,V=function(){_.postMessage(null)}}else V=function(){w(t,0)};e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(M=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_next=function(e){switch(b){case 1:case 2:case 3:var t=3;break;default:t=b}var n=b;b=t;try{return e()}finally{b=n}},e.unstable_requestPaint=function(){N=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=b;b=e;try{return t()}finally{b=n}},e.unstable_scheduleCallback=function(t,a,o){var r=e.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?r+o:r,t){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return t={id:f++,callback:a,priorityLevel:t,startTime:o,expirationTime:l=o+l,sortIndex:-1},o>r?(t.sortIndex=o,n(h,t),null===s(p)&&t===s(h)&&(x?(E(S),S=-1):x=!0,c(i,o-r))):(t.sortIndex=l,n(p,t),y||v||(y=!0,D||(D=!0,V()))),t},e.unstable_shouldYield=l,e.unstable_wrapCallback=function(e){var t=b;return function(){var n=b;b=t;try{return e.apply(this,arguments)}finally{b=n}}},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),es)),Zn.exports;var e}function ns(){return Kn||(Kn=1,function(){function n(e,t){for(e=e.memoizedState;null!==e&&0<t;)e=e.next,t--;return e}function s(e,t,n,a){if(n>=t.length)return a;var o=t[n],r=Id(e)?e.slice():yd({},e);return r[o]=s(e[o],t,n+1,a),r}function a(e,t,n){if(t.length===n.length){for(var s=0;s<n.length-1;s++)if(t[s]!==n[s])return;return o(e,t,n,0)}}function o(e,t,n,s){var a=t[s],r=Id(e)?e.slice():yd({},e);return s+1===t.length?(r[n[s]]=r[a],Id(r)?r.splice(a,1):delete r[a]):r[a]=o(e[a],t,n,s+1),r}function r(e,t,n){var s=t[n],a=Id(e)?e.slice():yd({},e);return n+1===t.length?(Id(a)?a.splice(s,1):delete a[s],a):(a[s]=r(e[s],t,n+1),a)}function i(){return!1}function l(){return null}function c(){}function u(){}function d(e){var t=[];return e.forEach(function(e){t.push(e)}),t.sort().join(", ")}function m(e,t,n,s){return new En(e,t,n,s)}function p(e,t){e.context===yf&&(Fu(e.current,2,t,e,null,null),al())}function h(e,t){if(null!==xf){var n=t.staleFamilies;t=t.updatedFamilies,Vl(),wn(e.current,t,n),al()}}function f(e){xf=e}function g(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function b(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function v(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function y(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function x(e){if(b(e)!==e)throw Error("Unable to find node on an unmounted component.")}function N(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=N(e)))return t;e=e.sibling}return null}function w(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Ad&&e[Ad]||e["@@iterator"])?e:null}function E(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===Bd?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case Ed:return"Fragment";case Dd:return"Profiler";case kd:return"StrictMode";case Vd:return"Suspense";case Pd:return"SuspenseList";case Td:return"Activity"}if("object"==typeof e)switch(e.tag,e.$$typeof){case wd:return"Portal";case Md:return e.displayName||"Context";case Sd:return(e._context.displayName||"Context")+".Consumer";case Cd:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case _d:return null!==(t=e.displayName||null)?t:E(e.type)||"Memo";case Od:t=e._payload,e=e._init;try{return E(e(t))}catch(n){}}return null}function k(e){return"number"==typeof e.tag?D(e):"string"==typeof e.name?e.name:null}function D(e){var t=e.type;switch(e.tag){case 31:return"Activity";case 24:return"Cache";case 9:return(t._context.displayName||"Context")+".Consumer";case 10:return t.displayName||"Context";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 26:case 27:case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E(t);case 8:return t===kd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;break;case 29:if(null!=(t=e._debugInfo))for(var n=t.length-1;0<=n;n--)if("string"==typeof t[n].name)return t[n].name;if(null!==e.return)return D(e.return)}return null}function S(e){return{current:e}}function M(e,t){0>zd||(Xd[zd],e.current=jd[zd],jd[zd]=null,Xd[zd]=null,zd--)}function C(e,t,n){zd++,jd[zd]=e.current,Xd[zd]=n,e.current=t}function V(e,t){C(Wd,t,e),C(Hd,e,e),C(Gd,null,e);var n=t.nodeType;switch(n){case 9:case 11:n=9===n?"#document":"#fragment",t=(t=t.documentElement)&&(t=t.namespaceURI)?Oc(t):_N;break;default:if(n=t.tagName,t=t.namespaceURI)t=Tc(t=Oc(t),n);else switch(n){case"svg":t=ON;break;case"math":t=TN;break;default:t=_N}}n={context:t,ancestorInfo:n=at(null,n=n.toLowerCase())},M(Gd),C(Gd,n,e)}function P(e){M(Gd),M(Hd),M(Wd)}function _(){return Gd.current}function O(e){null!==e.memoizedState&&C(qd,e,e);var t=Gd.current,n=e.type,s=Tc(t.context,n);t!==(s={context:s,ancestorInfo:n=at(t.ancestorInfo,n)})&&(C(Hd,e,e),C(Gd,s,e))}function T(e){Hd.current===e&&(M(Gd),M(Hd)),qd.current===e&&(M(qd),vw._currentValue=bw)}function L(){}function A(e){var t=Error.prepareStackTrace;return Error.prepareStackTrace=void 0,e=e.stack,Error.prepareStackTrace=t,e.startsWith("Error: react-stack-top-frame\n")&&(e=e.slice(29)),-1!==(t=e.indexOf("\n"))&&(e=e.slice(t+1)),-1!==(t=e.indexOf("react_stack_bottom_frame"))&&(t=e.lastIndexOf("\n",t)),-1===t?"":e=e.slice(0,t)}function B(e){if(void 0===$d)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);$d=t&&t[1]||"",Yd=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+$d+e+Yd}function I(e,t){if(!e||Jd)return"";var n=Qd.get(e);if(void 0!==n)return n;Jd=!0,n=Error.prepareStackTrace,Error.prepareStackTrace=void 0;var s;s=Fd.H,Fd.H=null,function(){if(0===Kd){cd=console.log,ud=console.info,dd=console.warn,md=console.error,pd=console.group,hd=console.groupCollapsed,fd=console.groupEnd;var e={configurable:!0,enumerable:!0,value:L,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}Kd++}();try{var a={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(a){var s=a}Reflect.construct(e,[],n)}else{try{n.call()}catch(o){s=o}e.call(n.prototype)}}else{try{throw Error()}catch(r){s=r}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(i){if(i&&s&&"string"==typeof i.stack)return[i.stack,s.stack]}return[null,null]}};a.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(a.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(a.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=a.DetermineComponentFrameRoot(),i=r[0],l=r[1];if(i&&l){var c=i.split("\n"),u=l.split("\n");for(r=o=0;o<c.length&&!c[o].includes("DetermineComponentFrameRoot");)o++;for(;r<u.length&&!u[r].includes("DetermineComponentFrameRoot");)r++;if(o===c.length||r===u.length)for(o=c.length-1,r=u.length-1;1<=o&&0<=r&&c[o]!==u[r];)r--;for(;1<=o&&0<=r;o--,r--)if(c[o]!==u[r]){if(1!==o||1!==r)do{if(o--,0>--r||c[o]!==u[r]){var d="\n"+c[o].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),"function"==typeof e&&Qd.set(e,d),d}}while(1<=o&&0<=r);break}}}finally{Jd=!1,Fd.H=s,function(){if(0===--Kd){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:yd({},e,{value:cd}),info:yd({},e,{value:ud}),warn:yd({},e,{value:dd}),error:yd({},e,{value:md}),group:yd({},e,{value:pd}),groupCollapsed:yd({},e,{value:hd}),groupEnd:yd({},e,{value:fd})})}}(),Error.prepareStackTrace=n}return c=(c=e?e.displayName||e.name:"")?B(c):"","function"==typeof e&&Qd.set(e,c),c}function F(e,t){switch(e.tag){case 26:case 27:case 5:return B(e.type);case 16:return B("Lazy");case 13:return e.child!==t&&null!==t?B("Suspense Fallback"):B("Suspense");case 19:return B("SuspenseList");case 0:case 15:return I(e.type,!1);case 11:return I(e.type.render,!1);case 1:return I(e.type,!0);case 31:return B("Activity");default:return""}}function U(e){try{var t="",n=null;do{t+=F(e,n);var s=e._debugInfo;if(s)for(var a=s.length-1;0<=a;a--){var o=s[a];if("string"==typeof o.name){var r=t;e:{var i=o.name,l=o.env,c=o.debugLocation;if(null!=c){var u=A(c),d=u.lastIndexOf("\n"),m=-1===d?u:u.slice(d+1);if(-1!==m.indexOf(i)){var p="\n"+m;break e}}p=B(i+(l?" ["+l+"]":""))}t=r+p}}n=e,e=e.return}while(e);return t}catch(h){return"\nError generating stack: "+h.message+"\n"+h.stack}}function R(e){return(e=e?e.displayName||e.name:"")?B(e):""}function j(){if(null===Zd)return"";var e=Zd;try{var t="";switch(6===e.tag&&(e=e.return),e.tag){case 26:case 27:case 5:t+=B(e.type);break;case 13:t+=B("Suspense");break;case 19:t+=B("SuspenseList");break;case 31:t+=B("Activity");break;case 30:case 0:case 15:case 1:e._debugOwner||""!==t||(t+=R(e.type));break;case 11:e._debugOwner||""!==t||(t+=R(e.type.render))}for(;e;)if("number"==typeof e.tag){var n=e;e=n._debugOwner;var s=n._debugStack;if(e&&s){var a=A(s);""!==a&&(t+="\n"+a)}}else{if(null==e.debugStack)break;var o=e.debugStack;(e=e.owner)&&o&&(t+="\n"+A(o))}var r=t}catch(i){r="\nError generating stack: "+i.message+"\n"+i.stack}return r}function X(e,t,n,s,a,o,r){var i=Zd;z(e);try{return null!==e&&e._debugTask?e._debugTask.run(t.bind(null,n,s,a,o,r)):t(n,s,a,o,r)}finally{z(i)}throw Error("runWithFiberInDEV should never be called in production. This is a bug in React.")}function z(e){Fd.getCurrentStack=null===e?null:j,em=!1,Zd=e}function G(e){try{return H(e),!1}catch(t){return!0}}function H(e){return""+e}function W(e,t){if(G(e))return H(e)}function q(e,t){if(G(e))return H(e)}function K(e){if(G(e))return H(e)}function $(e){if("function"==typeof pm&&hm(e),gm&&"function"==typeof gm.setStrictMode)try{gm.setStrictMode(fm,e)}catch(t){bm||(bm=!0)}}function Y(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function J(e,t,n){var s=e.pendingLanes;if(0===s)return 0;var a=0,o=e.suspendedLanes,r=e.pingedLanes;e=e.warmLanes;var i=134217727&s;return 0!==i?0!==(s=i&~o)?a=Y(s):0!==(r&=i)?a=Y(r):n||0!==(n=i&~e)&&(a=Y(n)):0!==(i=s&~o)?a=Y(i):0!==r?a=Y(r):n||0!==(n=s&~e)&&(a=Y(n)),0===a?0:0!==t&&t!==a&&0===(t&o)&&((o=a&-a)>=(n=t&-t)||32===o&&4194048&n)?t:a}function Q(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Z(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ee(){var e=km;return!(62914560&(km<<=1))&&(km=4194304),e}function te(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ne(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function se(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-ym(t);e.entangledLanes|=t,e.entanglements[s]=1073741824|e.entanglements[s]|261930&n}function ae(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-ym(n),a=1<<s;a&t|e[s]&t&&(e[s]|=t),n&=~a}}function oe(e,t){var n=t&-t;return 0!==((n=42&n?1:re(n))&(e.suspendedLanes|t))?0:n}function re(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ie(e,t,n){if(vm)for(e=e.pendingUpdatersLaneMap;0<n;){var s=31-ym(n),a=1<<s;e[s].add(t),n&=~a}}function le(e,t){if(vm)for(var n=e.pendingUpdatersLaneMap,s=e.memoizedUpdaters;0<t;){var a=31-ym(t);e=1<<a,0<(a=n[a]).size&&(a.forEach(function(e){var t=e.alternate;null!==t&&s.has(t)||s.add(e)}),a.clear()),t&=~e}}function ce(e){return Dm<(e&=-e)?Sm<e?134217727&e?Mm:Cm:Sm:Dm}function ue(){var e=Ud.p;return 0!==e?e:void 0===(e=window.event)?Mm:$u(e.type)}function de(e,t){var n=Ud.p;try{return Ud.p=e,t()}finally{Ud.p=n}}function me(e){delete e[Pm],delete e[_m],delete e[Tm],delete e[Lm],delete e[Am]}function pe(e){var t=e[Pm];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Om]||n[Pm]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cu(e);null!==e;){if(n=e[Pm])return n;e=cu(e)}return t}n=(e=n).parentNode}return null}function he(e){if(e=e[Pm]||e[Om]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function fe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error("getNodeFromInstance: Invalid argument.")}function ge(e){var t=e[Bm];return t||(t=e[Bm]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function be(e){e[Im]=!0}function ve(e,t){ye(e,t),ye(e+"Capture",t)}function ye(e,t){Um[e],Um[e]=t;var n=e.toLowerCase();for(Rm[n]=e,"onDoubleClick"===e&&(Rm.ondblclick=e),e=0;e<t.length;e++)Fm.add(t[e])}function xe(e,t){jm[t.type]||t.onChange||t.onInput||t.readOnly||t.disabled||t.value,t.onChange||t.readOnly||t.disabled||t.checked}function Ne(e){return!!tm.call(Gm,e)||!tm.call(zm,e)&&(Xm.test(e)?Gm[e]=!0:(zm[e]=!0,!1))}function we(e,t,n){if(Ne(t)){if(!e.hasAttribute(t)){switch(typeof n){case"symbol":case"object":case"function":return n;case"boolean":if(!1===n)return n}return void 0===n?void 0:null}return""===(e=e.getAttribute(t))&&!0===n||(W(n),e===""+n?n:e)}}function Ee(e,t,n){if(Ne(t))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var s=t.toLowerCase().slice(0,5);if("data-"!==s&&"aria-"!==s)return void e.removeAttribute(t)}W(n),e.setAttribute(t,""+n)}}function ke(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}W(n),e.setAttribute(t,""+n)}}function De(e,t,n,s){if(null===s)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}W(s),e.setAttributeNS(t,n,""+s)}}function Se(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return K(e),e;default:return""}}function Me(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Ce(e){if(!e._valueTracker){var t=Me(e)?"checked":"value";e._valueTracker=function(e,t,n){var s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==s&&"function"==typeof s.get&&"function"==typeof s.set){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){K(e),n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(e){K(e),n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function Ve(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=Me(e)?e.checked?"true":"false":e.value),(e=s)!==n&&(t.setValue(e),!0)}function Pe(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function _e(e){return e.replace(Hm,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Oe(e,t){void 0===t.checked||void 0===t.defaultChecked||qm||(qm=!0),void 0===t.value||void 0===t.defaultValue||Wm||(Wm=!0)}function Te(e,t,n,s,a,o,r,i){e.name="",null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r?(W(r),e.type=r):e.removeAttribute("type"),null!=t?"number"===r?(0===t&&""===e.value||e.value!=t)&&(e.value=""+Se(t)):e.value!==""+Se(t)&&(e.value=""+Se(t)):"submit"!==r&&"reset"!==r||e.removeAttribute("value"),null!=t?Ae(e,r,Se(t)):null!=n?Ae(e,r,Se(n)):null!=s&&e.removeAttribute("value"),null==a&&null!=o&&(e.defaultChecked=!!o),null!=a&&(e.checked=a&&"function"!=typeof a&&"symbol"!=typeof a),null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i?(W(i),e.name=""+Se(i)):e.removeAttribute("name")}function Le(e,t,n,s,a,o,r,i){if(null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(W(o),e.type=o),null!=t||null!=n){if(("submit"===o||"reset"===o)&&null==t)return void Ce(e);n=null!=n?""+Se(n):"",t=null!=t?""+Se(t):n,i||t===e.value||(e.value=t),e.defaultValue=t}s="function"!=typeof(s=null!=s?s:a)&&"symbol"!=typeof s&&!!s,e.checked=i?e.checked:!!s,e.defaultChecked=!!s,null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r&&(W(r),e.name=r),Ce(e)}function Ae(e,t,n){"number"===t&&Pe(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function Be(e,t){null==t.value&&("object"==typeof t.children&&null!==t.children?bd.Children.forEach(t.children,function(e){null==e||"string"==typeof e||"number"==typeof e||"bigint"==typeof e||$m||($m=!0)}):null==t.dangerouslySetInnerHTML||Ym||(Ym=!0)),null==t.selected||Km||(Km=!0)}function Ie(e,t,n,s){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&s&&(e[n].defaultSelected=!0)}else{for(n=""+Se(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(s&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function Fe(e,t){for(e=0;e<Qm.length;e++){var n=Qm[e];if(null!=t[n]){var s=Id(t[n]);t.multiple&&!s||t.multiple}}void 0===t.value||void 0===t.defaultValue||Jm||(Jm=!0)}function Ue(e,t){void 0===t.value||void 0===t.defaultValue||Zm||(Zm=!0),null!=t.children&&t.value}function Re(e,t,n){null==t||((t=""+Se(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+Se(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function je(e,t,n,s){if(null==t){if(null!=s){if(null!=n)throw Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(Id(s)){if(1<s.length)throw Error("<textarea> can only have at most one child.");s=s[0]}n=s}null==n&&(n=""),t=n}n=Se(t),e.defaultValue=n,(s=e.textContent)===n&&""!==s&&null!==s&&(e.value=s),Ce(e)}function Xe(e,t){return void 0===e.serverProps&&0===e.serverTail.length&&1===e.children.length&&3<e.distanceFromLeaf&&e.distanceFromLeaf>15-t?Xe(e.children[0],t):e}function ze(e){return"  "+"  ".repeat(e)}function Ge(e){return"+ "+"  ".repeat(e)}function He(e){return"- "+"  ".repeat(e)}function We(e){switch(e.tag){case 26:case 27:case 5:return e.type;case 16:return"Lazy";case 31:return"Activity";case 13:return"Suspense";case 19:return"SuspenseList";case 0:case 15:case 1:return(e=e.type).displayName||e.name||null;case 11:return(e=e.type.render).displayName||e.name||null;default:return null}}function qe(e,t){return ep.test(e)?(e=JSON.stringify(e)).length>t-2?8>t?'{"..."}':"{"+e.slice(0,t-7)+'..."}':"{"+e+"}":e.length>t?5>t?'{"..."}':e.slice(0,t-3)+"...":e}function Ke(e,t,n){var s=120-2*n;if(null===t)return Ge(n)+qe(e,s)+"\n";if("string"==typeof t){for(var a=0;a<t.length&&a<e.length&&t.charCodeAt(a)===e.charCodeAt(a);a++);return a>s-8&&10<a&&(e="..."+e.slice(a-8),t="..."+t.slice(a-8)),Ge(n)+qe(e,s)+"\n"+He(n)+qe(t,s)+"\n"}return ze(n)+qe(e,s)+"\n"}function $e(e){return Object.prototype.toString.call(e).replace(/^\[object (.*)\]$/,function(e,t){return t})}function Ye(e,t){switch(typeof e){case"string":return(e=JSON.stringify(e)).length>t?5>t?'"..."':e.slice(0,t-4)+'..."':e;case"object":if(null===e)return"null";if(Id(e))return"[...]";if(e.$$typeof===Nd)return(t=E(e.type))?"<"+t+">":"<...>";var n=$e(e);if("Object"===n){for(var s in n="",t-=2,e)if(e.hasOwnProperty(s)){var a=JSON.stringify(s);if(a!=='"'+s+'"'&&(s=a),t-=s.length-2,0>(t-=(a=Ye(e[s],15>t?t:15)).length)){n+=""===n?"...":", ...";break}n+=(""===n?"":",")+s+":"+a}return"{"+n+"}"}return n;case"function":return(t=e.displayName||e.name)?"function "+t:"function";default:return String(e)}}function Je(e,t){return"string"!=typeof e||ep.test(e)?"{"+Ye(e,t-2)+"}":e.length>t-2?5>t?'"..."':'"'+e.slice(0,t-5)+'..."':'"'+e+'"'}function Qe(e,t,n){var s,a=120-n.length-e.length,o=[];for(s in t)if(t.hasOwnProperty(s)&&"children"!==s){var r=Je(t[s],120-n.length-s.length-1);a-=s.length+r.length+2,o.push(s+"="+r)}return 0===o.length?n+"<"+e+">\n":0<a?n+"<"+e+" "+o.join(" ")+">\n":n+"<"+e+"\n"+n+"  "+o.join("\n"+n+"  ")+"\n"+n+">\n"}function Ze(e,t,n){var s,a="",o=yd({},t);for(s in e)if(e.hasOwnProperty(s)){delete o[s];var r=120-2*n-s.length-2,i=Ye(e[s],r);t.hasOwnProperty(s)?(r=Ye(t[s],r),a+=Ge(n)+s+": "+i+"\n",a+=He(n)+s+": "+r+"\n"):a+=Ge(n)+s+": "+i+"\n"}for(var l in o)o.hasOwnProperty(l)&&(e=Ye(o[l],120-2*n-l.length-2),a+=He(n)+l+": "+e+"\n");return a}function et(e,t){var n=We(e);if(null===n){for(n="",e=e.child;e;)n+=et(e,t),e=e.sibling;return n}return ze(t)+"<"+n+">\n"}function tt(e,t){var n=Xe(e,t);if(n!==e&&(1!==e.children.length||e.children[0]!==n))return ze(t)+"...\n"+tt(n,t+1);n="";var s=e.fiber._debugInfo;if(s)for(var a=0;a<s.length;a++){var o=s[a].name;"string"==typeof o&&(n+=ze(t)+"<"+o+">\n",t++)}if(s="",a=e.fiber.pendingProps,6===e.fiber.tag)s=Ke(a,e.serverProps,t),t++;else if(null!==(o=We(e.fiber)))if(void 0===e.serverProps){var r=120-2*(s=t)-o.length-2,i="";for(c in a)if(a.hasOwnProperty(c)&&"children"!==c){var l=Je(a[c],15);if(0>(r-=c.length+l.length+2)){i+=" ...";break}i+=" "+c+"="+l}s=ze(s)+"<"+o+i+">\n",t++}else null===e.serverProps?(s=Qe(o,a,Ge(t)),t++):"string"==typeof e.serverProps||(s=function(e,t,n,s){var a="",o=new Map;for(c in n)n.hasOwnProperty(c)&&o.set(c.toLowerCase(),c);if(1===o.size&&o.has("children"))a+=Qe(e,t,ze(s));else{for(var r in t)if(t.hasOwnProperty(r)&&"children"!==r){var i=120-2*(s+1)-r.length-1,l=o.get(r.toLowerCase());if(void 0!==l){o.delete(r.toLowerCase());var c=t[r];l=n[l];var u=Je(c,i);i=Je(l,i),"object"==typeof c&&null!==c&&"object"==typeof l&&null!==l&&"Object"===$e(c)&&"Object"===$e(l)&&(2<Object.keys(c).length||2<Object.keys(l).length||-1<u.indexOf("...")||-1<i.indexOf("..."))?a+=ze(s+1)+r+"={{\n"+Ze(c,l,s+2)+ze(s+1)+"}}\n":(a+=Ge(s+1)+r+"="+u+"\n",a+=He(s+1)+r+"="+i+"\n")}else a+=ze(s+1)+r+"="+Je(t[r],i)+"\n"}o.forEach(function(e){if("children"!==e){var t=120-2*(s+1)-e.length-1;a+=He(s+1)+e+"="+Je(n[e],t)+"\n"}}),a=""===a?ze(s)+"<"+e+">\n":ze(s)+"<"+e+"\n"+a+ze(s)+">\n"}return e=n.children,t=t.children,"string"==typeof e||"number"==typeof e||"bigint"==typeof e?(o="","string"!=typeof t&&"number"!=typeof t&&"bigint"!=typeof t||(o=""+t),a+=Ke(o,""+e,s+1)):"string"!=typeof t&&"number"!=typeof t&&"bigint"!=typeof t||(a=null==e?a+Ke(""+t,null,s+1):a+Ke(""+t,void 0,s+1)),a}(o,a,e.serverProps,t),t++);var c="";for(a=e.fiber.child,o=0;a&&o<e.children.length;)(r=e.children[o]).fiber===a?(c+=tt(r,t),o++):c+=et(a,t),a=a.sibling;for(a&&0<e.children.length&&(c+=ze(t)+"...\n"),a=e.serverTail,null===e.serverProps&&t--,e=0;e<a.length;e++)c="string"==typeof(o=a[e])?c+(He(t)+qe(o,120-2*t)+"\n"):c+Qe(o.type,o.props,He(t));return n+s+c}function nt(e){try{return"\n\n"+tt(e,0)}catch(t){return""}}function st(e,t,n){for(var s=t,a=null,o=0;s;)s===e&&(o=0),a={fiber:s,children:null!==a?[a]:[],serverProps:s===t?n:s===e?null:void 0,serverTail:[],distanceFromLeaf:o},o++,s=s.return;return null!==a?nt(a).replaceAll(/^[+-]/gm,">"):""}function at(e,t){var n=yd({},e||op),s={tag:t};return-1!==np.indexOf(t)&&(n.aTagInScope=null,n.buttonTagInScope=null,n.nobrTagInScope=null),-1!==sp.indexOf(t)&&(n.pTagInButtonScope=null),-1!==tp.indexOf(t)&&"address"!==t&&"div"!==t&&"p"!==t&&(n.listItemTagAutoclosing=null,n.dlItemTagAutoclosing=null),n.current=s,"form"===t&&(n.formTag=s),"a"===t&&(n.aTagInScope=s),"button"===t&&(n.buttonTagInScope=s),"nobr"===t&&(n.nobrTagInScope=s),"p"===t&&(n.pTagInButtonScope=s),"li"===t&&(n.listItemTagAutoclosing=s),"dd"!==t&&"dt"!==t||(n.dlItemTagAutoclosing=s),"#document"===t||"html"===t?n.containerTagInScope=null:n.containerTagInScope||(n.containerTagInScope=s),null!==e||"#document"!==t&&"html"!==t&&"body"!==t?!0===n.implicitRootScope&&(n.implicitRootScope=!1):n.implicitRootScope=!0,n}function ot(e,t,n){switch(t){case"select":return"hr"===e||"option"===e||"optgroup"===e||"script"===e||"template"===e||"#text"===e;case"optgroup":return"option"===e||"#text"===e;case"option":return"#text"===e;case"tr":return"th"===e||"td"===e||"style"===e||"script"===e||"template"===e;case"tbody":case"thead":case"tfoot":return"tr"===e||"style"===e||"script"===e||"template"===e;case"colgroup":return"col"===e||"template"===e;case"table":return"caption"===e||"colgroup"===e||"tbody"===e||"tfoot"===e||"thead"===e||"style"===e||"script"===e||"template"===e;case"head":return"base"===e||"basefont"===e||"bgsound"===e||"link"===e||"meta"===e||"title"===e||"noscript"===e||"noframes"===e||"style"===e||"script"===e||"template"===e;case"html":if(n)break;return"head"===e||"body"===e||"frameset"===e;case"frameset":return"frame"===e;case"#document":if(!n)return"html"===e}switch(e){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return"h1"!==t&&"h2"!==t&&"h3"!==t&&"h4"!==t&&"h5"!==t&&"h6"!==t;case"rp":case"rt":return-1===ap.indexOf(t);case"caption":case"col":case"colgroup":case"frameset":case"frame":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return null==t;case"head":return n||null===t;case"html":return n&&"#document"===t||null===t;case"body":return n&&("#document"===t||"html"===t)||null===t}return!0}function rt(e,t){for(;e;){switch(e.tag){case 5:case 26:case 27:if(e.type===t)return e}e=e.return}return null}function it(e,t){var n=(t=t||op).current;if(t=(n=ot(e,n&&n.tag,t.implicitRootScope)?null:n)?null:function(e,t){switch(e){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return t.pTagInButtonScope;case"form":return t.formTag||t.pTagInButtonScope;case"li":return t.listItemTagAutoclosing;case"dd":case"dt":return t.dlItemTagAutoclosing;case"button":return t.buttonTagInScope;case"a":return t.aTagInScope;case"nobr":return t.nobrTagInScope}return null}(e,t),!(t=n||t))return!0;var s=t.tag;if(t=String(!!n)+"|"+e+"|"+s,rp[t])return!1;rp[t]=!0;var a=(t=Zd)?rt(t.return,s):null;null!==t&&null!==a&&st(a,t,null);return n&&(n="","table"===s&&"tr"===e&&(n+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser.")),t&&(e=t.return,null===a||null===e||a===e&&e._debugOwner===t._debugOwner||X(a,function(){})),!1}function lt(e,t,n){if(n||ot("#text",t,!1))return!0;if(rp[n="#text|"+t])return!1;rp[n]=!0;var s=(n=Zd)?rt(n,t):null;return n=null!==n&&null!==s?st(s,n,6!==n.tag?{children:null}:null):"",/\S/.test(e),!1}function ct(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function ut(e,t,n){var s=0===t.indexOf("--");s||(-1<t.indexOf("-")||up.test(t)?mp.hasOwnProperty(t)&&mp[t]||(mp[t]=!0):!dp.test(n)||pp.hasOwnProperty(n)&&pp[n]||(pp[n]=!0),"number"==typeof n&&(isNaN(n)?hp||(hp=!0):isFinite(n)||fp||(fp=!0))),null==n||"boolean"==typeof n||""===n?s?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":s?e.setProperty(t,n):"number"!=typeof n||0===n||gp.has(t)?"float"===t?e.cssFloat=n:(q(n),e[t]=(""+n).trim()):e[t]=n+"px"}function dt(e,t,n){if(null!=t&&"object"!=typeof t)throw Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.");if(t&&Object.freeze(t),e=e.style,null!=n){if(t){var s={};if(n)for(var a in n)if(n.hasOwnProperty(a)&&!t.hasOwnProperty(a))for(var o=ip[a]||[a],r=0;r<o.length;r++)s[o[r]]=a;for(var i in t)if(t.hasOwnProperty(i)&&(!n||n[i]!==t[i]))for(a=ip[i]||[i],o=0;o<a.length;o++)s[a[o]]=i;for(var l in i={},t)for(a=ip[l]||[l],o=0;o<a.length;o++)i[a[o]]=l;for(var c in l={},s)if(a=s[c],(o=i[c])&&a!==o&&!l[r=a+","+o]){l[r]=!0,r=console;var u=t[a];r.error.call(r,"%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",null==u||"boolean"==typeof u||""===u?"Removing":"Updating",a,o)}}for(var d in n)!n.hasOwnProperty(d)||null!=t&&t.hasOwnProperty(d)||(0===d.indexOf("--")?e.setProperty(d,""):"float"===d?e.cssFloat="":e[d]="");for(var m in t)c=t[m],t.hasOwnProperty(m)&&n[m]!==c&&ut(e,m,c)}else for(s in t)t.hasOwnProperty(s)&&ut(e,s,t[s])}function mt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function pt(e){return yp.get(e)||e}function ht(e,t){if(tm.call(wp,t)&&wp[t])return!0;if(kp.test(t)){if(e="aria-"+t.slice(4).toLowerCase(),null==(e=Np.hasOwnProperty(e)?e:null))return wp[t]=!0;if(t!==e)return wp[t]=!0}if(Ep.test(t)){if(e=t.toLowerCase(),null==(e=Np.hasOwnProperty(e)?e:null))return wp[t]=!0,!1;t!==e&&(wp[t]=!0)}return!0}function ft(e,t,n,s){if(tm.call(Sp,t)&&Sp[t])return!0;var a=t.toLowerCase();if("onfocusin"===a||"onfocusout"===a)return Sp[t]=!0;if("function"==typeof n&&("form"===e&&"action"===t||"input"===e&&"formAction"===t||"button"===e&&"formAction"===t))return!0;if(null!=s){if(e=s.possibleRegistrationNames,s.registrationNameDependencies.hasOwnProperty(t))return!0;if(null!=(s=e.hasOwnProperty(a)?e[a]:null))return Sp[t]=!0;if(Mp.test(t))return Sp[t]=!0}else if(Mp.test(t))return Cp.test(t),Sp[t]=!0;if(Vp.test(t)||Pp.test(t))return!0;if("innerhtml"===a)return Sp[t]=!0;if("aria"===a)return Sp[t]=!0;if("is"===a&&null!=n&&"string"!=typeof n)return Sp[t]=!0;if("number"==typeof n&&isNaN(n))return Sp[t]=!0;if(xp.hasOwnProperty(a)){if((a=xp[a])!==t)return Sp[t]=!0}else if(t!==a)return Sp[t]=!0;switch(t){case"dangerouslySetInnerHTML":case"children":case"style":case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"innerText":case"textContent":return!0}switch(typeof n){case"boolean":switch(t){case"autoFocus":case"checked":case"multiple":case"muted":case"selected":case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":case"capture":case"download":case"inert":return!0;default:return"data-"===(a=t.toLowerCase().slice(0,5))||"aria-"===a||(Sp[t]=!0)}case"function":case"symbol":return Sp[t]=!0,!1;case"string":if("false"===n||"true"===n){switch(t){case"checked":case"selected":case"multiple":case"muted":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":case"inert":break;default:return!0}Sp[t]=!0}}return!0}function gt(e){return _p.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function bt(){}function vt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function yt(e){var t=he(e);if(t&&(e=t.stateNode)){var n=e[_m]||null;e:switch(e=t.stateNode,t.type){case"input":if(Te(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(W(t),n=n.querySelectorAll('input[name="'+_e(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var a=s[_m]||null;if(!a)throw Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");Te(s,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)(s=n[t]).form===e.form&&Ve(s)}break e;case"textarea":Re(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&Ie(e,!!n.multiple,t,!1)}}}function xt(e,t,n){if(Ap)return e(t,n);Ap=!0;try{return e(t)}finally{if(Ap=!1,(null!==Tp||null!==Lp)&&(al(),Tp&&(t=Tp,e=Lp,Lp=Tp=null,yt(t),e)))for(t=0;t<e.length;t++)yt(e[t])}}function Nt(e,t){var n=e.stateNode;if(null===n)return null;var s=n[_m]||null;if(null===s)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error("Expected `"+t+"` listener to be a function, instead got a value of `"+typeof n+"` type.");return n}function wt(){if(Gp)return Gp;var e,t,n=zp,s=n.length,a="value"in Xp?Xp.value:Xp.textContent,o=a.length;for(e=0;e<s&&n[e]===a[e];e++);var r=s-e;for(t=1;t<=r&&n[s-t]===a[o-t];t++);return Gp=a.slice(e,1<t?1-t:void 0)}function Et(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function kt(){return!0}function Dt(){return!1}function St(e){function t(t,n,s,a,o){for(var r in this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(r)&&(t=e[r],this[r]=t?t(a):a[r]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?kt:Dt,this.isPropagationStopped=Dt,this}return yd(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=kt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=kt)},persist:function(){},isPersistent:kt}),t}function Mt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=oh[e])&&!!t[e]}function Ct(){return Mt}function Vt(e,t){switch(e){case"keyup":return-1!==mh.indexOf(t.keyCode);case"keydown":return t.keyCode!==ph;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pt(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}function _t(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!wh[e.type]:"textarea"===t}function Ot(e,t,n,s){Tp?Lp?Lp.push(s):Lp=[s]:Tp=s,0<(t=cc(t,"onChange")).length&&(n=new Wp("onChange","change",null,n,s),e.push({event:n,listeners:t}))}function Tt(e){nc(e,0)}function Lt(e){if(Ve(fe(e)))return e}function At(e,t){if("change"===e)return t}function Bt(){Eh&&(Eh.detachEvent("onpropertychange",It),kh=Eh=null)}function It(e){if("value"===e.propertyName&&Lt(kh)){var t=[];Ot(t,kh,e,vt(e)),xt(Tt,t)}}function Ft(e,t,n){"focusin"===e?(Bt(),kh=n,(Eh=t).attachEvent("onpropertychange",It)):"focusout"===e&&Bt()}function Ut(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Lt(kh)}function Rt(e,t){if("click"===e)return Lt(t)}function jt(e,t){if("input"===e||"change"===e)return Lt(t)}function Xt(e,t){if(Sh(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var a=n[s];if(!tm.call(t,a)||!Sh(e[a],t[a]))return!1}return!0}function zt(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Gt(e,t){var n,s=zt(e);for(e=0;s;){if(3===s.nodeType){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=zt(s)}}function Ht(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Ht(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Wt(e){for(var t=Pe((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(s){n=!1}if(!n)break;t=Pe((e=t.contentWindow).document)}return t}function qt(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Kt(e,t,n){var s=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_h||null==Ch||Ch!==Pe(s)||("selectionStart"in(s=Ch)&&qt(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},Ph&&Xt(Ph,s)||(Ph=s,0<(s=cc(Vh,"onSelect")).length&&(t=new Wp("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Ch)))}function $t(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}function Yt(e){if(Th[e])return Th[e];if(!Oh[e])return e;var t,n=Oh[e];for(t in n)if(n.hasOwnProperty(t)&&t in Lh)return Th[e]=n[t];return e}function Jt(e,t){Xh.set(e,t),ve(t,[e])}function Qt(e,t,n,s){for(var a in e)tm.call(e,a)&&"_"!==a[0]&&Zt(a,e[a],t,n,s)}function Zt(e,t,n,s,a){switch(typeof t){case"object":if(null===t){t="null";break}if(t.$$typeof===Nd){var o=E(t.type)||"",r=t.key;t=t.props;var i=Object.keys(t),l=i.length;if(null==r&&0===l){t="<"+o+" />";break}if(3>s||1===l&&"children"===i[0]&&null==r){t="<"+o+"  />";break}for(var c in n.push([a+"".repeat(s)+e,"<"+o]),null!==r&&Zt("key",r,n,s+1,a),e=!1,t)"children"===c?null!=t.children&&(!Id(t.children)||0<t.children.length)&&(e=!0):tm.call(t,c)&&"_"!==c[0]&&Zt(c,t[c],n,s+1,a);return void n.push(["",e?"></"+o+">":"/>"])}if("Array"===(o=(o=Object.prototype.toString.call(t)).slice(8,o.length-1))){if(c=function(e){for(var t=Yh,n=0;n<e.length;n++){var s=e[n];if("object"==typeof s&&null!==s){if(!Id(s)||2!==s.length||"string"!=typeof s[0])return Jh;if(t!==Yh&&t!==Zh)return Jh;t=Zh}else{if("function"==typeof s||"string"==typeof s&&50<s.length||t!==Yh&&t!==Qh)return Jh;t=Qh}}return t}(t),c===Qh||c===Yh){t=JSON.stringify(t);break}if(c===Zh){for(n.push([a+"".repeat(s)+e,""]),e=0;e<t.length;e++)Zt((o=t[e])[0],o[1],n,s+1,a);return}}if("Promise"===o){if("fulfilled"===t.status){if(o=n.length,Zt(e,t.value,n,s,a),n.length>o)return void((n=n[o])[1]="Promise<"+(n[1]||"Object")+">")}else if("rejected"===t.status&&(o=n.length,Zt(e,t.reason,n,s,a),n.length>o))return void((n=n[o])[1]="Rejected Promise<"+n[1]+">");return void n.push(["".repeat(s)+e,"Promise"])}return"Object"===o&&(c=Object.getPrototypeOf(t))&&"function"==typeof c.constructor&&(o=c.constructor.name),n.push([a+"".repeat(s)+e,"Object"===o?3>s?"":"":o]),void(3>s&&Qt(t,n,s+1,a));case"function":t=""===t.name?"() => {}":t.name+"() {}";break;case"string":t=t===$h?"":JSON.stringify(t);break;case"undefined":t="undefined";break;case"boolean":t=t?"true":"false";break;default:t=String(t)}n.push([a+"".repeat(s)+e,t])}function en(e,t,n,s){var a=!0;for(r in e)r in t||(n.push([ef+"".repeat(s)+r,""]),a=!1);for(var o in t)if(o in e){var r=e[o],i=t[o];if(r!==i){if(0===s&&"children"===o)a="".repeat(s)+o,n.push([ef+a,""],[tf+a,""]);else{if(!(3<=s))if("object"==typeof r&&"object"==typeof i&&null!==r&&null!==i&&r.$$typeof===i.$$typeof)if(i.$$typeof===Nd){if(r.type===i.type&&r.key===i.key){r=E(i.type)||"",a="".repeat(s)+o,r="<"+r+"  />",n.push([ef+a,r],[tf+a,r]),a=!1;continue}}else{var l=Object.prototype.toString.call(r),c=Object.prototype.toString.call(i);if(l===c&&("[object Object]"===c||"[object Array]"===c)){l=[nf+"".repeat(s)+o,"[object Array]"===c?"Array":""],n.push(l),c=n.length,en(r,i,n,s+1)?c===n.length&&(l[1]="Referentially unequal but deeply equal objects. Consider memoization."):a=!1;continue}}else if("function"==typeof r&&"function"==typeof i&&r.name===i.name&&r.length===i.length&&(l=Function.prototype.toString.call(r))===(c=Function.prototype.toString.call(i))){r=""===i.name?"() => {}":i.name+"() {}",n.push([nf+"".repeat(s)+o,r+" Referentially unequal function closure. Consider memoization."]);continue}Zt(o,r,n,s,ef),Zt(o,i,n,s,tf)}a=!1}}else n.push([tf+"".repeat(s)+o,""]),a=!1;return a}function tn(e){rf=63&e?"Blocking":64&e?"Gesture":4194176&e?"Transition":62914560&e?"Suspense":2080374784&e?"Idle":"Other"}function nn(e,t,n,s){sf&&(uf.start=t,uf.end=n,cf.color="warning",cf.tooltipText=s,cf.properties=null,(e=e._debugTask)?e.run(performance.measure.bind(performance,s,uf)):performance.measure(s,uf))}function sn(e,t,n){nn(e,t,n,"Reconnect")}function an(e,t,n,s,a){var o=D(e);if(null!==o&&sf){var r=e.alternate,i=e.actualDuration;if(null===r||r.child!==e.child)for(var l=e.child;null!==l;l=l.sibling)i-=l.actualDuration;s=.5>i?s?"tertiary-light":"primary-light":10>i?s?"tertiary":"primary":100>i?s?"tertiary-dark":"primary-dark":"error";var c=e.memoizedProps;i=e._debugTask,null!==c&&null!==r&&r.memoizedProps!==c?(l=[df],c=en(r.memoizedProps,c,l,0),1<l.length&&(c&&!lf&&0===(r.lanes&a)&&100<e.actualDuration?(lf=!0,l[0]=pf,cf.color="warning",cf.tooltipText=mf):(cf.color=s,cf.tooltipText=o),cf.properties=l,uf.start=t,uf.end=n,null!=i?i.run(performance.measure.bind(performance,""+o,uf)):performance.measure(""+o,uf))):null!=i&&i.run(function(){}.bind())}}function on(e,t,n,s){if(sf){var a=D(e);if(null!==a){for(var o=null,r=[],i=0;i<s.length;i++){var l=s[i];null==o&&null!==l.source&&(o=l.source._debugTask),l=l.value,r.push(["Error","object"==typeof l&&null!==l&&"string"==typeof l.message?String(l.message):String(l)])}null!==e.key&&Zt("key",e.key,r,0,""),null!==e.memoizedProps&&Qt(e.memoizedProps,r,0,""),null==o&&(o=e._debugTask),e={start:t,end:n,detail:{devtools:{color:"error",track:af,tooltipText:13===e.tag?"Hydration failed":"Error boundary caught an error",properties:r}}},o?o.run(performance.measure.bind(performance,""+a,e)):performance.measure(""+a,e)}}}function rn(e,t,n,s,a){if(null!==a){if(sf){var o=D(e);if(null!==o){s=[];for(var r=0;r<a.length;r++){var i=a[r].value;s.push(["Error","object"==typeof i&&null!==i&&"string"==typeof i.message?String(i.message):String(i)])}null!==e.key&&Zt("key",e.key,s,0,""),null!==e.memoizedProps&&Qt(e.memoizedProps,s,0,""),t={start:t,end:n,detail:{devtools:{color:"error",track:af,tooltipText:"A lifecycle or effect errored",properties:s}}},(e=e._debugTask)?e.run(performance.measure.bind(performance,""+o,t)):performance.measure(""+o,t)}}}else null!==(o=D(e))&&sf&&(a=1>s?"secondary-light":100>s?"secondary":500>s?"secondary-dark":"error",(e=e._debugTask)&&e.run(function(){}.bind()))}function ln(e,t,n,s){!sf||t<=e||(n=(738197653&n)===n?"tertiary-dark":"primary-dark",s&&s.run(function(){}.bind()))}function cn(e,t,n,s){!sf||t<=e||(n=(738197653&n)===n?"tertiary-dark":"primary-dark",s&&s.run(function(){}.bind()))}function un(e,t,n,s){!sf||t<=e||s&&s.run(function(){}.bind())}function dn(e,t,n,s,a){if(sf&&!(t<=e)){for(var o=[],r=0;r<n.length;r++){var i=n[r].value;o.push(["Error","object"==typeof i&&null!==i&&"string"==typeof i.message?String(i.message):String(i)])}e={start:e,end:t,detail:{devtools:{color:"error",track:rf,trackGroup:of,tooltipText:s?"Remaining Effects Errored":"Commit Errored",properties:o}}},a?a.run(performance.measure.bind(performance,"Errored",e)):performance.measure("Errored",e)}}function mn(){for(var e=bf,t=vf=bf=0;t<e;){var n=gf[t];gf[t++]=null;var s=gf[t];gf[t++]=null;var a=gf[t];gf[t++]=null;var o=gf[t];if(gf[t++]=null,null!==s&&null!==a){var r=s.pending;null===r?a.next=a:(a.next=r.next,r.next=a),s.pending=a}0!==o&&gn(n,a,o)}}function pn(e,t,n,s){gf[bf++]=e,gf[bf++]=t,gf[bf++]=n,gf[bf++]=s,vf|=s,e.lanes|=s,null!==(e=e.alternate)&&(e.lanes|=s)}function hn(e,t,n,s){return pn(e,t,n,s),bn(e)}function fn(e,t){return pn(e,null,null,t),bn(e)}function gn(e,t,n){e.lanes|=n;var s=e.alternate;null!==s&&(s.lanes|=n);for(var a=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(s=o.alternate)&&(s.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||e._visibility&hf||(a=!0)),e=o,o=o.return;return 3===e.tag?(o=e.stateNode,a&&null!==t&&(a=31-ym(n),null===(s=(e=o.hiddenUpdates)[a])?e[a]=[t]:s.push(t),t.lane=536870912|n),o):null}function bn(e){if(Bx>Ax)throw jx=Bx=0,Xx=Ix=null,Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");jx>Rx&&(jx=0,Xx=null),null===e.alternate&&4098&e.flags&&jl(e);for(var t=e,n=t.return;null!==n;)null===t.alternate&&!!(4098&t.flags)&&jl(e),n=(t=n).return;return 3===t.tag?t.stateNode:null}function vn(e){if(null===xf)return e;var t=xf(e);return void 0===t?e:t.current}function yn(e){if(null===xf)return e;var t=xf(e);return void 0===t?null!=e&&"function"==typeof e.render&&(t=vn(e.render),e.render!==t)?(t={$$typeof:Cd,render:t},void 0!==e.displayName&&(t.displayName=e.displayName),t):e:t.current}function xn(e,t){if(null===xf)return!1;var n=e.elementType,s=!1,a="object"==typeof(t=t.type)&&null!==t?t.$$typeof:null;switch(e.tag){case 1:"function"==typeof t&&(s=!0);break;case 0:("function"==typeof t||a===Od)&&(s=!0);break;case 11:(a===Cd||a===Od)&&(s=!0);break;case 14:case 15:(a===_d||a===Od)&&(s=!0);break;default:return!1}return!(!s||(e=xf(n),void 0===e||e!==xf(t)))}function Nn(e){null!==xf&&"function"==typeof WeakSet&&(null===Nf&&(Nf=new WeakSet),Nf.add(e))}function wn(e,t,n){for(;;){var s=e,a=s.alternate,o=s.child,r=s.sibling,i=s.tag;s=s.type;var l=null;switch(i){case 0:case 15:case 1:l=s;break;case 11:l=s.render}if(null===xf)throw Error("Expected resolveFamily to be set during hot reload.");var c=!1;if(s=!1,null!==l&&(void 0!==(l=xf(l))&&(n.has(l)?s=!0:t.has(l)&&(1===i?s=!0:c=!0))),null!==Nf&&(Nf.has(e)||null!==a&&Nf.has(a))&&(s=!0),s&&(e._debugNeedsRemount=!0),(s||c)&&(null!==(a=fn(e,2))&&Zi(a,e,2)),null===o||s||wn(o,t,n),null===r)break;e=r}}function En(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null,this.actualDuration=-0,this.actualStartTime=-1.1,this.treeBaseDuration=this.selfBaseDuration=-0,this._debugTask=this._debugStack=this._debugOwner=this._debugInfo=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,Cf||"function"!=typeof Object.preventExtensions||Object.preventExtensions(this)}function kn(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dn(e,t){var n=e.alternate;switch(null===n?((n=m(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n._debugOwner=e._debugOwner,n._debugStack=e._debugStack,n._debugTask=e._debugTask,n._debugHookTypes=e._debugHookTypes,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null,n.actualDuration=-0,n.actualStartTime=-1.1),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext,_debugThenableState:t._debugThenableState},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n.selfBaseDuration=e.selfBaseDuration,n.treeBaseDuration=e.treeBaseDuration,n._debugInfo=e._debugInfo,n._debugNeedsRemount=e._debugNeedsRemount,n.tag){case 0:case 15:case 1:n.type=vn(e.type);break;case 11:n.type=yn(e.type)}return n}function Sn(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null,e.selfBaseDuration=0,e.treeBaseDuration=0):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext,_debugThenableState:t._debugThenableState},e.selfBaseDuration=n.selfBaseDuration,e.treeBaseDuration=n.treeBaseDuration),e}function Mn(e,t,n,s,a,o){var r=0,i=e;if("function"==typeof e)kn(e)&&(r=1),i=vn(i);else if("string"==typeof e)r=function(e,t,n){var s=!n.ancestorInfo.containerTagInScope;if(n.context===ON||null!=t.itemProp)return!s||t.itemProp,!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError){if("stylesheet"===t.rel&&"string"==typeof t.precedence){e=t.href;var a=t.onError,o=t.disabled;n=[],t.onLoad&&n.push("`onLoad`"),a&&n.push("`onError`"),null!=o&&n.push("`disabled`"),a=function(e,t){switch(e.length){case 0:return"";case 1:return e[0];case 2:return e[0]+" "+t+" "+e[1];default:return e.slice(0,-1).join(", ")+", "+t+" "+e[e.length-1]}}(n,"and"),a+=1===n.length?" prop":" props",o=1===n.length?"an "+a:"the "+a,n.length}s&&("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onError||t.onLoad);break}return"stylesheet"!==t.rel||(e=t.precedence,t=t.disabled,"string"==typeof e&&null==t);case"script":if(!(e=t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async)||t.onLoad||t.onError||!t.src||"string"!=typeof t.src){s&&e&&(t.onLoad||t.onError);break}return!0}return!1}(e,n,r=_())?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case Td:return(t=m(31,n,t,a)).elementType=Td,t.lanes=o,t;case Ed:return Vn(n.children,a,o,t);case kd:r=8,a|=Df,a|=Sf;break;case Dd:return s=a,(e=n).id,(t=m(12,e,t,s|kf)).elementType=Dd,t.lanes=o,t.stateNode={effectDuration:0,passiveEffectDuration:0},t;case Vd:return(t=m(13,n,t,a)).elementType=Vd,t.lanes=o,t;case Pd:return(t=m(19,n,t,a)).elementType=Pd,t.lanes=o,t;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case Md:r=10;break e;case Sd:r=9;break e;case Cd:r=11,i=yn(i);break e;case _d:r=14;break e;case Od:r=16,i=null;break e}i="",(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(i+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports."),null===e?n="null":Id(e)?n="array":void 0!==e&&e.$$typeof===Nd?(n="<"+(E(e.type)||"Unknown")+" />",i=" Did you accidentally export a JSX literal instead of a component?"):n=typeof e,(r=s?k(s):null)&&(i+="\n\nCheck the render method of `"+r+"`."),r=29,n=Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+n+"."+i),i=null}return(t=m(r,n,t,a)).elementType=e,t.type=i,t.lanes=o,t._debugOwner=s,t}function Cn(e,t,n){return(t=Mn(e.type,e.key,e.props,e._owner,t,n))._debugOwner=e._owner,t._debugStack=e._debugStack,t._debugTask=e._debugTask,t}function Vn(e,t,n,s){return(e=m(7,e,s,t)).lanes=n,e}function Pn(e,t,n){return(e=m(6,e,null,t)).lanes=n,e}function _n(e){var t=m(18,null,null,wf);return t.stateNode=e,t}function On(e,t,n){return(t=m(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Tn(e,t){if("object"==typeof e&&null!==e){var n=Vf.get(e);return void 0!==n?n:(t={value:e,source:t,stack:U(t)},Vf.set(e,t),t)}return{value:e,source:t,stack:U(t)}}function Ln(e,t){Rn(),Pf[_f++]=Tf,Pf[_f++]=Of,Of=e,Tf=t}function An(e,t,n){Rn(),Lf[Af++]=If,Lf[Af++]=Ff,Lf[Af++]=Bf,Bf=e;var s=If;e=Ff;var a=32-ym(s)-1;s&=~(1<<a),n+=1;var o=32-ym(t)+a;if(30<o){var r=a-a%5;o=(s&(1<<r)-1).toString(32),s>>=r,a-=r,If=1<<32-ym(t)+a|n<<a|s,Ff=o+e}else If=1<<o|n<<a|s,Ff=e}function Bn(e){Rn(),null!==e.return&&(Ln(e,1),An(e,1,0))}function In(e){for(;e===Of;)Of=Pf[--_f],Pf[_f]=null,Tf=Pf[--_f],Pf[_f]=null;for(;e===Bf;)Bf=Lf[--Af],Lf[Af]=null,Ff=Lf[--Af],Lf[Af]=null,If=Lf[--Af],Lf[Af]=null}function Fn(){return Rn(),null!==Bf?{id:If,overflow:Ff}:null}function Un(e,t){Rn(),Lf[Af++]=If,Lf[Af++]=Ff,Lf[Af++]=Bf,If=t.id,Ff=t.overflow,Bf=e}function Rn(){}function jn(e,t){if(null===e.return){if(null===zf)zf={fiber:e,children:[],serverProps:void 0,serverTail:[],distanceFromLeaf:t};else{if(zf.fiber!==e)throw Error("Saw multiple hydration diff roots in a pass. This is a bug in React.");zf.distanceFromLeaf>t&&(zf.distanceFromLeaf=t)}return zf}var n=jn(e.return,t+1).children;return 0<n.length&&n[n.length-1].fiber===e?((n=n[n.length-1]).distanceFromLeaf>t&&(n.distanceFromLeaf=t),n):(t={fiber:e,children:[],serverProps:void 0,serverTail:[],distanceFromLeaf:t},n.push(t),t)}function Xn(e,t){Xf||((e=jn(e,0)).serverProps=null,null!==t&&(t=ru(t),e.serverTail.push(t)))}function zn(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n="",s=zf;throw null!==s&&(zf=null,n=nt(s)),$n(Tn(Error("Hydration failed because the server rendered "+(t?"text":"HTML")+" didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\n\n- A server/client branch `if (typeof window !== 'undefined')`.\n- Variable input such as `Date.now()` or `Math.random()` which changes each time it's called.\n- Date formatting in a user's locale which doesn't match the server.\n- External changing data without sending a snapshot of it along with the HTML.\n- Invalid HTML tag nesting.\n\nIt can also happen if the client has a browser extension installed which messes with the HTML before React loaded.\n\nhttps://react.dev/link/hydration-mismatch"+n),e)),Wf}function Gn(e){var t=e.stateNode,n=e.type,s=e.memoizedProps;switch(t[Pm]=e,t[_m]=s,mc(n,s),n){case"dialog":sc("cancel",t),sc("close",t);break;case"iframe":case"object":case"embed":sc("load",t);break;case"video":case"audio":for(n=0;n<eN.length;n++)sc(eN[n],t);break;case"source":sc("error",t);break;case"img":case"image":case"link":sc("error",t),sc("load",t);break;case"details":sc("toggle",t);break;case"input":xe(0,s),sc("invalid",t),Oe(0,s),Le(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0);break;case"option":Be(0,s);break;case"select":xe(0,s),sc("invalid",t),Fe(t,s);break;case"textarea":xe(0,s),sc("invalid",t),Ue(0,s),je(t,s.value,s.defaultValue,s.children)}"string"!=typeof(n=s.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===s.suppressHydrationWarning||bc(t.textContent,n)?(null!=s.popover&&(sc("beforetoggle",t),sc("toggle",t)),null!=s.onScroll&&sc("scroll",t),null!=s.onScrollEnd&&sc("scrollend",t),null!=s.onClick&&(t.onclick=bt),t=!0):t=!1,t||zn(e,!0)}function Hn(e){for(Uf=e.return;Uf;)switch(Uf.tag){case 5:case 31:case 13:return void(Hf=!1);case 27:case 3:return void(Hf=!0);default:Uf=Uf.return}}function Wn(e){if(e!==Uf)return!1;if(!jf)return Hn(e),jf=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Lc(e.type,e.memoizedProps)),t=!t),t&&Rf){for(t=Rf;t;){var s=jn(e,0),a=ru(t);s.serverTail.push(a),t="Suspense"===a.type?lu(t):ou(t.nextSibling)}zn(e)}if(Hn(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");Rf=lu(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");Rf=lu(e)}else 27===n?(n=Rf,Gc(e.type)?(e=GN,GN=null,Rf=e):Rf=n):Rf=Uf?ou(e.stateNode.nextSibling):null;return!0}function qn(){Rf=Uf=null,Xf=jf=!1}function Kn(){var e=Gf;return null!==e&&(null===ax?ax=e:ax.push.apply(ax,e),Gf=null),e}function $n(e){null===Gf?Gf=[e]:Gf.push(e)}function Yn(){var e=zf;if(null!==e){zf=null;for(nt(e);0<e.children.length;)e=e.children[0];X(e.fiber,function(){})}}function Jn(){Jf=Yf=null}function Zn(e,t,n){C(qf,t._currentValue,e),t._currentValue=n,C(Kf,t._currentRenderer,e),void 0!==t._currentRenderer&&null!==t._currentRenderer&&t._currentRenderer,t._currentRenderer=$f}function es(e,t){e._currentValue=qf.current;var n=Kf.current;M(Kf),e._currentRenderer=n,M(qf)}function ns(e,t,n){for(;null!==e;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==s&&(s.childLanes|=t)):null!==s&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function ss(e,t,n,s){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var o=a.dependencies;if(null!==o){var r=a.child;o=o.firstContext;e:for(;null!==o;){var i=o;o=a;for(var l=0;l<t.length;l++)if(i.context===t[l]){o.lanes|=n,null!==(i=o.alternate)&&(i.lanes|=n),ns(o.return,n,e),s||(r=null);break e}o=i.next}}else if(18===a.tag){if(null===(r=a.return))throw Error("We just came from a parent so we must have had a parent. This is a bug in React.");r.lanes|=n,null!==(o=r.alternate)&&(o.lanes|=n),ns(r,n,e),r=null}else r=a.child;if(null!==r)r.return=a;else for(r=a;null!==r;){if(r===e){r=null;break}if(null!==(a=r.sibling)){a.return=r.return,r=a;break}r=r.return}a=r}}function as(e,t,n,s){e=null;for(var a=t,o=!1;null!==a;){if(!o)if(524288&a.flags)o=!0;else if(262144&a.flags)break;if(10===a.tag){var r=a.alternate;if(null===r)throw Error("Should have a current fiber. This is a bug in React.");if(null!==(r=r.memoizedProps)){var i=a.type;Sh(a.pendingProps.value,r.value)||(null!==e?e.push(i):e=[i])}}else if(a===qd.current){if(null===(r=a.alternate))throw Error("Should have a current fiber. This is a bug in React.");r.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push(vw):e=[vw])}a=a.return}null!==e&&ss(t,e,n,s),t.flags|=262144}function os(e){for(e=e.firstContext;null!==e;){if(!Sh(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function rs(e){Yf=e,Jf=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function is(e){return cs(Yf,e)}function ls(e,t){return null===Yf&&rs(e),cs(e,t)}function cs(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===Jf){if(null===e)throw Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");Jf=t,e.dependencies={lanes:0,firstContext:t,_debugThenableState:null},e.flags|=524288}else Jf=Jf.next=t;return n}function us(){return{controller:new Qf,data:new Map,refCount:0}}function ds(e){e.controller.signal.aborted,e.refCount++}function ms(e){e.refCount--,e.refCount,0===e.refCount&&Zf(eg,function(){e.controller.abort()})}function ps(e,t,n){127&e?0>vg&&(vg=ng(),yg=sg(t),Ng=t,null!=n&&(wg=D(n)),(_y&(wy|Ey))!==Ny&&(gg=!0,xg=ag),e=Bc(),t=Ac(),e!==Dg||t!==kg?Dg=-1.1:null!==t&&(xg=ag),Eg=e,kg=t):4194048&e&&0>Vg&&(Vg=ng(),_g=sg(t),Og=t,null!=n&&(Tg=D(n)),0>Cg)&&(e=Bc(),t=Ac(),e===Bg&&t===Ag||(Bg=-1.1),Lg=e,Ag=t)}function hs(){var e=dg;return dg=0,e}function fs(e){var t=dg;return dg=e,t}function gs(e){var t=dg;return dg+=e,t}function bs(){hg=pg=-1.1}function vs(){var e=pg;return pg=-1.1,e}function ys(e){0<=e&&(pg=e)}function xs(){var e=mg;return mg=-0,e}function Ns(e){0<=e&&(mg=e)}function ws(){var e=fg;return fg=null,e}function Es(){var e=gg;return gg=!1,e}function ks(e){ug=ng(),0>e.actualStartTime&&(e.actualStartTime=ug)}function Ds(e){if(0<=ug){var t=ng()-ug;e.actualDuration+=t,e.selfBaseDuration=t,ug=-1}}function Ss(e){if(0<=ug){var t=ng()-ug;e.actualDuration+=t,ug=-1}}function Ms(){if(0<=ug){var e=ng(),t=e-ug;ug=-1,dg+=t,mg+=t,hg=e}}function Cs(e){null===fg&&(fg=[]),fg.push(e),null===cg&&(cg=[]),cg.push(e)}function Vs(){ug=ng(),0>pg&&(pg=ug)}function Ps(e){for(var t=e.child;t;)e.actualDuration+=t.actualDuration,t=t.sibling}function _s(){if(0===--Gg&&(-1<Vg||(Cg=-1.1),null!==zg)){null!==Wg&&(Wg.status="fulfilled");var e=zg;zg=null,Hg=0,Wg=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Os(){var e=Kg.current;return null!==e?e:Oy.pooledCache}function Ts(e,t){C(Kg,null===t?Kg.current:t.pool,e)}function Ls(){var e=Os();return null===e?null:{parent:tg._currentValue,pool:e}}function As(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Bs(e,t,n){null!==Fd.actQueue&&(Fd.didUsePromise=!0);var s=e.thenables;if(void 0===(n=s[n])?s.push(t):n!==t&&(e.didWarnAboutUncachedPromise||(e.didWarnAboutUncachedPromise=!0),t.then(bt,bt),t=n),void 0===t._debugInfo){e=performance.now();var a={name:"string"==typeof(s=t.displayName)?s:"Promise",start:e,end:e,value:t};t._debugInfo=[{awaited:a}],"fulfilled"!==t.status&&"rejected"!==t.status&&(e=function(){a.end=performance.now()},t.then(e,e))}switch(t.status){case"fulfilled":return t.value;case"rejected":throw Us(e=t.reason),e;default:if("string"==typeof t.status)t.then(bt,bt);else{if(null!==(e=Oy)&&100<e.shellSuspendCounter)throw Error("An unknown Component is an async Client Component. Only Server Components can be async at the moment. This error is often caused by accidentally adding `'use client'` to a module that was originally written for the server.");(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw Us(e=t.reason),e}throw Cb=t,Vb=!0,kb}}function Is(e){try{return Eb(e)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw Cb=t,Vb=!0,kb;throw t}}function Fs(){if(null===Cb)throw Error("Expected a suspended thenable. This is a bug in React. Please file an issue.");var e=Cb;return Cb=null,Vb=!1,e}function Us(e){if(e===kb||e===Sb)throw Error("Hooks are not supported inside an async component. This error is often caused by accidentally adding `'use client'` to a module that was originally written for the server.")}function Rs(e){var t=Ob;return null!=e&&(Ob=null===t?e:t.concat(e)),t}function js(){var e=Ob;if(null!=e)for(var t=e.length-1;0<=t;t--)if(null!=e[t].name){var n=e[t].debugTask;if(null!=n)return n}return null}function Xs(e,t,n){for(var s=Object.keys(e.props),a=0;a<s.length;a++){var o=s[a];if("children"!==o&&"key"!==o){null===t&&((t=Cn(e,n.mode,0))._debugInfo=Ob,t.return=n),X(t,function(e){},o);break}}}function zs(e){var t=_b;return _b+=1,null===Pb&&(Pb={didWarnAboutUncachedPromise:!1,thenables:[]}),Bs(Pb,e,t)}function Gs(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Hs(e,t){if(t.$$typeof===xd)throw Error('A React Element from an older version of React was rendered. This is not supported. It can happen if:\n- Multiple copies of the "react" package is used.\n- A library pre-bundled an old copy of "react" or "react/jsx-runtime".\n- A compiler tries to "inline" JSX instead of using the runtime.');throw e=Object.prototype.toString.call(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}function Ws(e,t){var n=js();null!==n?n.run(Hs.bind(null,e,t)):Hs(e,t)}function qs(e,t){var n=D(e)||"Component";Lb[n]||(Lb[n]=!0,t=t.displayName||t.name||"Component",e.tag)}function Ks(e,t){var n=js();null!==n?n.run(qs.bind(null,e,t)):qs(e,t)}function $s(e,t){var n=D(e)||"Component";Ab[n]||(Ab[n]=!0,t=String(t),e.tag)}function Ys(e,t){var n=js();null!==n?n.run($s.bind(null,e,t)):$s(e,t)}function Js(e){function t(t,n){if(e){var s=t.deletions;null===s?(t.deletions=[n],t.flags|=16):s.push(n)}}function n(n,s){if(!e)return null;for(;null!==s;)t(n,s),s=s.sibling;return null}function s(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function a(e,t){return(e=Dn(e,t)).index=0,e.sibling=null,e}function o(t,n,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<n?(t.flags|=67108866,n):s:(t.flags|=67108866,n):(t.flags|=1048576,n)}function r(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function i(e,t,n,s){return null===t||6!==t.tag?((t=Pn(n,e.mode,s)).return=e,t._debugOwner=e,t._debugTask=e._debugTask,t._debugInfo=Ob,t):((t=a(t,n)).return=e,t._debugInfo=Ob,t)}function l(e,t,n,s){var o=n.type;return o===Ed?(Xs(n,t=d(e,t,n.props.children,s,n.key),e),t):null!==t&&(t.elementType===o||xn(t,n)||"object"==typeof o&&null!==o&&o.$$typeof===Od&&Is(o)===t.type)?(Gs(t=a(t,n.props),n),t.return=e,t._debugOwner=n._owner,t._debugInfo=Ob,t):(Gs(t=Cn(n,e.mode,s),n),t.return=e,t._debugInfo=Ob,t)}function c(e,t,n,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=On(n,e.mode,s)).return=e,t._debugInfo=Ob,t):((t=a(t,n.children||[])).return=e,t._debugInfo=Ob,t)}function d(e,t,n,s,o){return null===t||7!==t.tag?((t=Vn(n,e.mode,s,o)).return=e,t._debugOwner=e,t._debugTask=e._debugTask,t._debugInfo=Ob,t):((t=a(t,n)).return=e,t._debugInfo=Ob,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Pn(""+t,e.mode,n)).return=e,t._debugOwner=e,t._debugTask=e._debugTask,t._debugInfo=Ob,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case Nd:return Gs(n=Cn(t,e.mode,n),t),n.return=e,e=Rs(t._debugInfo),n._debugInfo=Ob,Ob=e,n;case wd:return(t=On(t,e.mode,n)).return=e,t._debugInfo=Ob,t;case Od:var s=Rs(t._debugInfo);return e=p(e,t=Is(t),n),Ob=s,e}if(Id(t)||w(t))return(n=Vn(t,e.mode,n,null)).return=e,n._debugOwner=e,n._debugTask=e._debugTask,e=Rs(t._debugInfo),n._debugInfo=Ob,Ob=e,n;if("function"==typeof t.then)return s=Rs(t._debugInfo),e=p(e,zs(t),n),Ob=s,e;if(t.$$typeof===Md)return p(e,ls(e,t),n);Ws(e,t)}return"function"==typeof t&&Ks(e,t),"symbol"==typeof t&&Ys(e,t),null}function h(e,t,n,s){var a=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==a?null:i(e,t,""+n,s);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Nd:return n.key===a?(a=Rs(n._debugInfo),e=l(e,t,n,s),Ob=a,e):null;case wd:return n.key===a?c(e,t,n,s):null;case Od:return a=Rs(n._debugInfo),e=h(e,t,n=Is(n),s),Ob=a,e}if(Id(n)||w(n))return null!==a?null:(a=Rs(n._debugInfo),e=d(e,t,n,s,null),Ob=a,e);if("function"==typeof n.then)return a=Rs(n._debugInfo),e=h(e,t,zs(n),s),Ob=a,e;if(n.$$typeof===Md)return h(e,t,ls(e,n),s);Ws(e,n)}return"function"==typeof n&&Ks(e,n),"symbol"==typeof n&&Ys(e,n),null}function f(e,t,n,s,a){if("string"==typeof s&&""!==s||"number"==typeof s||"bigint"==typeof s)return i(t,e=e.get(n)||null,""+s,a);if("object"==typeof s&&null!==s){switch(s.$$typeof){case Nd:return n=e.get(null===s.key?n:s.key)||null,e=Rs(s._debugInfo),t=l(t,n,s,a),Ob=e,t;case wd:return c(t,e=e.get(null===s.key?n:s.key)||null,s,a);case Od:var o=Rs(s._debugInfo);return t=f(e,t,n,s=Is(s),a),Ob=o,t}if(Id(s)||w(s))return n=e.get(n)||null,e=Rs(s._debugInfo),t=d(t,n,s,a,null),Ob=e,t;if("function"==typeof s.then)return o=Rs(s._debugInfo),t=f(e,t,n,zs(s),a),Ob=o,t;if(s.$$typeof===Md)return f(e,t,n,ls(t,s),a);Ws(t,s)}return"function"==typeof s&&Ks(t,s),"symbol"==typeof s&&Ys(t,s),null}function g(e,t,n,s){if("object"!=typeof n||null===n)return s;switch(n.$$typeof){case Nd:case wd:u(e,t,n);var a=n.key;if("string"!=typeof a)break;if(null===s){(s=new Set).add(a);break}if(!s.has(a)){s.add(a);break}X(t,function(){});break;case Od:g(e,t,n=Is(n),s)}return s}function b(i,l,c,u){if("object"==typeof c&&null!==c&&c.type===Ed&&null===c.key&&(Xs(c,null,i),c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case Nd:var d=Rs(c._debugInfo);e:{for(var m=c.key;null!==l;){if(l.key===m){if((m=c.type)===Ed){if(7===l.tag){n(i,l.sibling),(u=a(l,c.props.children)).return=i,u._debugOwner=c._owner,u._debugInfo=Ob,Xs(c,u,i),i=u;break e}}else if(l.elementType===m||xn(l,c)||"object"==typeof m&&null!==m&&m.$$typeof===Od&&Is(m)===l.type){n(i,l.sibling),Gs(u=a(l,c.props),c),u.return=i,u._debugOwner=c._owner,u._debugInfo=Ob,i=u;break e}n(i,l);break}t(i,l),l=l.sibling}c.type===Ed?((u=Vn(c.props.children,i.mode,u,c.key)).return=i,u._debugOwner=i,u._debugTask=i._debugTask,u._debugInfo=Ob,Xs(c,u,i),i=u):(Gs(u=Cn(c,i.mode,u),c),u.return=i,u._debugInfo=Ob,i=u)}return i=r(i),Ob=d,i;case wd:e:{for(c=(d=c).key;null!==l;){if(l.key===c){if(4===l.tag&&l.stateNode.containerInfo===d.containerInfo&&l.stateNode.implementation===d.implementation){n(i,l.sibling),(u=a(l,d.children||[])).return=i,i=u;break e}n(i,l);break}t(i,l),l=l.sibling}(u=On(d,i.mode,u)).return=i,i=u}return r(i);case Od:return d=Rs(c._debugInfo),i=b(i,l,c=Is(c),u),Ob=d,i}if(Id(c))return d=Rs(c._debugInfo),i=function(a,r,i,l){for(var c=null,u=null,d=null,m=r,b=r=0,v=null;null!==m&&b<i.length;b++){m.index>b?(v=m,m=null):v=m.sibling;var y=h(a,m,i[b],l);if(null===y){null===m&&(m=v);break}c=g(a,y,i[b],c),e&&m&&null===y.alternate&&t(a,m),r=o(y,r,b),null===d?u=y:d.sibling=y,d=y,m=v}if(b===i.length)return n(a,m),jf&&Ln(a,b),u;if(null===m){for(;b<i.length;b++)null!==(m=p(a,i[b],l))&&(c=g(a,m,i[b],c),r=o(m,r,b),null===d?u=m:d.sibling=m,d=m);return jf&&Ln(a,b),u}for(m=s(m);b<i.length;b++)null!==(v=f(m,a,b,i[b],l))&&(c=g(a,v,i[b],c),e&&null!==v.alternate&&m.delete(null===v.key?b:v.key),r=o(v,r,b),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach(function(e){return t(a,e)}),jf&&Ln(a,b),u}(i,l,c,u),Ob=d,i;if(w(c)){if(d=Rs(c._debugInfo),"function"!=typeof(m=w(c)))throw Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");var v=m.call(c);return v===c?0===i.tag&&"[object GeneratorFunction]"===Object.prototype.toString.call(i.type)&&"[object Generator]"===Object.prototype.toString.call(v)||!0:c.entries!==m||ob||(ob=!0),i=function(a,r,i,l){if(null==i)throw Error("An iterable object provided no iterator.");for(var c=null,u=null,d=r,m=r=0,b=null,v=null,y=i.next();null!==d&&!y.done;m++,y=i.next()){d.index>m?(b=d,d=null):b=d.sibling;var x=h(a,d,y.value,l);if(null===x){null===d&&(d=b);break}v=g(a,x,y.value,v),e&&d&&null===x.alternate&&t(a,d),r=o(x,r,m),null===u?c=x:u.sibling=x,u=x,d=b}if(y.done)return n(a,d),jf&&Ln(a,m),c;if(null===d){for(;!y.done;m++,y=i.next())null!==(d=p(a,y.value,l))&&(v=g(a,d,y.value,v),r=o(d,r,m),null===u?c=d:u.sibling=d,u=d);return jf&&Ln(a,m),c}for(d=s(d);!y.done;m++,y=i.next())null!==(b=f(d,a,m,y.value,l))&&(v=g(a,b,y.value,v),e&&null!==b.alternate&&d.delete(null===b.key?m:b.key),r=o(b,r,m),null===u?c=b:u.sibling=b,u=b);return e&&d.forEach(function(e){return t(a,e)}),jf&&Ln(a,m),c}(i,l,v,u),Ob=d,i}if("function"==typeof c.then)return d=Rs(c._debugInfo),i=b(i,l,zs(c),u),Ob=d,i;if(c.$$typeof===Md)return b(i,l,ls(i,c),u);Ws(i,c)}return"string"==typeof c&&""!==c||"number"==typeof c||"bigint"==typeof c?(d=""+c,null!==l&&6===l.tag?(n(i,l.sibling),(u=a(l,d)).return=i,i=u):(n(i,l),(u=Pn(d,i.mode,u)).return=i,u._debugOwner=i,u._debugTask=i._debugTask,u._debugInfo=Ob,i=u),r(i)):("function"==typeof c&&Ks(i,c),"symbol"==typeof c&&Ys(i,c),n(i,l))}return function(e,t,n,s){var a=Ob;Ob=null;try{_b=0;var o=b(e,t,n,s);return Pb=null,o}catch(c){if(c===kb||c===Sb)throw c;var r=m(29,c,null,e.mode);r.lanes=s,r.return=e;var i=r._debugInfo=Ob;if(r._debugOwner=e._debugOwner,r._debugTask=e._debugTask,null!=i)for(var l=i.length-1;0<=l;l--)if("string"==typeof i[l].stack){r._debugOwner=i[l],r._debugTask=i[l].debugTask;break}return r}finally{Ob=a}}}function Qs(e,t){var n=Id(e);return e=!n&&"function"==typeof w(e),!n&&!e||(n=n?"array":"iterable",!1)}function Zs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ea(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ta(e){return{lane:e,tag:Ub,payload:null,callback:null,next:null}}function na(e,t,n){var s=e.updateQueue;if(null===s)return null;if(s=s.shared,Hb===s&&!Gb){var a=D(e);Gb=!0}return(_y&wy)!==Ny?(null===(a=s.pending)?t.next=t:(t.next=a.next,a.next=t),s.pending=t,t=bn(e),gn(e,null,n),t):(pn(e,s,t,n),bn(e))}function sa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,ae(e,n)}}function aa(e,t){var n=e.updateQueue,s=e.alternate;if(null!==s&&n===(s=s.updateQueue)){var a=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var r={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?a=o=r:o=o.next=r,n=n.next}while(null!==n);null===o?a=o=t:o=o.next=t}else a=o=t;return n={baseState:s.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:s.shared,callbacks:s.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function oa(){if(Wb){if(null!==Wg)throw Wg}}function ra(e,t,n,s){Wb=!1;var a=e.updateQueue;zb=!1,Hb=a.shared;var o=a.firstBaseUpdate,r=a.lastBaseUpdate,i=a.shared.pending;if(null!==i){a.shared.pending=null;var l=i,c=l.next;l.next=null,null===r?o=c:r.next=c,r=l;var u=e.alternate;null!==u&&((i=(u=u.updateQueue).lastBaseUpdate)!==r&&(null===i?u.firstBaseUpdate=c:i.next=c,u.lastBaseUpdate=l))}if(null!==o){var d=a.baseState;for(r=0,u=c=l=null,i=o;;){var m=-536870913&i.lane,p=m!==i.lane;if(p?(Ly&m)===m:(s&m)===m){0!==m&&m===Hg&&(Wb=!0),null!==u&&(u=u.next={lane:0,tag:i.tag,payload:i.payload,callback:null,next:null});e:{m=e;var h=i,f=t,g=n;switch(h.tag){case Rb:if("function"==typeof(h=h.payload)){0;var b=h.call(g,d,f);if(m.mode&Df){$(!0);try{h.call(g,d,f)}finally{$(!1)}}d=b;break e}d=h;break e;case Xb:m.flags=-65537&m.flags|128;case Ub:if("function"==typeof(b=h.payload)){if(h=b.call(g,d,f),m.mode&Df){$(!0);try{b.call(g,d,f)}finally{$(!1)}}0}else h=b;if(null==h)break e;d=yd({},d,h);break e;case jb:zb=!0}}null!==(m=i.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=a.callbacks)?a.callbacks=[m]:p.push(m))}else p={lane:m,tag:i.tag,payload:i.payload,callback:i.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,r|=m;if(null===(i=i.next)){if(null===(i=a.shared.pending))break;i=(p=i).next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}null===u&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,null===o&&(a.shared.lanes=0),Qy|=r,e.lanes=r,e.memoizedState=d}Hb=null}function ia(e,t){if("function"!=typeof e)throw Error("Invalid argument passed as callback. Expected a function. Instead received: "+e);e.call(t)}function la(e,t){var n=e.shared.hiddenCallbacks;if(null!==n)for(e.shared.hiddenCallbacks=null,e=0;e<n.length;e++)ia(n[e],t)}function ca(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ia(n[e],t)}function ua(e,t){var n=Yy;C(Kb,n,e),C(qb,t,e),Yy=n|t.baseLanes}function da(e){C(Kb,Yy,e),C(qb,qb.current,e)}function ma(e){Yy=Kb.current,M(qb),M(Kb)}function pa(e){var t=e.alternate;C(Zb,Zb.current&Jb,e),C($b,e,e),null===Yb&&(null===t||null!==qb.current||null!==t.memoizedState)&&(Yb=e)}function ha(e){C(Zb,Zb.current,e),C($b,e,e),null===Yb&&(Yb=e)}function fa(e){22===e.tag?(C(Zb,Zb.current,e),C($b,e,e),null===Yb&&(Yb=e)):ga(e)}function ga(e){C(Zb,Zb.current,e),C($b,$b.current,e)}function ba(e){M($b),Yb===e&&(Yb=null),M(Zb)}function va(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||su(n)||au(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ya(){var e=Nv;null===wv?wv=[e]:wv.push(e)}function xa(){var e=Nv;if(null!==wv&&(Ev++,wv[Ev]!==e)){var t=D(uv);if(!ov.has(t)&&(ov.add(t),null!==wv))for(var n=0;n<=Ev;n++){var s=wv[n],a=n===Ev?e:s;for(s=n+1+". "+s;30>s.length;)s+=" ";s+=a+"\n"}}}function Na(e){null==e||Id(e)}function wa(){var e=D(uv);lv.has(e)||lv.add(e)}function Ea(){throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://react.dev/link/invalid-hook-call for tips about how to debug and fix this problem.")}function ka(e,t){if(kv)return!1;if(null===t)return!1;e.length,t.length;for(var n=0;n<t.length&&n<e.length;n++)if(!Sh(e[n],t[n]))return!1;return!0}function Da(e,t,n,s,a,o){cv=o,uv=t,wv=null!==e?e._debugHookTypes:null,Ev=-1,kv=null!==e&&e.type!==t.type,"[object AsyncFunction]"!==Object.prototype.toString.call(n)&&"[object AsyncGeneratorFunction]"!==Object.prototype.toString.call(n)||(o=D(uv),iv.has(o)||iv.add(o)),t.memoizedState=null,t.updateQueue=null,t.lanes=0,Fd.H=null!==e&&null!==e.memoizedState?Cv:null!==wv?Mv:Sv,fv=o=(t.mode&Df)!==wf;var r=ib(n,s,a);if(fv=!1,hv&&(r=Ma(t,n,s,a)),o){$(!0);try{r=Ma(t,n,s,a)}finally{$(!1)}}return Sa(e,t),r}function Sa(e,t){t._debugHookTypes=wv,null===t.dependencies?null!==vv&&(t.dependencies={lanes:0,firstContext:null,_debugThenableState:vv}):t.dependencies._debugThenableState=vv,Fd.H=Dv;var n=null!==dv&&null!==dv.next;if(cv=0,wv=Nv=mv=dv=uv=null,Ev=-1,null!==e&&(e.flags,t.flags),pv=!1,bv=0,vv=null,n)throw Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");null===e||Kv||null!==(e=e.dependencies)&&os(e)&&(Kv=!0),Vb?(Vb=!1,e=!0):e=!1,e&&(t=D(t)||"Unknown",rv.has(t)||iv.has(t)||rv.add(t))}function Ma(e,t,n,s){uv=e;var a=0;do{if(hv&&(vv=null),bv=0,hv=!1,a>=xv)throw Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");if(a+=1,kv=!1,mv=dv=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}Ev=-1,Fd.H=Vv,o=ib(t,n,s)}while(hv);return o}function Ca(){var e=Fd.H,t=e.useState()[0];return t="function"==typeof t.then?La(t):t,e=e.useState()[0],(null!==dv?dv.memoizedState:null)!==e&&(uv.flags|=1024),t}function Va(){var e=0!==gv;return gv=0,e}function Pa(e,t,n){t.updateQueue=e.updateQueue,t.flags=(t.mode&Sf)!==wf?-402655237&t.flags:-2053&t.flags,e.lanes&=~n}function _a(e){if(pv){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}pv=!1}cv=0,wv=mv=dv=uv=null,Ev=-1,Nv=null,hv=!1,bv=gv=0,vv=null}function Oa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===mv?uv.memoizedState=mv=e:mv=mv.next=e,mv}function Ta(){if(null===dv){var e=uv.alternate;e=null!==e?e.memoizedState:null}else e=dv.next;var t=null===mv?uv.memoizedState:mv.next;if(null!==t)mv=t,dv=e;else{if(null===e){if(null===uv.alternate)throw Error("Update hook called on initial render. This is likely a bug in React. Please file an issue.");throw Error("Rendered more hooks than during the previous render.")}e={memoizedState:(dv=e).memoizedState,baseState:dv.baseState,baseQueue:dv.baseQueue,queue:dv.queue,next:null},null===mv?uv.memoizedState=mv=e:mv=mv.next=e}return mv}function La(e){var t=bv;return bv+=1,null===vv&&(vv={didWarnAboutUncachedPromise:!1,thenables:[]}),e=Bs(vv,e,t),t=uv,null===(null===mv?t.memoizedState:mv.next)&&(t=t.alternate,Fd.H=null!==t&&null!==t.memoizedState?Cv:Sv),e}function Aa(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return La(e);if(e.$$typeof===Md)return is(e)}throw Error("An unsupported type was passed to use(): "+String(e))}function Ba(e){var t=null,n=uv.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var s=uv.alternate;null!==s&&(null!==(s=s.updateQueue)&&(null!=(s=s.memoCache)&&(t={data:s.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},uv.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index])||kv)for(n=t.data[t.index]=Array(e),s=0;s<e;s++)n[s]=Ld;else n.length;return t.index++,n}function Ia(e,t){return"function"==typeof t?t(e):t}function Fa(e,t,n){var s=Oa();if(void 0!==n){var a=n(t);if(fv){$(!0);try{n(t)}finally{$(!1)}}}else a=t;return s.memoizedState=s.baseState=a,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:a},s.queue=e,e=e.dispatch=Wo.bind(null,uv,e),[s.memoizedState,e]}function Ua(e){return Ra(Ta(),dv,e)}function Ra(e,t,n){var s=e.queue;if(null===s)throw Error("Should have a queue. You are likely calling Hooks conditionally, which is not allowed. (https://react.dev/link/invalid-hook-call)");s.lastRenderedReducer=n;var a=e.baseQueue,o=s.pending;if(null!==o){if(null!==a){var r=a.next;a.next=o.next,o.next=r}t.baseQueue,t.baseQueue=a=o,s.pending=null}if(o=e.baseState,null===a)e.memoizedState=o;else{var i=r=null,l=null,c=t=a.next,u=!1;do{var d=-536870913&c.lane;if(d!==c.lane?(Ly&d)===d:(cv&d)===d){var m=c.revertLane;if(0===m)null!==l&&(l=l.next={lane:0,revertLane:0,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Hg&&(u=!0);else{if((cv&m)===m){c=c.next,m===Hg&&(u=!0);continue}d={lane:0,revertLane:c.revertLane,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(i=l=d,r=o):l=l.next=d,uv.lanes|=m,Qy|=m}d=c.action,fv&&n(o,d),o=c.hasEagerState?c.eagerState:n(o,d)}else m={lane:d,revertLane:c.revertLane,gesture:c.gesture,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===l?(i=l=m,r=o):l=l.next=m,uv.lanes|=d,Qy|=d;c=c.next}while(null!==c&&c!==t);if(null===l?r=o:l.next=i,!Sh(o,e.memoizedState)&&(Kv=!0,u&&null!==(n=Wg)))throw n;e.memoizedState=o,e.baseState=r,e.baseQueue=l,s.lastRenderedState=o}return null===a&&(s.lanes=0),[e.memoizedState,s.dispatch]}function ja(e){var t=Ta(),n=t.queue;if(null===n)throw Error("Should have a queue. You are likely calling Hooks conditionally, which is not allowed. (https://react.dev/link/invalid-hook-call)");n.lastRenderedReducer=e;var s=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var r=a=a.next;do{o=e(o,r.action),r=r.next}while(r!==a);Sh(o,t.memoizedState)||(Kv=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function Xa(e,t,n){var s=uv,a=Oa();if(jf){if(void 0===n)throw Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");var o=n();Bb||o===n()||(Bb=!0)}else{if(o=t(),Bb||(n=t(),Sh(o,n)||(Bb=!0)),null===Oy)throw Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");127&Ly||Ga(s,t,o)}return a.memoizedState=o,n={value:o,getSnapshot:t},a.queue=n,vo(Wa.bind(null,s,n,e),[e]),s.flags|=2048,ho(tv|av,{destroy:void 0},Ha.bind(null,s,n,o,t),null),o}function za(e,t,n){var s=uv,a=Ta(),o=jf;if(o){if(void 0===n)throw Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");n=n()}else if(n=t(),!Bb){var r=t();Sh(n,r)||(Bb=!0)}(r=!Sh((dv||a).memoizedState,n))&&(a.memoizedState=n,Kv=!0),a=a.queue;var i=Wa.bind(null,s,a,e);if(bo(2048,av,i,[e]),a.getSnapshot!==t||r||null!==mv&&mv.memoizedState.tag&tv){if(s.flags|=2048,ho(tv|av,{destroy:void 0},Ha.bind(null,s,a,n,t),null),null===Oy)throw Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");o||127&cv||Ga(s,t,n)}return n}function Ga(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=uv.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},uv.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ha(e,t,n,s){t.value=n,t.getSnapshot=s,qa(t)&&Ka(e)}function Wa(e,t,n){return n(function(){qa(t)&&(ps(2,"updateSyncExternalStore()",e),Ka(e))})}function qa(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Sh(e,n)}catch(s){return!0}}function Ka(e){var t=fn(e,2);null!==t&&Zi(t,e,2)}function $a(e){var t=Oa();if("function"==typeof e){var n=e;if(e=n(),fv){$(!0);try{n()}finally{$(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:e},t}function Ya(e){var t=(e=$a(e)).queue,n=qo.bind(null,uv,t);return t.dispatch=n,[e.memoizedState,n]}function Ja(e){var t=Oa();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=$o.bind(null,uv,!0,n),n.dispatch=t,[e,t]}function Qa(e,t){return Za(Ta(),dv,e,t)}function Za(e,t,n,s){return e.baseState=n,Ra(e,dv,"function"==typeof s?s:Ia)}function eo(e,t){var n=Ta();return null!==dv?Za(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])}function to(e,t,n,s,a){if(Yo(e))throw Error("Cannot update form state while rendering.");if(null!==(e=t.action)){var o={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==Fd.T?n(!0):o.isTransition=!1,s(o),null===(n=t.pending)?(o.next=t.pending=o,no(t,o)):(o.next=n.next,t.pending=n.next=o)}}function no(e,t){var n=t.action,s=t.payload,a=e.state;if(t.isTransition){var o=Fd.T,r={};r._updatedFibers=new Set,Fd.T=r;try{var i=n(a,s),l=Fd.S;null!==l&&l(r,i),so(e,t,i)}catch(c){oo(e,t,c)}finally{null!==o&&null!==r.types&&(null!==o.types&&(o.types,r.types),o.types=r.types),Fd.T=o,null===o&&r._updatedFibers&&(e=r._updatedFibers.size,r._updatedFibers.clear())}}else try{so(e,t,r=n(a,s))}catch(u){oo(e,t,u)}}function so(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?(Fd.asyncTransitions++,n.then(Lo,Lo),n.then(function(n){ao(e,t,n)},function(n){return oo(e,t,n)}),t.isTransition):ao(e,t,n)}function ao(e,t,n){t.status="fulfilled",t.value=n,ro(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,no(e,n)))}function oo(e,t,n){var s=e.pending;if(e.pending=null,null!==s){s=s.next;do{t.status="rejected",t.reason=n,ro(t),t=t.next}while(t!==s)}e.action=null}function ro(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function io(e,t){return t}function lo(e,t){if(jf){var n=Oy.formState;if(null!==n){e:{var s=uv;if(jf){if(Rf){t:{for(var a=Rf,o=Hf;8!==a.nodeType;){if(!o){a=null;break t}if(null===(a=ou(a.nextSibling))){a=null;break t}}a=(o=a.data)===MN||o===CN?a:null}if(a){Rf=ou(a.nextSibling),s=a.data===MN;break e}}zn(s)}s=!1}s&&(t=n[0])}}return(n=Oa()).memoizedState=n.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:io,lastRenderedState:t},n.queue=s,n=qo.bind(null,uv,s),s.dispatch=n,s=$a(!1),o=$o.bind(null,uv,!1,s.queue),a={state:t,dispatch:null,action:e,pending:null},(s=Oa()).queue=a,n=to.bind(null,uv,a,o,n),a.dispatch=n,s.memoizedState=e,[t,n,!1]}function co(e){return uo(Ta(),dv,e)}function uo(e,t,n){if(t=Ra(e,t,io)[0],e=Ua(Ia)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var s=La(t)}catch(r){if(r===kb)throw Sb;throw r}else s=t;var a=(t=Ta()).queue,o=a.dispatch;return n!==t.memoizedState&&(uv.flags|=2048,ho(tv|av,{destroy:void 0},mo.bind(null,a,n),null)),[s,o,e]}function mo(e,t){e.action=t}function po(e){var t=Ta(),n=dv;if(null!==n)return uo(t,n,e);Ta(),t=t.memoizedState;var s=(n=Ta()).queue.dispatch;return n.memoizedState=e,[t,s,!1]}function ho(e,t,n,s){return e={tag:e,create:n,deps:s,inst:t,next:null},null===(t=uv.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},uv.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e),e}function fo(e){return e={current:e},Oa().memoizedState=e}function go(e,t,n,s){var a=Oa();uv.flags|=e,a.memoizedState=ho(tv|t,{destroy:void 0},n,void 0===s?null:s)}function bo(e,t,n,s){var a=Ta();s=void 0===s?null:s;var o=a.memoizedState.inst;null!==dv&&null!==s&&ka(s,dv.memoizedState.deps)?a.memoizedState=ho(t,o,n,s):(uv.flags|=e,a.memoizedState=ho(tv|t,o,n,s))}function vo(e,t){(uv.mode&Sf)!==wf?go(276826112,av,e,t):go(8390656,av,e,t)}function yo(e){var t=Oa(),n={impl:e};return t.memoizedState=n,function(){if((_y&wy)!==Ny)throw Error("A function wrapped in useEffectEvent can't be called during rendering.");return n.impl.apply(void 0,arguments)}}function xo(e){var t=Ta().memoizedState;return function(e){uv.flags|=4;var t=uv.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},uv.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if((_y&wy)!==Ny)throw Error("A function wrapped in useEffectEvent can't be called during rendering.");return t.impl.apply(void 0,arguments)}}function No(e,t){var n=4194308;return(uv.mode&Sf)!==wf&&(n|=134217728),go(n,sv,e,t)}function wo(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return t.hasOwnProperty("current"),e=e(),t.current=e,function(){t.current=null}}function Eo(e,t,n){n=null!=n?n.concat([e]):null;var s=4194308;(uv.mode&Sf)!==wf&&(s|=134217728),go(s,sv,wo.bind(null,t,e),n)}function ko(e,t,n){n=null!=n?n.concat([e]):null,bo(4,sv,wo.bind(null,t,e),n)}function Do(e,t){return Oa().memoizedState=[e,void 0===t?null:t],e}function So(e,t){var n=Ta();t=void 0===t?null:t;var s=n.memoizedState;return null!==t&&ka(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Mo(e,t){var n=Oa();t=void 0===t?null:t;var s=e();if(fv){$(!0);try{e()}finally{$(!1)}}return n.memoizedState=[s,t],s}function Co(e,t){var n=Ta();t=void 0===t?null:t;var s=n.memoizedState;if(null!==t&&ka(t,s[1]))return s[0];if(s=e(),fv){$(!0);try{e()}finally{$(!1)}}return n.memoizedState=[s,t],s}function Vo(e,t){return Oo(Oa(),e,t)}function Po(e,t){return To(Ta(),dv.memoizedState,e,t)}function _o(e,t){var n=Ta();return null===dv?Oo(n,e,t):To(n,dv.memoizedState,e,t)}function Oo(e,t,n){return void 0===n||1073741824&cv&&!(261930&Ly)?e.memoizedState=t:(e.memoizedState=n,e=Qi(),uv.lanes|=e,Qy|=e,n)}function To(e,t,n,s){return Sh(n,t)?n:null!==qb.current?(e=Oo(e,n,s),Sh(e,t)||(Kv=!0),e):42&cv&&(!(1073741824&cv)||261930&Ly)?(e=Qi(),uv.lanes|=e,Qy|=e,t):(Kv=!0,e.memoizedState=n)}function Lo(){Fd.asyncTransitions--}function Ao(e,t,n,s,a){var o=Ud.p;Ud.p=0!==o&&o<Sm?o:Sm;var r,i,l,c=Fd.T,u={};u._updatedFibers=new Set,Fd.T=u,$o(e,!1,t,n);try{var d=a(),m=Fd.S;if(null!==m&&m(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then)Fd.asyncTransitions++,d.then(Lo,Lo),Ko(e,t,(r=s,i=[],l={status:"pending",value:null,reason:null,then:function(e){i.push(e)}},d.then(function(){l.status="fulfilled",l.value=r;for(var e=0;e<i.length;e++)(0,i[e])(r)},function(e){for(l.status="rejected",l.reason=e,e=0;e<i.length;e++)(0,i[e])(void 0)}),l),Ji(e));else Ko(e,t,s,Ji(e))}catch(p){Ko(e,t,{then:function(){},status:"rejected",reason:p},Ji(e))}finally{Ud.p=o,null!==c&&null!==u.types&&(null!==c.types&&(c.types,u.types),c.types=u.types),Fd.T=c,null===c&&u._updatedFibers&&(e=u._updatedFibers.size,u._updatedFibers.clear())}}function Bo(e,t,n,s){if(5!==e.tag)throw Error("Expected the form instance to be a HostComponent. This is a bug in React.");var a=Io(e).queue;!function(e){if(0>vg){vg=ng(),yg=null!=e._debugTask?e._debugTask:null,(_y&(wy|Ey))!==Ny&&(xg=ag);var t=Bc(),n=Ac();t!==Dg||n!==kg?Dg=-1.1:null!==n&&(xg=ag),Eg=t,kg=n}0>Vg&&(Vg=ng(),_g=null!=e._debugTask?e._debugTask:null,0>Cg)&&(e=Bc(),t=Ac(),e===Bg&&t===Ag||(Bg=-1.1),Lg=e,Ag=t)}(e),Ao(e,a,t,bw,null===n?c:function(){return Fo(e),n(s)})}function Io(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:bw,baseState:bw,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:bw},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Fo(e){Fd.T;var t=Io(e);null===t.next&&(t=e.alternate.memoizedState),Ko(e,t.next.queue,{},Ji(e))}function Uo(){var e=$a(!1);return e=Ao.bind(null,uv,e.queue,!0,!1),Oa().memoizedState=e,[!1,e]}function Ro(){var e=Ua(Ia)[0],t=Ta().memoizedState;return["boolean"==typeof e?e:La(e),t]}function jo(){var e=ja(Ia)[0],t=Ta().memoizedState;return["boolean"==typeof e?e:La(e),t]}function Xo(){return is(vw)}function zo(){var e=Oa(),t=Oy.identifierPrefix;if(jf){var n=Ff;t="_"+t+"R_"+(n=(If&~(1<<32-ym(If)-1)).toString(32)+n),0<(n=gv++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=yv++).toString(32)+"_";return e.memoizedState=t}function Go(){return Oa().memoizedState=Ho.bind(null,uv)}function Ho(e,t){for(var n=e.return;null!==n;){switch(n.tag){case 24:case 3:var s=Ji(n),a=ta(s),o=na(n,a,s);return null!==o&&(ps(s,"refresh()",e),Zi(o,n,s),sa(o,n,s)),e=us(),void(a.payload={cache:e})}n=n.return}}function Wo(e,t,n){var s=arguments;s[3];var a={lane:s=Ji(e),revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};Yo(e)?Jo(t,a):null!==(a=hn(e,t,a,s))&&(ps(s,"dispatch()",e),Zi(a,e,s),Qo(a,t,s))}function qo(e,t,n){var s=arguments;s[3],Ko(e,t,n,s=Ji(e))&&ps(s,"setState()",e)}function Ko(e,t,n,s){var a={lane:s,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yo(e))Jo(t,a);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer)){var r=Fd.H;Fd.H=_v;try{var i=t.lastRenderedState,l=o(i,n);if(a.hasEagerState=!0,a.eagerState=l,Sh(l,i))return pn(e,t,a,0),null===Oy&&mn(),!1}catch(c){}finally{Fd.H=r}}if(null!==(n=hn(e,t,a,s)))return Zi(n,e,s),Qo(n,t,s),!0}return!1}function $o(e,t,n,s){if(Fd.T,s={lane:2,revertLane:Ql(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Yo(e)){if(t)throw Error("Cannot update optimistic state while rendering.")}else null!==(t=hn(e,n,s,2))&&(ps(2,"setOptimistic()",e),Zi(t,e,2))}function Yo(e){var t=e.alternate;return e===uv||null!==t&&t===uv}function Jo(e,t){hv=pv=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qo(e,t,n){if(4194048&n){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,ae(e,n)}}function Zo(e){if(null!==e&&"function"!=typeof e){var t=String(e);zv.has(t)||zv.add(t)}}function er(e,t,n,s){var a=e.memoizedState,o=n(s,a);if(e.mode&Df){$(!0);try{o=n(s,a)}finally{$(!1)}}void 0===o&&(t=E(t)||"Component",Uv.has(t)||Uv.add(t)),a=null==o?a:yd({},a,o),e.memoizedState=a,0===e.lanes&&(e.updateQueue.baseState=a)}function tr(e,t,n,s,a,o,r){var i=e.stateNode;if("function"==typeof i.shouldComponentUpdate){if(n=i.shouldComponentUpdate(s,o,r),e.mode&Df){$(!0);try{n=i.shouldComponentUpdate(s,o,r)}finally{$(!1)}}return n}return!t.prototype||!t.prototype.isPureReactComponent||(!Xt(n,s)||!Xt(a,o))}function nr(e,t,n,s){var a=t.state;"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,s),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==a&&(e=D(e)||"Component",Lv.has(e)||Lv.add(e),Gv.enqueueReplaceState(t,t.state,null))}function sr(e,t){var n=t;if("ref"in t)for(var s in n={},t)"ref"!==s&&(n[s]=t[s]);if(e=e.defaultProps)for(var a in n===t&&(n=yd({},n)),e)void 0===n[a]&&(n[a]=e[a]);return n}function ar(e){Kh(e)}function or(e){var t=Hv?"The above error occurred in the <"+Hv+"> component.":"The above error occurred in one of your React components.",n="React will try to recreate this component tree from scratch using the error boundary you provided, "+(Wv||"Anonymous")+".";if("object"==typeof e&&null!==e&&"string"==typeof e.environmentName){var s=e.environmentName;"string"==typeof(e=["%o\n\n%s\n\n%s\n",e,t,n].slice(0))[0]?e.splice(0,1,yw+" "+e[0],xw,ww+s+ww,Nw):e.splice(0,0,yw,xw,ww+s+ww,Nw),e.unshift(console),(s=Ew.apply(console.error,e))()}}function rr(e){Kh(e)}function ir(e,t){try{Hv=t.source?D(t.source):null,Wv=null;var n=t.value;if(null!==Fd.actQueue)Fd.thrownErrors.push(n);else(0,e.onUncaughtError)(n,{componentStack:t.stack})}catch(s){setTimeout(function(){throw s})}}function lr(e,t,n){try{Hv=n.source?D(n.source):null,Wv=D(t),(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(s){setTimeout(function(){throw s})}}function cr(e,t,n){return(n=ta(n)).tag=Xb,n.payload={element:null},n.callback=function(){X(t.source,ir,e,t)},n}function ur(e){return(e=ta(e)).tag=Xb,e}function dr(e,t,n,s){var a=n.type.getDerivedStateFromError;if("function"==typeof a){var o=s.value;e.payload=function(){return a(o)},e.callback=function(){Nn(n),X(s.source,lr,t,n,s)}}var r=n.stateNode;null!==r&&"function"==typeof r.componentDidCatch&&(e.callback=function(){Nn(n),X(s.source,lr,t,n,s),"function"!=typeof a&&(null===px?px=new Set([this]):px.add(this)),fb(this,s),"function"==typeof a||n.lanes})}function mr(e,t,n,s){t.child=null===e?Fb(t,null,n,s):Ib(t,e.child,n,s)}function pr(e,t,n,s,a){n=n.render;var o=t.ref;if("ref"in s){var r={};for(var i in s)"ref"!==i&&(r[i]=s[i])}else r=s;return rs(t),s=Da(e,t,n,r,o,a),i=Va(),null===e||Kv?(jf&&i&&Bn(t),t.flags|=1,mr(e,t,s,a),t.child):(Pa(e,t,a),Br(e,t,a))}function hr(e,t,n,s,a){if(null===e){var o=n.type;return"function"!=typeof o||kn(o)||void 0!==o.defaultProps||null!==n.compare?((e=Mn(n.type,null,s,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(n=vn(o),t.tag=15,t.type=n,Sr(t,o),fr(e,t,n,s,a))}if(o=e.child,!Ir(e,a)){var r=o.memoizedProps;if((n=null!==(n=n.compare)?n:Xt)(r,s)&&e.ref===t.ref)return Br(e,t,a)}return t.flags|=1,(e=Dn(o,s)).ref=t.ref,e.return=t,t.child=e}function fr(e,t,n,s,a){if(null!==e){var o=e.memoizedProps;if(Xt(o,s)&&e.ref===t.ref&&t.type===e.type){if(Kv=!1,t.pendingProps=s=o,!Ir(e,a))return t.lanes=e.lanes,Br(e,t,a);131072&e.flags&&(Kv=!0)}}return wr(e,t,n,s,a)}function gr(e,t,n,s){var a=s.children,o=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:hf,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===s.mode){if(128&t.flags){if(o=null!==o?o.baseLanes|n:n,null!==e){for(s=t.child=e.child,a=0;null!==s;)a=a|s.lanes|s.childLanes,s=s.sibling;s=a&~o}else s=0,t.child=null;return vr(e,t,o,n,s)}if(!(536870912&n))return s=t.lanes=536870912,vr(e,t,null!==o?o.baseLanes|n:n,n,s);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Ts(t,null!==o?o.cachePool:null),null!==o?ua(t,o):da(t),fa(t)}else null!==o?(Ts(t,o.cachePool),ua(t,o),ga(t),t.memoizedState=null):(null!==e&&Ts(t,null),da(t),ga(t));return mr(e,t,a,n),t.child}function br(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:hf,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function vr(e,t,n,s,a){var o=Os();return o=null===o?null:{parent:tg._currentValue,pool:o},t.memoizedState={baseLanes:n,cachePool:o},null!==e&&Ts(t,null),da(t),fa(t),null!==e&&as(e,t,s,!0),t.childLanes=a,null}function yr(e,t){t.hidden;return(t=_r({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function xr(e,t,n){return Ib(t,e.child,null,n),(e=yr(t,t.pendingProps)).flags|=2,ba(t),t.memoizedState=null,e}function Nr(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error("Expected ref to be a function, an object returned by React.createRef(), or undefined/null.");null!==e&&e.ref===n||(t.flags|=4194816)}}function wr(e,t,n,s,a){if(n.prototype&&"function"==typeof n.prototype.render){var o=E(n)||"Unknown";$v[o]||($v[o]=!0)}return t.mode&Df&&$g.recordLegacyContextWarning(t,null),null===e&&(Sr(t,t.type),n.contextTypes&&(o=E(n)||"Unknown",Jv[o]||(Jv[o]=!0))),rs(t),n=Da(e,t,n,s,void 0,a),s=Va(),null===e||Kv?(jf&&s&&Bn(t),t.flags|=1,mr(e,t,n,a),t.child):(Pa(e,t,a),Br(e,t,a))}function Er(e,t,n,s,a,o){return rs(t),Ev=-1,kv=null!==e&&e.type!==t.type,t.updateQueue=null,n=Ma(t,s,n,a),Sa(e,t),s=Va(),null===e||Kv?(jf&&s&&Bn(t),t.flags|=1,mr(e,t,n,o),t.child):(Pa(e,t,o),Br(e,t,o))}function kr(e,t,n,s,a){switch(l(t)){case!1:var o=t.stateNode,r=new t.type(t.memoizedProps,o.context).state;o.updater.enqueueSetState(o,r,null);break;case!0:t.flags|=128,t.flags|=65536,o=Error("Simulated error coming from DevTools");var i=a&-a;if(t.lanes|=i,null===(r=Oy))throw Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");dr(i=ur(i),r,t,Tn(o,t)),aa(t,i)}if(rs(t),null===t.stateNode){if(r=yf,o=n.contextType,"contextType"in n&&null!==o&&(void 0===o||o.$$typeof!==Md)&&!Xv.has(n)&&(Xv.add(n),i=void 0===o?" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":"object"!=typeof o?" However, it is set to a "+typeof o+".":o.$$typeof===Sd?" Did you accidentally pass the Context.Consumer instead?":" However, it is set to an object with keys {"+Object.keys(o).join(", ")+"}."),"object"==typeof o&&null!==o&&(r=is(o)),o=new n(s,r),t.mode&Df){$(!0);try{o=new n(s,r)}finally{$(!1)}}if(r=t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=Gv,t.stateNode=o,o._reactInternals=t,o._reactInternalInstance=Tv,"function"==typeof n.getDerivedStateFromProps&&null===r&&(r=E(n)||"Component",Av.has(r)||Av.add(r)),"function"==typeof n.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate){var c=i=r=null;if("function"==typeof o.componentWillMount&&!0!==o.componentWillMount.__suppressDeprecationWarning?r="componentWillMount":"function"==typeof o.UNSAFE_componentWillMount&&(r="UNSAFE_componentWillMount"),"function"==typeof o.componentWillReceiveProps&&!0!==o.componentWillReceiveProps.__suppressDeprecationWarning?i="componentWillReceiveProps":"function"==typeof o.UNSAFE_componentWillReceiveProps&&(i="UNSAFE_componentWillReceiveProps"),"function"==typeof o.componentWillUpdate&&!0!==o.componentWillUpdate.__suppressDeprecationWarning?c="componentWillUpdate":"function"==typeof o.UNSAFE_componentWillUpdate&&(c="UNSAFE_componentWillUpdate"),null!==r||null!==i||null!==c){o=E(n)||"Component";var u="function"==typeof n.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";Iv.has(o)||Iv.add(o)}}o=t.stateNode,r=E(n)||"Component",o.render||n.prototype&&n.prototype.render,!o.getInitialState||o.getInitialState.isReactClassApproved||o.state,o.getDefaultProps&&o.getDefaultProps.isReactClassApproved,o.contextType,n.childContextTypes&&!jv.has(n)&&jv.add(n),n.contextTypes&&!Rv.has(n)&&Rv.add(n),o.componentShouldUpdate,n.prototype&&n.prototype.isPureReactComponent&&o.shouldComponentUpdate,o.componentDidUnmount,o.componentDidReceiveProps,o.componentWillRecieveProps,o.UNSAFE_componentWillRecieveProps,i=o.props!==s,o.props,o.defaultProps,"function"!=typeof o.getSnapshotBeforeUpdate||"function"==typeof o.componentDidUpdate||Bv.has(n)||Bv.add(n),o.getDerivedStateFromProps,o.getDerivedStateFromError,n.getSnapshotBeforeUpdate,(i=o.state)&&("object"!=typeof i||Id(i)),"function"==typeof o.getChildContext&&n.childContextTypes,(o=t.stateNode).props=s,o.state=t.memoizedState,o.refs={},Zs(t),r=n.contextType,o.context="object"==typeof r&&null!==r?is(r):yf,o.state===s&&(r=E(n)||"Component",Fv.has(r)||Fv.add(r)),t.mode&Df&&$g.recordLegacyContextWarning(t,o),$g.recordUnsafeLifecycleWarnings(t,o),o.state=t.memoizedState,"function"==typeof(r=n.getDerivedStateFromProps)&&(er(t,n,r,s),o.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(r=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),r!==o.state&&Gv.enqueueReplaceState(o,o.state,null),ra(t,s,o,a),oa(),o.state=t.memoizedState),"function"==typeof o.componentDidMount&&(t.flags|=4194308),(t.mode&Sf)!==wf&&(t.flags|=134217728),o=!0}else if(null===e){o=t.stateNode;var d=t.memoizedProps;i=sr(n,d),o.props=i;var m=o.context;c=n.contextType,r=yf,"object"==typeof c&&null!==c&&(r=is(c)),c="function"==typeof(u=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate,d=t.pendingProps!==d,c||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(d||m!==r)&&nr(t,o,s,r),zb=!1;var p=t.memoizedState;o.state=p,ra(t,s,o,a),oa(),m=t.memoizedState,d||p!==m||zb?("function"==typeof u&&(er(t,n,u,s),m=t.memoizedState),(i=zb||tr(t,n,i,s,p,m,r))?(c||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308),(t.mode&Sf)!==wf&&(t.flags|=134217728)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),(t.mode&Sf)!==wf&&(t.flags|=134217728),t.memoizedProps=s,t.memoizedState=m),o.props=s,o.state=m,o.context=r,o=i):("function"==typeof o.componentDidMount&&(t.flags|=4194308),(t.mode&Sf)!==wf&&(t.flags|=134217728),o=!1)}else{o=t.stateNode,ea(e,t),c=sr(n,r=t.memoizedProps),o.props=c,u=t.pendingProps,p=o.context,m=n.contextType,i=yf,"object"==typeof m&&null!==m&&(i=is(m)),(m="function"==typeof(d=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(r!==u||p!==i)&&nr(t,o,s,i),zb=!1,p=t.memoizedState,o.state=p,ra(t,s,o,a),oa();var h=t.memoizedState;r!==u||p!==h||zb||null!==e&&null!==e.dependencies&&os(e.dependencies)?("function"==typeof d&&(er(t,n,d,s),h=t.memoizedState),(c=zb||tr(t,n,c,s,p,h,i)||null!==e&&null!==e.dependencies&&os(e.dependencies))?(m||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(s,h,i),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(s,h,i)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||r===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||r===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=h),o.props=s,o.state=h,o.context=i,o=c):("function"!=typeof o.componentDidUpdate||r===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||r===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),o=!1)}if(i=o,Nr(e,t),r=!!(128&t.flags),i||r){if(i=t.stateNode,z(t),r&&"function"!=typeof n.getDerivedStateFromError)n=null,ug=-1;else if(n=cb(i),t.mode&Df){$(!0);try{cb(i)}finally{$(!1)}}t.flags|=1,null!==e&&r?(t.child=Ib(t,e.child,null,a),t.child=Ib(t,null,n,a)):mr(e,t,n,a),t.memoizedState=i.state,e=t.child}else e=Br(e,t,a);return a=t.stateNode,o&&a.props!==s&&(Zv=!0),e}function Dr(e,t,n,s){return qn(),t.flags|=256,mr(e,t,n,s),t.child}function Sr(e,t){t&&t.childContextTypes,"function"==typeof t.getDerivedStateFromProps&&(e=E(t)||"Unknown",Qv[e]||(Qv[e]=!0)),"object"==typeof t.contextType&&null!==t.contextType&&(t=E(t)||"Unknown",Yv[t]||(Yv[t]=!0))}function Mr(e){return{baseLanes:e,cachePool:Ls()}}function Cr(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=tx),e}function Vr(e,t,n){var s,a=t.pendingProps;i(t)&&(t.flags|=128);var o=!1,r=!!(128&t.flags);if((s=r)||(s=(null===e||null!==e.memoizedState)&&0!==(Zb.current&Qb)),s&&(o=!0,t.flags&=-129),s=!!(32&t.flags),t.flags&=-33,null===e){if(jf){if(o?pa(t):ga(t),(e=Rf)?null!==(n=null!==(n=nu(e,Hf))&&n.data!==bN?n:null)&&(s={dehydrated:n,treeContext:Fn(),retryLane:536870912,hydrationErrors:null},t.memoizedState=s,(s=_n(n)).return=t,t.child=s,Uf=t,Rf=null):n=null,null===n)throw Xn(t,e),zn(t);return au(n)?t.lanes=32:t.lanes=536870912,null}var l=a.children;if(a=a.fallback,o){ga(t);var c=t.mode;return l=_r({mode:"hidden",children:l},c),a=Vn(a,c,n,null),l.return=t,a.return=t,l.sibling=a,t.child=l,(a=t.child).memoizedState=Mr(n),a.childLanes=Cr(e,s,n),t.memoizedState=ny,br(null,a)}return pa(t),Pr(t,l)}var u=e.memoizedState;if(null!==u){var d=u.dehydrated;if(null!==d){if(r)256&t.flags?(pa(t),t.flags&=-257,t=Or(e,t,n)):null!==t.memoizedState?(ga(t),t.child=e.child,t.flags|=128,t=null):(ga(t),l=a.fallback,c=t.mode,a=_r({mode:"visible",children:a.children},c),(l=Vn(l,c,n,null)).flags|=2,a.return=t,l.return=t,a.sibling=l,t.child=a,Ib(t,e.child,null,n),(a=t.child).memoizedState=Mr(n),a.childLanes=Cr(e,s,n),t.memoizedState=ny,t=br(null,a));else if(pa(t),!!(536870912&n)&&ml(t),au(d)){if(s=d.nextSibling&&d.nextSibling.dataset){l=s.dgst;var m=s.msg;c=s.stck;var p=s.cstck}s=l,a=c,c=d=p,(l=(l=o=m)?Error(l):Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering.")).stack=a||"",l.digest=s,a={value:l,source:null,stack:s=void 0===c?null:c},"string"==typeof s&&Vf.set(l,a),$n(a),t=Or(e,t,n)}else if(Kv||as(e,t,n,!1),s=0!==(n&e.childLanes),Kv||s){if(null!==(s=Oy)&&(0!==(a=oe(s,n))&&a!==u.retryLane))throw u.retryLane=a,fn(e,a),Zi(s,e,a),qv;su(d)||pl(),t=Or(e,t,n)}else su(d)?(t.flags|=192,t.child=e.child,t=null):(e=u.treeContext,Rf=ou(d.nextSibling),Uf=t,jf=!0,Gf=null,Xf=!1,zf=null,Hf=!1,null!==e&&Un(t,e),(t=Pr(t,a.children)).flags|=4096);return t}}return o?(ga(t),l=a.fallback,c=t.mode,d=(p=e.child).sibling,(a=Dn(p,{mode:"hidden",children:a.children})).subtreeFlags=65011712&p.subtreeFlags,null!==d?l=Dn(d,l):(l=Vn(l,c,n,null)).flags|=2,l.return=t,a.return=t,a.sibling=l,t.child=a,br(null,a),a=t.child,null===(l=e.child.memoizedState)?l=Mr(n):(null!==(c=l.cachePool)?(p=tg._currentValue,c=c.parent!==p?{parent:p,pool:p}:c):c=Ls(),l={baseLanes:l.baseLanes|n,cachePool:c}),a.memoizedState=l,a.childLanes=Cr(e,s,n),t.memoizedState=ny,br(e.child,a)):(null!==u&&(62914560&n)===n&&0!==(n&e.lanes)&&ml(t),pa(t),e=(n=e.child).sibling,(n=Dn(n,{mode:"visible",children:a.children})).return=t,n.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n)}function Pr(e,t){return(t=_r({mode:"visible",children:t},e.mode)).return=e,e.child=t}function _r(e,t){return(e=m(22,e,null,t)).lanes=0,e}function Or(e,t,n){return Ib(t,e.child,null,n),(e=Pr(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Tr(e,t,n){e.lanes|=t;var s=e.alternate;null!==s&&(s.lanes|=t),ns(e.return,t,n)}function Lr(e,t,n,s,a,o){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:a,treeForkCount:o}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=n,r.tailMode=a,r.treeForkCount=o)}function Ar(e,t,n){var s=t.pendingProps,a=s.revealOrder,o=s.tail,r=s.children,i=Zb.current;(s=0!==(i&Qb))?(i=i&Jb|Qb,t.flags|=128):i&=Jb,C(Zb,i,t),i=null==a?"null":a,"forwards"===a||"unstable_legacy-backwards"===a||"together"===a||"independent"===a||ey[i]||(ey[i]=!0,null==a||"backwards"===a||"string"==typeof a&&a.toLowerCase()),ty[i=null==o?"null":o]||(null==o?"forwards"!==a&&"backwards"!==a&&"unstable_legacy-backwards"!==a||(ty[i]=!0):("visible"!==o&&"collapsed"!==o&&"hidden"!==o||"forwards"!==a&&"backwards"!==a&&"unstable_legacy-backwards"!==a)&&(ty[i]=!0));e:if(("forwards"===a||"backwards"===a||"unstable_legacy-backwards"===a)&&null!=r&&!1!==r)if(Id(r)){for(i=0;i<r.length;i++)if(!Qs(r[i]))break e}else if(i=w(r),"function"==typeof i&&(i=i.call(r)))for(var l=i.next();!l.done;l=i.next()){if(!Qs(l.value))break e;0}if(mr(e,t,r,n),r=jf?Tf:0,!s&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Tr(e,n,t);else if(19===e.tag)Tr(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===va(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Lr(t,!1,a,n,o,r);break;case"backwards":case"unstable_legacy-backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===va(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Lr(t,!0,n,null,o,r);break;case"together":Lr(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function Br(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ug=-1,Qy|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(as(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error("Resuming work not yet implemented.");if(null!==t.child){for(n=Dn(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dn(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ir(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!os(e))}function Fr(e,t,n){if(t._debugNeedsRemount&&null!==e){(n=Mn(t.type,t.key,t.pendingProps,t._debugOwner||null,t.mode,t.lanes))._debugStack=t._debugStack,n._debugTask=t._debugTask;var s=t.return;if(null===s)throw Error("Cannot swap the root fiber.");if(e.alternate=null,t.alternate=null,n.index=t.index,n.sibling=t.sibling,n.return=t.return,n.ref=t.ref,n._debugInfo=t._debugInfo,t===s.child)s.child=n;else{var a=s.child;if(null===a)throw Error("Expected parent to have a child.");for(;a.sibling!==t;)if(null===(a=a.sibling))throw Error("Expected to find the previous sibling.");a.sibling=n}return null===(t=s.deletions)?(s.deletions=[e],s.flags|=16):t.push(e),n.flags|=2,n}if(null!==e)if(e.memoizedProps!==t.pendingProps||t.type!==e.type)Kv=!0;else{if(!(Ir(e,n)||128&t.flags))return Kv=!1,function(e,t,n){switch(t.tag){case 3:V(t,t.stateNode.containerInfo),Zn(t,tg,e.memoizedState.cache),qn();break;case 27:case 5:O(t);break;case 4:V(t,t.stateNode.containerInfo);break;case 10:Zn(t,t.type,t.memoizedProps.value);break;case 12:0!==(n&t.childLanes)&&(t.flags|=4),t.flags|=2048;var s=t.stateNode;s.effectDuration=-0,s.passiveEffectDuration=-0;break;case 31:if(null!==t.memoizedState)return t.flags|=128,ha(t),null;break;case 13:if(null!==(s=t.memoizedState))return null!==s.dehydrated?(pa(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Vr(e,t,n):(pa(t),null!==(e=Br(e,t,n))?e.sibling:null);pa(t);break;case 19:var a=!!(128&e.flags);if((s=0!==(n&t.childLanes))||(as(e,t,n,!1),s=0!==(n&t.childLanes)),a){if(s)return Ar(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),C(Zb,Zb.current,t),s)break;return null;case 22:return t.lanes=0,gr(e,t,n,t.pendingProps);case 24:Zn(t,tg,e.memoizedState.cache)}return Br(e,t,n)}(e,t,n);Kv=!!(131072&e.flags)}else Kv=!1,(s=jf)&&(s=!!(1048576&t.flags)),s&&(s=t.index,An(t,Tf,s));switch(t.lanes=0,t.tag){case 16:e:{if(s=t.pendingProps,e=Is(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){if((a=e.$$typeof)===Cd){t.tag=11,t.type=e=yn(e),t=pr(null,t,e,s,n);break e}if(a===_d){t.tag=14,t=hr(null,t,e,s,n);break e}}throw t="",null!==e&&"object"==typeof e&&e.$$typeof===Od&&(t=" Did you wrap a component in React.lazy() more than once?"),n=E(e)||e,Error("Element type is invalid. Received a promise that resolves to: "+n+". Lazy element type must resolve to a class or function."+t)}kn(e)?(s=sr(e,s),t.tag=1,t.type=e=vn(e),t=kr(null,t,e,s,n)):(t.tag=0,Sr(t,e),t.type=e=vn(e),t=wr(null,t,e,s,n))}return t;case 0:return wr(e,t,t.type,t.pendingProps,n);case 1:return kr(e,t,s=t.type,a=sr(s,t.pendingProps),n);case 3:e:{if(V(t,t.stateNode.containerInfo),null===e)throw Error("Should have a current fiber. This is a bug in React.");s=t.pendingProps;var o=t.memoizedState;a=o.element,ea(e,t),ra(t,s,null,n);var r=t.memoizedState;if(s=r.cache,Zn(t,tg,s),s!==o.cache&&ss(t,[tg],n,!0),oa(),s=r.element,o.isDehydrated){if(o={element:s,isDehydrated:!1,cache:r.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Dr(e,t,s,n);break e}if(s!==a){$n(a=Tn(Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."),t)),t=Dr(e,t,s,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(Rf=ou(e.firstChild),Uf=t,jf=!0,Gf=null,Xf=!1,zf=null,Hf=!0,n=Fb(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(qn(),s===a){t=Br(e,t,n);break e}mr(e,t,s,n)}t=t.child}return t;case 26:return Nr(e,t),null===e?(n=vu(t.type,null,t.pendingProps,null))?t.memoizedState=n:jf||(n=t.type,e=t.pendingProps,(s=_c(s=Wd.current).createElement(n))[Pm]=t,s[_m]=e,xc(s,n,e),be(s),t.stateNode=s):t.memoizedState=vu(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return O(t),null===e&&jf&&(s=Wd.current,a=_(),s=t.stateNode=pu(t.type,t.pendingProps,s,a,!1),Xf||null!==(a=Vc(s,t.type,t.pendingProps,a))&&(jn(t,0).serverProps=a),Uf=t,Hf=!0,a=Rf,Gc(t.type)?(GN=a,Rf=ou(s.firstChild)):Rf=a),mr(e,t,t.pendingProps.children,n),Nr(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&jf&&(o=_(),s=it(t.type,o.ancestorInfo),(r=!(a=Rf))||(null!==(r=function(e,t,n,s){for(;1===e.nodeType;){var a=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(s){if(!e[Im])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(o!==a.rel||e.getAttribute("href")!==(null==a.href||""===a.href?null:a.href)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin)||e.getAttribute("title")!==(null==a.title?null:a.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((o=e.getAttribute("src"))!==(null==a.src?null:a.src)||e.getAttribute("type")!==(null==a.type?null:a.type)||e.getAttribute("crossorigin")!==(null==a.crossOrigin?null:a.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;W(a.name);var o=null==a.name?null:""+a.name;if("hidden"===a.type&&e.getAttribute("name")===o)return e}if(null===(e=ou(e.nextSibling)))break}return null}(a,t.type,t.pendingProps,Hf))?(t.stateNode=r,Xf||null!==(o=Vc(r,t.type,t.pendingProps,o))&&(jn(t,0).serverProps=o),Uf=t,Rf=ou(r.firstChild),Hf=!1,o=!0):o=!1,r=!o),r&&(s&&Xn(t,a),zn(t))),O(t),a=t.type,o=t.pendingProps,r=null!==e?e.memoizedProps:null,s=o.children,Lc(a,o)?s=null:null!==r&&Lc(a,r)&&(t.flags|=32),null!==t.memoizedState&&(a=Da(e,t,Ca,null,null,n),vw._currentValue=a),Nr(e,t),mr(e,t,s,n),t.child;case 6:return null===e&&jf&&(n=t.pendingProps,n=null==(s=(e=_()).ancestorInfo.current)||lt(n,s.tag,e.ancestorInfo.implicitRootScope),(s=!(e=Rf))||(null!==(s=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=ou(e.nextSibling)))return null}return e}(e,t.pendingProps,Hf))?(t.stateNode=s,Uf=t,Rf=null,s=!0):s=!1,s=!s),s&&(n&&Xn(t,e),zn(t))),null;case 13:return Vr(e,t,n);case 4:return V(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=Ib(t,null,s,n):mr(e,t,s,n),t.child;case 11:return pr(e,t,t.type,t.pendingProps,n);case 7:return mr(e,t,t.pendingProps,n),t.child;case 8:return mr(e,t,t.pendingProps.children,n),t.child;case 12:return t.flags|=4,t.flags|=2048,(s=t.stateNode).effectDuration=-0,s.passiveEffectDuration=-0,mr(e,t,t.pendingProps.children,n),t.child;case 10:return s=t.type,o=(a=t.pendingProps).value,"value"in a||sy||(sy=!0),Zn(t,s,o),mr(e,t,a.children,n),t.child;case 9:return a=t.type._context,s=t.pendingProps.children,rs(t),a=is(a),s=ib(s,a,void 0),t.flags|=1,mr(e,t,s,n),t.child;case 14:return hr(e,t,t.type,t.pendingProps,n);case 15:return fr(e,t,t.type,t.pendingProps,n);case 19:return Ar(e,t,n);case 31:return function(e,t,n){var s=t.pendingProps,a=!!(128&t.flags);if(t.flags&=-129,null===e){if(jf){if("hidden"===s.mode)return e=yr(t,s),t.lanes=536870912,br(null,e);if(ha(t),(e=Rf)?null!==(n=null!==(n=nu(e,Hf))&&n.data===bN?n:null)&&(s={dehydrated:n,treeContext:Fn(),retryLane:536870912,hydrationErrors:null},t.memoizedState=s,(s=_n(n)).return=t,t.child=s,Uf=t,Rf=null):n=null,null===n)throw Xn(t,e),zn(t);return t.lanes=536870912,null}return yr(t,s)}var o=e.memoizedState;if(null!==o){var r=o.dehydrated;if(ha(t),a)if(256&t.flags)t.flags&=-257,t=xr(e,t,n);else{if(null===t.memoizedState)throw Error("Client rendering an Activity suspended it again. This is a bug in React.");t.child=e.child,t.flags|=128,t=null}else if(!!(536870912&n)&&ml(t),Kv||as(e,t,n,!1),a=0!==(n&e.childLanes),Kv||a){if(null!==(s=Oy)&&0!==(r=oe(s,n))&&r!==o.retryLane)throw o.retryLane=r,fn(e,r),Zi(s,e,r),qv;pl(),t=xr(e,t,n)}else e=o.treeContext,Rf=ou(r.nextSibling),Uf=t,jf=!0,Gf=null,Xf=!1,zf=null,Hf=!1,null!==e&&Un(t,e),(t=yr(t,s)).flags|=4096;return t}return o=e.child,s={mode:s.mode,children:s.children},536870912&n&&0!==(n&e.lanes)&&ml(t),(e=Dn(o,s)).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return gr(e,t,n,t.pendingProps);case 24:return rs(t),s=is(tg),null===e?(null===(a=Os())&&(a=Oy,o=us(),a.pooledCache=o,ds(o),null!==o&&(a.pooledCacheLanes|=n),a=o),t.memoizedState={parent:s,cache:a},Zs(t),Zn(t,tg,a)):(0!==(e.lanes&n)&&(ea(e,t),ra(t,null,null,n),oa()),a=e.memoizedState,o=t.memoizedState,a.parent!==s?(a={parent:s,cache:s},t.memoizedState=a,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=a),Zn(t,tg,s)):(s=o.cache,Zn(t,tg,s),s!==a.cache&&ss(t,[tg],n,!0))),mr(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function Ur(e){e.flags|=4}function Rr(e,t,n,s,a){if((t=(e.mode&Mf)!==wf)&&(t=!1),t){if(e.flags|=16777216,(335544128&a)===a)if(e.stateNode.complete)e.flags|=8192;else{if(!cl())throw Cb=Mb,Db;e.flags|=8192}}else e.flags&=-16777217}function jr(e,t){if("stylesheet"!==t.type||(t.state.loading&$N)!==HN)e.flags&=-16777217;else if(e.flags|=16777216,!_u(t)){if(!cl())throw Cb=Mb,Db;e.flags|=8192}}function Xr(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?ee():536870912,e.lanes|=t,nx|=t)}function zr(e,t){if(!jf)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;null!==n;)null!==n.alternate&&(s=n),n=n.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Gr(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,s=0;if(t)if((e.mode&kf)!==wf){for(var a=e.selfBaseDuration,o=e.child;null!==o;)n|=o.lanes|o.childLanes,s|=65011712&o.subtreeFlags,s|=65011712&o.flags,a+=o.treeBaseDuration,o=o.sibling;e.treeBaseDuration=a}else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,s|=65011712&a.subtreeFlags,s|=65011712&a.flags,a.return=e,a=a.sibling;else if((e.mode&kf)!==wf){a=e.actualDuration,o=e.selfBaseDuration;for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,a+=r.actualDuration,o+=r.treeBaseDuration,r=r.sibling;e.actualDuration=a,e.treeBaseDuration=o}else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,s|=a.subtreeFlags,s|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function Hr(e,t,n){var s=t.pendingProps;switch(In(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Gr(t),null;case 3:return n=t.stateNode,s=null,null!==e&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),es(tg),P(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(Wn(t)?(Yn(),Ur(t)):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,Kn())),Gr(t),null;case 26:var a=t.type,o=t.memoizedState;return null===e?(Ur(t),null!==o?(Gr(t),jr(t,o)):(Gr(t),Rr(t,a,0,0,n))):o?o!==e.memoizedState?(Ur(t),Gr(t),jr(t,o)):(Gr(t),t.flags&=-16777217):((e=e.memoizedProps)!==s&&Ur(t),Gr(t),Rr(t,a,0,0,n)),null;case 27:if(T(t),n=Wd.current,a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&Ur(t);else{if(!s){if(null===t.stateNode)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return Gr(t),null}e=_(),Wn(t)?Gn(t):(e=pu(a,s,n,e,!0),t.stateNode=e,Ur(t))}return Gr(t),null;case 5:if(T(t),a=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&Ur(t);else{if(!s){if(null===t.stateNode)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return Gr(t),null}var r=_();if(Wn(t))Gn(t);else{switch(o=Wd.current,it(a,r.ancestorInfo),r=r.context,o=_c(o),r){case ON:o=o.createElementNS(vp,a);break;case TN:o=o.createElementNS(bp,a);break;default:switch(a){case"svg":o=o.createElementNS(vp,a);break;case"math":o=o.createElementNS(bp,a);break;case"script":(o=o.createElement("div")).innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o="string"==typeof s.is?o.createElement("select",{is:s.is}):o.createElement("select"),s.multiple?o.multiple=!0:s.size&&(o.size=s.size);break;default:o="string"==typeof s.is?o.createElement(a,{is:s.is}):o.createElement(a),-1===a.indexOf("-")&&(a.toLowerCase(),"[object HTMLUnknownElement]"!==Object.prototype.toString.call(o)||tm.call(BN,a)||(BN[a]=!0))}}o[Pm]=t,o[_m]=s;e:for(r=t.child;null!==r;){if(5===r.tag||6===r.tag)o.appendChild(r.stateNode);else if(4!==r.tag&&27!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;null===r.sibling;){if(null===r.return||r.return===t)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}t.stateNode=o;e:switch(xc(o,a,s),a){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Ur(t)}}return Gr(t),Rr(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==s&&Ur(t);else{if("string"!=typeof s&&null===t.stateNode)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");if(e=Wd.current,n=_(),Wn(t)){if(e=t.stateNode,n=t.memoizedProps,a=!Xf,s=null,null!==(o=Uf))switch(o.tag){case 3:a&&(null!==(a=iu(e,n,s))&&(jn(t,0).serverProps=a));break;case 27:case 5:s=o.memoizedProps,a&&(null!==(a=iu(e,n,s))&&(jn(t,0).serverProps=a))}e[Pm]=t,(e=!!(e.nodeValue===n||null!==s&&!0===s.suppressHydrationWarning||bc(e.nodeValue,n)))||zn(t,!0)}else null!=(a=n.ancestorInfo.current)&&lt(s,a.tag,n.ancestorInfo.implicitRootScope),(e=_c(e).createTextNode(s))[Pm]=t,t.stateNode=e}return Gr(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(s=Wn(t),null!==n){if(null===e){if(!s)throw Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error("Expected to have a hydrated activity instance. This error is likely caused by a bug in React. Please file an issue.");e[Pm]=t,Gr(t),(t.mode&kf)!==wf&&null!==n&&(null!==(e=t.child)&&(t.treeBaseDuration-=e.treeBaseDuration))}else Yn(),qn(),!(128&t.flags)&&(n=t.memoizedState=null),t.flags|=4,Gr(t),(t.mode&kf)!==wf&&null!==n&&(null!==(e=t.child)&&(t.treeBaseDuration-=e.treeBaseDuration));e=!1}else n=Kn(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(ba(t),t):(ba(t),null);if(128&t.flags)throw Error("Client rendering an Activity suspended it again. This is a bug in React.")}return Gr(t),null;case 13:if(s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=s,o=Wn(t),null!==a&&null!==a.dehydrated){if(null===e){if(!o)throw Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");o[Pm]=t,Gr(t),(t.mode&kf)!==wf&&null!==a&&(null!==(a=t.child)&&(t.treeBaseDuration-=a.treeBaseDuration))}else Yn(),qn(),!(128&t.flags)&&(a=t.memoizedState=null),t.flags|=4,Gr(t),(t.mode&kf)!==wf&&null!==a&&(null!==(a=t.child)&&(t.treeBaseDuration-=a.treeBaseDuration));a=!1}else a=Kn(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return 256&t.flags?(ba(t),t):(ba(t),null)}return ba(t),128&t.flags?(t.lanes=n,(t.mode&kf)!==wf&&Ps(t),t):(n=null!==s,e=null!==e&&null!==e.memoizedState,n&&(a=null,null!==(s=t.child).alternate&&null!==s.alternate.memoizedState&&null!==s.alternate.memoizedState.cachePool&&(a=s.alternate.memoizedState.cachePool.pool),o=null,null!==s.memoizedState&&null!==s.memoizedState.cachePool&&(o=s.memoizedState.cachePool.pool),o!==a&&(s.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),Xr(t,t.updateQueue),Gr(t),(t.mode&kf)!==wf&&n&&(null!==(e=t.child)&&(t.treeBaseDuration-=e.treeBaseDuration)),null);case 4:return P(),null===e&&oc(t.stateNode.containerInfo),Gr(t),null;case 10:return es(t.type),Gr(t),null;case 19:if(M(Zb),null===(s=t.memoizedState))return Gr(t),null;if(a=!!(128&t.flags),null===(o=s.rendering))if(a)zr(s,!1);else{if(Jy!==ky||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=va(e))){for(t.flags|=128,zr(s,!1),e=o.updateQueue,t.updateQueue=e,Xr(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)Sn(n,e),n=n.sibling;return C(Zb,Zb.current&Jb|Qb,t),jf&&Ln(t,s.treeForkCount),t.child}e=e.sibling}null!==s.tail&&rm()>cx&&(t.flags|=128,a=!0,zr(s,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=va(o))){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,Xr(t,e),zr(s,!0),null===s.tail&&"hidden"===s.tailMode&&!o.alternate&&!jf)return Gr(t),null}else 2*rm()-s.renderingStartTime>cx&&536870912!==n&&(t.flags|=128,a=!0,zr(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=s.last)?e.sibling=o:t.child=o,s.last=o)}return null!==s.tail?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=rm(),e.sibling=null,n=Zb.current,C(Zb,n=a?n&Jb|Qb:n&Jb,t),jf&&Ln(t,s.treeForkCount),e):(Gr(t),null);case 22:case 23:return ba(t),ma(),s=null!==t.memoizedState,null!==e?null!==e.memoizedState!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?!!(536870912&n)&&!(128&t.flags)&&(Gr(t),6&t.subtreeFlags&&(t.flags|=8192)):Gr(t),null!==(n=t.updateQueue)&&Xr(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),s=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(s=t.memoizedState.cachePool.pool),s!==n&&(t.flags|=2048),null!==e&&M(Kg),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),es(tg),Gr(t),null;case 25:case 30:return null}throw Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function Wr(e,t){switch(In(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,(t.mode&kf)!==wf&&Ps(t),t):null;case 3:return es(tg),P(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return T(t),null;case 31:if(null!==t.memoizedState){if(ba(t),null===t.alternate)throw Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");qn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,(t.mode&kf)!==wf&&Ps(t),t):null;case 13:if(ba(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");qn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,(t.mode&kf)!==wf&&Ps(t),t):null;case 19:return M(Zb),null;case 4:return P(),null;case 10:return es(t.type),null;case 22:case 23:return ba(t),ma(),null!==e&&M(Kg),65536&(e=t.flags)?(t.flags=-65537&e|128,(t.mode&kf)!==wf&&Ps(t),t):null;case 24:return es(tg),null;default:return null}}function qr(e,t){switch(In(t),t.tag){case 3:es(tg),P();break;case 26:case 27:case 5:T(t);break;case 4:P();break;case 31:null!==t.memoizedState&&ba(t);break;case 13:ba(t);break;case 19:M(Zb);break;case 10:es(t.type);break;case 22:case 23:ba(t),ma(),null!==e&&M(Kg);break;case 24:es(tg)}}function Kr(e){return(e.mode&kf)!==wf}function $r(e,t){Kr(e)?(Vs(),Jr(t,e),Ms()):Jr(t,e)}function Yr(e,t,n){Kr(e)?(Vs(),Qr(n,e,t),Ms()):Qr(n,e,t)}function Jr(e,t){try{var n=t.updateQueue,s=null!==n?n.lastEffect:null;if(null!==s){var a=s.next;n=a;do{if((n.tag&e)===e&&(s=void 0,(e&nv)!==ev&&!0,s=X(t,yb,n),(e&nv)!==ev&&!1,void 0!==s&&"function"!=typeof s)){var o;o=0!==(n.tag&sv)?"useLayoutEffect":0!==(n.tag&nv)?"useInsertionEffect":"useEffect";X(t,function(e,t){},o,null===s?" You returned null. If your effect does not require clean up, return undefined (or nothing).":"function"==typeof s.then?"\n\nIt looks like you wrote "+o+"(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:\n\n"+o+"(() => {\n  async function fetchData() {\n    // You can await here\n    const response = await MyAPI.getData(someId);\n    // ...\n  }\n  fetchData();\n}, [someId]); // Or [] if effect doesn't need props or state\n\nLearn more about data fetching with Hooks: https://react.dev/link/hooks-data-fetching":" You returned: "+s)}n=n.next}while(n!==a)}}catch(r){Ol(t,t.return,r)}}function Qr(e,t,n){try{var s=t.updateQueue,a=null!==s?s.lastEffect:null;if(null!==a){var o=a.next;s=o;do{if((s.tag&e)===e){var r=s.inst,i=r.destroy;void 0!==i&&(r.destroy=void 0,(e&nv)!==ev&&!0,X(a=t,Nb,a,n,i),(e&nv)!==ev&&!1)}s=s.next}while(s!==o)}}catch(l){Ol(t,t.return,l)}}function Zr(e,t){Kr(e)?(Vs(),Jr(t,e),Ms()):Jr(t,e)}function ei(e,t,n){Kr(e)?(Vs(),Qr(n,e,t),Ms()):Qr(n,e,t)}function ti(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;e.type.defaultProps||"ref"in e.memoizedProps||Zv||(n.props,e.memoizedProps,n.state,e.memoizedState);try{X(e,ca,t,n)}catch(s){Ol(e,e.return,s)}}}function ni(e,t,n){return e.getSnapshotBeforeUpdate(t,n)}function si(e,t){var n=t.memoizedProps,s=t.memoizedState;t=e.stateNode,e.type.defaultProps||"ref"in e.memoizedProps||Zv||(t.props,e.memoizedProps,t.state,e.memoizedState);try{var a=X(e,ni,t,sr(e.type,n),s);n=ay,void 0!==a||n.has(e.type)||(n.add(e.type),X(e,function(){})),t.__reactInternalSnapshotBeforeUpdate=a}catch(o){Ol(e,e.return,o)}}function ai(e,t,n){n.props=sr(e.type,e.memoizedProps),n.state=e.memoizedState,Kr(e)?(Vs(),X(e,bb,e,t,n),Ms()):X(e,bb,e,t,n)}function oi(e){var t=e.ref;if(null!==t){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;default:n=e.stateNode}if("function"==typeof t)if(Kr(e))try{Vs(),e.refCleanup=t(n)}finally{Ms()}else e.refCleanup=t(n);else"string"==typeof t||t.hasOwnProperty("current"),t.current=n}}function ri(e,t){try{X(e,oi,e)}catch(n){Ol(e,t,n)}}function ii(e,t){var n=e.ref,s=e.refCleanup;if(null!==n)if("function"==typeof s)try{if(Kr(e))try{Vs(),X(e,s)}finally{Ms()}else X(e,s)}catch(a){Ol(e,t,a)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{if(Kr(e))try{Vs(),X(e,n,null)}finally{Ms()}else X(e,n,null)}catch(o){Ol(e,t,o)}else n.current=null}function li(e,t,n,s){var a=e.memoizedProps,o=a.id,r=a.onCommit;a=a.onRender,t=null===t?"mount":"update",jg&&(t="nested-update"),"function"==typeof a&&a(o,t,e.actualDuration,e.treeBaseDuration,e.actualStartTime,n),"function"==typeof r&&r(o,t,s,n)}function ci(e,t,n,s){var a=e.memoizedProps;e=a.id,a=a.onPostCommit,t=null===t?"mount":"update",jg&&(t="nested-update"),"function"==typeof a&&a(e,t,s,n)}function ui(e){var t=e.type,n=e.memoizedProps,s=e.stateNode;try{X(e,Fc,s,t,n,e)}catch(a){Ol(e,e.return,a)}}function di(e,t,n){try{X(e,Rc,e.stateNode,e.type,n,t,e)}catch(s){Ol(e,e.return,s)}}function mi(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Gc(e.type)||4===e.tag}function pi(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||mi(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Gc(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function hi(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?(zc(n),(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t)):(zc(n),(t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=bt));else if(4!==s&&(27===s&&Gc(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(hi(e,t,n),e=e.sibling;null!==e;)hi(e,t,n),e=e.sibling}function fi(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==s&&(27===s&&Gc(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(fi(e,t,n),e=e.sibling;null!==e;)fi(e,t,n),e=e.sibling}function gi(e){for(var t,n=e.return;null!==n;){if(mi(n)){t=n;break}n=n.return}if(null==t)throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");switch(t.tag){case 27:t=t.stateNode,fi(e,n=pi(e),t);break;case 5:n=t.stateNode,32&t.flags&&(jc(n),t.flags&=-33),fi(e,t=pi(e),n);break;case 3:case 4:t=t.stateNode.containerInfo,hi(e,n=pi(e),t);break;default:throw Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}function bi(e){var t=e.stateNode,n=e.memoizedProps;try{X(e,hu,e.type,n,t,e)}catch(s){Ol(e,e.return,s)}}function vi(e,t){return 31===t.tag?(t=t.memoizedState,null!==e.memoizedState&&null===t):13===t.tag?(e=e.memoizedState,t=t.memoizedState,null!==e&&null!==e.dehydrated&&(null===t||null===t.dehydrated)):3===t.tag&&(e.memoizedState.isDehydrated&&!(256&t.flags))}function yi(e,t,n){var s=vs(),a=xs(),o=ws(),r=Es(),i=n.flags;switch(n.tag){case 0:case 11:case 15:Pi(e,n),4&i&&$r(n,sv|tv);break;case 1:if(Pi(e,n),4&i)if(e=n.stateNode,null===t)n.type.defaultProps||"ref"in n.memoizedProps||Zv||(e.props,n.memoizedProps,e.state,n.memoizedState),Kr(n)?(Vs(),X(n,db,n,e),Ms()):X(n,db,n,e);else{var l=sr(n.type,t.memoizedProps);t=t.memoizedState,n.type.defaultProps||"ref"in n.memoizedProps||Zv||(e.props,n.memoizedProps,e.state,n.memoizedState),Kr(n)?(Vs(),X(n,pb,n,e,l,t,e.__reactInternalSnapshotBeforeUpdate),Ms()):X(n,pb,n,e,l,t,e.__reactInternalSnapshotBeforeUpdate)}64&i&&ti(n),512&i&&ri(n,n.return);break;case 3:if(t=hs(),Pi(e,n),64&i&&null!==(i=n.updateQueue)){if(l=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:l=n.child.stateNode}try{X(n,ca,i,l)}catch(u){Ol(n,n.return,u)}}e.effectDuration+=fs(t);break;case 27:null===t&&4&i&&bi(n);case 26:case 5:if(Pi(e,n),null===t)if(4&i)ui(n);else if(64&i){e=n.type,t=n.memoizedProps,l=n.stateNode;try{X(n,Uc,l,e,t,n)}catch(u){Ol(n,n.return,u)}}512&i&&ri(n,n.return);break;case 12:if(4&i){i=hs(),Pi(e,n),(e=n.stateNode).effectDuration+=gs(i);try{X(n,li,n,t,ig,e.effectDuration)}catch(u){Ol(n,n.return,u)}}else Pi(e,n);break;case 31:Pi(e,n),4&i&&Ei(e,n);break;case 13:Pi(e,n),4&i&&ki(e,n),64&i&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if(e.data===wN)e._reactRetry=t;else if(e.data!==NN||n.readyState!==VN)t();else{var s=function(){t(),n.removeEventListener("DOMContentLoaded",s)};n.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}(e,i=Bl.bind(null,n))));break;case 22:if(!(i=null!==n.memoizedState||oy)){t=null!==t&&null!==t.memoizedState||ry,l=oy;var c=ry;oy=i,(ry=t)&&!c?(Li(e,n,!!(8772&n.subtreeFlags)),(n.mode&kf)!==wf&&0<=pg&&0<=hg&&.05<hg-pg&&sn(n,pg,hg)):Pi(e,n),oy=l,ry=c}break;case 30:break;default:Pi(e,n)}(n.mode&kf)!==wf&&0<=pg&&0<=hg&&((gg||.05<mg)&&rn(n,pg,hg,mg,fg),null===n.alternate&&null!==n.return&&null!==n.return.alternate&&.05<hg-pg&&(vi(n.return.alternate,n.return)||nn(n,pg,hg,"Mount"))),ys(s),Ns(a),fg=o,gg=r}function xi(e){var t=e.alternate;null!==t&&(e.alternate=null,xi(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&me(t)),e.stateNode=null,e._debugOwner=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Ni(e,t,n){for(n=n.child;null!==n;)wi(e,t,n),n=n.sibling}function wi(e,t,n){if(gm&&"function"==typeof gm.onCommitFiberUnmount)try{gm.onCommitFiberUnmount(fm,n)}catch(c){bm||(bm=!0)}var s=vs(),a=xs(),o=ws(),r=Es();switch(n.tag){case 26:ry||ii(n,t),Ni(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(e=n.stateNode).parentNode.removeChild(e);break;case 27:ry||ii(n,t);var i=my,l=py;Gc(n.type)&&(my=n.stateNode,py=!1),Ni(e,t,n),X(n,fu,n.stateNode),my=i,py=l;break;case 5:ry||ii(n,t);case 6:if(i=my,l=py,my=null,Ni(e,t,n),py=l,null!==(my=i))if(py)try{X(n,Wc,my,n.stateNode)}catch(u){Ol(n,t,u)}else try{X(n,Hc,my,n.stateNode)}catch(u){Ol(n,t,u)}break;case 18:null!==my&&(py?(qc(9===(e=my).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),ad(e)):qc(my,n.stateNode));break;case 4:i=my,l=py,my=n.stateNode.containerInfo,py=!0,Ni(e,t,n),my=i,py=l;break;case 0:case 11:case 14:case 15:Qr(nv,n,t),ry||Yr(n,t,sv),Ni(e,t,n);break;case 1:ry||(ii(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount&&ai(n,t,i)),Ni(e,t,n);break;case 21:Ni(e,t,n);break;case 22:ry=(i=ry)||null!==n.memoizedState,Ni(e,t,n),ry=i;break;default:Ni(e,t,n)}(n.mode&kf)!==wf&&0<=pg&&0<=hg&&(gg||.05<mg)&&rn(n,pg,hg,mg,fg),ys(s),Ns(a),fg=o,gg=r}function Ei(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{X(t,du,e)}catch(n){Ol(t,t.return,n)}}}function ki(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{X(t,mu,e)}catch(n){Ol(t,t.return,n)}}function Di(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new ly),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new ly),t;default:throw Error("Unexpected Suspense handler tag ("+e.tag+"). This is a bug in React.")}}(e);t.forEach(function(t){if(!n.has(t)){if(n.add(t),vm){if(null===uy||null===dy)throw Error("Expected finished root and lanes to be set. This is a bug in React.");Xl(dy,uy)}var s=Il.bind(null,e,t);t.then(s,s)}})}function Si(e,t){var n=t.deletions;if(null!==n)for(var s=0;s<n.length;s++){var a=e,o=t,r=n[s],i=vs(),l=o;e:for(;null!==l;){switch(l.tag){case 27:if(Gc(l.type)){my=l.stateNode,py=!1;break e}break;case 5:my=l.stateNode,py=!1;break e;case 3:case 4:my=l.stateNode.containerInfo,py=!0;break e}l=l.return}if(null===my)throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");wi(a,o,r),my=null,py=!1,(r.mode&kf)!==wf&&0<=pg&&0<=hg&&.05<hg-pg&&nn(r,pg,hg,"Unmount"),ys(i),null!==(o=(a=r).alternate)&&(o.return=null),a.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Mi(t,e),t=t.sibling}function Mi(e,t){var n=vs(),s=xs(),a=ws(),o=Es(),r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Si(t,e),Ci(e),4&i&&(Qr(nv|tv,e,e.return),Jr(nv|tv,e),Yr(e,e.return,sv|tv));break;case 1:if(Si(t,e),Ci(e),512&i&&(ry||null===r||ii(r,r.return)),64&i&&oy&&(null!==(i=e.updateQueue)&&null!==(r=i.callbacks))){var l=i.shared.hiddenCallbacks;i.shared.hiddenCallbacks=null===l?r:l.concat(r)}break;case 26:if(l=hy,Si(t,e),Ci(e),512&i&&(ry||null===r||ii(r,r.return)),4&i){var c=null!==r?r.memoizedState:null;if(i=e.memoizedState,null===r)if(null===i)if(null===e.stateNode){e:{i=e.type,r=e.memoizedProps,l=l.ownerDocument||l;t:switch(i){case"title":(!(c=l.getElementsByTagName("title")[0])||c[Im]||c[Pm]||c.namespaceURI===vp||c.hasAttribute("itemprop"))&&(c=l.createElement(i),l.head.insertBefore(c,l.querySelector("head > title"))),xc(c,i,r),c[Pm]=e,be(c),i=c;break e;case"link":var u=Vu("link","href",l).get(i+(r.href||""));if(u)for(var d=0;d<u.length;d++)if((c=u[d]).getAttribute("href")===(null==r.href||""===r.href?null:r.href)&&c.getAttribute("rel")===(null==r.rel?null:r.rel)&&c.getAttribute("title")===(null==r.title?null:r.title)&&c.getAttribute("crossorigin")===(null==r.crossOrigin?null:r.crossOrigin)){u.splice(d,1);break t}xc(c=l.createElement(i),i,r),l.head.appendChild(c);break;case"meta":if(u=Vu("meta","content",l).get(i+(r.content||"")))for(d=0;d<u.length;d++)if(c=u[d],W(r.content),c.getAttribute("content")===(null==r.content?null:""+r.content)&&c.getAttribute("name")===(null==r.name?null:r.name)&&c.getAttribute("property")===(null==r.property?null:r.property)&&c.getAttribute("http-equiv")===(null==r.httpEquiv?null:r.httpEquiv)&&c.getAttribute("charset")===(null==r.charSet?null:r.charSet)){u.splice(d,1);break t}xc(c=l.createElement(i),i,r),l.head.appendChild(c);break;default:throw Error('getNodesForType encountered a type it did not expect: "'+i+'". This is a bug in React.')}c[Pm]=e,be(c),i=c}e.stateNode=i}else Pu(l,e.type,e.stateNode);else e.stateNode=Du(l,i,e.memoizedProps);else c!==i?(null===c?null!==r.stateNode&&(r=r.stateNode).parentNode.removeChild(r):c.count--,null===i?Pu(l,e.type,e.stateNode):Du(l,i,e.memoizedProps)):null===i&&null!==e.stateNode&&di(e,e.memoizedProps,r.memoizedProps)}break;case 27:Si(t,e),Ci(e),512&i&&(ry||null===r||ii(r,r.return)),null!==r&&4&i&&di(e,e.memoizedProps,r.memoizedProps);break;case 5:if(Si(t,e),Ci(e),512&i&&(ry||null===r||ii(r,r.return)),32&e.flags){l=e.stateNode;try{X(e,jc,l)}catch(f){Ol(e,e.return,f)}}4&i&&null!=e.stateNode&&di(e,l=e.memoizedProps,null!==r?r.memoizedProps:l),1024&i&&(iy=!0,e.type);break;case 6:if(Si(t,e),Ci(e),4&i){if(null===e.stateNode)throw Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");i=e.memoizedProps,r=null!==r?r.memoizedProps:i,l=e.stateNode;try{X(e,Xc,l,r,i)}catch(f){Ol(e,e.return,f)}}break;case 3:if(l=hs(),uw=null,c=hy,hy=gu(t.containerInfo),Si(t,e),hy=c,Ci(e),4&i&&null!==r&&r.memoizedState.isDehydrated)try{X(e,uu,t.containerInfo)}catch(f){Ol(e,e.return,f)}iy&&(iy=!1,Vi(e)),t.effectDuration+=fs(l);break;case 4:i=hy,hy=gu(e.stateNode.containerInfo),Si(t,e),Ci(e),hy=i;break;case 12:i=hs(),Si(t,e),Ci(e),e.stateNode.effectDuration+=gs(i);break;case 31:case 19:Si(t,e),Ci(e),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Di(e,i)));break;case 13:Si(t,e),Ci(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==r&&null!==r.memoizedState)&&(rx=rm()),4&i&&(null!==(i=e.updateQueue)&&(e.updateQueue=null,Di(e,i)));break;case 22:l=null!==e.memoizedState;var m=null!==r&&null!==r.memoizedState,p=oy,h=ry;if(oy=p||l,ry=h||m,Si(t,e),ry=h,oy=p,m&&!l&&!p&&!h&&(e.mode&kf)!==wf&&0<=pg&&0<=hg&&.05<hg-pg&&sn(e,pg,hg),Ci(e),8192&i)e:for(t=e.stateNode,t._visibility=l?t._visibility&~hf:t._visibility|hf,!l||null===r||m||oy||ry||(Oi(e),(e.mode&kf)!==wf&&0<=pg&&0<=hg&&.05<hg-pg&&nn(e,pg,hg,"Disconnect")),r=null,t=e;;){if(5===t.tag||26===t.tag){if(null===r){m=r=t;try{c=m.stateNode,l?X(m,Yc,c):X(m,Zc,m.stateNode,m.memoizedProps)}catch(f){Ol(m,m.return,f)}}}else if(6===t.tag){if(null===r){m=t;try{u=m.stateNode,l?X(m,Jc,u):X(m,eu,u,m.memoizedProps)}catch(f){Ol(m,m.return,f)}}}else if(18===t.tag){if(null===r){m=t;try{d=m.stateNode,l?X(m,$c,d):X(m,Qc,m.stateNode)}catch(f){Ol(m,m.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;r===t&&(r=null),t=t.return}r===t&&(r=null),t.sibling.return=t.return,t=t.sibling}4&i&&(null!==(i=e.updateQueue)&&(null!==(r=i.retryQueue)&&(i.retryQueue=null,Di(e,r))));break;case 30:case 21:break;default:Si(t,e),Ci(e)}(e.mode&kf)!==wf&&0<=pg&&0<=hg&&((gg||.05<mg)&&rn(e,pg,hg,mg,fg),null===e.alternate&&null!==e.return&&null!==e.return.alternate&&.05<hg-pg&&(vi(e.return.alternate,e.return)||nn(e,pg,hg,"Mount"))),ys(n),Ns(s),fg=a,gg=o}function Ci(e){var t=e.flags;if(2&t){try{X(e,gi,e)}catch(n){Ol(e,e.return,n)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Vi(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Vi(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Pi(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)yi(e,t.alternate,t),t=t.sibling}function _i(e){var t=vs(),n=xs(),s=ws(),a=Es();switch(e.tag){case 0:case 11:case 14:case 15:Yr(e,e.return,sv),Oi(e);break;case 1:ii(e,e.return);var o=e.stateNode;"function"==typeof o.componentWillUnmount&&ai(e,e.return,o),Oi(e);break;case 27:X(e,fu,e.stateNode);case 26:case 5:ii(e,e.return),Oi(e);break;case 22:null===e.memoizedState&&Oi(e);break;default:Oi(e)}(e.mode&kf)!==wf&&0<=pg&&0<=hg&&(gg||.05<mg)&&rn(e,pg,hg,mg,fg),ys(t),Ns(n),fg=s,gg=a}function Oi(e){for(e=e.child;null!==e;)_i(e),e=e.sibling}function Ti(e,t,n,s){var a=vs(),o=xs(),r=ws(),i=Es(),l=n.flags;switch(n.tag){case 0:case 11:case 15:Li(e,n,s),$r(n,sv);break;case 1:if(Li(e,n,s),"function"==typeof(t=n.stateNode).componentDidMount&&X(n,db,n,t),null!==(t=n.updateQueue)){e=n.stateNode;try{X(n,la,t,e)}catch(c){Ol(n,n.return,c)}}s&&64&l&&ti(n),ri(n,n.return);break;case 27:bi(n);case 26:case 5:Li(e,n,s),s&&null===t&&4&l&&ui(n),ri(n,n.return);break;case 12:if(s&&4&l){l=hs(),Li(e,n,s),(s=n.stateNode).effectDuration+=gs(l);try{X(n,li,n,t,ig,s.effectDuration)}catch(c){Ol(n,n.return,c)}}else Li(e,n,s);break;case 31:Li(e,n,s),s&&4&l&&Ei(e,n);break;case 13:Li(e,n,s),s&&4&l&&ki(e,n);break;case 22:null===n.memoizedState&&Li(e,n,s),ri(n,n.return);break;case 30:break;default:Li(e,n,s)}(n.mode&kf)!==wf&&0<=pg&&0<=hg&&(gg||.05<mg)&&rn(n,pg,hg,mg,fg),ys(a),Ns(o),fg=r,gg=i}function Li(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;)Ti(e,t.alternate,t,n),t=t.sibling}function Ai(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&ds(e),null!=n&&ms(n))}function Bi(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(ds(t),null!=e&&ms(e))}function Ii(e,t,n,s,a){if(10256&t.subtreeFlags||0!==t.actualDuration&&(null===t.alternate||t.alternate.child!==t.child))for(t=t.child;null!==t;){var o=t.sibling;Fi(e,t,n,s,null!==o?o.actualStartTime:a),t=o}}function Fi(e,t,n,s,a){var o=vs(),r=xs(),i=ws(),l=Es(),c=lf,u=t.flags;switch(t.tag){case 0:case 11:case 15:(t.mode&kf)!==wf&&0<t.actualStartTime&&1&t.flags&&an(t,t.actualStartTime,a,fy,n),Ii(e,t,n,s,a),2048&u&&Zr(t,av|tv);break;case 1:(t.mode&kf)!==wf&&0<t.actualStartTime&&(128&t.flags?on(t,t.actualStartTime,a,[]):1&t.flags&&an(t,t.actualStartTime,a,fy,n)),Ii(e,t,n,s,a);break;case 3:var d=hs(),m=fy;fy=null!==t.alternate&&t.alternate.memoizedState.isDehydrated&&!(256&t.flags),Ii(e,t,n,s,a),fy=m,2048&u&&(n=null,null!==t.alternate&&(n=t.alternate.memoizedState.cache),(s=t.memoizedState.cache)!==n&&(ds(s),null!=n&&ms(n))),e.passiveEffectDuration+=fs(d);break;case 12:if(2048&u){u=hs(),Ii(e,t,n,s,a),(e=t.stateNode).passiveEffectDuration+=gs(u);try{X(t,ci,t,t.alternate,ig,e.passiveEffectDuration)}catch(p){Ol(t,t.return,p)}}else Ii(e,t,n,s,a);break;case 31:u=fy,d=null!==t.alternate?t.alternate.memoizedState:null,m=t.memoizedState,null!==d&&null===m?null!==(m=t.deletions)&&0<m.length&&18===m[0].tag?(fy=!1,null!==(d=d.hydrationErrors)&&on(t,t.actualStartTime,a,d)):fy=!0:fy=!1,Ii(e,t,n,s,a),fy=u;break;case 13:u=fy,d=null!==t.alternate?t.alternate.memoizedState:null,m=t.memoizedState,null===d||null===d.dehydrated||null!==m&&null!==m.dehydrated?fy=!1:null!==(m=t.deletions)&&0<m.length&&18===m[0].tag?(fy=!1,null!==(d=d.hydrationErrors)&&on(t,t.actualStartTime,a,d)):fy=!0,Ii(e,t,n,s,a),fy=u;break;case 23:break;case 22:m=t.stateNode,d=t.alternate,null!==t.memoizedState?m._visibility&ff?Ii(e,t,n,s,a):ji(e,t,n,s,a):m._visibility&ff?Ii(e,t,n,s,a):(m._visibility|=ff,Ui(e,t,n,s,!!(10256&t.subtreeFlags)||0!==t.actualDuration&&(null===t.alternate||t.alternate.child!==t.child),a),(t.mode&kf)===wf||fy||(0<=(e=t.actualStartTime)&&.05<a-e&&sn(t,e,a),0<=pg&&0<=hg&&.05<hg-pg&&sn(t,pg,hg))),2048&u&&Ai(d,t);break;case 24:Ii(e,t,n,s,a),2048&u&&Bi(t.alternate,t);break;default:Ii(e,t,n,s,a)}(t.mode&kf)!==wf&&((e=!fy&&null===t.alternate&&null!==t.return&&null!==t.return.alternate)&&(0<=(n=t.actualStartTime)&&.05<a-n&&nn(t,n,a,"Mount")),0<=pg&&0<=hg&&((gg||.05<mg)&&rn(t,pg,hg,mg,fg),e&&.05<hg-pg&&nn(t,pg,hg,"Mount"))),ys(o),Ns(r),fg=i,gg=l,lf=c}function Ui(e,t,n,s,a,o){for(a=a&&(!!(10256&t.subtreeFlags)||0!==t.actualDuration&&(null===t.alternate||t.alternate.child!==t.child)),t=t.child;null!==t;){var r=t.sibling;Ri(e,t,n,s,a,null!==r?r.actualStartTime:o),t=r}}function Ri(e,t,n,s,a,o){var r=vs(),i=xs(),l=ws(),c=Es(),u=lf;a&&(t.mode&kf)!==wf&&0<t.actualStartTime&&1&t.flags&&an(t,t.actualStartTime,o,fy,n);var d=t.flags;switch(t.tag){case 0:case 11:case 15:Ui(e,t,n,s,a,o),Zr(t,av);break;case 23:break;case 22:var m=t.stateNode;null!==t.memoizedState?m._visibility&ff?Ui(e,t,n,s,a,o):ji(e,t,n,s,o):(m._visibility|=ff,Ui(e,t,n,s,a,o)),a&&2048&d&&Ai(t.alternate,t);break;case 24:Ui(e,t,n,s,a,o),a&&2048&d&&Bi(t.alternate,t);break;default:Ui(e,t,n,s,a,o)}(t.mode&kf)!==wf&&0<=pg&&0<=hg&&(gg||.05<mg)&&rn(t,pg,hg,mg,fg),ys(r),Ns(i),fg=l,gg=c,lf=u}function ji(e,t,n,s,a){if(10256&t.subtreeFlags||0!==t.actualDuration&&(null===t.alternate||t.alternate.child!==t.child))for(var o=t.child;null!==o;){var r=e,i=n,l=s,c=null!==(t=o.sibling)?t.actualStartTime:a,u=lf;(o.mode&kf)!==wf&&0<o.actualStartTime&&1&o.flags&&an(o,o.actualStartTime,c,fy,i);var d=o.flags;switch(o.tag){case 22:ji(r,o,i,l,c),2048&d&&Ai(o.alternate,o);break;case 24:ji(r,o,i,l,c),2048&d&&Bi(o.alternate,o);break;default:ji(r,o,i,l,c)}lf=u,o=t}}function Xi(e,t,n){if(e.subtreeFlags&gy)for(e=e.child;null!==e;)zi(e,t,n),e=e.sibling}function zi(e,t,n){switch(e.tag){case 26:Xi(e,t,n),e.flags&gy&&null!==e.memoizedState&&function(e,t,n,s){if("stylesheet"===n.type&&("string"!=typeof s.media||!1!==matchMedia(s.media).matches)&&(n.state.loading&$N)===HN){if(null===n.instance){var a=xu(s.href),o=t.querySelector(Nu(a));if(o)return null!==(t=o._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=Ou.bind(e),t.then(e,e)),n.state.loading|=$N,n.instance=o,void be(o);o=t.ownerDocument||t,s=wu(s),(a=YN.get(a))&&Mu(s,a),be(o=o.createElement("link"));var r=o;r._p=new Promise(function(e,t){r.onload=e,r.onerror=t}),xc(o,"link",s),n.instance=o}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&(n.state.loading&KN)===HN&&(e.count++,n=Ou.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,hy,e.memoizedState,e.memoizedProps);break;case 5:default:Xi(e,t,n);break;case 3:case 4:var s=hy;hy=gu(e.stateNode.containerInfo),Xi(e,t,n),hy=s;break;case 22:null===e.memoizedState&&(null!==(s=e.alternate)&&null!==s.memoizedState?(s=gy,gy=16777216,Xi(e,t,n),gy=s):Xi(e,t,n))}}function Gi(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Hi(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var s=t[n],a=vs();cy=s,$i(s,e),(s.mode&kf)!==wf&&0<=pg&&0<=hg&&.05<hg-pg&&nn(s,pg,hg,"Unmount"),ys(a)}Gi(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Wi(e),e=e.sibling}function Wi(e){var t=vs(),n=xs(),s=ws(),a=Es();switch(e.tag){case 0:case 11:case 15:Hi(e),2048&e.flags&&ei(e,e.return,av|tv);break;case 3:var o=hs();Hi(e),e.stateNode.passiveEffectDuration+=fs(o);break;case 12:o=hs(),Hi(e),e.stateNode.passiveEffectDuration+=gs(o);break;case 22:o=e.stateNode,null!==e.memoizedState&&o._visibility&ff&&(null===e.return||13!==e.return.tag)?(o._visibility&=~ff,qi(e),(e.mode&kf)!==wf&&0<=pg&&0<=hg&&.05<hg-pg&&nn(e,pg,hg,"Disconnect")):Hi(e);break;default:Hi(e)}(e.mode&kf)!==wf&&0<=pg&&0<=hg&&(gg||.05<mg)&&rn(e,pg,hg,mg,fg),ys(t),Ns(n),gg=a,fg=s}function qi(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var s=t[n],a=vs();cy=s,$i(s,e),(s.mode&kf)!==wf&&0<=pg&&0<=hg&&.05<hg-pg&&nn(s,pg,hg,"Unmount"),ys(a)}Gi(e)}for(e=e.child;null!==e;)Ki(e),e=e.sibling}function Ki(e){var t=vs(),n=xs(),s=ws(),a=Es();switch(e.tag){case 0:case 11:case 15:ei(e,e.return,av),qi(e);break;case 22:var o=e.stateNode;o._visibility&ff&&(o._visibility&=~ff,qi(e));break;default:qi(e)}(e.mode&kf)!==wf&&0<=pg&&0<=hg&&(gg||.05<mg)&&rn(e,pg,hg,mg,fg),ys(t),Ns(n),gg=a,fg=s}function $i(e,t){for(;null!==cy;){var n=cy,s=n,a=t,o=vs(),r=xs(),i=ws(),l=Es();switch(s.tag){case 0:case 11:case 15:ei(s,a,av);break;case 23:case 22:null!==s.memoizedState&&null!==s.memoizedState.cachePool&&(null!=(a=s.memoizedState.cachePool.pool)&&ds(a));break;case 24:ms(s.memoizedState.cache)}if((s.mode&kf)!==wf&&0<=pg&&0<=hg&&(gg||.05<mg)&&rn(s,pg,hg,mg,fg),ys(o),Ns(r),gg=l,fg=i,null!==(s=n.child))s.return=n,cy=s;else e:for(n=e;null!==cy;){if(o=(s=cy).sibling,r=s.return,xi(s),s===n){cy=null;break e}if(null!==o){o.return=r,cy=o;break e}cy=r}}}function Yi(){var e="undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?IS_REACT_ACT_ENVIRONMENT:void 0;return e||Fd.actQueue,e}function Ji(e){if((_y&wy)!==Ny&&0!==Ly)return Ly&-Ly;var t=Fd.T;return null!==t?(t._updatedFibers||(t._updatedFibers=new Set),t._updatedFibers.add(e),Ql()):ue()}function Qi(){if(0===tx)if(536870912&Ly&&!jf)tx=536870912;else{var e=Em;!(3932160&(Em<<=1))&&(Em=262144),tx=e}return null!==(e=$b.current)&&(e.flags|=32),tx}function Zi(e,t,n){if(Fx&&(Ux=!0),(e!==Oy||Hy!==Iy&&Hy!==Gy)&&null===e.cancelPendingCommit||(il(e,0),sl(e,Ly,tx,!1)),ne(e,n),(_y&wy)!==Ny&&e===Oy){if(em)switch(t.tag){case 0:case 11:case 15:e=Ty&&D(Ty)||"Unknown",Hx.has(e)||(Hx.add(e),t=D(t)||"Unknown");break;case 1:Gx||(Gx=!0)}}else vm&&ie(e,t,n),function(e){Yi()&&null===Fd.actQueue&&X(e,function(){})}(t),e===Oy&&((_y&wy)===Ny&&(Zy|=n),Jy===Cy&&sl(e,Ly,tx,!1)),zl(e)}function el(e,t,n){if((_y&(wy|Ey))!==Ny)throw Error("Should not already be working.");if(0!==Ly&&null!==Ty){var s=Ty,a=rm();switch(Ug){case Fy:case Iy:var o=Rg;sf&&(s=s._debugTask)&&s.run(function(){}.bind());break;case Gy:o=Rg,sf&&(s=s._debugTask)&&s.run(function(){}.bind());break;default:sf&&(s=a-Rg)}}o=(n=!n&&!(127&t)&&0===(t&e.expiredLanes)||Q(e,t))?function(e,t){var n=_y;_y|=wy;var s=ul(),a=dl();if(Oy!==e||Ly!==t){if(vm){var o=e.memoizedUpdaters;0<o.size&&(Xl(e,Ly),o.clear()),le(e,t)}dx=null,cx=rm()+ux,il(e,t)}else Ky=Q(e,t);e:for(;;)try{if(Hy!==Ay&&null!==Ty)t:switch(t=Ty,o=Wy,Hy){case By:Hy=Ay,Wy=null,xl(e,t,o,By);break;case Iy:case Gy:if(As(o)){Hy=Ay,Wy=null,vl(t);break}t=function(){Hy!==Iy&&Hy!==Gy||Oy!==e||(Hy=Xy),zl(e)},o.then(t,t);break e;case Fy:Hy=Xy;break e;case Uy:Hy=Ry;break e;case Xy:As(o)?(Hy=Ay,Wy=null,vl(t)):(Hy=Ay,Wy=null,xl(e,t,o,Xy));break;case Ry:var r=null;switch(Ty.tag){case 26:r=Ty.memoizedState;case 5:case 27:var i=Ty;if(r?_u(r):i.stateNode.complete){Hy=Ay,Wy=null;var l=i.sibling;if(null!==l)Ty=l;else{var c=i.return;null!==c?(Ty=c,Nl(c)):Ty=null}break t}}Hy=Ay,Wy=null,xl(e,t,o,Ry);break;case jy:Hy=Ay,Wy=null,xl(e,t,o,jy);break;case zy:ol(),Jy=Vy;break e;default:throw Error("Unexpected SuspendedReason. This is a bug in React.")}null!==Fd.actQueue?fl():gl();break}catch(u){ll(e,u)}return Jn(),Fd.H=s,Fd.A=a,_y=n,null!==Ty?ky:(Oy=null,Ly=0,mn(),Jy)}(e,t):hl(e,t,!0);for(var r=n;;){if(o===ky){Ky&&!n&&sl(e,t,0,!1),t=Hy,Rg=ng(),Ug=t;break}if(s=rm(),a=e.current.alternate,!r||nl(a)){if(o===Sy){if(r=t,e.errorRecoveryDisabledLanes&r)var i=0;else i=0!==(i=-536870913&e.pendingLanes)?i:536870912&i?536870912:0;if(0!==i){tn(t),un(rg,s,0,mx),rl(t,s),t=i;e:{o=r,r=sx;var l=(s=e).current.memoizedState.isDehydrated;if(l&&(il(s,i).flags|=256),(i=hl(s,i,!1))!==Sy){if($y&&!l){s.errorRecoveryDisabledLanes|=o,Zy|=o,o=Cy;break e}s=ax,ax=r,null!==s&&(null===ax?ax=s:ax.push.apply(ax,s))}o=i}if(r=!1,o!==Sy)continue;s=rm()}}if(o===Dy){tn(t),un(rg,s,0,mx),rl(t,s),il(e,0),sl(e,t,0,!0);break}e:{switch(n=e,o){case ky:case Dy:throw Error("Root did not complete. This is a bug in React.");case Cy:if((4194048&t)!==t)break;case Vy:tn(t),ln(rg,s,t,mx),rl(t,s),127&(a=t)?Sg=s:4194048&a&&(Ig=s),sl(n,t,tx,!qy);break e;case Sy:ax=null;break;case My:case Py:break;default:throw Error("Unknown root exit status.")}if(null!==Fd.actQueue)El(n,a,t,ax,dx,ox,tx,Zy,nx,o,null,null,rg,s);else{if((62914560&t)===t&&10<(r=rx+lx-rm())){if(sl(n,t,tx,!qy),0!==J(n,0,!0))break e;Mx=t,n.timeoutHandle=UN(tl.bind(null,n,a,ax,dx,ox,t,tx,Zy,nx,qy,o,"Throttled",rg,s),r);break e}tl(n,a,ax,dx,ox,t,tx,Zy,nx,qy,o,null,rg,s)}}break}tn(t),a=rg,o=s,!sf||o<=a||mx&&mx.run(function(){}.bind()),rl(t,s),o=hl(e,t,!1),r=!1}zl(e)}function tl(e,t,n,s,a,o,r,i,l,c,u,d,m,p){e.timeoutHandle=jN;var h,f,g=t.subtreeFlags,b=null;if((8192&g||!(16785408&~g))&&(zi(t,o,b={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:bt}),g=(62914560&o)===o?rx-rm():(4194048&o)===o?ix-rm():0,f=g,(h=b).stylesheets&&0===h.count&&Tu(h,h.stylesheets),null!==(g=0<h.count||0<h.imgCount?function(e){var t=setTimeout(function(){if(h.stylesheets&&Tu(h,h.stylesheets),h.unsuspend){var e=h.unsuspend;h.unsuspend=null,e()}},dw+f);0<h.imgBytes&&0===hw&&(hw=125*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),s=0;s<n.length;s++){var a=n[s],o=a.transferSize,r=a.initiatorType,i=a.duration;if(o&&i&&Pc(r)){for(r=0,i=a.responseEnd,s+=1;s<n.length;s++){var l=n[s],c=l.startTime;if(c>i)break;var u=l.transferSize,d=l.initiatorType;u&&Pc(d)&&(r+=u*((l=l.responseEnd)<i?1:(i-c)/(l-c)))}if(--s,t+=8*(o+r)/(a.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}()*pw);var n=setTimeout(function(){if(h.waitingForImages=!1,0===h.count&&(h.stylesheets&&Tu(h,h.stylesheets),h.unsuspend)){var e=h.unsuspend;h.unsuspend=null,e()}},(h.imgBytes>hw?50:mw)+f);return h.unsuspend=e,function(){h.unsuspend=null,clearTimeout(t),clearTimeout(n)}}:null)))return Mx=o,e.cancelPendingCommit=g(El.bind(null,e,t,o,n,s,a,r,i,l,u,b,b.waitingForViewTransition?"Waiting for the previous Animation":0<b.count?0<b.imgCount?"Suspended on CSS and Images":"Suspended on CSS":1===b.imgCount?"Suspended on an Image":0<b.imgCount?"Suspended on Images":null,m,p)),void sl(e,o,r,!c);El(e,t,o,n,s,a,r,i,l,u,b,d,m,p)}function nl(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var s=0;s<n.length;s++){var a=n[s],o=a.getSnapshot;a=a.value;try{if(!Sh(o(),a))return!1}catch(r){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function sl(e,t,n,s){t&=~ex,t&=~Zy,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var a=t;0<a;){var o=31-ym(a),r=1<<o;s[o]=-1,a&=~r}0!==n&&se(e,n,t)}function al(){return(_y&(wy|Ey))!==Ny||(Gl(0),!1)}function ol(){if(null!==Ty){if(Hy===Ay)var e=Ty.return;else e=Ty,Jn(),_a(e),Pb=null,_b=0,e=Ty;for(;null!==e;)qr(e.alternate,e),e=e.return;Ty=null}}function rl(e,t){127&e&&(bg=t),4194048&e&&(Mg=t),62914560&e&&t,2080374784&e&&t}function il(e,t){var n=rg;if(rg=ng(),0!==Ly&&0<n){if(tn(Ly),Jy===My||Jy===Cy)ln(n,rg,t,mx);else{var s=rg,a=mx;if(sf&&!(s<=n)){var o=(738197653&t)===t?"tertiary-dark":"primary-dark",r=(536870912&t)===t?"Prewarm":(201326741&t)===t?"Interrupted Hydration":"Interrupted Render";a&&a.run(function(){}.bind())}}rl(Ly,rg)}if(n=mx,mx=null,127&t){mx=yg,a=0<=vg&&vg<bg?bg:vg,o=0<=(s=0<=Eg&&Eg<bg?bg:Eg)?s:0<=a?a:rg,0<=Sg&&(tn(2),cn(Sg,o,t,n)),n=a;var i=s,l=kg,c=0<Dg,u=xg===ag,d=xg===og;if(a=rg,s=yg,o=Ng,r=wg,sf){if(rf="Blocking",0<n?n>a&&(n=a):n=a,0<i?i>n&&(i=n):i=n,null!==l&&n>i){s&&s.run(function(){}.bind())}a>n&&(i=u?"error":(738197653&t)===t?"tertiary-light":"primary-light",u=d?"Promise Resolved":u?"Cascading Update":5<a-n?"Update Blocked":"Update",d=[],null!=r&&d.push(["Component name",r]),null!=o&&d.push(["Method name",o]),n={start:n,end:a,detail:{devtools:{properties:d,track:rf,trackGroup:of,color:i}}},s?s.run(performance.measure.bind(performance,u,n)):performance.measure(u,n))}vg=-1.1,xg=0,wg=Ng=null,Sg=-1.1,Dg=Eg,Eg=-1.1,bg=ng()}if(4194048&t&&(mx=_g,a=0<=Cg&&Cg<Mg?Mg:Cg,n=0<=Vg&&Vg<Mg?Mg:Vg,o=0<=(s=0<=Lg&&Lg<Mg?Mg:Lg)?s:0<=n?n:rg,0<=Ig&&(tn(256),cn(Ig,o,t,mx)),d=s,i=Ag,l=0<Bg,c=Pg===og,o=rg,s=_g,r=Og,u=Tg,sf&&(rf="Transition",0<n?n>o&&(n=o):n=o,0<a?a>n&&(a=n):a=n,0<d?d>a&&(d=a):d=a,a>d&&null!==i&&(s&&s.run(function(){}.bind())),n>a&&(s&&s.run(function(){}.bind())),o>n&&(a=c?"Promise Resolved":5<o-n?"Update Blocked":"Update",d=[],null!=u&&d.push(["Component name",u]),null!=r&&d.push(["Method name",r]),n={start:n,end:o,detail:{devtools:{properties:d,track:rf,trackGroup:of,color:"primary-light"}}},s?s.run(performance.measure.bind(performance,a,n)):performance.measure(a,n))),Vg=Cg=-1.1,Pg=0,Ig=-1.1,Bg=Lg,Lg=-1.1,Mg=ng()),62914560&t&&62914560&Fg&&tn(4194304),2080374784&t&&2080374784&Fg&&tn(268435456),(n=e.timeoutHandle)!==jN&&(e.timeoutHandle=jN,RN(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Mx=0,ol(),Oy=e,Ty=n=Dn(e.current,null),Ly=t,Hy=Ay,Wy=null,qy=!1,Ky=Q(e,t),$y=!1,Jy=ky,nx=tx=ex=Zy=Qy=0,ax=sx=null,ox=!1,8&t&&(t|=32&t),0!==(s=e.entangledLanes))for(e=e.entanglements,s&=t;0<s;)o=1<<(a=31-ym(s)),t|=e[a],s&=~o;return Yy=t,mn(),1e3<(e=Wh())-Gh&&(Fd.recentlyCreatedOwnerStacks=0,Gh=e),$g.discardPendingWarnings(),n}function ll(e,t){uv=null,Fd.H=Dv,Fd.getCurrentStack=null,em=!1,Zd=null,t===kb||t===Sb?(t=Fs(),Hy=Fy):t===Db?(t=Fs(),Hy=Uy):Hy=t===qv?zy:null!==t&&"object"==typeof t&&"function"==typeof t.then?jy:By,Wy=t;var n=Ty;null===n?(Jy=Dy,ir(e,Tn(t,e.current))):n.mode&kf&&Ds(n)}function cl(){var e=$b.current;return null===e||((4194048&Ly)===Ly?null===Yb:!!((62914560&Ly)===Ly||536870912&Ly)&&e===Yb)}function ul(){var e=Fd.H;return Fd.H=Dv,null===e?Dv:e}function dl(){var e=Fd.A;return Fd.A=by,e}function ml(e){null===mx&&(mx=null==e._debugTask?null:e._debugTask)}function pl(){Jy=Cy,qy||(4194048&Ly)!==Ly&&null!==$b.current||(Ky=!0),!(134217727&Qy)&&!(134217727&Zy)||null===Oy||sl(Oy,Ly,tx,!1)}function hl(e,t,n){var s=_y;_y|=wy;var a=ul(),o=dl();if(Oy!==e||Ly!==t){if(vm){var r=e.memoizedUpdaters;0<r.size&&(Xl(e,Ly),r.clear()),le(e,t)}dx=null,il(e,t)}t=!1,r=Jy;e:for(;;)try{if(Hy!==Ay&&null!==Ty){var i=Ty,l=Wy;switch(Hy){case zy:ol(),r=Vy;break e;case Fy:case Iy:case Gy:case jy:null===$b.current&&(t=!0);var c=Hy;if(Hy=Ay,Wy=null,xl(e,i,l,c),n&&Ky){r=ky;break e}break;default:c=Hy,Hy=Ay,Wy=null,xl(e,i,l,c)}}fl(),r=Jy;break}catch(u){ll(e,u)}return t&&e.shellSuspendCounter++,Jn(),_y=s,Fd.H=a,Fd.A=o,null===Ty&&(Oy=null,Ly=0,mn()),r}function fl(){for(;null!==Ty;)bl(Ty)}function gl(){for(;null!==Ty&&!am();)bl(Ty)}function bl(e){var t=e.alternate;(e.mode&kf)!==wf?(ks(e),t=X(e,Fr,t,e,Yy),Ds(e)):t=X(e,Fr,t,e,Yy),e.memoizedProps=e.pendingProps,null===t?Nl(e):Ty=t}function vl(e){var t=X(e,yl,e);e.memoizedProps=e.pendingProps,null===t?Nl(e):Ty=t}function yl(e){var t=e.alternate,n=(e.mode&kf)!==wf;switch(n&&ks(e),e.tag){case 15:case 0:t=Er(t,e,e.pendingProps,e.type,void 0,Ly);break;case 11:t=Er(t,e,e.pendingProps,e.type.render,e.ref,Ly);break;case 5:_a(e);default:qr(t,e),t=Fr(t,e=Ty=Sn(e,Yy),Yy)}return n&&Ds(e),t}function xl(e,t,n,s){Jn(),_a(t),Pb=null,_b=0;var a=t.return;try{if(function(e,t,n,s,a){if(n.flags|=32768,vm&&Xl(e,a),null!==s&&"object"==typeof s&&"function"==typeof s.then){if(null!==(t=n.alternate)&&as(t,n,a,!0),jf&&(Xf=!0),null!==(n=$b.current)){switch(n.tag){case 31:case 13:return null===Yb?pl():null===n.alternate&&Jy===ky&&(Jy=My),n.flags&=-257,n.flags|=65536,n.lanes=a,s===Mb?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([s]):t.add(s),Tl(e,s,a)),!1;case 22:return n.flags|=65536,s===Mb?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([s]):n.add(s),Tl(e,s,a)),!1}throw Error("Unexpected Suspense handler tag ("+n.tag+"). This is a bug in React.")}return Tl(e,s,a),pl(),!1}if(jf)return Xf=!0,null!==(t=$b.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,s!==Wf&&$n(Tn(Error("There was an error while hydrating but React was able to recover by instead client rendering from the nearest Suspense boundary.",{cause:s}),n))):(s!==Wf&&$n(Tn(Error("There was an error while hydrating but React was able to recover by instead client rendering the entire root.",{cause:s}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,s=Tn(s,n),aa(e,a=cr(e.stateNode,s,a)),Jy!==Cy&&(Jy=Sy)),!1;var o=Tn(Error("There was an error during concurrent rendering but React was able to recover by instead synchronously rendering the entire root.",{cause:s}),n);if(null===sx?sx=[o]:sx.push(o),Jy!==Cy&&(Jy=Sy),null===t)return!0;s=Tn(s,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,aa(n,e=cr(n.stateNode,s,e)),!1;case 1:if(t=n.type,o=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===o||"function"!=typeof o.componentDidCatch||null!==px&&px.has(o))))return n.flags|=65536,a&=-a,n.lanes|=a,dr(a=ur(a),e,n,s),aa(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,Ly))return Jy=Dy,ir(e,Tn(n,e.current)),void(Ty=null)}catch(o){if(null!==a)throw Ty=a,o;return Jy=Dy,ir(e,Tn(n,e.current)),void(Ty=null)}32768&t.flags?(jf||s===By?e=!0:Ky||536870912&Ly?e=!1:(qy=e=!0,(s===Iy||s===Gy||s===Fy||s===jy)&&(null!==(s=$b.current)&&13===s.tag&&(s.flags|=16384))),wl(t,e)):Nl(t)}function Nl(e){var t=e;do{if(32768&t.flags)return void wl(t,qy);var n=t.alternate;if(e=t.return,ks(t),n=X(t,Hr,n,t,Yy),(t.mode&kf)!==wf&&Ss(t),null!==n)return void(Ty=n);if(null!==(t=t.sibling))return void(Ty=t);Ty=t=e}while(null!==t);Jy===ky&&(Jy=Py)}function wl(e,t){do{var n=Wr(e.alternate,e);if(null!==n)return n.flags&=32767,void(Ty=n);if((e.mode&kf)!==wf){Ss(e),n=e.actualDuration;for(var s=e.child;null!==s;)n+=s.actualDuration,s=s.sibling;e.actualDuration=n}if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(Ty=e);Ty=e=n}while(null!==e);Jy=Vy,Ty=null}function El(e,t,n,s,a,o,r,i,l,c,u,d,m,p){e.cancelPendingCommit=null;do{Vl()}while(kx!==vx);if($g.flushLegacyContextWarning(),$g.flushPendingUnsafeLifecycleWarnings(),(_y&(wy|Ey))!==Ny)throw Error("Should not already be working.");if(tn(n),c===Sy?un(m,p,0,mx):null!==s?function(e,t,n,s,a,o){if(sf&&!(t<=e)){n=[];for(var r=0;r<s.length;r++){var i=s[r].value;n.push(["Recoverable Error","object"==typeof i&&null!==i&&"string"==typeof i.message?String(i.message):String(i)])}e={start:e,end:t,detail:{devtools:{color:"primary-dark",track:rf,trackGroup:of,tooltipText:a?"Hydration Failed":"Recovered after Error",properties:n}}},o?o.run(performance.measure.bind(performance,"Recovered",e)):performance.measure("Recovered",e)}}(m,p,n,s,null!==t&&null!==t.alternate&&t.alternate.memoizedState.isDehydrated&&!!(256&t.flags),mx):function(e,t,n,s){!sf||t<=e||(n=(536870912&n)===n?"Prepared":(201326741&n)===n?"Hydrated":"Render",s&&s.run(function(){}.bind()))}(m,p,n,mx),null!==t){if(t===e.current)throw Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");if(o=t.lanes|t.childLanes,function(e,t,n,s,a,o){var r=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var i=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=r&~n;0<n;){var u=31-ym(n),d=1<<u;i[u]=0,l[u]=-1;var m=c[u];if(null!==m)for(c[u]=null,u=0;u<m.length;u++){var p=m[u];null!==p&&(p.lane&=-536870913)}n&=~d}0!==s&&se(e,s,0),0!==o&&0===a&&0!==e.tag&&(e.suspendedLanes|=o&~(r&~t))}(e,n,o|=vf,r,i,l),e===Oy&&(Ty=Oy=null,Ly=0),Sx=t,Dx=e,Mx=n,Cx=o,Px=a,_x=s,Vx=p,Ox=d,Tx=hx,Lx=null,0!==t.actualDuration||10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,b=um,v=function(){return FN=window.event,Tx===hx&&(Tx=gx),Pl(),null},null!==(y=Fd.actQueue)?y.push(v):nm(b,v)):(e.callbackNode=null,e.callbackPriority=0),cg=null,ig=ng(),null!==d&&(h=p,f=ig,g=mx,!sf||f<=h||g&&g.run(function(){}.bind())),s=!!(13878&t.flags),13878&t.subtreeFlags||s){s=Fd.T,Fd.T=null,a=Ud.p,Ud.p=Dm,r=_y,_y|=Ey;try{!function(e,t){if(e=e.containerInfo,LN=Sw,qt(e=Wt(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(s&&0!==s.rangeCount){n=s.anchorNode;var a=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch(h){n=null;break e}var r=0,i=-1,l=-1,c=0,u=0,d=e,m=null;t:for(;;){for(var p;d!==n||0!==a&&3!==d.nodeType||(i=r+a),d!==o||0!==s&&3!==d.nodeType||(l=r+s),3===d.nodeType&&(r+=d.nodeValue.length),null!==(p=d.firstChild);)m=d,d=p;for(;;){if(d===e)break t;if(m===n&&++c===a&&(i=r),m===o&&++u===s&&(l=r),null!==(p=d.nextSibling))break;m=(d=m).parentNode}d=p}n=-1===i||-1===l?null:{start:i,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(AN={focusedElem:e,selectionRange:n},Sw=!1,cy=t;null!==cy;)if(e=(t=cy).child,1028&t.subtreeFlags&&null!==e)e.return=t,cy=e;else for(;null!==cy;){switch(n=(e=t=cy).alternate,a=e.flags,e.tag){case 0:if(4&a&&null!==(e=null!==(e=e.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(a=e[n]).ref.impl=a.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:1024&a&&null!==n&&si(e,n);break;case 3:if(1024&a)if(9===(n=(e=e.stateNode.containerInfo).nodeType))tu(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":tu(e);break;default:e.textContent=""}break;default:if(1024&a)throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}if(null!==(e=t.sibling)){e.return=t.return,cy=e;break}cy=t.return}}(e,t)}finally{_y=r,Ud.p=a,Fd.T=s}}kx=yx,kl(),Dl(),Sl()}var h,f,g,b,v,y}function kl(){if(kx===yx){kx=vx;var e=Dx,t=Sx,n=Mx,s=!!(13878&t.flags);if(13878&t.subtreeFlags||s){s=Fd.T,Fd.T=null;var a=Ud.p;Ud.p=Dm;var o=_y;_y|=Ey;try{uy=n,dy=e,bs(),Mi(t,e),dy=uy=null,n=AN;var r=Wt(e.containerInfo),i=n.focusedElem,l=n.selectionRange;if(r!==i&&i&&i.ownerDocument&&Ht(i.ownerDocument.documentElement,i)){if(null!==l&&qt(i)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in i)i.selectionStart=c,i.selectionEnd=Math.min(u,i.value.length);else{var d=i.ownerDocument||document,m=d&&d.defaultView||window;if(m.getSelection){var p=m.getSelection(),h=i.textContent.length,f=Math.min(l.start,h),g=void 0===l.end?f:Math.min(l.end,h);!p.extend&&f>g&&(r=g,g=f,f=r);var b=Gt(i,f),v=Gt(i,g);if(b&&v&&(1!==p.rangeCount||p.anchorNode!==b.node||p.anchorOffset!==b.offset||p.focusNode!==v.node||p.focusOffset!==v.offset)){var y=d.createRange();y.setStart(b.node,b.offset),p.removeAllRanges(),f>g?(p.addRange(y),p.extend(v.node,v.offset)):(y.setEnd(v.node,v.offset),p.addRange(y))}}}}for(d=[],p=i;p=p.parentNode;)1===p.nodeType&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"==typeof i.focus&&i.focus(),i=0;i<d.length;i++){var x=d[i];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}Sw=!!LN,AN=LN=null}finally{_y=o,Ud.p=a,Fd.T=s}}e.current=t,kx=xx}}function Dl(){if(kx===xx){kx=vx;var e=Lx;if(null!==e){ig=ng();var t=lg,n=ig}e=Dx,n=Mx;var s=!!(8772&(t=Sx).flags);if(8772&t.subtreeFlags||s){s=Fd.T,Fd.T=null;var a=Ud.p;Ud.p=Dm;var o=_y;_y|=Ey;try{uy=n,dy=e,bs(),yi(e,t.alternate,t),dy=uy=null}finally{_y=o,Ud.p=a,Fd.T=s}}e=Vx,t=Ox,lg=ng(),e=null===t?e:ig,t=lg,n=Tx===fx,s=mx,null!==cg?dn(e,t,cg,!1,s):!sf||t<=e||s&&s.run(function(){}.bind()),kx=Nx}}function Sl(){if(kx===wx||kx===Nx){if(kx===wx){var e=lg,t=lg=ng(),n=Tx===fx;Tx!==fx&&(Tx=bx)}kx=vx,om(),e=Dx;var s=Sx;t=Mx,n=_x;var a=0!==s.actualDuration||!!(10256&s.subtreeFlags)||!!(10256&s.flags);a?kx=Ex:(kx=vx,Sx=Dx=null,Cl(e,e.pendingLanes),jx=0,Xx=null);var o=e.pendingLanes;if(0===o&&(px=null),a||Rl(e),o=ce(t),s=s.stateNode,gm&&"function"==typeof gm.onCommitFiberRoot)try{var r=!(128&~s.current.flags);switch(o){case Dm:var i=lm;break;case Sm:i=cm;break;case Mm:i=um;break;case Cm:i=mm;break;default:i=um}gm.onCommitFiberRoot(fm,s,i,r)}catch(d){bm||(bm=!0)}if(vm&&e.memoizedUpdaters.clear(),yy.forEach(function(e){return e()}),null!==n){r=Fd.T,i=Ud.p,Ud.p=Dm,Fd.T=null;try{var l=e.onRecoverableError;for(s=0;s<n.length;s++){var c=n[s],u=Ml(c.stack);X(c.source,l,c.value,u)}}finally{Fd.T=r,Ud.p=i}}3&Mx&&Vl(),zl(e),o=e.pendingLanes,261930&t&&42&o?(Xg=!0,e===Ix?Bx++:(Bx=0,Ix=e)):Bx=0,a||rl(t,lg),Gl(0)}}function Ml(e){return e={componentStack:e},Object.defineProperty(e,"digest",{get:function(){}}),e}function Cl(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,ms(t)))}function Vl(){return kl(),Dl(),Sl(),Pl()}function Pl(){if(kx!==Ex)return!1;var e=Dx,t=Cx;Cx=0;var n=ce(Mx),s=Mm>n?Mm:n;n=Fd.T;var a=Ud.p;try{Ud.p=s,Fd.T=null;var o=Px;Px=null,s=Dx;var r=Mx;if(kx=vx,Sx=Dx=null,Mx=0,(_y&(wy|Ey))!==Ny)throw Error("Cannot flush passive effects while already rendering.");tn(r),Fx=!0,Ux=!1;var i;if(cg=null,i=rm(),Tx===bx);else{var l=lg;!sf||i<=l||mx&&mx.run(function(){}.bind())}l=_y,_y|=Ey;var c=s.current;bs(),Wi(c);var u=s.current;c=Vx,bs(),Fi(s,u,r,o,c),Rl(s),_y=l;var d=rm();if(u=i,c=mx,null!==cg?dn(u,d,cg,!0,c):!sf||d<=u||c&&c.run(function(){}.bind()),rl(r,d),Gl(0,!1),Ux?s===Xx?jx++:(jx=0,Xx=s):jx=0,Ux=Fx=!1,gm&&"function"==typeof gm.onPostCommitFiberRoot)try{gm.onPostCommitFiberRoot(fm,s)}catch(p){bm||(bm=!0)}var m=s.current.stateNode;return m.effectDuration=0,m.passiveEffectDuration=0,!0}finally{Ud.p=a,Fd.T=n,Cl(e,t)}}function _l(e,t,n){Cs(t=Tn(n,t)),null!==(e=na(e,t=cr(e.stateNode,t,2),2))&&(ne(e,2),zl(e))}function Ol(e,t,n){if(3===e.tag)_l(e,e,n);else for(;null!==t;){if(3===t.tag)return void _l(t,e,n);if(1===t.tag){var s=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof s.componentDidCatch&&(null===px||!px.has(s)))return Cs(e=Tn(n,e)),void(null!==(s=na(t,n=ur(2),2))&&(dr(n,s,t,e),ne(s,2),zl(s)))}t=t.return}}function Tl(e,t,n){var s=e.pingCache;if(null===s){s=e.pingCache=new xy;var a=new Set;s.set(t,a)}else void 0===(a=s.get(t))&&(a=new Set,s.set(t,a));a.has(n)||($y=!0,a.add(n),s=Ll.bind(null,e,t,n),vm&&Xl(e,n),t.then(s,s))}function Ll(e,t,n){var s=e.pingCache;null!==s&&s.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,127&n?0>vg&&(bg=vg=ng(),yg=sg("Promise Resolved"),xg=og):4194048&n&&0>Vg&&(Mg=Vg=ng(),_g=sg("Promise Resolved"),Pg=og),Yi()&&Fd.actQueue,Oy===e&&(Ly&n)===n&&(Jy===Cy||Jy===My&&(62914560&Ly)===Ly&&rm()-rx<lx?(_y&wy)===Ny&&il(e,0):ex|=n,nx===Ly&&(nx=0)),zl(e)}function Al(e,t){0===t&&(t=ee()),null!==(e=fn(e,t))&&(ne(e,t),zl(e))}function Bl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Al(e,n)}function Il(e,t){var n=0;switch(e.tag){case 31:case 13:var s=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}null!==s&&s.delete(t),Al(e,n)}function Fl(e,t,n){if(67117056&t.subtreeFlags)for(t=t.child;null!==t;){var s=e,a=t,o=a.type===kd;o=n||o,22!==a.tag?67108864&a.flags?o&&X(a,Ul,s,a):Fl(s,a,o):null===a.memoizedState&&(o&&8192&a.flags?X(a,Ul,s,a):67108864&a.subtreeFlags&&X(a,Fl,s,a,o)),t=t.sibling}}function Ul(e,t){$(!0);try{_i(t),Ki(t),Ti(e,t.alternate,t,!1),Ri(e,t,0,null,!1,0)}finally{$(!1)}}function Rl(e){var t=!0;e.current.mode&(Df|Sf)||(t=!1),Fl(e,e.current,t)}function jl(e){if((_y&wy)===Ny){var t=e.tag;if(3===t||1===t||0===t||11===t||14===t||15===t){if(t=D(e)||"ReactComponent",null!==zx){if(zx.has(t))return;zx.add(t)}else zx=new Set([t]);X(e,function(){})}}}function Xl(e,t){vm&&e.memoizedUpdaters.forEach(function(n){ie(e,n,t)})}function zl(e){e!==qx&&null===e.next&&(null===qx?Wx=qx=e:qx=qx.next=e),Yx=!0,null!==Fd.actQueue?$x||($x=!0,Jl()):Kx||(Kx=!0,Jl())}function Gl(e,t){if(!Jx&&Yx){Jx=!0;do{for(var n=!1,s=Wx;null!==s;){if(0!==e){var a=s.pendingLanes;if(0===a)var o=0;else{var r=s.suspendedLanes,i=s.pingedLanes;o=(1<<31-ym(42|e)+1)-1,o=201326741&(o&=a&~(r&~i))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,$l(s,o))}else o=Ly,!(3&(o=J(s,s===Oy?o:0,null!==s.cancelPendingCommit||s.timeoutHandle!==jN)))||Q(s,o)||(n=!0,$l(s,o));s=s.next}}while(n);Jx=!1}}function Hl(){FN=window.event,Wl()}function Wl(){Yx=$x=Kx=!1;var e=0;0!==Qx&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==IN&&(IN=e,!0);return IN=null,!1}()&&(e=Qx);for(var t=rm(),n=null,s=Wx;null!==s;){var a=s.next,o=ql(s,t);0===o?(s.next=null,null===n?Wx=a:n.next=a,null===a&&(qx=n)):(n=s,(0!==e||3&o)&&(Yx=!0)),s=a}kx!==vx&&kx!==Ex||Gl(e),0!==Qx&&(Qx=0)}function ql(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,a=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var r=31-ym(o),i=1<<r,l=a[r];-1===l?0!==(i&n)&&0===(i&s)||(a[r]=Z(i,t)):l<=t&&(e.expiredLanes|=i),o&=~i}if(n=Ly,n=J(e,e===(t=Oy)?n:0,null!==e.cancelPendingCommit||e.timeoutHandle!==jN),s=e.callbackNode,0===n||e===t&&(Hy===Iy||Hy===Gy)||null!==e.cancelPendingCommit)return null!==s&&Yl(s),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||Q(e,n)){if((t=n&-n)===e.callbackPriority&&(null===Fd.actQueue||s===Zx))return t;switch(Yl(s),ce(n)){case Dm:case Sm:n=cm;break;case Mm:n=um;break;case Cm:n=mm;break;default:n=um}return s=Kl.bind(null,e),null!==Fd.actQueue?(Fd.actQueue.push(s),n=Zx):n=nm(n,s),e.callbackPriority=t,e.callbackNode=n,t}return null!==s&&Yl(s),e.callbackPriority=2,e.callbackNode=null,2}function Kl(e,t){if(Xg=jg=!1,FN=window.event,kx!==vx&&kx!==Ex)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Tx===hx&&(Tx=gx),Vl()&&e.callbackNode!==n)return null;var s=Ly;return 0===(s=J(e,e===Oy?s:0,null!==e.cancelPendingCommit||e.timeoutHandle!==jN))?null:(el(e,s,t),ql(e,rm()),null!=e.callbackNode&&e.callbackNode===n?Kl.bind(null,e):null)}function $l(e,t){if(Vl())return null;jg=Xg,Xg=!1,el(e,t,!0)}function Yl(e){e!==Zx&&null!==e&&sm(e)}function Jl(){null!==Fd.actQueue&&Fd.actQueue.push(function(){return Wl(),null}),zN(function(){(_y&(wy|Ey))!==Ny?nm(lm,Hl):Wl()})}function Ql(){if(0===Qx){var e=Hg;0===e&&(e=wm,!(261888&(wm<<=1))&&(wm=256)),Qx=e}return Qx}function Zl(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:(W(e),gt(""+e))}function ec(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}function tc(e,t,n){e.currentTarget=n;try{t(e)}catch(s){Kh(s)}e.currentTarget=null}function nc(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var s=e[n];e:{var a=void 0,o=s.event;if(s=s.listeners,t)for(var r=s.length-1;0<=r;r--){var i=s[r],l=i.instance,c=i.currentTarget;if(i=i.listener,l!==a&&o.isPropagationStopped())break e;null!==l?X(l,tc,o,i,c):tc(o,i,c),a=l}else for(r=0;r<s.length;r++){if(l=(i=s[r]).instance,c=i.currentTarget,i=i.listener,l!==a&&o.isPropagationStopped())break e;null!==l?X(l,tc,o,i,c):tc(o,i,c),a=l}}}}function sc(e,t){tN.has(e);var n=t[Tm];void 0===n&&(n=t[Tm]=new Set);var s=e+"__bubble";n.has(s)||(rc(t,e,2,!1),n.add(s))}function ac(e,t,n){tN.has(e);var s=0;t&&(s|=4),rc(n,e,s,t)}function oc(e){if(!e[nN]){e[nN]=!0,Fm.forEach(function(t){"selectionchange"!==t&&(tN.has(t)||ac(t,!1,e),ac(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[nN]||(t[nN]=!0,ac("selectionchange",!1,t))}}function rc(e,t,n,s){switch($u(t)){case Dm:var a=Gu;break;case Sm:a=Hu;break;default:a=Wu}n=a.bind(null,t,n,e),a=void 0,!Ip||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),s?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function ic(e,t,n,s,a){var o=s;if(!(1&t||2&t||null===s))e:for(;;){if(null===s)return;var r=s.tag;if(3===r||4===r){var i=s.stateNode.containerInfo;if(i===a)break;if(4===r)for(r=s.return;null!==r;){var l=r.tag;if((3===l||4===l)&&r.stateNode.containerInfo===a)return;r=r.return}for(;null!==i;){if(null===(r=pe(i)))return;if(5===(l=r.tag)||6===l||26===l||27===l){s=o=r;continue e}i=i.parentNode}}s=s.return}xt(function(){var s=o,a=vt(n),r=[];e:{var i=Xh.get(e);if(void 0!==i){var l=Wp,c=e;switch(e){case"keypress":if(0===Et(n))break e;case"keydown":case"keyup":l=rh;break;case"focusin":c="focus",l=Qp;break;case"focusout":c="blur",l=Qp;break;case"beforeblur":case"afterblur":l=Qp;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=Yp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=Jp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=lh;break;case Ah:case Bh:case Ih:l=Zp;break;case jh:l=ch;break;case"scroll":case"scrollend":l=Kp;break;case"wheel":l=uh;break;case"copy":case"cut":case"paste":l=eh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=ih;break;case"toggle":case"beforetoggle":l=dh}var u=!!(4&t),d=!u&&("scroll"===e||"scrollend"===e),m=u?null!==i?i+"Capture":null:i;u=[];for(var p,h=s;null!==h;){var f=h;if(p=f.stateNode,5!==(f=f.tag)&&26!==f&&27!==f||null===p||null===m||null!=(f=Nt(h,m))&&u.push(lc(h,f,p)),d)break;h=h.return}0<u.length&&(i=new l(i,c,null,n,a),r.push({event:i,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(i="mouseover"===e||"pointerover"===e)||n===Op||!(c=n.relatedTarget||n.fromElement)||!pe(c)&&!c[Om])&&(l||i)&&(i=a.window===a?a:(i=a.ownerDocument)?i.defaultView||i.parentWindow:window,l?(l=s,null!==(c=(c=n.relatedTarget||n.toElement)?pe(c):null)&&(d=b(c),u=c.tag,c!==d||5!==u&&27!==u&&6!==u)&&(c=null)):(l=null,c=s),l!==c)){if(u=Yp,f="onMouseLeave",m="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(u=ih,f="onPointerLeave",m="onPointerEnter",h="pointer"),d=null==l?i:fe(l),p=null==c?i:fe(c),(i=new u(f,h+"leave",l,n,a)).target=d,i.relatedTarget=p,f=null,pe(a)===s&&((u=new u(m,h+"enter",c,n,a)).target=p,u.relatedTarget=d,f=u),d=f,l&&c)e:{for(u=uc,h=c,p=0,f=m=l;f;f=u(f))p++;f=0;for(var g=h;g;g=u(g))f++;for(;0<p-f;)m=u(m),p--;for(;0<f-p;)h=u(h),f--;for(;p--;){if(m===h||null!==h&&m===h.alternate){u=m;break e}m=u(m),h=u(h)}u=null}else u=null;null!==l&&dc(r,i,l,u,!1),null!==c&&null!==d&&dc(r,d,c,u,!0)}if("select"===(l=(i=s?fe(s):window).nodeName&&i.nodeName.toLowerCase())||"input"===l&&"file"===i.type)var v=At;else if(_t(i))if(Dh)v=jt;else{v=Ut;var y=Ft}else!(l=i.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==i.type&&"radio"!==i.type?s&&mt(s.elementType)&&(v=At):v=Rt;switch(v&&(v=v(e,s))?Ot(r,v,n,a):(y&&y(e,i,s),"focusout"===e&&s&&"number"===i.type&&null!=s.memoizedProps.value&&Ae(i,"number",i.value)),y=s?fe(s):window,e){case"focusin":(_t(y)||"true"===y.contentEditable)&&(Ch=y,Vh=s,Ph=null);break;case"focusout":Ph=Vh=Ch=null;break;case"mousedown":_h=!0;break;case"contextmenu":case"mouseup":case"dragend":_h=!1,Kt(r,n,a);break;case"selectionchange":if(Mh)break;case"keydown":case"keyup":Kt(r,n,a)}var x;if(hh)e:{switch(e){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else Nh?Vt(e,n)&&(N="onCompositionEnd"):"keydown"===e&&n.keyCode===ph&&(N="onCompositionStart");N&&(bh&&"ko"!==n.locale&&(Nh||"onCompositionStart"!==N?"onCompositionEnd"===N&&Nh&&(x=wt()):(zp="value"in(Xp=a)?Xp.value:Xp.textContent,Nh=!0)),0<(y=cc(s,N)).length&&(N=new th(N,e,null,n,a),r.push({event:N,listeners:y}),x?N.data=x:null!==(x=Pt(n))&&(N.data=x))),(x=gh?function(e,t){switch(e){case"compositionend":return Pt(t);case"keypress":return t.which!==vh?null:(xh=!0,yh);case"textInput":return(e=t.data)===yh&&xh?null:e;default:return null}}(e,n):function(e,t){if(Nh)return"compositionend"===e||!hh&&Vt(e,t)?(e=wt(),Gp=zp=Xp=null,Nh=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return bh&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(N=cc(s,"onBeforeInput")).length&&(y=new nh("onBeforeInput","beforeinput",null,n,a),r.push({event:y,listeners:N}),y.data=x)),function(e,t,n,s,a){if("submit"===t&&n&&n.stateNode===a){var o=Zl((a[_m]||null).action),r=s.submitter;r&&null!==(t=(t=r[_m]||null)?Zl(t.formAction):r.getAttribute("formAction"))&&(o=t,r=null);var i=new Wp("action","action",null,s,a);e.push({event:i,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(0!==Qx){var e=r?ec(a,r):new FormData(a),t={pending:!0,data:e,method:a.method,action:o};Object.freeze(t),Bo(n,t,null,e)}}else"function"==typeof o&&(i.preventDefault(),t={pending:!0,data:e=r?ec(a,r):new FormData(a),method:a.method,action:o},Object.freeze(t),Bo(n,t,o,e))},currentTarget:a}]})}}(r,e,s,n,a)}nc(r,t)})}function lc(e,t,n){return{instance:e,listener:t,currentTarget:n}}function cc(e,t){for(var n=t+"Capture",s=[];null!==e;){var a=e,o=a.stateNode;if(5!==(a=a.tag)&&26!==a&&27!==a||null===o||(null!=(a=Nt(e,n))&&s.unshift(lc(e,a,o)),null!=(a=Nt(e,t))&&s.push(lc(e,a,o))),3===e.tag)return s;e=e.return}return[]}function uc(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function dc(e,t,n,s,a){for(var o=t._reactName,r=[];null!==n&&n!==s;){var i=n,l=i.alternate,c=i.stateNode;if(i=i.tag,null!==l&&l===s)break;5!==i&&26!==i&&27!==i||null===c||(l=c,a?null!=(c=Nt(n,o))&&r.unshift(lc(n,c,l)):a||null!=(c=Nt(n,o))&&r.push(lc(n,c,l))),n=n.return}0!==r.length&&e.push({event:t,listeners:r})}function mc(e,t){!function(e,t){var n,s=[];for(n in t)ht(e,n)||s.push(n);t=s.map(function(e){return"`"+e+"`"}).join(", "),1===s.length||s.length}(e,t),"input"!==e&&"textarea"!==e&&"select"!==e||null==t||null!==t.value||Dp||(Dp=!0,"select"===e&&t.multiple);var n={registrationNameDependencies:Um,possibleRegistrationNames:Rm};mt(e)||"string"==typeof t.is||function(e,t,n){var s,a=[];for(s in t)ft(e,s,t[s],n)||a.push(s);t=a.map(function(e){return"`"+e+"`"}).join(", "),1===a.length||a.length}(e,t,n),t.contentEditable&&!t.suppressContentEditableWarning&&t.children}function pc(e,t,n,s){t!==n&&(n=gc(n),gc(t)!==n&&(s[e]=t))}function hc(e,t){}function fc(e,t){return(e=e.namespaceURI===bp||e.namespaceURI===vp?e.ownerDocument.createElementNS(e.namespaceURI,e.tagName):e.ownerDocument.createElement(e.tagName)).innerHTML=t,e.innerHTML}function gc(e){return G(e)&&H(e),("string"==typeof e?e:""+e).replace(dN,"\n").replace(mN,"")}function bc(e,t){return t=gc(t),gc(e)===t}function vc(e,t,n,s,a,o){switch(n){case"children":"string"==typeof s?(lt(s,t,!1),"body"===t||"textarea"===t&&""===s||ct(e,s)):"number"!=typeof s&&"bigint"!=typeof s||(lt(""+s,t,!1),"body"!==t&&ct(e,""+s));break;case"className":ke(e,"class",s);break;case"tabIndex":ke(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":ke(e,n,s);break;case"style":dt(e,s,o);break;case"data":if("object"!==t){ke(e,"data",s);break}case"src":case"href":if(""===s&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==s||"function"==typeof s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(n);break}W(s),s=gt(""+s),e.setAttribute(n,s);break;case"action":case"formAction":if(null!=s&&("form"===t?"formAction"===n||"function"==typeof s&&(null==a.encType&&null==a.method||lN||(lN=!0),null==a.target||iN||(iN=!0)):("input"===t||"button"===t)&&("action"===n||("input"===t&&"submit"!==a.type&&"image"!==a.type&&!oN||"button"===t&&null!=a.type&&"submit"!==a.type&&!oN?oN=!0:"function"==typeof s&&(null==a.name||rN||(rN=!0),null==a.formEncType&&null==a.formMethod||lN||(lN=!0),null==a.formTarget||iN||(iN=!0))))),"function"==typeof s){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof o&&("formAction"===n?("input"!==t&&vc(e,t,"name",a.name,a,null),vc(e,t,"formEncType",a.formEncType,a,null),vc(e,t,"formMethod",a.formMethod,a,null),vc(e,t,"formTarget",a.formTarget,a,null)):(vc(e,t,"encType",a.encType,a,null),vc(e,t,"method",a.method,a,null),vc(e,t,"target",a.target,a,null))),null==s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(n);break}W(s),s=gt(""+s),e.setAttribute(n,s);break;case"onClick":null!=s&&(e.onclick=bt);break;case"onScroll":null!=s&&sc("scroll",e);break;case"onScrollEnd":null!=s&&sc("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://react.dev/link/dangerously-set-inner-html for more information.");if(null!=(n=s.__html)){if(null!=a.children)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");e.innerHTML=n}}break;case"multiple":e.multiple=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"muted":e.muted=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==s||"function"==typeof s||"boolean"==typeof s||"symbol"==typeof s){e.removeAttribute("xlink:href");break}W(s),n=gt(""+s),e.setAttributeNS(pN,"xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=s&&"function"!=typeof s&&"symbol"!=typeof s?(W(s),e.setAttribute(n,""+s)):e.removeAttribute(n);break;case"inert":""!==s||uN[n]||(uN[n]=!0);case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===s?e.setAttribute(n,""):!1!==s&&null!=s&&"function"!=typeof s&&"symbol"!=typeof s?(W(s),e.setAttribute(n,s)):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&!isNaN(s)&&1<=s?(W(s),e.setAttribute(n,s)):e.removeAttribute(n);break;case"rowSpan":case"start":null==s||"function"==typeof s||"symbol"==typeof s||isNaN(s)?e.removeAttribute(n):(W(s),e.setAttribute(n,s));break;case"popover":sc("beforetoggle",e),sc("toggle",e),Ee(e,"popover",s);break;case"xlinkActuate":De(e,pN,"xlink:actuate",s);break;case"xlinkArcrole":De(e,pN,"xlink:arcrole",s);break;case"xlinkRole":De(e,pN,"xlink:role",s);break;case"xlinkShow":De(e,pN,"xlink:show",s);break;case"xlinkTitle":De(e,pN,"xlink:title",s);break;case"xlinkType":De(e,pN,"xlink:type",s);break;case"xmlBase":De(e,hN,"xml:base",s);break;case"xmlLang":De(e,hN,"xml:lang",s);break;case"xmlSpace":De(e,hN,"xml:space",s);break;case"is":Ee(e,"is",s);break;case"innerText":case"textContent":break;case"popoverTarget":cN||null==s||"object"!=typeof s||(cN=!0);default:!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1]?Ee(e,n=pt(n),s):Um.hasOwnProperty(n)}}function yc(e,t,n,s,a,o){switch(n){case"style":dt(e,s,o);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://react.dev/link/dangerously-set-inner-html for more information.");if(null!=(n=s.__html)){if(null!=a.children)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");e.innerHTML=n}}break;case"children":"string"==typeof s?ct(e,s):("number"==typeof s||"bigint"==typeof s)&&ct(e,""+s);break;case"onScroll":null!=s&&sc("scroll",e);break;case"onScrollEnd":null!=s&&sc("scrollend",e);break;case"onClick":null!=s&&(e.onclick=bt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Um.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(a=n.endsWith("Capture"),t=n.slice(2,a?n.length-7:void 0),"function"==typeof(o=null!=(o=e[_m]||null)?o[n]:null)&&e.removeEventListener(t,o,a),"function"!=typeof s)?n in e?e[n]=s:!0===s?e.setAttribute(n,""):Ee(e,n,s):("function"!=typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,s,a)))}}function xc(e,t,n){switch(mc(t,n),t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":sc("error",e),sc("load",e);var s,a=!1,o=!1;for(s in n)if(n.hasOwnProperty(s)){var r=n[s];if(null!=r)switch(s){case"src":a=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(t+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:vc(e,t,s,r,n,null)}}return o&&vc(e,t,"srcSet",n.srcSet,n,null),void(a&&vc(e,t,"src",n.src,n,null));case"input":xe(0,n),sc("invalid",e);var i=s=r=o=null,l=null,c=null;for(a in n)if(n.hasOwnProperty(a)){var u=n[a];if(null!=u)switch(a){case"name":o=u;break;case"type":r=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":s=u;break;case"defaultValue":i=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(t+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");break;default:vc(e,t,a,u,n,null)}}return Oe(0,n),void Le(e,s,i,l,c,r,o,!1);case"select":for(o in xe(0,n),sc("invalid",e),a=r=s=null,n)if(n.hasOwnProperty(o)&&null!=(i=n[o]))switch(o){case"value":s=i;break;case"defaultValue":r=i;break;case"multiple":a=i;default:vc(e,t,o,i,n,null)}return Fe(e,n),t=s,n=r,e.multiple=!!a,void(null!=t?Ie(e,!!a,t,!1):null!=n&&Ie(e,!!a,n,!0));case"textarea":for(r in xe(0,n),sc("invalid",e),s=o=a=null,n)if(n.hasOwnProperty(r)&&null!=(i=n[r]))switch(r){case"value":a=i;break;case"defaultValue":o=i;break;case"children":s=i;break;case"dangerouslySetInnerHTML":if(null!=i)throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");break;default:vc(e,t,r,i,n,null)}return Ue(0,n),void je(e,a,o,s);case"option":for(l in Be(0,n),n)if(n.hasOwnProperty(l)&&null!=(a=n[l]))if("selected"===l)e.selected=a&&"function"!=typeof a&&"symbol"!=typeof a;else vc(e,t,l,a,n,null);return;case"dialog":sc("beforetoggle",e),sc("toggle",e),sc("cancel",e),sc("close",e);break;case"iframe":case"object":sc("load",e);break;case"video":case"audio":for(a=0;a<eN.length;a++)sc(eN[a],e);break;case"image":sc("error",e),sc("load",e);break;case"details":sc("toggle",e);break;case"embed":case"source":case"link":sc("error",e),sc("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&null!=(a=n[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(t+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");default:vc(e,t,c,a,n,null)}return;default:if(mt(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(a=n[u])&&yc(e,t,u,a,n,void 0));return}}for(i in n)n.hasOwnProperty(i)&&(null!=(a=n[i])&&vc(e,t,i,a,n,null))}function Nc(e){switch(e){case"class":return"className";case"for":return"htmlFor";default:return e}}function wc(e){var t={};e=e.style;for(var n=0;n<e.length;n++){var s=e[n];t[s]=e.getPropertyValue(s)}return t}function Ec(e,t,n){if(null!=t&&"object"!=typeof t);else{var s,a,o=s="";for(a in t)if(t.hasOwnProperty(a)){var r=t[a];null!=r&&"boolean"!=typeof r&&""!==r&&(0===a.indexOf("--")?(q(r),s+=o+a+":"+(""+r).trim()):"number"!=typeof r||0===r||gp.has(a)?(q(r),s+=o+a.replace(lp,"-$1").toLowerCase().replace(cp,"-ms-")+":"+(""+r).trim()):s+=o+a.replace(lp,"-$1").toLowerCase().replace(cp,"-ms-")+":"+r+"px",o=";")}s=s||null,(t=e.getAttribute("style"))!==s&&(s=gc(s),gc(t)!==s&&(n.style=wc(e)))}}function kc(e,t,n,s,a,o){if(a.delete(n),null===(e=e.getAttribute(n)))switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":return}else if(null!=s)switch(typeof s){case"function":case"symbol":case"boolean":break;default:if(W(s),e===""+s)return}pc(t,e,s,o)}function Dc(e,t,n,s,a,o){if(a.delete(n),null===(e=e.getAttribute(n))){switch(typeof s){case"function":case"symbol":return}if(!s)return}else switch(typeof s){case"function":case"symbol":break;default:if(s)return}pc(t,e,s,o)}function Sc(e,t,n,s,a,o){if(a.delete(n),null===(e=e.getAttribute(n)))switch(typeof s){case"undefined":case"function":case"symbol":return}else if(null!=s)switch(typeof s){case"function":case"symbol":break;default:if(W(s),e===""+s)return}pc(t,e,s,o)}function Mc(e,t,n,s,a,o){if(a.delete(n),null===(e=e.getAttribute(n)))switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":return;default:if(isNaN(s))return}else if(null!=s)switch(typeof s){case"function":case"symbol":case"boolean":break;default:if(!isNaN(s)&&(W(s),e===""+s))return}pc(t,e,s,o)}function Cc(e,t,n,s,a,o){if(a.delete(n),null===(e=e.getAttribute(n)))switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":return}else if(null!=s)switch(typeof s){case"function":case"symbol":case"boolean":break;default:if(W(s),e===(n=gt(""+s)))return}pc(t,e,s,o)}function Vc(e,t,n,s){for(var a={},o=new Set,r=e.attributes,i=0;i<r.length;i++)switch(r[i].name.toLowerCase()){case"value":case"checked":case"selected":break;default:o.add(r[i].name)}if(mt(t)){for(var l in n)if(n.hasOwnProperty(l)){var c=n[l];if(null!=c)if(Um.hasOwnProperty(l))"function"!=typeof c&&hc();else if(!0!==n.suppressHydrationWarning)switch(l){case"children":"string"!=typeof c&&"number"!=typeof c||pc("children",e.textContent,c,a);continue;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":continue;case"dangerouslySetInnerHTML":r=e.innerHTML,null!=(c=c?c.__html:void 0)&&pc(l,r,c=fc(e,c),a);continue;case"style":o.delete(l),Ec(e,c,a);continue;case"offsetParent":case"offsetTop":case"offsetLeft":case"offsetWidth":case"offsetHeight":case"isContentEditable":case"outerText":case"outerHTML":o.delete(l.toLowerCase());continue;case"className":o.delete("class"),pc("className",r=we(e,"class",c),c,a);continue;default:s.context===_N&&"svg"!==t&&"math"!==t?o.delete(l.toLowerCase()):o.delete(l),pc(l,r=we(e,l,c),c,a)}}}else for(c in n)if(n.hasOwnProperty(c)&&null!=(l=n[c]))if(Um.hasOwnProperty(c))"function"!=typeof l&&hc();else if(!0!==n.suppressHydrationWarning)switch(c){case"children":"string"!=typeof l&&"number"!=typeof l||pc("children",e.textContent,l,a);continue;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"value":case"checked":case"selected":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":continue;case"dangerouslySetInnerHTML":r=e.innerHTML,null!=(l=l?l.__html:void 0)&&(r!==(l=fc(e,l))&&(a[c]={__html:r}));continue;case"className":kc(e,c,"class",l,o,a);continue;case"tabIndex":kc(e,c,"tabindex",l,o,a);continue;case"style":o.delete(c),Ec(e,l,a);continue;case"multiple":o.delete(c),pc(c,e.multiple,l,a);continue;case"muted":o.delete(c),pc(c,e.muted,l,a);continue;case"autoFocus":o.delete("autofocus"),pc(c,e.autofocus,l,a);continue;case"data":if("object"!==t){o.delete(c),pc(c,r=e.getAttribute("data"),l,a);continue}case"src":case"href":if(!(""!==l||"a"===t&&"href"===c||"object"===t&&"data"===c))continue;Cc(e,c,c,l,o,a);continue;case"action":case"formAction":if(r=e.getAttribute(c),"function"==typeof l){o.delete(c.toLowerCase()),"formAction"===c?(o.delete("name"),o.delete("formenctype"),o.delete("formmethod"),o.delete("formtarget")):(o.delete("enctype"),o.delete("method"),o.delete("target"));continue}if(r===fN){o.delete(c.toLowerCase()),pc(c,"function",l,a);continue}Cc(e,c,c.toLowerCase(),l,o,a);continue;case"xlinkHref":Cc(e,c,"xlink:href",l,o,a);continue;case"contentEditable":Sc(e,c,"contenteditable",l,o,a);continue;case"spellCheck":Sc(e,c,"spellcheck",l,o,a);continue;case"draggable":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":Sc(e,c,c,l,o,a);continue;case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":Dc(e,c,c.toLowerCase(),l,o,a);continue;case"capture":case"download":e:{i=e;var u=r=c,d=a;if(o.delete(u),null===(i=i.getAttribute(u)))switch(typeof l){case"undefined":case"function":case"symbol":break e;default:if(!1===l)break e}else if(null!=l)switch(typeof l){case"function":case"symbol":break;case"boolean":if(!0===l&&""===i)break e;break;default:if(W(l),i===""+l)break e}pc(r,i,l,d)}continue;case"cols":case"rows":case"size":case"span":e:{if(i=e,u=r=c,d=a,o.delete(u),null===(i=i.getAttribute(u)))switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":break e;default:if(isNaN(l)||1>l)break e}else if(null!=l)switch(typeof l){case"function":case"symbol":case"boolean":break;default:if(!(isNaN(l)||1>l)&&(W(l),i===""+l))break e}pc(r,i,l,d)}continue;case"rowSpan":Mc(e,c,"rowspan",l,o,a);continue;case"start":Mc(e,c,c,l,o,a);continue;case"xHeight":kc(e,c,"x-height",l,o,a);continue;case"xlinkActuate":kc(e,c,"xlink:actuate",l,o,a);continue;case"xlinkArcrole":kc(e,c,"xlink:arcrole",l,o,a);continue;case"xlinkRole":kc(e,c,"xlink:role",l,o,a);continue;case"xlinkShow":kc(e,c,"xlink:show",l,o,a);continue;case"xlinkTitle":kc(e,c,"xlink:title",l,o,a);continue;case"xlinkType":kc(e,c,"xlink:type",l,o,a);continue;case"xmlBase":kc(e,c,"xml:base",l,o,a);continue;case"xmlLang":kc(e,c,"xml:lang",l,o,a);continue;case"xmlSpace":kc(e,c,"xml:space",l,o,a);continue;case"inert":""!==l||uN[c]||(uN[c]=!0),Dc(e,c,c,l,o,a);continue;default:if(!(2<c.length)||"o"!==c[0]&&"O"!==c[0]||"n"!==c[1]&&"N"!==c[1]){i=pt(c),r=!1,s.context===_N&&"svg"!==t&&"math"!==t?o.delete(i.toLowerCase()):(u=c.toLowerCase(),null!==(u=xp.hasOwnProperty(u)&&xp[u]||null)&&u!==c&&(r=!0,o.delete(u)),o.delete(i));e:if(u=e,d=i,i=l,Ne(d))if(u.hasAttribute(d))u=u.getAttribute(d),W(i),i=u===""+i?i:u;else{switch(typeof i){case"function":case"symbol":break e;case"boolean":if("data-"!==(u=d.toLowerCase().slice(0,5))&&"aria-"!==u)break e}i=void 0===i?void 0:null}else i=void 0;r||pc(c,i,l,a)}}return 0<o.size&&!0!==n.suppressHydrationWarning&&function(e,t,n){t.forEach(function(t){n[Nc(t)]="style"===t?wc(e):e.getAttribute(t)})}(e,o,a),0===Object.keys(a).length?null:a}function Pc(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function _c(e){return 9===e.nodeType?e:e.ownerDocument}function Oc(e){switch(e){case vp:return ON;case bp:return TN;default:return _N}}function Tc(e,t){if(e===_N)switch(t){case"svg":return ON;case"math":return TN;default:return _N}return e===ON&&"foreignObject"===t?_N:e}function Lc(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}function Ac(){var e=window.event;return e&&e!==FN?e.type:null}function Bc(){var e=window.event;return e&&e!==FN?e.timeStamp:-1.1}function Ic(e){setTimeout(function(){throw e})}function Fc(e,t,n){switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&e.focus();break;case"img":n.src?e.src=n.src:n.srcSet&&(e.srcset=n.srcSet)}}function Uc(){}function Rc(e,t,n,s){!function(e,t,n,s){switch(mc(t,s),t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,o=null,r=null,i=null,l=null,c=null,u=null;for(p in n){var d=n[p];if(n.hasOwnProperty(p)&&null!=d)switch(p){case"checked":case"value":break;case"defaultValue":l=d;default:s.hasOwnProperty(p)||vc(e,t,p,null,s,d)}}for(var m in s){var p=s[m];if(d=n[m],s.hasOwnProperty(m)&&(null!=p||null!=d))switch(m){case"type":o=p;break;case"name":a=p;break;case"checked":c=p;break;case"defaultChecked":u=p;break;case"value":r=p;break;case"defaultValue":i=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(t+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");break;default:p!==d&&vc(e,t,m,p,s,d)}}return t="checkbox"===n.type||"radio"===n.type?null!=n.checked:null!=n.value,s="checkbox"===s.type||"radio"===s.type?null!=s.checked:null!=s.value,t||!s||aN||(aN=!0),!t||s||sN||(sN=!0),void Te(e,r,i,l,c,u,o,a);case"select":for(o in p=r=i=m=null,n)if(l=n[o],n.hasOwnProperty(o)&&null!=l)switch(o){case"value":break;case"multiple":p=l;default:s.hasOwnProperty(o)||vc(e,t,o,null,s,l)}for(a in s)if(o=s[a],l=n[a],s.hasOwnProperty(a)&&(null!=o||null!=l))switch(a){case"value":m=o;break;case"defaultValue":i=o;break;case"multiple":r=o;default:o!==l&&vc(e,t,a,o,s,l)}return s=i,t=r,n=p,void(null!=m?Ie(e,!!t,m,!1):!!n!=!!t&&(null!=s?Ie(e,!!t,s,!0):Ie(e,!!t,t?[]:"",!1)));case"textarea":for(i in p=m=null,n)if(a=n[i],n.hasOwnProperty(i)&&null!=a&&!s.hasOwnProperty(i))switch(i){case"value":case"children":break;default:vc(e,t,i,null,s,a)}for(r in s)if(a=s[r],o=n[r],s.hasOwnProperty(r)&&(null!=a||null!=o))switch(r){case"value":m=a;break;case"defaultValue":p=a;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=a)throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");break;default:a!==o&&vc(e,t,r,a,s,o)}return void Re(e,m,p);case"option":for(var h in n)m=n[h],n.hasOwnProperty(h)&&null!=m&&!s.hasOwnProperty(h)&&("selected"===h?e.selected=!1:vc(e,t,h,null,s,m));for(l in s)m=s[l],p=n[l],!s.hasOwnProperty(l)||m===p||null==m&&null==p||("selected"===l?e.selected=m&&"function"!=typeof m&&"symbol"!=typeof m:vc(e,t,l,m,s,p));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var f in n)m=n[f],n.hasOwnProperty(f)&&null!=m&&!s.hasOwnProperty(f)&&vc(e,t,f,null,s,m);for(c in s)if(m=s[c],p=n[c],s.hasOwnProperty(c)&&m!==p&&(null!=m||null!=p))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(t+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");break;default:vc(e,t,c,m,s,p)}return;default:if(mt(t)){for(var g in n)m=n[g],n.hasOwnProperty(g)&&void 0!==m&&!s.hasOwnProperty(g)&&yc(e,t,g,void 0,s,m);for(u in s)m=s[u],p=n[u],!s.hasOwnProperty(u)||m===p||void 0===m&&void 0===p||yc(e,t,u,m,s,p);return}}for(var b in n)m=n[b],n.hasOwnProperty(b)&&null!=m&&!s.hasOwnProperty(b)&&vc(e,t,b,null,s,m);for(d in s)m=s[d],p=n[d],!s.hasOwnProperty(d)||m===p||null==m&&null==p||vc(e,t,d,m,s,p)}(e,t,n,s),e[_m]=s}function jc(e){ct(e,"")}function Xc(e,t,n){e.nodeValue=n}function zc(e){if(!e.__reactWarnedAboutChildrenConflict){var t=e[_m]||null;if(null!==t){var n=he(e);null!==n&&("string"==typeof t.children||"number"==typeof t.children||null!=t.dangerouslySetInnerHTML)&&(e.__reactWarnedAboutChildrenConflict=!0,X(n,function(){}))}}}function Gc(e){return"head"===e}function Hc(e,t){e.removeChild(t)}function Wc(e,t){(9===e.nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e).removeChild(t)}function qc(e,t){var n=t,s=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if((n=a.data)===xN||n===vN){if(0===s)return e.removeChild(a),void ad(t);s--}else if(n===yN||n===NN||n===wN||n===EN||n===bN)s++;else if(n===kN)fu(e.ownerDocument.documentElement);else if(n===SN){fu(n=e.ownerDocument.head);for(var o=n.firstChild;o;){var r=o.nextSibling,i=o.nodeName;o[Im]||"SCRIPT"===i||"STYLE"===i||"LINK"===i&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=r}}else n===DN&&fu(e.ownerDocument.body);n=a}while(n);ad(t)}function Kc(e,t){var n=e;e=0;do{var s=n.nextSibling;if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),s&&8===s.nodeType)if((n=s.data)===xN){if(0===e)break;e--}else n!==yN&&n!==NN&&n!==wN&&n!==EN||e++;n=s}while(n)}function $c(e){Kc(e,!0)}function Yc(e){"function"==typeof(e=e.style).setProperty?e.setProperty("display","none","important"):e.display="none"}function Jc(e){e.nodeValue=""}function Qc(e){Kc(e,!1)}function Zc(e,t){t=null!=(t=t[PN])&&t.hasOwnProperty("display")?t.display:null,e.style.display=null==t||"boolean"==typeof t?"":(""+t).trim()}function eu(e,t){e.nodeValue=t}function tu(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":tu(n),me(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function nu(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=ou(e.nextSibling)))return null}return e}function su(e){return e.data===NN||e.data===wN}function au(e){return e.data===EN||e.data===NN&&e.ownerDocument.readyState!==VN}function ou(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if((t=e.data)===yN||t===EN||t===NN||t===wN||t===bN||t===MN||t===CN)break;if(t===xN||t===vN)return null}}return e}function ru(e){if(1===e.nodeType){for(var t=e.nodeName.toLowerCase(),n={},s=e.attributes,a=0;a<s.length;a++){var o=s[a];n[Nc(o.name)]="style"===o.name.toLowerCase()?wc(e):o.value}return{type:t,props:n}}return 8===e.nodeType?e.data===bN?{type:"Activity",props:{}}:{type:"Suspense",props:{}}:e.nodeValue}function iu(e,t,n){return null===n||!0!==n[gN]?(e.nodeValue===t?e=null:(t=gc(t),e=gc(e.nodeValue)===t?null:e.nodeValue),e):null}function lu(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if(n===xN||n===vN){if(0===t)return ou(e.nextSibling);t--}else n!==yN&&n!==EN&&n!==NN&&n!==wN&&n!==bN||t++}e=e.nextSibling}return null}function cu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if(n===yN||n===EN||n===NN||n===wN||n===bN){if(0===t)return e;t--}else n!==xN&&n!==vN||t++}e=e.previousSibling}return null}function uu(e){ad(e)}function du(e){ad(e)}function mu(e){ad(e)}function pu(e,t,n,s,a){switch(a&&it(e,s.ancestorInfo),t=_c(n),e){case"html":if(!(e=t.documentElement))throw Error("React expected an <html> element (document.documentElement) to exist in the Document but one was not found. React never removes the documentElement for any Document it renders into so the cause is likely in some other script running on this page.");return e;case"head":if(!(e=t.head))throw Error("React expected a <head> element (document.head) to exist in the Document but one was not found. React never removes the head for any Document it renders into so the cause is likely in some other script running on this page.");return e;case"body":if(!(e=t.body))throw Error("React expected a <body> element (document.body) to exist in the Document but one was not found. React never removes the body for any Document it renders into so the cause is likely in some other script running on this page.");return e;default:throw Error("resolveSingletonInstance was called with an element type that is not supported. This is a bug in React.")}}function hu(e,t,n,s){if(!n[Om]&&he(n))var a=n.tagName.toLowerCase();for(a=n.attributes;a.length;)n.removeAttributeNode(a[0]);xc(n,e,t),n[Pm]=s,n[_m]=t}function fu(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);me(e)}function gu(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}function bu(e,t,n){var s=cw;if(s&&"string"==typeof t&&t){var a=_e(t);a='link[rel="'+e+'"][href="'+a+'"]',"string"==typeof n&&(a+='[crossorigin="'+n+'"]'),JN.has(a)||(JN.add(a),e={rel:e,crossOrigin:n,href:t},null===s.querySelector(a)&&(xc(t=s.createElement("link"),"link",e),be(t),s.head.appendChild(t)))}}function vu(e,t,n,s){var a=(a=Wd.current)?gu(a):null;if(!a)throw Error('"resourceRoot" was expected to exist. This is a bug in React.');switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(n=xu(n.href),(s=(t=ge(a).hoistableStyles).get(n))||(s={type:"style",instance:null,count:0,state:null},t.set(n,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=xu(n.href);var o=ge(a).hoistableStyles,r=o.get(e);if(!r&&(a=a.ownerDocument||a,r={type:"stylesheet",instance:null,count:0,state:{loading:HN,preload:null}},o.set(e,r),(o=a.querySelector(Nu(e)))&&!o._p&&(r.instance=o,r.state.loading=WN|$N),!YN.has(e))){var i={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy};YN.set(e,i),o||function(e,t,n,s){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?s.loading=WN:(t=e.createElement("link"),s.preload=t,t.addEventListener("load",function(){return s.loading|=WN}),t.addEventListener("error",function(){return s.loading|=qN}),xc(t,"link",n),be(t),e.head.appendChild(t))}(a,e,i,r.state)}if(t&&null===s)throw n="\n\n  - "+yu(t)+"\n  + "+yu(n),Error("Expected <link> not to update to be updated to a stylesheet with precedence. Check the `rel`, `href`, and `precedence` props of this component. Alternatively, check whether two different <link> components render in the same slot or share the same key."+n);return r}if(t&&null!==s)throw n="\n\n  - "+yu(t)+"\n  + "+yu(n),Error("Expected stylesheet with precedence to not be updated to a different kind of <link>. Check the `rel`, `href`, and `precedence` props of this component. Alternatively, check whether two different <link> components render in the same slot or share the same key."+n);return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(n=Eu(n),(s=(t=ge(a).hoistableScripts).get(n))||(s={type:"script",instance:null,count:0,state:null},t.set(n,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error('getResource encountered a type it did not expect: "'+e+'". this is a bug in React.')}}function yu(e){var t=0,n="<link";return"string"==typeof e.rel?(t++,n+=' rel="'+e.rel+'"'):tm.call(e,"rel")&&(t++,n+=' rel="'+(null===e.rel?"null":"invalid type "+typeof e.rel)+'"'),"string"==typeof e.href?(t++,n+=' href="'+e.href+'"'):tm.call(e,"href")&&(t++,n+=' href="'+(null===e.href?"null":"invalid type "+typeof e.href)+'"'),"string"==typeof e.precedence?(t++,n+=' precedence="'+e.precedence+'"'):tm.call(e,"precedence")&&(t++,n+=" precedence={"+(null===e.precedence?"null":"invalid type "+typeof e.precedence)+"}"),Object.getOwnPropertyNames(e).length>t&&(n+=" ..."),n+" />"}function xu(e){return'href="'+_e(e)+'"'}function Nu(e){return'link[rel="stylesheet"]['+e+"]"}function wu(e){return yd({},e,{"data-precedence":e.precedence,precedence:null})}function Eu(e){return'[src="'+_e(e)+'"]'}function ku(e){return"script[async]"+e}function Du(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+_e(n.href)+'"]');if(s)return t.instance=s,be(s),s;var a=yd({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return be(s=(e.ownerDocument||e).createElement("style")),xc(s,"style",a),Su(s,n.precedence,e),t.instance=s;case"stylesheet":a=xu(n.href);var o=e.querySelector(Nu(a));if(o)return t.state.loading|=$N,t.instance=o,be(o),o;s=wu(n),(a=YN.get(a))&&Mu(s,a),be(o=(e.ownerDocument||e).createElement("link"));var r=o;return r._p=new Promise(function(e,t){r.onload=e,r.onerror=t}),xc(o,"link",s),t.state.loading|=$N,Su(o,n.precedence,e),t.instance=o;case"script":return o=Eu(n.src),(a=e.querySelector(ku(o)))?(t.instance=a,be(a),a):(s=n,(a=YN.get(o))&&Cu(s=yd({},n),a),be(a=(e=e.ownerDocument||e).createElement("script")),xc(a,"link",s),e.head.appendChild(a),t.instance=a);case"void":return null;default:throw Error('acquireResource encountered a resource type it did not expect: "'+t.type+'". this is a bug in React.')}else"stylesheet"===t.type&&(t.state.loading&$N)===HN&&(s=t.instance,t.state.loading|=$N,Su(s,n.precedence,e));return t.instance}function Su(e,t,n){for(var s=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=s.length?s[s.length-1]:null,o=a,r=0;r<s.length;r++){var i=s[r];if(i.dataset.precedence===t)o=i;else if(o!==a)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Mu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Cu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}function Vu(e,t,n){if(null===uw){var s=new Map,a=uw=new Map;a.set(n,s)}else(s=(a=uw).get(n))||(s=new Map,a.set(n,s));if(s.has(e))return s;for(s.set(e,null),n=n.getElementsByTagName(e),a=0;a<n.length;a++){var o=n[a];if(!(o[Im]||o[Pm]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&o.namespaceURI!==vp){var r=o.getAttribute(t)||"";r=e+r;var i=s.get(r);i?i.push(o):s.set(r,[o])}}return s}function Pu(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function _u(e){return"stylesheet"!==e.type||(e.state.loading&KN)!==HN}function Ou(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)Tu(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}function Tu(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,gw=new Map,t.forEach(Lu,e),gw=null,Ou.call(e))}function Lu(e,t){if(!(t.state.loading&$N)){var n=gw.get(e);if(n)var s=n.get(fw);else{n=new Map,gw.set(e,n);for(var a=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<a.length;o++){var r=a[o];"LINK"!==r.nodeName&&"not all"===r.getAttribute("media")||(n.set(r.dataset.precedence,r),s=r)}s&&n.set(fw,s)}r=(a=t.instance).getAttribute("data-precedence"),(o=n.get(r)||s)===s&&n.set(fw,a),n.set(r,a),this.count++,s=Ou.bind(this),a.addEventListener("load",s),a.addEventListener("error",s),o?o.parentNode.insertBefore(a,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(a,e.firstChild),t.state.loading|=$N}}function Au(e,t,n,s,a,o,r,i,l){for(this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=jN,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=te(0),this.hiddenUpdates=te(null),this.identifierPrefix=s,this.onUncaughtError=a,this.onCaughtError=o,this.onRecoverableError=r,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map,this.passiveEffectDuration=this.effectDuration=-0,this.memoizedUpdaters=new Set,e=this.pendingUpdatersLaneMap=[],t=0;31>t;t++)e.push(new Set);this._debugRootType=n?"hydrateRoot()":"createRoot()"}function Bu(e,t,n,s,a,o,r,i,l,c,u,d){return e=new Au(e,t,n,r,l,c,u,d,i),t=Ef,!0===o&&(t|=Df|Sf),o=m(3,null,null,t|=kf),e.current=o,o.stateNode=e,ds(t=us()),e.pooledCache=t,ds(t),o.memoizedState={element:s,isDehydrated:n,cache:t},Zs(o),e}function Iu(e){return e?e=yf:yf}function Fu(e,t,n,s,a,o){if(gm&&"function"==typeof gm.onScheduleFiberRoot)try{gm.onScheduleFiberRoot(fm,s,n)}catch(r){bm||(bm=!0)}a=Iu(a),null===s.context?s.context=a:s.pendingContext=a,em&&null!==Zd&&!kw&&(kw=!0),(s=ta(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(s.callback=o),null!==(n=na(e,s,t))&&(ps(t,"root.render()",null),Zi(n,e,t),sa(n,e,t))}function Uu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ru(e,t){Uu(e,t),(e=e.alternate)&&Uu(e,t)}function ju(e){if(13===e.tag||31===e.tag){var t=fn(e,67108864);null!==t&&Zi(t,e,67108864),Ru(e,67108864)}}function Xu(e){if(13===e.tag||31===e.tag){var t=Ji(e),n=fn(e,t=re(t));null!==n&&Zi(n,e,t),Ru(e,t)}}function zu(){return Zd}function Gu(e,t,n,s){var a=Fd.T;Fd.T=null;var o=Ud.p;try{Ud.p=Dm,Wu(e,t,n,s)}finally{Ud.p=o,Fd.T=a}}function Hu(e,t,n,s){var a=Fd.T;Fd.T=null;var o=Ud.p;try{Ud.p=Sm,Wu(e,t,n,s)}finally{Ud.p=o,Fd.T=a}}function Wu(e,t,n,s){if(Sw){var a=qu(s);if(null===a)ic(e,t,s,Mw,n),Yu(e,s);else if(function(e,t,n,s,a){switch(t){case"focusin":return Vw=Ju(Vw,e,t,n,s,a),!0;case"dragenter":return Pw=Ju(Pw,e,t,n,s,a),!0;case"mouseover":return _w=Ju(_w,e,t,n,s,a),!0;case"pointerover":var o=a.pointerId;return Ow.set(o,Ju(Ow.get(o)||null,e,t,n,s,a)),!0;case"gotpointercapture":return o=a.pointerId,Tw.set(o,Ju(Tw.get(o)||null,e,t,n,s,a)),!0}return!1}(a,e,t,n,s))s.stopPropagation();else if(Yu(e,s),4&t&&-1<Aw.indexOf(e)){for(;null!==a;){var o=he(a);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var r=Y(o.pendingLanes);if(0!==r){var i=o;for(i.pendingLanes|=2,i.entangledLanes|=2;r;){var l=1<<31-ym(r);i.entanglements[1]|=l,r&=~l}zl(o),(_y&(wy|Ey))===Ny&&(cx=rm()+ux,Gl(0))}}break;case 31:case 13:null!==(i=fn(o,2))&&Zi(i,o,2),al(),Ru(o,2)}if(null===(o=qu(s))&&ic(e,t,s,Mw,n),o===a)break;a=o}null!==a&&s.stopPropagation()}else ic(e,t,s,null,n)}}function qu(e){return Ku(e=vt(e))}function Ku(e){if(Mw=null,null!==(e=pe(e))){var t=b(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=v(t)))return e;e=null}else if(31===n){if(null!==(e=y(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Mw=e,null}function $u(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return Dm;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return Sm;case"message":switch(im()){case lm:return Dm;case cm:return Sm;case um:case dm:return Mm;case mm:return Cm;default:return Mm}default:return Mm}}function Yu(e,t){switch(e){case"focusin":case"focusout":Vw=null;break;case"dragenter":case"dragleave":Pw=null;break;case"mouseover":case"mouseout":_w=null;break;case"pointerover":case"pointerout":Ow.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tw.delete(t.pointerId)}}function Ju(e,t,n,s,a,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[a]},null!==t&&(null!==(t=he(t))&&ju(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Qu(e){var t=pe(e.target);if(null!==t){var n=b(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=v(n)))return e.blockedOn=t,void de(e.priority,function(){Xu(n)})}else if(31===t){if(null!==(t=y(n)))return e.blockedOn=t,void de(e.priority,function(){Xu(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Zu(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=qu(e.nativeEvent);if(null!==n)return null!==(t=he(n))&&ju(t),e.blockedOn=n,!1;var s=new(n=e.nativeEvent).constructor(n.type,n);Op=s,n.target.dispatchEvent(s),Op=null,t.shift()}return!0}function ed(e,t,n){Zu(e)&&n.delete(t)}function td(){Cw=!1,null!==Vw&&Zu(Vw)&&(Vw=null),null!==Pw&&Zu(Pw)&&(Pw=null),null!==_w&&Zu(_w)&&(_w=null),Ow.forEach(ed),Tw.forEach(ed)}function nd(e,t){e.blockedOn===t&&(e.blockedOn=null,Cw||(Cw=!0,gd.unstable_scheduleCallback(gd.unstable_NormalPriority,td)))}function sd(e){Bw!==e&&(Bw=e,gd.unstable_scheduleCallback(gd.unstable_NormalPriority,function(){Bw===e&&(Bw=null);for(var t=0;t<e.length;t+=3){var n=e[t],s=e[t+1],a=e[t+2];if("function"!=typeof s){if(null===Ku(s||n))continue;break}var o=he(n);null!==o&&(e.splice(t,3),t-=3,n={pending:!0,data:a,method:n.method,action:s},Object.freeze(n),Bo(o,n,s,a))}}))}function ad(e){function t(t){return nd(t,e)}null!==Vw&&nd(Vw,e),null!==Pw&&nd(Pw,e),null!==_w&&nd(_w,e),Ow.forEach(t),Tw.forEach(t);for(var n=0;n<Lw.length;n++){var s=Lw[n];s.blockedOn===e&&(s.blockedOn=null)}for(;0<Lw.length&&null===(n=Lw[0]).blockedOn;)Qu(n),null===n.blockedOn&&Lw.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(s=0;s<n.length;s+=3){var a=n[s],o=n[s+1],r=a[_m]||null;if("function"==typeof o)r||sd(n);else if(r){var i=null;if(o&&o.hasAttribute("formAction")){if(a=o,r=o[_m]||null)i=r.formAction;else if(null!==Ku(a))continue}else i=r.action;"function"==typeof i?n[s+1]=i:(n.splice(s,3),s-=3),sd(n)}}}function od(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return a=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==a&&(a(),a=null),s||setTimeout(n,20)}function n(){if(!s&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var s=!1,a=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){s=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==a&&(a(),a=null)}}}function rd(e){this._internalRoot=e}function id(e){this._internalRoot=e}function ld(e){e[Om]&&e._reactRootContainer}"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var cd,ud,dd,md,pd,hd,fd,gd=ts(),bd=e(),vd=t(),yd=Object.assign,xd=Symbol.for("react.element"),Nd=Symbol.for("react.transitional.element"),wd=Symbol.for("react.portal"),Ed=Symbol.for("react.fragment"),kd=Symbol.for("react.strict_mode"),Dd=Symbol.for("react.profiler"),Sd=Symbol.for("react.consumer"),Md=Symbol.for("react.context"),Cd=Symbol.for("react.forward_ref"),Vd=Symbol.for("react.suspense"),Pd=Symbol.for("react.suspense_list"),_d=Symbol.for("react.memo"),Od=Symbol.for("react.lazy"),Td=Symbol.for("react.activity"),Ld=Symbol.for("react.memo_cache_sentinel"),Ad=Symbol.iterator,Bd=Symbol.for("react.client.reference"),Id=Array.isArray,Fd=bd.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ud=vd.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Rd=Object.freeze({pending:!1,data:null,method:null,action:null}),jd=[],Xd=[],zd=-1,Gd=S(null),Hd=S(null),Wd=S(null),qd=S(null),Kd=0;L.__reactDisabledLog=!0;var $d,Yd,Jd=!1,Qd=new("function"==typeof WeakMap?WeakMap:Map),Zd=null,em=!1,tm=Object.prototype.hasOwnProperty,nm=gd.unstable_scheduleCallback,sm=gd.unstable_cancelCallback,am=gd.unstable_shouldYield,om=gd.unstable_requestPaint,rm=gd.unstable_now,im=gd.unstable_getCurrentPriorityLevel,lm=gd.unstable_ImmediatePriority,cm=gd.unstable_UserBlockingPriority,um=gd.unstable_NormalPriority,dm=gd.unstable_LowPriority,mm=gd.unstable_IdlePriority,pm=gd.log,hm=gd.unstable_setDisableYieldValue,fm=null,gm=null,bm=!1,vm="undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__,ym=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xm(e)/Nm|0)|0},xm=Math.log,Nm=Math.LN2,wm=256,Em=262144,km=4194304,Dm=2,Sm=8,Mm=32,Cm=268435456,Vm=Math.random().toString(36).slice(2),Pm="__reactFiber$"+Vm,_m="__reactProps$"+Vm,Om="__reactContainer$"+Vm,Tm="__reactEvents$"+Vm,Lm="__reactListeners$"+Vm,Am="__reactHandles$"+Vm,Bm="__reactResources$"+Vm,Im="__reactMarker$"+Vm,Fm=new Set,Um={},Rm={},jm={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0},Xm=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),zm={},Gm={},Hm=/[\n"\\]/g,Wm=!1,qm=!1,Km=!1,$m=!1,Ym=!1,Jm=!1,Qm=["value","defaultValue"],Zm=!1,ep=/["'&<>\n\t]|^\s|\s$/,tp="address applet area article aside base basefont bgsound blockquote body br button caption center col colgroup dd details dir div dl dt embed fieldset figcaption figure footer form frame frameset h1 h2 h3 h4 h5 h6 head header hgroup hr html iframe img input isindex li link listing main marquee menu menuitem meta nav noembed noframes noscript object ol p param plaintext pre script section select source style summary table tbody td template textarea tfoot th thead title tr track ul wbr xmp".split(" "),np="applet caption html table td th marquee object template foreignObject desc title".split(" "),sp=np.concat(["button"]),ap="dd dt li option optgroup p rp rt".split(" "),op={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null,containerTagInScope:null,implicitRootScope:!1},rp={},ip={animation:"animationDelay animationDirection animationDuration animationFillMode animationIterationCount animationName animationPlayState animationTimingFunction".split(" "),background:"backgroundAttachment backgroundClip backgroundColor backgroundImage backgroundOrigin backgroundPositionX backgroundPositionY backgroundRepeat backgroundSize".split(" "),backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:"borderBottomColor borderBottomStyle borderBottomWidth borderImageOutset borderImageRepeat borderImageSlice borderImageSource borderImageWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderTopColor borderTopStyle borderTopWidth".split(" "),borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:"fontFamily fontFeatureSettings fontKerning fontLanguageOverride fontSize fontSizeAdjust fontStretch fontStyle fontVariant fontVariantAlternates fontVariantCaps fontVariantEastAsian fontVariantLigatures fontVariantNumeric fontVariantPosition fontWeight lineHeight".split(" "),fontVariant:"fontVariantAlternates fontVariantCaps fontVariantEastAsian fontVariantLigatures fontVariantNumeric fontVariantPosition".split(" "),gap:["columnGap","rowGap"],grid:"gridAutoColumns gridAutoFlow gridAutoRows gridTemplateAreas gridTemplateColumns gridTemplateRows".split(" "),gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:"maskClip maskComposite maskImage maskMode maskOrigin maskPositionX maskPositionY maskRepeat maskSize".split(" "),maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},lp=/([A-Z])/g,cp=/^ms-/,up=/^(?:webkit|moz|o)[A-Z]/,dp=/;\s*$/,mp={},pp={},hp=!1,fp=!1,gp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" ")),bp="http://www.w3.org/1998/Math/MathML",vp="http://www.w3.org/2000/svg",yp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xp={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",fetchpriority:"fetchPriority",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",imagesizes:"imageSizes",imagesrcset:"imageSrcSet",inert:"inert",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",popover:"popover",popovertarget:"popoverTarget",popovertargetaction:"popoverTargetAction",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",transformorigin:"transformOrigin","transform-origin":"transformOrigin",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},Np={"aria-current":0,"aria-description":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0,"aria-braillelabel":0,"aria-brailleroledescription":0,"aria-colindextext":0,"aria-rowindextext":0},wp={},Ep=RegExp("^(aria)-[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),kp=RegExp("^(aria)[A-Z][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Dp=!1,Sp={},Mp=/^on./,Cp=/^on[^A-Z]/,Vp=RegExp("^(aria)-[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Pp=RegExp("^(aria)[A-Z][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_p=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i,Op=null,Tp=null,Lp=null,Ap=!1,Bp=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Ip=!1;if(Bp)try{var Fp={};Object.defineProperty(Fp,"passive",{get:function(){Ip=!0}}),window.addEventListener("test",Fp,Fp),window.removeEventListener("test",Fp,Fp)}catch(Fw){Ip=!1}var Up,Rp,jp,Xp=null,zp=null,Gp=null,Hp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wp=St(Hp),qp=yd({},Hp,{view:0,detail:0}),Kp=St(qp),$p=yd({},qp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ct,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==jp&&(jp&&"mousemove"===e.type?(Up=e.screenX-jp.screenX,Rp=e.screenY-jp.screenY):Rp=Up=0,jp=e),Up)},movementY:function(e){return"movementY"in e?e.movementY:Rp}}),Yp=St($p),Jp=St(yd({},$p,{dataTransfer:0})),Qp=St(yd({},qp,{relatedTarget:0})),Zp=St(yd({},Hp,{animationName:0,elapsedTime:0,pseudoElement:0})),eh=St(yd({},Hp,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),th=St(yd({},Hp,{data:0})),nh=th,sh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ah={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},rh=St(yd({},qp,{key:function(e){if(e.key){var t=sh[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Et(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?ah[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ct,charCode:function(e){return"keypress"===e.type?Et(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Et(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),ih=St(yd({},$p,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),lh=St(yd({},qp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ct})),ch=St(yd({},Hp,{propertyName:0,elapsedTime:0,pseudoElement:0})),uh=St(yd({},$p,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),dh=St(yd({},Hp,{newState:0,oldState:0})),mh=[9,13,27,32],ph=229,hh=Bp&&"CompositionEvent"in window,fh=null;Bp&&"documentMode"in document&&(fh=document.documentMode);var gh=Bp&&"TextEvent"in window&&!fh,bh=Bp&&(!hh||fh&&8<fh&&11>=fh),vh=32,yh=String.fromCharCode(vh),xh=!1,Nh=!1,wh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Eh=null,kh=null,Dh=!1;Bp&&(Dh=function(e){if(!Bp)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}("input")&&(!document.documentMode||9<document.documentMode));var Sh="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Mh=Bp&&"documentMode"in document&&11>=document.documentMode,Ch=null,Vh=null,Ph=null,_h=!1,Oh={animationend:$t("Animation","AnimationEnd"),animationiteration:$t("Animation","AnimationIteration"),animationstart:$t("Animation","AnimationStart"),transitionrun:$t("Transition","TransitionRun"),transitionstart:$t("Transition","TransitionStart"),transitioncancel:$t("Transition","TransitionCancel"),transitionend:$t("Transition","TransitionEnd")},Th={},Lh={};Bp&&(Lh=document.createElement("div").style,"AnimationEvent"in window||(delete Oh.animationend.animation,delete Oh.animationiteration.animation,delete Oh.animationstart.animation),"TransitionEvent"in window||delete Oh.transitionend.transition);var Ah=Yt("animationend"),Bh=Yt("animationiteration"),Ih=Yt("animationstart"),Fh=Yt("transitionrun"),Uh=Yt("transitionstart"),Rh=Yt("transitioncancel"),jh=Yt("transitionend"),Xh=new Map,zh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");zh.push("scrollEnd");var Gh=0;if("object"==typeof performance&&"function"==typeof performance.now)var Hh=performance,Wh=function(){return Hh.now()};else{var qh=Date;Wh=function(){return qh.now()}}var Kh="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},$h="This object has been omitted by React in the console log to avoid sending too much data from the server. Try logging smaller or more specific objects.",Yh=0,Jh=1,Qh=2,Zh=3,ef="",tf="+",nf="",sf="undefined"!=typeof console&&"function"==typeof console.timeStamp&&"undefined"!=typeof performance&&"function"==typeof performance.measure,af="Components ",of="Scheduler ",rf="Blocking",lf=!1,cf={color:"primary",properties:null,tooltipText:"",track:af},uf={start:-0,end:-0,detail:{devtools:cf}},df=["Changed Props",""],mf="This component received deeply equal props. It might benefit from useMemo or the React Compiler in its owner.",pf=["Changed Props",mf],hf=1,ff=2,gf=[],bf=0,vf=0,yf={};Object.freeze(yf);var xf=null,Nf=null,wf=0,Ef=1,kf=2,Df=8,Sf=16,Mf=32,Cf=!1;try{Object.preventExtensions({})}catch(Uw){Cf=!0}var Vf=new WeakMap,Pf=[],_f=0,Of=null,Tf=0,Lf=[],Af=0,Bf=null,If=1,Ff="",Uf=null,Rf=null,jf=!1,Xf=!1,zf=null,Gf=null,Hf=!1,Wf=Error("Hydration Mismatch Exception: This is not a real error, and should not leak into userspace. If you're seeing this, it's likely a bug in React."),qf=S(null),Kf=S(null),$f={},Yf=null,Jf=null,Qf="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Zf=gd.unstable_scheduleCallback,eg=gd.unstable_NormalPriority,tg={$$typeof:Md,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0,_currentRenderer:null,_currentRenderer2:null},ng=gd.unstable_now,sg=console.createTask?console.createTask:function(){return null},ag=1,og=2,rg=-0,ig=-0,lg=-0,cg=null,ug=-1.1,dg=-0,mg=-0,pg=-1.1,hg=-1.1,fg=null,gg=!1,bg=-0,vg=-1.1,yg=null,xg=0,Ng=null,wg=null,Eg=-1.1,kg=null,Dg=-1.1,Sg=-1.1,Mg=-0,Cg=-1.1,Vg=-1.1,Pg=0,_g=null,Og=null,Tg=null,Lg=-1.1,Ag=null,Bg=-1.1,Ig=-1.1,Fg=0,Ug=0,Rg=-1.1,jg=!1,Xg=!1,zg=null,Gg=0,Hg=0,Wg=null,qg=Fd.S;Fd.S=function(e,t){if(ix=rm(),"object"==typeof t&&null!==t&&"function"==typeof t.then){if(0>Cg&&0>Vg){Cg=ng();var n=Bc(),s=Ac();n===Bg&&s===Ag||(Bg=-1.1),Lg=n,Ag=s}!function(e,t){if(null===zg){var n=zg=[];Gg=0,Hg=Ql(),Wg={status:"pending",value:void 0,then:function(e){n.push(e)}}}Gg++,t.then(_s,_s)}(0,t)}null!==qg&&qg(e,t)};var Kg=S(null),$g={recordUnsafeLifecycleWarnings:function(){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}},Yg=[],Jg=[],Qg=[],Zg=[],eb=[],tb=[],nb=new Set;$g.recordUnsafeLifecycleWarnings=function(e,t){nb.has(e.type)||("function"==typeof t.componentWillMount&&!0!==t.componentWillMount.__suppressDeprecationWarning&&Yg.push(e),e.mode&Df&&"function"==typeof t.UNSAFE_componentWillMount&&Jg.push(e),"function"==typeof t.componentWillReceiveProps&&!0!==t.componentWillReceiveProps.__suppressDeprecationWarning&&Qg.push(e),e.mode&Df&&"function"==typeof t.UNSAFE_componentWillReceiveProps&&Zg.push(e),"function"==typeof t.componentWillUpdate&&!0!==t.componentWillUpdate.__suppressDeprecationWarning&&eb.push(e),e.mode&Df&&"function"==typeof t.UNSAFE_componentWillUpdate&&tb.push(e))},$g.flushPendingUnsafeLifecycleWarnings=function(){var e=new Set;0<Yg.length&&(Yg.forEach(function(t){e.add(D(t)||"Component"),nb.add(t.type)}),Yg=[]);var t=new Set;0<Jg.length&&(Jg.forEach(function(e){t.add(D(e)||"Component"),nb.add(e.type)}),Jg=[]);var n=new Set;0<Qg.length&&(Qg.forEach(function(e){n.add(D(e)||"Component"),nb.add(e.type)}),Qg=[]);var s=new Set;0<Zg.length&&(Zg.forEach(function(e){s.add(D(e)||"Component"),nb.add(e.type)}),Zg=[]);var a=new Set;0<eb.length&&(eb.forEach(function(e){a.add(D(e)||"Component"),nb.add(e.type)}),eb=[]);var o=new Set;if(0<tb.length&&(tb.forEach(function(e){o.add(D(e)||"Component"),nb.add(e.type)}),tb=[]),0<t.size)d(t);0<s.size&&d(s),0<o.size&&d(o),0<e.size&&d(e),0<n.size&&d(n),0<a.size&&d(a)};var sb=new Map,ab=new Set;$g.recordLegacyContextWarning=function(e,t){for(var n=null,s=e;null!==s;)s.mode&Df&&(n=s),s=s.return;null===n||!ab.has(e.type)&&(s=sb.get(n),null!=e.type.contextTypes||null!=e.type.childContextTypes||null!==t&&"function"==typeof t.getChildContext)&&(void 0===s&&(s=[],sb.set(n,s)),s.push(e))},$g.flushLegacyContextWarning=function(){sb.forEach(function(e){if(0!==e.length){var t=e[0],n=new Set;e.forEach(function(e){n.add(D(e)||"Component"),ab.add(e.type)});d(n);X(t,function(){})}})},$g.discardPendingWarnings=function(){Yg=[],Jg=[],Qg=[],Zg=[],eb=[],tb=[],sb=new Map};var ob,rb={react_stack_bottom_frame:function(e,t,n){var s=em;em=!0;try{return e(t,n)}finally{em=s}}},ib=rb.react_stack_bottom_frame.bind(rb),lb={react_stack_bottom_frame:function(e){var t=em;em=!0;try{return e.render()}finally{em=t}}},cb=lb.react_stack_bottom_frame.bind(lb),ub={react_stack_bottom_frame:function(e,t){try{t.componentDidMount()}catch(n){Ol(e,e.return,n)}}},db=ub.react_stack_bottom_frame.bind(ub),mb={react_stack_bottom_frame:function(e,t,n,s,a){try{t.componentDidUpdate(n,s,a)}catch(o){Ol(e,e.return,o)}}},pb=mb.react_stack_bottom_frame.bind(mb),hb={react_stack_bottom_frame:function(e,t){var n=t.stack;e.componentDidCatch(t.value,{componentStack:null!==n?n:""})}},fb=hb.react_stack_bottom_frame.bind(hb),gb={react_stack_bottom_frame:function(e,t,n){try{n.componentWillUnmount()}catch(s){Ol(e,t,s)}}},bb=gb.react_stack_bottom_frame.bind(gb),vb={react_stack_bottom_frame:function(e){var t=e.create;return e=e.inst,t=t(),e.destroy=t}},yb=vb.react_stack_bottom_frame.bind(vb),xb={react_stack_bottom_frame:function(e,t,n){try{n()}catch(s){Ol(e,t,s)}}},Nb=xb.react_stack_bottom_frame.bind(xb),wb={react_stack_bottom_frame:function(e){return(0,e._init)(e._payload)}},Eb=wb.react_stack_bottom_frame.bind(wb),kb=Error("Suspense Exception: This is not a real error! It's an implementation detail of `use` to interrupt the current render. You must either rethrow it immediately, or move the `use` call outside of the `try/catch` block. Capturing without rethrowing will lead to unexpected behavior.\n\nTo handle async errors, wrap your component in an error boundary, or call the promise's `.catch` method and pass the result to `use`."),Db=Error("Suspense Exception: This is not a real error, and should not leak into userspace. If you're seeing this, it's likely a bug in React."),Sb=Error("Suspense Exception: This is not a real error! It's an implementation detail of `useActionState` to interrupt the current render. You must either rethrow it immediately, or move the `useActionState` call outside of the `try/catch` block. Capturing without rethrowing will lead to unexpected behavior.\n\nTo handle async errors, wrap your component in an error boundary."),Mb={then:function(){}},Cb=null,Vb=!1,Pb=null,_b=0,Ob=null,Tb=(ob=!1,{}),Lb={},Ab={};u=function(e,t,n){if(null!==n&&"object"==typeof n&&n._store&&(!n._store.validated&&null==n.key||2===n._store.validated)){if("object"!=typeof n._store)throw Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");n._store.validated=1;var s=D(e),a=s||"null";if(!Tb[a]){Tb[a]=!0,n=n._owner;var o="";(e=e._debugOwner)&&"number"==typeof e.tag&&(a=D(e))&&(o="\n\nCheck the render method of `"+a+"`."),o||s&&(o="\n\nCheck the top-level render call using <"+s+">.");null!=n&&e!==n&&(s=null,"number"==typeof n.tag?s=D(n):"string"==typeof n.name&&(s=n.name),s&&" It was passed a child from "+s+"."),X(t,function(){})}}};var Bb,Ib=Js(!0),Fb=Js(!1),Ub=0,Rb=1,jb=2,Xb=3,zb=!1,Gb=!1,Hb=null,Wb=!1,qb=S(null),Kb=S(0),$b=S(null),Yb=null,Jb=1,Qb=2,Zb=S(0),ev=0,tv=1,nv=2,sv=4,av=8,ov=new Set,rv=new Set,iv=new Set,lv=new Set,cv=0,uv=null,dv=null,mv=null,pv=!1,hv=!1,fv=!1,gv=0,bv=0,vv=null,yv=0,xv=25,Nv=null,wv=null,Ev=-1,kv=!1,Dv={readContext:is,use:Aa,useCallback:Ea,useContext:Ea,useEffect:Ea,useImperativeHandle:Ea,useLayoutEffect:Ea,useInsertionEffect:Ea,useMemo:Ea,useReducer:Ea,useRef:Ea,useState:Ea,useDebugValue:Ea,useDeferredValue:Ea,useTransition:Ea,useSyncExternalStore:Ea,useId:Ea,useHostTransitionStatus:Ea,useFormState:Ea,useActionState:Ea,useOptimistic:Ea,useMemoCache:Ea,useCacheRefresh:Ea};Dv.useEffectEvent=Ea;var Sv=null,Mv=null,Cv=null,Vv=null,Pv=null,_v=null,Ov=null;Sv={readContext:function(e){return is(e)},use:Aa,useCallback:function(e,t){return Nv="useCallback",ya(),Na(t),Do(e,t)},useContext:function(e){return Nv="useContext",ya(),is(e)},useEffect:function(e,t){return Nv="useEffect",ya(),Na(t),vo(e,t)},useImperativeHandle:function(e,t,n){return Nv="useImperativeHandle",ya(),Na(n),Eo(e,t,n)},useInsertionEffect:function(e,t){Nv="useInsertionEffect",ya(),Na(t),go(4,nv,e,t)},useLayoutEffect:function(e,t){return Nv="useLayoutEffect",ya(),Na(t),No(e,t)},useMemo:function(e,t){Nv="useMemo",ya(),Na(t);var n=Fd.H;Fd.H=Pv;try{return Mo(e,t)}finally{Fd.H=n}},useReducer:function(e,t,n){Nv="useReducer",ya();var s=Fd.H;Fd.H=Pv;try{return Fa(e,t,n)}finally{Fd.H=s}},useRef:function(e){return Nv="useRef",ya(),fo(e)},useState:function(e){Nv="useState",ya();var t=Fd.H;Fd.H=Pv;try{return Ya(e)}finally{Fd.H=t}},useDebugValue:function(){Nv="useDebugValue",ya()},useDeferredValue:function(e,t){return Nv="useDeferredValue",ya(),Vo(e,t)},useTransition:function(){return Nv="useTransition",ya(),Uo()},useSyncExternalStore:function(e,t,n){return Nv="useSyncExternalStore",ya(),Xa(e,t,n)},useId:function(){return Nv="useId",ya(),zo()},useFormState:function(e,t){return Nv="useFormState",ya(),wa(),lo(e,t)},useActionState:function(e,t){return Nv="useActionState",ya(),lo(e,t)},useOptimistic:function(e){return Nv="useOptimistic",ya(),Ja(e)},useHostTransitionStatus:Xo,useMemoCache:Ba,useCacheRefresh:function(){return Nv="useCacheRefresh",ya(),Go()},useEffectEvent:function(e){return Nv="useEffectEvent",ya(),yo(e)}},Mv={readContext:function(e){return is(e)},use:Aa,useCallback:function(e,t){return Nv="useCallback",xa(),Do(e,t)},useContext:function(e){return Nv="useContext",xa(),is(e)},useEffect:function(e,t){return Nv="useEffect",xa(),vo(e,t)},useImperativeHandle:function(e,t,n){return Nv="useImperativeHandle",xa(),Eo(e,t,n)},useInsertionEffect:function(e,t){Nv="useInsertionEffect",xa(),go(4,nv,e,t)},useLayoutEffect:function(e,t){return Nv="useLayoutEffect",xa(),No(e,t)},useMemo:function(e,t){Nv="useMemo",xa();var n=Fd.H;Fd.H=Pv;try{return Mo(e,t)}finally{Fd.H=n}},useReducer:function(e,t,n){Nv="useReducer",xa();var s=Fd.H;Fd.H=Pv;try{return Fa(e,t,n)}finally{Fd.H=s}},useRef:function(e){return Nv="useRef",xa(),fo(e)},useState:function(e){Nv="useState",xa();var t=Fd.H;Fd.H=Pv;try{return Ya(e)}finally{Fd.H=t}},useDebugValue:function(){Nv="useDebugValue",xa()},useDeferredValue:function(e,t){return Nv="useDeferredValue",xa(),Vo(e,t)},useTransition:function(){return Nv="useTransition",xa(),Uo()},useSyncExternalStore:function(e,t,n){return Nv="useSyncExternalStore",xa(),Xa(e,t,n)},useId:function(){return Nv="useId",xa(),zo()},useActionState:function(e,t){return Nv="useActionState",xa(),lo(e,t)},useFormState:function(e,t){return Nv="useFormState",xa(),wa(),lo(e,t)},useOptimistic:function(e){return Nv="useOptimistic",xa(),Ja(e)},useHostTransitionStatus:Xo,useMemoCache:Ba,useCacheRefresh:function(){return Nv="useCacheRefresh",xa(),Go()},useEffectEvent:function(e){return Nv="useEffectEvent",xa(),yo(e)}},Cv={readContext:function(e){return is(e)},use:Aa,useCallback:function(e,t){return Nv="useCallback",xa(),So(e,t)},useContext:function(e){return Nv="useContext",xa(),is(e)},useEffect:function(e,t){Nv="useEffect",xa(),bo(2048,av,e,t)},useImperativeHandle:function(e,t,n){return Nv="useImperativeHandle",xa(),ko(e,t,n)},useInsertionEffect:function(e,t){return Nv="useInsertionEffect",xa(),bo(4,nv,e,t)},useLayoutEffect:function(e,t){return Nv="useLayoutEffect",xa(),bo(4,sv,e,t)},useMemo:function(e,t){Nv="useMemo",xa();var n=Fd.H;Fd.H=_v;try{return Co(e,t)}finally{Fd.H=n}},useReducer:function(e,t,n){Nv="useReducer",xa();var s=Fd.H;Fd.H=_v;try{return Ua(e)}finally{Fd.H=s}},useRef:function(){return Nv="useRef",xa(),Ta().memoizedState},useState:function(){Nv="useState",xa();var e=Fd.H;Fd.H=_v;try{return Ua(Ia)}finally{Fd.H=e}},useDebugValue:function(){Nv="useDebugValue",xa()},useDeferredValue:function(e,t){return Nv="useDeferredValue",xa(),Po(e,t)},useTransition:function(){return Nv="useTransition",xa(),Ro()},useSyncExternalStore:function(e,t,n){return Nv="useSyncExternalStore",xa(),za(e,t,n)},useId:function(){return Nv="useId",xa(),Ta().memoizedState},useFormState:function(e){return Nv="useFormState",xa(),wa(),co(e)},useActionState:function(e){return Nv="useActionState",xa(),co(e)},useOptimistic:function(e,t){return Nv="useOptimistic",xa(),Qa(e,t)},useHostTransitionStatus:Xo,useMemoCache:Ba,useCacheRefresh:function(){return Nv="useCacheRefresh",xa(),Ta().memoizedState},useEffectEvent:function(e){return Nv="useEffectEvent",xa(),xo(e)}},Vv={readContext:function(e){return is(e)},use:Aa,useCallback:function(e,t){return Nv="useCallback",xa(),So(e,t)},useContext:function(e){return Nv="useContext",xa(),is(e)},useEffect:function(e,t){Nv="useEffect",xa(),bo(2048,av,e,t)},useImperativeHandle:function(e,t,n){return Nv="useImperativeHandle",xa(),ko(e,t,n)},useInsertionEffect:function(e,t){return Nv="useInsertionEffect",xa(),bo(4,nv,e,t)},useLayoutEffect:function(e,t){return Nv="useLayoutEffect",xa(),bo(4,sv,e,t)},useMemo:function(e,t){Nv="useMemo",xa();var n=Fd.H;Fd.H=Ov;try{return Co(e,t)}finally{Fd.H=n}},useReducer:function(e,t,n){Nv="useReducer",xa();var s=Fd.H;Fd.H=Ov;try{return ja(e)}finally{Fd.H=s}},useRef:function(){return Nv="useRef",xa(),Ta().memoizedState},useState:function(){Nv="useState",xa();var e=Fd.H;Fd.H=Ov;try{return ja(Ia)}finally{Fd.H=e}},useDebugValue:function(){Nv="useDebugValue",xa()},useDeferredValue:function(e,t){return Nv="useDeferredValue",xa(),_o(e,t)},useTransition:function(){return Nv="useTransition",xa(),jo()},useSyncExternalStore:function(e,t,n){return Nv="useSyncExternalStore",xa(),za(e,t,n)},useId:function(){return Nv="useId",xa(),Ta().memoizedState},useFormState:function(e){return Nv="useFormState",xa(),wa(),po(e)},useActionState:function(e){return Nv="useActionState",xa(),po(e)},useOptimistic:function(e,t){return Nv="useOptimistic",xa(),eo(e,t)},useHostTransitionStatus:Xo,useMemoCache:Ba,useCacheRefresh:function(){return Nv="useCacheRefresh",xa(),Ta().memoizedState},useEffectEvent:function(e){return Nv="useEffectEvent",xa(),xo(e)}},Pv={readContext:function(e){return is(e)},use:function(e){return Aa(e)},useCallback:function(e,t){return Nv="useCallback",ya(),Do(e,t)},useContext:function(e){return Nv="useContext",ya(),is(e)},useEffect:function(e,t){return Nv="useEffect",ya(),vo(e,t)},useImperativeHandle:function(e,t,n){return Nv="useImperativeHandle",ya(),Eo(e,t,n)},useInsertionEffect:function(e,t){Nv="useInsertionEffect",ya(),go(4,nv,e,t)},useLayoutEffect:function(e,t){return Nv="useLayoutEffect",ya(),No(e,t)},useMemo:function(e,t){Nv="useMemo",ya();var n=Fd.H;Fd.H=Pv;try{return Mo(e,t)}finally{Fd.H=n}},useReducer:function(e,t,n){Nv="useReducer",ya();var s=Fd.H;Fd.H=Pv;try{return Fa(e,t,n)}finally{Fd.H=s}},useRef:function(e){return Nv="useRef",ya(),fo(e)},useState:function(e){Nv="useState",ya();var t=Fd.H;Fd.H=Pv;try{return Ya(e)}finally{Fd.H=t}},useDebugValue:function(){Nv="useDebugValue",ya()},useDeferredValue:function(e,t){return Nv="useDeferredValue",ya(),Vo(e,t)},useTransition:function(){return Nv="useTransition",ya(),Uo()},useSyncExternalStore:function(e,t,n){return Nv="useSyncExternalStore",ya(),Xa(e,t,n)},useId:function(){return Nv="useId",ya(),zo()},useFormState:function(e,t){return Nv="useFormState",ya(),lo(e,t)},useActionState:function(e,t){return Nv="useActionState",ya(),lo(e,t)},useOptimistic:function(e){return Nv="useOptimistic",ya(),Ja(e)},useMemoCache:function(e){return Ba(e)},useHostTransitionStatus:Xo,useCacheRefresh:function(){return Nv="useCacheRefresh",ya(),Go()},useEffectEvent:function(e){return Nv="useEffectEvent",ya(),yo(e)}},_v={readContext:function(e){return is(e)},use:function(e){return Aa(e)},useCallback:function(e,t){return Nv="useCallback",xa(),So(e,t)},useContext:function(e){return Nv="useContext",xa(),is(e)},useEffect:function(e,t){Nv="useEffect",xa(),bo(2048,av,e,t)},useImperativeHandle:function(e,t,n){return Nv="useImperativeHandle",xa(),ko(e,t,n)},useInsertionEffect:function(e,t){return Nv="useInsertionEffect",xa(),bo(4,nv,e,t)},useLayoutEffect:function(e,t){return Nv="useLayoutEffect",xa(),bo(4,sv,e,t)},useMemo:function(e,t){Nv="useMemo",xa();var n=Fd.H;Fd.H=_v;try{return Co(e,t)}finally{Fd.H=n}},useReducer:function(e,t,n){Nv="useReducer",xa();var s=Fd.H;Fd.H=_v;try{return Ua(e)}finally{Fd.H=s}},useRef:function(){return Nv="useRef",xa(),Ta().memoizedState},useState:function(){Nv="useState",xa();var e=Fd.H;Fd.H=_v;try{return Ua(Ia)}finally{Fd.H=e}},useDebugValue:function(){Nv="useDebugValue",xa()},useDeferredValue:function(e,t){return Nv="useDeferredValue",xa(),Po(e,t)},useTransition:function(){return Nv="useTransition",xa(),Ro()},useSyncExternalStore:function(e,t,n){return Nv="useSyncExternalStore",xa(),za(e,t,n)},useId:function(){return Nv="useId",xa(),Ta().memoizedState},useFormState:function(e){return Nv="useFormState",xa(),co(e)},useActionState:function(e){return Nv="useActionState",xa(),co(e)},useOptimistic:function(e,t){return Nv="useOptimistic",xa(),Qa(e,t)},useMemoCache:function(e){return Ba(e)},useHostTransitionStatus:Xo,useCacheRefresh:function(){return Nv="useCacheRefresh",xa(),Ta().memoizedState},useEffectEvent:function(e){return Nv="useEffectEvent",xa(),xo(e)}},Ov={readContext:function(e){return is(e)},use:function(e){return Aa(e)},useCallback:function(e,t){return Nv="useCallback",xa(),So(e,t)},useContext:function(e){return Nv="useContext",xa(),is(e)},useEffect:function(e,t){Nv="useEffect",xa(),bo(2048,av,e,t)},useImperativeHandle:function(e,t,n){return Nv="useImperativeHandle",xa(),ko(e,t,n)},useInsertionEffect:function(e,t){return Nv="useInsertionEffect",xa(),bo(4,nv,e,t)},useLayoutEffect:function(e,t){return Nv="useLayoutEffect",xa(),bo(4,sv,e,t)},useMemo:function(e,t){Nv="useMemo",xa();var n=Fd.H;Fd.H=_v;try{return Co(e,t)}finally{Fd.H=n}},useReducer:function(e,t,n){Nv="useReducer",xa();var s=Fd.H;Fd.H=_v;try{return ja(e)}finally{Fd.H=s}},useRef:function(){return Nv="useRef",xa(),Ta().memoizedState},useState:function(){Nv="useState",xa();var e=Fd.H;Fd.H=_v;try{return ja(Ia)}finally{Fd.H=e}},useDebugValue:function(){Nv="useDebugValue",xa()},useDeferredValue:function(e,t){return Nv="useDeferredValue",xa(),_o(e,t)},useTransition:function(){return Nv="useTransition",xa(),jo()},useSyncExternalStore:function(e,t,n){return Nv="useSyncExternalStore",xa(),za(e,t,n)},useId:function(){return Nv="useId",xa(),Ta().memoizedState},useFormState:function(e){return Nv="useFormState",xa(),po(e)},useActionState:function(e){return Nv="useActionState",xa(),po(e)},useOptimistic:function(e,t){return Nv="useOptimistic",xa(),eo(e,t)},useMemoCache:function(e){return Ba(e)},useHostTransitionStatus:Xo,useCacheRefresh:function(){return Nv="useCacheRefresh",xa(),Ta().memoizedState},useEffectEvent:function(e){return Nv="useEffectEvent",xa(),xo(e)}};var Tv={},Lv=new Set,Av=new Set,Bv=new Set,Iv=new Set,Fv=new Set,Uv=new Set,Rv=new Set,jv=new Set,Xv=new Set,zv=new Set;Object.freeze(Tv);var Gv={enqueueSetState:function(e,t,n){var s=Ji(e=e._reactInternals),a=ta(s);a.payload=t,null!=n&&(Zo(n),a.callback=n),null!==(t=na(e,a,s))&&(ps(s,"this.setState()",e),Zi(t,e,s),sa(t,e,s))},enqueueReplaceState:function(e,t,n){var s=Ji(e=e._reactInternals),a=ta(s);a.tag=Rb,a.payload=t,null!=n&&(Zo(n),a.callback=n),null!==(t=na(e,a,s))&&(ps(s,"this.replaceState()",e),Zi(t,e,s),sa(t,e,s))},enqueueForceUpdate:function(e,t){var n=Ji(e=e._reactInternals),s=ta(n);s.tag=jb,null!=t&&(Zo(t),s.callback=t),null!==(t=na(e,s,n))&&(ps(n,"this.forceUpdate()",e),Zi(t,e,n),sa(t,e,n))}},Hv=null,Wv=null,qv=Error("This is not a real error. It's an implementation detail of React's selective hydration feature. If this leaks into userspace, it's a bug in React. Please file an issue."),Kv=!1,$v={},Yv={},Jv={},Qv={},Zv=!1,ey={},ty={},ny={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},sy=!1,ay=null;ay=new Set;var oy=!1,ry=!1,iy=!1,ly="function"==typeof WeakSet?WeakSet:Set,cy=null,uy=null,dy=null,my=null,py=!1,hy=null,fy=!1,gy=8192,by={getCacheForType:function(e){var t=is(tg),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return is(tg).controller.signal},getOwner:function(){return Zd}};if("function"==typeof Symbol&&Symbol.for){var vy=Symbol.for;vy("selector.component"),vy("selector.has_pseudo_class"),vy("selector.role"),vy("selector.test_id"),vy("selector.text")}var yy=[],xy="function"==typeof WeakMap?WeakMap:Map,Ny=0,wy=2,Ey=4,ky=0,Dy=1,Sy=2,My=3,Cy=4,Vy=6,Py=5,_y=Ny,Oy=null,Ty=null,Ly=0,Ay=0,By=1,Iy=2,Fy=3,Uy=4,Ry=5,jy=6,Xy=7,zy=8,Gy=9,Hy=Ay,Wy=null,qy=!1,Ky=!1,$y=!1,Yy=0,Jy=ky,Qy=0,Zy=0,ex=0,tx=0,nx=0,sx=null,ax=null,ox=!1,rx=0,ix=0,lx=300,cx=1/0,ux=500,dx=null,mx=null,px=null,hx=0,fx=1,gx=2,bx=3,vx=0,yx=1,xx=2,Nx=3,wx=4,Ex=5,kx=0,Dx=null,Sx=null,Mx=0,Cx=0,Vx=-0,Px=null,_x=null,Ox=null,Tx=hx,Lx=null,Ax=50,Bx=0,Ix=null,Fx=!1,Ux=!1,Rx=50,jx=0,Xx=null,zx=null,Gx=!1,Hx=new Set,Wx=null,qx=null,Kx=!1,$x=!1,Yx=!1,Jx=!1,Qx=0,Zx={};!function(){for(var e=0;e<zh.length;e++){var t=zh[e];Jt(t.toLowerCase(),"on"+(t=t[0].toUpperCase()+t.slice(1)))}Jt(Ah,"onAnimationEnd"),Jt(Bh,"onAnimationIteration"),Jt(Ih,"onAnimationStart"),Jt("dblclick","onDoubleClick"),Jt("focusin","onFocus"),Jt("focusout","onBlur"),Jt(Fh,"onTransitionRun"),Jt(Uh,"onTransitionStart"),Jt(Rh,"onTransitionCancel"),Jt(jh,"onTransitionEnd")}(),ye("onMouseEnter",["mouseout","mouseover"]),ye("onMouseLeave",["mouseout","mouseover"]),ye("onPointerEnter",["pointerout","pointerover"]),ye("onPointerLeave",["pointerout","pointerover"]),ve("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ve("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ve("onBeforeInput",["compositionend","keypress","textInput","paste"]),ve("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ve("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ve("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eN="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tN=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(eN)),nN="_reactListening"+Math.random().toString(36).slice(2),sN=!1,aN=!1,oN=!1,rN=!1,iN=!1,lN=!1,cN=!1,uN={},dN=/\r\n?/g,mN=/\u0000|\uFFFD/g,pN="http://www.w3.org/1999/xlink",hN="http://www.w3.org/XML/1998/namespace",fN="javascript:throw new Error('React form unexpectedly submitted.')",gN="suppressHydrationWarning",bN="&",vN="/&",yN="$",xN="/$",NN="$?",wN="$~",EN="$!",kN="html",DN="body",SN="head",MN="F!",CN="F",VN="loading",PN="style",_N=0,ON=1,TN=2,LN=null,AN=null,BN={dialog:!0,webview:!0},IN=null,FN=void 0,UN="function"==typeof setTimeout?setTimeout:void 0,RN="function"==typeof clearTimeout?clearTimeout:void 0,jN=-1,XN="function"==typeof Promise?Promise:void 0,zN="function"==typeof queueMicrotask?queueMicrotask:void 0!==XN?function(e){return XN.resolve(null).then(e).catch(Ic)}:UN,GN=null,HN=0,WN=1,qN=2,KN=3,$N=4,YN=new Map,JN=new Set,QN=Ud.d;Ud.d={f:function(){var e=QN.f(),t=al();return e||t},r:function(e){var t=he(e);null!==t&&5===t.tag&&"form"===t.type?Fo(t):QN.r(e)},D:function(e){QN.D(e),bu("dns-prefetch",e,null)},C:function(e,t){QN.C(e,t),bu("preconnect",e,t)},L:function(e,t,n){QN.L(e,t,n);var s=cw;if(s&&e&&t){var a='link[rel="preload"][as="'+_e(t)+'"]';"image"===t&&n&&n.imageSrcSet?(a+='[imagesrcset="'+_e(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(a+='[imagesizes="'+_e(n.imageSizes)+'"]')):a+='[href="'+_e(e)+'"]';var o=a;switch(t){case"style":o=xu(e);break;case"script":o=Eu(e)}YN.has(o)||(e=yd({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),YN.set(o,e),null!==s.querySelector(a)||"style"===t&&s.querySelector(Nu(o))||"script"===t&&s.querySelector(ku(o))||(xc(t=s.createElement("link"),"link",e),be(t),s.head.appendChild(t)))}},m:function(e,t){QN.m(e,t);var n=cw;if(n&&e){var s=t&&"string"==typeof t.as?t.as:"script",a='link[rel="modulepreload"][as="'+_e(s)+'"][href="'+_e(e)+'"]',o=a;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Eu(e)}if(!YN.has(o)&&(e=yd({rel:"modulepreload",href:e},t),YN.set(o,e),null===n.querySelector(a))){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(ku(o)))return}xc(s=n.createElement("link"),"link",e),be(s),n.head.appendChild(s)}}},X:function(e,t){QN.X(e,t);var n=cw;if(n&&e){var s=ge(n).hoistableScripts,a=Eu(e),o=s.get(a);o||((o=n.querySelector(ku(a)))||(e=yd({src:e,async:!0},t),(t=YN.get(a))&&Cu(e,t),be(o=n.createElement("script")),xc(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},s.set(a,o))}},S:function(e,t,n){QN.S(e,t,n);var s=cw;if(s&&e){var a=ge(s).hoistableStyles,o=xu(e);t=t||"default";var r=a.get(o);if(!r){var i={loading:HN,preload:null};if(r=s.querySelector(Nu(o)))i.loading=WN|$N;else{e=yd({rel:"stylesheet",href:e,"data-precedence":t},n),(n=YN.get(o))&&Mu(e,n);var l=r=s.createElement("link");be(l),xc(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){i.loading|=WN}),l.addEventListener("error",function(){i.loading|=qN}),i.loading|=$N,Su(r,t,s)}r={type:"stylesheet",instance:r,count:1,state:i},a.set(o,r)}}},M:function(e,t){QN.M(e,t);var n=cw;if(n&&e){var s=ge(n).hoistableScripts,a=Eu(e),o=s.get(a);o||((o=n.querySelector(ku(a)))||(e=yd({src:e,async:!0,type:"module"},t),(t=YN.get(a))&&Cu(e,t),be(o=n.createElement("script")),xc(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},s.set(a,o))}}};var ZN,ew,tw,nw,sw,aw,ow,rw,iw,lw,cw="undefined"==typeof document?null:document,uw=null,dw=6e4,mw=800,pw=500,hw=0,fw=null,gw=null,bw=Rd,vw={$$typeof:Md,Provider:null,Consumer:null,_currentValue:bw,_currentValue2:bw,_threadCount:0},yw="%c%s%c",xw="background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px",Nw="",ww=" ",Ew=Function.prototype.bind,kw=!1;ZN=function(e,t,a,o){null!==(t=n(e,t))&&(a=s(t.memoizedState,a,0,o),t.memoizedState=a,t.baseState=a,e.memoizedProps=yd({},e.memoizedProps),null!==(a=fn(e,2))&&Zi(a,e,2))},ew=function(e,t,s){null!==(t=n(e,t))&&(s=r(t.memoizedState,s,0),t.memoizedState=s,t.baseState=s,e.memoizedProps=yd({},e.memoizedProps),null!==(s=fn(e,2))&&Zi(s,e,2))},tw=function(e,t,s,o){null!==(t=n(e,t))&&(s=a(t.memoizedState,s,o),t.memoizedState=s,t.baseState=s,e.memoizedProps=yd({},e.memoizedProps),null!==(s=fn(e,2))&&Zi(s,e,2))},nw=function(e,t,n){e.pendingProps=s(e.memoizedProps,t,0,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),null!==(t=fn(e,2))&&Zi(t,e,2)},sw=function(e,t){e.pendingProps=r(e.memoizedProps,t,0),e.alternate&&(e.alternate.pendingProps=e.pendingProps),null!==(t=fn(e,2))&&Zi(t,e,2)},aw=function(e,t,n){e.pendingProps=a(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),null!==(t=fn(e,2))&&Zi(t,e,2)},ow=function(e){var t=fn(e,2);null!==t&&Zi(t,e,2)},rw=function(e){var t=ee(),n=fn(e,t);null!==n&&Zi(n,e,t)},iw=function(e){l=e},lw=function(e){i=e};var Dw,Sw=!0,Mw=null,Cw=!1,Vw=null,Pw=null,_w=null,Ow=new Map,Tw=new Map,Lw=[],Aw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" "),Bw=null;if(id.prototype.render=rd.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error("Cannot update an unmounted root.");var n=arguments;"function"==typeof n[1]||g(n[1])||n[1],n=e;var s=t.current;Fu(s,Ji(s),n,t,null,null)},id.prototype.unmount=rd.prototype.unmount=function(){var e=arguments;if(e[0],null!==(e=this._internalRoot)){this._internalRoot=null;var t=e.containerInfo;Fu(e.current,2,null,e,null,null),al(),t[Om]=null}},id.prototype.unstable_scheduleHydration=function(e){if(e){var t=ue();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lw.length&&0!==t&&t<Lw[n].priority;n++);Lw.splice(n,0,e),0===n&&Qu(e)}},function(){var e=bd.version;if("19.2.3"!==e)throw Error('Incompatible React versions: The "react" and "react-dom" packages must have the exact same version. Instead got:\n  - react:      '+e+"\n  - react-dom:  19.2.3\nLearn more: https://react.dev/warnings/version-mismatch")}(),"function"==typeof Map&&null!=Map.prototype&&"function"==typeof Map.prototype.forEach&&"function"==typeof Set&&null!=Set.prototype&&"function"==typeof Set.prototype.clear&&Set.prototype.forEach,Ud.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error("Unable to find node on an unmounted component.");throw e=Object.keys(e).join(","),Error("Argument appears to not be a ReactComponent. Keys: "+e)}return e=function(e){var t=e.alternate;if(!t){if(null===(t=b(e)))throw Error("Unable to find node on an unmounted component.");return t!==e?null:e}for(var n=e,s=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(s=a.return)){n=s;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return x(a),e;if(o===s)return x(a),t;o=o.sibling}throw Error("Unable to find node on an unmounted component.")}if(n.return!==s.return)n=a,s=o;else{for(var r=!1,i=a.child;i;){if(i===n){r=!0,n=a,s=o;break}if(i===s){r=!0,s=a,n=o;break}i=i.sibling}if(!r){for(i=o.child;i;){if(i===n){r=!0,n=o,s=a;break}if(i===s){r=!0,s=o,n=a;break}i=i.sibling}if(!r)throw Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(n.alternate!==s)throw Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(3!==n.tag)throw Error("Unable to find node on an unmounted component.");return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?N(e):null)?null:e.stateNode},(Dw={bundleType:1,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Fd,reconcilerVersion:"19.2.3"}).overrideHookState=ZN,Dw.overrideHookStateDeletePath=ew,Dw.overrideHookStateRenamePath=tw,Dw.overrideProps=nw,Dw.overridePropsDeletePath=sw,Dw.overridePropsRenamePath=aw,Dw.scheduleUpdate=ow,Dw.scheduleRetry=rw,Dw.setErrorHandler=iw,Dw.setSuspenseHandler=lw,Dw.scheduleRefresh=h,Dw.scheduleRoot=p,Dw.setRefreshHandler=f,Dw.getCurrentFiber=zu,!function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled)return!0;if(!t.supportsFiber)return!0;try{fm=t.inject(e),gm=t}catch(n){}return!!t.checkDCE}(Dw)&&Bp&&window.top===window.self&&(-1<navigator.userAgent.indexOf("Chrome")&&-1===navigator.userAgent.indexOf("Edge")||-1<navigator.userAgent.indexOf("Firefox"))){var Iw=window.location.protocol;/^(https?|file):$/.test(Iw)}Qn.createRoot=function(e,t){if(!g(e))throw Error("Target container is not a DOM element.");ld(e);var n=!1,s="",a=ar,o=or,r=rr;return null!=t&&(t.hydrate||"object"==typeof t&&null!==t&&t.$$typeof,!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onUncaughtError&&(a=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bu(e,1,!1,null,0,n,s,null,a,o,r,od),e[Om]=t.current,oc(e),new rd(t)},Qn.hydrateRoot=function(e,t,n){if(!g(e))throw Error("Target container is not a DOM element.");ld(e);var s=!1,a="",o=ar,r=or,i=rr,l=null;return null!=n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onUncaughtError&&(o=n.onUncaughtError),void 0!==n.onCaughtError&&(r=n.onCaughtError),void 0!==n.onRecoverableError&&(i=n.onRecoverableError),void 0!==n.formState&&(l=n.formState)),(t=Bu(e,1,!0,t,0,s,a,l,o,r,i,od)).context=Iu(null),(a=ta(s=re(s=Ji(n=t.current)))).callback=null,na(n,a,s),ps(s,"hydrateRoot()",null),n=s,t.current.lanes=n,ne(t,n),zl(t),e[Om]=t.current,oc(e),new id(t)},Qn.version="19.2.3","undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()),Qn}var ss=($n||($n=1,Jn.exports=ns()),Jn.exports);const as={},os=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=n?.nonce||n?.getAttribute("nonce");s=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in as)return;as[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,a&&s.setAttribute("nonce",a),document.head.appendChild(s),t?new Promise((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})},rs=e=>Symbol.iterator in e,is=e=>"entries"in e,ls=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),s=t instanceof Map?t:new Map(t.entries());if(n.size!==s.size)return!1;for(const[a,o]of n)if(!s.has(a)||!Object.is(o,s.get(a)))return!1;return!0};function cs(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(rs(e)&&rs(t)?is(e)&&is(t)?ls(e,t):((e,t)=>{const n=e[Symbol.iterator](),s=t[Symbol.iterator]();let a=n.next(),o=s.next();for(;!a.done&&!o.done;){if(!Object.is(a.value,o.value))return!1;a=n.next(),o=s.next()}return!!a.done&&!!o.done})(e,t):ls({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}function us(e){const t=a.useRef(void 0);return n=>{const s=e(n);return cs(t.current,s)?t.current:t.current=s}}const ds=e=>(t,n,s)=>(s.setState=(e,n,...s)=>{const a="function"==typeof e?o(e):e;return t(a,n,...s)},e(s.setState,n,s));function ms(e){if(!e)return"";if(e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:"))return e;const t="/".endsWith("/")?"/".slice(0,-1):"/";if(""===t||"/"===t)return e;const n=e.startsWith("/")?e:"/"+e;if(n.startsWith(t))return n;return t+n}function ps(e,t,n){const s=e.replace(/\.wav$/i,"");return{filename:e,name:s.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/\s+/g," ").trim()||s,category:t,url:ms(`${n}/${t}/${encodeURIComponent(e)}`)}}const hs="data/samples/packs/drumnibus",fs={id:"drumnibus",name:"Drumnibus Electro Drums",author:"Legowelt",description:"A collection of 229 electro drum machine samples. Classic analog-style kicks, snares, hi-hats, percussion and FX sounds perfect for electro, techno, and electronic music production.",coverImage:ms("data/samples/packs/drumnibus/cover.png"),basePath:hs,categories:["kicks","snares","hihats","percussion","fx"],samples:{kicks:["BB_Electro1short.wav","BD_Drumaxia.wav","BD_Pufsub.wav","BD_808A1200.wav","BD_DiggerLong.wav","BD_Digidap.wav","BD_Digimozzy.wav","BD_Dikkie.wav","BD_Dome_Long.wav","BD_EchoRam1.wav","BD_EchoRam2.wav","BD_Electro1shorter.wav","BD_Juxtapos.wav","BD_Lite2021.wav","BD_LofiHuman.wav","BD_Losamplix.wav","BD_Magnotron..wav","BD_Matrixtape1.wav","BD_Matrixtape2.wav","BD_Plastiklog.wav","BD_Punchtron.wav","BD_Punchysplur.wav","BD_Pziforze.wav","BD_Ritmo.wav","BD_Romkick1.wav","BD_Rubydub.wav","BD_Ruflex.wav","BD_Simpletron.wav","BD_Springworth.wav","BD_Spriverbion.wav","BD_Stuf.wav","BD_SubThud.wav","BD_Zistort.wav"].map(e=>ps(e,"kicks",hs)),snares:["SD_808A1200.wav","SD_Analog_Noise_2.wav","SD_Analog_Noise_4.wav","SD_Analog_Noise_5.wav","SD_Analog_Noise1.wav","SD_CompuCrunchy.wav","SD_Digidap.wav","SD_Draconis1.wav","SD_Draconis2.wav","SD_Drumaxia.wav","SD_Echoram1.wav","SD_Echoram2.wav","SD_Echoram3.wav","SD_electro7000.wav","SD_Hark.wav","SD_Juxtapos.wav","SD_Kitcatlitter.wav","SD_LoDigital_1.wav","SD_LoDigital_2.wav","SD_LofiHuman.wav","SD_Magnotron.wav","SD_Mamba.wav","SD_Mambalazesnare.wav","SD_Mambalazesnare2.wav","SD_NomiSnare.wav","SD_NomiSnareLazer.wav","SD_NomiSnareWhip.wav","SD_Punchtron..wav","SD_Reverz1.wav","SD_Reverz2.wav","SD_Reverz3.wav","SD_Ritmo.wav","SD_Rubydubwav.wav","SD_Ruflex.wav","SD_Strakker.wav","SD_Turbosound.wav","SD_Wolf_3.wav","SD_Wolf_5.wav","SD_Wolf_6.wav","SD_Wolf_7.wav","SD_Wolf_8.wav","SD_Wolf_9.wav","SD_Wolf1.wav","SD_Wolf2.wav","SD_Wolfsweep1.wav"].map(e=>ps(e,"snares",hs)),hihats:["CH_Digidap.wav","CH_DistortedRitmo.wav","CH_DraconisD921.wav","CH_DraconisD922.wav","CH_Fantio_Closed_Hat.wav","CH_Filtix_Closed_Hat.wav","CH_Juxtapos.wav","CH_LofiHuman.wav","CH_Magnotron.wav","CH_Punchtron.wav","CH_Rezmatix_Closed_Hat.wav","CH_Rubydub.wav","CH_Ruflex.wav","CH_Sizzel_Closed_Hat.wav","CYM_Juxtapos.wav","CYM_Magnotron.wav","CYM_Punchtron.wav","CYM_Ruflex.wav","CYM_Synthique.wav","OH_AnalogHihat1.wav","OH_AnalogOpenhatwav.wav","OH_AnalogVeryLongHat.wav","OH_Digidap.wav","OH_DistortedRitmo.wav","OH_DraconisD921.wav","OH_DraconisD922.wav","OH_Drumaxia.wav","OH_Fantio_Open_Hat.wav","OH_Filtix_Open_Hat.wav","OH_Juxtapos.wav","OH_LofiHuman.wav","OH_Magnotron.wav","OH_Punchtron.wav","OH_Rezmatix_Open_Hat_Long.wav","OH_Rezmatix_Open_Hat.wav","OH_Rubydub.wav","OH_Ruflex.wav","OH_Sizzel_Open_Hat.wav"].map(e=>ps(e,"hihats",hs)),claps:[],percussion:["BELL_Darkgong.wav","BELL_Filterbell.wav","BELL_Hypnoschaal.wav","BELL_Hypnoschaal2.wav","BELL_Hypnoschaal3.wav","BONGO_Ryhtmbox.wav","BONGO_Ryhtmbox2.wav","BONGO_Simple.wav","CLAP_Juxtapos.wav","CLAP_LofiHuman.wav","CLAP_Magnotron.wav","CLAP_Punchtron.wav","CLAP_Rubydub.wav","CLAP_Ruflex.wav","CLAVE_Punchtron.wav","CLAVE_Simple.wav","CLAVE_Singalique.wav","CLAVE_Syntheticblox.wav","CONGA_Lowpark.wav","CONGA_Syntique.wav","COW_Syntique.wav","LAZ_Drumaxia.wav","LAZ_Blip1.wav","LAZ_Blip2.wav","LAZ_Blip3.wav","LAZ_Chewy1.wav","LAZ_Digidap.wav","LAZ_Lectrophy.wav","LAZ_Lectrophy2.wav","LAZ_lowvix1.wav","LAZ_lowvix2.wav","LAZ_lowvix3.wav","LAZ_Mambalazesnare.wav","LAZ_R900.wav","LAZ_Softrond.wav","LAZ_Softrond2.wav","LAZ_Softrond3.wav","RIM_Losimple.wav","RIM_Magnotron.wav","RIM_Rubydub.wav","SHAKE_AnalogShaker1.wav","SHAKE_AnalogShaker2.wav","SHAKE_AnalogShaker3.wav","SHAKE_Ritmo.wav","SNAP_Juxtapos.wav","TABLA_Mamba.wav","TAMB_Tamb&Shaker.wav","TAMB_TapeShake1.wav","TAMB_TapeShake2.wav","TAMB_TapeShake3.wav","TOM_digger.wav","TOM_DistortedRitmo.wav","TOM_DistortedRitmoHi.wav","TOM_DraconisDS92.wav","TOM_DraconisDS92high.wav","TOM_Druimaxia.wav","TOM_Juxtapos.wav","TOM_LofiHuman.wav","TOM_Magnotron.wav","TOM_Osciaz.wav","TOM_Punchtron.wav","TOM_Rubydub.wav","TOM_Ruflex.wav","TOM_Stofelectro1.wav","TOM_TamborineTom.wav","TOM_TamborineTom2.wav","TOM_TamborineTom3.wav","TOM_Warped.wav"].map(e=>ps(e,"percussion",hs)),fx:["FX_AnalogFX1.wav","FX_AnalogFX2.wav","FX_Blarper.wav","FX_Briesherfst.wav","FX_Briesherfst2.wav","FX_Briesherfst3.wav","FX_Burst1.wav","FX_Burst2.wav","FX_Chainmalz.wav","FX_Digidap2.wav","FX_Digidap3.wav","FX_Drumaxia.wav","FX_Drumaxia2.wav","FX_ElectroIsland.wav","FX_ElectroIsland2.wav","FX_Emerx1.wav","FX_Emerx2.wav","FX_Emerx3.wav","FX_LofiHuman.wav","FX_LofiHuman2.wav","FX_Magstorm1.wav","FX_Magstorm2.wav","FX_NomiElastiek.wav","FX_NomiLaser1.wav","FX_NomiLectric.wav","FX_NomiLectric2.wav","FX_NomiSnip.wav","FX_NomiSpring.wav","FX_Poni1.wav","FX_Poni2.wav","FX_Poni3.wav","FX_Quarkulator.wav","FX_Quarkulator2.wav","FX_Sloiz.wav","FX_Snakamon1.wav","FX_Snakamon2.wav","FX_Snakamon3.wav","FX_Snakamon3B.wav","FX_Snakamon5.wav","FX_Sonar.wav","FX_Sonar2.wav","FX_Sydrum1.wav","FX_Sydrum2.wav","FX_Sydrum3.wav","FX_Timpio.wav"].map(e=>ps(e,"fx",hs)),bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},sampleCount:229},gs="data/samples/packs/casio-mt40",bs={id:"casio-mt40",name:"Casio MT-40",author:"Casio",description:"Classic 8-bit instrument sounds from the legendary Casio MT-40 keyboard. Home of the Sleng Teng riddim.",coverImage:ms("data/samples/packs/casio-mt40/cover.jpg"),basePath:gs,categories:["leads"],samples:{kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:["accordion.wav","banjo.wav","bass.wav","brass.wav","celesta.wav","cello.wav","clarinet.wav","elec piano.wav","flute.wav","folk flute.wav","funny fuzz.wav","glocken.wav","guitar.wav","harpsichord.wav","organ.wav","oriental.wav","pipe-organ.wav","recorder.wav","st ensemble.wav","synth fuzz.wav","trumpet.wav","violin.wav","xylophone.wav"].map(e=>ps(e,"leads",gs)),pads:[],loops:[],vocals:[],other:[]},sampleCount:23},vs="data/samples/packs/st-01",ys={id:"st-01",name:"ST-01 (Ami-Sampler)",author:"Unknown",description:"Classic Amiga tracker sounds from the Ami-Sampler VST. 126 samples including drums, basses, strings, leads and more. Perfect for classic tracker music and chiptune.",basePath:vs,categories:["kicks","snares","claps","hihats","percussion","bass","leads","pads"],samples:{kicks:["BassDrum1.wav","BassDrum2.wav","BassDrum3.wav","BassDrum4.wav"].map(e=>ps(e,"kicks",vs)),snares:["Snare1.wav","Snare2.wav","Snare3.wav","Snare4.wav","Snare5.wav","PopSnare1.wav","PopSnare2.wav","PopSnare3.wav","Smash1.wav","Smash2.wav"].map(e=>ps(e,"snares",vs)),claps:["Claps1.wav","Claps2.wav"].map(e=>ps(e,"claps",vs)),hihats:["HiHat1.wav","HiHat2.wav","CloseHiHat.wav"].map(e=>ps(e,"hihats",vs)),percussion:["Claves.wav","Conga.wav","CowBell.wav","DxTom.wav","ElecTom.wav","Perco.wav","Shaker.wav","SynClaves.wav","WoodBlock.wav"].map(e=>ps(e,"percussion",vs)),bass:["DeepBass.wav","DXBass.wav","FilterBass.wav","FunBass.wav","FunkBass.wav","KorgBass.wav","MonoBass.wav","MonsterBass.wav","PopBass.wav","RubberBass.wav","SlapBass.wav","SoftBass.wav","SyntheBass.wav","TechBass.wav","TuneBass.wav","WowBass.wav"].map(e=>ps(e,"bass",vs)),leads:["Alien.wav","Aligator.wav","Asia.wav","BigBow.wav","Blast.wav","Blubzing.wav","Breath.wav","Call.wav","Celeste.wav","Chink.wav","Cinema.wav","Dangerous.wav","Detune.wav","DigDug.wav","DigiHarp.wav","DreamBells.wav","EPiano.wav","ExBells.wav","FaeryTale.wav","Gato.wav","Great.wav","HallBrass.wav","Heaven.wav","HeavySynth.wav","Heifer.wav","Hooman.wav","Horns.wav","JahrMarkt1.wav","JahrMarkt2.wav","Jetes.wav","Klickorgan.wav","KorgBeau.wav","KorgBow.wav","KorgFilter.wav","Koto.wav","Leader.wav","Licks.wav","Magic.wav","Marimba.wav","Mechanic1.wav","Mechanic2.wav","MetalKeys.wav","MuteClav.wav","Nice.wav","NightMare.wav","NoteMan.wav","Organ.wav","Outlaw.wav","PanFlute.wav","PingBells.wav","Pizza.wav","PolySynth.wav","Pulse.wav","RingPiano.wav","RoomBrass.wav","Shamus.wav","SineCZ.wav","SixTease.wav","Soundtrack.wav","Squares.wav","Stabs.wav","Steinway.wav","Strange.wav","Sweep.wav","SynBrass.wav","SynthPiano.wav","TheEgg.wav","TineWave.wav","Touch.wav","Voices.wav"].map(e=>ps(e,"leads",vs)),pads:["AnalogString.wav","KorgString.wav","RichString.wav","Strings1.wav","Strings2.wav","Strings3.wav","Strings4.wav","Strings5.wav","strings6.wav","Strings7.wav","Strings8.wav","WabberString.wav"].map(e=>ps(e,"pads",vs)),fx:[],loops:[],vocals:[],other:[]},sampleCount:126},xs="data/samples/packs/st-02",Ns={id:"st-02",name:"ST-02 (Ami-Sampler)",author:"Unknown",description:"More classic Amiga tracker sounds from the Ami-Sampler VST. 121 samples including Kermit vocals, percussion, basses and melodic instruments. Great for tracker music.",basePath:xs,categories:["kicks","snares","hihats","percussion","bass","leads","vocals"],samples:{kicks:["BassDrum5.wav","bassdrum8.wav","linnkick.wav"].map(e=>ps(e,"kicks",xs)),snares:["Snare6.wav","Snare7.wav","Snare8.wav","Snare9.wav","snare10.wav","break.wav","snx.drum2.wav","snx.drum3.wav"].map(e=>ps(e,"snares",xs)),claps:[],hihats:["HiHat3.wav","HiHat4.wav"].map(e=>ps(e,"hihats",xs)),percussion:["Cowbell2.wav","Cymbal1.wav","Cymbal2.wav","ridecymbal.wav","Perc-Agogo.wav","Perc-Bongo.wav","perc-drytom.wav","Perc-HandDrum.wav","Perc-Taiko.wav","Perc-Timbale.wav","Perc-Timpani.wav"].map(e=>ps(e,"percussion",xs)),bass:["DumpfBass.wav","HammerBass.wav","HitBass.wav","HosBass.wav","MilBass.wav","MiniMoog.wav","SoloBass.wav","slapbass2.wav"].map(e=>ps(e,"bass",xs)),leads:["AccGit.wav","accordion.wav","AcoPiano.wav","aeh.wav","AhhVox.wav","Alcom.wav","Aloog.wav","baba.wav","Balance.wav","Blower.wav","Bouncy.wav","Bratz.wav","Brian.wav","Bright.wav","Bubble.wav","China.wav","Cliop.wav","CordPiano.wav","DigiPop.wav","ElecGuitar.wav","EloPin.wav","fatbrass.wav","Friday.wav","GlassMute.wav","Glockenspiel.wav","Growl.wav","guitar1.wav","ha.wav","Hapsi.wav","he.wav","HighVibes.wav","HitMe1.wav","HitMe2.wav","IceRain.wav","importdev.wav","JamJam.wav","k.wav","kermie1.wav","kermie2.wav","kermie3.wav","kermie4.wav","kermie5.wav","kermie6.wav","kermie7.wav","Licks2.wav","LongSlap.wav","master.wav","Monkey.wav","o.wav","ok.wav","Paper.wav","Peck.wav","PinVoice.wav","PitchBrass.wav","Pizza2.wav","Poison.wav","RealKoto1.wav","RealKoto2.wav","Reflex.wav","Reverb2.wav","Ringtone.wav","s.wav","SawJump.wav","Sequencer.wav","servant.wav","Sinbad.wav","SingerBell.wav","Siren.wav","SmartBrass.wav","SpeOwl.wav","Spoils.wav","SqBrass.wav","Squint.wav","Starpeace.wav","Stars.wav","stoehn.wav","stringsc.wav","swoop.wav","SynBuz.wav","SynPia.wav","Take.wav","Tallic.wav","TeaPiano.wav","Telephone.wav","Trio.wav","Tubes.wav","WarmBells.wav","Warmth.wav","YaskMe.wav"].map(e=>ps(e,"leads",xs)),pads:[],fx:[],loops:[],vocals:[],other:[]},sampleCount:121},ws="data/samples/packs/scratch-originals",Es=Array.from({length:53},(e,t)=>{const n=t+1;if(52===n)return null;const s=String(n).padStart(3,"0");return{filename:`scratch_${s}.wav`,name:`Scratch ${s}`,category:"fx",url:ms(`${ws}/scratch_${s}.wav`)}}).filter(e=>null!==e),ks=[fs,bs,ys,Ns,{id:"scratch-originals",name:"Scratch Originals",author:"Phase",description:"52 DJ scratch sounds chopped from a continuous scratch performance. Turntablist moves including babies, transforms, flares, crabs and more.",basePath:ws,categories:["fx"],samples:{kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:Es,bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},sampleCount:Es.length}];const Ds=n(r()),Ss={kicks:"kicks",kick:"kicks",bd:"kicks",bassdrum:"kicks","bass drum":"kicks",snares:"snares",snare:"snares",sd:"snares",hihats:"hihats",hihat:"hihats","hi-hats":"hihats","hi-hat":"hihats",hh:"hihats",claps:"claps",clap:"claps",cp:"claps",percussion:"percussion",perc:"percussion",fx:"fx",effects:"fx",sfx:"fx",bass:"bass",leads:"leads",lead:"leads",pads:"pads",pad:"pads",loops:"loops",loop:"loops",vocals:"vocals",vocal:"vocals",vox:"vocals",toms:"percussion",tom:"percussion",cymbals:"hihats",cymbal:"hihats",rides:"hihats",ride:"hihats",crash:"hihats",open:"hihats",closed:"hihats",oh:"hihats",ch:"hihats"},Ms=[".wav",".mp3",".ogg",".flac",".aiff",".aif",".opus",".aac",".m4a",".webm"],Cs=[".png",".jpg",".jpeg",".webp"];function Vs(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Ms.includes(t)}function Ps(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Cs.includes(t)}function _s(e){const t=e.toLowerCase();return t.includes("cover")||t.includes("folder")||t.includes("front")||t.includes("artwork")}function Os(e,t){const n=e.toLowerCase();return".ds_store"===n||"thumbs.db"===n||n.startsWith("._")||t.includes("__MACOSX")||e.startsWith(".")}function Ts(e){const t=e.toLowerCase().trim();return Ss[t]||"other"}function Ls(e){const t=e.replace(/\.(wav|mp3|ogg|flac|aiff|aif)$/i,"");return t.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/-/g," ").replace(/\s+/g," ").trim()||t}const As=i()(ds(e=>({userPacks:[],uploadZip:async t=>{try{const n=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},n=e.name.replace(/\.zip$/i,"");let s;const a=[],o=new Set;try{const l=await Ds.loadAsync(e),c=Object.entries(l.files);let u=0;for(const[e,n]of c){if(n.dir)continue;const s=e.split("/").filter(e=>e.length>0);if(0===s.length)continue;const i=s[s.length-1];if(Os(i,e))continue;if(Ps(i)){const t=_s(i)?2:s.length<=2?1:0;a.push({path:e,filename:i,priority:t});continue}if(!Vs(i))continue;let l="other";s.length>=2&&(l=Ts(s[s.length-2]));try{const e=await n.async("blob"),s=URL.createObjectURL(e),a={filename:i,name:Ls(i),category:l,url:s};t[l].push(a),o.add(l),u++}catch(r){}}if(a.length>0){a.sort((e,t)=>t.priority-e.priority);const e=a[0],t=l.files[e.path];if(t)try{const e=await t.async("blob");s=URL.createObjectURL(e)}catch(i){}}const d=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===d)throw new Error("No audio files found in the ZIP.");return{id:`user-${Date.now()}`,name:n,author:"User Upload",description:`User-uploaded sample pack with ${d} samples`,coverImage:s,basePath:"",categories:Array.from(o).filter(e=>t[e].length>0),samples:t,sampleCount:d,isUserUploaded:!0}}catch(l){throw l}}(t);return e(e=>{e.userPacks.push(n)}),n}catch(n){throw n}},uploadDirectory:async t=>{try{const n=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let n,s="";const a=[],o=new Set;for(let l=0;l<e.length;l++){const n=e[l],r=n.webkitRelativePath||n.name;if(Os(n.name,r))continue;const c=r.split("/").filter(e=>e.length>0),u=c[c.length-1];if(c.length>1&&!s&&(s=c[0]),Ps(u)){const e=_s(u)?2:c.length<=2?1:0;a.push({file:n,priority:e});continue}if(!Vs(u))continue;let d="other";c.length>=2&&(d=Ts(c.length>=3?c[c.length-2]:c[1]));try{const e=URL.createObjectURL(n),s={filename:u,name:Ls(u),category:d,url:e};t[d].push(s),o.add(d)}catch(i){}}if(s||(s="Uploaded Pack"),a.length>0){a.sort((e,t)=>t.priority-e.priority);try{n=URL.createObjectURL(a[0].file)}catch(i){}}const r=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===r)throw new Error("No audio files found in the directory.");return{id:`user-${Date.now()}`,name:s,author:"User Upload",description:`User-uploaded sample pack with ${r} samples`,coverImage:n,basePath:"",categories:Array.from(o).filter(e=>t[e].length>0),samples:t,sampleCount:r,isUserUploaded:!0}}(t);return e(e=>{e.userPacks.push(n)}),n}catch(n){throw n}},removeUserPack:t=>{e(e=>{e.userPacks=e.userPacks.filter(e=>e.id!==t)})},clearUserPacks:()=>{e(e=>{e.userPacks=[]})}}))),Bs=()=>{const e=As(e=>e.userPacks);return[...ks,...e]},Is=[null,"#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6b7280"],Fs={note:!0,instrument:!0,volume:!0,effect:!0,effect2:!0,flag1:!1,flag2:!1,cutoff:!1,resonance:!1,envMod:!1,pan:!1,probability:!1},Us={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0},Rs=97,js={harmonics:Array.from({length:32},(e,t)=>1/(t+1)),spectralTilt:0,evenOddBalance:0,filter:{type:"lowpass",cutoff:8e3,resonance:1},envelope:{attack:10,decay:300,sustain:70,release:200},lfo:{rate:2,depth:0,target:"pitch"},maxVoices:6},Xs={wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},zs={sampleUrl:"",grainSize:100,grainOverlap:50,playbackRate:1,detune:0,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:4,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}},Gs={type:"vfx",clock:16e6,romsLoaded:!1,registers:{}},Hs={type:"doc",clock:1e6,romsLoaded:!1,registers:{}},Ws={type:"swp30",clock:33868800,romsLoaded:!1,registers:{}},qs={moduleData:"",format:"UNKNOWN",useLibopenmpt:!0,repeatCount:0,stereoSeparation:100,interpolationFilter:0},Ks={volume:64,waveLength:3,filterLowerLimit:0,filterUpperLimit:0,filterSpeed:0,squareLowerLimit:32,squareUpperLimit:63,squareSpeed:1,vibratoDelay:0,vibratoSpeed:0,vibratoDepth:0,hardCutRelease:!1,hardCutReleaseFrames:0,envelope:{aFrames:1,aVolume:64,dFrames:1,dVolume:64,sFrames:1,rFrames:1,rVolume:0},performanceList:{speed:1,entries:[{note:0,waveform:2,fixed:!1,fx:[0,0],fxParam:[0,0]}]}},$s={type:"synth",waveType:0,waveSpeed:0,arpTable:new Array(16).fill(0),arpSpeed:0,attackVolume:64,decayVolume:32,sustainVolume:32,releaseVolume:0,attackSpeed:4,decaySpeed:4,sustainLength:16,releaseSpeed:4,vibratoDelay:0,vibratoSpeed:0,vibratoDepth:0,portamentoSpeed:0},Ys={type:"synth",waveform:1,pulseWidth:128,attack:2,decay:4,sustain:8,release:4,arpTable:new Array(8).fill(0),arpSpeed:0,vibDelay:0,vibSpeed:0,vibDepth:0,filterCutoff:255,filterResonance:0,filterMode:0},Js={wavetable:[0,2,4,6],waveBlend:0,waveSpeed:0,volume:64,arpTable:new Array(8).fill(0),arpSpeed:0,vibSpeed:0,vibDepth:0},Qs={waveNumber:0,synthTable:Array.from({length:16},()=>({waveNum:0,transposition:0,effect:0})),synthSpeed:1,atkLength:4,atkVolume:64,decLength:8,decVolume:32,sustVolume:32,relLength:8,vibDelay:0,vibSpeed:0,vibDepth:0,arpTable:new Array(16).fill(0)},Zs={envelopeVol:64,attackSpeed:1,attackVol:64,decaySpeed:1,decayVol:32,sustainTime:16,releaseSpeed:1,releaseVol:0,vibratoDelay:0,vibratoSpeed:0,vibratoDepth:0,arpeggio:new Array(16).fill(0),arpeggioLimit:0,arpeggioSpeed:1,pulseRateNeg:-1,pulseRatePos:1,pulseSpeed:4,pulsePosL:16,pulsePosH:48,pulseDelay:0,relative:1024},ea={sndSeqsCount:1,sndModSeqData:new Uint8Array(64),volModSeqData:new Uint8Array(64),sampleCount:0,sampleHeaders:new Uint8Array(0),sampleData:new Uint8Array(0)},ta={fseq:[0],vseq:[32,-31],volSpeed:1,vibSpeed:0,vibDepth:0,vibDelay:0},na={sampleLen:0,loopOffset:-1,sampleVolume:64,relative:256,divider:0,vibratoIdx:0,hiPos:0,loPos:0,vibTable:[],sampleData:[]},sa={arpeggio:new Array(16).fill(0),attackSpeed:8,attackMax:64,decaySpeed:4,decayMin:32,sustain:0,releaseSpeed:4,releaseMin:0,phaseShift:0,phaseSpeed:0,finetune:0,pitchFall:0,mainWave:[127,100,71,41,9,-22,-53,-82,-108,-127,-127,-127,-108,-82,-53,-22,9,41,71,100,127,100,71,41,9,-22,-53,-82,-108,-127,-127,-127],phaseWave:new Array(32).fill(0)},aa={volume:64,voltblSpeed:0,wfSpeed:0,vibratoSpeed:0,loopStart:0,loopLen:0,voltbl:new Uint8Array(128).fill(255),wftbl:new Uint8Array(128).fill(255),waveforms:[new Int8Array(256)]},oa={defaultVolume:64,relative:8364,vibratoSpeed:0,vibratoDepth:0,volseq:[64,-128,0],frqseq:[-128,0]},ra={voices:7,detune:30,mix:50,stereoSpread:80,envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},ia={voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100},portamento:0},la={drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:50,decay:"fast",harmonic:"third"},keyClick:30,vibrato:{type:"C3",depth:50},rotary:{enabled:!0,speed:"slow"}},ca={drumType:"kick",machineType:"909",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},snare:{pitch:220,pitchHigh:476,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},hihat:{tone:50,decay:100,metallic:50},clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},conga:{pitch:310,decay:180,tuning:50},cowbell:{decay:400,filterFreq:2640},rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450},maracas:{decay:30,filterFreq:5e3},cymbal:{tone:50,decay:2e3}},ua={channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop",swing:0}},da={pulseWidth:50,pwmDepth:30,pwmRate:2,pwmWaveform:"sine",oscillators:2,detune:10,envelope:{attack:50,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:4e3,resonance:20,envelopeAmount:30,keyTracking:50},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},ma={sections:{violin:100,viola:70,cello:50,bass:30},ensemble:{depth:60,rate:3,voices:4},attack:200,release:1e3,brightness:60},pa={A:{f1:800,f2:1200,f3:2500},E:{f1:400,f2:2e3,f3:2600},I:{f1:300,f2:2300,f3:3e3},O:{f1:500,f2:800,f3:2500},U:{f1:350,f2:600,f3:2400}},ha={mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},fa={machineType:"ArguruDistortion",parameters:{}},ga={vowel:"A",vowelMorph:{target:"O",amount:0,rate:1,mode:"manual"},oscillator:{type:"sawtooth"},formants:{...pa.A,bandwidth:100},envelope:{attack:50,decay:500,sustain:0,release:100},brightness:70},ba={VOL:0,ARP:1,DUTY:2,WAVE:3,PITCH:4,EX1:5,EX2:6,EX3:7,ALG:8,FB:9,FMS:10,AMS:11,PAN_L:12,PAN_R:13,PHASE_RESET:14,EX4:15,EX5:16,EX6:17,EX7:18,EX8:19,FMS2:20,AMS2:21},va={chipType:1,algorithm:4,feedback:4,fms:0,ams:0,fms2:0,ams2:0,ops:4,opllPreset:0,fixedDrums:!1,operators:[{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:50,ar:28,dr:6,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:10,d2r:4,sl:2,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:8,d2r:3,sl:3,rr:5,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0}],macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]},ya={algorithm:0,feedback:0,oscSync:!0,operators:Array.from({length:6},()=>({level:99,coarse:1,fine:0,detune:7,mode:"ratio",egRates:[99,99,99,99],egLevels:[99,99,99,0],breakPoint:0,leftDepth:0,rightDepth:0,leftCurve:0,rightCurve:0,rateScaling:0,ampModSens:0,velocitySens:0})),pitchEgRates:[99,99,99,99],pitchEgLevels:[50,50,50,50],lfoSpeed:35,lfoDelay:0,lfoPitchModDepth:0,lfoAmpModDepth:0,lfoSync:!1,lfoWave:"triangle",lfoPitchModSens:0,transpose:0,name:"INIT VOICE"},xa={osc1Waveform:"saw",osc1Octave:0,osc1Detune:0,osc1PulseWidth:.5,osc1Level:1,osc2Waveform:"saw",osc2Octave:0,osc2Detune:.1,osc2PulseWidth:.5,osc2Level:.7,oscSync:!1,oscXor:!1,filterCutoff:.7,filterResonance:.3,filterType:"lp24",filterEnvAmount:.5,filterKeyTrack:0,filterVelocity:.3,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:"sine",lfoDelay:0,lfoOscAmount:0,lfoFilterAmount:0,lfoAmpAmount:0,lfoPwAmount:0,masterVolume:.7,voices:8,unison:!1,unisonDetune:.1,portamento:0,panSpread:.3,velocitySensitivity:.5,noiseLevel:0,subOscLevel:0,subOscOctave:-1,drift:.02},Na={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1},wa={keymap:[],polyphony:"poly",maxVoices:8,noteCut:!1},Ea={enabled:!1,waveform:"sine",rate:5,sync:!1,syncDivision:"1/4",filterAmount:0,filterTarget:"cutoff",pitchAmount:0,volumeAmount:0,phase:0,retrigger:!0},ka={oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"square",rate:2,depth:100},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:1.5,wet:.1}},Da={text:"COMMODORE SIXTY FOUR",pitch:64,speed:72,mouth:128,throat:128,singmode:!0,phonetic:!1,vowelSequence:[],vowelLoopSingle:!0},Sa={moduleUrl:"",pluginState:null,pluginStateVersion:1,pluginStateTimestamp:0},Ma={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0,vowelSequence:[],vowelLoopSingle:!0},Ca={osc1:{mode:1,transpose:0,detune:0,color:64,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:10,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:-10,color:64,level:0},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:127,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:32},envelope2:{attack:0,decay:64,sustain:127,release:32},lfo1:{rate:64,depth:0}},Va={laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:40,ratio:2.5},noise:{amount:10,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:40},delay:{enabled:!0,time:.3,feedback:.5,wet:.4},reverb:{enabled:!0,decay:2,wet:.2}},Pa={oscillator:{type:"square",tune:200,fine:0},oscillator2:{enabled:!1,detune:0,mix:.5},noise:{enabled:!0,type:"white",mix:.2,color:100},filter:{cutoff:800,resonance:60,envMod:70,decay:200},lfo:{enabled:!1,rate:5,depth:0,target:"pitch"},envelope:{decay:300,sustain:0},sweep:{enabled:!0,amount:24,time:150}},_a={type:"sawtooth",detune:0,octave:0},Oa={attack:10,decay:500,sustain:0,release:100},Ta={type:"lowpass",frequency:2e3,Q:1,rolloff:-24},La={engineType:"db303",volume:1,oscillator:{type:"sawtooth",pulseWidth:0,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.5},accent:{amount:.5},slide:{time:.17,mode:"exponential"},overdrive:{amount:0},devilFish:{enabled:!0,normalDecay:.164,accentDecay:.006,softAttack:0,accentSoftAttack:.1,passbandCompensation:.09,resTracking:.257,filterInputDrive:.169,filterSelect:0,diodeCharacter:1,duffingAmount:.03,filterFmDepth:0,lpBpMix:0,filterTracking:0,stageNLAmount:0,ensembleAmount:0,korgEnabled:!1,oversamplingOrder:2,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{enabled:!1,waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:3,feedback:.3,tone:.5,mix:0,stereo:.5}},Aa={synthDefName:"",source:"SynthDef(\\mySynth, { |freq=440, amp=0.5, gate=1|\n  var sig = SinOsc.ar(freq) * amp;\n  var env = EnvGen.kr(Env.adsr(0.01, 0.1, 0.7, 0.5), gate, doneAction: 2);\n  Out.ar(0, (sig * env).dup);\n})",binary:"",params:[]},Ba=[{id:"straight",name:"Straight",category:"straight",description:"No groove, all rows on the grid",values:[0,0]},{id:"light-shuffle",name:"Light Shuffle",category:"shuffle",description:"Subtle rhythmic bounce (16th)",values:[0,8],velocityOffsets:[0,-.05]},{id:"medium-shuffle",name:"Medium Shuffle",category:"shuffle",description:"Classic bouncy shuffle feel",values:[0,16],velocityOffsets:[0,-.1]},{id:"heavy-shuffle",name:"Heavy Shuffle",category:"shuffle",description:"Strong triplet-style bounce",values:[0,25],velocityOffsets:[0,-.15]},{id:"triplet",name:"Full Triplet",category:"shuffle",description:"True 2:1 triplet timing (66%)",values:[0,33],velocityOffsets:[0,-.2]},{id:"mpc-50",name:"MPC 50%",category:"swing",description:"MPC straight (no swing)",values:[0,0]},{id:"mpc-54",name:"MPC 54%",category:"swing",description:"MPC light swing",values:[0,8],velocityOffsets:[0,-.08]},{id:"mpc-58",name:"MPC 58%",category:"swing",description:"MPC medium swing",values:[0,16],velocityOffsets:[0,-.12]},{id:"mpc-62",name:"MPC 62%",category:"swing",description:"MPC heavy swing",values:[0,25],velocityOffsets:[0,-.18]},{id:"mpc-66",name:"MPC 66%",category:"swing",description:"MPC maximum swing",values:[0,33],velocityOffsets:[0,-.25]},{id:"funk-16th",name:"Funk 16th",category:"funk",description:"16th note funk groove",values:[0,5,-3,10],velocityOffsets:[.1,-.2,.05,-.3],suggestedBpmRange:[90,130]},{id:"funk-lazy",name:"Lazy Funk",category:"funk",description:"Relaxed funk feel, everything slightly late",values:[3,8,5,12],velocityOffsets:[.05,-.1,.05,-.15],suggestedBpmRange:[80,110]},{id:"funk-tight",name:"Tight Funk",category:"funk",description:"Rushed funk feel, snappy timing",values:[-2,5,-5,8],velocityOffsets:[.15,-.15,.1,-.2],suggestedBpmRange:[100,140]},{id:"boom-bap",name:"Boom Bap",category:"hip-hop",description:"Classic 90s hip-hop swing",values:[0,12,0,8],velocityOffsets:[.1,-.15,.05,-.1],suggestedBpmRange:[85,100]},{id:"lo-fi",name:"Lo-Fi",category:"hip-hop",description:"Drunk/loose timing for lo-fi beats",values:[5,15,-3,18],velocityOffsets:[-.05,-.2,-.1,-.25],suggestedBpmRange:[70,95]},{id:"trap-triplet",name:"Trap Triplet",category:"hip-hop",description:"Triplet hi-hat groove for trap",values:[0,22,11,33,0,22],velocityOffsets:[.1,-.2,-.1,-.3,.05,-.25],suggestedBpmRange:[130,160]},{id:"drunken",name:"Drunken Master",category:"custom",description:"Irregular timing for experimental feel",values:[0,8,-5,15,3,20,-8,12],velocityOffsets:[0,-.1,.05,-.2,.1,-.15,.05,-.3]},{id:"push-pull",name:"Push-Pull",category:"custom",description:"Alternating early/late for tension",values:[-10,10,-10,10],velocityOffsets:[.1,-.1,.1,-.1]},{id:"elastic",name:"Elastic",category:"custom",description:"Cosine swell  heavy at steps 1 & 16, rushing at step 8. Smooth loop.",values:[20,18,13,6,-2,-10,-16,-20,-20,-16,-10,-2,6,13,18,20],velocityOffsets:[.1,.09,.07,.03,-.01,-.05,-.08,-.1,-.1,-.08,-.05,-.01,.03,.07,.09,.1]}];function Ia(e,t,n){if(!e.values||0===e.values.length)return 0;const s=t%e.values.length;return e.values[s]/100*n}function Fa(e,t){if(!e.velocityOffsets||0===e.velocityOffsets.length)return 0;const n=t%e.velocityOffsets.length;return e.velocityOffsets[n]}function Ua(e,t,n="linear",s="curve"){if(0===e.length)return null;let a=null,o=null;for(let r=0;r<e.length;r++)if(e[r].row<=t&&(a=e[r]),e[r].row>=t){o=e[r];break}if(a&&a.row===t)return a.value;if(o&&o.row===t)return o.value;if(!a&&o)return o.value;if(a&&!o)return a.value;if("steps"===s)return a?a.value:null;if(a&&o){const e=(t-a.row)/(o.row-a.row),s=o.value-a.value;switch(n){case"linear":default:return a.value+s*e;case"exponential":return a.value+s*(e*e);case"easeIn":return a.value+s*(e*e*e);case"easeOut":{const t=1-e;return a.value+s*(1-t*t*t)}case"easeBoth":if(e<.5)return a.value+s*(4*e*e*e);{const t=2*e-2;return a.value+s*(1+t*t*t/2)}}}return null}const Ra=[{id:"ramp-up",name:"Ramp Up",shape:"rampUp",points:[{row:0,value:0},{row:63,value:1}]},{id:"ramp-down",name:"Ramp Down",shape:"rampDown",points:[{row:0,value:1},{row:63,value:0}]},{id:"triangle",name:"Triangle",shape:"triangle",points:[{row:0,value:0},{row:31,value:1},{row:63,value:0}]},{id:"sine",name:"Sine Wave",shape:"sine",points:Array.from({length:64},(e,t)=>({row:t,value:(Math.sin(t/64*Math.PI*2)+1)/2}))}];(new Date).toISOString(),(new Date).toISOString();const ja=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Xa(e){if(null===e||""===e||"..."===e)return 0;if("==="===e||"OFF"===e)return 97;const t=e.match(/^([A-G])([#-])[-]?(\d)$/);if(!t)return 0;const[,n,s,a]=t,o=parseInt(a,10),r=n+s,i=ja.indexOf(r);if(-1===i)return 0;const l=12*o+i+1;return l<1||l>96?0:l}const za=new Array(98);za[0]="...",za[97]="===";for(let _0=1;_0<=96;_0++){const e=_0-1,t=Math.floor(e/12),n=e%12;za[_0]=`${ja[n]}${t}`}function Ga(e){return za[e]||"..."}const Ha={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,K:20,L:21,P:25,R:27,T:29,X:33},Wa=Object.fromEntries(Object.entries(Ha).map(([e,t])=>[t,e]));function qa(e){if(!e||"..."===e||"000"===e)return[0,0];const t=e.match(/^([0-9A-Z])([0-9A-F]{2})$/i);if(!t)return[0,0];const[,n,s]=t;return[Ha[n.toUpperCase()]??0,parseInt(s,16)]}const Ka=new Array(256);for(let _0=0;_0<256;_0++)Ka[_0]=_0.toString(16).toUpperCase().padStart(2,"0");function $a(e,t){if(0===e&&0===t)return"...";return`${Wa[e]??"0"}${Ka[t]??"00"}`}const Ya=new Array(98).fill(null);for(let _0=1;_0<=96;_0++){const e=_0-1,t=Math.floor(e/12),n=e%12;Ya[_0]=`${ja[n].replace("-","")}${t}`}function Ja(e){return e<1||e>96?null:Ya[e]}function Qa(e){return 0===e||97===e||e<1||e>96?null:e+11}function Za(e){const t=e-11;return Math.min(96,Math.max(1,t))}function eo(e){if(!e||"object"!=typeof e)return!1;const t=e;if(!t.output||"object"!=typeof t.output)return!1;const n=t.output,s="function"==typeof n.connect&&"function"==typeof n.disconnect&&"number"==typeof n.numberOfOutputs&&"function"!=typeof n.toDestination,a="function"==typeof t.toDestination;return s&&!a}const to=globalThis,no=to.BaseAudioContext||to.AudioContext||to.webkitAudioContext;let so=null;function ao(e){so=e}function oo(){if(!so)throw new Error("[audio-context] AudioContext not initialized  ToneEngine must be created first");return so}function ro(e){if(!e)throw new Error("[audio-context] getNativeContext called with null/undefined context");if(no&&e instanceof no)return e;const t=[e],n=new Set;let s=0;for(;t.length>0&&s<50;){const e=t.shift();if(e&&!n.has(e)){if(n.add(e),s++,no&&e instanceof no)return e;e.rawContext&&t.push(e.rawContext),e._nativeAudioContext&&t.push(e._nativeAudioContext),e.nativeContext&&t.push(e.nativeContext),e.baseAudioContext&&t.push(e.baseAudioContext),e.context&&t.push(e.context),e._context&&t.push(e._context)}}return e}function io(e){if(!e||"object"!=typeof e)return!1;const t=to.AudioNode;if(t&&e instanceof t){const t=e;return!("function"==typeof t.toDestination||"function"==typeof t.toMaster)}return!1}function lo(e){return e&&"object"==typeof e?io(e)?e:e._nativeAudioNode&&io(e._nativeAudioNode)?e._nativeAudioNode:null:null}function co(e){if(!e)return null;if(io(e))return e;const t=[e.input,e.output,e._gainNode,e._node,e._input,e._output,e._nativeNode,e._nativeAudioNode];for(const n of t){const e=lo(n);if(e)return e}if(e.input&&"object"==typeof e.input){const t=e.input,n=[t._gainNode,t._node,t.input,t._nativeAudioNode];for(const e of n){const t=lo(e);if(t)return t}}return null}const uo=/^([A-Ga-g])([#b]?)(-?\d+)$/,mo={C:0,D:2,E:4,F:5,G:7,A:9,B:11};function po(e){if("number"==typeof e)return Math.max(0,Math.min(127,Math.round(12*Math.log2(e/440)+69)));const t=e.match(uo);if(!t)return 60;const[,n,s,a]=t,o=mo[n.toUpperCase()]??0,r="#"===s?1:"b"===s?-1:0,i=parseInt(a);return Math.max(0,Math.min(127,12*(i+1)+o+r))}function ho(e){if("number"==typeof e)return e>=0&&e<=127&&Number.isInteger(e)?440*Math.pow(2,(e-69)/12):e;const t=po(e);return 440*Math.pow(2,(t-69)/12)}function fo(){return so?so.currentTime:0}function go(e,t=120){if("number"==typeof e)return e;const n=e.match(/^(\d+)n$/);if(n){return 4/parseInt(n[1])*(60/t)}const s=parseFloat(e);return isNaN(s)?0:s}const bo=Object.freeze(Object.defineProperty({__proto__:null,audioNow:fo,getDevilboxAudioContext:oo,getNativeAudioNode:co,getNativeContext:ro,noteToFrequency:ho,noteToMidi:po,setDevilboxAudioContext:ao,timeToSeconds:go},Symbol.toStringTag,{value:"Module"})),vo="cutoff",yo="cutoffHz",xo="resonance",No="envMod",wo="envModPercent",Eo="decay",ko="accent",Do="waveform",So="pulseWidth",Mo="pitchToPw",Co="subOscGain",Vo="subOscBlend",Po="normalDecay",_o="accentDecay",Oo="softAttack",To="accentSoftAttack",Lo="passbandCompensation",Ao="resTracking",Bo="filterInputDrive",Io="filterSelect",Fo="diodeCharacter",Uo="duffingAmount",Ro="filterFmDepth",jo="korgIbiasScale",Xo="korgBite",zo="korgClip",Go="korgCrossmod",Ho="korgQSag",Wo="korgSharpness",qo="korgWarmth",Ko="korgStiffness",$o="korgFilterFm",Yo="lpBpMix",Jo="filterTracking",Qo="stageNLAmount",Zo="ensembleAmount",er="slideTime",tr="lfoRate",nr="lfoContour",sr="lfoPitchDepth",ar="lfoPwmDepth",or="lfoFilterDepth",rr="lfoStiffDepth",ir="chorusMix",lr="phaserLfoRate",cr="phaserLfoWidth",ur="phaserFeedback",dr="phaserMix",mr="delayTime",pr="delayFeedback",hr="delayTone",fr="delayMix",gr="delaySpread",br="tuning",vr="volume",yr="lfoWaveform",xr="chorusMode",Nr="oversamplingOrder";function wr(){return"undefined"!=typeof window&&!!window.DB303_TRACE}class Er{name="DB303Synth";output;workletNode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;overdrive=null;overdriveGain=null;overdriveAmount=0;config={};audioContext;_disposed=!1;_initPromise;_resolveInit=null;_pendingParams=[];_releaseTimeout=null;_lastOversamplingOrder=void 0;_lastFilterSelect=void 0;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{if(await Er.ensureInitialized(this.audioContext),this._disposed)return;this.createNode()}catch(e){}}static wasmBinary=null;static jsCode=null;static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/db303/DB303.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/db303/DB303.wasm"),fetch("/db303/DB303.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar DB303 = createDB303Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){if(this._disposed)return;const e=this.audioContext;if(this.workletNode=new AudioWorkletNode(e,"db303-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?this._resolveInit&&(this._resolveInit(),this._resolveInit=null):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Er.wasmBinary,jsCode:Er.jsCode}),this._pendingParams.length>0){for(const{paramId:e,value:t}of this._pendingParams)this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t});this._pendingParams=[]}this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch{}}_savedSlideTime=.5;_currentSlideTime=.5;triggerAttack(e,t,n=1,s=!1,a=!1,o=!1){if(!this.workletNode||this._disposed)return;null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null);const r="string"==typeof e?po(e):Math.round(12*Math.log2(e/440)+69);let i=Math.floor(127*n);if(s&&i<100&&(i=127),!s&&i>=100&&(i=99),"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=Math.floor(r/12)-1;e[r%12]}o&&(this._savedSlideTime=this._currentSlideTime,this.setSlideTime(0));const l=t??fo();this.workletNode.port.postMessage({type:"noteOn",time:l,note:r,velocity:i,slide:a}),o&&setTimeout(()=>{this._disposed||this.setSlideTime(this._savedSlideTime)},50)}triggerRelease(e){if(!this.workletNode||this._disposed)return;const t=e??fo();this.workletNode.port.postMessage({type:"gateOff",time:t})}releaseAll(){this.workletNode&&!this._disposed&&(null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode.port.postMessage({type:"allNotesOff"}))}noteOn(e,t,n,s){const a=ho(e);this.triggerAttack(a,void 0,t/127,n,s,!1)}noteOff(){this.triggerRelease()}triggerAttackRelease(e,t,n,s,a=!1,o=!1,r=!1){if(this._disposed)return;const i=n??fo();this.triggerAttack(e,i,s||1,a,o,r);const l=1e3*(i+go(t)-fo());null!==this._releaseTimeout&&clearTimeout(this._releaseTimeout),this._releaseTimeout=setTimeout(()=>{this._releaseTimeout=null,this._disposed||this.triggerRelease()},Math.max(0,l))}setParameterByName(e,t){if(!this._disposed){if(!this.workletNode){const n=this._pendingParams.findIndex(t=>t.paramId===e);return void(n>=0?this._pendingParams[n].value=t:this._pendingParams.push({paramId:e,value:t}))}wr(),this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}}set(e,t){switch(wr(),e){case"cutoff":this.setCutoff(t);break;case"resonance":this.setResonance(t);break;case"envMod":this.setEnvMod(t);break;case"decay":this.setDecay(t);break;case"accent":this.setAccent(t);break;case"tuning":this.setTuning(t);break;case"volume":this.setVolume(t);break;case"waveform":this.setWaveform(t);break;case"slideTime":this.setSlideTime(t);break;case"overdrive":this.setOverdrive(t);break;case"pulseWidth":this.setPulseWidth(t);break;case"subOscGain":this.setSubOscGain(t);break;case"subOscBlend":this.setSubOscBlend(t);break;case"pitchToPw":this.setPitchToPw(t);break;case"normalDecay":this.setNormalDecay(t);break;case"accentDecay":this.setAccentDecay(t);break;case"softAttack":this.setSoftAttack(t);break;case"accentSoftAttack":this.setAccentSoftAttack(t);break;case"filterTracking":this.setFilterTracking(t);break;case"filterFmDepth":this.setFilterFmDepth(t),this.setKorgFilterFm(t);break;case"filterInputDrive":this.setFilterInputDrive(t);break;case"passbandCompensation":this.setPassbandCompensation(1-t);break;case"resTracking":this.setResTracking(1-t),this.setKorgIbiasScale(.1+3.9*t);break;case"diodeCharacter":this.setDiodeCharacter(t),this.setKorgWarmth(t);break;case"duffingAmount":{this.setDuffingAmount(t);const e=Math.abs(t)<.16?0:(t>0?1:-1)*(Math.abs(t)-.16)/.84;this.setKorgStiffness(e);break}case"lpBpMix":this.setLpBpMix(t);break;case"korgBite":this.setKorgBite(t);break;case"korgClip":this.setKorgClip(t);break;case"korgCrossmod":this.setKorgCrossmod(t);break;case"korgQSag":this.setKorgQSag(t);break;case"korgSharpness":this.setKorgSharpness(t);break;case"stageNLAmount":this.setStageNLAmount(t);break;case"ensembleAmount":this.setEnsembleAmount(t);break;case"lfoRate":this.setLfoRate(t);break;case"lfoContour":this.setLfoContour(t);break;case"lfoPitchDepth":this.setLfoPitchDepth(t);break;case"lfoPwmDepth":this.setLfoPwmDepth(t);break;case"lfoFilterDepth":this.setLfoFilterDepth(t);break;case"lfoStiffDepth":this.setLfoStiffDepth(t);break;case"phaserRate":this.setPhaserRate(t);break;case"phaserWidth":this.setPhaserWidth(t);break;case"phaserFeedback":this.setPhaserFeedback(t);break;case"phaserMix":this.setPhaserMix(t);break;case"delayTime":this.setDelayTime(t);break;case"delayFeedback":this.setDelayFeedback(t);break;case"delayTone":this.setDelayTone(t);break;case"delayMix":this.setDelayMix(t);break;case"delaySpread":this.setDelaySpread(t);break;case"filterSelect":this.setFilterSelect(t);break;case"chorusMode":this.setChorusMode(t);break;case"chorusMix":this.setChorusMix(t);break;case"lfoWaveform":this.setLfoWaveform(t);break;case"oversamplingOrder":this.setOversamplingOrder(t);break;case"vegDecay":this.setVegDecay(t);break;case"vegSustain":this.setVegSustain(t);break;case"filterFM":this.setFilterFmDepth(t)}}setCutoff(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(vo,t)}setResonance(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(xo,t)}setEnvMod(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(No,t)}setDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Eo,t),this.setParameterByName("normalDecay",t)}setAccent(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ko,t)}setAccentAmount(e){this.setAccent(e)}setSlideTime(e){const t=Math.max(0,Math.min(1,e));this._currentSlideTime=e,this.setParameterByName(er,t)}setVolume(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(vr,t)}setWaveform(e){this.setParameterByName(Do,e)}setTuning(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(br,t)}setLfoWaveform(e){this.setParameterByName(yr,e)}setLfoRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(tr,t)}setLfoContour(e){this.setParameterByName(nr,e)}setLfoPitchDepth(e){this.setParameterByName(sr,e)}setLfoPwmDepth(e){this.setParameterByName(ar,e)}setLfoFilterDepth(e){this.setParameterByName(or,e)}setLfoStiffDepth(e){this.setParameterByName(rr,e)}setNormalDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Po,t)}setAccentDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(_o,t)}setSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Oo,t)}setAccentSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(To,t)}setPassbandCompensation(e){this.setParameterByName(Lo,e)}setFeedbackHighpass(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName("feedbackHighpass",t)}setResTracking(e){this.setParameterByName(Ao,e)}setFilterInputDrive(e){this.setParameterByName(Bo,e)}setFilterSelect(e){e!==this._lastFilterSelect&&(this._lastFilterSelect=e,this.setParameterByName(Io,e))}setDiodeCharacter(e){this.setParameterByName(Fo,e)}setDuffingAmount(e){let t;if(Math.abs(e)<.16)t=0;else{t=(e>0?1:-1)*(Math.abs(e)-.16)/.84}this.setParameterByName(Uo,t)}setFilterFmDepth(e){this.setParameterByName(Ro,e)}setLpBpMix(e){this.setParameterByName(Yo,e)}setFilterTracking(e){this.setParameterByName(Jo,e)}setKorgWarmth(e){this.setParameterByName(qo,e)}setKorgStiffness(e){this.setParameterByName(Ko,e)}setKorgFilterFm(e){this.setParameterByName($o,e)}setKorgIbiasScale(e){this.setParameterByName(jo,e)}setKorgBite(e){this.setParameterByName(Xo,e)}setKorgClip(e){this.setParameterByName(zo,e)}setKorgCrossmod(e){this.setParameterByName(Go,e)}setKorgQSag(e){this.setParameterByName(Ho,e)}setKorgSharpness(e){this.setParameterByName(Wo,e)}setPitchToPw(e){this.setParameterByName(Mo,e)}setCutoffHz(e){this.setParameterByName(yo,Math.max(10,Math.min(5e3,e)))}setEnvModPercent(e){this.setParameterByName(wo,Math.max(0,Math.min(300,e)))}setStageNLAmount(e){this.setParameterByName(Qo,e)}setEnsembleAmount(e){this.setParameterByName(Zo,e)}setChorusMode(e){this.setParameterByName(xr,e)}setOversamplingOrder(e){e!==this._lastOversamplingOrder&&(this._lastOversamplingOrder=e,this.setParameterByName(Nr,e))}setPulseWidth(e){this.setParameterByName(So,e)}setSubOscGain(e){this.setParameterByName(Co,e)}setSubOscBlend(e){this.setParameterByName(Vo,e)}setChorusMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ir,t)}setPhaserRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(lr,t)}setPhaserWidth(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(cr,t)}setPhaserFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ur,t)}setPhaserMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(dr,t)}setDelayTime(e){const t=Math.max(0,Math.min(16,e));this.setParameterByName(mr,t)}setDelayFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(pr,t)}setDelayTone(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(hr,t)}setDelayMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(fr,t)}setDelaySpread(e){this.setParameterByName(gr,e)}setOverdrive(e){if(this._disposed||!this.workletNode)return;this.overdriveAmount=Math.max(0,Math.min(1,e));const t=this.audioContext.currentTime;if(this.overdriveAmount>0){this.overdrive&&this.overdriveGain||(this.overdriveGain=this.audioContext.createGain(),this.overdrive=this.audioContext.createWaveShaper());const e=new Float32Array(4096),n=1+8*this.overdriveAmount;for(let t=0;t<4096;t++){const s=t/4096*2-1;e[t]=Math.tanh(s*n)/Math.tanh(n)}this.overdrive.curve=e,this.overdriveGain.gain.linearRampToValueAtTime(1+2*this.overdriveAmount,t+.03);try{this.workletNode.disconnect(this.output)}catch{}try{this.workletNode.connect(this.overdriveGain),this.overdriveGain.connect(this.overdrive),this.overdrive.connect(this.output)}catch{}}else{if(this.overdrive&&this.overdriveGain){try{this.workletNode.disconnect(this.overdriveGain),this.overdriveGain.disconnect(this.overdrive),this.overdrive.disconnect(this.output)}catch{}this.overdriveGain.gain.linearRampToValueAtTime(1,t+.03)}try{this.workletNode.connect(this.output)}catch{}}}setVegDecay(e){}setVegSustain(e){}setFilterFM(e){this.setFilterFmDepth(e/100)}setMuffler(e){switch(e){case"soft":this.setOverdrive(.15);break;case"hard":this.setOverdrive(.45);break;case"dark":this.setOverdrive(.3);break;case"mid":this.setOverdrive(.25);break;case"bright":this.setOverdrive(.35);break;default:this.setOverdrive(0)}}setSweepSpeed(e){}setHighResonanceEnabled(e){}setAccentSweepEnabled(e){}setChorusEnabled(e){e||this.setParameterByName(ir,0)}setPhaserEnabled(e){e||this.setParameterByName(dr,0)}setPhaserDepth(e){this.setParameterByName(cr,e)}setDelayEnabled(e){e||this.setParameterByName(fr,0)}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}enableDevilFish(e){}setHighResonance(e){}applyConfig(e){const t=e.devilFish;if(wr()){Object.keys(e).filter(t=>void 0!==e[t])}if(void 0!==e.tuning&&this.setTuning(e.tuning),void 0!==e.volume&&this.setVolume(e.volume),e.filter){if(e.devilFish?.extendedCutoff){const t=10*Math.pow(500,e.filter.cutoff);this.setCutoffHz(t)}else this.setCutoff(e.filter.cutoff);this.setResonance(e.filter.resonance)}if(e.filterEnvelope&&(e.devilFish?.extendedEnvMod?this.setEnvModPercent(300*e.filterEnvelope.envMod):this.setEnvMod(e.filterEnvelope.envMod),this.setDecay(e.filterEnvelope.decay)),e.accent&&this.setAccent(e.accent.amount),e.slide&&this.setSlideTime(e.slide.time),e.overdrive&&this.setOverdrive(e.overdrive.amount),e.oscillator){const t=void 0!==e.oscillator.waveformBlend?e.oscillator.waveformBlend:"square"===e.oscillator.type?1:0;this.setWaveform(t),void 0!==e.oscillator.pulseWidth&&this.setPulseWidth(e.oscillator.pulseWidth),void 0!==e.oscillator.subOscGain&&this.setSubOscGain(e.oscillator.subOscGain),void 0!==e.oscillator.subOscBlend&&this.setSubOscBlend(e.oscillator.subOscBlend),void 0!==e.oscillator.pitchToPw&&this.setPitchToPw(e.oscillator.pitchToPw)}if(t){if(this.enableDevilFish(!0),void 0!==t.oversamplingOrder&&this.setOversamplingOrder(t.oversamplingOrder),void 0!==t.filterSelect&&this.setFilterSelect(t.filterSelect),void 0!==t.filterTracking&&this.setFilterTracking(t.filterTracking),void 0!==t.filterFmDepth&&(this.setFilterFmDepth(t.filterFmDepth),this.setKorgFilterFm(t.filterFmDepth)),void 0!==t.filterInputDrive&&this.setFilterInputDrive(t.filterInputDrive),void 0!==t.passbandCompensation&&this.setPassbandCompensation(1-t.passbandCompensation),void 0!==t.resTracking&&(this.setResTracking(1-t.resTracking),this.setKorgIbiasScale(.1+3.9*t.resTracking)),void 0!==t.duffingAmount){this.setDuffingAmount(t.duffingAmount);const e=t.duffingAmount,n=Math.abs(e)<.16?0:(e>0?1:-1)*(Math.abs(e)-.16)/.84;this.setKorgStiffness(n)}void 0!==t.lpBpMix&&this.setLpBpMix(t.lpBpMix),void 0!==t.diodeCharacter&&(this.setDiodeCharacter(t.diodeCharacter),this.setKorgWarmth(t.diodeCharacter)),void 0!==t.stageNLAmount&&this.setStageNLAmount(t.stageNLAmount),void 0!==t.ensembleAmount&&this.setEnsembleAmount(t.ensembleAmount)}t&&(void 0!==t.normalDecay&&this.setNormalDecay(t.normalDecay),void 0!==t.accentDecay&&this.setAccentDecay(t.accentDecay),void 0!==t.softAttack&&this.setSoftAttack(t.softAttack),void 0!==t.accentSoftAttack&&this.setAccentSoftAttack(t.accentSoftAttack),void 0!==t.muffler&&this.setMuffler(t.muffler),void 0!==t.sweepSpeed&&this.setSweepSpeed(t.sweepSpeed),void 0!==t.highResonance&&this.setHighResonanceEnabled(t.highResonance)),t?.korgEnabled?(void 0!==t.korgBite&&this.setKorgBite(t.korgBite),void 0!==t.korgClip&&this.setKorgClip(t.korgClip),void 0!==t.korgCrossmod&&this.setKorgCrossmod(t.korgCrossmod),void 0!==t.korgQSag&&this.setKorgQSag(t.korgQSag),void 0!==t.korgSharpness&&this.setKorgSharpness(t.korgSharpness)):t&&(this.setKorgBite(0),this.setKorgClip(0),this.setKorgCrossmod(0),this.setKorgQSag(0),this.setKorgSharpness(.5));const n=e.lfo;n?.enabled?(void 0!==n.waveform&&this.setLfoWaveform(n.waveform),void 0!==n.rate&&this.setLfoRate(n.rate),void 0!==n.contour&&this.setLfoContour(n.contour),void 0!==n.pitchDepth&&this.setLfoPitchDepth(n.pitchDepth),void 0!==n.pwmDepth&&this.setLfoPwmDepth(n.pwmDepth),void 0!==n.filterDepth&&this.setLfoFilterDepth(n.filterDepth),void 0!==n.stiffDepth&&this.setLfoStiffDepth(n.stiffDepth)):(this.setLfoRate(0),this.setLfoPitchDepth(0),this.setLfoPwmDepth(0),this.setLfoFilterDepth(0),this.setLfoStiffDepth(0)),e.chorus&&(void 0!==e.chorus.mode&&this.setChorusMode(e.chorus.mode),this.setChorusMix(e.chorus.enabled?e.chorus.mix??0:0)),e.phaser&&(void 0!==e.phaser.rate&&this.setPhaserRate(e.phaser.rate),void 0!==e.phaser.depth&&this.setPhaserWidth(e.phaser.depth),void 0!==e.phaser.feedback&&this.setPhaserFeedback(e.phaser.feedback),this.setPhaserMix(e.phaser.enabled?e.phaser.mix??0:0)),e.delay&&(void 0!==e.delay.time&&this.setDelayTime(e.delay.time),void 0!==e.delay.feedback&&this.setDelayFeedback(e.delay.feedback),void 0!==e.delay.tone&&this.setDelayTone(e.delay.tone),this.setDelayMix(e.delay.enabled?e.delay.mix??0:0),void 0!==e.delay.stereo&&this.setDelaySpread(e.delay.stereo))}getDiagnostics(){return new Promise(e=>{if(!this.workletNode)return void e({});const t=n=>{"diagnostics"===n.data.type&&(this.workletNode?.port.removeEventListener("message",t),e(n.data))};this.workletNode.port.addEventListener("message",t),this.workletNode.port.postMessage({type:"getDiagnostics"}),setTimeout(()=>e({}),500)})}dispose(){this._disposed=!0,null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveGain&&(this.overdriveGain.disconnect(),this.overdriveGain=null),this.output.disconnect()}}const kr="vfx",Dr="rsa",Sr="swp30",Mr={vfx:0,doc:1,rsa:2,swp30:3,segapcm:4,ga20:5,upd933:6};class Cr{static instance;module=null;isInitialized=!1;heapU8=null;constructor(){}static getInstance(){return Cr.instance||(Cr.instance=new Cr),Cr.instance}async init(){if(this.isInitialized)return;try{const e=await fetch("/mame/MAMEChips.js"),t=await e.text(),n=new Function(`${t}; return MAMEChips;`)(),s=await fetch("/mame/MAMEChips.wasm"),a=await s.arrayBuffer();this.module=await n({wasmBinary:a}),this.module&&this.module.wasmMemory&&(this.heapU8=new Uint8Array(this.module.wasmMemory.buffer)),this.isInitialized=!0}catch(e){throw new Error(`MAMEChips WASM failed to load: ${e}`)}}createInstance(e,t){if(!this.isInitialized||!this.module)return 0;const n=Mr[e];return this.module._mame_create_instance(n,t)}deleteInstance(e){this.isInitialized&&0!==e&&this.module&&this.module._mame_delete_instance(e)}write(e,t,n){this.isInitialized&&0!==e&&this.module&&this.module._mame_write(e,t,n)}write16(e,t,n){this.isInitialized&&0!==e&&this.module&&this.module._mame_write16(e,t,n)}read(e,t){return this.isInitialized&&0!==e&&this.module?this.module._mame_read(e,t):0}setRom(e,t){if(!this.isInitialized||!this.heapU8||!this.module)return;const n=this.module._malloc(t.length);this.heapU8.set(t,n),this.module._mame_set_rom(e,n,t.length)}addMidiEvent(e,t){if(!this.isInitialized||0===e||!this.heapU8||!this.module)return;const n=this.module._malloc(t.length);this.heapU8.set(t,n),this.module._mame_add_midi_event(e,n,t.length),this.module._free(n)}rsaLoadRoms(e,t,n,s){if(!this.isInitialized||0===e||!this.heapU8||!this.module)return;const a=this.module._malloc(t.length),o=this.module._malloc(n.length),r=this.module._malloc(s.length);this.heapU8.set(t,a),this.heapU8.set(n,o),this.heapU8.set(s,r),this.module._rsa_load_roms(e,a,o,r)}render(e,t=128){if(!this.isInitialized||0===e||!this.module||!this.module.wasmMemory)return{left:new Float32Array(t),right:new Float32Array(t)};const n=this.module._malloc(4*t),s=this.module._malloc(4*t);this.module._mame_render(e,n,s,t);const a=this.module.wasmMemory.buffer,o=new Float32Array(a,n,t).slice(),r=new Float32Array(a,s,t).slice();return this.module._free(n),this.module._free(s),{left:o,right:r}}}class Vr{name="MAMESynth";output;engine=Cr.getInstance();config;isInitialized=!1;initInProgress=!1;handle=0;voices=[];numHardwareVoices=32;constructor(e){this.output=oo().createGain(),this.config=e,"rsa"===e.type?this.numHardwareVoices=16:"swp30"===e.type&&(this.numHardwareVoices=64);for(let t=0;t<this.numHardwareVoices;t++)this.voices.push({note:"",active:!1,voiceIndex:t,startTime:0});this.initEngine()}async ensureInitialized(){if(!this.isInitialized)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.isInitialized&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.isInitialized){this.initInProgress=!0;try{await this.engine.init();let e=16e6;"rsa"===this.config.type?e=2e7:"swp30"===this.config.type&&(e=33868800);const t=this.config.clock||e;if(this.handle=this.engine.createInstance(this.config.type,t),this.config.roms)for(const n of this.config.roms)this.engine.setRom(n.bank,n.data);this.isInitialized=!0,"vfx"===this.config.type&&(this.engine.write(this.handle,88,31),this.engine.write(this.handle,96,1)),this.startRendering()}catch(e){}finally{this.initInProgress=!1}}}startRendering(){const e=oo();if(!e||!e.createScriptProcessor)return;const t=e.createScriptProcessor(512,0,2);t.onaudioprocess=e=>{if(!this.isInitialized||0===this.handle)return;const t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1),{left:s,right:a}=this.engine.render(this.handle,512);t.set(s),n.set(a)},t.connect(this.output)}getHandle(){return this.handle}write(e,t){this.isInitialized&&0!==this.handle&&this.engine.write(this.handle,e,t)}write16(e,t){this.isInitialized&&0!==this.handle&&this.engine.write16(this.handle,e,t)}read(e){return this.isInitialized&&0!==this.handle?this.engine.read(this.handle,e):0}findFreeVoice(){const e=this.voices.find(e=>!e.active);return e||this.voices.sort((e,t)=>e.startTime-t.startTime)[0]}triggerAttack(e,t,n=1){if(!this.isInitialized||0===this.handle)return this;const s=ho(e),a=this.findFreeVoice();a.note=e,a.active=!0,a.startTime=Date.now();const o=a.voiceIndex;if("vfx"===this.config.type){this.engine.write(this.handle,120,o),this.engine.write16(this.handle,0,1);const e=44100,t=Math.floor(2048*s*32/e);this.engine.write16(this.handle,8,65535&t),this.engine.write(this.handle,10,t>>16&255),this.engine.write16(this.handle,136,0),this.engine.write16(this.handle,144,8192);const a=Math.floor(65535*n);this.engine.write16(this.handle,16,a),this.engine.write16(this.handle,0,0)}else if("doc"===this.config.type){this.engine.write(this.handle,224,0),this.engine.write(this.handle,0+o,0);const e=Math.floor(65536*s/1e3);this.engine.write(this.handle,0+o,255&e),this.engine.write(this.handle,32+o,e>>8&255),this.engine.write(this.handle,64+o,Math.floor(255*n)),this.engine.write(this.handle,128+o,0)}else if("rsa"===this.config.type){const e=Math.floor(16384*s/32e3);for(let t=0;t<10;t++){const n=256*o+16*t;this.engine.write(this.handle,n+0,255&e),this.engine.write(this.handle,n+1,e>>8&255),this.engine.write(this.handle,n+5,127)}}else if("swp30"===this.config.type){const e=o<<6,t=Math.floor(1024*s/44100);this.engine.write16(this.handle,10|e,t)}return this}triggerRelease(e,t){if(!this.isInitialized||0===this.handle)return this;const n=this.voices.find(t=>t.active&&t.note===e);if(!n)return this;n.active=!1;const s=n.voiceIndex;if("vfx"===this.config.type)this.engine.write(this.handle,120,s),this.engine.write16(this.handle,0,1);else if("doc"===this.config.type)this.engine.write(this.handle,128+s,1);else if("rsa"===this.config.type)for(let a=0;a<10;a++){const e=256*s+16*a;this.engine.write(this.handle,e+5,255)}return this}releaseAll(){if(this.isInitialized&&0!==this.handle)for(const e of this.voices.filter(e=>e.active))this.triggerRelease(e.note)}dispose(){0!==this.handle&&(this.engine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const Pr=new Map,_r=new WeakMap,Or=`?t=${Date.now()}`;function Tr(e,t){return e.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory').replace(/new\s+URL\(([^,]+),\s*([^)]+)\)\.href/g,"($2 + $1)")}const Lr={VOLUME:0,ARPEGGIO:1,DUTY:2,WAVETABLE:3,PITCH:4,PANNING:5,PHASE_RESET:6,ALG:7,FB:8,FMS:9,AMS:10};const Ar={numVoices:1,numOperators:0,hasFM:!1,hasAlgorithm:!1,hasFeedback:!1,hasVibrato:!1,hasTremolo:!1,hasPitchLFO:!1,hasAmpLFO:!1,hasWavetable:!1,hasPCM:!1,hasNoise:!1,hasADSR:!0,hasSSG:!1,hasPanning:!1,hasStereo:!1,hasDSP:!1,hasReverb:!1,sampleRAMSize:0},Br={AICA:{numVoices:64,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:2097152},SCSP:{numVoices:32,numOperators:4,hasFM:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:524288},C352:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},ES5503:{numVoices:32,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:65536},YMF271:{numVoices:12,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:4194304},YMOPQ:{numVoices:8,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasADSR:!0,hasPanning:!1,hasStereo:!1},K054539:{numVoices:8,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:8388608},ICS2115:{numVoices:32,hasWavetable:!0,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},RF5C400:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},SN76477:{numVoices:1,hasNoise:!0,hasVibrato:!0},TMS36XX:{numVoices:6,hasADSR:!1},TMS5220:{numVoices:1},MEA8000:{numVoices:1},Votrax:{numVoices:1},Astrocade:{numVoices:3,hasNoise:!0,hasVibrato:!0},SNKWave:{numVoices:3,hasWavetable:!0},SP0250:{numVoices:1},UPD931:{numVoices:1},UPD933:{numVoices:8,hasWavetable:!0,hasADSR:!0},TR707:{numVoices:15,hasPCM:!0,sampleRAMSize:32768},VASynth:{numVoices:16,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0},CEM3394:{numVoices:1,hasADSR:!0,hasVibrato:!0},ASC:{numVoices:4,hasWavetable:!0,hasStereo:!0}};function Ir(e){return{...Ar,...Br[e]||{}}}const Fr=0,Ur=1,Rr=2,jr=3;class Xr{channelMemory=new Map;speed=6;bpm=125;constructor(){}getChannelMemory(e){return this.channelMemory.has(e)||this.channelMemory.set(e,{arpeggioX:0,arpeggioY:0,arpeggioTick:0,pitchSlideUp:0,pitchSlideDown:0,tonePortamento:0,tonePortamentoTarget:null,vibratoSpeed:0,vibratoDepth:0,vibratoPhase:0,vibratoWaveform:0,tremoloSpeed:0,tremoloDepth:0,tremoloPhase:0,tremoloWaveform:0,volumeSlide:0,currentVolume:64,currentPanning:128,currentPitch:440,currentPitchOffset:0,noteCutTick:-1,noteDelayTick:-1,retriggerTick:0,retriggerVolume:0,sampleOffset:0,loopStart:0,loopCount:0,loopRow:0}),this.channelMemory.get(e)}setSpeed(e){this.speed=Math.max(1,Math.min(31,e))}setBPM(e){this.bpm=Math.max(32,Math.min(255,e))}getSpeed(){return this.speed}getBPM(){return this.bpm}processTickZero(e,t,n,s,a){const o=this.getChannelMemory(t),r={positionJump:null,patternBreak:null,patternDelay:0};if(!e||e.length<3)return r;const i=e.charAt(0).toUpperCase(),l=parseInt(e.substring(1),16),c=l>>4&15,u=15&l;switch(n>0&&(o.currentPitch=n),i){case"0":l>0&&(o.arpeggioX=c,o.arpeggioY=u,o.arpeggioTick=0);break;case"1":l>0&&(o.pitchSlideUp=l);break;case"2":l>0&&(o.pitchSlideDown=l);break;case"3":l>0&&(o.tonePortamento=l),n>0&&(o.tonePortamentoTarget=n);break;case"4":c>0&&(o.vibratoSpeed=c),u>0&&(o.vibratoDepth=u);break;case"5":case"6":case"A":l>0&&(o.volumeSlide=l);break;case"7":c>0&&(o.tremoloSpeed=c),u>0&&(o.tremoloDepth=u);break;case"8":o.currentPanning=l,a.setPanning(l);break;case"9":l>0&&(o.sampleOffset=l),a.setSampleOffset(256*o.sampleOffset);break;case"B":r.positionJump=l;break;case"C":o.currentVolume=Math.min(l,64),a.setVolume(o.currentVolume);break;case"D":r.patternBreak=10*c+u;break;case"E":this.processExtendedTick0(l,t,s,a,r);break;case"F":0===l||(l<32?this.speed=l:this.bpm=l)}return r}processExtendedTick0(e,t,n,s,a){const o=this.getChannelMemory(t),r=15&e;switch(e>>4&15){case 1:o.currentPitchOffset+=4*r,s.setPitchOffset(o.currentPitchOffset);break;case 2:o.currentPitchOffset-=4*r,s.setPitchOffset(o.currentPitchOffset);break;case 3:case 5:break;case 4:o.vibratoWaveform=3&r;break;case 6:0===r?o.loopStart=n:0===o.loopCount?(o.loopCount=r,o.loopRow=o.loopStart):(o.loopCount--,o.loopCount>0&&(o.loopRow=o.loopStart));break;case 7:o.tremoloWaveform=3&r;break;case 8:o.currentPanning=17*r,s.setPanning(o.currentPanning);break;case 9:r>0&&(o.retriggerTick=r);break;case 10:o.currentVolume=Math.min(o.currentVolume+r,64),s.setVolume(o.currentVolume);break;case 11:o.currentVolume=Math.max(o.currentVolume-r,0),s.setVolume(o.currentVolume);break;case 12:o.noteCutTick=r,0===r&&s.cutNote();break;case 13:o.noteDelayTick=r;break;case 14:a.patternDelay=r}}processTickN(e,t,n,s){const a=this.getChannelMemory(t);if(!e)return;switch(e.charAt(0).toUpperCase()){case"0":this.processArpeggio(a,n,s);break;case"1":this.processPitchSlideUp(a,s);break;case"2":this.processPitchSlideDown(a,s);break;case"3":this.processTonePortamento(a,s);break;case"4":this.processVibrato(a,s);break;case"5":this.processTonePortamento(a,s),this.processVolumeSlide(a,s);break;case"6":this.processVibrato(a,s),this.processVolumeSlide(a,s);break;case"7":this.processTremolo(a,s);break;case"A":this.processVolumeSlide(a,s);break;case"E":this.processExtendedTickN(e,a,n,s)}}processExtendedTickN(e,t,n,s){switch(parseInt(e.substring(1),16)>>4&15){case 9:t.retriggerTick>0&&n%t.retriggerTick===0&&s.retriggerNote(t.currentVolume/64);break;case 12:n===t.noteCutTick&&s.cutNote()}}processArpeggio(e,t,n){if(0===e.arpeggioX&&0===e.arpeggioY)return;let s=0;switch(t%3){case 0:s=0;break;case 1:s=e.arpeggioX;break;case 2:s=e.arpeggioY}const a=e.currentPitch*Math.pow(2,s/12);n.setFrequency(a)}processPitchSlideUp(e,t){e.pitchSlideUp>0&&(e.currentPitchOffset+=4*e.pitchSlideUp,t.setPitchOffset(e.currentPitchOffset))}processPitchSlideDown(e,t){e.pitchSlideDown>0&&(e.currentPitchOffset-=4*e.pitchSlideDown,t.setPitchOffset(e.currentPitchOffset))}processTonePortamento(e,t){if(0===e.tonePortamento||null===e.tonePortamentoTarget)return;const n=e.tonePortamentoTarget-e.currentPitch,s=4*e.tonePortamento;Math.abs(n)<s?e.currentPitch=e.tonePortamentoTarget:e.currentPitch+=n>0?s:-s,t.setFrequency(e.currentPitch)}processVibrato(e,t){if(0===e.vibratoDepth)return;const n=4*this.calculateWaveformValue(e.vibratoWaveform,e.vibratoPhase,e.vibratoDepth);t.setPitchOffset(e.currentPitchOffset+n),e.vibratoPhase=e.vibratoPhase+e.vibratoSpeed&63}processTremolo(e,t){if(0===e.tremoloDepth)return;const n=this.calculateWaveformValue(e.tremoloWaveform,e.tremoloPhase,e.tremoloDepth),s=Math.round(n),a=Math.max(0,Math.min(64,e.currentVolume+s));t.setVolume(a),e.tremoloPhase=e.tremoloPhase+e.tremoloSpeed&63}processVolumeSlide(e,t){if(0===e.volumeSlide)return;const n=e.volumeSlide>>4&15,s=15&e.volumeSlide;n>0?e.currentVolume=Math.min(e.currentVolume+n,64):s>0&&(e.currentVolume=Math.max(e.currentVolume-s,0)),t.setVolume(e.currentVolume)}calculateWaveformValue(e,t,n){const s=t/64*Math.PI*2;switch(e){case Fr:return Math.sin(s)*n;case Ur:return((64-t)/32-1)*n;case Rr:return(t<32?1:-1)*n;case jr:return(2*Math.random()-1)*n;default:return 0}}hasNoteDelay(e){return!!e&&(e.toUpperCase().startsWith("ED")&&"ED0"!==e)}getNoteDelayTick(e){return e&&e.toUpperCase().startsWith("ED")&&parseInt(e.substring(2),16)||0}reset(){this.channelMemory.clear(),this.speed=6,this.bpm=125}resetChannel(e){const t=this.getChannelMemory(e);t.currentPitchOffset=0,t.arpeggioX=0,t.arpeggioY=0,t.arpeggioTick=0,t.pitchSlideUp=0,t.pitchSlideDown=0,t.tonePortamentoTarget=null,t.vibratoPhase=0,t.tremoloPhase=0,t.noteCutTick=-1,t.noteDelayTick=-1}}function zr(e,t){const n=t/64;return e*Math.pow(2,n/12)}function Gr(e){const t=function(e){return 69+12*Math.log2(e/440)}(e),n=Math.floor(t),s=t-n,a=Math.max(0,Math.min(127,n)),o=Math.round(64*s);return{kc:a,kf:Math.max(0,Math.min(63,o))}}class Hr{output;workletNode=null;_initPromise;_pendingCalls=[];_isReady=!1;_disposed=!1;capabilities;config={};romLoaded=!1;currentNote=60;currentFreq=261.63;currentVelocity=1;isNoteOn=!1;noteOnTime=0;static MIN_GATE_TIME=50;macros=new Map;opMacros=[];effectRouter;channelIndex=0;basePitchOffset=0;effectPitchOffset=0;oscBuffer=null;oscCallbacks=new Set;constructor(){this.output=oo().createGain(),this.effectRouter=new Xr,this.capabilities=Ir("default")}initSynth(){this.capabilities=Ir(this.chipName),this._initPromise=this.initialize(),this.capabilities.numOperators>0&&(this.opMacros=Array.from({length:this.capabilities.numOperators},()=>({})))}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=oo(),{wasmBinary:t,jsCode:n}=await async function(e,t,n){const s="/";let a=_r.get(e);if(a||(a=new Set,_r.set(e,a)),!a.has("__mame_init_helper__")){try{await e.audioWorklet.addModule(`${s}mame/mame-worklet-init.js${Or}`)}catch{}a.add("__mame_init_helper__")}if(!a.has(t)){try{await e.audioWorklet.addModule(`${s}mame/${n}${Or}`)}catch{}a.add(t)}if(!Pr.has(t)){const e=(async()=>{const[e,n]=await Promise.all([fetch(`${s}mame/${t}.wasm`),fetch(`${s}mame/${t}.js`)]);if(!e.ok)throw new Error(`Failed to load ${t}.wasm: ${e.status}`);if(!n.ok)throw new Error(`Failed to load ${t}.js: ${n.status}`);const[a,o]=await Promise.all([e.arrayBuffer(),n.text()]);return{wasmBinary:a,jsCode:Tr(o,`${s}mame/`)}})();Pr.set(t,e)}return Pr.get(t)}(e,this.chipName,this.workletFile);if(this._disposed)return;const s=this.output,{workletNode:a,readyPromise:o}=function(e,t,n,s,a){const o=new AudioWorkletNode(e,t,{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),r=new Promise((e,n)=>{const s=setTimeout(()=>n(new Error(`${t} init timeout`)),1e4),a=o.port.onmessage;o.port.onmessage=r=>{"ready"===r.data.type?(clearTimeout(s),e()):"error"===r.data.type&&(clearTimeout(s),n(new Error(r.data.message||`${t} init error`))),a&&a.call(o.port,r)}});o.port.postMessage({type:"init",wasmBinary:n,jsCode:s,sampleRate:e.sampleRate}),o.connect(a);try{const t=e.createGain();t.gain.value=0,o.connect(t),t.connect(e.destination)}catch{}return{workletNode:o,readyPromise:r}}(e,this.processorName,t,n,s);this.workletNode=a;const r=this.workletNode.port.onmessage;this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data),r&&r.call(this.workletNode.port,e)},await o}catch(e){}}handleWorkletMessage(e){switch(e.type){case"ready":this._isReady=!0;for(const e of this._pendingCalls)this.processPendingCall(e);this._pendingCalls=[];break;case"oscData":e.buffer&&(this.oscBuffer=new Float32Array(e.buffer),this.oscCallbacks.forEach(e=>e(this.oscBuffer)))}}processPendingCall(e){"setParam"===e.method?this.setParam(e.args[0],e.args[1]):"triggerAttack"===e.method&&this.triggerAttack(e.args[0],e.args[1],e.args[2])}triggerAttack(e,t,n=1){this._disposed||(this._isReady&&this.workletNode?(this.currentNote="string"==typeof e?function(e){const t=e.match(/^([A-Ga-g][#b]?)[-]?(\d)$/);if(!t)return 60;const n=t[1].toUpperCase(),s=parseInt(t[2]),a={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n];return void 0===a?60:12*(s+1)+a}(e):e>127?Math.round(12*Math.log2(e/440)+69):e,this.currentFreq=function(e){return 440*Math.pow(2,(e-69)/12)}(this.currentNote),this.currentVelocity=n,this.isNoteOn=!0,this.noteOnTime=Date.now(),this.resetMacros(),this.effectRouter.resetChannel(this.channelIndex),this.writeKeyOn(this.currentNote,n)):this._pendingCalls.push({method:"triggerAttack",args:[e,t,n]}))}triggerRelease(e){if(this._disposed)return;const t=Date.now()-this.noteOnTime;t<Hr.MIN_GATE_TIME?setTimeout(()=>this.triggerRelease(e),Hr.MIN_GATE_TIME-t):(this.isNoteOn=!1,this.releaseMacros(),this.writeKeyOff())}triggerAttackRelease(e,t,n,s){if(this._disposed)return;this.triggerAttack(e,n,s||1);const a=go(t);setTimeout(()=>{this._disposed||this.triggerRelease()},1e3*a)}releaseAll(){this.workletNode&&!this._disposed&&(this.workletNode.port.postMessage({type:"allNotesOff"}),this.isNoteOn=!1)}setFrequency(e){this.currentFreq=e,this.writeFrequency(e)}setPitchOffset(e){this.effectPitchOffset=e;const t=zr(this.currentFreq,this.basePitchOffset+e);this.writeFrequency(t)}setVolume(e){const t=e/64;this.writeVolume(t*this.currentVelocity)}setPanning(e){this.writePanning(e)}setSampleOffset(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setSampleOffset",offset:e})}retriggerNote(e){this.writeKeyOn(this.currentNote,e)}cutNote(){this.writeVolume(0),this.isNoteOn=!1}writeDuty(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:100,value:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"selectWavetable",index:e})}writePhaseReset(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"phaseReset"})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dr",value:t})}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"sl",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dt",value:t})}setMacro(e){const t={type:e.type,data:e.data,loop:e.loop??-1,release:e.release??-1,position:0,active:e.data.length>0,released:!1};this.macros.set(e.type,t)}setMacros(e){for(const t of e)this.setMacro(t)}clearMacros(){this.macros.clear()}resetMacros(){this.macros.forEach(e=>{e.position=0,e.released=!1});for(const e of this.opMacros)for(const t of Object.keys(e)){const n=e[t];n&&(n.position=0,n.released=!1)}}releaseMacros(){this.macros.forEach(e=>{e.released=!0,e.release>=0&&e.release<e.data.length&&(e.position=e.release)});for(const e of this.opMacros)for(const t of Object.keys(e)){const n=e[t];n&&(n.released=!0,n.release>=0&&n.release<n.data.length&&(n.position=n.release))}}processTick(){this.isNoteOn&&(this.macros.forEach((e,t)=>{if(!e.active||0===e.data.length)return;let n=e.position;n>=e.data.length&&(n=e.data.length-1);const s=e.data[n];this.applyMacroValue(t,s),n++,n>=e.data.length&&(n=e.loop>=0?e.loop:e.data.length-1),e.position=n}),this.processOperatorMacros())}applyMacroValue(e,t){switch(e){case Lr.VOLUME:{const e=t/127*this.currentVelocity;this.writeVolume(e);break}case Lr.ARPEGGIO:{const e=t>127?t-256:t,n=this.currentFreq*Math.pow(2,e/12);this.writeFrequency(n);break}case Lr.DUTY:this.writeDuty(t);break;case Lr.WAVETABLE:this.writeWavetableSelect(t);break;case Lr.PITCH:{const e=t>127?t-256:t;this.basePitchOffset=e;const n=zr(this.currentFreq,this.basePitchOffset+this.effectPitchOffset);this.writeFrequency(n);break}case Lr.PANNING:{const e=t>127?t-256:t;this.writePanning(128+e);break}case Lr.PHASE_RESET:0!==t&&this.writePhaseReset();break;case Lr.ALG:this.setFMAlgorithm(t);break;case Lr.FB:this.setFMFeedback(t);break;case Lr.FMS:this.setFMSensitivity(t);break;case Lr.AMS:this.setAMSensitivity(t)}}processOperatorMacros(){for(let e=0;e<this.opMacros.length;e++){const t=this.opMacros[e];if(t){if(t.tl?.active){const n=this.advanceOpMacro(t.tl);this.setOperatorTL(e,n)}if(t.ar?.active){const n=this.advanceOpMacro(t.ar);this.setOperatorAR(e,n)}if(t.dr?.active){const n=this.advanceOpMacro(t.dr);this.setOperatorDR(e,n)}if(t.sl?.active){const n=this.advanceOpMacro(t.sl);this.setOperatorSL(e,n)}if(t.rr?.active){const n=this.advanceOpMacro(t.rr);this.setOperatorRR(e,n)}if(t.mult?.active){const n=this.advanceOpMacro(t.mult);this.setOperatorMult(e,n)}if(t.dt?.active){const n=this.advanceOpMacro(t.dt);this.setOperatorDetune(e,n)}}}}advanceOpMacro(e){if(!e.active||0===e.data.length)return 0;let t=e.position;t>=e.data.length&&(t=e.data.length-1);const n=e.data[t];return t++,t>=e.data.length&&(t=e.loop>=0?e.loop:e.data.length-1),e.position=t,n}setFMAlgorithm(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:200,value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:201,value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:202,value:e})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:203,value:e})}processEffectTick0(e,t,n){return this.effectRouter.processTickZero(e,this.channelIndex,t,n,this)}processEffectTickN(e,t){this.effectRouter.processTickN(e,this.channelIndex,t,this)}hasNoteDelay(e){return this.effectRouter.hasNoteDelay(e)}getNoteDelayTick(e){return this.effectRouter.getNoteDelayTick(e)}setChannelIndex(e){this.channelIndex=e}getOscData(){return this.oscBuffer}onOscData(e){return this.oscCallbacks.add(e),this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!0}),()=>{this.oscCallbacks.delete(e),0===this.oscCallbacks.size&&this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!1})}}setParam(e,t){this._isReady||this._pendingCalls.push({method:"setParam",args:[e,t]})}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,s,a,o){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:s,loop:a,format:o??0})}debugTestAudio(){const e=oo();if(!this.workletNode)return;const t=e.createGain();t.gain.value=.3,this.workletNode.connect(t),t.connect(e.destination);const n=e.createAnalyser();n.fftSize=256,this.workletNode.connect(n),this.workletNode.port.postMessage({type:"noteOn",note:60,velocity:100}),setTimeout(()=>{const e=new Float32Array(n.fftSize);n.getFloatTimeDomainData(e);e.reduce((e,t)=>Math.max(e,Math.abs(t)),0)},200),setTimeout(()=>{this.workletNode?.port.postMessage({type:"noteOff",note:60});try{this.workletNode?.disconnect(t),this.workletNode?.disconnect(n),t.disconnect(),n.disconnect()}catch{}},3e3)}debugDumpRouting(){oo();this.workletNode}dispose(){this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.oscCallbacks.clear(),this.output.disconnect()}}class Wr extends d{name="TapeSaturation";inputGain;saturation;toneFilter;outputGain;dryGain;wetGain;_drive;_tone;_wet;input;output;constructor(e={}){super(),this._drive=e.drive??.5,this._tone=e.tone??12e3,this._wet=e.wet??1,this.input=new m(1),this.output=new m(1),this.inputGain=new m(this.calculateInputGain(this._drive)),this.saturation=new p(this.createSaturationCurve(this._drive),4096),this.toneFilter=new h({type:"lowpass",frequency:this._tone,rolloff:-12,Q:.7}),this.outputGain=new m(this.calculateMakeupGain(this._drive)),this.dryGain=new m(1-this._wet),this.wetGain=new m(this._wet),this.input.connect(this.inputGain),this.inputGain.connect(this.saturation),this.saturation.connect(this.toneFilter),this.toneFilter.connect(this.outputGain),this.outputGain.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output)}createSaturationCurve(e){const t=new Float32Array(4096),n=1+8*e;for(let s=0;s<4096;s++){const e=s/4096*2-1;t[s]=e>=0?.95*Math.tanh(e*n)+.02*e:Math.tanh(e*n*.85)}return t}calculateInputGain(e){return 1+2*e}calculateMakeupGain(e){return 1/(1+.5*e)}get drive(){return this._drive}set drive(e){this._drive=Math.max(0,Math.min(1,e)),this.inputGain.gain.value=this.calculateInputGain(this._drive),this.saturation.curve=this.createSaturationCurve(this._drive),this.outputGain.gain.value=this.calculateMakeupGain(this._drive)}get tone(){return this._tone}set tone(e){this._tone=Math.max(2e3,Math.min(2e4,e)),this.toneFilter.frequency.value=this._tone}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.inputGain.dispose(),this.saturation.dispose(),this.toneFilter.dispose(),this.outputGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this}}const qr=Object.freeze(Object.defineProperty({__proto__:null,TapeSaturation:Wr},Symbol.toStringTag,{value:"Module"}));class Kr{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_tunePromise=null;_resolveTune=null;_rejectTune=null;_positionCallbacks=new Set;_songEndCallbacks=new Set;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return Kr.instance&&!Kr.instance._disposed||(Kr.instance=new Kr),Kr.instance}static hasInstance(){return!!Kr.instance&&!Kr.instance._disposed}async initialize(){try{await Kr.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/hively/Hively.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/hively/Hively.wasm"),fetch("/hively/Hively.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/HEAPU8=new Uint8Array\(b\);/,'HEAPU8=new Uint8Array(b);Module["HEAPU8"]=HEAPU8;').replace(/HEAPF32=new Float32Array\(b\);/,'HEAPF32=new Float32Array(b);Module["HEAPF32"]=HEAPF32;'),e+="\nvar createHively = createHively || "+e.match(/var\s+(\w+)\s*=\s*\(\s*\)\s*=>/)?.[1]+";",e.includes("var createHively =")||(e+="\n// Factory is already named createHively via EXPORT_NAME"),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"hively-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"tuneLoaded":this._resolveTune&&(this._resolveTune({name:t.name,channels:t.channels,positions:t.positions,trackLength:t.trackLength,subsongs:t.subsongs,speedMultiplier:t.speedMultiplier,restart:t.restart,mixGain:t.mixGain,stereoMode:t.stereoMode,version:t.version}),this._resolveTune=null,this._rejectTune=null);break;case"error":this._rejectTune&&(this._rejectTune(new Error(t.message)),this._resolveTune=null,this._rejectTune=null);break;case"position":for(const e of this._positionCallbacks)e({position:t.position,row:t.row,speed:t.speed});break;case"songEnd":for(const e of this._songEndCallbacks)e();break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Kr.wasmBinary,jsCode:Kr.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}async loadTune(e,t=2){if(await this._initPromise,!this.workletNode)throw new Error("HivelyEngine not initialized");return this._tunePromise=new Promise((e,t)=>{this._resolveTune=e,this._rejectTune=t}),this.workletNode.port.postMessage({type:"loadTune",buffer:e,defStereo:t},[e]),this._tunePromise}initSubsong(e){this.workletNode?.port.postMessage({type:"initSubsong",nr:e})}play(){this.workletNode?.port.postMessage({type:"play"})}stop(){this.workletNode?.port.postMessage({type:"stop"})}pause(){this.workletNode?.port.postMessage({type:"pause"})}setLooping(e){this.workletNode?.port.postMessage({type:"setLooping",value:e})}freeTune(){this.workletNode?.port.postMessage({type:"freeTune"})}onPositionUpdate(e){return this._positionCallbacks.add(e),()=>this._positionCallbacks.delete(e)}onSongEnd(e){return this._songEndCallbacks.add(e),()=>this._songEndCallbacks.delete(e)}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,this._positionCallbacks.clear(),this._songEndCallbacks.clear(),Kr.instance===this&&(Kr.instance=null)}}const $r=Object.freeze(Object.defineProperty({__proto__:null,HivelyEngine:Kr},Symbol.toStringTag,{value:"Module"}));class Yr{name="HivelySynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;_instrumentMode=!1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=Kr.getInstance(),Yr._engineConnectedToSynth||(this.engine.output.connect(this.output),Yr._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){this._instrumentMode=!0,await this.engine.ready(),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=this.serializeInstrument(e);this.engine.sendMessage({type:"setInstrument",handle:this._playerHandle,buffer:t},[t])}serializeInstrument(e){const t=e.performanceList.entries.length,n=new Uint8Array(22+5*t);n[0]=255&e.volume,n[1]=(31&e.filterSpeed)<<3|7&e.waveLength,n[2]=255&e.envelope.aFrames,n[3]=255&e.envelope.aVolume,n[4]=255&e.envelope.dFrames,n[5]=255&e.envelope.dVolume,n[6]=255&e.envelope.sFrames,n[7]=255&e.envelope.rFrames,n[8]=255&e.envelope.rVolume,n[9]=0,n[10]=0,n[11]=0,n[12]=127&e.filterLowerLimit|(e.filterSpeed>>5&1)<<7,n[13]=255&e.vibratoDelay,n[14]=(e.hardCutRelease?128:0)|(7&e.hardCutReleaseFrames)<<4|15&e.vibratoDepth,n[15]=255&e.vibratoSpeed,n[16]=255&e.squareLowerLimit,n[17]=255&e.squareUpperLimit,n[18]=255&e.squareSpeed,n[19]=63&e.filterUpperLimit,n[20]=255&e.performanceList.speed,n[21]=255&t;let s=22;for(const a of e.performanceList.entries)n[s++]=15&a.fx[0],n[s++]=(15&a.fx[1])<<3|7&a.waveform,n[s++]=(a.fixed?1:0)<<6|63&a.note,n[s++]=255&a.fxParam[0],n[s++]=255&a.fxParam[1];return n.buffer}triggerAttack(e,t,n){if(!this._disposed)if(this._instrumentMode&&this._playerHandle>=0){let t;t="string"==typeof e?po(e):"number"==typeof e?e:36;const s=Math.max(1,Math.min(60,t+1)),a=Math.round(127*(n??1));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}else this.engine.play()}triggerRelease(e,t){this._disposed||(this._instrumentMode&&this._playerHandle>=0?this.engine.sendMessage({type:"noteOff",handle:this._playerHandle}):this.engine.stop())}releaseAll(){this.triggerRelease()}set(e,t){if("volume"===e)this.output.gain.value=Math.max(0,Math.min(1,t))}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._instrumentMode&&this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}Yr._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class Jr{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return Jr.instance&&!Jr.instance._disposed||(Jr.instance=new Jr),Jr.instance}static hasInstance(){return!!Jr.instance&&!Jr.instance._disposed}async initialize(){try{await Jr.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/soundmon/SoundMon.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/soundmon/SoundMon.wasm"),fetch("/soundmon/SoundMon.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"soundmon-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Jr.wasmBinary,jsCode:Jr.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,Jr.instance===this&&(Jr.instance=null)}}class Qr{name="SoundMonSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=Jr.getInstance(),Qr._engineConnectedToSynth||(this.engine.output.connect(this.output),Qr._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){if("pcm"===e.type){const t=e.pcmData??new Uint8Array(0),n=16+t.length,s=new Uint8Array(n);s[0]=1,s[1]=255&(e.volume??64),s[2]=(e.finetune??0)+256&255,s[3]=(e.transpose??0)+256&255;const a=t.length;s[4]=255&a,s[5]=a>>8&255,s[6]=a>>16&255,s[7]=a>>24&255;const o=e.loopStart??0;s[8]=255&o,s[9]=o>>8&255,s[10]=o>>16&255,s[11]=o>>24&255;const r=e.loopLength??0;return s[12]=255&r,s[13]=r>>8&255,s[14]=r>>16&255,s[15]=r>>24&255,s.set(t,16),s.buffer}const t=new Uint8Array(36);t[0]=0,t[1]=15&(e.waveType??0),t[2]=15&(e.waveSpeed??0),t[3]=15&(e.arpSpeed??0),t[4]=255&(e.attackVolume??64),t[5]=255&(e.decayVolume??32),t[6]=255&(e.sustainVolume??32),t[7]=255&(e.releaseVolume??0),t[8]=255&(e.attackSpeed??4),t[9]=255&(e.decaySpeed??4),t[10]=255&(e.sustainLength??16),t[11]=255&(e.releaseSpeed??4),t[12]=255&(e.vibratoDelay??0),t[13]=255&(e.vibratoSpeed??0),t[14]=255&(e.vibratoDepth??0),t[15]=255&(e.portamentoSpeed??0);const n=e.arpTable??new Array(16).fill(0);for(let s=0;s<16;s++)t[16+s]=255&(n[s]??0);return t[32]=0,t[33]=0,t[34]=0,t[35]=0,t.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"vibratoDepth":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:6,value:Math.max(0,Math.min(1,t/63))});break;case"vibratoSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:5,value:Math.max(0,Math.min(1,t/63))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}Qr._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class Zr{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return Zr.instance&&!Zr.instance._disposed||(Zr.instance=new Zr),Zr.instance}static hasInstance(){return!!Zr.instance&&!Zr.instance._disposed}async initialize(){try{await Zr.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/sidmon/SidMon.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/sidmon/SidMon.wasm"),fetch("/sidmon/SidMon.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"sidmon-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Zr.wasmBinary,jsCode:Zr.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,Zr.instance===this&&(Zr.instance=null)}}class ei{name="SidMonSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=Zr.getInstance(),ei._engineConnectedToSynth||(this.engine.output.connect(this.output),ei._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){if("pcm"===e.type){const t=e.pcmData??new Uint8Array(0),n=30+t.length,s=new Uint8Array(n);s[0]=1,s[1]=15&(e.attack??2),s[2]=15&(e.decay??4),s[3]=15&(e.sustain??8),s[4]=15&(e.release??4),s[5]=15&(e.arpSpeed??0);const a=e.arpTable??new Array(8).fill(0);for(let e=0;e<8;e++)s[6+e]=255&(a[e]??0);s[14]=255&(e.vibDelay??0),s[15]=63&(e.vibSpeed??0),s[16]=63&(e.vibDepth??0),s[17]=(e.finetune??0)+256&255;const o=t.length;s[18]=255&o,s[19]=o>>8&255,s[20]=o>>16&255,s[21]=o>>24&255;const r=e.loopStart??0;s[22]=255&r,s[23]=r>>8&255,s[24]=r>>16&255,s[25]=r>>24&255;const i=e.loopLength??0;return s[26]=255&i,s[27]=i>>8&255,s[28]=i>>16&255,s[29]=i>>24&255,s.set(t,30),s.buffer}const t=new Uint8Array(22);t[0]=0,t[1]=3&(e.waveform??1),t[2]=255&(e.pulseWidth??128),t[3]=15&(e.attack??2),t[4]=15&(e.decay??4),t[5]=15&(e.sustain??8),t[6]=15&(e.release??4),t[7]=15&(e.arpSpeed??0);const n=e.arpTable??new Array(8).fill(0);for(let s=0;s<8;s++)t[8+s]=255&(n[s]??0);return t[16]=255&(e.vibDelay??0),t[17]=63&(e.vibSpeed??0),t[18]=63&(e.vibDepth??0),t[19]=255&(e.filterCutoff??255),t[20]=15&(e.filterResonance??0),t[21]=3&(e.filterMode??0),t.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"vibDepth":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:6,value:Math.max(0,Math.min(1,t/63))});break;case"vibSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:5,value:Math.max(0,Math.min(1,t/63))});break;case"filterCutoff":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:16,value:Math.max(0,Math.min(1,t/255))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}ei._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class ti{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return ti.instance&&!ti.instance._disposed||(ti.instance=new ti),ti.instance}static hasInstance(){return!!ti.instance&&!ti.instance._disposed}async initialize(){try{await ti.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/digmug/DigMug.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/digmug/DigMug.wasm"),fetch("/digmug/DigMug.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"digmug-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:ti.wasmBinary,jsCode:ti.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,ti.instance===this&&(ti.instance=null)}}class ni{name="DigMugSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=ti.getInstance(),ni._engineConnectedToSynth||(this.engine.output.connect(this.output),ni._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){if(e.pcmData&&e.pcmData.length>0){const t=e.pcmData,n=25+t.length,s=new Uint8Array(n);s[0]=1,s[1]=63&(e.volume??64),s[2]=15&(e.arpSpeed??0);const a=e.arpTable??new Array(8).fill(0);for(let e=0;e<8;e++)s[3+e]=255&(a[e]??0);s[11]=63&(e.vibSpeed??0),s[12]=63&(e.vibDepth??0);const o=t.length;s[13]=255&o,s[14]=o>>8&255,s[15]=o>>16&255,s[16]=o>>24&255;const r=e.loopStart??0;s[17]=255&r,s[18]=r>>8&255,s[19]=r>>16&255,s[20]=r>>24&255;const i=e.loopLength??0;return s[21]=255&i,s[22]=i>>8&255,s[23]=i>>16&255,s[24]=i>>24&255,s.set(t,25),s.buffer}const t=e.waveformData??new Uint8Array(0),n=24+t.length,s=new Uint8Array(n);s[0]=0;const a=e.wavetable??[0,0,0,0];s[1]=255&a[0],s[2]=255&a[1],s[3]=255&a[2],s[4]=255&a[3],s[5]=63&(e.waveBlend??0),s[6]=63&(e.waveSpeed??0),s[7]=255&Math.min(64,e.volume??64),s[8]=15&(e.arpSpeed??0);const o=e.arpTable??new Array(8).fill(0);for(let i=0;i<8;i++)s[9+i]=255&(o[i]??0);s[17]=63&(e.vibSpeed??0),s[18]=63&(e.vibDepth??0),s[19]=0;const r=t.length;s[20]=255&r,s[21]=r>>8&255,s[22]=r>>16&255,s[23]=r>>24&255,r>0&&s.set(t,24);return s.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"vibSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:5,value:Math.max(0,Math.min(1,t/63))});break;case"vibDepth":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:6,value:Math.max(0,Math.min(1,t/63))});break;case"arpSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:8,value:Math.max(0,Math.min(1,t/15))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}ni._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class si{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return si.instance&&!si.instance._disposed||(si.instance=new si),si.instance}static hasInstance(){return!!si.instance&&!si.instance._disposed}async initialize(){try{await si.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/fc/FC.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/fc/FC.wasm"),fetch("/fc/FC.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"fc-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:si.wasmBinary,jsCode:si.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,si.instance===this&&(si.instance=null)}}class ai{name="FCSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=si.getInstance(),ai._engineConnectedToSynth||(this.engine.output.connect(this.output),ai._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){const t=new Uint8Array(76);t[0]=0,t[1]=Math.max(0,Math.min(46,e.waveNumber??0)),t[2]=Math.max(1,Math.min(15,e.synthSpeed??1));const n=e.synthTable??[];for(let a=0;a<16;a++){const e=n[a],s=3+3*a;e&&(t[s]=255&Math.max(0,Math.min(46,e.waveNum??0)),t[s+1]=255&(e.transposition??0),t[s+2]=255&(e.effect??0))}t[51]=Math.max(0,Math.min(255,e.atkLength??4)),t[52]=Math.max(0,Math.min(64,e.atkVolume??64)),t[53]=Math.max(0,Math.min(255,e.decLength??8)),t[54]=Math.max(0,Math.min(64,e.decVolume??32)),t[55]=Math.max(0,Math.min(64,e.sustVolume??32)),t[56]=Math.max(0,Math.min(255,e.relLength??8)),t[57]=Math.max(0,Math.min(255,e.vibDelay??0)),t[58]=Math.max(0,Math.min(63,e.vibSpeed??0)),t[59]=Math.max(0,Math.min(63,e.vibDepth??0));const s=e.arpTable??new Array(16).fill(0);for(let a=0;a<16;a++)t[60+a]=255&(s[a]??0);return t.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"vibDepth":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:1,value:Math.max(0,Math.min(1,t/63))});break;case"vibSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:2,value:Math.max(0,Math.min(1,t/63))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}ai._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class oi{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return oi.instance&&!oi.instance._disposed||(oi.instance=new oi),oi.instance}static hasInstance(){return!!oi.instance&&!oi.instance._disposed}async initialize(){try{await oi.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/tfmx/TFMX.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/tfmx/TFMX.wasm"),fetch("/tfmx/TFMX.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"tfmx-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:oi.wasmBinary,jsCode:oi.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,oi.instance===this&&(oi.instance=null)}}class ri{name="TFMXSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=oi.getInstance(),ri._engineConnectedToSynth||(this.engine.output.connect(this.output),ri._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){const t=e.sndSeqsCount,n=e.sampleCount,s=e.sndModSeqData??new Uint8Array(0),a=e.volModSeqData??new Uint8Array(64),o=e.sampleHeaders??new Uint8Array(0),r=e.sampleData??new Uint8Array(0),i=r.length,l=12+s.length+64+o.length+i,c=new Uint8Array(l);let u=0;c[u++]=255&t,c[u++]=t>>8&255,c[u++]=t>>16&255,c[u++]=t>>24&255,c[u++]=255&n,c[u++]=n>>8&255,c[u++]=n>>16&255,c[u++]=n>>24&255,c[u++]=255&i,c[u++]=i>>8&255,c[u++]=i>>16&255,c[u++]=i>>24&255,c.set(s,u),u+=s.length;const d=a.subarray(0,Math.min(64,a.length));return c.set(d,u),u+=64,c.set(o,u),u+=o.length,c.set(r,u),c.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){if("volume"===e)this.output.gain.value=Math.max(0,Math.min(1,t))}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}ri._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class ii{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return ii.instance&&!ii.instance._disposed||(ii.instance=new ii),ii.instance}static hasInstance(){return!!ii.instance&&!ii.instance._disposed}async initialize(){try{await ii.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/fred/Fred.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/fred/Fred.wasm"),fetch("/fred/Fred.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"fred-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:ii.wasmBinary,jsCode:ii.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,ii.instance===this&&(ii.instance=null)}}class li{name="FredSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=ii.getInstance(),li._engineConnectedToSynth||(this.engine.output.connect(this.output),li._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){const t=new Uint8Array(37);t[0]=255&e.envelopeVol,t[1]=255&e.attackSpeed,t[2]=255&e.attackVol,t[3]=255&e.decaySpeed,t[4]=255&e.decayVol,t[5]=255&e.sustainTime,t[6]=255&e.releaseSpeed,t[7]=255&e.releaseVol,t[8]=255&e.vibratoDelay,t[9]=255&e.vibratoSpeed,t[10]=255&e.vibratoDepth,t[11]=255&e.arpeggioLimit,t[12]=255&e.arpeggioSpeed,t[13]=255&(e.pulseRateNeg<0?e.pulseRateNeg+256:e.pulseRateNeg),t[14]=255&e.pulseRatePos,t[15]=255&e.pulseSpeed,t[16]=255&e.pulsePosL,t[17]=255&e.pulsePosH,t[18]=255&e.pulseDelay;for(let s=0;s<16;s++){const n=e.arpeggio[s]??0;t[19+s]=255&(n<0?n+256:n)}const n=65535&e.relative;return t[35]=255&n,t[36]=n>>8&255,t.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){if("volume"===e)this.output.gain.value=Math.max(0,Math.min(1,t))}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}li._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class ci{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return ci.instance&&!ci.instance._disposed||(ci.instance=new ci),ci.instance}static hasInstance(){return!!ci.instance&&!ci.instance._disposed}async initialize(){try{await ci.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/hippel-coso/HippelCoSo.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/hippel-coso/HippelCoSo.wasm"),fetch("/hippel-coso/HippelCoSo.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"hippel-coso-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:ci.wasmBinary,jsCode:ci.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,ci.instance===this&&(ci.instance=null)}}class ui{name="HippelCoSoSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=ci.getInstance(),ui._engineConnectedToSynth||(this.engine.output.connect(this.output),ui._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){const t=e.fseq??[],n=e.vseq??[],s=7+t.length+2+n.length,a=new Uint8Array(s);a[0]=0,a[1]=255&Math.max(1,e.volSpeed??1),a[2]=(e.vibSpeed??0)+256&255,a[3]=255&(e.vibDepth??0),a[4]=255&(e.vibDelay??0);const o=t.length;a[5]=255&o,a[6]=o>>8&255;for(let c=0;c<o;c++)a[7+c]=t[c]+256&255;const r=n.length,i=7+o;a[i]=255&r,a[i+1]=r>>8&255;const l=i+2;for(let c=0;c<r;c++)a[l+c]=n[c]+256&255;return a.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"vibDepth":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:1,value:Math.max(0,Math.min(1,t/255))});break;case"vibSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:2,value:Math.max(0,Math.min(1,t/127))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}ui._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class di{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return di.instance&&!di.instance._disposed||(di.instance=new di),di.instance}static hasInstance(){return!!di.instance&&!di.instance._disposed}async initialize(){try{await di.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/robhubbard/RobHubbard.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/robhubbard/RobHubbard.wasm"),fetch("/robhubbard/RobHubbard.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"rob-hubbard-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:di.wasmBinary,jsCode:di.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,di.instance===this&&(di.instance=null)}}class mi{name="RobHubbardSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=di.getInstance(),mi._engineConnectedToSynth||(this.engine.output.connect(this.output),mi._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){const t=e.vibTable??[],n=e.sampleData??[],s=t.length,a=n.length,o=new Uint8Array(19+s+a);o[0]=0,o[1]=255&a,o[2]=a>>8&255;const r=e.loopOffset??-1,i=r<0?r+65536:r;o[3]=255&i,o[4]=i>>8&255;const l=Math.max(0,Math.min(64,e.sampleVolume??64));o[5]=255&l,o[6]=l>>8&255;const c=e.relative??1;o[7]=255&c,o[8]=c>>8&255;const u=e.divider??0;o[9]=255&u,o[10]=u>>8&255;const d=e.vibratoIdx??0;o[11]=255&d,o[12]=d>>8&255;const m=e.hiPos??0;o[13]=255&m,o[14]=m>>8&255;const p=e.loPos??0;o[15]=255&p,o[16]=p>>8&255,o[17]=255&s,o[18]=s>>8&255;for(let f=0;f<s;f++)o[19+f]=t[f]+256&255;const h=19+s;for(let f=0;f<a;f++)o[h+f]=n[f]+256&255;return o.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"portaSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:1,value:Math.max(-1,Math.min(1,t/127))});break;case"divider":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:2,value:Math.max(0,Math.min(1,t/255))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}mi._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class pi{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return pi.instance&&!pi.instance._disposed||(pi.instance=new pi),pi.instance}static hasInstance(){return!!pi.instance&&!pi.instance._disposed}async initialize(){try{await pi.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/sidmon1/SidMon1.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/sidmon1/SidMon1.wasm"),fetch("/sidmon1/SidMon1.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"sidmon1-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:pi.wasmBinary,jsCode:pi.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,pi.instance===this&&(pi.instance=null)}}class hi{name="SidMon1Synth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=pi.getInstance(),hi._engineConnectedToSynth||(this.engine.output.connect(this.output),hi._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){const t=new Uint8Array(93),n=new DataView(t.buffer);t[0]=0,t[1]=255&(e.attackSpeed??8),t[2]=255&Math.min(64,e.attackMax??64),t[3]=255&(e.decaySpeed??4),t[4]=255&Math.min(64,e.decayMin??32),t[5]=255&(e.sustain??0),t[6]=255&(e.releaseSpeed??4),t[7]=255&Math.min(64,e.releaseMin??0),t[8]=255&(e.phaseShift??0),t[9]=255&(e.phaseSpeed??0);const s=Math.max(0,Math.min(1005,e.finetune??0));n.setUint16(10,s,!0),t[12]=(e.pitchFall??0)+256&255;const a=e.arpeggio??new Array(16).fill(0);for(let i=0;i<16;i++)t[13+i]=255&(a[i]??0);const o=e.mainWave??new Array(32).fill(0);for(let i=0;i<32;i++)t[29+i]=(o[i]??0)+256&255;const r=e.phaseWave??new Array(32).fill(0);for(let i=0;i<32;i++)t[61+i]=(r[i]??0)+256&255;return t.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"attackMax":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:1,value:Math.max(0,Math.min(1,t/64))});break;case"decayMin":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:2,value:Math.max(0,Math.min(1,t/64))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}hi._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class fi{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return fi.instance&&!fi.instance._disposed||(fi.instance=new fi),fi.instance}static hasInstance(){return!!fi.instance&&!fi.instance._disposed}async initialize(){try{await fi.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/octamed/OctaMED.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/octamed/OctaMED.wasm"),fetch("/octamed/OctaMED.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"octamed-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:fi.wasmBinary,jsCode:fi.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,fi.instance===this&&(fi.instance=null)}}class gi{name="OctaMEDSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=fi.getInstance(),gi._engineConnectedToSynth||(this.engine.output.connect(this.output),gi._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=gi.serializeInstrument(e);this.engine.sendMessage({type:"setInstrument",handle:this._playerHandle,buffer:t},[t])}static serializeInstrument(e){const t=Math.max(1,Math.min(10,e.waveforms.length)),n=new Uint8Array(264+256*t);n[0]=1,n[1]=t,n[2]=63&e.volume,n[3]=255&e.vibratoSpeed,n[4]=255&e.voltblSpeed,n[5]=255&e.wfSpeed;const s=e.voltbl;for(let o=0;o<128;o++)n[8+o]=s[o]??255;const a=e.wftbl;for(let o=0;o<128;o++)n[136+o]=a[o]??255;for(let o=0;o<t;o++){const t=e.waveforms[o],s=new Uint8Array(n.buffer,264+256*o,256);t&&s.set(new Uint8Array(t.buffer,t.byteOffset,Math.min(256,t.byteLength)))}return n.buffer}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?this.noteNameToMidi(e):"number"==typeof e?e:48,this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:127})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){if("volume"===e)this.output.gain.value=Math.max(0,Math.min(1,t))}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}gi._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}noteNameToMidi(e){const t=e.match(/^([A-G][#b]?)(-?\d+)$/);if(!t)return 48;const n={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[t[1]]??0;return 12*(parseInt(t[2],10)+1)+n}}class bi{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_playerHandleResolvers=[];_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return bi.instance&&!bi.instance._disposed||(bi.instance=new bi),bi.instance}static hasInstance(){return!!bi.instance&&!bi.instance._disposed}async initialize(){try{await bi.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/davidwhittaker/DavidWhittaker.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/davidwhittaker/DavidWhittaker.wasm"),fetch("/davidwhittaker/DavidWhittaker.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"david-whittaker-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"error":break;case"playerCreated":if(this._playerHandleResolvers.length>0){this._playerHandleResolvers.shift()(t.handle)}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:bi.wasmBinary,jsCode:bi.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}sendMessage(e,t){this.workletNode&&(t?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}waitForPlayerHandle(){return new Promise(e=>{this._playerHandleResolvers.push(e)})}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,bi.instance===this&&(bi.instance=null)}}class vi{name="DavidWhittakerSynth";output;engine;audioContext;_disposed=!1;_playerHandle=-1;static _engineConnectedToSynth=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=bi.getInstance(),vi._engineConnectedToSynth||(this.engine.output.connect(this.output),vi._engineConnectedToSynth=!0,this._ownsEngineConnection=!0)}async setInstrument(e){await this.engine.ready(),this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this.engine.sendMessage({type:"createPlayer"}),this._playerHandle=await this.engine.waitForPlayerHandle();const t=function(e){const t=e.volseq??[64,-128,0],n=e.frqseq??[-128,0],s=e.relative??8364,a=t.length,o=n.length,r=new Uint8Array(8+a+2+o);r[0]=0,r[1]=255&Math.max(0,Math.min(64,e.defaultVolume??64)),r[2]=255&s,r[3]=s>>8&255,r[4]=255&(e.vibratoSpeed??0),r[5]=255&(e.vibratoDepth??0),r[6]=255&a,r[7]=a>>8&255;for(let c=0;c<a;c++)r[8+c]=t[c]+256&255;const i=8+a;r[i]=255&o,r[i+1]=o>>8&255;const l=i+2;for(let c=0;c<o;c++)r[l+c]=n[c]+256&255;return r.buffer}(e);this.engine.sendMessage({type:"loadInstrument",handle:this._playerHandle,buffer:t},[t])}triggerAttack(e,t,n){if(this._disposed||this._playerHandle<0)return;let s;s="string"==typeof e?po(e):"number"==typeof e?e:48;const a=Math.round(127*(n??.8));this.engine.sendMessage({type:"noteOn",handle:this._playerHandle,note:s,velocity:a})}triggerRelease(e,t){this._disposed||this._playerHandle<0||this.engine.sendMessage({type:"noteOff",handle:this._playerHandle})}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"vibratoDepth":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:1,value:Math.max(0,Math.min(1,t/255))});break;case"vibratoSpeed":this._playerHandle>=0&&this.engine.sendMessage({type:"setParam",handle:this._playerHandle,paramId:2,value:Math.max(0,Math.min(1,t/255))})}}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this._playerHandle>=0&&(this.engine.sendMessage({type:"destroyPlayer",handle:this._playerHandle}),this._playerHandle=-1),this._ownsEngineConnection){try{this.engine.output.disconnect(this.output)}catch{}vi._engineConnectedToSynth=!1,this._ownsEngineConnection=!1}}}class yi{static instance=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;workletNode=null;_disposed=!1;constructor(){}static hasInstance(){return null!==yi.instance&&!yi.instance._disposed}static getInstance(){return yi.instance&&!yi.instance._disposed||(yi.instance=new yi),yi.instance}async ensureInitialized(e){if(yi.loadedContexts.has(e))return;const t=yi.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/symphonie/Symphonie.worklet.js")}catch{}yi.loadedContexts.add(e)})();return yi.initPromises.set(e,n),n}async loadSong(e,t){await this.ensureInitialized(e),this.workletNode?.disconnect(),this.workletNode=null,this.workletNode=new AudioWorkletNode(e,"symphonie-processor",{numberOfOutputs:1,outputChannelCount:[2]});const n=new Promise((e,t)=>{this.workletNode.port.onmessage=n=>{const s=n.data;"ready"===s.type?e():"error"===s.type&&t(new Error(`[SymphonieEngine] ${s.message??"worklet error"}`))}}),s=[];for(const a of t.instruments)null!==a.samples&&s.push(a.samples.buffer);this.workletNode.port.postMessage({type:"load",playbackData:t},s),await n}play(){this.workletNode?.port.postMessage({type:"play"})}stop(){this.workletNode?.port.postMessage({type:"stop"})}setVolume(e){this.workletNode?.port.postMessage({type:"volume",value:e})}getNode(){return this.workletNode}dispose(){this._disposed=!0,this.workletNode?.disconnect(),this.workletNode=null,yi.instance===this&&(yi.instance=null)}}const xi=Object.freeze(Object.defineProperty({__proto__:null,SymphonieEngine:yi},Symbol.toStringTag,{value:"Module"}));class Ni{name="SymphonieSynth";output;engine;audioContext;_disposed=!1;_ownsEngineConnection=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=yi.getInstance()}async load(e){await this.engine.loadSong(this.audioContext,e.symphonie);const t=this.engine.getNode();if(t){if(this._ownsEngineConnection)try{t.disconnect(this.output)}catch{}t.connect(this.output),this._ownsEngineConnection=!0}}play(){this._disposed||this.engine.play()}stop(){this._disposed||this.engine.stop()}triggerAttack(e,t,n){this.play()}triggerRelease(e,t){this.stop()}set(e,t){if("volume"===e)this.output.gain.value=Math.max(0,Math.min(1,t)),this.engine.setVolume(Math.max(0,Math.min(1,t)))}get(e){if("volume"===e)return this.output.gain.value}getEngine(){return this.engine}dispose(){if(this._disposed=!0,this.engine.stop(),this._ownsEngineConnection){const e=this.engine.getNode();if(e)try{e.disconnect(this.output)}catch{}this._ownsEngineConnection=!1}this.engine.dispose()}}class wi{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_rejectInit=null;_disposed=!1;_handleQueue=[];_songLoadedQueue=new Map;_songSavedQueue=new Map;_synthLoadedQueue=new Map;_synthSavedQueue=new Map;_modulesQueue=new Map;_controlsQueue=new Map;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise((e,t)=>{this._resolveInit=e,this._rejectInit=t}),this.initialize()}static getInstance(){return wi.instance&&!wi.instance._disposed||(wi.instance=new wi),wi.instance}static hasInstance(){return!!wi.instance&&!wi.instance._disposed}async initialize(){try{await wi.ensureInitialized(this.audioContext),this.createNode()}catch(e){this._rejectInit&&(this._rejectInit(e instanceof Error?e:new Error(String(e))),this._rejectInit=null,this._resolveInit=null)}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{if("running"!==e.state){e.resume().catch(()=>{});for(let t=0;t<40&&"running"!==e.state;t++)await new Promise(e=>setTimeout(e,50));e.state}try{await e.audioWorklet.addModule("/sunvox/SunVox.worklet.js")}catch(t){}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/sunvox/SunVox.wasm"),fetch("/sunvox/SunVox.js")]);if(!e.ok)throw new Error(`[SunVoxEngine] Failed to fetch SunVox.wasm: ${e.status}`);if(!t.ok)throw new Error(`[SunVoxEngine] Failed to fetch SunVox.js: ${t.status}`);this.wasmBinary=await e.arrayBuffer();let n=await t.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/HEAPU8=new Uint8Array\(b\);/,'HEAPU8=new Uint8Array(b);Module["HEAPU8"]=HEAPU8;').replace(/HEAPF32=new Float32Array\(b\);/,'HEAPF32=new Float32Array(b);Module["HEAPF32"]=HEAPF32;'),this.jsCode=n}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"sunvox-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data)},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:wi.wasmBinary,jsCode:wi.jsCode}),this.workletNode.connect(this.output)}handleWorkletMessage(e){switch(e.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null,this._rejectInit=null);break;case"handle":{const t=this._handleQueue.shift();t&&t.resolve(e.handle);break}case"songLoaded":{const t=this._songLoadedQueue.get(e.handle);t&&(this._songLoadedQueue.delete(e.handle),t.resolve());break}case"songSaved":{const t=this._songSavedQueue.get(e.handle);t&&(this._songSavedQueue.delete(e.handle),t.resolve(e.buffer));break}case"synthLoaded":{const t=this._synthLoadedQueue.get(e.handle);t&&(this._synthLoadedQueue.delete(e.handle),t.resolve(e.moduleId));break}case"synthSaved":{const t=`${e.handle}:${e.moduleId}`,n=this._synthSavedQueue.get(t);n&&(this._synthSavedQueue.delete(t),n.resolve(e.buffer));break}case"modules":{const t=this._modulesQueue.get(e.handle);t&&(this._modulesQueue.delete(e.handle),t.resolve(e.modules??[]));break}case"controls":{const t=`${e.handle}:${e.moduleId}`,n=this._controlsQueue.get(t);n&&(this._controlsQueue.delete(t),n.resolve(e.controls??[]));break}case"error":{const t=new Error(e.message??"SunVox worklet error");this._rejectInit&&(this._rejectInit(t),this._rejectInit=null,this._resolveInit=null),this._rejectAll(t);break}}}_rejectAll(e){for(const t of this._handleQueue)t.reject(e);this._handleQueue.length=0;for(const t of this._songLoadedQueue.values())t.reject(e);this._songLoadedQueue.clear();for(const t of this._songSavedQueue.values())t.reject(e);this._songSavedQueue.clear();for(const t of this._synthLoadedQueue.values())t.reject(e);this._synthLoadedQueue.clear();for(const t of this._synthSavedQueue.values())t.reject(e);this._synthSavedQueue.clear();for(const t of this._modulesQueue.values())t.reject(e);this._modulesQueue.clear();for(const t of this._controlsQueue.values())t.reject(e);this._controlsQueue.clear()}async ready(){return this._initPromise}async createHandle(e){if(await this._initPromise,this._disposed||!this.workletNode)throw new Error("[SunVoxEngine] Engine is disposed or not initialized");return new Promise((t,n)=>{this._handleQueue.push({resolve:t,reject:n}),this.workletNode.port.postMessage({type:"create",sampleRate:e})})}destroyHandle(e){this.workletNode?.port.postMessage({type:"destroy",handle:e})}async loadSong(e,t){if(await this._initPromise,this._disposed||!this.workletNode)throw new Error("[SunVoxEngine] Engine is disposed or not initialized");return new Promise((n,s)=>{this._songLoadedQueue.set(e,{resolve:n,reject:s});const a=t.slice(0);this.workletNode.port.postMessage({type:"loadSong",handle:e,buffer:a},[a])})}async saveSong(e){if(await this._initPromise,this._disposed||!this.workletNode)throw new Error("[SunVoxEngine] Engine is disposed or not initialized");return new Promise((t,n)=>{this._songSavedQueue.set(e,{resolve:t,reject:n}),this.workletNode.port.postMessage({type:"saveSong",handle:e})})}async loadSynth(e,t){if(await this._initPromise,this._disposed||!this.workletNode)throw new Error("[SunVoxEngine] Engine is disposed or not initialized");return new Promise((n,s)=>{this._synthLoadedQueue.set(e,{resolve:n,reject:s});const a=t.slice(0);this.workletNode.port.postMessage({type:"loadSynth",handle:e,buffer:a},[a])})}async saveSynth(e,t){if(await this._initPromise,this._disposed||!this.workletNode)throw new Error("[SunVoxEngine] Engine is disposed or not initialized");const n=`${e}:${t}`;return new Promise((s,a)=>{this._synthSavedQueue.set(n,{resolve:s,reject:a}),this.workletNode.port.postMessage({type:"saveSynth",handle:e,moduleId:t})})}async getModules(e){if(await this._initPromise,this._disposed||!this.workletNode)throw new Error("[SunVoxEngine] Engine is disposed or not initialized");return new Promise((t,n)=>{this._modulesQueue.set(e,{resolve:t,reject:n}),this.workletNode.port.postMessage({type:"getModules",handle:e})})}async getControls(e,t){if(await this._initPromise,this._disposed||!this.workletNode)throw new Error("[SunVoxEngine] Engine is disposed or not initialized");const n=`${e}:${t}`;return new Promise((s,a)=>{this._controlsQueue.set(n,{resolve:s,reject:a}),this.workletNode.port.postMessage({type:"getControls",handle:e,moduleId:t})})}sendMessage(e,t){this.workletNode&&(t&&t.length>0?this.workletNode.port.postMessage(e,t):this.workletNode.port.postMessage(e))}noteOn(e,t,n,s){this.sendMessage({type:"noteOn",handle:e,moduleId:t,note:n,vel:s})}noteOff(e,t){this.sendMessage({type:"noteOff",handle:e,moduleId:t})}setControl(e,t,n,s){this.sendMessage({type:"setControl",handle:e,moduleId:t,ctlId:n,value:s})}play(e){this.sendMessage({type:"play",handle:e})}stop(e){this.sendMessage({type:"stop",handle:e})}dispose(){this._disposed=!0,this._rejectAll(new Error("SunVoxEngine disposed")),this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,wi.instance===this&&(wi.instance=null)}}const Ei=Object.freeze(Object.defineProperty({__proto__:null,SunVoxEngine:wi},Symbol.toStringTag,{value:"Module"}));class ki{name="SunVoxSynth";output;engine;audioContext;_disposed=!1;_handle=-1;_moduleId=-1;_controlValues=new Map;constructor(){this.audioContext=oo(),this.engine=wi.getInstance(),this.output=this.engine.output}async setModule(e){await this.engine.ready(),this._handle<0&&(this._handle=await this.engine.createHandle(this.audioContext.sampleRate)),this._moduleId=await this.engine.loadSynth(this._handle,e)}async setSong(e){await this.engine.ready(),this._handle<0&&(this._handle=await this.engine.createHandle(this.audioContext.sampleRate)),await this.engine.loadSong(this._handle,e)}async getControls(){return this._handle<0||this._moduleId<0?[]:this.engine.getControls(this._handle,this._moduleId)}async saveSynth(){if(this._handle<0||this._moduleId<0)throw new Error("[SunVoxSynth] No module loaded");return this.engine.saveSynth(this._handle,this._moduleId)}async saveSong(){if(this._handle<0)throw new Error("[SunVoxSynth] No song loaded");return this.engine.saveSong(this._handle)}triggerAttack(e,t,n){if(this._disposed)return;if(this._handle<0)return;if(this._moduleId<0)return void this.engine.play(this._handle);let s;s="string"==typeof e?po(e):"number"==typeof e?e:60;const a=Math.max(1,Math.min(128,Math.round(127*(n??1))+1));this.engine.sendMessage({type:"noteOn",handle:this._handle,moduleId:this._moduleId,note:s,vel:a})}triggerRelease(e,t){this._disposed||this._handle<0||(this._moduleId<0?this.engine.stop(this._handle):this.engine.sendMessage({type:"noteOff",handle:this._handle,moduleId:this._moduleId}))}releaseAll(){this.triggerRelease()}set(e,t){if(this._disposed)return;if(this._handle<0||this._moduleId<0)return;const n=parseInt(e,10);isNaN(n)||(this._controlValues.set(e,t),this.engine.sendMessage({type:"setControl",handle:this._handle,moduleId:this._moduleId,ctlId:n,value:t}))}get(e){return this._controlValues.get(e)}getEngine(){return this.engine}dispose(){this._disposed||(this._disposed=!0,this._handle>=0&&(this.engine.destroyHandle(this._handle),this._handle=-1,this._moduleId=-1))}}class Di{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_rejectInit=null;_loadPromise=null;_resolveLoad=null;_rejectLoad=null;_renderPromise=null;_resolveRender=null;_rejectRender=null;_subsongScanPromise=null;_resolveSubsongScan=null;_rejectSubsongScan=null;_isolateChannelPending=new Map;_positionCallbacks=new Set;_channelCallbacks=new Set;_songEndCallbacks=new Set;_disposed=!1;_readStringPending=new Map;_readStringNextId=0;_scanMemoryPending=new Map;_scanMemoryNextId=0;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise((e,t)=>{this._resolveInit=e,this._rejectInit=t}),this.initialize()}static getInstance(){return Di.instance&&!Di.instance._disposed||(Di.instance=new Di),Di.instance}static hasInstance(){return!!Di.instance&&!Di.instance._disposed}async initialize(){try{await Di.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/uade/UADE.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/uade/UADE.wasm"),fetch("/uade/UADE.js")]);if(!e.ok)throw new Error("[UADEEngine] Failed to fetch UADE.wasm");if(this.wasmBinary=await e.arrayBuffer(),!t.ok)throw new Error("[UADEEngine] Failed to fetch UADE.js");{let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"uade-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null,this._rejectInit=null);break;case"loaded":if(this._resolveLoad){const e={player:t.player??"Unknown",formatName:t.formatName??"Unknown",minSubsong:t.minSubsong??1,maxSubsong:t.maxSubsong??1,subsongCount:t.subsongCount??1,scanData:t.scanData};t.enhancedScan&&(e.enhancedScan={...t.enhancedScan,warnings:t.enhancedScan.warnings??[]}),this._resolveLoad(e),this._resolveLoad=null,this._rejectLoad=null}break;case"error":this._rejectInit&&(this._rejectInit(new Error(t.message)),this._resolveInit=null,this._rejectInit=null),this._rejectLoad&&(this._rejectLoad(new Error(t.message)),this._resolveLoad=null,this._rejectLoad=null);break;case"position":for(const e of this._positionCallbacks)e({subsong:t.subsong??0,position:t.position??0});break;case"channels":for(const e of this._channelCallbacks)e(t.channels,t.totalFrames);break;case"songEnd":for(const e of this._songEndCallbacks)e();break;case"renderComplete":this._resolveRender&&(this._resolveRender(t.audioBuffer),this._resolveRender=null,this._rejectRender=null);break;case"renderError":this._rejectRender&&(this._rejectRender(new Error(t.message)),this._resolveRender=null,this._rejectRender=null);break;case"subsongScanned":this._resolveSubsongScan&&(this._resolveSubsongScan({subsong:t.subsong,scanResult:t.scanResult}),this._resolveSubsongScan=null,this._rejectSubsongScan=null);break;case"subsongScanError":this._rejectSubsongScan&&(this._rejectSubsongScan(new Error(t.message)),this._resolveSubsongScan=null,this._rejectSubsongScan=null);break;case"instrumentIsolated":{const e=this._isolateChannelPending.get(t.channelIndex);e&&(e.resolve({channelIndex:t.channelIndex,pcm:t.pcm,sampleRate:t.sampleRate,framesWritten:t.framesWritten}),this._isolateChannelPending.delete(t.channelIndex));break}case"instrumentIsolatedError":{const e=this._isolateChannelPending.get(t.channelIndex);e&&(e.reject(new Error(t.message)),this._isolateChannelPending.delete(t.channelIndex));break}case"readStringResult":{const e=this._readStringPending.get(t.requestId);e&&(e.resolve(t.value??""),this._readStringPending.delete(t.requestId));break}case"readStringError":{const e=this._readStringPending.get(t.requestId);e&&(e.reject(new Error(t.message)),this._readStringPending.delete(t.requestId));break}case"scanMemoryResult":{const e=this._scanMemoryPending.get(t.requestId);e&&(e.resolve(t.addr??-1),this._scanMemoryPending.delete(t.requestId));break}case"scanMemoryError":{const e=this._scanMemoryPending.get(t.requestId);e&&(e.reject(new Error(t.message)),this._scanMemoryPending.delete(t.requestId));break}}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Di.wasmBinary,jsCode:Di.jsCode},Di.wasmBinary?[Di.wasmBinary]:[]),Di.wasmBinary=null,this.workletNode.connect(this.output)}async ready(){return this._initPromise}async load(e,t){if(await this._initPromise,!this.workletNode)throw new Error("UADEEngine not initialized");this._loadPromise=new Promise((e,t)=>{this._resolveLoad=e,this._rejectLoad=t});const n=e.slice(0);return this.workletNode.port.postMessage({type:"load",buffer:n,filenameHint:t},[n]),this._loadPromise}async addCompanionFile(e,t){if(await this._initPromise,!this.workletNode)throw new Error("UADEEngine not initialized");const n=t.slice(0);this.workletNode.port.postMessage({type:"addCompanionFile",filename:e,buffer:n},[n])}cancelLoad(){this._rejectLoad&&this._rejectLoad(new Error("Scan cancelled")),this._resolveLoad=null,this._rejectLoad=null,this._loadPromise=null}play(){this.workletNode?.port.postMessage({type:"play"})}stop(){this.workletNode?.port.postMessage({type:"stop"})}pause(){this.workletNode?.port.postMessage({type:"pause"})}setSubsong(e){this.workletNode?.port.postMessage({type:"setSubsong",index:e})}setLooping(e){this.workletNode?.port.postMessage({type:"setLooping",value:e})}onPositionUpdate(e){return this._positionCallbacks.add(e),()=>this._positionCallbacks.delete(e)}onChannelData(e){return this._channelCallbacks.add(e),()=>this._channelCallbacks.delete(e)}onSongEnd(e){return this._songEndCallbacks.add(e),()=>this._songEndCallbacks.delete(e)}async renderFull(e){if(await this._initPromise,!this.workletNode)throw new Error("UADEEngine not initialized");return this._renderPromise=new Promise((e,t)=>{this._resolveRender=e,this._rejectRender=t}),this.workletNode.port.postMessage({type:"renderFull",subsong:e}),this._renderPromise}async scanSubsong(e){if(await this._initPromise,!this.workletNode)throw new Error("UADEEngine not initialized");return this._subsongScanPromise=new Promise((e,t)=>{this._resolveSubsongScan=e,this._rejectSubsongScan=t}),this.workletNode.port.postMessage({type:"scanSubsong",subsong:e}),this._subsongScanPromise}async isolateChannel(e,t=2e3){if(await this._initPromise,!this.workletNode)throw new Error("UADEEngine not initialized");const n=new Promise((t,n)=>{this._isolateChannelPending.set(e,{resolve:t,reject:n})});return this.workletNode.port.postMessage({type:"isolateChannel",channelIndex:e,durationMs:t}),n}setInstrumentSample(e,t){if(!this.workletNode)return;const n=t.slice();this.workletNode.port.postMessage({type:"setInstrumentSample",samplePtr:e,pcmData:n.buffer},[n.buffer])}async readStringFromMemory(e,t=22){if(await this._initPromise,!this.workletNode)throw new Error("UADEEngine not initialized");const n=this._readStringNextId++,s=new Promise((e,t)=>{this._readStringPending.set(n,{resolve:e,reject:t})});return this.workletNode.port.postMessage({type:"readString",requestId:n,addr:e,maxLen:t}),s}async scanMemoryForMagic(e,t=524288){if(await this._initPromise,!this.workletNode)throw new Error("UADEEngine not initialized");const n=this._scanMemoryNextId++,s=new Promise((e,t)=>{this._scanMemoryPending.set(n,{resolve:e,reject:t})}),a=e.slice();return this.workletNode.port.postMessage({type:"scanMemory",requestId:n,magic:a.buffer,searchLen:t},[a.buffer]),s}dispose(){this._disposed=!0,this.workletNode?.port.postMessage({type:"dispose"}),this.workletNode?.disconnect(),this.workletNode=null,this._positionCallbacks.clear(),this._channelCallbacks.clear(),this._songEndCallbacks.clear(),Di.instance===this&&(Di.instance=null)}}const Si=Object.freeze(Object.defineProperty({__proto__:null,UADEEngine:Di},Symbol.toStringTag,{value:"Module"}));class Mi{name="UADESynth";output;engine;audioContext;_disposed=!1;_currentConfig=null;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.engine=Di.getInstance(),this.engine.output.connect(this.output)}async setInstrument(e){this._currentConfig=e,await this.engine.ready(),await this.engine.load(e.fileData,e.filename),e.currentSubsong>0&&this.engine.setSubsong(e.currentSubsong)}triggerAttack(e,t,n){this._disposed||this.engine.play()}triggerRelease(e,t){this._disposed||this.engine.stop()}releaseAll(){this.triggerRelease()}set(e,t){switch(e){case"volume":this.output.gain.value=Math.max(0,Math.min(1,t));break;case"subsong":this.engine.setSubsong(Math.round(t))}}get(e){switch(e){case"volume":return this.output.gain.value;case"subsong":return this._currentConfig?.currentSubsong??0}}setInstrumentSample(e,t){this.engine.setInstrumentSample(e,t)}getEngine(){return this.engine}dispose(){this._disposed=!0,this.engine.output.disconnect()}}const Ci=new TextEncoder;function Vi(e){return 4*Math.ceil(e/4)}function Pi(e){const t=Ci.encode(e),n=Vi(t.length+1),s=new Uint8Array(n);return s.set(t),s}function _i(e,t){const n=Pi(e),s=Pi(","+t.map(e=>e.type).join("")),a=t.map(e=>{switch(e.type){case"i":return function(e){const t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!1),t}(e.value);case"f":return function(e){const t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!1),t}(e.value);case"s":return Pi(e.value);case"b":return function(e){const t=Vi(e.length),n=new Uint8Array(4+t);return new DataView(n.buffer).setInt32(0,e.length,!1),n.set(e,4),n}(e.value);default:throw new Error(`Unhandled OSC arg type: ${e.type}`)}}),o=n.length+s.length+a.reduce((e,t)=>e+t.length,0),r=new Uint8Array(o);let i=0;r.set(n,i),i+=n.length,r.set(s,i),i+=s.length;for(const l of a)r.set(l,i),i+=l.length;return r}function Oi(e,t){const n=[{type:"i",value:e}];for(const[s,a]of Object.entries(t))n.push({type:"s",value:s}),n.push({type:"f",value:a});return _i("/n_set",n)}const Ti=new WeakMap;class Li{output;_node;_disposed=!1;constructor(e,t){this._node=e,this.output=t}static getInstance(e){const t=Ti.get(e);if(t)return t;const n=Li._boot(e);return n.catch(()=>Ti.delete(e)),Ti.set(e,n),n}static async _boot(e){await e.audioWorklet.addModule("/sc/DEViLBOX.SC.worklet.js");const[t,n]=await Promise.all([fetch("/sc/SC.js"),fetch("/sc/SC.wasm")]);if(!t.ok)throw new Error(`[SuperColliderEngine] Failed to fetch SC.js: ${t.status}`);if(!n.ok)throw new Error(`[SuperColliderEngine] Failed to fetch SC.wasm: ${n.status}`);const[s,a]=await Promise.all([t.text(),n.arrayBuffer()]),o=new AudioWorkletNode(e,"devilbox-sc-processor"),r=e.createGain();o.connect(r),await new Promise((t,n)=>{o.port.onmessage=e=>{const s=e.data;"ready"===s.type?t():"error"===s.type&&n(new Error(`[SuperColliderEngine] Worklet error: ${s.message??"(no message)"}`))},o.port.postMessage({type:"init",jsCode:s,wasmBinary:a,blockSize:128,sampleRate:e.sampleRate},[a])});const i=new Li(o,r);return i._attachPortListener(),i}_attachPortListener(){this._node.port.onmessage=e=>{e.data.type}}sendOsc(e){if(this._disposed)return;const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);this._node.port.postMessage({type:"osc",data:t},[t])}loadSynthDef(e){this.sendOsc(function(e){return _i("/d_recv",[{type:"b",value:e}])}(e))}noteOn(e,t,n){this.sendOsc(function(e,t,n){const s=[{type:"s",value:e},{type:"i",value:t},{type:"i",value:0},{type:"i",value:0}];for(const[a,o]of Object.entries(n))s.push({type:"s",value:a}),s.push({type:"f",value:o});return _i("/s_new",s)}(t,e,n))}noteOff(e){this.sendOsc(Oi(e,{gate:0}))}setNodeParams(e,t){this.sendOsc(Oi(e,t))}dispose(){this._disposed||(this._disposed=!0,this._node.port.postMessage({type:"dispose"}),this._node.disconnect())}}const Ai={C:0,D:2,E:4,F:5,G:7,A:9,B:11};function Bi(e){const t="string"==typeof e?function(e){const t=e.match(/^([A-G])([#b]?)(-?\d+)$/);if(!t)return 69;const n=Ai[t[1]]+("#"===t[2]?1:"b"===t[2]?-1:0);return 12*(parseInt(t[3],10)+1)+n}(e):e;return 440*Math.pow(2,(t-69)/12)}let Ii=1e3;class Fi{name="SuperCollider";output;_config;_audioContext;_engine=null;_enginePromise=null;_currentNodeId=null;_disposed=!1;_gainNode;constructor(e,t){this._config=e,this._audioContext=t,this._gainNode=t.createGain(),this.output=this._gainNode,this._initEngine()}_initEngine(){this._enginePromise=Li.getInstance(this._audioContext).then(e=>(this._disposed||(this._engine=e,e.output.connect(this._gainNode),this._config.binary&&this._loadBinary(e,this._config.binary)),e)).catch(e=>{throw e})}_loadBinary(e,t){const n=Uint8Array.from(atob(t),e=>e.charCodeAt(0));e.loadSynthDef(n)}triggerAttack(e,t,n){if(this._disposed||!this._config.binary||!this._config.synthDefName)return;null!=this._currentNodeId&&(this._engine?.noteOff(this._currentNodeId),this._currentNodeId=null);const s=Ii++;this._currentNodeId=s;const a={freq:Bi(e),amp:n??1,gate:1,...Object.fromEntries(this._config.params.map(e=>[e.name,e.value]))},o=this._config.synthDefName;this._engine?this._engine.noteOn(s,o,a):this._enginePromise?.then(e=>{this._disposed||e.noteOn(s,o,a)})}triggerRelease(e,t){if(null==this._currentNodeId||this._disposed)return;const n=this._currentNodeId;this._currentNodeId=null,this._engine?this._engine.noteOff(n):this._enginePromise?.then(e=>{this._disposed||e.noteOff(n)})}set(e,t){const n=this._config.params.find(t=>t.name===e);if(n&&(n.value=t),null==this._currentNodeId||this._disposed)return;const s=this._currentNodeId;this._engine?this._engine.setNodeParams(s,{[e]:t}):this._enginePromise?.then(n=>{this._disposed||this._currentNodeId!==s||n.setNodeParams(s,{[e]:t})})}updateConfig(e){const t=e.binary!==this._config.binary;this._config=e,t&&e.binary&&this._engine&&this._loadBinary(this._engine,e.binary)}dispose(){this._disposed||(this._disposed=!0,null!=this._currentNodeId&&(this._engine?.noteOff(this._currentNodeId),this._currentNodeId=null),this._gainNode.disconnect())}}const Ui=2048;function Ri(e){const t=new Float32Array(Ui),n=new Float32Array(Ui);switch(e){case"sine":n[1]=1;break;case"saw":for(let e=1;e<1024;e++)n[e]=2/(e*Math.PI)*(e%2==0?1:-1);break;case"square":for(let e=1;e<1024;e+=2)n[e]=4/(e*Math.PI);break;case"triangle":for(let e=1;e<1024;e+=2)n[e]=8/(Math.PI*Math.PI*e*e)*((e-1)/2%2==0?1:-1)}return{real:t,imag:n}}function ji(e){const t=new Float32Array(Ui),n=new Float32Array(Ui);for(let s=1;s<1024;s++)n[s]=2/(s*Math.PI)*Math.sin(s*Math.PI*e);return{real:t,imag:n}}function Xi(e,t,n){const s=new Float32Array(Ui),a=new Float32Array(Ui),o=[e,t,n],r=[100,150,200];for(let i=1;i<1024;i++){const e=100*i;let t=0;for(let n=0;n<o.length;n++){const s=Math.abs(e-o[n]);t+=Math.exp(-s*s/(2*r[n]*r[n]))}a[i]=t/(.5*i+1)}return{real:s,imag:a}}const zi=[{id:"basic-saw",name:"Saw",category:"Basic",frames:[Ri("saw")]},{id:"basic-square",name:"Square",category:"Basic",frames:[Ri("square")]},{id:"basic-triangle",name:"Triangle",category:"Basic",frames:[Ri("triangle")]},{id:"basic-sine",name:"Sine",category:"Basic",frames:[Ri("sine")]},{id:"analog-sweep",name:"Analog Sweep",category:"Analog",frames:[Ri("sine"),Ri("triangle"),Ri("saw"),Ri("square")]},{id:"pwm",name:"PWM",category:"Analog",frames:[ji(.1),ji(.25),ji(.5),ji(.75),ji(.9)]},{id:"saw-stack",name:"Saw Stack",category:"Analog",frames:[Ri("saw"),(()=>{const e=Ri("saw");for(let t=1;t<1024;t++){const n=.1*Math.PI*t,s=Math.cos(n),a=Math.sin(n),o=e.real[t],r=e.imag[t];e.real[t]=o*s-r*a,e.imag[t]=o*a+r*s}return e})()]},{id:"digital-harmonics",name:"Digital",category:"Digital",frames:[(()=>{const e=new Float32Array(Ui),t=new Float32Array(Ui);for(let n=1;n<32;n+=2)t[n]=1/n;return{real:e,imag:t}})(),(()=>{const e=new Float32Array(Ui),t=new Float32Array(Ui);for(let n=2;n<32;n+=2)t[n]=1/n;return{real:e,imag:t}})()]},{id:"vocal-a",name:"Vocal A",category:"Vocal",frames:[Xi(800,1200,2800)]},{id:"vocal-morph",name:"Vocal Morph",category:"Vocal",frames:[Xi(300,2300,3e3),Xi(500,1800,2500),Xi(800,1200,2800),Xi(450,800,2500),Xi(300,600,2300)]},{id:"metallic",name:"Metallic",category:"FX",frames:[(()=>{const e=new Float32Array(Ui),t=new Float32Array(Ui);return[1,2.756,5.404,8.933,13.344].forEach((e,n)=>{const s=Math.round(e);s<1024&&(t[s]=1/(n+1))}),{real:e,imag:t}})()]}];function Gi(e,t){if(1===e.frames.length)return e.frames[0];const n=t*(e.frames.length-1),s=Math.floor(n),a=n-s;return s>=e.frames.length-1?e.frames[e.frames.length-1]:function(e,t,n){const s=new Float32Array(Ui),a=new Float32Array(Ui);for(let o=0;o<Ui;o++)s[o]=e.real[o]*(1-n)+t.real[o]*n,a[o]=e.imag[o]*(1-n)+t.imag[o]*n;return{real:s,imag:a}}(e.frames[s],e.frames[s+1],a)}class Hi{name="WavetableSynth";output;voices=new Map;voicePool=[];config;audioContext;filter;outputGain;baseMorphPosition=0;constructor(e){this.config=e,this.audioContext=oo(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.filter=this.audioContext.createBiquadFilter(),this.filter.type=e.filter.type,this.filter.frequency.value=isFinite(e.filter.cutoff)?e.filter.cutoff:8e3,this.filter.Q.value=isFinite(e.filter.resonance)?e.filter.resonance/10:1,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=2,this.filter.connect(this.outputGain),this.outputGain.connect(this.output);for(let t=0;t<8;t++)this.voicePool.push(this.createVoice());this.baseMorphPosition=e.morphPosition/100}createVoice(){return new Wi(this.config,this.filter,this.audioContext)}getCurrentMorphPosition(){return Math.max(0,Math.min(1,this.baseMorphPosition))}triggerAttack(e,t,n=1){const s=t??fo(),a="string"==typeof e?ho(e):e,o="string"==typeof e?po(e):Math.round(69+12*Math.log2(e/440));let r=this.voicePool.pop();if(!r){const e=this.voices.keys().next().value;void 0!==e&&(r=this.voices.get(e),this.voices.delete(e))}if(r){const e=this.getCurrentMorphPosition();if(r.setMorphPosition(e),r.triggerAttack(a,s,n),this.voices.set(o,r),0!==this.config.filter.envelopeAmount){const e=this.config.filter.cutoff,t=this.config.filter.envelopeAmount/100,n=Math.min(2e4,e+t*(2e4-e)),a=this.config.filterEnvelope.attack/1e3,o=this.config.filterEnvelope.decay/1e3,r=e+(n-e)*(this.config.filterEnvelope.sustain/100);this.filter.frequency.cancelScheduledValues(s),this.filter.frequency.setValueAtTime(e,s),this.filter.frequency.linearRampToValueAtTime(n,s+a),this.filter.frequency.linearRampToValueAtTime(r,s+a+o)}}}triggerRelease(e,t){const n=t??fo(),s="string"==typeof e?po(e):Math.round(69+12*Math.log2(e/440)),a=this.voices.get(s);a&&(a.triggerRelease(n),this.voices.delete(s),setTimeout(()=>{this.voicePool.push(a)},this.config.envelope.release+100))}releaseAll(){const e=fo();for(const[t,n]of this.voices.entries())n.triggerRelease(e),setTimeout(()=>{this.voicePool.push(n)},this.config.envelope.release+100),this.voices.delete(t)}triggerAttackRelease(e,t,n,s=1){const a=n??fo(),o="string"==typeof t?go(t):t;this.triggerAttack(e,a,s),this.triggerRelease(e,a+o)}setMorphPosition(e){this.baseMorphPosition=Math.max(0,Math.min(1,e));const t=this.getCurrentMorphPosition();this.voices.forEach(e=>{e.setMorphPosition(t)})}setMorphLFORate(e){this.config.morphLFORate=e}setFilterCutoff(e){this.config.filter.cutoff=e,this.filter.frequency.value=e}setFilterResonance(e){this.config.filter.resonance=e,this.filter.Q.value=e/10}updateConfig(e){this.config={...this.config,...e},e.filter&&(e.filter.type&&(this.filter.type=e.filter.type),void 0!==e.filter.cutoff&&(this.filter.frequency.value=e.filter.cutoff),void 0!==e.filter.resonance&&(this.filter.Q.value=e.filter.resonance/10))}dispose(){this.voices.forEach(e=>e.dispose()),this.voicePool.forEach(e=>e.dispose()),this.filter.disconnect(),this.outputGain.disconnect(),this.output.disconnect()}}class Wi{oscillators=[];gains=[];panners=[];config;audioContext;attackTime;decayTime;sustainLevel;releaseTime;constructor(e,t,n){this.config=e,this.audioContext=n,this.attackTime=e.envelope.attack/1e3,this.decayTime=e.envelope.decay/1e3,this.sustainLevel=e.envelope.sustain/100,this.releaseTime=e.envelope.release/1e3;const s=e.unison.voices,a=e.unison.detune,o=e.unison.stereoSpread/100;for(let r=0;r<s;r++){let e=0;s>1&&(e=(r/(s-1)*2-1)*a);let i=0;s>1&&(i=(r/(s-1)*2-1)*o);const l=n.createOscillator();l.detune.value=e;const c=n.createGain();c.gain.value=0;const u=n.createStereoPanner();u.pan.value=i,l.connect(c),c.connect(u),u.connect(t),this.oscillators.push(l),this.gains.push(c),this.panners.push(u)}this.setMorphPosition(e.morphPosition/100)}setMorphPosition(e){const t=(n=this.config.wavetableId,zi.find(e=>e.id===n));var n;if(!t)return;const s=Gi(t,e),a=Math.min(32,s.imag.length),o=new Float32Array(a+1),r=new Float32Array(a+1);for(let l=1;l<a;l++)r[l+1-1]=s.imag[l];const i=this.audioContext.createPeriodicWave(o,r,{disableNormalization:!1});this.oscillators.forEach(e=>{e.setPeriodicWave(i)})}triggerAttack(e,t,n){this.oscillators.forEach(n=>{n.frequency.setValueAtTime(e,t),n.start(t)}),this.gains.forEach(e=>{const n=e.gain;n.cancelScheduledValues(t),n.setValueAtTime(0,t),n.linearRampToValueAtTime(1,t+this.attackTime),n.linearRampToValueAtTime(this.sustainLevel,t+this.attackTime+this.decayTime)})}triggerRelease(e){this.gains.forEach(t=>{const n=t.gain;n.cancelScheduledValues(e),n.setValueAtTime(n.value,e),n.linearRampToValueAtTime(0,e+this.releaseTime)});const t=e+this.releaseTime+.1;this.oscillators.forEach(e=>{e.stop(t)})}dispose(){this.oscillators.forEach(e=>{try{e.stop()}catch{}e.disconnect()}),this.gains.forEach(e=>e.disconnect()),this.panners.forEach(e=>e.disconnect())}}class qi{audioContext;workletNode=null;isInitialized=!1;currentModel=null;outputGain;static BUILT_IN_MODELS=[{name:"Ibanez TS9",fileName:"TS9_DriveKnob.json",type:"pedal"},{name:"Ibanez Mostortion Clone",fileName:"Ibanez_Mostortion_Clone_GainKnob.json",type:"pedal"},{name:"Mooer CaliMkIV",fileName:"Mooer_CaliMkIV_GainKnob.json",type:"pedal"},{name:"Boss MT2",fileName:"BossMT2_PedalHighGain.json",type:"pedal"},{name:"Pro Co RAT Distortion",fileName:"ProcoRatPedal_HighGain.json",type:"pedal"},{name:"MXR 78",fileName:"MXR78_pedal_DistKnob.json",type:"pedal"},{name:"Ibanez TS808",fileName:"Ibanez808TubeScreamer.json",type:"pedal"},{name:"RevvG3 Pedal",fileName:"RevvG3_Pedal_GainKnob.json",type:"pedal"},{name:"Jeckyl and Hyde Distortion",fileName:"Jeckyl_and_Hyde_Distortion_DriveKnob.json",type:"pedal"},{name:"Friedman BEOD Pedal",fileName:"Friedman_BEOD_Pedal_GainKnob.json",type:"pedal"},{name:"Blackstar HT40 Clean",fileName:"BlackstarHT40_AmpClean.json",type:"amp"},{name:"Mesa Mini Rec High Gain",fileName:"MesaMiniRec_HighGain_DirectOut.json",type:"amp"},{name:"Splawn OD High Gain",fileName:"Splawn_OD_FractalFM3_HighGain.json",type:"amp"},{name:"Ethos Lead Channel",fileName:"EthosLeadChan_GainKnob.json",type:"amp"},{name:"Princeton Amp Clean",fileName:"PrincetonAmp_Clean.json",type:"amp"},{name:"Dumble Kit High Gain",fileName:"DumbleKit_HighG_DirectOut.json",type:"amp"},{name:"Blackstar HT40 Gain",fileName:"BlackstarHT40_GainKnob_SM57mic.json",type:"amp"},{name:"T-Rex Mudhoney + Pork Loin",fileName:"TRexMudhoney_plus_PorkLoin_HighGain.json",type:"pedal"},{name:"Prince Of Tone OD",fileName:"PrinceOfToneClone_OD_Knob.json",type:"pedal"},{name:"Pork Loin Pedal",fileName:"PorkLoinPedal_LowGain.json",type:"pedal"},{name:"Prince Of Tone Dist",fileName:"PrinceOfToneClone_Dist_Knob.json",type:"pedal"},{name:"Aguilar Agro Bright Bass",fileName:"AguilarAgro_Bright_Bass.json",type:"bass"},{name:"Aguilar Agro Dark Bass",fileName:"AguilarAgro_Dark_Bass.json",type:"bass"},{name:"BadCat50 Med Gain",fileName:"BadCat50_MedGain_PREAMP.json",type:"amp"},{name:"ShiftTwin Clean2",fileName:"ShiftTwin_Clean2_PREAMP.json",type:"amp"},{name:"Sovtek50 Med Gain",fileName:"Sovtek50_MedGain_DIRECT.json",type:"amp"},{name:"ShiftTwin StampedeDT",fileName:"ShiftTwin_StampedeDT_PREAMP.json",type:"amp"},{name:"Sovtek50 Dod FX56B",fileName:"Sovtek50_DodFX56B_DIRECT.json",type:"amp"},{name:"ENGL E645 Clean",fileName:"ENGL_E645_Clean_EdoardoNapoli.json",type:"amp"},{name:"Filmosound with Cab",fileName:"Filmosound_with_cab.json",type:"amp"},{name:"ENGL E430 Clean",fileName:"ENGL_E430_Clean_EdoardoNapoli.json",type:"amp"},{name:"El Coyote Trainwreck",fileName:"ElCoyote_Trainwreck_Crunch.json",type:"amp"},{name:"Supro Bold Drive",fileName:"Supro_Bold_DriveKnob.json",type:"amp"},{name:"Goat Pedal High Gain",fileName:"GoatPedal_HighGain.json",type:"pedal"},{name:"Protein Blue Pedal",fileName:"ProteinBlue_pedal_DriveKnob.json",type:"pedal"},{name:"Little Big Muff",fileName:"LittleBigMuff_HighGainPedal.json",type:"pedal"},{name:"Big Muff V6",fileName:"BigMuff_V6_T3_S5.json",type:"pedal"}];constructor(e){this.audioContext=e,this.outputGain=e.createGain(),this.outputGain.gain.value=1}async initialize(){if(!this.isInitialized)try{const e="/";await this.audioContext.audioWorklet.addModule(`${e}GuitarML.worklet.js`),this.workletNode=new AudioWorkletNode(this.audioContext,"guitarml-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1]}),this.workletNode.connect(this.outputGain),this.workletNode.port.onmessage=e=>this.handleWorkletMessage(e.data),this.isInitialized=!0}catch(e){throw e}}handleWorkletMessage(e){if("modelLoaded"===e.type)e.success}async loadModel(e){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");if(e<0||e>=qi.BUILT_IN_MODELS.length)throw new Error(`Invalid model index: ${e}`);const t=qi.BUILT_IN_MODELS[e];try{const e="/",n=await fetch(`${e}models/guitarml/${t.fileName}`);if(!n.ok)throw new Error(`Failed to fetch model: ${n.statusText}`);const s=await n.json();this.workletNode.port.postMessage({type:"loadModel",modelData:s}),this.currentModel=t}catch(n){throw n}}async loadModelFromURL(e,t){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");try{const n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch model: ${n.statusText}`);const s=await n.json();this.workletNode.port.postMessage({type:"loadModel",modelData:s}),this.currentModel={name:t,fileName:e,type:"pedal"}}catch(n){throw n}}setParameter(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setGain(e){this.setParameter("gain",e)}setCondition(e){this.setParameter("condition",e)}setDryWet(e){this.setParameter("dryWet",e)}setEnabled(e){this.setParameter("enabled",e?1:0)}setUseSRCFilter(e){this.setParameter("useSRCFilter",e?1:0)}reset(){this.workletNode&&this.workletNode.port.postMessage({type:"reset"})}connect(e){this.outputGain.connect(e)}disconnect(){this.outputGain.disconnect()}getInput(){if(!this.workletNode)throw new Error("GuitarML not initialized - call initialize() first");return this.workletNode}getOutput(){return this.outputGain}isReady(){return this.isInitialized}getCurrentModel(){return this.currentModel}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.outputGain.disconnect(),this.isInitialized=!1}}class Ki extends d{name="NeuralEffectWrapper";input;output;guitarML;_wet;_level=1;dryGain;wetGain;modelIndex;neuralOutputGain;eq3;presenceFilter;constructor(e){super(),this.modelIndex=e.modelIndex,this._wet=e.wet??1;const t=ro(this.context);this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-this._wet),this.wetGain=new m(this._wet),this.guitarML=new qi(t),this.neuralOutputGain=new m(1),this.eq3=new f({low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500}),this.presenceFilter=new h({type:"highshelf",frequency:4e3,gain:0,Q:.7}),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.neuralOutputGain.connect(this.eq3),this.eq3.connect(this.presenceFilter),this.presenceFilter.connect(this.wetGain),this.wetGain.connect(this.output)}async loadModel(){await this.guitarML.initialize();const e=co(this.input),t=e?._nativeAudioNode||e;t&&t.connect(this.guitarML.getInput());const n=co(this.neuralOutputGain),s=n?._nativeAudioNode||n;s&&this.guitarML.getOutput().connect(s),await this.guitarML.loadModel(this.modelIndex)}setParameter(e,t){const n=Math.max(0,Math.min(100,t))/100;switch(e){case"drive":case"gain":case"condition":{const e=qi.BUILT_IN_MODELS[this.modelIndex];e?.fileName.includes("Knob")??!1?this.guitarML.setCondition(n):this.guitarML.setGain(24*n-12);break}case"dryWet":this.guitarML.setDryWet(n);break;case"level":case"output":this._level=n,this.wetGain.gain.value=this._level*this._wet;break;case"tone":case"presence":this.presenceFilter.gain.value=20*(n-.5);break;case"bass":this.eq3.low.value=30*(n-.5);break;case"mid":this.eq3.mid.value=30*(n-.5);break;case"treble":this.eq3.high.value=30*(n-.5)}}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet*this._level,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.guitarML.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.neuralOutputGain.dispose(),this.eq3.dispose(),this.presenceFilter.dispose(),this}}const $i=Object.freeze(Object.defineProperty({__proto__:null,NeuralEffectWrapper:Ki},Symbol.toStringTag,{value:"Module"}));class Yi extends d{name="SpaceEcho";input;output;head1;head2;head3;head1Gain;head2Gain;head3Gain;feedbackGain;saturation;eq;reverb;reverbGain;echoGain;wowLFO;wowGain;dryGain;wetGain;_options;constructor(e={}){super(),this._options={mode:e.mode??4,rate:e.rate??300,intensity:e.intensity??.5,echoVolume:e.echoVolume??.8,reverbVolume:e.reverbVolume??.3,bass:e.bass??0,treble:e.treble??0,wow:e.wow??.15,wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.head1=new g(this._options.rate/1e3),this.head2=new g(2*this._options.rate/1e3),this.head3=new g(3*this._options.rate/1e3),this.head1Gain=new m(0),this.head2Gain=new m(0),this.head3Gain=new m(0),this.reverb=new b({decay:2.5,preDelay:.01}),this.reverb.generate(),this.reverbGain=new m(this._options.reverbVolume),this.echoGain=new m(this._options.echoVolume),this.feedbackGain=new m(this._options.intensity),this.saturation=new v(.1),this.eq=new f({low:this._options.bass,mid:0,high:this._options.treble,lowFrequency:200,highFrequency:2500}),this.wowLFO=new y(.5+.2*Math.random(),-.002,.002),this.wowLFO.type="sine",this.wowGain=new m(this._options.wow),this.wowLFO.connect(this.wowGain),this.wowLFO.start(),this.wowGain.connect(this.head1.delayTime),this.wowGain.connect(this.head2.delayTime),this.wowGain.connect(this.head3.delayTime),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.head1),this.input.connect(this.head2),this.input.connect(this.head3),this.input.connect(this.reverb),this.head1.connect(this.head1Gain),this.head2.connect(this.head2Gain),this.head3.connect(this.head3Gain);const t=new m(1);this.head1Gain.connect(t),this.head2Gain.connect(t),this.head3Gain.connect(t),t.connect(this.echoGain),this.echoGain.connect(this.eq),this.eq.connect(this.saturation),this.saturation.connect(this.feedbackGain),this.feedbackGain.connect(this.head1),this.feedbackGain.connect(this.head2),this.feedbackGain.connect(this.head3),this.reverb.connect(this.reverbGain),this.eq.connect(this.wetGain),this.reverbGain.connect(this.wetGain),this.wetGain.connect(this.output),this.setMode(this._options.mode)}setMode(e){this._options.mode=e;const t=[1,5,8,10,11].includes(e),n=[2,4,6,8,9,11].includes(e),s=[3,4,7,9,10,11].includes(e);this.head1Gain.gain.rampTo(t?1:0,.1),this.head2Gain.gain.rampTo(n?1:0,.1),this.head3Gain.gain.rampTo(s?1:0,.1);const a=e>=5;this.reverbGain.gain.rampTo(a?this._options.reverbVolume:0,.1)}setRate(e){this._options.rate=e,this.head1.delayTime.rampTo(e/1e3,.1),this.head2.delayTime.rampTo(2*e/1e3,.1),this.head3.delayTime.rampTo(3*e/1e3,.1)}setIntensity(e){this._options.intensity=e,this.feedbackGain.gain.rampTo(e,.1)}setEchoVolume(e){this._options.echoVolume=e,this.echoGain.gain.rampTo(e,.1)}setReverbVolume(e){this._options.reverbVolume=e,this._options.mode>=5&&this.reverbGain.gain.rampTo(e,.1)}setBass(e){this._options.bass=e,this.eq.low.value=e}setTreble(e){this._options.treble=e,this.eq.high.value=e}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.head1.dispose(),this.head2.dispose(),this.head3.dispose(),this.head1Gain.dispose(),this.head2Gain.dispose(),this.head3Gain.dispose(),this.feedbackGain.dispose(),this.reverb.dispose(),this.reverbGain.dispose(),this.echoGain.dispose(),this.eq.dispose(),this.saturation.dispose(),this.wowLFO.dispose(),this.wowGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const Ji=Object.freeze(Object.defineProperty({__proto__:null,SpaceEchoEffect:Yi},Symbol.toStringTag,{value:"Module"}));function Qi(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}let Zi=null,el=null,tl=!1,nl=null;class sl extends d{name="SpaceyDelayer";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={firstTap:e.firstTap??250,tapSize:e.tapSize??150,feedback:Math.min(e.feedback??40,95),multiTap:e.multiTap??1,tapeFilter:e.tapeFilter??0,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new m(1),this.output=new m(1),this.dryGain=new m(Math.max(.2,1-this._options.wet)),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initialize()}async initialize(){try{const e=ro(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await sl.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"spacey-delayer-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("firstTap",this._options.firstTap),this.sendParam("tapSize",this._options.tapSize),this.sendParam("feedback",this._options.feedback),this.sendParam("multiTap",this._options.multiTap),this.sendParam("tapeFilter",this._options.tapeFilter),this.dryGain.gain.value=1-this._options.wet):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Zi,jsCode:el}),Qi(this.input).connect(this.workletNode),this.workletNode.connect(Qi(this.wetGain))}catch(e){}}static async ensureModuleLoaded(e){if(!tl){if(nl)return nl;nl=(async()=>{try{await e.audioWorklet.addModule("/spacey-delayer/SpaceyDelayer.worklet.js")}catch(t){const e=t instanceof Error?t.message:String(t);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load SpaceyDelayer worklet: ${e}`)}if(!Zi||!el){const[e,t]=await Promise.all([fetch("/spacey-delayer/SpaceyDelayer.wasm"),fetch("/spacey-delayer/SpaceyDelayer.js")]);if(!e.ok||!t.ok)throw nl=null,new Error(`Failed to fetch SpaceyDelayer WASM/JS: wasm=${e.status} js=${t.status}`);Zi=await e.arrayBuffer();let n=await t.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),n+="\nvar createSpaceyDelayer = createSpaceyDelayer || Module;",el=n}tl=!0})();try{await nl}catch(t){throw nl=null,tl=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setFirstTap(e){this._options.firstTap=Math.max(10,Math.min(e,2e3)),this.sendParam("firstTap",this._options.firstTap)}setTapSize(e){this._options.tapSize=Math.max(10,Math.min(e,1e3)),this.sendParam("tapSize",this._options.tapSize)}setFeedback(e){this._options.feedback=Math.max(0,Math.min(e,95)),this.sendParam("feedback",this._options.feedback)}setMultiTap(e){this._options.multiTap=e?1:0,this.sendParam("multiTap",e?1:0)}setTapeFilter(e){this._options.tapeFilter=e?1:0,this.sendParam("tapeFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const al=Object.freeze(Object.defineProperty({__proto__:null,SpaceyDelayerEffect:sl},Symbol.toStringTag,{value:"Module"}));function ol(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}let rl=null,il=null,ll=!1,cl=null;class ul extends d{name="RETapeEcho";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={mode:Math.max(0,Math.min(e.mode??3,5)),repeatRate:Math.max(0,Math.min(e.repeatRate??.5,1)),intensity:Math.max(0,Math.min(e.intensity??.5,1)),echoVolume:Math.max(0,Math.min(e.echoVolume??.8,1)),wow:Math.max(0,Math.min(e.wow??0,1)),flutter:Math.max(0,Math.min(e.flutter??0,1)),dirt:Math.max(0,Math.min(e.dirt??0,1)),inputBleed:e.inputBleed??0,loopAmount:Math.max(0,Math.min(e.loopAmount??0,1)),playheadFilter:e.playheadFilter??1,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new m(1),this.output=new m(1),this.dryGain=new m(Math.max(.2,1-this._options.wet)),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initialize()}async initialize(){try{const e=ro(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await ul.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"re-tape-echo-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("mode",this._options.mode),this.sendParam("repeatRate",this._options.repeatRate),this.sendParam("intensity",this._options.intensity),this.sendParam("echoVolume",this._options.echoVolume),this.sendParam("wow",this._options.wow),this.sendParam("flutter",this._options.flutter),this.sendParam("dirt",this._options.dirt),this.sendParam("inputBleed",this._options.inputBleed),this.sendParam("loopAmount",this._options.loopAmount),this.sendParam("playheadFilter",this._options.playheadFilter),this.dryGain.gain.value=1-this._options.wet):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:rl,jsCode:il}),ol(this.input).connect(this.workletNode),this.workletNode.connect(ol(this.wetGain))}catch(e){}}static async ensureModuleLoaded(e){if(!ll){if(cl)return cl;cl=(async()=>{try{await e.audioWorklet.addModule("/re-tape-echo/RETapeEcho.worklet.js")}catch(t){const e=t instanceof Error?t.message:String(t);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load RETapeEcho worklet: ${e}`)}if(!rl||!il){const[e,t]=await Promise.all([fetch("/re-tape-echo/RETapeEcho.wasm"),fetch("/re-tape-echo/RETapeEcho.js")]);if(!e.ok||!t.ok)throw cl=null,new Error(`Failed to fetch RETapeEcho WASM/JS: wasm=${e.status} js=${t.status}`);rl=await e.arrayBuffer();let n=await t.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),n+="\nvar createRETapeEcho = createRETapeEcho || Module;",il=n}ll=!0})();try{await cl}catch(t){throw cl=null,ll=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setMode(e){this._options.mode=Math.max(0,Math.min(Math.round(e),5)),this.sendParam("mode",this._options.mode)}setRepeatRate(e){this._options.repeatRate=Math.max(0,Math.min(e,1)),this.sendParam("repeatRate",this._options.repeatRate)}setIntensity(e){this._options.intensity=Math.max(0,Math.min(e,1)),this.sendParam("intensity",this._options.intensity)}setEchoVolume(e){this._options.echoVolume=Math.max(0,Math.min(e,1)),this.sendParam("echoVolume",this._options.echoVolume)}setWow(e){this._options.wow=Math.max(0,Math.min(e,1)),this.sendParam("wow",this._options.wow)}setFlutter(e){this._options.flutter=Math.max(0,Math.min(e,1)),this.sendParam("flutter",this._options.flutter)}setDirt(e){this._options.dirt=Math.max(0,Math.min(e,1)),this.sendParam("dirt",this._options.dirt)}setInputBleed(e){this._options.inputBleed=e?1:0,this.sendParam("inputBleed",e?1:0)}setLoopAmount(e){this._options.loopAmount=Math.max(0,Math.min(e,1)),this.sendParam("loopAmount",this._options.loopAmount)}setPlayheadFilter(e){this._options.playheadFilter=e?1:0,this.sendParam("playheadFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const dl=Object.freeze(Object.defineProperty({__proto__:null,RETapeEchoEffect:ul},Symbol.toStringTag,{value:"Module"}));class ml extends d{name="BiPhase";input;output;phaserA;phaserB;parallelInB;seriesInB;outputA;outputB;dryGain;wetGain;_options;constructor(e={}){super(),this._options={rateA:e.rateA??.5,depthA:e.depthA??.6,rateB:e.rateB??4,depthB:e.depthB??.4,feedback:e.feedback??.3,routing:e.routing??"parallel",wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.phaserA=new x({frequency:this._options.rateA,octaves:5*this._options.depthA,baseFrequency:350,stages:6,Q:20*this._options.feedback}),this.phaserB=new x({frequency:this._options.rateB,octaves:5*this._options.depthB,baseFrequency:450,stages:6,Q:20*this._options.feedback}),this.parallelInB=new m(0),this.seriesInB=new m(0),this.outputA=new m(1),this.outputB=new m(1),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.phaserA),this.input.connect(this.parallelInB),this.parallelInB.connect(this.phaserB),this.phaserA.connect(this.seriesInB),this.seriesInB.connect(this.phaserB),this.phaserA.connect(this.outputA),this.outputA.connect(this.wetGain),this.phaserB.connect(this.outputB),this.outputB.connect(this.wetGain),this.wetGain.connect(this.output),this.setRouting(this._options.routing)}setRouting(e){this._options.routing=e,"parallel"===e?(this.parallelInB.gain.rampTo(1,.1),this.seriesInB.gain.rampTo(0,.1),this.outputA.gain.rampTo(1,.1),this.outputB.gain.rampTo(1,.1)):(this.parallelInB.gain.rampTo(0,.1),this.seriesInB.gain.rampTo(1,.1),this.outputA.gain.rampTo(0,.1),this.outputB.gain.rampTo(1,.1))}setRateA(e){this._options.rateA=e,this.phaserA.frequency.rampTo(e,.1)}setDepthA(e){this._options.depthA=e,this.phaserA.octaves=5*e}setRateB(e){this._options.rateB=e,this.phaserB.frequency.rampTo(e,.1)}setDepthB(e){this._options.depthB=e,this.phaserB.octaves=5*e}setFeedback(e){this._options.feedback=e;const t=20*e;this.phaserA.Q.value=t,this.phaserB.Q.value=t}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.phaserA.dispose(),this.phaserB.dispose(),this.parallelInB.dispose(),this.seriesInB.dispose(),this.outputA.dispose(),this.outputB.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const pl=Object.freeze(Object.defineProperty({__proto__:null,BiPhaseEffect:ml},Symbol.toStringTag,{value:"Module"}));class hl extends d{name="DubFilter";input;output;filter;drive;gainNode;dryGain;wetGain;_options;constructor(e={}){super(),this._options={cutoff:e.cutoff??20,resonance:e.resonance??1,gain:e.gain??1,wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.filter=new h({frequency:this._options.cutoff,type:"highpass",rolloff:-24,Q:this._options.resonance/100*20}),this.drive=new v({distortion:.1,wet:.5}),this.gainNode=new m(this._options.gain),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.filter),this.filter.connect(this.drive),this.drive.connect(this.gainNode),this.gainNode.connect(this.wetGain),this.wetGain.connect(this.output)}setCutoff(e){this._options.cutoff=e,this.filter.frequency.rampTo(e,.05)}setResonance(e){this._options.resonance=e;const t=e/100*20;this.filter.Q.rampTo(t,.1)}setGain(e){this._options.gain=e,this.gainNode.gain.rampTo(e,.1)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.filter.dispose(),this.drive.dispose(),this.gainNode.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const fl=Object.freeze(Object.defineProperty({__proto__:null,DubFilterEffect:hl},Symbol.toStringTag,{value:"Module"})),gl={Hyperion:0,Krajeski:1,Stilson:2,Microtracker:3,Improved:4,Oberheim:5},bl={LP2:0,LP4:1,BP2:2,BP4:3,HP2:4,HP4:5,NOTCH:6};function vl(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class yl extends d{name="MoogFilter";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;pendingParams=[];fallbackNode=null;fallbackFilter=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={cutoff:e.cutoff??1e3,resonance:e.resonance??.1,drive:e.drive??1,model:e.model??gl.Hyperion,filterMode:e.filterMode??bl.LP4,wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setCutoff(e){this._options.cutoff=Math.max(20,Math.min(2e4,e)),this.sendParam(1,this._options.cutoff),this.fallbackFilter&&this.fallbackFilter.setCutoff(this._options.cutoff)}setResonance(e){this._options.resonance=Math.max(0,Math.min(1,e)),this.sendParam(2,this._options.resonance),this.fallbackFilter&&this.fallbackFilter.setResonance(this._options.resonance)}setDrive(e){this._options.drive=Math.max(.1,Math.min(4,e)),this.sendParam(3,this._options.drive)}setModel(e){this._options.model=e,this.sendParam(0,e)}setFilterMode(e){this._options.filterMode=e,this.sendParam(4,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=N().rawContext;if(await yl.ensureInitialized(e),!yl.wasmBinary||!yl.jsCode)return;this.workletNode=new AudioWorkletNode(e,"moogfilters-processor"),this.workletNode.port.onmessage=e=>{if("ready"===e.data.type){this.isWasmReady=!0,this.sendParam(0,this._options.model),this.sendParam(1,this._options.cutoff),this.sendParam(2,this._options.resonance),this.sendParam(3,this._options.drive),this.sendParam(4,this._options.filterMode),this.sendParam(5,1);for(const{paramId:e,value:t}of this.pendingParams)this.sendParam(e,t);this.pendingParams=[],this.swapToWasm()}else e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:yl.wasmBinary,jsCode:yl.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/moogfilters/MoogFilters.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,t]=await Promise.all([fetch("/moogfilters/MoogFilters.wasm"),fetch("/moogfilters/MoogFilters.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(t){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=N().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackFilter=new xl(e.sampleRate),this.fallbackFilter.setCutoff(this._options.cutoff),this.fallbackFilter.setResonance(this._options.resonance);let t=0;this.fallbackNode.onaudioprocess=e=>{const n=e.inputBuffer.getChannelData(0),s=e.inputBuffer.getChannelData(1),a=e.outputBuffer.getChannelData(0),o=e.outputBuffer.getChannelData(1);this.fallbackFilter.process(n,s,a,o),t++};const n=vl(this.input),s=vl(this.wetGain);n.connect(this.fallbackNode),this.fallbackNode.connect(s);const a=e.createGain();a.gain.value=0,this.fallbackNode.connect(a),a.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=N().rawContext,t=vl(this.input),n=vl(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(n),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const s=e.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady?this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t}):(this.pendingParams=this.pendingParams.filter(t=>t.paramId!==e),this.pendingParams.push({paramId:e,value:t}))}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}class xl{sampleRate;stateL=new Float64Array(5);delayL=new Float64Array(5);stateR=new Float64Array(5);delayR=new Float64Array(5);wc=0;g=0;gRes=0;gComp=1;drive=1;constructor(e){this.sampleRate=e,this.setCutoff(1e3),this.setResonance(.1)}setCutoff(e){this.wc=2*Math.PI*e/this.sampleRate,this.g=.9892*this.wc-.4342*this.wc**2+.1381*this.wc**3-.0202*this.wc**4,this.updateResonance()}setResonance(e){this._resonance=e,this.updateResonance()}_resonance=.1;updateResonance(){this.gRes=this._resonance*(1.0029+.0526*this.wc-.926*this.wc**2+.0218*this.wc**3)}process(e,t,n,s){const a=e.length,{stateL:o,delayL:r,stateR:i,delayR:l,g:c,gRes:u,gComp:d,drive:m}=this;for(let p=0;p<a;p++){o[0]=Math.tanh(m*(e[p]-4*u*(o[4]-d*e[p])));for(let e=0;e<4;e++)o[e+1]=Nl(c*(.3/1.3*o[e]+1/1.3*r[e]-o[e+1])+o[e+1]),r[e]=o[e];n[p]=o[4],i[0]=Math.tanh(m*(t[p]-4*u*(i[4]-d*t[p])));for(let e=0;e<4;e++)i[e+1]=Nl(c*(.3/1.3*i[e]+1/1.3*l[e]-i[e+1])+i[e+1]),l[e]=i[e];s[p]=i[4]}}}function Nl(e){return Math.min(Math.max(e,-1e30),1e30)}const wl=Object.freeze(Object.defineProperty({__proto__:null,MoogFilterEffect:yl,MoogFilterMode:bl,MoogFilterModel:gl},Symbol.toStringTag,{value:"Module"}));function El(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class kl extends d{name="MVerb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;pendingParams=[];fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={damping:e.damping??.5,density:e.density??.5,bandwidth:e.bandwidth??.5,decay:e.decay??.7,predelay:e.predelay??0,size:e.size??.8,gain:e.gain??1,mix:e.mix??.4,earlyMix:e.earlyMix??.5,wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setDamping(e){this._options.damping=Dl(e),this.sendParam(0,e)}setDensity(e){this._options.density=Dl(e),this.sendParam(1,e)}setBandwidth(e){this._options.bandwidth=Dl(e),this.sendParam(2,e)}setDecay(e){this._options.decay=Dl(e),this.sendParam(3,e)}setPredelay(e){this._options.predelay=Dl(e),this.sendParam(4,e)}setSize(e){this._options.size=Dl(e),this.sendParam(5,e)}setGain(e){this._options.gain=Dl(e),this.sendParam(6,e)}setMix(e){this._options.mix=Dl(e),this.sendParam(7,e)}setEarlyMix(e){this._options.earlyMix=Dl(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Dl(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=N().rawContext;if(await kl.ensureInitialized(e),!kl.wasmBinary||!kl.jsCode)return;this.workletNode=new AudioWorkletNode(e,"mverb-processor"),this.workletNode.port.onmessage=e=>{if("ready"===e.data.type){this.isWasmReady=!0,this.sendParam(0,this._options.damping),this.sendParam(1,this._options.density),this.sendParam(2,this._options.bandwidth),this.sendParam(3,this._options.decay),this.sendParam(4,this._options.predelay),this.sendParam(5,this._options.size),this.sendParam(6,this._options.gain),this.sendParam(7,1),this.sendParam(8,this._options.earlyMix);for(const{paramId:e,value:t}of this.pendingParams)this.sendParam(e,t);this.pendingParams=[],this.swapToWasm()}else e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:kl.wasmBinary,jsCode:kl.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/mverb/MVerb.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,t]=await Promise.all([fetch("/mverb/MVerb.wasm"),fetch("/mverb/MVerb.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(t){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=N().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new Sl(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),s=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,n,s,a)};const t=El(this.input),n=El(this.wetGain);t.connect(this.fallbackNode),this.fallbackNode.connect(n);const s=e.createGain();s.gain.value=0,this.fallbackNode.connect(s),s.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=N().rawContext,t=El(this.input),n=El(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(n),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const s=e.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady?this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t}):(this.pendingParams=this.pendingParams.filter(t=>t.paramId!==e),this.pendingParams.push({paramId:e,value:t}))}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function Dl(e){return Math.max(0,Math.min(1,e))}class Sl{combs;allpasses;constructor(e){const t=e/44100;this.combs=[new Ml(Math.round(1116*t),.84),new Ml(Math.round(1188*t),.84),new Ml(Math.round(1277*t),.84),new Ml(Math.round(1356*t),.84)],this.allpasses=[new Cl(Math.round(556*t),.5),new Cl(Math.round(441*t),.5)]}process(e,t,n,s){const a=e.length;for(let o=0;o<a;o++){const a=.5*(e[o]+t[o]);let r=0;for(const e of this.combs)r+=e.process(a);r*=.25;for(const e of this.allpasses)r=e.process(r);n[o]=r,s[o]=r}}}class Ml{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index];return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,t}}class Cl{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index],n=-e+t;return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,n}}const Vl=Object.freeze(Object.defineProperty({__proto__:null,MVerbEffect:kl},Symbol.toStringTag,{value:"Module"}));function Pl(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class _l extends d{name="Leslie";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;pendingParams=[];fallbackNode=null;fallbackLeslie=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={speed:e.speed??0,hornRate:e.hornRate??6.8,drumRate:e.drumRate??5.9,hornDepth:e.hornDepth??.7,drumDepth:e.drumDepth??.5,doppler:e.doppler??.5,mix:e.mix??1,width:e.width??.8,acceleration:e.acceleration??.5,wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setSpeed(e){this._options.speed=Ol(e),this.sendParam(0,e)}setHornRate(e){this._options.hornRate=Math.max(.1,Math.min(10,e)),this.sendParam(1,e)}setDrumRate(e){this._options.drumRate=Math.max(.1,Math.min(8,e)),this.sendParam(2,e)}setHornDepth(e){this._options.hornDepth=Ol(e),this.sendParam(3,e)}setDrumDepth(e){this._options.drumDepth=Ol(e),this.sendParam(4,e)}setDoppler(e){this._options.doppler=Ol(e),this.sendParam(5,e)}setMix(e){this._options.mix=Ol(e),this.sendParam(6,e)}setWidth(e){this._options.width=Ol(e),this.sendParam(7,e)}setAcceleration(e){this._options.acceleration=Ol(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Ol(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=N().rawContext;if(await _l.ensureInitialized(e),!_l.wasmBinary||!_l.jsCode)return;this.workletNode=new AudioWorkletNode(e,"leslie-processor"),this.workletNode.port.onmessage=e=>{if("ready"===e.data.type){this.isWasmReady=!0,this.sendParam(0,this._options.speed),this.sendParam(1,this._options.hornRate),this.sendParam(2,this._options.drumRate),this.sendParam(3,this._options.hornDepth),this.sendParam(4,this._options.drumDepth),this.sendParam(5,this._options.doppler),this.sendParam(6,1),this.sendParam(7,this._options.width),this.sendParam(8,this._options.acceleration);for(const{paramId:e,value:t}of this.pendingParams)this.sendParam(e,t);this.pendingParams=[],this.swapToWasm()}else e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:_l.wasmBinary,jsCode:_l.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/leslie/Leslie.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,t]=await Promise.all([fetch("/leslie/Leslie.wasm"),fetch("/leslie/Leslie.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(t){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=N().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackLeslie=new Tl(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),s=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1);this.fallbackLeslie.process(t,n,s,a)};const t=Pl(this.input),n=Pl(this.wetGain);t.connect(this.fallbackNode),this.fallbackNode.connect(n);const s=e.createGain();s.gain.value=0,this.fallbackNode.connect(s),s.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=N().rawContext,t=Pl(this.input),n=Pl(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(n),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const s=e.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady?this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t}):(this.pendingParams=this.pendingParams.filter(t=>t.paramId!==e),this.pendingParams.push({paramId:e,value:t}))}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function Ol(e){return Math.max(0,Math.min(1,e))}class Tl{phase=0;rate=6.8;sampleRate;constructor(e){this.sampleRate=e}process(e,t,n,s){const a=e.length;for(let o=0;o<a;o++){const a=Math.sin(2*this.phase*Math.PI),r=.7+.3*a;n[o]=e[o]*r,s[o]=t[o]*(.7-.3*a),this.phase+=this.rate/this.sampleRate,this.phase>=1&&(this.phase-=1)}}}const Ll=Object.freeze(Object.defineProperty({__proto__:null,LeslieEffect:_l},Symbol.toStringTag,{value:"Module"}));function Al(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class Bl extends d{name="SpringReverb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;pendingParams=[];fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={decay:e.decay??.6,damping:e.damping??.4,tension:e.tension??.5,mix:e.mix??.35,drip:e.drip??.5,diffusion:e.diffusion??.7,wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setDecay(e){this._options.decay=Il(e),this.sendParam(0,e)}setDamping(e){this._options.damping=Il(e),this.sendParam(1,e)}setTension(e){this._options.tension=Il(e),this.sendParam(2,e)}setSpringMix(e){this._options.mix=Il(e),this.sendParam(3,e)}setDrip(e){this._options.drip=Il(e),this.sendParam(4,e)}setDiffusion(e){this._options.diffusion=Il(e),this.sendParam(5,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Il(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=N().rawContext;if(await Bl.ensureInitialized(e),!Bl.wasmBinary||!Bl.jsCode)return;this.workletNode=new AudioWorkletNode(e,"springreverb-processor"),this.workletNode.port.onmessage=e=>{if("ready"===e.data.type){this.isWasmReady=!0,this.sendParam(0,this._options.decay),this.sendParam(1,this._options.damping),this.sendParam(2,this._options.tension),this.sendParam(3,1),this.sendParam(4,this._options.drip),this.sendParam(5,this._options.diffusion);for(const{paramId:e,value:t}of this.pendingParams)this.sendParam(e,t);this.pendingParams=[],this.swapToWasm()}else e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:Bl.wasmBinary,jsCode:Bl.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/springreverb/SpringReverb.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,t]=await Promise.all([fetch("/springreverb/SpringReverb.wasm"),fetch("/springreverb/SpringReverb.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(t){}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}initFallback(){try{const e=N().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new Fl(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),s=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,n,s,a)};const t=Al(this.input),n=Al(this.wetGain);t.connect(this.fallbackNode),this.fallbackNode.connect(n);const s=e.createGain();s.gain.value=0,this.fallbackNode.connect(s),s.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=N().rawContext,t=Al(this.input),n=Al(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(n),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const s=e.createGain();s.gain.value=0,this.workletNode.connect(s),s.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady?this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t}):(this.pendingParams=this.pendingParams.filter(t=>t.paramId!==e),this.pendingParams.push({paramId:e,value:t})),this.usingFallback&&this.fallbackReverb&&(0===e&&this.fallbackReverb.setFeedback(t),1===e&&this.fallbackReverb.setDamping(t))}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function Il(e){return Math.max(0,Math.min(1,e))}class Fl{combs;dampingCoeff=.4;constructor(e){const t=e/44100;this.combs=[{buffer:new Float32Array(Math.round(1116*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1188*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1277*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1356*t)),index:0,feedback:.8,lp:0}]}setFeedback(e){const t=.5+.45*Il(e);for(const n of this.combs)n.feedback=t}setDamping(e){this.dampingCoeff=.1+.8*Il(e)}process(e,t,n,s){const a=e.length,o=this.dampingCoeff;for(let r=0;r<a;r++){const a=.5*(e[r]+t[r]);let i=0;for(const e of this.combs){const t=e.buffer[e.index];e.lp=t+o*(e.lp-t),e.buffer[e.index]=a+e.lp*e.feedback,e.index=(e.index+1)%e.buffer.length,i+=t}i*=.25,n[r]=i,s[r]=i}}}const Ul=Object.freeze(Object.defineProperty({__proto__:null,SpringReverbEffect:Bl},Symbol.toStringTag,{value:"Module"}));function Rl(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}function jl(e){return Math.max(0,Math.min(1,e))}class Xl extends d{name="VinylNoise";input;output;dryGain;wetGain;workletNode=null;_hiss;_dust;_age;_speed;_wet;_riaa;_stylusResonance;_wornStylus;_pinch;_innerGroove;_ghostEcho;_dropout;_warp;_eccentricity;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._hiss=e.hiss??.5,this._dust=e.dust??.5,this._age=e.age??.5,this._speed=e.speed??0,this._wet=e.wet??1,this._riaa=e.riaa??.3,this._stylusResonance=e.stylusResonance??.25,this._wornStylus=e.wornStylus??0,this._pinch=e.pinch??.15,this._innerGroove=e.innerGroove??0,this._ghostEcho=e.ghostEcho??0,this._dropout=e.dropout??0,this._warp=e.warp??0,this._eccentricity=e.eccentricity??0,this.input=new m(1),this.output=new m(1),this.dryGain=new m(1),this.wetGain=new m(this._wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this._initWorklet()}async _initWorklet(){try{const e=N().rawContext;await Xl._ensureRegistered(e),this.workletNode=new AudioWorkletNode(e,"vinyl-noise-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});const t=Rl(this.input),n=Rl(this.wetGain);t.connect(this.workletNode),this.workletNode.connect(n),this._send("hiss",this._hiss),this._send("dust",this._dust),this._send("age",this._age),this._send("speed",this._speed),this._send("riaa",this._riaa),this._send("stylusResonance",this._stylusResonance),this._send("wornStylus",this._wornStylus),this._send("pinch",this._pinch),this._send("innerGroove",this._innerGroove),this._send("ghostEcho",this._ghostEcho),this._send("dropout",this._dropout),this._send("warp",this._warp),this._send("eccentricity",this._eccentricity),this._send("playing",this._playingState?1:0)}catch(e){this.input.connect(this.wetGain)}}static async _ensureRegistered(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{await e.audioWorklet.addModule("/vinylnoise/VinylNoise.worklet.js"),this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}_send(e,t){this.workletNode&&this.workletNode.port.postMessage({param:e,value:t})}setHiss(e){this._hiss=jl(e),this._send("hiss",this._hiss)}setDust(e){this._dust=jl(e),this._send("dust",this._dust)}setAge(e){this._age=jl(e),this._send("age",this._age)}setSpeed(e){this._speed=jl(e),this._send("speed",this._speed)}setRiaa(e){this._riaa=jl(e),this._send("riaa",this._riaa)}setStylusResonance(e){this._stylusResonance=jl(e),this._send("stylusResonance",this._stylusResonance)}setWornStylus(e){this._wornStylus=jl(e),this._send("wornStylus",this._wornStylus)}setPinch(e){this._pinch=jl(e),this._send("pinch",this._pinch)}setInnerGroove(e){this._innerGroove=jl(e),this._send("innerGroove",this._innerGroove)}setGhostEcho(e){this._ghostEcho=jl(e),this._send("ghostEcho",this._ghostEcho)}setDropout(e){this._dropout=jl(e),this._send("dropout",this._dropout)}setWarp(e){this._warp=jl(e),this._send("warp",this._warp)}setEccentricity(e){this._eccentricity=jl(e),this._send("eccentricity",this._eccentricity)}_playingState=!1;setPlaying(e){this._playingState=e,this._send("playing",e?1:0)}setEditorOpen(e){this._send("editorOpen",e?1:0)}get wet(){return this._wet}set wet(e){this._wet=jl(e),this.wetGain.gain.value=this._wet}dispose(){try{this.workletNode?.disconnect()}catch{}return this.workletNode=null,this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function zl(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}function Gl(e){return Math.max(0,Math.min(1,e))}class Hl extends d{name="ToneArm";input;output;dryGain;wetGain;workletNode=null;_wow;_coil;_flutter;_riaa;_stylus;_hiss;_pops;_rpm;_wet;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._wow=e.wow??0,this._coil=e.coil??.5,this._flutter=e.flutter??0,this._riaa=e.riaa??.5,this._stylus=e.stylus??0,this._hiss=e.hiss??0,this._pops=e.pops??0,this._rpm=e.rpm??33.333,this._wet=e.wet??1,this.input=new m(1),this.output=new m(1),this.dryGain=new m(1),this.wetGain=new m(this._wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this._initWorklet()}async _initWorklet(){try{const e=N().rawContext;await Hl._ensureRegistered(e),this.workletNode=new AudioWorkletNode(e,"tonearm-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});const t=zl(this.input),n=zl(this.wetGain);t.connect(this.workletNode),this.workletNode.connect(n),this._send("wow",this._wow),this._send("coil",this._coil),this._send("flutter",this._flutter),this._send("riaa",this._riaa),this._send("stylus",this._stylus),this._send("hiss",this._hiss),this._send("pops",this._pops),this._send("rpm",this._rpm),this._send("wet",this._wet)}catch(e){this.input.connect(this.wetGain)}}static async _ensureRegistered(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{await e.audioWorklet.addModule("/tonearm/ToneArm.worklet.js"),this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}_send(e,t){this.workletNode?.port.postMessage({param:e,value:t})}setWow(e){this._wow=Gl(e),this._send("wow",this._wow)}setCoil(e){this._coil=Gl(e),this._send("coil",this._coil)}setFlutter(e){this._flutter=Gl(e),this._send("flutter",this._flutter)}setRiaa(e){this._riaa=Gl(e),this._send("riaa",this._riaa)}setStylus(e){this._stylus=Gl(e),this._send("stylus",this._stylus)}setHiss(e){this._hiss=Gl(e),this._send("hiss",this._hiss)}setPops(e){this._pops=Gl(e),this._send("pops",this._pops)}setRpm(e){this._rpm=e,this._send("rpm",this._rpm)}get wet(){return this._wet}set wet(e){this._wet=Gl(e),this.wetGain.gain.value=this._wet,this._send("wet",this._wet)}get wow(){return this._wow}get coil(){return this._coil}get flutter(){return this._flutter}get riaa(){return this._riaa}get stylus(){return this._stylus}get hiss(){return this._hiss}get pops(){return this._pops}get rpm(){return this._rpm}dispose(){try{this.workletNode?.disconnect()}catch{}return this.workletNode=null,this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const Wl={"1/1":4,"1/2":2,"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125,"1/2d":3,"1/4d":1.5,"1/8d":.75,"1/16d":.375,"1/2t":4/3,"1/4t":2/3,"1/8t":1/3};function ql(e,t){return 6e4/e*Wl[t]}const Kl=[{value:"1/1",label:"1/1",category:"Straight"},{value:"1/2",label:"1/2",category:"Straight"},{value:"1/4",label:"1/4",category:"Straight"},{value:"1/8",label:"1/8",category:"Straight"},{value:"1/16",label:"1/16",category:"Straight"},{value:"1/32",label:"1/32",category:"Straight"},{value:"1/2d",label:"1/2.",category:"Dotted"},{value:"1/4d",label:"1/4.",category:"Dotted"},{value:"1/8d",label:"1/8.",category:"Dotted"},{value:"1/16d",label:"1/16.",category:"Dotted"},{value:"1/2t",label:"1/2T",category:"Triplet"},{value:"1/4t",label:"1/4T",category:"Triplet"},{value:"1/8t",label:"1/8T",category:"Triplet"}],$l={Delay:[{param:"time",unit:"seconds"}],FeedbackDelay:[{param:"time",unit:"seconds"}],PingPongDelay:[{param:"time",unit:"seconds"}],SpaceEcho:[{param:"rate",unit:"ms"}],SpaceyDelayer:[{param:"firstTap",unit:"ms"}],RETapeEcho:[{param:"repeatRate",unit:"normalized"}],Chorus:[{param:"frequency",unit:"hz"}],BiPhase:[{param:"rateA",unit:"hz"}]};function Yl(e,t,n){switch(n){case"seconds":return function(e,t){return ql(e,t)/1e3}(e,t);case"ms":default:return ql(e,t);case"hz":return function(e,t){return 1e3/ql(e,t)}(e,t);case"normalized":return Math.min(1,Math.max(0,ql(e,t)/1e3))}}function Jl(e){return 1===e.bpmSync}function Ql(e){const t=e.syncDivision;return t&&t in Wl?t:"1/8"}class Zl extends d{name="SidechainCompressor";compressor;dryGain;wetGain;sidechainInput;sidechainGainNode;sidechainAnalyser;_threshold;_ratio;_attack;_release;_knee;_sidechainGain;_wet;animationFrame=null;baseThreshold;input;output;constructor(e={}){super(),this._threshold=e.threshold??-24,this._ratio=e.ratio??4,this._attack=e.attack??.003,this._release=e.release??.25,this._knee=e.knee??6,this._sidechainGain=e.sidechainGain??1,this._wet=e.wet??1,this.baseThreshold=this._threshold,this.input=new m(1),this.output=new m(1),this.compressor=new w({threshold:this._threshold,ratio:this._ratio,attack:this._attack,release:this._release,knee:this._knee}),this.dryGain=new m(1-this._wet),this.wetGain=new m(this._wet),this.sidechainInput=new m(1),this.sidechainGainNode=new m(this._sidechainGain),this.sidechainAnalyser=new E({smoothing:.8,normalRange:!1}),this.input.connect(this.compressor),this.compressor.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.sidechainInput.connect(this.sidechainGainNode),this.sidechainGainNode.connect(this.sidechainAnalyser),this.startSidechainPolling()}getSidechainInput(){return this.sidechainInput}startSidechainPolling=()=>{this.updateSidechain()};updateSidechain=()=>{const e=this.sidechainAnalyser.getValue(),t="number"==typeof e?e:e[0];if(t>-60){const e=24*Math.min(1,Math.max(0,(t+60)/60))*this._sidechainGain;this.compressor.threshold.value=this.baseThreshold-e}else this.compressor.threshold.value=this.baseThreshold;this.animationFrame=requestAnimationFrame(this.updateSidechain)};get threshold(){return this._threshold}set threshold(e){this._threshold=Math.max(-60,Math.min(0,e)),this.baseThreshold=this._threshold,this.compressor.threshold.value=this._threshold}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.max(1,Math.min(20,e)),this.compressor.ratio.value=this._ratio}get attack(){return this._attack}set attack(e){this._attack=Math.max(.001,Math.min(.5,e)),this.compressor.attack.value=this._attack}get release(){return this._release}set release(e){this._release=Math.max(.01,Math.min(1,e)),this.compressor.release.value=this._release}get knee(){return this._knee}set knee(e){this._knee=Math.max(0,Math.min(40,e)),this.compressor.knee.value=this._knee}get sidechainGain(){return this._sidechainGain}set sidechainGain(e){this._sidechainGain=Math.max(0,Math.min(2,e)),this.sidechainGainNode.gain.value=this._sidechainGain}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}getReduction(){return this.compressor.reduction}dispose(){return null!==this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),super.dispose(),this.compressor.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.sidechainInput.dispose(),this.sidechainGainNode.dispose(),this.sidechainAnalyser.dispose(),this}}const ec=Object.freeze(Object.defineProperty({__proto__:null,SidechainCompressor:Zl},Symbol.toStringTag,{value:"Module"}));class tc{config;loop=null;currentStepIndex=0;pingPongDirection=1;baseNote="C4";baseVelocity=1;isPlaying=!1;heldNotes=new Set;onStep;onNoteOn;onNoteOff;currentPlayingNote=null;constructor(e){this.config={...e.config},this.onStep=e.onStep,this.onNoteOn=e.onNoteOn,this.onNoteOff=e.onNoteOff}getSteps(){return this.config.steps&&this.config.steps.length>0?this.config.steps:this.config.pattern&&this.config.pattern.length>0?this.config.pattern.map(e=>({noteOffset:e})):[{noteOffset:0}]}getInterval(){const{speed:e,speedUnit:t}=this.config,n=k().bpm.value;switch(t){case"hz":return 1/Math.max(1,Math.min(60,e));case"ticks":return 60/n*(e/48);case"division":return{1:"1n",2:"2n",4:"4n",8:"8n",16:"16n",32:"32n",64:"64n"}[e]||`${e}n`;default:return 1/15}}getSwingAdjustedTime(e,t){const n=(this.config.swing??0)/100;if(0===n)return e;if(t%2==0){return e+("number"==typeof this.getInterval()?this.getInterval():.066)*n*.5}return e}getNextStepIndex(){const e=this.getSteps().length;switch(this.config.mode){case"loop":default:return(this.currentStepIndex+1)%e;case"pingpong":{let t=this.currentStepIndex+this.pingPongDirection;return t>=e?(this.pingPongDirection=-1,t=e-2):t<0&&(this.pingPongDirection=1,t=1),e<=2?(this.currentStepIndex+1)%e:Math.max(0,Math.min(e-1,t))}case"oneshot":{const t=this.currentStepIndex+1;return t>=e?(this.isPlaying=!1,e-1):t}case"random":return Math.floor(Math.random()*e)}}midiToNoteName(e){const t=Math.floor(e/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}${t}`}noteNameToMidi(e){const t=e.match(/^([A-Ga-g][#b]?)(-?\d+)$/);if(!t)return 60;const n=t[1].charAt(0).toUpperCase()+t[1].slice(1);return 12*(parseInt(t[2],10)+1)+({C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n]??0)}processStep(){if(!this.isPlaying)return;const e=this.getSteps()[this.currentStepIndex];if(!e)return;if("skip"===e.effect)return void(this.currentStepIndex=this.getNextStepIndex());const t=this.noteNameToMidi(this.baseNote)+e.noteOffset,n=this.midiToNoteName(t),s=(e.volume??100)/100,a="accent"===e.effect?1.2:1,o=Math.min(1,this.baseVelocity*s*a),r=(e.gate??100)/100,i=("number"==typeof this.getInterval()?this.getInterval():D(this.getInterval()).toSeconds())*r*.95;this.currentPlayingNote&&this.onNoteOff&&this.onNoteOff(this.currentPlayingNote),this.onNoteOn&&this.onNoteOn(n,o,i),this.currentPlayingNote=n,this.onStep&&this.onStep(this.currentStepIndex,e,e.noteOffset),this.currentStepIndex=this.getNextStepIndex()}start(e,t=1){if(this.isPlaying)return this.baseNote=e,this.baseVelocity=t,void this.heldNotes.add(e);this.baseNote=e,this.baseVelocity=t,this.currentStepIndex=0,this.pingPongDirection=1,this.isPlaying=!0,this.heldNotes.add(e);const n=this.getInterval();this.loop=new S(()=>{this.processStep()},n),this.loop.start(0)}stop(e){if(e){if(this.heldNotes.delete(e),this.heldNotes.size>0){const e=Array.from(this.heldNotes)[this.heldNotes.size-1];return void(this.baseNote=e)}}else this.heldNotes.clear();this.currentPlayingNote&&this.onNoteOff&&(this.onNoteOff(this.currentPlayingNote),this.currentPlayingNote=null),this.loop&&(this.loop.stop(),this.loop.dispose(),this.loop=null),this.isPlaying=!1,this.currentStepIndex=0,this.pingPongDirection=1}stopAll(){this.heldNotes.clear(),this.stop()}updateConfig(e){if(this.config={...this.config,...e},this.loop&&this.isPlaying){const e=this.getInterval();this.loop.interval=e}"oneshot"===e.mode&&(this.currentStepIndex=0)}getCurrentStep(){return this.currentStepIndex}getIsPlaying(){return this.isPlaying}getConfig(){return{...this.config}}dispose(){this.stopAll(),this.loop&&(this.loop.dispose(),this.loop=null)}}const nc={OPN2:0,OPM:1,OPL3:2,OPLL:11,OPNA:13,OPNB:14,OPZ:22,Y8950:23,OPL4:26,OPN:47,OPNB_B:48,ESFM:49,PSG:3,AY:12,SAA:18,T6W28:43,AY8930:50,NES:4,GB:5,SNES:24,FDS:16,MMC5:17,VRC6:9,N163:8,VB:44,NDS:51,GBA_DMA:52,GBA_MINMOD:53,POKEMINI:54,PCE:6,SCC:7,SWAN:19,SM8521:37,BUBBLE:38,X1_010:41,NAMCO:55,SID:10,SID_6581:45,SID_8580:46,VIC:33,TED:34,PET:56,TIA:15,POKEY:57,LYNX:25,OKI:20,ES5506:21,SEGAPCM:27,YMZ280B:28,RF5C68:29,GA20:30,C140:31,QSOUND:32,K007232:39,K053260:40,MSM6258:58,MSM5232:59,MULTIPCM:60,AMIGA:61,VERA:36,SUPERVISION:35,UPD1771:42,PCSPKR:62,PONG:63,PV1000:64,DAVE:65,SU:66,BIFURCATOR:67,POWERNOISE:68,ZXBEEPER:69,ZXBEEPER_QT:70,SCVTONE:71,PCMDAC:72},sc="__FurnaceChipEngineInstance__";class ac{static instance=null;static instanceId=0;myInstanceId;isLoaded=!1;initPromise=null;initFailedPermanently=!1;workletNode=null;lastInitAttempt=0;writeCount=0;nativeContext=null;rawContext=null;outputGain=null;constructor(){this.myInstanceId=++ac.instanceId}static getInstance(){const e=globalThis[sc];return e?(ac.instance!==e&&(ac.instance=e),e):(ac.instance||(ac.instance=new ac,globalThis[sc]=ac.instance),ac.instance)}async init(e){if(this.isLoaded)return;if(this.initFailedPermanently)return;if(this.initPromise)return this.initPromise;const t=Date.now();return t-this.lastInitAttempt<500?void 0:(this.lastInitAttempt=t,this.initPromise=this.doInit(e),this.initPromise)}async doInit(e){try{const a=e,o=a.rawContext||a._context||e,r=ro(e);if(!o||!o.audioWorklet)return void(this.initPromise=null);if("running"!==o.state){try{await o.resume()}catch{}if("running"!==o.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===o.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const i="/",l=`?v=${Date.now()}`,c=r instanceof AudioContext?r:o,u=`${i}FurnaceChips.worklet.js${l}`;try{await c.audioWorklet.addModule(u)}catch(t){const e=t instanceof Error?t:null;if(!e?.message?.includes("already")&&"InvalidStateError"!==e?.name)return void(this.initPromise=null)}const d=`${i}FurnaceChips.wasm${l}`,m=`${i}FurnaceChips.js${l}`,[p,h]=await Promise.all([fetch(d,{cache:"no-store"}),fetch(m,{cache:"no-store"})]);if(!p.ok)return void(this.initPromise=null);if(!h.ok)return void(this.initPromise=null);const f=await p.arrayBuffer();let g=await h.text();g='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+g.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');try{this.nativeContext=r,this.workletNode=new AudioWorkletNode(c,"furnace-chips-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode}catch(t){return void(this.initPromise=null)}const b=new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4),n=s=>{"initialized"===s.data.type&&(clearTimeout(t),this.workletNode?.port.removeEventListener("message",n),e(!0))};this.workletNode.port.addEventListener("message",n),this.workletNode.port.start()});this.workletNode&&this.workletNode.port.postMessage({type:"init",wasmBinary:f,jsCode:g});if(await b){this.isLoaded=!0,this.rawContext=c;try{const e=c.createGain();e.gain.value=1,this.workletNode.connect(e),this.outputGain=e;const t=c.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(c.destination)}catch(n){try{if(r&&r.destination){const e=r.createGain();e.gain.value=1,this.workletNode.connect(e),this.outputGain=e;const t=r.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(r.destination)}}catch(s){}}this.workletNode.port.addEventListener("message",e=>{"debug"===e.data.type?e.data.msgType:e.data.type}),setTimeout(()=>{this.requestWorkletStatus()},500)}else this.initPromise=null}catch(t){this.initPromise=null}}write(e,t,n){if(this.writeCount,!this.workletNode)return this.writeCount,void this.writeCount++;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(()=>{});const s={type:"write",chipType:e,register:t,value:n,writeId:this.writeCount};this.workletNode.port.postMessage(s);const a=8===t||40===t||t>=160&&t<=167;if(this.writeCount<10||a){this.nativeContext}this.writeCount++}getDiagnostics(){return{loaded:this.isLoaded,hasWorklet:null!==this.workletNode,contextState:this.nativeContext?.state||null}}requestWorkletStatus(){this.workletNode&&this.workletNode.port.postMessage({type:"getStatus"})}testPing(){this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now()})}testWrite(){this.workletNode&&this.workletNode.port.postMessage({type:"write",chipType:0,register:255,value:170,writeId:-1})}getNativeOutput(){return this.outputGain}routeOutputTo(e){if(this.outputGain)try{this.outputGain.connect(e)}catch(t){}}getWorkletDiagnostics(){const e=null!==this.workletNode,t=null!==this.workletNode?.port;return{hasNode:e,hasPort:t,portId:t?`port-inst-${this.myInstanceId}`:"none"}}resetWriteCount(){this.writeCount=0;this.rawContext;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(e=>{}),this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now(),label:"post-reset"})}setWavetable(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",chipType:e,index:t,data:n})}setLogging(e){this.workletNode&&this.workletNode.port.postMessage({type:"setLogging",enabled:e})}async getLog(){return this.workletNode?new Promise(e=>{const t=n=>{"logData"===n.data.type&&(this.workletNode?.port.removeEventListener("message",t),e(n.data.data))};this.workletNode?.port.addEventListener("message",t),this.workletNode?.port.postMessage({type:"getLog"})}):new Uint8Array(0)}getOutput(){if(!this.workletNode)throw new Error("Engine not initialized");return this.workletNode}setOutputGain(e){this.outputGain&&this.outputGain.gain.setValueAtTime(e,this.rawContext?.currentTime||0)}getOutputGainValue(){return this.outputGain?.gain.value??1}isInitialized(){return this.isLoaded&&null!==this.workletNode}deactivate(e){this.workletNode&&this.workletNode.port.postMessage({type:"deactivate",chipType:e})}}const oc=[{id:"32x16FunkyLead",name:"Funky Lead",category:"32x16",len:32,max:15,data:[8,15,14,11,9,6,4,4,6,7,6,4,3,3,4,6,8,9,11,12,12,11,9,8,9,11,11,9,6,4,1,0]},{id:"32x16NamcoBass",name:"Namco Bass",category:"32x16",len:32,max:15,data:[7,10,12,13,14,13,12,10,7,4,2,1,0,1,2,4,7,11,13,14,13,11,7,3,1,0,1,3,7,14,7,0]},{id:"32x16ataribass",name:"Atari Bass",category:"32x16",len:32,max:15,data:[15,15,0,0,15,15,0,0,0,0,15,15,15,15,0,0,15,15,15,15,15,15,0,0,0,0,0,0,0,0,0,0]},{id:"32x16brass",name:"Brass",category:"32x16",len:32,max:15,data:[15,14,13,12,11,8,6,2,4,3,7,9,9,7,5,0,15,15,13,13,13,11,11,8,8,0,0,0,0,0,0,0]},{id:"32x16clarinet",name:"Clarinet",category:"32x16",len:32,max:15,data:[12,14,15,15,15,15,15,15,15,15,15,15,15,15,14,12,3,1,0,0,0,0,0,0,0,0,0,0,0,0,1,3]},{id:"32x16distortedsquare",name:"Distorted Square",category:"32x16",len:32,max:15,data:[14,12,10,11,14,9,10,13,9,14,10,15,13,7,14,6,5,1,6,0,3,2,4,5,0,3,2,4,2,3,6,1]},{id:"32x16eguitar",name:"E-Guitar",category:"32x16",len:32,max:15,data:[0,12,9,6,13,2,9,12,4,3,4,12,10,8,8,1,2,0,9,10,10,12,0,0,5,3,0,15,0,0,10,10]},{id:"32x16flute",name:"Flute",category:"32x16",len:32,max:15,data:[12,14,15,15,14,14,14,15,13,14,15,15,14,13,11,9,6,4,2,0,0,2,2,2,1,1,1,1,0,1,2,4]},{id:"32x16guitar",name:"Guitar",category:"32x16",len:32,max:15,data:[9,15,15,14,15,15,15,15,15,15,15,13,5,1,1,3,7,7,5,4,2,1,0,4,8,7,4,1,2,3,5,6]},{id:"32x16opllpiano",name:"OPLL Piano",category:"32x16",len:32,max:15,data:[7,13,15,15,15,15,14,11,10,12,15,14,8,3,2,4,7,11,13,13,10,4,0,2,5,5,3,1,0,0,0,1]},{id:"32x16opllvibra",name:"OPLL Vibraphone",category:"32x16",len:32,max:15,data:[5,14,12,9,8,15,15,15,14,15,12,13,15,15,11,4,7,11,9,1,0,2,4,1,1,0,0,0,4,7,4,1]},{id:"32x16reedorgan",name:"Reed Organ",category:"32x16",len:32,max:15,data:[8,12,10,11,10,12,12,13,12,15,14,13,12,13,13,9,6,2,2,3,2,1,0,3,2,3,3,5,4,5,3,7]},{id:"32x16saw",name:"Saw",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15]},{id:"32x16saw2",name:"Saw 2",category:"32x16",len:32,max:15,data:[15,14,13,12,11,10,9,8,15,14,13,12,11,10,9,8,12,14,12,10,8,6,5,4,3,3,2,2,1,1,0,0]},{id:"32x16sax",name:"Sax",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,0,15,10,11,12,13,14,15,15]},{id:"32x16slapbass",name:"Slap Bass",category:"32x16",len:32,max:15,data:[8,13,15,15,13,11,8,7,6,8,10,14,15,12,4,0,8,15,12,3,0,2,5,8,9,9,7,5,2,0,0,3]},{id:"32x16synthbass",name:"Synth Bass",category:"32x16",len:32,max:15,data:[10,9,9,8,5,7,7,5,4,4,5,7,8,9,10,10,10,9,7,6,8,10,12,12,12,11,8,4,3,2,3,1]},{id:"32x16synthbrass",name:"Synth Brass",category:"32x16",len:32,max:15,data:[2,15,5,0,0,9,15,13,11,9,12,14,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x16trumpet",name:"Trumpet",category:"32x16",len:32,max:15,data:[7,15,13,12,10,10,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,6,5,5,3,2,0,0]},{id:"32x16voice",name:"Voice",category:"32x16",len:32,max:15,data:[7,8,9,10,10,11,11,12,12,12,12,12,12,12,12,12,11,11,10,10,9,8,7,2,1,0,0,0,0,0,1,2]},{id:"32x32KeygenBass",name:"Keygen Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,23,25,27,29,30,31,31,31,31,31,31,31,31,31]},{id:"32x32accordion",name:"Accordion",category:"32x32",len:32,max:31,data:[0,8,1,13,20,23,20,17,23,17,9,9,18,17,16,26,31,26,27,24,20,14,5,12,10,18,11,15,21,12,5,11]},{id:"32x32accordion2",name:"Accordion 2",category:"32x32",len:32,max:31,data:[16,17,21,22,22,22,20,19,13,12,11,10,10,13,15,17,27,27,31,31,31,29,25,23,9,7,3,1,0,2,4,6]},{id:"32x32acousticguitar",name:"Acoustic Guitar",category:"32x32",len:32,max:31,data:[2,18,26,28,29,28,28,28,29,31,31,27,14,2,1,0,1,2,2,0,1,1,1,1,1,1,1,0,0,0,0,0]},{id:"32x32agogo",name:"Agogo",category:"32x32",len:32,max:31,data:[16,8,6,31,13,16,16,14,25,21,8,12,28,18,18,12,16,16,23,0,13,16,20,16,6,12,18,17,8,15,15,26]},{id:"32x32ataribass",name:"Atari Bass",category:"32x32",len:32,max:31,data:[31,31,31,31,31,31,31,31,0,0,0,0,0,0,0,0,31,31,31,0,0,0,31,31,31,31,31,0,0,0,0,0]},{id:"32x32bass2",name:"Bass 2",category:"32x32",len:32,max:31,data:[15,25,31,31,26,18,12,7,4,3,3,3,4,6,8,12,15,19,23,26,28,29,29,29,28,26,22,16,8,2,0,5]},{id:"32x32bass3",name:"Bass 3",category:"32x32",len:32,max:31,data:[15,15,12,7,2,0,2,7,15,24,29,31,29,24,19,16,15,16,17,18,17,17,16,15,15,15,15,14,14,13,14,15]},{id:"32x32bell",name:"Bell",category:"32x32",len:32,max:31,data:[16,31,30,16,26,25,13,28,31,15,0,0,8,4,10,26,13,4,20,30,29,30,30,19,1,9,23,9,5,11,0,0]},{id:"32x32brass",name:"Brass",category:"32x32",len:32,max:31,data:[31,31,29,27,25,23,21,19,16,14,12,10,8,6,4,2,28,26,23,21,19,17,14,12,22,20,17,15,13,11,9,6]},{id:"32x32brass2",name:"Brass 2",category:"32x32",len:32,max:31,data:[16,18,21,24,27,29,30,31,31,31,30,29,27,24,21,18,0,2,4,6,8,10,12,14,16,17,19,21,23,25,27,29]},{id:"32x32chime",name:"Chime",category:"32x32",len:32,max:31,data:[15,27,23,17,23,27,21,15,23,30,26,17,21,23,15,6,15,24,15,7,9,13,4,0,7,15,9,3,7,13,7,3]},{id:"32x32choir",name:"Choir",category:"32x32",len:32,max:31,data:[0,3,8,13,22,26,30,31,31,30,28,24,20,18,17,16,15,15,15,15,16,16,16,16,15,14,12,10,8,5,2,0]},{id:"32x32clarinet",name:"Clarinet",category:"32x32",len:32,max:31,data:[20,31,29,26,26,28,30,31,31,30,28,26,25,27,30,31,15,0,4,6,6,4,2,0,0,1,3,5,6,6,2,2]},{id:"32x32clarinet2",name:"Clarinet 2",category:"32x32",len:32,max:31,data:[21,27,30,28,24,22,24,26,24,22,19,18,19,26,23,19,12,6,0,1,4,8,7,5,7,10,13,11,9,7,5,10]},{id:"32x32distortedpulse",name:"Distorted Pulse",category:"32x32",len:32,max:31,data:[31,31,31,31,0,0,0,0,16,16,16,16,0,0,0,0,8,8,8,8,0,0,0,0,3,3,3,3,0,0,0,0]},{id:"32x32distortedpulse2",name:"Distorted Pulse 2",category:"32x32",len:32,max:31,data:[3,25,13,15,18,16,17,15,15,15,17,15,12,11,6,15,27,0,13,15,18,3,8,15,15,20,17,15,12,31,29,15]},{id:"32x32distortedsaw",name:"Distorted Saw",category:"32x32",len:32,max:31,data:[0,7,10,10,14,14,17,17,21,21,25,25,27,27,29,29,29,29,31,31,31,31,31,5,8,11,14,16,18,20,22,0]},{id:"32x32ebass",name:"E-Bass",category:"32x32",len:32,max:31,data:[17,21,31,28,23,27,30,13,0,8,11,10,7,8,14,21,27,27,26,25,31,19,0,2,0,0,0,8,15,18,18,16]},{id:"32x32eguitar",name:"E-Guitar",category:"32x32",len:32,max:31,data:[3,9,16,23,28,31,31,29,26,23,25,27,28,29,28,22,8,0,12,28,0,14,2,0,1,31,30,4,3,1,0,0]},{id:"32x32eguitar2",name:"E-Guitar 2",category:"32x32",len:32,max:31,data:[16,27,31,28,31,25,16,0,3,0,11,7,5,16,18,17,23,23,30,31,29,30,0,12,3,4,4,8,11,10,20,21]},{id:"32x32englishhorn",name:"English Horn",category:"32x32",len:32,max:31,data:[16,22,31,22,15,9,15,9,15,13,11,8,6,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,6,8,11]},{id:"32x32fantasia",name:"Fantasia",category:"32x32",len:32,max:31,data:[0,6,14,15,14,8,5,7,15,15,21,26,27,26,21,15,17,23,29,31,31,28,22,12,11,15,19,20,19,17,6,1]},{id:"32x32filteredsaw",name:"Filtered Saw",category:"32x32",len:32,max:31,data:[16,18,20,21,23,25,26,28,29,30,31,31,31,31,30,26,19,9,3,1,0,0,1,2,3,4,6,7,9,11,12,14]},{id:"32x32filteredsquare",name:"Filtered Square",category:"32x32",len:32,max:31,data:[20,24,27,28,29,30,31,31,31,31,30,29,28,27,24,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32flute",name:"Flute",category:"32x32",len:32,max:31,data:[16,19,23,27,30,31,31,31,29,25,21,17,12,8,6,4,3,3,3,3,3,3,3,3,4,5,6,7,8,9,11,13]},{id:"32x32frenchhorn",name:"French Horn",category:"32x32",len:32,max:31,data:[16,22,27,29,30,31,31,26,22,16,14,9,4,5,8,15,19,20,18,16,14,10,8,8,8,8,9,13,14,13,13,13]},{id:"32x32frenchhorn2",name:"French Horn 2",category:"32x32",len:32,max:31,data:[29,31,29,27,24,22,18,11,2,0,2,4,8,13,16,17,18,17,16,13,8,4,2,0,2,11,18,22,24,27,29,31]},{id:"32x32glockenspiel",name:"Glockenspiel",category:"32x32",len:33,max:31,data:[16,29,24,17,24,29,20,16,24,31,26,16,20,22,15,5,16,26,15,11,15,15,5,0,7,15,11,2,7,15,7,2,16]},{id:"32x32hardslap",name:"Hard Slap",category:"32x32",len:32,max:31,data:[18,30,21,16,15,17,22,31,2,11,29,0,20,10,15,31,6,21,30,0,7,11,12,8,1,11,30,16,1,31,18,4]},{id:"32x32jazzguitar",name:"Jazz Guitar",category:"32x32",len:32,max:31,data:[0,2,3,2,1,0,0,2,11,19,24,29,30,30,29,28,27,28,30,31,30,25,17,13,13,15,16,17,16,13,7,0]},{id:"32x32lead",name:"Lead",category:"32x32",len:32,max:31,data:[31,23,18,14,11,9,7,5,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,5,7,9,11,14,18,23,31]},{id:"32x32lead2",name:"Lead 2",category:"32x32",len:32,max:31,data:[11,20,26,30,31,31,30,22,12,0,1,1,1,17,16,16,16,16,30,31,30,0,5,8,18,20,21,22,20,19,15,11]},{id:"32x32mutetrumpet",name:"Mute Trumpet",category:"32x32",len:32,max:31,data:[31,29,20,15,12,11,12,12,13,13,13,14,14,15,16,15,15,15,14,14,15,15,16,16,16,16,16,16,17,17,17,24]},{id:"32x32oboe",name:"Oboe",category:"32x32",len:32,max:31,data:[21,31,14,0,1,8,14,18,20,22,22,22,21,20,18,17,15,13,12,11,10,9,9,10,12,15,20,27,31,30,13,1]},{id:"32x32octavelead",name:"Octave Lead",category:"32x32",len:32,max:31,data:[6,11,15,19,23,27,29,31,13,14,15,16,17,18,18,0,3,6,9,12,14,16,17,18,0,0,0,0,0,0,0,0]},{id:"32x32octavesaw",name:"Octave Saw",category:"32x32",len:32,max:31,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]},{id:"32x32organ",name:"Organ",category:"32x32",len:32,max:31,data:[23,31,31,28,27,26,19,15,19,23,17,10,9,11,8,10,20,29,28,22,19,17,9,5,8,13,8,3,2,6,5,9]},{id:"32x32organ2",name:"Organ 2",category:"32x32",len:32,max:31,data:[16,19,26,30,31,27,23,14,10,6,8,9,9,8,13,14,18,17,20,22,26,24,24,19,18,13,12,9,5,2,5,8]},{id:"32x32organ3",name:"Organ 3",category:"32x32",len:32,max:31,data:[16,31,31,24,22,24,20,15,16,18,17,17,22,22,11,6,16,25,21,11,10,15,16,14,16,17,12,8,10,9,0,0]},{id:"32x32piano",name:"Piano",category:"32x32",len:32,max:31,data:[18,30,31,29,31,30,30,31,31,31,31,26,10,2,2,6,14,14,10,8,5,3,1,9,17,15,8,2,4,7,10,13]},{id:"32x32piano2",name:"Piano 2",category:"32x32",len:32,max:31,data:[14,27,31,31,31,31,28,22,21,24,31,29,16,7,5,8,15,22,26,26,21,8,0,4,10,11,6,2,0,1,0,2]},{id:"32x32reedorgan",name:"Reed Organ",category:"32x32",len:32,max:31,data:[16,22,31,22,15,8,0,8,16,22,31,22,15,8,16,22,15,13,16,18,16,16,16,16,16,16,31,31,31,31,31,31]},{id:"32x32sam",name:"SAM",category:"32x32",len:32,max:31,data:[5,10,15,10,10,15,15,26,31,31,31,26,21,15,10,10,10,10,15,21,26,26,26,26,21,26,21,21,10,5,0,0]},{id:"32x32saw2",name:"Saw 2",category:"32x32",len:32,max:31,data:[15,31,30,25,23,20,19,17,17,16,15,15,15,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13]},{id:"32x32sax",name:"Sax",category:"32x32",len:32,max:31,data:[0,16,22,27,29,31,29,27,22,16,9,5,2,0,2,5,9,16,24,29,31,29,24,16,7,2,0,2,7,16,31,16]},{id:"32x32strings",name:"Strings",category:"32x32",len:32,max:31,data:[5,31,10,0,0,18,31,26,23,19,25,28,31,14,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32strings2",name:"Strings 2",category:"32x32",len:32,max:31,data:[21,26,26,21,16,16,16,24,29,31,29,21,15,12,12,16,19,19,15,7,2,0,2,7,16,16,10,5,5,10,16,16]},{id:"32x32synthbass",name:"Synth Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,15,15,0,0,15,15,31,31,31,31,31,31,0,7,7,7,7,7,7,0,23,23,23,23,23,23,0]},{id:"32x32synthbell",name:"Synth Bell",category:"32x32",len:32,max:31,data:[16,31,26,31,19,12,16,19,11,0,6,0,29,18,4,28,19,0,7,0,15,19,16,12,23,31,27,31,4,14,28,5]},{id:"32x32synthlead",name:"Synth Lead",category:"32x32",len:32,max:31,data:[0,0,0,0,3,26,1,0,1,28,0,29,0,18,5,4,0,0,3,0,31,0,20,31,5,2,0,20,27,31,0,16]},{id:"32x32synthlead2",name:"Synth Lead 2",category:"32x32",len:32,max:31,data:[16,16,15,0,16,31,31,31,16,16,15,0,15,15,15,0,0,0,0,15,0,0,15,15,15,15,0,0,0,15,0,0]},{id:"32x32synthpiano",name:"Synth Piano",category:"32x32",len:32,max:31,data:[14,7,8,8,7,3,2,5,3,4,13,25,31,31,31,30,25,14,14,18,22,17,9,9,8,9,15,25,30,29,23,5]},{id:"32x32synthstrings",name:"Synth Strings",category:"32x32",len:32,max:31,data:[17,26,31,31,27,22,17,14,13,16,21,28,31,25,8,1,16,31,24,7,0,5,11,17,19,18,15,10,4,1,1,7]},{id:"32x32trumpet",name:"Trumpet",category:"32x32",len:32,max:31,data:[15,31,26,24,21,20,19,19,18,17,17,17,17,16,17,16,16,16,16,16,16,16,15,14,14,12,11,10,7,4,1,0]},{id:"32x32tuba",name:"Tuba",category:"32x32",len:32,max:31,data:[19,28,31,30,26,22,19,17,16,15,14,14,15,15,15,16,17,17,18,18,18,18,18,17,16,14,11,8,4,1,0,7]},{id:"32x32vibraphone",name:"Vibraphone",category:"32x32",len:32,max:31,data:[10,28,25,18,17,30,31,31,29,31,25,26,30,31,22,9,15,22,19,2,1,5,9,2,3,1,0,0,8,15,8,3]},{id:"32x32voice",name:"Voice",category:"32x32",len:32,max:31,data:[16,25,28,31,28,25,12,8,8,13,19,29,31,29,24,19,9,8,3,2,1,1,0,1,0,0,2,1,5,5,8,14]},{id:"32x32voice2",name:"Voice 2",category:"32x32",len:32,max:31,data:[0,6,8,17,19,21,21,19,16,12,10,12,20,26,29,30,29,21,13,0,1,1,2,2,16,31,30,30,28,16,8,2]},{id:"128x256bass",name:"Bass",category:"128x256",len:128,max:255,data:[0,1,5,17,41,76,120,164,201,227,242,249,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,250,248,244,240,236,232,228,224,222,220,218,217,216,215,214,213,212,210,207,204,199,194,189,184,178,172,166,160,154,148,144,140,136,133,131,129,127,125,123,122,121,120,119,118,117,114,111,107,102,97,90,83,76,70,64,58,52,46,42,39,37,35,34,33,32,31,30,29,28,25,22,17,13,9,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"128x256chime",name:"Chime",category:"128x256",len:128,max:255,data:[128,154,184,203,201,192,190,187,181,176,172,167,164,161,160,161,165,174,188,210,235,252,255,254,253,253,252,250,249,248,246,245,244,244,246,248,252,255,251,233,210,212,223,224,225,230,233,235,237,239,240,240,239,236,230,217,192,151,110,101,118,122,123,130,136,140,144,148,151,151,150,145,136,118,91,55,23,13,20,25,24,28,33,35,38,41,44,44,44,41,35,26,13,2,2,12,9,5,5,4,2,1,1,0,0,0,0,0,1,3,9,25,57,92,95,80,77,76,69,64,61,57,54,52,52,53,58,67]},{id:"128x256lead",name:"Lead",category:"128x256",len:128,max:255,data:[96,159,151,135,187,216,196,170,210,251,206,157,149,151,191,242,206,206,248,206,168,164,166,208,247,200,156,186,218,207,179,212,255,241,241,255,255,255,255,255,248,241,248,255,255,255,232,195,217,212,179,221,250,242,223,163,105,134,164,126,94,110,150,123,102,153,132,104,144,161,128,90,120,149,91,31,13,4,34,76,42,37,60,22,0,0,0,7,13,6,0,0,0,0,0,14,14,0,43,75,48,37,68,98,54,8,47,88,91,87,49,6,49,49,13,64,103,105,98,49,4,44,84,58,38,67,119,104]}];function rc(e,t){if(e.max===t)return e.data;const n=t/e.max;return e.data.map(e=>Math.round(Math.max(0,Math.min(t,e*n))))}function ic(e,t){const n=(s=e,oc.find(e=>e.id===s));var s;if(!n)return null;switch(t){case"gb":case"n163":case"swan":return rc(n,15);case"pce":case"vb":return 31===n.max?n.data:rc(n,31);case"scc":return rc(n,255).map(e=>e-128);case"lynx":return rc(n,255);default:return n.data}}class lc{static mapOPN2(e,t,n){const s=nc.OPN2,a=t%3,o=0===(t<3?0:1)?0:256;if(e.write(s,34,8),n.fms||n.ams){const t=n.fms??0;e.write(s,34,8|7&t)}const r=(7&n.feedback)<<3|7&n.algorithm;e.write(s,o|176+a,r);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(s,o|180+a,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const r=l[n]+a,i=this.furnaceDtToOPN2(t.dt);e.write(s,o|48+r,(7&i)<<4|15&t.mult),e.write(s,o|64+r,127&t.tl),e.write(s,o|80+r,(3&(t.rs??0))<<6|31&t.ar),e.write(s,o|96+r,(t.am?128:0)|31&t.dr),e.write(s,o|112+r,31&t.d2r),e.write(s,o|128+r,(15&t.sl)<<4|15&t.rr),e.write(s,o|144+r,15&(t.ssg??0))})}static mapOPM(e,t,n){const s=nc.OPM,a=7&t;if(e.write(s,1,2),e.write(s,24,0),e.write(s,25,127),e.write(s,25,255),n.fms||n.ams){const t=n.fms??0;e.write(s,24,16*t&255);const a=n.fms??127,o=n.ams??127;e.write(s,25,128|127&a),e.write(s,25,127&o)}const o=192|(7&n.feedback)<<3|7&n.algorithm;e.write(s,32+a,o);const r=n.fms??0,i=n.ams??0;e.write(s,56+a,(7&r)<<4|3&i);const l=[0,8,16,24];n.operators.forEach((t,n)=>{const o=l[n]+a,r=this.furnaceDtToOPN2(t.dt??0);e.write(s,64+o,(7&r)<<4|15&(t.mult??1)),e.write(s,96+o,127&(t.tl??0)),e.write(s,128+o,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(s,160+o,(t.am?128:0)|31&(t.dr??0)),e.write(s,192+o,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(s,224+o,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapOPL3(e,t,n,s){const a=s??nc.OPL3;e.write(a,261,1),e.write(a,1,32);const o=t<9?0:256,r=t%9,i=48|(7&n.feedback)<<1|1&n.algorithm;e.write(a,o|192+r,i);const l=this.getOPL3Slots(r);n.operators.slice(0,2).forEach((t,n)=>{const s=o|l[n],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(a,32+s,r),e.write(a,64+s,(3&(t.ksl??0))<<6|63&t.tl),e.write(a,96+s,t.ar>>1<<4|t.dr>>1),e.write(a,128+s,(15&t.sl)<<4|15&t.rr),e.write(a,224+s,7&(t.ws??0))})}static mapPSG(e,t,n){const s=nc.PSG;e.write(s,0,231),e.write(s,1,255);const a=159|(3&t)<<5;e.write(s,0,a)}static mapGB(e,t,n){const s=nc.GB;e.write(s,16,0),e.write(s,38,128),e.write(s,37,0),e.write(s,36,0)}static mapC64(e,t,n){const s=n.c64,a=n.chipType===nc.SID_6581||n.chipType===nc.SID_8580,o=a?n.chipType:nc.SID;if(a){const n=7*t,a=s?.a??0,r=s?.d??8;e.write(o,n+5,(15&a)<<4|15&r);const i=s?.s??15,l=s?.r??4;e.write(o,n+6,(15&i)<<4|15&l);const c=s?.duty??2048;e.write(o,n+2,255&c),e.write(o,n+3,c>>8&15),s&&(s.noiseOn,s.pulseOn,s.sawOn,s.triOn,s.ringMod,s.oscSync),e.write(o,n+4,0),e.write(o,24,15);const u=s?.filterResonance??s?.filterRes??0;let d=0;s?.filterOn&&!0!==s?.filterCh3Off&&(d|=1<<t),e.write(o,23,(15&u)<<4|d)}else{const n=0,a=1,r=2,i=3,l=5,c=6,u=7,d=8,m=13,p=50,h=51,f=t*64,g=17*(s?.a??0),b=17*(s?.d??8),v=17*(s?.s??15),y=17*(s?.r??4);e.write(o,f+a,255&g),e.write(o,f+r,255&b),e.write(o,f+i,255&v),e.write(o,f+l,255&y);let x=0;s?(s.triOn&&(x|=1),s.sawOn&&(x|=2),s.pulseOn&&(x|=4),s.noiseOn&&(x|=8)):x=4,e.write(o,f+c,x);const N=s?.duty??2048;e.write(o,f+u,N>>8&255),e.write(o,f+d,255&N),e.write(o,f+m,255),e.write(o,f+p,255),e.write(o,f+h,255),e.write(o,f+n,0)}}static mapNES(e,t,n){const s=nc.NES;if(e.write(s,16405,31),e.write(s,16385,8),e.write(s,16389,8),e.write(s,16384,48),e.write(s,16386,0),e.write(s,16387,8),e.write(s,16388,48),e.write(s,16390,0),e.write(s,16391,8),e.write(s,16392,0),e.write(s,16394,0),e.write(s,16395,8),e.write(s,16396,48),e.write(s,16398,8),e.write(s,16399,8),t<2){const a=4*t,o=3&Math.floor((n.operators[0]?.mult??2)/4);e.write(s,16384+a,48|o<<6)}else 2===t?e.write(s,16392,255):3===t&&e.write(s,16396,48)}static mapAY(e,t,n){const s=nc.AY;e.write(s,7,56)}static mapPCE(e,t,n){const s=nc.PCE;e.write(s,0,0),e.write(s,1,0)}static mapSNES(e,t,n){const s=nc.SNES;e.write(s,93,2),e.write(s,12,0),e.write(s,28,0),e.write(s,108,0),e.write(s,76,0),e.write(s,92,0);for(let a=0;a<8;a++)e.write(s,16*a+4,a)}static mapOPLL(e,t,n){const s=nc.OPLL,a=n.opllPreset??3;if(0===a&&n.operators.length>=2){const t=n.operators[0],a=n.operators[1],o=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(s,0,o);const r=(a.am?128:0)|(a.vib?64:0)|(a.sus?32:0)|(a.ksr?16:0)|15&a.mult;e.write(s,1,r);const i=Math.min(63,t.tl>>1);e.write(s,2,(3&(t.ksl??0))<<6|63&i);const l=1&(a.ws??0),c=1&(t.ws??0);e.write(s,3,l<<4|c<<3|7&n.feedback),e.write(s,4,(15&t.ar)<<4|15&t.dr),e.write(s,5,(15&a.ar)<<4|15&a.dr),e.write(s,6,(15&t.sl)<<4|15&t.rr),e.write(s,7,(15&a.sl)<<4|15&a.rr)}e.write(s,48+t,(15&a)<<4),e.write(s,14,0)}static mapOPNA(e,t,n){const s=nc.OPNA,a=t%3,o=0===(t<3?0:1)?0:256;e.write(s,34,8),e.write(s,41,159),e.write(s,257,63);const r=(7&n.feedback)<<3|7&n.algorithm;e.write(s,o|176+a,r);const i=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(s,o|180+a,i);const l=[0,8,4,12];n.operators.forEach((t,n)=>{const r=l[n]+a,i=this.furnaceDtToOPN2(t.dt);e.write(s,o|48+r,(7&i)<<4|15&t.mult),e.write(s,o|64+r,127&t.tl),e.write(s,o|80+r,(3&(t.rs??0))<<6|31&t.ar),e.write(s,o|96+r,(t.am?128:0)|31&t.dr),e.write(s,o|112+r,31&t.d2r),e.write(s,o|128+r,(15&t.sl)<<4|15&t.rr),e.write(s,o|144+r,15&(t.ssg??0))})}static mapOPN(e,t,n){const s=nc.OPN,a=t%3;e.write(s,34,8);const o=(7&n.feedback)<<3|7&n.algorithm;e.write(s,176+a,o);const r=(3&(n.ams??0))<<4|7&(n.fms??0);e.write(s,180+a,r);const i=[0,8,4,12];n.operators.forEach((t,n)=>{const o=i[n]+a,r=this.furnaceDtToOPN2(t.dt);e.write(s,48+o,(7&r)<<4|15&t.mult),e.write(s,64+o,127&t.tl),e.write(s,80+o,(3&(t.rs??0))<<6|31&t.ar),e.write(s,96+o,(t.am?128:0)|31&t.dr),e.write(s,112+o,31&t.d2r),e.write(s,128+o,(15&t.sl)<<4|15&t.rr),e.write(s,144+o,15&(t.ssg??0))})}static mapOPNB(e,t,n){const s=n.chipType,a=n.chipType===nc.OPNB_B?[1,2,5,6,0,4]:[1,2,5,6],o=a[t%a.length],r=3&o,i=o>>2&1?256:0;e.write(s,34,0);const l=(7&n.feedback)<<3|7&n.algorithm;e.write(s,i|176+r,l);const c=192|(3&(n.ams??0))<<4|7&(n.fms??0);e.write(s,i|180+r,c);const u=[0,8,4,12];n.operators.forEach((t,n)=>{const a=u[n]+r,o=this.furnaceDtToOPN2(t.dt);e.write(s,i|48+a,(7&o)<<4|15&t.mult),e.write(s,i|64+a,127&t.tl),e.write(s,i|80+a,(3&(t.rs??0))<<6|31&t.ar),e.write(s,i|96+a,(t.am?128:0)|31&t.dr),e.write(s,i|112+a,31&t.d2r),e.write(s,i|128+a,(15&t.sl)<<4|15&t.rr),e.write(s,i|144+a,15&(t.ssg??0))})}static mapVRC6(e,t,n){const s=nc.VRC6;e.write(s,36867,0)}static mapN163(e,t,n){const s=nc.N163;e.write(s,127,0)}static mapSCC(e,t,n){const s=nc.SCC;for(let a=0;a<5;a++)e.write(s,138+a,0);e.write(s,143,0)}static mapFDS(e,t,n){const s=nc.FDS;e.write(s,16419,0),e.write(s,16419,131),e.write(s,16521,0)}static mapMMC5(e,t,n){const s=nc.MMC5;e.write(s,20501,3),e.write(s,20496,0)}static mapTIA(e,t,n){const s=nc.TIA;e.write(s,21,0),e.write(s,22,0),e.write(s,23,0),e.write(s,24,0),e.write(s,25,0),e.write(s,26,0)}static mapSAA(e,t,n){const s=nc.SAA;e.write(s,28,2),e.write(s,28,1)}static mapSWAN(e,t,n){const s=nc.SWAN;for(let a=0;a<4;a++)e.write(s,8+a,0);e.write(s,15,0),e.write(s,16,0),e.write(s,17,0)}static mapOKI(e,t,n){const s=nc.OKI;e.write(s,12,0)}static mapES5506(e,t,n){}static mapOPZ(e,t,n){const s=nc.OPZ,a=7&t;e.write(s,1,2),e.write(s,24,0),e.write(s,25,127),e.write(s,25,255);const o=192|(7&n.feedback)<<3|7&n.algorithm;e.write(s,32+a,o);const r=n.fms??0,i=n.ams??0;e.write(s,56+a,(7&r)<<4|3&i);const l=[0,8,16,24];n.operators.forEach((t,n)=>{const o=l[n]+a,r=this.furnaceDtToOPN2(t.dt??0);e.write(s,64+o,(7&r)<<4|15&(t.mult??1)),e.write(s,96+o,127&(t.tl??0)),e.write(s,128+o,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(s,160+o,(t.am?128:0)|31&(t.dr??0)),e.write(s,192+o,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(s,224+o,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapY8950(e,t,n){const s=nc.Y8950;e.write(s,1,32),e.write(s,4,0),e.write(s,8,0);const a=t%9,o=(7&n.feedback)<<1|1&n.algorithm;e.write(s,192+a,o);const r=this.getOPL3Slots(a);n.operators.slice(0,2).forEach((t,n)=>{const a=r[n],o=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(s,32+a,o),e.write(s,64+a,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(s,96+a,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(s,128+a,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(s,224+a,3&(t.ws??0))})}static mapOPL4(e,t,n){const s=nc.OPL4;e.write(s,261,3),e.write(s,514,16),e.write(s,1,32);const a=t<9?0:256,o=t%9,r=48|(7&n.feedback)<<1|1&n.algorithm;e.write(s,a|192+o,r);const i=this.getOPL3Slots(o);n.operators.slice(0,2).forEach((t,n)=>{const o=a|i[n],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(s,32+o,r),e.write(s,64+o,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(s,96+o,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(s,128+o,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(s,224+o,7&(t.ws??0))})}static mapSEGAPCM(e,t,n){const s=nc.SEGAPCM;for(let a=0;a<16;a++){const t=a<<3;e.write(s,134+t,0),e.write(s,2+t,0),e.write(s,3+t,0)}}static mapYMZ280B(e,t,n){const s=nc.YMZ280B;e.write(s,255,128);for(let a=0;a<8;a++)e.write(s,2+4*a,255),e.write(s,3+4*a,8)}static mapRF5C68(e,t,n){const s=nc.RF5C68;e.write(s,8,255);for(let a=0;a<8;a++)e.write(s,0+a,0),e.write(s,1+a,0);e.write(s,8,0)}static mapGA20(e,t,n){const s=nc.GA20;for(let a=0;a<4;a++)e.write(s,5+8*a,0),e.write(s,6+8*a,0)}static mapC140(e,t,n){const s=nc.C140;for(let a=0;a<24;a++)e.write(s,5+(a<<4),0)}static mapQSOUND(e,t,n){const s=nc.QSOUND;e.write(s,0,0)}static mapVIC(e,t,n){const s=nc.VIC;e.write(s,14,0)}static mapTED(e,t,n){const s=nc.TED;e.write(s,17,15)}static mapSUPERVISION(e,t,n){}static mapVERA(e,t,n){const s=nc.VERA;for(let a=0;a<16;a++)e.write(s,129472+4*a+2,3)}static mapSM8521(e,t,n){const s=nc.SM8521;e.write(s,64,128)}static mapBUBBLE(e,t,n){}static mapK007232(e,t,n){const s=nc.K007232;e.write(s,12,255),e.write(s,13,0)}static mapK053260(e,t,n){const s=nc.K053260;e.write(s,40,0),e.write(s,47,2)}static mapX1_010(e,t,n){const s=nc.X1_010;for(let a=0;a<16;a++)e.write(s,8*a,0)}static mapUPD1771(e,t,n){}static mapT6W28(e,t,n){const s=nc.T6W28;e.write(s,1,231)}static mapVB(e,t,n){const s=nc.VB;for(let a=0;a<6;a++){const t=1024+64*a;e.write(s,t+4,255),e.write(s,t+16,240)}}static mapLYNX(e,t,n){const s=nc.LYNX;e.write(s,80,0)}static mapNAMCO(e,t,n){}static mapPET(e,t,n){}static mapPOKEY(e,t,n){}static mapAMIGA(e,t,n){}static mapPCSPKR(e,t,n){}static getOPL3Slots(e){return[[0,1,2,8,9,10,16,17,18][e],[3,4,5,11,12,13,19,20,21][e]]}static furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}static uploadWavetable(e,t,n){switch(t){case nc.GB:for(let t=0;t<16;t++){const s=15&(n[2*t]||0),a=15&(n[2*t+1]||0);e.write(nc.GB,48+t,s<<4|a)}break;case nc.SCC:for(let t=0;t<32;t++)e.write(nc.SCC,t,255&n[t]);break;case nc.N163:e.write(nc.N163,57344,128);for(let t=0;t<Math.min(128,n.length);t++)e.write(nc.N163,63488,255&n[t]);break;case nc.PCE:for(let t=0;t<32;t++)e.write(nc.PCE,6,31&n[t]);break;case nc.SWAN:for(let t=0;t<16;t++){const s=15&(n[2*t]||0),a=15&(n[2*t+1]||0);e.write(nc.SWAN,64+t,s<<4|a)}break;case nc.BUBBLE:{const t=new Uint8Array(n.slice(0,32));e.setWavetable(nc.BUBBLE,0,t),e.setWavetable(nc.BUBBLE,1,t);break}case nc.X1_010:{const t=n.some(e=>e<0);for(let s=0;s<16;s++){const a=4096|s<<7;for(let s=0;s<128;s++){const o=s*n.length/128,r=Math.floor(o),i=o-r,l=n[r]||0,c=l+((n[(r+1)%n.length]||0)-l)*i;let u;u=t?255&Math.round(4*c):17*c-128&255,e.write(nc.X1_010,a+s,u)}}break}}}static loadWavetablePreset(e,t,n){let s;switch(t){case nc.GB:s="gb";break;case nc.PCE:s="pce";break;case nc.N163:s="n163";break;case nc.SCC:s="scc";break;case nc.SWAN:s="swan";break;case nc.VB:s="vb";break;case nc.LYNX:s="lynx";break;default:return!1}const a=ic(n,s);return!!a&&(this.uploadWavetable(e,t,a),!0)}static getRecommendedWavetables(e){switch(e){case nc.GB:case nc.N163:case nc.SWAN:return["32x16saw","32x16FunkyLead","32x16NamcoBass","32x16brass","32x16clarinet","32x16flute","32x16guitar","32x16opllpiano","32x16synthbass","32x16trumpet","32x16voice"];case nc.PCE:case nc.VB:return["32x32piano","32x32brass","32x32flute","32x32lead","32x32organ","32x32strings","32x32synthbass","32x32trumpet","32x32voice","32x32bell","32x32choir","32x32vibraphone"];case nc.SCC:return["32x32piano","32x32brass","32x32lead","32x32organ","32x32synthbass","32x32trumpet","32x32strings","32x32flute"];case nc.LYNX:return["128x256bass","128x256chime","128x256lead","32x32piano","32x32brass","32x32lead","32x32synthbass"];default:return[]}}}class cc{static CLOCK_OPN2=7670454;static CLOCK_OPN2_PAL=7600489;static CLOCK_OPN=4e6;static CLOCK_OPM=3579545;static FREQ_BASE_OPN2=9440540;static FREQ_BASE_OPN=4720270;static FREQ_BASE_OPM=3579545;static freqToOPN2(e){if(e<=0)return{block:0,fnum:0};const t=this.CLOCK_OPN2;let n=7,s=0;for(n=7;n>=0;n--){const a=Math.pow(2,n);if(s=Math.round(144*e*2097152/(t*a)),s<=2047&&s>=600)break;if(!(s<=2047&&s<600&&n>0)&&(0===n&&s<=2047))break}return s>2047&&(n=7,s=2047),n=Math.max(0,Math.min(7,n)),s=Math.max(0,Math.min(2047,s)),{block:n,fnum:s}}static freqToOPM(e){if(e<=0)return{kc:0,kf:0};const t=12*Math.log2(e/440)+69,n=Math.floor(t),s=t-n,a=Math.floor(n/12)-1,o=n%12;return{kc:Math.max(0,Math.min(7,a))<<4|[0,1,2,4,5,6,8,9,10,12,13,14][o],kf:63&Math.floor(64*s)}}static freqToGB(e){if(e<=0)return 0;const t=2048-131072/e;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNES(e){if(e<=0)return 0;const t=1789773/(16*e)-1;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNESNoise(e){const t=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];if(e<=0)return 15;const n=1789773/e;let s=0,a=Math.abs(t[0]-n);for(let o=1;o<16;o++){const e=Math.abs(t[o]-n);e<a&&(a=e,s=o)}return s}static freqToAY(e,t=1789773){if(e<=0)return 0;const n=Math.floor(t/(16*e));return Math.max(0,Math.min(4095,n))}static freqToPCE(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(4095,t))}static freqToSCC(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToSID(e,t=!0){if(e<=0)return 0;const n=t?985248:1022727,s=Math.floor(16777216*e/n);return Math.max(0,Math.min(65535,s))}static freqToPSG(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(1023,t))}static freqToSNES(e){if(e<=0)return 0;const t=Math.floor(4096*e/32e3);return Math.max(0,Math.min(16383,t))}static freqToFDS(e){if(e<=0)return 0;const t=Math.floor(65536*e/1789773);return Math.max(0,Math.min(4095,t))}static freqToVRC6(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToPOKEY(e){if(e<=0)return 0;const t=Math.floor(1789773/(2*e))-1;return Math.max(0,Math.min(255,t))}static freqToTIA(e){if(e<=0)return 0;const t=Math.floor(31440/(32*e))-1;return Math.max(0,Math.min(31,t))}static freqToVIC(e){if(e<=0)return 0;const t=Math.floor(256-1022727/(32*e));return Math.max(0,Math.min(127,t))}static freqToTED(e){if(e<=0)return 0;const t=Math.floor(1024-1773447/(8*e));return Math.max(0,Math.min(1023,t))}static freqToAmiga(e,t=!0){if(e<=0)return 65535;const n=t?3546895:3579545,s=Math.floor(n/(2*e));return Math.max(124,Math.min(65535,s))}}let uc=0;const dc=i((e,t)=>({errors:[],activeError:null,reportError:t=>{const n="synth-error-"+ ++uc,s={timestamp:(new Date).toISOString(),userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",audioContextState:(()=>{try{const e=window._toneEngine;return e?.getContextState?e.getContextState():"unknown (no engine ref)"}catch{return"unknown"}})(),wasmSupported:"undefined"!=typeof WebAssembly,...t.debugData},a={id:n,synthType:t.synthType,synthName:t.synthName,errorType:t.errorType,message:t.message,stack:t.stack,debugData:s,dismissed:!1};return e(e=>({errors:[...e.errors,a],activeError:a})),n},dismissError:t=>{e(e=>({errors:e.errors.map(e=>e.id===t?{...e,dismissed:!0}:e),activeError:e.activeError?.id===t?null:e.activeError}))},dismissAll:()=>{e(e=>({errors:e.errors.map(e=>({...e,dismissed:!0})),activeError:null}))},clearDismissed:()=>{e(e=>({errors:e.errors.filter(e=>!e.dismissed)}))},getDebugString:e=>{const t=["=== DEViLBOX Synth Error Report ===","",`Synth Type: ${e.synthType}`,e.synthName?`Synth Name: ${e.synthName}`:null,`Error Type: ${e.errorType}`,`Message: ${e.message}`,"","--- Debug Data ---",`Timestamp: ${e.debugData.timestamp}`,`User Agent: ${e.debugData.userAgent}`,`AudioContext State: ${e.debugData.audioContextState}`,`WASM Supported: ${e.debugData.wasmSupported}`,""].filter(Boolean),n=Object.keys(e.debugData).filter(e=>!["timestamp","userAgent","audioContextState","wasmSupported","synthConfig"].includes(e));if(n.length>0){t.push("--- Additional Info ---");for(const s of n)t.push(`${s}: ${JSON.stringify(e.debugData[s])}`);t.push("")}return e.debugData.synthConfig&&(t.push("--- Synth Config ---"),t.push(JSON.stringify(e.debugData.synthConfig,null,2)),t.push("")),e.stack&&(t.push("--- Stack Trace ---"),t.push(e.stack)),t.join("\n")},copyToClipboard:async e=>{const n=t().getDebugString(e);try{return await navigator.clipboard.writeText(n),!0}catch(s){return!1}}})),mc=(e,t,n)=>dc.getState().reportError({synthType:e,message:t,synthName:n?.synthName,errorType:n?.errorType??"init",stack:n?.error?.stack,debugData:n?.debugData});class pc{name="FurnaceSynth";output;chipEngine=ac.getInstance();config;channelIndex=0;macroPositions=new Map;opMacroPositions=Array.from({length:4},()=>({}));activeNoteFreq=440;isNoteOn=!1;currentDuty=2;currentPan=0;velocity=1;baseTLValues=[];_oplBlock=0;_oplFnum=0;useWasmEngine=!1;errorReported=!1;gbFreqHigh=0;gbFreqVal=0;nesNoiseIndex=0;initInProgress=!1;wasmNoteTriggered=!1;noteOnTime=0;static MIN_GATE_TIME=.05;_volumeOffsetDb=0;constructor(e=va,t=0){this.config={...e,operators:e.operators?.map(e=>({...e}))||[]},this.channelIndex=t,this.output=oo().createGain(),this.chipEngine=ac.getInstance(),this.initEngine()}getChipType(){return this.config.chipType}setChannelIndex(e){this.channelIndex=e}static getMaxChannels(e){switch(e){case nc.OPN2:return 6;case nc.OPM:case nc.OPZ:return 8;case nc.OPL3:return 18;case nc.OPLL:return 9;case nc.OPNA:return 6;case nc.OPNB:return 4;case nc.OPN:return 3;case nc.OPNB_B:return 6;case nc.ESFM:return 18;case nc.Y8950:return 9;case nc.OPL4:return 18;case nc.PSG:return 4;case nc.AY:return 3;case nc.NES:return 5;case nc.GB:return 4;case nc.SID:case nc.SID_6581:case nc.SID_8580:return 3;case nc.PCE:return 6;case nc.SNES:return 8;default:return 6}}setVolumeOffset(e){this._volumeOffsetDb=e,this.useWasmEngine&&this.chipEngine.setOutputGain(Math.pow(10,e/20))}async ensureInitialized(){if(!this.useWasmEngine){if(this.initInProgress){for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);if(this.useWasmEngine)return}await this.initEngine(),!this.useWasmEngine&&this.chipEngine.isInitialized()&&(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters())}}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=oo();if("running"!==e.state){if(!(await Promise.race([new Promise(t=>{const n=()=>{"running"===e.state?t(!0):setTimeout(n,100)};n()}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return this.reportInitError("audio","AudioContext failed to start. Click anywhere to enable audio, then try again."),void(this.initInProgress=!1)}if(await this.chipEngine.init(e),this.chipEngine.isInitialized()){this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20));try{Bw().routeNativeEngineOutput(this)}catch{}this.updateParameters(),this.isNoteOn&&this.activeNoteFreq>0&&(this.updateFrequency(this.activeNoteFreq),this.writeKeyOn(this.velocity),this.wasmNoteTriggered=!0)}else this.reportInitError("wasm","WASM chip engine failed to initialize. This synth requires WebAssembly support.")}catch(e){const t=e instanceof Error?e:new Error(String(e));this.reportInitError("wasm",t.message,t)}finally{this.initInProgress=!1}}}reportInitError(e,t,n){this.errorReported||(this.errorReported=!0,mc(`Furnace/${this.config.chipType||"Unknown"}`,t,{errorType:e,error:n,debugData:{chipType:this.config.chipType,channelIndex:this.channelIndex,synthConfig:this.config}}))}processTick(e=fo()){this.isNoteOn&&(this.config.macros.forEach(t=>{if(!t.data||0===t.data.length)return;let n=this.macroPositions.get(t.type)||0;n>=t.data.length&&(n=t.data.length-1);const s=t.data[n];switch(t.type){case 0:{const t=Math.max(0,s/127*this.velocity);this.output.gain.setValueAtTime(t,e);break}case 1:this.updateFrequency(this.activeNoteFreq*Math.pow(2,s/12));break;case 2:this.currentDuty=s,this.writeDutyRegister(s);break;case 3:this.writeWavetableSelect(s);break;case 4:{const e=s>127?s-256:s;this.updateFrequency(this.activeNoteFreq*Math.pow(2,e/1200));break}case 5:this.currentPan=s>127?s-256:s,this.writePanRegister(this.currentPan);break;case 6:0!==s&&this.writePhaseReset()}n++,n>=t.data.length&&(n=t.loop>=0?t.loop:t.data.length-1),this.macroPositions.set(t.type,n)}),this.config.opMacros.forEach((e,t)=>{if(!e)return;const n=this.config.operators[t];if(n){if(e.tl&&e.tl.data.length>0){const s=this.advanceOpMacro(e.tl,t,"tl");n.tl=s,this.writeOperatorTL(t,s)}if(e.mult&&e.mult.data.length>0){const s=this.advanceOpMacro(e.mult,t,"mult");n.mult=s,this.writeOperatorMult(t,s)}if(e.ar&&e.ar.data.length>0){const s=this.advanceOpMacro(e.ar,t,"ar");n.ar=s,this.writeOperatorAR(t,s)}if(e.dr&&e.dr.data.length>0){const s=this.advanceOpMacro(e.dr,t,"dr");n.dr=s,this.writeOperatorDR(t,s)}if(e.sl&&e.sl.data.length>0){const s=this.advanceOpMacro(e.sl,t,"sl");n.sl=s,this.writeOperatorSL(t,s)}if(e.rr&&e.rr.data.length>0){const s=this.advanceOpMacro(e.rr,t,"rr");n.rr=s,this.writeOperatorRR(t,s)}}}))}advanceOpMacro(e,t,n){let s=this.opMacroPositions[t][n]||0;s>=e.data.length&&(s=e.data.length-1);const a=e.data[s];return s++,s>=e.data.length&&(s=e.loop>=0?e.loop:e.data.length-1),this.opMacroPositions[t][n]=s,a}writeDutyRegister(e){const t=this.channelIndex;if(this.config.chipType===nc.NES){if(t<2){const n=16384+4*t,s=48|15&(this.config.operators[0]?.tl||15);this.chipEngine.write(nc.NES,n,(3&e)<<6|s)}}else if(this.config.chipType===nc.GB){if(t<2){const n=0===t?17:22;this.chipEngine.write(nc.GB,n,(3&e)<<6)}}else this.config.chipType,nc.PSG}writeWavetableSelect(e){if(this.config.wavetables&&this.config.wavetables[e]){const t=this.config.wavetables[e].data;lc.uploadWavetable(this.chipEngine,this.config.chipType,t)}}writePanRegister(e){const t=this.channelIndex;if(this.config.chipType===nc.OPN2){const n=t%3,s=0===(t<3?0:1)?0:256;let a=192;e<-32?a=128:e>32&&(a=64),this.chipEngine.write(nc.OPN2,s|180+n,a)}else if(this.config.chipType===nc.OPM){let n=192;e<-32?n=128:e>32&&(n=64);const s=(7&this.config.feedback)<<3|7&this.config.algorithm;this.chipEngine.write(nc.OPM,32+(7&t),n|s)}else this.config.chipType===nc.GB&&this.chipEngine.write(nc.GB,37,255)}writePhaseReset(){if(this.config.chipType===nc.OPN2){const e=this.channelIndex%3,t=this.channelIndex<3?0:1;this.chipEngine.write(nc.OPN2,40,t<<2|e),this.chipEngine.write(nc.OPN2,40,240|t<<2|e)}}writeOperatorTL(e,t){const n=this.channelIndex;if(this.config.chipType===nc.OPN2){const s=0===(n<3?0:1)?0:256,a=[0,8,4,12][e]+n%3;this.chipEngine.write(nc.OPN2,s|64+a,127&t)}else if(this.config.chipType===nc.OPM||this.config.chipType===nc.OPZ){const s=[0,16,8,24][e]+(7&n),a=this.config.chipType;this.chipEngine.write(a,96+s,127&t)}}writeOperatorMult(e,t){const n=this.channelIndex,s=this.config.operators[e];if(!s)return;const a=this.furnaceDtToOPN2(s.dt);if(this.config.chipType===nc.OPN2){const s=0===(n<3?0:1)?0:256,o=[0,8,4,12][e]+n%3;this.chipEngine.write(nc.OPN2,s|48+o,(7&a)<<4|15&t)}else if(this.config.chipType===nc.OPM||this.config.chipType===nc.OPZ){const s=[0,16,8,24][e]+(7&n),o=this.config.chipType;this.chipEngine.write(o,64+s,(7&a)<<4|15&t)}}writeOperatorAR(e,t){const n=this.channelIndex,s=this.config.operators[e];if(s)if(this.config.chipType===nc.OPN2){const a=0===(n<3?0:1)?0:256,o=[0,8,4,12][e]+n%3;this.chipEngine.write(nc.OPN2,a|80+o,(3&(s.rs??0))<<6|31&t)}else if(this.config.chipType===nc.OPM||this.config.chipType===nc.OPZ){const a=[0,16,8,24][e]+(7&n),o=this.config.chipType;this.chipEngine.write(o,128+a,(3&(s.rs??0))<<6|31&t)}}writeOperatorDR(e,t){const n=this.channelIndex,s=this.config.operators[e];if(s)if(this.config.chipType===nc.OPN2){const a=0===(n<3?0:1)?0:256,o=[0,8,4,12][e]+n%3;this.chipEngine.write(nc.OPN2,a|96+o,(s.am?128:0)|31&t)}else if(this.config.chipType===nc.OPM||this.config.chipType===nc.OPZ){const a=[0,16,8,24][e]+(7&n),o=this.config.chipType;this.chipEngine.write(o,160+a,(s.am?128:0)|31&t)}}writeOperatorSL(e,t){const n=this.channelIndex,s=this.config.operators[e];if(s)if(this.config.chipType===nc.OPN2){const a=0===(n<3?0:1)?0:256,o=[0,8,4,12][e]+n%3;this.chipEngine.write(nc.OPN2,a|128+o,(15&t)<<4|15&s.rr)}else if(this.config.chipType===nc.OPM||this.config.chipType===nc.OPZ){const a=[0,16,8,24][e]+(7&n),o=this.config.chipType;this.chipEngine.write(o,224+a,(15&t)<<4|15&s.rr)}}writeOperatorRR(e,t){const n=this.channelIndex,s=this.config.operators[e];if(s)if(this.config.chipType===nc.OPN2){const a=0===(n<3?0:1)?0:256,o=[0,8,4,12][e]+n%3;this.chipEngine.write(nc.OPN2,a|128+o,(15&s.sl)<<4|15&t)}else if(this.config.chipType===nc.OPM||this.config.chipType===nc.OPZ){const a=[0,16,8,24][e]+(7&n),o=this.config.chipType;this.chipEngine.write(o,224+a,(15&s.sl)<<4|15&t)}}furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}updateFrequency(e){const t=this.channelIndex%3,n=0===(this.channelIndex<3?0:1)?0:256;if(this.config.chipType===nc.OPN2){const{block:s,fnum:a}=cc.freqToOPN2(e);this.chipEngine.write(nc.OPN2,n|164+t,(7&s)<<3|a>>8&7),this.chipEngine.write(nc.OPN2,n|160+t,255&a)}else if(this.config.chipType===nc.OPN){const{block:t,fnum:n}=cc.freqToOPN2(e),s=this.channelIndex%3;this.chipEngine.write(nc.OPN,164+s,(7&t)<<3|n>>8&7),this.chipEngine.write(nc.OPN,160+s,255&n)}else if(this.config.chipType===nc.OPM){const{kc:t,kf:n}=cc.freqToOPM(e);this.chipEngine.write(nc.OPM,40+(7&this.channelIndex),t),this.chipEngine.write(nc.OPM,48+(7&this.channelIndex),n<<2)}else if(this.config.chipType===nc.OPZ){const t=[0,1,2,4,5,6,8,9,10,12,13,14],n=Math.round(12*Math.log2(e/440)+69),s=Math.max(0,Math.min(127,n)),a=(7&Math.floor(s/12))<<4|t[s%12],o=12*Math.log2(e/440)+69-s,r=63&Math.floor(64*o);this.chipEngine.write(nc.OPZ,40+(7&this.channelIndex),a),this.chipEngine.write(nc.OPZ,48+(7&this.channelIndex),r<<2)}else if(this.config.chipType===nc.OPL3||this.config.chipType===nc.Y8950||this.config.chipType===nc.OPL4||this.config.chipType===nc.ESFM){const t=this.channelIndex%9,n=this.channelIndex<9?0:256;let s=4,a=Math.floor(e*(1<<19)/2e5);for(;a>1023&&s<7;)a>>=1,s++;for(;a<256&&s>0;)a<<=1,s--;a&=1023,this._oplBlock=s,this._oplFnum=a,this.chipEngine.write(this.config.chipType,n|160+t,255&a),this.chipEngine.write(this.config.chipType,n|176+t,(7&s)<<2|a>>8&3)}else if(this.config.chipType===nc.OPLL){const t=this.channelIndex%9;let n=4,s=Math.floor(e*(1<<18)/2e5);for(;s>511&&n<7;)s>>=1,n++;for(;s<128&&n>0;)s<<=1,n--;s&=511,this._oplBlock=n,this._oplFnum=s,this.chipEngine.write(nc.OPLL,16+t,255&s)}else if(this.config.chipType===nc.OPNA||this.config.chipType===nc.OPNB||this.config.chipType===nc.OPNB_B){const{block:t,fnum:n}=cc.freqToOPN2(e);let s,a;if(this.config.chipType===nc.OPNB){const e=[1,2,5,6][3&this.channelIndex];s=3&e,a=e>>2&1?256:0}else if(this.config.chipType===nc.OPNB_B){const e=[1,2,5,6,0,4][this.channelIndex%6];s=3&e,a=e>>2&1?256:0}else{const e=this.channelIndex<3?0:1;s=this.channelIndex%3,a=0===e?0:256}this.chipEngine.write(this.config.chipType,a|164+s,(7&t)<<3|n>>8&7),this.chipEngine.write(this.config.chipType,a|160+s,255&n)}else if(this.config.chipType===nc.AY||this.config.chipType===nc.AY8930){const t=1789773,n=4095&Math.floor(t/(16*e)),s=this.channelIndex%3;this.chipEngine.write(this.config.chipType,2*s,255&n),this.chipEngine.write(this.config.chipType,2*s+1,n>>8&15)}else if(this.config.chipType===nc.SID||this.config.chipType===nc.SID_6581||this.config.chipType===nc.SID_8580){const t=985248,n=65535&Math.floor(16777216*e/t),s=this.channelIndex%3*7;this.chipEngine.write(this.config.chipType,s+0,255&n),this.chipEngine.write(this.config.chipType,s+1,n>>8&255)}else if(this.config.chipType===nc.PSG){const t=1023&Math.floor(3579545/(32*e)),n=3&this.channelIndex;this.chipEngine.write(nc.PSG,0,128|n<<5|15&t),this.chipEngine.write(nc.PSG,0,t>>4&63)}else if(this.config.chipType===nc.NES){const t=this.channelIndex;if(t<2){const n=cc.freqToNES(e),s=16384+4*t;this.chipEngine.write(nc.NES,s+2,255&n),this.chipEngine.write(nc.NES,s+3,n>>8&7)}else if(2===t){const t=cc.freqToNES(e);this.chipEngine.write(nc.NES,16394,255&t),this.chipEngine.write(nc.NES,16395,t>>8&7)}else if(3===t){const t=cc.freqToNESNoise(e);this.nesNoiseIndex=t,this.chipEngine.write(nc.NES,16398,15&t)}}else if(this.config.chipType===nc.GB){const t=cc.freqToGB(e);this.gbFreqVal=t}else if(this.config.chipType===nc.PCE){const t=this.channelIndex,n=4095&Math.floor(3579545/(32*e));this.chipEngine.write(nc.PCE,0,7&t),this.chipEngine.write(nc.PCE,2,255&n),this.chipEngine.write(nc.PCE,3,n>>8&15)}else if(this.config.chipType===nc.SNES){const t=16*(7&this.channelIndex),n=16383&Math.floor(4096*e/32e3);this.chipEngine.write(nc.SNES,t+2,255&n),this.chipEngine.write(nc.SNES,t+3,n>>8&63)}}updateParameters(){switch(this.config.chipType){case 0:lc.mapOPN2(this.chipEngine,this.channelIndex,this.config);break;case 1:lc.mapOPM(this.chipEngine,this.channelIndex,this.config);break;case 2:lc.mapOPL3(this.chipEngine,this.channelIndex,this.config);break;case 11:lc.mapOPLL(this.chipEngine,this.channelIndex,this.config);break;case 13:lc.mapOPNA(this.chipEngine,this.channelIndex,this.config);break;case 14:case 48:lc.mapOPNB(this.chipEngine,this.channelIndex,this.config);break;case 22:lc.mapOPZ(this.chipEngine,this.channelIndex,this.config);break;case 23:lc.mapY8950(this.chipEngine,this.channelIndex,this.config);break;case 26:lc.mapOPL4(this.chipEngine,this.channelIndex,this.config);break;case 47:lc.mapOPN(this.chipEngine,this.channelIndex,this.config);break;case 49:lc.mapOPL3(this.chipEngine,this.channelIndex,this.config,nc.ESFM);break;case 3:lc.mapPSG(this.chipEngine,this.channelIndex,this.config);break;case 12:lc.mapAY(this.chipEngine,this.channelIndex,this.config);break;case 18:lc.mapSAA(this.chipEngine,this.channelIndex,this.config);break;case 43:lc.mapT6W28(this.chipEngine,this.channelIndex,this.config);break;case 4:lc.mapNES(this.chipEngine,this.channelIndex,this.config);break;case 5:lc.mapGB(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&lc.uploadWavetable(this.chipEngine,nc.GB,this.config.wavetables[0].data);break;case 6:lc.mapPCE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&lc.uploadWavetable(this.chipEngine,nc.PCE,this.config.wavetables[0].data);break;case 24:lc.mapSNES(this.chipEngine,this.channelIndex,this.config);break;case 44:lc.mapVB(this.chipEngine,this.channelIndex,this.config);break;case 16:lc.mapFDS(this.chipEngine,this.channelIndex,this.config);break;case 17:lc.mapMMC5(this.chipEngine,this.channelIndex,this.config);break;case 8:lc.mapN163(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&lc.uploadWavetable(this.chipEngine,nc.N163,this.config.wavetables[0].data);break;case 9:lc.mapVRC6(this.chipEngine,this.channelIndex,this.config);break;case 7:lc.mapSCC(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&lc.uploadWavetable(this.chipEngine,nc.SCC,this.config.wavetables[0].data);break;case 19:lc.mapSWAN(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&lc.uploadWavetable(this.chipEngine,nc.SWAN,this.config.wavetables[0].data);break;case 36:lc.mapVERA(this.chipEngine,this.channelIndex,this.config);break;case 37:lc.mapSM8521(this.chipEngine,this.channelIndex,this.config);break;case 38:lc.mapBUBBLE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&lc.uploadWavetable(this.chipEngine,nc.BUBBLE,this.config.wavetables[0].data);break;case 10:case 45:case 46:lc.mapC64(this.chipEngine,this.channelIndex,this.config);break;case 20:lc.mapOKI(this.chipEngine,this.channelIndex,this.config);break;case 21:lc.mapES5506(this.chipEngine,this.channelIndex,this.config);break;case 27:lc.mapSEGAPCM(this.chipEngine,this.channelIndex,this.config);break;case 28:lc.mapYMZ280B(this.chipEngine,this.channelIndex,this.config);break;case 29:lc.mapRF5C68(this.chipEngine,this.channelIndex,this.config);break;case 30:lc.mapGA20(this.chipEngine,this.channelIndex,this.config);break;case 31:lc.mapC140(this.chipEngine,this.channelIndex,this.config);break;case 32:lc.mapQSOUND(this.chipEngine,this.channelIndex,this.config);break;case 39:lc.mapK007232(this.chipEngine,this.channelIndex,this.config);break;case 40:lc.mapK053260(this.chipEngine,this.channelIndex,this.config);break;case 41:lc.mapX1_010(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&lc.uploadWavetable(this.chipEngine,nc.X1_010,this.config.wavetables[0].data);break;case 15:lc.mapTIA(this.chipEngine,this.channelIndex,this.config);break;case 33:lc.mapVIC(this.chipEngine,this.channelIndex,this.config);break;case 34:lc.mapTED(this.chipEngine,this.channelIndex,this.config);break;case 35:lc.mapSUPERVISION(this.chipEngine,this.channelIndex,this.config);break;case 42:lc.mapUPD1771(this.chipEngine,this.channelIndex,this.config);break;case 25:lc.mapLYNX(this.chipEngine,this.channelIndex,this.config);break;case 55:lc.mapNAMCO(this.chipEngine,this.channelIndex,this.config);break;case 56:lc.mapPET(this.chipEngine,this.channelIndex,this.config);break;case 57:lc.mapPOKEY(this.chipEngine,this.channelIndex,this.config);break;case 61:lc.mapAMIGA(this.chipEngine,this.channelIndex,this.config);break;case 62:lc.mapPCSPKR(this.chipEngine,this.channelIndex,this.config)}}triggerAttack(e,t,n){const s=ho(e);this.activeNoteFreq=s,this.isNoteOn=!0,this.velocity=void 0!==n?n:1;const a=t||fo();return this.noteOnTime=fo(),this.useWasmEngine||(this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters()):this.initInProgress||this.initEngine()),this.useWasmEngine?(this.macroPositions.clear(),this.opMacroPositions=Array.from({length:4},()=>({})),this.currentDuty=2,this.currentPan=0,this.baseTLValues=this.config.operators.map(e=>e.tl),this.applyVelocityToCarriers(),this.updateParameters(),this.updateFrequency(s),this.writeKeyOn(n),this.wasmNoteTriggered=!0,this.processTick(a),this):this}applyVelocityToCarriers(){if(this.config.chipType!==nc.OPN2&&this.config.chipType!==nc.OPM)return;const e=[[3],[3],[3],[3],[2,3],[2,3],[1,2,3],[0,1,2,3]][7&this.config.algorithm]||[3],t=Math.floor(32*(1-this.velocity));for(const n of e)if(this.config.operators[n]){const e=this.baseTLValues[n];this.config.operators[n].tl=Math.min(127,e+t)}}writeKeyOn(e){const t=this.channelIndex,n=void 0!==e?Math.floor(15*e):15;switch(this.config.chipType){case nc.OPN2:{const e=(t<3?0:1)<<2|t%3,n=240|e;this.chipEngine.write(nc.OPN2,40,e),this.chipEngine.write(nc.OPN2,40,n);break}case nc.OPM:this.chipEngine.write(nc.OPM,8,7&t),this.chipEngine.write(nc.OPM,8,120|7&t);break;case nc.NES:if(this.chipEngine.write(nc.NES,16405,31),t<2){const e=16384+4*t,s=cc.freqToNES(this.activeNoteFreq);this.chipEngine.write(nc.NES,e,(3&this.currentDuty)<<6|48|n),this.chipEngine.write(nc.NES,e+1,8),this.chipEngine.write(nc.NES,e+2,255&s),this.chipEngine.write(nc.NES,e+3,8|s>>8&7)}else if(2===t){const e=cc.freqToNES(this.activeNoteFreq);this.chipEngine.write(nc.NES,16392,255),this.chipEngine.write(nc.NES,16394,255&e),this.chipEngine.write(nc.NES,16395,8|e>>8&7)}else 3===t&&(this.chipEngine.write(nc.NES,16396,48|n),this.chipEngine.write(nc.NES,16398,15&this.nesNoiseIndex),this.chipEngine.write(nc.NES,16399,8));break;case nc.GB:{const e=this.gbFreqVal||0;if(t<2){const s=0===t?16:21;this.chipEngine.write(nc.GB,s+1,(3&this.currentDuty)<<6|63),this.chipEngine.write(nc.GB,s+2,n<<4|8),this.chipEngine.write(nc.GB,s+3,2048-e&255),this.chipEngine.write(nc.GB,s+4,2048-e>>8&7|128)}else 2===t?(this.chipEngine.write(nc.GB,26,128),this.chipEngine.write(nc.GB,27,255),this.chipEngine.write(nc.GB,28,32),this.chipEngine.write(nc.GB,29,2048-e&255),this.chipEngine.write(nc.GB,30,2048-e>>8&7|128)):3===t&&(this.chipEngine.write(nc.GB,32,63),this.chipEngine.write(nc.GB,33,n<<4|8),this.chipEngine.write(nc.GB,34,0),this.chipEngine.write(nc.GB,35,128));this.chipEngine.write(nc.GB,38,128);break}case nc.PSG:{const e=15-Math.min(15,n);this.chipEngine.write(nc.PSG,0,144|(3&t)<<5|e);break}case nc.PCE:{const e=4095&Math.floor(3579545/(32*this.activeNoteFreq));this.chipEngine.write(nc.PCE,0,7&t),this.chipEngine.write(nc.PCE,4,95),this.chipEngine.write(nc.PCE,4,31);for(let t=0;t<32;t++){const e=t<16?31:0;this.chipEngine.write(nc.PCE,6,e)}this.chipEngine.write(nc.PCE,2,255&e),this.chipEngine.write(nc.PCE,3,e>>8&15),this.chipEngine.write(nc.PCE,5,255),this.chipEngine.write(nc.PCE,4,128|31&n);break}case nc.SNES:{const e=16*(7&t),s=1<<(7&t);this.chipEngine.write(nc.SNES,92,s);const a=16383&Math.floor(4096*this.activeNoteFreq/32e3);this.chipEngine.write(nc.SNES,e+2,255&a),this.chipEngine.write(nc.SNES,e+3,a>>8&63),this.chipEngine.write(nc.SNES,e+5,255),this.chipEngine.write(nc.SNES,e+6,224),this.chipEngine.write(nc.SNES,e+0,8*n),this.chipEngine.write(nc.SNES,e+1,8*n),this.chipEngine.write(nc.SNES,92,0),this.chipEngine.write(nc.SNES,76,s);break}case nc.OPL3:{const e=t%9,n=t<9?0:256,s=(7&this._oplBlock)<<2|this._oplFnum>>8&3,a=32|s;this.chipEngine.write(nc.OPL3,n|176+e,s),this.chipEngine.write(nc.OPL3,n|176+e,a);break}case nc.OPLL:{const e=t%9,n=(7&this._oplBlock)<<1|this._oplFnum>>8&1,s=16|n;this.chipEngine.write(nc.OPLL,32+e,n),this.chipEngine.write(nc.OPLL,32+e,s);break}case nc.OPNA:{const e=(t<3?0:1)<<2|t%3,n=240|e;this.chipEngine.write(nc.OPNA,40,e),this.chipEngine.write(nc.OPNA,40,n);break}case nc.OPNB:{const e=[1,2,5,6][3&t];this.chipEngine.write(nc.OPNB,40,e),this.chipEngine.write(nc.OPNB,40,240|e);break}case nc.OPN:{const e=t%3;this.chipEngine.write(nc.OPN,40,e),this.chipEngine.write(nc.OPN,40,240|e);break}case nc.OPZ:{const e=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7,n=64|e;this.chipEngine.write(nc.OPZ,32+(7&t),e),this.chipEngine.write(nc.OPZ,32+(7&t),n);break}case nc.Y8950:case nc.OPL4:{const e=this.config.chipType,n=t%9,s=(7&this._oplBlock)<<2|this._oplFnum>>8&3,a=32|s;this.chipEngine.write(e,176+n,s),this.chipEngine.write(e,176+n,a);break}case nc.AY:{const e=4095&Math.floor(1789773/(16*this.activeNoteFreq));this.chipEngine.write(nc.AY,2*t,255&e),this.chipEngine.write(nc.AY,2*t+1,e>>8&15),this.chipEngine.write(nc.AY,8+t,15&n);const s=63&~(1<<t);this.chipEngine.write(nc.AY,7,s);break}case nc.SAA:{const e=8e6;let s=4,a=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-s)));for(;a<0&&s<7;)s++,a=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-s)));for(;a>255&&s>0;)s--,a=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-s)));a=Math.max(0,Math.min(255,a)),this.chipEngine.write(nc.SAA,0+t,n<<4|n),this.chipEngine.write(nc.SAA,8+t,a);const o=16+Math.floor(t/2),r=t%2*4;this.chipEngine.write(nc.SAA,o,s<<r|s<<4*(1-t%2)),this.chipEngine.write(nc.SAA,20,1<<t);break}case nc.T6W28:{const e=3072e3,s=3===t?15:16,a=Math.floor(e/(s*this.activeNoteFreq))-1,o=Math.max(0,Math.min(1023,a)),r=15-Math.min(15,n);this.chipEngine.write(nc.T6W28,0,128|(3&t)<<5|15&o),this.chipEngine.write(nc.T6W28,0,o>>4&63),this.chipEngine.write(nc.T6W28,1,128|(3&t)<<5|15&o),this.chipEngine.write(nc.T6W28,1,o>>4&63),this.chipEngine.write(nc.T6W28,0,144|(3&t)<<5|r),this.chipEngine.write(nc.T6W28,1,144|(3&t)<<5|r);break}case nc.VRC6:if(t<2){const e=0===t?36864:40960,s=Math.floor(3579545/(16*this.activeNoteFreq))-1;this.chipEngine.write(nc.VRC6,e,(7&this.currentDuty)<<4|n),this.chipEngine.write(nc.VRC6,e+1,255&s),this.chipEngine.write(nc.VRC6,e+2,128|s>>8&15)}else{const e=Math.floor(3579545/(14*this.activeNoteFreq))-1;this.chipEngine.write(nc.VRC6,45056,63&n),this.chipEngine.write(nc.VRC6,45057,255&e),this.chipEngine.write(nc.VRC6,45058,128|e>>8&15)}break;case nc.N163:{const e=Math.floor(7864320*this.activeNoteFreq/3579545);this.chipEngine.write(nc.N163,120,255&e),this.chipEngine.write(nc.N163,122,e>>8&255),this.chipEngine.write(nc.N163,124,224|e>>16&3),this.chipEngine.write(nc.N163,127,240|n);break}case nc.FDS:{const e=4095&Math.floor(65536*this.activeNoteFreq/1789773);this.chipEngine.write(nc.FDS,16512,128|2*n),this.chipEngine.write(nc.FDS,16514,255&e),this.chipEngine.write(nc.FDS,16515,e>>8&15);break}case nc.MMC5:{const e=0===t?20480:20484,s=cc.freqToNES(this.activeNoteFreq);this.chipEngine.write(nc.MMC5,e,(3&this.currentDuty)<<6|48|n),this.chipEngine.write(nc.MMC5,e+2,255&s),this.chipEngine.write(nc.MMC5,e+3,8|s>>8&7);break}case nc.SCC:{const e=Math.floor(3579545/(16*this.activeNoteFreq))-1,s=128;this.chipEngine.write(nc.SCC,s+2*t,255&e),this.chipEngine.write(nc.SCC,s+2*t+1,e>>8&15),this.chipEngine.write(nc.SCC,s+10+t,15&n),this.chipEngine.write(nc.SCC,s+15,1<<t);break}case nc.SWAN:{const e=3072e3,s=2047&Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(nc.SWAN,2*t,255&s),this.chipEngine.write(nc.SWAN,2*t+1,s>>8&7),this.chipEngine.write(nc.SWAN,8+t,n<<4|n),this.chipEngine.write(nc.SWAN,16,1<<t),this.chipEngine.write(nc.SWAN,17,15);break}case nc.VERA:{const e=25e6,s=65535&Math.floor(2097152*this.activeNoteFreq/e),a=4*t;this.chipEngine.write(nc.VERA,a+0,255&s),this.chipEngine.write(nc.VERA,a+1,s>>8&255),this.chipEngine.write(nc.VERA,a+2,(63&n)<<2|3),this.chipEngine.write(nc.VERA,a+3,63);break}case nc.SM8521:{const e=756e3,s=Math.floor(4096-e/(32*this.activeNoteFreq)),a=Math.max(0,Math.min(4095,s)),o=[[71,70],[73,72],[77,76]],r=[66,68,74];this.chipEngine.write(nc.SM8521,r[t]||66,31&n),o[t]&&(this.chipEngine.write(nc.SM8521,o[t][0],a>>8&15),this.chipEngine.write(nc.SM8521,o[t][1],255&a)),this.chipEngine.write(nc.SM8521,64,128|1<<t);break}case nc.BUBBLE:{const e=3579545,s=Math.floor(4096-e/(32*this.activeNoteFreq)),a=Math.max(0,Math.min(4095,s));this.chipEngine.write(nc.BUBBLE,1&t,255&a),this.chipEngine.write(nc.BUBBLE,2+(1&t),15&n);break}case nc.X1_010:{const e=4194304,s=65535&Math.floor(this.activeNoteFreq*e/1e6),a=t<<3;this.chipEngine.write(nc.X1_010,a+2,255&s),this.chipEngine.write(nc.X1_010,a+3,s>>8&255),this.chipEngine.write(nc.X1_010,a+1,n<<4),this.chipEngine.write(nc.X1_010,a,3);break}case nc.VB:{const e=5e6,s=Math.floor(2048-e/(16*this.activeNoteFreq)),a=Math.max(0,Math.min(2047,s)),o=1024+64*t;this.chipEngine.write(nc.VB,o+8,2047-a&255),this.chipEngine.write(nc.VB,o+12,2047-a>>8&7),this.chipEngine.write(nc.VB,o+4,255),this.chipEngine.write(nc.VB,o+16,(15&n)<<4),this.chipEngine.write(nc.VB,o+20,0),this.chipEngine.write(nc.VB,o+0,128);break}case nc.LYNX:{const e=16e6,s=Math.floor(e/(256*this.activeNoteFreq))-1,a=Math.max(0,Math.min(255,s)),o=32+8*t;this.chipEngine.write(nc.LYNX,o+0,n<<4|n),this.chipEngine.write(nc.LYNX,o+1,1),this.chipEngine.write(nc.LYNX,o+4,a),this.chipEngine.write(nc.LYNX,o+5,128),this.chipEngine.write(nc.LYNX,80,255);break}case nc.SID:{const e=t*64;this.chipEngine.write(nc.SID,e+0,1);break}case nc.SID_6581:case nc.SID_8580:{const e=7*t,n=45===this.config.chipType?nc.SID_6581:nc.SID_8580,s=0,a=8,o=15,r=8,i=64,l=1,c=2048;this.chipEngine.write(n,e+2,255&c),this.chipEngine.write(n,e+3,c>>8&15),this.chipEngine.write(n,e+5,s<<4|a),this.chipEngine.write(n,e+6,o<<4|r),this.chipEngine.write(n,e+4,i|l);break}case nc.TIA:{const e=31440,s=Math.floor(e/(32*this.activeNoteFreq))-1,a=Math.max(0,Math.min(31,s)),o=0===t?21:22;this.chipEngine.write(nc.TIA,o,4),this.chipEngine.write(nc.TIA,o+2,31&a),this.chipEngine.write(nc.TIA,o+4,15&n);break}case nc.VIC:{const e=1022727;let s=Math.floor(256-e/(32*this.activeNoteFreq));s>>=t<3?2-t:1;const a=Math.max(0,Math.min(127,s));this.chipEngine.write(nc.VIC,10+t,255-a),this.chipEngine.write(nc.VIC,14,15&n);break}case nc.TED:{const e=1773447,s=Math.floor(1024-e/(8*this.activeNoteFreq)),a=Math.max(0,Math.min(1023,s));0===t?(this.chipEngine.write(nc.TED,14,1022-a&255),this.chipEngine.write(nc.TED,18,1022-a>>8&3)):(this.chipEngine.write(nc.TED,15,1022-a&255),this.chipEngine.write(nc.TED,16,1022-a>>8&3));const o=15&n|(0===t?16:32);this.chipEngine.write(nc.TED,17,o);break}case nc.SUPERVISION:{const e=4e6;if(t<2){const n=Math.floor(2*e/(32*this.activeNoteFreq)),s=Math.max(1,Math.min(2047,n)),a=16+4*t;this.chipEngine.write(nc.SUPERVISION,a,255&s),this.chipEngine.write(nc.SUPERVISION,a+1,s>>8&7);const o=30|(3&this.currentDuty)<<4;this.chipEngine.write(nc.SUPERVISION,a+2,o),this.chipEngine.write(nc.SUPERVISION,a+3,255)}else if(3===t){const e=15-(15&Math.floor(12*Math.log2(this.activeNoteFreq/440)+69))<<4|15&n;this.chipEngine.write(nc.SUPERVISION,40,e),this.chipEngine.write(nc.SUPERVISION,41,200),this.chipEngine.write(nc.SUPERVISION,42,30)}break}case nc.UPD1771:this.chipEngine.write(nc.UPD1771,0,2);break;case nc.OKI:this.chipEngine.write(nc.OKI,t,128|n<<3);break;case nc.SEGAPCM:{const e=8*t;this.chipEngine.write(nc.SEGAPCM,e+134,255),this.chipEngine.write(nc.SEGAPCM,e+2,n<<3),this.chipEngine.write(nc.SEGAPCM,e+3,n<<3);break}case nc.YMZ280B:{const e=4*t;this.chipEngine.write(nc.YMZ280B,1+e,192|n<<1);break}case nc.RF5C68:this.chipEngine.write(nc.RF5C68,7,t),this.chipEngine.write(nc.RF5C68,8,255&~(1<<t));break;case nc.GA20:this.chipEngine.write(nc.GA20,0+8*t+5,0);break;case nc.C140:{const e=16*t;this.chipEngine.write(nc.C140,e+5,96);break}case nc.QSOUND:this.chipEngine.write(nc.QSOUND,8*t+6,n<<4);break;case nc.K007232:this.chipEngine.write(nc.K007232,6*t+0,128);break;case nc.K053260:this.chipEngine.write(nc.K053260,40,1<<t);break;case nc.ES5506:break;case nc.OPNB_B:{const e=[1,2,5,6,0,4][t%6];this.chipEngine.write(nc.OPNB_B,40,e),this.chipEngine.write(nc.OPNB_B,40,240|e);break}case nc.ESFM:{const e=t%18,n=e<9?0:256,s=(7&this._oplBlock)<<2|this._oplFnum>>8&3,a=32|s;this.chipEngine.write(nc.ESFM,n|176+e%9,s),this.chipEngine.write(nc.ESFM,n|176+e%9,a);break}case nc.AY8930:{const e=1789773,s=65535&Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(nc.AY8930,2*t,255&s),this.chipEngine.write(nc.AY8930,2*t+1,s>>8&255),this.chipEngine.write(nc.AY8930,8+t,31&n),this.chipEngine.write(nc.AY8930,7,63&~(1<<t)),this.chipEngine.write(nc.AY8930,22+t,8);break}case nc.NDS:{const e=16*t,s=65535&Math.floor(65536*this.activeNoteFreq/32768);this.chipEngine.write(nc.NDS,e+8,255&s),this.chipEngine.write(nc.NDS,e+9,s>>8&255),this.chipEngine.write(nc.NDS,e+3,128|n<<1);break}case nc.GBA_DMA:this.chipEngine.write(nc.GBA_DMA,130,11);break;case nc.GBA_MINMOD:this.chipEngine.write(nc.GBA_MINMOD,0,128|n);break;case nc.POKEMINI:{const e=4e6,t=Math.floor(e/(16*this.activeNoteFreq)),s=Math.max(1,Math.min(65535,t));this.chipEngine.write(nc.POKEMINI,74,255&s),this.chipEngine.write(nc.POKEMINI,75,s>>8&255),this.chipEngine.write(nc.POKEMINI,76,s>>1&255),this.chipEngine.write(nc.POKEMINI,77,s>>1>>8&255),this.chipEngine.write(nc.POKEMINI,72,4),this.chipEngine.write(nc.POKEMINI,113,n>8?3:n>4?2:1);break}case nc.NAMCO:{const e=4194304,s=1048575&Math.floor(this.activeNoteFreq*e/192e3);if(0===t)this.chipEngine.write(nc.NAMCO,16,s>>4&15),this.chipEngine.write(nc.NAMCO,17,15&s),this.chipEngine.write(nc.NAMCO,18,s>>8&15),this.chipEngine.write(nc.NAMCO,19,s>>12&15),this.chipEngine.write(nc.NAMCO,20,s>>16&15);else{const e=21+5*(t-1);this.chipEngine.write(nc.NAMCO,e+1,15&s),this.chipEngine.write(nc.NAMCO,e+2,s>>8&15),this.chipEngine.write(nc.NAMCO,e+3,s>>12&15),this.chipEngine.write(nc.NAMCO,e+4,s>>16&15)}this.chipEngine.write(nc.NAMCO,21+5*t,15&n),this.chipEngine.write(nc.NAMCO,5+5*t,0);break}case nc.PET:{const e=1e6,t=Math.floor(e/(16*this.activeNoteFreq))-1,n=Math.max(0,Math.min(65535,t));this.chipEngine.write(nc.PET,8,255&n),this.chipEngine.write(nc.PET,9,n>>8&255),this.chipEngine.write(nc.PET,11,16);break}case nc.POKEY:{const e=1789773,s=Math.floor(e/(2*this.activeNoteFreq))-1,a=Math.max(0,Math.min(255,s));this.chipEngine.write(nc.POKEY,2*t,a),this.chipEngine.write(nc.POKEY,2*t+1,160|15&n),this.chipEngine.write(nc.POKEY,8,0),this.chipEngine.write(nc.POKEY,15,3);break}case nc.MSM6258:this.chipEngine.write(nc.MSM6258,0,2);break;case nc.MSM5232:this.chipEngine.write(nc.MSM5232,t,128|n);break;case nc.MULTIPCM:{const e=t<<3;this.chipEngine.write(nc.MULTIPCM,e+4,128),this.chipEngine.write(nc.MULTIPCM,e+5,15-n<<3);break}case nc.AMIGA:{const e=3546895,s=Math.floor(e/(2*this.activeNoteFreq)),a=Math.max(124,Math.min(65535,s)),o=160+16*t;this.chipEngine.write(nc.AMIGA,o+6,a>>8&255),this.chipEngine.write(nc.AMIGA,o+7,255&a),this.chipEngine.write(nc.AMIGA,o+8,4*n&127),this.chipEngine.write(nc.AMIGA,150,32768|1<<t);break}case nc.PCSPKR:{const e=1193182,t=Math.floor(e/this.activeNoteFreq),n=Math.max(1,Math.min(65535,t));this.chipEngine.write(nc.PCSPKR,0,255&n),this.chipEngine.write(nc.PCSPKR,1,n>>8&255);break}case nc.PONG:this.chipEngine.write(nc.PONG,0,1);break;case nc.PV1000:{const e=3579545,n=Math.floor(63-e/(1024*this.activeNoteFreq)),s=Math.max(0,Math.min(62,n));this.chipEngine.write(nc.PV1000,t,s);break}case nc.DAVE:{const e=8e6,s=Math.floor(4096-e/(8*this.activeNoteFreq)),a=Math.max(0,Math.min(4095,s));this.chipEngine.write(nc.DAVE,2*t,255&a),this.chipEngine.write(nc.DAVE,2*t+1,a>>8&15),this.chipEngine.write(nc.DAVE,8+t,n<<2&63),this.chipEngine.write(nc.DAVE,12+t,n<<2&63),this.chipEngine.write(nc.DAVE,7,15);break}case nc.SU:{const e=t<<3;this.chipEngine.write(nc.SU,e+4,128|n);break}case nc.BIFURCATOR:this.chipEngine.write(nc.BIFURCATOR,t,n);break;case nc.POWERNOISE:{const e=t<<2;this.chipEngine.write(nc.POWERNOISE,e+0,128|n);break}case nc.ZXBEEPER:{const e=35e5,t=Math.floor(e/(2*this.activeNoteFreq));this.chipEngine.write(nc.ZXBEEPER,0,255&t),this.chipEngine.write(nc.ZXBEEPER,1,t>>8&255);break}case nc.ZXBEEPER_QT:{const e=35e5,n=Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(nc.ZXBEEPER_QT,2*t,255&n),this.chipEngine.write(nc.ZXBEEPER_QT,2*t+1,n>>8&255);break}case nc.SCVTONE:{const e=3579545,s=Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(nc.SCVTONE,2*t,255&s),this.chipEngine.write(nc.SCVTONE,2*t+1,s>>8&15|n<<4);break}case nc.PCMDAC:this.chipEngine.write(nc.PCMDAC,0,128|n)}}triggerRelease(){if(this.isNoteOn=!1,!this.useWasmEngine)return this;const e=fo()-this.noteOnTime;if(e<pc.MIN_GATE_TIME){const t=1e3*(pc.MIN_GATE_TIME-e);setTimeout(()=>this.writeKeyOff(),t)}else this.writeKeyOff();return this}releaseAll(){this.triggerRelease()}writeKeyOff(){if(!this.wasmNoteTriggered)return;this.wasmNoteTriggered=!1;const e=this.channelIndex;switch(this.config.chipType){case nc.OPN2:{const t=e%3,n=e<3?0:1,s=0===n?0:256,a=n<<2|t;this.chipEngine.write(nc.OPN2,40,a);const o=[0,8,4,12];for(let e=0;e<4;e++){const n=o[e]+t;this.chipEngine.write(nc.OPN2,s|64+n,127)}break}case nc.OPM:{const t=7&e;this.chipEngine.write(nc.OPM,8,t);const n=[0,16,8,24];for(let s=0;s<4;s++){const t=n[s]+(7&e);this.chipEngine.write(nc.OPM,96+t,127)}break}case nc.OPL3:{const t=e%9,n=e<9?0:256,s=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(nc.OPL3,n|176+t,s);break}case nc.OPLL:{const t=e%9,n=3579545;let s=0,a=Math.round(72*this.activeNoteFreq*Math.pow(2,19-s)/n);for(;a>511&&s<7;)s++,a=Math.round(72*this.activeNoteFreq*Math.pow(2,19-s)/n);a=Math.min(511,Math.max(0,a));const o=(7&s)<<1|a>>8&1;this.chipEngine.write(nc.OPLL,32+t,o);break}case nc.OPNA:{const t=(e<3?0:1)<<2|e%3;this.chipEngine.write(nc.OPNA,40,t);break}case nc.OPNB:{const t=[1,2,5,6][3&e];this.chipEngine.write(nc.OPNB,40,t);break}case nc.OPN:{const t=e%3;this.chipEngine.write(nc.OPN,40,t);break}case nc.OPZ:{const t=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7;this.chipEngine.write(nc.OPZ,32+(7&e),t);break}case nc.Y8950:case nc.OPL4:{const t=this.config.chipType,n=e%9,s=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(t,176+n,s);break}case nc.PSG:this.chipEngine.write(nc.PSG,0,159|(3&e)<<5);break;case nc.AY:this.chipEngine.write(nc.AY,8+e,0);break;case nc.SAA:this.chipEngine.write(nc.SAA,0+e,0),this.chipEngine.write(nc.SAA,20,0);break;case nc.T6W28:this.chipEngine.write(nc.T6W28,0,159|(3&e)<<5),this.chipEngine.write(nc.T6W28,1,159|(3&e)<<5);break;case nc.NES:if(e<2){const t=16384+4*e;this.chipEngine.write(nc.NES,t,48)}else 2===e?this.chipEngine.write(nc.NES,16392,0):3===e&&this.chipEngine.write(nc.NES,16396,48);break;case nc.GB:{const t=16+5*e;e<2?this.chipEngine.write(nc.GB,t+2,8):2===e?this.chipEngine.write(nc.GB,28,0):3===e&&this.chipEngine.write(nc.GB,33,8);break}case nc.PCE:this.chipEngine.write(nc.PCE,0,7&e),this.chipEngine.write(nc.PCE,5,0);break;case nc.SNES:this.chipEngine.write(nc.SNES,92,1<<(7&e));break;case nc.VB:{const t=1024+64*e;this.chipEngine.write(nc.VB,t+16,0);break}case nc.LYNX:{const t=32+8*e;this.chipEngine.write(nc.LYNX,t+0,0);break}case nc.VRC6:if(e<2){const t=0===e?36864:40960;this.chipEngine.write(nc.VRC6,t,0)}else this.chipEngine.write(nc.VRC6,45056,0);break;case nc.N163:this.chipEngine.write(nc.N163,127,0);break;case nc.FDS:this.chipEngine.write(nc.FDS,16512,128);break;case nc.MMC5:{const t=0===e?20480:20484;this.chipEngine.write(nc.MMC5,t,48);break}case nc.SCC:this.chipEngine.write(nc.SCC,170+e,0);break;case nc.SWAN:this.chipEngine.write(nc.SWAN,8+e,0);break;case nc.VERA:{const t=4*e;this.chipEngine.write(nc.VERA,t+2,0);break}case nc.SM8521:{const t=[66,68,74][e]||66;this.chipEngine.write(nc.SM8521,t,0);break}case nc.BUBBLE:this.chipEngine.write(nc.BUBBLE,2+e,0);break;case nc.X1_010:{const t=e<<3;this.chipEngine.write(nc.X1_010,t,0);break}case nc.SID:{const t=0,n=e*64;this.chipEngine.write(nc.SID,n+t,0);break}case nc.SID_6581:case nc.SID_8580:{const t=7*e,n=45===this.config.chipType?nc.SID_6581:nc.SID_8580;this.chipEngine.write(n,t+4,0);break}case nc.TIA:this.chipEngine.write(nc.TIA,25+e,0);break;case nc.VIC:this.chipEngine.write(nc.VIC,10+e,0);break;case nc.TED:this.chipEngine.write(nc.TED,17,0);break;case nc.SUPERVISION:{const t=16+4*e;this.chipEngine.write(nc.SUPERVISION,t+2,0);break}case nc.UPD1771:this.chipEngine.write(nc.UPD1771,0,0);break;case nc.YMZ280B:{const t=4*e;this.chipEngine.write(nc.YMZ280B,1+t,64);break}case nc.RF5C68:this.chipEngine.write(nc.RF5C68,8,255);break;case nc.GA20:{const t=8*e;this.chipEngine.write(nc.GA20,t+5,0),this.chipEngine.write(nc.GA20,t+6,0);break}case nc.SEGAPCM:{const t=8*(15&e);this.chipEngine.write(nc.SEGAPCM,134+t,0);break}case nc.K007232:this.chipEngine.write(nc.K007232,12,0);break;case nc.K053260:this.chipEngine.write(nc.K053260,40,0);break;case nc.QSOUND:{const t=e%16,n=t<8?6+8*t:70+8*(t-8);this.chipEngine.write(nc.QSOUND,0,0),this.chipEngine.write(nc.QSOUND,1,0),this.chipEngine.write(nc.QSOUND,2,n);break}case nc.C140:{const t=16*(e%24);this.chipEngine.write(nc.C140,t+5,0);break}case nc.ES5506:case nc.OKI:break;case nc.OPNB_B:{const t=[1,2,5,6,0,4][e%6];this.chipEngine.write(nc.OPNB_B,40,t);break}case nc.ESFM:{const t=e%9,n=e<9?0:256,s=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(nc.ESFM,n|176+t,s);break}case nc.AY8930:this.chipEngine.write(nc.AY8930,8+e,0);break;case nc.NDS:{const t=16*e;this.chipEngine.write(nc.NDS,t+3,0);break}case nc.GBA_DMA:this.chipEngine.write(nc.GBA_DMA,132,0);break;case nc.GBA_MINMOD:this.chipEngine.write(nc.GBA_MINMOD,132,0);break;case nc.POKEMINI:this.chipEngine.write(nc.POKEMINI,113,0);break;case nc.NAMCO:{const t=8*e;this.chipEngine.write(nc.NAMCO,21+t,0);break}case nc.PET:this.chipEngine.write(nc.PET,0,0);break;case nc.POKEY:this.chipEngine.write(nc.POKEY,2*e+1,0);break;case nc.MSM6258:this.chipEngine.write(nc.MSM6258,0,1);break;case nc.MSM5232:{const t=10+e;this.chipEngine.write(nc.MSM5232,t,0);break}case nc.MULTIPCM:{const t=8*e;this.chipEngine.write(nc.MULTIPCM,t+5,0);break}case nc.AMIGA:this.chipEngine.write(nc.AMIGA,150,1<<e);break;case nc.PCSPKR:this.chipEngine.write(nc.PCSPKR,97,0);break;case nc.PONG:break;case nc.PV1000:this.chipEngine.write(nc.PV1000,252+e,0);break;case nc.DAVE:{const t=8+3*e+2;this.chipEngine.write(nc.DAVE,t,0);break}case nc.SU:{const t=e<<5;this.chipEngine.write(nc.SU,t+2,0);break}case nc.BIFURCATOR:break;case nc.POWERNOISE:{const t=4*e;this.chipEngine.write(nc.POWERNOISE,t,0);break}case nc.ZXBEEPER:case nc.ZXBEEPER_QT:break;case nc.SCVTONE:this.chipEngine.write(nc.SCVTONE,e,0);break;case nc.PCMDAC:this.chipEngine.write(nc.PCMDAC,0,128)}}dispose(){this.output.disconnect()}}function hc(e){switch(e){case vc.GENESIS:case vc.GENESIS_EXT:case vc.YM2612:case vc.YM2612_EXT:case vc.YM2612_DUALPCM:case vc.YM2612_DUALPCM_EXT:case vc.YM2612_CSM:return"fm_opn2";case vc.YM2203:case vc.YM2203_EXT:case vc.YM2203_CSM:case vc.YM2608:case vc.YM2608_EXT:case vc.YM2608_CSM:case vc.YM2610:case vc.YM2610_EXT:case vc.YM2610_CRAP:case vc.YM2610_CRAP_EXT:case vc.YM2610_CSM:case vc.YM2610B:case vc.YM2610B_EXT:case vc.YM2610B_CSM:return"fm_opn";case vc.YM2151:case vc.ARCADE:case vc.TX81Z:return"fm_opm";case vc.OPL:case vc.OPL2:case vc.OPL3:case vc.OPL4:case vc.OPL_DRUMS:case vc.OPL2_DRUMS:case vc.OPL3_DRUMS:case vc.OPL4_DRUMS:case vc.Y8950:case vc.Y8950_DRUMS:case vc.ESFM:return"fm_opl";case vc.OPLL:case vc.OPLL_DRUMS:case vc.VRC7:case vc.NES_VRC7:return"fm_opll";case vc.AY8910:case vc.AY8930:case vc.SAA1099:return"psg";case vc.SMS:case vc.T6W28:return"sms";case vc.C64_6581:case vc.C64_8580:case vc.SID2:case vc.SID3:return"c64";case vc.SNES:return"snes";case vc.GB:return"gb";case vc.NES:return"nes";case vc.FDS:case vc.NES_FDS:return"fds";case vc.VRC6:return"vrc6";case vc.MMC5:return"mmc5";case vc.PCE:return"pce";case vc.NAMCO:case vc.NAMCO_15XX:case vc.NAMCO_CUS30:case vc.N163:return"namco";case vc.AMIGA:return"amiga";case vc.SEGAPCM:case vc.SEGAPCM_COMPAT:return"segapcm";case vc.QSOUND:case vc.MULTIPCM:case vc.RF5C68:case vc.MSM6295:case vc.MSM6258:case vc.YMZ280B:case vc.K007232:case vc.K053260:case vc.GA20:case vc.C140:case vc.C219:case vc.ES5506:case vc.PCM_DAC:case vc.GBA_DMA:case vc.GBA_MINMOD:case vc.VERA:return"sample";case vc.SCC:case vc.SCC_PLUS:return"scc";case vc.X1_010:return"x1010";case vc.BUBSYS_WSG:case vc.SOUND_UNIT:return"wavetable";case vc.POKEY:return"pokey";case vc.TIA:return"tia";case vc.SFX_BEEPER:case vc.SFX_BEEPER_QUADTONE:case vc.PCSPKR:return"beeper";case vc.VIC20:case vc.PET:case vc.TED:return"psg";default:return"other"}}class fc{platformType;family;effectMemory=new Map;_compatFlags={};constructor(e=vc.GB){this.platformType=e,this.family=hc(e)}setPlatform(e){this.platformType=e,this.family=hc(e)}setCompatFlags(e){this._compatFlags=e?.furnaceData?.compatFlags||{}}getCompatFlags(){return this._compatFlags}getMemory(e,t){return this.effectMemory.get(e)?.get(t)??0}setMemory(e,t,n){this.effectMemory.has(e)||this.effectMemory.set(e,new Map),this.effectMemory.get(e).set(t,n)}resetMemory(){this.effectMemory.clear()}routeEffect(e,t,n,s){e!==this.platformType&&this.setPlatform(e);const a=[];0===s?s=this.getMemory(t,n):this.setMemory(t,n,s);const o=s>>4&15,r=15&s;switch(n){case 0:0!==s&&a.push({cmd:xc.HINT_ARPEGGIO,chan:t,val1:o,val2:r});break;case 1:a.push({cmd:xc.PITCH,chan:t,val1:s,val2:0});break;case 2:a.push({cmd:xc.PITCH,chan:t,val1:-s,val2:0});break;case 3:a.push({cmd:xc.NOTE_PORTA,chan:t,val1:s,val2:1});break;case 4:a.push({cmd:xc.HINT_VIBRATO,chan:t,val1:o,val2:r});break;case 5:a.push({cmd:xc.HINT_VIBRATO,chan:t,val1:0,val2:0}),a.push({cmd:xc.HINT_VOL_SLIDE,chan:t,val1:o,val2:r});break;case 6:a.push({cmd:xc.HINT_PORTA,chan:t,val1:0,val2:0}),a.push({cmd:xc.HINT_VOL_SLIDE,chan:t,val1:o,val2:r});break;case 7:a.push({cmd:xc.HINT_TREMOLO,chan:t,val1:o,val2:r});break;case 8:a.push({cmd:xc.PANNING,chan:t,val1:s,val2:s}),a.push({cmd:xc.HINT_PANNING,chan:t,val1:s,val2:s});break;case 10:a.push({cmd:xc.HINT_VOL_SLIDE,chan:t,val1:o,val2:r});break;case 11:case 13:break;case 12:a.push({cmd:xc.VOLUME,chan:t,val1:s,val2:0}),a.push({cmd:xc.HINT_VOLUME,chan:t,val1:s,val2:0});break;case 14:a.push(...this.routeExtendedEffect(this.platformType,t,o,r));break;default:a.push(...this.routePlatformEffect(this.platformType,t,n,s))}return a}routeExtendedEffect(e,t,n,s){e!==this.platformType&&this.setPlatform(e);const a=[];switch(n){case 1:a.push({cmd:xc.PITCH,chan:t,val1:s,val2:0});break;case 2:a.push({cmd:xc.PITCH,chan:t,val1:-s,val2:0});break;case 3:a.push({cmd:xc.LEGATO,chan:t,val1:s,val2:0});break;case 4:a.push({cmd:xc.HINT_VIBRATO_SHAPE,chan:t,val1:s,val2:0});break;case 5:a.push({cmd:xc.PITCH,chan:t,val1:s-8,val2:1});break;case 9:a.push({cmd:xc.NOTE_ON,chan:t,val1:-1,val2:s});break;case 10:a.push({cmd:xc.HINT_VOL_SLIDE,chan:t,val1:s,val2:0});break;case 11:a.push({cmd:xc.HINT_VOL_SLIDE,chan:t,val1:0,val2:s});break;case 12:a.push({cmd:xc.NOTE_OFF,chan:t,val1:s,val2:0});break;case 13:a.push({cmd:xc.PRE_NOTE,chan:t,val1:s,val2:0});break;case 15:a.push({cmd:xc.MACRO_ON,chan:t,val1:s,val2:0})}return a}routePlatformEffect(e,t,n,s){switch(e!==this.platformType&&this.setPlatform(e),this.family){case"fm_opn2":return this.routeOPN2Effect(t,n,s);case"fm_opn":return this.routeOPNEffect(t,n,s);case"fm_opm":return this.routeOPMEffect(t,n,s);case"fm_opl":return this.routeOPLEffect(t,n,s);case"fm_opll":return this.routeOPLLEffect(t,n,s);case"psg":return this.routePSGEffect(t,n,s);case"sms":return this.routeSMSEffect(t,n,s);case"c64":return this.routeC64Effect(t,n,s);case"snes":return this.routeSNESEffect(t,n,s);case"gb":return this.routeGBEffect(t,n,s);case"nes":return this.routeNESEffect(t,n,s);case"fds":return this.routeFDSEffect(t,n,s);case"vrc6":return this.routeVRC6Effect(t,n,s);case"mmc5":return this.routeMMC5Effect(t,n,s);case"pce":return this.routePCEEffect(t,n,s);case"namco":return this.routeNamcoEffect(t,n,s);case"amiga":return this.routeAmigaEffect(t,n,s);case"segapcm":return this.routeSegaPCMEffect(t,n,s);case"sample":return this.routeSampleEffect(t,n,s);case"scc":return this.routeSCCEffect(t,n,s);case"x1010":return this.routeX1010Effect(t,n,s);case"wavetable":return this.routeWavetableEffect(t,n,s);case"pokey":return this.routePOKEYEffect(t,n,s);case"tia":return this.routeTIAEffect(t,n,s);default:return[]}}routeBaseFMEffect(e,t,n){const s=[];switch(t){case 17:s.push({cmd:xc.FM_FB,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.FM_TL,chan:e,val1:0,val2:n});break;case 19:s.push({cmd:xc.FM_TL,chan:e,val1:1,val2:n});break;case 20:s.push({cmd:xc.FM_TL,chan:e,val1:2,val2:n});break;case 21:s.push({cmd:xc.FM_TL,chan:e,val1:3,val2:n});break;case 22:{const t=n>>4;t>=1&&t<=4&&s.push({cmd:xc.FM_MULT,chan:e,val1:t-1,val2:15&n});break}case 25:s.push({cmd:xc.FM_AR,chan:e,val1:-1,val2:31&n});break;case 26:s.push({cmd:xc.FM_AR,chan:e,val1:0,val2:31&n});break;case 27:s.push({cmd:xc.FM_AR,chan:e,val1:1,val2:31&n});break;case 28:s.push({cmd:xc.FM_AR,chan:e,val1:2,val2:31&n});break;case 29:s.push({cmd:xc.FM_AR,chan:e,val1:3,val2:31&n});break;case 80:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_AM,chan:e,val1:t-1,val2:1&n});break}case 81:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_SL,chan:e,val1:t-1,val2:15&n});break}case 82:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_RR,chan:e,val1:t-1,val2:15&n});break}case 83:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_DT,chan:e,val1:t-1,val2:7&n});break}case 84:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_RS,chan:e,val1:t-1,val2:3&n});break}case 86:s.push({cmd:xc.FM_DR,chan:e,val1:-1,val2:31&n});break;case 87:s.push({cmd:xc.FM_DR,chan:e,val1:0,val2:31&n});break;case 88:s.push({cmd:xc.FM_DR,chan:e,val1:1,val2:31&n});break;case 89:s.push({cmd:xc.FM_DR,chan:e,val1:2,val2:31&n});break;case 90:s.push({cmd:xc.FM_DR,chan:e,val1:3,val2:31&n});break;case 91:s.push({cmd:xc.FM_D2R,chan:e,val1:-1,val2:31&n});break;case 92:s.push({cmd:xc.FM_D2R,chan:e,val1:0,val2:31&n});break;case 93:s.push({cmd:xc.FM_D2R,chan:e,val1:1,val2:31&n});break;case 94:s.push({cmd:xc.FM_D2R,chan:e,val1:2,val2:31&n});break;case 95:s.push({cmd:xc.FM_D2R,chan:e,val1:3,val2:31&n});break;case 96:s.push({cmd:xc.FM_OPMASK,chan:e,val1:n,val2:0});break;case 97:s.push({cmd:xc.FM_ALG,chan:e,val1:n,val2:0});break;case 98:s.push({cmd:xc.FM_FMS,chan:e,val1:n,val2:0});break;case 99:s.push({cmd:xc.FM_AMS,chan:e,val1:n,val2:0})}return s}routeAYEffect(e,t,n){const s=[];switch(t){case 32:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 33:s.push({cmd:xc.STD_NOISE_FREQ,chan:e,val1:n,val2:0});break;case 34:s.push({cmd:xc.AY_ENVELOPE_SET,chan:e,val1:n,val2:0});break;case 35:s.push({cmd:xc.AY_ENVELOPE_LOW,chan:e,val1:n,val2:0});break;case 36:s.push({cmd:xc.AY_ENVELOPE_HIGH,chan:e,val1:n,val2:0});break;case 37:s.push({cmd:xc.AY_ENVELOPE_SLIDE,chan:e,val1:-n,val2:0});break;case 38:s.push({cmd:xc.AY_ENVELOPE_SLIDE,chan:e,val1:n,val2:0});break;case 41:s.push({cmd:xc.AY_AUTO_ENVELOPE,chan:e,val1:n,val2:0});break;case 44:s.push({cmd:xc.AY_AUTO_PWM,chan:e,val1:n,val2:0});break;case 46:s.push({cmd:xc.AY_IO_WRITE,chan:e,val1:0,val2:n});break;case 47:s.push({cmd:xc.AY_IO_WRITE,chan:e,val1:1,val2:n})}return s}routeOPN2Effect(e,t,n){const s=[];switch(t){case 48:s.push({cmd:xc.FM_HARD_RESET,chan:e,val1:n,val2:0});break;case 223:s.push({cmd:xc.SAMPLE_DIR,chan:e,val1:n,val2:0});break;case 16:s.push({cmd:xc.FM_LFO,chan:e,val1:n,val2:0});break;case 85:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_SSG,chan:e,val1:t-1,val2:15&n});break}default:s.push(...this.routeBaseFMEffect(e,t,n))}return s}routeOPNEffect(e,t,n){const s=[];switch(t){case 48:s.push({cmd:xc.FM_HARD_RESET,chan:e,val1:n,val2:0});break;case 16:s.push({cmd:xc.FM_LFO,chan:e,val1:n,val2:0});break;case 31:s.push({cmd:xc.ADPCMA_GLOBAL_VOLUME,chan:e,val1:n,val2:0});break;case 85:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_SSG,chan:e,val1:t-1,val2:15&n});break}default:{const a=this.routeAYEffect(e,t,n);a.length>0?s.push(...a):s.push(...this.routeBaseFMEffect(e,t,n));break}}return s}routeOPMEffect(e,t,n){const s=[];switch(t){case 48:s.push({cmd:xc.FM_HARD_RESET,chan:e,val1:n,val2:0});break;case 16:s.push({cmd:xc.STD_NOISE_FREQ,chan:e,val1:n,val2:0});break;case 23:s.push({cmd:xc.FM_LFO,chan:e,val1:n,val2:0});break;case 24:s.push({cmd:xc.FM_LFO_WAVE,chan:e,val1:n,val2:0});break;case 30:s.push({cmd:xc.FM_AM_DEPTH,chan:e,val1:127&n,val2:0});break;case 31:s.push({cmd:xc.FM_PM_DEPTH,chan:e,val1:127&n,val2:0});break;case 85:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_DT2,chan:e,val1:t-1,val2:3&n});break}default:s.push(...this.routeBaseFMEffect(e,t,n))}return s}routeOPLEffect(e,t,n){const s=[];switch(t){case 48:s.push({cmd:xc.FM_HARD_RESET,chan:e,val1:n,val2:0});break;case 16:s.push({cmd:xc.FM_LFO,chan:e,val1:1&n,val2:0});break;case 23:s.push({cmd:xc.FM_LFO,chan:e,val1:2+(1&n),val2:0});break;case 42:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_WS,chan:e,val1:t-1,val2:7&n});break}case 83:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_VIB,chan:e,val1:t-1,val2:1&n});break}case 85:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_SUS,chan:e,val1:t-1,val2:1&n});break}case 91:{const t=n>>4;t<=4&&s.push({cmd:xc.FM_KSR,chan:e,val1:t-1,val2:1&n});break}default:s.push(...this.routeBaseFMEffect(e,t,n))}return s}routeOPLLEffect(e,t,n){const s=[];switch(t){case 48:s.push({cmd:xc.FM_HARD_RESET,chan:e,val1:n,val2:0});break;case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.FM_FB,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.FM_TL,chan:e,val1:0,val2:n});break;case 19:s.push({cmd:xc.FM_TL,chan:e,val1:1,val2:n});break;case 22:{const t=n>>4;t>=1&&t<=2&&s.push({cmd:xc.FM_MULT,chan:e,val1:t-1,val2:15&n});break}case 25:s.push({cmd:xc.FM_AR,chan:e,val1:-1,val2:15&n});break;case 26:s.push({cmd:xc.FM_AR,chan:e,val1:0,val2:15&n});break;case 27:s.push({cmd:xc.FM_AR,chan:e,val1:1,val2:15&n});break;case 80:{const t=n>>4;t<=2&&s.push({cmd:xc.FM_AM,chan:e,val1:t-1,val2:1&n});break}case 81:{const t=n>>4;t<=2&&s.push({cmd:xc.FM_SL,chan:e,val1:t-1,val2:15&n});break}case 82:{const t=n>>4;t<=2&&s.push({cmd:xc.FM_RR,chan:e,val1:t-1,val2:15&n});break}case 83:{const t=n>>4;t<=2&&s.push({cmd:xc.FM_VIB,chan:e,val1:t-1,val2:1&n});break}case 84:{const t=n>>4;t<=2&&s.push({cmd:xc.FM_RS,chan:e,val1:t-1,val2:3&n});break}case 85:{const t=n>>4;t<=2&&s.push({cmd:xc.FM_SUS,chan:e,val1:t-1,val2:1&n});break}case 86:s.push({cmd:xc.FM_DR,chan:e,val1:-1,val2:15&n});break;case 87:s.push({cmd:xc.FM_DR,chan:e,val1:0,val2:15&n});break;case 88:s.push({cmd:xc.FM_DR,chan:e,val1:1,val2:15&n});break;case 91:{const t=n>>4;t<=2&&s.push({cmd:xc.FM_KSR,chan:e,val1:t-1,val2:1&n});break}}return s}routeGBEffect(e,t,n){const s=[];switch(t){case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:case 18:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 19:s.push({cmd:xc.GB_SWEEP_TIME,chan:e,val1:n,val2:0});break;case 20:s.push({cmd:xc.GB_SWEEP_DIR,chan:e,val1:n,val2:0})}return s}routeNESEffect(e,t,n){const s=[];switch(t){case 17:s.push({cmd:xc.NES_DMC,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 19:s.push({cmd:xc.NES_SWEEP,chan:e,val1:0,val2:n});break;case 20:s.push({cmd:xc.NES_SWEEP,chan:e,val1:1,val2:n});break;case 21:s.push({cmd:xc.NES_ENV_MODE,chan:e,val1:n,val2:0});break;case 22:s.push({cmd:xc.NES_LENGTH,chan:e,val1:n,val2:0});break;case 23:s.push({cmd:xc.NES_COUNT_MODE,chan:e,val1:n,val2:0});break;case 24:s.push({cmd:xc.SAMPLE_MODE,chan:e,val1:n,val2:0});break;case 25:s.push({cmd:xc.NES_LINEAR_LENGTH,chan:e,val1:n,val2:0});break;case 32:s.push({cmd:xc.SAMPLE_FREQ,chan:e,val1:n,val2:0})}return s}routeFDSEffect(e,t,n){const s=[];switch(t){case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.FDS_MOD_DEPTH,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.FDS_MOD_HIGH,chan:e,val1:n,val2:0});break;case 19:s.push({cmd:xc.FDS_MOD_LOW,chan:e,val1:n,val2:0});break;case 20:s.push({cmd:xc.FDS_MOD_POS,chan:e,val1:n,val2:0});break;case 21:s.push({cmd:xc.FDS_MOD_WAVE,chan:e,val1:n,val2:0});break;case 22:s.push({cmd:xc.FDS_MOD_AUTO,chan:e,val1:n,val2:0})}return s}routeVRC6Effect(e,t,n){const s=[];return 18===t&&s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0}),s}routeMMC5Effect(e,t,n){const s=[];return 18===t&&s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0}),s}routePCEEffect(e,t,n){const s=[];switch(t){case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.PCE_LFO_MODE,chan:e,val1:n,val2:0});break;case 19:s.push({cmd:xc.PCE_LFO_SPEED,chan:e,val1:n,val2:0})}return s}routeSNESEffect(e,t,n){const s=[];switch(t){case 24:s.push({cmd:xc.SNES_ECHO_ENABLE,chan:e,val1:n,val2:0});break;case 25:s.push({cmd:xc.SNES_ECHO_DELAY,chan:e,val1:n,val2:0});break;case 26:s.push({cmd:xc.SNES_ECHO_VOL_LEFT,chan:e,val1:n,val2:0});break;case 27:s.push({cmd:xc.SNES_ECHO_VOL_RIGHT,chan:e,val1:n,val2:0});break;case 28:s.push({cmd:xc.SNES_ECHO_FEEDBACK,chan:e,val1:n,val2:0});break;case 30:s.push({cmd:xc.SNES_GLOBAL_VOL_LEFT,chan:e,val1:n,val2:0});break;case 31:s.push({cmd:xc.SNES_GLOBAL_VOL_RIGHT,chan:e,val1:n,val2:0});break;case 48:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:0,val2:n});break;case 49:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:1,val2:n});break;case 50:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:2,val2:n});break;case 51:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:3,val2:n});break;case 52:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:4,val2:n});break;case 53:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:5,val2:n});break;case 54:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:6,val2:n});break;case 55:s.push({cmd:xc.SNES_ECHO_FIR,chan:e,val1:7,val2:n});break;case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.SNES_ECHO,chan:e,val1:n,val2:0});break;case 19:s.push({cmd:xc.SNES_PITCH_MOD,chan:e,val1:n,val2:0});break;case 20:s.push({cmd:xc.SNES_INVERT,chan:e,val1:n,val2:0});break;case 21:s.push({cmd:xc.SNES_GAIN_MODE,chan:e,val1:n,val2:0});break;case 22:s.push({cmd:xc.SNES_GAIN,chan:e,val1:n,val2:0});break;case 29:s.push({cmd:xc.STD_NOISE_FREQ,chan:e,val1:n,val2:0});break;case 32:s.push({cmd:xc.FM_AR,chan:e,val1:n,val2:0});break;case 33:s.push({cmd:xc.FM_DR,chan:e,val1:n,val2:0});break;case 34:s.push({cmd:xc.FM_SL,chan:e,val1:n,val2:0});break;case 35:s.push({cmd:xc.FM_RR,chan:e,val1:n,val2:0})}return s}routeC64Effect(e,t,n){const s=[];switch(t){case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.C64_CUTOFF,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 19:s.push({cmd:xc.C64_RESONANCE,chan:e,val1:n,val2:0});break;case 20:s.push({cmd:xc.C64_FILTER_MODE,chan:e,val1:n,val2:0});break;case 21:s.push({cmd:xc.C64_RESET_TIME,chan:e,val1:n,val2:0});break;case 26:s.push({cmd:xc.C64_RESET_MASK,chan:e,val1:n,val2:0});break;case 27:s.push({cmd:xc.C64_FILTER_RESET,chan:e,val1:n,val2:0});break;case 28:s.push({cmd:xc.C64_DUTY_RESET,chan:e,val1:n,val2:0});break;case 30:s.push({cmd:xc.C64_EXTENDED,chan:e,val1:n,val2:0});break;case 32:s.push({cmd:xc.C64_AD,chan:e,val1:n,val2:0});break;case 33:s.push({cmd:xc.C64_SR,chan:e,val1:n,val2:0});break;case 34:s.push({cmd:xc.C64_PW_SLIDE,chan:e,val1:n,val2:1});break;case 35:s.push({cmd:xc.C64_PW_SLIDE,chan:e,val1:n,val2:-1});break;case 36:s.push({cmd:xc.C64_CUTOFF_SLIDE,chan:e,val1:n,val2:1});break;case 37:s.push({cmd:xc.C64_CUTOFF_SLIDE,chan:e,val1:n,val2:-1});break;default:if(t>=48&&t<=63){const a=(15&t)<<8|n;s.push({cmd:xc.C64_FINE_DUTY,chan:e,val1:a,val2:0})}else if(t>=64&&t<=71){const a=(7&t)<<8|n;s.push({cmd:xc.C64_FINE_CUTOFF,chan:e,val1:a,val2:0})}}return s}routePSGEffect(e,t,n){return this.routeAYEffect(e,t,n)}routeSMSEffect(e,t,n){const s=[];return 32===t&&s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0}),s}routeNamcoEffect(e,t,n){const s=[];switch(t){case 24:s.push({cmd:xc.N163_CHANNEL_LIMIT,chan:e,val1:n,val2:0});break;case 32:s.push({cmd:xc.N163_GLOBAL_WAVE_LOAD,chan:e,val1:n,val2:0});break;case 33:s.push({cmd:xc.N163_GLOBAL_WAVE_LOADPOS,chan:e,val1:n,val2:0});break;case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.N163_WAVE_POSITION,chan:e,val1:n,val2:1});break;case 18:s.push({cmd:xc.N163_WAVE_LENGTH,chan:e,val1:n,val2:1});break;case 21:s.push({cmd:xc.N163_WAVE_POSITION,chan:e,val1:n,val2:2});break;case 22:s.push({cmd:xc.N163_WAVE_LENGTH,chan:e,val1:n,val2:2});break;case 26:s.push({cmd:xc.N163_WAVE_POSITION,chan:e,val1:n,val2:3});break;case 27:s.push({cmd:xc.N163_WAVE_LENGTH,chan:e,val1:n,val2:3})}return s}routeAmigaEffect(e,t,n){const s=[];switch(t){case 16:s.push({cmd:xc.AMIGA_FILTER,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.AMIGA_AM,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.AMIGA_PM,chan:e,val1:n,val2:0});break;case 19:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0})}return s}routeSegaPCMEffect(e,t,n){const s=[];return 32===t&&s.push({cmd:xc.SAMPLE_FREQ,chan:e,val1:n,val2:0}),s}routeSampleEffect(e,t,n){const s=[];switch(t){case 16:s.push({cmd:xc.SAMPLE_MODE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.SAMPLE_BANK,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.SAMPLE_DIR,chan:e,val1:n,val2:0});break;case 32:s.push({cmd:xc.SAMPLE_FREQ,chan:e,val1:n,val2:0});break;case 20:s.push({cmd:xc.ES5506_FILTER_MODE,chan:e,val1:n,val2:0});break;case 21:s.push({cmd:xc.ES5506_FILTER_K1,chan:e,val1:n<<8,val2:65280});break;case 22:s.push({cmd:xc.ES5506_FILTER_K2,chan:e,val1:n<<8,val2:65280});break;case 23:s.push({cmd:xc.QSOUND_ECHO_FEEDBACK,chan:e,val1:n,val2:0});break;case 24:s.push({cmd:xc.QSOUND_ECHO_LEVEL,chan:e,val1:n,val2:0});break;case 25:s.push({cmd:xc.QSOUND_SURROUND,chan:e,val1:n,val2:0})}return s}routeSCCEffect(e,t,n){const s=[];return 16===t&&s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0}),s}routeX1010Effect(e,t,n){const s=[];switch(t){case 16:s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0});break;case 17:s.push({cmd:xc.SAMPLE_MODE,chan:e,val1:n,val2:0});break;case 18:s.push({cmd:xc.SAMPLE_BANK,chan:e,val1:n,val2:0})}return s}routeWavetableEffect(e,t,n){const s=[];return 16===t&&s.push({cmd:xc.WAVE,chan:e,val1:n,val2:0}),s}routePOKEYEffect(e,t,n){const s=[];switch(t){case 32:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 33:s.push({cmd:xc.STD_NOISE_FREQ,chan:e,val1:n,val2:0})}return s}routeTIAEffect(e,t,n){const s=[];switch(t){case 32:s.push({cmd:xc.STD_NOISE_MODE,chan:e,val1:n,val2:0});break;case 33:s.push({cmd:xc.VOLUME,chan:e,val1:n,val2:0})}return s}clearMemory(){this.effectMemory.clear()}clearChannelMemory(e){this.effectMemory.delete(e)}}let gc=null;function bc(){return gc||(gc=new fc),gc}new Proxy({},{get:(e,t)=>bc()[t],set:(e,t,n)=>(bc()[t]=n,!0)});const vc={GENESIS:2,GENESIS_EXT:3,ARCADE:13,NES_VRC7:9,NES_FDS:10,SMS:4,GB:6,PCE:7,NES:8,SNES:26,SWAN:43,LYNX:60,VBOY:47,NDS:103,POKEMINI:45,TIA:21,POKEY:41,C64_6581:11,C64_8580:12,PET:25,VIC20:24,TED:97,FDS:29,MMC5:30,N163:31,VRC6:27,VRC7:48,AY:17,AY8910:17,AY8930:23,SAA1099:22,T6W28:83,YM2612:20,YM2612_EXT:52,YM2612_DUALPCM:80,YM2612_DUALPCM_EXT:81,YM2612_CSM:89,YM2151:19,TX81Z:44,YM2203:32,YM2203_EXT:33,YM2203_CSM:92,YM2608:34,YM2608_EXT:35,YM2608_CSM:93,YM2610:57,YM2610_EXT:58,YM2610_CRAP:15,YM2610_CRAP_EXT:16,YM2610_CSM:90,YM2610B:49,YM2610B_EXT:63,YM2610B_CSM:91,OPL:36,OPL2:37,OPL3:38,OPL_DRUMS:54,OPL2_DRUMS:55,OPL3_DRUMS:56,OPL4:67,OPL4_DRUMS:68,OPLL:28,OPLL_DRUMS:59,Y8950:70,Y8950_DRUMS:71,ESFM:100,AMIGA:18,SEGAPCM:46,SEGAPCM_COMPAT:64,MULTIPCM:39,QSOUND:61,RF5C68:42,PCM_DAC:86,ES5506:69,K007232:84,K053260:96,GA20:85,C140:98,C219:99,YMZ280B:76,MSM6258:75,MSM6295:74,SCC:53,SCC_PLUS:72,NAMCO:77,NAMCO_15XX:78,NAMCO_CUS30:79,BUBSYS_WSG:66,X1_010:65,VERA:62,SOUND_UNIT:73,PCSPKR:40,PONG:87,PV1000:95,MSM5232:82,SM8521:94,DAVE:102,POWERNOISE:101,SFX_BEEPER:50,SFX_BEEPER_QUADTONE:51,GBA_DMA:104,GBA_MINMOD:105,SID2:108,SID3:111,SUPERVISION:109,UPD1771C:110},yc={DEPTH_VOX:10},xc={NOTE_ON:0,NOTE_OFF:1,INSTRUMENT:4,VOLUME:5,NOTE_PORTA:8,PITCH:9,PANNING:10,LEGATO:11,PRE_NOTE:13,HINT_VIBRATO:14,HINT_VIBRATO_SHAPE:16,HINT_ARPEGGIO:18,HINT_VOLUME:19,HINT_VOL_SLIDE:20,HINT_PORTA:21,HINT_TREMOLO:24,HINT_PANNING:27,SAMPLE_MODE:28,SAMPLE_FREQ:29,SAMPLE_BANK:30,SAMPLE_DIR:32,FM_HARD_RESET:33,FM_LFO:34,FM_LFO_WAVE:35,FM_TL:36,FM_AM:37,FM_AR:38,FM_DR:39,FM_SL:40,FM_D2R:41,FM_RR:42,FM_DT:43,FM_DT2:44,FM_RS:45,FM_KSR:46,FM_VIB:47,FM_SUS:48,FM_WS:49,FM_SSG:50,FM_FB:53,FM_MULT:54,FM_AM_DEPTH:58,FM_PM_DEPTH:59,STD_NOISE_FREQ:62,STD_NOISE_MODE:63,WAVE:64,GB_SWEEP_TIME:65,GB_SWEEP_DIR:66,PCE_LFO_MODE:67,PCE_LFO_SPEED:68,NES_SWEEP:69,NES_DMC:70,C64_CUTOFF:71,C64_RESONANCE:72,C64_FILTER_MODE:73,C64_RESET_TIME:74,C64_RESET_MASK:75,C64_FILTER_RESET:76,C64_DUTY_RESET:77,C64_EXTENDED:78,C64_FINE_DUTY:79,C64_FINE_CUTOFF:80,AY_ENVELOPE_SET:81,AY_ENVELOPE_LOW:82,AY_ENVELOPE_HIGH:83,AY_ENVELOPE_SLIDE:84,AY_AUTO_ENVELOPE:87,AY_IO_WRITE:88,AY_AUTO_PWM:89,FDS_MOD_DEPTH:90,FDS_MOD_HIGH:91,FDS_MOD_LOW:92,FDS_MOD_POS:93,FDS_MOD_WAVE:94,AMIGA_FILTER:96,AMIGA_AM:97,AMIGA_PM:98,QSOUND_ECHO_FEEDBACK:100,QSOUND_ECHO_LEVEL:102,QSOUND_SURROUND:103,N163_WAVE_POSITION:113,N163_WAVE_LENGTH:114,N163_CHANNEL_LIMIT:120,N163_GLOBAL_WAVE_LOAD:121,N163_GLOBAL_WAVE_LOADPOS:122,ADPCMA_GLOBAL_VOLUME:131,SNES_ECHO:132,SNES_PITCH_MOD:133,SNES_INVERT:134,SNES_GAIN_MODE:135,SNES_GAIN:136,SNES_ECHO_ENABLE:137,SNES_ECHO_DELAY:138,SNES_ECHO_VOL_LEFT:139,SNES_ECHO_VOL_RIGHT:140,SNES_ECHO_FEEDBACK:141,SNES_ECHO_FIR:142,NES_ENV_MODE:143,NES_LENGTH:144,NES_COUNT_MODE:145,MACRO_ON:147,ES5506_FILTER_MODE:151,ES5506_FILTER_K1:152,ES5506_FILTER_K2:153,SNES_GLOBAL_VOL_LEFT:163,SNES_GLOBAL_VOL_RIGHT:164,NES_LINEAR_LENGTH:165,C64_AD:167,C64_SR:168,FDS_MOD_AUTO:184,FM_OPMASK:185,C64_PW_SLIDE:214,C64_CUTOFF_SLIDE:215,FM_ALG:222,FM_FMS:223,FM_AMS:224},Nc={LINEAR_PITCH:1};class wc{static instance=null;workletNode=null;_nativeCtx=null;initialized=!1;initializing=!1;_initPromise=null;chips=new Map;_audioRouted=!1;_sharedGain=null;_wasmReadyResolve=null;_wasmReadyReject=null;_wasmReadyPromise=null;_chipCreatedPromises=new Map;oscCallbacks=new Set;latestOscData=[];static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;effectRouter=new fc;_moduleWavetables=null;_moduleSamples=null;constructor(){}static getInstance(){return wc.instance||(wc.instance=new wc),wc.instance}get isInitialized(){return this.initialized}getChannelCount(e){return void 0!==e?this.chips.get(e)?.numChannels??0:this.chips.values().next().value?.numChannels??0}get channelCount(){return this.getChannelCount()}get platform(){return this.chips.keys().next().value??0}get handle(){return this.chips.values().next().value?.handle??0}hasChip(e){return this.chips.has(e)}get audioRouted(){return this._audioRouted}getOrCreateSharedGain(){if(this._sharedGain)return this._sharedGain;const e=this.getWorkletNode(),t=this.getNativeCtx();if(!e||!t)return null;this._sharedGain=t.createGain(),e.connect(this._sharedGain);try{const n=t.createGain();n.gain.value=0,e.connect(n),n.connect(t.destination)}catch{}return this._audioRouted=!0,this._sharedGain}routeOutputTo(e){const t=this.getOrCreateSharedGain();if(t)try{t.connect(e)}catch(n){}}async init(e){if(!this.initialized)return this.initializing&&this._initPromise||(this.initializing=!0,this._initPromise=this._doInit(e)),this._initPromise}async _doInit(e){try{const s=ro(e);if(!s)throw new Error("Could not get native AudioContext");if(this._nativeCtx=s,"running"!==s.state)try{await s.resume()}catch(t){throw new Error(`AudioContext not running (state: ${s.state})`)}if("running"!==s.state)throw new Error(`AudioContext still not running after resume (state: ${s.state})`);await wc.ensureModuleLoaded(s);try{this.workletNode=new AudioWorkletNode(s,"furnace-dispatch-processor",{outputChannelCount:[2],processorOptions:{sampleRate:s.sampleRate}})}catch(n){throw n}this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data)},this._wasmReadyPromise=new Promise((e,t)=>{this._wasmReadyResolve=e,this._wasmReadyReject=t,setTimeout(()=>t(new Error("FurnaceDispatch WASM ready timeout after 10s")),1e4)}),this.workletNode.port.postMessage({type:"init",sampleRate:s.sampleRate,wasmBinary:wc.wasmBinary,jsCode:wc.jsCode}),await this._wasmReadyPromise;try{const e=s.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(s.destination)}catch(t){}this.initialized=!0}catch(s){throw s}finally{this.initializing=!1}}static async ensureModuleLoaded(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{const t=`?v=${Date.now()}`;if("running"!==e.state)try{await e.resume()}catch(s){}let n=!1;try{await e.audioWorklet.addModule(`/furnace-dispatch/FurnaceDispatch.worklet.js${t}`),n=!0}catch(s){const e=s instanceof Error?s.message:String(s),t=s instanceof Error?s.name:"";if(e.includes("already")||e.includes("duplicate"))n=!0;else if("InvalidStateError"!==t)throw new Error(`Failed to load FurnaceDispatch worklet: ${e}`)}if(!this.wasmBinary||!this.jsCode){const[e,n]=await Promise.all([fetch(`/furnace-dispatch/FurnaceDispatch.wasm${t}`,{cache:"no-store"}),fetch(`/furnace-dispatch/FurnaceDispatch.js${t}`,{cache:"no-store"})]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar createFurnaceDispatch = createFurnaceDispatch || Module;",this.jsCode=e}}n?this.loadedContexts.add(e):this.initPromises.delete(e)})();return this.initPromises.set(e,n),n}handleWorkletMessage(e){switch(e.type){case"ready":this._wasmReadyResolve&&(this._wasmReadyResolve(),this._wasmReadyResolve=null);break;case"chipCreated":{this.chips.set(e.platformType,{handle:e.handle,numChannels:e.numChannels});let t=0;for(const e of this.chips.values())t+=e.numChannels;this.latestOscData=new Array(t).fill(null);const n=this._chipCreatedPromises.get(e.platformType);n&&(n.resolve(),this._chipCreatedPromises.delete(e.platformType));break}case"oscData":this.latestOscData=e.channels;for(const t of this.oscCallbacks)t(e.channels);break;case"error":this._wasmReadyReject&&(this._wasmReadyReject(new Error(e.message)),this._wasmReadyReject=null,this._wasmReadyResolve=null)}}async createChip(e,t){if(this.chips.has(e))return;if(this._chipCreatedPromises.get(e))return;if(this._nativeCtx&&await wc.ensureModuleLoaded(this._nativeCtx),!this.workletNode)return;let n;const s=new Promise(e=>{n=e});this._chipCreatedPromises.set(e,{promise:s,resolve:n}),this.workletNode.port.postMessage({type:"createChip",platformType:e,sampleRate:t})}async waitForChipCreated(e){if(void 0===e||!this.chips.has(e)){if(void 0!==e){const t=this._chipCreatedPromises.get(e);if(t)return void(await t.promise)}for(const e of this._chipCreatedPromises.values())return void(await e.promise)}}dispatch(e,t,n=0,s=0,a,o){if(this.workletNode){if(e===xc.NOTE_ON||e===xc.INSTRUMENT){xc.NOTE_ON}this.workletNode.port.postMessage({type:"dispatch",cmd:e,chan:t,val1:n,val2:s,platformType:a,time:o})}}noteOn(e,t,n,s){this.dispatch(xc.NOTE_ON,e,t,0,n,s)}noteOff(e,t,n){this.dispatch(xc.NOTE_OFF,e,0,0,t,n)}setInstrument(e,t,n,s=!1,a){this.dispatch(xc.INSTRUMENT,e,t,s?1:0,n,a)}setVolume(e,t,n,s){this.dispatch(xc.VOLUME,e,t,0,n,s)}setGBInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setGBInstrument",insIndex:e,insData:t,platformType:n})}setWavetable(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",waveIndex:e,waveData:t,platformType:n})}setFMInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setFMInstrument",insIndex:e,insData:t,platformType:n})}setC64Instrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setC64Instrument",insIndex:e,insData:t,platformType:n})}setNESInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setNESInstrument",insIndex:e,insData:t,platformType:n})}setSNESInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setSNESInstrument",insIndex:e,insData:t,platformType:n})}setN163Instrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setN163Instrument",insIndex:e,insData:t,platformType:n})}setFDSInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setFDSInstrument",insIndex:e,insData:t,platformType:n})}uploadFurnaceInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:n})}setAmigaInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setAmigaInstrument",insIndex:e,insData:t,platformType:n})}setMultiPCMInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setMultiPCMInstrument",insIndex:e,insData:t,platformType:n})}setES5506Instrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setES5506Instrument",insIndex:e,insData:t,platformType:n})}setESFMInstrument(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setESFMInstrument",insIndex:e,insData:t,platformType:n})}setWaveSynth(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setWaveSynth",insIndex:e,insData:t,platformType:n})}setMacro(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setMacro",insIndex:e,macroData:t,platformType:n})}setInstrumentFull(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:n})}setSample(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setSample",sampleIndex:e,sampleData:t,platformType:n})}renderSamples(e){this.workletNode&&this.workletNode.port.postMessage({type:"renderSamples",platformType:e})}setModuleWavetables(e){this._moduleWavetables=e}setModuleSamples(e){this._moduleSamples=e}getModuleWavetables(){return this._moduleWavetables}getModuleSamples(){return this._moduleSamples}uploadModuleWavetablesToPlatform(e){if(this._moduleWavetables&&0!==this._moduleWavetables.length)for(let t=0;t<this._moduleWavetables.length;t++){const n=this._moduleWavetables[t],s=new Uint8Array(8+4*n.data.length),a=new DataView(s.buffer);a.setInt32(0,n.width,!0),a.setInt32(4,n.height,!0);for(let e=0;e<n.data.length;e++)a.setInt32(8+4*e,n.data[e],!0);this.setWavetable(t,s,e)}}uploadModuleSamplesToPlatform(e){if(this._moduleSamples&&0!==this._moduleSamples.length){for(let t=0;t<this._moduleSamples.length;t++){const n=this._moduleSamples[t],s=32;let a,o;16===n.depth?(a=n.data instanceof Int16Array?n.data.length:Math.floor(n.data.length/2),o=2*a):(a=n.data.length,o=n.data.length);const r=new Uint8Array(s+o),i=new DataView(r.buffer);if(i.setUint32(0,a,!0),i.setInt32(4,n.loopStart,!0),i.setInt32(8,n.loopEnd,!0),i.setUint8(12,n.depth),i.setUint8(13,n.loopMode),i.setUint32(16,n.rate,!0),i.setUint8(22,n.loopEnd>n.loopStart?1:0),n.data instanceof Int16Array){const e=new DataView(r.buffer,s);for(let t=0;t<n.data.length;t++)e.setInt16(2*t,n.data[t],!0)}else r.set(new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength),s);this.setSample(t,r,e)}this.renderSamples(e)}}setMacrosEnabled(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setMacrosEnabled",enabled:e,platformType:t})}clearMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"clearMacros",insIndex:e,platformType:t})}releaseMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"releaseMacros",chan:e,platformType:t})}setCompatFlags(e,t){if(!this.workletNode)return;const n=new Uint8Array(57);n[0]=e.limitSlides?1:0,n[1]=e.linearPitch??2,n[2]=e.pitchSlideSpeed??0,n[3]=e.loopModality??0,n[4]=e.delayBehavior??0,n[5]=e.jumpTreatment??0,n[6]=e.properNoiseLayout?1:0,n[7]=e.waveDutyIsVol?1:0,n[8]=e.resetMacroOnPorta?1:0,n[9]=e.legacyVolumeSlides?1:0,n[10]=e.compatibleArpeggio?1:0,n[11]=e.noteOffResetsSlides?1:0,n[12]=e.targetResetsSlides?1:0,n[13]=e.arpNonPorta?1:0,n[14]=e.algMacroBehavior?1:0,n[15]=e.brokenShortcutSlides?1:0,n[16]=e.ignoreDuplicateSlides?1:0,n[17]=e.stopPortaOnNoteOff?1:0,n[18]=e.continuousVibrato?1:0,n[19]=e.brokenDACMode?1:0,n[20]=e.oneTickCut?1:0,n[21]=e.newInsTriggersInPorta?1:0,n[22]=e.arp0Reset?1:0,n[23]=e.brokenSpeedSel?1:0,n[24]=e.noSlidesOnFirstTick?1:0,n[25]=e.rowResetsArpPos?1:0,n[26]=e.ignoreJumpAtEnd?1:0,n[27]=e.buggyPortaAfterSlide?1:0,n[28]=e.gbInsAffectsEnvelope?1:0,n[29]=e.sharedExtStat?1:0,n[30]=e.ignoreDACModeOutsideChannel?1:0,n[31]=e.e1e2AlsoTakePriority?1:0,n[32]=e.newSegaPCM?1:0,n[33]=e.fbPortaPause?1:0,n[34]=e.snDutyReset?1:0,n[35]=e.pitchMacroIsLinear?1:0,n[36]=e.oldOctaveBoundary?1:0,n[37]=e.noOPN2Vol?1:0,n[38]=e.newVolumeScaling?1:0,n[39]=e.volMacroLinger?1:0,n[40]=e.brokenOutVol?1:0,n[41]=e.brokenOutVol2?1:0,n[42]=e.e1e2StopOnSameNote?1:0,n[43]=e.brokenPortaArp?1:0,n[44]=e.snNoLowPeriods?1:0,n[45]=e.disableSampleMacro?1:0,n[46]=e.oldArpStrategy?1:0,n[47]=e.brokenPortaLegato?1:0,n[48]=e.brokenFMOff?1:0,n[49]=e.preNoteNoEffect?1:0,n[50]=e.oldDPCM?1:0,n[51]=e.resetArpPhaseOnNewNote?1:0,n[52]=e.ceilVolumeScaling?1:0,n[53]=e.oldAlwaysSetVolume?1:0,n[54]=e.oldSampleOffset?1:0,n[55]=e.oldCenterRate?1:0,n[56]=e.noVolSlideReset?1:0,this.workletNode.port.postMessage({type:"setCompatFlags",flags:n,platformType:t})}setCompatFlag(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"setCompatFlag",flagIndex:e,value:t,platformType:n})}resetCompatFlags(e){this.workletNode&&this.workletNode.port.postMessage({type:"resetCompatFlags",platformType:e})}setLinearPitch(e,t){this.setCompatFlag(Nc.LINEAR_PITCH,e,t)}setTickRate(e){this.workletNode&&this.workletNode.port.postMessage({type:"setTickRate",hz:e})}reset(e){this.workletNode&&this.workletNode.port.postMessage({type:"reset",platformType:e})}forceIns(e){this.workletNode&&this.workletNode.port.postMessage({type:"forceIns",platformType:e})}mute(e,t,n){this.workletNode&&this.workletNode.port.postMessage({type:"mute",chan:e,mute:t,platformType:n})}onOscData(e){return this.oscCallbacks.add(e),()=>{this.oscCallbacks.delete(e)}}getOscData(){return this.latestOscData}getWorkletNode(){return this.workletNode}getNativeCtx(){return this._nativeCtx}dispatchFM(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchC64(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchSNES(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchGB(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchNES(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchAY(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchES5506(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchN163(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchSample(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}dispatchMacro(e,t,n){this.dispatch(t.cmd,e,t.val1,t.val2,n)}applyEffect(e,t,n,s){const a=s??this.platform,o=this.effectRouter.routeEffect(a,e,t,n);for(const r of o)this.dispatch(r.cmd,r.chan,r.val1,r.val2,s)}applyExtendedEffect(e,t,n,s){const a=s??this.platform,o=this.effectRouter.routeExtendedEffect(a,e,t,n);for(const r of o)this.dispatch(r.cmd,r.chan,r.val1,r.val2,s)}applyPlatformEffect(e,t,n,s){const a=s??this.platform,o=this.effectRouter.routePlatformEffect(a,e,t,n);for(const r of o)this.dispatch(r.cmd,r.chan,r.val1,r.val2,s)}resetEffectMemory(){this.effectRouter.resetMemory()}getEffectRouter(){return this.effectRouter}dispose(){if(this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.initialized=!1,this.chips.clear(),this._audioRouted=!1,this._sharedGain){try{this._sharedGain.disconnect()}catch{}this._sharedGain=null}this.oscCallbacks.clear(),this.latestOscData=[],wc.instance=null}}const Ec=Object.freeze(Object.defineProperty({__proto__:null,CompatFlag:Nc,DivCmd:xc,FurnaceDispatchEngine:wc,FurnaceDispatchPlatform:vc,SampleDepth:yc},Symbol.toStringTag,{value:"Module"})),kc=i(e=>({channelData:[],numChannels:0,platformType:0,isActive:!1,updateChannelData:t=>e({channelData:t,isActive:!0}),setChipInfo:(t,n)=>e({numChannels:t,platformType:n,channelData:new Array(t).fill(null)}),clear:()=>e({channelData:[],numChannels:0,platformType:0,isActive:!1})})),Dc=new Set([0,1,13,14,19,32,33,55]);class Sc{buffer=[];writeUint8(e){this.buffer.push(255&e)}writeUint16(e){this.buffer.push(255&e),this.buffer.push(e>>8&255)}writeUint32(e){this.buffer.push(255&e),this.buffer.push(e>>8&255),this.buffer.push(e>>16&255),this.buffer.push(e>>24&255)}writeInt32(e){this.writeUint32(e)}writeInt8(e){this.writeUint8(e<0?e+256:e)}getPosition(){return this.buffer.length}patchUint32(e,t){this.buffer[e]=255&t,this.buffer[e+1]=t>>8&255,this.buffer[e+2]=t>>16&255,this.buffer[e+3]=t>>24&255}toUint8Array(){return new Uint8Array(this.buffer)}}function Mc(e){return void 0===e?0:"number"==typeof e?255&e:e?1:0}const Cc={0:1,1:33,2:14,11:13,13:1,14:1,22:19,23:14,26:14,47:1,48:1,49:55};function Vc(e,t="Instrument"){const n=new Sc;n.writeUint8(240),n.writeUint8(177),n.writeUint8(1);const s=function(e){if(e.c64)return 3;if(e.gb)return 2;if(e.n163)return 17;if(e.fds)return 15;if(e.snes)return 29;if(e.esfm)return 55;const t=Cc[e.chipType];return void 0!==t?t:e.chipType}(e);n.writeUint8(s);const a=n.getPosition();n.writeUint32(0),n.writeUint32(0),n.writeUint32(0),n.writeUint32(0),n.writeUint32(0),n.writeUint32(0);const o=(new TextEncoder).encode(t);n.writeUint32(o.length);for(const d of o)n.writeUint8(d);let r=0;if(Dc.has(s)&&e.operators&&e.operators.length>0){r=n.getPosition(),n.writeUint8(e.algorithm||0),n.writeUint8(e.feedback||0),n.writeUint8(e.fms||0),n.writeUint8(e.ams||0),n.writeUint8(e.fms2||0),n.writeUint8(e.ams2||0),n.writeUint8(e.ops||4),n.writeUint8(e.opllPreset||0);for(let t=0;t<4;t++)if(t<e.operators.length){const s=e.operators[t];n.writeUint8(s.enabled?1:0),n.writeUint8(Mc(s.am)),n.writeUint8(s.ar||0),n.writeUint8(s.dr||0),n.writeUint8(s.mult||0),n.writeUint8(s.rr||0),n.writeUint8(s.sl||0),n.writeUint8(s.tl||0),n.writeUint8(s.dt2||0),n.writeUint8(s.rs||0),n.writeInt8(s.dt||0),n.writeUint8(s.d2r||0),n.writeUint8(s.ssg||0),n.writeUint8(Mc(s.dam)),n.writeUint8(Mc(s.dvb)),n.writeUint8(Mc(s.egt)),n.writeUint8(s.ksl||0),n.writeUint8(Mc(s.sus)),n.writeUint8(Mc(s.vib)),n.writeUint8(s.ws||0),n.writeUint8(Mc(s.ksr)),n.writeUint8(s.kvs||0),n.writeUint8(0),n.writeUint8(0)}else for(let e=0;e<24;e++)n.writeUint8(0)}let i=0;e.macros?.find(e=>3===(e.code??e.type));if(e.macros&&e.macros.length>0){i=n.getPosition();const t=new Array(22).fill(null);for(const n of e.macros){const e=n.code??n.type;void 0!==e&&e>=0&&e<22&&(t[e]=n)}for(let e=0;e<22;e++){const s=t[e];if(s&&s.data&&s.data.length>0){n.writeUint8(s.data.length),n.writeUint8(s.delay??0),n.writeUint8(s.speed??1),n.writeUint8(void 0!==s.loop?s.loop:255),n.writeUint8(void 0!==s.release?s.release:255),n.writeUint8(s.mode??0),n.writeUint8(s.open?1:0);for(const e of s.data)n.writeInt32(e)}else for(let e=0;e<7;e++)n.writeUint8(0)}if(e.opMacroArrays&&e.opMacroArrays.length>0){n.writeUint8(160);for(let t=0;t<4;t++){const s=t<e.opMacroArrays.length?e.opMacroArrays[t]:[],a=new Array(20).fill(null);for(const e of s){const t=e.code??e.type;void 0!==t&&t>=0&&t<20&&(a[t]=e)}for(let e=0;e<20;e++){const t=a[e];if(t&&t.data&&t.data.length>0){n.writeUint8(t.data.length),n.writeUint8(t.delay??0),n.writeUint8(t.speed??1),n.writeUint8(void 0!==t.loop?t.loop:255),n.writeUint8(void 0!==t.release?t.release:255),n.writeUint8(t.mode??0),n.writeUint8(t.open?1:0);for(const e of t.data)n.writeInt32(e)}else for(let e=0;e<7;e++)n.writeUint8(0)}}}}let l=0;if(2===s&&e.gb){l=n.getPosition();const t=e.gb;n.writeUint8(t.envVol||0),n.writeUint8(t.envDir||0),n.writeUint8(t.envLen||0),n.writeUint8(t.soundLen||0),n.writeUint8(t.softEnv?1:0),n.writeUint8(t.alwaysInit?1:0),n.writeUint8(0);const s=t.hwSeq?.length??0;if(n.writeUint8(s),t.hwSeq)for(const e of t.hwSeq)n.writeUint8(e.cmd),n.writeUint16(e.data)}if(3===s&&e.c64){l=n.getPosition();const t=e.c64;let s=!1;if(!(t.triOn||t.sawOn||t.pulseOn||t.noiseOn)){t.duty;s=!0}let a=0;t.triOn&&(a|=1),t.sawOn&&(a|=2),(t.pulseOn||s)&&(a|=4),t.noiseOn&&(a|=8),n.writeUint8(a);const o=t.a||0,r=t.d||0;let i=t.s||0;const c=t.r||0;0===i&&0===o&&0===r&&0===c&&(i=8),n.writeUint8(o),n.writeUint8(r),n.writeUint8(i),n.writeUint8(c),n.writeUint16(t.duty||0),n.writeUint8(t.ringMod?1:0),n.writeUint8(t.oscSync?1:0);let u=0;t.toFilter&&(u|=1),t.initFilter&&(u|=2);"dutyIsAbs"in t&&t.dutyIsAbs&&(u|=4);(t.filterIsAbs??!1)&&(u|=8);(t.noTest??!1)&&(u|=16);(t.resetDuty??!1)&&(u|=32),n.writeUint8(u),n.writeUint8(t.filterResonance??t.filterRes??0),n.writeUint16(t.filterCutoff??0);const d=t;let m=0;(t.filterHP||d.hp)&&(m|=1),(t.filterLP||d.lp)&&(m|=2),(t.filterBP||d.bp)&&(m|=4),(t.filterCh3Off||d.ch3off)&&(m|=8),n.writeUint8(m);n.getPosition()}if(17===s&&e.n163){l=n.getPosition();const t=e.n163;n.writeUint32(t.wave||0),n.writeUint32(t.wavePos||0),n.writeUint32(t.waveLen||0),n.writeUint8(t.waveMode||0),n.writeUint8(t.perChPos?1:0)}if(15===s&&e.fds){l=n.getPosition();const t=e.fds;n.writeUint32(t.modSpeed||0),n.writeUint32(t.modDepth||0),n.writeUint8(t.initModTableWithFirstWave?1:0);const s=t.modTable||[];for(let e=0;e<32;e++)n.writeInt8(e<s.length?s[e]:0)}if(29===s&&e.snes){l=n.getPosition();const t=e.snes;n.writeUint8(t.useEnv?1:0),n.writeUint8(t.sus??0),n.writeUint8("number"==typeof t.gainMode?t.gainMode:0),n.writeUint8(t.gain||0),n.writeUint8(t.a||0),n.writeUint8(t.d||0),n.writeUint8(t.s||0),n.writeUint8(t.r||0),n.writeUint8(t.d2??0)}let c=0;if(e.amiga){c=n.getPosition();const t=e.amiga;n.writeUint16(t.initSample??-1);let s=0;if(t.useNoteMap&&(s|=1),t.useSample&&(s|=2),t.useWave&&(s|=4),n.writeUint8(s),n.writeUint8(t.waveLen||0),t.useNoteMap&&t.noteMap)for(let e=0;e<120;e++)if(e<t.noteMap.length){const s=t.noteMap[e];n.writeUint32(s.frequency||0),n.writeUint16(s.sample??-1),n.writeInt8(0),n.writeInt8(0)}else for(let t=0;t<8;t++)n.writeUint8(0)}const u=n.getPosition();return n.patchUint32(a,u),n.patchUint32(a+4,r),n.patchUint32(a+8,i),n.patchUint32(a+12,l),n.patchUint32(a+16,c),n.toUint8Array()}const Pc=Object.freeze(Object.defineProperty({__proto__:null,encodeFurnaceInstrument:Vc,updateFurnaceInstrument:function(e,t,n){return Vc(e,t)}},Symbol.toStringTag,{value:"Module"})),_c={[vc.GB]:["PU1","PU2","WAV","NOI"],[vc.NES]:["PU1","PU2","TRI","NOI","DPCM"],[vc.SMS]:["SQ1","SQ2","SQ3","NOI"],[vc.AY]:["A","B","C"],[vc.AY8930]:["A","B","C"],[vc.PCE]:["CH1","CH2","CH3","CH4","CH5","CH6"],[vc.SNES]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[vc.VRC6]:["PU1","PU2","SAW"],[vc.FDS]:["FDS"],[vc.MMC5]:["PU1","PU2","PCM"],[vc.N163]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[vc.C64_6581]:["V1","V2","V3"],[vc.C64_8580]:["V1","V2","V3"],[vc.VIC20]:["BASS","ALT","SOP","NOI"],[vc.SAA1099]:["CH1","CH2","CH3","CH4","CH5","CH6"],[vc.TIA]:["AUD0","AUD1"],[vc.POKEY]:["CH1","CH2","CH3","CH4"],[vc.LYNX]:["CH1","CH2","CH3","CH4"],[vc.SWAN]:["CH1","CH2","CH3","CH4"],[vc.VERA]:["PU1","PU2","PU3","PU4","PU5","PU6","PU7","PU8","PU9","PU10","PU11","PU12","PU13","PU14","PU15","PU16","PCM"],[vc.SCC]:["CH1","CH2","CH3","CH4","CH5"],[vc.VBOY]:["CH1","CH2","CH3","CH4","CH5","CH6"],[vc.AMIGA]:["CH1","CH2","CH3","CH4"],[vc.PET]:["CH"],[vc.PCSPKR]:["SPK"],[vc.SFX_BEEPER]:["CH1","CH2","CH3","CH4","CH5","CH6"],[vc.PONG]:["CH"],[vc.TED]:["SQ1","SQ2"],[vc.POKEMINI]:["CH"],[vc.PV1000]:["CH1","CH2","CH3"],[vc.SOUND_UNIT]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[vc.NAMCO]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[vc.QSOUND]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8","CH9","CH10","CH11","CH12","CH13","CH14","CH15","CH16"],[vc.DAVE]:["CH1","CH2","CH3","NOI"]},Oc={[vc.GB]:15,[vc.SMS]:15,[vc.NES]:15,[vc.C64_6581]:15,[vc.C64_8580]:15,[vc.AY]:15,[vc.AY8930]:15,[vc.SAA1099]:15,[vc.SCC]:15,[vc.SCC_PLUS]:15,[vc.PCE]:31,[vc.VIC20]:15,[vc.TIA]:15,[vc.POKEY]:15,[vc.PV1000]:15,[vc.POKEMINI]:3,[vc.PONG]:1,[vc.PCSPKR]:1,[vc.SFX_BEEPER]:15,[vc.TED]:8,[vc.VRC6]:15,[vc.MMC5]:15,[vc.SWAN]:15,[vc.LYNX]:127};function Tc(e){return Oc[e]??127}class Lc{name="FurnaceDispatchSynth";output;engine;_disposed=!1;_isReady=!1;_isReadyPromise;_resolveReady;_initFailed=!1;_pendingUploadConfig=null;currentChannel=0;platformType;activeNotes=new Map;_releaseTimeouts=new Map;_volumeOffsetDb=0;furnaceInstrumentIndex=0;_nativeGain=null;_instrumentUploadPromise=null;constructor(e=vc.GB){this.output=oo().createGain(),this.platformType=e,this.engine=wc.getInstance(),this._isReadyPromise=new Promise(e=>{this._resolveReady=e}),this.initialize()}get ready(){return this._isReadyPromise}async ensureInitialized(){if(await this._isReadyPromise,this._initFailed&&!this._isReady&&!this._disposed&&(this._initFailed=!1,this._isReadyPromise=new Promise(e=>{this._resolveReady=e}),this.initialize(),await this._isReadyPromise,this._isReady&&this._pendingUploadConfig)){const{config:e,name:t}=this._pendingUploadConfig;this._pendingUploadConfig=null;const n=this.uploadInstrumentFromConfig(e,t).catch(e=>{});this._instrumentUploadPromise=n}this._instrumentUploadPromise&&await this._instrumentUploadPromise}setFurnaceInstrumentIndex(e){this.furnaceInstrumentIndex=e}async uploadInstrumentFromConfig(e,t){if(this._pendingUploadConfig={config:e,name:t},await this._isReadyPromise,!this._isReady)return;const{updateFurnaceInstrument:n}=await os(async()=>{const{updateFurnaceInstrument:e}=await Promise.resolve().then(()=>Pc);return{updateFurnaceInstrument:e}},void 0),s=n(e,t,this.furnaceInstrumentIndex);this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,s,this.platformType),this._pendingUploadConfig=null;const a=this.engine.getChannelCount(this.platformType)||3;for(let o=0;o<a;o++)this.engine.setInstrument(o,this.furnaceInstrumentIndex,this.platformType,!0)}setInstrumentUploadPromise(e){this._instrumentUploadPromise=e}async uploadInstrumentData(e){e&&0!==e.length&&(await this.ensureInitialized(),this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,e,this.platformType))}setVolumeOffset(e){if(this._volumeOffsetDb=e,this._nativeGain){this._nativeGain.gain.value=Math.pow(10,e/20)}}async initialize(){try{const e=oo();if(await this.engine.init(e),this._disposed)return;const t=this.engine.getNativeCtx()?.sampleRate??e.sampleRate;await this.engine.createChip(this.platformType,t),await this.engine.waitForChipCreated(this.platformType);const n=this.engine.getOrCreateSharedGain();n&&(this._nativeGain=n,0!==this._volumeOffsetDb&&(n.gain.value=Math.pow(10,this._volumeOffsetDb/20))),this.setupDefaultInstrument();try{Bw().routeNativeEngineOutput(this)}catch{}this._isReady=!0,this._resolveReady();const s=kc.getState(),a=this.getChannelNames();s.setChipInfo(a.length,this.platformType),this.engine.onOscData(e=>{kc.getState().updateChannelData(e)})}catch(e){this._initFailed=!0,this._resolveReady()}}setupDefaultInstrument(){const e=vc,t=this.platformType,n=this.engine.getChannelCount(t)||4,s=Tc(t),a=null!==this.engine.getModuleWavetables(),o=null!==this.engine.getModuleSamples();a&&this.engine.uploadModuleWavetablesToPlatform(t),o&&this.engine.uploadModuleSamplesToPlatform(t);const r=(e,n,s=0,a=0)=>this.engine.dispatch(e,n,s,a,t),i=(e,n)=>this.engine.setInstrument(e,n,t),l=(e,n)=>this.engine.setVolume(e,n,t);switch(t){case e.GB:this.setupDefaultGBInstrument();break;case e.C64_6581:case e.C64_8580:this.setupDefaultC64Instrument();break;case e.AY:case e.AY8930:for(let e=0;e<n;e++)r(xc.STD_NOISE_MODE,e,0,0);break;case e.SAA1099:for(let e=0;e<n;e++)r(xc.STD_NOISE_MODE,e,1,0);break;case e.PCE:a||this.setupDefaultWavetable(32,31);for(let e=0;e<n;e++)r(xc.WAVE,e,0,0);break;case e.SCC:case e.SCC_PLUS:a||this.setupDefaultWavetable(32,255);for(let e=0;e<n;e++)r(xc.WAVE,e,0,0);break;case e.VBOY:a||this.setupDefaultWavetable(32,63);for(let e=0;e<n;e++)r(xc.WAVE,e,0,0);break;case e.NAMCO:case e.NAMCO_15XX:case e.NAMCO_CUS30:case e.BUBSYS_WSG:a||this.setupDefaultWavetable(32,15);for(let e=0;e<n;e++)r(xc.WAVE,e,0,0);break;case e.SWAN:a||this.setupDefaultWavetable(32,15);for(let e=0;e<n;e++)r(xc.WAVE,e,0,0);break;case e.FDS:a||this.setupDefaultWavetable(64,63),r(xc.WAVE,0,0,0);break;case e.N163:a||this.setupDefaultWavetable(32,15);for(let e=0;e<n;e++)r(xc.WAVE,e,0,0);break;case e.X1_010:case e.SOUND_UNIT:a||this.setupDefaultWavetable(32,255);for(let e=0;e<n;e++)r(xc.WAVE,e,0,0);break;case e.AMIGA:case e.SEGAPCM:case e.SEGAPCM_COMPAT:case e.K007232:case e.K053260:case e.GBA_DMA:case e.GBA_MINMOD:case e.NDS:case e.YMZ280B:case e.QSOUND:case e.MULTIPCM:o||(this.loadTestSample8bit(),this.engine.renderSamples(t));for(let e=0;e<n;e++)i(e,0),l(e,s);break;case e.RF5C68:case e.GA20:o||(this.loadTestSample8bit(),this.engine.renderSamples(t));for(let e=0;e<n;e++)i(e,0),l(e,s);break;case e.MSM6258:case e.MSM6295:o||(this.loadTestSampleVOX(),this.engine.renderSamples(t));for(let e=0;e<n;e++)i(e,0),l(e,s);break;case e.ES5506:case e.C140:case e.C219:case e.PCM_DAC:o||(this.loadTestSample16bit(),this.engine.renderSamples(t));for(let e=0;e<n;e++)i(e,0),l(e,s);break;case e.SNES:o||(this.loadTestSampleBRR(),this.engine.renderSamples(t));for(let e=0;e<n;e++)i(e,0),l(e,s);break;case e.LYNX:this.setupDefaultLynxInstrument()}if(![e.AMIGA,e.SEGAPCM,e.SEGAPCM_COMPAT,e.RF5C68,e.K007232,e.K053260,e.GA20,e.GBA_DMA,e.GBA_MINMOD,e.NDS,e.MSM6295,e.YMZ280B,e.QSOUND,e.MULTIPCM,e.MSM6258,e.ES5506,e.C140,e.C219,e.PCM_DAC,e.SNES].includes(t))for(let c=0;c<n;c++)i(c,0),l(c,s)}setupDefaultGBInstrument(){const e=this.platformType,t=new Uint8Array([15,0,2,0,0,1,0,0]);this.engine.setGBInstrument(0,t,e);for(let n=0;n<4;n++)this.engine.setInstrument(n,0,e),this.engine.setVolume(n,15,e);if(!this.engine.getModuleWavetables()){const t=32,n=15,s=new Uint8Array(8+4*t),a=new DataView(s.buffer);a.setInt32(0,t,!0),a.setInt32(4,n,!0);for(let e=0;e<t;e++){const s=e<t/2?Math.round(e/(t/2)*n):Math.round((t-e)/(t/2)*n);a.setInt32(8+4*e,s,!0)}this.engine.setWavetable(0,s,e)}}setupDefaultC64Instrument(){const e=this.platformType,t=this.engine.getChannelCount(e)||3,n=Vc({chipType:3,algorithm:0,feedback:0,fms:0,ams:0,fms2:0,ams2:0,ops:0,opllPreset:0,operators:[],macros:[{code:0,type:0,data:[15],loop:-1,release:-1,mode:0}],c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:0,s:15,r:1,duty:2048,ringMod:!1,oscSync:!1}},"Default C64");this.engine.uploadFurnaceInstrument(0,n,e);for(let s=0;s<t;s++)this.engine.setInstrument(s,0,e),this.engine.setVolume(s,15,e)}setupDefaultLynxInstrument(){const e=this.platformType,t=this.engine.getChannelCount(e)||4,n=Vc({chipType:nc.LYNX,algorithm:0,feedback:0,fms:0,ams:0,fms2:0,ams2:0,ops:0,opllPreset:0,operators:[],macros:[{code:2,type:0,data:[1],loop:-1,release:-1,mode:0}]},"Default Lynx");this.engine.uploadFurnaceInstrument(0,n,e);for(let s=0;s<t;s++)this.engine.setInstrument(s,0,e),this.engine.setVolume(s,Tc(e),e)}setupDefaultWavetable(e,t){const n=new Uint8Array(8+4*e),s=new DataView(n.buffer);s.setInt32(0,e,!0),s.setInt32(4,t,!0);for(let a=0;a<e;a++){const n=Math.round(a/(e-1)*t);s.setInt32(8+4*a,n,!0)}this.engine.setWavetable(0,n,this.platformType)}buildSampleHeader(e,t,n=8363,s=0,a,o=!0){const r=new DataView(new ArrayBuffer(32));return r.setUint32(0,e,!0),r.setInt32(4,s,!0),r.setInt32(8,a??e,!0),r.setUint8(12,t),r.setUint8(13,0),r.setUint8(14,0),r.setUint8(15,0),r.setUint32(16,n,!0),r.setUint8(22,o?1:0),r}loadTestSample8bit(){const e=new Uint8Array(64),t=this.buildSampleHeader(32,8,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let n=0;n<32;n++)e[32+n]=n<16?127:128;this.engine.setSample(0,e,this.platformType)}loadTestSample16bit(){const e=new Uint8Array(96),t=this.buildSampleHeader(32,16,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));const n=new DataView(e.buffer);for(let s=0;s<32;s++){const e=s<16?32767:-32768;n.setInt16(32+2*s,e,!0)}this.engine.setSample(0,e,this.platformType)}loadTestSampleBRR(){const e=Math.ceil(2),t=new Uint8Array(32+9*e),n=this.buildSampleHeader(32,9,8363);new Uint8Array(t.buffer,0,32).set(new Uint8Array(n.buffer));for(let s=0;s<e;s++){const n=32+9*s,a=s===e-1;t[n]=194|(a?1:0);for(let e=0;e<8;e++){const a=16*s+2*e,o=a<16?7:8,r=a+1<16?7:8;t[n+1+e]=(15&o)<<4|15&r}}this.engine.setSample(0,t,this.platformType)}loadTestSampleVOX(){const e=new Uint8Array(48.5),t=this.buildSampleHeader(32,yc.DEPTH_VOX,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let n=0;n<16.5;n++){const t=2*n,s=t<16?15:0,a=t+1<16?15:0;e[32+n]=s<<4|a}this.engine.setSample(0,e,this.platformType)}getChannelNames(){const e=_c[this.platformType];if(e)return e;const t=this.engine.getChannelCount(this.platformType)||1;return Array.from({length:t},(e,t)=>`CH${t+1}`)}getNumChannels(){return this.engine.getChannelCount(this.platformType)}onOscData(e){return this.engine.onOscData(e)}getOscData(){return this.engine.getOscData()}triggerAttack(e,t,n=1){if(!this._isReady||this._disposed)return;const s="string"==typeof e?po(e):e>127?Math.round(12*Math.log2(e/440)+69):e,a=this.currentChannel,o=this._releaseTimeouts.get(a);o&&(clearTimeout(o),this._releaseTimeouts.delete(a));const r=this.platformType;this.engine.setInstrument(a,this.furnaceInstrumentIndex,r,!0,t);const i=Tc(r),l=Math.round(n*i);this.engine.setVolume(a,l,r,t),this.engine.noteOn(a,s,r,t),this.activeNotes.set(s,a)}triggerAttackRelease(e,t,n,s=1){this.triggerAttack(e,n,s);const a=this.engine.getNativeCtx();if(a){const s=this.currentChannel,o=(n??a.currentTime)+t,r=setTimeout(()=>{this._releaseTimeouts.delete(s),this.triggerRelease(e)},Math.max(0,1e3*(o-a.currentTime))+50);this._releaseTimeouts.set(s,r),this.triggerRelease(e,o)}}triggerRelease(e,t){if(this._isReady&&!this._disposed)if(void 0!==e){const n="string"==typeof e?po(e):e>127?Math.round(12*Math.log2(e/440)+69):e,s=this.activeNotes.get(n);void 0!==s&&(this.engine.noteOff(s,this.platformType,t),this.activeNotes.delete(n))}else{for(const[,e]of this.activeNotes)this.engine.noteOff(e,this.platformType,t);this.activeNotes.clear()}}releaseAll(){for(const[,e]of this._releaseTimeouts)clearTimeout(e);if(this._releaseTimeouts.clear(),this.triggerRelease(),this._isReady&&!this._disposed){const e=this.engine.getChannelCount(this.platformType)||3;for(let t=0;t<e;t++)this.engine.noteOff(t,this.platformType)}}setChannel(e){this.currentChannel=e}sendCommand(e,t,n=0,s=0){this._isReady&&!this._disposed&&this.engine.dispatch(e,t,n,s,this.platformType)}applyEffect(e,t,n){this._isReady&&!this._disposed&&this.engine.applyEffect(n??this.currentChannel,e,t,this.platformType)}applyExtendedEffect(e,t,n){this._isReady&&!this._disposed&&this.engine.applyExtendedEffect(n??this.currentChannel,e,t,this.platformType)}applyPlatformEffect(e,t,n){this._isReady&&!this._disposed&&this.engine.applyPlatformEffect(n??this.currentChannel,e,t,this.platformType)}resetEffectMemory(){this.engine.resetEffectMemory()}setGBInstrument(e,t){this.engine.setGBInstrument(e,t,this.platformType)}setWavetable(e,t){this.engine.setWavetable(e,t,this.platformType)}renderSamples(){this.engine.renderSamples(this.platformType)}setParam(e,t){switch(e){case"volume":this.engine.setVolume(this.currentChannel,t,this.platformType);break;case"channel":this.currentChannel=t}}dispose(){this._disposed=!0,this.activeNotes.clear();for(const e of this._releaseTimeouts.values())clearTimeout(e);this._releaseTimeouts.clear(),this._nativeGain=null,this.output.disconnect()}}class Ac{name="DrumKitSynth";config;sampleBuffers=new Map;activeVoices=[];audioContext;outputGain;output;onSampleNeeded;constructor(e){this.config=e,this.audioContext=oo(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=.8,this.outputGain.connect(this.output)}setSampleLoader(e){this.onSampleNeeded=e}async preloadSamples(){if(!this.onSampleNeeded)return;const e=this.config.keymap.map(async e=>{if(!this.sampleBuffers.has(e.id)){const t=await this.onSampleNeeded(e.sampleId,e.sampleUrl);t&&this.sampleBuffers.set(e.id,t)}});await Promise.all(e)}loadSample(e,t){this.sampleBuffers.set(e,t)}findMapping(e){for(const t of this.config.keymap)if(e>=t.noteStart&&e<=t.noteEnd)return t;return null}noteToMidiNumber(e){return"number"==typeof e?e+11:function(e){if("number"==typeof e)return e+11;if(null==e||""===e||"..."===e||"==="===e)return 60;const t=e.match(/^([A-G])([#b])?-?(\d)$/i);if(!t)return 60;const[,n,s,a]=t,o=parseInt(a,10),r=n.toUpperCase(),i=s?r+s:r+"-",l=ja.indexOf(i);return-1===l?60:12*(o+1)+l}(e)}triggerAttack(e,t,n=.8){const s=this.noteToMidiNumber(e),a=this.findMapping(s);if(!a)return;const o=this.sampleBuffers.get(a.id);if(!o)return;if(this.activeVoices.length>=this.config.maxVoices){const e=this.activeVoices.shift();e&&this.disposeVoice(e)}if("mono"===this.config.polyphony||this.config.noteCut){this.activeVoices.filter(e=>e.mappingId===a.id).forEach(e=>{this.disposeVoice(e);const t=this.activeVoices.indexOf(e);-1!==t&&this.activeVoices.splice(t,1)})}const r=this.calculatePlaybackRate(a,s),i=this.audioContext.createBufferSource();i.buffer=o,i.playbackRate.value=r;const l=(a.panOffset||0)/100,c=this.audioContext.createStereoPanner();c.pan.value=l;const u=Math.pow(10,(a.volumeOffset||0)/20),d=this.audioContext.createGain();d.gain.value=n*u,i.connect(c),c.connect(d),d.connect(this.outputGain);const m=t??fo();i.start(m);const p={source:i,panner:c,gain:d,midiNote:s,mappingId:a.id,startTime:m};this.activeVoices.push(p);const h=o.duration/r;setTimeout(()=>{const e=this.activeVoices.indexOf(p);-1!==e&&(this.activeVoices.splice(e,1),this.disposeVoice(p))},1e3*(h+.1))}calculatePlaybackRate(e,t){let n=1;if(e.pitchOffset&&(n*=Math.pow(2,e.pitchOffset/12)),e.fineTune&&(n*=Math.pow(2,e.fineTune/1200)),e.baseNote){const s=t-this.noteToMidiNumber(e.baseNote);n*=Math.pow(2,s/12)}return Math.max(.1,Math.min(4,n))}triggerRelease(e,t){const n=this.noteToMidiNumber(e);this.activeVoices.filter(e=>e.midiNote===n).forEach(e=>{const n=t??fo();e.gain.gain.setValueAtTime(e.gain.gain.value,n),e.gain.gain.linearRampToValueAtTime(0,n+.05),setTimeout(()=>{const t=this.activeVoices.indexOf(e);-1!==t&&(this.activeVoices.splice(t,1),this.disposeVoice(e))},100)})}disposeVoice(e){try{e.source.stop()}catch{}try{e.source.disconnect(),e.panner.disconnect(),e.gain.disconnect()}catch{}}releaseAll(){this.activeVoices.forEach(e=>this.disposeVoice(e)),this.activeVoices=[]}updateConfig(e){this.config={...this.config,...e}}getKeymap(){return[...this.config.keymap]}addMapping(e){this.config.keymap.push(e)}removeMapping(e){const t=this.config.keymap.findIndex(t=>t.id===e);-1!==t&&(this.config.keymap.splice(t,1),this.sampleBuffers.delete(e))}clearKeymap(){this.config.keymap=[],this.sampleBuffers.clear(),this.releaseAll()}dispose(){this.releaseAll(),this.sampleBuffers.clear(),this.outputGain.disconnect(),this.output.disconnect()}}const Bc={type:"sine",frequency:440},Ic={enabled:!0,type:"square",rate:2,depth:100},Fc={enabled:!0,time:.3,feedback:.4,wet:.3},Uc={enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},Rc={enabled:!0,decay:1.5,wet:.1};class jc{name="DubSirenSynth";output;osc;filter;reverb;delay;distortion;gate;_toneOutput;signal;lfo;constructor(e){const t={oscillator:{...Bc,...e?.oscillator},lfo:{...Ic,...e?.lfo},delay:{...Fc,...e?.delay},filter:{...Uc,...e?.filter},reverb:{...Rc,...e?.reverb}};this.output=oo().createGain(),this._toneOutput=new M(0);const n=co(this._toneOutput);n&&n.connect(this.output),this.reverb=new b({decay:t.reverb.decay,wet:t.reverb.enabled?t.reverb.wet:0}),this.delay=new C({delayTime:t.delay.time,feedback:t.delay.feedback,wet:t.delay.enabled?t.delay.wet:0}),this.filter=new h({frequency:t.filter.frequency,type:t.filter.type,rolloff:t.filter.rolloff,Q:1}),this.distortion=new v(.1),this.gate=new m(0),this.osc=new V({type:t.oscillator.type}),this.signal=new P({units:"frequency",value:t.oscillator.frequency}),this.lfo=new y({type:t.lfo.type,frequency:t.lfo.rate,amplitude:1,min:-t.lfo.depth,max:t.lfo.depth}),this.osc.frequency.value=0,this.signal.connect(this.osc.frequency),t.lfo.enabled&&(this.lfo.connect(this.osc.frequency),this.lfo.start()),this.osc.connect(this.gate),this.gate.connect(this.filter),this.filter.connect(this.distortion),this.distortion.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.osc.start()}applyConfig(e){this.osc.type=e.oscillator.type,this.setFrequency(e.oscillator.frequency),this.lfo.type=e.lfo.type,this.setLFORate(e.lfo.rate),this.setLFODepth(e.lfo.depth),e.lfo.enabled?"started"!==this.lfo.state&&(this.lfo.start(),this.lfo.connect(this.osc.frequency)):(this.lfo.stop(),this.lfo.disconnect()),this.setDelayTime(e.delay.time),this.setDelayFeedback(e.delay.feedback),this.setDelayMix(e.delay.enabled?e.delay.wet:0),this.setFilterFreq(e.filter.frequency),this.filter.type=e.filter.type,this.filter.rolloff=e.filter.rolloff,this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,n){const s=t||fo();if(e){const t=ho(e);this.signal.setValueAtTime(t,s)}this.gate.gain.cancelScheduledValues(s),this.gate.gain.setValueAtTime(1,s)}triggerRelease(e){const t=e||fo();this.gate.gain.cancelScheduledValues(t),this.gate.gain.setValueAtTime(0,t)}releaseAll(){this.triggerRelease()}setOscType(e){this.osc.type=e}setFrequency(e){this.signal.rampTo(e,.1)}setLFOType(e){this.lfo.type=e}setLFORate(e){this.lfo.frequency.rampTo(e,.1)}setLFODepth(e){this.lfo.min=-e,this.lfo.max=e}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.delay.delayTime.rampTo(t,.1)}setDelayFeedback(e){this.delay.feedback.rampTo(e,.1)}setDelayMix(e){this.delay.wet.rampTo(e,.1)}setFilterFreq(e){this.filter.frequency.rampTo(e,.1)}dispose(){try{this.osc.stop()}catch{}try{this.lfo.stop()}catch{}this.osc.dispose(),this.gate.dispose(),this.filter.dispose(),this.distortion.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect(),this.signal.dispose(),this.lfo.dispose()}get volume(){return this._toneOutput.volume}}class Xc{name="SpaceLaserSynth";output;synth;filter;noise;noiseGain;reverb;delay;_toneOutput;config;constructor(e){this.config=e,this.output=oo().createGain(),this._toneOutput=new M(0);const t=co(this._toneOutput);t&&t.connect(this.output),this.reverb=new b({decay:e.reverb.decay,wet:e.reverb.enabled?e.reverb.wet:0}),this.delay=new C({delayTime:e.delay.time,feedback:e.delay.feedback,wet:e.delay.enabled?e.delay.wet:0}),this.filter=new h({frequency:e.filter.cutoff,type:e.filter.type,Q:e.filter.resonance/10}),this.synth=new _({harmonicity:e.fm.ratio,modulationIndex:e.fm.amount,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1},modulationEnvelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1}}),this.noise=new O({type:e.noise.type,volume:-1/0}),this.noiseGain=new m(e.noise.amount/100),this.noise.connect(this.noiseGain),this.synth.connect(this.filter),this.noiseGain.connect(this.filter),this.filter.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.noise.start()}applyConfig(e){this.config=e,this.synth.harmonicity.value=e.fm.ratio,this.synth.modulationIndex.value=e.fm.amount,this.synth.envelope.decay=e.laser.sweepTime/1e3,this.synth.modulationEnvelope.decay=e.laser.sweepTime/1e3,this.noise.type=e.noise.type,this.noiseGain.gain.rampTo(e.noise.amount/100,.1),this.filter.type=e.filter.type,this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.delay.delayTime.rampTo(e.delay.time,.1),this.delay.feedback.rampTo(e.delay.feedback,.1),this.delay.wet.rampTo(e.delay.enabled?e.delay.wet:0,.1),this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,n=1){const s=t||fo(),a=this.config.laser.sweepTime/1e3,o=e?ho(e):this.config.laser.startFreq,r=this.config.laser.endFreq;this.synth.triggerAttack(o,s,n),this.synth.frequency.cancelScheduledValues(s+.001),"exponential"===this.config.laser.sweepCurve?this.synth.frequency.exponentialRampToValueAtTime(r,s+a):this.synth.frequency.linearRampToValueAtTime(r,s+a),this.synth.triggerRelease(s+a)}triggerRelease(e){const t=null==e?fo():e;this.synth.triggerRelease(t)}releaseAll(){this.triggerRelease()}dispose(){this.noise.stop(),this.synth.dispose(),this.filter.dispose(),this.noise.dispose(),this.noiseGain.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}class zc{name="SynareSynth";output;osc1;osc2;noise;osc1Gain;osc2Gain;noiseGain;filter;ampEnv;_toneOutput;filterFreqEnv;pitchEnv;lfo;lfoGain;config;constructor(e){this.config=e,this.osc1=new V({type:"square",frequency:e.oscillator.tune}),this.osc2=new V({type:"square",frequency:e.oscillator.tune}),this.noise=new O({type:e.noise.type}),this.osc1Gain=new m(1),this.osc2Gain=new m(e.oscillator2.enabled?e.oscillator2.mix:0),this.noiseGain=new m(e.noise.enabled?e.noise.mix:0),this.filter=new h({frequency:e.filter.cutoff,type:"lowpass",rolloff:-24,Q:e.filter.resonance/10}),this.ampEnv=new T({attack:.005,decay:e.envelope.decay/1e3,sustain:e.envelope.sustain,release:.1}),this.output=oo().createGain(),this._toneOutput=new M(0);const t=co(this._toneOutput);t&&t.connect(this.output),this.filterFreqEnv=new L({attack:.005,decay:e.filter.decay/1e3,sustain:0,release:.1}),this.pitchEnv=new L({attack:.005,decay:e.sweep.time/1e3,sustain:0,release:.1}),this.lfo=new y({frequency:e.lfo.rate,amplitude:e.lfo.depth/100}),this.lfoGain=new m(0),this.lfo.connect(this.lfoGain),this.lfo.start(),this.osc1.connect(this.osc1Gain),this.osc2.connect(this.osc2Gain),this.noise.connect(this.noiseGain);const n=new m(1);this.osc1Gain.connect(n),this.osc2Gain.connect(n),this.noiseGain.connect(n),n.connect(this.filter),this.filter.connect(this.ampEnv),this.ampEnv.connect(this._toneOutput),this.applyConfig(e),this.osc1.start(),this.osc2.start(),this.noise.start()}applyConfig(e){this.config=e,this.osc1.frequency.rampTo(e.oscillator.tune,.1),this.osc2.frequency.rampTo(e.oscillator.tune*Math.pow(2,e.oscillator2.detune/12),.1),this.osc1Gain.gain.rampTo(1,.1),this.osc2Gain.gain.rampTo(e.oscillator2.enabled?e.oscillator2.mix:0,.1),this.noiseGain.gain.rampTo(e.noise.enabled?e.noise.mix:0,.1),this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.ampEnv.decay=e.envelope.decay/1e3,this.ampEnv.sustain=e.envelope.sustain,this.filterFreqEnv.decay=e.filter.decay/1e3,this.pitchEnv.decay=e.sweep.time/1e3,this.lfo.frequency.rampTo(e.lfo.rate,.1),this.lfoGain.gain.rampTo(e.lfo.enabled?e.lfo.depth/100:0,.1)}triggerAttack(e,t,n){const s=t||fo();if(e){const t=ho(e);this.osc1.frequency.setValueAtTime(t,s),this.osc2.frequency.setValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),s)}if(this.ampEnv.triggerAttack(s,n),this.config.filter.envMod>0){const e=Math.min(2e4,this.config.filter.cutoff+100*this.config.filter.envMod);this.filter.frequency.cancelScheduledValues(s),this.filter.frequency.setValueAtTime(this.config.filter.cutoff,s),this.filter.frequency.exponentialRampToValueAtTime(e,s+.005),this.filter.frequency.exponentialRampToValueAtTime(this.config.filter.cutoff,s+this.config.filter.decay/1e3)}if(this.config.sweep.enabled){const t=e?ho(e):this.config.oscillator.tune,n=t*Math.pow(2,this.config.sweep.amount/12);this.osc1.frequency.cancelScheduledValues(s),this.osc2.frequency.cancelScheduledValues(s),this.osc1.frequency.setValueAtTime(n,s),this.osc1.frequency.exponentialRampToValueAtTime(t,s+this.config.sweep.time/1e3),this.osc2.frequency.setValueAtTime(n*Math.pow(2,this.config.oscillator2.detune/12),s),this.osc2.frequency.exponentialRampToValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),s+this.config.sweep.time/1e3)}}triggerRelease(e){const t=e||fo();this.ampEnv.triggerRelease(t)}releaseAll(){this.triggerRelease()}updateParameter(e,t){this.applyConfig(this.config)}dispose(){try{this.osc1.stop()}catch{}try{this.osc2.stop()}catch{}try{this.noise.stop()}catch{}try{this.lfo.stop()}catch{}this.osc1.dispose(),this.osc2.dispose(),this.noise.dispose(),this.osc1Gain.dispose(),this.osc2Gain.dispose(),this.noiseGain.dispose(),this.filter.dispose(),this.ampEnv.dispose(),this.filterFreqEnv.dispose(),this.pitchEnv.dispose(),this.lfo.dispose(),this.lfoGain.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}const Gc=(e,t)=>0!==(e&t),Hc=e=>{const t=new Uint8Array(e.length);return e.split("").forEach((e,n)=>{t[n]=e.charCodeAt(0)}),t},Wc=e=>{const t=new Uint8Array(4);return t[0]=e,t[1]=e>>8,t[2]=e>>16,t[3]=e>>24,t},qc=e=>{const t=new Uint8Array(2);return t[0]=e,t[1]=e>>8,t};let Kc=null;const $c=e=>{if(null===Kc)try{const e=window._toneEngine;Kc=e&&e.nativeContext?e.nativeContext:new AudioContext}catch{Kc=new AudioContext}if(!Kc)throw new Error("No player available!");return((e,t)=>{let n;const s=new Promise((s,a)=>{const o=e.createBufferSource(),r=e.createBuffer(1,t.length,22050),i=r.getChannelData(0);for(let e=0;e<t.length;e++)i[e]=t[e];o.buffer=r,o.connect(e.destination),o.onended=()=>{s(!0)},n=e=>{o.disconnect(),a(e)},o.start(0)});return s.abort=n,s})(Kc,e)},Yc=e=>{const t=new Uint8Array(44+e.length);let n=0;const s=e=>{t.set(e,n),n+=e.length};return s(Hc("RIFF")),s(Wc(e.length+12+16+8-8)),s(Hc("WAVE")),s(Hc("fmt ")),s(Wc(16)),s(qc(1)),s(qc(1)),s(Wc(22050)),s(Wc(22050)),s(qc(1)),s(qc(8)),s(Hc("data")),s(Wc(e.length)),s(e),t},Jc={" ":0,"!":2,'"':2,"#":2,$:2,"%":2,"&":2,"'":130,"(":0,")":0,"*":2,"+":2,",":2,"-":2,".":2,"/":2,0:3,1:3,2:3,3:3,4:3,5:3,6:3,7:3,8:3,9:3,":":2,";":2,"<":2,"=":2,">":2,"?":2,"@":2,A:192,B:168,C:176,D:172,E:192,F:160,G:184,H:160,I:192,J:188,K:160,L:172,M:168,N:172,O:192,P:160,Q:160,R:172,S:180,T:164,U:192,V:168,W:168,X:176,Y:192,Z:188,"[":0,"\\":0,"]":0,"^":2,_:0,"`":32},Qc='(A)=|(!)=.|(") =-AH5NKWOWT-|(")=KWOW4T-|(#)= NAH4MBER|($)= DAA4LER|(%)= PERSEH4NT|(&)= AEND|(\')=|(*)= AE4STERIHSK|(+)= PLAH4S|(,)=,| (-) =-|(-)=|(.)= POYNT|(/)= SLAE4SH|(0)= ZIY4ROW| (1ST)=FER4ST| (10TH)=TEH4NTH|(1)= WAH4N| (2ND)=SEH4KUND|(2)= TUW4| (3RD)=THER4D|(3)= THRIY4|(4)= FOH4R| (5TH)=FIH4FTH|(5)= FAY4V| (64) =SIH4KSTIY FOHR|(6)= SIH4KS|(7)= SEH4VUN| (8TH)=EY4TH|(8)= EY4T|(9)= NAY4N|(:)=.|(;)=.|(<)= LEH4S DHAEN|(=)= IY4KWULZ|(>)= GREY4TER DHAEN|(?)=?|(@)= AE6T|(^)= KAE4RIXT',Zc=128,eu=(e,t)=>0!==(Jc[e]&t),tu=(e,t,n)=>eu(e[t],n),nu=(e,t)=>-1!==t.indexOf(e),su=e=>{const t=e.split("="),n=t.pop(),s=t.join("=").split("("),a=s.pop().split(")"),o=s[0],r=a[0],i=a[1],l=["T","C","S"],c=["E","I","Y"],u=(e,t)=>!!e.startsWith(r,t)&&(!!((e,t)=>{for(let n=o.length-1;n>-1;n--){const s=o[n];if(eu(s,Zc)){if(e[--t]!==s)return!1}else if(!{" ":()=>!tu(e,--t,Zc),"#":()=>tu(e,--t,64),".":()=>tu(e,--t,8),"&":()=>tu(e,--t,16)||nu(e.substr(--t,2),["CH","SH"]),"@":()=>{if(tu(e,--t,4))return!0;const n=e[t];if("H"!==n)return!1;if(!nu(n,l))return!1;throw new Error("Is always false but happened? "+n)},"^":()=>tu(e,--t,32),"+":()=>nu(e[--t],c),":":()=>{for(;t>=0&&tu(e,t-1,32);)t--;return!0}}[s]())return!1}return!0})(e,t)&&((e,t)=>{for(let n=0;n<i.length;n++){const s=i[n];if(eu(s,Zc)){if(e[++t]!==s)return!1}else if(!{" ":()=>!tu(e,++t,Zc),"#":()=>tu(e,++t,64),".":()=>tu(e,++t,8),"&":()=>tu(e,++t,16)||nu(e.substr(++t-2,2),["HC","HS"]),"@":()=>{if(tu(e,++t,4))return!0;const n=e[t];if("H"!==n)return!1;if(!nu(n,l))return!1;throw new Error("This should not be possible ",n)},"^":()=>tu(e,++t,32),"+":()=>nu(e[++t],c),":":()=>{for(;tu(e,t+1,32);)t++;return!0},"%":()=>"E"!==e[t+1]?"ING"===e.substr(t+1,3)&&(t+=3,!0):tu(e,t+2,Zc)?nu(e[t+2],["R","S","D"])?(t+=2,!0):"L"!==e[t+2]?"FUL"===e.substr(t+2,3)&&(t+=4,!0):"Y"===e[t+3]&&(t+=3,!0):(t++,!0)}[s]())return!1}return!0})(e,t+(r.length-1))),d=(e,t,s)=>{if(u(e,t))return s(n,r.length),!0};return d.c=r[0],d},au={};" (A.)=EH4Y. |(A) =AH| (ARE) =AAR| (AR)O=AXR|(AR)#=EH4R| ^(AS)#=EY4S|(A)WA=AX|(AW)=AO5| :(ANY)=EH4NIY|(A)^+#=EY5|#:(ALLY)=ULIY| (AL)#=UL|(AGAIN)=AXGEH4N|#:(AG)E=IHJ|(A)^%=EY|(A)^+:#=AE| :(A)^+ =EY4| (ARR)=AXR|(ARR)=AE4R| ^(AR) =AA5R|(AR)=AA5R|(AIR)=EH4R|(AI)=EY4|(AY)=EY5|(AU)=AO4|#:(AL) =UL|#:(ALS) =ULZ|(ALK)=AO4K|(AL)^=AOL| :(ABLE)=EY4BUL|(ABLE)=AXBUL|(A)VO=EY4|(ANG)+=EY4NJ|(ATARI)=AHTAA4RIY|(A)TOM=AE|(A)TTI=AE| (AT) =AET| (A)T=AH|(A)=AE| (B) =BIY4| (BE)^#=BIH|(BEING)=BIY4IHNX| (BOTH) =BOW4TH| (BUS)#=BIH4Z|(BREAK)=BREY5K|(BUIL)=BIH4L|(B)=B| (C) =SIY4| (CH)^=K|^E(CH)=K|(CHA)R#=KEH5|(CH)=CH| S(CI)#=SAY4|(CI)A=SH|(CI)O=SH|(CI)EN=SH|(CITY)=SIHTIY|(C)+=S|(CK)=K|(COMMODORE)=KAA4MAHDOHR|(COM)=KAHM|(CUIT)=KIHT|(CREA)=KRIYEY|(C)=K| (D) =DIY4| (DR.) =DAA4KTER|#:(DED) =DIHD|.E(D) =D|#:^E(D) =T| (DE)^#=DIH| (DO) =DUW| (DOES)=DAHZ|(DONE) =DAH5N|(DOING)=DUW4IHNX| (DOW)=DAW|#(DU)A=JUW|#(DU)^#=JAX|(D)=D| (E) =IYIY4|#:(E) =|':^(E) =| :(E) =IY|#(ED) =D|#:(E)D =|(EV)ER=EH4V|(E)^%=IY4|(ERI)#=IY4RIY|(ERI)=EH4RIH|#:(ER)#=ER|(ERROR)=EH4ROHR|(ERASE)=IHREY5S|(ER)#=EHR|(ER)=ER| (EVEN)=IYVEHN|#:(E)W=|@(EW)=UW|(EW)=YUW|(E)O=IY|#:&(ES) =IHZ|#:(E)S =|#:(ELY) =LIY|#:(EMENT)=MEHNT|(EFUL)=FUHL|(EE)=IY4|(EARN)=ER5N| (EAR)^=ER5|(EAD)=EHD|#:(EA) =IYAX|(EA)SU=EH5|(EA)=IY5|(EIGH)=EY4|(EI)=IY4| (EYE)=AY4|(EY)=IY|(EU)=YUW5|(EQUAL)=IY4KWUL|(E)=EH| (F) =EH4F|(FUL)=FUHL|(FRIEND)=FREH5ND|(FATHER)=FAA4DHER|(F)F=|(F)=F| (G) =JIY4|(GIV)=GIH5V| (G)I^=G|(GE)T=GEH5|SU(GGES)=GJEH4S|(GG)=G| B#(G)=G|(G)+=J|(GREAT)=GREY4T|(GON)E=GAO5N|#(GH)=| (GN)=N|(G)=G| (H) =EY4CH| (HAV)=/HAE6V| (HERE)=/HIYR| (HOUR)=AW5ER|(HOW)=/HAW|(H)#=/H|(H)=| (IN)=IHN| (I) =AY4|(I) =AY|(IN)D=AY5N|SEM(I)=IY| ANT(I)=AY|(IER)=IYER|#:R(IED) =IYD|(IED) =AY5D|(IEN)=IYEHN|(IE)T=AY4EH|(I')=AY5| :(I)^%=AY5| :(IE) =AY4|(I)%=IY|(IE)=IY4| (IDEA)=AYDIY5AH|(I)^+:#=IH|(IR)#=AYR|(IZ)%=AYZ|(IS)%=AYZ|I^(I)^#=IH|+^(I)^+=AY|#:^(I)^+=IH|(I)^+=AY|(IR)=ER|(IGH)=AY4|(ILD)=AY5LD| (IGN)=IHGN|(IGN) =AY4N|(IGN)^=AY4N|(IGN)%=AY4N|(ICRO)=AY4KROH|(IQUE)=IY4K|(I)=IH| (J) =JEY4|(J)=J| (K) =KEY4| (K)N=|(K)=K| (L) =EH4L|(LO)C#=LOW|L(L)=|#:^(L)%=UL|(LEAD)=LIYD| (LAUGH)=LAE4F|(L)=L| (M) =EH4M| (MR.) =MIH4STER| (MS.)=MIH5Z| (MRS.) =MIH4SIXZ|(MOV)=MUW4V|(MACHIN)=MAHSHIY5N|M(M)=|(M)=M| (N) =EH4N|E(NG)+=NJ|(NG)R=NXG|(NG)#=NXG|(NGL)%=NXGUL|(NG)=NX|(NK)=NXK| (NOW) =NAW4|N(N)=|(NON)E=NAH4N|(N)=N| (O) =OH4W|(OF) =AHV| (OH) =OW5|(OROUGH)=ER4OW|#:(OR) =ER|#:(ORS) =ERZ|(OR)=AOR| (ONE)=WAHN|#(ONE) =WAHN|(OW)=OW| (OVER)=OW5VER|PR(O)V=UW4|(OV)=AH4V|(O)^%=OW5|(O)^EN=OW|(O)^I#=OW5|(OL)D=OW4L|(OUGHT)=AO5T|(OUGH)=AH5F| (OU)=AW|H(OU)S#=AW4|(OUS)=AXS|(OUR)=OHR|(OULD)=UH5D|(OU)^L=AH5|(OUP)=UW5P|(OU)=AW|(OY)=OY|(OING)=OW4IHNX|(OI)=OY5|(OOR)=OH5R|(OOK)=UH5K|F(OOD)=UW5D|L(OOD)=AH5D|M(OOD)=UW5D|(OOD)=UH5D|F(OOT)=UH5T|(OO)=UW5|(O')=OH|(O)E=OW|(O) =OW|(OA)=OW4| (ONLY)=OW4NLIY| (ONCE)=WAH4NS|(ON'T)=OW4NT|C(O)N=AA|(O)NG=AO| :^(O)N=AH|I(ON)=UN|#:(ON)=UN|#^(ON)=UN|(O)ST=OW|(OF)^=AO4F|(OTHER)=AH5DHER|R(O)B=RAA|^R(O):#=OW5|(OSS) =AO5S|#:^(OM)=AHM|(O)=AA| (P) =PIY4|(PH)=F|(PEOPL)=PIY5PUL|(POW)=PAW4|(PUT) =PUHT|(P)P=|(P)S=|(P)N=|(PROF.)=PROHFEH4SER|(P)=P| (Q) =KYUW4|(QUAR)=KWOH5R|(QU)=KW|(Q)=K| (R) =AA5R| (RE)^#=RIY|(R)R=|(R)=R| (S) =EH4S|(SH)=SH|#(SION)=ZHUN|(SOME)=SAHM|#(SUR)#=ZHER|(SUR)#=SHER|#(SU)#=ZHUW|#(SSU)#=SHUW|#(SED)=ZD|#(S)#=Z|(SAID)=SEHD|^(SION)=SHUN|(S)S=|.(S) =Z|#:.E(S) =Z|#:^#(S) =S|U(S) =S| :#(S) =Z|##(S) =Z| (SCH)=SK|(S)C+=|#(SM)=ZUM|#(SN)'=ZUM|(STLE)=SUL|(S)=S| (T) =TIY4| (THE) #=DHIY| (THE) =DHAX|(TO) =TUX| (THAT)=DHAET| (THIS) =DHIHS| (THEY)=DHEY| (THERE)=DHEHR|(THER)=DHER|(THEIR)=DHEHR| (THAN) =DHAEN| (THEM) =DHAEN|(THESE) =DHIYZ| (THEN)=DHEHN|(THROUGH)=THRUW4|(THOSE)=DHOHZ|(THOUGH) =DHOW|(TODAY)=TUXDEY|(TOMO)RROW=TUMAA5|(TO)TAL=TOW5| (THUS)=DHAH4S|(TH)=TH|#:(TED)=TIXD|S(TI)#N=CH|(TI)O=SH|(TI)A=SH|(TIEN)=SHUN|(TUR)#=CHER|(TU)A=CHUW| (TWO)=TUW|&(T)EN =|(T)=T| (U) =YUW4| (UN)I=YUWN| (UN)=AHN| (UPON)=AXPAON|@(UR)#=UH4R|(UR)#=YUH4R|(UR)=ER|(U)^ =AH|(U)^^=AH5|(UY)=AY5| G(U)#=|G(U)%=|G(U)#=W|#N(U)=YUW|@(U)=UW|(U)=YUW| (V) =VIY4|(VIEW)=VYUW5|(V)=V| (W) =DAH4BULYUW| (WERE)=WER|(WA)SH=WAA|(WA)ST=WEY|(WA)S=WAH|(WA)T=WAA|(WHERE)=WHEHR|(WHAT)=WHAHT|(WHOL)=/HOWL|(WHO)=/HUW|(WH)=WH|(WAR)#=WEHR|(WAR)=WAOR|(WOR)^=WER|(WR)=R|(WOM)A=WUHM|(WOM)E=WIHM|(WEA)R=WEH|(WANT)=WAA5NT|ANS(WER)=ER|(W)=W| (X) =EH4KR| (X)=Z|(X)=KS| (Y) =WAY4|(YOUNG)=YAHNX| (YOUR)=YOHR| (YOU)=YUW| (YES)=YEHS| (Y)=Y|F(Y)=AY|PS(YCH)=AYK|#:^(Y)=IY|#:^(Y)I=IY| :(Y) =AY| :(Y)#=AY| :(Y)^+:#=IH| :(Y)^#=AY|(Y)=IH| (Z) =ZIY4|(Z)=Z".split("|").map(e=>{const t=su(e),n=t.c;au[n]=au[n]||[],au[n].push(t)});const ou=Qc.split("|").map(su),ru="*12345678".split(""),iu=" *.*?*,*-*IYIHEHAEAAAHAOUHAXIXERUXOHRXLXWXYXWHR*L*W*Y*M*N*NXDXQ*S*SHF*TH/H/XZ*ZHV*DHCH**J*******EYAYOYAWOWUWB*****D*****G*****GX****P*****T*****K*****KX****ULUMUN".match(/.{1,2}/g),lu=[32768,49408,49408,49408,49408,164,164,164,164,164,164,132,132,164,164,132,132,132,132,132,132,132,68,4164,4164,4164,4164,2124,3148,2124,1096,16460,9280,8256,8256,9280,64,64,9284,8260,8260,9284,8264,8256,76,8260,0,0,180,180,180,148,148,148,78,78,78,1102,1102,1102,78,78,78,78,78,78,75,75,75,1099,1099,1099,75,75,75,75,75,75,128,193,193],cu=[0,4626,4626,4626,2056,2824,2312,2824,3592,3851,2822,4108,3082,1541,1541,3595,3082,3594,3082,2825,2056,2055,2825,2567,2310,2056,2054,2055,2055,2055,770,1285,514,514,514,514,514,514,1542,1542,2055,1542,1542,514,2312,1027,513,286,3597,3852,3852,3852,3598,3593,2054,513,514,1797,513,257,1798,513,514,1798,513,514,2056,514,514,1540,514,514,1798,513,1028,1798,257,1028,1479,1535],uu=(e,t)=>{const n=iu.findIndex(n=>n===e+t&&"*"!==n[1]);return-1!==n&&n},du=e=>{const t=iu.findIndex(t=>t===e+"*");return-1!==t&&t},mu=(e,t)=>Gc(lu[e],t),pu=128,hu=e=>{if(!e)return!1;const t=e=>{if(e<0||e>l.length)throw new Error("Out of bounds: "+e);return e===l.length?null:l[e]},n=(e,t,n,o)=>{for(let c=l.length-1;c>=e;c--)l[c+1]=l[c],i[c+1]=a(c),r[c+1]=s(c);l[e]=t,i[e]=0|o,r[e]=n},s=e=>0|r[e],a=e=>0|i[e],o=(e,t)=>{if(128&t)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");if(e<0||e>l.length)throw new Error("Out of bounds: "+e);i[e]=t},r=[],i=[],l=[];let c=0;return((e,t,n)=>{for(let s=0;s<e.length;s++){e.toLowerCase();const a=e[s],o=e[s+1]||"";let r;if(!1===(r=uu(a,o)))if(!1===(r=du(a))){for(r=ru.length;a!==ru[r]&&r>0;)--r;if(0===r)throw Error(`Could not parse char ${a}`);n(r)}else t(r);else s++,t(r)}})(e,e=>{r[c]=0,i[c]=0,l[c++]=e},e=>{if(128&e)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");r[c-1]=e}),fu(l,i,r),((e,t,n,s)=>{const a=(a,o)=>{switch(a){case 53:mu(n(o-1),1024)&&t(o,16);break;case 42:e(o+1,43,s(o));break;case 44:e(o+1,45,s(o))}},o=(n,a)=>{t(n,13),e(n+1,a,s(n))};let r,i=-1;for(;null!==(r=n(++i));){if(0===r)continue;if(mu(r,16)){e(i+1,mu(r,32)?21:20,s(i)),a(r,i);continue}if(78===r){o(i,24);continue}if(79===r){o(i,27);continue}if(80===r){o(i,28);continue}if(mu(r,pu)&&s(i)){0===n(i+1)&&(r=n(i+2),null!==r&&mu(r,pu)&&s(i+2)&&e(i+2,31,0));continue}const l=0===i?null:n(i-1);if(23!==r)if(24===r&&mu(l,pu))t(i,19);else if(60!==l||32!==r){if(60===r){const e=n(i+1);mu(e,32)||null===e||t(i,63);continue}if(72===r){const e=n(i+1);mu(e,32)&&null!==e||(t(i,75),r=75)}mu(r,1)&&32===l?t(i,r-12):mu(r,1)||a(r,i),69!==r&&57!==r||i>0&&mu(n(i-1),pu)&&(r=n(i+1),0===r&&(r=n(i+2)),mu(r,pu)&&!s(i+1)&&t(i,30))}else t(i,38);else switch(l){case 69:t(i-1,42);break;case 57:t(i-1,44);break;default:mu(l,pu)&&t(i,18)}}})(n,(e,t)=>{l[e]=t},t,s),((e,t,n)=>{let s,a=0;for(;null!==(s=e(a));){if(mu(s,64)&&(s=e(a+1),null!==s&&mu(s,pu))){const e=t(a+1);0!==e&&e<128&&n(a,e+1)}++a}})(t,s,(e,t)=>{r[e]=t}),((e,t,n)=>{let s,a=0;for(;null!==(s=e(a));){const e=t(a);n(a,0===e||e>127?255&cu[s]:cu[s]>>8),a++}})(t,s,o),((e,t,n)=>{for(let o=0;null!==e(o);o++){if(!mu(e(o),256))continue;const s=o;for(;--o>1&&!mu(e(o),pu););if(0===o)break;for(;o<s;o++)if(!mu(e(o),8192)||mu(e(o),4)){const e=n(o);t(o,(e>>1)+e+1)}}let s,a=-1;for(;null!==(s=e(++a));){let o=a;if(mu(s,pu)){if(s=e(++o),!mu(s,64)){18!==s&&19!==s||!mu(e(++o),64)||t(a,n(a)-1);continue}const r=null===s?65:lu[s];if(!Gc(r,4)){if(Gc(r,1)){const e=n(a);t(a,e-(e>>3))}continue}const i=n(a);t(a,(i>>2)+i+1);continue}if(mu(s,2048))s=e(++o),null!==s&&mu(s,2)&&(t(o,6),t(o-1,5));else if(mu(s,2)){for(;0===(s=e(++o)););null!==s&&mu(s,2)&&(t(o,1+(n(o)>>1)),t(a,1+(n(a)>>1)))}else o>0&&mu(s,4096)&&mu(e(o-1),2)&&t(o,n(o)-2)}})(t,o,a),((e,t,n)=>{let s,a=-1;for(;null!==(s=e(++a));)if(mu(s,2)){if(mu(s,1)){let t,n=a;do{t=e(++n)}while(0===t);if(null!==t&&(mu(t,8)||36===t||37===t))continue}t(a+1,s+1,n(a),255&cu[s+1]),t(a+2,s+2,n(a),255&cu[s+2]),a+=2}})(t,n,s),fu(l,i,r),l.map((e,t)=>e?[e,0|i[t],0|r[t]]:null).filter(e=>e)},fu=(e,t,n)=>{for(let s=0;s<e.length;s++){}},gu=[24,26,23,23,23],bu=[0,224,230,236,243,249,0,6,12,6],vu=[0,31,31,31,31,2,2,2,2,2,2,2,2,2,5,5,2,10,2,8,5,5,11,10,9,8,8,160,8,8,23,31,18,18,18,18,30,30,20,20,20,20,23,23,26,26,29,29,2,2,2,2,2,2,26,29,27,26,29,27,26,29,27,26,29,27,23,29,23,23,29,23,23,29,23,23,29,23,23,23],yu=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,4,4,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1,0,1,0,1,0,5,5,5,5,5,4,4,2,0,1,2,0,1,2,0,1,2,0,1,2,0,2,2,0,1,3,0,2,3,0,2,160,160],xu=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,3,3,3,3,3,1,2,3,2,1,3,3,3,3,1,1,3,3,3,2,2,3,2,3,0,0,5,5,5,5,4,4,2,0,2,2,0,3,2,0,4,2,0,3,2,0,2,2,0,2,3,0,3,3,0,3,176,160],Nu=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,241,226,211,187,124,149,1,2,3,3,0,114,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,0,0,25,0,0,0,0,0,0,0,0,0],wu=[0,5980947,5980947,5980947,5980947,7230474,6113550,5980947,5783320,5842971,5712919,5775125,5383440,5844244,6113550,4075794,5383182,5774866,4076306,7218448,5250317,6112527,5904395,3944978,7216654,5904395,7230217,5320198,7943686,6641158,7943686,5980945,6506758,6967046,5315078,7946758,6113550,5383440,6107913,6767114,4990984,6106890,6639366,6639366,7946758,6639365,7958022,0,5916691,5777179,5775125,5778203,5774866,5382669,5315078,5315078,5315078,7946758,7946758,7946758,7368198,7237126,7237126,6181894,6181894,6181894,5315078,5315078,5315078,7946758,7946758,7946758,6647046,6641162,7367946,6181894,6181894,6181894,556844,98067],Eu=[0,0,0,0,0,526861,461581,527630,527887,68879,68623,3087,68367,2316,461581,330508,68623,3087,396301,67597,2061,461838,2061,330252,67597,2061,526861,780,2313,198153,0,0,0,0,0,0,0,0,779,66827,779,1035,0,0,1,66827,920064,66050,593422,68879,3087,68879,3087,2061,2,260,0,2,260,0,1,260,0,1,260,0,0,0,0,0,0,0,0,461324,0,0,330240,0,1245199,1048591],ku=[56,132,107,25,198,99,24,134,115,152,198,177,28,202,49,140,199,49,136,194,48,152,70,49,24,198,53,12,202,49,12,198,33,16,36,105,18,194,49,20,196,113,8,74,34,73,171,106,168,172,73,81,50,213,82,136,147,108,148,34,21,84,210,37,150,212,80,165,70,33,8,133,107,24,196,99,16,206,107,24,140,113,25,140,99,53,12,198,51,153,204,108,181,78,162,153,70,33,40,130,149,46,227,48,156,197,48,156,162,177,156,103,49,136,102,89,44,83,24,132,103,80,202,227,10,172,171,48,172,98,48,140,99,16,148,98,177,140,130,40,150,51,152,214,181,76,98,41,165,74,181,156,198,49,20,214,56,156,75,180,134,101,24,174,103,28,166,99,25,150,35,25,132,19,8,166,82,172,202,34,137,110,171,25,140,98,52,196,98,25,134,99,24,196,35,88,214,163,80,66,84,74,173,74,37,17,107,100,137,74,99,57,138,35,49,42,234,162,169,68,197,18,205,66,52,140,98,24,140,99,17,72,102,49,157,68,51,29,70,49,156,198,177,12,205,50,136,196,115,24,134,115,8,214,99,88,7,129,224,240,60,7,135,144,60,124,15,199,192,192,240,124,30,7,128,128,0,28,120,112,241,199,31,192,12,254,28,31,31,14,10,122,192,113,242,131,143,3,15,15,12,0,121,248,97,224,67,15,131,231,24,249,193,19,218,233,99,143,15,131,131,135,195,31,60,112,240,225,225,227,135,184,113,14,32,227,141,72,120,28,147,135,48,225,193,193,228,120,33,131,131,195,135,6,57,229,195,135,7,14,28,28,112,244,113,156,96,54,50,195,30,60,243,143,14,60,112,227,199,143,15,15,14,60,120,240,227,135,6,240,227,7,193,153,135,15,24,120,112,112,252,243,16,177,140,140,49,124,112,225,134,60,100,108,176,225,227,15,35,143,15,30,62,56,60,56,123,143,7,14,60,244,23,30,60,120,242,158,114,73,227,37,54,56,88,57,226,222,60,120,120,225,199,97,225,225,176,240,240,195,199,14,56,192,240,206,115,115,24,52,176,225,199,142,28,60,248,56,240,225,193,139,134,143,28,120,112,240,120,172,177,143,57,49,219,56,97,195,14,14,56,120,115,23,30,57,30,56,100,225,241,193,78,15,64,162,2,197,143,129,161,252,18,8,100,224,60,34,224,69,7,142,12,50,144,240,31,32,73,224,248,12,96,240,23,26,65,170,164,208,141,18,130,30,30,3,248,62,3,12,115,128,112,68,38,3,36,225,62,4,78,4,28,193,9,204,158,144,33,7,144,67,100,192,15,198,144,156,193,91,3,226,29,129,224,94,29,3,132,184,44,15,128,177,131,224,48,65,30,67,137,131,80,252,36,46,19,131,241,124,76,44,201,13,131,176,181,130,228,232,6,156,7,160,153,29,7,62,130,143,112,48,116,64,202,16,228,232,15,146,20,63,6,248,132,136,67,129,10,52,57,65,198,227,28,71,3,176,184,19,10,194,100,248,24,249,96,179,192,101,32,96,166,140,195,129,32,48,38,30,28,56,211,1,176,38,64,244,11,195,66,31,133,50,38,96,64,201,203,1,236,17,40,64,250,4,52,224,112,76,140,29,7,105,3,22,200,4,35,232,198,154,11,26,3,224,118,6,5,207,30,188,88,49,113,102,0,248,63,4,252,12,116,39,138,128,113,194,58,38,6,192,31,5,15,152,64,174,1,127,192,7,255,0,14,254,0,3,223,128,3,239,128,27,241,194,0,231,224,24,252,224,33,252,128,60,252,64,14,126,0,63,62,0,15,254,0,31,255,0,62,240,7,252,0,126,16,63,255,0,63,56,14,124,1,135,12,252,199,0,62,4,15,62,31,15,15,31,15,2,131,135,207,3,135,15,63,192,7,158,96,63,192,3,254,0,63,224,119,225,192,254,224,195,224,1,223,248,3,7,0,126,112,0,124,56,24,254,12,30,120,28,124,62,14,31,30,30,62,0,127,131,7,219,135,131,7,199,7,16,113,255,0,63,226,1,224,193,195,225,0,127,192,5,240,32,248,240,112,254,120,121,248,2,63,12,143,3,15,159,224,193,199,135,3,195,195,176,225,225,193,227,224,113,240,0,252,112,124,12,62,56,14,28,112,195,199,3,129,193,199,231,0,15,199,135,25,9,239,196,51,224,193,252,248,112,240,120,248,240,97,199,0,31,248,1,124,248,240,120,112,60,124,206,14,33,131,207,8,7,143,8,193,135,143,128,199,227,0,7,248,224,239,0,57,247,128,14,248,225,227,248,33,159,192,255,3,248,7,192,31,248,196,4,252,196,193,188,135,240,15,192,127,5,224,37,236,192,62,132,71,240,142,3,248,3,251,192,25,248,7,156,12,23,248,7,224,31,161,252,15,252,1,240,63,0,254,3,240,31,0,253,0,255,136,13,249,1,255,0,112,7,192,62,66,243,13,196,127,128,252,7,240,94,192,63,0,120,63,129,255,1,248,1,195,232,12,228,100,143,228,15,240,7,240,194,31,0,127,192,111,128,126,3,248,7,240,63,192,120,15,130,7,254,34,119,112,2,118,3,254,0,254,103,0,124,199,241,142,198,59,224,63,132,243,25,216,3,153,252,9,184,15,248,0,157,36,97,249,13,0,253,3,240,31,144,63,1,248,31,208,15,248,55,1,248,7,240,15,192,63,0,254,3,248,15,192,63,0,250,3,240,15,128,255,1,184,7,240,1,252,1,188,128,19,30,0,127,225,64,127,160,127,176,0,63,192,31,192,56,15,240,31,128,255,1,252,3,241,126,1,254,1,240,255,0,127,192,29,7,240,15,192,126,6,224,7,224,15,248,6,193,254,1,252,3,224,15,0,252],Du=(e,t,n,s,a)=>{const o=((e,t)=>{const n=(e,t)=>(e*t>>8&255)<<1,s=[[],[],[]];wu.map((e,t)=>{s[0][t]=255&e,s[1][t]=e>>8&255,s[2][t]=e>>16&255});for(let a=5;a<30;a++)s[0][a]=n(e,s[0][a]),s[1][a]=n(t,s[1][a]);for(let a=48;a<54;a++)s[0][a]=n(e,s[0][a]),s[1][a]=n(t,s[1][a]);return s})(n,s),[r,i,l,c]=((e,t,n)=>{const s=(e,t,n)=>{const s=t;let a;for(t<30?t=0:t-=30;127===(a=n[t]);)++t;for(;t!==s;)for(a+=e,n[t]=255&a;++t!==s&&255===n[t];);},a=[],o=[[],[],[]],r=[[],[],[]],i=[];let l=0;for(let c=0;c<t.length;c++){const u=t[c][0];1===u?s(1,l,a):2===u&&s(255,l,a);const d=bu[t[c][2]];for(let s=t[c][1];s>0;s--)o[0][l]=n[0][u],o[1][l]=n[1][u],o[2][l]=n[2][u],r[0][l]=255&Eu[u],r[1][l]=Eu[u]>>8&255,r[2][l]=Eu[u]>>16&255,i[l]=Nu[u],a[l]=e+d&255,l++}return[a,o,r,i]})(t,e,o),u=((e,t,n,s)=>{const a=[e,t[0],t[1],t[2],n[0],n[1],n[2]],o=(e,t)=>{if(e<0||e>a.length-1)throw new Error(`Error invalid table in Read: ${e}`);return a[e][t]},r=(e,t,n,s)=>{const r=s<0,i=Math.abs(s)%e,l=s/e|0;let c=0,u=e;for(;--u>0;){let s=o(t,n)+l;if(c+=i,c>=e&&(c-=e,r?s--:s&&s++),t<0||t>a.length-1)throw new Error(`Error invalid table in Read: ${t}`);a[t][++n]=s,s+=l}};let i,l,c=0;for(let u=0;u<s.length-1;u++){const t=s[u][0],n=s[u+1][0],a=vu[n],d=vu[t];d===a?(i=yu[t],l=yu[n]):d<a?(i=xu[n],l=yu[n]):(i=yu[t],l=xu[t]),c+=s[u][1];const m=c+l,p=c-i,h=i+l;if(!(h-2&128)){const t=s[u][1]>>1,n=s[u+1][1]>>1;r(t+n,0,p,e[c+n]-e[c-t]);for(let e=1;e<7;e++)r(h,e,p,o(e,m)-o(e,p))}}return c+s[s.length-1][1]})(r,i,l,e);if(!a)for(let m=0;m<r.length;m++)r[m]-=i[0][m]>>1;const d=[0,1,2,2,2,3,3,4,4,5,6,8,9,11,13,15];for(let m=l[0].length-1;m>=0;m--)l[0][m]=d[l[0][m]],l[1][m]=d[l[1][m]],l[2][m]=d[l[2][m]];return[u,i,r,l,c]},Su=(e,t,n,s)=>{const a=(7&n)-1,o=256*a&65535;let r=248&n;const i=(t,n,s,a)=>{let i=8,l=ku[o+r];do{128&l?e(t,n):e(s,a),l<<=1}while(--i)};if(0===r){let e=s>>4^255;r=255&t;do{i(3,26,4,6),r++,r&=255}while(255&++e);return r}r^=255;const l=255&gu[a];do{i(2,5,1,l)}while(255&++r);return t},Mu=e=>127*Math.sin(2*Math.PI*(e/256))|0,Cu=(e,t,n,s,a,o)=>{a=255&(a||72);const r=Du(e,t=void 0===t?64:255&t,n=void 0===n?128:255&n,s=void 0===s?128:255&s,o=o||!1),i=(e=>{const t=new Uint8Array(e);let n=0,s=0;const a=(e,t)=>{const n=16*(15&t);a.ary(e,[n,n,n,n,n])};return a.ary=(e,a)=>{if(n+=[[162,167,167,127,128],[226,60,60,0,0],[225,60,59,0,0],[200,0,0,54,55],[199,0,0,54,54]][s][e],(n/50|0)>t.length)throw new Error(`Buffer overflow, want ${n/50|0} but buffersize is only ${t.length}!`);s=e;for(let s=0;s<5;s++)t[(n/50|0)+s]=a[s]},a.get=()=>t.slice(0,n/50|0),a})(176.4*e.reduce((e,t)=>e+t[1],0)*a|0),[l,c,u,d,m]=r;return Vu(u,c,d,m),((e,t,n,s,a,o,r)=>{let i=n,l=0,c=0,u=0,d=0,m=0,p=a[0],h=.75*p|0;for(;t;){const f=r[m];if(248&f)d=Su(e,d,f,a[255&m]),m+=2,t-=2,i=n;else{{const t=[];let n=256*l,a=256*c,r=256*u;for(let e=0;e<5;e++){const i=Mu(255&n>>8),l=Mu(255&a>>8),c=(255&r>>8)<129?-112:112;let u=i*(15&o[0][m])+l*(15&o[1][m])+c*(15&o[2][m]);u/=32,u+=128,t[e]=0|u,n+=256*s[0][m]/4,a+=256*s[1][m]/4,r+=256*s[2][m]/4}e.ary(0,t)}if(i--,0===i){if(m++,0===--t)return;i=n}if(p--,0!==p){if(h--,0!==h||0===f){l+=s[0][m],c+=s[1][m],u+=s[2][m];continue}d=Su(e,d,f,a[255&m])}}p=a[m],h=.75*p|0,l=0,c=0,u=0}})(i,l,a,c,u,d,m),i.get()},Vu=(e,t,n,s)=>{for(let a=0;a<s.length;a++)a++},Pu=function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=hu(e);return!1!==n&&Cu(n,t.pitch,t.mouth,t.throat,t.speed,t.singmode)},_u=e=>{const t=" "+e.toUpperCase();let n=0,s="";const a=(e,t)=>{n+=t,s+=e};let o=0;for(;n<t.length&&o++<1e4;){t.toLowerCase();const e=t[n];if("."!==e||tu(t,n+1,1)){if(eu(e,2)){ou.some(e=>e(t,n,a));continue}if(0!==Jc[e]){if(!eu(e,Zc))return!1;au[e].some(e=>e(t,n,a));continue}s+=" ",n++}else s+=".",n++}return s},Ou=Pu,Tu=(e,t)=>{const n=Pu(e,t);return!1!==n&&(e=>{const t=new Float32Array(e.length);for(let n=0;n<e.length;n++)t[n]=(e[n]-128)/256;return t})(n)};function Lu(e){const t=e||{},n=(e,n)=>n||t.phonetic?e.toUpperCase():_u(e);this.buf8=(e,s)=>Ou(n(e,s),t),this.buf32=(e,s)=>Tu(n(e,s),t),this.speak=(e,t)=>$c(this.buf32(e,t)),this.download=(e,t)=>{(e=>{const t=new Blob([Yc(e)],{type:"audio/vnd.wave"}),n=window.URL||window.webkitURL,s=n.createObjectURL(t),a=document.createElement("a");a.href=s,a.target="_blank",a.download="sam.wav",document.body.appendChild(a),a.click(),document.body.removeChild(a),n.revokeObjectURL(s)})(this.buf8(e,t))},this.wav=(e,t)=>Yc(this.buf8(e,t))}Lu.buf8=Ou,Lu.buf32=Tu,Lu.convert=_u;class Au{name="SAMSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(e){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={...e},this._readyPromise=new Promise(e=>{this._readyResolve=e}),this._sam=new Lu({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()}async ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch{}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const n=this.audioContext.createBufferSource();n.buffer=this._buffer,n.loop=this._config.singmode,n.connect(this._playerGain),n.onended=()=>{this._sourceNode===n&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=n,n.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,this._config.phonetic);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const n=this._isPlaying;this._buffer=t,n&&this._config.singmode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,n=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.mouth&&e.mouth!==this._config.mouth||void 0!==e.throat&&e.throat!==this._config.throat||void 0!==e.singmode&&e.singmode!==this._config.singmode||void 0!==e.phonetic&&e.phonetic!==this._config.phonetic,s=void 0!==e.vowelSequence&&JSON.stringify(e.vowelSequence)!==JSON.stringify(this._config.vowelSequence);this._config={...this._config,...e},void 0!==e.vowelLoopSingle&&(this._vowelLoopSingle=e.vowelLoopSingle),s&&(this._vowelSequence=e.vowelSequence??[],this._vowelIndex=0),void 0!==e.singmode&&this._sourceNode&&(this._sourceNode.loop=e.singmode),(n||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{this._sam=new Lu({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()},50))}_renderVowel(e){const t=new Lu({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:!0,phonetic:!0}).buf32(e,!0);if(!t)return null;const n=this.audioContext.createBuffer(1,t.length,22050);return n.getChannelData(0).set(t),n}triggerAttack(e,t,n=1){if(this._config.singmode&&this._vowelSequence.length>0){const s=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const a=this._renderVowel(s);if(!a)return;this._buffer=a;const o="string"==typeof e?po(e):e,r=Math.pow(2,(o-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=n,this._stopSource();const i=this.audioContext.createBufferSource();return i.buffer=a,i.loop=this._vowelLoopSingle,i.connect(this._playerGain),i.onended=()=>{this._sourceNode===i&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=i,i.playbackRate.value=r,i.start(t,0),void(this._isPlaying=!0)}if(this._buffer)if(this._config.singmode){const s="string"==typeof e?po(e):e,a=Math.pow(2,(s-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=n,this._isPlaying&&this._sourceNode?(this._sourceNode.playbackRate.cancelScheduledValues(this.audioContext.currentTime),this._sourceNode.playbackRate.setTargetAtTime(a,this.audioContext.currentTime,.06)):(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=a))}else this._startSource(t),this._playerGain.gain.value=n}triggerAttackRelease(e,t,n,s=1){this.triggerAttack(e,n,s)}triggerRelease(e){if(this._config.singmode&&this._isPlaying){const t=e??this.audioContext.currentTime;this._playerGain.gain.cancelScheduledValues(t),this._playerGain.gain.setValueAtTime(this._playerGain.gain.value,t),this._playerGain.gain.linearRampToValueAtTime(0,t+.05),setTimeout(()=>this._stopSource(),80)}}releaseAll(){this._stopSource()}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}class Bu{name="V2Synth";output;_worklet=null;_initialized=!1;_initPromise;_pendingNotes=[];_releaseTimers=new Set;_initialConfig;constructor(e){this.output=oo().createGain(),this._initialConfig=e,this._initPromise=this._initialize()}async _initialize(){const e=oo();if("running"!==e.state){try{await e.resume()}catch{}"running"!==e.state&&await Promise.race([new Promise(t=>{const n=()=>{"running"===e.state?t():setTimeout(n,100)};setTimeout(n,100)}),new Promise((e,t)=>setTimeout(()=>t(new Error("AudioContext not running after 5s")),5e3))])}const t="/",n=`?v=${Date.now()}`;try{await e.audioWorklet.addModule(`${t}V2Synth.worklet.js${n}`)}catch{}const[s,a]=await Promise.all([fetch(`${t}V2Synth.wasm${n}`,{cache:"no-store"}),fetch(`${t}V2Synth.js${n}`,{cache:"no-store"})]);if(!s.ok)throw new Error(`Failed to load V2Synth.wasm: ${s.status}`);if(!a.ok)throw new Error(`Failed to load V2Synth.js: ${a.status}`);const[o,r]=await Promise.all([s.arrayBuffer(),a.text()]),i='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+r.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory').replace(/(_malloc=wasmExports\["\w+"\])/,'$1;Module["_malloc"]=_malloc').replace(/(_free=wasmExports\["\w+"\])/,'$1;Module["_free"]=_free');this._worklet=new AudioWorkletNode(e,"v2-synth-processor",{outputChannelCount:[2]}),await new Promise((e,t)=>{const n=setTimeout(()=>{t(new Error("V2Synth initialization timeout after 10s"))},1e4);this._worklet.port.onmessage=t=>{"ready"===t.data.type?(clearTimeout(n),this._initialized=!0,this._initialConfig&&this._applyV2Config(this._initialConfig),this._pendingNotes.forEach(e=>this._sendMIDI([144,e.note,e.vel])),this._pendingNotes=[],e()):t.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:o,jsCode:i})}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch(l){}}async ready(){return this._initPromise}async ensureInitialized(){return this._initPromise}triggerAttack(e,t,n=1){const s="string"==typeof e?po(e):e,a=Math.floor(127*n);this._initialized?this._sendMIDI([144,s,a]):this._pendingNotes.push({note:s,vel:a})}triggerRelease(){this._initialized}releaseAll(){this._initialized&&this._worklet&&this._sendMIDI([176,123,0])}triggerAttackRelease(e,t,n,s=1){this.triggerAttack(e,void 0,s);const a="string"==typeof e?po(e):e,o="number"==typeof t?t:parseFloat(String(t)),r=setTimeout(()=>{this._releaseTimers.delete(r),this._initialized&&this._worklet&&this._sendMIDI([128,a,0])},1e3*o);this._releaseTimers.add(r)}setParameter(e,t){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"param",index:e,value:t})}applyConfig(e){this._initialized?this._applyV2Config(e):this._initialConfig=e}_applyV2Config(e){e.osc1&&(this.setParameter(2,e.osc1.mode),this.setParameter(4,e.osc1.transpose+64),this.setParameter(5,e.osc1.detune+64),this.setParameter(6,e.osc1.color),this.setParameter(7,e.osc1.level)),e.osc2&&(this.setParameter(8,e.osc2.mode),this.setParameter(9,e.osc2.ringMod?1:0),this.setParameter(10,e.osc2.transpose+64),this.setParameter(11,e.osc2.detune+64),this.setParameter(12,e.osc2.color),this.setParameter(13,e.osc2.level)),e.osc3&&(this.setParameter(14,e.osc3.mode),this.setParameter(15,e.osc3.ringMod?1:0),this.setParameter(16,e.osc3.transpose+64),this.setParameter(17,e.osc3.detune+64),this.setParameter(18,e.osc3.color),this.setParameter(19,e.osc3.level)),e.filter1&&(this.setParameter(20,e.filter1.mode),this.setParameter(21,e.filter1.cutoff),this.setParameter(22,e.filter1.resonance)),e.filter2&&(this.setParameter(23,e.filter2.mode),this.setParameter(24,e.filter2.cutoff),this.setParameter(25,e.filter2.resonance)),e.routing&&(this.setParameter(26,e.routing.mode),this.setParameter(27,e.routing.balance)),e.envelope&&(this.setParameter(32,e.envelope.attack),this.setParameter(33,e.envelope.decay),this.setParameter(34,e.envelope.sustain),this.setParameter(36,e.envelope.release)),e.envelope2&&(this.setParameter(38,e.envelope2.attack),this.setParameter(39,e.envelope2.decay),this.setParameter(40,e.envelope2.sustain),this.setParameter(42,e.envelope2.release)),e.lfo1&&(this.setParameter(47,e.lfo1.rate),this.setParameter(50,e.lfo1.depth))}_sendMIDI(e){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"midi",msg:e})}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._initialized=!1,this._worklet&&this._worklet.disconnect(),this.output.disconnect()}}class Iu{name="V2SpeechSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(e){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0,...e},this._readyPromise=new Promise(e=>{this._readyResolve=e});const t=Math.round(this._config.pitch/127*255),n=Math.round(this._config.speed/127*255),s=(this._config.formantShift-64)/64*50,a=Math.max(0,Math.min(255,128+s)),o=Math.max(0,Math.min(255,128-s));this._sam=new Lu({pitch:t,speed:n,mouth:Math.round(a),throat:Math.round(o),singmode:this._config.singMode,phonetic:!1}),this._render()}async ready(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch{}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const n=this.audioContext.createBufferSource();n.buffer=this._buffer,n.loop=this._config.singMode,n.connect(this._playerGain),n.onended=()=>{this._sourceNode===n&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=n,n.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,!1);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const n=this._isPlaying;this._buffer=t,n&&this._config.singMode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,n=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.formantShift&&e.formantShift!==this._config.formantShift||void 0!==e.singMode&&e.singMode!==this._config.singMode,s=void 0!==e.vowelSequence&&JSON.stringify(e.vowelSequence)!==JSON.stringify(this._config.vowelSequence);this._config={...this._config,...e},void 0!==e.vowelLoopSingle&&(this._vowelLoopSingle=e.vowelLoopSingle),s&&(this._vowelSequence=e.vowelSequence??[],this._vowelIndex=0),void 0!==e.singMode&&this._sourceNode&&(this._sourceNode.loop=e.singMode),(n||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{const e=Math.round(this._config.pitch/127*255),t=Math.round(this._config.speed/127*255),n=(this._config.formantShift-64)/64*50,s=Math.max(0,Math.min(255,128+n)),a=Math.max(0,Math.min(255,128-n));this._sam=new Lu({pitch:e,speed:t,mouth:Math.round(s),throat:Math.round(a),singmode:this._config.singMode,phonetic:!1}),this._render()},50))}_renderVowel(e){const t=Math.round(this._config.pitch/127*255),n=Math.round(this._config.speed/127*255),s=(this._config.formantShift-64)/64*50,a=Math.max(0,Math.min(255,128+s)),o=Math.max(0,Math.min(255,128-s)),r=new Lu({pitch:t,speed:n,mouth:Math.round(a),throat:Math.round(o),singmode:!0,phonetic:!0}).buf32(e,!0);if(!r)return null;const i=this.audioContext.createBuffer(1,r.length,22050);return i.getChannelData(0).set(r),i}triggerAttack(e,t,n=1){if(this._config.singMode&&this._vowelSequence.length>0){const s=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const a=this._renderVowel(s);if(!a)return;this._buffer=a;const o="string"==typeof e?po(e):e,r=Math.pow(2,(o-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=n,this._stopSource();const i=this.audioContext.createBufferSource();return i.buffer=a,i.loop=this._vowelLoopSingle,i.connect(this._playerGain),i.onended=()=>{this._sourceNode===i&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=i,i.playbackRate.value=r,i.start(t,0),void(this._isPlaying=!0)}if(this._buffer)if(this._config.singMode){const s="string"==typeof e?po(e):e,a=Math.pow(2,(s-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=n,this._isPlaying&&this._sourceNode?(this._sourceNode.playbackRate.cancelScheduledValues(this.audioContext.currentTime),this._sourceNode.playbackRate.setTargetAtTime(a,this.audioContext.currentTime,.06)):(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=a))}else this._startSource(t),this._playerGain.gain.value=n}triggerRelease(e){if(this._config.singMode&&this._isPlaying){const t=e??this.audioContext.currentTime;this._playerGain.gain.setValueAtTime(this._playerGain.gain.value,t),this._playerGain.gain.linearRampToValueAtTime(0,t+.05),setTimeout(()=>this._stopSource(),80)}}releaseAll(){this._stopSource()}triggerAttackRelease(e,t,n,s=1){this.triggerAttack(e,n,s)}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}const Fu={ARGURU_DISTORTION:"ArguruDistortion",ELAK_DIST2:"ElakDist2",JESKOLA_DISTORTION:"JeskolaDistortion",GEONIK_OVERDRIVE:"GeonikOverdrive",GRAUE_SOFTSAT:"GraueSoftSat",WHITENOISE_STEREODIST:"WhiteNoiseStereoDist",ELAK_SVF:"ElakSVF",CYANPHASE_NOTCH:"CyanPhaseNotch",Q_ZFILTER:"QZfilter",FSM_PHILTA:"FSMPhilta",JESKOLA_DELAY:"JeskolaDelay",JESKOLA_CROSSDELAY:"JeskolaCrossDelay",JESKOLA_FREEVERB:"JeskolaFreeverb",FSM_PANZERDELAY:"FSMPanzerDelay",FSM_CHORUS:"FSMChorus",FSM_CHORUS2:"FSMChorus2",WHITENOISE_WHITECHORUS:"WhiteNoiseWhiteChorus",BIGYO_FREQUENCYSHIFTER:"BigyoFrequencyShifter",GEONIK_COMPRESSOR:"GeonikCompressor",LD_SLIMIT:"LdSLimit",OOMEK_EXCITER:"OomekExciter",OOMEK_MASTERIZER:"OomekMasterizer",DEDACODE_STEREOGAIN:"DedaCodeStereoGain",FSM_KICK:"FSMKick",FSM_KICKXP:"FSMKickXP",JESKOLA_TRILOK:"JeskolaTrilok",JESKOLA_NOISE:"JeskolaNoise",OOMEK_AGGRESSOR:"OomekAggressor",OOMEK_AGGRESSOR_DF:"OomekAggressorDF",MADBRAIN_4FM2F:"MadBrain4FM2F",MADBRAIN_DYNAMITE6:"MadBrainDynamite6",MAKK_M3:"MakkM3",MAKK_M4:"MakkM4",CYANPHASE_DTMF:"CyanPhaseDTMF",ELENZIL_FREQUENCYBOMB:"ElenzilFrequencyBomb"},Uu={[Fu.ARGURU_DISTORTION]:{name:"Arguru Distortion",shortName:"Distortion",author:"Arguru",type:"effect",parameters:[{index:0,name:"Input Gain",description:"Input Gain",minValue:1,maxValue:2048,defaultValue:256,type:"word"},{index:1,name:"Threshold (-)",description:"Threshold level (negative)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:2,name:"Threshold (+)",description:"Threshold level (positive)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:3,name:"Output Gain",description:"Output Gain",minValue:1,maxValue:2048,defaultValue:1024,type:"word"},{index:4,name:"Phase Inversor",description:"Stereo phase inversor",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:5,name:"Mode",description:"Operational mode (0=Clip, 1=Saturate)",minValue:0,maxValue:1,defaultValue:0,type:"byte"}]},[Fu.ELAK_SVF]:{name:"Elak SVF Filter",shortName:"SVF",author:"Elak",type:"effect",parameters:[{index:0,name:"Cutoff",description:"Cut-off frequency",minValue:0,maxValue:1e3,defaultValue:512,type:"word"},{index:1,name:"Resonance",description:"Resonance",minValue:0,maxValue:65534,defaultValue:512,type:"word"}]},[Fu.FSM_KICK]:{name:"FSM Kick",shortName:"Kick",author:"FSM",type:"generator",parameters:[]},[Fu.FSM_KICKXP]:{name:"FSM KickXP",shortName:"KickXP",author:"FSM",type:"generator",parameters:[]},[Fu.JESKOLA_TRILOK]:{name:"Jeskola Trilok",shortName:"Trilok",author:"Jeskola",type:"generator",parameters:[]},[Fu.JESKOLA_NOISE]:{name:"Jeskola Noise",shortName:"Noise",author:"Jeskola",type:"generator",parameters:[]},[Fu.OOMEK_AGGRESSOR]:{name:"Oomek Aggressor",shortName:"Aggressor",author:"Oomek",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"}]},[Fu.OOMEK_AGGRESSOR_DF]:{name:"Oomek Aggressor Devil Fish",shortName:"AggressorDF",author:"Oomek + Devil Fish Mods",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Normal envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:8,name:"Accent Decay",description:"Accent envelope decay time (Devil Fish)",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:9,name:"VEG Decay",description:"Volume envelope decay (Devil Fish)",minValue:0,maxValue:128,defaultValue:96,type:"byte"},{index:10,name:"VEG Sustain",description:"Volume envelope sustain 0-100% (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:11,name:"Soft Attack",description:"Soft attack time 0.3-30ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:12,name:"Filter Tracking",description:"Filter tracking 0-200% (Devil Fish)",minValue:0,maxValue:200,defaultValue:0,type:"byte"},{index:13,name:"High Resonance",description:"High resonance mode - self oscillation (Devil Fish)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:14,name:"Slide Time",description:"Slide/glide time 10-500ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:30,type:"byte"},{index:15,name:"Muffler",description:"Output soft clipping 0=off, 1=soft, 2=hard (Devil Fish)",minValue:0,maxValue:2,defaultValue:0,type:"byte"},{index:16,name:"Sweep Speed",description:"Accent sweep speed 0=fast, 1=normal, 2=slow (Devil Fish)",minValue:0,maxValue:2,defaultValue:1,type:"byte"}]},[Fu.MADBRAIN_4FM2F]:{name:"MadBrain 4FM2F",shortName:"4FM2F",author:"MadBrain",type:"generator",parameters:[]},[Fu.MADBRAIN_DYNAMITE6]:{name:"MadBrain Dynamite6",shortName:"Dynamite6",author:"MadBrain",type:"generator",parameters:[]},[Fu.MAKK_M3]:{name:"Makk M3",shortName:"M3",author:"Makk",type:"generator",parameters:[]},[Fu.MAKK_M4]:{name:"Makk M4",shortName:"M4",author:"Makk",type:"generator",parameters:[]},[Fu.ELAK_DIST2]:{name:"Elak Dist2",shortName:"Dist2",author:"Elak",type:"effect",parameters:[]},[Fu.JESKOLA_DISTORTION]:{name:"Jeskola Distortion",shortName:"JDist",author:"Jeskola",type:"effect",parameters:[]},[Fu.GEONIK_OVERDRIVE]:{name:"Geonik Overdrive",shortName:"Overdrive",author:"Geonik",type:"effect",parameters:[]},[Fu.GRAUE_SOFTSAT]:{name:"Graue SoftSat",shortName:"SoftSat",author:"Graue",type:"effect",parameters:[]},[Fu.WHITENOISE_STEREODIST]:{name:"WhiteNoise StereoDist",shortName:"StereoDist",author:"WhiteNoise",type:"effect",parameters:[]},[Fu.CYANPHASE_NOTCH]:{name:"CyanPhase Notch",shortName:"Notch",author:"CyanPhase",type:"effect",parameters:[]},[Fu.Q_ZFILTER]:{name:"Q Zfilter",shortName:"Zfilter",author:"Q",type:"effect",parameters:[]},[Fu.FSM_PHILTA]:{name:"FSM Philta",shortName:"Philta",author:"FSM",type:"effect",parameters:[]},[Fu.JESKOLA_DELAY]:{name:"Jeskola Delay",shortName:"JDelay",author:"Jeskola",type:"effect",parameters:[]},[Fu.JESKOLA_CROSSDELAY]:{name:"Jeskola CrossDelay",shortName:"CrossDelay",author:"Jeskola",type:"effect",parameters:[]},[Fu.JESKOLA_FREEVERB]:{name:"Jeskola Freeverb",shortName:"Freeverb",author:"Jeskola",type:"effect",parameters:[]},[Fu.FSM_PANZERDELAY]:{name:"FSM PanzerDelay",shortName:"PanzerDelay",author:"FSM",type:"effect",parameters:[]},[Fu.FSM_CHORUS]:{name:"FSM Chorus",shortName:"Chorus",author:"FSM",type:"effect",parameters:[]},[Fu.FSM_CHORUS2]:{name:"FSM Chorus2",shortName:"Chorus2",author:"FSM",type:"effect",parameters:[]},[Fu.WHITENOISE_WHITECHORUS]:{name:"WhiteNoise WhiteChorus",shortName:"WhiteChorus",author:"WhiteNoise",type:"effect",parameters:[]},[Fu.BIGYO_FREQUENCYSHIFTER]:{name:"Bigyo FrequencyShifter",shortName:"FreqShift",author:"Bigyo",type:"effect",parameters:[]},[Fu.GEONIK_COMPRESSOR]:{name:"Geonik Compressor",shortName:"Compressor",author:"Geonik",type:"effect",parameters:[]},[Fu.LD_SLIMIT]:{name:"Ld SLimit",shortName:"SLimit",author:"Ld",type:"effect",parameters:[]},[Fu.OOMEK_EXCITER]:{name:"Oomek Exciter",shortName:"Exciter",author:"Oomek",type:"effect",parameters:[]},[Fu.OOMEK_MASTERIZER]:{name:"Oomek Masterizer",shortName:"Masterizer",author:"Oomek",type:"master",parameters:[]},[Fu.DEDACODE_STEREOGAIN]:{name:"DedaCode StereoGain",shortName:"StereoGain",author:"DedaCode",type:"effect",parameters:[]},[Fu.CYANPHASE_DTMF]:{name:"CyanPhase DTMF",shortName:"DTMF",author:"CyanPhase",type:"generator",parameters:[]},[Fu.ELENZIL_FREQUENCYBOMB]:{name:"Elenzil FrequencyBomb",shortName:"FreqBomb",author:"Elenzil",type:"generator",parameters:[]}};class Ru{static instance=null;isLoaded=!1;initPromise=null;workletNode=null;nativeContext=null;constructor(){}static getInstance(){return Ru.instance||(Ru.instance=new Ru),Ru.instance}async init(e){if(!this.isLoaded)return this.initPromise||(this.initPromise=this.doInit(e)),this.initPromise}async doInit(e){try{const t=e,n=t.rawContext||t._context||ro(e);if(this.nativeContext=n,!n||!n.audioWorklet)return void(this.initPromise=null);if("running"!==n.state){try{await n.resume()}catch{}if("running"!==n.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===n.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const s="/",a=`?v=${Date.now()}`;await n.audioWorklet.addModule(`${s}Buzzmachine.worklet.js${a}`),this.isLoaded=!0}catch(t){throw this.initPromise=null,t}}isInitialized(){return this.isLoaded}async createMachineNode(e,t){this.isLoaded||await this.init(e);const n=e,s=n.rawContext||n._context||ro(e),a=new AudioWorkletNode(s,"buzzmachine-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});return await this.loadMachineWasm(a,t),a}async loadMachineWasm(e,t){const n=this.getMachineFilename(t),[s,a]=await Promise.all([fetch(`/buzzmachines/${n}.js`),fetch(`/buzzmachines/${n}.wasm`)]);if(!s.ok||!a.ok)throw new Error(`Failed to load buzzmachine: ${t}`);const o=await s.text(),r=await a.arrayBuffer();return new Promise((n,s)=>{const a=setTimeout(()=>{s(new Error("Buzzmachine init timeout"))},5e3);e.port.onmessage=e=>{"initialized"===e.data.type?(clearTimeout(a),n()):"error"===e.data.type&&(clearTimeout(a),s(new Error(e.data.error)))},e.port.postMessage({type:"init",wasmBinary:r,jsCode:o,machineType:t})})}getMachineFilename(e){const t={[Fu.ARGURU_DISTORTION]:"Arguru_Distortion",[Fu.ELAK_DIST2]:"Elak_Dist2",[Fu.JESKOLA_DISTORTION]:"Jeskola_Distortion",[Fu.GEONIK_OVERDRIVE]:"Geonik_Overdrive",[Fu.GRAUE_SOFTSAT]:"Graue_SoftSat",[Fu.WHITENOISE_STEREODIST]:"WhiteNoise_StereoDist",[Fu.ELAK_SVF]:"Elak_SVF",[Fu.CYANPHASE_NOTCH]:"CyanPhase_Notch",[Fu.Q_ZFILTER]:"Q_Zfilter",[Fu.FSM_PHILTA]:"FSM_Philta",[Fu.JESKOLA_DELAY]:"Jeskola_Delay",[Fu.JESKOLA_CROSSDELAY]:"Jeskola_CrossDelay",[Fu.JESKOLA_FREEVERB]:"Jeskola_Freeverb",[Fu.FSM_PANZERDELAY]:"FSM_PanzerDelay",[Fu.FSM_CHORUS]:"FSM_Chorus",[Fu.FSM_CHORUS2]:"FSM_Chorus2",[Fu.WHITENOISE_WHITECHORUS]:"WhiteNoise_WhiteChorus",[Fu.BIGYO_FREQUENCYSHIFTER]:"Bigyo_FrequencyShifter",[Fu.GEONIK_COMPRESSOR]:"Geonik_Compressor",[Fu.LD_SLIMIT]:"Ld_SLimit",[Fu.OOMEK_EXCITER]:"Oomek_Exciter",[Fu.OOMEK_MASTERIZER]:"Oomek_Masterizer",[Fu.DEDACODE_STEREOGAIN]:"DedaCode_StereoGain",[Fu.FSM_KICK]:"FSM_Kick",[Fu.FSM_KICKXP]:"FSM_KickXP",[Fu.JESKOLA_TRILOK]:"Jeskola_Trilok",[Fu.JESKOLA_NOISE]:"Jeskola_Noise",[Fu.OOMEK_AGGRESSOR]:"Oomek_Aggressor",[Fu.OOMEK_AGGRESSOR_DF]:"Oomek_Aggressor_DF",[Fu.MADBRAIN_4FM2F]:"MadBrain_4FM2F",[Fu.MADBRAIN_DYNAMITE6]:"MadBrain_Dynamite6",[Fu.MAKK_M3]:"Makk_M3",[Fu.MAKK_M4]:"Makk_M4",[Fu.CYANPHASE_DTMF]:"CyanPhase_DTMF",[Fu.ELENZIL_FREQUENCYBOMB]:"Elenzil_FrequencyBomb"}[e];if(!t)throw new Error(`Unknown machine type: ${e}`);return t}setParameter(e,t,n){e.port.postMessage({type:"setParameter",paramIndex:t,paramValue:n})}stop(e){e.port.postMessage({type:"stop"})}getMachineInfo(e){return Uu[e]}}class ju{name="BuzzmachineGenerator";output;audioContext;engine=Ru.getInstance();machineType;workletNode=null;initInProgress=!1;useWasmEngine=!1;initError=null;errorReported=!1;preGain=null;overdrive=null;overdriveDry=null;overdriveWet=null;mufflerFilter=null;postFilter=null;postGain=null;overdriveAmount=0;mufflerMode="off";filterTrackingAmount=0;currentCutoff=1e3;constructor(e){this.audioContext=oo(),this.machineType=e,this.output=this.audioContext.createGain(),this.is303Style()&&this.createEffectsChain(),this.initEngine()}createEffectsChain(){const e=this.audioContext;this.preGain=e.createGain(),this.overdrive=e.createWaveShaper(),this.overdrive.oversample="2x",this.updateOverdriveCurve(.4),this.overdriveDry=e.createGain(),this.overdriveDry.gain.value=1,this.overdriveWet=e.createGain(),this.overdriveWet.gain.value=0,this.mufflerFilter=e.createBiquadFilter(),this.mufflerFilter.type="lowpass",this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7,this.postFilter=e.createBiquadFilter(),this.postFilter.type="lowpass",this.postFilter.frequency.value=2e4,this.postFilter.Q.value=1,this.postGain=e.createGain();const t=e.createGain();this.preGain.connect(this.overdriveDry),this.preGain.connect(this.overdrive),this.overdrive.connect(this.overdriveWet),this.overdriveDry.connect(t),this.overdriveWet.connect(t),t.connect(this.mufflerFilter),this.mufflerFilter.connect(this.postFilter),this.postFilter.connect(this.postGain),this.postGain.connect(this.output)}updateOverdriveCurve(e){if(!this.overdrive)return;const t=4096,n=new Float32Array(t),s=100*e;for(let a=0;a<t;a++){const e=a/t*2-1;n[a]=(1+s)*e/(1+s*Math.abs(e))}this.overdrive.curve=n}async ensureInitialized(){if(!this.useWasmEngine)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=this.audioContext;if(await this.engine.init(e),this.workletNode=await this.engine.createMachineNode(e,this.machineType),!this.workletNode)throw new Error("Worklet node creation failed");const t=this.is303Style()&&this.preGain?this.preGain:this.output;this.workletNode.connect(t);try{const e=this.audioContext.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(this.audioContext.destination)}catch{}this.useWasmEngine=!0}catch(e){this.initError=e instanceof Error?e:new Error(String(e)),this.useWasmEngine=!1,this.reportInitError()}finally{this.initInProgress=!1}}}reportInitError(){if(this.errorReported||!this.initError)return;this.errorReported=!0;const e=Uu[this.machineType];mc("BuzzmachineGenerator",this.initError.message,{synthName:e?.name??this.machineType,errorType:"wasm",error:this.initError,debugData:{machineType:this.machineType,machineKind:e?.type,wasmSupported:"undefined"!=typeof WebAssembly}})}triggerAttack(e,t,n=1,s,a){if(!this.useWasmEngine||!this.workletNode)return;const o=ho(e);this.is303Style()&&this.filterTrackingAmount>0&&this.applyFilterTracking(o),this.workletNode.port.postMessage({type:"noteOn",frequency:o,velocity:Math.round(127*n),time:t,accent:s,slide:a})}triggerRelease(e){this.useWasmEngine&&this.workletNode&&this.workletNode.port.postMessage({type:"noteOff",time:e})}triggerAttackRelease(e,t,n,s=1,a,o){const r=void 0!==n?go(n):fo(),i=go(t);this.triggerAttack(e,r,s,a,o),this.triggerRelease(r+i)}setParameter(e,t){this.useWasmEngine&&this.workletNode&&this.engine.setParameter(this.workletNode,e,t)}getParameters(){return this.engine.getMachineInfo(this.machineType).parameters}stop(){this.useWasmEngine&&this.workletNode&&this.engine.stop(this.workletNode)}releaseAll(){this.stop()}is303Style(){return this.machineType===Fu.OOMEK_AGGRESSOR||this.machineType===Fu.OOMEK_AGGRESSOR_DF}isDevilFishWasm(){return this.machineType===Fu.OOMEK_AGGRESSOR_DF}setCutoff(e){if(!this.is303Style())return;const t=200*Math.pow(100,e);this.currentCutoff=Math.max(200,Math.min(5e3,t)),this.postFilter&&0===this.filterTrackingAmount&&(this.postFilter.frequency.value=Math.min(18e3,1.5*this.currentCutoff));const n=Math.round(240*e);this.setParameter(1,Math.min(240,Math.max(0,n)))}setResonance(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(2,Math.min(128,Math.max(0,t)))}setEnvMod(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(3,Math.min(128,Math.max(0,t)))}setDecay(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(4,Math.min(128,Math.max(0,t)))}setAccentAmount(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(5,Math.min(128,Math.max(0,t)))}setAccent(e){this.setAccentAmount(e)}setTuning(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(6,Math.min(200,Math.max(0,t)))}setVolume(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(7,Math.min(200,Math.max(0,t)))}setWaveform(e){if(!this.is303Style())return;let t;t="number"==typeof e?e>=.5?1:0:"square"===e?1:0,this.setParameter(0,t)}setSlideTime(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(14,t)}}enableDevilFish(e,t){this.is303Style()&&(e?(this.setOverdrive(t?.overdrive??.3),this.setMuffler(t?.muffler??"mid"),this.setHighResonanceEnabled(!0),this.isDevilFishWasm()&&(this.setFilterTracking(.5),this.setSlideTime(.17),this.setSweepSpeed("normal"))):(this.setOverdrive(0),this.setMuffler("off"),this.setHighResonanceEnabled(!1),this.setFilterTracking(0)))}setOverdrive(e){if(this.is303Style()&&this.overdrive)if(this.overdriveAmount=Math.min(Math.max(e,0),1),0===this.overdriveAmount)this.overdriveDry&&(this.overdriveDry.gain.value=1),this.overdriveWet&&(this.overdriveWet.gain.value=0);else{const e=.8*this.overdriveAmount;this.overdriveDry&&(this.overdriveDry.gain.value=1-e),this.overdriveWet&&(this.overdriveWet.gain.value=e),this.updateOverdriveCurve(.2+.6*this.overdriveAmount)}}setMuffler(e){if(this.is303Style()){if(this.mufflerMode=e,this.isDevilFishWasm()){let e;switch(this.mufflerMode){case"dark":case"mid":e=1;break;case"bright":e=2;break;default:e=0}this.setParameter(15,e)}if(this.mufflerFilter)switch(this.mufflerMode){case"dark":this.mufflerFilter.frequency.value=2e3,this.mufflerFilter.Q.value=.5;break;case"mid":this.mufflerFilter.frequency.value=6e3,this.mufflerFilter.Q.value=.7;break;case"bright":this.mufflerFilter.frequency.value=12e3,this.mufflerFilter.Q.value=.7;break;default:this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7}}}applyFilterTracking(e){if(!this.postFilter||0===this.filterTrackingAmount)return;const t=Math.log2(e/440)*this.filterTrackingAmount*2e3,n=Math.max(200,Math.min(18e3,this.currentCutoff+t));this.postFilter.frequency.value=n}setFilterTracking(e){if(this.is303Style()&&(this.filterTrackingAmount=Math.min(Math.max(e,0),1),this.isDevilFishWasm())){const t=Math.round(200*e);this.setParameter(12,Math.min(200,t))}}setHighResonanceEnabled(e){this.is303Style()&&(this.isDevilFishWasm()&&this.setParameter(13,e?1:0),this.postFilter&&(this.postFilter.Q.value=e?4:1))}setHighResonance(e){this.setHighResonanceEnabled(e)}set(e,t){switch(e){case"cutoff":this.setCutoff(t);break;case"resonance":this.setResonance(t);break;case"envMod":this.setEnvMod(t);break;case"decay":this.setDecay(t);break;case"accent":this.setAccent(t);break;case"tuning":this.setTuning(t);break;case"volume":this.setVolume(t);break;case"waveform":this.setWaveform(t);break;case"slideTime":this.setSlideTime(t);break;case"overdrive":this.setOverdrive(t);break;case"normalDecay":this.setNormalDecay(t);break;case"accentDecay":this.setAccentDecay(t);break;case"softAttack":this.setSoftAttack(t);break;case"filterTracking":this.setFilterTracking(t);break;case"filterFmDepth":case"filterFM":this.setFilterFM(t);break;case"vegDecay":this.setVegDecay(t);break;case"vegSustain":this.setVegSustain(t)}}setNormalDecay(e){this.is303Style()&&this.setDecay(e)}setAccentDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(8,Math.min(128,Math.max(0,t)))}}setVegDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(9,Math.min(128,Math.max(0,t)))}}setVegSustain(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(10,t)}}setSoftAttack(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(11,Math.min(100,Math.max(0,t)))}}setFilterFM(e){this.is303Style()&&this.isDevilFishWasm()&&this.setParameter(19,Math.round(100*e))}setSweepSpeed(e){if(this.is303Style()&&this.isDevilFishWasm()){let t;if("number"==typeof e)t=Math.round(2*e);else switch(e.toLowerCase()){case"fast":t=0;break;case"slow":t=2;break;default:t=1}this.setParameter(16,t)}}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}dispose(){this.output.disconnect(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.preGain&&(this.preGain.disconnect(),this.preGain=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveDry&&(this.overdriveDry.disconnect(),this.overdriveDry=null),this.overdriveWet&&(this.overdriveWet.disconnect(),this.overdriveWet=null),this.mufflerFilter&&(this.mufflerFilter.disconnect(),this.mufflerFilter=null),this.postFilter&&(this.postFilter.disconnect(),this.postFilter=null),this.postGain&&(this.postGain.disconnect(),this.postGain=null)}}const Xu=0,zu=1,Gu=2,Hu=3,Wu=4,qu=5,Ku=6,$u=7,Yu=8,Ju=9,Qu=10,Zu=11,ed=12,td=13,nd=14,sd=15,ad=16,od=17,rd=18,id=19,ld=20,cd=126,ud=127,dd=128,md=129,pd=130,hd=131,fd=132,gd=133,bd=134,vd=135,yd=136,xd=137,Nd=138,wd=139,Ed=140,kd=141,Dd=142,Sd=143,Md=144,Cd={"E.PIANO 1":{algorithm:5,feedback:6,operators:[{level:99,coarse:1,fine:0,detune:7},{level:70,coarse:14,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:60,coarse:1,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:80,coarse:1,fine:0,detune:7}]},"BRASS 1":{algorithm:22,feedback:7},"STRINGS 1":{algorithm:2,feedback:4},"INIT VOICE":{algorithm:0,feedback:0}};class Vd{name="DexedSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=oo().createGain(),this.config={algorithm:0,feedback:0,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=oo(),t="/";Vd.isWorkletLoaded||(Vd.workletLoadPromise||(Vd.workletLoadPromise=e.audioWorklet.addModule(`${t}dexed/Dexed.worklet.js`)),await Vd.workletLoadPromise,Vd.isWorkletLoaded=!0);const[n,s]=await Promise.all([fetch(`${t}dexed/Dexed.wasm`),fetch(`${t}dexed/Dexed.js`)]);if(!n.ok)throw new Error(`Failed to load Dexed.wasm: ${n.status}`);if(!s.ok)throw new Error(`Failed to load Dexed.js: ${s.status}`);const[a,o]=await Promise.all([n.arrayBuffer(),s.text()]),r=o.replace(/import\.meta\.url/g,`"${t}dexed/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(e,"dexed-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:a,jsCode:r}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch{}}catch(e){throw e}}applyConfig(e){this._worklet&&this.isInitialized&&(void 0!==e.algorithm&&this.setParameter(bd,e.algorithm),void 0!==e.feedback&&this.setParameter(vd,e.feedback),void 0!==e.oscSync&&this.setParameter(yd,e.oscSync?1:0),void 0!==e.transpose&&this.setParameter(Md,e.transpose),void 0!==e.lfoSpeed&&this.setParameter(xd,e.lfoSpeed),void 0!==e.lfoDelay&&this.setParameter(Nd,e.lfoDelay),void 0!==e.lfoPmd&&this.setParameter(wd,e.lfoPmd),void 0!==e.lfoAmd&&this.setParameter(Ed,e.lfoAmd),void 0!==e.lfoSync&&this.setParameter(kd,e.lfoSync?1:0),void 0!==e.lfoWave&&this.setParameter(Dd,e.lfoWave),void 0!==e.lfoPms&&this.setParameter(Sd,e.lfoPms),e.pitchEgRates&&(this.setParameter(cd,e.pitchEgRates[0]),this.setParameter(ud,e.pitchEgRates[1]),this.setParameter(dd,e.pitchEgRates[2]),this.setParameter(md,e.pitchEgRates[3])),e.pitchEgLevels&&(this.setParameter(pd,e.pitchEgLevels[0]),this.setParameter(hd,e.pitchEgLevels[1]),this.setParameter(fd,e.pitchEgLevels[2]),this.setParameter(gd,e.pitchEgLevels[3])),e.operators&&e.operators.forEach((e,t)=>{if(t>=6)return;const n=21*t;void 0!==e.level&&this.setParameter(n+ad,e.level),void 0!==e.coarse&&this.setParameter(n+rd,e.coarse),void 0!==e.fine&&this.setParameter(n+id,e.fine),void 0!==e.detune&&this.setParameter(n+ld,e.detune),void 0!==e.mode&&this.setParameter(n+od,e.mode),e.egRates&&(this.setParameter(n+Xu,e.egRates[0]),this.setParameter(n+zu,e.egRates[1]),this.setParameter(n+Gu,e.egRates[2]),this.setParameter(n+Hu,e.egRates[3])),e.egLevels&&(this.setParameter(n+Wu,e.egLevels[0]),this.setParameter(n+qu,e.egLevels[1]),this.setParameter(n+Ku,e.egLevels[2]),this.setParameter(n+$u,e.egLevels[3])),void 0!==e.breakPoint&&this.setParameter(n+Yu,e.breakPoint),void 0!==e.leftDepth&&this.setParameter(n+Ju,e.leftDepth),void 0!==e.rightDepth&&this.setParameter(n+Qu,e.rightDepth),void 0!==e.leftCurve&&this.setParameter(n+Zu,e.leftCurve),void 0!==e.rightCurve&&this.setParameter(n+ed,e.rightCurve),void 0!==e.rateScaling&&this.setParameter(n+td,e.rateScaling),void 0!==e.ampModSens&&this.setParameter(n+nd,e.ampModSens),void 0!==e.velocitySens&&this.setParameter(n+sd,e.velocitySens)}))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadSysEx(e){this._worklet?.port.postMessage({type:"loadSysEx",sysexData:Array.from(e)})}loadPreset(e){const t=Cd[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setAlgorithm(e){this.config.algorithm=Math.max(0,Math.min(31,e)),this.setParameter(bd,this.config.algorithm)}setFeedback(e){this.config.feedback=Math.max(0,Math.min(7,e)),this.setParameter(vd,this.config.feedback)}setOperatorLevel(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+ad,Math.max(0,Math.min(99,t)))}setOperatorCoarse(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+rd,Math.max(0,Math.min(31,t)))}setOperatorFine(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+id,Math.max(0,Math.min(99,t)))}setOperatorDetune(e,t){if(e<0||e>=6)return;const n=21*e;this.setParameter(n+ld,Math.max(0,Math.min(14,t)))}setLfoSpeed(e){this.config.lfoSpeed=Math.max(0,Math.min(99,e)),this.setParameter(xd,this.config.lfoSpeed)}setLfoPitchModDepth(e){this.config.lfoPmd=Math.max(0,Math.min(99,e)),this.setParameter(wd,this.config.lfoPmd)}setLfoAmpModDepth(e){this.config.lfoAmd=Math.max(0,Math.min(99,e)),this.setParameter(Ed,this.config.lfoAmd)}setLfoWaveform(e){this.config.lfoWave=Math.max(0,Math.min(5,e)),this.setParameter(Dd,this.config.lfoWave)}setTranspose(e){this.config.transpose=Math.max(0,Math.min(48,e)),this.setParameter(Md,this.config.transpose)}triggerAttack(e,t,n=1){const s=po(e),a=Math.round(127*n);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:s,velocity:a}),this):(this.pendingNotes.push({note:s,velocity:a}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=po(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}releaseAll(){this._worklet?.port.postMessage({type:"allNotesOff"})}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Pd=0,_d=1,Od=2,Td=3,Ld=4,Ad=5,Bd=6,Id=7,Fd=8,Ud=9,Rd=11,jd=12,Xd=13,zd=14,Gd=15,Hd=16,Wd=17,qd=18,Kd=19,$d=20,Yd=21,Jd=22,Qd=23,Zd=24,em=25,tm=26,nm=27,sm=28,am=29,om=30,rm=31,im=32,lm=33,cm=34,um=35,dm=36,mm=37,pm=38,hm=39,fm=40,gm=41,bm=42,vm=43,ym=44,xm=0,Nm=1,wm=0,Em={"Classic Brass":{osc1Waveform:xm,osc2Waveform:xm,osc2Detune:.05,osc1Level:1,osc2Level:.8,filterCutoff:.4,filterResonance:.2,filterEnvAmount:.6,filterAttack:.1,filterDecay:.3,filterSustain:.4,filterRelease:.2,ampAttack:.05,ampDecay:.1,ampSustain:.8,ampRelease:.3},"Fat Lead":{osc1Waveform:xm,osc2Waveform:xm,osc2Octave:-1,osc2Detune:.1,osc1Level:1,osc2Level:1,filterCutoff:.6,filterResonance:.4,filterEnvAmount:.3,lfoRate:.3,lfoOscAmount:.1},"Pulse Pad":{osc1Waveform:Nm,osc2Waveform:Nm,osc1PulseWidth:.3,osc2PulseWidth:.7,osc2Detune:.02,filterCutoff:.3,filterResonance:.1,filterEnvAmount:.2,ampAttack:.5,ampDecay:.5,ampSustain:.7,ampRelease:1,lfoRate:.15,lfoPwAmount:.3},"Sync Lead":{osc1Waveform:xm,osc2Waveform:xm,osc2Octave:1,oscSync:!0,filterCutoff:.5,filterResonance:.3,filterEnvAmount:.5},Init:{osc1Waveform:xm,osc1Level:1,osc2Level:0,filterCutoff:.7,filterResonance:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3}};class km{name="OBXdSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=oo().createGain(),this.config={osc1Waveform:xm,osc1Octave:0,osc1Level:1,osc1PulseWidth:.5,osc2Waveform:xm,osc2Octave:0,osc2Detune:.1,osc2Level:.7,osc2PulseWidth:.5,filterCutoff:.7,filterResonance:.3,filterEnvAmount:.5,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:wm,masterVolume:.7,velocitySensitivity:.5,panSpread:.3,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=oo(),t="/";km.isWorkletLoaded||(km.workletLoadPromise||(km.workletLoadPromise=e.audioWorklet.addModule(`${t}obxd/OBXd.worklet.js`)),await km.workletLoadPromise,km.isWorkletLoaded=!0);const[n,s]=await Promise.all([fetch(`${t}obxd/OBXd.wasm`),fetch(`${t}obxd/OBXd.js`)]);if(!n.ok)throw new Error(`Failed to load OBXd.wasm: ${n.status}`);if(!s.ok)throw new Error(`Failed to load OBXd.js: ${s.status}`);const[a,o]=await Promise.all([n.arrayBuffer(),s.text()]),r=o.replace(/import\.meta\.url/g,`"${t}obxd/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(e,"obxd-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:a,jsCode:r}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch{}}catch(e){throw e}}applyConfig(e){if(!this._worklet||!this.isInitialized)return;const t=[["osc1Waveform",Pd],["osc1Octave",_d],["osc1Detune",Od],["osc1PulseWidth",Td],["osc1Level",Ld],["osc2Waveform",Ad],["osc2Octave",Bd],["osc2Detune",Id],["osc2PulseWidth",Fd],["osc2Level",Ud],["filterCutoff",Xd],["filterResonance",zd],["filterType",Gd],["filterEnvAmount",Hd],["filterKeyTrack",Wd],["filterVelocity",qd],["filterAttack",Kd],["filterDecay",$d],["filterSustain",Yd],["filterRelease",Jd],["ampAttack",Qd],["ampDecay",Zd],["ampSustain",em],["ampRelease",tm],["lfoRate",nm],["lfoWaveform",sm],["lfoDelay",am],["lfoOscAmount",om],["lfoFilterAmount",rm],["lfoAmpAmount",im],["lfoPwAmount",lm],["masterVolume",cm],["voices",um],["unisonDetune",mm],["portamento",pm],["velocitySensitivity",fm],["panSpread",hm],["noiseLevel",gm],["subOscLevel",bm],["subOscOctave",vm],["drift",ym]];for(const[n,s]of t){const t=e[n];void 0!==t&&this.setParameter(s,t)}void 0!==e.oscSync&&this.setParameter(Rd,e.oscSync?1:0),void 0!==e.oscXor&&this.setParameter(jd,e.oscXor?1:0),void 0!==e.unison&&this.setParameter(dm,e.unison?1:0)}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadPreset(e){const t=Em[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setCutoff(e){this.config.filterCutoff=Math.max(0,Math.min(1,e)),this.setParameter(Xd,this.config.filterCutoff)}setResonance(e){this.config.filterResonance=Math.max(0,Math.min(1,e)),this.setParameter(zd,this.config.filterResonance)}setFilterEnvAmount(e){this.config.filterEnvAmount=Math.max(0,Math.min(1,e)),this.setParameter(Hd,this.config.filterEnvAmount)}setOsc1Waveform(e){this.config.osc1Waveform=e,this.setParameter(Pd,e)}setOsc2Waveform(e){this.config.osc2Waveform=e,this.setParameter(Ad,e)}setOsc2Detune(e){this.config.osc2Detune=Math.max(-1,Math.min(1,e)),this.setParameter(Id,this.config.osc2Detune)}setLfoRate(e){this.config.lfoRate=Math.max(0,Math.min(1,e)),this.setParameter(nm,this.config.lfoRate)}setLfoOscAmount(e){this.config.lfoOscAmount=Math.max(0,Math.min(1,e)),this.setParameter(om,this.config.lfoOscAmount)}setLfoFilterAmount(e){this.config.lfoFilterAmount=Math.max(0,Math.min(1,e)),this.setParameter(rm,this.config.lfoFilterAmount)}setPortamento(e){this.config.portamento=Math.max(0,Math.min(1,e)),this.setParameter(pm,this.config.portamento)}setUnison(e){this.config.unison=e,this.setParameter(dm,e?1:0)}setUnisonDetune(e){this.config.unisonDetune=Math.max(0,Math.min(1,e)),this.setParameter(mm,this.config.unisonDetune)}setVolume(e){this.config.masterVolume=Math.max(0,Math.min(1,e)),this.setParameter(cm,this.config.masterVolume)}triggerAttack(e,t,n=1){const s=po(e),a=Math.round(127*n);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:s,velocity:a}),this):(this.pendingNotes.push({note:s,velocity:a}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=po(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}releaseAll(){this._worklet?.port.postMessage({type:"allNotesOff"})}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Dm=0,Sm=0,Mm=0,Cm=16,Vm=32,Pm=96,_m=104,Om=152;class Tm{name="CZ101Synth";output;audioContext;workletNode=null;voices=[];currentPatch=null;isInitialized=!1;initPromise=null;static DEFAULT_PATCH={name:"Init",line1:{waveform1:Dm,dcaEnvelope:[{rate:99,level:99},{rate:60,level:80},{rate:40,level:60},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:0,level:0}],dcwEnvelope:[{rate:99,level:99},{rate:50,level:70},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:2,level:2},{rate:0,level:0}]}};constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain();for(let e=0;e<8;e++)this.voices.push({note:0,velocity:0,active:!1,envStage:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){const e=this.audioContext;if(!e.audioWorklet)throw new Error("AudioWorklet not supported");try{await e.audioWorklet.addModule("/cz101/CZ101.worklet.js")}catch(t){if(!(t instanceof Error&&t.message?.includes("already")))throw t}this.workletNode=new AudioWorkletNode(e,"cz101-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch{}await new Promise((e,t)=>{const n=setTimeout(()=>t(new Error("CZ101 init timeout")),5e3),s=t=>{"initialized"===t.data.type&&(clearTimeout(n),this.workletNode?.port.removeEventListener("message",s),e())};this.workletNode.port.addEventListener("message",s),this.workletNode.port.start(),this.workletNode.port.postMessage({type:"init"})}),this.isInitialized=!0,this.loadPatch(Tm.DEFAULT_PATCH)}writeReg(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"writeReg",register:e,value:t})}midiNoteToPitch(e,t=0){return(e-7<<9)+4*t}encodeDCAStep(e,t,n,s){return(1&e)<<15|(127&t)<<8|(1&n)<<7|127&s}_encodeDCOStep(e,t,n,s,a){return(1&e)<<15|(127&t)<<8|(1&n)<<7|(1&s)<<6|63&a}encodeWaveform(e,t,n,s,a,o){return(7&e)<<13|(7&(t??e))<<10|(void 0!==t?1:0)<<9|(7&n)<<6|(s?1:0)<<5|(3&a)<<3|(o?1:0)<<2}loadPatch(e){if(this.currentPatch=e,this.workletNode)for(let t=0;t<8;t++){const n=this.encodeWaveform(e.line1.waveform1,e.line1.waveform2,Sm,e.ringMod??!1,e.noiseMode?2:0,!1);this.writeReg(_m+t,n)}}triggerAttack(e,t,n=.8){const s="string"==typeof e?po(e):e;let a=this.voices.findIndex(e=>!e.active);-1===a&&(a=0);const o=this.voices[a];if(o.note=s,o.velocity=Math.floor(127*n),o.active=!0,o.envStage=0,!this.workletNode||!this.currentPatch)return;const r=this.midiNoteToPitch(s,this.currentPatch.detune??0);this.writeReg(Pm+a,r),this.writeReg(Om+a,0);const i=this.currentPatch.line1.dcaEnvelope[0],l=this.encodeDCAStep(0,i.rate,0,Math.floor(i.level*o.velocity/127));this.writeReg(Mm+a,l);const c=this.currentPatch.line1.dcwEnvelope[0],u=this.encodeDCAStep(0,c.rate,0,c.level);if(this.writeReg(Vm+a,u),this.currentPatch.line1.dcoEnvelope&&this.currentPatch.line1.dcoEnvelope.length>0){const e=this.currentPatch.line1.dcoEnvelope[0],t=this._encodeDCOStep(0,e.rate,0,0,e.level);this.writeReg(Cm+a,t)}}triggerRelease(e,t){const n="string"==typeof e?po(e):e,s=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===s)return;if(this.voices[s].active=!1,!this.workletNode||!this.currentPatch)return;const a=this.encodeDCAStep(1,40,0,0);this.writeReg(Mm+s,a)}releaseAll(){for(const e of this.voices.filter(e=>e.active))this.triggerRelease(e.note)}setParameter(e,t){}getParameters(){return{}}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.output.disconnect()}}const Lm=0,Am=1,Bm=2,Im=3,Fm=4,Um=5,Rm=6,jm=7,Xm=1,zm=2,Gm=4;class Hm extends Hr{name="CEM3394Synth";chipName="CEM3394";workletFile="CEM3394.worklet.js";processorName="cem3394-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setCutoff(e){this.setParameterById(Rm,e)}setResonance(e){this.setParameterById(Um,e)}setFilterModulation(e){this.setParameterById(Am,e)}setPulseWidth(e){this.setParameterById(Im,e)}setWaveform(e){let t=zm|Gm;if("string"==typeof e)switch(e.toLowerCase()){case"triangle":t=Xm;break;case"sawtooth":case"saw":t=zm;break;case"pulse":case"square":t=Gm;break;case"all":t=Xm|zm|Gm}else t=e;this.setParameterById(Bm,t)}setVolume(e){this.setParameterById(jm,e)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={vco_frequency:Lm,modulation:Am,wave_select:Bm,pulse_width:Im,mixer_balance:Fm,resonance:Um,cutoff:Rm,volume:jm}[e];void 0!==n&&this.setParameterById(n,t)}}const Wm=0;class qm extends Hr{name="SCSPSynth";chipName="SCSP";workletFile="SCSP.worklet.js";processorName="scsp-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const n=t/2,s=Math.log2(e/n),a=Math.floor(s)+1,o=Math.round(1024*(e/(n*Math.pow(2,a-1))-1));return{oct:Math.max(-8,Math.min(7,a)),fns:Math.max(0,Math.min(1023,o))}}(e);this.workletNode.port.postMessage({type:"setFrequency",oct:t.oct,fns:t.fns,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",tl:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*31),n=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",sdl:t,sdr:n,slot:this.currentSlot})}setFMLevel(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMLevel",slot:e,level:t})}setFMInputSlot(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMInputSlot",slot:e,inputSlot:t})}setSlot(e){this.currentSlot=Math.max(0,Math.min(31,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,s,a,o){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:s,loop:a,format:o??0})}setEnvelope(e,t,n,s,a,o){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,ar:t,d1r:n,d2r:s,rr:a,dl:o})}setLFO(e,t,n,s,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,plfos:t,alfos:n,freq:s,wave:a})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Wm,volume:Wm}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Wm,e)}}const Km={chipName:"TR707",basePath:"/roms/tr707",zipFile:"tr707.zip",combinedFile:"tr707_combined.bin",combinedSize:131072,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768}]},$m={chipName:"TR707-Expansion",basePath:"/roms/tr707",zipFile:"tr707_expansion.zip",combinedFile:"tr707_expansion.bin",combinedSize:262144,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768},{name:"tr707_expansion.bin",offset:131072,size:131072}]},Ym={chipName:"TMS5220",basePath:"/roms/snspell",files:[{name:"tmc0351n2l.vsm",offset:0,size:16384,required:!0},{name:"tmc0352n2l.vsm",offset:16384,size:16384,required:!0}]},Jm={chipName:"C352",basePath:"/roms/c352",zipFile:"c352.zip",combinedFile:"c352_samples.bin",combinedSize:8388608,files:[{name:"c352_samples_0.bin",offset:0,size:4194304,required:!0},{name:"c352_samples_1.bin",offset:4194304,size:4194304,required:!0}]},Qm={chipName:"K054539",basePath:"/roms/k054539",zipFile:"k054539.zip",combinedFile:"k054539_samples.bin",combinedSize:6291456,files:[{name:"k054539_samples_0.bin",offset:0,size:2097152,required:!0},{name:"k054539_samples_1.bin",offset:2097152,size:1048576,required:!0},{name:"k054539_samples_2.bin",offset:3145728,size:1048576,required:!0},{name:"k054539_samples_3.bin",offset:4194304,size:2097152,required:!0}]},Zm={chipName:"ICS2115",basePath:"/roms/ics2115",zipFile:"ics2115.zip",combinedFile:"ics2115_wavetable.bin",combinedSize:262144,files:[{name:"ics2115_wavetable_0.bin",offset:0,size:262144,required:!0}]},ep={chipName:"RF5C400",basePath:"/roms/rf5c400",zipFile:"rf5c400.zip",combinedFile:"rf5c400_samples.bin",files:[{name:"rf5c400_samples.bin",offset:0,required:!0}]},tp={chipName:"ES5503",basePath:"/roms/es5503",zipFile:"es5503.zip",combinedFile:"es5503_wavetable.bin",files:[{name:"es5503_wavetable.bin",offset:0,required:!0}]},np={chipName:"D50",basePath:"/roms/d50",zipFile:"d50.zip",files:[{name:"d50_firmware.bin",offset:0,size:65536,required:!0},{name:"d50_ic30.bin",offset:65536,size:524288,required:!0},{name:"d50_ic29.bin",offset:589824,size:524288,required:!0}]},sp={chipName:"VFX",basePath:"/roms/vfx",zipFile:"vfx.zip",files:[{name:"u14.bin",offset:0,size:524288,required:!0},{name:"u15.bin",offset:524288,size:524288,required:!0},{name:"u16.bin",offset:1048576,size:524288,required:!0},{name:"vfx210b-low.bin",offset:1572864,size:65536},{name:"vfx210b-high.bin",offset:1638400,size:65536}]};async function ap(e){try{if(e.zipFile){const t=`${e.basePath}/${e.zipFile}`,n=await async function(e,t){try{const n=await fetch(ms(e));if(!n.ok)return null;if((n.headers.get("content-type")||"").includes("text/html"))return null;const s=await n.arrayBuffer();if(s.byteLength<4)return null;const a=new Uint8Array(s,0,4);if(80!==a[0]||75!==a[1])return null;const o=await Ds.loadAsync(s),r=t.files.filter(e=>e.size).map(e=>e.offset+e.size),i=r.length>0?Math.max(...r):t.combinedSize||4194304;let l=new Uint8Array(i),c=0;for(const e of t.files){let t=o.file(e.name);if(!t){const n=Object.keys(o.files).find(t=>t.endsWith("/"+e.name)||t===e.name);n&&(t=o.file(n))}if(!t){if(e.required)return null;continue}const n=await t.async("uint8array");e.size&&(n.length,e.size);const s=e.offset+n.length;if(s>l.length){const e=new Uint8Array(s);e.set(l),l=e}l.set(n,e.offset),c++}return 0===c?null:l}catch(n){return null}}(t,e);if(n)return n}if(e.combinedFile)try{const t=await fetch(ms(`${e.basePath}/${e.combinedFile}`)),n=t.headers.get("content-type")||"";if(t.ok&&!n.includes("text/html")){const n=await t.arrayBuffer(),s=new Uint8Array(n);return e.combinedSize&&(s.length,e.combinedSize),s}}catch{}const t=Math.max(...e.files.map(e=>e.offset+(e.size||0))),n=new Uint8Array(t||1048576);let s=0;const a=await Promise.allSettled(e.files.map(async t=>{try{const a=await fetch(ms(`${e.basePath}/${t.name}`)),o=a.headers.get("content-type")||"";if(!a.ok||o.includes("text/html")){if(t.required)throw new Error(`${t.name} not found (HTTP ${a.status}, type: ${o})`);return}const r=await a.arrayBuffer(),i=new Uint8Array(r);t.size&&(i.length,t.size),n.set(i,t.offset),s++}catch(a){if(t.required)throw a}}));if(0===s)throw new Error(`No ROM files loaded for ${e.chipName}`);if(a.find((t,n)=>"rejected"===t.status&&e.files[n].required))throw new Error(`Required ROM file failed to load for ${e.chipName}`);return n}catch(t){throw new Error(`${e.chipName} ROM files not found or invalid.\nPlease place ROM files in ${e.basePath}/\nRequired files: ${e.files.filter(e=>e.required).map(e=>e.name).join(", ")}`)}}const op=1,rp=0,ip=1,lp=3,cp=5,up=6,dp=7,mp=8,pp=10,hp=12;class fp{name="VFXSynth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=16e6;static NUM_VOICES=32;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.mameEngine=Cr.getInstance();for(let e=0;e<fp.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,looping:!1})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(kr,fp.CLOCK),0===this.handle)throw new Error("Failed to create ES5506 instance");this.isInitialized=!0;try{const e=await async function(){const e=await ap(sp);return[e.slice(0,524288),e.slice(524288,1048576),e.slice(1048576,1572864)]}();for(let t=0;t<e.length;t++)await this.loadSampleROM(t,e[t].buffer)}catch(e){}}async loadSampleROM(e,t){this.isInitialized||await this.init(),this.mameEngine.setRom(e,new Uint8Array(t)),this.romLoaded=!0}writeVoiceReg(e,t,n){if(0===this.handle)return;const s=16*e+t;this.mameEngine.write16(this.handle,s,n)}midiNoteToFreqCount(e,t=44100){const n=440*Math.pow(2,(e-69)/12);return 4294967295&Math.floor(n*Math.pow(2,32)/t)}velocityToVolume(e){const t=e/127,n=Math.pow(t,2);return Math.floor(65535*n)}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,n=.8){if(!this.isInitialized||!this.romLoaded)return;const s="string"==typeof e?po(e):e,a=this.allocateVoice(),o=this.voices[a];o.note=s,o.velocity=Math.floor(127*n),o.active=!0;const r=this.midiNoteToFreqCount(s);this.writeVoiceReg(a,ip,r>>>16),this.writeVoiceReg(a,ip+1,65535&r);const i=this.velocityToVolume(o.velocity);this.writeVoiceReg(a,lp,i),this.writeVoiceReg(a,dp,i),this.writeVoiceReg(a,up,0);const l=op;this.writeVoiceReg(a,rp,l)}triggerAttackRelease(e,t=.5,n,s=.8){this.triggerAttack(e,n,s);const a="string"==typeof t?go(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*a)}triggerRelease(e,t){if(!this.isInitialized)return;const n="string"==typeof e?po(e):e,s=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===s)return;this.voices[s].active=!1,this.writeVoiceReg(s,cp,128),this.writeVoiceReg(s,mp,128)}releaseAll(){if(this.isInitialized)for(const e of this.voices.filter(e=>e.active))this.triggerRelease(e.note)}setFilter(e,t,n){this.writeVoiceReg(e,hp,Math.floor(65535*t)),this.writeVoiceReg(e,pp,Math.floor(65535*n))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const gp=0,bp=6144;class vp{name="D50Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=2e7;static NUM_VOICES=16;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.mameEngine=Cr.getInstance();for(let e=0;e<vp.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,partialMask:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(Dr,vp.CLOCK),0===this.handle)throw new Error("Failed to create Roland SA instance");this.isInitialized=!0;try{const{firmware:e,ic30:t,ic29:n}=await async function(){const e=await ap(np);return{firmware:e.slice(0,65536),ic30:e.slice(65536,589824),ic29:e.slice(589824,1114112)}}();await this.loadROMs(t.buffer,n.buffer,e.buffer)}catch(e){}}async loadROMs(e,t,n){this.isInitialized||await this.init(),this.mameEngine.rsaLoadRoms(this.handle,new Uint8Array(e),new Uint8Array(t),new Uint8Array(n)),this.romLoaded=!0}writeControl(e,t){0!==this.handle&&this.mameEngine.write(this.handle,e,t)}_midiNoteToPitch(e,t=0){return e}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e,this.isInitialized}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,n=.8){if(!this.isInitialized||!this.romLoaded)return;const s="string"==typeof e?po(e):e,a=this.allocateVoice(),o=this.voices[a],r=this._currentPatch?.effects?.chorusRate??0,i=this._midiNoteToPitch(s,r);o.note=s,o.velocity=Math.floor(127*n),o.active=!0,o.partialMask=15;const l=gp+128*a;this.writeControl(l+0,i),this.writeControl(l+1,o.velocity),this.writeControl(l+2,1)}triggerAttackRelease(e,t=.5,n,s=.8){this.triggerAttack(e,n,s);const a="string"==typeof t?go(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*a)}triggerRelease(e,t){if(!this.isInitialized)return;const n="string"==typeof e?po(e):e,s=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===s)return;this.voices[s].active=!1;const a=gp+128*s;this.writeControl(a+2,0)}releaseAll(){if(this.isInitialized)for(const e of this.voices.filter(e=>e.active))this.triggerRelease(e.note)}setChorus(e,t){this.writeControl(bp+0,Math.floor(127*e)),this.writeControl(bp+1,Math.floor(127*t))}setReverb(e){this.writeControl(bp+16,Math.floor(127*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const yp=0,xp=1,Np=2,wp=3,Ep=4,kp=5,Dp=6,Sp=7,Mp=8,Cp=9,Vp=[{ic5:"mks20_15179738.BIN",ic6:"mks20_15179737.BIN",ic7:"mks20_15179736.BIN",ic18:"mks20_15179757.BIN"},{ic5:"mks20_15179741.BIN",ic6:"mks20_15179740.BIN",ic7:"mks20_15179739.BIN",ic18:"mks20_15179757.BIN"},{ic5:"MK80_IC5.bin",ic6:"MK80_IC6.bin",ic7:"MK80_IC7.bin",ic18:"MK80_IC18.bin"}],Pp=[{name:"MKS-20: Piano 1",romSet:0},{name:"MKS-20: Piano 2",romSet:0},{name:"MKS-20: Piano 3",romSet:0},{name:"MKS-20: Harpsichord",romSet:1},{name:"MKS-20: Clavi",romSet:1},{name:"MKS-20: Vibraphone",romSet:1},{name:"MKS-20: E-Piano 1",romSet:1},{name:"MKS-20: E-Piano 2",romSet:1},{name:"MK-80: Classic",romSet:2},{name:"MK-80: Special",romSet:2},{name:"MK-80: Blend",romSet:2},{name:"MK-80: Contemporary",romSet:2},{name:"MK-80: A. Piano 1",romSet:2},{name:"MK-80: A. Piano 2",romSet:2},{name:"MK-80: Clavi",romSet:2},{name:"MK-80: Vibraphone",romSet:2}];class _p{name="RdPianoSynth";output;audioContext;_worklet=null;config;isInitialized=!1;pendingNotes=[];loadedRomSets=new Set;currentPatch=0;romLoadError=!1;_initPromise;static romCache=new Map;static isWorkletLoaded=!1;static workletLoadPromise=null;static wasmBinary=null;static jsCode=null;constructor(e={}){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.config={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=this.audioContext,t="/";if(!_p.isWorkletLoaded){if(!_p.workletLoadPromise){const n=`?v=${Date.now()}`;_p.workletLoadPromise=e.audioWorklet.addModule(`${t}rdpiano/RdPiano.worklet.js${n}`)}await _p.workletLoadPromise,_p.isWorkletLoaded=!0}if(!_p.wasmBinary||!_p.jsCode){const[e,n]=await Promise.all([fetch(`${t}rdpiano/RdPiano.wasm`),fetch(`${t}rdpiano/RdPiano.js`)]);if(!e.ok||!n.ok)throw new Error("Failed to fetch RdPiano WASM files");const[s,a]=await Promise.all([e.arrayBuffer(),n.text()]);_p.jsCode=a.replace(/import\.meta\.url/g,`"${t}rdpiano/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),_p.wasmBinary=s}this._worklet=new AudioWorkletNode(this.audioContext,"rdpiano-processor"),this._worklet.port.onmessage=e=>{const{type:t}=e.data;if("wasmReady"===t)this.loadROMs();else if("ready"===t){this.isInitialized=!0,this.applyConfig(),null!=this.config.patch&&0!==this.config.patch&&this.selectPatch(this.config.patch);for(const{note:e,velocity:t}of this.pendingNotes)this._worklet?.port.postMessage({type:"noteOn",note:e,velocity:t});this.pendingNotes=[]}},this._worklet.port.postMessage({type:"init",wasmBinary:_p.wasmBinary,jsCode:_p.jsCode}),this._worklet.connect(this.output)}catch(e){}}async loadROMs(){try{const e=`${"/"}rdpiano/roms/`,t=await this.fetchROM(e+"RD200_B.bin");if(!t)return void(this.romLoadError=!0);this._worklet?.port.postMessage({type:"loadProgramROM",romData:t}),await new Promise(e=>setTimeout(e,50));const n=this.config.patch||0,s=Pp[n].romSet;await this.loadROMSet(s),await new Promise(e=>setTimeout(e,100)),this._worklet?.port.postMessage({type:"initMCU"})}catch(e){this.romLoadError=!0}}async loadROMSet(e){if(this.loadedRomSets.has(e))return!0;if(e<0||e>2)return!1;const t="/rdpiano/roms/",n=Vp[e],[s,a,o,r]=await Promise.all([this.fetchROM(t+n.ic5),this.fetchROM(t+n.ic6),this.fetchROM(t+n.ic7),this.fetchROM(t+n.ic18)]);return!!(s&&a&&o&&r)&&(this._worklet?.port.postMessage({type:"loadROMSet",setIndex:e,ic5:s,ic6:a,ic7:o,ic18:r}),this.loadedRomSets.add(e),!0)}async fetchROM(e){const t=_p.romCache.get(e);if(t)return t.slice(0);try{const t=await fetch(e);if(!t.ok)return null;const n=await t.arrayBuffer();return _p.romCache.set(e,n),n.slice(0)}catch(n){return null}}applyConfig(){this._worklet&&this.isInitialized&&(null!=this.config.chorusEnabled&&this.setParameter(yp,this.config.chorusEnabled?1:0),null!=this.config.chorusRate&&this.setParameter(xp,this.config.chorusRate),null!=this.config.chorusDepth&&this.setParameter(Np,this.config.chorusDepth),null!=this.config.efxEnabled&&this.setParameter(wp,this.config.efxEnabled?1:0),null!=this.config.phaserRate&&this.setParameter(Ep,this.config.phaserRate),null!=this.config.phaserDepth&&this.setParameter(kp,this.config.phaserDepth),null!=this.config.tremoloEnabled&&this.setParameter(Dp,this.config.tremoloEnabled?1:0),null!=this.config.tremoloRate&&this.setParameter(Sp,this.config.tremoloRate),null!=this.config.tremoloDepth&&this.setParameter(Mp,this.config.tremoloDepth),null!=this.config.volume&&this.setParameter(Cp,this.config.volume))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}async selectPatch(e){if(e<0||e>=16)return;const t=Pp[e];if(!this.loadedRomSets.has(t.romSet)){if(!(await this.loadROMSet(t.romSet)))return}this._worklet?.port.postMessage({type:"selectPatch",patchIndex:e}),this.currentPatch=e}setChorusEnabled(e){this.config.chorusEnabled=e,this.setParameter(yp,e?1:0)}setChorusRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusRate=e,this.setParameter(xp,e)}setChorusDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusDepth=e,this.setParameter(Np,e)}setEfxEnabled(e){this.config.efxEnabled=e,this.setParameter(wp,e?1:0)}setPhaserRate(e){e=Math.max(0,Math.min(1,e)),this.config.phaserRate=e,this.setParameter(Ep,e)}setPhaserDepth(e){e=Math.max(0,Math.min(1,e)),this.config.phaserDepth=e,this.setParameter(kp,e)}setTremoloEnabled(e){this.config.tremoloEnabled=e,this.setParameter(Dp,e?1:0)}setTremoloRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloRate=e,this.setParameter(Sp,e)}setTremoloDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloDepth=e,this.setParameter(Mp,e)}setVolume(e){e=Math.max(0,Math.min(1,e)),this.config.volume=e,this.setParameter(Cp,e)}triggerAttack(e,t,n=1){const s=po(e),a=Math.round(127*Math.max(0,Math.min(1,n)));this.romLoadError||(this.isInitialized?this._worklet?.port.postMessage({type:"noteOn",note:s,velocity:a}):this.pendingNotes.push({note:s,velocity:a}))}triggerRelease(e,t){if(this._worklet)if(void 0!==e){const t=po(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"})}releaseAll(){this._worklet?.port.postMessage({type:"allNotesOff"})}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}getCurrentPatch(){return this.currentPatch}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Op=8,Tp=10,Lp=12,Ap=50,Bp=4096;class Ip{name="MU2000Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;static CLOCK=33868800;static NUM_VOICES=64;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this.mameEngine=Cr.getInstance();for(let e=0;e<Ip.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,channel:0,active:!1,startTime:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(Sr,Ip.CLOCK),0===this.handle)throw new Error("Failed to create SWP30 instance");this.isInitialized=!0}async loadWaveROM(e){this.isInitialized||await this.init();const t=new Uint8Array(e);this.mameEngine.setRom(0,t),this.romLoaded=!0}midiNoteToPitch(e,t=0){const n=e-60+t/8192,s=Math.pow(2,n/12);return 65535&Math.floor(8192*s)}velocityToVolume(e){return Math.floor(2*e)}allocateVoice(e){let t=this.voices.findIndex(e=>!e.active);if(-1===t){let n=1/0,s=0;for(let t=0;t<this.voices.length;t++)this.voices[t].channel===e&&this.voices[t].startTime<n&&(n=this.voices[t].startTime,s=t);if(n===1/0)for(let e=0;e<this.voices.length;e++)this.voices[e].startTime<n&&(n=this.voices[e].startTime,s=e);t=s}return t}writeReg(e,t){0!==this.handle&&this.mameEngine.write16(this.handle,e,t)}triggerAttack(e,t,n=.8,s=0){if(!this.isInitialized||!this.romLoaded)return;const a="string"==typeof e?po(e):e,o=this.allocateVoice(s),r=this.voices[o];r.note=a,r.velocity=Math.floor(127*n),r.channel=s,r.active=!0,r.startTime=performance.now();const i=64*o,l=this.midiNoteToPitch(a);this.writeReg(i+Lp,l);const c=this.velocityToVolume(r.velocity);this.writeReg(i+Ap,c),this.writeReg(i+Op,0),this.writeReg(i+Tp,0)}triggerRelease(e,t){if(!this.isInitialized)return;const n="string"==typeof e?po(e):e,s=this.voices.findIndex(e=>e.active&&e.note===n);if(-1===s)return;this.voices[s].active=!1;const a=64*s;this.writeReg(a+Ap,0)}sendMidi(e){0!==this.handle&&this.mameEngine.addMidiEvent(this.handle,e)}setMasterVolume(e){this.writeReg(Bp,Math.floor(255*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const Fp=0;class Up extends Hr{name="AICASynth";chipName="AICA";workletFile="AICA.worklet.js";processorName="aica-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",volume:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",pan:t,slot:this.currentSlot})}setSlot(e){this.currentSlot=Math.max(0,Math.min(63,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,n,s,a,o=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:n,loopEnd:s,loop:a,format:o})}setEnvelope(e,t,n,s,a,o){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,attack:t,decay1:n,decay2:s,release:a,sustainLevel:o})}setLFO(e,t,n,s,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,pitchDepth:t,ampDepth:n,rate:s,waveform:a})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:Fp,volume:Fp}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(Fp,e)}}const Rp=0,jp=1,Xp=2,zp=3,Gp=4,Hp=5,Wp=6,qp=7;class Kp extends Hr{name="ASCSynth";chipName="ASC";workletFile="ASC.worklet.js";processorName="asc-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=(e-128)/128*.5;this.workletNode.port.postMessage({type:"setPanning",width:t})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveform(e){this.writeWavetableSelect(e)}setAttack(e){this.setParameterById(Xp,e)}setDecay(e){this.setParameterById(zp,e)}setSustain(e){this.setParameterById(Gp,e)}setRelease(e){this.setParameterById(Hp,e)}setStereoWidth(e){this.setParameterById(Wp,e)}setDetune(e){this.setParameterById(qp,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Rp,waveform:jp,attack:Xp,decay:zp,sustain:Gp,release:Hp,stereo_width:Wp,detune:qp}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const $p=0,Yp=1,Jp=2,Qp=3,Zp=4,eh=5,th=6,nh=7;class sh extends Hr{name="AstrocadeSynth";chipName="Astrocade";workletFile="Astrocade.worklet.js";processorName="astrocade-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVibratoSpeed(e){this.sendMessage("setVibratoSpeed",e)}setVibratoDepth(e){this.sendMessage("setVibratoDepth",e)}setNoiseVolume(e){this.sendMessage("setNoiseVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:$p,vibrato_speed:Yp,vibrato_depth:Jp,noise_am:Qp,noise_mod:Zp,noise_vol:eh,master_freq:th,stereo_width:nh}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const ah=0;class oh extends Hr{name="C352Synth";chipName="C352";workletFile="C352.worklet.js";processorName="c352-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ap(Jm)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const n=t,s=Math.round(e/n*65536);return Math.max(0,Math.min(65535,s))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,voice:this.currentVoice})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,voice:this.currentVoice})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*255),n=Math.round(e/255*255);this.workletNode.port.postMessage({type:"setPanning",vol_f:t<<8|n,vol_r:t<<8|n,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureVoice(e,t,n,s,a,o,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureVoice",voice:e,bank:t,start:n,end:s,loop:a,freq:o,flags:r})}setVoiceVolume(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVoiceVolume",voice:e,vol_f:t,vol_r:n})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",voice:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",voice:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:ah,volume:ah}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(ah,e)}}const rh=0,ih=1,lh=2,ch=3,uh=4,dh=5,mh=6,ph=7;class hh extends Hr{name="ES5503Synth";chipName="ES5503";workletFile="ES5503.worklet.js";processorName="es5503-processor";currentOsc=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ap(tp)}();await super.initialize(),this.loadWaveData(e,2048),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),osc:this.currentOsc})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,osc:this.currentOsc})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=894886){const n=Math.round(e*Math.pow(2,17)/t);return Math.max(0,Math.min(131071,n))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,osc:this.currentOsc})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,osc:this.currentOsc})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*7);this.workletNode.port.postMessage({type:"setPanning",channel:t,osc:this.currentOsc})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e,osc:this.currentOsc})}setOscillator(e){this.currentOsc=Math.max(0,Math.min(31,e))}setWaveform(e){this.writeWavetableSelect(e)}setWaveSize(e){this.sendMessage("setWaveSize",e)}setResolution(e){this.sendMessage("setResolution",e)}setOscMode(e){this.sendMessage("setOscMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setReleaseTime(e){this.sendMessage("setReleaseTime",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setNumOscillators(e){this.sendMessage("setNumOscillators",e)}loadWaveData(e,t=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadWaveData",waveData:e.buffer,offset:t})}loadWavePage(e,t){this.loadWaveData(e.slice(0,256),256*t)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={waveform:rh,wave_size:ih,resolution:lh,osc_mode:ch,volume:uh,num_oscillators:dh,attack_time:mh,release_time:ph}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const fh=0,gh=1;class bh extends Hr{name="ICS2115Synth";chipName="ICS2115";workletFile="ICS2115.worklet.js";processorName="ics2115-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ap(Zm)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",voice:e,reg:t,data:n})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:fh,volume:fh,active_osc:gh,voices:gh}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(fh,e)}setActiveOscillators(e){this.setParameterById(gh,e)}}const vh=0,yh=1;class xh extends Hr{name="K054539Synth";chipName="K054539";workletFile="K054539.worklet.js";processorName="k054539-processor";currentChannel=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ap(Qm)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=261.63){const n=e/t,s=Math.round(4096*n);return Math.max(0,Math.min(65535,s))}(e);this.workletNode.port.postMessage({type:"setChannelPitch",channel:this.currentChannel,delta:t})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(64*(1-e));this.workletNode.port.postMessage({type:"setChannelVolume",channel:this.currentChannel,volume:t})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*14);this.workletNode.port.postMessage({type:"setChannelPan",channel:this.currentChannel,pan:t})}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureChannel(e,t,n,s=0,a=!1,o=!1){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureChannel",channel:e,startAddr:t,loopAddr:n,sampleType:s,loopEnable:a,reverse:o})}setChannelPitch(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPitch",channel:e,delta:t})}setChannelVolume(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelVolume",channel:e,volume:t})}setChannelPan(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPan",channel:e,pan:t})}setChannelGain(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelGain",channel:e,gain:t})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",channel:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",channel:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:vh,volume:vh,reverb_enable:yh,reverb:yh}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(vh,e)}setReverbEnable(e){this.setParameterById(yh,e?1:0)}}function Nh(e){try{return Lu.convert(e)}catch{return!1}}function wh(e){if(!e)return[];const t=[];let n=0;for(;n<e.length;){if(" "===e[n]){t.push({code:" ",stress:0}),n++;continue}if(e[n]>="0"&&e[n]<="8"){t.length>0&&(t[t.length-1].stress=parseInt(e[n])),n++;continue}if(n+1<e.length){const s=e[n]+e[n+1];if(kh(s)){t.push({code:s,stress:0}),n+=2;continue}}const s=e[n]+"*";kh(s)?(t.push({code:s,stress:0}),n++):n++}return t}const Eh=new Set(["IY","IH","EH","AE","AA","AH","AO","UH","AX","IX","ER","UX","OH","RX","LX","WX","YX","WH","R*","L*","W*","Y*","M*","N*","NX","DX","Q*","S*","SH","F*","TH","/H","/X","Z*","ZH","V*","DH","CH","J*","EY","AY","OY","AW","OW","UW","B*","D*","G*","GX","P*","T*","K*","KX"]);function kh(e){return Eh.has(e)}const Dh=Object.freeze(Object.defineProperty({__proto__:null,parsePhonemeString:wh,textToPhonemes:Nh},Symbol.toStringTag,{value:"Module"}));class Sh{_queue=[];_currentIndex=0;_timer=null;_speaking=!1;_loop=!1;_onFrame=null;_onDone=null;constructor(e,t){this._onFrame=e,this._onDone=t??null}speak(e,t=!1){this.stop(),this._queue=e,this._currentIndex=0,this._loop=t,this._speaking=!0,this._playNext()}stop(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null),this._speaking=!1,this._queue=[],this._currentIndex=0}get isSpeaking(){return this._speaking}_playNext(){if(this._currentIndex>=this._queue.length){if(!(this._loop&&this._queue.length>0))return this._speaking=!1,void this._onDone?.();this._currentIndex=0}const e=this._queue[this._currentIndex];this._onFrame?.(e.data),this._currentIndex++,this._timer=setTimeout(()=>{this._timer=null,this._playNext()},e.durationMs)}dispose(){this.stop(),this._onFrame=null,this._onDone=null}}const Mh=[150,162,174,188,202,217,233,250,267,286,305,325,346,368,391,415,440,466,494,523,554,587,622,659,698,740,784,830,880,932,988,1047],Ch=[440,466,494,523,554,587,622,659,698,740,784,830,880,932,988,1047,1100,1179,1254,1337,1428,1528,1639,1761,1897,2047,2214,2400,2609,2842,3105,3400],Vh=[1179,1337,1528,1761,2047,2400,2842,3400];function Ph(e,t){let n=0,s=Math.abs(e-t[0]);for(let a=1;a<t.length;a++){const o=Math.abs(e-t[a]);o<s&&(s=o,n=a)}return n}function _h(e,t,n,s,a,o){return{f1:Ph(e,Mh),f2:Ph(t,Ch),f3:Ph(n,Vh),noise:s,bw:a,durationMs:o}}function Oh(e){return{IY:_h(270,2290,3010,!1,2,100),IH:_h(390,1990,2550,!1,2,80),EH:_h(530,1840,2480,!1,2,80),AE:_h(660,1720,2410,!1,2,90),AA:_h(710,1100,2540,!1,2,100),AH:_h(730,1090,2440,!1,2,80),AO:_h(570,840,2410,!1,2,100),UH:_h(440,1020,2240,!1,2,80),AX:_h(500,1500,2500,!1,1,60),IX:_h(390,1990,2550,!1,1,60),ER:_h(490,1350,1690,!1,2,100),UX:_h(300,870,2240,!1,2,80),OH:_h(570,840,2410,!1,2,100),EY:_h(530,1840,2480,!1,2,130),AY:_h(710,1100,2540,!1,2,140),OY:_h(570,840,2410,!1,2,140),AW:_h(710,1100,2540,!1,2,130),OW:_h(570,840,2410,!1,2,130),UW:_h(300,870,2240,!1,2,100),"R*":_h(490,1350,1690,!1,1,70),RX:_h(490,1350,1690,!1,1,70),"L*":_h(360,1700,2800,!1,1,70),LX:_h(360,1700,2800,!1,1,70),"W*":_h(300,870,2240,!1,1,60),WX:_h(300,870,2240,!1,1,60),WH:_h(300,870,2240,!0,0,60),"Y*":_h(270,2290,3010,!1,1,60),YX:_h(270,2290,3010,!1,1,60),"M*":_h(300,1100,2500,!1,0,80),"N*":_h(350,1700,2500,!1,0,70),NX:_h(300,1100,2500,!1,0,80),"S*":_h(400,2200,3400,!0,0,90),SH:_h(350,1800,2800,!0,0,90),"F*":_h(350,1500,2500,!0,0,80),TH:_h(400,2e3,3e3,!0,0,80),"/H":_h(500,1500,2500,!0,0,60),"/X":_h(500,1500,2500,!0,0,60),"Z*":_h(400,2200,3400,!1,0,90),ZH:_h(350,1800,2800,!1,0,80),"V*":_h(350,1500,2500,!1,0,70),DH:_h(400,2e3,3e3,!1,0,60),CH:_h(400,2e3,3e3,!0,0,80),"J*":_h(400,2e3,3e3,!1,0,80),"B*":_h(350,1100,2500,!1,0,40),"D*":_h(400,1800,2600,!1,0,40),"G*":_h(350,1500,2500,!1,0,40),GX:_h(350,1500,2500,!1,0,40),"P*":_h(350,1100,2500,!0,0,40),"T*":_h(400,1800,2600,!0,0,40),"K*":_h(350,1500,2500,!0,0,40),KX:_h(350,1500,2500,!0,0,40),DX:_h(400,1800,2600,!1,0,30),"Q*":_h(150,440,1179,!1,0,10)," ":_h(150,440,1179,!1,0,80)}[e]??null}const Th=0,Lh=1,Ah=2,Bh=3,Ih=4,Fh=5,Uh=6,Rh=7,jh=8;class Xh extends Hr{name="MEA8000Synth";chipName="MEA8000";workletFile="MEA8000.worklet.js";processorName="mea8000-processor";_speechSequencer=null;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0)this._speakSingleVowel(e,t);else if(this._singMode)if(this._speechSequencer){const t=440*Math.pow(2,(e-69)/12);this.writeFrequency(t)}else this._startSpeechAtNote(this._speechText,e,t);else this._startSpeechAtNote(this._speechText,60,t);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",f1:e,f2:t,f3:n})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setBandwidth(e){this.setParameterById(Fh,e)}setInterpTime(e){this.setParameterById(jh,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}speakText(e){this._isReady&&this.workletNode?this._startSpeechAtNote(e,60,.8):this._pendingCalls.push({method:"speakText",args:[e]})}_startSpeechAtNote(e,t,n){if(!this._isReady||!this.workletNode||this._disposed)return;this.stopSpeaking();const s=Nh(e);if(!s)return;const a=function(e){const t=[];for(const n of e){const e=Oh(n.code);e&&t.push(e)}return t}(wh(s));if(0===a.length)return;const o=a.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:t,velocity:Math.floor(127*n)}),this._speechSequencer=new Sh(e=>{this.setFormants(e.f1,e.f2,e.f3),this.setNoiseMode(e.noise),this.setBandwidth(e.bw)},()=>{this._speechSequencer=null,this.triggerRelease()}),this._speechSequencer.speak(o)}stopSpeaking(){const e=null!==this._speechSequencer;this._speechSequencer&&(this._speechSequencer.stop(),this._speechSequencer=null),e&&this.triggerRelease()}get isSpeaking(){return this._speechSequencer?.isSpeaking??!1}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Th,noise_mode:Lh,f1_index:Ah,f2_index:Bh,f3_index:Ih,bw_index:Fh,amplitude:Uh,stereo_width:Rh,interp_time:jh}[e];void 0!==n&&this.setParameterById(n,t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(e,t){if(!this._isReady||!this.workletNode||this._disposed)return;const n=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const s=Oh(n);if(!s)return;this.stopSpeaking();const a=[{data:s,durationMs:s.durationMs}];this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)}),this._speechSequencer=new Sh(e=>{this.setFormants(e.f1,e.f2,e.f3),this.setNoiseMode(e.noise),this.setBandwidth(e.bw)},()=>{this._vowelLoopSingle||(this._speechSequencer=null,this.triggerRelease())}),this._speechSequencer.speak(a,this._vowelLoopSingle)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const zh=0,Gh=1;class Hh extends Hr{name="RF5C400Synth";chipName="RF5C400";workletFile="RF5C400.worklet.js";processorName="rf5c400-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return ap(ep)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,data:t})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:zh,volume:zh,clock:Gh}[e];void 0!==n&&this.setParameterById(n,t)}setMasterVolume(e){this.setParameterById(zh,e)}setClock(e){this.setParameterById(Gh,e)}}const Wh=0,qh=1,Kh=2,$h=3,Yh=4,Jh=5,Qh=6,Zh=7,ef=8,tf=9,nf=10,sf=11,af=12;class of extends Hr{name="SN76477Synth";chipName="SN76477";workletFile="SN76477.worklet.js";processorName="sn76477-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVCOFreq(e){this.sendMessage("setVCOFreq",e)}setSLFFreq(e){this.sendMessage("setSLFFreq",e)}setNoiseFreq(e){this.sendMessage("setNoiseFreq",e)}setVCODutyCycle(e){this.sendMessage("setVCODutyCycle",e)}setMixerMode(e){this.sendMessage("setMixerMode",e)}setEnvelopeMode(e){this.sendMessage("setEnvelopeMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setDecayTime(e){this.sendMessage("setDecayTime",e)}setOneShotTime(e){this.sendMessage("setOneShotTime",e)}setNoiseFilterFreq(e){this.sendMessage("setNoiseFilterFreq",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setVCOMode(e){this.sendMessage("setVCOMode",e)}setChipEnable(e){this.sendMessage("setEnable",e?0:1)}setVCORes(e){this.sendMessage("setVCORes",e)}setVCOCap(e){this.sendMessage("setVCOCap",e)}setVCOVoltage(e){this.sendMessage("setVCOVoltage",e)}setPitchVoltage(e){this.sendMessage("setPitchVoltage",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}static RES_K(e){return 1e3*e}static RES_M(e){return 1e6*e}static CAP_U(e){return 1e-6*e}static CAP_N(e){return 1e-9*e}static CAP_P(e){return 1e-12*e}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={vco_freq:Wh,slf_freq:qh,noise_freq:Kh,vco_duty_cycle:$h,mixer_mode:Yh,envelope_mode:Jh,attack_time:Qh,decay_time:Zh,one_shot_time:ef,noise_filter_freq:tf,amplitude:nf,vco_mode:sf,enable:af}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const rf=0,lf=1,cf=2,uf=3;class df extends Hr{name="SNKWaveSynth";chipName="SNKWave";workletFile="SNKWave.worklet.js";processorName="snkwave-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e){this.writeWavetableSelect(e)}setCustomWaveform(e,t,n,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setCustomWaveform",b0:e,b1:t,b2:n,b3:s})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:rf,waveform:lf,stereo_width:cf,detune:uf}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}function mf(e){return{IY:{preset:yf.EE,voiced:!0,brightness:.7,durationMs:100},IH:{preset:yf.IH,voiced:!0,brightness:.6,durationMs:80},EH:{preset:yf.IH,voiced:!0,brightness:.5,durationMs:80},AE:{preset:yf.AH,voiced:!0,brightness:.6,durationMs:90},AA:{preset:yf.AH,voiced:!0,brightness:.5,durationMs:100},AH:{preset:yf.AH,voiced:!0,brightness:.4,durationMs:80},AO:{preset:yf.OH,voiced:!0,brightness:.3,durationMs:100},UH:{preset:yf.OO,voiced:!0,brightness:.4,durationMs:80},AX:{preset:yf.AH,voiced:!0,brightness:.3,durationMs:60},IX:{preset:yf.IH,voiced:!0,brightness:.4,durationMs:60},ER:{preset:yf.AH,voiced:!0,brightness:.5,durationMs:100},UX:{preset:yf.OO,voiced:!0,brightness:.3,durationMs:80},OH:{preset:yf.OH,voiced:!0,brightness:.4,durationMs:100},EY:{preset:yf.EE,voiced:!0,brightness:.6,durationMs:130},AY:{preset:yf.AH,voiced:!0,brightness:.5,durationMs:140},OY:{preset:yf.OH,voiced:!0,brightness:.4,durationMs:140},AW:{preset:yf.AH,voiced:!0,brightness:.4,durationMs:130},OW:{preset:yf.OH,voiced:!0,brightness:.4,durationMs:130},UW:{preset:yf.OO,voiced:!0,brightness:.3,durationMs:100},"R*":{preset:yf.AH,voiced:!0,brightness:.4,durationMs:70},RX:{preset:yf.AH,voiced:!0,brightness:.4,durationMs:70},"L*":{preset:yf.EE,voiced:!0,brightness:.3,durationMs:70},LX:{preset:yf.EE,voiced:!0,brightness:.3,durationMs:70},"W*":{preset:yf.OO,voiced:!0,brightness:.3,durationMs:60},WX:{preset:yf.OO,voiced:!0,brightness:.3,durationMs:60},WH:{preset:yf.HH,voiced:!1,brightness:.3,durationMs:60},"Y*":{preset:yf.EE,voiced:!0,brightness:.5,durationMs:60},YX:{preset:yf.EE,voiced:!0,brightness:.5,durationMs:60},"M*":{preset:yf.NN,voiced:!0,brightness:.3,durationMs:80},"N*":{preset:yf.NN,voiced:!0,brightness:.4,durationMs:70},NX:{preset:yf.NN,voiced:!0,brightness:.3,durationMs:80},"S*":{preset:yf.ZZ,voiced:!1,brightness:.9,durationMs:90},SH:{preset:yf.ZZ,voiced:!1,brightness:.7,durationMs:90},"F*":{preset:yf.HH,voiced:!1,brightness:.6,durationMs:80},TH:{preset:yf.HH,voiced:!1,brightness:.5,durationMs:80},"/H":{preset:yf.HH,voiced:!1,brightness:.4,durationMs:60},"/X":{preset:yf.HH,voiced:!1,brightness:.4,durationMs:60},"Z*":{preset:yf.ZZ,voiced:!0,brightness:.8,durationMs:90},ZH:{preset:yf.ZZ,voiced:!0,brightness:.6,durationMs:80},"V*":{preset:yf.ZZ,voiced:!0,brightness:.5,durationMs:70},DH:{preset:yf.ZZ,voiced:!0,brightness:.4,durationMs:60},CH:{preset:yf.ZZ,voiced:!1,brightness:.8,durationMs:80},"J*":{preset:yf.ZZ,voiced:!0,brightness:.7,durationMs:80},"B*":{preset:yf.ZZ,voiced:!0,brightness:.3,durationMs:40},"D*":{preset:yf.ZZ,voiced:!0,brightness:.5,durationMs:40},"G*":{preset:yf.ZZ,voiced:!0,brightness:.4,durationMs:40},GX:{preset:yf.ZZ,voiced:!0,brightness:.4,durationMs:40},"P*":{preset:yf.HH,voiced:!1,brightness:.3,durationMs:40},"T*":{preset:yf.HH,voiced:!1,brightness:.5,durationMs:40},"K*":{preset:yf.HH,voiced:!1,brightness:.4,durationMs:40},KX:{preset:yf.HH,voiced:!1,brightness:.4,durationMs:40},DX:{preset:yf.ZZ,voiced:!0,brightness:.4,durationMs:30},"Q*":{preset:yf.AH,voiced:!1,brightness:0,durationMs:10}," ":{preset:yf.AH,voiced:!1,brightness:0,durationMs:80}}[e]??null}const pf=0,hf=1,ff=2,gf=3,bf=4,vf=5,yf={AH:0,EE:1,IH:2,OH:3,OO:4,NN:5,ZZ:6,HH:7};class xf extends Hr{name="SP0250Synth";chipName="SP0250";workletFile="SP0250.worklet.js";processorName="sp0250-processor";_speechSequencer=null;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0)this._speakSingleVowel(e,t);else if(this._singMode)if(this._speechSequencer){const t=440*Math.pow(2,(e-69)/12);this.writeFrequency(t)}else this._startSpeechAtNote(this._speechText,e,t);else this._startSpeechAtNote(this._speechText,60,t);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.setParameterById(pf,e)}setVowel(e){this.setParameterById(hf,e)}setVoiced(e){this.setParameterById(ff,e?1:0)}setBrightness(e){this.setParameterById(gf,e)}writeFIFO(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeFIFO",index:e,data:t})}setFilterCoeff(e,t,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFilterCoeff",filterIdx:e,isB:t,value:n})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}speakText(e){this._isReady&&this.workletNode?this._startSpeechAtNote(e,60,.8):this._pendingCalls.push({method:"speakText",args:[e]})}_startSpeechAtNote(e,t,n){if(!this._isReady||!this.workletNode||this._disposed)return;this.stopSpeaking();const s=Nh(e);if(!s)return;const a=function(e){const t=[];for(const n of e){const e=mf(n.code);e&&t.push(e)}return t}(wh(s));if(0===a.length)return;const o=a.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:t,velocity:Math.floor(127*n)}),this._speechSequencer=new Sh(e=>{this.setVowel(e.preset),this.setVoiced(e.voiced),this.setBrightness(e.brightness)},()=>{this._speechSequencer=null,this.triggerRelease()}),this._speechSequencer.speak(o)}stopSpeaking(){const e=null!==this._speechSequencer;this._speechSequencer&&(this._speechSequencer.stop(),this._speechSequencer=null),e&&this.triggerRelease()}get isSpeaking(){return this._speechSequencer?.isSpeaking??!1}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:pf,vowel:hf,voiced:ff,brightness:gf,stereo_width:bf,filter_mix:vf}[e];void 0!==n&&this.setParameterById(n,t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(e,t){if(!this._isReady||!this.workletNode||this._disposed)return;const n=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const s=mf(n);if(!s)return;this.stopSpeaking();const a=[{data:s,durationMs:s.durationMs}];this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)}),this._speechSequencer=new Sh(e=>{this.setVowel(e.preset),this.setVoiced(e.voiced),this.setBrightness(e.brightness)},()=>{this._vowelLoopSingle||(this._speechSequencer=null,this.triggerRelease())}),this._speechSequencer.speak(a,this._vowelLoopSingle)}}const Nf=0,wf=1,Ef=2,kf=3,Df=4,Sf=5;class Mf extends Hr{name="TMS36XXSynth";chipName="TMS36XX";workletFile="TMS36XX.worklet.js";processorName="tms36xx-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setStopEnable(e){this.sendMessage("setStopEnable",e)}setOctave(e){this.sendMessage("setOctave",e)}setDecayRate(e){this.setParameterById(Ef,e)}setDetune(e){this.setParameterById(Sf,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Nf,stop_enable:wf,decay_rate:Ef,octave:kf,stereo_width:Df,detune:Sf}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}function Cf(e){return{IY:{k:[12,28,11,6,10,7,9,3,5,3],energy:12,pitch:31,unvoiced:!1,durationMs:150},IH:{k:[15,25,10,7,9,7,8,3,4,3],energy:12,pitch:30,unvoiced:!1,durationMs:120},EH:{k:[20,22,10,7,8,7,8,4,4,3],energy:12,pitch:30,unvoiced:!1,durationMs:140},AE:{k:[24,19,10,8,8,7,8,4,4,4],energy:12,pitch:30,unvoiced:!1,durationMs:150},AA:{k:[23,12,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:160},AH:{k:[21,11,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:130},AO:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:150},UH:{k:[17,13,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:120},AX:{k:[18,14,8,8,8,8,8,4,4,4],energy:10,pitch:28,unvoiced:!1,durationMs:90},IX:{k:[14,23,9,7,9,7,8,3,4,3],energy:10,pitch:30,unvoiced:!1,durationMs:90},ER:{k:[18,16,9,9,6,10,7,5,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:160},UX:{k:[14,6,6,10,7,8,8,5,4,4],energy:12,pitch:24,unvoiced:!1,durationMs:130},OH:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:150},EY:{k:[20,22,10,7,8,7,8,4,4,3],energy:12,pitch:30,unvoiced:!1,durationMs:200},AY:{k:[23,12,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:200},OY:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:200},AW:{k:[23,12,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:200},OW:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:200},UW:{k:[14,6,6,10,7,8,8,5,4,4],energy:12,pitch:24,unvoiced:!1,durationMs:160},"R*":{k:[17,15,9,9,6,10,7,5,4,4],energy:10,pitch:28,unvoiced:!1,durationMs:100},RX:{k:[17,15,9,9,6,10,7,5,4,4],energy:10,pitch:28,unvoiced:!1,durationMs:100},"L*":{k:[16,20,7,10,5,10,6,5,3,4],energy:10,pitch:28,unvoiced:!1,durationMs:110},LX:{k:[16,20,7,10,5,10,6,5,3,4],energy:10,pitch:28,unvoiced:!1,durationMs:110},"W*":{k:[14,5,5,11,7,8,9,5,5,4],energy:9,pitch:26,unvoiced:!1,durationMs:80},WX:{k:[14,5,5,11,7,8,9,5,5,4],energy:9,pitch:26,unvoiced:!1,durationMs:80},WH:{k:[14,5,5,11,7,8,9,5,5,4],energy:6,pitch:0,unvoiced:!0,durationMs:80},"Y*":{k:[12,28,11,6,10,7,9,3,5,3],energy:9,pitch:30,unvoiced:!1,durationMs:80},YX:{k:[12,28,11,6,10,7,9,3,5,3],energy:9,pitch:30,unvoiced:!1,durationMs:80},"M*":{k:[20,10,4,14,5,10,6,5,3,5],energy:9,pitch:28,unvoiced:!1,durationMs:120},"N*":{k:[18,19,4,14,5,10,6,5,3,5],energy:9,pitch:28,unvoiced:!1,durationMs:100},NX:{k:[16,12,4,14,5,10,6,5,3,5],energy:9,pitch:28,unvoiced:!1,durationMs:120},"S*":{k:[10,28,14,12,11,5,10,2,6,2],energy:8,pitch:0,unvoiced:!0,durationMs:140},SH:{k:[12,22,13,13,10,6,9,3,5,3],energy:10,pitch:0,unvoiced:!0,durationMs:140},"F*":{k:[8,20,12,9,10,5,8,2,5,2],energy:6,pitch:0,unvoiced:!0,durationMs:120},TH:{k:[8,24,12,8,10,5,8,2,6,2],energy:5,pitch:0,unvoiced:!0,durationMs:120},"/H":{k:[18,14,8,8,8,8,8,4,4,4],energy:6,pitch:0,unvoiced:!0,durationMs:80},"/X":{k:[18,14,8,8,8,8,8,4,4,4],energy:6,pitch:0,unvoiced:!0,durationMs:80},"Z*":{k:[10,28,14,12,11,5,10,2,6,2],energy:9,pitch:28,unvoiced:!1,durationMs:130},ZH:{k:[12,22,13,13,10,6,9,3,5,3],energy:9,pitch:28,unvoiced:!1,durationMs:120},"V*":{k:[8,20,12,9,10,5,8,2,5,2],energy:8,pitch:28,unvoiced:!1,durationMs:100},DH:{k:[8,24,12,8,10,5,8,2,6,2],energy:8,pitch:28,unvoiced:!1,durationMs:80},CH:{k:[12,24,13,12,10,6,9,3,5,3],energy:8,pitch:0,unvoiced:!0,durationMs:120},"J*":{k:[12,24,13,12,10,6,9,3,5,3],energy:9,pitch:28,unvoiced:!1,durationMs:120},"B*":{k:[22,10,6,10,5,9,7,4,3,4],energy:7,pitch:28,unvoiced:!1,durationMs:60},"D*":{k:[18,22,6,10,6,8,7,3,4,3],energy:7,pitch:28,unvoiced:!1,durationMs:60},"G*":{k:[16,14,6,10,7,8,8,4,4,4],energy:7,pitch:28,unvoiced:!1,durationMs:60},GX:{k:[16,14,6,10,7,8,8,4,4,4],energy:7,pitch:28,unvoiced:!1,durationMs:60},"P*":{k:[22,10,6,10,5,9,7,4,3,4],energy:5,pitch:0,unvoiced:!0,durationMs:60},"T*":{k:[18,22,6,10,6,8,7,3,4,3],energy:6,pitch:0,unvoiced:!0,durationMs:60},"K*":{k:[16,14,6,10,7,8,8,4,4,4],energy:5,pitch:0,unvoiced:!0,durationMs:60},KX:{k:[16,14,6,10,7,8,8,4,4,4],energy:5,pitch:0,unvoiced:!0,durationMs:60},DX:{k:[18,22,6,10,6,8,7,3,4,3],energy:6,pitch:28,unvoiced:!1,durationMs:40},"Q*":{k:[8,8,8,8,8,8,8,4,4,4],energy:1,pitch:0,unvoiced:!1,durationMs:20}," ":{k:[8,8,8,8,8,8,8,4,4,4],energy:1,pitch:0,unvoiced:!1,durationMs:120}}[e]??null}class Vf{data;bitPos;constructor(e,t=0){this.data=e,this.bitPos=t}readBits(e){let t=0;for(let n=0;n<e;n++){const e=Math.floor(this.bitPos/8),n=this.bitPos%8;if(e<this.data.length){t=t<<1|this.data[e]>>n&1}this.bitPos++}return t}get position(){return this.bitPos}set position(e){this.bitPos=e}get bytesRemaining(){return Math.floor((8*this.data.length-this.bitPos)/8)}}function Pf(e){const t=e.readBits(4);if(0===t)return{energy:0,repeat:!1,pitch:0,k:[],unvoiced:!1};if(15===t)return null;const n=1===e.readBits(1),s=e.readBits(5),a=0===s;if(n)return{energy:t,repeat:!0,pitch:s,k:[],unvoiced:a};const o=e.readBits(5),r=e.readBits(5),i=e.readBits(4),l=e.readBits(4);if(a)return{energy:t,repeat:!1,pitch:s,unvoiced:!0,k:[o,r,i,l,8,8,8,4,4,4]};return{energy:t,repeat:!1,pitch:s,unvoiced:!1,k:[o,r,i,l,e.readBits(4),e.readBits(4),e.readBits(4),e.readBits(3),e.readBits(3),e.readBits(3)]}}function _f(e,t){const n=new Vf(e,t),s=[],a=8*e.length;for(;n.position<a-10&&s.length<300;){const e=Pf(n);if(null===e)break;s.push(e)}return s}const Of=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","ABOUT","AFTER","AGAIN","ANSWER","BEAUTY","BETWEEN","BOY","BUILT","BUSY","BUY","CEILING","CIRCLE","CLOWN","COME","COULD","COUNTRY","COUSIN","DOES","DOUBLE","ENOUGH","EVER","EYE","FRIEND","FROM","GHOST","GIRL","GOES","GONE","GOOD","GREAT","GUARD","GUESS","GYM","HALF","HAVE","HEART","HERE","HIDDEN","HOUR","IDEA","ISLE","JOIN","KEY","KNOW","LAUGH","LEARN","LISTEN","LOVE","MACHINE","MANY","MEANT","MOVE","NONE","OCEAN","OF","ONE","ONLY","OTHER","OVEN","OUTSIDE","PEOPLE","PERIOD","PHONE","PIECE","PRETTY","PROMISE","PSYCHOLOGY","QUIET","READY","RIGHT","ROUGH","SAID","SAYS","SCHOOL","SCIENCE","SCISSORS","SECRET","SHOULD","SIGN","SOME","SPECIAL","SQUARE","STRAIGHT","SUGAR","SURE","THEIR","THERE","THEY","THOUGH","THOUGHT","THROUGH","TOGETHER","TROUBLE","TWO","UPON","USUAL","VERY","WAS","WATCH","WATER","WEAR","WEIRD","WHAT","WHERE","WHO","WOMEN","WON","WORD","WORK","WOULD","WRITE","WRONG","YOU","YOUR","ZERO"];const Tf={IY:"vowel",IH:"vowel",EH:"vowel",AE:"vowel",AA:"vowel",AH:"vowel",AO:"vowel",UH:"vowel",AX:"vowel",IX:"vowel",ER:"vowel",UX:"vowel",OH:"vowel",EY:"diphthong",AY:"diphthong",OY:"diphthong",AW:"diphthong",OW:"diphthong",UW:"diphthong","R*":"liquid",RX:"liquid","L*":"liquid",LX:"liquid","W*":"glide",WX:"glide",WH:"glide","Y*":"glide",YX:"glide","M*":"nasal","N*":"nasal",NX:"nasal","S*":"fricative",SH:"fricative","F*":"fricative",TH:"fricative","/H":"fricative","/X":"fricative","Z*":"fricative",ZH:"fricative","V*":"fricative",DH:"fricative",CH:"affricate","J*":"affricate","P*":"stop","T*":"stop","K*":"stop",KX:"stop","B*":"stop","D*":"stop","G*":"stop",GX:"stop",DX:"stop","Q*":"stop"," ":"pause"};function Lf(e){return Tf[e]??"other"}const Af={A:{segments:["EY"],type:"V"},B:{segments:["B*","IY"],type:"CV"},C:{segments:["S*","IY"],type:"CV"},D:{segments:["D*","IY"],type:"CV"},E:{segments:["IY"],type:"V"},F:{segments:["EH","F*"],type:"VC"},G:{segments:["J*","IY"],type:"CV"},H:{segments:["EY","CH"],type:"VC"},I:{segments:["AY"],type:"V"},J:{segments:["J*","EY"],type:"CV"},K:{segments:["K*","EY"],type:"CV"},L:{segments:["EH","L*"],type:"VC"},M:{segments:["EH","M*"],type:"VC"},N:{segments:["EH","N*"],type:"VC"},O:{segments:["OW"],type:"V"},P:{segments:["P*","IY"],type:"CV"},Q:{segments:["K*","UW"],type:"CVC"},R:{segments:["AA","R*"],type:"VC"},S:{segments:["EH","S*"],type:"VC"},T:{segments:["T*","IY"],type:"CV"},U:{segments:["Y*","UW"],type:"GV"},V:{segments:["V*","IY"],type:"CV"},W:{segments:[],type:"SKIP"},X:{segments:[],type:"SKIP"},Y:{segments:["W*","AY"],type:"GV"},Z:{segments:["Z*","IY"],type:"CV"}};function Bf(e){for(let t=0;t<e.length;t++)if(!e[t].unvoiced&&e[t].energy>=6&&e[t].pitch>0)return t;return Math.floor(.3*e.length)}function If(e){if(e.length<=2)return e;const t=Math.max(1,Math.floor(.2*e.length));return e.slice(t,e.length-t)}const Ff=[31,31,15,15,15,15,15,7,7,7];function Uf(e,t){return Math.min(Math.max(Math.round(e[t]??0),0),Ff[t])}function Rf(e,t,n){const s=[];for(let a=0;a<10;a++){const o=(e.k[a]??0)*(1-n)+(t.k[a]??0)*n;s.push(Math.min(Math.max(Math.round(o),0),Ff[a]))}return{k:s,energy:Math.min(Math.max(Math.round(e.energy*(1-n)+t.energy*n),0),14),pitch:Math.min(Math.max(Math.round(e.pitch*(1-n)+t.pitch*n),0),31),unvoiced:n<.5?e.unvoiced:t.unvoiced,durationMs:25}}function jf(e,t){let n;switch(t){case"vowel":case"diphthong":n=6;break;case"nasal":case"liquid":n=5;break;case"fricative":case"glide":n=4;break;default:n=3}const s=[];for(let a=0;a<n;a++){const t=a/n*Math.PI*2,o=[...e.k];o[0]=Uf(o,0)+Math.round(Math.sin(t)),o[0]=Math.min(Math.max(o[0],0),Ff[0]),o[1]=Uf(o,1)+Math.round(Math.cos(t)),o[1]=Math.min(Math.max(o[1],0),Ff[1]),s.push({k:o,energy:e.energy,pitch:e.pitch,unvoiced:e.unvoiced,durationMs:25})}return s}function Xf(e,t){const n=Math.max(1,Math.round(t));if(0===e.length)return[];if(1===e.length||1===n)return[{...e[0],k:[...e[0].k],durationMs:25}];if(n===e.length)return e.map(e=>({...e,k:[...e.k],durationMs:25}));const s=[];for(let a=0;a<n;a++){const t=a/(n-1)*(e.length-1),o=Math.floor(t),r=t-o;if(o>=e.length-1){const t=e[e.length-1];s.push({...t,k:[...t.k],durationMs:25})}else s.push(Rf(e[o],e[o+1],r))}return s}function zf(e,t=.65){return e.length<=2?e.map(e=>({...e,k:[...e.k]})):Xf(e,e.length*t)}function Gf(e,t){return e.length<=1||1===t?e.map(e=>({...e,k:[...e.k]})):Xf(e,e.length*t)}function Hf(e){return e<=0?.8:e<=2?.9:e<=4?1:e<=6?1.15:1.3}function Wf(e,t){return e.length<=1?e:e.map((n,s)=>{const a=s/(e.length-1);let o=1;switch(t){case"vowel":case"diphthong":a<.2?o=.6+a/.2*.4:a>.75&&(o=.6+(1-a)/.25*.4);break;case"stop":o=a<.1?.8+a/.1*.2:1-.3*(a-.1);break;case"fricative":a<.3?o=.5+a/.3*.5:a>.75&&(o=.5+(1-a)/.25*.5);break;case"affricate":o=a<.15?.7+a/.15*.3:1-.25*(a-.15);break;case"nasal":case"liquid":case"glide":a<.25?o=.7+a/.25*.3:a>.8&&(o=.7+(1-a)/.2*.3)}const r=Math.max(1,Math.min(14,Math.round(n.energy*o)));return{...n,k:[...n.k],energy:r}})}function qf(e,t){return e.length<=2?e.map(e=>({...e,k:[...e.k]})):e.map((n,s)=>{if(n.unvoiced||0===n.pitch)return{...n,k:[...n.k]};const a=s/(e.length-1);let o=0;switch(t){case"vowel":case"diphthong":o=Math.round(1-2*a);break;case"nasal":case"liquid":a>.7&&(o=-1)}const r=Math.min(31,Math.max(1,n.pitch+o));return{...n,k:[...n.k],pitch:r}})}function Kf(e,t){const n=e.pClass,s=t.pClass;if("pause"===n||"pause"===s)return 0;if("stop"===n)return 0;if("stop"===s)return 1;if((e.frames.length>0&&!e.frames[e.frames.length-1].unvoiced)!==(t.frames.length>0&&!t.frames[0].unvoiced))return 1;const a=["vowel","diphthong","nasal","liquid","glide"];return a.includes(n)&&a.includes(s)?2:1}function $f(e,t){const n=new Map,s=Af[e.toUpperCase()];if(!s||"SKIP"===s.type||0===s.segments.length)return n;const a=function(e){const t=[];let n=[8,8,8,8,8,8,8,4,4,4],s=!1;for(const a of e)0!==a.energy?a.repeat?t.push({energy:a.energy,repeat:!1,pitch:a.pitch,k:[...n],unvoiced:s}):(n=[...a.k],s=a.unvoiced,t.push({...a,k:[...a.k]})):t.push({...a});return t}(t),o=function(e){let t=0;for(;t<e.length&&0===e[t].energy;)t++;let n=e.length-1;for(;n>=t&&0===e[n].energy;)n--;return e.slice(t,n+1)}(a);if(o.length<2)return n;switch(s.type){case"V":{const e=If(o);e.length>0&&n.set(s.segments[0],e);break}case"CV":{const e=Bf(o),t=o.slice(0,e),a=o.slice(e);if(t.length>0&&n.set(s.segments[0],t),a.length>0){const e=If(a);e.length>0&&n.set(s.segments[1],e)}break}case"VC":{const e=function(e){for(let t=e.length-1;t>=0;t--)if(!e[t].unvoiced&&e[t].energy>=6&&e[t].pitch>0)return t+1;return Math.floor(.7*e.length)}(o),t=o.slice(0,e),a=o.slice(e);if(t.length>0){const e=If(t);e.length>0&&n.set(s.segments[0],e)}a.length>0&&n.set(s.segments[1],a);break}case"CVC":{const e=Bf(o),t=o.slice(0,e),a=o.slice(e),r=Math.floor(a.length/2),i=a.slice(r);if(t.length>0&&n.set(s.segments[0],t),i.length>0){const e=If(i);e.length>0&&n.set(s.segments[1],e)}break}case"GV":{const e=Math.max(1,Math.floor(.3*o.length)),t=o.slice(0,e),a=o.slice(e);if(t.length>0&&n.set(s.segments[0],t),a.length>0){const e=If(a);e.length>0&&n.set(s.segments[1],e)}break}}return n}function Yf(e){return e.filter(e=>e.energy>0).map(e=>({k:e.k.length>=10?[...e.k]:[...e.k,...Array(10-e.k.length).fill(0)],energy:e.energy,pitch:e.pitch,unvoiced:e.unvoiced,durationMs:25}))}function Jf(e,t,n){const s=[];for(const a of e){const e=Lf(a.code),o=t.get(a.code);let r;if(o&&o.length>0)r=o.map(e=>({...e,k:[...e.k]})),r=zf(r);else{const t=n(a.code);if(!t)continue;r=jf(t,e)}const i=Hf(a.stress);1!==i&&(r=Gf(r,i)),a.stress>=4&&(r=r.map(e=>({...e,k:[...e.k],energy:Math.min(14,e.energy+2)}))),r=Wf(r,e),r=qf(r,e),s.push({code:a.code,pClass:e,frames:r})}return function(e){if(0===e.length)return[];const t=[];for(let n=0;n<e.length;n++){const s=e[n];if(0!==s.frames.length){for(const e of s.frames)t.push({...e,k:[...e.k]});if(n<e.length-1){const a=e[n+1];if(0===a.frames.length)continue;const o=Kf(s,a);if(0===o)continue;const r=s.frames[s.frames.length-1],i=a.frames[0];for(let e=0;e<o;e++){const n=Rf(r,i,(e+1)/(o+1));r.unvoiced!==i.unvoiced&&(n.energy=Math.max(1,Math.round(.6*n.energy))),t.push(n)}}}}return t}(s)}const Qf=0,Zf=1,eg=2,tg=3,ng=4,sg=5,ag=6,og=7,rg=8,ig=9,lg=10,cg=11,ug=12,dg=13,mg=14,pg=15,hg=16,fg=17;class gg extends Hr{name="TMS5220Synth";chipName="TMS5220";workletFile="TMS5220.worklet.js";processorName="tms5220-processor";_romData=null;_romWords=[];_romLoaded=!1;_romSentToWasm=!1;_romPhonemes=null;_speakingChain=null;_phonemeSpeechActive=!1;_phonemeSpeechTimer=null;_speechPitchIndex=32;_speechEnergyIndex=10;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth(),this._loadROMs()}async _loadROMs(){try{this._romData=await async function(){return ap(Ym)}();try{const e=await fetch(ms("/roms/snspell/tmc0271h-n2l"));if(!e.ok)throw new Error(`MCU ROM not found (${e.status})`);const t=await e.arrayBuffer();this._romWords=function(e,t){const n=t.length,s=[],a=Math.min(1024,n),o=[];let r=0;for(let l=0;l<a;l+=2){const e=t[l]|t[l+1]<<8,s=16384*(e>>14&3)+(16383&e);if(s>=n){if(r++,r>5)break;continue}const a=_f(t,8*s),i=a.length>0&&15===a[a.length-1].energy;if(a.length>=3||a.length>=1&&i)o.push({byteOffset:s,tableOffset:l}),r=0;else if(r++,o.length>20&&r>5)break}let i=0;if(o.length>15){const e=10;for(let r=0;r<=Math.min(10,o.length-e);r++){let t=!0;for(let n=r;n<r+e-1;n++)if(o[n+1].byteOffset<=o[n].byteOffset){t=!1;break}if(t){i=r;break}}const t=Math.min(i+15,o.length-1);let n=0,s=i;const a=[];for(let r=i;r<t;r++){const e=o[r+1].byteOffset-o[r].byteOffset;a.push(e),e>n&&(n=e,s=r+1)}if(a.length>3){const e=[...a].sort((e,t)=>e-t);n>3*e[Math.floor(e.length/2)]&&s>i&&(i=s)}}for(let l=i;l<o.length;l++){const e=l-i,n=e<Of.length?Of[e]:`Word ${e}`,a=8*o[l].byteOffset,r=_f(t,a);s.push({name:n,startBit:a,frames:r})}return s}(new Uint8Array(t),this._romData)}catch{this._romWords=function(e,t=256){const n=[],s=new Vf(e),a=8*e.length;let o=0;for(let r=0;r<e.length-4&&o<t;r++){const e=8*r;s.position=e;const t=[];let i=!0,l=0,c=0;for(;i&&l<200;){if(s.position>=a-10){i=!1;break}const e=Pf(s);if(null===e){if(l>=3)break;i=!1;break}if(t.push(e),l++,0===e.energy){if(c++,c>5){i=!1;break}}else c=0}i&&t.length>=3&&(n.some(t=>{const n=t.startBit+50*t.frames.length;return e>=t.startBit&&e<n})||(n.push({name:`Word ${o}`,startBit:e,frames:t}),o++,r=Math.floor(s.position/8)))}return n}(this._romData)}this._romWords.length>=26&&(this._romPhonemes=function(e){const t=new Map;for(let n=0;n<Math.min(26,e.length);n++){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[n],a=e[n];if(a.name.toUpperCase()!==s)continue;const o=$f(s,a.frames);for(const[e,n]of o){if(0===n.length)continue;const s=Yf(n);if(0===s.length)continue;const a=t.get(e);(!a||s.length>a.length)&&t.set(e,s)}}return t}(this._romWords.slice(0,26))),this._romLoaded=!0,this.romLoaded=!0;this._romWords.slice(0,10).map(e=>e.name);this._isReady&&this._sendROMToWasm()}catch{}}_sendROMToWasm(){if(!this._romData||!this.workletNode||this._romSentToWasm)return;const e=this._romData.buffer.slice(this._romData.byteOffset,this._romData.byteOffset+this._romData.byteLength);this.workletNode.port.postMessage({type:"loadROM",romData:e},[e]),this._romData=null,this._romSentToWasm=!0}handleWorkletMessage(e){super.handleWorkletMessage(e),"ready"===e.type&&this._romLoaded&&!this._romSentToWasm&&this._sendROMToWasm()}get romWords(){return this._romWords}get hasROM(){return this._romLoaded}speakWord(e){this.stopSpeaking(),this._playROMWordDirect(e)}_playROMWordDirect(e){if(!this._romLoaded||e<0||e>=this._romWords.length)return;if(!this._romSentToWasm||!this.workletNode||this._disposed)return;const t=this._romWords[e],n=Math.floor(t.startBit/8);this.workletNode.port.postMessage({type:"setVolume",value:1}),this.workletNode.port.postMessage({type:"speakAtByte",byteAddr:n})}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0){const t=Math.round(.5*(e-60));this.setParameterById(fg,t),this._speakSingleVowel()}else if(this._singMode){const t=Math.round(.5*(e-60));this.setParameterById(fg,t),this.isSpeaking||this.speakText(this._speechText)}else this.stopSpeaking(),this.speakText(this._speechText);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e){this.workletNode&&!this._disposed&&(e.length<10||(this.setParameterById(eg,e[0]),this.setParameterById(tg,e[1]),this.setParameterById(ng,e[2]),this.setParameterById(lg,e[3]),this.setParameterById(cg,e[4]),this.setParameterById(ug,e[5]),this.setParameterById(dg,e[6]),this.setParameterById(mg,e[7]),this.setParameterById(pg,e[8]),this.setParameterById(hg,e[9])))}setNoiseMode(e){this.workletNode&&!this._disposed&&this.setParameterById(og,e?1:0)}setChirpType(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChirpType",value:e})}setEnergy(e){this.setParameterById(sg,e)}setBrightness(e){this.setParameterById(ig,e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}speakText(e){this._isReady&&this.workletNode?this._romSentToWasm&&this._romWords.length>0?this.speakTextHybrid(e):this._speakPhonemeText(e):this._pendingCalls.push({method:"speakText",args:[e]})}stopSpeaking(){this._speakingChain=null,this._phonemeSpeechActive=!1,null!==this._phonemeSpeechTimer&&(clearTimeout(this._phonemeSpeechTimer),this._phonemeSpeechTimer=null),this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"stopSpeaking"})}get isSpeaking(){return this._phonemeSpeechActive||null!==this._speakingChain}speakLetter(e){const t=this._romWords.findIndex(t=>t.name===e.toUpperCase());t>=0&&this.speakWord(t)}spellText(e){this.stopSpeaking();const t=e.toUpperCase().split("").filter(e=>/[A-Z]/.test(e));if(0===t.length)return;let n=0;const s=()=>{if(n>=t.length||!this._speakingChain)return;const e=this._romWords.findIndex(e=>e.name===t[n]);if(n++,e>=0){this._playROMWordDirect(e);const t=25*this._romWords[e].frames.length+100;setTimeout(s,t)}else setTimeout(s,300)};this._speakingChain=s,s()}speakTextHybrid(e){this.stopSpeaking();const t=e.trim().split(/\s+/).filter(Boolean);if(0===t.length)return;let n=0;const s=()=>{if(n>=t.length||!this._speakingChain)return void(this._speakingChain=null);const e=t[n++];let a=-1;if(1===e.length&&/^[A-Za-z]$/.test(e)&&(a=this._romWords.findIndex((t,n)=>n<26&&t.name.toLowerCase()===e.toLowerCase())),a>=0){this._playROMWordDirect(a);const e=25*this._romWords[a].frames.length+200;setTimeout(s,e)}else this._speakPhonemeWord(e,()=>{setTimeout(s,200)})};this._speakingChain=s,s()}_packFrameBuffer(e){let t=0;for(const o of e){t+=Math.max(1,Math.round(o.durationMs/25))}t+=1;const n=new Uint8Array(12*t);let s=0;const a=[31,31,15,15,15,15,15,7,7,7];for(const o of e){const e=Math.max(1,Math.round(o.durationMs/25)),t=Math.min(Math.max(o.energy,1),14),r=o.unvoiced?0:Math.min(Math.max(o.pitch,0),31),i=o.k;for(let o=0;o<e;o++){n[s]=t,n[s+1]=r;for(let e=0;e<10;e++)n[s+2+e]=Math.min(Math.max(i[e]??0,0),a[e]);s+=12}}return n[s]=0,{data:n,numFrames:t}}_applySpeechParamsToFrames(e){const t=this._speechPitchIndex-32,n=this._speechEnergyIndex/10;return 0===t&&Math.abs(n-1)<.01?e:e.map(e=>{let s=e.pitch,a=e.energy;return 0!==t&&e.pitch>0&&(s=Math.max(1,Math.min(31,e.pitch+t))),Math.abs(n-1)>=.01&&e.energy>0&&e.energy<15&&(a=Math.max(1,Math.min(14,Math.round(e.energy*n)))),s===e.pitch&&a===e.energy?e:{...e,pitch:s,energy:a}})}_sendFrameBufferAndSpeak(e,t){if(!this.workletNode||this._disposed)return void t?.();const n=this._applySpeechParamsToFrames(e),{data:s,numFrames:a}=this._packFrameBuffer(n),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength);if(this.workletNode.port.postMessage({type:"loadFrameBuffer",frameData:o,numFrames:a},[o]),this.workletNode.port.postMessage({type:"speakFrameBuffer"}),this._phonemeSpeechActive=!0,t){const e=25*a+100;this._phonemeSpeechTimer=setTimeout(()=>{this._phonemeSpeechTimer=null,this._phonemeSpeechActive=!1,t()},e)}}_buildPhonemeFrames(e){return this._romPhonemes&&this._romPhonemes.size>0?Jf(e,this._romPhonemes,Cf):function(e){const t=[];for(const n of e){const e=Cf(n.code);if(e){const s=n.stress>=4?2:0;t.push({...e,energy:Math.min(14,e.energy+s)})}}return t}(e)}_speakPhonemeText(e){this.stopSpeaking();const t=Nh(e);if(!t)return;const n=wh(t),s=this._buildPhonemeFrames(n);0!==s.length&&this._sendFrameBufferAndSpeak(s,()=>{this._phonemeSpeechActive=!1})}_speakPhonemeWord(e,t){const n=Nh(e);if(!n)return void t();const s=wh(n),a=this._buildPhonemeFrames(s);0!==a.length?(this.workletNode&&this.workletNode.port.postMessage({type:"stopSpeaking"}),this._sendFrameBufferAndSpeak(a,t)):t()}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Qf,chirp_type:Zf,k1_index:eg,k2_index:tg,k3_index:ng,energy_index:sg,pitch_index:ag,noise_mode:og,stereo_width:rg,brightness:ig}[e];void 0!==n&&this.setParameterById(n,t),"pitch_index"===e&&(this._speechPitchIndex=t),"energy_index"===e&&(this._speechEnergyIndex=t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(){if(!this._isReady||!this.workletNode||this._disposed)return;const e=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const t=Cf(e);if(!t)return;this.stopSpeaking();const n=this._vowelLoopSingle?Array(40).fill(t):[t];this._sendFrameBufferAndSpeak(n,()=>{this._phonemeSpeechActive=!1})}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const bg=0,vg=1,yg=2,xg=3,Ng=4,wg=5,Eg=6,kg=7,Dg=8,Sg=9,Mg=10,Cg=11,Vg=12,Pg={BASS_1:36,SNARE_1:38,SNARE_2:40,LOW_TOM:41,MID_TOM:47,HI_TOM:50,RIMSHOT:37,COWBELL:56,HANDCLAP:39,TAMBOURINE:54,CLOSED_HIHAT:42,OPEN_HIHAT:46,CRASH:49,RIDE:51};class _g extends Hr{name="TR707Synth";chipName="TR707";workletFile="TR707.worklet.js";processorName="tr707-processor";constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(e=!1){if(e)try{return await ap($m)}catch{}return ap(Km)}(!1);await super.initialize(),this.loadCombinedROM(e);for(let t=0;t<10;t++)this.setParameterById(vg+t,.8);this.setParameterById(bg,.8),this.setParameterById(Cg,.5),this.setParameterById(Vg,.5),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"allNotesOff"})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}loadCombinedROM(e){this.loadROM(0,e)}loadROMs(e,t,n){this.loadROM(0,e),this.loadROM(65536,t),this.loadROM(98304,n)}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setVoiceLevel(e,t){this.setParameterById(vg+e,t)}setAccent(e){this.setParameterById(Cg,e)}setDecay(e){this.setParameterById(Vg,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:bg,bass:vg,snare:yg,low_tom:xg,mid_tom:Ng,hi_tom:wg,rimshot:Eg,handclap:kg,hihat:Dg,crash:Sg,ride:Mg,accent:Cg,decay:Vg}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Og=0,Tg=1,Lg=2,Ag=3,Bg=4,Ig=5,Fg=6,Ug=7;class Rg extends Hr{name="UPD931Synth";chipName="UPD931";workletFile="UPD931.worklet.js";processorName="upd931-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveA(e){this.setParameterById(Tg,e)}setWaveB(e){this.setParameterById(Lg,e)}setMirror(e){this.setParameterById(Ag,e?1:0)}setInvert(e){this.setParameterById(Bg,e?1:0)}setModeA(e){this.setParameterById(Ig,e)}setModeB(e){this.setParameterById(Fg,e)}setKeyScaling(e){this.setParameterById(Ug,e?1:0)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:Og,wave_a:Tg,wave_b:Lg,mirror:Ag,invert:Bg,mode_a:Ig,mode_b:Fg,key_scaling:Ug}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const jg=0,Xg=1,zg=2,Gg=3,Hg=4,Wg=5,qg=6,Kg=7,$g=8,Yg=9,Jg=10;class Qg extends Hr{name="UPD933Synth";chipName="UPD933";workletFile="UPD933.worklet.js";processorName="upd933-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",wave1:e,wave2:t})}setWindow(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWindow",value:e})}setDCWDepth(e){this.setParameterById(Hg,e)}setDCARate(e){this.setParameterById(Wg,e)}setDCWRate(e){this.setParameterById(qg,e)}setDCODepth(e){this.setParameterById($g,e)}setRingMod(e){this.setParameterById(Yg,e?1:0)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:jg,waveform1:Xg,waveform2:zg,window:Gg,dcw_depth:Hg,dca_rate:Wg,dcw_rate:qg,dco_rate:Kg,dco_depth:$g,ring_mod:Yg,stereo_width:Jg}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Zg=0,eb=1,tb=2,nb=3,sb=4,ab=5,ob=6,rb=7,ib=8,lb=9,cb=10,ub=11,db=12,mb=13,pb=14,hb=15,fb=16,gb=17,bb=18,vb=19,yb=20,xb=21,Nb=22,wb=23,Eb=24,kb=25,Db=26,Sb=27,Mb=28,Cb=29,Vb=30,Pb=31,_b=32,Ob=33,Tb=34,Lb=35,Ab=36,Bb=37,Ib=38,Fb=39,Ub=40,Rb=41,jb=42,Xb=43,zb=44,Gb=45,Hb=46,Wb=47,qb=48,Kb=49,$b=50,Yb=51,Jb=52,Qb=53,Zb=54,ev=55,tv=56,nv=57,sv=58,av=59,ov=60,rv=61,iv=62,lv=63,cv={[Zg]:59,[eb]:49,[tb]:39,[nb]:5,[sb]:21,[ab]:47,[ob]:39,[rb]:47,[ib]:49,[lb]:59,[cb]:49,[ub]:39,[db]:49,[mb]:49,[pb]:21,[hb]:41,[fb]:33,[gb]:47,[bb]:47,[vb]:53,[yb]:49,[xb]:39,[Nb]:47,[wb]:59,[Eb]:41,[kb]:23,[Db]:33,[Sb]:33,[Mb]:23,[Cb]:41,[Vb]:21,[Pb]:47,[_b]:53,[Ob]:59,[Tb]:33,[Lb]:59,[Ab]:53,[Bb]:21,[Ib]:53,[Fb]:49,[Ub]:53,[Rb]:41,[jb]:21,[Xb]:43,[zb]:53,[Gb]:33,[Hb]:53,[Wb]:39,[qb]:47,[Kb]:49,[$b]:39,[Yb]:53,[Jb]:47,[Qb]:39,[Zb]:53,[ev]:39,[tv]:41,[nv]:57,[sv]:53,[av]:53,[ov]:39,[rv]:59,[iv]:15,[lv]:5};function uv(e){return 2*(cv[e]??30)}function dv(e){return{IY:[{phone:zb,durationMs:uv(zb)}],IH:[{phone:Fb,durationMs:uv(Fb)}],EH:[{phone:av,durationMs:uv(av)}],AE:[{phone:Hb,durationMs:uv(Hb)}],AA:[{phone:_b,durationMs:uv(_b)}],AH:[{phone:Ab,durationMs:uv(Ab)}],AO:[{phone:Ib,durationMs:uv(Ib)}],UH:[{phone:Yb,durationMs:uv(Yb)}],AX:[{phone:xb,durationMs:uv(xb)}],IX:[{phone:ub,durationMs:uv(ub)}],ER:[{phone:sv,durationMs:uv(sv)}],UX:[{phone:Ub,durationMs:uv(Ub)}],OH:[{phone:Ib,durationMs:uv(Ib)}],EY:[{phone:av,durationMs:uv(av)},{phone:ub,durationMs:uv(ub)}],AY:[{phone:Ob,durationMs:uv(Ob)},{phone:ub,durationMs:uv(ub)}],OY:[{phone:Ib,durationMs:uv(Ib)},{phone:ub,durationMs:uv(ub)}],AW:[{phone:rv,durationMs:uv(rv)},{phone:ev,durationMs:uv(ev)}],OW:[{phone:Ib,durationMs:uv(Ib)},{phone:ev,durationMs:uv(ev)}],UW:[{phone:wb,durationMs:uv(wb)}],"R*":[{phone:Xb,durationMs:uv(Xb)}],RX:[{phone:Xb,durationMs:uv(Xb)}],"L*":[{phone:Eb,durationMs:uv(Eb)}],LX:[{phone:Eb,durationMs:uv(Eb)}],"W*":[{phone:Gb,durationMs:uv(Gb)}],WX:[{phone:Gb,durationMs:uv(Gb)}],WH:[{phone:Gb,durationMs:uv(Gb)}],"Y*":[{phone:Rb,durationMs:uv(Rb)}],YX:[{phone:Rb,durationMs:uv(Rb)}],"M*":[{phone:db,durationMs:uv(db)}],"N*":[{phone:mb,durationMs:uv(mb)}],NX:[{phone:yb,durationMs:uv(yb)}],"S*":[{phone:Pb,durationMs:uv(Pb)}],SH:[{phone:gb,durationMs:uv(gb)}],"F*":[{phone:Cb,durationMs:uv(Cb)}],TH:[{phone:nv,durationMs:uv(nv)}],"/H":[{phone:Sb,durationMs:uv(Sb)}],"/X":[{phone:Sb,durationMs:uv(Sb)}],"Z*":[{phone:bb,durationMs:uv(bb)}],ZH:[{phone:rb,durationMs:uv(rb)}],"V*":[{phone:hb,durationMs:uv(hb)}],DH:[{phone:tv,durationMs:uv(tv)}],CH:[{phone:fb,durationMs:uv(fb)}],"J*":[{phone:Db,durationMs:uv(Db)}],"B*":[{phone:pb,durationMs:uv(pb)}],"D*":[{phone:Vb,durationMs:uv(Vb)}],"G*":[{phone:Mb,durationMs:uv(Mb)}],GX:[{phone:Mb,durationMs:uv(Mb)}],"P*":[{phone:Bb,durationMs:uv(Bb)}],"T*":[{phone:jb,durationMs:uv(jb)}],"K*":[{phone:kb,durationMs:uv(kb)}],KX:[{phone:kb,durationMs:uv(kb)}],DX:[{phone:sb,durationMs:uv(sb)}],"Q*":[{phone:nb,durationMs:uv(nb)}]," ":[{phone:iv,durationMs:uv(iv)}]}[e]??null}const mv=0,pv=1,hv=2,fv=3,gv=4,bv=5,vv=6;class yv extends Hr{name="VotraxSynth";chipName="Votrax";workletFile="Votrax.worklet.js";processorName="votrax-processor";_speechSequencer=null;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0)this._speakSingleVowel(e,t);else if(this._singMode)if(this._speechSequencer){const t=440*Math.pow(2,(e-69)/12);this.writeFrequency(t)}else this._startSpeechAtNote(this._speechText,e,t);else this._startSpeechAtNote(this._speechText,60,t);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setPhoneme(e){this.sendMessage("setPhoneme",e)}setInflection(e){this.setParameterById(hv,e)}setF1Override(e){this.setParameterById(fv,e)}setF2Override(e){this.setParameterById(gv,e)}setF3Override(e){this.setParameterById(bv,e)}writePhone(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writePhone",value:e})}writeInflection(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeInflection",value:e})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}speakText(e){this._isReady&&this.workletNode?this._startSpeechAtNote(e,60,.8):this._pendingCalls.push({method:"speakText",args:[e]})}_startSpeechAtNote(e,t,n){if(!this._isReady||!this.workletNode||this._disposed)return;this.stopSpeaking();const s=Nh(e);if(!s)return;const a=function(e){const t=[];for(const n of e){const e=dv(n.code);e&&t.push(...e)}return t}(wh(s));if(0===a.length)return;const o=a.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:t,velocity:Math.floor(127*n)}),this._speechSequencer=new Sh(e=>this.writePhone(e.phone),()=>{this._speechSequencer=null,this.triggerRelease()}),this._speechSequencer.speak(o)}stopSpeaking(){const e=null!==this._speechSequencer;this._speechSequencer&&(this._speechSequencer.stop(),this._speechSequencer=null),e&&this.triggerRelease()}get isSpeaking(){return this._speechSequencer?.isSpeaking??!1}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:mv,phoneme:pv,inflection:hv,f1_override:fv,f2_override:gv,f3_override:bv,stereo_width:vv}[e];void 0!==n&&this.setParameterById(n,t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(e,t){if(!this._isReady||!this.workletNode||this._disposed)return;const n=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const s=dv(n);if(!s||0===s.length)return;this.stopSpeaking();const a=s.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)}),this._speechSequencer=new Sh(e=>this.writePhone(e.phone),()=>{this._vowelLoopSingle||(this._speechSequencer=null,this.triggerRelease())}),this._speechSequencer.speak(a,this._vowelLoopSingle)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const xv=0,Nv=1,wv=2,Ev=3,kv=4,Dv=5,Sv=6,Mv=7,Cv=8,Vv=9,Pv=10,_v=11,Ov=12,Tv=13,Lv=14,Av=15;class Bv extends Hr{name="YMF271Synth";chipName="YMF271";workletFile="YMF271.worklet.js";processorName="ymf271-processor";currentGroup=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),group:this.currentGroup})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,group:this.currentGroup})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=16384e3){let n=0,s=0;for(n=0;n<8&&(s=Math.round(1024*e*Math.pow(2,20-n)/t),!(s<1024));n++);return{block:Math.min(7,n),fnum:Math.max(0,Math.min(1023,s))}}(e);this.workletNode.port.postMessage({type:"setFrequency",block:t.block,fnum:t.fnum,group:this.currentGroup})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),n=Math.round(127*(1-e));for(const s of t)this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:s,param:"tl",value:n})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,group:this.currentGroup})}getCarrierOperators(){return{0:[3],1:[2,3],2:[2,3],3:[1,3],4:[1,3],5:[0,2,3],6:[0,2,3],7:[0,1,2,3]}[this.currentAlgorithm%8]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Nv,value:e/15})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:wv,value:e/7})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Lv,value:e/7})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Av,value:e/3})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d1r",value:t})}setOperatorD2R(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d2r",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"dt",value:t})}setOperatorWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"waveform",value:t})}setGroup(e){this.currentGroup=Math.max(0,Math.min(11,e))}setLFOFrequency(e){this.setParameterById(Ov,e/255)}setLFOWaveform(e){this.setParameterById(Tv,e/3)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={master_volume:xv,volume:xv,algorithm:Nv,feedback:wv,waveform:Ev,tl:kv,total_level:kv,ar:Dv,attack:Dv,d1r:Sv,decay1:Sv,d2r:Mv,decay2:Mv,rr:Cv,release:Cv,d1l:Vv,decay1_level:Vv,multiple:Pv,detune:_v,lfo_freq:Ov,lfo_wave:Tv,pms:Lv,ams:Av}[e];void 0!==n&&this.setParameterById(n,t)}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setWaveform(e){this.setParameterById(Ev,e/6)}setAttackRate(e){this.setParameterById(Dv,e/31)}setDecay1Rate(e){this.setParameterById(Sv,e/31)}setDecay2Rate(e){this.setParameterById(Mv,e/31)}setReleaseRate(e){this.setParameterById(Cv,e/15)}setTotalLevel(e){this.setParameterById(kv,e/127)}setMultiple(e){this.setParameterById(Pv,e/15)}setMasterVolume(e){this.setParameterById(xv,e)}}const Iv=0,Fv=1,Uv=2,Rv=3,jv=4,Xv=5,zv=6,Gv=10,Hv=11,Wv=12,qv=13,Kv=14,$v=15,Yv=16,Jv=17,Qv=18,Zv=19,ey=20;class ty extends Hr{name="YMOPQSynth";chipName="YMOPQ";workletFile="YMOPQ.worklet.js";processorName="ymopq-processor";currentChannel=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=Gr(e);this.workletNode.port.postMessage({type:"setFrequency",kc:t.kc,kf:t.kf,channel:this.currentChannel})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),n=Math.round(127*(1-e));for(const s of t)this.workletNode.port.postMessage({type:"setOperatorParam",channel:this.currentChannel,op:s,param:"tl",value:n})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,channel:this.currentChannel})}getCarrierOperators(){return{0:[3],1:[3],2:[3],3:[3],4:[1,3],5:[1,2,3],6:[1,2,3],7:[0,1,2,3]}[this.currentAlgorithm]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setAlgorithm",value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFeedback",value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(Rv,e/7)}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(jv,e/3)}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Gv,t/127)}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Hv,t/31)}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Wv,t/31)}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Kv,t/15)}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+$v,t/15)}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Yv,t/15)}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Jv,t/7)}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setLFORate(e){this.sendMessage("setLFORate",e)}setVolume(e){this.sendMessage("setVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n=e.match(/^op(\d+)_(.+)$/);if(n)return void this.setOperatorParamByName(parseInt(n[1]),n[2],t);const s={algorithm:Iv,feedback:Fv,lfo_rate:Uv,lfo_pm_sens:Rv,lfo_am_sens:jv,reverb:Xv,volume:zv}[e];void 0!==s&&this.setParameterById(s,t)}setOperatorParamByName(e,t,n){const s={total_level:Gv,attack_rate:Hv,decay_rate:Wv,sustain_rate:qv,sustain_level:Kv,release_rate:$v,multiple:Yv,detune:Jv,waveform:Qv,ksr:Zv,am_enable:ey}[t];void 0!==s&&e>=1&&e<=4&&this.setParameterById(100*e+s,n)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const ny=0,sy=1,ay=2,oy=3,ry=4,iy=5,ly=6,cy=7;class uy extends Hr{name="VASynthSynth";chipName="VASynth";workletFile="VASynth.worklet.js";processorName="vasynth-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e){return Math.max(20,Math.min(2e4,e))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setOsc1Wave(e){this.setParameterById(sy,e)}setOsc2Wave(e){this.setParameterById(ay,e)}setOscMix(e){this.setParameterById(oy,e)}setOsc2Detune(e){this.setParameterById(ry,e)}setFilterCutoff(e){this.setParameterById(iy,e)}setFilterResonance(e){this.setParameterById(ly,e)}setFilterEnvDepth(e){this.setParameterById(cy,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const n={volume:ny,osc1_wave:sy,osc2_wave:ay,osc_mix:oy,osc2_detune:ry,filter_cutoff:iy,filter_res:ly,filter_env_depth:cy}[e];void 0!==n&&this.setParameterById(n,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const dy=(e,t,...n)=>{const s=`(${t.toString()})(${n.map(e=>JSON.stringify(e)).join(", ")});`,a=URL.createObjectURL(new Blob([s],{type:"text/javascript"}));return e.addModule(a)},my=e=>{const t=globalThis;if(t.AudioWorkletProcessor&&t.webAudioModules)return;const n=new Map,s=new Map;class a{get apiVersion(){return e}getModuleScope(e){return n.has(e)||n.set(e,{}),n.get(e)}getGroup(e,t){const n=s.get(e);if(n.validate(t))return n;throw new Error("Invalid key")}addGroup(e){s.has(e.groupId)||s.set(e.groupId,e)}removeGroup(e){s.delete(e.groupId)}addWam(e){s.get(e.groupId)?.addWam(e)}removeWam(e){s.get(e.groupId)?.removeWam(e)}connectEvents(e,t,n,a=0){s.get(e)?.connectEvents(t,n,a)}disconnectEvents(e,t,n,a){s.get(e)?.disconnectEvents(t,n,a)}emitEvents(e,...t){s.get(e.groupId)?.emitEvents(e,...t)}}t.AudioWorkletProcessor&&(t.webAudioModules||(t.webAudioModules=new a))},py=(e,t)=>{const n=globalThis;class s{_groupId;_validate;_processors=new Map;_eventGraph=new Map;constructor(e,t){this._groupId=e,this._validate=e=>e===t}get groupId(){return this._groupId}get processors(){return this._processors}get eventGraph(){return this._eventGraph}validate(e){return this._validate(e)}addWam(e){this._processors.set(e.instanceId,e)}removeWam(e){this._eventGraph.has(e)&&this._eventGraph.delete(e),this._eventGraph.forEach(t=>{t.forEach(t=>{t&&t.delete(e)})}),this._processors.delete(e.instanceId)}connectEvents(e,t,n=0){const s=this._processors.get(e),a=this._processors.get(t);let o;if(this._eventGraph.has(s)?o=this._eventGraph.get(s):(o=[],this._eventGraph.set(s,o)),o[n])o[n].add(a);else{const e=new Set;e.add(a),o[n]=e}}disconnectEvents(e,t,n){const s=this._processors.get(e);if(!this._eventGraph.has(s))return;const a=this._eventGraph.get(s);if(void 0===t)return void a.forEach(e=>{e&&e.clear()});const o=this._processors.get(t);void 0!==n?a[n]&&o&&a[n].delete(o):a.forEach(e=>{e&&o&&e.delete(o)})}emitEvents(e,...t){this._eventGraph.has(e)&&this._eventGraph.get(e).forEach(e=>{e&&e.forEach(e=>e.scheduleEvents(...t))})}}n.AudioWorkletProcessor&&n.webAudioModules.addGroup(new s(e,t))};class hy{name="WAMSynth";output;_wamInstance=null;_wamNode=null;_config;_isInitialized=!1;_initPromise;_releaseTimers=new Set;_activeNotes=new Set;_audioContext;_pluginType="unknown";_inputGain=null;_activeOscillators=new Map;static _hostInitPromise=null;static initializeHost(e){if(hy._hostInitPromise)return hy._hostInitPromise;const t=`devilbox-host-${performance.now()}`,n=performance.now().toString();return hy._hostInitPromise=(async()=>(await dy(e.audioWorklet,my,"2.0.0-alpha.6"),await dy(e.audioWorklet,py,t,n),[t,n]))(),hy._hostInitPromise}constructor(e){this._audioContext=oo(),this.output=this._audioContext.createGain(),this.output.gain.value=1,this._config=e,this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}get pluginType(){return this._pluginType}get descriptor(){return this._wamInstance?.descriptor||null}async _initialize(){if(this._config.moduleUrl)try{const t=this._audioContext,[n]=await hy.initializeHost(t),{default:s}=await import(this._config.moduleUrl);if(!s||"function"!=typeof s)throw new Error("Invalid WAM: Default export is not a constructor or factory function");const a=/^class\s/.test(s.toString());if(a&&"function"==typeof s.createInstance)this._wamInstance=await s.createInstance(n,t);else if(a){const e=new s(n,t);"function"==typeof e.initialize&&await e.initialize(),this._wamInstance=e}else this._wamInstance=await s(t,n);if(this._wamInstance.audioNode?this._wamNode=this._wamInstance.audioNode:"function"==typeof this._wamInstance.createAudioNode&&(this._wamNode=await this._wamInstance.createAudioNode()),!this._wamNode)throw new Error("Failed to create WAM audio node");const o=this._wamInstance.descriptor;if(o)if(!0===o.isInstrument)this._pluginType="instrument";else if(!1===o.isInstrument)this._pluginType="effect";else{const e=o.keywords||[],t=e.includes("instrument")||e.includes("synth")||e.includes("synthesizer"),n=e.includes("effect")||e.includes("fx")||e.includes("audio-effect");if(t)this._pluginType="instrument";else if(n)this._pluginType="effect";else{const e=`${o.name||""} ${o.description||""}`.toLowerCase();/synth|instrument|piano|organ|drum/i.test(e)&&(this._pluginType="instrument")}}if("unknown"===this._pluginType&&this._config.moduleUrl){const{WAM_SYNTH_PLUGINS:e}=await os(async()=>{const{WAM_SYNTH_PLUGINS:e}=await Promise.resolve().then(()=>Ny);return{WAM_SYNTH_PLUGINS:e}},[]),t=e.find(e=>this._config.moduleUrl.includes(e.url)||e.url.includes(this._config.moduleUrl));t&&(this._pluginType="instrument"===t.type?"instrument":"effect"===t.type?"effect":"unknown")}if("unknown"===this._pluginType&&this._wamNode.numberOfInputs>0&&(this._pluginType="effect"),"effect"===this._pluginType?(this._inputGain=t.createGain(),this._inputGain.gain.value=1,this._inputGain.connect(this._wamNode),this._wamNode.connect(this.output)):this._wamNode.connect(this.output),this._config.pluginState&&this._wamInstance&&"function"==typeof this._wamInstance.setState)try{await this._wamInstance.setState(this._config.pluginState)}catch(e){this._config.pluginState=null}this._isInitialized=!0}catch(t){const e=t instanceof Error?t.message:String(t);let n;throw n=e.includes("Failed to fetch")||e.includes("NetworkError")||e.includes("net::ERR_")?`Network error loading WAM module. Check that the URL is correct and accessible: ${this._config.moduleUrl}`:e.includes("CORS")||e.includes("cross-origin")||e.includes("has been blocked")?`CORS policy blocked loading this WAM module. The server hosting the plugin must allow cross-origin requests. URL: ${this._config.moduleUrl}`:e.includes("not a valid JavaScript MIME type")||e.includes("SyntaxError")||e.includes("Unexpected token")?"Invalid module format. The URL does not point to a valid WAM 2.0 JavaScript module. Ensure the URL points to the plugin's index.js entry point.":`WAM initialization failed: ${e}`,new Error(n)}}_sendMidi(e,t){const n=new Uint8Array(e),s=this._wamNode;s&&"function"==typeof s.scheduleEvents?s.scheduleEvents({type:"wam-midi",data:{bytes:n},time:t}):this._wamInstance&&"function"==typeof this._wamInstance.onMidi?this._wamInstance.onMidi(e,t):s&&s.port&&s.port.postMessage({type:"wam-midi",data:{bytes:n},time:t})}_midiToFreq(e){return 440*Math.pow(2,(e-69)/12)}triggerAttack(e,t,n=1){if(!this._isInitialized||!this._wamInstance)return this;const s=po(e),a=Math.round(127*n),o=t??this._audioContext.currentTime;if(this._activeNotes.add(s),"effect"===this._pluginType&&this._inputGain){const e=this._activeOscillators.get(s);if(e){try{e.osc.stop()}catch{}e.gain.disconnect()}const t=this._audioContext.createOscillator(),a=this._audioContext.createGain();t.type="sawtooth",t.frequency.setValueAtTime(this._midiToFreq(s),o),a.gain.setValueAtTime(.3*n,o),t.connect(a),a.connect(this._inputGain),t.start(o),this._activeOscillators.set(s,{osc:t,gain:a})}else this._sendMidi([144,s,a],o);return this}_stopOscillator(e,t){const n=this._activeOscillators.get(e);if(n){n.gain.gain.setValueAtTime(n.gain.gain.value,t),n.gain.gain.linearRampToValueAtTime(0,t+.02);try{n.osc.stop(t+.03)}catch{}this._activeOscillators.delete(e)}}triggerRelease(e,t){if(!this._isInitialized||!this._wamInstance)return this;const n=t??this._audioContext.currentTime;if(void 0!==e){const t=po(e);this._activeNotes.delete(t),"effect"===this._pluginType?this._stopOscillator(t,n):this._sendMidi([128,t,0],n)}else{if("effect"===this._pluginType)for(const e of this._activeOscillators.keys())this._stopOscillator(e,n);else{for(const e of this._activeNotes)this._sendMidi([128,e,0],n);this._sendMidi([176,123,0],n)}this._activeNotes.clear()}return this}triggerAttackRelease(e,t,n,s=1){this.triggerAttack(e,n,s);const a=(n??this._audioContext.currentTime)+t,o=setTimeout(()=>{this._releaseTimers.delete(o),this._isInitialized&&this._wamInstance&&this.triggerRelease(e,a)},1e3*t);return this._releaseTimers.add(o),this}releaseAll(e){return this.triggerRelease(void 0,e)}async setPluginState(e){if(this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.setState)try{await this._wamInstance.setState(e),this._config.pluginState=e,this._config.pluginStateTimestamp=Date.now()}catch(t){}else this._config.pluginState=e}async getPluginState(){if(this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.getState){return{state:await this._wamInstance.getState(),timestamp:Date.now(),version:1}}return this._config.pluginState}async setParameter(e,t){if(this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.setParameterValues){const n="number"==typeof e?e.toString():e;await this._wamInstance.setParameterValues({[n]:{id:n,value:t}})}}async getParameters(){return this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.getParameterInfo?await this._wamInstance.getParameterInfo():{}}async createGui(){if(!this._isInitialized||!this._wamInstance)return null;const e=this._wamInstance;if("function"==typeof e.createGui)try{const t=await e.createGui();if(t)return t}catch(t){}if(this._config.moduleUrl){const t=this._config.moduleUrl.replace(/\/[^/]*$/,"/"),n=["gui.js","Gui/index.js","gui/index.js"];for(const s of n){const n=t+s;try{const t=await import(n);if("function"==typeof t.createElement){const n=await t.createElement(e);if(n)return n}}catch{}}}return null}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._activeNotes.clear();for(const[,e]of this._activeOscillators){try{e.osc.stop()}catch{}e.gain.disconnect()}this._activeOscillators.clear(),this._inputGain&&this._inputGain.disconnect(),this._wamNode&&this._wamNode.disconnect(),this._wamInstance&&"function"==typeof this._wamInstance.destroy&&this._wamInstance.destroy(),this.output.disconnect()}}class fy extends d{name="WAMEffect";input;output;dryGain;wetGain;_wamInstance=null;_wamNode=null;_moduleUrl;_audioContext;_initPromise;_isInitialized=!1;constructor(e){super(),this._moduleUrl=e.moduleUrl,this._audioContext=oo();const t=e.wet??1;this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-t),this.wetGain=new m(t),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}get isInitialized(){return this._isInitialized}async _initialize(){if(this._moduleUrl)try{const e=this._audioContext,[t]=await hy.initializeHost(e),{default:n}=await import(this._moduleUrl);if(!n||"function"!=typeof n)throw new Error("Invalid WAM: Default export is not a constructor or factory function");const s=/^class\s/.test(n.toString());if(s&&"function"==typeof n.createInstance)this._wamInstance=await n.createInstance(t,e);else if(s){const s=new n(t,e);"function"==typeof s.initialize&&await s.initialize(),this._wamInstance=s}else this._wamInstance=await n(e,t);if(this._wamInstance.audioNode?this._wamNode=this._wamInstance.audioNode:"function"==typeof this._wamInstance.createAudioNode&&(this._wamNode=await this._wamInstance.createAudioNode()),!this._wamNode)throw new Error("Failed to create WAM audio node");const a=this.input._gainNode,o=this.wetGain._gainNode,r=this.output._gainNode;a.connect(this._wamNode),this._wamNode.connect(o),o.connect(r),this._isInitialized=!0;this._wamInstance}catch(e){}}async createGui(){if(!this._wamInstance)return null;if("function"==typeof this._wamInstance.createGui)try{const e=await this._wamInstance.createGui();if(e)return e}catch{}if(this._moduleUrl){const e=this._moduleUrl.replace(/\/[^/]*$/,"/"),t=["gui.js","Gui/index.js","gui/index.js"];for(const n of t){const t=e+n;try{const e=await import(t);if("function"==typeof e.createElement){const t=await e.createElement(this._wamInstance);if(t)return t}}catch{}}}return null}async getParameters(){if(!this._wamInstance)return null;try{return"function"==typeof this._wamInstance.getParameterInfo?await this._wamInstance.getParameterInfo():null}catch{return null}}async setParameter(e,t){if(this._wamInstance&&this._wamNode)try{this._wamNode.setParameterValues&&await this._wamNode.setParameterValues({[e]:{value:t}})}catch{}}setWet(e){const t=Math.max(0,Math.min(1,e));this.wetGain.gain.value=t,this.dryGain.gain.value=1-t}get descriptor(){return this._wamInstance?.descriptor||null}dispose(){try{this._wamNode&&(this._wamNode.disconnect(),this._wamInstance&&"function"==typeof this._wamInstance.destroy&&this._wamInstance.destroy())}catch{}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose()}}const gy=Object.freeze(Object.defineProperty({__proto__:null,WAMEffectNode:fy},Symbol.toStringTag,{value:"Module"})),by="https://mainline.i3s.unice.fr/wam2/packages",vy=[{name:"OB-Xd",url:`${by}/obxd/index.js`,type:"instrument",category:"Synthesizer",description:"Oberheim OB-X virtual analog synth (WASM)"},{name:"Synth-101",url:`${by}/synth101/dist/index.js`,type:"instrument",category:"Synthesizer",description:"Roland SH-101 monophonic synthesizer"},{name:"TinySynth",url:`${by}/tinySynth/src/index.js`,type:"instrument",category:"Synthesizer",description:"GM-mapped multi-timbral synth"},{name:"Faust Flute",url:`${by}/faustFlute/index.js`,type:"instrument",category:"Synthesizer",description:"Physical modelling flute (Faust DSP)"},{name:"Big Muff",url:`${by}/BigMuff/index.js`,type:"effect",category:"Distortion",description:"Electro-Harmonix Big Muff Pi fuzz"},{name:"TS-9 Overdrive",url:`${by}/TS9_OverdriveFaustGenerated/index.js`,type:"effect",category:"Distortion",description:"Ibanez Tube Screamer overdrive (Faust)"},{name:"Disto Machine",url:`${by}/disto_machine/src/index.js`,type:"effect",category:"Amp Simulator",description:"Multi-mode distortion with cabinet sim"},{name:"QuadraFuzz",url:`${by}/quadrafuzz/dist/index.js`,type:"effect",category:"Distortion",description:"4-band multiband distortion/fuzz"},{name:"Vox Amp 30",url:`${by}/GuitarAmpSim60s/index.js`,type:"effect",category:"Amp Simulator",description:"1960s guitar amp simulator with cabinet"},{name:"Stone Phaser",url:`${by}/StonePhaserStereo/index.js`,type:"effect",category:"Modulation",description:"Stereo phaser effect (Faust DSP)"},{name:"Ping Pong Delay",url:`${by}/pingpongdelay/dist/index.js`,type:"effect",category:"Delay",description:"Stereo ping-pong delay"},{name:"Faust Delay",url:`${by}/faustPingPongDelay/plugin/index.js`,type:"effect",category:"Delay",description:"Ping-pong delay (Faust DSP)"},{name:"Csound Pitch Shifter",url:`${by}/csoundPitchShifter/dist/index.js`,type:"effect",category:"Pitch",description:"Pitch shifter powered by Csound"},{name:"Graphic Equalizer",url:`${by}/graphicEqualizer/src/index.js`,type:"effect",category:"EQ & Filter",description:"Multi-band graphic equalizer"},{name:"Pedalboard",url:`${by}/pedalboard/dist/index.js`,type:"effect",category:"Multi-FX",description:"Drag-and-drop guitar pedalboard"}],yy={WAMBigMuff:`${by}/BigMuff/index.js`,WAMTS9:`${by}/TS9_OverdriveFaustGenerated/index.js`,WAMDistoMachine:`${by}/disto_machine/src/index.js`,WAMQuadraFuzz:`${by}/quadrafuzz/dist/index.js`,WAMVoxAmp:`${by}/GuitarAmpSim60s/index.js`,WAMStonePhaser:`${by}/StonePhaserStereo/index.js`,WAMPingPongDelay:`${by}/pingpongdelay/dist/index.js`,WAMFaustDelay:`${by}/faustPingPongDelay/plugin/index.js`,WAMPitchShifter:`${by}/csoundPitchShifter/dist/index.js`,WAMGraphicEQ:`${by}/graphicEqualizer/src/index.js`,WAMPedalboard:`${by}/pedalboard/dist/index.js`},xy={WAMOBXd:`${by}/obxd/index.js`,WAMSynth101:`${by}/synth101/dist/index.js`,WAMTinySynth:`${by}/tinySynth/src/index.js`,WAMFaustFlute:`${by}/faustFlute/index.js`},Ny=Object.freeze(Object.defineProperty({__proto__:null,WAM_EFFECT_URLS:yy,WAM_SYNTH_PLUGINS:vy,WAM_SYNTH_URLS:xy},Symbol.toStringTag,{value:"Module"})),wy=new Map,Ey=new WeakMap;class ky{name;output;_worklet=null;_descriptor;_isReady=!1;_initPromise;_params=[];_paramValues=new Map;_pendingNotes=[];constructor(e,t){this._descriptor=e,this.name=`VSTBridge:${e.id}`;const n=oo();if(this.output=n.createGain(),e.volumeOffsetDb){const t=Math.pow(10,e.volumeOffsetDb/20);this.output.gain.value=t}this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}getParams(){return this._params}getDescriptor(){return this._descriptor}async _initialize(){try{const e=oo(),{wasmBinary:t,jsCode:n}=await async function(e,t){const n="/";if(!Ey.get(e)){try{await e.audioWorklet.addModule(`${n}vstbridge/VSTBridge.worklet.js`)}catch{}Ey.set(e,!0)}const s=t.id;if(!wy.has(s)){const e=(async()=>{const e=`${n}${t.wasmDir}/${t.wasmFile}.wasm`,s=`${n}${t.wasmDir}/${t.wasmFile}.js`,[a,o]=await Promise.all([fetch(e),fetch(s)]);if(!a.ok)throw new Error(`Failed to load ${e}: ${a.status}`);if(!o.ok)throw new Error(`Failed to load ${s}: ${o.status}`);const[r,i]=await Promise.all([a.arrayBuffer(),o.text()]);return{wasmBinary:r,jsCode:Tr(i,`${n}${t.wasmDir}/`)}})();wy.set(s,e)}return wy.get(s)}(e,this._descriptor),{workletNode:s,readyPromise:a}=function(e,t,n,s,a){const o=new AudioWorkletNode(e,"vstbridge-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate,synthClassName:t.synthClassName,moduleFactoryName:t.moduleFactoryName}}),r=new Promise((e,n)=>{const s=setTimeout(()=>n(new Error(`VSTBridge ${t.id} init timeout`)),1e4),a=o.port.onmessage;o.port.onmessage=r=>{"ready"===r.data.type?(clearTimeout(s),e()):"error"===r.data.type&&(clearTimeout(s),n(new Error(r.data.error||`VSTBridge ${t.id} init error`))),a&&a.call(o.port,r)}});o.port.postMessage({type:"init",wasmBinary:n,jsCode:s,sampleRate:e.sampleRate}),o.connect(a);try{const t=e.createGain();t.gain.value=0,o.connect(t),t.connect(e.destination)}catch{}return{workletNode:o,readyPromise:r}}(e,this._descriptor,t,n,this.output);this._worklet=s;const o=s.port.onmessage;s.port.onmessage=e=>{if("params"===e.data.type){this._params=e.data.params;for(const e of this._params)this._paramValues.has(e.id)||this._paramValues.set(e.id,e.defaultValue)}o&&o.call(s.port,e)},await a,this._isReady=!0,this._worklet.port.postMessage({type:"getParams"});for(const{note:r,velocity:i}of this._pendingNotes)this._worklet.port.postMessage({type:"noteOn",note:r,velocity:i});this._pendingNotes=[]}catch(e){}}triggerAttack(e,t,n=1){const s=po(e),a=Math.round(127*n);return this._worklet&&this._isReady?this._worklet.port.postMessage({type:"noteOn",note:s,velocity:a}):this._pendingNotes.push({note:s,velocity:a}),this}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=po(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}triggerAttackRelease(e,t,n,s=1){return this.triggerAttack(e,n,s),setTimeout(()=>this.triggerRelease(e),1e3*t),this}set(e,t){if(!this._worklet)return;let n;if(/^\d+$/.test(e))n=parseInt(e,10);else{const t=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!t)return;n=t.id}this._paramValues.set(n,t),this._worklet.port.postMessage({type:"parameter",paramId:n,value:t})}get(e){let t;if(/^\d+$/.test(e))t=parseInt(e,10);else{const n=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!n)return;t=n.id}return this._paramValues.get(t)}setParameter(e,t){this._worklet&&(this._paramValues.set(e,t),this._worklet.port.postMessage({type:"parameter",paramId:e,value:t}))}getParameter(e){return this._paramValues.get(e)}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}programChange(e){this._worklet?.port.postMessage({type:"programChange",program:e})}async sendCommand(e,t){return!(!this._worklet||!this._isReady)&&new Promise(n=>{const s=setTimeout(()=>n(!1),2e3),a=t=>{"commandResult"===t.data.type&&t.data.commandType===e&&(clearTimeout(s),this._worklet?.port.removeEventListener("message",a),n(t.data.handled))};this._worklet.port.addEventListener("message",a),this._worklet.port.postMessage({type:"command",commandType:e,data:t?Array.from(t):[]})})}setVolumeOffset(e){const t=Math.pow(10,e/20);this.output.gain.value=t}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Dy=new Map;function Sy(e){Dy.set(e.id,e)}Sy({id:"DexedBridge",name:"Dexed DX7 (Bridge)",wasmDir:"dexed",wasmFile:"Dexed",synthClassName:"DexedSynth",moduleFactoryName:"createDexedModule",volumeOffsetDb:41,commands:["loadSysEx","loadPatch"]}),Sy({id:"Vital",name:"Vital (Wavetable)",wasmDir:"vital",wasmFile:"Vital",synthClassName:"VitalSynth",moduleFactoryName:"createVitalModule",volumeOffsetDb:0,panelComponent:"VitalControls",commands:["loadWavetable","loadPreset"]}),Sy({id:"Odin2",name:"Odin2 (Hybrid)",wasmDir:"odin2",wasmFile:"Odin2",synthClassName:"Odin2Synth",moduleFactoryName:"createOdin2Module",volumeOffsetDb:0,panelComponent:"Odin2Controls",commands:["loadPatch"]}),Sy({id:"Surge",name:"Surge XT (Hybrid)",wasmDir:"surge",wasmFile:"Surge",synthClassName:"SurgeSynth",moduleFactoryName:"createSurgeModule",volumeOffsetDb:0,panelComponent:"SurgeControls",commands:["loadPatch","loadWavetable"]}),Sy({id:"TonewheelOrgan",name:"Tonewheel Organ",wasmDir:"tonewheel",wasmFile:"Tonewheel",synthClassName:"TonewheelOrganSynth",moduleFactoryName:"createTonewheelModule",volumeOffsetDb:0}),Sy({id:"Melodica",name:"Melodica",wasmDir:"melodica",wasmFile:"Melodica",synthClassName:"MelodicaWASMSynth",moduleFactoryName:"createMelodicaModule",volumeOffsetDb:0}),Sy({id:"Monique",name:"Monique (Monosynth)",wasmDir:"monique",wasmFile:"Monique",synthClassName:"MoniqueSynth",moduleFactoryName:"createMoniqueModule",volumeOffsetDb:0}),Sy({id:"Helm",name:"Helm (Poly)",wasmDir:"helm",wasmFile:"Helm",synthClassName:"HelmSynth",moduleFactoryName:"createHelmModule",volumeOffsetDb:0}),Sy({id:"Sorcer",name:"Sorcer (Wavetable)",wasmDir:"sorcer",wasmFile:"Sorcer",synthClassName:"SorcerSynth",moduleFactoryName:"createSorcerModule",volumeOffsetDb:0}),Sy({id:"Amsynth",name:"amsynth (Analog)",wasmDir:"amsynth",wasmFile:"Amsynth",synthClassName:"AmsynthSynth",moduleFactoryName:"createAmsynthModule",volumeOffsetDb:0}),Sy({id:"OBXf",name:"OB-Xf (Analog)",wasmDir:"obxf",wasmFile:"OBXf",synthClassName:"OBXfSynth",moduleFactoryName:"createOBXfModule",volumeOffsetDb:0}),Sy({id:"OBXd",name:"OB-Xd (Analog)",wasmDir:"obxd",wasmFile:"OBXd",synthClassName:"OBXdSynth",moduleFactoryName:"createOBXdModule",volumeOffsetDb:0});const My=new class{modules=new Map;register(e){this.modules.has(e.id)||this.modules.set(e.id,e)}get(e){return this.modules.get(e)}getAll(){return Array.from(this.modules.values())}getByCategory(e){return this.getAll().filter(t=>t.category===e)}has(e){return this.modules.has(e)}clear(){this.modules.clear()}};class Cy{isActive=!1;ctx;modules=new Map;sharedModules;voiceOutput;_currentNote=null;constructor(e,t,n,s=new Map){this.ctx=e,this.voiceOutput=e.createGain(),this.voiceOutput.connect(n),this.sharedModules=s,t.forEach(e=>{this.createModule(e)})}createModule(e){const t=My.get(e.descriptorId);if(t&&"per-voice"===t.voiceMode){const n=t.create(this.ctx);if(Object.entries(e.parameters).forEach(([e,t])=>{n.setParam(e,t)}),this.modules.set(e.id,n),"Output"===t.id){const e=n.ports.get("output");e?.node&&e.node.connect(this.voiceOutput)}}}noteOn(e,t,n){this.isActive=!0,this._currentNote=e;const s=ho(e);this.modules.forEach(e=>{const a=My.get(e.descriptorId);e.gateOn&&e.gateOn(t,n),"source"===a?.category&&e.setParam&&e.setParam("frequency",s)})}noteOff(e){this.modules.forEach(t=>{t.gateOff&&t.gateOff(e)}),setTimeout(()=>{this.isActive=!1,this._currentNote=null},2e3)}setParameter(e,t,n){const s=this.modules.get(e);s&&s.setParam(t,n)}addModule(e){this.createModule(e)}removeModule(e){const t=this.modules.get(e);t&&(t.dispose(),this.modules.delete(e))}getModule(e){const t=this.modules.get(e);return t||this.sharedModules.get(e)}getOutput(){return this.voiceOutput}getCurrentNote(){return this._currentNote}dispose(){this.modules.forEach(e=>e.dispose()),this.modules.clear(),this.voiceOutput.disconnect()}}class Vy{constructor(){}buildConnections(e,t){const n=this.topologicalSort(t);e.forEach(e=>{n.forEach(t=>{this.createConnection(e,t)})})}createConnection(e,t){const n=e.getModule(t.source.moduleId),s=e.getModule(t.target.moduleId);if(!n||!s)return;const a=n.ports.get(t.source.portId),o=s.ports.get(t.target.portId);a&&o&&this.areTypesCompatible(a.signal,o.signal)&&("audio"===a.signal&&"audio"===o.signal?a.node&&o.node&&a.node.connect(o.node):a.node&&o.param&&o.scaleNode&&(a.node.connect(o.scaleNode),o.scaleNode.connect(o.param)))}areTypesCompatible(e,t){return"audio"===e?"audio"===t:"cv"===t||("gate"===e&&"gate"===t||"trigger"===e&&"trigger"===t)}topologicalSort(e){if(0===e.length)return[];const t=new Set,n=new Map,s=new Map;for(const i of e){const e=i.source.moduleId,a=i.target.moduleId;t.add(e),t.add(a),n.has(e)||n.set(e,[]),n.get(e).push(a),s.set(a,(s.get(a)??0)+1)}const a=[];for(const i of t)0===(s.get(i)??0)&&a.push(i);const o=[];for(;a.length>0;){const e=a.shift();o.push(e);for(const t of n.get(e)??[]){const e=(s.get(t)??1)-1;s.set(t,e),0===e&&a.push(t)}}if(o.length<t.size)return[...e];const r=new Map(o.map((e,t)=>[e,t]));return[...e].sort((e,t)=>(r.get(e.source.moduleId)??0)-(r.get(t.source.moduleId)??0))}detectAudioCycles(e){const t=new Map;for(const o of e){const e=o.source.moduleId,n=o.target.moduleId;t.has(e)||t.set(e,[]),t.get(e).push(n)}const n=new Set,s=new Set;function a(e){if(s.has(e))return!0;if(n.has(e))return!1;n.add(e),s.add(e);for(const n of t.get(e)??[])if(a(n))return!0;return s.delete(e),!1}for(const o of t.keys())if(!n.has(o)&&a(o))return!0;return!1}disconnectConnection(e,t){const n=e.getModule(t.source.moduleId),s=e.getModule(t.target.moduleId);if(!n||!s)return;const a=n.ports.get(t.source.portId),o=s.ports.get(t.target.portId);if(a&&o){if(a.node&&o.node)try{a.node.disconnect(o.node)}catch(r){}if(a.node&&o.scaleNode)try{a.node.disconnect(o.scaleNode)}catch(r){}}}}class Py{graphBuilder=null;currentConnections=[];updateConnections(e,t){!this.graphBuilder&&e.length>0&&(this.graphBuilder=new Vy),this.graphBuilder&&(this.currentConnections.forEach(t=>{e.forEach(e=>{this.graphBuilder.disconnectConnection(e,t)})}),this.graphBuilder.buildConnections(e,t),this.currentConnections=[...t])}addConnection(e,t){const n=[...this.currentConnections,t];this.updateConnections(e,n)}removeConnection(e,t){const n=this.currentConnections.filter(e=>e.id!==t);this.updateConnections(e,n)}clear(e){this.updateConnections(e,[])}}const _y={id:"VCO",name:"VCO (Oscillator)",category:"source",voiceMode:"per-voice",color:"#3b82f6",ports:[{id:"pitch",name:"Pitch",direction:"input",signal:"cv"},{id:"pwm",name:"PWM",direction:"input",signal:"cv"},{id:"fm",name:"FM",direction:"input",signal:"cv"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"waveform",name:"Waveform",min:0,max:3,default:0},{id:"detune",name:"Detune",min:-100,max:100,default:0},{id:"octave",name:"Octave",min:-2,max:2,default:0},{id:"pulseWidth",name:"Pulse Width",min:0,max:1,default:.5}],create:e=>{const t=e.createOscillator(),n=e.createConstantSource(),s=e.createGain();t.type="sawtooth",t.frequency.value=440,n.offset.value=440,n.start(),t.start(),n.connect(t.frequency),t.connect(s);const a=new Map([["pitch",{id:"pitch",name:"Pitch",direction:"input",signal:"cv",param:n.offset}],["pwm",{id:"pwm",name:"PWM",direction:"input",signal:"cv"}],["fm",{id:"fm",name:"FM",direction:"input",signal:"cv",param:t.frequency}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:s}]]);let o=0,r=0,i=0,l=.5,c=null;function u(n){const s=new Float32Array(128),a=new Float32Array(128);for(let e=1;e<128;e++)a[e]=2/(e*Math.PI)*Math.sin(e*Math.PI*n);c=e.createPeriodicWave(s,a,{disableNormalization:!1}),t.setPeriodicWave(c)}return{descriptorId:"VCO",ports:a,setParam:(e,s)=>{switch(e){case"waveform":if(o=Math.floor(s),2===o)u(l);else{const e=["sine","sawtooth","square","triangle"];t.type=e[o]||"sawtooth"}break;case"detune":r=s,t.detune.value=s;break;case"octave":i=Math.floor(s);break;case"pulseWidth":l=Math.max(.01,Math.min(.99,s)),2===o&&u(l);break;case"frequency":const e=s*Math.pow(2,i);n.offset.value=e}},getParam:e=>{switch(e){case"waveform":return o;case"detune":return r;case"octave":return i;case"pulseWidth":return l;default:return 0}},dispose:()=>{t.stop(),t.disconnect(),n.stop(),n.disconnect(),s.disconnect()}}}};const Oy={id:"Noise",name:"Noise",category:"source",voiceMode:"shared",color:"#6b7280",ports:[{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"type",name:"Type",min:0,max:2,default:0}],create:e=>{const t=2*e.sampleRate,n=[0,1,2].map(n=>{const s=e.createBuffer(1,t,e.sampleRate),a=0===n?function(e){const t=new Float32Array(e);for(let n=0;n<e;n++)t[n]=2*Math.random()-1;return t}(t):1===n?function(e){const t=new Float32Array(e);let n=0,s=0,a=0,o=0,r=0,i=0,l=0;for(let c=0;c<e;c++){const e=2*Math.random()-1;n=.99886*n+.0555179*e,s=.99332*s+.0750759*e,a=.969*a+.153852*e,o=.8665*o+.3104856*e,r=.55*r+.5329522*e,i=-.7616*i-.016898*e,t[c]=(n+s+a+o+r+i+l+.5362*e)/9,l=.115926*e}return t}(t):function(e){const t=new Float32Array(e);let n=0;for(let s=0;s<e;s++)n=(n+.02*(2*Math.random()-1))/1.02,t[s]=3.5*n;return t}(t);return s.copyToChannel(a,0),s}),s=e.createGain();s.gain.value=.3;let a=0,o=null;function r(t){if(o){try{o.stop()}catch{}o.disconnect()}const a=e.createBufferSource();a.buffer=n[t],a.loop=!0,a.connect(s),a.start(),o=a}r(0);return{descriptorId:"Noise",ports:new Map([["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:s}]]),setParam:(e,t)=>{if("type"===e){const e=Math.max(0,Math.min(2,Math.floor(t)));e!==a&&(a=e,r(a))}},getParam:e=>"type"===e?a:0,dispose:()=>{if(o){try{o.stop()}catch{}o.disconnect()}s.disconnect()}}}},Ty={id:"VCF",name:"VCF (Filter)",category:"filter",voiceMode:"per-voice",color:"#f59e0b",ports:[{id:"input",name:"Input",direction:"input",signal:"audio"},{id:"cutoff",name:"Cutoff",direction:"input",signal:"cv"},{id:"resonance",name:"Resonance",direction:"input",signal:"cv"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"type",name:"Type",min:0,max:3,default:0},{id:"cutoff",name:"Cutoff",min:20,max:2e4,default:1e3,curve:"exponential"},{id:"resonance",name:"Resonance",min:0,max:30,default:1},{id:"keyTracking",name:"Key Tracking",min:0,max:1,default:0}],create:e=>{const t=e.createBiquadFilter(),n=e.createGain(),s=e.createGain();t.type="lowpass",t.frequency.value=1e3,t.Q.value=1,n.gain.value=100,s.gain.value=1;const a=new Map([["input",{id:"input",name:"Input",direction:"input",signal:"audio",node:t}],["cutoff",{id:"cutoff",name:"Cutoff",direction:"input",signal:"cv",param:t.frequency,scaleNode:n}],["resonance",{id:"resonance",name:"Resonance",direction:"input",signal:"cv",param:t.Q,scaleNode:s}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:t}]]);let o=0,r=0;return{descriptorId:"VCF",ports:a,setParam:(e,n)=>{switch(e){case"type":o=Math.floor(n);const e=["lowpass","highpass","bandpass","notch"];t.type=e[o]||"lowpass";break;case"cutoff":t.frequency.value=n;break;case"resonance":t.Q.value=n;break;case"keyTracking":r=n}},getParam:e=>{switch(e){case"type":return o;case"cutoff":return t.frequency.value;case"resonance":return t.Q.value;case"keyTracking":return r;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect(),s.disconnect()}}}},Ly={id:"VCA",name:"VCA (Amplifier)",category:"amplifier",voiceMode:"per-voice",color:"#10b981",ports:[{id:"input",name:"Input",direction:"input",signal:"audio"},{id:"cv",name:"CV",direction:"input",signal:"cv"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"gain",name:"Gain",min:0,max:2,default:1},{id:"bias",name:"Bias",min:0,max:1,default:0}],create:e=>{const t=e.createGain(),n=e.createGain();t.gain.value=0,n.gain.value=1;const s=new Map([["input",{id:"input",name:"Input",direction:"input",signal:"audio",node:t}],["cv",{id:"cv",name:"CV",direction:"input",signal:"cv",param:t.gain,scaleNode:n}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:t}]]);let a=1,o=0;return{descriptorId:"VCA",ports:s,setParam:(e,s)=>{switch(e){case"gain":a=s,n.gain.value=s;break;case"bias":o=s,t.gain.value=Math.max(t.gain.value,s)}},getParam:e=>{switch(e){case"gain":return a;case"bias":return o;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect()}}}},Ay={id:"LFO",name:"LFO",category:"modulator",voiceMode:"shared",color:"#ec4899",ports:[{id:"rate",name:"Rate",direction:"input",signal:"cv"},{id:"sync",name:"Sync",direction:"input",signal:"trigger"},{id:"output",name:"Output",direction:"output",signal:"cv"}],parameters:[{id:"waveform",name:"Waveform",min:0,max:3,default:0},{id:"rate",name:"Rate",min:.01,max:20,default:1,curve:"exponential"},{id:"depth",name:"Depth",min:0,max:1,default:.5},{id:"bipolar",name:"Bipolar",min:0,max:1,default:1}],create:e=>{const t=e.createOscillator(),n=e.createGain(),s=e.createConstantSource(),a=e.createGain(),o=e.createGain();t.type="sine",t.frequency.value=1,n.gain.value=.5,s.offset.value=1,a.gain.value=0,o.gain.value=1,s.start(),t.start(),t.connect(n),n.connect(o),s.connect(a),a.connect(o);const r=new Map([["rate",{id:"rate",name:"Rate",direction:"input",signal:"cv",param:t.frequency}],["sync",{id:"sync",name:"Sync",direction:"input",signal:"trigger"}],["output",{id:"output",name:"Output",direction:"output",signal:"cv",node:o}]]);let i=0,l=1,c=.5;function u(){l?(n.gain.value=c,a.gain.value=0):(n.gain.value=.5*c,a.gain.value=.5*c)}return{descriptorId:"LFO",ports:r,setParam:(e,n)=>{switch(e){case"waveform":i=Math.floor(n);const e=["sine","sawtooth","square","triangle"];t.type=e[i]||"sine";break;case"rate":t.frequency.value=n;break;case"depth":c=n,u();break;case"bipolar":l=n>=.5?1:0,u()}},getParam:e=>{switch(e){case"waveform":return i;case"rate":return t.frequency.value;case"depth":return c;case"bipolar":return l;default:return 0}},dispose:()=>{t.stop(),t.disconnect(),n.disconnect(),s.stop(),s.disconnect(),a.disconnect(),o.disconnect()}}}},By={id:"ADSR",name:"ADSR (Envelope)",category:"envelope",voiceMode:"per-voice",color:"#8b5cf6",ports:[{id:"gate",name:"Gate",direction:"input",signal:"gate"},{id:"retrigger",name:"Retrigger",direction:"input",signal:"trigger"},{id:"output",name:"Output",direction:"output",signal:"cv"}],parameters:[{id:"attack",name:"Attack",min:.001,max:2,default:.01,curve:"exponential"},{id:"decay",name:"Decay",min:.001,max:2,default:.1,curve:"exponential"},{id:"sustain",name:"Sustain",min:0,max:1,default:.7},{id:"release",name:"Release",min:.001,max:5,default:.3,curve:"exponential"}],create:e=>{const t=e.createConstantSource();t.offset.value=0,t.start();let n=.01,s=.1,a=.7,o=.3;return{descriptorId:"ADSR",ports:new Map([["gate",{id:"gate",name:"Gate",direction:"input",signal:"gate"}],["retrigger",{id:"retrigger",name:"Retrigger",direction:"input",signal:"trigger"}],["output",{id:"output",name:"Output",direction:"output",signal:"cv",node:t}]]),setParam:(e,t)=>{switch(e){case"attack":n=t;break;case"decay":s=t;break;case"sustain":a=t;break;case"release":o=t}},getParam:e=>{switch(e){case"attack":return n;case"decay":return s;case"sustain":return a;case"release":return o;default:return 0}},gateOn:(o,r)=>{const i=t.offset,l=o||e.currentTime;i.cancelScheduledValues(l),i.setValueAtTime(i.value,l),i.linearRampToValueAtTime(r,l+n),i.linearRampToValueAtTime(a*r,l+n+s)},gateOff:n=>{const s=t.offset,a=n||e.currentTime;s.cancelScheduledValues(a),s.setValueAtTime(s.value,a),s.linearRampToValueAtTime(0,a+o)},dispose:()=>{t.stop(),t.disconnect()}}}},Iy={id:"Mixer",name:"Mixer",category:"utility",voiceMode:"per-voice",color:"#14b8a6",ports:[{id:"in1",name:"Input 1",direction:"input",signal:"audio"},{id:"in2",name:"Input 2",direction:"input",signal:"audio"},{id:"in3",name:"Input 3",direction:"input",signal:"audio"},{id:"in4",name:"Input 4",direction:"input",signal:"audio"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"level1",name:"Level 1",min:0,max:1,default:1},{id:"level2",name:"Level 2",min:0,max:1,default:1},{id:"level3",name:"Level 3",min:0,max:1,default:1},{id:"level4",name:"Level 4",min:0,max:1,default:1}],create:e=>{const t=e.createGain(),n=[];for(let s=0;s<4;s++){const s=e.createGain();s.gain.value=1,s.connect(t),n.push(s)}return{descriptorId:"Mixer",ports:new Map([["in1",{id:"in1",name:"Input 1",direction:"input",signal:"audio",node:n[0]}],["in2",{id:"in2",name:"Input 2",direction:"input",signal:"audio",node:n[1]}],["in3",{id:"in3",name:"Input 3",direction:"input",signal:"audio",node:n[2]}],["in4",{id:"in4",name:"Input 4",direction:"input",signal:"audio",node:n[3]}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:t}]]),setParam:(e,t)=>{const s=e.match(/level(\d+)/);if(s){const e=parseInt(s[1],10)-1;e>=0&&e<4&&(n[e].gain.value=t)}},getParam:e=>{const t=e.match(/level(\d+)/);if(t){const e=parseInt(t[1],10)-1;if(e>=0&&e<4)return n[e].gain.value}return 0},dispose:()=>{n.forEach(e=>e.disconnect()),t.disconnect()}}}},Fy={id:"Delay",name:"Delay",category:"utility",voiceMode:"shared",color:"#06b6d4",ports:[{id:"input",name:"Input",direction:"input",signal:"audio"},{id:"time",name:"Time",direction:"input",signal:"cv"},{id:"feedback",name:"Feedback",direction:"input",signal:"cv"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"time",name:"Time",min:.001,max:2,default:.25,curve:"linear"},{id:"feedback",name:"Feedback",min:0,max:.95,default:.3},{id:"mix",name:"Mix",min:0,max:1,default:.5}],create:e=>{const t=e.createDelay(2),n=e.createGain(),s=e.createGain(),a=e.createGain(),o=e.createGain();t.delayTime.value=.25,n.gain.value=.3,s.gain.value=.5,a.gain.value=.5,t.connect(n),n.connect(t),t.connect(s),s.connect(o),a.connect(o);const r=new Map([["input",{id:"input",name:"Input",direction:"input",signal:"audio",node:t}],["time",{id:"time",name:"Time",direction:"input",signal:"cv",param:t.delayTime}],["feedback",{id:"feedback",name:"Feedback",direction:"input",signal:"cv",param:n.gain}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:o}]]),i=e.createGain();return i.connect(t),i.connect(a),{descriptorId:"Delay",ports:r,setParam:(e,o)=>{switch(e){case"time":t.delayTime.value=o;break;case"feedback":n.gain.value=o;break;case"mix":s.gain.value=o,a.gain.value=1-o}},getParam:e=>{switch(e){case"time":return t.delayTime.value;case"feedback":return n.gain.value;case"mix":return s.gain.value;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect(),s.disconnect(),a.disconnect(),o.disconnect(),i.disconnect()}}}},Uy={id:"SampleHold",name:"Sample & Hold",category:"utility",voiceMode:"shared",color:"#f97316",ports:[{id:"input",name:"Input",direction:"input",signal:"cv"},{id:"clock",name:"Clock",direction:"input",signal:"trigger"},{id:"output",name:"Output",direction:"output",signal:"cv"}],parameters:[{id:"slew",name:"Slew",min:0,max:.5,default:0}],create:e=>{const t=e.createConstantSource();t.offset.value=0,t.start();let n=0,s=0;return{descriptorId:"SampleHold",ports:new Map([["input",{id:"input",name:"Input",direction:"input",signal:"cv"}],["clock",{id:"clock",name:"Clock",direction:"input",signal:"trigger"}],["output",{id:"output",name:"Output",direction:"output",signal:"cv",node:t}]]),setParam:(e,t)=>{"slew"===e?n=t:"inputValue"===e&&(s=t)},getParam:e=>"slew"===e?n:"inputValue"===e?s:0,gateOn:a=>{const o=a||e.currentTime;n>0?(t.offset.cancelScheduledValues(o),t.offset.setValueAtTime(t.offset.value,o),t.offset.linearRampToValueAtTime(s,o+n)):t.offset.setValueAtTime(s,o)},dispose:()=>{t.stop(),t.disconnect()}}}},Ry={id:"Waveshaper",name:"Waveshaper",category:"utility",voiceMode:"per-voice",color:"#f59e0b",ports:[{id:"input",name:"Input",direction:"input",signal:"audio"},{id:"drive",name:"Drive CV",direction:"input",signal:"cv"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"drive",name:"Drive",min:0,max:1,default:.5,unit:"%"},{id:"mix",name:"Dry/Wet",min:0,max:1,default:1,unit:"%"},{id:"curve",name:"Curve",min:0,max:5,default:0},{id:"bias",name:"Bias",min:-1,max:1,default:0}],create:e=>{const t=e.createGain(),n=e.createGain(),s=e.createWaveShaper(),a=e.createGain(),o=e.createGain(),r=e.createGain();n.gain.value=1,a.gain.value=1,o.gain.value=0,r.gain.value=1;const i=new Float32Array(128);for(let h=0;h<128;h++){const e=2*h/128-1;i[h]=Math.tanh(2*e)}s.curve=i,s.oversample="4x",t.connect(n),n.connect(s),s.connect(r),r.connect(a),t.connect(o),o.connect(a);const l=new Map([["input",{id:"input",name:"Input",direction:"input",signal:"audio",node:t}],["drive",{id:"drive",name:"Drive CV",direction:"input",signal:"cv",param:n.gain}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:a}]]);let c=.5,u=1,d=0,m=0;function p(){const e=new Float32Array(256),t=10*c;for(let n=0;n<256;n++){let s=2*n/256-1;s+=.3*m;let a=s;switch(d){case 0:a=Math.tanh(s*t);break;case 1:a=Math.max(-1,Math.min(1,s*t));break;case 2:a=s>=0?Math.tanh(s*t):Math.tanh(s*t*1.5);break;case 3:a=s*t-s*s*s*(t/3),a=Math.max(-1,Math.min(1,a));break;case 4:a=Math.sin(s*t*Math.PI);break;case 5:const e=Math.floor(8-6*c),n=Math.pow(2,e);a=Math.round(s*n)/n}e[n]=a}s.curve=e}return{descriptorId:"Waveshaper",ports:l,setParam:(e,t)=>{switch(e){case"drive":c=t,n.gain.value=1+10*t,p();break;case"mix":u=t;const e=Math.sqrt(t),s=Math.sqrt(1-t);r.gain.value=e,o.gain.value=s;break;case"curve":d=Math.floor(t),p();break;case"bias":m=t,p()}},getParam:e=>{switch(e){case"drive":return c;case"mix":return u;case"curve":return d;case"bias":return m;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect(),s.disconnect(),r.disconnect(),o.disconnect(),a.disconnect()}}}},jy={id:"Compressor",name:"Compressor",category:"utility",voiceMode:"per-voice",color:"#8b5cf6",ports:[{id:"input",name:"Input",direction:"input",signal:"audio"},{id:"sidechain",name:"Sidechain",direction:"input",signal:"audio"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"threshold",name:"Threshold",min:0,max:1,default:.7,unit:"dB"},{id:"ratio",name:"Ratio",min:0,max:1,default:.5},{id:"attack",name:"Attack",min:0,max:1,default:.1,unit:"s"},{id:"release",name:"Release",min:0,max:1,default:.3,unit:"s"},{id:"knee",name:"Knee",min:0,max:1,default:.5,unit:"dB"},{id:"makeup",name:"Makeup",min:0,max:1,default:0,unit:"dB"}],create:e=>{const t=e.createGain(),n=e.createDynamicsCompressor(),s=e.createGain(),a=e.createGain();n.threshold.value=-24,n.knee.value=30,n.ratio.value=4,n.attack.value=.003,n.release.value=.25,s.gain.value=1,a.gain.value=1,t.connect(n),n.connect(s),s.connect(a);return{descriptorId:"Compressor",ports:new Map([["input",{id:"input",name:"Input",direction:"input",signal:"audio",node:t}],["sidechain",{id:"sidechain",name:"Sidechain",direction:"input",signal:"audio",node:n}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:a}]]),setParam:(e,t)=>{switch(e){case"threshold":n.threshold.value=60*t-60;break;case"ratio":n.ratio.value=1+19*t;break;case"attack":n.attack.value=.001*Math.pow(1e3,t);break;case"release":n.release.value=.01*Math.pow(300,t);break;case"knee":n.knee.value=40*t;break;case"makeup":const e=24*t;s.gain.value=Math.pow(10,e/20)}},getParam:e=>{switch(e){case"threshold":return(n.threshold.value+60)/60;case"ratio":return(n.ratio.value-1)/19;case"attack":return Math.log(n.attack.value/.001)/Math.log(1e3);case"release":return Math.log(n.release.value/.01)/Math.log(300);case"knee":return n.knee.value/40;case"makeup":return 20*Math.log10(s.gain.value)/24;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect(),s.disconnect(),a.disconnect()}}}},Xy={id:"Reverb",name:"Reverb",category:"utility",voiceMode:"shared",color:"#06b6d4",ports:[{id:"input",name:"Input",direction:"input",signal:"audio"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"size",name:"Size",min:0,max:1,default:.5,unit:"%"},{id:"decay",name:"Decay",min:0,max:1,default:.5,unit:"s"},{id:"damping",name:"Damping",min:0,max:1,default:.5,unit:"%"},{id:"mix",name:"Dry/Wet",min:0,max:1,default:.3,unit:"%"},{id:"predelay",name:"Pre-delay",min:0,max:1,default:0,unit:"ms"}],create:e=>{const t=e.createGain(),n=e.createGain(),s=e.createGain(),a=e.createGain(),o=e.createDelay(.5),r=[],i=[],l=[],c=[.037,.041,.043,.047];for(let d=0;d<4;d++){const t=e.createDelay(5),n=e.createGain(),s=e.createBiquadFilter();t.delayTime.value=c[d],n.gain.value=.7,s.type="lowpass",s.frequency.value=5e3,t.connect(s),s.connect(n),n.connect(t),r.push(t),i.push(n),l.push(s)}const u=[];for(let d=0;d<4;d++)u.push(e.createGain()),u[d].gain.value=.5;o.delayTime.value=0,t.connect(o);for(const d of r)o.connect(d);for(let d=0;d<4;d++)r[d].connect(u[d]),u[d].connect(s);t.connect(n),n.connect(a),s.connect(a),n.gain.value=.7,s.gain.value=.3,a.gain.value=1;return{descriptorId:"Reverb",ports:new Map([["input",{id:"input",name:"Input",direction:"input",signal:"audio",node:t}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:a}]]),setParam:(e,t)=>{switch(e){case"size":const e=.5+1.5*t;r.forEach((t,n)=>{t.delayTime.value=c[n]*e});break;case"decay":const a=.3+.65*t;i.forEach(e=>{e.gain.value=a});break;case"damping":const u=500+15500*(1-t);l.forEach(e=>{e.frequency.value=u});break;case"mix":const d=Math.sqrt(t),m=Math.sqrt(1-t);s.gain.value=d,n.gain.value=m;break;case"predelay":o.delayTime.value=.2*t}},getParam:e=>{switch(e){case"size":return(r[0].delayTime.value/c[0]-.5)/1.5;case"decay":return(i[0].gain.value-.3)/.65;case"damping":return 1-(l[0].frequency.value-500)/15500;case"mix":return s.gain.value*s.gain.value;case"predelay":return o.delayTime.value/.2;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect(),s.disconnect(),a.disconnect(),o.disconnect(),r.forEach(e=>e.disconnect()),i.forEach(e=>e.disconnect()),l.forEach(e=>e.disconnect()),u.forEach(e=>e.disconnect())}}}},zy={id:"RingModulator",name:"Ring Modulator",category:"utility",voiceMode:"per-voice",color:"#ec4899",ports:[{id:"carrier",name:"Carrier",direction:"input",signal:"audio"},{id:"modulator",name:"Modulator",direction:"input",signal:"audio"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"frequency",name:"Frequency",min:0,max:1,default:.5,unit:"Hz"},{id:"mix",name:"Dry/Wet",min:0,max:1,default:1,unit:"%"},{id:"internalOsc",name:"Internal Osc",min:0,max:1,default:1}],create:e=>{const t=e.createGain(),n=e.createGain(),s=e.createOscillator(),a=e.createGain(),o=e.createGain(),r=e.createGain(),i=e.createGain(),l=e.createGain();s.frequency.value=440,s.type="sine",s.start(),a.gain.value=1,o.gain.value=0,r.gain.value=0,i.gain.value=1,t.connect(o),o.connect(i),i.connect(l),n.connect(o.gain),s.connect(a),a.connect(o.gain),t.connect(r),r.connect(l);return{descriptorId:"RingModulator",ports:new Map([["carrier",{id:"carrier",name:"Carrier",direction:"input",signal:"audio",node:t}],["modulator",{id:"modulator",name:"Modulator",direction:"input",signal:"audio",node:n}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:l}]]),setParam:(e,t)=>{switch(e){case"frequency":s.frequency.value=20*Math.pow(250,t);break;case"mix":const e=Math.sqrt(t),n=Math.sqrt(1-t);i.gain.value=e,r.gain.value=n;break;case"internalOsc":a.gain.value=t}},getParam:e=>{switch(e){case"frequency":return Math.log(s.frequency.value/20)/Math.log(250);case"mix":return i.gain.value*i.gain.value;case"internalOsc":return a.gain.value;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect(),s.stop(),s.disconnect(),a.disconnect(),o.disconnect(),r.disconnect(),i.disconnect(),l.disconnect()}}}},Gy={enabled:!0,oversamplingOrder:2,filterSelect:0,normalDecay:.164,accentDecay:.006,softAttack:0,accentSoftAttack:.1,passbandCompensation:.09,resTracking:.257,filterInputDrive:.169,diodeCharacter:1,duffingAmount:.03,filterFmDepth:0,lpBpMix:0,filterTracking:0,stageNLAmount:0,ensembleAmount:0,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},Hy=[{type:"synth",name:"DB303 Default",synthType:"TB303",tb303:{engineType:"db303",volume:1,oscillator:{type:"sawtooth",pulseWidth:0,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.5},accent:{amount:.5},slide:{time:.17,mode:"exponential"},devilFish:{...Gy,normalDecay:.5},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:3,feedback:.3,tone:.5,mix:0,stereo:.5}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.65},filterEnvelope:{envMod:.6,decay:.3},accent:{amount:.7},slide:{time:.17,mode:"exponential"},devilFish:{...Gy,normalDecay:.3}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.82},filterEnvelope:{envMod:.85,decay:.4},accent:{amount:.9},slide:{time:.15,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.15,normalDecay:.4}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Deep Sub",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.15,resonance:.35},filterEnvelope:{envMod:.25,decay:.2},accent:{amount:.45},slide:{time:.3,mode:"exponential"},devilFish:{...Gy,normalDecay:.2}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{volume:1,oscillator:{type:"square"},filter:{cutoff:.45,resonance:.68},filterEnvelope:{envMod:.55,decay:.25},accent:{amount:.65},slide:{time:.15,mode:"exponential"},devilFish:{...Gy,normalDecay:.25}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.35,resonance:.92},filterEnvelope:{envMod:.95,decay:.4},accent:{amount:1},slide:{time:.1,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.4,duffingAmount:.3,normalDecay:.4,accentDecay:.003}},effects:[],volume:0,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.5,resonance:.8},filterEnvelope:{envMod:.75,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"},devilFish:{...Gy,normalDecay:.45,accentDecay:.015,softAttack:.05,filterTracking:.6,filterFmDepth:.5,filterInputDrive:.35,diodeCharacter:.4,duffingAmount:.5,sweepSpeed:"fast"}},effects:[],volume:0,pan:0},{type:"synth",name:"DF Acid Burn",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.88},filterEnvelope:{envMod:.9,decay:.35},accent:{amount:.95},slide:{time:.12,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.5,duffingAmount:.2,normalDecay:.35,accentDecay:.005}},effects:[],volume:0,pan:0},{type:"synth",name:"Acid RAT",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.75},filterEnvelope:{envMod:.7,decay:.35},accent:{amount:.85},slide:{time:.12,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.2,normalDecay:.35}},effects:[{id:"acid-rat-neural",category:"neural",type:"Neural",enabled:!0,wet:60,parameters:{gain:.55},neuralModelIndex:1,neuralModelName:"ProCo RAT"},{id:"acid-rat-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:0,pan:0},{type:"synth",name:"Acid DS-1",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.5,resonance:.7},filterEnvelope:{envMod:.65,decay:.3},accent:{amount:.8},slide:{time:.15,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.15,normalDecay:.3}},effects:[{id:"acid-ds1-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.5,oversample:"2x"}},{id:"acid-ds1-eq",category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:0,mid:3,high:1}},{id:"acid-ds1-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:0,pan:0},{type:"synth",name:"Acid Warm",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.45,resonance:.6},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.65},slide:{time:.2,mode:"exponential"},devilFish:{...Gy,normalDecay:.4}},effects:[{id:"acid-warm-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:60,parameters:{drive:.35,tone:8e3}},{id:"acid-warm-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}}],volume:0,pan:0},{type:"synth",name:"Acid Dub",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.35,resonance:.55},filterEnvelope:{envMod:.45,decay:.5},accent:{amount:.6},slide:{time:.25,mode:"exponential"},devilFish:{...Gy,normalDecay:.5}},effects:[{id:"acid-dub-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:30,parameters:{drive:.2,tone:1e4}},{id:"acid-dub-echo",category:"tonejs",type:"SpaceEcho",enabled:!0,wet:35,parameters:{mode:4,rate:400,intensity:.5,echoVolume:.7,reverbVolume:.2}},{id:"acid-dub-spring",category:"wasm",type:"SpringReverb",enabled:!0,wet:25,parameters:{decay:.6,damping:.5,tension:.4,mix:.5,drip:.3}}],volume:0,pan:0},{type:"synth",name:"Acid Echo",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth",pulseWidth:1,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.5},slide:{time:.17,mode:"exponential"},devilFish:{...Gy,normalDecay:.4},delay:{enabled:!0,time:.3,feedback:.3,tone:.5,mix:.5,stereo:.75}},effects:[],volume:0,pan:0},{type:"synth",name:"Acid Trance",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.6,resonance:.72},filterEnvelope:{envMod:.75,decay:.4},accent:{amount:.8},slide:{time:.15,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.1,normalDecay:.4}},effects:[{id:"acid-trance-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.35}},{id:"acid-trance-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:25,parameters:{time:.375,feedback:.45}},{id:"acid-trance-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:30,parameters:{decay:3,preDelay:.03}}],volume:0,pan:0},{type:"synth",name:"Acid Techno",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.65,resonance:.85},filterEnvelope:{envMod:.85,decay:.35},accent:{amount:.9},slide:{time:.1,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.3,diodeCharacter:.15,normalDecay:.35}},effects:[{id:"acid-techno-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:6,attack:.002,release:.1}}],volume:0,pan:0},{type:"synth",name:"Acid Industrial",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.45,resonance:.85},filterEnvelope:{envMod:.9,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"},devilFish:{...Gy,filterInputDrive:.6,diodeCharacter:.5,duffingAmount:.6,normalDecay:.45,accentDecay:.008}},effects:[{id:"acid-ind-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}}],volume:0,pan:0},{type:"synth",name:"Acid Space",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.5},filterEnvelope:{envMod:.4,decay:.55},accent:{amount:.5},slide:{time:.3,mode:"exponential"},devilFish:{...Gy,normalDecay:.55}},effects:[{id:"acid-space-chorus",category:"tonejs",type:"Chorus",enabled:!0,wet:25,parameters:{frequency:.4,depth:.4}},{id:"acid-space-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:35,parameters:{time:.5,feedback:.5}},{id:"acid-space-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}}],volume:0,pan:0}],Wy=(e={})=>({enabled:!0,am:!1,ar:31,dr:0,mult:1,rr:15,sl:0,tl:0,dt2:0,rs:0,dt:0,d2r:0,ssg:0,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0,...e}),qy=()=>Wy({enabled:!1,tl:127,ar:0,rr:0}),Ky=[{name:"Genesis Bass",type:"synth",synthType:"FurnaceOPN",volume:-6,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:5,operators:[Wy({mult:1,tl:20,ar:31,dr:8,sl:2,rr:8}),Wy({mult:2,tl:30,ar:31,dr:12,sl:4,rr:6,dt:3}),Wy({mult:1,tl:25,ar:31,dr:10,sl:3,rr:8}),Wy({mult:4,tl:35,ar:28,dr:15,sl:5,rr:10,dt:-1})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Lead",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:5,feedback:6,operators:[Wy({mult:1,tl:10,ar:31,dr:4,sl:1,rr:6}),Wy({mult:3,tl:35,ar:31,dr:8,sl:3,rr:8,dt:2}),Wy({mult:2,tl:30,ar:31,dr:6,sl:2,rr:8,dt:-2}),Wy({mult:1,tl:15,ar:31,dr:10,sl:4,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Brass",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:2,feedback:7,operators:[Wy({mult:1,tl:25,ar:28,dr:10,sl:4,rr:8}),Wy({mult:1,tl:20,ar:31,dr:8,sl:3,rr:10}),Wy({mult:2,tl:30,ar:31,dr:12,sl:5,rr:8,dt:1}),Wy({mult:1,tl:15,ar:25,dr:6,sl:2,rr:6})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Bell",type:"synth",synthType:"FurnaceOPN",volume:-10,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:0,operators:[Wy({mult:1,tl:15,ar:31,dr:8,sl:0,rr:10}),Wy({mult:7,tl:40,ar:31,dr:12,sl:2,rr:12,dt:3}),Wy({mult:1,tl:20,ar:31,dr:10,sl:1,rr:10}),Wy({mult:14,tl:45,ar:31,dr:15,sl:3,rr:14,dt:-2})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Strings",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:1,feedback:3,operators:[Wy({mult:1,tl:20,ar:20,dr:5,sl:2,rr:8}),Wy({mult:2,tl:35,ar:25,dr:8,sl:4,rr:10,dt:1}),Wy({mult:1,tl:25,ar:22,dr:6,sl:3,rr:8,dt:-1}),Wy({mult:3,tl:40,ar:28,dr:10,sl:5,rr:12,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Synth Lead",type:"synth",synthType:"FurnaceOPM",volume:-8,pan:0,effects:[],furnace:{chipType:33,algorithm:5,feedback:6,operators:[Wy({mult:1,tl:15,ar:31,dr:5,sl:1,rr:6}),Wy({mult:3,tl:40,ar:31,dr:8,sl:3,rr:8,dt:2}),Wy({mult:2,tl:35,ar:31,dr:10,sl:4,rr:8,dt:-2}),Wy({mult:1,tl:25,ar:31,dr:12,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Electric Piano",type:"synth",synthType:"FurnaceOPM",volume:-10,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:2,operators:[Wy({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),Wy({mult:14,tl:50,ar:31,dr:15,sl:5,rr:10}),Wy({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),Wy({mult:1,tl:45,ar:31,dr:18,sl:6,rr:12,dt:1})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Metallic Drum",type:"synth",synthType:"FurnaceOPM",volume:-6,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:7,operators:[Wy({mult:1,tl:20,ar:31,dr:15,sl:0,rr:15}),Wy({mult:5,tl:30,ar:31,dr:12,sl:0,rr:15,dt:2}),Wy({mult:9,tl:40,ar:31,dr:10,sl:0,rr:15,dt:-2}),Wy({mult:2,tl:50,ar:31,dr:8,sl:0,rr:15})],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Organ",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:3,operators:[Wy({mult:2,tl:30,ar:15,dr:4,sl:8,rr:5,ws:1}),Wy({mult:1,tl:0,ar:15,dr:2,sl:4,rr:8,ws:0}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Slap Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:5,operators:[Wy({mult:4,tl:35,ar:15,dr:6,sl:3,rr:4,ws:0}),Wy({mult:1,tl:0,ar:15,dr:3,sl:2,rr:6,ws:0}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Bass Drum",type:"synth",synthType:"FurnaceOPL",volume:-4,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[Wy({mult:1,tl:10,ar:31,dr:6,sl:2,rr:6,ws:0}),Wy({mult:0,tl:0,ar:31,dr:8,sl:0,rr:8,ws:0}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Snare",type:"synth",synthType:"FurnaceOPL",volume:-6,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:0,operators:[Wy({mult:1,tl:5,ar:31,dr:10,sl:0,rr:10,ws:3}),Wy({mult:4,tl:20,ar:31,dr:8,sl:0,rr:8,ws:0}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[Wy({mult:1,tl:25,ar:12,dr:5,sl:5,rr:6,ws:0}),Wy({mult:1,tl:5,ar:14,dr:4,sl:3,rr:8,ws:0}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:0,ar:31,dr:0,sl:0,rr:12}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:5,ar:31,dr:4,sl:2,rr:8}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Triangle",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:8,ar:31,dr:2,sl:1,rr:10}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Pulse",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:5,ar:28,dr:2,sl:2,rr:10}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:8,ar:31,dr:5,sl:3,rr:8}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Arp Lead",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:3,ar:31,dr:3,sl:1,rr:12}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:8,ar:31,dr:4,sl:3,rr:8}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:12,ar:31,dr:6,sl:4,rr:6}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"6581 Pulse Lead",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1200,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Saw Lead",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Saw Bass",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:14,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:512,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Pulse Bass",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:15,r:3,duty:1024,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:400,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Arp Pulse",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:4,s:0,r:2,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Noise Snare",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:4,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:2,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Kick",type:"synth",synthType:"FurnaceSID6581",volume:-4,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:6,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:300,filterResonance:0,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Ring Mod",type:"synth",synthType:"FurnaceSID6581",volume:-10,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:8,s:8,r:6,duty:0,ringMod:!0,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Filter Sweep",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:2,d:10,s:6,r:8,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:900,filterResonance:12,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Pad",type:"synth",synthType:"FurnaceSID6581",volume:-10,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:8,d:6,s:10,r:10,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:700,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Pulse Lead",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1400,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Saw Lead",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Saw Bass",type:"synth",synthType:"FurnaceSID8580",volume:-6,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:14,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:600,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Pulse Bass",type:"synth",synthType:"FurnaceSID8580",volume:-6,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:15,r:3,duty:1024,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:500,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Arp Saw",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:3,s:0,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Hi-Hat",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:2,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1200,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!0,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Sync Lead",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!0,toFilter:!0,initFilter:!0,filterCutoff:1e3,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Pad",type:"synth",synthType:"FurnaceSID8580",volume:-10,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:8,d:6,s:10,r:10,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"AY Buzzy Lead",type:"synth",synthType:"FurnaceAY",volume:-8,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:1,operators:[Wy({mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6}),Wy({mult:3,tl:50,ar:31,dr:8,sl:8,rr:10}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Square Bass",type:"synth",synthType:"FurnaceAY",volume:-6,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:15,ar:31,dr:8,sl:5,rr:5}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:4,algorithm:6,feedback:2,operators:[Wy({mult:1,tl:12,ar:31,dr:5,sl:2,rr:8}),Wy({mult:2,tl:40,ar:31,dr:8,sl:4,rr:10}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:4,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:8,ar:31,dr:6,sl:3,rr:6}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Pulse Lead",type:"synth",synthType:"FurnaceVRC6",volume:-8,pan:0,effects:[],furnace:{chipType:21,algorithm:5,feedback:0,operators:[Wy({mult:1,tl:5,ar:31,dr:3,sl:1,rr:10}),Wy({mult:2,tl:30,ar:31,dr:6,sl:3,rr:12}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Saw Bass",type:"synth",synthType:"FurnaceVRC6",volume:-6,pan:0,effects:[],furnace:{chipType:21,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:10,ar:31,dr:5,sl:2,rr:8}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"N163 Wave Lead",type:"synth",synthType:"FurnaceN163",volume:-8,pan:0,effects:[],furnace:{chipType:22,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:8,ar:31,dr:4,sl:2,rr:8}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]}},{name:"TIA Buzzy",type:"synth",synthType:"FurnaceTIA",volume:-10,pan:0,effects:[],furnace:{chipType:38,algorithm:7,feedback:7,operators:[Wy({mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4}),Wy({mult:5,tl:45,ar:31,dr:20,sl:10,rr:6,dt:2}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"VERA PSG Lead",type:"synth",synthType:"FurnaceVERA",volume:-8,pan:0,effects:[],furnace:{chipType:42,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"SCC Wave",type:"synth",synthType:"FurnaceSCC",volume:-8,pan:0,effects:[],furnace:{chipType:10,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:8,ar:31,dr:5,sl:2,rr:10}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[{id:0,data:[0,32,64,96,127,96,64,32,0,-32,-64,-96,-127,-96,-64,-32]}]}},{name:"OPLL Piano",type:"synth",synthType:"FurnaceOPLL",volume:-10,pan:0,effects:[],furnace:{chipType:9,algorithm:0,feedback:2,operators:[Wy({mult:4,tl:35,ar:15,dr:5,sl:6,rr:7}),Wy({mult:1,tl:0,ar:15,dr:3,sl:3,rr:6}),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Pad",type:"synth",synthType:"FurnaceSNES",volume:-10,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:12,ar:20,dr:4,sl:2,rr:12}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Bass",type:"synth",synthType:"FurnaceSNES",volume:-6,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:8,ar:31,dr:6,sl:3,rr:8}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"FDS Wave",type:"synth",synthType:"FurnaceFDS",volume:-8,pan:0,effects:[],furnace:{chipType:23,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[{id:0,data:[32,40,48,56,63,56,48,40,32,24,16,8,0,8,16,24]}]}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:32,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:12,ar:31,dr:5,sl:3,rr:8}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"SAA Square",type:"synth",synthType:"FurnaceSAA",volume:-8,pan:0,effects:[],furnace:{chipType:31,algorithm:7,feedback:0,operators:[Wy({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),qy(),qy(),qy()],macros:[],opMacros:[],wavetables:[]}},{name:"ESFM Lead",type:"synth",synthType:"FurnaceESFM",volume:-8,pan:0,effects:[],furnace:{chipType:48,algorithm:5,feedback:5,operators:[Wy({mult:1,tl:15,ar:15,dr:4,sl:2,rr:6}),Wy({mult:3,tl:35,ar:15,dr:6,sl:4,rr:8,dt:1}),Wy({mult:2,tl:30,ar:15,dr:5,sl:3,rr:8}),Wy({mult:1,tl:20,ar:15,dr:8,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPZ E.Piano",type:"synth",synthType:"FurnaceOPZ",volume:-10,pan:0,effects:[],furnace:{chipType:40,algorithm:4,feedback:3,operators:[Wy({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),Wy({mult:14,tl:48,ar:31,dr:14,sl:5,rr:10,dt:1}),Wy({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),Wy({mult:1,tl:45,ar:31,dr:16,sl:6,rr:12})],macros:[],opMacros:[],wavetables:[]}}],$y=[{type:"synth",name:"Classic Siren",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"triangle",rate:2,depth:200},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!1,decay:1.5,wet:.2}},effects:[],volume:-10,pan:0},{type:"synth",name:"Code Red",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"square",frequency:600},lfo:{enabled:!0,type:"square",rate:8,depth:100},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:2,wet:.4}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Echo",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:220},lfo:{enabled:!0,type:"sine",rate:.5,depth:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},filter:{enabled:!0,type:"highpass",frequency:300,rolloff:-12},reverb:{enabled:!0,decay:4,wet:.6}},effects:[],volume:-12,pan:0},{type:"synth",name:"Air Horn",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:150},lfo:{enabled:!0,type:"sawtooth",rate:15,depth:20},delay:{enabled:!0,time:.15,feedback:.2,wet:.2},filter:{enabled:!0,type:"lowpass",frequency:1200,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0}],Yy=[{type:"synth",name:"Standard Zap",synthType:"SpaceLaser",spaceLaser:{...Va,laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:30,ratio:2},noise:{amount:5,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:30}},effects:[],volume:-10,pan:0},{type:"synth",name:"Cosmic Burst",synthType:"SpaceLaser",spaceLaser:{...Va,laser:{startFreq:8e3,endFreq:400,sweepTime:300,sweepCurve:"exponential"},fm:{amount:60,ratio:4.5},noise:{amount:20,type:"pink"},filter:{type:"highpass",cutoff:1e3,resonance:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},reverb:{enabled:!0,decay:4,wet:.4}},effects:[],volume:-12,pan:0},{type:"synth",name:"Anime Pew",synthType:"SpaceLaser",spaceLaser:{...Va,laser:{startFreq:6e3,endFreq:2e3,sweepTime:80,sweepCurve:"exponential"},fm:{amount:80,ratio:8},noise:{amount:0,type:"white"},filter:{type:"bandpass",cutoff:4e3,resonance:60},delay:{enabled:!0,time:.1,feedback:.3,wet:.3},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Blaster",synthType:"SpaceLaser",spaceLaser:{...Va,laser:{startFreq:1500,endFreq:40,sweepTime:500,sweepCurve:"linear"},fm:{amount:20,ratio:1.5},noise:{amount:40,type:"brown"},filter:{type:"lowpass",cutoff:800,resonance:40},delay:{enabled:!0,time:.33,feedback:.6,wet:.6},reverb:{enabled:!0,decay:2.5,wet:.3}},effects:[],volume:-10,pan:0}],Jy={type:"synth",name:"V2 Trance Lead",synthType:"V2",v2:{...Ca,osc1:{mode:1,detune:0,transpose:0,color:64,level:100},osc2:{mode:1,ringMod:!1,detune:15,transpose:0,color:64,level:80},filter1:{mode:1,cutoff:80,resonance:40},envelope:{attack:5,decay:60,sustain:40,release:40}},effects:[],volume:-10,pan:0},Qy={type:"synth",name:"V2 Silk Pad",synthType:"V2",v2:{...Ca,osc1:{mode:1,detune:5,transpose:0,color:64,level:60},osc2:{mode:3,ringMod:!1,detune:0,transpose:12,color:64,level:40},filter1:{mode:1,cutoff:40,resonance:20},envelope:{attack:80,decay:100,sustain:100,release:100}},effects:[],volume:-12,pan:0},Zy={type:"synth",name:"V2 4k Bass",synthType:"V2",v2:{...Ca,osc1:{mode:1,detune:0,transpose:-12,color:64,level:100},osc2:{mode:2,ringMod:!1,detune:0,transpose:-12,color:64,level:60},filter1:{mode:1,cutoff:30,resonance:60},envelope:{attack:0,decay:40,sustain:0,release:10}},effects:[],volume:-8,pan:0},ex={type:"synth",name:"V2 4k Kick",synthType:"V2",v2:{...Ca,osc1:{mode:3,detune:0,transpose:-24,color:64,level:120},filter1:{mode:1,cutoff:20,resonance:40},envelope:{attack:0,decay:30,sustain:0,release:10}},effects:[],volume:-6,pan:0},tx={type:"synth",name:"V2 Noise Snare",synthType:"V2",v2:{...Ca,osc1:{mode:4,detune:0,transpose:0,color:64,level:100},filter1:{mode:2,cutoff:60,resonance:20},envelope:{attack:0,decay:45,sustain:0,release:20}},effects:[],volume:-10,pan:0},nx={type:"synth",name:"V2 Metal Hat",synthType:"V2",v2:{...Ca,osc1:{mode:4,detune:0,transpose:0,color:64,level:80},filter1:{mode:3,cutoff:100,resonance:10},envelope:{attack:0,decay:15,sustain:0,release:10}},effects:[],volume:-14,pan:0},sx=[Jy,Qy,Zy,ex,tx,nx,{type:"synth",name:"V2 Retro Zap",synthType:"V2",v2:{...Ca,osc1:{mode:1,detune:0,transpose:12,color:64,level:100},filter1:{mode:1,cutoff:120,resonance:80},envelope:{attack:0,decay:25,sustain:0,release:10}},effects:[],volume:-10,pan:0},{name:"V2 Speech",type:"synth",synthType:"V2Speech",volume:-6,pan:0,effects:[],parameters:{text:"Ready"}}],ax=[{type:"synth",name:"Disco Tom",synthType:"Synare",synare:{...Pa,oscillator:{type:"square",tune:150,fine:0},sweep:{enabled:!0,amount:24,time:200},envelope:{decay:400,sustain:0},noise:{enabled:!1,type:"white",mix:0,color:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Perc",synthType:"Synare",synare:{...Pa,oscillator:{type:"square",tune:80,fine:0},sweep:{enabled:!0,amount:12,time:100},filter:{cutoff:400,resonance:85,envMod:80,decay:150},envelope:{decay:200,sustain:0},noise:{enabled:!0,type:"white",mix:.1,color:50}},effects:[],volume:-10,pan:0},{type:"synth",name:"Synare Snare",synthType:"Synare",synare:{...Pa,oscillator:{type:"square",tune:220,fine:0},noise:{enabled:!0,type:"white",mix:.6,color:80},filter:{cutoff:2e3,resonance:30,envMod:40,decay:100},envelope:{decay:150,sustain:0},sweep:{enabled:!1,amount:0,time:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Zap",synthType:"Synare",synare:{...Pa,oscillator:{type:"square",tune:600,fine:0},sweep:{enabled:!0,amount:48,time:300},lfo:{enabled:!0,rate:12,depth:50,target:"pitch"},envelope:{decay:500,sustain:0}},effects:[],volume:-12,pan:0}],ox=(e,t,n)=>({id:`map-${e}-${Date.now()}-${Math.random()}`,noteStart:e,noteEnd:e,sampleId:t,sampleName:t,sampleUrl:`data/samples/packs/drumnibus/${n}`,pitchOffset:0,fineTune:0,volumeOffset:0,panOffset:0}),rx=(e,t)=>({type:"synth",name:e,synthType:"DrumKit",drumKit:{keymap:t,polyphony:"poly",maxVoices:8,noteCut:!0},effects:[],volume:-6,pan:0}),ix=[ox(36,"Kick","kicks/BD_808A1200.wav"),ox(38,"Snare","snares/SD_Analog Noise1.wav"),ox(39,"Clap","percussion/CLAP_Juxtapos.wav"),ox(42,"Closed Hat","hihats/CH_AnalogHihat1.wav"),ox(46,"Open Hat","hihats/OH_AnalogOpenhatwav.wav"),ox(41,"Tom Low","percussion/TOM_Warped.wav"),ox(45,"Tom Mid","percussion/TOM_Stofelectro1.wav"),ox(49,"Crash","hihats/CYM_Synthique.wav"),ox(51,"Ride","hihats/CYM_Magnotron.wav"),ox(60,"FX","fx/FX_AnalogFX1.wav")],lx=[ox(36,"Kick","kicks/BD_Digidap.wav"),ox(38,"Snare","snares/SD_Digidap.wav"),ox(39,"Clap","percussion/CLAP_Punchtron.wav"),ox(42,"Closed Hat","hihats/CH_Digidap.wav"),ox(46,"Open Hat","hihats/OH_Digidap.wav"),ox(41,"Tom","percussion/TOM_Punchtron.wav"),ox(49,"Crash","hihats/CYM_Punchtron.wav"),ox(60,"Zap","fx/FX_Digidap2.wav")],cx=[ox(36,"Kick","kicks/BD_LofiHuman.wav"),ox(38,"Snare","snares/SD_LofiHuman.wav"),ox(39,"Clap","percussion/CLAP_LofiHuman.wav"),ox(42,"Closed Hat","hihats/CH_LofiHuman.wav"),ox(46,"Open Hat","hihats/OH_LofiHuman.wav"),ox(41,"Tom","percussion/TOM_LofiHuman.wav"),ox(60,"Vocal FX","fx/FX_LofiHuman.wav")],ux=[ox(36,"Kick","kicks/BD_Pziforze.wav"),ox(38,"Snare","snares/SD_Wolf 3.wav"),ox(39,"Clap","percussion/CLAP_Magnotron.wav"),ox(42,"Closed Hat","hihats/CH_Magnotron.wav"),ox(46,"Open Hat","hihats/OH_Magnotron.wav"),ox(41,"Tom Low","percussion/TOM_Magnotron.wav"),ox(49,"Crash","hihats/CYM_Magnotron.wav"),ox(60,"Rumble FX","fx/FX_Magstorm1.wav")],dx=[rx("Drumnibus Analog",ix),rx("Drumnibus Digital",lx),rx("Drumnibus LoFi",cx),rx("Drumnibus Techno",ux)],mx=[{type:"synth",name:"SP_TheProduct",synthType:"V2",v2Speech:{text:"!DHAX_ !prAA_dAHkt",speed:64,pitch:40,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP_Demoscene",synthType:"V2",v2Speech:{text:"!dEH_mOW_sIYn",speed:64,pitch:64,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"KY_Rhodesano0",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:0},osc2:{mode:5,ringMod:!1,transpose:0,detune:9,color:0,level:122},osc3:{mode:0,ringMod:!1,transpose:31,detune:29,color:72,level:0},filter1:{mode:1,cutoff:99,resonance:0},filter2:{mode:0,cutoff:94,resonance:99},routing:{mode:1,balance:64},envelope:{attack:13,decay:104,sustain:0,release:44},envelope2:{attack:4,decay:93,sustain:0,release:64},lfo1:{rate:74,depth:75}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_AnaBass#005",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:7,color:0,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:64,level:125},osc3:{mode:0,ringMod:!1,transpose:-12,detune:0,color:0,level:125},filter1:{mode:1,cutoff:52,resonance:91},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_French HornZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Dry BD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:22,level:122},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:0},filter1:{mode:1,cutoff:122,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:5,release:45},envelope2:{attack:0,decay:35,sustain:0,release:33},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Morseh #000",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:-6,detune:0,color:62,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:94,depth:108}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Transortion",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:63,resonance:95},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:90,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Long Pad007",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:16,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-8,color:64,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:4,cutoff:39,resonance:0},filter2:{mode:1,cutoff:35,resonance:69},routing:{mode:1,balance:64},envelope:{attack:71,decay:94,sustain:96,release:106},envelope2:{attack:114,decay:120,sustain:113,release:112},lfo1:{rate:7,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_JarreStrings",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:12,color:1,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:61,level:34},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:5,cutoff:74,resonance:42},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:26,decay:64,sustain:64,release:49},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:78,depth:2}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_His Shadow's Breath",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:4,level:122},osc2:{mode:4,ringMod:!1,transpose:45,detune:0,color:41,level:77},osc3:{mode:1,ringMod:!1,transpose:12,detune:16,color:3,level:122},filter1:{mode:5,cutoff:67,resonance:97},filter2:{mode:2,cutoff:76,resonance:120},routing:{mode:2,balance:64},envelope:{attack:27,decay:64,sustain:122,release:30},envelope2:{attack:0,decay:102,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Deepness001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:14,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-15,color:0,level:126},filter1:{mode:1,cutoff:76,resonance:47},filter2:{mode:1,cutoff:76,resonance:47},routing:{mode:1,balance:42},envelope:{attack:0,decay:14,sustain:115,release:54},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 SD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Marsian Pan Flute",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:28,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:-27,color:64,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:18,resonance:118},filter2:{mode:1,cutoff:100,resonance:70},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:37,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Lullaby09",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:80,resonance:44},filter2:{mode:2,cutoff:115,resonance:108},routing:{mode:2,balance:64},envelope:{attack:0,decay:64,sustain:64,release:75},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Morpher#072",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-8,color:8,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:12,color:24,level:72},osc3:{mode:1,ringMod:!1,transpose:0,detune:-7,color:97,level:126},filter1:{mode:2,cutoff:0,resonance:86},filter2:{mode:2,cutoff:123,resonance:51},routing:{mode:2,balance:63},envelope:{attack:0,decay:25,sustain:126,release:7},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:24,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Jarresque06",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:124},osc2:{mode:4,ringMod:!1,transpose:23,detune:0,color:98,level:49},osc3:{mode:1,ringMod:!1,transpose:12,detune:10,color:6,level:124},filter1:{mode:2,cutoff:68,resonance:0},filter2:{mode:3,cutoff:120,resonance:0},routing:{mode:2,balance:29},envelope:{attack:75,decay:0,sustain:125,release:98},envelope2:{attack:125,decay:125,sustain:125,release:125},lfo1:{rate:10,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_Awaych #000",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-11,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:12,color:0,level:126},filter1:{mode:2,cutoff:86,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:86,decay:114,sustain:109,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:74,depth:23}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Kicking Saw",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:68,resonance:98},filter2:{mode:1,cutoff:62,resonance:105},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:105,depth:32}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Hiphop BaZZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:42,resonance:0},filter2:{mode:2,cutoff:126,resonance:0},routing:{mode:2,balance:64},envelope:{attack:0,decay:12,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Woodblock",synthType:"V2",v2:{osc1:{mode:3,transpose:12,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:21,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:21,sustain:0,release:25},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Electrons68",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:1,ringMod:!0,transpose:0,detune:-19,color:32,level:125},osc3:{mode:3,ringMod:!0,transpose:31,detune:0,color:114,level:125},filter1:{mode:2,cutoff:67,resonance:95},filter2:{mode:3,cutoff:60,resonance:89},routing:{mode:1,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:91,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Garage Organ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:15,level:125},osc2:{mode:3,ringMod:!1,transpose:48,detune:0,color:32,level:25},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:33},filter1:{mode:1,cutoff:108,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:49,sustain:108,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Lonely Square Lead",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:97},osc2:{mode:2,ringMod:!1,transpose:0,detune:-9,color:64,level:66},osc3:{mode:2,ringMod:!1,transpose:0,detune:6,color:64,level:47},filter1:{mode:2,cutoff:66,resonance:35},filter2:{mode:3,cutoff:98,resonance:10},routing:{mode:2,balance:32},envelope:{attack:0,decay:73,sustain:36,release:55},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Strangeland",synthType:"V2",v2:{osc1:{mode:2,transpose:-12,detune:0,color:2,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:5,color:123,level:126},osc3:{mode:2,ringMod:!1,transpose:0,detune:-9,color:24,level:126},filter1:{mode:3,cutoff:117,resonance:14},filter2:{mode:2,cutoff:91,resonance:15},routing:{mode:2,balance:42},envelope:{attack:10,decay:96,sustain:65,release:102},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:14,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old Saw Percs",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:9,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:23,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:67,resonance:13},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:68},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:50,depth:114}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_SawBass#004",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:4,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-5,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:0,color:6,level:126},filter1:{mode:1,cutoff:64,resonance:7},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:90,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Ridesecken",synthType:"V2",v2:{osc1:{mode:2,transpose:-4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:4,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:2,cutoff:104,resonance:95},routing:{mode:1,balance:64},envelope:{attack:0,decay:26,sustain:57,release:100},envelope2:{attack:0,decay:90,sustain:0,release:95},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Powerbeam15",synthType:"V2",v2:{osc1:{mode:3,transpose:-45,detune:0,color:0,level:124},osc2:{mode:3,ringMod:!0,transpose:-38,detune:0,color:32,level:124},osc3:{mode:5,ringMod:!1,transpose:-2,detune:0,color:67,level:124},filter1:{mode:1,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:125,sustain:0,release:2},envelope2:{attack:0,decay:125,sustain:0,release:0},lfo1:{rate:94,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Glimpse Of a Clavi",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:13,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:82,resonance:102},filter2:{mode:3,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:13},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_PWM Leade)",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:125},osc2:{mode:0,ringMod:!1,transpose:-12,detune:7,color:4,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:73,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:60,decay:114,sustain:80,release:64},envelope2:{attack:126,decay:126,sustain:126,release:0},lfo1:{rate:77,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_LoFi Choir9",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-20,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:82,resonance:98},filter2:{mode:3,cutoff:80,resonance:106},routing:{mode:1,balance:64},envelope:{attack:67,decay:64,sustain:64,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old SawsrnZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_I like to move it",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-13,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:20,color:32,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:58},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:31},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Industrial VeloHammer",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:15,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:61,resonance:113},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:55,sustain:0,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Rave Siren",synthType:"V2",v2:{osc1:{mode:2,transpose:8,detune:4,color:69,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:53,level:107},osc3:{mode:2,ringMod:!1,transpose:-4,detune:5,color:69,level:126},filter1:{mode:3,cutoff:58,resonance:95},filter2:{mode:2,cutoff:100,resonance:90},routing:{mode:1,balance:64},envelope:{attack:0,decay:13,sustain:28,release:86},envelope2:{attack:0,decay:72,sustain:58,release:73},lfo1:{rate:104,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Doj's Organ",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:0,color:32,level:125},osc3:{mode:3,ringMod:!1,transpose:36,detune:0,color:32,level:78},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:38,sustain:107,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Phunny #002",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:26,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:75,resonance:82},filter2:{mode:1,cutoff:64,resonance:0},routing:{mode:2,balance:26},envelope:{attack:7,decay:37,sustain:64,release:53},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:73,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Fairies#001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:63},osc2:{mode:1,ringMod:!1,transpose:0,detune:8,color:0,level:63},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:121},filter1:{mode:3,cutoff:42,resonance:101},filter2:{mode:0,cutoff:108,resonance:0},routing:{mode:0,balance:64},envelope:{attack:72,decay:121,sustain:70,release:100},envelope2:{attack:0,decay:125,sustain:56,release:108},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nastyn-303",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:0,level:125},osc2:{mode:0,ringMod:!1,transpose:0,detune:19,color:0,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:49,resonance:114},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:18},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:61,depth:82}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Squaredance",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:65,level:126},osc3:{mode:2,ringMod:!0,transpose:12,detune:0,color:64,level:22},filter1:{mode:1,cutoff:57,resonance:63},filter2:{mode:2,cutoff:60,resonance:31},routing:{mode:0,balance:64},envelope:{attack:0,decay:26,sustain:100,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Biiiig Drumdamm",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:0,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:81},envelope2:{attack:0,decay:57,sustain:0,release:52},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Random Zaps",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:44,detune:0,color:53,level:126},filter1:{mode:3,cutoff:80,resonance:51},filter2:{mode:1,cutoff:93,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:0},envelope2:{attack:0,decay:0,sustain:46,release:3},lfo1:{rate:22,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_What They Called Pian",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:32,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:34,level:124},filter1:{mode:1,cutoff:95,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:79,sustain:64,release:69},envelope2:{attack:96,decay:0,sustain:124,release:62},lfo1:{rate:76,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Debil? ICH?",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:52,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:97,resonance:62},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:32,sustain:0,release:64},lfo1:{rate:78,depth:113}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Formants From The Cry",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:17,level:126},osc2:{mode:3,ringMod:!0,transpose:36,detune:4,color:112,level:76},osc3:{mode:1,ringMod:!1,transpose:31,detune:0,color:22,level:27},filter1:{mode:2,cutoff:81,resonance:83},filter2:{mode:1,cutoff:73,resonance:104},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_You broke me!bass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:2,level:11},osc2:{mode:1,ringMod:!1,transpose:0,detune:2,color:0,level:10},osc3:{mode:4,ringMod:!1,transpose:6,detune:0,color:53,level:38},filter1:{mode:1,cutoff:78,resonance:30},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:25,depth:117}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Airy HH003",synthType:"V2",v2:{osc1:{mode:4,transpose:35,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:115,resonance:8},filter2:{mode:1,cutoff:116,resonance:24},routing:{mode:1,balance:64},envelope:{attack:0,decay:55,sustain:24,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:97,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Tag You're Its",synthType:"V2",v2:{osc1:{mode:3,transpose:-6,detune:0,color:60,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:61,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:106,resonance:126},filter2:{mode:3,cutoff:95,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:35,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Slow Synthbrass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-9,color:0,level:126},filter1:{mode:1,cutoff:74,resonance:24},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:45,decay:66,sustain:64,release:73},envelope2:{attack:98,decay:91,sustain:121,release:72},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Random Arp3",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:11,color:18,level:98},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:83},filter2:{mode:0,cutoff:58,resonance:0},routing:{mode:0,balance:64},envelope:{attack:4,decay:50,sustain:0,release:57},envelope2:{attack:0,decay:26,sustain:0,release:31},lfo1:{rate:64,depth:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Analog Mod Bass",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:25,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:19,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:39,resonance:105},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:32,decay:64,sustain:64,release:62},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:97}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_HighSnare02",synthType:"V2",v2:{osc1:{mode:3,transpose:3,detune:0,color:0,level:68},osc2:{mode:3,ringMod:!1,transpose:10,detune:0,color:32,level:64},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:23,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:107,sustain:0,release:64},lfo1:{rate:93,depth:25}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Whistling Wind",synthType:"V2",v2:{osc1:{mode:4,transpose:31,detune:0,color:61,level:126},osc2:{mode:4,ringMod:!1,transpose:-10,detune:-13,color:23,level:126},osc3:{mode:0,ringMod:!1,transpose:24,detune:-5,color:96,level:126},filter1:{mode:4,cutoff:62,resonance:40},filter2:{mode:1,cutoff:80,resonance:53},routing:{mode:1,balance:64},envelope:{attack:46,decay:78,sustain:126,release:66},envelope2:{attack:0,decay:0,sustain:11,release:4},lfo1:{rate:5,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Sweeping Dist",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:11,level:126},osc2:{mode:0,ringMod:!1,transpose:38,detune:0,color:65,level:24},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:126},filter2:{mode:0,cutoff:80,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:30}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lofi Squares",synthType:"V2",v2:{osc1:{mode:3,transpose:10,detune:0,color:72,level:126},osc2:{mode:3,ringMod:!0,transpose:12,detune:-1,color:55,level:126},osc3:{mode:2,ringMod:!1,transpose:4,detune:0,color:65,level:126},filter1:{mode:1,cutoff:52,resonance:104},filter2:{mode:2,cutoff:126,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:41,sustain:43,release:8},envelope2:{attack:0,decay:23,sustain:126,release:14},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Not From This World",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:2,color:52,level:126},osc2:{mode:2,ringMod:!0,transpose:4,detune:13,color:23,level:126},osc3:{mode:5,ringMod:!0,transpose:-24,detune:3,color:56,level:126},filter1:{mode:2,cutoff:50,resonance:53},filter2:{mode:2,cutoff:78,resonance:82},routing:{mode:2,balance:63},envelope:{attack:0,decay:83,sustain:126,release:6},envelope2:{attack:0,decay:41,sustain:126,release:10},lfo1:{rate:9,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:-3,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-3,detune:0,color:96,level:126},osc3:{mode:4,ringMod:!1,transpose:21,detune:0,color:36,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:69,sustain:0,release:55},envelope2:{attack:0,decay:32,sustain:0,release:31},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Mod Perc004",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:10,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:60,resonance:110},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:13,decay:39,sustain:24,release:59},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:0,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nice Saws87",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:13,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-13,color:0,level:126},filter1:{mode:1,cutoff:126,resonance:107},filter2:{mode:2,cutoff:113,resonance:65},routing:{mode:2,balance:64},envelope:{attack:0,decay:66,sustain:19,release:70},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:12,depth:102}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Roaar! 007",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:3,color:126,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:-7,color:126,level:26},filter1:{mode:1,cutoff:62,resonance:75},filter2:{mode:3,cutoff:41,resonance:15},routing:{mode:1,balance:64},envelope:{attack:20,decay:64,sustain:126,release:20},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Dist Kick",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_XPlosion007",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:-46,detune:0,color:65,level:126},osc3:{mode:0,ringMod:!1,transpose:-11,detune:0,color:32,level:14},filter1:{mode:1,cutoff:92,resonance:0},filter2:{mode:1,cutoff:25,resonance:10},routing:{mode:1,balance:64},envelope:{attack:0,decay:96,sustain:0,release:96},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Whistlotronic",synthType:"V2",v2:{osc1:{mode:2,transpose:12,detune:0,color:66,level:127},osc2:{mode:0,ringMod:!1,transpose:7,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:4,detune:0,color:27,level:126},filter1:{mode:2,cutoff:86,resonance:0},filter2:{mode:2,cutoff:116,resonance:0},routing:{mode:2,balance:21},envelope:{attack:34,decay:64,sustain:53,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:99,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Tech Arp100",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:13,resonance:32},filter2:{mode:2,cutoff:29,resonance:104},routing:{mode:2,balance:78},envelope:{attack:0,decay:48,sustain:18,release:23},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:1,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Mightyass1",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:9,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:47},filter1:{mode:1,cutoff:25,resonance:69},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:105,sustain:6,release:81},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Rim#003",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:6,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:38,detune:0,color:0,level:121},filter1:{mode:0,cutoff:73,resonance:117},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:11,sustain:0,release:0},envelope2:{attack:0,decay:6,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Hell's Bell",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:91,level:28},osc2:{mode:5,ringMod:!1,transpose:23,detune:50,color:30,level:126},osc3:{mode:3,ringMod:!0,transpose:-64,detune:0,color:102,level:24},filter1:{mode:1,cutoff:80,resonance:106},filter2:{mode:3,cutoff:37,resonance:77},routing:{mode:1,balance:64},envelope:{attack:0,decay:65,sustain:126,release:77},envelope2:{attack:0,decay:46,sustain:15,release:13},lfo1:{rate:28,depth:52}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Farscape04",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:4,ringMod:!1,transpose:-44,detune:-10,color:0,level:6},osc3:{mode:3,ringMod:!1,transpose:0,detune:1,color:32,level:126},filter1:{mode:1,cutoff:86,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:80,decay:64,sustain:112,release:94},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:27,depth:109}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lethal PWM0",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:80,resonance:0},filter2:{mode:5,cutoff:114,resonance:91},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:116,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:68,depth:34}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Soaring#088",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-4,color:126,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:-11,color:0,level:126},filter1:{mode:1,cutoff:33,resonance:51},filter2:{mode:1,cutoff:77,resonance:115},routing:{mode:1,balance:64},envelope:{attack:0,decay:126,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:8,depth:46}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_Trombrato02",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:14,color:0,level:121},osc2:{mode:0,ringMod:!1,transpose:0,detune:-15,color:0,level:82},osc3:{mode:0,ringMod:!1,transpose:12,detune:2,color:0,level:76},filter1:{mode:1,cutoff:70,resonance:0},filter2:{mode:1,cutoff:70,resonance:23},routing:{mode:1,balance:64},envelope:{attack:46,decay:64,sustain:121,release:20},envelope2:{attack:94,decay:125,sustain:125,release:26},lfo1:{rate:0,depth:17}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noiseh #004",synthType:"V2",v2:{osc1:{mode:4,transpose:5,detune:0,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:67,resonance:83},filter2:{mode:2,cutoff:86,resonance:66},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:113,release:26},envelope2:{attack:0,decay:25,sustain:20,release:121},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Disturbing7",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:122},osc2:{mode:4,ringMod:!1,transpose:52,detune:0,color:32,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:122},filter1:{mode:2,cutoff:89,resonance:89},filter2:{mode:2,cutoff:78,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:77,sustain:123,release:0},envelope2:{attack:0,decay:106,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Bontempi002",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:5,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:2,cutoff:45,resonance:0},filter2:{mode:0,cutoff:47,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:41,release:70},envelope2:{attack:0,decay:64,sustain:64,release:90},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_FlangeHats2",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Screeeam!IKAAAA!!!",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-17,color:63,level:55},osc2:{mode:1,ringMod:!1,transpose:12,detune:-43,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:92,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:14,decay:64,sustain:64,release:42},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:82,depth:87}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Kick075",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Synth Jew's Harp",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:5,level:123},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},filter1:{mode:2,cutoff:9,resonance:113},filter2:{mode:1,cutoff:81,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:27},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Snaree",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:124},osc2:{mode:4,ringMod:!1,transpose:25,detune:0,color:102,level:108},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:0,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:39,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Cheap Arp08",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:14,color:0,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:1,cutoff:83,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:42,sustain:38,release:71},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 HHs 104",synthType:"V2",v2:{osc1:{mode:2,transpose:4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:24,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:3,cutoff:104,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_VeloFuzz001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:1,color:0,level:126},osc2:{mode:2,ringMod:!0,transpose:24,detune:14,color:63,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:4,resonance:116},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Hefty Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:-54,detune:3,color:70,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:0,color:65,level:126},filter1:{mode:1,cutoff:122,resonance:11},filter2:{mode:3,cutoff:41,resonance:42},routing:{mode:1,balance:64},envelope:{attack:0,decay:98,sustain:126,release:47},envelope2:{attack:0,decay:54,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_yasgch #005",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:9,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:59},filter2:{mode:0,cutoff:59,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:118,sustain:114,release:35},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Synth Kick",synthType:"V2",v2:{osc1:{mode:1,transpose:-3,detune:0,color:61,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:0,cutoff:27,resonance:56},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:34,sustain:0,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Hihats 2",synthType:"V2",v2:{osc1:{mode:2,transpose:-10,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:91},filter2:{mode:2,cutoff:108,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 1001",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:26,resonance:126},filter2:{mode:2,cutoff:25,resonance:126},routing:{mode:1,balance:64},envelope:{attack:0,decay:61,sustain:0,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 13",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:3,ringMod:!1,transpose:0,detune:7,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:60},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:76,depth:104}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 28",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:70,sustain:0,release:92},envelope2:{attack:0,decay:37,sustain:0,release:40},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistSnare11",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:32,level:0},osc2:{mode:3,ringMod:!1,transpose:8,detune:36,color:32,level:0},osc3:{mode:4,ringMod:!1,transpose:35,detune:0,color:70,level:124},filter1:{mode:5,cutoff:73,resonance:115},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:56,sustain:0,release:65},envelope2:{attack:0,decay:15,sustain:0,release:0},lfo1:{rate:64,depth:105}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 Ride",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:14},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:18},osc3:{mode:4,ringMod:!1,transpose:50,detune:0,color:66,level:123},filter1:{mode:3,cutoff:124,resonance:0},filter2:{mode:2,cutoff:104,resonance:100},routing:{mode:1,balance:64},envelope:{attack:0,decay:54,sustain:0,release:75},envelope2:{attack:0,decay:64,sustain:123,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 HHs + Dis",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 1 #000",synthType:"V2",v2:{osc1:{mode:3,transpose:-7,detune:0,color:32,level:127},osc2:{mode:3,ringMod:!1,transpose:-7,detune:9,color:32,level:127},osc3:{mode:4,ringMod:!1,transpose:29,detune:0,color:64,level:0},filter1:{mode:0,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:47,sustain:0,release:43},envelope2:{attack:0,decay:46,sustain:1,release:75},lfo1:{rate:90,depth:107}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:4,detune:-64,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:-1,detune:-13,color:32,level:91},osc3:{mode:4,ringMod:!1,transpose:-11,detune:44,color:0,level:34},filter1:{mode:1,cutoff:68,resonance:0},filter2:{mode:2,cutoff:84,resonance:63},routing:{mode:2,balance:15},envelope:{attack:0,decay:0,sustain:65,release:64},envelope2:{attack:0,decay:63,sustain:99,release:76},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_March Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:6,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:12,detune:1,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Nice Synth HH",synthType:"V2",v2:{osc1:{mode:4,transpose:53,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:121,resonance:121},filter2:{mode:1,cutoff:117,resonance:114},routing:{mode:2,balance:64},envelope:{attack:0,decay:20,sustain:20,release:8},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Crash",synthType:"V2",v2:{osc1:{mode:4,transpose:62,detune:62,color:106,level:126},osc2:{mode:4,ringMod:!1,transpose:62,detune:50,color:51,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:26,color:108,level:126},filter1:{mode:3,cutoff:126,resonance:55},filter2:{mode:1,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:47,sustain:21,release:77},envelope2:{attack:0,decay:113,sustain:70,release:124},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Open HH",synthType:"V2",v2:{osc1:{mode:4,transpose:36,detune:0,color:82,level:126},osc2:{mode:0,ringMod:!1,transpose:9,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:112,resonance:106},filter2:{mode:0,cutoff:104,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:44,sustain:0,release:32},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Pop BD #003",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:121},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:36,detune:0,color:90,level:0},filter1:{mode:1,cutoff:121,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:0,release:52},envelope2:{attack:0,decay:23,sustain:0,release:0},lfo1:{rate:80,depth:84}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Snappy Snare",synthType:"V2",v2:{osc1:{mode:1,transpose:-10,detune:0,color:72,level:126},osc2:{mode:5,ringMod:!1,transpose:0,detune:0,color:64,level:38},osc3:{mode:4,ringMod:!1,transpose:33,detune:0,color:76,level:126},filter1:{mode:3,cutoff:53,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:45,sustain:0,release:19},envelope2:{attack:0,decay:18,sustain:0,release:0},lfo1:{rate:105,depth:11}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Ver|bt Snare",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:60,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:-21,color:126,level:88},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:82,resonance:126},filter2:{mode:1,cutoff:22,resonance:126},routing:{mode:2,balance:17},envelope:{attack:0,decay:0,sustain:126,release:14},envelope2:{attack:0,decay:83,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #100",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #101",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #102",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #103",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #104",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #105",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #106",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #107",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #108",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #109",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #110",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #111",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #112",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #113",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #114",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #115",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #116",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #117",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #118",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #119",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #120",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #121",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #122",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #123",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #124",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #125",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #126",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #127",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0}],px=[{type:"synth",name:"SAM_Classic",synthType:"Sam",sam:{text:"SAM IS BACK",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_C64",synthType:"Sam",sam:{text:"COMMODORE SIXTY FOUR",pitch:64,speed:64,mouth:150,throat:110,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_Robotic",synthType:"Sam",sam:{text:"EXTERMINATE",pitch:40,speed:80,mouth:200,throat:200,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_High",synthType:"Sam",sam:{text:"I HAVE A HIGH VOICE",pitch:100,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0}],hx=[{type:"synth",name:"Astrocade Clean Square",synthType:"MAMEAstrocade",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Vibrato Lead",synthType:"MAMEAstrocade",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Buzz",synthType:"MAMEAstrocade",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Rumble",synthType:"MAMEAstrocade",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Laser",synthType:"MAMESN76477",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Explosion",synthType:"MAMESN76477",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Engine",synthType:"MAMESN76477",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Siren",synthType:"MAMESN76477",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Organ",synthType:"MAMEMSM5232",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Full Brass",synthType:"MAMEMSM5232",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Strings",synthType:"MAMEMSM5232",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Reedy Combo",synthType:"MAMEMSM5232",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Piano",synthType:"MAMETMS36XX",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Banjo",synthType:"MAMETMS36XX",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Organ",synthType:"MAMETMS36XX",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Sine",synthType:"MAMESNKWave",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Square",synthType:"MAMESNKWave",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Triangle",synthType:"MAMESNKWave",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"YMOPQ E.Piano",synthType:"MAMEYMOPQ",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Brass",synthType:"MAMEYMOPQ",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Strings",synthType:"MAMEYMOPQ",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bass",synthType:"MAMEYMOPQ",parameters:{_program:3},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Organ",synthType:"MAMEYMOPQ",parameters:{_program:4},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Lead",synthType:"MAMEYMOPQ",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Pad",synthType:"MAMEYMOPQ",parameters:{_program:6},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bell",synthType:"MAMEYMOPQ",parameters:{_program:7},effects:[],volume:-8,pan:0},{type:"synth",name:"MEA8000 Vowel A",synthType:"MAMEMEA8000",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel E",synthType:"MAMEMEA8000",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel O",synthType:"MAMEMEA8000",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Nasal",synthType:"MAMEMEA8000",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel AH",synthType:"MAMESP0250",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel EE",synthType:"MAMESP0250",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel OO",synthType:"MAMESP0250",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax EH",synthType:"MAMEVotrax",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AW",synthType:"MAMEVotrax",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AH",synthType:"MAMEVotrax",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax OO",synthType:"MAMEVotrax",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"ES5503 Default",synthType:"MAMEES5503",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"YMF271 FM Piano",synthType:"MAMEYMF271",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Brass",synthType:"MAMEYMF271",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Strings",synthType:"MAMEYMF271",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"TR707 Default Kit",synthType:"MAMETR707",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Bass",synthType:"MAMEVASynth",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Lead",synthType:"MAMEVASynth",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pad",synthType:"MAMEVASynth",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pluck",synthType:"MAMEVASynth",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"TIA Square",synthType:"MAMETIA",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TIA Buzz",synthType:"MAMETIA",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD931 Default",synthType:"MAMEUPD931",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD933 Default",synthType:"MAMEUPD933",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS5220 Speech",synthType:"MAMETMS5220",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Sine",synthType:"MAMEASC",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Square",synthType:"MAMEASC",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"AICA Default",synthType:"MAMEAICA",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"SCSP Default",synthType:"SCSP",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"C352 Default",synthType:"MAMEC352",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"RF5C400 Default",synthType:"MAMERF5C400",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"ICS2115 Default",synthType:"MAMEICS2115",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"K054539 Default",synthType:"MAMEK054539",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Bass",synthType:"CEM3394",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"CEM3394 Lead",synthType:"CEM3394",parameters:{_program:1,volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Pad",synthType:"CEM3394",parameters:{_program:2,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"SCSP Synth Bass",synthType:"SCSP",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"SCSP Poly Pad",synthType:"SCSP",parameters:{_program:1,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"AICA FM Piano",synthType:"MAMEAICA",parameters:{_program:0,volume:.8},effects:[],volume:-10,pan:0}],fx=(e,t,n=0,s=7)=>({level:e,coarse:t,fine:n,detune:s,egRates:[99,99,99,99],egLevels:[99,99,99,0]}),gx=[{name:"DX7 E.Piano 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Cd["E.PIANO 1"]},{name:"DX7 E.Piano Bright",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{...Cd["E.PIANO 1"],feedback:7}},{name:"DX7 Clavinet",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,60,30,60],egLevels:[99,0,0,0]},{level:80,coarse:2,egRates:[99,50,20,50],egLevels:[99,0,0,0]},fx(0,1),fx(0,1),fx(0,1),fx(0,1)]}},{name:"DX7 Organ",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:3,feedback:0,operators:[{level:99,coarse:1},{level:90,coarse:2},{level:85,coarse:3},{level:80,coarse:4},fx(0,1),fx(0,1)]}},{name:"DX7 Bass 1",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:5,feedback:7,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:75,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:50,coarse:2,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},fx(0,1),fx(0,1),fx(0,1)]}},{name:"DX7 Slap Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:16,feedback:6,operators:[{level:99,coarse:1,egRates:[99,60,40,60],egLevels:[99,95,0,0]},{level:88,coarse:4,egRates:[99,80,60,80],egLevels:[99,0,0,0]},fx(0,1),fx(0,1),fx(0,1),fx(0,1)]}},{name:"DX7 Solid Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:18,feedback:4,operators:[{level:99,coarse:0,fine:50},{level:80,coarse:1},{level:70,coarse:1},fx(0,1),fx(0,1),fx(0,1)]}},{name:"DX7 Tubular Bells",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:1,feedback:5,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,40,20,50],egLevels:[99,0,0,0]},{level:85,coarse:3,fine:50,detune:7,egRates:[99,60,30,50],egLevels:[99,0,0,0]},fx(0,1),fx(0,1),fx(0,1),fx(0,1)]}},{name:"DX7 Marimba",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,70,30,60],egLevels:[99,0,0,0]},{level:80,coarse:4,egRates:[99,60,20,50],egLevels:[99,0,0,0]},fx(0,1),fx(0,1),fx(0,1),fx(0,1)]}},{name:"DX7 Brass 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Cd["BRASS 1"]},{name:"DX7 Strings 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Cd["STRINGS 1"]},{name:"DX7 Init Voice",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Cd["INIT VOICE"]}],bx=[{name:"OB-X Classic Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Em["Classic Brass"]},{name:"OB-X Bright Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{...Em["Classic Brass"],filterCutoff:.6,filterEnvAmount:.7,unison:!0,unisonDetune:.1}},{name:"OB-X Fat Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Em["Fat Lead"]},{name:"OB-X Sync Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Em["Sync Lead"]},{name:"OB-X Unison Saw",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,unison:!0,unisonDetune:.2,panSpread:.5,filterCutoff:1,ampRelease:.2}},{name:"OB-X Rez Bass",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:1,osc2Detune:.08,filterCutoff:.3,filterResonance:.6,filterEnvAmount:.7,filterAttack:.05,filterDecay:.2,ampAttack:.01,ampDecay:.3}},{name:"OB-X Sub Bass",type:"synth",synthType:"OBXd",volume:-6,pan:0,effects:[],obxd:{osc1Waveform:2,osc2Waveform:0,osc2Octave:-1,filterCutoff:.2,filterResonance:0,filterEnvAmount:.3,filterDecay:.4}},{name:"OB-X PWM Strings",type:"synth",synthType:"OBXd",volume:-12,pan:0,effects:[],obxd:{osc1Waveform:1,osc2Waveform:1,osc1PulseWidth:.5,osc2Detune:.03,lfoRate:.2,lfoPwAmount:.4,filterCutoff:.4,filterResonance:.1,ampAttack:.2,ampRelease:.5}},{name:"OB-X Pulse Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Em["Pulse Pad"]},{name:"OB-X Sweep Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,filterCutoff:.3,filterResonance:.5,lfoRate:.1,lfoFilterAmount:.4,ampAttack:.5,ampRelease:.8}},{name:"OB-X S&H Sci-Fi",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:1,lfoWaveform:4,lfoRate:.7,lfoFilterAmount:.8,lfoOscAmount:.3,filterResonance:.7}},{name:"OB-X Init",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Em.Init}],vx=[{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:nc.NES}},{name:"NES Pulse 12.5%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:nc.NES,nes:{dutyNoise:0,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Pulse 25%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:nc.NES,nes:{dutyNoise:1,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Triangle Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:nc.NES}},{name:"NES Noise Drums",type:"synth",synthType:"FurnaceNES",volume:-10,pan:0,effects:[],furnace:{chipType:nc.NES}},{name:"MMC5 Expansion Init",type:"synth",synthType:"FurnaceMMC5",volume:-8,pan:0,effects:[],furnace:{chipType:nc.MMC5}},{name:"GB Pulse 50%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:nc.GB}},{name:"GB Pulse 25%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:nc.GB}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:nc.GB}},{name:"GB Noise Snare",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:nc.GB}},{name:"GB Wave Organ",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:nc.GB}},{name:"GB Noise HiHat",type:"synth",synthType:"FurnaceGB",volume:-12,pan:0,effects:[],furnace:{chipType:nc.GB}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:nc.PSG}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:nc.PSG}},{name:"PSG Periodic Noise",type:"synth",synthType:"FurnacePSG",volume:-10,pan:0,effects:[],furnace:{chipType:nc.PSG}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:nc.PCE}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:nc.PCE}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:nc.VIC}},{name:"VIC Noise",type:"synth",synthType:"FurnaceVIC",volume:-10,pan:0,effects:[],furnace:{chipType:nc.VIC}},{name:"TIA Square",type:"synth",synthType:"FurnaceTIA",volume:-8,pan:0,effects:[],furnace:{chipType:nc.TIA}},{name:"TIA Bass",type:"synth",synthType:"FurnaceTIA",volume:-6,pan:0,effects:[],furnace:{chipType:nc.TIA}},{name:"OPL3 FM Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:nc.OPL3,algorithm:0,feedback:6}},{name:"OPL3 FM Strings",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:nc.OPL3,algorithm:1,feedback:2}},{name:"OPL3 FM Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:nc.OPL3,algorithm:0,feedback:4}},{name:"Amiga ST-01 Bass",type:"synth",synthType:"FurnaceAMIGA",volume:-6,pan:0,effects:[],furnace:{chipType:nc.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Lead Strings",type:"synth",synthType:"FurnaceAMIGA",volume:-8,pan:0,effects:[],furnace:{chipType:nc.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Poly Pad",type:"synth",synthType:"FurnaceAMIGA",volume:-10,pan:0,effects:[],furnace:{chipType:nc.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"PET Bleep",type:"synth",synthType:"FurnacePET",volume:-10,pan:0,effects:[],furnace:{chipType:nc.PET}},{name:"PC Speaker Beeper",type:"synth",synthType:"FurnacePCSPKR",volume:-10,pan:0,effects:[],furnace:{chipType:nc.PCSPKR}},{name:"ZX Beeper QuadTone",type:"synth",synthType:"FurnaceZXBEEPER",volume:-10,pan:0,effects:[],furnace:{chipType:nc.ZXBEEPER_QT}},{name:"C64 Pulse Lead",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1200,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Saw Lead",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Bass",type:"synth",synthType:"FurnaceC64",volume:-6,pan:0,effects:[],furnace:{chipType:nc.SID,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:14,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:512,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Arp",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:4,s:0,r:2,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Noise Drum",type:"synth",synthType:"FurnaceC64",volume:-6,pan:0,effects:[],furnace:{chipType:nc.SID,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:4,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:2,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Pad",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:nc.SID,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:8,d:6,s:10,r:10,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:700,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 Saw+Pulse",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID_6581,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:0,d:8,s:10,r:6,duty:1536,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:900,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 Triangle Sub",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:nc.SID_6581,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:10,s:15,r:4,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 Dirty Reso",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID_6581,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:10,s:8,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:600,filterResonance:14,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 PWM Throb",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID_6581,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:4,d:6,s:12,r:8,duty:512,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:700,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Clean Pulse",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID_8580,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1400,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Bandpass",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SID_8580,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:10,filterLP:!1,filterBP:!0,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Ring Mod",type:"synth",synthType:"FurnaceSID8580",volume:-10,pan:0,effects:[],furnace:{chipType:nc.SID_8580,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:8,s:8,r:6,duty:0,ringMod:!0,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Noise Perc",type:"synth",synthType:"FurnaceSID8580",volume:-6,pan:0,effects:[],furnace:{chipType:nc.SID_8580,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:3,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1e3,filterResonance:2,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"GBA Synth Bass",type:"synth",synthType:"FurnaceGBA",volume:-8,pan:0,effects:[],furnace:{chipType:nc.GBA_DMA}},{name:"GBA Lead Strings",type:"synth",synthType:"FurnaceGBA",volume:-10,pan:0,effects:[],furnace:{chipType:nc.GBA_DMA}},{name:"NDS Piano",type:"synth",synthType:"FurnaceNDS",volume:-10,pan:0,effects:[],furnace:{chipType:nc.NDS}},{name:"NDS Pad",type:"synth",synthType:"FurnaceNDS",volume:-12,pan:0,effects:[],furnace:{chipType:nc.NDS}},{name:"Virtual Boy Lead",type:"synth",synthType:"FurnaceVB",volume:-10,pan:0,effects:[],furnace:{chipType:nc.VB}},{name:"WonderSwan Wave",type:"synth",synthType:"FurnaceSWAN",volume:-10,pan:0,effects:[],furnace:{chipType:nc.SWAN}},{name:"Atari Lynx Pulse",type:"synth",synthType:"FurnaceLynx",volume:-10,pan:0,effects:[],furnace:{chipType:nc.LYNX}},{name:"Neo Geo Pocket Bass",type:"synth",synthType:"FurnaceT6W28",volume:-8,pan:0,effects:[],furnace:{chipType:nc.T6W28}},{name:"QSound Fat Bass",type:"synth",synthType:"FurnaceQSOUND",volume:-6,pan:0,effects:[],furnace:{chipType:nc.QSOUND}},{name:"Sega MultiPCM Strings",type:"synth",synthType:"FurnaceMULTIPCM",volume:-10,pan:0,effects:[],furnace:{chipType:nc.MULTIPCM}},{name:"Sega PCM Lead",type:"synth",synthType:"FurnaceSEGAPCM",volume:-8,pan:0,effects:[],furnace:{chipType:nc.SEGAPCM}},{name:"Namco C140 Drum",type:"synth",synthType:"FurnaceC140",volume:-6,pan:0,effects:[],furnace:{chipType:nc.C140}},{name:"OKI MSM6295 Kick",type:"synth",synthType:"FurnaceOKI",volume:-4,pan:0,effects:[],furnace:{chipType:nc.OKI}},{name:"OKI MSM6258 Snare",type:"synth",synthType:"FurnaceMSM6258",volume:-6,pan:0,effects:[],furnace:{chipType:nc.MSM6258}},{name:"YM2203 FM Bass",type:"synth",synthType:"FurnaceOPN2203",volume:-8,pan:0,effects:[],furnace:{chipType:nc.OPN,algorithm:4,feedback:5}},{name:"YM2608 FM Strings",type:"synth",synthType:"FurnaceOPNA",volume:-10,pan:0,effects:[],furnace:{chipType:nc.OPNA,algorithm:5,feedback:3}},{name:"YM2610 FM Lead",type:"synth",synthType:"FurnaceOPNB",volume:-8,pan:0,effects:[],furnace:{chipType:nc.OPNB,algorithm:4,feedback:6}},{name:"YMF278B FM Piano",type:"synth",synthType:"FurnaceOPL4",volume:-10,pan:0,effects:[],furnace:{chipType:nc.OPL4,algorithm:4,feedback:2}},{name:"VRC7 FM Brass",type:"synth",synthType:"FurnaceVRC7",volume:-10,pan:0,effects:[],furnace:{chipType:nc.OPLL,algorithm:0,feedback:4}}],yx="/data/samples/packs/st-01",xx="/data/samples/packs/st-02",Nx=[{name:"Amiga Kick 1",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/BassDrum1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Kick 2",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/BassDrum2.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Kick Deep",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/BassDrum4.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Snare 1",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${yx}/Snare1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Snare 2",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${yx}/Snare2.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Pop Snare",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${yx}/PopSnare1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga HiHat",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/HiHat1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Closed Hat",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/CloseHiHat.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Claps",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${yx}/Claps1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Deep Bass",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/DeepBass.wav`,baseNote:"C2",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Filter Bass",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/FilterBass.wav`,baseNote:"C2",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Funk Bass",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/FunkBass.wav`,baseNote:"C2",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Slap Bass",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/SlapBass.wav`,baseNote:"C2",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Synthe Bass",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${yx}/SyntheBass.wav`,baseNote:"C2",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Mini Moog Bass",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${xx}/MiniMoog.wav`,baseNote:"C2",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Strings 1",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Strings1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Strings 2",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Strings2.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Rich String",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/RichString.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Analog String",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/AnalogString.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga PolySync",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/PolySynth.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Heavy Synth",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/HeavySynth.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga E-Piano",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/EPiano.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Steinway",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Steinway.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Synth Piano",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/SynthPiano.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Brass",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/HallBrass.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Syn Brass",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/SynBrass.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Organ",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Organ.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Marimba",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${yx}/Marimba.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Dream Bells",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${yx}/DreamBells.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Koto",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Koto.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Pan Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/PanFlute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Voices",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Voices.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Kermit 1",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${xx}/kermie1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Kermit 2",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${xx}/kermie2.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Kermit 3",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${xx}/kermie3.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Kermit 5 Long",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${xx}/kermie5.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Sweep",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Sweep.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Blast",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${yx}/Blast.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Amiga Siren",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${xx}/Siren.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}}],wx="/data/samples/packs/casio-mt40/leads",Ex="/data/samples/packs/drumnibus",kx=[...Nx,{name:"MT-40 Accordion",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/accordion.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Brass",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/brass.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Clarinet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/clarinet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Elec Piano",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/elec piano.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Harpsichord",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/harpsichord.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Pipe Organ",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/pipe-organ.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Trumpet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/trumpet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Violin",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/violin.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Celesta",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${wx}/celesta.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Funny Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/funny fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Xylophone",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/xylophone.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Gloken",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${wx}/glocken.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Folk Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/folk flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 ST Ensemble",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${wx}/st ensemble.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Synth Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${wx}/synth fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Kick 1",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${Ex}/kicks/BD_808A1200.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Analog",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Ex}/snares/SD_Analog_Noise1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Wolf",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Ex}/snares/SD_Wolf1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Percussion Tom",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Ex}/percussion/TOM_Magnotron.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus HiHat Digidap",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Ex}/hihats/CH_Digidap.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Player Analog Kick",type:"synth",synthType:"Player",volume:-6,pan:0,effects:[],parameters:{sampleUrl:`${Ex}/kicks/BD_808A1200.wav`}},{name:"Player Analog Snare",type:"synth",synthType:"Player",volume:-8,pan:0,effects:[],parameters:{sampleUrl:`${Ex}/snares/SD_Analog_Noise1.wav`}},{name:"Player Sci-Fi FX",type:"synth",synthType:"Player",volume:-10,pan:0,effects:[],parameters:{sampleUrl:`${Ex}/fx/FX_AnalogFX1.wav`}},{name:"Granular Casio Flute",type:"synth",synthType:"GranularSynth",volume:-10,pan:0,effects:[],granular:{sampleUrl:`${wx}/flute.wav`,grainSize:100,grainOverlap:50,detune:10,randomPitch:20,density:8,scanSpeed:10,playbackRate:1,randomPosition:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"Granular Drumnibus Texture",type:"synth",synthType:"GranularSynth",volume:-12,pan:0,effects:[],granular:{sampleUrl:`${Ex}/fx/FX_Blarper.wav`,grainSize:200,grainOverlap:10,detune:-5,randomPosition:30,density:12,scanSpeed:5,playbackRate:1,randomPitch:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"MT-40 Full Lead Set",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:"",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1,multiMap:{C2:`${wx}/bass.wav`,C3:`${wx}/cello.wav`,C4:`${wx}/elec piano.wav`,C5:`${wx}/glocken.wav`,C6:`${wx}/funny fuzz.wav`}}}],Dx=[{name:"Wavetable Bell",type:"synth",synthType:"Wavetable",volume:-12,pan:0,effects:[],wavetable:{wavetableId:"bell-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:1,detune:0,stereoSpread:0},envelope:{attack:10,decay:1e3,sustain:0,release:100},filter:{type:"lowpass",cutoff:12e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Brass",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"brass-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:2,detune:10,stereoSpread:50},envelope:{attack:50,decay:500,sustain:50,release:200},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:30},filterEnvelope:{attack:100,decay:300,sustain:0,release:100}}},{name:"Wavetable Choir",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"choir-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:4,detune:15,stereoSpread:80},envelope:{attack:200,decay:500,sustain:100,release:500},filter:{type:"lowpass",cutoff:4e3,resonance:5,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Heavy Bass",type:"synth",synthType:"Wavetable",volume:-8,pan:0,effects:[],wavetable:{wavetableId:"m4-bass01",morphPosition:0,morphModSource:"envelope",morphModAmount:50,morphLFORate:0,unison:{voices:2,detune:15,stereoSpread:40},envelope:{attack:5,decay:400,sustain:20,release:150},filter:{type:"lowpass",cutoff:2e3,resonance:40,envelopeAmount:60},filterEnvelope:{attack:10,decay:300,sustain:0,release:100}}}],Sx={"Soft Clip":{machineType:Fu.ARGURU_DISTORTION,parameters:{0:256,1:1024,2:1024,3:1024,4:0,5:0}},"Hard Clip":{machineType:Fu.ARGURU_DISTORTION,parameters:{0:512,1:256,2:256,3:768,4:0,5:0}},"Heavy Saturate":{machineType:Fu.ARGURU_DISTORTION,parameters:{0:768,1:512,2:512,3:1280,4:0,5:1}}},Mx={"Low Pass":{machineType:Fu.ELAK_SVF,parameters:{0:500,1:512}},"Low Pass Resonant":{machineType:Fu.ELAK_SVF,parameters:{0:300,1:40960}},"High Pass":{machineType:Fu.ELAK_SVF,parameters:{0:700,1:1024}}},Cx={[Fu.ARGURU_DISTORTION]:Sx,[Fu.ELAK_SVF]:Mx,[Fu.FSM_KICK]:{"Hard Kick":{machineType:Fu.FSM_KICK,parameters:{0:100,1:80}},"Soft Kick":{machineType:Fu.FSM_KICK,parameters:{0:60,1:40}},"Long 808-ish":{machineType:Fu.FSM_KICK,parameters:{0:80,1:120}}},[Fu.FSM_KICKXP]:{"Init KickXP":{machineType:Fu.FSM_KICKXP,parameters:{}},"Extreme Kick":{machineType:Fu.FSM_KICKXP,parameters:{0:127,1:127}}},[Fu.JESKOLA_TRILOK]:{"Punchy BD":{machineType:Fu.JESKOLA_TRILOK,parameters:{0:80,1:60}},"Deep BD":{machineType:Fu.JESKOLA_TRILOK,parameters:{0:40,1:90}}},[Fu.JESKOLA_NOISE]:{"White Noise":{machineType:Fu.JESKOLA_NOISE,parameters:{0:0}},"Pink Noise":{machineType:Fu.JESKOLA_NOISE,parameters:{0:1}},"Noisy FX":{machineType:Fu.JESKOLA_NOISE,parameters:{0:2,1:100}}},[Fu.OOMEK_AGGRESSOR]:{"Acid Bass":{machineType:Fu.OOMEK_AGGRESSOR,parameters:{1:120,2:96,3:80,4:64}},"Squelchy Lead":{machineType:Fu.OOMEK_AGGRESSOR,parameters:{1:160,2:127,3:96,4:80}},"Soft Sub":{machineType:Fu.OOMEK_AGGRESSOR,parameters:{1:48,2:32,3:32,4:96}}},[Fu.OOMEK_AGGRESSOR_DF]:{"DF Screamer":{machineType:Fu.OOMEK_AGGRESSOR_DF,parameters:{1:176,2:127,13:1,15:2}},"DF Infinite":{machineType:Fu.OOMEK_AGGRESSOR_DF,parameters:{1:96,10:100,9:127}}},[Fu.MADBRAIN_4FM2F]:{"FM Bass":{machineType:Fu.MADBRAIN_4FM2F,parameters:{0:10,1:80,2:40}},"FM Lead":{machineType:Fu.MADBRAIN_4FM2F,parameters:{0:40,1:100,2:60}},"FM Pad":{machineType:Fu.MADBRAIN_4FM2F,parameters:{0:60,1:50,2:100}}},[Fu.MADBRAIN_DYNAMITE6]:{"Additive Lead":{machineType:Fu.MADBRAIN_DYNAMITE6,parameters:{0:80,1:40}},"Organ-like":{machineType:Fu.MADBRAIN_DYNAMITE6,parameters:{0:60,1:100}}},[Fu.MAKK_M3]:{"M3 Lead":{machineType:Fu.MAKK_M3,parameters:{0:64,1:64}},"M3 Bass":{machineType:Fu.MAKK_M3,parameters:{0:127,1:32}}},[Fu.MAKK_M4]:{"M4 Wavetable":{machineType:Fu.MAKK_M4,parameters:{0:0}},"M4 Sweep":{machineType:Fu.MAKK_M4,parameters:{0:50,1:100}}},[Fu.CYANPHASE_DTMF]:{"Phone Tones":{machineType:Fu.CYANPHASE_DTMF,parameters:{}}},[Fu.ELENZIL_FREQUENCYBOMB]:{"Freq Bomb":{machineType:Fu.ELENZIL_FREQUENCYBOMB,parameters:{0:100}}},[Fu.ELAK_DIST2]:{},[Fu.JESKOLA_DISTORTION]:{},[Fu.GEONIK_OVERDRIVE]:{},[Fu.GRAUE_SOFTSAT]:{},[Fu.WHITENOISE_STEREODIST]:{},[Fu.CYANPHASE_NOTCH]:{},[Fu.Q_ZFILTER]:{},[Fu.FSM_PHILTA]:{},[Fu.JESKOLA_DELAY]:{},[Fu.JESKOLA_CROSSDELAY]:{},[Fu.JESKOLA_FREEVERB]:{},[Fu.FSM_PANZERDELAY]:{},[Fu.FSM_CHORUS]:{},[Fu.FSM_CHORUS2]:{},[Fu.WHITENOISE_WHITECHORUS]:{},[Fu.BIGYO_FREQUENCYSHIFTER]:{},[Fu.GEONIK_COMPRESSOR]:{},[Fu.LD_SLIMIT]:{},[Fu.OOMEK_EXCITER]:{},[Fu.OOMEK_MASTERIZER]:{},[Fu.DEDACODE_STEREOGAIN]:{}};function Vx(e){return Object.keys(function(e){return Cx[e]||{}}(e))}const Px=[Fu.FSM_KICK,Fu.FSM_KICKXP,Fu.JESKOLA_TRILOK,Fu.JESKOLA_NOISE,Fu.OOMEK_AGGRESSOR,Fu.OOMEK_AGGRESSOR_DF,Fu.MADBRAIN_4FM2F,Fu.MADBRAIN_DYNAMITE6,Fu.MAKK_M3,Fu.MAKK_M4,Fu.CYANPHASE_DTMF,Fu.ELENZIL_FREQUENCYBOMB],_x=[];for(const _0 of Px){const e=Cx[_0];if(e)for(const[t,n]of Object.entries(e)){const e=`Buzz ${t}`;_x.push({name:e,type:"synth",synthType:`Buzz${Ox(_0)}`,volume:-10,pan:0,effects:[],parameters:n.parameters})}}function Ox(e){switch(e){case Fu.FSM_KICK:return"Kick";case Fu.FSM_KICKXP:return"KickXP";case Fu.JESKOLA_TRILOK:return"Trilok";case Fu.JESKOLA_NOISE:return"Noise";case Fu.OOMEK_AGGRESSOR:return"3o3";case Fu.OOMEK_AGGRESSOR_DF:return"3o3DF";case Fu.MADBRAIN_4FM2F:return"4FM2F";case Fu.MADBRAIN_DYNAMITE6:return"Dynamite6";case Fu.MAKK_M3:return"M3";case Fu.MAKK_M4:return"M4";case Fu.CYANPHASE_DTMF:return"DTMF";case Fu.ELENZIL_FREQUENCYBOMB:return"FreqBomb";default:return e}}const Tx=[{name:"M4 Deep Bass",type:"synth",synthType:"BuzzM4",volume:-8,pan:0,effects:[],parameters:{0:1,1:64,2:32,3:80}},{name:"M4 Sub Bass",type:"synth",synthType:"BuzzM4",volume:-6,pan:0,effects:[],parameters:{0:5,1:0,2:20}},{name:"M4 Rezzy Growl",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:13,1:127,2:45,3:110}},{name:"M4 Sharp Saw",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:20,1:64,2:100,3:20}},{name:"M4 Digi Lead",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:45,1:80,2:120}},{name:"M4 Sync Lead",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:30,1:64,4:12}},{name:"M4 Soft Pad",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:60,1:64,2:60,3:10}},{name:"M4 Metallic Text",type:"synth",synthType:"BuzzM4",volume:-14,pan:0,effects:[],parameters:{0:85,1:100,2:80,3:90}}],Lx=Array.from({length:32},(e,t)=>1/(t+1)),Ax=Array.from({length:32},(e,t)=>(t+1)%2==1?1/(t+1):0),Bx=Array.from({length:32},(e,t)=>(t+1)%2==1?1/Math.pow(t+1,2):0),Ix=[{type:"synth",name:"Pure Sine",synthType:"HarmonicSynth",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>0===t?1:0),spectralTilt:0,evenOddBalance:0,filter:{type:"lowpass",cutoff:12e3,resonance:.5},envelope:{attack:50,decay:200,sustain:80,release:300},lfo:{rate:2,depth:0,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Bright Saw",harmonicSynth:{harmonics:Lx,spectralTilt:20,evenOddBalance:0,filter:{type:"lowpass",cutoff:8e3,resonance:2},envelope:{attack:5,decay:150,sustain:70,release:200},lfo:{rate:5,depth:15,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Warm Square",harmonicSynth:{harmonics:Ax,spectralTilt:-10,evenOddBalance:-100,filter:{type:"lowpass",cutoff:2e3,resonance:1},envelope:{attack:10,decay:200,sustain:90,release:150},lfo:{rate:1.5,depth:0,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Mellow Triangle",harmonicSynth:{harmonics:Bx,spectralTilt:-20,evenOddBalance:-80,filter:{type:"lowpass",cutoff:5e3,resonance:.5},envelope:{attack:100,decay:300,sustain:85,release:400},lfo:{rate:.5,depth:5,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Church Organ",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return n%2==0?0:1===n?1:3===n?.8:5===n?.6:7===n?.4:9===n?.3:.2/n}),spectralTilt:0,evenOddBalance:-60,filter:{type:"lowpass",cutoff:1e4,resonance:1},envelope:{attack:20,decay:100,sustain:95,release:100},lfo:{rate:6,depth:3,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Vocal Formant",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return n>=4&&n<=8?1-.15*Math.abs(n-6):.3/n}),spectralTilt:0,evenOddBalance:20,filter:{type:"bandpass",cutoff:1500,resonance:8},envelope:{attack:30,decay:250,sustain:60,release:200},lfo:{rate:4,depth:40,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Spectral Bell",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return Math.exp(.3*-n)}),spectralTilt:-30,evenOddBalance:30,filter:{type:"highpass",cutoff:200,resonance:2},envelope:{attack:1,decay:2e3,sustain:10,release:1500},lfo:{rate:.3,depth:0,target:"pitch"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Metallic Pad",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return 1/n*(n%3==0||n%7==0?1.5:1)*Math.exp(.1*-n)}),spectralTilt:10,evenOddBalance:0,filter:{type:"lowpass",cutoff:6e3,resonance:3},envelope:{attack:200,decay:400,sustain:75,release:600},lfo:{rate:1.2,depth:20,target:"spectral"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Glass Chimes",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return n%2==0?1/Math.sqrt(n):.3/n}),spectralTilt:15,evenOddBalance:100,filter:{type:"highpass",cutoff:400,resonance:4},envelope:{attack:5,decay:1500,sustain:20,release:1e3},lfo:{rate:.8,depth:10,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Nasal Reed",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return 1===n?1:3===n?.9:5===n?.7:7===n?.5:.3/n}),spectralTilt:-5,evenOddBalance:-70,filter:{type:"bandpass",cutoff:2500,resonance:6},envelope:{attack:15,decay:200,sustain:75,release:150},lfo:{rate:5.5,depth:5,target:"pitch"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Plucked String",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return 1/n*Math.exp(.15*-n)}),spectralTilt:-25,evenOddBalance:0,filter:{type:"lowpass",cutoff:4e3,resonance:2},envelope:{attack:2,decay:800,sustain:10,release:200},lfo:{rate:0,depth:0,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Phasing Pad",harmonicSynth:{harmonics:Lx,spectralTilt:-15,evenOddBalance:0,filter:{type:"lowpass",cutoff:7e3,resonance:1.5},envelope:{attack:300,decay:500,sustain:80,release:800},lfo:{rate:.25,depth:80,target:"spectral"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Dark Bass",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>Math.exp(.8*-t)),spectralTilt:-50,evenOddBalance:0,filter:{type:"lowpass",cutoff:800,resonance:4},envelope:{attack:5,decay:150,sustain:90,release:100},lfo:{rate:0,depth:0,target:"pitch"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Bright Lead",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return n<=16?1/Math.sqrt(n):.8/n}),spectralTilt:40,evenOddBalance:0,filter:{type:"lowpass",cutoff:12e3,resonance:3},envelope:{attack:3,decay:100,sustain:80,release:150},lfo:{rate:6,depth:25,target:"filter"},maxVoices:4},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"String Ensemble",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return 1/n*Math.exp(.12*-n)}),spectralTilt:-8,evenOddBalance:15,filter:{type:"lowpass",cutoff:6e3,resonance:1},envelope:{attack:250,decay:400,sustain:85,release:700},lfo:{rate:2,depth:12,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Hollow Pipe",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return n%2==0?0:1/Math.pow(n,1.5)}),spectralTilt:-30,evenOddBalance:-100,filter:{type:"bandpass",cutoff:1200,resonance:5},envelope:{attack:40,decay:300,sustain:70,release:250},lfo:{rate:3,depth:8,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Synth Choir",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return n>=3&&n<=5?.9:n>=8&&n<=12?.7:.3/n}),spectralTilt:0,evenOddBalance:0,filter:{type:"bandpass",cutoff:1800,resonance:7},envelope:{attack:150,decay:350,sustain:80,release:500},lfo:{rate:.4,depth:30,target:"filter"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Analog Saw Bass",harmonicSynth:{harmonics:Lx,spectralTilt:-10,evenOddBalance:0,filter:{type:"lowpass",cutoff:1500,resonance:8},envelope:{attack:5,decay:120,sustain:70,release:80},lfo:{rate:0,depth:0,target:"pitch"},maxVoices:4},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Sweeping Lead",harmonicSynth:{harmonics:Lx,spectralTilt:10,evenOddBalance:0,filter:{type:"lowpass",cutoff:3e3,resonance:12},envelope:{attack:10,decay:200,sustain:65,release:180},lfo:{rate:3.5,depth:60,target:"filter"},maxVoices:4},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Ethereal Shimmer",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const n=t+1;return Math.sin(n*Math.PI/8)*(1/n)}),spectralTilt:5,evenOddBalance:50,filter:{type:"lowpass",cutoff:9e3,resonance:2},envelope:{attack:400,decay:600,sustain:75,release:1e3},lfo:{rate:.15,depth:90,target:"spectral"},maxVoices:8}}],Fx=[{type:"synth",name:"DJ Air Horn",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:150},lfo:{enabled:!0,type:"sawtooth",rate:15,depth:20},delay:{enabled:!0,time:.15,feedback:.2,wet:.2},filter:{enabled:!0,type:"lowpass",frequency:1200,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-6,pan:0},{type:"synth",name:"Reggaeton Horn",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:200},lfo:{enabled:!0,type:"triangle",rate:12,depth:30},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!0,type:"lowpass",frequency:1800,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:60,parameters:{drive:45,frequency:2500}}],volume:-6,pan:0},{type:"synth",name:"Foghorn",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:65},lfo:{enabled:!0,type:"sine",rate:.5,depth:10},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!0,type:"lowpass",frequency:400,rolloff:-24},reverb:{enabled:!1,decay:1,wet:0}},effects:[{category:"wasm",type:"MVerb",enabled:!0,wet:40,parameters:{damping:.5,density:.6,bandwidth:.7,decay:.5,predelay:.02,size:.7,gain:1,mix:.45,earlyMix:.5}}],volume:-8,pan:0},{type:"synth",name:"Chord Stab",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:200,sustain:0,release:150},filter:{type:"lowpass",frequency:3e3,Q:2,rolloff:-12},effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:4,attack:.003,release:.1}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:25,parameters:{delayTime:.2,feedback:.3}}],volume:-10,pan:0},{type:"synth",name:"Brass Stab",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:5,decay:250,sustain:0,release:100},filter:{type:"lowpass",frequency:4e3,Q:1,rolloff:-12},effects:[{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:50,parameters:{drive:35,frequency:3e3}},{category:"wasm",type:"MVerb",enabled:!0,wet:25,parameters:{damping:.6,density:.5,bandwidth:.7,decay:.3,predelay:.01,size:.35,gain:1,mix:.35,earlyMix:.6}}],volume:-10,pan:0},{type:"synth",name:"Dub Horn",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:180},lfo:{enabled:!0,type:"sine",rate:6,depth:40},delay:{enabled:!0,time:.35,feedback:.5,wet:.4},filter:{enabled:!0,type:"lowpass",frequency:1500,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:45,parameters:{mode:4,rate:330,intensity:.6,echoVolume:.75,reverbVolume:.2}},{category:"wasm",type:"SpringReverb",enabled:!0,wet:30,parameters:{decay:.5,damping:.4,tension:.45,mix:.35,drip:.6,diffusion:.7}}],volume:-10,pan:0},{type:"synth",name:"White Noise Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:2e3,decay:100,sustain:0,release:200},filter:{type:"lowpass",frequency:200,Q:5,rolloff:-24},effects:[{category:"tonejs",type:"AutoFilter",enabled:!0,wet:80,parameters:{frequency:.15,baseFrequency:200,octaves:6,type:"sine",depth:1}},{category:"wasm",type:"MVerb",enabled:!0,wet:30,parameters:{damping:.4,density:.6,bandwidth:.7,decay:.5,predelay:.01,size:.6,gain:1,mix:.4,earlyMix:.4}}],volume:-14,pan:0},{type:"synth",name:"Tension Builder",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:3e3,decay:200,sustain:.1,release:300},filter:{type:"bandpass",frequency:800,Q:4,rolloff:-24},effects:[{category:"tonejs",type:"Phaser",enabled:!0,wet:60,parameters:{frequency:.2,octaves:4,baseFrequency:400,Q:8}},{category:"wasm",type:"MVerb",enabled:!0,wet:35,parameters:{damping:.3,density:.7,bandwidth:.6,decay:.6,predelay:.03,size:.8,gain:1,mix:.45,earlyMix:.3}}],volume:-16,pan:0},{type:"synth",name:"Frequency Sweep",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:1500,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:300,Q:6,rolloff:-24},effects:[{category:"tonejs",type:"AutoFilter",enabled:!0,wet:70,parameters:{frequency:.1,baseFrequency:150,octaves:7,type:"sawtooth",depth:1}},{category:"tonejs",type:"Chorus",enabled:!0,wet:40,parameters:{frequency:2.5,delayTime:3.5,depth:.7,spread:180}}],volume:-14,pan:0},{type:"synth",name:"Dark Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:2500,decay:300,sustain:0,release:200},filter:{type:"lowpass",frequency:500,Q:3,rolloff:-24},effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:50,parameters:{bits:6}},{category:"wasm",type:"MVerb",enabled:!0,wet:35,parameters:{damping:.6,density:.5,bandwidth:.5,decay:.4,predelay:.02,size:.5,gain:1,mix:.4,earlyMix:.5}}],volume:-14,pan:0},{type:"synth",name:"Euphoria Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:3e3,decay:200,sustain:0,release:400},filter:{type:"highpass",frequency:400,Q:2,rolloff:-12},effects:[{category:"tonejs",type:"Chorus",enabled:!0,wet:55,parameters:{frequency:3,delayTime:4,depth:.8,spread:180}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:70,parameters:{width:.8}},{category:"wasm",type:"MVerb",enabled:!0,wet:45,parameters:{damping:.2,density:.8,bandwidth:.8,decay:.7,predelay:.02,size:.9,gain:1,mix:.5,earlyMix:.3}}],volume:-16,pan:0},{type:"synth",name:"Sub Drop",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:800,sustain:0,release:200},effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:6,attack:.001,release:.05}}],volume:-6,pan:0},{type:"synth",name:"Boom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:600,sustain:0,release:300},effects:[{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:55,parameters:{drive:50,frequency:800}},{category:"wasm",type:"MVerb",enabled:!0,wet:30,parameters:{damping:.6,density:.5,bandwidth:.6,decay:.35,predelay:.01,size:.45,gain:1,mix:.4,earlyMix:.6}}],volume:-8,pan:0},{type:"synth",name:"Cinematic Hit",synthType:"MetalSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:1e3,sustain:0,release:500},effects:[{category:"wasm",type:"MVerb",enabled:!0,wet:50,parameters:{damping:.3,density:.8,bandwidth:.7,decay:.7,predelay:.03,size:.9,gain:1,mix:.5,earlyMix:.3}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:80,parameters:{width:.9}}],volume:-10,pan:0},{type:"synth",name:"Earthquake",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:1200,sustain:0,release:400},effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:40,parameters:{distortion:.6,oversample:2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:8,attack:.001,release:.08}}],volume:-8,pan:0},{type:"synth",name:"Crash Impact",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:400,sustain:0,release:200},filter:{type:"lowpass",frequency:4e3,Q:1,rolloff:-12},effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:6,attack:.001,release:.05}}],volume:-8,pan:0},{type:"synth",name:"Reverse Hit",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:300,decay:100,sustain:0,release:50},filter:{type:"bandpass",frequency:1500,Q:3,rolloff:-12},effects:[{category:"wasm",type:"RETapeEcho",enabled:!0,wet:55,parameters:{time:.25,feedback:.5,tone:.6,flutter:.3,wow:.2,saturation:.4,mix:.5}}],volume:-10,pan:0},{type:"synth",name:"DJ Laser",synthType:"SpaceLaser",spaceLaser:{...Va,laser:{startFreq:5e3,endFreq:200,sweepTime:120,sweepCurve:"exponential"},fm:{amount:50,ratio:3},noise:{amount:8,type:"white"},filter:{type:"bandpass",cutoff:2500,resonance:40}},effects:[{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{delayTime:.15,feedback:.4}}],volume:-10,pan:0},{type:"synth",name:"Glitch Zap",synthType:"SpaceLaser",spaceLaser:{...Va,laser:{startFreq:8e3,endFreq:100,sweepTime:80,sweepCurve:"exponential"},fm:{amount:70,ratio:5},noise:{amount:15,type:"white"},filter:{type:"highpass",cutoff:1e3,resonance:50}},effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:55,parameters:{bits:4}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:25,parameters:{delayTime:.1,feedback:.35}}],volume:-12,pan:0},{type:"synth",name:"Pew Pew",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:150,sustain:0,release:80},filter:{type:"bandpass",frequency:3e3,Q:8,rolloff:-24},effects:[{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{delayTime:.12,feedback:.3}}],volume:-10,pan:0},{type:"synth",name:"Cosmic Ray",synthType:"SpaceLaser",spaceLaser:{...Va,laser:{startFreq:6e3,endFreq:300,sweepTime:250,sweepCurve:"exponential"},fm:{amount:45,ratio:3.5},noise:{amount:12,type:"pink"},filter:{type:"bandpass",cutoff:2e3,resonance:35},delay:{enabled:!0,time:.3,feedback:.5,wet:.4},reverb:{enabled:!0,decay:3,wet:.3}},effects:[{category:"wasm",type:"MVerb",enabled:!0,wet:40,parameters:{damping:.3,density:.7,bandwidth:.7,decay:.6,predelay:.02,size:.8,gain:1,mix:.45,earlyMix:.3}},{category:"tonejs",type:"Chorus",enabled:!0,wet:35,parameters:{frequency:2,delayTime:3.5,depth:.6,spread:180}}],volume:-12,pan:0},{type:"synth",name:"Rave Siren",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:500},lfo:{enabled:!0,type:"sine",rate:4,depth:300},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!0,type:"lowpass",frequency:3e3,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:40,parameters:{distortion:.4,oversample:2}},{category:"wasm",type:"MVerb",enabled:!0,wet:25,parameters:{damping:.5,density:.5,bandwidth:.7,decay:.3,predelay:.01,size:.4,gain:1,mix:.35,earlyMix:.5}}],volume:-10,pan:0},{type:"synth",name:"Ambulance",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"square",frequency:700},lfo:{enabled:!0,type:"square",rate:3,depth:150},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!0,type:"lowpass",frequency:4e3,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Nuclear Alarm",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:400},lfo:{enabled:!0,type:"sine",rate:1.5,depth:200},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!1,decay:1,wet:0}},effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:45,parameters:{bits:5}},{category:"wasm",type:"MVerb",enabled:!0,wet:35,parameters:{damping:.4,density:.6,bandwidth:.6,decay:.5,predelay:.02,size:.6,gain:1,mix:.4,earlyMix:.4}}],volume:-10,pan:0},{type:"synth",name:"Wobble Siren",synthType:"DubSiren",dubSiren:{...ka,oscillator:{type:"sawtooth",frequency:350},lfo:{enabled:!0,type:"sine",rate:6,depth:120},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!0,type:"lowpass",frequency:2500,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[{category:"tonejs",type:"Tremolo",enabled:!0,wet:70,parameters:{frequency:5,depth:.8,type:"sine",spread:0}}],volume:-10,pan:0},{type:"synth",name:"Vinyl Scratch",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:120,sustain:0,release:50},filter:{type:"bandpass",frequency:2e3,Q:6,rolloff:-24},effects:[{category:"tonejs",type:"AutoFilter",enabled:!0,wet:80,parameters:{frequency:8,baseFrequency:800,octaves:4,type:"sawtooth",depth:1}}],volume:-10,pan:0},{type:"synth",name:"Static Burst",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:200,sustain:0,release:80},filter:{type:"highpass",frequency:1e3,Q:2,rolloff:-12},effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:65,parameters:{bits:3}},{category:"tonejs",type:"Distortion",enabled:!0,wet:40,parameters:{distortion:.5,oversample:2}}],volume:-12,pan:0},{type:"synth",name:"Wind Gust",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:200,decay:800,sustain:.2,release:600},filter:{type:"bandpass",frequency:600,Q:2,rolloff:-12},effects:[{category:"tonejs",type:"AutoFilter",enabled:!0,wet:75,parameters:{frequency:.3,baseFrequency:300,octaves:5,type:"sine",depth:1}},{category:"wasm",type:"MVerb",enabled:!0,wet:40,parameters:{damping:.3,density:.7,bandwidth:.7,decay:.6,predelay:.03,size:.8,gain:1,mix:.45,earlyMix:.3}}],volume:-14,pan:0},{type:"synth",name:"Radio Tune",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:50,decay:300,sustain:.3,release:200},filter:{type:"bandpass",frequency:1200,Q:8,rolloff:-24},effects:[{category:"tonejs",type:"AutoFilter",enabled:!0,wet:80,parameters:{frequency:2,baseFrequency:600,octaves:3,type:"sine",depth:1}},{category:"tonejs",type:"Tremolo",enabled:!0,wet:50,parameters:{frequency:12,depth:.6,type:"sine",spread:0}}],volume:-12,pan:0},{type:"synth",name:"Echo Washout",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:10,decay:300,sustain:.3,release:200},filter:{type:"lowpass",frequency:2e3,Q:3,rolloff:-12},effects:[{category:"wasm",type:"RETapeEcho",enabled:!0,wet:65,parameters:{time:.35,feedback:.7,tone:.5,flutter:.4,wow:.3,saturation:.5,mix:.6}}],volume:-12,pan:0},{type:"synth",name:"Rewind",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:1},envelope:{attack:10,decay:600,sustain:0,release:100},filter:{type:"lowpass",frequency:4e3,Q:4,rolloff:-24},effects:[{category:"tonejs",type:"Phaser",enabled:!0,wet:55,parameters:{frequency:6,octaves:3,baseFrequency:500,Q:10}}],volume:-12,pan:0},{type:"synth",name:"Tape Stop",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:1500,Q:2,rolloff:-24},effects:[{category:"wasm",type:"TapeSimulator",enabled:!0,wet:70,parameters:{flutter:.8,wow:.9,saturation:.5,hiss:.2,toneHigh:.4,toneLow:.6,speed:.3,mix:.7}}],volume:-10,pan:0},{type:"synth",name:"Splash",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:400},filter:{type:"highpass",frequency:600,Q:1,rolloff:-12},effects:[{category:"wasm",type:"MVerb",enabled:!0,wet:55,parameters:{damping:.2,density:.8,bandwidth:.8,decay:.7,predelay:.01,size:.9,gain:1,mix:.55,earlyMix:.4}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:80,parameters:{width:.9}}],volume:-10,pan:0}],Ux=[{type:"synth",name:"Classic Wobble",synthType:"WobbleBass",wobbleBass:{mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Growl Bass",synthType:"WobbleBass",wobbleBass:{mode:"growl",osc1:{type:"sawtooth",octave:-2,detune:0,level:100},osc2:{type:"square",octave:-2,detune:5,level:70},sub:{enabled:!0,octave:-2,level:80},fm:{enabled:!0,amount:40,ratio:1,envelope:60},unison:{voices:2,detune:10,stereoSpread:30},filter:{type:"bandpass",cutoff:600,resonance:40,rolloff:-12,drive:50,keyTracking:20},filterEnvelope:{amount:50,attack:10,decay:400,sustain:40,release:200},wobbleLFO:{enabled:!0,sync:"1/8",rate:4,shape:"saw",amount:60,pitchAmount:0,fmAmount:30,phase:0,retrigger:!0},envelope:{attack:5,decay:300,sustain:60,release:200},distortion:{enabled:!0,type:"hard",drive:60,tone:50},formant:{enabled:!0,vowel:"O",morph:50,lfoAmount:40}},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Wobble",synthType:"WobbleBass",wobbleBass:{mode:"reese",osc1:{type:"sawtooth",octave:-1,detune:-10,level:90},osc2:{type:"sawtooth",octave:-1,detune:10,level:90},sub:{enabled:!0,octave:-2,level:70},fm:{enabled:!1,amount:0,ratio:1,envelope:0},unison:{voices:6,detune:25,stereoSpread:80},filter:{type:"lowpass",cutoff:1200,resonance:30,rolloff:-24,drive:20,keyTracking:0},filterEnvelope:{amount:0,attack:0,decay:0,sustain:0,release:0},wobbleLFO:{enabled:!0,sync:"1/2",rate:1,shape:"triangle",amount:50,pitchAmount:0,fmAmount:0,phase:0,retrigger:!1},envelope:{attack:20,decay:500,sustain:100,release:800},distortion:{enabled:!0,type:"soft",drive:30,tone:60},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Pluck Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:300,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Fat Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:5,octave:-1},envelope:{attack:10,decay:400,sustain:.4,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Sine Sub",synthType:"Synth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"808 Sub",synthType:"MonoSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:1,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:15,octave:0},envelope:{attack:10,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:800,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"House Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Wobble Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:5,decay:400,sustain:0,release:100},filter:{type:"lowpass",frequency:1e3,Q:8,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Duo Sub Bass",synthType:"DuoSynth",oscillator:{type:"triangle",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:1,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},...Hy,...$y],Rx=[{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Pluck Keys",synthType:"PluckSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2500,Q:1,rolloff:-12},effects:[],volume:-10,pan:0},{type:"synth",name:"Guitar Pluck",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:200,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"AM Bell",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"AM Sci-Fi",synthType:"AMSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:.5,release:1e3},effects:[],volume:-6,pan:0},{type:"synth",name:"FM Electric Piano",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:.2,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Saw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:10,decay:200,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Square Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:100,sustain:.8,release:100},effects:[],volume:-10,pan:0},{type:"synth",name:"Supersaw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:20,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"lowpass",frequency:3e3,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Acid Lead",synthType:"MonoSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:350,sustain:0,release:200},filter:{type:"lowpass",frequency:2e3,Q:5,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Stab",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"lowpass",frequency:4e3,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Sync Lead",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:10,decay:450,sustain:0,release:300},filter:{type:"lowpass",frequency:2500,Q:3,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:250,sustain:0,release:100},filter:{type:"lowpass",frequency:3e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Detuned Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:25,octave:0},envelope:{attack:30,decay:450,sustain:0,release:400},filter:{type:"lowpass",frequency:2800,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Filtered Lead",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"AM Tremolo Lead",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:10,decay:300,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"FM Bell Lead",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:1e3,sustain:0,release:800},effects:[],volume:-10,pan:0},{type:"synth",name:"Harp Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:800,sustain:0,release:500},effects:[],volume:-8,pan:0},{type:"synth",name:"Nylon Guitar",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:1,decay:1200,sustain:0,release:1e3},effects:[],volume:-8,pan:0},{type:"synth",name:"PWM Solo Lead",synthType:"PWMSynth",pwmSynth:{pulseWidth:20,pwmDepth:40,pwmRate:1.5,pwmWaveform:"sine",oscillators:2,detune:5,envelope:{attack:10,decay:300,sustain:.6,release:200},filter:{type:"lowpass",cutoff:3e3,resonance:30,envelopeAmount:20,keyTracking:50},filterEnvelope:{attack:5,decay:400,sustain:.2,release:100}},effects:[],volume:-10,pan:0},{type:"synth",name:"Poly Brass",synthType:"PolySynth",polySynth:{voiceCount:6,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:50,decay:400,sustain:.7,release:200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SuperSaw Lead",synthType:"SuperSaw",superSaw:{voices:7,detune:40,mix:70,stereoSpread:80,envelope:{attack:10,decay:300,sustain:50,release:200},filter:{type:"lowpass",cutoff:5e3,resonance:20,envelopeAmount:50},filterEnvelope:{attack:5,decay:400,sustain:0,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Robot Talk",synthType:"FormantSynth",formantSynth:{vowel:"E",vowelMorph:{target:"U",amount:80,rate:2,mode:"manual"},oscillator:{type:"square"},formants:{...pa.E,bandwidth:120},envelope:{attack:5,decay:200,sustain:.5,release:100},brightness:80},effects:[],volume:-10,pan:0}],jx=[{type:"synth",name:"Ambient Pad",synthType:"Synth",oscillator:{type:"sine",detune:3,octave:0},envelope:{attack:800,decay:2e3,sustain:0,release:1500},filter:{type:"lowpass",frequency:1500,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Dark Pad",synthType:"DuoSynth",oscillator:{type:"triangle",detune:8,octave:0},envelope:{attack:1e3,decay:2500,sustain:0,release:2e3},filter:{type:"lowpass",frequency:800,Q:2,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"String Pad",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:500,decay:1800,sustain:0,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1.5,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Noise Sweep",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:300,decay:1500,sustain:0,release:1e3},filter:{type:"bandpass",frequency:1e3,Q:5,rolloff:-24},effects:[],volume:-18,pan:0},{type:"synth",name:"AM Atmospheric",synthType:"AMSynth",oscillator:{type:"sine",detune:5,octave:0},envelope:{attack:1500,decay:3e3,sustain:.8,release:2e3},effects:[],volume:-12,pan:0},{type:"synth",name:"Wavetable Evolving Pad",synthType:"Wavetable",wavetable:{wavetableId:"evolve-1",morphPosition:0,morphModSource:"lfo",morphModAmount:80,morphLFORate:.1,unison:{voices:4,detune:12,stereoSpread:60},envelope:{attack:1e3,decay:2e3,sustain:.7,release:1500},filter:{type:"lowpass",cutoff:1500,resonance:20,envelopeAmount:30},filterEnvelope:{attack:2e3,decay:1e3,sustain:.5,release:1e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"Poly Soft Strings",synthType:"PolySynth",polySynth:{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:500,decay:1e3,sustain:.8,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-14,pan:0},{type:"synth",name:"PWM Strings",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:30,pwmRate:.5,pwmWaveform:"sine",oscillators:3,detune:12,envelope:{attack:800,decay:1500,sustain:.9,release:1500},filter:{type:"lowpass",cutoff:1200,resonance:15,envelopeAmount:0,keyTracking:30},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Solina Ensemble",synthType:"StringMachine",stringMachine:{sections:{violin:100,viola:80,cello:60,bass:40},ensemble:{depth:70,rate:2.5,voices:4},attack:300,release:1500,brightness:50},effects:[],volume:-10,pan:0},{type:"synth",name:"Ethereal Choir",synthType:"FormantSynth",formantSynth:{vowel:"A",vowelMorph:{target:"O",amount:50,rate:.2,mode:"lfo"},oscillator:{type:"sawtooth"},formants:{...pa.A,bandwidth:80},envelope:{attack:1e3,decay:2e3,sustain:.8,release:2e3},brightness:60},effects:[],volume:-12,pan:0},{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"Wavetable Morph Pad",synthType:"Wavetable",wavetable:{wavetableId:"morph-2",morphPosition:50,morphModSource:"lfo",morphModAmount:40,morphLFORate:.2,unison:{voices:6,detune:20,stereoSpread:90},envelope:{attack:1200,decay:2500,sustain:.8,release:2e3},filter:{type:"lowpass",cutoff:2e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"PWM Soft Pad",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:20,pwmRate:.3,pwmWaveform:"sine",oscillators:2,detune:8,envelope:{attack:1500,decay:2e3,sustain:.9,release:2e3},filter:{type:"lowpass",cutoff:800,resonance:5,envelopeAmount:0,keyTracking:20},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-14,pan:0},{type:"synth",name:"Granular Cloud",synthType:"GranularSynth",granular:{sampleUrl:"",grainSize:.1,grainOverlap:.05,detune:5,playbackRate:1,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:1,reverse:!1,envelope:{attack:10,release:100},filter:{type:"lowpass",cutoff:2e3,resonance:1}},effects:[],volume:-10,pan:0}],Xx=[ex,tx,nx,{type:"synth",name:"808 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:100,Q:1,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:300,sustain:0,release:50},filter:{type:"lowpass",frequency:80,Q:2,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"Hardcore Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:150,sustain:0,release:20},filter:{type:"lowpass",frequency:120,Q:3,rolloff:-24},effects:[],volume:-4,pan:0},{type:"synth",name:"DnB Snare",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:300,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Clap",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:150,sustain:0,release:50},filter:{type:"bandpass",frequency:1e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Closed Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:50,sustain:0,release:20},filter:{type:"highpass",frequency:8e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Open Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:200},filter:{type:"highpass",frequency:7e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:1500,sustain:0,release:1e3},filter:{type:"highpass",frequency:6e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Synth Low Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:400,sustain:0,release:100},effects:[],volume:-8,pan:-20},{type:"synth",name:"Synth Mid Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:350,sustain:0,release:80},effects:[],volume:-8,pan:0},{type:"synth",name:"Synth Hi Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:60},effects:[],volume:-8,pan:20},...ax],zx=[{type:"synth",name:"NES Major Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:15,delay:200},arpeggio:{enabled:!0,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"C64 Minor Arp",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:4,depth:10,delay:300},arpeggio:{enabled:!0,speed:12,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"SID Dim7 Pad",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:50,decay:600,sustain:0,release:500},vibrato:{speed:3,depth:8,delay:100},arpeggio:{enabled:!0,speed:8,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:6},{noteOffset:9}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Gameboy Sus4",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:12.5},bitDepth:4,sampleRate:16384,envelope:{attack:1,decay:200,sustain:0,release:100},vibrato:{speed:6,depth:20,delay:150},arpeggio:{enabled:!0,speed:18,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:5},{noteOffset:7}],mode:"loop"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Atari Dom7",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:4,sampleRate:15720,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:20,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Amiga Power Oct",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:8,sampleRate:28867,envelope:{attack:5,decay:300,sustain:0,release:250},vibrato:{speed:4,depth:12,delay:200},arpeggio:{enabled:!0,speed:14,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Fast Maj9 Stab",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:150,sustain:0,release:80},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:30,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:11},{noteOffset:14}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Slow Min7 Sweep",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:100,decay:800,sustain:0,release:600},vibrato:{speed:3,depth:15,delay:500},arpeggio:{enabled:!0,speed:4,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Square Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:200},vibrato:{speed:6,depth:15,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Triangle Bass",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:4,sampleRate:22050,envelope:{attack:1,decay:400,sustain:0,release:150},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12}],mode:"loop"}},effects:[],volume:-6,pan:0},{type:"synth",name:"Noise Snare",synthType:"ChipSynth",chipSynth:{channel:"noise",bitDepth:1,sampleRate:22050,envelope:{attack:1,decay:100,sustain:0,release:50},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Octave Jump",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:10,delay:250},arpeggio:{enabled:!0,speed:10,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12},{noteOffset:24}],mode:"loop"}},effects:[],volume:-10,pan:0}],Gx=[{type:"synth",name:"909 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3}},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",snare:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Rim",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:100,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:300,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:60,decay:50,metallic:65}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:55,decay:350,metallic:60}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Ride",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:800,sustain:.1,release:500},filter:{type:"highpass",frequency:5e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"909 Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:2e3,sustain:.05,release:1500},filter:{type:"highpass",frequency:4e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0}],Hx=[{type:"synth",name:"808 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",machineType:"808",kick:{pitch:48,pitchDecay:110,tone:50,toneDecay:20,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}},effects:[],volume:-6,pan:0},{type:"synth",name:"808 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",machineType:"808",snare:{pitch:238,pitchHigh:476,tone:50,toneDecay:75,snappy:50,decay:100,envAmount:1,envDuration:100,filterType:"highpass",filterFreq:1300}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",machineType:"808",clap:{tone:50,decay:115,toneDecay:200,spread:100,filterFreqs:[1e3,1e3],modulatorFreq:10}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Rimshot",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",machineType:"808",rimshot:{decay:40,filterFreqs:[480,1750,2450],filterQ:5,saturation:2.5}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Clave",synthType:"DrumMachine",drumMachine:{drumType:"clave",machineType:"808",clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Cowbell",synthType:"DrumMachine",drumMachine:{drumType:"cowbell",machineType:"808",cowbell:{decay:400,filterFreq:2640}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Maracas",synthType:"DrumMachine",drumMachine:{drumType:"maracas",machineType:"808",maracas:{decay:30,filterFreq:5e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:90,decay:200,tone:20,toneDecay:155,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:140,decay:190,tone:20,toneDecay:130,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:190,decay:180,tone:20,toneDecay:100,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Low Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:190,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:280,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:410,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:50,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:270,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Cymbal",synthType:"DrumMachine",drumMachine:{drumType:"cymbal",machineType:"808",cymbal:{tone:50,decay:3e3}},effects:[],volume:-14,pan:0}],Wx=[{type:"synth",name:"Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:2e3,decay:100,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:5,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"Downlifter",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:10,decay:2e3,sustain:0,release:100},filter:{type:"lowpass",frequency:5e3,Q:3,rolloff:-24},effects:[],volume:-14,pan:0},{type:"synth",name:"Impact",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:300,Q:2,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Laser Zap",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-12,pan:0}],qx=[{type:"synth",name:"Web Audio Module (WAM)",synthType:"WAM",wam:{moduleUrl:"",pluginState:null},effects:[],volume:-12,pan:0}],Kx=[{type:"synth",name:"505 Kick",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Snare",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Clap",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Rim",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"505 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"505 Crash",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"505 Ride",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"505 Low Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 High Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Low Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-20},{type:"synth",name:"505 High Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:20},{type:"synth",name:"505 Timbale",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-timbal.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0}],$x=[{type:"synth",name:"707 Kick",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Kick Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Snare",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Clap",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Rim",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Low Tom Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"707 Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-cowbell.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Crash",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"707 Ride",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"707 Tambourine",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tambourine.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0}],Yx=[{type:"synth",name:"DN 808 A1200",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN SubThud",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_SubThud.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Punchtron Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN 808 Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Analog Noise",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro 7000",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_electro7000.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Wolf Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Wolf1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Closed Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Open Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Analog Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Cymbal",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CYM_Synthique.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Clap",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Clave",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Tom",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Lazer",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/LAZ_R900.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Sonar",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Sonar.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Laser",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Burst",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Burst1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0}],Jx=[{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"VFX Evolving",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},{type:"synth",name:"ESQ-1 Gritty Keys",synthType:"MAMEDOC",effects:[],volume:-10,pan:0},{type:"synth",name:"MKS-20 E.Piano 1",synthType:"MAMERSA",effects:[],volume:-10,pan:0},{type:"synth",name:"RD-1000 Grand",synthType:"MAMERSA",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Grand Piano",synthType:"MAMESWP30",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Synth Brass",synthType:"MAMESWP30",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Brass 1",synthType:"CZ101",effects:[],volume:-8,pan:0},{type:"synth",name:"CZ Electric Piano",synthType:"CZ101",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Synth Bass",synthType:"CZ101",effects:[],volume:-6,pan:0},{type:"synth",name:"CZ Digital Pad",synthType:"CZ101",effects:[],volume:-10,pan:0}],Qx=[{type:"synth",name:"Jazz Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!0,volume:60,decay:"fast",harmonic:"third"},keyClick:40,vibrato:{type:"C3",depth:60},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Gospel Organ",synthType:"Organ",organ:{drawbars:[8,8,8,8,8,8,8,8,8],percussion:{enabled:!1,volume:50,decay:"slow",harmonic:"second"},keyClick:20,vibrato:{type:"V3",depth:40},rotary:{enabled:!0,speed:"slow"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Church Organ",synthType:"Organ",organ:{drawbars:[8,0,8,0,8,0,0,8,8],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:0,vibrato:{type:"V1",depth:20},rotary:{enabled:!1,speed:"slow"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Rock Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:80,vibrato:{type:"C3",depth:80},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-8,pan:0}],Zx=[{type:"synth",name:"Generic Module",synthType:"ChiptuneModule",effects:[],volume:-6,pan:0}],eN=[...Ux,...Rx,...jx,...Xx,...Jx,...hx,...Qx,...Zx,...Hx,...Gx,...$x,...Kx,...zx,...Ky,...vx,...Wx,...qx,...$y,...Yy,...sx,...mx,...px,...Yx,...dx,...gx,...bx,...kx,...Dx,..._x,...Tx,...Fx,{type:"synth",name:"Sample Player",synthType:"Player",volume:-6,pan:0,effects:[]}],tN={Bass:Ux,Leads:Rx,Pads:jx,Drums:Xx,MAME:[...Jx,...hx],Keys:Qx,Module:Zx,"TR-808":Hx,"TR-909":Gx,"TR-707":$x,"TR-505":Kx,Chip:zx,Furnace:[...Ky,...vx],FX:Wx,WAM:qx,Dub:[...$y,...Yy,...sx,...mx,...ax],DubSiren:$y,SpaceLaser:Yy,V2:[...sx,...mx],Sam:px,Synare:ax,Drumnibus:[...dx,...Yx],Dexed:gx,OBXd:bx,Samples:kx,Wavetables:Dx,Amiga:Nx,Buzz:_x,Makk:Tx,Harmonic:Ix,"DJ FX":Fx};function nN(e){const t=tN[e];if(t&&t.length>0)return t[0];const n=eN.find(t=>t.synthType===e);if(n)return n;const s=Hy.find(t=>t.synthType===e);if(s)return s;const a=ax.find(t=>t.synthType===e);return a||null}class sN{view;offset=0;size;constructor(e){e instanceof DataView?this.view=e:this.view=new DataView(e),this.size=this.view.byteLength}getOffset(){return this.offset}setOffset(e){this.offset=e}getSize(){return this.size}seek(e){this.offset=e}skip(e){this.offset+=e}isEOF(){return this.offset>=this.size}readUint8(){const e=this.view.getUint8(this.offset);return this.offset+=1,e}readInt8(){const e=this.view.getInt8(this.offset);return this.offset+=1,e}readUint16(e=!0){const t=this.view.getUint16(this.offset,e);return this.offset+=2,t}readInt16(e=!0){const t=this.view.getInt16(this.offset,e);return this.offset+=2,t}readUint32(e=!0){const t=this.view.getUint32(this.offset,e);return this.offset+=4,t}readInt32(e=!0){const t=this.view.getInt32(this.offset,e);return this.offset+=4,t}readFloat32(e=!0){const t=this.view.getFloat32(this.offset,e);return this.offset+=4,t}readString(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);this.offset+=e;let n=0;for(;n<e&&0!==t[n];)n++;return(new TextDecoder).decode(t.slice(0,n))}readNullTerminatedString(){let e=0;for(;this.offset+e<this.size&&0!==this.view.getUint8(this.offset+e);)e++;const t=this.readString(e);return this.offset<this.size&&this.offset++,t}readPrefixedString(){const e=this.readUint8();return 0===e?"":this.readString(e)}readPrefixedString16(){const e=this.readUint16();return 0===e?"":this.readString(e)}readPrefixedString32(){const e=this.readUint32();return 0===e?"":this.readString(e)}readBytes(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,new Uint8Array(t)}readMagic(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,Array.from(t).map(e=>String.fromCharCode(e)).join("")}}class aN{static parse(e){const t=new sN(e);if(t.readMagic(16).startsWith("-Furnace instr."))return this.parseOldFormat(t);t.seek(0);const n=t.readMagic(4);if("FINS"===n||"INS2"===n||"INST"===n)return this.parseNewFormat(t,n);throw new Error(`Invalid Furnace instrument header: ${n}`)}static parseNewFormat(e,t){"INS2"===t&&e.skip(4),e.skip(2);const n=e.readUint8(),s={...va,chipType:n,operators:Array.from({length:4},()=>({...va.operators[0]})),macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]};let a="Furnace Instrument";const o=[];for(;!e.isEOF();)try{if(e.getOffset()+4>e.getSize())break;const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const n=e.readUint16(),r=e.getOffset()+n;if(r>e.getSize())break;switch(t){case"NA":case"NM":a=e.readString(n);break;case"FM":this.readFMFeature(e,s);break;case"WV":case"WL":case"LW":this.readWavePointers(e,o)}e.seek(r)}catch{break}return this.loadWavetables(e,o,s),{name:a,config:s}}static parseOldFormat(e){e.seek(16),e.skip(4);const t=e.readUint32(),n=e.readUint16(),s=e.readUint16();e.skip(4);const a=[];for(let l=0;l<n;l++)a.push(e.readUint32());if(e.skip(4*s),t>=e.getSize())throw new Error("Invalid data pointer");if(e.seek(t),"INST"!==e.readMagic(4))throw new Error("Invalid INST block");e.skip(4),e.skip(2);const o=e.readUint8();e.skip(1);const r=e.readNullTerminatedString(),i={...va,chipType:o,operators:[],macros:[],opMacros:[],wavetables:[]};if(e.getOffset()+8<=e.getSize()){i.algorithm=e.readUint8(),i.feedback=e.readUint8(),e.skip(2);const t=e.readUint8();e.skip(3);for(let n=0;n<4&&!(e.getOffset()+12>e.getSize());n++){const s={enabled:n<t,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.getOffset()+10<=e.getSize()&&e.skip(10),i.operators.push(s)}}return 0===i.operators.length&&(i.operators=Array.from({length:4},()=>({...va.operators[0]}))),this.loadWavetables(e,a,i),{name:r,config:i}}static readFMFeature(e,t){const n=e.readUint8(),s=15&n,a=n>>4&15;t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),e.skip(2),t.operators=[];for(let o=0;o<s;o++){const n={enabled:!!(a>>o&1),mult:15&e.readUint8(),dt:e.readUint8()>>4&7,dt2:0,tl:e.readUint8(),ar:31&e.readUint8(),dr:31&e.readUint8(),d2r:0,sl:e.readUint8()>>4&15,rr:15&e.readUint8(),rs:0,ssg:15&e.readUint8(),am:!1,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};t.operators.push(n)}}static readWavePointers(e,t){const n=e.readUint16();e.skip(2*n);for(let s=0;s<n;s++)t.push(e.readUint32())}static loadWavetables(e,t,n){for(const s of t)if(s>0&&s<e.getSize()){e.seek(s);const t=this.readWaveBlock(e);t&&n.wavetables.push(t)}}static readWaveBlock(e){if(e.getOffset()+4>e.getSize())return null;if("WAVE"!==e.readMagic(4))return null;e.skip(20);const t=e.readUint32();e.skip(8);const n=[];for(let s=0;s<t&&!(e.getOffset()+4>e.getSize());s++)n.push(e.readInt32());return{id:0,data:n}}}const oN={1:{id:1,name:"YMU759",chipType:19,fmChannels:17,psgChannels:0,totalChannels:17},2:{id:2,name:"Genesis",chipType:0,fmChannels:6,psgChannels:4,totalChannels:10},3:{id:3,name:"SMS",chipType:3,fmChannels:0,psgChannels:4,totalChannels:4},4:{id:4,name:"Game Boy",chipType:5,fmChannels:0,psgChannels:4,totalChannels:4},5:{id:5,name:"PC Engine",chipType:6,fmChannels:0,psgChannels:6,totalChannels:6},6:{id:6,name:"NES",chipType:4,fmChannels:0,psgChannels:5,totalChannels:5},7:{id:7,name:"C64",chipType:10,fmChannels:0,psgChannels:3,totalChannels:3},8:{id:8,name:"Arcade",chipType:1,fmChannels:13,psgChannels:0,totalChannels:13},9:{id:9,name:"Neo Geo",chipType:14,fmChannels:4,psgChannels:7,totalChannels:13},10:{id:10,name:"Genesis Ext",chipType:0,fmChannels:9,psgChannels:4,totalChannels:13},11:{id:11,name:"SMS + OPLL",chipType:11,fmChannels:9,psgChannels:4,totalChannels:13},12:{id:12,name:"NES + VRC7",chipType:4,fmChannels:6,psgChannels:5,totalChannels:11},13:{id:13,name:"NES + FDS",chipType:16,fmChannels:0,psgChannels:6,totalChannels:6}};class rN{static SYSTEM_MAP={1:19,2:0,3:3,4:5,5:6,6:4,7:10,8:1,9:14,10:0,11:11,12:4,13:16};static parse(e,t){const n=new sN(e),s=n.readMagic(16);if("dmf"===t){if(!s.startsWith(".DeFleMask."))throw new Error("Invalid DMF magic");return this.parseDMF(n,s)}if("dmp"===t)return n.seek(0),this.parseDMP(n);if("dmw"===t)return n.seek(0),this.parseDMW(n);throw new Error(`Unknown format: ${t}`)}static parseDMF(e,t){const n=this.extractVersion(t),s=e.readUint8(),a=oN[s]??oN[2],o={version:n,system:a,name:"",author:"",timeBase:0,ticksPerRow:[6,6],framesPerTick:1,patternRows:64,matrixRows:1,arpeggioTickSpeed:1,instruments:[],wavetables:[],patterns:[],patternMatrix:[],channelCount:a.totalChannels};if(n>=17?(o.name=e.readPrefixedString(),o.author=e.readPrefixedString(),e.readUint8(),e.readUint8()):n>=10&&(o.name=e.readNullTerminatedString(),o.author=e.readNullTerminatedString()),o.timeBase=e.readUint8(),o.ticksPerRow=[e.readUint8(),e.readUint8()],n>=14&&(o.framesPerTick=e.readUint8()),n>=19){e.readUint8()&&(e.readUint8(),e.readUint8(),e.readUint8())}o.patternRows=e.readUint32(),o.matrixRows=e.readUint8(),n>=21&&(o.arpeggioTickSpeed=e.readUint8()),o.patternMatrix=[];for(let l=0;l<o.channelCount;l++){const t=[];for(let n=0;n<o.matrixRows;n++)t.push(e.readUint8());o.patternMatrix.push(t)}const r=e.readUint8();for(let l=0;l<r;l++){const t=this.parseInstrument(e,n,a);o.instruments.push(t)}const i=e.readUint8();for(let l=0;l<i;l++){const t=e.readUint32(),n=[];for(let s=0;s<t;s++)n.push(e.readUint32());o.wavetables.push(n)}for(let l=0;l<o.channelCount;l++){const t=e.readUint8();for(let n=0;n<o.matrixRows;n++){const n={rows:[]};for(let s=0;s<o.patternRows;s++){const a={note:e.readUint16(),octave:e.readUint16(),volume:e.readInt16(),instrument:e.readInt16(),effects:[]};for(let n=0;n<t;n++){const t=e.readInt16(),n=e.readInt16();t>=0&&a.effects.push({code:t,value:n})}n.rows[s]||(n.rows[s]=[]),n.rows[s][l]=a}o.patterns.push(n)}}return o}static extractVersion(e){const t=e.match(/\.DeFleMask\.(\d+)/);return t?parseInt(t[1],10):24}static parseInstrument(e,t,n){const s=t>=17?e.readPrefixedString():e.readNullTerminatedString(),a=e.readUint8(),o={...va,chipType:this.SYSTEM_MAP[n.id]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===a){o.algorithm=e.readUint8(),o.feedback=e.readUint8();const s=11===n.id||12===n.id?2:4;t>=19&&(e.readUint8(),e.readUint8());for(let n=0;n<s;n++){const n=this.parseOperator(e,t);o.operators.push(n)}}else this.readMacros(e,o);return{name:s,config:o}}static parseOperator(e,t){const n={enabled:!0,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt:0,dt2:0,rs:0,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};return t>=11&&(n.dt=e.readInt8(),n.rs=e.readUint8()),t>=12&&e.readUint8(),t>=15&&(n.ssg=e.readUint8()),n}static parseDMP(e){e.readUint8();const t=e.readUint8(),n=e.readUint8(),s={...va,chipType:this.SYSTEM_MAP[t]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===n){s.algorithm=e.readUint8(),s.feedback=e.readUint8();for(let t=0;t<4;t++){const t={enabled:!0,mult:e.readUint8(),tl:e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,sl:e.readUint8(),rr:e.readUint8(),dt:e.readInt8(),dt2:0,rs:e.readUint8(),am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};s.operators.push(t)}}else this.readMacros(e,s);return{name:"DefleMask Instrument",config:s}}static parseDMW(e){const t=[];for(;!e.isEOF();)t.push(e.readUint8());return t}static readMacros(e,t){const n=["volume","arp","duty","wave","pitch"];for(const s of n){if(e.readUint8()){const a=e.readUint8(),o=e.readUint8(),r=[];for(let t=0;t<a;t++)r.push(e.readInt32());t.macros.push({type:n.indexOf(s),data:r,loop:o,release:-1,mode:0})}}}}function iN(e,t){const n={...e};for(const s of Object.keys(t)){const a=t[s],o=e[s];null!=a&&("object"!=typeof a||Array.isArray(a)||"object"!=typeof o||Array.isArray(o)?n[s]=a:n[s]=iN(o,a))}return n}function lN(e){const t={...e};switch(e.synthType){case"TB303":case"Buzz3o3":t.tb303=iN(La,e.tb303||{}),t.tb303?.devilFish&&0!==t.tb303.devilFish.filterSelect&&5!==t.tb303.devilFish.filterSelect&&(t.tb303.devilFish.filterSelect=0);break;case"DrumMachine":t.drumMachine=iN(ca,e.drumMachine||{});break;case"ChipSynth":t.chipSynth=iN(ua,e.chipSynth||{});break;case"PWMSynth":t.pwmSynth=iN(da,e.pwmSynth||{});break;case"Wavetable":t.wavetable=iN(Xs,e.wavetable||{});break;case"GranularSynth":t.granular=iN(zs,e.granular||{});break;case"SuperSaw":t.superSaw=iN(ra,e.superSaw||{});break;case"PolySynth":t.polySynth=iN(ia,e.polySynth||{});break;case"Organ":t.organ=iN(la,e.organ||{});break;case"StringMachine":t.stringMachine=iN(ma,e.stringMachine||{});break;case"FormantSynth":t.formantSynth=iN(ga,e.formantSynth||{});break;case"WobbleBass":t.wobbleBass=iN(ha,e.wobbleBass||{});break;case"DubSiren":t.dubSiren=iN(ka,e.dubSiren||{});break;case"SpaceLaser":t.spaceLaser=iN(Va,e.spaceLaser||{});break;case"V2":t.v2=iN(Ca,e.v2||{});break;case"Sam":t.sam=iN(Da,e.sam||{});break;case"Synare":t.synare=iN(Pa,e.synare||{});break;case"Buzzmachine":t.buzzmachine=iN(fa,e.buzzmachine||{});break;case"Dexed":t.dexed=iN(ya,e.dexed||{});break;case"OBXd":t.obxd=iN(xa,e.obxd||{});break;case"DrumKit":t.drumKit=iN(wa,e.drumKit||{});break;case"Furnace":t.furnace=iN(va,e.furnace||{})}return t}function cN(e){return"string"==typeof e.note}function uN(e){return e.some(e=>{const t=e.id;return 0===t||t>0&&t%100==0&&t<3200})}function dN(e){return 0===e?1:e%100==0&&e<3200?e/100+1:e}function mN(e){const t={...e};if("string"==typeof e.note?t.note=Xa(e.note):null!==e.note&&void 0!==e.note||(t.note=0),null===e.instrument||void 0===e.instrument?t.instrument=0:"number"==typeof e.instrument&&(t.instrument=dN(e.instrument)),null===e.volume||void 0===e.volume?t.volume=0:"number"==typeof e.volume&&e.volume<=64&&(t.volume=16+e.volume),void 0!==e.effect&&"string"==typeof e.effect){const n=e.effect;if(n&&"..."!==n&&"000"!==n){const[e,s]=qa(n);t.effTyp=e,t.eff=s}else t.effTyp=0,t.eff=0;delete t.effect}if(t.effTyp||0===t.effTyp||(t.effTyp=0),t.eff||0===t.eff||(t.eff=0),void 0!==e.effect2&&"string"==typeof e.effect2){const n=e.effect2;if(n&&"..."!==n&&"000"!==n){const[e,s]=qa(n);t.effTyp2=e,t.eff2=s}else t.effTyp2=0,t.eff2=0;delete t.effect2}return void 0!==t.effTyp2&&null!==t.effTyp2||(t.effTyp2=0),void 0!==t.eff2&&null!==t.eff2||(t.eff2=0),t}function pN(e){return{...e,channels:e.channels.map(e=>({...e,rows:e.rows.map(e=>mN(e)),instrumentId:null!==e.instrumentId&&void 0!==e.instrumentId?dN(e.instrumentId):1}))}}function hN(e){const t=new Map;let n=1;for(const s of e)if(!t.has(s.id)){const e=dN(s.id);Array.from(t.values()).includes(e)?t.set(s.id,n++):(t.set(s.id,e),n=Math.max(n,e+1))}return e.map(e=>{const n=t.get(e.id)??e.id,s="Sampler"===e.synthType||"Player"===e.synthType?"sample":"synth";return{...lN(e),id:n,type:e.type||s}})}function fN(e,t){const n=e.some(e=>e.channels.some(e=>e.rows.some(e=>cN(e)))),s=uN(t),a=t.some(e=>!e.type),o=t.some(e=>function(e){switch(e.synthType){case"TB303":case"Buzz3o3":return!e.tb303||!e.tb303.filter||!e.tb303.filterEnvelope;case"DrumMachine":return!e.drumMachine;case"ChipSynth":return!e.chipSynth||!e.chipSynth.envelope;case"PWMSynth":return!e.pwmSynth||!e.pwmSynth.envelope;case"SuperSaw":return!e.superSaw||!e.superSaw.envelope;case"PolySynth":return!e.polySynth||!e.polySynth.envelope;case"Organ":return!e.organ||!e.organ.drawbars;case"StringMachine":return!e.stringMachine;case"FormantSynth":return!e.formantSynth||!e.formantSynth.envelope;case"WobbleBass":return!e.wobbleBass||!e.wobbleBass.envelope;case"DubSiren":return!e.dubSiren||!e.dubSiren.reverb;case"SpaceLaser":return!e.spaceLaser;case"Dexed":return!e.dexed;case"OBXd":return!e.obxd;case"DrumKit":return!e.drumKit;case"Furnace":return!e.furnace;default:return!1}}(e));return n||s||a||o}function gN(e,t){return{patterns:e.map(e=>pN(e)),instruments:hN(t)}}const bN=Object.freeze(Object.defineProperty({__proto__:null,deepMerge:iN,ensureCompleteInstrumentConfig:lN,hasOldInstrumentIds:uN,isOldFormatCell:cN,migrateCell:mN,migrateInstrumentId:dN,migrateInstruments:hN,migratePattern:pN,migrateProject:gN,needsMigration:fN},Symbol.toStringTag,{value:"Module"}));class vN{static createBuffer(e,t,n){return new AudioBuffer({length:Math.max(1,e),numberOfChannels:t,sampleRate:n})}static copyRegion(e,t,n,s,a){for(let o=0;o<e.numberOfChannels;o++){const r=e.getChannelData(o),i=t.getChannelData(o);for(let e=0;e<a;e++)i[s+e]=r[n+e]}}static reverse(e){const{numberOfChannels:t,length:n,sampleRate:s}=e,a=this.createBuffer(n,t,s);for(let o=0;o<t;o++){const t=e.getChannelData(o),s=a.getChannelData(o);for(let e=0;e<n;e++)s[e]=t[n-1-e]}return a}static reverseRange(e,t,n){const{numberOfChannels:s,length:a,sampleRate:o}=e,r=this.createBuffer(a,s,o);for(let i=0;i<s;i++){const s=e.getChannelData(i),o=r.getChannelData(i);for(let e=0;e<t;e++)o[e]=s[e];const l=n-t;for(let e=0;e<l;e++)o[t+e]=s[n-1-e];for(let e=n;e<a;e++)o[e]=s[e]}return r}static normalize(e){const{numberOfChannels:t,length:n,sampleRate:s}=e;let a=0;for(let i=0;i<t;i++){const t=e.getChannelData(i);for(let e=0;e<n;e++){const n=Math.abs(t[e]);n>a&&(a=n)}}if(0===a||1===a)return e;const o=1/a,r=this.createBuffer(n,t,s);for(let i=0;i<t;i++){const t=e.getChannelData(i),s=r.getChannelData(i);for(let e=0;e<n;e++)s[e]=t[e]*o}return r}static normalizeRange(e,t,n){const{numberOfChannels:s,length:a,sampleRate:o}=e;let r=0;for(let c=0;c<s;c++){const s=e.getChannelData(c);for(let e=t;e<n;e++){const t=Math.abs(s[e]);t>r&&(r=t)}}if(0===r||1===r)return e;const i=1/r,l=this.createBuffer(a,s,o);for(let c=0;c<s;c++){const s=e.getChannelData(c),o=l.getChannelData(c);for(let e=0;e<a;e++)o[e]=e>=t&&e<n?s[e]*i:s[e]}return l}static amigaPal8Bit(e){const{numberOfChannels:t,length:n,sampleRate:s}=e;let a=0;for(let r=0;r<t;r++){const t=e.getChannelData(r);for(let e=0;e<n;e++){const n=Math.abs(t[e]);n>a&&(a=n)}}const o=this.createBuffer(n,t,s);for(let r=0;r<t;r++){const t=e.getChannelData(r),s=o.getChannelData(r);for(let e=0;e<n;e++){let n=a>0?t[e]/a:t[e];n=Math.max(-1,Math.min(1,n));let o=Math.round(128*n);o=Math.max(-128,Math.min(127,o));const r=Math.pow(.5,8);s[e]=r*Math.floor(o/128/r)}}return o}static invertLoop(e,t,n){const{numberOfChannels:s,length:a,sampleRate:o}=e,r=this.createBuffer(a,s,o);for(let i=0;i<s;i++){const s=e.getChannelData(i),o=r.getChannelData(i);for(let e=0;e<t;e++)o[e]=s[e];for(let e=t;e<n&&e<a;e++)o[e]=-s[e];for(let e=n;e<a;e++)o[e]=s[e]}return r}static applyGain(e,t){const{numberOfChannels:n,length:s,sampleRate:a}=e,o=this.createBuffer(s,n,a);for(let r=0;r<n;r++){const n=e.getChannelData(r),a=o.getChannelData(r);for(let e=0;e<s;e++)a[e]=n[e]*t}return o}static adjustVolume(e,t,n,s){const{numberOfChannels:a,length:o,sampleRate:r}=e,i=this.createBuffer(o,a,r);for(let l=0;l<a;l++){const a=e.getChannelData(l),r=i.getChannelData(l);for(let e=0;e<o;e++)r[e]=e>=t&&e<n?Math.max(-1,Math.min(1,a[e]*s)):a[e]}return i}static copy(e,t,n){const s=n-t;if(s<=0)return this.createBuffer(1,e.numberOfChannels,e.sampleRate);const a=this.createBuffer(s,e.numberOfChannels,e.sampleRate);return this.copyRegion(e,a,t,0,s),a}static cut(e,t,n){const s=this.copy(e,t,n);return{remaining:this.deleteRange(e,t,n),cut:s}}static paste(e,t,n){const s=e.length+n.length,a=e.numberOfChannels,o=this.createBuffer(s,a,e.sampleRate);t>0&&this.copyRegion(e,o,0,0,t);for(let i=0;i<Math.min(a,n.numberOfChannels);i++){const e=n.getChannelData(i),s=o.getChannelData(i);for(let a=0;a<n.length;a++)s[t+a]=e[a]}const r=e.length-t;return r>0&&this.copyRegion(e,o,t,t+n.length,r),o}static crop(e,t,n){return this.copy(e,t,n)}static deleteRange(e,t,n){const s=n-t,a=e.length-s;if(a<=0)return this.createBuffer(1,e.numberOfChannels,e.sampleRate);const o=this.createBuffer(a,e.numberOfChannels,e.sampleRate);t>0&&this.copyRegion(e,o,0,0,t);const r=e.length-n;return r>0&&this.copyRegion(e,o,n,t,r),o}static silence(e,t,n){const{numberOfChannels:s,length:a,sampleRate:o}=e,r=this.createBuffer(a,s,o);for(let i=0;i<s;i++){const s=e.getChannelData(i),o=r.getChannelData(i);for(let e=0;e<a;e++)o[e]=e>=t&&e<n?0:s[e]}return r}static fadeIn(e,t,n,s="linear"){const{numberOfChannels:a,length:o,sampleRate:r}=e,i=this.createBuffer(o,a,r),l=n-t;for(let c=0;c<a;c++){const a=e.getChannelData(c),r=i.getChannelData(c);for(let e=0;e<o;e++)if(e>=t&&e<n){const n=(e-t)/l,o="exponential"===s?n*n:n;r[e]=a[e]*o}else r[e]=a[e]}return i}static fadeOut(e,t,n,s="linear"){const{numberOfChannels:a,length:o,sampleRate:r}=e,i=this.createBuffer(o,a,r),l=n-t;for(let c=0;c<a;c++){const a=e.getChannelData(c),r=i.getChannelData(c);for(let e=0;e<o;e++)if(e>=t&&e<n){const n=1-(e-t)/l,o="exponential"===s?n*n:n;r[e]=a[e]*o}else r[e]=a[e]}return i}static dcOffsetRemoval(e,t,n){const s=t??0,a=n??e.length,{numberOfChannels:o,length:r,sampleRate:i}=e,l=this.createBuffer(r,o,i);for(let c=0;c<o;c++){const t=e.getChannelData(c),n=l.getChannelData(c);let o=0;for(let e=s;e<a;e++)o+=t[e];const i=o/(a-s);for(let e=0;e<r;e++)n[e]=e>=s&&e<a?t[e]-i:t[e]}return l}static findNearestZeroCrossing(e,t,n=512){const s=e.getChannelData(0),a=s.length;let o=n+1,r=t;const i=Math.max(0,t-n),l=Math.min(a-1,t+n);for(let c=i;c<l;c++)if(s[c]>=0&&s[c+1]<0||s[c]<0&&s[c+1]>=0){const e=Math.abs(c-t);e<o&&(o=e,r=c)}return r}static findBestLoopPoint(e,t=1e3,n){const s=e.getChannelData(0),a=s.length,o=n??Math.floor(.9*a);let r=-1/0,i=0,l=a;const c=Math.max(1,Math.floor(a/500));for(let m=Math.min(o,a);m>t+256;m-=c)for(let e=0;e<m-t;e+=c){let t=0;const n=Math.min(256,m-e);for(let a=0;a<n;a++)t+=s[e+a]*s[m-n+a];t>r&&(r=t,i=e,l=m)}const u=this.findNearestZeroCrossing(e,i,128),d=this.findNearestZeroCrossing(e,l,128);return{start:"number"==typeof u?u:i,end:"number"==typeof d?d:l}}static async bufferToWav(e){const t=e.numberOfChannels,n=e.sampleRate,s=e.length,a=2*t,o=n*a,r=s*a,i=44+r,l=new ArrayBuffer(i),c=new DataView(l);this.writeString(c,0,"RIFF"),c.setUint32(4,i-8,!0),this.writeString(c,8,"WAVE"),this.writeString(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,t,!0),c.setUint32(24,n,!0),c.setUint32(28,o,!0),c.setUint16(32,a,!0),c.setUint16(34,16,!0),this.writeString(c,36,"data"),c.setUint32(40,r,!0);let u=44;for(let d=0;d<s;d++)for(let n=0;n<t;n++){let t=e.getChannelData(n)[d];t=Math.max(-1,Math.min(1,t));const s=t<0?32768*t:32767*t;c.setInt16(u,s,!0),u+=2}return l}static writeString(e,t,n){for(let s=0;s<n.length;s++)e.setUint8(t+s,n.charCodeAt(s))}}function yN(e){e&&(e.url&&URL.revokeObjectURL(e.url),e.multiMap&&Object.values(e.multiMap).forEach(e=>URL.revokeObjectURL(e)))}const xN=new Set;function NN(e,t){const n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=new Set;return e.forEach(e=>{e.channels.forEach(e=>{e.rows.forEach(e=>{if(e.instrument===t&&e.note>0&&e.note<=96){const t=(e.note-1)%12,a=Math.floor((e.note-1)/12),o=n[t];s.add(o.includes("#")?`${o}${a}`:`${o}-${a}`)}})})}),Array.from(s).sort()}function wN(e){for(let t=1;t<=128;t++)if(!e.includes(t))return t;return 1}const EN=i()(ds((e,t)=>({instruments:[],currentInstrumentId:0,get currentInstrument(){const e=t();return e.instruments.find(t=>t.id===e.currentInstrumentId)||null},previewInstrument:null,presets:[],setCurrentInstrument:n=>{const s=t().instruments.find(e=>e.id===n);s&&(e(e=>{e.currentInstrumentId=n}),"TB303"!==s.synthType&&"Buzz3o3"!==s.synthType||os(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>FD);return{useTrackerStore:e}},[]).then(({useTrackerStore:e})=>{const t=e.getState().columnVisibility;t.flag1&&t.flag2||e.getState().setColumnVisibility({flag1:!0,flag2:!0})}).catch(()=>{}))},setPreviewInstrument:t=>e(e=>{e.previewInstrument=t}),getInstrument:e=>t().instruments.find(t=>t.id===e),updateInstrument:(n,s)=>{const a=t().instruments.find(e=>e.id===n),o=a&&s.synthType&&s.synthType!==a.synthType,r=s.name&&s.synthType,i=!!(s.oscillator||s.envelope||s.filter||s.filterEnvelope||s.superSaw||s.polySynth||s.organ||s.drumMachine||s.chipSynth||s.pwmSynth||s.stringMachine||s.formantSynth||s.wavetable||s.granular||s.furnace||s.dubSiren||s.synare||s.sam||s.v2Speech||s.tb303||s.buzzmachine||s.spaceLaser||s.v2||s.wam||s.parameters||s.sample||s.superCollider);if(e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e=Object.fromEntries(Object.entries(s).filter(([e])=>"id"!==e));if(Object.keys(e).forEach(n=>{const s=e[n],a=n;s&&"object"==typeof s&&!Array.isArray(s)&&t[a]?t[a]={...t[a],...s}:t[a]=s}),s.sample&&s.sample.url){const e=t.parameters;e?.sampleUrl&&delete e.sampleUrl}if(o&&!r&&s.synthType?.startsWith("Furnace")){const e=QN(s.synthType);e&&(t.furnace=e)}if(o&&"DubSiren"===s.synthType&&!t.dubSiren&&(t.dubSiren={...ka}),o&&"SpaceLaser"===s.synthType&&!t.spaceLaser&&(t.spaceLaser={...Va}),o&&"V2"===s.synthType&&!t.v2&&(t.v2={...Ca}),o&&"Synare"===s.synthType&&!t.synare&&(t.synare={...Pa}),o&&"Sam"===s.synthType&&!t.sam&&(t.sam={...Da}),o&&"V2Speech"===s.synthType&&!t.v2Speech&&(t.v2Speech={...Ma}),o&&!r&&s.synthType){const e=t.furnace?.chipType,n=t.buzzmachine?.machineType,a=nN(s.synthType);if(a){const o=a,r=Object.fromEntries(Object.entries(o).filter(([e])=>"name"!==e&&"type"!==e&&"synthType"!==e));Object.keys(r).forEach(e=>{const n=r[e],s=e;n&&"object"==typeof n&&!Array.isArray(n)&&t[s]?Object.assign(t[s],n):t[s]=n}),t.synthType=s.synthType,void 0!==e&&t.furnace&&(t.furnace.chipType=e),n&&t.buzzmachine&&(t.buzzmachine.machineType=n)}}if(o&&s.synthType){const e=s.synthType;"TB303"!==e&&"Buzz3o3"!==e&&delete t.tb303,"Sampler"!==e&&"Player"!==e&&delete t.sample}}}),!o&&!r)try{const a=Bw(),o=t().instruments.find(e=>e.id===n);if(o){if(("TB303"===o.synthType||"Buzz3o3"===o.synthType)&&o.tb303&&s.tb303)return void a.updateTB303Parameters(n,o.tb303);if("DubSiren"===o.synthType&&o.dubSiren&&s.dubSiren)return void a.updateDubSirenParameters(n,o.dubSiren);if("SpaceLaser"===o.synthType&&o.spaceLaser&&s.spaceLaser)return void a.updateSpaceLaserParameters(n,o.spaceLaser);if("V2"===o.synthType&&o.v2&&s.v2)return void a.updateV2Parameters(n,o.v2);if(("V2"===o.synthType||"V2Speech"===o.synthType)&&o.v2Speech&&s.v2Speech)return void a.updateComplexSynthParameters(n,o.v2Speech);if("Sam"===o.synthType&&o.sam&&s.sam)return void a.updateComplexSynthParameters(n,o.sam);if("Synare"===o.synthType&&o.synare&&s.synare)return void a.updateSynareParameters(n,o.synare);if("HarmonicSynth"===o.synthType&&o.harmonicSynth&&s.harmonicSynth)return void a.updateHarmonicSynthParameters(n,o.harmonicSynth);if(o.synthType?.startsWith("Furnace")&&o.furnace&&s.furnace)return void a.updateFurnaceInstrument(n,o);if("Buzz3o3"===o.synthType&&o.tb303&&s.tb303){const t=o.tb303,s=o.buzzmachine||{machineType:"OomekAggressor",parameters:{}},r={...s.parameters};return r[0]="square"===t.oscillator.type?1:0,r[1]=Math.round(Math.log2(t.filter.cutoff/200)/Math.log2(25)*240),r[2]=Math.round(t.filter.resonance/100*128),r[3]=Math.round(t.filterEnvelope.envMod/100*128),r[4]=Math.round(Math.log2(t.filterEnvelope.decay/30)/Math.log2(100)*128),r[5]=Math.round(t.accent.amount/100*128),r[6]=Math.round((t.tuning||0)+100),e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.buzzmachine={...s,parameters:r})}),void a.updateBuzzmachineParameters(n,{...s,parameters:r})}if(o.synthType.startsWith("Buzz")&&o.buzzmachine&&s.buzzmachine)return void a.updateBuzzmachineParameters(n,o.buzzmachine);if(("Furnace"===o.synthType||o.synthType.startsWith("Furnace"))&&o.furnace&&s.furnace)return void a.updateFurnaceParameters(n,o.furnace);if("WAM"===o.synthType&&o.wam&&s.wam)return void a.updateWAMParameters(n,o.wam);if(["SuperSaw","WobbleBass","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth"].includes(o.synthType)){const e=o.synthType.charAt(0).toLowerCase()+o.synthType.slice(1),t=o[e];if(t&&s[e])return void a.updateComplexSynthParameters(n,t)}if(["Synth","FMSynth","AMSynth","MonoSynth","DuoSynth","PluckSynth","MembraneSynth","MetalSynth","NoiseSynth"].includes(o.synthType)&&(s.oscillator||s.envelope||s.filter||s.filterEnvelope||void 0!==s.volume))return void a.updateToneJsSynthInPlace(n,o)}}catch(l){}if(o||r||i)try{const e=Bw();s.superCollider,e.invalidateInstrument(n)}catch(l){}},createInstrument:n=>{const s=wN(t().instruments.map(e=>e.id));return e(e=>{const t={id:a=s,name:`Instrument ${String(a).padStart(2,"0")}`,type:"synth",synthType:"Sampler",oscillator:{..._a},envelope:{...Oa},filter:{...Ta},effects:[],volume:0,pan:0};var a;const o=n?iN(t,n):t;if(o.id=s,o.synthType&&"TB303"!==o.synthType&&"Buzz3o3"!==o.synthType&&delete o.tb303,o.synthType&&"Sampler"!==o.synthType&&"Player"!==o.synthType&&delete o.sample,void 0===n?.monophonic){const e=new Set(["MonoSynth","DuoSynth","TB303","Buzz3o3","DB303","DubSiren","SpaceLaser","Synare","MAMEMEA8000","MAMETMS5220","MAMESP0250","MAMEVotrax","Sam","V2Speech","MAMECM3394","MAMETMS36XX","MAMESN76477","MAMEUPD931","MAMEUPD933"]);o.synthType&&e.has(o.synthType)&&(o.monophonic=!0)}e.instruments.push(o),e.currentInstrumentId=s}),s},addInstrument:t=>{e(e=>{const n={...t};if(n.id<1||n.id>128){const t=e.instruments.map(e=>e.id);n.id=wN(t)}if(void 0===n.monophonic){const e=new Set(["MonoSynth","DuoSynth","TB303","Buzz3o3","DB303","DubSiren","SpaceLaser","Synare","MAMEMEA8000","MAMETMS5220","MAMESP0250","MAMEVotrax","Sam","V2Speech","MAMECM3394","MAMETMS36XX","MAMESN76477","MAMEUPD931","MAMEUPD933"]);n.synthType&&e.has(n.synthType)&&(n.monophonic=!0)}const s=e.instruments.find(e=>e.id===n.id);s?Object.assign(s,n):e.instruments.push(n),e.currentInstrumentId=n.id})},deleteInstrument:t=>e(e=>{const n=e.instruments.findIndex(e=>e.id===t);-1!==n&&e.instruments.length>1&&(yN(e.instruments[n].sample),e.instruments.splice(n,1),e.currentInstrumentId===t&&(e.currentInstrumentId=e.instruments[0].id))}),cloneInstrument:n=>{const s=t().instruments.find(e=>e.id===n);if(!s)return n;const a=wN(t().instruments.map(e=>e.id));return e(e=>{const t=structuredClone(s);t.id=a,t.name=`${s.name} (Copy)`,e.instruments.push(t),e.currentInstrumentId=a}),a},resetInstrument:t=>{e(e=>{const n=e.instruments.find(e=>e.id===t);if(n){const e=n.synthType,t=function(e){const t={synthType:e,effects:[],volume:-12,pan:0};switch(e){case"TB303":t.tb303={...La};break;case"DrumMachine":t.drumMachine={...ca};break;case"ChipSynth":t.chipSynth={...ua};break;case"PWMSynth":t.pwmSynth={...da};break;case"Wavetable":t.wavetable={...Xs};break;case"GranularSynth":t.granular={...zs};break;case"SuperSaw":t.superSaw={...ra};break;case"PolySynth":t.polySynth={...ia};break;case"Organ":t.organ={...la};break;case"StringMachine":t.stringMachine={...ma};break;case"FormantSynth":t.formantSynth={...ga};break;case"WobbleBass":t.wobbleBass={...ha};break;case"DubSiren":t.dubSiren={...ka};break;case"SpaceLaser":t.spaceLaser={...Va};break;case"V2":t.v2={...Ca};break;case"Sam":t.sam={...Da};break;case"Synare":t.synare={...Pa};break;case"WAMOBXd":case"WAMSynth101":case"WAMTinySynth":case"WAMFaustFlute":case"WAM":t.wam={...Sa};break;case"Buzz3o3":t.tb303={...La},t.buzzmachine={...fa,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}};break;case"Buzzmachine":t.buzzmachine={...fa};break;case"Dexed":t.dexed={...ya};break;case"OBXd":t.obxd={...xa};break;case"DrumKit":t.drumKit={...wa};break;case"ChiptuneModule":t.chiptuneModule={...qs};break;case"MAMEVFX":t.mame={...Gs};break;case"MAMEDOC":t.mame={...Hs};break;case"MAMERSA":t.rdpiano={...Na};break;case"MAMESWP30":t.mame={...Ws};break;case"SuperCollider":t.superCollider={...Aa},t.isLive=!0}const n=nN(e);if(n){const s=n,a=Object.fromEntries(Object.entries(s).filter(([e])=>"name"!==e&&"type"!==e&&"synthType"!==e));Object.assign(t,a),t.synthType=e}return t}(e);if(Object.assign(n,{...t,synthType:e,name:n.name,tb303:void 0,drumMachine:void 0,chipSynth:void 0,pwmSynth:void 0,wavetable:void 0,granular:void 0,superSaw:void 0,polySynth:void 0,organ:void 0,stringMachine:void 0,formantSynth:void 0,furnace:void 0,chiptuneModule:void 0,wobbleBass:void 0,drumKit:void 0,dubSiren:void 0,spaceLaser:void 0,synare:void 0,v2:void 0}),"TB303"===e||"Buzz3o3"===e)n.tb303={...La},"Buzz3o3"===e&&(n.buzzmachine={...fa,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}});else if("DubSiren"===e)n.dubSiren={...ka};else if("SpaceLaser"===e)n.spaceLaser={...Va};else if("V2"===e)n.v2={...Ca};else if("Synare"===e)n.synare={...Pa};else if(e.startsWith("Furnace")){const t=QN(e);t&&(n.furnace=t)}}});try{Bw().invalidateInstrument(t)}catch(n){}},bakeInstrument:async(n,s="lite")=>{const a=t().instruments.find(e=>e.id===n);if(a&&"Sampler"!==a.synthType&&!xN.has(n)){xN.add(n);try{const o=Bw();a.sample&&yN(a.sample);const r=structuredClone(a);if(delete r.metadata,"pro"===s){const s=NN((await os(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>FD);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,n);if(0===s.length)return t().bakeInstrument(n,"lite");const i={};for(const e of s){const t=await o.bakeInstrument(a,2,e),n=await vN.bufferToWav(t),s=new Blob([n],{type:"audio/wav"});i[e]=URL.createObjectURL(s)}e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:r,bakeType:"pro"}},t.synthType="Sampler",t.sample={url:"",multiMap:i,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}else{const t=await o.bakeInstrument(a,2,"C4"),s=await vN.bufferToWav(t),i=new Blob([s],{type:"audio/wav"}),l=URL.createObjectURL(i);e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:r,bakeType:"lite"}},t.synthType="Sampler",t.sample={url:l,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}o.invalidateInstrument(n)}catch(o){}finally{xN.delete(n)}}},unbakeInstrument:n=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t&&t.metadata?.preservedSynth){const{synthType:e,config:n}=t.metadata.preservedSynth;yN(t.sample);const s={...t.metadata};delete s.preservedSynth,Object.assign(t,n),t.synthType=e,t.metadata=s,t.sample=void 0}});try{const e=Bw();e.invalidateInstrument(n);const s=t().instruments.find(e=>e.id===n);s&&e.rebuildInstrumentEffects(n,s.effects)}catch{}},autoBakeInstruments:async()=>{const n=t().instruments.filter(e=>e.metadata?.preservedSynth&&!e.sample?.url&&!e.sample?.multiMap);if(0!==n.length)for(const t of n){const n=t.metadata.preservedSynth,a={...t,...n.config,synthType:n.synthType},o=n.bakeType||"lite";try{const n=Bw();if("pro"===o){const s=NN((await os(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>FD);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,t.id),o={};for(const e of s){const t=await n.bakeInstrument(a,2,e),s=await vN.bufferToWav(t),r=new Blob([s],{type:"audio/wav"});o[e]=URL.createObjectURL(r)}e(e=>{const n=e.instruments.find(e=>e.id===t.id);n&&n.sample&&(n.sample.multiMap=o)})}else{const s=await n.bakeInstrument(a,2,"C4"),o=await vN.bufferToWav(s),r=new Blob([o],{type:"audio/wav"}),i=URL.createObjectURL(r);e(e=>{const n=e.instruments.find(e=>e.id===t.id);n&&n.sample&&(n.sample.url=i)})}n.invalidateInstrument(t.id)}catch(s){}}},addEffect:(n,s)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e={id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:s,enabled:!0,wet:50,parameters:$N(s)};t.effects.push(e)}});const a=t().instruments.find(e=>e.id===n);a&&(async()=>{try{const e=Bw();await e.rebuildInstrumentEffects(n,a.effects)}catch(e){}})()},addEffectConfig:(n,s)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e={...s,id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,parameters:{...$N(s.type),...s.parameters}};t.effects.push(e)}});const a=t().instruments.find(e=>e.id===n);a&&(async()=>{try{const e=Bw();await e.rebuildInstrumentEffects(n,a.effects)}catch(e){}})()},removeEffect:(n,s)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e=t.effects.findIndex(e=>e.id===s);-1!==e&&t.effects.splice(e,1)}});const a=t().instruments.find(e=>e.id===n);a&&(async()=>{try{const e=Bw();await e.rebuildInstrumentEffects(n,a.effects)}catch(e){}})()},updateEffect:(n,s,a)=>{if(e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const e=t.effects.find(e=>e.id===s);e&&(a.parameters&&Object.keys(e.parameters).length<Object.keys($N(e.type)).length&&(e.parameters={...$N(e.type),...e.parameters}),Object.assign(e,a))}}),void 0!==a.enabled){const e=t().instruments.find(e=>e.id===n);e&&(async()=>{try{const t=Bw();await t.rebuildInstrumentEffects(n,e.effects)}catch(t){}})()}else{const e=t().instruments.find(e=>e.id===n),a=e?.effects.find(e=>e.id===s);if(a)try{Bw().updateInstrumentEffectParams(s,a)}catch{}}const o=t().instruments.find(e=>e.id===n),r=o?.effects.find(e=>e.id===s);if(1===r?.parameters.bpmSync)try{const e=Bw(),t=e.getBPM();e.updateBpmSyncedEffects(t)}catch{}},reorderEffects:(n,s,a)=>{e(e=>{const t=e.instruments.find(e=>e.id===n);if(t){const[e]=t.effects.splice(s,1);t.effects.splice(a,0,e)}});const o=t().instruments.find(e=>e.id===n);o&&(async()=>{try{const e=Bw();await e.rebuildInstrumentEffects(n,o.effects)}catch(e){}})()},loadPreset:(t,n)=>{e(e=>{const s=e.instruments.find(e=>e.id===n);s&&(Object.assign(s,t.config),s.id=n)});try{Bw().invalidateInstrument(n)}catch(s){}},saveAsPreset:(t,n,s)=>e(e=>{const a=e.instruments.find(e=>e.id===t);if(a){const t={id:`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:n,category:s,tags:[],author:"User",config:{name:a.name,type:a.type,synthType:a.synthType,oscillator:a.oscillator,envelope:a.envelope,filter:a.filter,filterEnvelope:a.filterEnvelope,tb303:a.tb303,effects:a.effects,volume:a.volume,pan:a.pan}};e.presets.push(t)}}),loadInstruments:n=>{t().instruments.forEach(e=>{yN(e.sample)});Bw().disposeAllInstruments();const s=new Set,a=n.map(e=>{const t=lN(e);if(t.id<1||t.id>128){let e=1;for(let t=1;t<=128;t++)if(!s.has(t)){e=t;break}t.id=e}return s.add(t.id),{...t,synthType:e.synthType,type:e.type||("Sampler"===e.synthType?"sample":"synth"),effects:e.effects?.map(e=>({...e,category:e.category||"tonejs"}))||[]}});e(e=>{e.instruments=a,e.currentInstrumentId=a.length>0?a[0].id:null}),Bw().preloadInstruments(a).catch(e=>{})},loadFurnaceInstrument:n=>{try{const{name:s,config:a}=aN.parse(n),o=wN(t().instruments.map(e=>e.id));e(e=>{const t={id:o,name:s||"Furnace Patch",type:"synth",synthType:"Furnace",furnace:a,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=o})}catch(s){}},loadDefleMaskInstrument:n=>{try{const s=rN.parse(n,"dmp"),{name:a,config:o}=s,r=wN(t().instruments.map(e=>e.id));e(e=>{const t={id:r,name:a||"DefleMask Patch",type:"synth",synthType:"Furnace",furnace:o,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=r})}catch(s){}},loadDefleMaskWavetable:n=>{try{const s=rN.parse(n,"dmw"),a=t().currentInstrumentId;if(!a)return;e(e=>{const t=e.instruments.find(e=>e.id===a);"Furnace"===t?.synthType&&t.furnace&&t.furnace.wavetables.push({id:t.furnace.wavetables.length,data:s})})}catch(s){}},transformInstrument:(n,s,a)=>{const o=t().instruments.find(e=>e.id===n);if(!o)return;if("Sampler"!==o.synthType)return;const r=o.sample?{...o.sample,envelope:o.envelope||{...Oa}}:void 0;if(!r)return;let i;function l(t,n,s,a){e(e=>{const o=e.instruments.find(e=>e.id===t);if(!o)return;delete o.tb303,delete o.polySynth,delete o.wavetable,delete o.granular,delete o.superSaw,delete o.organ,delete o.drumMachine,delete o.chipSynth,delete o.pwmSynth,delete o.stringMachine,delete o.formantSynth,delete o.sample,o.type="synth",o.synthType=n;o[n.toLowerCase()]=s,o.metadata||(o.metadata={}),o.metadata.preservedSample=a,o.metadata.transformHistory||(o.metadata.transformHistory=[]),o.metadata.transformHistory.push({timestamp:(new Date).toISOString(),fromType:"Sampler",toType:n}),o.metadata.transformHistory.length>20&&(o.metadata.transformHistory=o.metadata.transformHistory.slice(-20))});try{Bw().invalidateInstrument(t)}catch(o){}}"analyze"===a?os(async()=>{const{analyzeSample:e,suggestSynthConfig:t}=await Promise.resolve().then(()=>zT);return{analyzeSample:e,suggestSynthConfig:t}},void 0).then(({analyzeSample:e,suggestSynthConfig:t})=>{const a=e({id:n,name:o.name,pcmData:r.audioBuffer||new ArrayBuffer(0),loopStart:r.loopStart,loopLength:r.loopEnd-r.loopStart,loopType:r.loop?"forward":"none",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:44100,length:1e3},o.metadata?.originalEnvelope);i=t(s,a),l(n,s,i,r)}):(i=function(e){switch(e){case"TB303":return{...La};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{..._a},envelope:{...Oa},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{...Oa},filter:{...Ta,cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{...Oa}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{...Oa,attack:5,decay:300},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{..._a},envelope:{...Oa}}}}(s),l(n,s,i,r))},revertToSample:n=>{const s=t().instruments.find(e=>e.id===n);if(!s)return;const a=s.metadata?.preservedSample;if(a){e(e=>{const t=e.instruments.find(e=>e.id===n);t&&(delete t.tb303,delete t.polySynth,delete t.wavetable,delete t.granular,delete t.superSaw,delete t.organ,delete t.drumMachine,delete t.chipSynth,delete t.pwmSynth,delete t.stringMachine,delete t.formantSynth,t.type="sample",t.synthType="Sampler",t.sample={audioBuffer:a.audioBuffer,url:a.url,baseNote:a.baseNote,detune:a.detune,loop:a.loop,loopStart:a.loopStart,loopEnd:a.loopEnd,reverse:!1,playbackRate:1},t.envelope=a.envelope)});try{Bw().invalidateInstrument(n)}catch(o){}}},reverseSample:async n=>{const s=t().instruments.find(e=>e.id===n);if(!s?.sample?.audioBuffer)return;const a=s.sample.audioBuffer,o=await Bw().decodeAudioData(a),r=vN.reverse(o),i=await Bw().encodeAudioData(r);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),Bw().invalidateInstrument(n)},normalizeSample:async n=>{const s=t().instruments.find(e=>e.id===n);if(!s?.sample?.audioBuffer)return;const a=s.sample.audioBuffer,o=await Bw().decodeAudioData(a),r=vN.normalize(o),i=await Bw().encodeAudioData(r);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),Bw().invalidateInstrument(n)},invertLoopSample:async n=>{const s=t().instruments.find(e=>e.id===n);if(!s?.sample?.audioBuffer||!s.sample.loop)return;const a=s.sample.audioBuffer,o=await Bw().decodeAudioData(a),r=vN.invertLoop(o,s.sample.loopStart,s.sample.loopEnd),i=await Bw().encodeAudioData(r);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=i)}),Bw().invalidateInstrument(n)},updateSampleBuffer:async(n,s)=>{const a=t().instruments.find(e=>e.id===n);if(!a?.sample)return;const o=await Bw().encodeAudioData(s);e(e=>{const t=e.instruments.find(e=>e.id===n);t?.sample&&(t.sample.audioBuffer=o)}),Bw().invalidateInstrument(n)},updateSlices:(t,n)=>{e(e=>{const s=e.instruments.find(e=>e.id===t);s?.sample&&(s.sample.slices=n)})},updateSliceConfig:(t,n)=>{e(e=>{const s=e.instruments.find(e=>e.id===t);s?.sample&&(s.sample.sliceConfig=n)})},removeSlice:(t,n)=>{e(e=>{const s=e.instruments.find(e=>e.id===t);if(s?.sample?.slices){const e=s.sample.slices,t=e.findIndex(e=>e.id===n);if(-1!==t&&e.length>1){const n=e[t];t>0?(e[t-1].endFrame=n.endFrame,e[t-1].endTime=n.endTime):t<e.length-1&&(e[t+1].startFrame=n.startFrame,e[t+1].startTime=n.startTime),e.splice(t,1)}}})},createSlicedInstruments:async(n,s,a="Slice")=>{const o=t().instruments.find(e=>e.id===n);if(!o?.sample?.url)return[];const r=[],i=t().instruments.map(e=>e.id);try{const t=Bw(),l=await fetch(o.sample.url),c=await l.arrayBuffer(),u=(await t.decodeAudioData(c)).sampleRate;for(let d=0;d<s.length;d++){const t=s[d],l=wN([...i,...r]);r.push(l);const c=t.endFrame-t.startFrame,m=t.label||`${a} ${d+1}`,p=o.name?`${o.name} - ${m}`:m;e(e=>{const s={id:l,name:p.slice(0,22),type:"sample",synthType:"Sampler",sample:{url:o.sample.url,sourceInstrumentId:n,sliceStart:t.startFrame,sliceEnd:t.endFrame,baseNote:o.sample?.baseNote||"C-4",detune:o.sample?.detune||0,loop:!1,loopStart:0,loopEnd:c,sampleRate:u,reverse:!1,playbackRate:1},envelope:o.envelope||{...Oa},effects:[],volume:o.volume||-6,pan:o.pan||0};e.instruments.push(s)})}return r.length>0&&e(e=>{e.currentInstrumentId=r[0]}),r}catch(l){return[]}},createDrumKitFromSlices:async(n,s,a="Kit")=>{const o=t().instruments.find(e=>e.id===n);if(!o?.sample?.url)return null;const r=Bw();try{const n=await fetch(o.sample.url),i=await n.arrayBuffer(),l=await r.decodeAudioData(i),c=t().instruments.map(e=>e.id),u=[],d=[];for(let t=0;t<s.length;t++){const n=s[t],a=wN([...c,...u]);u.push(a);const o=n.endFrame-n.startFrame,i=l.numberOfChannels,m=l.sampleRate,p=new OfflineAudioContext(i,o,m).createBuffer(i,o,m);for(let e=0;e<i;e++){const t=l.getChannelData(e),s=p.getChannelData(e);for(let e=0;e<o;e++)s[e]=t[n.startFrame+e]}const h=await r.encodeAudioData(p),f=new Blob([h],{type:"audio/wav"}),g=await new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(f)}),b=n.label||`Slice ${t+1}`;e(e=>{e.instruments.push({id:a,name:`(Slice ${t+1})`.slice(0,22),type:"sample",synthType:"Sampler",sample:{url:g,audioBuffer:h,baseNote:"C-4",detune:0,loop:!1,loopStart:0,loopEnd:o,sampleRate:m,reverse:!1,playbackRate:1},envelope:{...Oa,sustain:100},effects:[],volume:-6,pan:0})});const v=36+t;v<=127&&d.push({id:`mapping-${a}`,noteStart:v,noteEnd:v,sampleId:String(a),sampleUrl:g,sampleName:b,pitchOffset:0,fineTune:0,volumeOffset:0,panOffset:0,baseNote:"C-4"})}const m=wN([...c,...u]),p=o.name?`${o.name} ${a}`:`Sliced ${a}`;return e(e=>{const t={id:m,name:p.slice(0,22),type:"synth",synthType:"DrumKit",drumKit:{...wa,keymap:d},envelope:{...Oa,sustain:100},effects:[],volume:0,pan:0};e.instruments.push(t),e.currentInstrumentId=m}),m}catch(i){return null}},reset:()=>{const n=Bw();t().instruments.forEach(e=>{try{n.invalidateInstrument(e.id)}catch{}}),e(e=>{e.instruments=[],e.currentInstrumentId=0,e.presets=[]})}}))),kN=Object.freeze(Object.defineProperty({__proto__:null,useInstrumentStore:EN},Symbol.toStringTag,{value:"Module"}));let DN=null,SN=!1,MN=!1;function CN(){if(SN)return;SN=!0;(DN||(DN=document.createElement("audio"),DN.src="/silent.mp3",DN.preload="none",DN.style.display="none",document.body.appendChild(DN)),DN).play().then(()=>{}).catch(e=>{});try{const e=N(),t=e._context||e.rawContext||N();t&&"function"==typeof t.createBuffer&&("suspended"===t.state&&t.resume(),function(e){try{const t=e.createBuffer(1,1,e.sampleRate||44100),n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start(0),n.onended=()=>{try{n.disconnect()}catch{}}}catch{}}(t))}catch{}A().catch(()=>{}),document.removeEventListener("touchend",CN,!0),document.removeEventListener("click",CN,!0)}async function VN(){SN||CN()}const PN=e=>(t,n,s)=>{const a=s.subscribe;s.subscribe=(e,t,n)=>{let o=e;if(t){const a=(null==n?void 0:n.equalityFn)||Object.is;let r=e(s.getState());o=n=>{const s=e(n);if(!a(r,s)){const e=r;t(r=s,e)}},(null==n?void 0:n.fireImmediately)&&t(r,r)}return a(o)};return e(t,n,s)};function _N(e,t){let n;try{n=e()}catch(s){return}return{getItem:e=>{var t;const s=e=>null===e?null:JSON.parse(e,void 0),a=null!=(t=n.getItem(e))?t:null;return a instanceof Promise?a.then(s):s(a)},setItem:(e,t)=>n.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>n.removeItem(e)}}const ON=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then:e=>ON(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>ON(e)(n)}}},TN=(e,t)=>(n,s,a)=>{let o={storage:_N(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},r=!1,i=0;const l=new Set,c=new Set;let u=o.storage;if(!u)return e((...e)=>{n(...e)},s,a);const d=()=>{const e=o.partialize({...s()});return u.setItem(o.name,{state:e,version:o.version})},m=a.setState;a.setState=(e,t)=>(m(e,t),d());const p=e((...e)=>(n(...e),d()),s,a);let h;a.getInitialState=()=>p;const f=()=>{var e,t;if(!u)return;const a=++i;r=!1,l.forEach(e=>{var t;return e(null!=(t=s())?t:p)});const m=(null==(t=o.onRehydrateStorage)?void 0:t.call(o,null!=(e=s())?e:p))||void 0;return ON(u.getItem.bind(u))(o.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];if(o.migrate){const t=o.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;if(a!==i)return;const[r,l]=e;return h=o.merge(l,null!=(t=s())?t:p),n(h,!0),r?d():void 0}).then(()=>{a===i&&(null==m||m(h,void 0),h=s(),r=!0,c.forEach(e=>e(h)))}).catch(e=>{a===i&&(null==m||m(void 0,e))})};return a.persist={setOptions:e=>{o={...o,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>f(),hasHydrated:()=>r,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},o.skipHydration||f(),h||p},LN=i()(TN(ds(e=>({visiblePanels:["tracker","oscilloscope","pattern-list"],trackerZoom:100,activePanel:"tracker",modalOpen:null,modalData:null,showPatterns:!1,showAutomationLanes:!1,showMacroLanes:!1,showMacroSlots:!1,sidebarCollapsed:!1,useHexNumbers:!0,rowHighlightInterval:4,showBeatLabels:!1,chordEntryMode:!1,blankEmptyCells:!1,tb303Collapsed:!0,oscilloscopeVisible:!0,compactToolbar:!1,autoCompactApplied:!1,showSamplePackModal:!1,uiVersion:8,performanceQuality:"high",scratchEnabled:!1,scratchAcceleration:!0,platterMass:.5,activeView:"tracker",tb303PoppedOut:!1,instrumentEditorPoppedOut:!1,masterEffectsPoppedOut:!1,instrumentEffectsPoppedOut:!1,pianoRollPoppedOut:!1,oscilloscopePoppedOut:!1,arrangementPoppedOut:!1,vjPoppedOut:!1,statusMessage:"All Right",prevStatusMessage:"All Right",pendingModuleFile:null,pendingAudioFile:null,pendingTD3File:null,pendingSunVoxFile:null,dialogOpen:null,showFileBrowser:!1,showChannelNames:!1,togglePanel:t=>e(e=>{const n=e.visiblePanels.indexOf(t);-1!==n?e.visiblePanels.splice(n,1):e.visiblePanels.push(t)}),setActivePanel:t=>e(e=>{e.activePanel=t,e.visiblePanels.includes(t)||e.visiblePanels.push(t)}),setTrackerZoom:t=>e(e=>{e.trackerZoom=Math.max(80,Math.min(200,t))}),openModal:(t,n)=>e(e=>{e.modalOpen=t,e.modalData=n??null}),closeModal:()=>e(e=>{e.modalOpen=null,e.modalData=null}),togglePatterns:()=>e(e=>{e.showPatterns=!e.showPatterns}),toggleAutomationLanes:()=>e(e=>{e.showAutomationLanes=!e.showAutomationLanes}),toggleMacroLanes:()=>e(e=>{e.showMacroLanes=!e.showMacroLanes}),toggleMacroSlots:()=>e(e=>{e.showMacroSlots=!e.showMacroSlots}),toggleSidebar:()=>e(e=>{e.sidebarCollapsed=!e.sidebarCollapsed}),setSidebarCollapsed:t=>e(e=>{e.sidebarCollapsed=t}),setUseHexNumbers:t=>e(e=>{e.useHexNumbers=t}),setRowHighlightInterval:t=>e(e=>{e.rowHighlightInterval=Math.max(1,Math.min(32,t))}),toggleBeatLabels:()=>e(e=>{e.showBeatLabels=!e.showBeatLabels}),toggleChordEntryMode:()=>e(e=>{e.chordEntryMode=!e.chordEntryMode}),setBlankEmptyCells:t=>e(e=>{e.blankEmptyCells=t}),setStatusMessage:(t,n=!1,s=2e3)=>e(e=>{n&&(e.prevStatusMessage=t),e.statusMessage=t;const a=window;a._statusTimeout&&(clearTimeout(a._statusTimeout),a._statusTimeout=null),s>0&&(a._statusTimeout=setTimeout(()=>{const e=LN.getState().prevStatusMessage;LN.getState().setStatusMessage(e||"All Right",!1,0),a._statusTimeout=null},s))}),toggleTB303Collapsed:()=>e(e=>{e.tb303Collapsed=!e.tb303Collapsed}),setTB303Collapsed:t=>e(e=>{e.tb303Collapsed=t}),toggleOscilloscopeVisible:()=>e(e=>{e.oscilloscopeVisible=!e.oscilloscopeVisible}),setOscilloscopeVisible:t=>e(e=>{e.oscilloscopeVisible=t}),toggleCompactToolbar:()=>e(e=>{e.compactToolbar=!e.compactToolbar}),setCompactToolbar:t=>e(e=>{e.compactToolbar=t}),applyAutoCompact:()=>e(e=>{const t="undefined"!=typeof window?window.innerHeight:1080;e.uiVersion<8&&(e.uiVersion=8,e.tb303Collapsed=!0,e.compactToolbar=!1),e.autoCompactApplied||(e.autoCompactApplied=!0,t<800&&(e.oscilloscopeVisible=!1))}),setShowSamplePackModal:t=>e(e=>{e.showSamplePackModal=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setScratchEnabled:t=>e(e=>{e.scratchEnabled=t}),setScratchAcceleration:t=>e(e=>{e.scratchAcceleration=t}),setPlatterMass:t=>e(e=>{e.platterMass=Math.max(0,Math.min(1,t))}),setActiveView:t=>e(e=>{e.activeView=t}),toggleActiveView:()=>e(e=>{e.activeView="tracker"===e.activeView?"arrangement":"tracker"}),setTB303PoppedOut:t=>e(e=>{e.tb303PoppedOut=t}),setInstrumentEditorPoppedOut:t=>e(e=>{e.instrumentEditorPoppedOut=t}),setMasterEffectsPoppedOut:t=>e(e=>{e.masterEffectsPoppedOut=t}),setInstrumentEffectsPoppedOut:t=>e(e=>{e.instrumentEffectsPoppedOut=t}),setPianoRollPoppedOut:t=>e(e=>{e.pianoRollPoppedOut=t}),setOscilloscopePoppedOut:t=>e(e=>{e.oscilloscopePoppedOut=t}),setArrangementPoppedOut:t=>e(e=>{e.arrangementPoppedOut=t}),setVJPoppedOut:t=>e(e=>{e.vjPoppedOut=t}),setPendingModuleFile:t=>e(e=>{e.pendingModuleFile=t}),setPendingAudioFile:t=>e(e=>{e.pendingAudioFile=t}),setPendingTD3File:t=>e(e=>{e.pendingTD3File=t}),setPendingSunVoxFile:t=>e(e=>{e.pendingSunVoxFile=t}),openDialogCommand:t=>e(e=>{e.dialogOpen=t}),closeDialogCommand:()=>e(e=>{e.dialogOpen=null}),setShowFileBrowser:t=>e(e=>{e.showFileBrowser=t}),toggleChannelNames:()=>e(e=>{e.showChannelNames=!e.showChannelNames})})),{name:"devilbox-ui-settings",version:1,migrate:e=>e??{},partialize:e=>({showPatterns:e.showPatterns,showAutomationLanes:e.showAutomationLanes,showMacroLanes:e.showMacroLanes,showMacroSlots:e.showMacroSlots,tb303Collapsed:e.tb303Collapsed,oscilloscopeVisible:e.oscilloscopeVisible,compactToolbar:e.compactToolbar,sidebarCollapsed:e.sidebarCollapsed,trackerZoom:e.trackerZoom,useHexNumbers:e.useHexNumbers,rowHighlightInterval:e.rowHighlightInterval,showBeatLabels:e.showBeatLabels,chordEntryMode:e.chordEntryMode,blankEmptyCells:e.blankEmptyCells,performanceQuality:e.performanceQuality,scratchEnabled:e.scratchEnabled,scratchAcceleration:e.scratchAcceleration,platterMass:e.platterMass,activeView:e.activeView,uiVersion:e.uiVersion})})),AN=Object.freeze(Object.defineProperty({__proto__:null,useUIStore:LN},Symbol.toStringTag,{value:"Module"}));let BN,IN=0,FN=null,UN=null;function RN(){null!==UN&&(window.clearTimeout(UN),UN=null),FN=null,BN=void 0}const jN=i()(ds((e,t)=>({bpm:125,timeSignature:[4,4],swing:100,position:"0:0:0",isPlaying:!1,isPaused:!1,isLooping:!0,currentRow:0,currentPatternIndex:0,continuousRow:0,smoothScrolling:!1,metronomeEnabled:!1,metronomeVolume:75,speed:6,loopStartRow:0,grooveTemplateId:"straight",grooveSteps:2,jitter:0,useMpcScale:!1,currentGlobalRow:0,globalPitch:0,countInEnabled:!1,setBPM:t=>e(e=>{e.bpm=Math.max(20,Math.min(999,t));try{LN.getState().setStatusMessage(`BPM ${e.bpm}`,!1,1500)}catch{}}),setGlobalPitch:t=>e(e=>{e.globalPitch=Math.max(-16,Math.min(16,t))}),setTimeSignature:(t,n)=>e(e=>{e.timeSignature=[t,n]}),setSwing:t=>e(e=>{e.useMpcScale?e.swing=Math.max(50,Math.min(75,t)):e.swing=Math.max(0,Math.min(200,t))}),setJitter:t=>e(e=>{e.jitter=Math.max(0,Math.min(100,t))}),setUseMpcScale:t=>e(e=>{e.useMpcScale!==t&&(e.useMpcScale=t,e.swing=t?50+e.swing/200*25:(e.swing-50)/25*200)}),setPosition:t=>e(e=>{e.position=t}),play:async()=>{EN.getState().autoBakeInstruments(),await VN(),await A(),e(e=>{e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow})},pause:()=>e(e=>{e.isPlaying=!1,e.isPaused=!0}),stop:()=>e(e=>{e.isPlaying=!1,e.isPaused=!1,e.currentRow=0,e.continuousRow=0,e.position="0:0:0"}),togglePlayPause:async()=>{t().isPlaying||(EN.getState().autoBakeInstruments(),await VN(),await A()),e(e=>{e.isPlaying?(e.isPlaying=!1,e.isPaused=!0):(e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow)})},setIsLooping:t=>e(e=>{e.isLooping=t}),setCurrentRow:(t,n)=>e(e=>{const s=e.currentRow;if(e.currentRow=t,t>s)e.continuousRow+=t-s;else if(t===s);else if(t<s){if(n?s-t>=n/2:0===t&&s>2){const a=n||s+1;e.continuousRow+=a-s+t}}}),setCurrentRowThrottled:(e,n,s)=>{const a=performance.now();FN=e,BN=n,s||a-IN>=20?(IN=a,t().setCurrentRow(e,n),FN=null,BN=void 0,null!==UN&&(window.clearTimeout(UN),UN=null)):null===UN&&(UN=window.setTimeout(()=>{null!==FN&&(IN=performance.now(),t().setCurrentRow(FN,BN),FN=null,BN=void 0),UN=null},20-(a-IN)))},setCurrentPattern:t=>e(e=>{e.currentPatternIndex=t}),setSmoothScrolling:t=>e(e=>{e.smoothScrolling=t}),setMetronomeEnabled:t=>e(e=>{e.metronomeEnabled=t}),setMetronomeVolume:t=>e(e=>{e.metronomeVolume=Math.max(0,Math.min(100,t))}),toggleMetronome:()=>e(e=>{e.metronomeEnabled=!e.metronomeEnabled}),toggleCountIn:()=>e(e=>{e.countInEnabled=!e.countInEnabled}),setSpeed:t=>e(e=>{e.speed=Math.max(1,Math.min(31,t))}),setLoopStartRow:t=>e(e=>{e.loopStartRow=Math.max(0,t)}),setGrooveTemplate:t=>e(e=>{Ba.find(e=>e.id===t)&&(e.grooveTemplateId=t)}),setGrooveSteps:t=>e(e=>{e.grooveSteps=Math.max(1,Math.min(64,t))}),getGrooveTemplate:()=>{const e=t();return Ba.find(t=>t.id===e.grooveTemplateId)||Ba[0]},setCurrentGlobalRow:t=>e(e=>{e.currentGlobalRow=t}),seekToGlobalRow:t=>e(e=>{e.currentGlobalRow=Math.max(0,t)}),cancelPendingRowUpdate:()=>{RN()},reset:()=>e(e=>{e.bpm=125,e.timeSignature=[4,4],e.swing=100,e.position="0:0:0",e.isPlaying=!1,e.isPaused=!1,e.isLooping=!0,e.currentRow=0,e.currentPatternIndex=0,e.continuousRow=0,e.speed=6,e.loopStartRow=0,e.grooveTemplateId="straight",e.grooveSteps=2,e.jitter=0,e.useMpcScale=!1,e.currentGlobalRow=0})}))),XN=Object.freeze(Object.defineProperty({__proto__:null,cancelPendingRowUpdate:RN,useTransportStore:jN},Symbol.toStringTag,{value:"Module"})),zN=[_y,Oy,Ty,Ly,Ay,{id:"Arpeggiator",name:"Arpeggiator",category:"modulator",voiceMode:"shared",color:"#10b981",ports:[{id:"gate",name:"Gate Out",direction:"output",signal:"gate"},{id:"cv",name:"CV Out",direction:"output",signal:"cv"},{id:"clock",name:"Clock In",direction:"input",signal:"trigger"}],parameters:[{id:"rate",name:"Rate",min:0,max:1,default:.5},{id:"pattern",name:"Pattern",min:0,max:7,default:0},{id:"octaves",name:"Octaves",min:0,max:1,default:0},{id:"gateLength",name:"Gate Length",min:0,max:1,default:.5,unit:"%"}],create:e=>{const t=e.createConstantSource(),n=e.createConstantSource(),s=e.createGain();t.offset.value=0,n.offset.value=0,t.start(),n.start();let a=[],o=0,r=0,i=1,l=.5,c=.5,u=null;function d(){const e=function(){if(0===a.length)return[];const e=[...a].sort((e,t)=>e-t);let t=[];switch(r){case 0:case 6:t=e;break;case 1:t=[...e].reverse();break;case 2:t=[...e,...[...e].reverse().slice(1,-1)];break;case 3:t=[...[...e].reverse(),...e.slice(1,-1)];break;case 4:t=e.map(()=>e[Math.floor(Math.random()*e.length)]);break;case 5:t=a;break;case 7:t=e;for(let n=1;n<i;n++)t=[...t,...e.map(e=>e+12*n)]}return t}();if(0===e.length)return void(t.offset.value=0);const s=e[o%e.length];n.offset.value=s,t.offset.value=1;const l=jN.getState().bpm??120;setTimeout(()=>{t.offset.value=0},60/l*c*1e3),o++}function m(){u&&p();const e=60/(jN.getState().bpm??120)*1e3,t=[4,2,1,.5,.25,.125],n=Math.floor(l*(t.length-1));u=setInterval(d,e*t[n])}function p(){u&&(clearInterval(u),u=null),t.offset.value=0,o=0}return{descriptorId:"Arpeggiator",ports:new Map([["gate",{id:"gate",name:"Gate Out",direction:"output",signal:"gate",node:t}],["cv",{id:"cv",name:"CV Out",direction:"output",signal:"cv",node:n}],["clock",{id:"clock",name:"Clock In",direction:"input",signal:"trigger",node:s}]]),setParam:(e,t)=>{switch(e){case"rate":l=t,u&&m();break;case"pattern":r=Math.floor(t),o=0;break;case"octaves":i=Math.floor(1+3*t);break;case"gateLength":c=t}},getParam:e=>{switch(e){case"rate":return l;case"pattern":return r;case"octaves":return(i-1)/3;case"gateLength":return c;default:return 0}},gateOn:(e,t)=>{const n=Math.round(127*t);a.includes(n)||a.push(n),!u&&a.length>0&&m()},gateOff:e=>{a=[],p()},dispose:()=>{p(),t.stop(),t.disconnect(),n.stop(),n.disconnect(),s.disconnect()}}}},By,Iy,Fy,Uy,Ry,jy,Xy,zy,{id:"Output",name:"Output",category:"io",voiceMode:"per-voice",color:"#ef4444",ports:[{id:"input",name:"Input",direction:"input",signal:"audio"},{id:"output",name:"Output",direction:"output",signal:"audio"}],parameters:[{id:"level",name:"Level",min:0,max:2,default:1},{id:"pan",name:"Pan",min:-1,max:1,default:0}],create:e=>{const t=e.createGain(),n=e.createStereoPanner();t.gain.value=1,n.pan.value=0,t.connect(n);return{descriptorId:"Output",ports:new Map([["input",{id:"input",name:"Input",direction:"input",signal:"audio",node:t}],["output",{id:"output",name:"Output",direction:"output",signal:"audio",node:n}]]),setParam:(e,s)=>{switch(e){case"level":t.gain.value=s;break;case"pan":n.pan.value=s}},getParam:e=>{switch(e){case"level":return t.gain.value;case"pan":return n.pan.value;default:return 0}},dispose:()=>{t.disconnect(),n.disconnect()}}}},{id:"MIDIIn",name:"MIDI In",category:"io",voiceMode:"shared",color:"#a855f7",ports:[{id:"pitch",name:"Pitch (V/Oct)",direction:"output",signal:"cv"},{id:"gate",name:"Gate",direction:"output",signal:"gate"},{id:"velocity",name:"Velocity",direction:"output",signal:"cv"}],parameters:[],create:e=>{const t=e.createConstantSource(),n=e.createConstantSource(),s=e.createConstantSource();t.offset.value=440,n.offset.value=0,s.offset.value=1,t.start(),n.start(),s.start();return{descriptorId:"MIDIIn",ports:new Map([["pitch",{id:"pitch",name:"Pitch (V/Oct)",direction:"output",signal:"cv",node:t}],["gate",{id:"gate",name:"Gate",direction:"output",signal:"gate",node:n}],["velocity",{id:"velocity",name:"Velocity",direction:"output",signal:"cv",node:s}]]),setParam:()=>{},getParam:()=>0,dispose:()=>{t.stop(),n.stop(),s.stop(),t.disconnect(),n.disconnect(),s.disconnect()}}}}];function GN(){zN.forEach(e=>{My.register(e)})}GN();class HN{name="ModularSynth";output;ctx;voices=[];activeVoices=new Map;config;connectionManager;sharedModules=new Map;constructor(e){this.ctx=oo(),this.output=this.ctx.createGain(),this.config=e,this.connectionManager=new Py,GN(),this.initializeVoices()}initializeVoices(){const e=this.config.polyphony||1;this.voices=[],this.sharedModules.clear(),this.config.modules.forEach(e=>{const t=My.get(e.descriptorId);if(t&&"shared"===t.voiceMode){const n=t.create(this.ctx);Object.entries(e.parameters).forEach(([e,t])=>{n.setParam(e,t)}),this.sharedModules.set(e.id,n)}});for(let t=0;t<e;t++){const e=new Cy(this.ctx,this.config.modules,this.output,this.sharedModules);this.voices.push(e)}this.config.connections.length>0&&this.connectionManager.updateConnections(this.voices,this.config.connections)}triggerAttack(e,t=this.ctx.currentTime,n=1){let s=this.voices.find(e=>!e.isActive);if(!s){const e=Array.from(this.activeVoices.keys())[0];s=this.activeVoices.get(e),s&&this.activeVoices.delete(e)}s&&(s.noteOn(e,t,n),this.activeVoices.set(e,s))}triggerRelease(e,t=this.ctx.currentTime){const n=this.activeVoices.get(e);n&&(n.noteOff(t),this.activeVoices.delete(e))}set(e,t){const[n,s]=e.split(".");if(!n||!s)return;const a=this.config.modules.find(e=>e.id===n);a&&(a.parameters[s]=t),this.voices.forEach(e=>{e.setParameter(n,s,t)})}get(e){const[t,n]=e.split("."),s=this.config.modules.find(e=>e.id===t);return s?.parameters[n]??0}addModule(e){this.config.modules.push(e),this.voices.forEach(t=>{t.addModule(e)})}removeModule(e){this.config.modules=this.config.modules.filter(t=>t.id!==e),this.voices.forEach(t=>{t.removeModule(e)}),this.config.connections=this.config.connections.filter(t=>t.source.moduleId!==e&&t.target.moduleId!==e),this.connectionManager.updateConnections(this.voices,this.config.connections)}addConnection(e){this.config.connections.push(e),this.connectionManager.updateConnections(this.voices,this.config.connections)}removeConnection(e){this.config.connections=this.config.connections.filter(t=>t.id!==e),this.connectionManager.updateConnections(this.voices,this.config.connections)}getConfig(){return{...this.config}}setPolyphony(e){this.voices.forEach(e=>e.dispose()),this.voices=[],this.activeVoices.clear(),this.config.polyphony=e,this.initializeVoices()}releaseAll(){for(const e of this.activeVoices.keys())this.triggerRelease(e)}dispose(){this.releaseAll(),this.voices.forEach(e=>e.dispose()),this.voices=[],this.activeVoices.clear(),this.output.disconnect()}}const WN={modules:[],connections:[],polyphony:1,viewMode:"rack"};class qN{static descriptors=new Map;static lazyLoaders=new Map;static loadingPromises=new Map;static register(e){const t=Array.isArray(e)?e:[e];for(const n of t)this.descriptors.set(n.id,n)}static registerLazy(e,t){for(const n of e)this.lazyLoaders.set(n,t)}static get(e){return this.descriptors.get(e)}static async ensure(e){const t=this.descriptors.get(e);if(t)return t;const n=this.lazyLoaders.get(e);if(!n)return;let s=this.loadingPromises.get(e);if(!s){s=n().then(()=>{for(const[e,t]of this.lazyLoaders.entries())t===n&&(this.lazyLoaders.delete(e),this.loadingPromises.delete(e))});for(const[e,t]of this.lazyLoaders.entries())t===n&&this.loadingPromises.set(e,s)}return await s,this.descriptors.get(e)}static getAll(){return Array.from(this.descriptors.values())}static has(e){return this.descriptors.has(e)}static knows(e){return this.descriptors.has(e)||this.lazyLoaders.has(e)}static getAllIds(){const e=new Set;for(const t of this.descriptors.keys())e.add(t);for(const t of this.lazyLoaders.keys())e.add(t);return Array.from(e)}}class KN{static descriptors=new Map;static lazyLoaders=new Map;static loadingPromises=new Map;static register(e){const t=Array.isArray(e)?e:[e];for(const n of t)this.descriptors.set(n.id,n)}static registerLazy(e,t){for(const n of e)this.lazyLoaders.set(n,t)}static get(e){return this.descriptors.get(e)}static async ensure(e){const t=this.descriptors.get(e);if(t)return t;const n=this.lazyLoaders.get(e);if(!n)return;let s=this.loadingPromises.get(e);if(!s){s=n().then(()=>{for(const[e,t]of this.lazyLoaders.entries())t===n&&(this.lazyLoaders.delete(e),this.loadingPromises.delete(e))});for(const[e,t]of this.lazyLoaders.entries())t===n&&this.loadingPromises.set(e,s)}return await s,this.descriptors.get(e)}static getAll(){return Array.from(this.descriptors.values())}static has(e){return this.descriptors.has(e)}static knows(e){return this.descriptors.has(e)||this.lazyLoaders.has(e)}static getAllIds(){const e=new Set;for(const t of this.descriptors.keys())e.add(t);for(const t of this.lazyLoaders.keys())e.add(t);return Array.from(e)}static getByGroup(e){return this.getAll().filter(t=>t.group===e)}static getByCategory(e){return this.getAll().filter(t=>t.category===e)}}function $N(e){const t=KN.get(e);if(t)return t.getDefaultParameters();switch(e){case"Distortion":return{drive:.4,oversample:"none"};case"Reverb":return{decay:1.5,preDelay:.01};case"Delay":case"FeedbackDelay":case"PingPongDelay":return{time:.25,feedback:.5};case"Chorus":return{frequency:1.5,delayTime:3.5,depth:.7};case"Phaser":return{frequency:.5,octaves:3,baseFrequency:350};case"Tremolo":return{frequency:10,depth:.5};case"Vibrato":return{frequency:5,depth:.1};case"AutoFilter":return{frequency:1,baseFrequency:200,octaves:2.6,filterType:"lowpass"};case"AutoPanner":return{frequency:1,depth:1};case"AutoWah":return{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.1};case"BitCrusher":return{bits:4};case"Chebyshev":return{order:2,oversample:"none"};case"FrequencyShifter":return{frequency:0};case"PitchShift":return{pitch:0,windowSize:.1,delayTime:0,feedback:0};case"Compressor":return{threshold:-24,ratio:12,attack:.003,release:.25};case"EQ3":return{low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500};case"Filter":return{type:"lowpass",frequency:5e3,rolloff:-12,Q:1,gain:0};case"JCReverb":return{roomSize:.5};case"StereoWidener":return{width:.5};case"TapeSaturation":return{drive:50,tone:12e3};case"SidechainCompressor":return{threshold:-24,ratio:4,attack:.003,release:.25,knee:6,sidechainGain:100};case"SpaceEcho":return{mode:4,rate:300,intensity:.5,echoVolume:.8,reverbVolume:.3,bass:0,treble:0};case"SpaceyDelayer":return{firstTap:250,tapSize:150,feedback:40,multiTap:1,tapeFilter:0};case"RETapeEcho":return{mode:3,repeatRate:.5,intensity:.5,echoVolume:.8,wow:0,flutter:0,dirt:0,inputBleed:0,loopAmount:0,playheadFilter:1};case"BiPhase":return{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0};case"DubFilter":return{cutoff:20,resonance:30,gain:1};case"MoogFilter":return{cutoff:1e3,resonance:10,drive:1,model:0,filterMode:0};case"MVerb":return{damping:.5,density:.5,bandwidth:.5,decay:.7,predelay:0,size:.8,gain:1,mix:.4,earlyMix:.5};case"Leslie":return{speed:0,hornRate:6.8,drumRate:5.9,hornDepth:.7,drumDepth:.5,doppler:.5,width:.8,acceleration:.5};case"SpringReverb":return{decay:.6,damping:.4,tension:.5,mix:.35,drip:.5,diffusion:.7};case"VinylNoise":return{hiss:50,dust:58,age:45,speed:5.5,riaa:52,stylusResonance:50,wornStylus:28,pinch:35,innerGroove:25,ghostEcho:20,dropout:10,warp:10,eccentricity:18};case"ToneArm":return{wow:20,coil:50,flutter:15,riaa:50,stylus:30,hiss:20,pops:15,rpm:33.333};default:return{}}}const YN={FurnaceNES:vc.NES,FurnaceGB:vc.GB,FurnaceSNES:vc.SNES,FurnacePCE:vc.PCE,FurnacePSG:vc.SMS,FurnaceVB:vc.VBOY,FurnaceLynx:vc.LYNX,FurnaceSWAN:vc.SWAN,FurnaceVRC6:vc.VRC6,FurnaceN163:vc.N163,FurnaceFDS:vc.FDS,FurnaceMMC5:vc.MMC5,FurnaceGBA:vc.GBA_DMA,FurnaceNDS:vc.NDS,FurnacePOKEMINI:vc.POKEMINI,FurnaceC64:vc.C64_6581,FurnaceSID6581:vc.C64_6581,FurnaceSID8580:vc.C64_8580,FurnaceAY:vc.AY8910,FurnaceAY8930:vc.AY8930,FurnaceVIC:vc.VIC20,FurnaceSAA:vc.SAA1099,FurnaceTED:vc.TED,FurnaceVERA:vc.VERA,FurnaceSCC:vc.SCC,FurnaceTIA:vc.TIA,FurnaceAMIGA:vc.AMIGA,FurnacePET:vc.PET,FurnacePCSPKR:vc.PCSPKR,FurnaceZXBEEPER:vc.SFX_BEEPER,FurnacePOKEY:vc.POKEY,FurnacePONG:vc.PONG,FurnacePV1000:vc.PV1000,FurnaceDAVE:vc.DAVE,FurnaceSU:vc.SOUND_UNIT,FurnacePOWERNOISE:vc.POWERNOISE,FurnaceSEGAPCM:vc.SEGAPCM,FurnaceQSOUND:vc.QSOUND,FurnaceES5506:vc.ES5506,FurnaceRF5C68:vc.RF5C68,FurnaceC140:vc.C140,FurnaceK007232:vc.K007232,FurnaceK053260:vc.K053260,FurnaceGA20:vc.GA20,FurnaceOKI:vc.MSM6295,FurnaceYMZ280B:vc.YMZ280B,FurnaceX1_010:vc.X1_010,FurnaceMSM6258:vc.MSM6258,FurnaceMSM5232:vc.MSM5232,FurnaceMULTIPCM:vc.MULTIPCM,FurnaceNAMCO:vc.NAMCO,FurnacePCMDAC:vc.PCM_DAC,FurnaceBUBBLE:vc.BUBSYS_WSG,FurnaceSM8521:vc.SM8521,FurnaceT6W28:vc.T6W28,FurnaceSUPERVISION:vc.SUPERVISION,FurnaceUPD1771:vc.UPD1771C,FurnaceSCVTONE:vc.UPD1771C};class JN{static VOLUME_NORMALIZATION_OFFSETS={Synth:11,MonoSynth:14,DuoSynth:5,FMSynth:16,AMSynth:22,PluckSynth:32,MetalSynth:23,MembraneSynth:10,NoiseSynth:7,PolySynth:8,TB303:15,JC303:15,Buzz3o3:5,Furnace:0,FurnaceOPN:7,FurnaceOPM:-6,FurnaceOPL:2,FurnaceOPLL:1,FurnaceESFM:5,FurnaceOPZ:-14,FurnaceOPNA:-11,FurnaceOPNB:-10,FurnaceOPL4:-8,FurnaceY8950:-5,FurnaceVRC7:-6,FurnaceOPN2203:-23,FurnaceOPNBB:-21,FurnaceNES:7,FurnaceGB:4,FurnaceSNES:-10,FurnacePCE:5,FurnacePSG:3,FurnaceVB:16,FurnaceLynx:3,FurnaceSWAN:4,FurnaceVRC6:3,FurnaceN163:7,FurnaceFDS:3,FurnaceMMC5:37,FurnaceGBA:-10,FurnaceNDS:3,FurnacePOKEMINI:-10,FurnaceC64:16,FurnaceSID6581:16,FurnaceSID8580:17,FurnaceAY:3,FurnaceAY8930:25,FurnaceVIC:-1,FurnaceSAA:6,FurnaceTED:-4,FurnaceVERA:14,FurnaceSCC:9,FurnaceTIA:-7,FurnaceAMIGA:-4,FurnacePET:-10,FurnacePCSPKR:-10,FurnaceZXBEEPER:-4,FurnacePOKEY:7,FurnacePONG:-10,FurnacePV1000:3,FurnaceDAVE:2,FurnaceSU:8,FurnacePOWERNOISE:-4,FurnaceSEGAPCM:-5,FurnaceQSOUND:4,FurnaceES5506:38,FurnaceRF5C68:0,FurnaceC140:8,FurnaceK007232:-4,FurnaceK053260:-1,FurnaceGA20:3,FurnaceOKI:2,FurnaceYMZ280B:14,FurnaceX1_010:15,FurnaceMSM6258:-10,FurnaceMSM5232:10,FurnaceMULTIPCM:14,FurnaceNAMCO:0,FurnacePCMDAC:-5,FurnaceBUBBLE:3,FurnaceSM8521:9,FurnaceT6W28:3,FurnaceSUPERVISION:-1,FurnaceUPD1771:9,FurnaceSCVTONE:3,BuzzKick:3,BuzzKickXP:5,BuzzNoise:7,BuzzTrilok:5,Buzz4FM2F:7,BuzzFreqBomb:4,Buzz3o3DF:8,Synare:7,DubSiren:13,SpaceLaser:24,V2:0,Sam:16,SuperSaw:9,WobbleBass:13,FormantSynth:9,StringMachine:11,PWMSynth:9,ChipSynth:5,Wavetable:5,Organ:3,Sampler:10,Player:10,GranularSynth:-47,DrumMachine:18,ChiptuneModule:-6,DrumKit:0,MAMEVFX:0,MAMEDOC:0,MAMERSA:0,MAMESWP30:0,CZ101:0,Dexed:41,OBXd:9,CEM3394:14,SCSP:1,MAMEAstrocade:10,MAMESN76477:5,MAMEASC:2,MAMEES5503:48,MAMEMEA8000:8,MAMESNKWave:2,MAMESP0250:7,MAMETMS36XX:-1,MAMEVotrax:12,MAMEYMOPQ:9,MAMEUPD931:18,MAMEUPD933:16,MAMETMS5220:4,MAMEYMF271:8,MAMETR707:22,MAMEVASynth:12,MAMEAICA:0,MAMEICS2115:30,MAMEK054539:19,MAMEC352:17,MAMERF5C400:0,ModularSynth:0,HivelySynth:0,OctaMEDSynth:0,UADESynth:0,SunVoxSynth:0};static getNormalizedVolume(e,t){return(t??-12)+(this.VOLUME_NORMALIZATION_OFFSETS[e]??0)}static createInstrument(e){const t=qN.get(e.synthType);if(t){const n=t.create(e);return e.synthType.startsWith("Furnace")&&t.volumeOffsetDb&&"setVolumeOffset"in n&&n.setVolumeOffset(t.volumeOffsetDb),n}let n;switch(e.synthType){case"Synth":case"ChiptuneModule":n=this.createSynth(e);break;case"MonoSynth":n=this.createMonoSynth(e);break;case"DuoSynth":n=this.createDuoSynth(e);break;case"FMSynth":n=this.createFMSynth(e);break;case"AMSynth":n=this.createAMSynth(e);break;case"PluckSynth":n=this.createPluckSynth(e);break;case"MetalSynth":n=this.createMetalSynth(e);break;case"MembraneSynth":n=this.createMembraneSynth(e);break;case"NoiseSynth":n=this.createNoiseSynth(e);break;case"TB303":n=this.createTB303(e);break;case"Furnace":n=this.createFurnace(e);break;case"Buzzmachine":n=this.createBuzzmachine(e);break;case"FurnaceOPN":n=this.createFurnaceWithChip(e,nc.OPN2);break;case"FurnaceOPM":n=this.createFurnaceWithChip(e,nc.OPM);break;case"FurnaceOPL":n=this.createFurnaceWithChip(e,nc.OPL3);break;case"FurnaceOPLL":case"FurnaceVRC7":n=this.createFurnaceWithChip(e,nc.OPLL);break;case"FurnaceESFM":n=this.createFurnaceWithChip(e,nc.ESFM);break;case"FurnaceOPZ":n=this.createFurnaceWithChip(e,nc.OPZ);break;case"FurnaceOPNA":n=this.createFurnaceWithChip(e,nc.OPNA);break;case"FurnaceOPNB":n=this.createFurnaceWithChip(e,nc.OPNB);break;case"FurnaceOPL4":n=this.createFurnaceWithChip(e,nc.OPL4);break;case"FurnaceY8950":n=this.createFurnaceWithChip(e,nc.Y8950);break;case"FurnaceNES":case"FurnaceGB":case"FurnaceSNES":case"FurnacePCE":case"FurnacePSG":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceGBA":case"FurnaceNDS":case"FurnacePOKEMINI":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceAY8930":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSCC":case"FurnaceTIA":case"FurnaceAMIGA":case"FurnacePET":case"FurnacePCSPKR":case"FurnaceZXBEEPER":case"FurnacePOKEY":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceX1_010":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceNAMCO":case"FurnacePCMDAC":case"FurnaceBUBBLE":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":{const t=YN[e.synthType];if(void 0!==t){n=new Lc(t);const s=e.furnace?.furnaceIndex??0;if(n.setFurnaceInstrumentIndex(s),e.furnace){const t=n.uploadInstrumentFromConfig(e.furnace,e.name).catch(e=>{});n.setInstrumentUploadPromise(t)}}else n=this.createFurnaceWithChip(e,nc.OPN2);break}case"FurnaceOPN2203":n=this.createFurnaceWithChip(e,nc.OPN);break;case"FurnaceOPNBB":n=this.createFurnaceWithChip(e,nc.OPNB_B);break;case"Sampler":{const t=e.metadata?.modPlayback?.usePeriodPlayback;n=t?this.createPlayer(e):this.createSampler(e);break}case"Player":n=this.createPlayer(e);break;case"Wavetable":n=this.createWavetable(e);break;case"GranularSynth":n=this.createGranularSynth(e);break;case"SuperSaw":n=this.createSuperSaw(e);break;case"PolySynth":n=this.createPolySynth(e);break;case"Organ":n=this.createOrgan(e);break;case"DrumMachine":n=this.createDrumMachine(e);break;case"ChipSynth":n=this.createChipSynth(e);break;case"PWMSynth":n=this.createPWMSynth(e);break;case"StringMachine":n=this.createStringMachine(e);break;case"FormantSynth":n=this.createFormantSynth(e);break;case"WobbleBass":n=this.createWobbleBass(e);break;case"DrumKit":n=this.createDrumKit(e);break;case"DubSiren":n=this.createDubSiren(e);break;case"SpaceLaser":n=this.createSpaceLaser(e);break;case"V2":case"V2Speech":n=this.createV2(e);break;case"Sam":n=this.createSam(e);break;case"Synare":n=this.createSynare(e);break;case"WAMOBXd":case"WAMSynth101":case"WAMTinySynth":case"WAMFaustFlute":n=this.createNamedWAM(e);break;case"WAM":n=this.createWAM(e);break;case"Dexed":n=this.createDexed(e);break;case"OBXd":n=this.createOBXd(e);break;case"MAMEVFX":case"VFX":n=this.createVFX(e);break;case"D50":n=this.createD50(e);break;case"MAMEDOC":n=new Vr({type:"doc"});break;case"MAMERSA":n=this.createRdPiano(e);break;case"MAMESWP30":n=this.createMU2000(e);break;case"CZ101":n=this.createCZ101(e);break;case"CEM3394":n=this.createCEM3394(e);break;case"SCSP":n=this.createSCSP(e);break;case"BuzzDTMF":n=this.createBuzzGenerator(Fu.CYANPHASE_DTMF,"BuzzDTMF",e);break;case"BuzzFreqBomb":n=this.createBuzzGenerator(Fu.ELENZIL_FREQUENCYBOMB,"BuzzFreqBomb",e);break;case"BuzzKick":n=this.createBuzzGenerator(Fu.FSM_KICK,"BuzzKick",e);break;case"BuzzKickXP":n=this.createBuzzGenerator(Fu.FSM_KICKXP,"BuzzKickXP",e);break;case"BuzzNoise":n=this.createBuzzGenerator(Fu.JESKOLA_NOISE,"BuzzNoise",e);break;case"BuzzTrilok":n=this.createBuzzGenerator(Fu.JESKOLA_TRILOK,"BuzzTrilok",e);break;case"Buzz4FM2F":n=this.createBuzzGenerator(Fu.MADBRAIN_4FM2F,"Buzz4FM2F",e);break;case"BuzzDynamite6":n=this.createBuzzGenerator(Fu.MADBRAIN_DYNAMITE6,"BuzzDynamite6",e);break;case"BuzzM3":n=this.createBuzzGenerator(Fu.MAKK_M3,"BuzzM3",e);break;case"Buzz3o3":n=this.createBuzz3o3(e);break;case"Buzz3o3DF":n=this.createBuzz3o3DF(e);break;case"BuzzM4":n=this.createBuzzGenerator(Fu.MAKK_M4,"BuzzM4",e);break;case"MAMEAICA":n=this.createMAMEAICA(e);break;case"MAMEASC":n=this.createMAMEASC(e);break;case"MAMEAstrocade":n=this.createMAMEAstrocade(e);break;case"MAMEC352":n=this.createMAMEC352(e);break;case"MAMEES5503":n=this.createMAMEES5503(e);break;case"MAMEICS2115":n=this.createMAMEICS2115(e);break;case"MAMEK054539":n=this.createMAMEK054539(e);break;case"MAMEMEA8000":n=this.createMAMEMEA8000(e);break;case"MAMERF5C400":n=this.createMAMERF5C400(e);break;case"MAMESN76477":n=this.createMAMESN76477(e);break;case"MAMESNKWave":n=this.createMAMESNKWave(e);break;case"MAMESP0250":n=this.createMAMESP0250(e);break;case"MAMETMS36XX":n=this.createMAMETMS36XX(e);break;case"MAMETMS5220":n=this.createMAMETMS5220(e);break;case"MAMETR707":n=this.createMAMETR707(e);break;case"MAMEUPD931":n=this.createMAMEUPD931(e);break;case"MAMEUPD933":n=this.createMAMEUPD933(e);break;case"MAMEVotrax":n=this.createMAMEVotrax(e);break;case"MAMEYMF271":n=this.createMAMEYMF271(e);break;case"MAMEYMOPQ":n=this.createMAMEYMOPQ(e);break;case"MAMEVASynth":n=this.createMAMEVASynth(e);break;case"ModularSynth":n=this.createModularSynth(e);break;case"HivelySynth":n=new Yr;break;case"SoundMonSynth":{const t=new Qr;e.soundMon&&t.setInstrument(e.soundMon).catch(e=>{}),n=t;break}case"SidMonSynth":{const t=new ei;e.sidMon&&t.setInstrument(e.sidMon).catch(e=>{}),n=t;break}case"DigMugSynth":{const t=new ni;e.digMug&&t.setInstrument(e.digMug).catch(e=>{}),n=t;break}case"FCSynth":{const t=new ai;e.fc&&t.setInstrument(e.fc).catch(e=>{}),n=t;break}case"TFMXSynth":{const t=new ri;e.tfmx&&t.setInstrument(e.tfmx).catch(e=>{}),n=t;break}case"SymphonieSynth":{const t=new Ni;e.symphonie&&t.load({symphonie:e.symphonie}).catch(e=>{}),n=t;break}case"SunVoxSynth":{const t=new ki;if(e.sunvox?.patchData){(e.sunvox.isSong?t.setSong(e.sunvox.patchData):t.setModule(e.sunvox.patchData)).catch(e=>{})}n=t;break}case"FredSynth":{const t=new li;e.fred&&t.setInstrument(e.fred).catch(e=>{}),n=t;break}case"HippelCoSoSynth":{const t=new ui;e.hippelCoso&&t.setInstrument(e.hippelCoso).catch(e=>{}),n=t;break}case"RobHubbardSynth":{const t=new mi;e.robHubbard&&t.setInstrument(e.robHubbard).catch(e=>{}),n=t;break}case"SidMon1Synth":{const t=new hi;e.sidmon1&&t.setInstrument(e.sidmon1).catch(e=>{}),n=t;break}case"OctaMEDSynth":{const t=new gi;e.octamed&&t.setInstrument(e.octamed).catch(e=>{}),n=t;break}case"DavidWhittakerSynth":{const t=new vi;e.davidWhittaker&&t.setInstrument(e.davidWhittaker).catch(e=>{}),n=t;break}case"UADESynth":{const t=new Mi;e.uade&&t.setInstrument(e.uade).catch(e=>{}),n=t;break}case"SuperCollider":{const t=e.superCollider??Aa,s=N().rawContext;n=new Fi(t,s);break}default:{const t=Dy.get(e.synthType);n=t?new ky(t,e):this.createSynth(e)}}if(e.synthType.startsWith("Furnace")&&n){const t=this.VOLUME_NORMALIZATION_OFFSETS[e.synthType]??0;0!==t&&"setVolumeOffset"in n&&n.setVolumeOffset(t)}return n}static async createEffectChain(e){const t=e.filter(e=>e.enabled);return Promise.all(t.map(e=>this.createEffect(e)))}static async createEffect(e){const t=e.wet/100,n=e.parameters,s=await KN.ensure(e.type);if(s){const t=await s.create(e);return t._fxType=e.type,t}if("neural"===e.category){if(void 0===e.neuralModelIndex)throw new Error("Neural effect requires neuralModelIndex");const n=new Ki({modelIndex:e.neuralModelIndex,wet:t});return await n.loadModel(),Object.entries(e.parameters).forEach(([e,t])=>{n.setParameter(e,t)}),n}let a;switch(e.type){case"Distortion":a=new v({distortion:n.drive||.4,oversample:n.oversample||"none",wet:t});break;case"Reverb":{const e=new b({decay:n.decay||1.5,preDelay:n.preDelay||.01,wet:t});await e.ready,a=e;break}case"Delay":case"FeedbackDelay":a=new C({delayTime:n.time||.25,feedback:n.feedback||.5,wet:t});break;case"Chorus":{const e=new q({frequency:n.frequency||1.5,delayTime:n.delayTime||3.5,depth:n.depth||.7,wet:t});e.start(),a=e;break}case"Phaser":a=new x({frequency:n.frequency||.5,octaves:n.octaves||3,baseFrequency:n.baseFrequency||350,wet:t});break;case"Tremolo":{const e=new W({frequency:n.frequency||10,depth:n.depth||.5,wet:t});e.start(),a=e;break}case"Vibrato":a=new H({frequency:n.frequency||5,depth:n.depth||.1,wet:t});break;case"AutoFilter":{const e=new G({frequency:n.frequency||1,baseFrequency:n.baseFrequency||200,octaves:n.octaves||2.6,filter:{type:n.filterType||"lowpass",rolloff:-12,Q:1},wet:t});e.start(),a=e;break}case"AutoPanner":{const e=new z({frequency:n.frequency||1,depth:n.depth||1,wet:t});e.start(),a=e;break}case"AutoWah":a=new X({baseFrequency:n.baseFrequency||100,octaves:n.octaves||6,sensitivity:n.sensitivity||0,Q:n.Q||2,gain:n.gain||2,follower:n.follower||.1,wet:t});break;case"BitCrusher":{const e=Number(n.bits)||4,s=new v({distortion:0,wet:t,oversample:"none"}),o=Math.pow(.5,e-1);s._shaper.setMap(e=>o*Math.floor(e/o+.5),4096),s._isBitCrusher=!0,s._bitsValue=e,a=s;break}case"Chebyshev":a=new j({order:n.order||2,oversample:n.oversample||"none",wet:t});break;case"FrequencyShifter":a=new R({frequency:n.frequency||0,wet:t});break;case"PingPongDelay":a=new U({delayTime:n.time||.25,feedback:n.feedback||.5,wet:t});break;case"PitchShift":a=new F({pitch:n.pitch||0,windowSize:n.windowSize||.1,delayTime:n.delayTime||0,feedback:n.feedback||0,wet:t});break;case"Compressor":a=new w({threshold:n.threshold||-24,ratio:n.ratio||12,attack:n.attack||.003,release:n.release||.25});break;case"EQ3":a=new f({low:n.low||0,mid:n.mid||0,high:n.high||0,lowFrequency:n.lowFrequency||400,highFrequency:n.highFrequency||2500});break;case"Filter":a=new h({type:n.type||"lowpass",frequency:n.frequency||5e3,rolloff:n.rolloff||-12,Q:n.Q||1,gain:n.gain||0});break;case"JCReverb":{const e=new I({roomSize:n.roomSize||.5,wet:t}),s=e._feedbackCombFilters;if(s?.length)for(let t=0;t<50&&!s.every(e=>e._worklet);t++)await new Promise(e=>setTimeout(e,20));a=e;break}case"StereoWidener":a=new B({width:n.width||.5});break;case"TapeSaturation":a=new Wr({drive:(n.drive||50)/100,tone:n.tone||12e3,wet:t});break;case"SidechainCompressor":a=new Zl({threshold:n.threshold??-24,ratio:n.ratio??4,attack:n.attack??.003,release:n.release??.25,knee:n.knee??6,sidechainGain:(n.sidechainGain??100)/100,wet:t});break;case"SpaceEcho":a=new Yi({mode:Number(n.mode)||4,rate:Number(n.rate)||300,intensity:Number(n.intensity)||.5,echoVolume:Number(n.echoVolume)||.8,reverbVolume:Number(n.reverbVolume)||.3,bass:Number(n.bass)||0,treble:Number(n.treble)||0,wet:t});break;case"SpaceyDelayer":a=new sl({firstTap:Number(n.firstTap)||250,tapSize:Number(n.tapSize)||150,feedback:Number(n.feedback)||40,multiTap:null!=n.multiTap?Number(n.multiTap):1,tapeFilter:Number(n.tapeFilter)||0,wet:t});break;case"RETapeEcho":a=new ul({mode:null!=n.mode?Number(n.mode):3,repeatRate:Number(n.repeatRate)||.5,intensity:Number(n.intensity)||.5,echoVolume:Number(n.echoVolume)||.8,wow:Number(n.wow)||0,flutter:Number(n.flutter)||0,dirt:Number(n.dirt)||0,inputBleed:null!=n.inputBleed?Number(n.inputBleed):0,loopAmount:Number(n.loopAmount)||0,playheadFilter:null!=n.playheadFilter?Number(n.playheadFilter):1,wet:t});break;case"BiPhase":a=new ml({rateA:Number(n.rateA)||.5,depthA:Number(n.depthA)||.6,rateB:Number(n.rateB)||4,depthB:Number(n.depthB)||.4,feedback:Number(n.feedback)||.3,routing:1===Number(n.routing)?"series":"parallel",wet:t});break;case"DubFilter":a=new hl({cutoff:Number(n.cutoff)||20,resonance:Number(n.resonance)||30,gain:Number(n.gain)||1,wet:t});break;case"BuzzDistortion":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ArguruDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzSVF":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ElakSVF");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzDelay":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaDelay");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzChorus":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMChorus");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzCompressor":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GeonikCompressor");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzOverdrive":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GeonikOverdrive");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzDistortion2":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzCrossDelay":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaCrossDelay");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzPhilta":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMPhilta");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzDist2":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("ElakDist2");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzFreeverb":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("JeskolaFreeverb");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzFreqShift":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("BigyoFrequencyShifter");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzNotch":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("CyanPhaseNotch");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzStereoGain":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("DedaCodeStereoGain");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzSoftSat":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("GraueSoftSat");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzLimiter":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("LdSLimit");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzExciter":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("OomekExciter");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzMasterizer":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("OomekMasterizer");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzStereoDist":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("WhiteNoiseStereoDist");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzWhiteChorus":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("WhiteNoiseWhiteChorus");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzZfilter":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("QZfilter");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzChorus2":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMChorus2");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"BuzzPanzerDelay":{const{BuzzmachineSynth:t}=await os(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-VtTC1x0h.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),n=new t("FSMPanzerDelay");Object.entries(e.parameters).forEach(([e,t])=>{const s=parseInt(e,10);isNaN(s)||n.setParameter(s,t)}),a=n;break}case"MoogFilter":a=new yl({cutoff:Number(n.cutoff)||1e3,resonance:(Number(n.resonance)||10)/100,drive:Number(n.drive)||1,model:Number(n.model)||gl.Hyperion,filterMode:Number(n.filterMode)||bl.LP4,wet:t});break;case"MVerb":a=new kl({damping:Number(n.damping),density:Number(n.density),bandwidth:Number(n.bandwidth),decay:Number(n.decay),predelay:Number(n.predelay),size:Number(n.size),gain:Number(n.gain),mix:Number(n.mix),earlyMix:Number(n.earlyMix),wet:t});break;case"Leslie":a=new _l({speed:Number(n.speed),hornRate:Number(n.hornRate),drumRate:Number(n.drumRate),hornDepth:Number(n.hornDepth),drumDepth:Number(n.drumDepth),doppler:Number(n.doppler),width:Number(n.width),acceleration:Number(n.acceleration),wet:t});break;case"SpringReverb":a=new Bl({decay:Number(n.decay),damping:Number(n.damping),tension:Number(n.tension),mix:Number(n.mix),drip:Number(n.drip),diffusion:Number(n.diffusion),wet:t});break;case"ToneArm":{const e=new Hl({wow:(null!=n.wow?Number(n.wow):20)/100,coil:(null!=n.coil?Number(n.coil):50)/100,flutter:(null!=n.flutter?Number(n.flutter):15)/100,riaa:(null!=n.riaa?Number(n.riaa):50)/100,stylus:(null!=n.stylus?Number(n.stylus):30)/100,hiss:(null!=n.hiss?Number(n.hiss):20)/100,pops:(null!=n.pops?Number(n.pops):15)/100,rpm:null!=n.rpm?Number(n.rpm):33.333,wet:t});return e._fxType="ToneArm",e}case"VinylNoise":{const e=new Xl({hiss:(null!=n.hiss?Number(n.hiss):20)/100,dust:(null!=n.dust?Number(n.dust):30)/100,age:(null!=n.age?Number(n.age):18)/100,speed:(null!=n.speed?Number(n.speed):5.5)/100,riaa:(null!=n.riaa?Number(n.riaa):30)/100,stylusResonance:(null!=n.stylusResonance?Number(n.stylusResonance):25)/100,wornStylus:(null!=n.wornStylus?Number(n.wornStylus):0)/100,pinch:(null!=n.pinch?Number(n.pinch):15)/100,innerGroove:(null!=n.innerGroove?Number(n.innerGroove):0)/100,ghostEcho:(null!=n.ghostEcho?Number(n.ghostEcho):0)/100,dropout:(null!=n.dropout?Number(n.dropout):0)/100,warp:(null!=n.warp?Number(n.warp):0)/100,eccentricity:(null!=n.eccentricity?Number(n.eccentricity):0)/100,wet:t});return e._fxType="VinylNoise",e}case"WAMBigMuff":case"WAMTS9":case"WAMDistoMachine":case"WAMQuadraFuzz":case"WAMVoxAmp":case"WAMStonePhaser":case"WAMPingPongDelay":case"WAMFaustDelay":case"WAMPitchShifter":case"WAMGraphicEQ":case"WAMPedalboard":{const n=yy[e.type];if(!n){a=new m(1);break}const s=new fy({moduleUrl:n,wet:t});await s.ensureInitialized(),a=s;break}default:a=new m(1)}if(a._fxType=e.type,Jl(e.parameters)){const t=$l[e.type];if(t){const n=k().bpm.value,s=Ql(e.parameters);for(const o of t){const t=Yl(n,s,o.unit);switch(e.type){case"Delay":case"FeedbackDelay":"time"===o.param&&a instanceof C&&(a.delayTime.value=t);break;case"PingPongDelay":"time"===o.param&&a instanceof U&&(a.delayTime.value=t);break;case"SpaceEcho":"rate"===o.param&&a instanceof Yi&&a.setRate(t);break;case"SpaceyDelayer":"firstTap"===o.param&&a instanceof sl&&a.setFirstTap(t);break;case"RETapeEcho":"repeatRate"===o.param&&a instanceof ul&&a.setRepeatRate(t);break;case"Chorus":"frequency"===o.param&&a instanceof q&&(a.frequency.value=t);break;case"BiPhase":"rateA"===o.param&&a instanceof ml&&(a.rateA=t)}}}}return a}static connectWithEffects(e,t,n){if(0!==t.length){e.connect(t[0]);for(let e=0;e<t.length-1;e++)t[e].connect(t[e+1]);t[t.length-1].connect(n)}else e.connect(n)}static disposeInstrument(e,t){t.forEach(e=>e.dispose()),e.dispose()}static createSynth(e){const t=new K($,{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("Synth",e.volume)});e.oscillator?.detune&&t.set({detune:e.oscillator.detune});const n=e.pitchEnvelope;return n?.enabled&&0!==n.amount?{triggerAttackRelease:(e,s,a,o)=>{const r=a??Y();try{t.triggerRelease(e,r)}catch{}this.applyPitchEnvelope(t,n,r,s),t.triggerAttackRelease(e,s,r,o)},triggerAttack:(e,s,a)=>{const o=s??Y();try{t.triggerRelease(e,o)}catch{}this.triggerPitchEnvelopeAttack(t,n,o),t.triggerAttack(e,o,a)},triggerRelease:(e,s)=>{const a=s??Y();this.triggerPitchEnvelopeRelease(t,n,a),t.triggerRelease(e,a)},releaseAll:()=>{t.set({detune:0}),t.releaseAll()},connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}:{triggerAttackRelease:(e,n,s,a)=>{try{t.triggerRelease(e,s)}catch{}t.triggerAttackRelease(e,n,s,a)},triggerAttack:(e,n,s)=>{try{t.triggerRelease(e,n)}catch{}t.triggerAttack(e,n,s)},triggerRelease:(e,n)=>{t.triggerRelease(e,n)},releaseAll:()=>t.releaseAll(),connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}}static createMonoSynth(e){const t={oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("MonoSynth",e.volume)};return e.filter&&e.filter.type&&e.filter.frequency&&(t.filter={type:e.filter.type,frequency:e.filter.frequency,Q:e.filter.Q??1,rolloff:e.filter.rolloff??-12}),e.filterEnvelope&&void 0!==e.filterEnvelope.baseFrequency&&void 0!==e.filterEnvelope.attack&&(t.filterEnvelope={baseFrequency:e.filterEnvelope.baseFrequency,octaves:e.filterEnvelope.octaves??3,attack:e.filterEnvelope.attack/1e3,decay:(e.filterEnvelope.decay??200)/1e3,sustain:(e.filterEnvelope.sustain??50)/100,release:(e.filterEnvelope.release??1e3)/1e3}),new J(t)}static createDuoSynth(e){const t=e.oscillator?.type||"sawtooth",n=new Q({voice0:{oscillator:{type:t},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:t},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},vibratoAmount:e.oscillator?.detune?e.oscillator.detune/100:.5,vibratoRate:5,volume:this.getNormalizedVolume("DuoSynth",e.volume)});return{triggerAttackRelease:(e,t,s,a)=>{try{n.triggerRelease(s)}catch{}n.triggerAttackRelease(e,t,s,a)},triggerAttack:(e,t,s)=>{try{n.triggerRelease(t)}catch{}n.triggerAttack(e,t,s)},triggerRelease:e=>n.triggerRelease(e),releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>n.dispose(),volume:n.volume}}static createFMSynth(e){const t=new K(_,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},modulationIndex:10,volume:this.getNormalizedVolume("FMSynth",e.volume)});return{triggerAttackRelease:(e,n,s,a)=>{try{t.triggerRelease(e,s)}catch{}t.triggerAttackRelease(e,n,s,a)},triggerAttack:(e,n,s)=>{try{t.triggerRelease(e,n)}catch{}t.triggerAttack(e,n,s)},triggerRelease:(e,n)=>t.triggerRelease(e,n),releaseAll:()=>t.releaseAll(),connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}}static createAMSynth(e){const t=new K(Z,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("AMSynth",e.volume)});return{triggerAttackRelease:(e,n,s,a)=>{try{t.triggerRelease(e,s)}catch{}t.triggerAttackRelease(e,n,s,a)},triggerAttack:(e,n,s)=>{try{t.triggerRelease(e,n)}catch{}t.triggerAttack(e,n,s)},triggerRelease:(e,n)=>t.triggerRelease(e,n),releaseAll:()=>t.releaseAll(),connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}}static createPluckSynth(e){const t=new K(ee);return t.set({attackNoise:1,dampening:4e3,resonance:.7}),t.volume.value=this.getNormalizedVolume("PluckSynth",e.volume),{triggerAttackRelease:(e,n,s,a)=>{try{t.triggerRelease(e,s)}catch{}t.triggerAttackRelease(e,n,s,a)},triggerAttack:(e,n,s)=>{try{t.triggerRelease(e,n)}catch{}t.triggerAttack(e,n,s)},triggerRelease:(e,n)=>t.triggerRelease(e,n),releaseAll:()=>t.releaseAll(),connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}}static createMetalSynth(e){return new te({envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??100)/1e3,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MetalSynth",e.volume)})}static createMembraneSynth(e){return new ne({pitchDecay:.05,octaves:10,oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??400)/1e3,sustain:.01,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MembraneSynth",e.volume)})}static createNoiseSynth(e){return new se({noise:{type:"white"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("NoiseSynth",e.volume)})}static createTB303(e){const t=e.tb303||{...La},n=this.getNormalizedVolume("TB303",e.volume);return this.createDB303(t,n)}static createWAM(e){const t=e.wam||{moduleUrl:"",pluginState:null},n=new hy(t);return n.output.gain.value=ae(e.volume??-12),n}static createNamedWAM(e){const t=xy[e.synthType];if(!t)return this.createWAM(e);const n={...e.wam,moduleUrl:t,pluginState:e.wam?.pluginState??null},s=new hy(n);return s.output.gain.value=ae(e.volume??-12),s}static createDB303(e,t){const n=new Er;return n.applyConfig(e),void 0!==t&&(n.output.gain.value=ae(t)),n}static createBuzzGenerator(e,t,n){const s=new ju(e),a=this.getNormalizedVolume(t,n.volume);return s.output.gain.value=ae(a),s}static createBuzz3o3(e){const t=new ju(Fu.OOMEK_AGGRESSOR_DF);if(e.tb303){const n=e.tb303;if(t.setCutoff(n.filter.cutoff),t.setResonance(n.filter.resonance),t.setEnvMod(n.filterEnvelope.envMod),t.setDecay(n.filterEnvelope.decay),t.setAccentAmount(n.accent.amount),t.setWaveform(n.oscillator.type),void 0!==n.tuning&&t.setTuning(n.tuning),n.overdrive&&t.setOverdrive(n.overdrive.amount),n.devilFish){const e=n.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:n.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.filterFmDepth&&t.setFilterFM(e.filterFmDepth)}const s=this.getNormalizedVolume("Buzz3o3",e.volume);t.setVolume(s)}return t}static createWavetable(e){const t=e.wavetable||Xs,n=new Hi(t);return n.output.gain.value=ae(this.getNormalizedVolume("Wavetable",e.volume)),n}static createSampler(e){if(e.sample?.multiMap&&Object.keys(e.sample.multiMap).length>0)return new oe({urls:e.sample.multiMap,volume:this.getNormalizedVolume("Sampler",e.volume)});const t=e.parameters,n=t?.sampleUrl||e.sample?.url,s=e.sample?.baseNote||"C4";if(!n&&e.metadata,n){const t={};return t[s]=n,new oe({urls:t,volume:this.getNormalizedVolume("Sampler",e.volume)})}return new oe({volume:this.getNormalizedVolume("Sampler",e.volume)})}static createPlayer(e){const t=e.parameters,n=t?.sampleUrl,s=t?.reverseMode||"forward";if(n){return new re({url:n,volume:this.getNormalizedVolume("Player",e.volume),reverse:"reverse"===s})}return new re({volume:this.getNormalizedVolume("Player",e.volume)})}static createGranularSynth(e){const t=e.granular?.sampleUrl||e.parameters?.sampleUrl,n=e.granular;if(t){return new ie({url:t,grainSize:(n?.grainSize||100)/1e3,overlap:(n?.grainOverlap||50)/100,playbackRate:n?.playbackRate||1,detune:n?.detune||0,reverse:n?.reverse||!1,loop:!0,loopStart:0,loopEnd:0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}return new ie({grainSize:.1,overlap:.5,playbackRate:1,loop:!0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}static createSuperSaw(e){const t=e.superSaw||ra,n=t.detune,s=new K($,{oscillator:{type:"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??80)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("SuperSaw",e.volume)}),a=new h({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),o=new q({frequency:4,delayTime:2.5,depth:Math.min(1,n/50),wet:.8});o.start(),s.connect(a),a.connect(o);const r=e.pitchEnvelope,i=r?.enabled&&0!==r.amount;return{triggerAttackRelease:(e,t,n,a)=>{const o=n??Y();try{s.triggerRelease(e,o)}catch{}i&&this.applyPitchEnvelope(s,r,o,t),s.triggerAttackRelease(e,t,o,a)},triggerAttack:(e,t,n)=>{const a=t??Y();try{s.triggerRelease(e,a)}catch{}i&&this.triggerPitchEnvelopeAttack(s,r,a),s.triggerAttack(e,a,n)},triggerRelease:(e,t)=>{const n=t??Y();i&&this.triggerPitchEnvelopeRelease(s,r,n),s.triggerRelease(e,n)},releaseAll:()=>{s.set({detune:0}),s.releaseAll()},connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{s.dispose(),a.dispose(),o.dispose()},applyConfig:e=>{const t=e||ra,n=t.envelope,r=t.filter;s.set({envelope:{attack:(n.attack||10)/1e3,decay:(n.decay||100)/1e3,sustain:(n.sustain||80)/100,release:(n.release||300)/1e3}}),a.set({type:r.type,frequency:r.cutoff,Q:r.resonance/10}),o.set({depth:Math.min(1,t.detune/50)})},volume:s.volume}}static createPolySynth(e){const t=e.polySynth||ia;let n=$;"FMSynth"===t.voiceType?n=_:"AMSynth"===t.voiceType&&(n=Z);const s=new K(n,{oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||50)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||500)/1e3},volume:this.getNormalizedVolume("PolySynth",e.volume)});s.maxPolyphony=t.voiceCount;const a=e.pitchEnvelope;return a?.enabled&&0!==a.amount?{triggerAttackRelease:(e,t,n,o)=>{const r=n??Y();try{s.triggerRelease(e,r)}catch{}this.applyPitchEnvelope(s,a,r,t),s.triggerAttackRelease(e,t,r,o)},triggerAttack:(e,t,n)=>{const o=t??Y();try{s.triggerRelease(e,o)}catch{}this.triggerPitchEnvelopeAttack(s,a,o),s.triggerAttack(e,o,n)},triggerRelease:(e,t)=>{const n=t??Y();this.triggerPitchEnvelopeRelease(s,a,n),s.triggerRelease(e,n)},releaseAll:()=>{s.set({detune:0}),s.releaseAll()},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>s.dispose(),volume:s.volume}:{triggerAttackRelease:(e,t,n,a)=>{try{s.triggerRelease(e,n)}catch{}s.triggerAttackRelease(e,t,n,a)},triggerAttack:(e,t,n)=>{try{s.triggerRelease(e,t)}catch{}s.triggerAttack(e,t,n)},triggerRelease:(e,t)=>s.triggerRelease(e,t),releaseAll:()=>s.releaseAll(),connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>s.dispose(),volume:s.volume}}static createOrgan(e){const t=e.organ||la,n=t.drawbars||la.drawbars,s=new m(1),a=new K($,{oscillator:{type:"custom",partials:[n[0]/8,n[1]/8,n[2]/8,n[3]/8,n[4]/8,n[5]/8,n[6]/8,n[7]/8,n[8]/8]},envelope:{attack:.005,decay:.1,sustain:1,release:.1},volume:this.getNormalizedVolume("Organ",e.volume)});a.maxPolyphony=32;let o=null;return t.rotary?.enabled?(o=new W({frequency:"fast"===t.rotary.speed?6:1,depth:.3,wet:.5}),o.start(),a.connect(o),o.connect(s)):a.connect(s),{triggerAttackRelease:(e,t,n,s)=>{try{a.triggerRelease(e,n)}catch{}a.triggerAttackRelease(e,t,n,s)},triggerAttack:(e,t,n)=>{try{a.triggerRelease(e,t)}catch{}a.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(e,t)},releaseAll:()=>a.releaseAll(),connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{a.dispose(),o?.dispose(),s.dispose()},applyConfig:e=>{const t=e||la,n=t.drawbars;a.set({oscillator:{partials:[(n[0]||0)/8,(n[1]||0)/8,(n[2]||0)/8,(n[3]||0)/8,(n[4]||0)/8,(n[5]||0)/8,(n[6]||0)/8,(n[7]||0)/8,(n[8]||0)/8]}}),o&&o.frequency.rampTo("fast"===t.rotary?.speed?6:1,.1)},volume:a.volume}}static createDrumMachine(e){const t=e.drumMachine||ca,n="808"===t.machineType;switch(t.drumType){case"kick":{const s={...n?{pitch:48,pitchDecay:50,tone:40,toneDecay:30,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},...t.kick},a=new ne({pitchDecay:s.envDuration/1e3,octaves:2*Math.log2(s.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:s.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)});let o=a,r=null,i=null;s.drive>0&&(r=new v({distortion:s.drive/100*.5,oversample:"2x",wet:1})),i=new h({type:"lowpass",frequency:s.filterFreq,Q:1,rolloff:-24}),r?(a.connect(r),r.connect(i)):a.connect(i),o=i;const l=le(s.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(l,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(l,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{a.dispose(),r?.dispose(),i?.dispose()},applyConfig:e=>{const t=(e||ca).kick;t&&(a.set({pitchDecay:t.envDuration/1e3,octaves:2*Math.log2(t.envAmount),envelope:{decay:t.decay/1e3}}),r&&(r.distortion=t.drive/100*.5),i&&i.frequency.rampTo(t.filterFreq,.1))},volume:a.volume}}case"snare":{const s={...n?{pitch:238,tone:35,toneDecay:200,snappy:55,decay:150,envAmount:2.5,envDuration:25,filterType:"lowpass",filterFreq:2500}:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},...t.snare},a=new ne({pitchDecay:s.envDuration/1e3,octaves:2*Math.log2(s.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:s.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),o=new se({noise:{type:"white"},envelope:{attack:.001,decay:s.toneDecay/1e3,sustain:0,release:.05},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(s.snappy/15-3)}),r=new h({type:s.filterType,frequency:s.filterFreq,Q:2}),i=new m(1);a.connect(i),o.connect(r),r.connect(i);const l=le(s.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(l,t,n,s),o.triggerAttackRelease(t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(l,t,n),o.triggerAttack(t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t),o.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}try{o.triggerRelease()}catch{}},connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{a.dispose(),o.dispose(),r.dispose(),i.dispose()},applyConfig:t=>{const n=(t||ca).snare;n&&(a.set({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),envelope:{decay:n.decay/1e3}}),o.set({envelope:{decay:n.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(n.snappy/15-3)}),r.set({type:n.filterType,frequency:n.filterFreq}))},volume:a.volume}}case"hihat":{const s={...n?{tone:40,decay:80,metallic:70}:{tone:50,decay:100,metallic:50},...t.hihat},a=new te({envelope:{attack:.001,decay:s.decay/1e3,release:n?.02:.01},harmonicity:5.1,modulationIndex:32+s.metallic/3,resonance:4e3+40*s.tone,octaves:1.5,volume:e.volume||-12});return a.frequency.value=n?180+1.5*s.tone:200+2*s.tone,a}case"clap":{const s={...n?{tone:45,decay:120,toneDecay:350,spread:15,filterFreqs:[700,1e3],modulatorFreq:30}:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},...t.clap},a=new m(1),o=new se({noise:{type:"white"},envelope:{attack:.001,decay:s.decay/1e3,sustain:0,release:.05},volume:e.volume??-10}),r=new h({type:"highpass",frequency:s.filterFreqs[0],Q:1.2}),i=new h({type:"bandpass",frequency:s.filterFreqs[1],Q:.7}),l=new h({type:"bandpass",frequency:1e3+24*s.tone,Q:2});o.connect(l),l.connect(r),r.connect(i),i.connect(a);const c=[],u=4;for(let t=0;t<u;t++){const n=new se({noise:{type:"white"},envelope:{attack:.001,decay:s.toneDecay/1e3/(t+1),sustain:0,release:.02},volume:(e.volume??-10)-3*t});n.connect(l),c.push(n)}return{triggerAttackRelease:(e,t,n,a)=>{const r=n??Y(),i=s.spread/1e3;c.forEach((e,n)=>{const s=r+n*i,o=(a??1)*(1-.15*n);e.triggerAttackRelease(t/(n+1),s,o)}),o.triggerAttackRelease(t,r+u*i,a)},triggerAttack:(e,t,n)=>{const a=t??Y(),r=s.spread/1e3;c.forEach((e,t)=>{e.triggerAttack(a+t*r,(n??1)*(1-.15*t))}),o.triggerAttack(a+u*r,n)},triggerRelease:(e,t)=>{o.triggerRelease(t),c.forEach(e=>e.triggerRelease(t))},releaseAll:()=>{try{o.triggerRelease()}catch{}c.forEach(e=>{try{e.triggerRelease()}catch{}})},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{o.dispose(),c.forEach(e=>e.dispose()),r.dispose(),i.dispose(),l.dispose(),a.dispose()},applyConfig:e=>{const t=(e||ca).clap;t&&(o.set({envelope:{decay:t.decay/1e3}}),r.frequency.rampTo(t.filterFreqs[0],.1),i.frequency.rampTo(t.filterFreqs[1],.1),l.frequency.rampTo(1e3+24*t.tone,.1),c.forEach((e,n)=>{e.set({envelope:{decay:t.toneDecay/1e3/(n+1)}})}))},volume:o.volume}}case"tom":{const s={...n?{pitch:160,decay:300,tone:2,toneDecay:50,envAmount:1.5,envDuration:150}:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},...t.tom},a=new ne({pitchDecay:s.envDuration/1e3,octaves:2*Math.log2(s.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:s.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),o=new se({noise:{type:"white"},envelope:{attack:.001,decay:s.toneDecay/1e3,sustain:0,release:.02},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+s.tone/5}),r=new m(1);a.connect(r),o.connect(r);const i=le(s.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(i,t,n,s),o.triggerAttackRelease(.3*t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(i,t,n),o.triggerAttack(t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t),o.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}try{o.triggerRelease()}catch{}},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{a.dispose(),o.dispose(),r.dispose()},applyConfig:t=>{const n=(t||ca).tom;n&&(a.set({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),envelope:{decay:n.decay/1e3}}),o.set({envelope:{decay:n.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+n.tone/5}))},volume:a.volume}}case"rimshot":{const s={...n?{decay:45,filterFreqs:[280,450,850],filterQ:8,saturation:2}:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},...t.rimshot},a=new se({noise:{type:"white"},envelope:{attack:.001,decay:s.decay/1e3,sustain:0,release:.01},volume:e.volume??-10}),o=new h({type:"bandpass",frequency:s.filterFreqs[0],Q:s.filterQ}),r=new h({type:"bandpass",frequency:s.filterFreqs[1],Q:s.filterQ}),i=new h({type:"bandpass",frequency:s.filterFreqs[2],Q:s.filterQ}),l=new m(1);a.connect(o),a.connect(r),a.connect(i),o.connect(l),r.connect(l),i.connect(l);const c=new v({distortion:s.saturation/5*.8,oversample:"2x",wet:1}),u=new h({type:"highpass",frequency:100,Q:.5});return l.connect(c),c.connect(u),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>u.connect(e),disconnect:()=>u.disconnect(),dispose:()=>{a.dispose(),o.dispose(),r.dispose(),i.dispose(),l.dispose(),c.dispose(),u.dispose()},applyConfig:e=>{const t=(e||ca).rimshot;t&&(a.set({envelope:{decay:t.decay/1e3}}),o.frequency.rampTo(t.filterFreqs[0],.1),r.frequency.rampTo(t.filterFreqs[1],.1),i.frequency.rampTo(t.filterFreqs[2],.1),o.Q.value=t.filterQ,r.Q.value=t.filterQ,i.Q.value=t.filterQ,c.distortion=t.saturation/5*.8)},volume:a.volume}}case"conga":{const n={pitch:310,decay:180,...t.conga},s=new $({oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:e.volume??-8}),a=new h({type:"lowpass",frequency:1e4,Q:1});s.connect(a);const o=le(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(o,t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(o,t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{s.dispose(),a.dispose()},applyConfig:e=>{const t=(e||ca).conga;t&&s.set({envelope:{decay:t.decay/1e3}})},volume:s.volume}}case"cowbell":{const e={decay:400,filterFreq:2640,...t.cowbell},n=new V({type:"square",frequency:540,volume:-6}),s=new V({type:"square",frequency:800,volume:-6}),a=new m(0),o=new m(0),r=new h({type:"bandpass",frequency:e.filterFreq,Q:1}),i=new m(.3);n.connect(i),s.connect(i),i.connect(a),i.connect(o);const l=new m(1);return a.connect(r),o.connect(r),r.connect(l),n.start(),s.start(),{triggerAttackRelease:(t,n,s,r)=>{const i=s??Y(),l=r??1;a.gain.cancelScheduledValues(i),a.gain.setValueAtTime(0,i),a.gain.linearRampToValueAtTime(.375*l,i+.002),a.gain.linearRampToValueAtTime(0,i+.017),o.gain.cancelScheduledValues(i),o.gain.setValueAtTime(.001,i+.015),o.gain.exponentialRampToValueAtTime(.125*l,i+.017),o.gain.exponentialRampToValueAtTime(.001,i+.017+e.decay/1e3)},triggerAttack:(t,n,s)=>{const r=n??Y(),i=s??1;a.gain.cancelScheduledValues(r),a.gain.setValueAtTime(0,r),a.gain.linearRampToValueAtTime(.375*i,r+.002),a.gain.linearRampToValueAtTime(0,r+.017),o.gain.cancelScheduledValues(r),o.gain.setValueAtTime(.001,r+.015),o.gain.exponentialRampToValueAtTime(.125*i,r+.017),o.gain.exponentialRampToValueAtTime(.001,r+.017+e.decay/1e3)},triggerRelease:()=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{n.stop(),s.stop(),n.dispose(),s.dispose(),a.dispose(),o.dispose(),i.dispose(),r.dispose(),l.dispose()},applyConfig:e=>{const t=(e||ca).cowbell;t&&r.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"clave":{const e={decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450,...t.clave},n=new V({type:"triangle",frequency:e.pitch,volume:-6}),s=new V({type:"sine",frequency:e.pitchSecondary,volume:-8}),a=new m(0),o=new m(0),r=new h({type:"bandpass",frequency:e.filterFreq,Q:5}),i=new v({distortion:.5,oversample:"2x",wet:1}),l=new m(1);return n.connect(a),s.connect(o),a.connect(r),o.connect(r),r.connect(i),i.connect(l),n.start(),s.start(),{triggerAttackRelease:(t,n,s,r)=>{const i=s??Y(),l=r??1;a.gain.cancelScheduledValues(i),a.gain.setValueAtTime(.7*l,i),a.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3),o.gain.cancelScheduledValues(i),o.gain.setValueAtTime(.5*l,i),o.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3)},triggerAttack:(t,n,s)=>{const r=n??Y(),i=s??1;a.gain.cancelScheduledValues(r),a.gain.setValueAtTime(.7*i,r),a.gain.exponentialRampToValueAtTime(.001,r+e.decay/1e3),o.gain.cancelScheduledValues(r),o.gain.setValueAtTime(.5*i,r),o.gain.exponentialRampToValueAtTime(.001,r+e.decay/1e3)},triggerRelease:()=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{n.stop(),s.stop(),n.dispose(),s.dispose(),a.dispose(),o.dispose(),r.dispose(),i.dispose(),l.dispose()},applyConfig:e=>{const t=(e||ca).clave;t&&r.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"maracas":{const n={decay:30,filterFreq:5e3,...t.maracas},s=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.01},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),a=new h({type:"highpass",frequency:n.filterFreq,Q:1});return s.connect(a),{triggerAttackRelease:(e,t,n,a)=>{s.triggerAttackRelease(t,n,a)},triggerAttack:(e,t,n)=>{s.triggerAttack(t,n)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{s.dispose(),a.dispose()},applyConfig:e=>{const t=(e||ca).maracas;t&&(s.set({envelope:{decay:t.decay/1e3}}),a.frequency.rampTo(t.filterFreq,.1))},volume:s.volume}}case"cymbal":{const e={tone:50,decay:2e3,...t.cymbal},n=[263,400,421,474,587,845],s=[],a=new m(.3);for(const t of n){const e=new V({type:"square",frequency:t,volume:-10});e.connect(a),e.start(),s.push(e)}const o=new h({type:"bandpass",frequency:5e3,Q:1}),r=new m(0),i=new h({type:"bandpass",frequency:1e4,Q:1}),l=new m(0),c=new h({type:"highpass",frequency:8e3,Q:1}),u=new m(0);a.connect(o),a.connect(i),a.connect(c),o.connect(r),i.connect(l),c.connect(u);const d=new m(1);r.connect(d),l.connect(d),u.connect(d);const p=.666-e.tone/100*.666,f=.333,g=.666-.666*(1-e.tone/100);return{triggerAttackRelease:(t,n,s,a)=>{const o=s??Y(),i=a??1;r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.001,o),r.gain.exponentialRampToValueAtTime(p*i,o+.01),r.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3),l.gain.cancelScheduledValues(o),l.gain.setValueAtTime(.001,o),l.gain.exponentialRampToValueAtTime(f*i,o+.01),l.gain.exponentialRampToValueAtTime(.001,o+.4),u.gain.cancelScheduledValues(o),u.gain.setValueAtTime(.001,o),u.gain.exponentialRampToValueAtTime(g*i,o+.01),u.gain.exponentialRampToValueAtTime(.001,o+.15)},triggerAttack:(t,n,s)=>{const a=n??Y(),o=s??1;r.gain.cancelScheduledValues(a),r.gain.setValueAtTime(.001,a),r.gain.exponentialRampToValueAtTime(p*o,a+.01),r.gain.exponentialRampToValueAtTime(.001,a+e.decay/1e3),l.gain.cancelScheduledValues(a),l.gain.setValueAtTime(.001,a),l.gain.exponentialRampToValueAtTime(f*o,a+.01),l.gain.exponentialRampToValueAtTime(.001,a+.4),u.gain.cancelScheduledValues(a),u.gain.setValueAtTime(.001,a),u.gain.exponentialRampToValueAtTime(g*o,a+.01),u.gain.exponentialRampToValueAtTime(.001,a+.15)},triggerRelease:()=>{},releaseAll:()=>{},connect:e=>d.connect(e),disconnect:()=>d.disconnect(),dispose:()=>{s.forEach(e=>{e.stop(),e.dispose()}),a.dispose(),o.dispose(),i.dispose(),c.dispose(),r.dispose(),l.dispose(),u.dispose(),d.dispose()},applyConfig:()=>{},volume:d.gain}}default:return new ne({pitchDecay:.05,octaves:3,envelope:{attack:.001,decay:.3,sustain:0,release:.1},volume:e.volume||-12})}}static createChipSynth(e){const t=e.chipSynth||ua,n=t.arpeggio;let s="square";if("triangle"===t.channel&&(s="triangle"),"noise"===t.channel){const n=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack||5)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??0)/100,release:(t.envelope?.release||50)/1e3},volume:e.volume||-12}),s=new ce(t.bitDepth);return s.wet.value=1,n.connect(s),{triggerAttackRelease:(e,t,s,a)=>{n.triggerAttackRelease(t,s,a)},triggerAttack:(e,t,s)=>{n.triggerAttack(t,s)},triggerRelease:(e,t)=>{n.triggerRelease(t)},releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),s.dispose()},applyConfig:e=>{const t=e||ua,a=t.envelope;n.set({envelope:{attack:a.attack/1e3,decay:a.decay/1e3,sustain:a.sustain/100,release:a.release/1e3}}),s.bits=t.bitDepth},volume:n.volume}}const a=new K($,{oscillator:{type:s},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:this.getNormalizedVolume("ChipSynth",e.volume)}),o=new ce(t.bitDepth);o.wet.value=1,a.connect(o);let r=null,i=null;n?.enabled&&(r=new tc({config:n,onNoteOn:(e,t,n)=>{i&&a.triggerRelease(i),a.triggerAttackRelease(e,n,void 0,t),i=e},onNoteOff:e=>{a.triggerRelease(e),i===e&&(i=null)}}));return{triggerAttackRelease:(e,t,s,o)=>{if(r&&n?.enabled){if(r.start(e,o??1),t&&"number"==typeof t){const n=(s??Y())+t;k().scheduleOnce(()=>{r.stop(e)},n)}}else{try{a.triggerRelease(e,s)}catch{}a.triggerAttackRelease(e,t,s,o)}},triggerAttack:(e,t,s)=>{if(r&&n?.enabled)r.start(e,s??1);else{try{a.triggerRelease(e,t)}catch{}a.triggerAttack(e,t,s)}},triggerRelease:(e,t)=>{r&&n?.enabled?r.stop(e):a.triggerRelease(e,t)},releaseAll:()=>{r&&r.stopAll(),a.releaseAll(),i=null},connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{r&&r.dispose(),a.dispose(),o.dispose()},applyConfig:e=>{const t=e||ua,n=t.envelope;a.set({envelope:{attack:n.attack/1e3,decay:n.decay/1e3,sustain:n.sustain/100,release:n.release/1e3}}),o.bits=t.bitDepth},volume:a.volume,updateArpeggio:e=>{r&&e&&r.updateConfig(e)},getArpeggioEngine:()=>r,getCurrentArpeggioStep:()=>r?.getCurrentStep()??0,isArpeggioPlaying:()=>r?.getIsPlaying()??!1}}static createFurnace(e){if(!e.furnace)throw new Error("Furnace config required for Furnace synth type");return new pc(e.furnace)}static createBuzzmachine(e){const t=e.buzzmachine?.machineType||"ArguruDistortion",n=new ju({ArguruDistortion:Fu.ARGURU_DISTORTION,ElakDist2:Fu.ELAK_DIST2,JeskolaDistortion:Fu.JESKOLA_DISTORTION,GeonikOverdrive:Fu.GEONIK_OVERDRIVE,GraueSoftSat:Fu.GRAUE_SOFTSAT,WhiteNoiseStereoDist:Fu.WHITENOISE_STEREODIST,ElakSVF:Fu.ELAK_SVF,CyanPhaseNotch:Fu.CYANPHASE_NOTCH,QZfilter:Fu.Q_ZFILTER,FSMPhilta:Fu.FSM_PHILTA,JeskolaDelay:Fu.JESKOLA_DELAY,JeskolaCrossDelay:Fu.JESKOLA_CROSSDELAY,JeskolaFreeverb:Fu.JESKOLA_FREEVERB,FSMPanzerDelay:Fu.FSM_PANZERDELAY,FSMChorus:Fu.FSM_CHORUS,FSMChorus2:Fu.FSM_CHORUS2,WhiteNoiseWhiteChorus:Fu.WHITENOISE_WHITECHORUS,BigyoFrequencyShifter:Fu.BIGYO_FREQUENCYSHIFTER,GeonikCompressor:Fu.GEONIK_COMPRESSOR,LdSLimit:Fu.LD_SLIMIT,OomekExciter:Fu.OOMEK_EXCITER,OomekMasterizer:Fu.OOMEK_MASTERIZER,DedaCodeStereoGain:Fu.DEDACODE_STEREOGAIN,FSMKick:Fu.FSM_KICK,FSMKickXP:Fu.FSM_KICKXP,JeskolaTrilok:Fu.JESKOLA_TRILOK,JeskolaNoise:Fu.JESKOLA_NOISE,OomekAggressor:Fu.OOMEK_AGGRESSOR,MadBrain4FM2F:Fu.MADBRAIN_4FM2F,MadBrainDynamite6:Fu.MADBRAIN_DYNAMITE6,MakkM3:Fu.MAKK_M3,CyanPhaseDTMF:Fu.CYANPHASE_DTMF,ElenzilFrequencyBomb:Fu.ELENZIL_FREQUENCYBOMB}[t]??Fu.ARGURU_DISTORTION),s=this.getNormalizedVolume("Buzzmachine",e.volume);return n.output.gain.value=ae(s),n}static CHIP_DEFAULTS={0:{algorithm:4,feedback:5,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:8,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:12,d2r:0,sl:4,rr:6,dt:3,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:10,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!0,mult:4,tl:35,ar:28,dr:15,d2r:0,sl:5,rr:10,dt:-1,am:!1}]},1:{algorithm:5,feedback:6,operators:[{enabled:!0,mult:1,tl:15,ar:31,dr:5,d2r:0,sl:1,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:40,ar:31,dr:8,d2r:0,sl:3,rr:8,dt:2,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:4,rr:8,dt:-2,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:12,d2r:0,sl:5,rr:10,dt:0,am:!0}]},2:{algorithm:0,feedback:3,operators:[{enabled:!0,mult:2,tl:30,ar:15,dr:4,d2r:0,sl:8,rr:5,dt:0,ws:1,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:2,d2r:0,sl:4,rr:8,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1}]},11:{algorithm:0,feedback:2,operators:[{enabled:!0,mult:4,tl:35,ar:15,dr:5,d2r:0,sl:6,rr:7,dt:0,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:3,d2r:0,sl:3,rr:6,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},4:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},5:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:28,dr:2,d2r:0,sl:2,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},3:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},12:{algorithm:7,feedback:1,operators:[{enabled:!0,mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:50,ar:31,dr:8,d2r:0,sl:8,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},10:{algorithm:4,feedback:4,operators:[{enabled:!0,mult:1,tl:15,ar:25,dr:8,d2r:3,sl:5,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:6,rr:10,dt:1,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},6:{algorithm:6,feedback:2,operators:[{enabled:!0,mult:1,tl:12,ar:31,dr:5,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:0,sl:4,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},9:{algorithm:5,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:31,dr:3,d2r:0,sl:1,rr:10,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:6,d2r:0,sl:3,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},8:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]},15:{algorithm:7,feedback:7,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4,dt:0,am:!1},{enabled:!0,mult:5,tl:45,ar:31,dr:20,d2r:0,sl:10,rr:6,dt:2,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]}};static createFurnaceWithChip(e,t){const n=this.CHIP_DEFAULTS[t]||{algorithm:0,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:15,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:0,sl:4,rr:10,dt:0,am:!1}]},s={...e.furnace||{algorithm:n.algorithm??0,feedback:n.feedback??0,operators:n.operators||[],macros:[],opMacros:[],wavetables:n.wavetables||[]},chipType:t};return new pc(s)}static createPWMSynth(e){const t=e.pwmSynth||da,n=new K($,{oscillator:{type:"square"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("PWMSynth",e.volume)});n.maxPolyphony=32;const s=new h({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),a=new q({frequency:t.pwmRate,delayTime:2,depth:t.pwmDepth/100,wet:.6});return a.start(),n.connect(s),s.connect(a),{triggerAttackRelease:(e,t,s,a)=>{try{n.triggerRelease(e,s)}catch{}n.triggerAttackRelease(e,t,s,a)},triggerAttack:(e,t,s)=>{try{n.triggerRelease(e,t)}catch{}n.triggerAttack(e,t,s)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{n.dispose(),s.dispose(),a.dispose()},applyConfig:e=>{const t=e||da,o=t.envelope,r=t.filter;n.set({envelope:{attack:o.attack/1e3,decay:o.decay/1e3,sustain:o.sustain/100,release:o.release/1e3}}),s.set({type:r.type,frequency:r.cutoff,Q:r.resonance/10}),a.set({frequency:t.pwmRate,depth:t.pwmDepth/100})},volume:n.volume}}static createStringMachine(e){const t=e.stringMachine||ma,n=new K($,{oscillator:{type:"sawtooth"},envelope:{attack:(t.attack||100)/1e3,decay:.2,sustain:.9,release:(t.release||500)/1e3},volume:this.getNormalizedVolume("StringMachine",e.volume)});n.maxPolyphony=32;const s=new q({frequency:t.ensemble.rate,delayTime:3.5,depth:t.ensemble.depth/100,wet:.8});s.start();const a=new h({type:"lowpass",frequency:2e3+80*t.brightness,Q:.5,rolloff:-12});return n.connect(a),a.connect(s),{triggerAttackRelease:(e,t,s,a)=>{try{n.triggerRelease(e,s)}catch{}n.triggerAttackRelease(e,t,s,a)},triggerAttack:(e,t,s)=>{try{n.triggerRelease(e,t)}catch{}n.triggerAttack(e,t,s)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),s.dispose(),a.dispose()},applyConfig:e=>{const t=e||ma,o=t.ensemble;n.set({envelope:{attack:t.attack/1e3,release:t.release/1e3}}),s.set({frequency:o.rate,depth:o.depth/100}),a.frequency.rampTo(2e3+80*t.brightness,.1)},volume:n.volume}}static createFormantSynth(e){const t=e.formantSynth||ga,n=pa[t.vowel]||pa.A,s=new K($,{oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("FormantSynth",e.volume)});s.maxPolyphony=32;const a=new h({type:"bandpass",frequency:n.f1,Q:3}),o=new h({type:"bandpass",frequency:n.f2,Q:3}),r=new h({type:"bandpass",frequency:n.f3,Q:3}),i=new m(2);return s.connect(a),s.connect(o),s.connect(r),a.connect(i),o.connect(i),r.connect(i),{triggerAttackRelease:(e,t,n,a)=>{try{s.triggerRelease(e,n)}catch{}s.triggerAttackRelease(e,t,n,a)},triggerAttack:(e,t,n)=>{try{s.triggerRelease(e,t)}catch{}s.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{s.triggerRelease(e,t)},releaseAll:()=>s.releaseAll(),connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{s.dispose(),a.dispose(),o.dispose(),r.dispose(),i.dispose()},applyConfig:e=>{const t=e||ga,n=t.envelope,i=pa[t.vowel];s.set({envelope:{attack:n.attack/1e3,decay:n.decay/1e3,sustain:n.sustain/100,release:n.release/1e3}}),a.frequency.rampTo(i.f1,.1),o.frequency.rampTo(i.f2,.1),r.frequency.rampTo(i.f3,.1)},volume:s.volume}}static createWobbleBass(e){const t=e.wobbleBass||ha,n=Math.max(1,t.unison.voices),s=t.unison.detune,a=new K($,{oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc1.level/100*6-6-6});a.maxPolyphony=32;const o=new K($,{oscillator:{type:t.osc2.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc2.level/100*6-6-6});o.maxPolyphony=32,a.set({detune:1200*t.osc1.octave+t.osc1.detune}),o.set({detune:1200*t.osc2.octave+t.osc2.detune});let r=null;t.sub.enabled&&(r=new K($,{oscillator:{type:"sine"},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.sub.level/100*12-12-6}),r.maxPolyphony=32,r.set({detune:1200*t.sub.octave}));const i=[],l=[];if(n>1)for(let m=1;m<Math.min(n,8);m++){const e=(m/n-.5)*s*2,a=(m/n-.5)*(t.unison.stereoSpread/50),o=new K($,{oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-12-1.5*n});o.maxPolyphony=32,o.set({detune:1200*t.osc1.octave+e});const r=new ue(a);o.connect(r),i.push(o),l.push(r)}let c=null;t.fm.enabled&&t.fm.amount>0&&(c=new K(_,{modulationIndex:t.fm.amount/10,harmonicity:t.fm.ratio,envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-6}),c.maxPolyphony=32,c.set({detune:1200*t.osc1.octave}));const u=new m(1),d=new h({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:t.filter.rolloff});let p=null;t.filter.drive>0&&(p=new v({distortion:t.filter.drive/100,oversample:"2x"}));const f=t.filterEnvelope.amount/100,g=t.filter.cutoff,b=4*Math.abs(f),x=new de({baseFrequency:g,octaves:b,attack:t.filterEnvelope.attack/1e3,decay:t.filterEnvelope.decay/1e3,sustain:t.filterEnvelope.sustain/100,release:t.filterEnvelope.release/1e3});(!t.wobbleLFO.enabled||t.filterEnvelope.amount>0)&&x.connect(d.frequency);let N=null;if(t.wobbleLFO.enabled){let e=t.wobbleLFO.rate;if("free"!==t.wobbleLFO.sync){e=(k().bpm.value||120)/60*(({"1/1":1,"1/2":2,"1/2T":3,"1/2D":1.5,"1/4":4,"1/4T":6,"1/4D":3,"1/8":8,"1/8T":12,"1/8D":6,"1/16":16,"1/16T":24,"1/16D":12,"1/32":32,"1/32T":48}[t.wobbleLFO.sync]||4)/4)}const n={sine:"sine",triangle:"triangle",saw:"sawtooth",square:"square",sample_hold:"square"},s=4*g,a=Math.max(20,.1*g),o=Math.min(2e4,g+s*(t.wobbleLFO.amount/100));N=new y({frequency:e,type:n[t.wobbleLFO.shape]||"sine",min:a,max:o,phase:t.wobbleLFO.phase}),N.connect(d.frequency),N.start()}let w=null;if(t.distortion.enabled)switch(t.distortion.type){case"soft":w=new v({distortion:t.distortion.drive/100,oversample:"2x"});break;case"hard":w=new j({order:Math.floor(1+t.distortion.drive/100*50)});break;case"fuzz":w=new v({distortion:.5+t.distortion.drive/200,oversample:"4x"});break;case"bitcrush":w=new ce({bits:Math.max(2,12-Math.floor(t.distortion.drive/10))})}const E=new h({type:"lowpass",frequency:500+t.distortion.tone/100*15e3,Q:.5});let D=[],S=null;if(t.formant.enabled){const e=pa[t.formant.vowel];D=[new h({type:"bandpass",frequency:e.f1,Q:5}),new h({type:"bandpass",frequency:e.f2,Q:5}),new h({type:"bandpass",frequency:e.f3,Q:5})],S=new m(.5)}const M=new m(1);M.gain.value=Math.pow(10,this.getNormalizedVolume("WobbleBass",e.volume)/20),a.connect(u),o.connect(u),r&&r.connect(u),c&&c.connect(u),l.forEach(e=>e.connect(u)),p?(u.connect(p),p.connect(d)):u.connect(d);let C=d;w&&(C.connect(w),C=w),C.connect(E),C=E,S&&D.length>0?(D.forEach(e=>{C.connect(e),e.connect(S)}),S.connect(M),C.connect(M)):C.connect(M);const V=new Set;return{triggerAttackRelease:(e,n,s,l)=>{const u=s??Y(),d=l??.8;try{a.triggerRelease(e,u)}catch{}try{o.triggerRelease(e,u)}catch{}try{r&&r.triggerRelease(e,u)}catch{}try{c&&c.triggerRelease(e,u)}catch{}try{i.forEach(t=>t.triggerRelease(e,u))}catch{}t.wobbleLFO.retrigger&&N&&(N.phase=t.wobbleLFO.phase),x.triggerAttack(u),a.triggerAttackRelease(e,n,u,d),o.triggerAttackRelease(e,n,u,d),r&&r.triggerAttackRelease(e,n,u,d),c&&c.triggerAttackRelease(e,n,u,d),i.forEach(t=>t.triggerAttackRelease(e,n,u,.6*d))},triggerAttack:(e,n,s)=>{const l=n??Y(),u=s??.8;V.add(e);try{a.triggerRelease(e,l)}catch{}try{o.triggerRelease(e,l)}catch{}try{r&&r.triggerRelease(e,l)}catch{}try{c&&c.triggerRelease(e,l)}catch{}try{i.forEach(t=>t.triggerRelease(e,l))}catch{}t.wobbleLFO.retrigger&&N&&(N.phase=t.wobbleLFO.phase),x.triggerAttack(l),a.triggerAttack(e,l,u),o.triggerAttack(e,l,u),r&&r.triggerAttack(e,l,u),c&&c.triggerAttack(e,l,u),i.forEach(t=>t.triggerAttack(e,l,.6*u))},triggerRelease:(e,t)=>{const n=t??Y();V.delete(e),x.triggerRelease(n),a.triggerRelease(e,n),o.triggerRelease(e,n),r&&r.triggerRelease(e,n),c&&c.triggerRelease(e,n),i.forEach(t=>t.triggerRelease(e,n))},releaseAll:()=>{a.releaseAll(),o.releaseAll(),r&&r.releaseAll(),c&&c.releaseAll(),i.forEach(e=>e.releaseAll()),V.clear()},connect:e=>M.connect(e),disconnect:()=>M.disconnect(),dispose:()=>{a.dispose(),o.dispose(),r&&r.dispose(),c&&c.dispose(),i.forEach(e=>e.dispose()),l.forEach(e=>e.dispose()),u.dispose(),d.dispose(),p&&p.dispose(),x.dispose(),N&&N.dispose(),w&&w.dispose(),E.dispose(),D.forEach(e=>e.dispose()),S&&S.dispose(),M.dispose()},applyConfig:e=>{const t=e||ha,n=t.envelope||{},s=t.osc1||{},l=t.osc2||{},u=t.sub||{},m=t.filter||{},p=t.wobbleLFO||{},h={attack:(n.attack||10)/1e3,decay:(n.decay||200)/1e3,sustain:(n.sustain??70)/100,release:(n.release||300)/1e3};a.set({envelope:h}),o.set({envelope:h}),r&&r.set({envelope:h}),c&&c.set({envelope:h}),i.forEach(e=>e.set({envelope:h})),a.volume.rampTo(s.level/100*6-6-6,.1),o.volume.rampTo(l.level/100*6-6-6,.1),a.set({detune:1200*s.octave+s.detune}),o.set({detune:1200*l.octave+l.detune}),r&&(r.volume.rampTo(u.level/100*12-12-6,.1),r.set({detune:1200*u.octave})),d.set({type:m.type,frequency:Number(m.cutoff)||500,Q:Number(m.resonance)/10}),N&&N.frequency.rampTo(p.rate||1,.1)},volume:a.volume,wobbleLFO:N,filter:d}}static _reverseAudioBuffer(e){const t=N().rawContext.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let n=0;n<e.numberOfChannels;n++){const s=e.getChannelData(n),a=t.getChannelData(n);for(let e=0;e<s.length;e++)a[e]=s[s.length-1-e]}return t}static createDrumKit(e){const t=e.drumKit||wa;return new Ac(t)}static applyPitchEnvelope(e,t,n,s){const a=100*t.amount,o=t.sustain/100*a,r=t.attack/1e3,i=t.release/1e3,l=e;if(!l.set)return;l.set({detune:a});setTimeout(()=>{l.set&&l.set({detune:o})},1e3*(n+r-Y()));setTimeout(()=>{l.set&&l.set({detune:0})},1e3*(n+s-Y())+1e3*i)}static triggerPitchEnvelopeAttack(e,t,n){const s=100*t.amount,a=t.sustain/100*s,o=t.attack/1e3,r=t.decay/1e3,i=e;if(!i.set)return;i.set({detune:s});const l=Math.max(0,1e3*(n-Y()+o+r));setTimeout(()=>{i.set&&i.set({detune:a})},l)}static createDubSiren(e){const t=e.dubSiren||ka,n=new jc(t);return n.volume.value=this.getNormalizedVolume("DubSiren",e.volume),n}static createSpaceLaser(e){const t=e.spaceLaser||Va,n=new Xc(t);return n.volume.value=this.getNormalizedVolume("SpaceLaser",e.volume),n}static createV2(e){if(e.v2Speech||"V2Speech"===e.synthType){const t=new Iu(e.v2Speech||void 0);return t.output.gain.value=ae(this.getNormalizedVolume("V2",e.volume)),t}const t=new Bu(e.v2||void 0);return t.output.gain.value=ae(this.getNormalizedVolume("V2",e.volume)),t}static createSam(e){const t=e.sam||Da,n=new Au(t);return n.output.gain.value=ae(this.getNormalizedVolume("Sam",e.volume)),n}static createSynare(e){const t=e.synare||Pa,n=new zc(t);return n.volume.value=this.getNormalizedVolume("Synare",e.volume),n}static createDexed(e){const t=e.dexed||{},n=new Vd(t);return n.output.gain.value=ae(this.getNormalizedVolume("Dexed",e.volume)),n}static createOBXd(e){const t=e.obxd||{},n=new km(t);return n.output.gain.value=ae(this.getNormalizedVolume("OBXd",e.volume)),n}static createCZ101(e){const t=new Tm;return t.init(),t.output.gain.value=ae(this.getNormalizedVolume("CZ101",e.volume)),t}static createCEM3394(e){const t=new Hm;return t.output.gain.value=ae(this.getNormalizedVolume("CEM3394",e.volume)),t}static createSCSP(e){const t=new qm;return t.output.gain.value=ae(this.getNormalizedVolume("SCSP",e.volume)),t}static createVFX(e){const t=new fp;return t.init(),t.output.gain.value=ae(this.getNormalizedVolume("MAMEVFX",e.volume)),t}static createD50(e){const t=new vp;return t.init(),t.output.gain.value=ae(this.getNormalizedVolume("MAMERSA",e.volume)),t}static createRdPiano(e){const t=e.rdpiano||{},n=new _p(t);return n.output.gain.value=ae(this.getNormalizedVolume("MAMERSA",e.volume)),n}static createMU2000(e){const t=new Ip;return t.init(),t.output.gain.value=ae(this.getNormalizedVolume("MAMESWP30",e.volume)),t}static createBuzz3o3DF(e){const t=new ju(Fu.OOMEK_AGGRESSOR_DF);if(e.tb303){const n=e.tb303;if(t.setCutoff(n.filter.cutoff),t.setResonance(n.filter.resonance),t.setEnvMod(n.filterEnvelope.envMod),t.setDecay(n.filterEnvelope.decay),t.setAccentAmount(n.accent.amount),t.setWaveform(n.oscillator.type),void 0!==n.tuning&&t.setTuning(n.tuning),n.overdrive&&t.setOverdrive(n.overdrive.amount),n.devilFish){const e=n.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:n.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.filterFmDepth&&t.setFilterFM(e.filterFmDepth)}const s=this.getNormalizedVolume("Buzz3o3DF",e.volume);t.setVolume(s)}return t}static applyChipParameters(e,t){const n=t.parameters;if(n){"number"==typeof n._program&&"function"==typeof e.loadPreset&&e.loadPreset(n._program);for(const[t,s]of Object.entries(n))"_program"!==t&&"number"==typeof s&&e.setParam(t,s)}}static createMAMEAICA(e){const t=new Up;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEAICA",e.volume)),this.applyChipParameters(t,e),t}static createMAMEASC(e){const t=new Kp;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEASC",e.volume)),this.applyChipParameters(t,e),t}static createMAMEAstrocade(e){const t=new sh;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEAstrocade",e.volume)),this.applyChipParameters(t,e),t}static createMAMEC352(e){const t=new oh;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEC352",e.volume)),this.applyChipParameters(t,e),t}static createMAMEES5503(e){const t=new hh;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEES5503",e.volume)),this.applyChipParameters(t,e),t}static createMAMEICS2115(e){const t=new bh;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEICS2115",e.volume)),this.applyChipParameters(t,e),t}static createMAMEK054539(e){const t=new xh;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEK054539",e.volume)),this.applyChipParameters(t,e),t}static createMAMEMEA8000(e){const t=new Xh;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEMEA8000",e.volume)),this.applyChipParameters(t,e),t}static createMAMERF5C400(e){const t=new Hh;return t.output.gain.value=ae(this.getNormalizedVolume("MAMERF5C400",e.volume)),this.applyChipParameters(t,e),t}static createMAMESN76477(e){const t=new of;return t.output.gain.value=ae(this.getNormalizedVolume("MAMESN76477",e.volume)),this.applyChipParameters(t,e),t}static createMAMESNKWave(e){const t=new df;return t.output.gain.value=ae(this.getNormalizedVolume("MAMESNKWave",e.volume)),this.applyChipParameters(t,e),t}static createMAMESP0250(e){const t=new xf;return t.output.gain.value=ae(this.getNormalizedVolume("MAMESP0250",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS36XX(e){const t=new Mf;return t.output.gain.value=ae(this.getNormalizedVolume("MAMETMS36XX",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS5220(e){const t=new gg;return t.output.gain.value=ae(this.getNormalizedVolume("MAMETMS5220",e.volume)),this.applyChipParameters(t,e),t}static createMAMETR707(e){const t=new _g;return t.output.gain.value=ae(this.getNormalizedVolume("MAMETR707",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD931(e){const t=new Rg;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEUPD931",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD933(e){const t=new Qg;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEUPD933",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVotrax(e){const t=new yv;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEVotrax",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMF271(e){const t=new Bv;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEYMF271",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMOPQ(e){const t=new ty;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEYMOPQ",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVASynth(e){const t=new uy;return t.output.gain.value=ae(this.getNormalizedVolume("MAMEVASynth",e.volume)),this.applyChipParameters(t,e),t}static createModularSynth(e){const t=e.modularSynth||WN,n=new HN(t);return n.output.gain.value=ae(this.getNormalizedVolume("ModularSynth",e.volume)),n}static triggerPitchEnvelopeRelease(e,t,n){const s=t.release/1e3,a=e;if(!a.set)return;const o=Math.max(0,1e3*(n-Y()+s));setTimeout(()=>{a.set&&a.set({detune:0})},o)}}function QN(e){const t={FurnaceOPN:0,FurnaceOPM:1,FurnaceOPL:2,FurnacePSG:3,FurnaceNES:4,FurnaceGB:5,FurnacePCE:6,FurnaceSCC:7,FurnaceN163:8,FurnaceVRC6:9,FurnaceC64:10,FurnaceOPLL:11,FurnaceAY:12,FurnaceOPNA:13,FurnaceOPNB:14,FurnaceTIA:15,FurnaceFDS:16,FurnaceMMC5:17,FurnaceSAA:18,FurnaceSWAN:19,FurnaceOKI:20,FurnaceES5506:21,FurnaceOPZ:22,FurnaceY8950:23,FurnaceSNES:24,FurnaceLYNX:25,FurnaceOPL4:26,FurnaceSEGAPCM:27,FurnaceYMZ280B:28,FurnaceRF5C68:29,FurnaceGA20:30,FurnaceC140:31,FurnaceQSOUND:32,FurnaceVIC:33,FurnaceTED:34,FurnaceSUPERVISION:35,FurnaceVERA:36,FurnaceSM8521:37,FurnaceBUBBLE:38,FurnaceK007232:39,FurnaceK053260:40,FurnaceX1_010:41,FurnaceUPD1771:42,FurnaceT6W28:43,FurnaceVB:44,FurnaceSID6581:45,FurnaceSID8580:46,FurnaceOPN2203:47,FurnaceOPNBB:48,FurnaceESFM:49,FurnaceAY8930:50,FurnaceNDS:51,FurnaceGBA:52,FurnacePOKEMINI:54,FurnaceNAMCO:55,FurnacePET:56,FurnacePOKEY:57,FurnaceMSM6258:58,FurnaceMSM5232:59,FurnaceMULTIPCM:60,FurnaceAMIGA:61,FurnacePCSPKR:62,FurnacePONG:63,FurnacePV1000:64,FurnaceDAVE:65,FurnaceSU:66,FurnacePOWERNOISE:68,FurnaceZXBEEPER:69,FurnaceSCVTONE:71,FurnacePCMDAC:72,Furnace:0}[e];if(void 0===t)return;const n={...va,chipType:t,operators:va.operators.map(e=>({...e}))};return"FurnaceC64"!==e&&"FurnaceSID6581"!==e&&"FurnaceSID8580"!==e||(n.c64={triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:12,r:6,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}),n}const ZN=32e3;function ew(e,t=!1){if(e<=0)return 0;try{const n=Bw().getWasmInstance();if(n&&!t&&"function"==typeof n.periodToHz)return n.periodToHz(e)}catch{}return(t?3579545:3546895)/(2*e)}const tw=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24],nw=[[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113],[850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113],[844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112],[838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111],[832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110],[826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109],[820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109],[814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108],[907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120],[900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119],[894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118],[887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118],[881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117],[875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116],[868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115],[862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114]],sw=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function aw(e){const t=Math.max(-8,Math.min(7,Math.round(e)));return t<0?t+16:t}function ow(e,t=0){if(e>=36&&e<72&&Math.abs(t)<=8){const n=aw(t);return nw[n][e-36]}const n=e-48+t/128;return Math.round(428/Math.pow(2,n/12))}function rw(e,t=0){if(e<=0)return-1;const n=3546895/e,s=48+12*Math.log2(n/8287.13);return Math.round(s)}function iw(e,t=0,n){if(!e||"..."===e||"---"===e)return 0;if("==="===e||"^^^"===e)return-1;const s=e.match(/^([A-G][#-]?)[-]?(\d)$/i);if(!s)return 0;const a=s[1].toUpperCase(),o=parseInt(s[2],10),r=sw.findIndex(e=>e===a||e.replace("-","")===a.replace("#","#"));if(-1===r)return 0;let i=4;"MOD"===n&&(i=1),"IT"!==n&&"S3M"!==n||(i=2);return ow(12*(o-i)+r+48,t)}function lw(e,t=0,n){if(e<=0)return"---";if(-1===e)return"===";const s=rw(e,t);let a=4;"MOD"===n&&(a=1),"IT"!==n&&"S3M"!==n||(a=2);return`${sw[(s%12+12)%12]}${Math.floor((s-48)/12)+a}`}function cw(e,t=0){if(!e||"..."===e||"---"===e)return 0;if("==="===e||"^^^"===e)return-1;const n=e.match(/^([A-G][#-]?)[-]?(\d)$/i);if(!n)return 0;const s=n[1].toUpperCase(),a=parseInt(n[2],10),o=sw.findIndex(e=>e===s||e.replace("-","")===s.replace("#","#"));if(-1===o)return 0;return 7680-64*(12*(a-4)+o+49)-Math.floor(t/2)}function uw(e){return e<=0?0:8363*Math.pow(2,(4608-e)/768)}function dw(e,t,n=0,s=!1){if(e<=0)return 0;const a=rw(e,n);if(-1===a)return e;let o=a+t;if(s){if(72===o)return 0;o>72&&(o-=37)}return ow(o,n)}function mw(e,t=0){if(e<=0)return 0;return ow(rw(e,t),t)}const pw=Object.freeze(Object.defineProperty({__proto__:null,NOTE_NAMES:sw,PERIOD_TABLE:nw,PT_MAX_PERIOD:ZN,PT_MIN_PERIOD:54,VIBRATO_TABLE:tw,finetuneToIndex:aw,getArpeggioPeriod:dw,getPeriodExtended:ow,noteStringToPeriod:iw,noteStringToXMLinearPeriod:cw,periodToFrequency:ew,periodToNoteIndex:rw,periodToNoteString:lw,snapPeriodToSemitone:mw,xmLinearPeriodToFrequency:uw},Symbol.toStringTag,{value:"Module"}));class hw extends d{name="AmigaFilter";hp_a1=0;hp_a2=0;lp1_a1=0;lp1_a2=0;lp2_a1=0;lp2_a2=0;lp2_b1=0;lp2_b2=0;_ledFilterEnabled=!0;_sampleRate;input;output;_worklet=null;_initialized=!1;_initializing=!1;_retryCount=0;static MAX_RETRIES=3;static _loadPromises=new WeakMap;constructor(){super(),this.input=new m,this.output=new m,this._sampleRate=N().sampleRate,this.setupCoefficients(),this.input.connect(this.output),this.tryInitWorklet()}async tryInitWorklet(){if(this._initialized||this._initializing)return;const e=N();if("running"!==e.state){const t=()=>{"running"===e.state&&this.initWorklet()};return e.on("statechange",t),void setTimeout(()=>{"running"!==e.state||this._initialized||this.initWorklet()},100)}await this.initWorklet()}async initWorklet(){if(!(this._initialized||this._initializing||this._retryCount>=hw.MAX_RETRIES)){this._initializing=!0;try{const t=this.context,n=t.rawContext||t._context;if(!n||!n.audioWorklet)return void(this._initializing=!1);if("running"!==n.state)return void(this._initializing=!1);const s="/",a=`?v=${Date.now()}`;let o=hw._loadPromises.get(n);o||(o=(async()=>{try{await n.audioWorklet.addModule(`${s}AmigaFilter.worklet.js${a}`)}catch(e){const t=e instanceof Error?e:null;if(!(t?.message?.includes("already")||t?.message?.includes("duplicate")))throw hw._loadPromises.delete(n),e}})(),hw._loadPromises.set(n,o)),await o;try{this._worklet=new AudioWorkletNode(n,"amiga-filter-processor")}catch(e){const t=e instanceof Error?e:null;if("InvalidStateError"===t?.name)return this._retryCount++,hw._loadPromises.delete(n),this._initializing=!1,void(this._retryCount<hw.MAX_RETRIES&&setTimeout(()=>this.initWorklet(),500));throw e}if(this._worklet&&this._worklet.port.postMessage({type:"INIT",coeffs:{hp:{a1:this.hp_a1,a2:this.hp_a2},lp1:{a1:this.lp1_a1,a2:this.lp1_a2},lp2:{a1:this.lp2_a1,a2:this.lp2_a2,b1:this.lp2_b1,b2:this.lp2_b2}}}),this._worklet){try{this.input.disconnect(this.output)}catch{}me(this.input,this._worklet),me(this._worklet,this.output),this._initialized=!0}else this._initializing=!1}catch(e){this._initializing=!1,this._retryCount++}}}setupCoefficients(){const e=this._sampleRate,t=Math.PI,n=2-Math.cos(2*t*5.128/e),s=n-Math.sqrt(n*n-1);this.hp_a1=1-s,this.hp_a2=s;const a=2-Math.cos(2*t*4420.971/e),o=a-Math.sqrt(a*a-1);this.lp1_a1=1-o,this.lp1_a2=o;const r=1/Math.tan(3090.533*t/e),i=1/.660225;this.lp2_a1=1/(1+i*r+r*r),this.lp2_a2=2*this.lp2_a1,this.lp2_b1=2*(1-r*r)*this.lp2_a1,this.lp2_b2=(1-i*r+r*r)*this.lp2_a1}get ledFilterEnabled(){return this._ledFilterEnabled}set ledFilterEnabled(e){this._ledFilterEnabled=e,this._worklet&&this._worklet.port.postMessage({type:"SET_LED",enabled:e})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this}}class fw{points=[];enabled=!1;sustainPoint=null;loopStart=null;loopEnd=null;tick=0;isKeyOff=!1;currentValue=64;finished=!1;constructor(e){e&&this.init(e)}init(e){this.enabled=e.enabled,this.points=e.points,this.sustainPoint=e.sustainPoint,this.loopStart=e.loopStartPoint,this.loopEnd=e.loopEndPoint,this.reset()}reset(){this.tick=0,this.isKeyOff=!1,this.currentValue=this.points.length>0?this.points[0].value:64,this.finished=!1}keyOff(){this.isKeyOff=!0}tickNext(){if(!this.enabled||0===this.points.length)return 64;if(this.finished)return this.points[this.points.length-1].value;if(!this.isKeyOff&&null!==this.sustainPoint){const e=this.points[this.sustainPoint];if(this.tick>=e.tick)return this.tick=e.tick,this.currentValue=e.value,this.currentValue}if(null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd],t=this.points[this.loopStart];this.tick>=e.tick&&(this.tick=t.tick)}if(this.currentValue=this.interpolate(this.tick),this.tick++,null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd];this.tick>=e.tick&&(this.tick=this.points[this.loopStart].tick)}return this.tick>this.points[this.points.length-1].tick&&(this.finished=!0,this.tick=this.points[this.points.length-1].tick),this.currentValue}interpolate(e){if(0===this.points.length)return 64;if(e<=this.points[0].tick)return this.points[0].value;if(e>=this.points[this.points.length-1].tick)return this.points[this.points.length-1].value;for(let t=0;t<this.points.length-1;t++){const n=this.points[t],s=this.points[t+1];if(e>=n.tick&&e<=s.tick){const t=s.tick-n.tick;if(0===t)return s.value;const a=(s.value-n.value<<16)/t,o=(e-n.tick)*a;return n.value+(o>>16)}}return 64}isEnabled(){return this.enabled}isFinished(){return this.finished}getCurrentValue(){return this.currentValue}}class gw{input;output;analyser;fft;disposed=!1;cachedWaveform=null;cachedFFT=null;constructor(){this.input=new m(1),this.output=new m(1),this.analyser=new pe("waveform",256),this.fft=new he(1024),this.input.connect(this.analyser),this.input.connect(this.fft),this.input.connect(this.output)}getWaveform(){if(this.disposed)return this.cachedWaveform||new Float32Array(256);const e=this.analyser.getValue();return this.cachedWaveform&&this.cachedWaveform.length===e.length||(this.cachedWaveform=new Float32Array(e.length)),this.cachedWaveform.set(e),this.cachedWaveform}getFFT(){if(this.disposed)return this.cachedFFT||new Float32Array(1024);const e=this.fft.getValue();return this.cachedFFT&&this.cachedFFT.length===e.length||(this.cachedFFT=new Float32Array(e.length)),this.cachedFFT.set(e),this.cachedFFT}getLevel(){if(this.disposed)return 0;const e=this.getWaveform();if(0===e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];return Math.sqrt(t/e.length)}getPeak(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let n=0;n<e.length;n++){const s=Math.abs(e[n]);s>t&&(t=s)}return t}hasActivity(){return this.getPeak()>.001}connectInstrument(e){if(!this.disposed)if(eo(e)){const t=co(this.input);t&&e.output.connect(t)}else e.connect(this.input)}disconnectInstrument(e){if(!this.disposed)try{eo(e)?e.output.disconnect():e.disconnect(this.input)}catch{}}dispose(){if(!this.disposed){this.disposed=!0;try{this.input.disconnect(),this.analyser.disconnect(),this.fft.disconnect(),this.output.disconnect(),this.input.dispose(),this.output.dispose(),this.analyser.dispose(),this.fft.dispose()}catch{}this.cachedWaveform=null,this.cachedFFT=null}}}function bw(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}const vw=["hum/hum1_0ktober_hyperspace_cut.wav","hum/hum2_alienhum1.wav","hum/hum3_joedeshon__electrical_hum_01_cut.wav","hum/hum4_loose-connection-feedback-hum.wav","hum/hum5_vhs-hum.wav","machine/machine1_computer_fan_hum_cut.wav","machine/machine2_dough-machine-electricity-001_cut.wav","machine/machine3_fridge-hum-kitchen-2012_cut.wav","machine/machine4_fridge-hum-loud-saint-john_cut.wav","machine/machine5_furnace-propane-pump-hum-rattle-nearby.wav","machine/machine6_lettersort.wav","machine/machine7_oven-hum-2_cut.wav","machine/machine8_tattoo-air-conditioning-blowing-traffic-hum-outside_cut.wav","machine/machine9_thailand-hotel-hallway-heavy-ventilation-hum-distant-voices-man-spits-middle.wav","machine/machine10_vending-machine-hum_cut.wav","machine/machine11_washing-machine-rinse.wav","static/static1_electric-zap-electricity-2.wav","static/static2_electrical-noise.wav","static/static3_film_static_03_cut.wav","static/static4_gramophone_stereo.wav","static/static5_radio-fuzz-for-old-radio-broadcast-ff233_cut.wav","static/static6_tv-static_cut.wav","vinyl/vinyl1_Runoff 139 BPM.wav","vinyl/vinyl2_oldvinyl_128.wav","vinyl/vinyl3_Vinyl Dust2.wav","vinyl/vinyl4_Vinyl Crackle Analogue 1.wav","vinyl/vinyl5_vinyl-crackle-1_edit.wav","world/city1_city-ambiance-heavy-snow-wind.wav","world/city2_city-ambience-at-night-3.wav","world/city3_distant-city-evening-traffic-5th-floor-balcony.wav","world/crowd_large_crowd_medium_distance_stereo.wav","world/fire1_ambiance_campfire_loop_stereo.wav","world/fire2.wav","world/fire3_campfire-01.wav","world/fire4_campfire.wav","world/rain1_field_la-rain_park_under-stone-bridge_02.wav","world/rain2_forest-cabin-summer-rain-5.wav","world/rain3_rain-and-thunder-in-the-countryside.wav","world/rain4_rain-in-the-midnight-city.wav","world/rain5_rain-thunder-and-traffic.wav","world/underground_large-underground-metro-station-heavy-ventilation-and-distant-echo-voices.wav","world/waterfall1_hidden-waterfall.wav","world/waterfall2_krka_waterfall2_f_4824.wav","world/waterfall3_turbulent-river-waterfall.wav","world/waterfall4_sound.wav","noiseplethora/A/A0-RadioOhNo_1.wav","noiseplethora/A/A0-RadioOhNo_2.wav","noiseplethora/A/A1-Rwalk_SineFMFlange.wav","noiseplethora/A/A2-xModRingSqr.wav","noiseplethora/A/A3-xModRingSine_1.wav","noiseplethora/A/A3-xModRingSine_2.wav","noiseplethora/A/A4-CrossModRing_1.wav","noiseplethora/A/A4-CrossModRing_2.wav","noiseplethora/A/A5-Resonoise_long.wav","noiseplethora/A/A6-GrainGlitch_1.wav","noiseplethora/A/A6-GrainGlitch_2.wav","noiseplethora/A/A7-GrainGlitchII_1.wav","noiseplethora/A/A7-GrainGlitchII_2.wav","noiseplethora/A/A8-GrainGlitchIII_1.wav","noiseplethora/A/A8-GrainGlitchIII_2.wav","noiseplethora/A/A9-Basurilla_1.wav","noiseplethora/A/A9-Basurilla_2.wav","noiseplethora/B/B0-ClusterSaw.wav","noiseplethora/B/B1-PwCluster.wav","noiseplethora/B/B2-CrCluster2.wav","noiseplethora/B/B3-SineFMcluster.wav","noiseplethora/B/B4-TriFMcluster.wav","noiseplethora/B/B5-Primecluster.wav","noiseplethora/B/B6-PrimecCnoise.wav","noiseplethora/B/B7-FibonacciCluster.wav","noiseplethora/B/B8-PartialCluster.wav","noiseplethora/B/B9-PhasingCluster.wav","noiseplethora/C/C0-BasuraTotal_1.wav","noiseplethora/C/C0-BasuraTotal_2.wav","noiseplethora/C/C1-Atari.wav","noiseplethora/C/C2-WakingFilomena_1.wav","noiseplethora/C/C2-WakingFilomena_2.wav","noiseplethora/C/C3-P_S_H.wav","noiseplethora/C/C4-ArrayOnTheRocks_1.wav","noiseplethora/C/C4-ArrayOnTheRocks_2.wav","noiseplethora/C/C4-ArrayOnTheRocks_3.wav","noiseplethora/C/C4-ArrayOnTheRocks_4.wav","noiseplethora/C/C5-ExistencelsPain_1.wav","noiseplethora/C/C5-ExistencelsPain_2.wav","noiseplethora/C/C6-WhoKnows_1.wav","noiseplethora/C/C6-WhoKnows_2.wav","noiseplethora/C/C6-WhoKnows_3.wav","noiseplethora/C/C7-SatanWorkout_1.wav","noiseplethora/C/C7-SatanWorkout_2.wav","noiseplethora/C/C8-Rwalk_BitCrushPW_1.wav","noiseplethora/C/C8-Rwalk_BitCrushPW_2.wav","noiseplethora/C/C8-Rwalk_BitCrushPW_3.wav","noiseplethora/C/C9-Rwalk_LFree_1.wav","noiseplethora/C/C9-Rwalk_LFree_2.wav","noiseplethora/C/C9-Rwalk_LFree_3.wav"];class yw extends d{name="Tumult";input;output;dryGain;wetGain;workletNode=null;_params;_loadedSampleIndex=-1;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._params={noiseGain:e.noiseGain??-10,mix:e.mix??.5,noiseMode:e.noiseMode??0,sourceMode:e.sourceMode??0,switchBranch:e.switchBranch??0,duckThreshold:e.duckThreshold??-20,duckAttack:e.duckAttack??0,duckRelease:e.duckRelease??15,followThreshold:e.followThreshold??-20,followAttack:e.followAttack??0,followRelease:e.followRelease??15,followAmount:e.followAmount??.7,clipAmount:e.clipAmount??.497,hpEnable:e.hpEnable??0,hpFreq:e.hpFreq??888.5,hpQ:e.hpQ??.7,peak1Enable:e.peak1Enable??0,peak1Type:e.peak1Type??0,peak1Freq:e.peak1Freq??20,peak1Gain:e.peak1Gain??-.19,peak1Q:e.peak1Q??.7,peak2Enable:e.peak2Enable??0,peak2Freq:e.peak2Freq??600,peak2Gain:e.peak2Gain??1,peak2Q:e.peak2Q??1,peak3Enable:e.peak3Enable??0,peak3Type:e.peak3Type??1,peak3Freq:e.peak3Freq??2500,peak3Gain:e.peak3Gain??1,peak3Q:e.peak3Q??1,lpEnable:e.lpEnable??0,lpFreq:e.lpFreq??8500,lpQ:e.lpQ??.7,sampleIndex:e.sampleIndex??0,playerStart:e.playerStart??0,playerEnd:e.playerEnd??1,playerFade:e.playerFade??.01,playerGain:e.playerGain??0,wet:e.wet??1},this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-this._params.wet),this.wetGain=new m(this._params.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this._initWorklet()}async _initWorklet(){try{const e=N().rawContext;await yw._ensureRegistered(e),this.workletNode=new AudioWorkletNode(e,"tumult-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});const t=bw(this.input),n=bw(this.wetGain);t.connect(this.workletNode),this.workletNode.connect(n);const s=this._params;for(const[a,o]of Object.entries(s))"wet"!==a&&this._send(a,o);this._send("playing",this._playingState?1:0),2!==s.sourceMode&&3!==s.sourceMode||this._loadSample(s.sampleIndex)}catch(e){this.input.connect(this.wetGain)}}static async _ensureRegistered(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{await e.audioWorklet.addModule("/tumult/Tumult.worklet.js"),this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}_send(e,t){this.workletNode?.port.postMessage({param:e,value:t})}async _loadSample(e){if(e===this._loadedSampleIndex)return;const t=vw[e];if(t)try{const n=`${"/"}tumult/samples/${t}`,s=await fetch(n),a=await s.arrayBuffer(),o=N().rawContext,r=await o.decodeAudioData(a),i=r.getChannelData(0).slice(),l=(r.numberOfChannels>1?r.getChannelData(1):r.getChannelData(0)).slice();this.workletNode?.port.postMessage({type:"sample",bufferL:i.buffer,bufferR:l.buffer,length:i.length,sampleRate:r.sampleRate},[i.buffer,l.buffer]),this._loadedSampleIndex=e}catch(n){}}get wet(){return this._params.wet}set wet(e){this.setParam("wet",e)}_playingState=!1;setPlaying(e){this._playingState=e,this._send("playing",e?1:0)}setEditorOpen(e){this._send("editorOpen",e?1:0)}setParam(e,t){if(this._params[e]=t,"wet"===e?(this.wetGain.gain.value=t,this.dryGain.gain.value=1-t):this._send(e,t),"sampleIndex"===e||"sourceMode"===e){const e=this._params;2!==e.sourceMode&&3!==e.sourceMode||this._loadSample(e.sampleIndex)}}dispose(){try{this.workletNode?.disconnect()}catch{}return this.workletNode=null,this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const xw=Object.freeze(Object.defineProperty({__proto__:null,TumultEffect:yw},Symbol.toStringTag,{value:"Module"}));let Nw=null,ww=null,Ew=!1,kw=null;class Dw extends d{name="TapeSimulator";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={drive:Math.max(0,Math.min(e.drive??.3,1)),character:Math.max(0,Math.min(e.character??.4,1)),bias:Math.max(0,Math.min(e.bias??.4,1)),shame:Math.max(0,Math.min(e.shame??.2,1)),hiss:Math.max(0,Math.min(e.hiss??.2,1)),speed:e.speed??0,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new m(1),this.output=new m(1),this.dryGain=new m(1-this._options.wet),this.wetGain=new m(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initialize()}async initialize(){try{const e=ro(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await Dw.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"kiss-of-shame-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("drive",this._options.drive),this.sendParam("character",this._options.character),this.sendParam("bias",this._options.bias),this.sendParam("shame",this._options.shame),this.sendParam("hiss",this._options.hiss),this.sendParam("speed",this._options.speed)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Nw,jsCode:ww}),me(this.input,this.workletNode),me(this.workletNode,this.wetGain)}catch(e){}}static async ensureModuleLoaded(e){if(!Ew){if(kw)return kw;kw=(async()=>{try{await e.audioWorklet.addModule("/kissofshame/KissOfShame.worklet.js")}catch(t){const e=t instanceof Error?t.message:String(t);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load KissOfShame worklet: ${e}`)}if(!Nw||!ww){const[e,t]=await Promise.all([fetch("/kissofshame/KissOfShame.wasm"),fetch("/kissofshame/KissOfShame.js")]);if(!e.ok||!t.ok)throw kw=null,new Error(`Failed to fetch KissOfShame WASM/JS: wasm=${e.status} js=${t.status}`);Nw=await e.arrayBuffer();let n=await t.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),n+="\nvar createKissOfShameModule = createKissOfShameModule || Module;",ww=n}Ew=!0})();try{await kw}catch(t){throw kw=null,Ew=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setDrive(e){this._options.drive=Math.max(0,Math.min(e,1)),this.sendParam("drive",this._options.drive)}setCharacter(e){this._options.character=Math.max(0,Math.min(e,1)),this.sendParam("character",this._options.character)}setBias(e){this._options.bias=Math.max(0,Math.min(e,1)),this.sendParam("bias",this._options.bias)}setShame(e){this._options.shame=Math.max(0,Math.min(e,1)),this.sendParam("shame",this._options.shame)}setHiss(e){this._options.hiss=Math.max(0,Math.min(e,1)),this.sendParam("hiss",this._options.hiss)}setSpeed(e){this._options.speed=Math.round(e),this.sendParam("speed",this._options.speed)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const Sw=Object.freeze(Object.defineProperty({__proto__:null,TapeSimulatorEffect:Dw},Symbol.toStringTag,{value:"Module"})),Mw={MAMEAstrocade:{synthType:"MAMEAstrocade",name:"Astrocade",subtitle:"Bally Astrocade Custom I/O (1977)",color:"#a855f7",presetCount:8,presetNames:["Clean Square","Vibrato Square","Wide Vibrato","Fast Vibrato","Noise+Tone","Noise Modulated","Arcade Siren","Pure Noise"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vibrato_speed",label:"Vibrato Speed",group:"Vibrato",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Fastest"},{value:1,label:"Fast"},{value:2,label:"Slow"},{value:3,label:"Slowest"}]},{key:"vibrato_depth",label:"Vibrato Depth",group:"Vibrato",type:"knob",min:0,max:63,step:1,default:0,formatValue:"int"},{key:"noise_am",label:"Noise AM",group:"Noise",type:"toggle",min:0,max:1,default:0},{key:"noise_mod",label:"Noise Mod",group:"Noise",type:"toggle",min:0,max:1,default:0},{key:"noise_vol",label:"Noise Volume",group:"Noise",type:"knob",min:0,max:255,step:1,default:0,formatValue:"int"},{key:"master_freq",label:"Master Freq",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMESN76477:{synthType:"MAMESN76477",name:"SN76477",subtitle:"TI Complex Sound Generator (1978)",color:"#ef4444",presetCount:5,presetNames:["UFO","Laser","Explosion","Siren","Engine"],parameters:[{key:"vco_freq",label:"VCO Freq",group:"VCO",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"slf_freq",label:"SLF Freq",group:"SLF",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"noise_freq",label:"Noise Freq",group:"Noise",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"vco_duty_cycle",label:"VCO Duty",group:"VCO",type:"knob",min:.18,max:1,step:.01,default:.5,formatValue:"percent"},{key:"mixer_mode",label:"Mixer Mode",group:"Mixer",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"VCO"},{value:1,label:"SLF"},{value:2,label:"Noise"},{value:3,label:"VCO+Noise"},{value:4,label:"SLF+Noise"},{value:5,label:"SLF+VCO+Noise"},{value:6,label:"SLF+VCO"},{value:7,label:"Inhibit"}]},{key:"envelope_mode",label:"Envelope Mode",group:"Envelope",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"VCO"},{value:1,label:"One-Shot"},{value:2,label:"Mixer Only"},{value:3,label:"VCO Alt"}]},{key:"attack_time",label:"Attack",group:"Envelope",type:"knob",min:.001,max:10,step:.001,default:.1,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"decay_time",label:"Decay",group:"Envelope",type:"knob",min:.001,max:10,step:.001,default:.5,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"one_shot_time",label:"One-Shot",group:"Envelope",type:"knob",min:.001,max:10,step:.001,default:.2,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"noise_filter_freq",label:"Noise Filter",group:"Noise",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"amplitude",label:"Amplitude",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vco_mode",label:"VCO Mode",group:"VCO",type:"select",min:0,max:1,default:0,formatValue:"int",options:[{value:0,label:"External"},{value:1,label:"SLF Modulates"}]},{key:"enable",label:"Enable",group:"Output",type:"toggle",min:0,max:1,default:0}]},MAMEASC:{synthType:"MAMEASC",name:"ASC",subtitle:"Apple Sound Chip (1987)",color:"#10b981",presetCount:8,presetNames:["Sine Pad","Triangle Lead","Saw Bass","Square Retro","Pulse Nasal","Organ","Piano","Strings"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"waveform",label:"Waveform",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Noise"},{value:5,label:"Pulse 25%"},{value:6,label:"Organ"},{value:7,label:"Random"}]},{key:"attack",label:"Attack",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.01,formatValue:"percent"},{key:"decay",label:"Decay",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.3,formatValue:"percent"},{key:"sustain",label:"Sustain",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.7,formatValue:"percent"},{key:"release",label:"Release",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.3,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMEES5503:{synthType:"MAMEES5503",name:"ES5503",subtitle:"Ensoniq DOC 32-Voice Wavetable (1986)",color:"#3b82f6",presetCount:0,romConfig:{requiredZip:"es5503.zip (Ensoniq Mirage wavetable ROM)",bankCount:1,romType:"es5503"},parameters:[{key:"waveform",label:"Waveform",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Noise"},{value:5,label:"Pulse 25%"},{value:6,label:"Pulse 12%"},{value:7,label:"Organ"}]},{key:"wave_size",label:"Wave Size",group:"Oscillator",type:"select",min:0,max:7,default:2,formatValue:"int",options:[{value:0,label:"256"},{value:1,label:"512"},{value:2,label:"1024"},{value:3,label:"2048"},{value:4,label:"4096"},{value:5,label:"8192"},{value:6,label:"16384"},{value:7,label:"32768"}]},{key:"resolution",label:"Resolution",group:"Oscillator",type:"select",min:0,max:7,default:7,formatValue:"int",options:[{value:0,label:"Coarse"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"6"},{value:7,label:"Fine"}]},{key:"osc_mode",label:"Osc Mode",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Free Run"},{value:1,label:"One Shot"},{value:2,label:"Sync/AM"},{value:3,label:"Swap"}]},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"num_oscillators",label:"Oscillators",group:"Oscillator",type:"knob",min:1,max:32,step:1,default:8,formatValue:"int"},{key:"attack_time",label:"Attack",group:"Envelope",type:"knob",min:.001,max:5,step:.001,default:.01,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"release_time",label:"Release",group:"Envelope",type:"knob",min:.001,max:5,step:.001,default:.3,unit:"s",formatValue:"seconds",logarithmic:!0}]},MAMEMEA8000:{synthType:"MAMEMEA8000",name:"MEA8000",subtitle:"Philips MEA8000 LPC Speech Synthesizer",color:"#f59e0b",presetCount:8,presetNames:["AH","EE","IH","OH","OO","AE","UH","ER"],parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"noise_mode",label:"Noise Mode",group:"Excitation",type:"toggle",min:0,max:1,default:0},{key:"f1_index",label:"F1 Index",group:"Formants",type:"knob",min:0,max:7,step:1,default:3,formatValue:"int"},{key:"f2_index",label:"F2 Index",group:"Formants",type:"knob",min:0,max:7,step:1,default:4,formatValue:"int"},{key:"f3_index",label:"F3 Index",group:"Formants",type:"knob",min:0,max:7,step:1,default:5,formatValue:"int"},{key:"bw_index",label:"Bandwidth",group:"Formants",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Wide (726Hz)"},{value:1,label:"Medium (309Hz)"},{value:2,label:"Narrow (125Hz)"},{value:3,label:"V.Narrow (50Hz)"}]},{key:"amplitude",label:"Amplitude",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"interp_time",label:"Interp Time",group:"Formants",type:"knob",min:.1,max:10,step:.1,default:1,unit:"s",formatValue:"seconds",logarithmic:!0}]},MAMEMSM5232:{synthType:"MAMEMSM5232",name:"MSM5232",subtitle:"OKI MSM5232 8-Voice Organ",color:"#8b5cf6",presetCount:8,presetNames:["Full Organ","Flute 8'","Principal 16'","Piccolo","Percussive","Strings","Noise Perc","Bass 16'"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"feet_mix",label:"Feet Mix",group:"Voicing",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"All Feet"},{value:1,label:"8'+16'"},{value:2,label:"8' Only"},{value:3,label:"16' Only"}]},{key:"attack_rate",label:"Attack Rate",group:"Envelope",type:"knob",min:0,max:7,step:1,default:4,formatValue:"int"},{key:"decay_rate",label:"Decay Rate",group:"Envelope",type:"knob",min:0,max:15,step:1,default:8,formatValue:"int"},{key:"noise_enable",label:"Noise",group:"Voicing",type:"toggle",min:0,max:1,default:0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"reverb",label:"Reverb",group:"Output",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"arm_mode",label:"ARM Mode",group:"Voicing",type:"toggle",min:0,max:1,default:0}]},MAMESNKWave:{synthType:"MAMESNKWave",name:"SNK Wave",subtitle:"SNK Programmable Waveform Generator",color:"#06b6d4",presetCount:8,presetNames:["Sine","Sawtooth","Square","Triangle","Pulse 25%","Organ","Buzz","Soft Bell"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"waveform",label:"Waveform",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Pulse 25%"},{value:5,label:"Organ"},{value:6,label:"Buzz"},{value:7,label:"Soft Bell"}]},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMESP0250:{synthType:"MAMESP0250",name:"SP0250",subtitle:"GI SP0250 Digital LPC Speech Synthesizer",color:"#f97316",presetCount:8,presetNames:["AH","EE","IH","OH","OO","NN","ZZ","HH"],parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vowel",label:"Vowel",group:"Formants",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"AH"},{value:1,label:"EE"},{value:2,label:"IH"},{value:3,label:"OH"},{value:4,label:"OO"},{value:5,label:"NN"},{value:6,label:"ZZ"},{value:7,label:"HH"}]},{key:"voiced",label:"Voiced",group:"Excitation",type:"toggle",min:0,max:1,default:1},{key:"brightness",label:"Brightness",group:"Formants",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"filter_mix",label:"Filter Mix",group:"Formants",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMETMS36XX:{synthType:"MAMETMS36XX",name:"TMS36XX",subtitle:"TI TMS36XX Tone Matrix Organ",color:"#84cc16",presetCount:8,presetNames:["Full Organ","Flute 8'","Principal","Mixture","Foundation","Bright","Diapason","Percussive"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"stop_enable",label:"Stop Enable",group:"Voicing",type:"knob",min:0,max:63,step:1,default:63,formatValue:"int"},{key:"decay_rate",label:"Decay Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"octave",label:"Octave",group:"Oscillator",type:"knob",min:-2,max:2,step:1,default:0,formatValue:"int",bipolar:!0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMEVotrax:{synthType:"MAMEVotrax",name:"Votrax SC-01",subtitle:"Votrax SC-01 Formant Speech (64 Phonemes)",color:"#ec4899",presetCount:8,presetNames:["AH","EE","OH","OO","SH","ZH","NG","PA"],parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"phoneme",label:"Phoneme",group:"Speech",type:"knob",min:0,max:63,step:1,default:0,formatValue:"int"},{key:"inflection",label:"Inflection",group:"Speech",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Normal"},{value:1,label:"Rising"},{value:2,label:"Falling"},{value:3,label:"Emphasis"}]},{key:"f1_override",label:"F1 Override",group:"Formants",type:"knob",min:-1,max:15,step:1,default:-1,formatValue:"int"},{key:"f2_override",label:"F2 Override",group:"Formants",type:"knob",min:-1,max:15,step:1,default:-1,formatValue:"int"},{key:"f3_override",label:"F3 Override",group:"Formants",type:"knob",min:-1,max:15,step:1,default:-1,formatValue:"int"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMEYMOPQ:{synthType:"MAMEYMOPQ",name:"YM3806 OPQ",subtitle:"Yamaha YM3806 4-Operator FM Synthesizer",color:"#3b82f6",presetCount:8,presetNames:["E.Piano","Brass","Strings","Bass","Organ","Lead","Pad","Bell"],operatorCount:4,parameters:[{key:"algorithm",label:"Algorithm",group:"FM",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Serial"},{value:1,label:"(1+2)->3->4"},{value:2,label:"(1+(2->3))->4"},{value:3,label:"((1->2)+3)->4"},{value:4,label:"Dual Serial"},{value:5,label:"Branching"},{value:6,label:"(1->2)+3+4"},{value:7,label:"All Carriers"}]},{key:"feedback",label:"Feedback",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_rate",label:"LFO Rate",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_pm_sens",label:"LFO PM Sens",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_am_sens",label:"LFO AM Sens",group:"LFO",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"},{key:"reverb",label:"Reverb",group:"Output",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}],operatorParams:[{key:"total_level",label:"Total Level",group:"Operator",type:"knob",min:0,max:127,step:1,default:0,formatValue:"int"},{key:"attack_rate",label:"Attack Rate",group:"Operator",type:"knob",min:0,max:31,step:1,default:31,formatValue:"int"},{key:"decay_rate",label:"Decay Rate",group:"Operator",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"sustain_rate",label:"Sustain Rate",group:"Operator",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"sustain_level",label:"Sustain Level",group:"Operator",type:"knob",min:0,max:15,step:1,default:0,formatValue:"int"},{key:"release_rate",label:"Release Rate",group:"Operator",type:"knob",min:0,max:15,step:1,default:7,formatValue:"int"},{key:"multiple",label:"Multiple",group:"Operator",type:"knob",min:0,max:15,step:1,default:1,formatValue:"int"},{key:"detune",label:"Detune",group:"Operator",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"waveform",label:"Waveform",group:"Operator",type:"select",min:0,max:1,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Half Sine"}]},{key:"ksr",label:"Key Scale Rate",group:"Operator",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"},{key:"am_enable",label:"AM Enable",group:"Operator",type:"toggle",min:0,max:1,default:0}]},MAMETIA:{synthType:"MAMETIA",name:"TIA",subtitle:"Atari 2600 Television Interface Adaptor",color:"#f59e0b",presetCount:8,presetNames:["Constant","Poly4 Buzz","Div31 Rumble","Poly5+4 Noise","Pure Square","Pure Alt","Div31 Bass","Engine Rumble"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"audc_mode",label:"AUDC Mode",group:"Oscillator",type:"knob",min:0,max:15,step:1,default:4,formatValue:"int"},{key:"audf_fine",label:"Freq Fine",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"poly_reset",label:"Poly Reset",group:"Oscillator",type:"toggle",min:0,max:1,default:0}]},MAMEUPD931:{synthType:"MAMEUPD931",name:"uPD931",subtitle:"NEC uPD931 Casio Keyboard Voice (1981)",color:"#14b8a6",presetCount:8,presetNames:["Organ","Piano","Strings","Brass","Reed","Bell","Bass","Synth Lead"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"wave_a",label:"Wave A",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Pulse 25%"},{value:5,label:"Pulse 12%"},{value:6,label:"Organ"},{value:7,label:"Noise"}]},{key:"wave_b",label:"Wave B",group:"Oscillator",type:"select",min:0,max:7,default:1,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Pulse 25%"},{value:5,label:"Pulse 12%"},{value:6,label:"Organ"},{value:7,label:"Noise"}]},{key:"mirror",label:"Mirror",group:"Oscillator",type:"toggle",min:0,max:1,default:0},{key:"invert",label:"Invert",group:"Oscillator",type:"toggle",min:0,max:1,default:0},{key:"mode_a",label:"Mode A",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Always"},{value:1,label:"Alternating"},{value:2,label:"Attack Only"},{value:3,label:"Sustain Only"}]},{key:"mode_b",label:"Mode B",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Always"},{value:1,label:"Alternating"},{value:2,label:"Attack Only"},{value:3,label:"Sustain Only"}]},{key:"key_scaling",label:"Key Scaling",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMEUPD933:{synthType:"MAMEUPD933",name:"uPD933",subtitle:"NEC uPD933 CZ Phase Distortion Synthesis",color:"#6366f1",presetCount:8,presetNames:["Brass","Strings","E.Piano","Bass","Organ","Pad","Lead","Bell"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"waveform1",label:"Waveform 1",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sawtooth"},{value:1,label:"Square"},{value:2,label:"Pulse"},{value:3,label:"Silent"},{value:4,label:"Double Sine"},{value:5,label:"Saw+Pulse"},{value:6,label:"Resonance"},{value:7,label:"Double Pulse"}]},{key:"waveform2",label:"Waveform 2",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sawtooth"},{value:1,label:"Square"},{value:2,label:"Pulse"},{value:3,label:"Silent"},{value:4,label:"Double Sine"},{value:5,label:"Saw+Pulse"},{value:6,label:"Resonance"},{value:7,label:"Double Pulse"}]},{key:"window",label:"Window",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"None"},{value:1,label:"Half"},{value:2,label:"Rise"},{value:3,label:"Fall"}]},{key:"dcw_depth",label:"DCW Depth",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"dca_rate",label:"DCA Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"dcw_rate",label:"DCW Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"dco_rate",label:"DCO Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"dco_depth",label:"DCO Depth",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"ring_mod",label:"Ring Mod",group:"Oscillator",type:"toggle",min:0,max:1,default:0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMETMS5220:{synthType:"MAMETMS5220",name:"TMS5220",subtitle:"TI TMS5220 LPC Speech (Speak & Spell)",color:"#d946ef",presetCount:8,presetNames:["AH","EE","IH","OH","OO","AE","UH","SH"],romConfig:{requiredZip:".vsm files (TI Speak & Spell speech ROM)",bankCount:2,romType:"tms5220"},parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"chirp_type",label:"Chirp Type",group:"Excitation",type:"select",min:0,max:2,default:0,formatValue:"int",options:[{value:0,label:"TMS5220"},{value:1,label:"TMS5200"},{value:2,label:"TI99"}]},{key:"k1_index",label:"K1 Index",group:"Formants",type:"knob",min:0,max:31,step:1,default:15,formatValue:"int"},{key:"k2_index",label:"K2 Index",group:"Formants",type:"knob",min:0,max:31,step:1,default:15,formatValue:"int"},{key:"k3_index",label:"K3 Index",group:"Formants",type:"knob",min:0,max:31,step:1,default:15,formatValue:"int"},{key:"energy_index",label:"Energy",group:"Excitation",type:"knob",min:0,max:15,step:1,default:10,formatValue:"int"},{key:"pitch_index",label:"Pitch",group:"Excitation",type:"knob",min:0,max:63,step:1,default:32,formatValue:"int"},{key:"noise_mode",label:"Noise Mode",group:"Excitation",type:"toggle",min:0,max:1,default:0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"brightness",label:"Brightness",group:"Formants",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMEYMF271:{synthType:"MAMEYMF271",name:"YMF271 OPX",subtitle:"Yamaha OPX 4-Operator FM+PCM Synthesizer",color:"#2563eb",presetCount:8,presetNames:["E.Piano","Brass","Strings","Bass","Organ","Lead","Pad","Bell"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"algorithm",label:"Algorithm",group:"FM",type:"knob",min:0,max:15,step:1,default:0,formatValue:"int"},{key:"feedback",label:"Feedback",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"waveform",label:"Waveform",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"tl",label:"Total Level",group:"Operator",type:"knob",min:0,max:127,step:1,default:0,formatValue:"int"},{key:"ar",label:"Attack Rate",group:"Envelope",type:"knob",min:0,max:31,step:1,default:31,formatValue:"int"},{key:"d1r",label:"Decay 1 Rate",group:"Envelope",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"d2r",label:"Decay 2 Rate",group:"Envelope",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"rr",label:"Release Rate",group:"Envelope",type:"knob",min:0,max:15,step:1,default:7,formatValue:"int"},{key:"d1l",label:"Decay 1 Level",group:"Envelope",type:"knob",min:0,max:15,step:1,default:0,formatValue:"int"},{key:"multiple",label:"Multiple",group:"FM",type:"knob",min:0,max:15,step:1,default:1,formatValue:"int"},{key:"detune",label:"Detune",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_freq",label:"LFO Freq",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_wave",label:"LFO Wave",group:"LFO",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"},{key:"pms",label:"Pitch Mod Sens",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"ams",label:"Amp Mod Sens",group:"LFO",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"}]},MAMETR707:{synthType:"MAMETR707",name:"TR-707",subtitle:"Roland TR-707 Drum Machine (1984)",color:"#dc2626",presetCount:0,romConfig:{requiredZip:"tr707.zip (Roland TR-707 voice ROMs)",bankCount:3,romType:"tr707"},parameters:[{key:"volume",label:"Volume",group:"Master",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"bass",label:"Bass",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"snare",label:"Snare",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"low_tom",label:"Low Tom",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"mid_tom",label:"Mid Tom",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"hi_tom",label:"Hi Tom",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"rimshot",label:"Rimshot",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"handclap",label:"Handclap",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"hihat",label:"Hi-Hat",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"crash",label:"Crash",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"ride",label:"Ride",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"accent",label:"Accent",group:"Master",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"decay",label:"Decay",group:"Master",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMEVASynth:{synthType:"MAMEVASynth",name:"VA Synth",subtitle:"Virtual Analog Subtractive Synthesizer",color:"#7c3aed",presetCount:8,presetNames:["Bass","Lead","Pad","Brass","Strings","Pluck","Keys","FX"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"osc1_wave",label:"Osc 1 Wave",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Saw"},{value:1,label:"Square"},{value:2,label:"Triangle"},{value:3,label:"Noise"}]},{key:"osc2_wave",label:"Osc 2 Wave",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Saw"},{value:1,label:"Square"},{value:2,label:"Triangle"},{value:3,label:"Noise"}]},{key:"osc_mix",label:"Osc Mix",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"osc2_detune",label:"Osc 2 Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"filter_cutoff",label:"Filter Cutoff",group:"Filter",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"filter_res",label:"Filter Res",group:"Filter",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"filter_env_depth",label:"Filter Env",group:"Filter",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},CEM3394:{synthType:"CEM3394",name:"CEM3394",subtitle:"Curtis Electromusic Analog Synth Voice (1984)",color:"#f43f5e",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vco_frequency",label:"VCO Freq",group:"VCO",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"modulation",label:"Modulation",group:"VCO",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"wave_select",label:"Wave Select",group:"VCO",type:"knob",min:0,max:7,step:1,default:2,formatValue:"int"},{key:"pulse_width",label:"Pulse Width",group:"VCO",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"mixer_balance",label:"Mixer Balance",group:"Mixer",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"resonance",label:"Resonance",group:"Filter",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"cutoff",label:"Cutoff",group:"Filter",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},SCSP:{synthType:"SCSP",name:"SCSP",subtitle:"Sega Saturn YMF292-F Sound Processor",color:"#475569",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMEAICA:{synthType:"MAMEAICA",name:"AICA",subtitle:"Sega Dreamcast Sound Processor",color:"#0ea5e9",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMEICS2115:{synthType:"MAMEICS2115",name:"ICS2115",subtitle:"ICS WaveFront 32-Voice Synthesizer",color:"#64748b",presetCount:0,romConfig:{requiredZip:"ics2115.zip (ICS WaveFront wavetable ROM)",bankCount:1,romType:"ics2115"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"active_osc",label:"Active Voices",group:"Oscillator",type:"knob",min:1,max:32,step:1,default:8,formatValue:"int"}]},MAMEK054539:{synthType:"MAMEK054539",name:"K054539",subtitle:"Konami K054539 PCM/ADPCM (8-Channel)",color:"#78716c",presetCount:0,romConfig:{requiredZip:"k054539.zip (Konami PCM sample ROM)",bankCount:1,romType:"k054539"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"reverb_enable",label:"Reverb",group:"Effects",type:"toggle",min:0,max:1,default:0}]},MAMEC352:{synthType:"MAMEC352",name:"C352",subtitle:"Namco C352 32-Voice PCM",color:"#94a3b8",presetCount:0,romConfig:{requiredZip:"c352.zip (Namco C352 sample ROM)",bankCount:1,romType:"c352"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMERF5C400:{synthType:"MAMERF5C400",name:"RF5C400",subtitle:"Ricoh RF5C400 32-Voice PCM",color:"#6b7280",presetCount:0,romConfig:{requiredZip:"rf5c400.zip (Ricoh RF5C400 sample ROM)",bankCount:1,romType:"rf5c400"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},CZ101:{synthType:"CZ101",name:"CZ-101",subtitle:"Casio Phase Distortion Synthesizer (1984)",color:"#8b5cf6",presetCount:4,presetNames:["Brass 1","E.Piano","Synth Bass","Pad"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMERSA:{synthType:"MAMERSA",name:"Roland D-50",subtitle:"Roland SA Linear Arithmetic (requires ROM)",color:"#6b7280",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}],romConfig:{requiredZip:"mks20.zip (Roland D-50 / MKS-20 ROMs: IC5, IC6, IC7)",bankCount:3,romType:"rsa"}},MAMESWP30:{synthType:"MAMESWP30",name:"Yamaha MU-2000",subtitle:"SWP30 Wavetable (requires ROM)",color:"#6b7280",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}],romConfig:{requiredZip:"mu100.zip (Yamaha MU-100/MU-2000 wave ROM)",bankCount:1,romType:"swp30"}}};function Cw(e){return e in Mw}function Vw(e){return Mw[e]}const Pw=i(e=>({pendingRomRequest:null,showRomDialog:t=>{e({pendingRomRequest:t})},dismissRomDialog:()=>{e({pendingRomRequest:null})}}));class _w{workletNode=null;enabled=!1;initialized=!1;connectedNativeSource=null;connectedNativeDest=null;async init(){if(!this.initialized)try{const e=ro(N());await e.audioWorklet.addModule("/blep/blep-processor.worklet.js"),this.workletNode=new AudioWorkletNode(e,"blep-processor",{numberOfInputs:1,numberOfOutputs:1,channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"}),this.initialized=!0}catch(e){throw e}}connect(e,t){if(this.disconnectNative(),!this.workletNode||!this.initialized||!this.enabled){try{e.connect(t)}catch{}return}const n=co(e),s=co(t);if(n&&s)try{n.connect(this.workletNode),this.workletNode.connect(s),this.connectedNativeSource=n,this.connectedNativeDest=s}catch(a){this.disconnectNative();try{e.connect(t)}catch{}}else try{e.connect(t)}catch{}}disconnectNative(){if(this.workletNode){if(this.connectedNativeSource){try{this.connectedNativeSource.disconnect(this.workletNode)}catch{}this.connectedNativeSource=null}if(this.connectedNativeDest){try{this.workletNode.disconnect(this.connectedNativeDest)}catch{}this.connectedNativeDest=null}}}setEnabled(e){e!==this.enabled&&(this.enabled=e,this.workletNode&&this.workletNode.port.postMessage({type:"setEnabled",value:e}))}reset(){this.workletNode&&this.workletNode.port.postMessage({type:"reset"})}getNode(){return this.workletNode}isInitialized(){return this.initialized}isEnabled(){return this.enabled}dispose(){this.disconnectNative(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.initialized=!1,this.enabled=!1}}class Ow{baseChannel;maxVoices;activeVoices=new Map;freeVoices=[];constructor(e,t){this.baseChannel=e,this.maxVoices=t,this.freeVoices=Array.from({length:t},(t,n)=>e+n)}allocate(e,t,n){if(this.freeVoices.length>0){const s=this.freeVoices.pop();return this.activeVoices.set(s,{channelIndex:s,note:e,instrumentId:t,startTime:Date.now(),velocity:n,priority:this.calculatePriority(n,!1),isReleasing:!1}),s}const s=this.findStealableVoice();this.activeVoices.get(s);return this.activeVoices.set(s,{channelIndex:s,note:e,instrumentId:t,startTime:Date.now(),velocity:n,priority:this.calculatePriority(n,!1),isReleasing:!1}),s}findStealableVoice(){let e=1/0,t=-1;for(const[n,s]of this.activeVoices)s.priority<e&&(e=s.priority,t=n);return t}calculatePriority(e,t){let n=e;return t&&(n-=50),Math.max(0,Math.min(100,n))}markReleasing(e){const t=this.activeVoices.get(e);t&&(t.isReleasing=!0,t.priority=this.calculatePriority(t.velocity,!0))}free(e){this.activeVoices.delete(e),this.freeVoices.push(e)}getVoiceState(e){return this.activeVoices.get(e)}getAllActiveVoices(){return Array.from(this.activeVoices.values())}getStats(){return{activeVoices:this.activeVoices.size,freeVoices:this.freeVoices.length,maxVoices:this.maxVoices,utilizationPercent:this.activeVoices.size/this.maxVoices*100}}reset(){this.activeVoices.clear(),this.freeVoices=Array.from({length:this.maxVoices},(e,t)=>this.baseChannel+t)}}const Tw=new Map;function Lw(e){let t=Tw.get(e);return void 0===t&&(t=le(e).toFrequency(),Tw.set(e,t)),t}class Aw{static instance=null;static itFilterWorkletLoaded=!1;static itFilterWorkletPromise=null;masterInput;synthBus;masterEffectsInput;blepInput;masterChannel;analyser;fft;analysersConnected=!1;autoGainEnabled=!1;autoGainLoopId=null;sampleLevelAnalyser=null;synthLevelAnalyser=null;autoGainSampleCorr=0;autoGainSynthCorr=0;_manualSampleGainDb=0;_manualSynthGainDb=0;_nativeContext=null;blepManager=new _w;wasmInstance=null;globalPlaybackRate=1;globalDetuneCents=0;instruments;instrumentSynthTypes=new Map;instrumentLoadingPromises=new Map;decodedAudioBuffers=new Map;liveVoiceAllocation=new Map;voiceAllocator;static LIVE_VOICE_BASE_CHANNEL=100;static MAX_LIVE_VOICES=16;activeVoices=new Map;masterEffectsNodes=[];masterEffectConfigs=new Map;masterEffectsRebuildVersion=0;masterEffectAnalysers=new Map;_isPlaying=!1;nativeEngineRouting=new Map;channelOutputs=new Map;channelMuteStates=new Map;channelPitchState=new Map;channelActivePlayer=new Map;slicePlayersMap=new Map;channelLastNote=new Map;static SLIDE_TIME_CONSTANT=.06;static ACCENT_BOOST=1.35;static MIDI_FREQ_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=440*Math.pow(2,(t-69)/12);return e})();static FILTER_CUTOFF_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=100*Math.pow(100,t/127);return e})();static PITCH_CENTS_CACHE=new Map;metronomeSynth=null;metronomeVolume=null;metronomeEnabled=!1;metronomePart=null;amigaFilter;amigaFilterEnabled=!0;instrumentEffectChains=new Map;instrumentEffectNodes=new Map;instrumentAnalysers=new Map;instrumentOutputOverrides=new Map;releaseRestoreTimeouts=new Map;preloadGeneration=0;constructor(){this._nativeContext=new AudioContext({latencyHint:"interactive"}),fe(this._nativeContext),ao(this._nativeContext),this.masterInput=new m(1),this.amigaFilter=new hw,this.masterChannel=new ge({volume:-6,pan:0}).toDestination(),this.analyser=new pe("waveform",1024),this.fft=new he(1024),this.masterEffectsInput=new m(1),this.blepInput=new m(1),this.masterInput.connect(this.amigaFilter),this.amigaFilter.connect(this.masterEffectsInput),this.masterEffectsInput.connect(this.blepInput),this.blepInput.connect(this.masterChannel),this.synthBus=new m(1),this.synthBus.connect(this.masterEffectsInput),this.instruments=new Map,this.voiceAllocator=new Ow(Aw.LIVE_VOICE_BASE_CHANNEL,Aw.MAX_LIVE_VOICES)}static getInstance(){return Aw.instance||(Aw.instance=new Aw,window._toneEngine=Aw.instance),Aw.instance}get nativeContext(){return this._nativeContext}connectNativeSynth(e,t){const n=co(t);if(n){if(e.context!==n.context)return;try{e.connect(n)}catch(s){}}else{const n=t;if(n.input)try{e.connect(n.input)}catch(s){}}}routeNativeEngineOutput(e){const t=co(this.synthBus);if(!t)return;let n,s=null;if(e instanceof pc){n="FurnaceChipEngine";const e=ac.getInstance();if(!e.isInitialized())return;s=e.getNativeOutput()}else if(e instanceof Lc){n="FurnaceDispatchEngine";const e=wc.getInstance();if(!e.isInitialized)return;s=e.getOrCreateSharedGain()}else{if(!("output"in e&&e.output instanceof GainNode))return;n=e.name||"NativeWASM",s=e.output}if(!s)return;let a=this.nativeEngineRouting.get(n);a?a.gain!==s&&(a.destinations.forEach(e=>{try{a.gain.disconnect(e)}catch{}}),a.gain=s,a.destinations.clear()):(a={gain:s,destinations:new Set},this.nativeEngineRouting.set(n,a)),0===a.destinations.size&&(s.connect(t),a.destinations.add(t))}rerouteNativeEngine(e,t){const n=this.nativeEngineRouting.get(e);if(n?.gain){for(const e of n.destinations)try{n.gain.disconnect(e)}catch{}n.destinations.clear(),n.gain.connect(t),n.destinations.add(t)}}restoreNativeEngineRouting(e){const t=this.nativeEngineRouting.get(e);if(!t?.gain)return;const n=co(this.synthBus);if(n&&(!t.destinations.has(n)||1!==t.destinations.size)){for(const e of t.destinations)try{t.gain.disconnect(e)}catch{}t.destinations.clear(),t.gain.connect(n),t.destinations.add(n)}}async stopNativeEngine(e){if("UADESynth"===e){const{UADEEngine:e}=await os(async()=>{const{UADEEngine:e}=await Promise.resolve().then(()=>Si);return{UADEEngine:e}},void 0);e.hasInstance()&&e.getInstance().stop()}else if("HivelySynth"===e){const{HivelyEngine:e}=await os(async()=>{const{HivelyEngine:e}=await Promise.resolve().then(()=>$r);return{HivelyEngine:e}},void 0);e.hasInstance()&&e.getInstance().stop()}else if("SymphonieSynth"===e){const{SymphonieEngine:e}=await os(async()=>{const{SymphonieEngine:e}=await Promise.resolve().then(()=>xi);return{SymphonieEngine:e}},void 0);e.hasInstance()&&e.getInstance().stop()}else if("MusicLineSynth"===e){const{MusicLineEngine:e}=await os(async()=>{const{MusicLineEngine:e}=await Promise.resolve().then(()=>qk);return{MusicLineEngine:e}},void 0);e.hasInstance()&&e.getInstance().stop()}}async decodeAudioData(e){if(e instanceof AudioBuffer)return e;if(e instanceof Uint8Array){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return await N().rawContext.decodeAudioData(t)}if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer type: "+typeof e);return await N().rawContext.decodeAudioData(e.slice(0))}async encodeAudioData(e){return e.getChannelData(0).buffer.slice(0)}getDecodedBuffer(e){return this.decodedAudioBuffers.get(e)}async awaitPendingLoads(e=5e3){const t=Array.from(this.instrumentLoadingPromises.values());if(0!==t.length)try{await Promise.race([Promise.all(t),new Promise(t=>setTimeout(t,e))])}catch{}}getWasmInstance(){return this.wasmInstance}async init(){const e=this._nativeContext;"suspended"!==N().state&&"running"===e.state||(await A(),"running"!==e.state&&await e.resume().catch(()=>{})),N().lookAhead=.01,k().bpm.value=125,"running"!==e.state&&await new Promise(t=>{const n=()=>{"running"===e.state?t():setTimeout(n,10)};n()});let t=null;const n=async()=>{if(t)return t;const e=await fetch("/DevilboxDSP.wasm");if(e.ok){t=await e.arrayBuffer();try{const e={env:{abort:()=>{}}},{instance:n}=await WebAssembly.instantiate(t,e);this.wasmInstance=n.exports,this.wasmInstance.init&&this.wasmInstance.init()}catch(n){}return t}return null};Aw.itFilterWorkletLoaded||(Aw.itFilterWorkletPromise||(Aw.itFilterWorkletPromise=(async()=>{try{const t="/";await e.audioWorklet.addModule(`${t}ITFilter.worklet.js`);const s=await n();if(s){const t=new AudioWorkletNode(e,"it-filter-processor");t.port.postMessage({type:"init",wasmBinary:s}),t.disconnect()}Aw.itFilterWorkletLoaded=!0}catch(t){const e=t instanceof Error?t.message:"";e.includes("already")||e.includes("duplicate")||(Aw.itFilterWorkletPromise=null)}})()),await Aw.itFilterWorkletPromise);try{const e=ac.getInstance();await e.init(N())}catch(s){}this.blepManager.init().then(()=>{this.reconnectBlepChain()}).catch(e=>{})}reconnectBlepChain(){try{this.blepInput.disconnect(this.masterChannel)}catch{}this.blepManager.connect(this.blepInput,this.masterChannel)}setBlepEnabled(e){this.blepManager.setEnabled(e),this.blepManager.isInitialized()&&this.reconnectBlepChain()}isBlepEnabled(){return this.blepManager.isEnabled()}getContextState(){return N().state}isContextActuallyRunning(){return"running"===N().state&&"running"===(this._nativeContext?.state??"suspended")}syncResume(){"running"!==this._nativeContext?.state&&this._nativeContext?.resume().catch(()=>{})}async preloadInstruments(e){const t=++this.preloadGeneration,n=e.map(e=>qN.ensure(e.synthType)).filter(Boolean);if(n.length>0&&(await Promise.all(n),t!==this.preloadGeneration))return;e.forEach(e=>{const t=this.getInstrumentKey(e.id,-1);this.instruments.has(t)&&this.disposeInstrument(e.id)});const s=e.filter(e=>"Sampler"===e.synthType||"Player"===e.synthType),a=e.filter(e=>"Sam"===e.synthType||"V2"===e.synthType&&e.v2Speech);e.filter(e=>"Sampler"!==e.synthType&&"Player"!==e.synthType&&"Sam"!==e.synthType&&!("V2"===e.synthType&&e.v2Speech)).forEach(e=>{this.getInstrument(e.id,e)}),s.forEach(e=>{this.getInstrument(e.id,e)});const o=[];if(a.forEach(e=>{const t=this.getInstrument(e.id,e);t?.ready&&o.push(t.ready())}),s.length>0)try{if(await be(),t!==this.preloadGeneration)return;const e=Array.from(this.instrumentLoadingPromises.values());if(e.length>0&&(await Promise.all(e),t!==this.preloadGeneration))return}catch(c){}if(o.length>0)try{if(await Promise.all(o),t!==this.preloadGeneration)return}catch(c){}const r=[];for(const u of e){const e=this.getInstrumentKey(u.id,-1),t=this.instruments.get(e);t&&"function"==typeof t.ensureInitialized&&r.push(t.ensureInitialized())}if(r.length>0)try{if(await Promise.all(r),t!==this.preloadGeneration)return}catch(c){}const i=["MetalSynth","MembraneSynth","NoiseSynth","FMSynth"];for(const u of e)if(i.includes(u.synthType||"")){const e=this.getInstrumentKey(u.id,-1),t=this.instruments.get(e);if(t&&!eo(t))try{const e=t,n=e.volume.value;e.volume.value=-1/0,"NoiseSynth"===u.synthType||"MetalSynth"===u.synthType?t.triggerAttackRelease(.001,Y()):"MembraneSynth"===u.synthType?t.triggerAttackRelease("C2",.001,Y()):e.triggerAttackRelease?.("C4",.001,Y()),e.volume.value=n}catch{}}const l=e.filter(e=>{const t=Mw[e.synthType||""];return t?.romConfig});if(l.length>0){const{useInstrumentStore:e}=await os(async()=>{const{useInstrumentStore:e}=await Promise.resolve().then(()=>kN);return{useInstrumentStore:e}},void 0),t=e.getState();for(const n of l){const e=this.getInstrumentKey(n.id,-1),s=this.instruments.get(e),a=Mw[n.synthType||""];if(!s||!a?.romConfig)continue;const o=!0===s.romLoaded,r=t.instruments.find(e=>e.id===n.id);if(r&&t.updateInstrument(n.id,{parameters:{...r.parameters,_romsLoaded:o?1:0}}),!o){Pw.getState().showRomDialog({instrumentId:n.id,synthType:n.synthType||"",chipName:a.name,requiredZip:a.romConfig.requiredZip,bankCount:a.romConfig.bankCount});break}}}}async ensureWASMSynthsReady(e){const t=e.filter(e=>["TB303","Buzz3o3","V2","Sam","Synare","DubSiren","SpaceLaser","Dexed","OBXd","Furnace","HivelySynth","UADESynth","SymphonieSynth","MusicLineSynth","SoundMonSynth","SidMonSynth","DigMugSynth","FCSynth","FredSynth","TFMXSynth","OctaMEDSynth","SidMon1Synth","HippelCoSoSynth","RobHubbardSynth","DavidWhittakerSynth","SunVoxSynth"].includes(e.synthType||"")||e.synthType?.startsWith("Furnace"));if(0===t.length)return;const n=new Set,s=t.filter(e=>{if("HivelySynth"===e.synthType||"UADESynth"===e.synthType||"SymphonieSynth"===e.synthType||"MusicLineSynth"===e.synthType){if(n.has(e.synthType))return!1;n.add(e.synthType)}return!0}),a=[];for(const o of s){const e=this.getInstrument(o.id,o);e?.ensureInitialized&&a.push(e.ensureInitialized())}a.length>0&&await Promise.all(a)}async ensureInstrumentReady(e){const t=this.getInstrument(e.id,e);t&&"function"==typeof t.ensureInitialized&&await t.ensureInitialized()}setMasterVolume(e){this.masterChannel.volume.value=e}setSampleBusGain(e){this._manualSampleGainDb=e,this._applyBusGains()}setSynthBusGain(e){this._manualSynthGainDb=e,this._applyBusGains()}_applyBusGains(){const e=this._manualSampleGainDb+this.autoGainSampleCorr,t=this._manualSynthGainDb+this.autoGainSynthCorr;this.masterInput.gain.value=Math.pow(10,e/20),this.synthBus.gain.value=Math.pow(10,t/20)}setAutoGain(e){this.autoGainEnabled=e,e?(this._ensureAutoGainAnalysers(),this._startAutoGainLoop()):(this._stopAutoGainLoop(),this.autoGainSampleCorr=0,this.autoGainSynthCorr=0,this._applyBusGains())}getAutoGain(){return this.autoGainEnabled}getAutoGainCorrections(){return{sample:this.autoGainSampleCorr,synth:this.autoGainSynthCorr}}_ensureAutoGainAnalysers(){if(this.sampleLevelAnalyser&&this.synthLevelAnalyser)return;const e=N().rawContext;if(!this.sampleLevelAnalyser){const t=e.createAnalyser();t.fftSize=2048,t.smoothingTimeConstant=0,co(this.masterInput).connect(t),this.sampleLevelAnalyser=t}if(!this.synthLevelAnalyser){const t=e.createAnalyser();t.fftSize=2048,t.smoothingTimeConstant=0,co(this.synthBus).connect(t),this.synthLevelAnalyser=t}}_computeRmsDb(e){let t=0;for(let s=0;s<e.length;s++)t+=e[s]*e[s];const n=Math.sqrt(t/e.length);return n<1e-10?-120:20*Math.log10(n)}_startAutoGainLoop(){if(null!==this.autoGainLoopId)return;const e=new Float32Array(2048);this.autoGainLoopId=setInterval(()=>{if(!this.sampleLevelAnalyser||!this.synthLevelAnalyser)return;this.sampleLevelAnalyser.getFloatTimeDomainData(e);const t=this._computeRmsDb(e);this.synthLevelAnalyser.getFloatTimeDomainData(e);const n=this._computeRmsDb(e);if(t<-50||n<-50)return;const s=t-n;this.autoGainSampleCorr-=.2*s*.5,this.autoGainSynthCorr+=.2*s*.5,this.autoGainSampleCorr=Math.max(-12,Math.min(12,this.autoGainSampleCorr)),this.autoGainSynthCorr=Math.max(-12,Math.min(12,this.autoGainSynthCorr)),this._applyBusGains()},100)}_stopAutoGainLoop(){null!==this.autoGainLoopId&&(clearInterval(this.autoGainLoopId),this.autoGainLoopId=null)}setMasterMute(e){this.masterChannel.mute=e}setAmigaFilter(e){this.amigaFilterEnabled=e,this.amigaFilter.ledFilterEnabled=e}getAmigaFilterEnabled(){return this.amigaFilterEnabled}processInstrumentTicks(e=Y()){this.instruments.forEach(t=>{t&&"function"==typeof t.processTick&&t.processTick(e)})}setBPM(e){const t=k();"started"===t.state?t.bpm.rampTo(e,.02):t.bpm.value=e,this.updateBpmSyncedEffects(e)}getBPM(){return k().bpm.value}setGlobalPlaybackRate(e){this.globalPlaybackRate=e}getGlobalPlaybackRate(){return this.globalPlaybackRate}setGlobalDetune(e){this.globalDetuneCents=e,this.applyGlobalDetuneToActiveVoices()}getGlobalDetune(){return this.globalDetuneCents}applyGlobalDetuneToActiveVoices(){this.activeVoices.forEach(e=>{for(const t of e){const e=t.instrument;if(eo(e)||void 0===e.detune?.value||(e.detune.value=this.globalDetuneCents),e.set&&e._voices)try{e.set({detune:this.globalDetuneCents})}catch{}}})}async start(){"suspended"===N().state&&await A(),this._isPlaying=!0,this._notifyNoiseEffectsPlaying(!0),k().start()}stop(){this.releaseAll(),this._isPlaying=!1,this._notifyNoiseEffectsPlaying(!1),this.clearChannelTriggerLevels();const e=this.masterChannel.volume.value;this.masterChannel.volume.value=-1/0,setTimeout(()=>{this.masterChannel.volume.value=e},50),k().stop()}_notifyNoiseEffectsPlaying(e){this.masterEffectConfigs.forEach(({node:t})=>{(t instanceof Xl||t instanceof yw)&&t.setPlaying(e)})}pause(){k().pause()}getPosition(){return k().position}setPosition(e){k().position=e}getInstrumentKey(e,t){return e<<16|65535&(t??-1)}instrumentIdFromKey(e){return e>>>16}getInstrumentOutputDestination(e,t){const n=this.instrumentOutputOverrides.get(e);return n||(t?this.synthBus:this.masterInput)}lastTriggerTime=0;getSafeTime(e){if(!this.isContextActuallyRunning()){ve.state,this._nativeContext;return null}const t=null==e||isNaN(e)||e<=0?ye():Y();let n;return n=null!=e&&!isNaN(e)&&e>0?e:t+.001,n<=this.lastTriggerTime&&(n=this.lastTriggerTime+5e-4),this.lastTriggerTime=n,n}getImmediateTime(){let e=ye();return e<=this.lastTriggerTime&&(e=this.lastTriggerTime+1e-4),this.lastTriggerTime=e,e}getInstrument(e,t,n){const s=t.synthType?.startsWith("MAME")||"CZ101"===t.synthType||"CEM3394"===t.synthType||"SCSP"===t.synthType,a=t.synthType?.startsWith("Furnace")||"Furnace"===t.synthType,o=t.synthType?.startsWith("Buzz")||"Buzzmachine"===t.synthType,r=["TB303","V2","Sam","DubSiren","SpaceLaser","Synare","Dexed","OBXd","WAM"].includes(t.synthType||""),i=!r&&"string"==typeof t.synthType&&Dy.has(t.synthType),l="Sampler"===t.synthType||"Player"===t.synthType||"SunVoxSynth"===t.synthType||s||a||o||r||i,c=l?this.getInstrumentKey(e,-1):this.getInstrumentKey(e,n);if(t.synthType,this.instruments.has(c)){const e=this.instruments.get(c),n=this.instrumentSynthTypes.get(c);if(!t.synthType||!n||n===t.synthType||"Player"===n)return e??null;this.disposeInstrumentByKey(c)}const u=void 0!==n&&n>=Aw.LIVE_VOICE_BASE_CHANNEL,d=this.getInstrumentKey(e,-1);if(!l&&!u&&this.instruments.has(d)){const e=this.instrumentSynthTypes.get(d);if(!t.synthType||!e||e===t.synthType)return this.instruments.get(d)??null;this.disposeInstrumentByKey(d)}let m=null;switch(t.synthType){case"Synth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;m=new K({voice:$,maxPolyphony:e,options:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break}case"MonoSynth":m=new J({oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume||-12});break;case"DuoSynth":m=new Q({voice0:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},vibratoAmount:t.oscillator?.detune?t.oscillator.detune/100:.5,vibratoRate:5,volume:t.volume||-12});break;case"FMSynth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?6:3;m=new K({voice:_,maxPolyphony:e,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},modulationIndex:10},volume:t.volume||-12});break}case"AMSynth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;m=new K({voice:Z,maxPolyphony:e,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break}case"PluckSynth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;m=new K({voice:ee,maxPolyphony:e,options:{attackNoise:1,dampening:t.filter?.frequency||4e3,resonance:.7},volume:t.volume||-12});break}case"MetalSynth":m=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??100)/1e3,sustain:0,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"MembraneSynth":m=new $({oscillator:{type:"sine"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??400)/1e3,sustain:.01,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"NoiseSynth":{const e=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume??-12});if(t.filter&&"lowpass"!==t.filter.type){const n=new h({type:t.filter.type,frequency:t.filter.frequency,Q:t.filter.Q||1,rolloff:t.filter.rolloff||-12});e.connect(n),m={triggerAttackRelease:(t,n,s)=>{e.triggerAttackRelease(t,n,s)},triggerAttack:(t,n,s)=>{e.triggerAttack(n,s)},triggerRelease:t=>{e.triggerRelease(t)},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{e.dispose(),n.dispose()},volume:e.volume}}else m=e;break}case"TB303":case"SuperSaw":case"PolySynth":case"Organ":case"DrumMachine":case"ChipSynth":case"PWMSynth":case"StringMachine":case"FormantSynth":case"Wavetable":case"WobbleBass":case"Furnace":case"FurnaceOPN":case"FurnaceOPM":case"FurnaceOPL":case"FurnaceOPLL":case"FurnaceOPZ":case"FurnaceOPNA":case"FurnaceOPNB":case"FurnaceOPL4":case"FurnaceY8950":case"FurnaceESFM":case"FurnaceNES":case"FurnaceGB":case"FurnacePSG":case"FurnacePCE":case"FurnaceSNES":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceVRC7":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceSCC":case"FurnaceX1_010":case"FurnaceBUBBLE":case"FurnaceTIA":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":case"FurnaceOPN2203":case"FurnaceOPNBB":case"FurnaceAY8930":case"FurnaceNDS":case"FurnaceGBA":case"FurnacePOKEMINI":case"FurnaceNAMCO":case"FurnacePET":case"FurnacePOKEY":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceAMIGA":case"FurnacePCSPKR":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceZXBEEPER":case"FurnaceSCVTONE":case"FurnacePCMDAC":case"DrumKit":case"ChiptuneModule":case"Dexed":case"OBXd":case"MAMEVFX":case"MAMEDOC":case"MAMERSA":case"MAMESWP30":case"CZ101":case"CEM3394":case"SCSP":case"MAMEAICA":case"MAMEASC":case"MAMEAstrocade":case"MAMEC352":case"MAMEES5503":case"MAMEICS2115":case"MAMEK054539":case"MAMEMEA8000":case"MAMEMSM5232":case"MAMERF5C400":case"MAMESN76477":case"MAMESNKWave":case"MAMESP0250":case"MAMETIA":case"MAMETMS36XX":case"MAMETMS5220":case"MAMETR707":case"MAMEUPD931":case"MAMEUPD933":case"MAMEVotrax":case"MAMEYMF271":case"MAMEYMOPQ":case"MAMEVASynth":case"BuzzDTMF":case"BuzzFreqBomb":case"BuzzKick":case"BuzzKickXP":case"BuzzNoise":case"BuzzTrilok":case"Buzz4FM2F":case"BuzzDynamite6":case"BuzzM3":case"Buzz3o3":case"DubSiren":case"SpaceLaser":case"V2":case"V2Speech":case"Sam":case"Synare":case"WAM":case"Buzzmachine":case"HivelySynth":case"UADESynth":case"SymphonieSynth":case"MusicLineSynth":case"SoundMonSynth":case"SidMonSynth":case"DigMugSynth":case"FCSynth":case"FredSynth":case"TFMXSynth":case"OctaMEDSynth":case"SidMon1Synth":case"HippelCoSoSynth":case"RobHubbardSynth":case"DavidWhittakerSynth":case"SunVoxSynth":m=JN.createInstrument(t);break;case"Sampler":{let n=t.sample?.url||t.parameters?.sampleUrl;const s=t.sample?.baseNote||"C4",a=!0===t.sample?.loop,o=t.sample?.loopStart||0,r=t.sample?.loopEnd||0,i=t.sample?.audioBuffer;n&&n.startsWith("blob:")&&(n=void 0),n&&(n=ms(n));const l=i instanceof ArrayBuffer||i instanceof Uint8Array||"string"==typeof i;if(i&&l){let n=i;if("string"==typeof i)try{const e=atob(i),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);n=t.buffer}catch{n=null}if(n){const i=t.metadata?.modPlayback?.usePeriodPlayback;if(i||a){m=new re({loop:a,volume:t.volume||0}),this.instrumentSynthTypes.set(c,"Player");const s=n,i=m,l=(async()=>{try{const n=await this.decodeAudioData(s);if(i.buffer=new xe(n),a){const e=t.sample?.sampleRate||8363,s=n.duration;i.loopStart=Math.min(o/e,s-1e-4),i.loopEnd=Math.min(r/e,s),i.loopEnd<=i.loopStart&&(i.loopEnd=s)}this.decodedAudioBuffers.set(e,n)}catch(n){}})();this.instrumentLoadingPromises.set(c,l)}else{m=new oe({volume:t.volume||-12}),this.instrumentSynthTypes.set(c,"Sampler");const a=n,o=m,r=(async()=>{try{const t=await this.decodeAudioData(a),n=new xe(t);o.add(s,n),this.decodedAudioBuffers.set(e,t)}catch(t){}})();this.instrumentLoadingPromises.set(c,r)}}}if(!m&&n){const i=t.metadata?.modPlayback?.usePeriodPlayback;if(i||a){const s=new re({url:n,loop:a,volume:t.volume||0,onload:()=>{if(a){const e=t.sample?.sampleRate||8363,n=s.buffer.get(),a=n?n.duration:0;a>0&&(s.loopStart=Math.min(o/e,a-1e-4),s.loopEnd=Math.min(r/e,a),s.loopEnd<=s.loopStart&&(s.loopEnd=a))}const n=s.buffer.get();n&&this.decodedAudioBuffers.set(e,n)},onerror:e=>{}});m=s,this.instrumentSynthTypes.set(c,"Player")}else{const a=t.sample?.multiMap||{};if(!t.sample?.multiMap&&n&&(a[s]=n),m=new oe({urls:a,volume:t.volume||-12,onerror:e=>{}}),this.instrumentSynthTypes.set(c,"Sampler"),n){const t=n,s=(async()=>{try{const n=await fetch(t),s=await n.arrayBuffer(),a=await this.decodeAudioData(s);this.decodedAudioBuffers.set(e,a)}catch(n){}})();this.instrumentLoadingPromises.set(c,s)}}}m||(m=new oe({volume:t.volume||-12}),this.instrumentSynthTypes.set(c,"EmptySampler"));break}case"Player":{const e=t.parameters?.sampleUrl;m=new re(e?{url:e,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{volume:t.volume||-12});break}case"GranularSynth":{const e=t.granular?.sampleUrl||t.parameters?.sampleUrl,n=t.granular;m=new ie(e?{url:e,grainSize:(n?.grainSize||100)/1e3,overlap:(n?.grainOverlap||50)/100,playbackRate:n?.playbackRate||1,detune:n?.detune||0,reverse:n?.reverse||!1,loop:!0,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{grainSize:.1,overlap:.5,loop:!0,volume:t.volume||-12});break}default:{const n=t.synthType||"";if(t.synthType,Dy.has(n)||qN.knows(n)){t.synthType,m=JN.createInstrument(t);break}return mc(t.synthType||"Unknown",`Unsupported synth type "${t.synthType}". This instrument cannot produce sound.`,{synthName:t.name,errorType:"init",debugData:{synthType:t.synthType,instrumentId:e}}),null}}return m?(t.filter&&m.filter&&(m.filter.type=t.filter.type,m.filter.frequency.value=t.filter.frequency,m.filter.Q.value=t.filter.Q),this.instruments.set(c,m),this.instrumentSynthTypes.has(c)||this.instrumentSynthTypes.set(c,t.synthType),this.buildInstrumentEffectChain(c,t.effects||[],m).catch(e=>{}),this.routeNativeEngineOutput(m),m):null}getInstrumentAnalyser(e){let t=this.instrumentAnalysers.get(e);if(t)return t;t=new gw;let n=!1;for(const[s,a]of this.instruments)if(s>>16===e){eo(a)&&(n=!0);break}return t.output.connect(this.getInstrumentOutputDestination(e,n)),this.instrumentEffectChains.forEach((n,s)=>{if(s>>16===e){try{n.output.disconnect(this.masterInput)}catch{}try{n.output.disconnect(this.synthBus)}catch{}const s=this.instrumentOutputOverrides.get(e);if(s)try{n.output.disconnect(s)}catch{}n.output.connect(t.input)}}),this.instrumentAnalysers.set(e,t),t}disposeInstrumentAnalyser(e){const t=this.instrumentAnalysers.get(e);if(!t)return;const n=this.getInstrumentKey(e,-1);let s=this.instruments.get(n);if(!s)for(const[a,o]of this.instruments)if(a>>16===e){s=o;break}if(s){const a=eo(s);try{a?s.output.disconnect():s.disconnect()}catch{}const o=this.instrumentEffectChains.get(n),r=e=>{a?this.connectNativeSynth(s.output,e):s.connect(e)};if(o){o.effects.length>0?r(o.effects[0]):r(o.output);try{o.output.disconnect(t.input)}catch{}o.output.connect(this.getInstrumentOutputDestination(e,a))}else r(this.getInstrumentOutputDestination(e,a))}t.dispose(),this.instrumentAnalysers.delete(e)}disposeAllInstrumentAnalysers(){this.instrumentAnalysers.forEach((e,t)=>{this.disposeInstrumentAnalyser(t)})}applyAutomation(e,t,n,s){const a=this.getInstrumentKey(e,s),o=this.instruments.get(a);if(!o){const s=this.instruments.get(this.getInstrumentKey(e,-1));if(!s)return;return void this.applyAutomationToInstrument(s,t,n)}this.applyAutomationToInstrument(o,t,n)}applyAutomationToInstrument(e,t,n){const s=this.getSafeTime();if(null!==s)try{if((e instanceof Er||"BuzzmachineGenerator"===e.constructor.name)&&"function"==typeof e.set)return void e.set(t,n);const a=e;switch(t){case"cutoff":if(a.filter){const e=200*Math.pow(100,n);a.filter.frequency.setValueAtTime(e,s)}break;case"resonance":a.filter&&a.filter.Q.setValueAtTime(10*n,s);break;case"volume":{const t=40*n-40;if(eo(e)){const n=Math.pow(10,t/20);e.output.gain.setValueAtTime(n,s)}else a.volume&&a.volume.setValueAtTime(t,s);break}case"pan":{const e=2*n-1;a.pan&&a.pan.setValueAtTime(e,s);break}case"distortion":case"delay":case"reverb":break;default:e instanceof hy?e.setParameter(t,n):"function"==typeof a.setParam&&a.setParam(t,n)}}catch(a){}}applySlideAndAccent(e,t,n,s,a,o,r,i){let l=s;if(a&&(l=Math.min(1,s*Aw.ACCENT_BOOST)),o&&void 0!==r){const s=this.channelLastNote.get(r);if(s&&s.frequency>0){let a=null;const o=e;if(o.oscillator?.frequency?a=o.oscillator.frequency:o.voice0?.oscillator?.frequency?a=o.voice0.oscillator.frequency:o.frequency&&(a=o.frequency),a)try{a.setValueAtTime(s.frequency,n),a.setTargetAtTime(t,n,Aw.SLIDE_TIME_CONSTANT)}catch{}}}return void 0!==r&&void 0!==i&&this.channelLastNote.set(r,{frequency:t,time:n,instrumentId:i}),l}triggerNoteAttack(e,t,n,s=1,a,o,r,i,l,c){a.synthType;const u=this.getInstrument(e,a,l);if(!u)return void a.synthType;"SuperCollider"===a.synthType&&a.superCollider&&u.updateConfig?.(a.superCollider);if(!(u.triggerAttack||u.start))return void a.synthType;const d=a.isLive||"SuperCollider"===a.synthType?this.getImmediateTime():this.getSafeTime(n);if(null!==d)try{const n=qN.get(a.synthType);if(n?.onTriggerAttack){if(n.onTriggerAttack(u,t,d,s,{accent:r,slide:i,hammer:c,period:o,channelIndex:l,config:a}))return}if(u instanceof Er)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,u.triggerAttack(t,d,s,r,i);else if(u instanceof Er)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,u.triggerAttack(t,d,s,r,i,c);else if("NoiseSynth"===a.synthType)u.triggerAttack(d,s);else if("Sampler"===a.synthType){const n=this.getInstrumentKey(e,void 0),r=this.instrumentSynthTypes.get(n);if("Player"===r){const e=u;if(!e.buffer||!e.buffer.loaded)return;const n=s>0?Ne(s):-1/0;if(e.volume.value=n,a.metadata?.modPlayback?.usePeriodPlayback&&o){const t=a.metadata.modPlayback;let n=o;if(0!==t.finetune){const e=rw(o,0);e>=0&&(n=ow(e,t.finetune))}const s=t.periodMultiplier/n,r=s/(a.sample?.sampleRate||8363);e.playbackRate=r*this.globalPlaybackRate}else{const n=Lw(a.sample?.baseNote||"C4"),s=Lw(t)/n;e.playbackRate=s*this.globalPlaybackRate}e.start(d)}else{if("EmptySampler"===r)return;const n=u;if(!n.loaded)return;if(void 0!==a.sample?.sliceStart&&void 0!==a.sample?.sliceEnd){const o=a.sample?.baseNote||"C4",r=n,i=r._buffers?.get?.(o)||r._buffers?._buffers?.[o];if(i&&i.duration){const r=i.sampleRate||N().sampleRate,l=a.sample.sliceStart/r;try{const n=new re({url:i,volume:Ne(s)+(a.volume||-12)});n.connect(this.getInstrumentOutputDestination(e,!1));const r=Lw(o),c=Lw(t)/r;n.playbackRate=c*this.globalPlaybackRate,n.start(d,l),this.slicePlayersMap.set(`${e}-${t}`,n)}catch(m){n.triggerAttack(t,d,s)}}else n.triggerAttack(t,d,s)}else try{n.triggerAttack(t,d,s)}catch{}}}else if("Player"===a.synthType||"GranularSynth"===a.synthType){const e=u;if(!e.buffer||!e.buffer.loaded)return;const n=s>0?Ne(s):-1/0;if(e.volume.value=n,a.metadata?.modPlayback?.usePeriodPlayback&&o){const t=a.metadata.modPlayback;let n=o;if(0!==t.finetune){const e=rw(o,0);e>=0&&(n=ow(e,t.finetune))}const s=t.periodMultiplier/n,r=s/(a.sample?.sampleRate||8363);e.playbackRate=r}else{const n=Lw(a.sample?.baseNote||"C4"),s=Lw(t)/n;e.playbackRate=s}e.start(d)}else if("NoiseSynth"===a.synthType){const e=u,t=r?Math.min(1,s*Aw.ACCENT_BOOST):s;e.triggerAttack(d,t)}else if("MetalSynth"===a.synthType){const e=u,t=r?Math.min(1,s*Aw.ACCENT_BOOST):s;e.triggerAttack(d,t)}else if("MembraneSynth"===a.synthType){const e=u,n=r?Math.min(1,s*Aw.ACCENT_BOOST):s;e.triggerAttack(t,d,n)}else if("BuzzmachineGenerator"===u.constructor.name)u.triggerAttack(t,d,s,r,i);else if(u instanceof hy)u.triggerAttack(t,d,s);else{if(u instanceof pc&&void 0!==l){const e=pc.getMaxChannels(u.getChipType());u.setChannelIndex(l%e)}if(u instanceof Lc&&void 0!==l){const e=l%(u.getNumChannels()||3);u.setChannel(e)}const n=Lw(t),a=this.applySlideAndAccent(u,n,d,s,r,i,l,e);u.triggerAttack(t,d,a)}}catch(p){}}triggerNoteRelease(e,t,n,s,a){const o=this.getInstrument(e,s,a);if(!o||!o.triggerRelease){if("Sampler"===s.synthType){const t=this.getInstrumentKey(e,-1);if("Player"===this.instrumentSynthTypes.get(t)){const e=o;if("started"===e.state){const t=s.isLive?this.getImmediateTime():this.getSafeTime(n);null!==t&&e.stop(t)}}}return}const r=s.isLive?this.getImmediateTime():this.getSafeTime(n);if(null!==r)try{const n=qN.get(s.synthType);if(n?.onTriggerRelease){if(n.onTriggerRelease(o,t,r,{config:s}))return}if("Sampler"===s.synthType){const n=`${e}-${t}`,s=this.slicePlayersMap.get(n);if(s)return"started"===s.state&&s.stop(r),k().scheduleOnce(()=>{s.dispose()},r+.1),void this.slicePlayersMap.delete(n);const a=o;if(!a.loaded)return;return void a.triggerRelease(t,r)}if("Player"===s.synthType||"GranularSynth"===s.synthType){const e=o;return void("started"===e.state&&e.stop(r))}"NoiseSynth"===s.synthType||"MonoSynth"===s.synthType||"DuoSynth"===s.synthType||"MetalSynth"===s.synthType||"MembraneSynth"===s.synthType||"DrumMachine"===s.synthType||"TB303"===s.synthType||"DubSiren"===s.synthType||"Synare"===s.synthType||"Furnace"===s.synthType||"BuzzKick"===s.synthType||"BuzzKickXP"===s.synthType||"BuzzNoise"===s.synthType||"BuzzTrilok"===s.synthType||"Buzz4FM2F"===s.synthType||"BuzzDynamite6"===s.synthType||"BuzzM3"===s.synthType||"Buzz3o3"===s.synthType||"SpaceLaser"===s.synthType||"Sam"===s.synthType||"V2"===s.synthType||"V2Speech"===s.synthType||"MAMEVFX"===s.synthType||"MAMEDOC"===s.synthType||"MAMERSA"===s.synthType||"MAMESWP30"===s.synthType||"CZ101"===s.synthType||"CEM3394"===s.synthType||"SCSP"===s.synthType||s.synthType.startsWith("MAME")||"SunVoxSynth"===s.synthType?o.triggerRelease(r):o.triggerRelease(t,r)}catch(i){}}static NATIVE_POLY_TYPES=new Set(["Synth","FMSynth","AMSynth","PluckSynth","Sampler","SuperSaw","PolySynth","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth","Wavetable","WobbleBass"]);triggerPolyNoteAttack(e,t,n,s,a=!1,o=!1){s.synthType;const r=new Set(["MAMEMEA8000","MAMETMS5220","MAMESP0250","MAMEVotrax","Sam","V2Speech","MAMECM3394","MAMETMS36XX","MAMESN76477","MAMEUPD931","MAMEUPD933","MonoSynth","DuoSynth","TB303","Buzz3o3","DB303","DubSiren","SpaceLaser","Synare"]),i=!!s.synthType&&r.has(s.synthType);(!0===s.monophonic||i)&&(o||this.releaseAllPolyNotes(e,s));const l=s.synthType;if((!l||Aw.NATIVE_POLY_TYPES.has(l))&&!0!==s.monophonic){this.liveVoiceAllocation.set(t,-1);const r=s.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,r,n,s,void 0,a,o)}if("TB303"===l||"Buzz3o3"===l){o||this.releaseAllPolyNotes(e,s),this.liveVoiceAllocation.set(t,-1);const r=s.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,r,n,s,void 0,a,o)}this.liveVoiceAllocation.has(t)&&(o||this.triggerPolyNoteRelease(e,t,s));const c=this.voiceAllocator.allocate(t,e,n);this.liveVoiceAllocation.set(t,c);const u=this.getImmediateTime();this.triggerNoteAttack(e,t,u,n,s,void 0,a,o,c)}triggerPolyNoteRelease(e,t,n){const s=this.liveVoiceAllocation.get(t);if(void 0===s)return;this.liveVoiceAllocation.delete(t);const a=n.isLive?this.getImmediateTime():0;-1===s?this.triggerNoteRelease(e,t,a,n):(this.voiceAllocator.markReleasing(s),this.triggerNoteRelease(e,t,a,n,s),setTimeout(()=>{this.voiceAllocator.free(s)},100))}releaseAllPolyNotes(e,t){for(const[n,s]of this.liveVoiceAllocation.entries())-1===s?this.triggerNoteRelease(e,n,0,t):(this.triggerNoteRelease(e,n,0,t,s),this.voiceAllocator.free(s));this.liveVoiceAllocation.clear()}hasActivePolyNotes(){return this.liveVoiceAllocation.size>0}releaseNote(e,t,n,s){const a=this.getInstrumentKey(e,s);let o=this.instruments.get(a);if(o||(o=this.instruments.get(this.getInstrumentKey(e,-1))),!o)return;const r=this.getSafeTime(n);if(null===r)return;const i=this.instrumentSynthTypes.get(a)||this.instrumentSynthTypes.get(this.getInstrumentKey(e,-1));if("Sampler"===i){const e=o;if(e.loaded&&e.triggerRelease)try{e.triggerRelease(t,r)}catch{}return}if("Player"===i||"GranularSynth"===i){const e=o;if("started"===e.state)try{e.stop(r)}catch{}return}if(!o.triggerRelease)return;const l="MonoSynth"===i||"DuoSynth"===i||"MetalSynth"===i||"MembraneSynth"===i||"NoiseSynth"===i||"TB303"===i||"Buzz3o3"===i||"BuzzKick"===i||"BuzzKickXP"===i||"BuzzNoise"===i||"BuzzTrilok"===i||"Buzz4FM2F"===i||"BuzzDynamite6"===i||"BuzzM3"===i||"DubSiren"===i||"Synare"===i;try{l?o.triggerRelease(r):o.triggerRelease(t,r)}catch{try{o.triggerRelease(r)}catch{}}}triggerNote(e,t,n,s,a=1,o,r,i,l,c,u,d=0,m){const p=this.getSafeTime(s);if(null===p)return;const h=this.getInstrument(e,o,l);if(h){if(void 0!==l){let n,s=this.activeVoices.get(l)||[];if(0===d){let e=0;for(let t=0;t<s.length;t++)s[t].instrument===h?s[e++]=s[t]:this.stopVoice(s[t],p);s.length=e}else for(let e=0;e<s.length;e++)2===d&&s[e].volumeEnv.keyOff(),3===d&&(s[e].isKeyOff=!0,0===s[e].fadeoutStep&&(s[e].fadeoutStep=1024));if("Sampler"===o.synthType||"Player"===o.synthType){const e=h;n=new re(e.buffer),n.loop=e.loop,n.loopStart=e.loopStart,n.loopEnd=e.loopEnd}else n="Synth"===o.synthType?new $(h.get()):h;const m=s.findIndex(e=>e.instrument===n);if(m>=0)s[m].note=t;else{const e=this.createVoice(l,n,t,o);eo(n)||n.connect(e.nodes.gain),s.push(e)}this.activeVoices.set(l,s);try{if(n instanceof re){const e=a>0?Ne(a):-1/0;if(n.volume.value=e,o.metadata?.modPlayback?.usePeriodPlayback&&c){const e=o.metadata.modPlayback.periodMultiplier/c,t=e/(o.sample?.sampleRate||8363);n.playbackRate=t*this.globalPlaybackRate}else{const e=Lw(o.sample?.baseNote||"C4"),s=Lw(t)/e;n.playbackRate=s*this.globalPlaybackRate}const s=o.sample?.sampleRate||8363,r=n.buffer?.duration??0;let i=0;if(u&&u>0&&r>0){u<r*s&&(i=Math.min(u/s,r-.001))}n.start(p,i)}else if(n.triggerAttack){if(eo(n)){const e=n.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}if(n instanceof pc&&void 0!==l){const e=pc.getMaxChannels(n.getChipType());n.setChannelIndex(l%e)}if(n instanceof Lc&&void 0!==l){const e=l%(n.getNumChannels()||3);n.setChannel(e)}if("NoiseSynth"===o.synthType||"MetalSynth"===o.synthType){const e=r?Math.min(1,a*Aw.ACCENT_BOOST):a;n.triggerAttack(p,e)}else if(n instanceof Er)n.triggerAttack(t,p,a,r,i);else if(n instanceof Er)n.triggerAttack(t,p,a,r,i);else{const s=Lw(t),o=this.applySlideAndAccent(n,s,p,a,r,i,l,e);n.triggerAttack(t,p,o)}}}catch(f){}if(0!==this.globalDetuneCents&&!eo(n))if(void 0!==n.detune?.value)n.detune.value=this.globalDetuneCents;else if(n.set)try{n.set({detune:this.globalDetuneCents})}catch{}return}if(eo(h)){const e=h.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}try{if(h instanceof Er)h.triggerAttackRelease(t,n,p,a,r,i);else if(h instanceof Er)h.triggerAttackRelease(t,n,p,a,r,i,m);else if("NoiseSynth"===o.synthType)h.triggerAttackRelease(n,p,a);else if("MetalSynth"===o.synthType)h.triggerAttackRelease(n,p,a);else if("MembraneSynth"===o.synthType)h.triggerAttackRelease(t,n,p,a);else if("GranularSynth"===o.synthType){const e=h;if(e.buffer&&e.buffer.loaded){const s=a>0?Ne(a):-1/0;if(e.volume.value=s,o.metadata?.modPlayback?.usePeriodPlayback&&c){const t=o.metadata.modPlayback;let n=c;if(0!==t.finetune){const e=rw(c,0);e>=0&&(n=ow(e,t.finetune))}const s=t.periodMultiplier/n,a=s/(o.sample?.sampleRate||8363);e.playbackRate=a*(o.granular?.playbackRate||1)*this.globalPlaybackRate}else{const n=Lw("C4"),s=Lw(t)/n;e.playbackRate=s*(o.granular?.playbackRate||1)*this.globalPlaybackRate}e.start(p),e.stop(p+n)}}else if("Player"===o.synthType||"Sampler"===o.synthType&&o.sample?.loop||"Sampler"===o.synthType&&o.metadata?.modPlayback?.usePeriodPlayback){const e=h;if(e.buffer&&e.buffer.loaded){const s=r?Math.min(1,a*Aw.ACCENT_BOOST):a,i=s>0?Ne(s):-1/0;if(e.volume.value=i,o.metadata?.modPlayback?.usePeriodPlayback&&c){const t=o.metadata.modPlayback;let n=c;if(0!==t.finetune){const e=rw(c,0);e>=0&&(n=ow(e,t.finetune))}const s=t.periodMultiplier/n,a=o.sample?.sampleRate||8363,r=s/a*this.globalPlaybackRate;e.playbackRate=r}else if(o.metadata?.modPlayback?.usePeriodPlayback&&!c)e.playbackRate=this.globalPlaybackRate;else{const n=Lw("C4"),s=Lw(t)/n;e.playbackRate=s*this.globalPlaybackRate}const d=o.sample?.sampleRate||8363;let m=0;if(u&&u>0&&e.buffer){u<e.buffer.duration*d&&(m=Math.min(u/d,e.buffer.duration-.001))}if(e.loop){if(void 0!==l){const t=this.channelActivePlayer.get(l);t&&"started"===t.state&&t.stop(p),this.channelActivePlayer.set(l,e)}e.start(p,m)}else e.start(p,m),e.stop(p+n)}}else if("Sampler"!==o.synthType||o.sample?.loop){if("SuperSaw"===o.synthType||"PolySynth"===o.synthType||"Organ"===o.synthType||"ChipSynth"===o.synthType||"PWMSynth"===o.synthType||"StringMachine"===o.synthType||"FormantSynth"===o.synthType){if(h.triggerAttackRelease){const s=Lw(t),o=this.applySlideAndAccent(h,s,p,a,r,i,l,e);h.triggerAttackRelease(t,n,p,o)}}else if(h instanceof hy)h.triggerAttackRelease(t,n,p,a);else if("DrumMachine"===o.synthType){if(h.triggerAttackRelease){const e=r?Math.min(1,a*Aw.ACCENT_BOOST):a;h.triggerAttackRelease(t,n,p,e)}}else if(h.triggerAttackRelease){const s=Lw(t),o=this.applySlideAndAccent(h,s,p,a,r,i,l,e);h.triggerAttackRelease(t,n,p,o)}}else{const s=h;if(s.loaded){if(void 0!==o.sample?.sliceStart&&void 0!==o.sample?.sliceEnd){const r=o.sample?.baseNote||"C4",i=s,l=i._buffers?.get?.(r)||i._buffers?._buffers?.[r];if(l&&l.duration){const i=l.sampleRate||N().sampleRate,c=o.sample.sliceStart,u=o.sample.sliceEnd,d=c/i,m=u/i-d;try{const s=new re({url:l,volume:Ne(a)+(o.volume||-12)});s.connect(this.getInstrumentOutputDestination(e,!1));const i=Lw(r),c=Lw(t)/i;s.playbackRate=c*this.globalPlaybackRate,s.start(p,d),s.stop(p+Math.min(n,m)),k().scheduleOnce(()=>{s.dispose()},p+n+.1)}catch(f){s.triggerAttackRelease(t,n,p,a)}}else s.triggerAttackRelease(t,n,p,a)}else if(u&&u>0){const r=o.sample?.baseNote||"C4",i=s,l=i._buffers?.get?.(r)||i._buffers?._buffers?.[r];if(l&&l.duration){const i=u/(o.sample?.sampleRate||8363),c=Math.min(i,l.duration-.001);try{const s=new re({url:l,volume:Ne(a)+(o.volume||-12)});s.connect(this.getInstrumentOutputDestination(e,!1));const i=Lw(r),u=Lw(t)/i;s.playbackRate=u*this.globalPlaybackRate,s.start(p,c),s.stop(p+n),k().scheduleOnce(()=>{s.dispose()},p+n+.1)}catch(f){s.triggerAttackRelease(t,n,p,a)}}else s.triggerAttackRelease(t,n,p,a)}else s.triggerAttackRelease(t,n,p,a)}}}catch(g){}}}schedulePatternEvents(e){k().cancel(),e.forEach(e=>{k().schedule(t=>{this.triggerNote(e.instrumentId,e.note,e.duration,t,e.velocity,e.config)},e.time)})}clearSchedule(){k().cancel()}releaseAll(){const e=Y();this.instruments.forEach((t,n)=>{try{if(t instanceof re||t instanceof ie)t.loop=!1,"started"===t.state&&t.stop(e);else if(t instanceof oe){t.releaseAll(e);const n=t._activeSources;n&&n instanceof Map&&n.forEach(t=>{Array.isArray(t)&&t.forEach(t=>{try{t&&"function"==typeof t.stop&&t.stop(e+.05)}catch{}})})}else t instanceof Er?t.releaseAll():t.releaseAll?t.releaseAll(e):eo(t)&&t.triggerRelease&&(t.triggerRelease(void 0,e),"function"==typeof t.stopSpeaking&&t.stopSpeaking());const s=t;if(s.volume&&"function"==typeof s.volume.rampTo){const t=s.volume.value;if(null==t)return;"function"==typeof s.volume.cancelScheduledValues&&s.volume.cancelScheduledValues(e),s.volume.rampTo(-1/0,.05,e);const a=this.releaseRestoreTimeouts.get(n);a&&clearTimeout(a);const o=setTimeout(()=>{this.releaseRestoreTimeouts.delete(n);try{s.volume&&(s.volume.value=t)}catch{}},100);this.releaseRestoreTimeouts.set(n,o)}else if(eo(t)){const s=t.output.gain,a=this.releaseRestoreTimeouts.get(n);a&&clearTimeout(a),s.cancelScheduledValues(e),s.setValueAtTime(s.value||1,e),s.linearRampToValueAtTime(0,e+.05);const o=setTimeout(()=>{this.releaseRestoreTimeouts.delete(n);try{s.cancelScheduledValues(0),s.value=1}catch{}},100);this.releaseRestoreTimeouts.set(n,o)}}catch(s){}}),this.activeVoices.forEach(t=>{for(const n of t)try{this.stopVoice(n,e)}catch{}}),this.activeVoices.clear(),this.muteChipEngineOutputs(e),this.channelActivePlayer.forEach(t=>{try{t.loop=!1,"started"===t.state&&t.stop(e)}catch{}}),this.channelPitchState.clear(),this.channelActivePlayer.clear(),this.slicePlayersMap.forEach(e=>{try{"started"===e.state&&e.stop(),e.dispose()}catch{}}),this.slicePlayersMap.clear()}static CHIP_ENGINE_KEY=-1;static DISPATCH_ENGINE_KEY=-2;muteChipEngineOutputs(e){const t=(t,n)=>{const s=n();if(!s)return;const a=this.releaseRestoreTimeouts.get(t);a&&clearTimeout(a),s.gain.cancelScheduledValues(e),s.gain.setValueAtTime(s.gain.value||1,e),s.gain.linearRampToValueAtTime(0,e+.05);const o=setTimeout(()=>{this.releaseRestoreTimeouts.delete(t);try{s.gain.cancelScheduledValues(0),s.gain.value=1}catch{}},100);this.releaseRestoreTimeouts.set(t,o)};this.nativeEngineRouting.has("FurnaceChipEngine")&&t(Aw.CHIP_ENGINE_KEY,()=>ac.getInstance().getNativeOutput()),this.nativeEngineRouting.has("FurnaceDispatchEngine")&&t(Aw.DISPATCH_ENGINE_KEY,()=>wc.getInstance().getOrCreateSharedGain())}disposeInstrumentByKey(e){const t=this.instruments.get(e);if(t){this.instruments.delete(e),this.instrumentSynthTypes.delete(e),this.instrumentLoadingPromises.delete(e);try{t.disposed||(t.releaseAll?t.releaseAll():t.triggerRelease&&t.triggerRelease())}catch{}this.disposeInstrumentEffectChain(e);try{t.disposed||t.dispose()}catch{}}}disposeInstrument(e){const t=[];this.instruments.forEach((n,s)=>{this.instrumentIdFromKey(s)===e&&t.push(s)}),t.forEach(e=>{this.disposeInstrumentByKey(e)})}disposeAllInstruments(){this.releaseRestoreTimeouts.forEach(e=>clearTimeout(e)),this.releaseRestoreTimeouts.clear(),this.instrumentOutputOverrides.clear();Array.from(this.instruments.keys()).forEach(e=>{this.disposeInstrumentByKey(e)}),this.instrumentSynthTypes.clear(),this.instrumentLoadingPromises.clear(),this.decodedAudioBuffers.clear(),this.activeVoices.clear(),this.channelLastNote.clear(),this.channelMuteStates.clear(),this.channelPitchState.clear(),this.channelActivePlayer.forEach(e=>{try{e.loop=!1,"started"===e.state&&e.stop()}catch{}}),this.channelActivePlayer.clear(),this.lastTriggerTime=0}invalidateInstrument(e){this.disposeInstrument(e)}updateInstrument(e,t){this.disposeInstrument(e),this.getInstrument(e,t)}async previewSlice(e,t,n){await A();const s=(await os(()=>Promise.resolve().then(()=>kN),void 0).then(e=>e.useInstrumentStore.getState())).instruments.find(t=>t.id===e),a=s?.sample?.audioBuffer,o=s?.sample?.url;if(a||o)try{let e;if(a)e=await this.decodeAudioData(a);else{const t=await fetch(o),n=await t.arrayBuffer();e=await this.decodeAudioData(n)}const s=e.sampleRate,r=n-t;if(r<=0)return;const i=ve.createBuffer(e.numberOfChannels,r,s);for(let n=0;n<e.numberOfChannels;n++){const s=e.getChannelData(n),a=i.getChannelData(n);for(let e=0;e<r;e++)a[e]=s[t+e]}const l=new re(i).toDestination();l.start();setTimeout(()=>{try{l.stop(),l.dispose()}catch{}},r/s*1e3+100)}catch(r){}}async bakeInstrument(e,t=2,n="C4"){return await we(async()=>{const t=JN.createInstrument(e);if(e.effects&&e.effects.length>0){const n=await JN.createEffectChain(e.effects);let s;if(eo(t)){const e=new m(1),n=co(e);n&&t.output.connect(n),s=e}else s=t;let a=s;for(const e of n)a.connect(e),a=e;a.toDestination()}else if(eo(t)){const e=new m(1),n=co(e);n&&t.output.connect(n),e.toDestination()}else t.toDestination();t.triggerAttack&&(t.triggerAttack(n,0),t.triggerRelease&&t.triggerRelease(1))},t)}updateWAMParameters(e,t){const n=[];this.instruments.forEach((t,s)=>{this.instrumentIdFromKey(s)===e&&t instanceof hy&&n.push(t)}),0!==n.length?n.forEach(e=>{t.parameterValues&&Object.entries(t.parameterValues).forEach(([t,n])=>{e.setParameter(t,n)}),t.pluginState&&e.setPluginState(t.pluginState)}):this.invalidateInstrument(e)}updateTB303Parameters(e,t){const n=[];this.instruments.forEach((t,s)=>{this.instrumentIdFromKey(s)===e&&t instanceof Er&&n.push(t)}),0!==n.length?n.forEach(e=>e.applyConfig(t)):this.invalidateInstrument(e)}updateFurnaceInstrument(e,t){if(!t.furnace||!t.synthType?.startsWith("Furnace"))return;const n=[];this.instruments.forEach((t,s)=>{this.instrumentIdFromKey(s)===e&&t.uploadInstrumentData&&n.push(t)}),0!==n.length?os(async()=>{const{updateFurnaceInstrument:e}=await Promise.resolve().then(()=>Pc);return{updateFurnaceInstrument:e}},void 0).then(({updateFurnaceInstrument:e})=>{const s=t.furnace.furnaceIndex??0,a=e(t.furnace,t.name,s);n.forEach(e=>{e.uploadInstrumentData(a)})}).catch(e=>{}):this.invalidateInstrument(e)}updateHarmonicSynthParameters(e,t){const n=[];this.instruments.forEach((t,s)=>{this.instrumentIdFromKey(s)===e&&t.applyConfig&&n.push(t)}),0!==n.length?n.forEach(e=>e.applyConfig(t)):this.invalidateInstrument(e)}getMAMESynthHandle(e){const t=this.getInstrumentKey(e,-1),n=this.instruments.get(t);return n instanceof Vr?n.getHandle():0}getMAMEChipSynth(e){const t=this.getInstrumentKey(e,-1),n=this.instruments.get(t);if(n instanceof Hr)return n;for(const[s,a]of this.instruments)if(s>>16===e&&a instanceof Hr)return a;return null}updateMAMEParameters(e,t){const n=this.getInstrumentKey(e,-1);this.instruments.get(n)}updateMAMEChipParam(e,t,n){const s=this.getInstrumentKey(e,-1),a=this.instruments.get(s);if(!a)return;const o=a;"function"==typeof o.setParam&&o.setParam(t,n)}loadMAMEChipPreset(e,t){const n=this.getInstrumentKey(e,-1),s=this.instruments.get(n);if(!s)return;const a=s;"function"==typeof a.loadPreset&&a.loadPreset(t)}updateMAMEChipTextParam(e,t,n){const s=this.getInstrumentKey(e,-1),a=this.instruments.get(s);if(!a)return;const o=a;"function"==typeof o.setTextParam?o.setTextParam(t,n):"function"==typeof o.applyConfig&&o.applyConfig({[t]:n})}async speakMAMEChipText(e,t){const n=this.getInstrumentKey(e,-1);let s=this.instruments.get(n);if(!s)try{const{useInstrumentStore:t}=await os(async()=>{const{useInstrumentStore:e}=await Promise.resolve().then(()=>kN);return{useInstrumentStore:e}},void 0),n=t.getState().instruments.find(t=>t.id===e);n&&(s=this.getInstrument(e,n)??void 0,s&&"function"==typeof s.ensureInitialized&&await s.ensureInitialized(),await new Promise(e=>setTimeout(e,50)))}catch(o){}if(!s)return;const a=s;"function"==typeof a.speakText&&a.speakText(t)}loadSynthROM(e,t,n,s){const a=this.getInstrumentKey(e,-1),o=this.instruments.get(a);if(!o)return;const r=o;"MAMERSA"===t?"function"==typeof r.loadROM&&r.loadROM(n,s):"MAMESWP30"===t?"function"==typeof r.loadWaveROM&&r.loadWaveROM(s.buffer):"function"==typeof r.loadROM?r.loadROM(n,s):"function"==typeof r.setRom&&r.setRom(n,s)}updateDubSirenParameters(e,t){let n=!1;this.instruments.forEach((s,a)=>{this.instrumentIdFromKey(a)===e&&s&&"function"==typeof s.applyConfig&&(s.applyConfig(t),n=!0)})}updateSpaceLaserParameters(e,t){this.instruments.forEach((n,s)=>{this.instrumentIdFromKey(s)===e&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateV2Parameters(e,t){this.instruments.forEach((n,s)=>{if(this.instrumentIdFromKey(s)===e&&n&&"V2Synth"===n.name){const e=n;t.osc1&&(e.setParameter(2,t.osc1.mode),e.setParameter(4,t.osc1.transpose+64),e.setParameter(5,t.osc1.detune+64),e.setParameter(6,t.osc1.color),e.setParameter(7,t.osc1.level)),t.osc2&&(e.setParameter(8,t.osc2.mode),e.setParameter(9,t.osc2.ringMod?1:0),e.setParameter(10,t.osc2.transpose+64),e.setParameter(11,t.osc2.detune+64),e.setParameter(12,t.osc2.color),e.setParameter(13,t.osc2.level)),t.osc3&&(e.setParameter(14,t.osc3.mode),e.setParameter(15,t.osc3.ringMod?1:0),e.setParameter(16,t.osc3.transpose+64),e.setParameter(17,t.osc3.detune+64),e.setParameter(18,t.osc3.color),e.setParameter(19,t.osc3.level)),t.filter1&&(e.setParameter(20,t.filter1.mode),e.setParameter(21,t.filter1.cutoff),e.setParameter(22,t.filter1.resonance)),t.filter2&&(e.setParameter(23,t.filter2.mode),e.setParameter(24,t.filter2.cutoff),e.setParameter(25,t.filter2.resonance)),t.routing&&(e.setParameter(26,t.routing.mode),e.setParameter(27,t.routing.balance)),t.envelope&&(e.setParameter(32,t.envelope.attack),e.setParameter(33,t.envelope.decay),e.setParameter(34,t.envelope.sustain),e.setParameter(36,t.envelope.release)),t.envelope2&&(e.setParameter(38,t.envelope2.attack),e.setParameter(39,t.envelope2.decay),e.setParameter(40,t.envelope2.sustain),e.setParameter(42,t.envelope2.release)),t.lfo1&&(e.setParameter(47,t.lfo1.rate),e.setParameter(50,t.lfo1.depth))}})}updateSynareParameters(e,t){this.instruments.forEach((n,s)=>{this.instrumentIdFromKey(s)===e&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateFurnaceParameters(e,t){this.instruments.forEach((t,n)=>{this.instrumentIdFromKey(n)===e&&t&&"function"==typeof t.updateParameters&&t.updateParameters()})}applyFurnaceEffect(e,t,n,s=0){const a=this.instrumentSynthTypes.get(this.getInstrumentKey(e,-1));if(!a||!a.startsWith("Furnace"))return!1;for(const[o,r]of this.instruments)if(this.instrumentIdFromKey(o)===e){if(r instanceof Lc)return r.applyEffect(t,n,s),!0;if(r instanceof pc)return this.applyFurnaceSynthEffect(r,t,n),!0}return!1}applyFurnaceExtendedEffect(e,t,n,s=0){const a=this.instrumentSynthTypes.get(this.getInstrumentKey(e,-1));if(!a||!a.startsWith("Furnace"))return!1;for(const[o,r]of this.instruments)if(this.instrumentIdFromKey(o)===e&&r instanceof Lc)return r.applyExtendedEffect(t,n,s),!0;return!1}applyFurnaceSynthEffect(e,t,n){const s=n>>4&15,a=15&n,o=e.getChipType();8!==t?this.isFMChip(o)?this.applyFMEffect(e,t,n,s,a):this.isPSGChip(o)?this.applyPSGEffect(e,t,n,o):this.isWavetableChip(o)?this.applyWavetableEffect(e,t,n,o):this.isC64Chip(o)&&this.applyC64Effect(e,t,n):e.writePanRegister(n)}isFMChip(e){return[nc.OPN2,nc.OPM,nc.OPL3,nc.OPLL,nc.OPNA,nc.OPNB,nc.OPZ,nc.Y8950,nc.OPL4,nc.OPN,nc.OPNB_B,nc.ESFM].includes(e)}isPSGChip(e){return[nc.NES,nc.GB,nc.PSG,nc.AY,nc.AY8930,nc.SAA,nc.VIC,nc.TED].includes(e)}isWavetableChip(e){return[nc.PCE,nc.SCC,nc.SWAN,nc.N163,nc.NAMCO,nc.FDS,nc.BUBBLE,nc.X1_010,nc.SM8521].includes(e)}isC64Chip(e){return[nc.SID,nc.SID_6581,nc.SID_8580].includes(e)}applyFMEffect(e,t,n,s,a){switch(t){case 17:e.writeOperatorTL(s,8*a);break;case 18:e.writeOperatorAR(s,2*a);break;case 19:e.writeOperatorDR(s,2*a);break;case 20:e.writeOperatorMult(s,a);break;case 21:e.writeOperatorRR(s,a);break;case 22:e.writeOperatorSL(s,a)}}applyPSGEffect(e,t,n,s){switch(s){case nc.GB:17===t?e.writeWavetableSelect(n):18===t&&e.writeDutyRegister(3&n);break;case nc.NES:18===t&&e.writeDutyRegister(n>>6&3)}}applyWavetableEffect(e,t,n,s){switch(s){case nc.PCE:18===t&&e.writeWavetableSelect(n);break;case nc.SCC:case nc.N163:case nc.NAMCO:16===t&&e.writeWavetableSelect(n);break;case nc.FDS:break;case nc.SWAN:case nc.SM8521:case nc.BUBBLE:case nc.X1_010:16!==t&&17!==t||e.writeWavetableSelect(n)}}applyC64Effect(e,t,n){16!==t&&18!==t||e.writeDutyRegister(n)}updateDexedParameters(e,t){this.instruments.forEach((n,s)=>{this.instrumentIdFromKey(s)===e&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateOBXdParameters(e,t){this.instruments.forEach((n,s)=>{this.instrumentIdFromKey(s)===e&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateComplexSynthParameters(e,t){this.instruments.forEach((n,s)=>{this.instrumentIdFromKey(s)===e&&n&&"function"==typeof n.applyConfig&&n.applyConfig(t)})}updateToneJsSynthInPlace(e,t){const n=Aw.EFFECT_RAMP_TIME;this.instruments.forEach((s,a)=>{if(this.instrumentIdFromKey(a)!==e)return;const o=s;if(t.oscillator?.type&&o.oscillator)try{const e="noise"===t.oscillator.type?"sawtooth":t.oscillator.type;o.oscillator.type=e}catch{}if(s instanceof K&&t.oscillator?.type)try{const e="noise"===t.oscillator.type?"sawtooth":t.oscillator.type;s.set({oscillator:{type:e}})}catch{}if(t.envelope){const e=t.envelope;try{s instanceof K?s.set({envelope:{attack:(e.attack??10)/1e3,decay:(e.decay??200)/1e3,sustain:(e.sustain??50)/100,release:(e.release??1e3)/1e3}}):o.envelope&&(o.envelope.attack=(e.attack??10)/1e3,o.envelope.decay=(e.decay??200)/1e3,o.envelope.sustain=(e.sustain??50)/100,o.envelope.release=(e.release??1e3)/1e3)}catch{}}if(t.filter&&o.filter)try{void 0!==t.filter.frequency&&o.filter.frequency.rampTo(t.filter.frequency,n),void 0!==t.filter.Q&&o.filter.Q.rampTo(t.filter.Q,n),t.filter.type&&(o.filter.type=t.filter.type)}catch{}if(void 0!==t.volume&&o.volume)try{o.volume.rampTo(t.volume,n)}catch{}})}updateBuzzmachineParameters(e,t){this.instruments.forEach((n,s)=>{if(this.instrumentIdFromKey(s)===e){const e=n;n&&"function"==typeof e.setParameter&&Object.entries(t.parameters).forEach(([t,n])=>{e.setParameter(Number(t),n)})}})}async updateTB303Pedalboard(e,t){if(!t)return;const n=[];if(this.instruments.forEach((t,s)=>{s>>16===e&&t instanceof Er&&n.push(t)}),0===n.length)return;const s=t.enabled&&t.chain.some(e=>e.enabled&&"neural"===e.type);for(const o of n)if(s){const e=t.chain.find(e=>e.enabled&&"neural"===e.type);if(e&&void 0!==e.neuralModelIndex)try{await o.loadGuitarMLModel(e.neuralModelIndex),await o.setGuitarMLEnabled(!0),void 0!==e.parameters?.dryWet&&o.setGuitarMLMix(e.parameters.dryWet)}catch(a){}}else try{await o.setGuitarMLEnabled(!1)}catch(a){}}updateChipSynthArpeggio(e,t){t&&this.instruments.forEach((n,s)=>{s>>16===e&&n.updateArpeggio&&n.updateArpeggio(t)})}getChipSynthArpeggioStep(e){for(const[t,n]of this.instruments.entries())if(t>>16===e&&n.getCurrentArpeggioStep)return n.getCurrentArpeggioStep();return 0}isChipSynthArpeggioPlaying(e){for(const[t,n]of this.instruments.entries())if(t>>16===e&&n.isArpeggioPlaying)return n.isArpeggioPlaying();return!1}initMetronome(){this.metronomeSynth||(this.metronomeSynth=new ne({pitchDecay:.008,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.1,sustain:0,release:.1}}),this.metronomeVolume=new m(.5),this.metronomeSynth.connect(this.metronomeVolume),this.metronomeVolume.connect(this.masterChannel))}setMetronomeEnabled(e){this.metronomeEnabled=e,e&&this.initMetronome()}isMetronomeEnabled(){return this.metronomeEnabled}setMetronomeVolume(e){this.metronomeVolume||this.initMetronome();const t=Math.max(0,Math.min(1,e/100));this.metronomeVolume?.set({gain:t})}triggerMetronomeClick(e,t=!1){if(!this.metronomeEnabled||!this.metronomeSynth)return;const n=t?"C5":"C4",s=t?.8:.5;this.metronomeSynth.triggerAttackRelease(n,"32n",e,s)}stopMetronome(){this.metronomePart&&(this.metronomePart.stop(),this.metronomePart.dispose(),this.metronomePart=null)}disposeMetronome(){this.stopMetronome(),this.metronomeSynth&&(this.metronomeSynth.dispose(),this.metronomeSynth=null),this.metronomeVolume&&(this.metronomeVolume.dispose(),this.metronomeVolume=null)}dispose(){this.stop(),this.clearSchedule(),this.disposeMetronome(),this.disposeAllInstrumentAnalysers(),this.instrumentEffectChains.forEach((e,t)=>{e.effects.forEach(e=>{try{e.dispose()}catch(t){}});try{e.output.dispose()}catch(n){}}),this.instrumentEffectChains.clear(),this.instrumentEffectNodes.clear(),this.instruments.forEach((e,t)=>{try{e.dispose()}catch(n){}}),this.instruments.clear(),this.disposeChannelOutputs(),this.masterEffectsNodes.forEach(e=>{try{e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear(),this.masterEffectAnalysers.forEach(({pre:e,post:t})=>{try{e.disconnect()}catch{}try{t.disconnect()}catch{}}),this.masterEffectAnalysers.clear(),this.analyser.dispose(),this.fft.dispose(),this.amigaFilter.dispose(),this.synthBus.dispose(),this.masterEffectsInput.dispose(),this.blepInput.dispose(),this.masterInput.dispose(),this.masterChannel.dispose(),Aw.instance=null}async buildInstrumentEffectChain(e,t,n){const s=this.instrumentEffectChains.get(e);if(s){for(const[e,t]of this.instrumentEffectNodes)s.effects.includes(t.node)&&this.instrumentEffectNodes.delete(e);if(s.effects.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),s.bridge)try{s.bridge.disconnect(),s.bridge.dispose()}catch{}s.output.disconnect(),s.output.dispose()}const a=new m(1),o=eo(n),r=e=>{o?this.connectNativeSynth(n.output,e):n.connect(e)},i=t.filter(e=>e.enabled);if(0===i.length){r(a);const t=e>>>16,n=this.instrumentAnalysers.get(t);return n?a.connect(n.input):a.connect(this.getInstrumentOutputDestination(t,o)),void this.instrumentEffectChains.set(e,{effects:[],output:a})}const l=await Promise.all(i.map(e=>JN.createEffect(e)));let c;if(l.length>0){o?(c=new m(1),r(c),c.connect(l[0])):n.connect(l[0]);for(let e=0;e<l.length-1;e++)l[e].connect(l[e+1]);l[l.length-1].connect(a)}else r(a);const u=e>>>16,d=this.instrumentAnalysers.get(u);d?a.connect(d.input):a.connect(this.getInstrumentOutputDestination(u,o)),this.instrumentEffectChains.set(e,{effects:l,output:a,bridge:c}),i.forEach((e,t)=>{this.instrumentEffectNodes.set(e.id,{node:l[t],config:e})})}async rebuildInstrumentEffects(e,t){const n=this.getInstrumentKey(e,-1),s=this.instruments.get(n);if(s){try{eo(s)?s.output.disconnect():s.disconnect()}catch{}await this.buildInstrumentEffectChain(n,t,s)}}setInstrumentOutputOverride(e,t){this.instrumentOutputOverrides.set(e,t)}removeInstrumentOutputOverride(e){this.instrumentOutputOverrides.delete(e)}throwInstrumentToEffect(e,t,n=1,s=0){const a=[];this.instrumentEffectChains.forEach((t,n)=>{n>>16===e&&a.push(t)}),0!==a.length&&a.forEach(e=>{const a=e.effects.find(e=>e._fxType===t);if(a&&"wet"in a){const e=a.wet,t=ye();e.cancelScheduledValues(t),e.rampTo(n,.01,t),s>0&&e.rampTo(0,.1,t+s/1e3)}})}disposeInstrumentEffectChain(e){const t=this.instrumentEffectChains.get(e);if(t){t.effects.forEach(e=>{try{e.dispose()}catch{}});try{t.output.dispose()}catch{}this.instrumentEffectChains.delete(e)}}async rebuildMasterEffects(e){if(this.canUseParameterUpdatePath(e))return void this.updateEffectParameters(e);const t=++this.masterEffectsRebuildVersion,n=structuredClone(e);this.masterEffectsInput.disconnect(),this.masterEffectsNodes.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear(),this.masterEffectAnalysers.forEach(({pre:e,post:t})=>{try{e.disconnect()}catch{}try{t.disconnect()}catch{}}),this.masterEffectAnalysers.clear();const s=n.filter(e=>e.enabled);if(0===s.length)return void this.masterEffectsInput.connect(this.blepInput);if("suspended"===N().state)try{await A()}catch{}if(t!==this.masterEffectsRebuildVersion)return;const a=[],o=[];for(const c of s)try{const e=await JN.createEffect(c);if(t!==this.masterEffectsRebuildVersion){try{e.disconnect(),e.dispose()}catch{}return void a.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}})}a.push(e),o.push(c)}catch(i){}if(t!==this.masterEffectsRebuildVersion)return void a.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}});if(0===a.length)return void this.masterEffectsInput.connect(this.blepInput);a.forEach((e,t)=>{this.masterEffectsNodes.push(e),this.masterEffectConfigs.set(o[t].id,{node:e,config:o[t]})}),this.masterEffectsInput.connect(this.masterEffectsNodes[0]);for(let c=0;c<this.masterEffectsNodes.length-1;c++)this.masterEffectsNodes[c].connect(this.masterEffectsNodes[c+1]);this.masterEffectsNodes[this.masterEffectsNodes.length-1].connect(this.blepInput);const r=N().rawContext;for(let c=0;c<a.length;c++){const e=o[c],t=r.createAnalyser();t.fftSize=2048,t.smoothingTimeConstant=.8;const n=r.createAnalyser();n.fftSize=2048,n.smoothingTimeConstant=.8;const s=0===c?this.masterEffectsInput:a[c-1],i=0===c?void 0:a[c-1].output,u=co(i||s);if(u)try{u.connect(t)}catch(l){}const d=a[c].output,m=co(d||a[c]);if(m)try{m.connect(n)}catch(l){}this.masterEffectAnalysers.set(e.id,{pre:t,post:n})}this._notifyNoiseEffectsPlaying(this._isPlaying)}canUseParameterUpdatePath(e){const t=e.filter(e=>e.enabled),n=Array.from(this.masterEffectConfigs.keys());if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++){if(t[s].id!==n[s])return!1;const e=this.masterEffectConfigs.get(n[s]);if(!e)return!1;if(t[s].type!==e.config.type)return!1}return!0}updateEffectParameters(e){const t=e.filter(e=>e.enabled);for(const n of t){const e=this.masterEffectConfigs.get(n.id);e&&(Object.entries(n.parameters||{}).forEach(([t,n])=>{if(t in e.node){const s=e.node;void 0!==s[t]?.value?s[t].value=n:s[t]=n}}),"wet"in e.node&&(e.node.wet.value=n.enabled?1:0),e.config=n)}}getMasterEffectNode(e){return this.masterEffectConfigs.get(e)?.node??null}getMasterEffectAnalysers(e){return this.masterEffectAnalysers.get(e)??null}updateMasterEffectParams(e,t){const n=this.masterEffectConfigs.get(e);if(!n)return;const{node:s,config:a}=n;try{if(t.wet!==a.wet){const e=t.wet/100;"wet"in s&&s.wet instanceof P?s.wet.rampTo(e,.02):"wet"in s&&"number"==typeof s.wet&&(s.wet=e)}const e={};for(const[n,s]of Object.entries(t.parameters))a.parameters[n]!==s&&(e[n]=s);if(Object.keys(e).length>0&&(this.applyEffectParametersDiff(s,t.type,e),"bpmSync"in e||"syncDivision"in e)){const e=k().bpm.value;this.updateBpmSyncedEffects(e).catch(()=>{})}n.config=t}catch(o){}}updateInstrumentEffectParams(e,t){const n=this.instrumentEffectNodes.get(e);if(!n)return;const{node:s,config:a}=n;try{if(t.wet!==a.wet){const e=t.wet/100;"wet"in s&&s.wet instanceof P?s.wet.rampTo(e,.02):"wet"in s&&"number"==typeof s.wet&&(s.wet=e)}const e={};for(const[n,s]of Object.entries(t.parameters))a.parameters[n]!==s&&(e[n]=s);Object.keys(e).length>0&&this.applyEffectParametersDiff(s,t.type,e),n.config=t}catch(o){}}static EFFECT_RAMP_TIME=.02;applyEffectParametersDiff(e,t,n){const s=Aw.EFFECT_RAMP_TIME;switch(t){case"Distortion":e instanceof v&&("drive"in n&&(e.distortion=n.drive),"oversample"in n&&(e.oversample=n.oversample));break;case"Delay":case"FeedbackDelay":e instanceof C&&("time"in n&&e.delayTime.rampTo(n.time,s),"feedback"in n&&e.feedback.rampTo(n.feedback,s));break;case"Chorus":e instanceof q&&("frequency"in n&&e.frequency.rampTo(n.frequency,s),"depth"in n&&(e.depth=n.depth));break;case"Phaser":e instanceof x&&("frequency"in n&&e.frequency.rampTo(n.frequency,s),"octaves"in n&&(e.octaves=n.octaves),"baseFrequency"in n&&(e.baseFrequency=Number(n.baseFrequency)),"Q"in n&&e.Q.rampTo(n.Q,s));break;case"Tremolo":e instanceof W&&("frequency"in n&&e.frequency.rampTo(n.frequency,s),"depth"in n&&e.depth.rampTo(n.depth,s));break;case"Vibrato":e instanceof H&&("frequency"in n&&e.frequency.rampTo(n.frequency,s),"depth"in n&&e.depth.rampTo(n.depth,s));break;case"BitCrusher":{const t=e;if(t._isBitCrusher&&"bits"in n){const e=Number(n.bits)||4;t._bitsValue=e;const s=Math.pow(.5,e-1);t._shaper?.setMap(e=>s*Math.floor(e/s+.5),4096)}break}case"PingPongDelay":e instanceof U&&("time"in n&&e.delayTime.rampTo(n.time,s),"feedback"in n&&e.feedback.rampTo(n.feedback,s));break;case"PitchShift":e instanceof F&&"pitch"in n&&(e.pitch=n.pitch);break;case"Compressor":e instanceof w&&("threshold"in n&&e.threshold.rampTo(n.threshold,s),"ratio"in n&&e.ratio.rampTo(n.ratio,s),"attack"in n&&e.attack.rampTo(n.attack,s),"release"in n&&e.release.rampTo(n.release,s));break;case"EQ3":e instanceof f&&("low"in n&&e.low.rampTo(n.low,s),"mid"in n&&e.mid.rampTo(n.mid,s),"high"in n&&e.high.rampTo(n.high,s));break;case"Filter":e instanceof h&&("frequency"in n&&e.frequency.rampTo(n.frequency,s),"Q"in n&&e.Q.rampTo(n.Q,s),"type"in n&&(e.type=n.type),"rolloff"in n&&(e.rolloff=n.rolloff),"gain"in n&&e.gain.rampTo(n.gain,s));break;case"AutoFilter":e instanceof G&&("frequency"in n&&e.frequency.rampTo(n.frequency,s),"baseFrequency"in n&&(e.baseFrequency=n.baseFrequency),"octaves"in n&&(e.octaves=n.octaves));break;case"AutoPanner":e instanceof z&&("frequency"in n&&e.frequency.rampTo(n.frequency,s),"depth"in n&&e.depth.rampTo(n.depth,s));break;case"StereoWidener":e instanceof B&&"width"in n&&e.width.rampTo(Math.min(.85,Number(n.width)),s);break;case"SpaceyDelayer":e instanceof sl&&("firstTap"in n&&e.setFirstTap(Number(n.firstTap)),"tapSize"in n&&e.setTapSize(Number(n.tapSize)),"feedback"in n&&e.setFeedback(Number(n.feedback)),"multiTap"in n&&e.setMultiTap(Number(n.multiTap)),"tapeFilter"in n&&e.setTapeFilter(Number(n.tapeFilter)));break;case"RETapeEcho":e instanceof ul&&("mode"in n&&e.setMode(Number(n.mode)),"repeatRate"in n&&e.setRepeatRate(Number(n.repeatRate)),"intensity"in n&&e.setIntensity(Number(n.intensity)),"echoVolume"in n&&e.setEchoVolume(Number(n.echoVolume)),"wow"in n&&e.setWow(Number(n.wow)),"flutter"in n&&e.setFlutter(Number(n.flutter)),"dirt"in n&&e.setDirt(Number(n.dirt)),"inputBleed"in n&&e.setInputBleed(Number(n.inputBleed)),"loopAmount"in n&&e.setLoopAmount(Number(n.loopAmount)),"playheadFilter"in n&&e.setPlayheadFilter(Number(n.playheadFilter)));break;case"SpaceEcho":e instanceof Yi&&("mode"in n&&e.setMode(Number(n.mode)),"rate"in n&&e.setRate(Number(n.rate)),"intensity"in n&&e.setIntensity(Number(n.intensity)),"echoVolume"in n&&e.setEchoVolume(Number(n.echoVolume)),"reverbVolume"in n&&e.setReverbVolume(Number(n.reverbVolume)),"bass"in n&&e.setBass(Number(n.bass)),"treble"in n&&e.setTreble(Number(n.treble)));break;case"BiPhase":if(e instanceof ml){const t=e;"rateA"in n&&(t.rateA=Number(n.rateA)),"depthA"in n&&(t.depthA=Number(n.depthA)),"rateB"in n&&(t.rateB=Number(n.rateB)),"depthB"in n&&(t.depthB=Number(n.depthB)),"feedback"in n&&(t.feedback=Number(n.feedback))}break;case"DubFilter":e instanceof hl&&("cutoff"in n&&e.setCutoff(Number(n.cutoff)),"resonance"in n&&e.setResonance(Number(n.resonance)),"gain"in n&&e.setGain(Number(n.gain)));break;case"MoogFilter":e instanceof yl&&("cutoff"in n&&e.setCutoff(Number(n.cutoff)),"resonance"in n&&e.setResonance(Number(n.resonance)/100),"drive"in n&&e.setDrive(Number(n.drive)),"model"in n&&e.setModel(Number(n.model)),"filterMode"in n&&e.setFilterMode(Number(n.filterMode)));break;case"MVerb":e instanceof kl&&("damping"in n&&e.setDamping(Number(n.damping)),"density"in n&&e.setDensity(Number(n.density)),"bandwidth"in n&&e.setBandwidth(Number(n.bandwidth)),"decay"in n&&e.setDecay(Number(n.decay)),"predelay"in n&&e.setPredelay(Number(n.predelay)),"size"in n&&e.setSize(Number(n.size)),"gain"in n&&e.setGain(Number(n.gain)),"mix"in n&&e.setMix(Number(n.mix)),"earlyMix"in n&&e.setEarlyMix(Number(n.earlyMix)));break;case"Leslie":e instanceof _l&&("speed"in n&&e.setSpeed(Number(n.speed)),"hornRate"in n&&e.setHornRate(Number(n.hornRate)),"drumRate"in n&&e.setDrumRate(Number(n.drumRate)),"hornDepth"in n&&e.setHornDepth(Number(n.hornDepth)),"drumDepth"in n&&e.setDrumDepth(Number(n.drumDepth)),"doppler"in n&&e.setDoppler(Number(n.doppler)),"mix"in n&&e.setMix(Number(n.mix)),"width"in n&&e.setWidth(Number(n.width)),"acceleration"in n&&e.setAcceleration(Number(n.acceleration)));break;case"SpringReverb":e instanceof Bl&&("decay"in n&&e.setDecay(Number(n.decay)),"damping"in n&&e.setDamping(Number(n.damping)),"tension"in n&&e.setTension(Number(n.tension)),"mix"in n&&e.setSpringMix(Number(n.mix)),"drip"in n&&e.setDrip(Number(n.drip)),"diffusion"in n&&e.setDiffusion(Number(n.diffusion)));break;case"Reverb":e instanceof b&&("decay"in n&&(e.decay=n.decay),"preDelay"in n&&(e.preDelay=n.preDelay));break;case"JCReverb":e instanceof I&&"roomSize"in n&&e.roomSize.rampTo(Math.min(.9,Number(n.roomSize)),s);break;case"SidechainCompressor":e instanceof Zl&&("threshold"in n&&(e.threshold=n.threshold),"ratio"in n&&(e.ratio=n.ratio),"attack"in n&&(e.attack=n.attack),"release"in n&&(e.release=n.release),"knee"in n&&(e.knee=n.knee),"sidechainGain"in n&&(e.sidechainGain=n.sidechainGain));break;case"TapeSaturation":e instanceof Wr&&("drive"in n&&(e.drive=n.drive/100),"tone"in n&&(e.tone=n.tone));break;case"VinylNoise":e instanceof Xl&&("hiss"in n&&e.setHiss(Number(n.hiss)/100),"dust"in n&&e.setDust(Number(n.dust)/100),"age"in n&&e.setAge(Number(n.age)/100),"speed"in n&&e.setSpeed(Number(n.speed)/100),"riaa"in n&&e.setRiaa(Number(n.riaa)/100),"stylusResonance"in n&&e.setStylusResonance(Number(n.stylusResonance)/100),"wornStylus"in n&&e.setWornStylus(Number(n.wornStylus)/100),"pinch"in n&&e.setPinch(Number(n.pinch)/100),"innerGroove"in n&&e.setInnerGroove(Number(n.innerGroove)/100),"ghostEcho"in n&&e.setGhostEcho(Number(n.ghostEcho)/100),"dropout"in n&&e.setDropout(Number(n.dropout)/100),"warp"in n&&e.setWarp(Number(n.warp)/100),"eccentricity"in n&&e.setEccentricity(Number(n.eccentricity)/100));break;case"Tumult":if(e instanceof yw)for(const t of Object.keys(n))e.setParam(t,Number(n[t]));break;case"TapeSimulator":e instanceof Dw&&("drive"in n&&e.setDrive(Number(n.drive)/100),"character"in n&&e.setCharacter(Number(n.character)/100),"bias"in n&&e.setBias(Number(n.bias)/100),"shame"in n&&e.setShame(Number(n.shame)/100),"hiss"in n&&e.setHiss(Number(n.hiss)/100),"speed"in n&&e.setSpeed(Number(n.speed)));break;case"ToneArm":e instanceof Hl&&("wow"in n&&e.setWow(Number(n.wow)/100),"coil"in n&&e.setCoil(Number(n.coil)/100),"flutter"in n&&e.setFlutter(Number(n.flutter)/100),"riaa"in n&&e.setRiaa(Number(n.riaa)/100),"stylus"in n&&e.setStylus(Number(n.stylus)/100),"hiss"in n&&e.setHiss(Number(n.hiss)/100),"pops"in n&&e.setPops(Number(n.pops)/100),"rpm"in n&&e.setRpm(Number(n.rpm)));break;case"AutoWah":e instanceof X&&("baseFrequency"in n&&(e.baseFrequency=n.baseFrequency),"octaves"in n&&(e.octaves=n.octaves),"sensitivity"in n&&(e.sensitivity=n.sensitivity),"Q"in n&&e.Q.rampTo(n.Q,s),"gain"in n&&e.gain.rampTo(n.gain,s),"follower"in n&&(e.follower=n.follower));break;case"Chebyshev":e instanceof j&&("order"in n&&(e.order=n.order),"oversample"in n&&(e.oversample=n.oversample));break;case"FrequencyShifter":e instanceof R&&"frequency"in n&&e.frequency.rampTo(n.frequency,s);break;case"WAMBigMuff":case"WAMTS9":case"WAMDistoMachine":case"WAMQuadraFuzz":case"WAMVoxAmp":case"WAMStonePhaser":case"WAMPingPongDelay":case"WAMFaustDelay":case"WAMPitchShifter":case"WAMGraphicEQ":case"WAMPedalboard":if(e instanceof fy)for(const[t,s]of Object.entries(n))"bpmSync"!==t&&"syncDivision"!==t&&e.setParameter(t,Number(s));break;case"Neural":if(e instanceof Ki)for(const[t,s]of Object.entries(n))e.setParameter(t,Number(s))}}async updateBpmSyncedEffects(e){this.masterEffectConfigs.forEach(({node:t,config:n})=>{if(!Jl(n.parameters))return;const s=$l[n.type];if(!s)return;const a=Ql(n.parameters);for(const o of s){const s=Yl(e,a,o.unit);this.applyBpmSyncedParam(t,n.type,o.param,s)}});try{const{useInstrumentStore:t}=await os(async()=>{const{useInstrumentStore:e}=await Promise.resolve().then(()=>kN);return{useInstrumentStore:e}},void 0),n=t.getState().instruments;this.instrumentEffectChains.forEach((t,s)=>{const a=s>>16,o=n.find(e=>e.id===a);if(!o?.effects)return;o.effects.filter(e=>e.enabled).forEach((n,s)=>{if(s>=t.effects.length)return;if(!Jl(n.parameters))return;const a=$l[n.type];if(!a)return;const o=Ql(n.parameters),r=t.effects[s];for(const t of a){const s=Yl(e,o,t.unit);this.applyBpmSyncedParam(r,n.type,t.param,s)}})})}catch{}}applyBpmSyncedParam(e,t,n,s){try{switch(t){case"Delay":case"FeedbackDelay":"time"===n&&e instanceof C&&e.delayTime.rampTo(s,.02);break;case"PingPongDelay":"time"===n&&e instanceof U&&e.delayTime.rampTo(s,.02);break;case"SpaceEcho":"rate"===n&&e instanceof Yi&&e.setRate(s);break;case"SpaceyDelayer":"firstTap"===n&&e instanceof sl&&e.setFirstTap(s);break;case"RETapeEcho":"repeatRate"===n&&e instanceof ul&&e.setRepeatRate(s);break;case"Chorus":"frequency"===n&&e instanceof q&&e.frequency.rampTo(s,.02);break;case"BiPhase":"rateA"===n&&e instanceof ml&&(e.rateA=s)}}catch(a){}}getChannelOutput(e){if(!this.channelOutputs.has(e)){const t=new m(1),n=new ge({volume:0,pan:0}),s=new E({smoothing:.8});t.connect(n),n.connect(s),n.connect(this.masterInput),this.channelOutputs.set(e,{input:t,channel:n,meter:s})}return this.channelOutputs.get(e).input}createVoice(e,t,n,s){const a=this.channelOutputs.get(e);if(!a)throw new Error(`Channel ${e} not initialized`);const o=new m(1);let r;if("IT"===s.metadata?.importedFrom&&Aw.itFilterWorkletLoaded){const e=this._nativeContext;r=new AudioWorkletNode(e,"it-filter-processor")}else r=new h({type:"lowpass",frequency:2e4,Q:0,rolloff:-12});const i=new ue(0);r instanceof h?(o.connect(r),r.connect(i)):(o.connect(r),me(r,i));const l=this.instrumentOutputOverrides.get(s.id);l?i.connect(l):i.connect(a.input);const c=s.metadata?.envelopes?.[s.id],u=new fw,d=new fw,p=new fw;return c?.volumeEnvelope&&u.init(c.volumeEnvelope),c?.panningEnvelope&&d.init(c.panningEnvelope),c?.pitchEnvelope&&p.init(c.pitchEnvelope),{instrument:t,note:n,volumeEnv:u,panningEnv:d,pitchEnv:p,fadeout:65536,fadeoutStep:s.metadata?.modPlayback?.fadeout||0,isKeyOff:!1,isFilterEnvelope:"filter"===c?.pitchEnvelope?.type,lastCutoff:127,lastResonance:0,nodes:{gain:o,filter:r,panner:i}}}stopVoice(e,t){e.instrument.stop?e.instrument.stop(t):e.instrument.triggerRelease&&e.instrument.triggerRelease(t),setTimeout(()=>{e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()},100)}setChannelVolume(e,t){const n=this.activeVoices.get(e);if(n&&n.length>0){const e=Y(),s=t<=-60?0:Math.pow(10,t/20);for(const t of n)t.nodes.gain&&t.nodes.gain.gain.setValueAtTime(s,e)}this.channelOutputs.get(e)}setChannelFilterCutoff(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const s=n[n.length-1];s.lastCutoff=t;const a=s.lastResonance,o=s.nodes.filter,r=Y();if(t>=127&&0===a||255===t)o instanceof h?(o.frequency.setValueAtTime(24e3,r),o.Q.setValueAtTime(0,r)):o instanceof AudioWorkletNode&&(o.parameters.get("cutoff")?.setValueAtTime(127,r),o.parameters.get("resonance")?.setValueAtTime(0,r));else if(o instanceof h){const e=100*Math.pow(100,t/127);o.frequency.setValueAtTime(e,r)}else o instanceof AudioWorkletNode&&o.parameters.get("cutoff")?.setValueAtTime(t,r)}setChannelFilterResonance(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const s=n[n.length-1];s.lastResonance=t;const a=s.lastCutoff,o=s.nodes.filter,r=Y();if(o instanceof h){const e=t/127*(t/127)*25;o.Q.setValueAtTime(e,r)}else o instanceof AudioWorkletNode&&o.parameters.get("resonance")?.setValueAtTime(t,r);t>0&&a>=127&&this.setChannelFilterCutoff(e,a)}setChannelPan(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const s=(t??0)/100;n[n.length-1].nodes.panner.pan.setValueAtTime(s,Y())}setChannelFunkRepeat(e,t){const n=this.activeVoices.get(e);if(!n||0===n.length)return;const s=n[n.length-1].instrument;if(s instanceof re&&s.loop){if(0===t)return;if(s.buffer.loaded){const e=s,n=e._originalLoopStart??s.loopStart;void 0===e._originalLoopStart&&(e._originalLoopStart=s.loopStart);const a=t/128*(s.loopEnd-n);s.loopStart=n+a}}}handlePastNoteAction(e,t){const n=this.activeVoices.get(e);if(!n||n.length<=1)return;const s=n.slice(0,n.length-1),a=n[n.length-1];0===t?(s.forEach(e=>this.stopVoice(e,Y())),this.activeVoices.set(e,[a])):2===t?s.forEach(e=>e.volumeEnv.keyOff()):3===t&&s.forEach(e=>{e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024)})}setChannelPitch(e,t){const n=this.channelPitchState.get(e);if(!n)return;n.currentPitchMult=t;const s=this.activeVoices.get(e);if(!s||0===s.length){const e=this.instruments.get(n.instrumentKey);if(!e)return;return void this.applyPitchToNode(e,t,n.basePlaybackRate,n.instrumentKey)}const a=s[s.length-1];this.applyPitchToNode(a.instrument,t,n.basePlaybackRate,n.instrumentKey)}applyPitchToNode(e,t,n,s){const a=this.instrumentSynthTypes.get(s),o=1200*Math.log2(t),r=e;e instanceof re||e instanceof ie?e.playbackRate=n*t:"Sampler"===a?void 0!==r.detune&&(r.detune.value=o):void 0!==r.detune&&r.detune instanceof P?r.detune.value=o:void 0!==r.oscillator?.detune?r.oscillator.detune.value=o:void 0!==r.detune&&(r.detune=o)}setChannelFrequency(e,t){const n=this.channelPitchState.get(e);if(!n||0===n.baseFrequency)return;const s=t/n.baseFrequency;this.setChannelPitch(e,s)}initChannelPitch(e,t,n,s=1){this.channelPitchState.set(e,{instrumentKey:t,basePlaybackRate:s,baseFrequency:n,currentPitchMult:1})}clearChannelPitch(e){this.channelPitchState.get(e)&&(this.setChannelPitch(e,1),this.channelPitchState.delete(e))}setChannelMute(e,t){this.channelOutputs.has(e)||this.getChannelOutput(e);const n=this.channelOutputs.get(e);n&&(n.channel.mute=t)}updateMuteStates(e){const t=e.some(e=>e.solo);e.forEach((e,n)=>{const s=t?!e.solo:e.muted;this.channelMuteStates.set(n,s),this.setChannelMute(n,s)})}isChannelMuted(e){return this.channelMuteStates.get(e)??!1}disposeChannelOutputs(){this.channelOutputs.forEach((e,t)=>{try{e.meter.dispose()}catch(n){}try{e.channel.dispose()}catch(n){}try{e.input.dispose()}catch(n){}}),this.channelOutputs.clear()}getChannelLevels(e){const t=[];for(let n=0;n<e;n++){const e=this.channelOutputs.get(n);if(e){const n=e.meter.getValue(),s=Math.max(0,Math.min(1,(n+60)/60));t.push(s)}else t.push(0)}return t}channelTriggerLevels=new Map;triggerLevelsCache=new Array(16).fill(0);triggerGensCache=new Array(16).fill(0);channelTriggerGens=new Map;triggerGenCounter=0;triggerChannelMeter(e,t){this.channelTriggerLevels.set(e,Math.min(1,1.2*t)),this.channelTriggerGens.set(e,++this.triggerGenCounter)}clearChannelTriggerLevels(){this.channelTriggerLevels.clear(),this.channelTriggerGens.clear()}getChannelTriggerLevels(e){if(this.triggerLevelsCache.length<e){const t=this.triggerLevelsCache;this.triggerLevelsCache=new Array(Math.max(e,16)).fill(0);for(let e=0;e<t.length;e++)this.triggerLevelsCache[e]=t[e]}for(let t=0;t<e;t++)this.triggerLevelsCache[t]=this.channelTriggerLevels.get(t)||0;return this.triggerLevelsCache}getChannelTriggerGenerations(e){this.triggerGensCache.length<e&&(this.triggerGensCache=new Array(Math.max(e,16)).fill(0));for(let t=0;t<e;t++)this.triggerGensCache[t]=this.channelTriggerGens.get(t)||0;return this.triggerGensCache}getWaveform(){return this.analyser.getValue()}getFFT(){return this.fft.getValue()}enableAnalysers(){this.analysersConnected||(this.masterChannel.connect(this.analyser),this.masterChannel.connect(this.fft),this.analysersConnected=!0)}disableAnalysers(){this.analysersConnected&&(this.masterChannel.disconnect(this.analyser),this.masterChannel.disconnect(this.fft),this.analysersConnected=!1)}currentPerformanceQuality="high";setPerformanceQuality(e){if(this.currentPerformanceQuality===e)return;this.currentPerformanceQuality=e,this.instruments.forEach(t=>{t instanceof Er&&t.setQuality(e)});const t=[];this.instruments.forEach((e,n)=>{if(e&&"object"==typeof e&&"maxPolyphony"in e){const e=n>>>16,s=65535&n,a=65535===s?void 0:s,o=this.instrumentSynthTypes.get(n);o&&["Synth","FMSynth","AMSynth","PluckSynth"].includes(o)&&t.push({key:n,instrumentId:e,channelIndex:a,config:{synthType:o}})}}),t.length>0&&t.forEach(({key:e})=>{const t=this.instruments.get(e);if(t&&"function"==typeof t.dispose)try{t.dispose()}catch(n){}this.instruments.delete(e),this.instrumentSynthTypes.delete(e)})}updateChannelEnvelopes(e){const t=this.activeVoices.get(e),n=this.channelOutputs.get(e);if(!t||0===t.length||!n)return;const s=Y(),a=n.channel.pan.value;let o=0;const r=t.length;for(let i=0;i<r;i++){const e=t[i],n=e.volumeEnv.tickNext();e.isKeyOff&&e.fadeout>0&&(e.fadeout=Math.max(0,e.fadeout-e.fadeoutStep));const r=n/64*(e.fadeout/65536);e.nodes.gain.gain.setValueAtTime(r,s);const l=e.panningEnv.tickNext();if(32!==l){const t=(l-32)/32,n=Math.max(-1,Math.min(1,a+t));e.nodes.panner.pan.setValueAtTime(n,s)}const c=e.pitchEnv.tickNext();if(e.pitchEnv.isEnabled())if(e.isFilterEnvelope){const t=e.lastCutoff,n=c-32,a=Math.max(0,Math.min(127,t+n));if(e.nodes.filter instanceof h){const t=Aw.FILTER_CUTOFF_LUT[a];e.nodes.filter.frequency.setValueAtTime(t,s)}else e.nodes.filter instanceof AudioWorkletNode&&e.nodes.filter.parameters.get("cutoff")?.setValueAtTime(a,s)}else{const t=(c-32)/32*12,n=e.instrument;void 0!==n.detune&&(n.detune.value=100*t)}e.isKeyOff&&e.fadeout<=0||e.volumeEnv.isFinished()&&e.isKeyOff?(e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()):t[o++]=e}o>0?t.length=o:this.activeVoices.delete(e)}setChannelKeyOff(e){const t=this.activeVoices.get(e);t&&t.forEach(e=>{e.isKeyOff=!0,e.volumeEnv.keyOff(),e.panningEnv.keyOff(),e.pitchEnv.keyOff()})}getPerformanceQuality(){return this.currentPerformanceQuality}}const Bw=()=>Aw.getInstance(),Iw=Object.freeze(Object.defineProperty({__proto__:null,ToneEngine:Aw,getToneEngine:Bw},Symbol.toStringTag,{value:"Module"}));class Fw{mode="classic";patterns=[];songPositions=[];furnaceNative=null;hivelyNative=null;setClassic(e,t){this.mode="classic",this.patterns=e,this.songPositions=t,this.furnaceNative=null,this.hivelyNative=null}setFurnace(e,t,n){this.mode="furnace",this.furnaceNative=e,this.patterns=t,this.songPositions=n,this.hivelyNative=null}setHively(e,t,n){this.mode="hively",this.hivelyNative=e,this.patterns=t,this.songPositions=n,this.furnaceNative=null}getMode(){return this.mode}getRow(e,t,n){switch(this.mode){case"furnace":return this.getFurnaceRow(e,t,n);case"hively":return this.getHivelyRow(e,t,n);default:return this.getClassicRow(e,t,n)}}getPatternLength(e){switch(this.mode){case"furnace":{if(!this.furnaceNative)return 64;const e=this.furnaceNative.subsongs[this.furnaceNative.activeSubsong];return e?.patLen??64}case"hively":return this.hivelyNative?.trackLength??64;default:{const t=this.songPositions[e];return this.patterns[t]?.length??64}}}getChannelCount(){switch(this.mode){case"furnace":{if(!this.furnaceNative)return 0;const e=this.furnaceNative.subsongs[this.furnaceNative.activeSubsong];return e?.channels.length??0}case"hively":return this.hivelyNative?.channels??0;default:{const e=this.songPositions[0];return this.patterns[e]?.channels.length??0}}}getOrderLength(){switch(this.mode){case"furnace":{if(!this.furnaceNative)return 0;const e=this.furnaceNative.subsongs[this.furnaceNative.activeSubsong];return e?.ordersLen??0}case"hively":return this.hivelyNative?.positions.length??0;default:return this.songPositions.length}}getEffectColumns(e){if("furnace"===this.mode){if(!this.furnaceNative)return 2;const t=this.furnaceNative.subsongs[this.furnaceNative.activeSubsong];return t?.channels[e]?.effectCols??2}return 2}getClassicRow(e,t,n){const s=this.songPositions[e],a=this.patterns[s];if(!a)return{...Us};const o=a.channels[n];return o?o.rows[t]??{...Us}:{...Us}}getFurnaceRow(e,t,n){if(!this.furnaceNative)return{...Us};const s=this.furnaceNative.subsongs[this.furnaceNative.activeSubsong];if(!s)return{...Us};const a=s.orders[n]?.[e];if(void 0===a)return{...Us};const o=s.channels[n]?.patterns.get(a);if(!o)return{...Us};const r=o.rows[t];return r?this.convertFurnaceRow(r):{...Us}}convertFurnaceRow(e){let t=0;-1===e.note||252===e.note?t=0:253===e.note||254===e.note||255===e.note?t=97:e.note>=0&&e.note<180&&(t=Math.min(96,Math.max(1,e.note+1)));const n=-1===e.ins?0:e.ins+1;let s=0;-1!==e.vol&&(s=16+Math.round(e.vol/127*64));const a=e.effects[0],o=e.effects[1];return{note:t,instrument:n,volume:s,effTyp:a?.cmd??0,eff:a?.val??0,effTyp2:o?.cmd??0,eff2:o?.val??0}}getHivelyRow(e,t,n){if(!this.hivelyNative)return{...Us};const s=this.hivelyNative.positions[e];if(!s)return{...Us};const a=s.track[n],o=s.transpose[n]??0,r=this.hivelyNative.tracks[a];if(!r)return{...Us};const i=r.steps[t];return i?this.convertHivelyStep(i,o):{...Us}}convertHivelyStep(e,t){let n=0;e.note>0&&e.note<=60&&(n=Math.min(96,Math.max(1,e.note+t)));return{note:n,instrument:e.instrument,volume:0,effTyp:e.fx,eff:e.fxParam,effTyp2:e.fxb,eff2:e.fxbParam}}}class Uw{inputTone;outputTone;splitter;merger;gainLL;gainLR;gainRL;gainRR;constructor(){const e=N().rawContext;this.inputTone=new m(1),this.outputTone=new m(1),this.splitter=e.createChannelSplitter(2),this.merger=e.createChannelMerger(2),this.gainLL=e.createGain(),this.gainLR=e.createGain(),this.gainRL=e.createGain(),this.gainRR=e.createGain(),this.inputTone.connect(this.splitter),this.splitter.connect(this.gainLL,0),this.splitter.connect(this.gainLR,0),this.splitter.connect(this.gainRL,1),this.splitter.connect(this.gainRR,1),this.gainLL.connect(this.merger,0,0),this.gainRL.connect(this.merger,0,0),this.gainLR.connect(this.merger,0,1),this.gainRR.connect(this.merger,0,1),this.merger.connect(this.outputTone.input),this.setSeparation(100)}setSeparation(e){const t=function(e){const t=Math.max(0,Math.min(200,e))/100;return{gainLL:(1+t)/2,gainRR:(1+t)/2,gainLR:(1-t)/2,gainRL:(1-t)/2}}(e);this.gainLL.gain.value=t.gainLL,this.gainRR.gain.value=t.gainRR,this.gainLR.gain.value=t.gainLR,this.gainRL.gain.value=t.gainRL}dispose(){this.inputTone.dispose(),this.splitter.disconnect(),this.gainLL.disconnect(),this.gainLR.disconnect(),this.gainRL.disconnect(),this.gainRR.disconnect(),this.merger.disconnect(),this.outputTone.dispose()}}function Rw(){return{period:0,frequency:440,finetune:0,volume:64,fadeOutVolume:65536,pan:128,vibratoPos:0,vibratoSpeed:0,vibratoDepth:0,vibratoWaveform:"sine",vibratoRetrigger:!0,tremoloPos:0,tremoloSpeed:0,tremoloDepth:0,tremoloWaveform:"sine",tremoloRetrigger:!0,portamentoSpeed:0,portamentoTarget:0,glissando:!1,tremorOnTime:1,tremorOffTime:1,tremorPos:0,retrigTick:0,retrigVolChange:0,loopRow:0,loopCount:0,noteCutTick:-1,noteDelayTick:-1,keyOffTick:-1,lastPortaUp:0,lastPortaDown:0,lastTonePortaSpeed:0,lastVibratoSpeed:0,lastVibratoDepth:0,lastTremoloSpeed:0,lastTremoloDepth:0,lastVolumeSlide:0,lastPanSlide:0,lastSampleOffset:0,lastArpeggio:0,lastRetrig:0,lastTremor:0,instrumentId:null,sampleId:null,noteOn:!1}}const jw=[e=>e,e=>e-1,e=>e-2,e=>e-4,e=>e-8,e=>e-16,e=>2*e/3,e=>e/2,e=>e,e=>e+1,e=>e+2,e=>e+4,e=>e+8,e=>e+16,e=>3*e/2,e=>2*e];class Xw{periodToHz(e){return ew(e)}config={format:"NATIVE",initialSpeed:6,initialTempo:125,numChannels:4};channels=new Map;globalVolume=64;speed=6;tempo=125;currentTick=0;currentRow=0;init(e){this.config=e,this.speed=e.initialSpeed,this.tempo=e.initialTempo,this.channels.clear();for(let t=0;t<e.numChannels;t++)this.channels.set(t,Rw())}getChannelState(e){return this.channels.has(e)||this.channels.set(e,{period:0,frequency:440,finetune:0,volume:64,fadeOutVolume:65536,pan:128,vibratoPos:0,vibratoSpeed:0,vibratoDepth:0,vibratoWaveform:"sine",vibratoRetrigger:!0,tremoloPos:0,tremoloSpeed:0,tremoloDepth:0,tremoloWaveform:"sine",tremoloRetrigger:!0,portamentoSpeed:0,portamentoTarget:0,glissando:!1,tremorOnTime:1,tremorOffTime:1,tremorPos:0,retrigTick:0,retrigVolChange:0,loopRow:0,loopCount:0,noteCutTick:-1,noteDelayTick:-1,keyOffTick:-1,lastPortaUp:0,lastPortaDown:0,lastTonePortaSpeed:0,lastVibratoSpeed:0,lastVibratoDepth:0,lastTremoloSpeed:0,lastTremoloDepth:0,lastVolumeSlide:0,lastPanSlide:0,lastSampleOffset:0,lastArpeggio:0,lastRetrig:0,lastTremor:0,instrumentId:null,sampleId:null,noteOn:!1}),this.channels.get(e)}resetChannel(e){this.channels.set(e,{period:0,frequency:440,finetune:0,volume:64,fadeOutVolume:65536,pan:128,vibratoPos:0,vibratoSpeed:0,vibratoDepth:0,vibratoWaveform:"sine",vibratoRetrigger:!0,tremoloPos:0,tremoloSpeed:0,tremoloDepth:0,tremoloWaveform:"sine",tremoloRetrigger:!0,portamentoSpeed:0,portamentoTarget:0,glissando:!1,tremorOnTime:1,tremorOffTime:1,tremorPos:0,retrigTick:0,retrigVolChange:0,loopRow:0,loopCount:0,noteCutTick:-1,noteDelayTick:-1,keyOffTick:-1,lastPortaUp:0,lastPortaDown:0,lastTonePortaSpeed:0,lastVibratoSpeed:0,lastVibratoDepth:0,lastTremoloSpeed:0,lastTremoloDepth:0,lastVolumeSlide:0,lastPanSlide:0,lastSampleOffset:0,lastArpeggio:0,lastRetrig:0,lastTremor:0,instrumentId:null,sampleId:null,noteOn:!1})}resetAll(){this.channels.clear();for(let e=0;e<this.config.numChannels;e++)this.channels.set(e,Rw());this.globalVolume=64,this.speed=this.config.initialSpeed,this.tempo=this.config.initialTempo,this.currentTick=0,this.currentRow=0}parseEffect(e){if(!e||"..."===e||"000"===e)return null;const t=e.toUpperCase().padEnd(3,"0");let n;const s=t[0];if(s>="0"&&s<="9")n=parseInt(s,16);else{if(!(s>="A"&&s<="Z"))return null;n=s.charCodeAt(0)-55}const a=parseInt(t[1],16),o=parseInt(t[2],16);return isNaN(n)||isNaN(a)||isNaN(o)?null:{command:n,x:a,y:o,param:16*a+o}}noteStringToPeriod(e,t=0){return iw(e,t,this.format)}periodToNoteString(e,t=0){return lw(e,t,this.format)}getWaveformValue(e,t){const n=63&t;switch(e){case"sine":{const e=tw[n>>1&31];return n<32?e/255:-e/255}case"rampDown":return 1-n/32;case"rampUp":return n/32-1;case"square":return n<32?1:-1;case"random":return 2*Math.random()-1;default:return 0}}clampVolume(e){return Math.max(0,Math.min(64,Math.floor(e)))}clampPan(e){return Math.max(0,Math.min(255,Math.floor(e)))}waveformFromNumber(e){return["sine","rampDown","square","random"][3&e]}processAutoVibrato(e,t,n){const s=e.activeInstrument;if(!s?.autoVibrato||0===s.autoVibrato.depth)return;if("XM"===this.format&&0===n)return;const a=s.autoVibrato;void 0===e.autoVibratoPos&&(e.autoVibratoPos=0),void 0===e.autoVibratoSweep&&("IT"===this.format?e.autoVibratoSweep=255===a.sweep?255:0:e.autoVibratoSweep=0===a.sweep?255:0),n>0&&e.autoVibratoSweep<255&&(e.autoVibratoSweep=Math.min(255,e.autoVibratoSweep+a.sweep));const o=this.getWaveformValue(a.type||"sine",e.autoVibratoPos>>2);if("XM"===this.format){let n=0;n=this.config.linearSlides?Math.floor(o*a.depth*e.autoVibratoSweep/128):Math.floor(o*a.depth*e.autoVibratoSweep/256);const s=void 0!==t.setPeriod?t.setPeriod:e.period;t.setPeriod=s+n,t.setFrequency=this.periodToHz(t.setPeriod)}else if("IT"===this.format){const n=e.frequency||0,s=o*(a.depth/200)*(e.autoVibratoSweep/255)*n;t.setFrequency?t.setFrequency+=s:t.setFrequency=e.frequency+s}n>0&&(e.autoVibratoPos=e.autoVibratoPos+a.rate&255)}processPortaUp(e,t,n,s=1){if(e.period<=0)return;const a="MOD"===this.format?1:4;e.period-=t*a;const o=this.config.amigaLimits?113:s;e.period<o&&(e.period=o),e.frequency=this.periodToHz(e.period),n.setPeriod=e.period,n.setFrequency=e.frequency}processPortaDown(e,t,n,s=32e3){if(e.period<=0)return;const a="MOD"===this.format?1:4;e.period+=t*a;const o=this.config.amigaLimits?856:s;e.period>o&&(e.period=o),e.frequency=this.periodToHz(e.period),n.setPeriod=e.period,n.setFrequency=e.frequency}processTonePorta(e,t,n){if(e.period<=0||e.portamentoTarget<=0)return;const s=t*("MOD"===this.format?1:4);if(e.period<e.portamentoTarget?(e.period+=s,e.period>e.portamentoTarget&&(e.period=e.portamentoTarget)):e.period>e.portamentoTarget&&(e.period-=s,e.period<e.portamentoTarget&&(e.period=e.portamentoTarget)),this.config.amigaLimits&&(e.period<113&&(e.period=113),e.period>856&&(e.period=856)),e.glissando){const t=nw[0];let n=t[0],s=Math.abs(e.period-n);for(const a of t){const t=Math.abs(e.period-a);t<s&&(s=t,n=a)}e.period=n}e.frequency=this.periodToHz(e.period),n.setPeriod=e.period,n.setFrequency=e.frequency}processVibrato(e,t,n=1){if(e.period<=0)return;const s=this.getWaveformValue(e.vibratoWaveform,e.vibratoPos),a=Math.floor(s*e.vibratoDepth*n),o=e.period+a;t.setPeriod=o,t.setFrequency=this.periodToHz(o),e.vibratoPos=e.vibratoPos+e.vibratoSpeed&63}processTremolo(e,t){e.tremoloPos=e.tremoloPos+e.tremoloSpeed&63;const n=this.getWaveformValue(e.tremoloWaveform,e.tremoloPos),s=Math.floor(n*e.tremoloDepth),a=this.clampVolume(e.volume+s);t.setVolume=a}processVolumeSlide(e,t,n,s){t>0?e.volume=this.clampVolume(e.volume+t):n>0&&(e.volume=this.clampVolume(e.volume-n)),s.setVolume=e.volume}processFineVolumeSlide(e,t,n,s){t>0?e.volume=this.clampVolume(e.volume+t):n>0&&(e.volume=this.clampVolume(e.volume-n)),s.setVolume=e.volume}processGlobalVolumeSlide(e,t,n){e>0?this.globalVolume=Math.min(64,this.globalVolume+e):t>0&&(this.globalVolume=Math.max(0,this.globalVolume-t)),n.setGlobalVolume=this.globalVolume}processTremor(e,t){const n=e.tremorOnTime+e.tremorOffTime;0!==n&&(e.tremorPos=(e.tremorPos+1)%n,e.tremorPos<e.tremorOnTime?t.setVolume=e.volume:t.setVolume=0)}patternLoopRow=new Map;patternLoopCount=new Map;processPatternLoop(e,t,n){if(0===t)this.patternLoopRow.set(e,this.currentRow);else{const s=this.patternLoopCount.get(e)??0;0===s?this.patternLoopCount.set(e,t):this.patternLoopCount.set(e,s-1),(this.patternLoopCount.get(e)??0)>0&&(n.patternLoop={startRow:this.patternLoopRow.get(e)??0,count:this.patternLoopCount.get(e)??0})}}setVibratoWaveform(e,t){e.vibratoWaveform=this.waveformFromNumber(3&t),e.vibratoRetrigger=!(4&t)}setTremoloWaveform(e,t){e.tremoloWaveform=this.waveformFromNumber(3&t),e.tremoloRetrigger=!(4&t)}processFinePortaUp(e,t,n,s,a){t>0&&e.period>0&&(e.period-=t*n,e.period<s&&(e.period=s),e.frequency=this.periodToHz(e.period),a.setPeriod=e.period,a.setFrequency=e.frequency)}processFinePortaDown(e,t,n,s,a){t>0&&e.period>0&&(e.period+=t*n,e.period>s&&(e.period=s),e.frequency=this.periodToHz(e.period),a.setPeriod=e.period,a.setFrequency=e.frequency)}}const zw=0,Gw=1,Hw=2,Ww=3,qw=4,Kw=5,$w=6,Yw=7,Jw=9,Qw=10,Zw=11,eE=12,tE=13,nE=14,sE=15,aE=0,oE=1,rE=2,iE=3,lE=4,cE=5,uE=6,dE=7,mE=9,pE=10,hE=11,fE=12,gE=13,bE=14,vE=15;class yE extends Xw{format="MOD";emulatePTBugs=!0;ciaBPMDelay=null;activeEffects=new Map;patternDelayCount=0;periodToHz(e){return e<=0?0:ew(e)}init(e){super.init(e),this.emulatePTBugs=e.emulatePTBugs??!0,this.activeEffects.clear(),this.patternDelayCount=0,this.ciaBPMDelay=null}resetAll(){super.resetAll(),this.activeEffects.clear(),this.patternDelayCount=0,this.ciaBPMDelay=null}processRowStart(e,t,n,s,a,o){const r={};if(this.activeEffects.delete(e),this.emulatePTBugs&&null!==this.ciaBPMDelay&&(r.setBPM=this.ciaBPMDelay,this.ciaBPMDelay=null),null!==n&&n>0){o.instrumentId=n;const e=o.activeInstrument,s=e?.defaultVolume??64,a=e?.finetune??0;o.volume=s,r.setVolume=o.volume;const i=o.finetune;if(o.finetune=a,!t||"..."===t||"---"===t){if(o.period>0&&i!==a){const e=lw(o.period,i,this.format);o.period=this.noteStringToPeriod(e,a),o.frequency=this.periodToHz(o.period),r.setPeriod=o.period,r.setFrequency=o.frequency}r.triggerNote=!1}}if(null!==s&&255!==s&&s<=64&&(o.volume=s,r.setVolume=o.volume),a){const n=this.processEffectTick0(e,a,o,t);Object.assign(r,n);const s=this.processTick(e,0,o);"MOD"===this.format&&(delete s.setPeriod,s.setVolume===o.volume&&delete s.setVolume),Object.assign(r,s)}if(t&&"..."!==t&&"---"!==t&&!r.preventNoteTrigger)if("==="===t||"^^^"===t)r.cutNote=!0,o.noteOn=!1;else{const e=this.noteStringToPeriod(t,o.finetune);if(e>0){const t=this.parseEffect(a);if(t&&(t.command===Ww||t.command===Kw)){let t=e;if(this.emulatePTBugs){const n=rw(e,o.finetune),s=aw(o.finetune);s>=8&&n>0&&(t=nw[s][n-1])}o.portamentoTarget=t}else o.period=e,o.frequency=this.periodToHz(e),o.noteOn=!0,r.triggerNote=!0,r.setPeriod=e,o.vibratoRetrigger&&(o.vibratoPos=0),o.tremoloRetrigger&&(o.tremoloPos=0)}}return r}processEffectTick0(e,t,n,s){const a={},o=this.parseEffect(t);if(!o)return a;const{command:r,x:i,y:l,param:c}=o;switch(r){case zw:0!==c&&(n.lastArpeggio=c,this.activeEffects.set(e,{type:"arpeggio",param:c,x:i,y:l}));break;case Gw:c>0&&(n.lastPortaUp=c),this.activeEffects.set(e,{type:"portaUp",param:n.lastPortaUp,x:i,y:l});break;case Hw:c>0&&(n.lastPortaDown=c),this.activeEffects.set(e,{type:"portaDown",param:n.lastPortaDown,x:i,y:l});break;case Ww:c>0&&(n.lastTonePortaSpeed=c),this.activeEffects.set(e,{type:"tonePorta",param:n.lastTonePortaSpeed,x:i,y:l});break;case qw:i>0&&(n.lastVibratoSpeed=i),l>0&&(n.lastVibratoDepth=l),n.vibratoSpeed=n.lastVibratoSpeed,n.vibratoDepth=n.lastVibratoDepth,this.activeEffects.set(e,{type:"vibrato",param:c,x:i,y:l});break;case Kw:this.activeEffects.set(e,{type:"tonePortaVolSlide",param:c,x:i,y:l});break;case $w:this.activeEffects.set(e,{type:"vibratoVolSlide",param:c,x:i,y:l});break;case Yw:i>0&&(n.lastTremoloSpeed=i),l>0&&(n.lastTremoloDepth=l),n.tremoloSpeed=n.lastTremoloSpeed,n.tremoloDepth=n.lastTremoloDepth,this.activeEffects.set(e,{type:"tremolo",param:c,x:i,y:l});break;case Jw:{c>0&&(n.lastSampleOffset=c);const e=n.lastSampleOffset<<8;a.sampleOffset=e;break}case Qw:c>0&&(n.lastVolumeSlide=c),this.activeEffects.set(e,{type:"volumeSlide",param:n.lastVolumeSlide,x:i,y:l});break;case Zw:a.positionJump=c;break;case eE:{const e=Math.min(c,64);n.volume=e,a.setVolume=e;break}case tE:{const e=10*i+l;a.patternBreak=e>63?0:e;break}case nE:this.processECommandTick0(e,i,l,n,s,a);break;case sE:0===c?a.stopSong=!0:c<32?(this.speed=c,a.setSpeed=c):this.emulatePTBugs?this.ciaBPMDelay=c:(this.tempo=c,a.setBPM=c)}return a}processECommandTick0(e,t,n,s,a,o){switch(t){case aE:o.setAmigaFilter=0===n;break;case oE:n>0&&s.period>0&&(s.period=Math.max(54,s.period-n),s.frequency=this.periodToHz(s.period),o.setPeriod=s.period);break;case rE:n>0&&s.period>0&&(s.period=Math.min(ZN,s.period+n),s.frequency=this.periodToHz(s.period),o.setPeriod=s.period);break;case iE:s.glissando=0!==n;break;case lE:this.setVibratoWaveform(s,n);break;case cE:s.finetune=n>7?n-16:n;break;case uE:this.processPatternLoop(e,n,o);break;case dE:this.setTremoloWaveform(s,n);break;case mE:n>0&&(s.retrigTick=n,this.activeEffects.set(e,{type:"retrig",param:n,x:0,y:n}));break;case pE:this.processFineVolumeSlide(s,n,0,o);break;case hE:this.processFineVolumeSlide(s,0,n,o);break;case fE:s.noteCutTick=n,this.activeEffects.set(e,{type:"noteCut",param:n,x:0,y:n});break;case gE:n>0&&a&&(s.noteDelayTick=n,this.activeEffects.set(e,{type:"noteDelay",param:n,x:0,y:n}),o.preventNoteTrigger=!0);break;case bE:n>0&&(this.patternDelayCount=n,o.patternDelay=n);break;case vE:0===n?s.funkRepeatPos=0:(void 0===s.funkRepeatPos&&(s.funkRepeatPos=0),this.activeEffects.set(e,{type:"invertLoop",param:n,x:0,y:n}))}}processTick(e,t,n){const s={};this.emulatePTBugs&&1===t&&null!==this.ciaBPMDelay&&(s.setBPM=this.ciaBPMDelay,this.ciaBPMDelay=null);const a=this.activeEffects.get(e);if(!a)return s;const{type:o,param:r,x:i,y:l}=a;switch(o){case"arpeggio":this.processArpeggio(t,n,i,l,s);break;case"portaUp":this.processPortaUp(n,r,s,54);break;case"portaDown":this.processPortaDown(n,r,s,ZN);break;case"tonePorta":this.processTonePorta(n,r,s),n.glissando&&void 0!==s.setPeriod&&(s.setPeriod=mw(s.setPeriod,n.finetune),s.setFrequency=this.periodToHz(s.setPeriod));break;case"vibrato":this.processVibrato(n,s);break;case"tonePortaVolSlide":this.processTonePorta(n,n.lastTonePortaSpeed,s),this.processVolumeSlide(n,i,l,s);break;case"vibratoVolSlide":this.processVibrato(n,s),this.processVolumeSlide(n,i,l,s);break;case"tremolo":this.processTremolo(n,s);break;case"volumeSlide":this.processVolumeSlide(n,i,l,s);break;case"retrig":t>0&&t%r===0&&(s.triggerNote=!0,this.emulatePTBugs&&n.lastSampleOffset>0&&(s.sampleOffset=n.lastSampleOffset<<8));break;case"noteCut":t===r&&(n.volume=0,s.setVolume=0,s.cutNote=!0);break;case"noteDelay":t===r&&(s.triggerNote=!0);break;case"invertLoop":void 0!==n.funkRepeatPos&&(n.funkRepeatPos+=r,n.funkRepeatPos>128&&(n.funkRepeatPos=0),s.funkRepeat=n.funkRepeatPos)}return s}getWaveformValueInt(e,t){const n=63&t;switch(e){case"sine":{const e=tw[31&n];return n<32?e:-e}case"rampDown":return 255-4*n;case"square":return n<32?255:-255;default:return 0}}processVibrato(e,t){if(e.period<=0)return;e.vibratoPos=e.vibratoPos+e.vibratoSpeed&63;const n=this.getWaveformValueInt(e.vibratoWaveform,e.vibratoPos)*e.vibratoDepth>>7,s=e.period+n;t.setPeriod=s,t.setFrequency=this.periodToHz(s)}processTremolo(e,t){e.tremoloPos=e.tremoloPos+e.tremoloSpeed&63;const n=this.getWaveformValueInt(e.tremoloWaveform,e.tremoloPos)*e.tremoloDepth>>6,s=this.clampVolume(e.volume+n);t.setVolume=s}processArpeggio(e,t,n,s,a){if(t.period<=0)return;const o=[0,n,s][e%3];if(0===o)a.setPeriod=t.period;else{const e=aw(t.finetune),n=rw(t.period,t.finetune);let s;if(-1!==n){let r=n+o;if(this.emulatePTBugs){if(72===r)return a.setPeriod=0,void(a.setFrequency=0);r>=73&&(r-=37)}s=r>=36&&r<72?nw[e][r-36]:dw(t.period,o,t.finetune,this.emulatePTBugs)}else s=dw(t.period,o,t.finetune,this.emulatePTBugs);a.setPeriod=s,a.setFrequency=a.setPeriod>0?this.periodToHz(a.setPeriod):0}}}const xE=0,NE=1,wE=2,EE=3,kE=4,DE=5,SE=6,ME=7,CE=8,VE=9,PE=10,_E=11,OE=12,TE=13,LE=14,AE=15,BE=1,IE=2,FE=3,UE=4,RE=5,jE=6,XE=7,zE=8,GE=9,HE=10,WE=11,qE=12,KE=13,$E=14,YE=6,JE=7,QE=8,ZE=9,ek=10,tk=11,nk=12,sk=13,ak=14,ok=15;class rk extends Xw{format="XM";linearSlides=!0;minPeriod=1;maxPeriod=32e3;activeEffects=new Map;volumeColumnData=new Map;patternDelayCount=0;noteStringToPeriod(e,t=0){return this.linearSlides?cw(e,t):super.noteStringToPeriod(e,t)}periodToHz(e){return e<=0?0:this.linearSlides?uw(e):ew(e)}init(e){super.init(e),this.linearSlides=e.linearSlides??!0,this.activeEffects.clear(),this.volumeColumnData.clear(),this.patternDelayCount=0}resetAll(){super.resetAll(),this.activeEffects.clear(),this.volumeColumnData.clear(),this.patternDelayCount=0}processRowStart(e,t,n,s,a,o){const r={};if(this.activeEffects.delete(e),null!==n&&n>0){o.instrumentId=n;const e=o,i=e.sampleDefaultVolume??64,l=e.sampleDefaultFinetune??0,c=this.parseEffect(a);c&&c.command===OE||null!==s&&s>=16&&s<=80||(o.volume=i,r.setVolume=o.volume);const u=o.finetune;if(o.finetune=l,!t||"..."===t||"---"===t){if(o.period>0&&u!==l){const e=lw(o.period,u,this.format);o.period=this.noteStringToPeriod(e,l),o.frequency=this.periodToHz(o.period),r.setPeriod=o.period,r.setFrequency=o.frequency}r.triggerNote=!1}}if(this.volumeColumnData.set(e,s??0),null!==s&&s>0&&this.processVolumeColumnTick0(e,s,o,r),t&&"..."!==t&&"---"!==t)if("==="===t||"^^^"===t)r.keyOff=!0,o.noteOn=!1;else{const e=this.noteStringToPeriod(t,o.finetune);if(e>0){const t=this.parseEffect(a),n=(s??0)>>4;t&&(t.command===EE||t.command===DE)||n===ok?o.portamentoTarget=e:(o.period=e,o.frequency=this.periodToHz(e),o.noteOn=!0,r.triggerNote=!0,r.setPeriod=e,r.setFrequency=o.frequency,o.vibratoRetrigger&&(o.vibratoPos=0),o.tremoloRetrigger&&(o.tremoloPos=0))}}if(a){const n=this.processEffectTick0(e,a,o,t);if(Object.assign(r,n),"XM"!==this.format){const t=this.processTick(e,0,o);Object.assign(r,t)}}return r}processVolumeColumnTick0(e,t,n,s){const a=15&t;switch(t>>4){case 1:case 2:case 3:case 4:case 5:{const e=t-16;e>=0&&e<=64&&(n.volume=e,s.setVolume=e);break}case QE:this.processFineVolumeSlide(n,0,a,s);break;case ZE:this.processFineVolumeSlide(n,a,0,s);break;case ek:a>0&&(n.vibratoSpeed=a,n.lastVibratoSpeed=a);break;case nk:n.pan=a<<4,s.setPan=n.pan}}processEffectTick0(e,t,n,s){const a={},o=this.parseEffect(t);if(!o)return a;const{command:r,x:i,y:l,param:c}=o,u=t.toUpperCase()[0];switch(r){case xE:0!==c&&(n.lastArpeggio=c,this.activeEffects.set(e,{type:"arpeggio",param:c,x:i,y:l}));break;case NE:c>0&&(n.lastPortaUp=c),this.activeEffects.set(e,{type:"portaUp",param:n.lastPortaUp,x:i,y:l});break;case wE:c>0&&(n.lastPortaDown=c),this.activeEffects.set(e,{type:"portaDown",param:n.lastPortaDown,x:i,y:l});break;case EE:c>0&&(n.lastTonePortaSpeed=c),this.activeEffects.set(e,{type:"tonePorta",param:n.lastTonePortaSpeed,x:i,y:l});break;case kE:i>0&&(n.lastVibratoSpeed=i),l>0&&(n.lastVibratoDepth=l),n.vibratoSpeed=n.lastVibratoSpeed,n.vibratoDepth=n.lastVibratoDepth,this.activeEffects.set(e,{type:"vibrato",param:c,x:i,y:l});break;case DE:this.activeEffects.set(e,{type:"tonePortaVolSlide",param:c,x:i,y:l});break;case SE:this.activeEffects.set(e,{type:"vibratoVolSlide",param:c,x:i,y:l});break;case ME:i>0&&(n.lastTremoloSpeed=i),l>0&&(n.lastTremoloDepth=l),n.tremoloSpeed=n.lastTremoloSpeed,n.tremoloDepth=n.lastTremoloDepth,this.activeEffects.set(e,{type:"tremolo",param:c,x:i,y:l});break;case CE:n.pan=c,a.setPan=c;break;case VE:c>0&&(n.lastSampleOffset=c),a.sampleOffset=256*n.lastSampleOffset;break;case PE:c>0&&(n.lastVolumeSlide=c),this.activeEffects.set(e,{type:"volumeSlide",param:n.lastVolumeSlide,x:i,y:l});break;case _E:a.positionJump=c;break;case OE:{const e=Math.min(c,64);n.volume=e,a.setVolume=e;break}case TE:a.patternBreak=c;break;case LE:this.processECommandTick0(e,i,l,n,s,a);break;case AE:0===c||(c<32?(this.speed=c,a.setSpeed=c):(this.tempo=c,a.setBPM=c))}if("G"===u){const e=Math.min(c,64);this.globalVolume=e,a.setGlobalVolume=e}else"H"===u?this.activeEffects.set(e,{type:"globalVolSlide",param:c,x:i,y:l}):"K"===u?(n.keyOffTick=c,this.activeEffects.set(e,{type:"keyOff",param:c,x:i,y:l})):"L"===u||("P"===u?(c>0&&(n.lastPanSlide=c),this.activeEffects.set(e,{type:"panSlide",param:n.lastPanSlide,x:i,y:l})):"R"===u?(l>0&&(n.retrigTick=l),i>=0&&(n.retrigVolChange=i),this.activeEffects.set(e,{type:"multiRetrig",param:c,x:i,y:l})):"T"===u?(i>0&&(n.tremorOnTime=i),l>0&&(n.tremorOffTime=l),this.activeEffects.set(e,{type:"tremor",param:c,x:i,y:l})):"X"===u&&(1===i?n.period>0&&(n.period-=l,n.period<this.minPeriod&&(n.period=this.minPeriod),n.frequency=this.periodToHz(n.period),a.setPeriod=n.period,a.setFrequency=n.frequency):2===i&&n.period>0&&(n.period+=l,n.period>this.maxPeriod&&(n.period=this.maxPeriod),n.frequency=this.periodToHz(n.period),a.setPeriod=n.period,a.setFrequency=n.frequency)));return a}processECommandTick0(e,t,n,s,a,o){switch(t){case BE:n>0&&s.period>0&&(s.period-=4*n,s.period<this.minPeriod&&(s.period=this.minPeriod),s.frequency=this.periodToHz(s.period),o.setPeriod=s.period,o.setFrequency=s.frequency);break;case IE:n>0&&s.period>0&&(s.period+=4*n,s.period>this.maxPeriod&&(s.period=this.maxPeriod),s.frequency=this.periodToHz(s.period),o.setPeriod=s.period,o.setFrequency=s.frequency);break;case FE:s.glissando=n>0;break;case UE:this.setVibratoWaveform(s,n);break;case RE:s.finetune=n>7?16*(n-16):16*n;break;case jE:this.processPatternLoop(e,n,o);break;case XE:this.setTremoloWaveform(s,n);break;case zE:s.pan=17*n,o.setPan=s.pan;break;case GE:n>0&&(s.retrigTick=n,this.activeEffects.set(e,{type:"retrig",param:n,x:0,y:n}));break;case HE:this.processFineVolumeSlide(s,n,0,o);break;case WE:this.processFineVolumeSlide(s,0,n,o);break;case qE:s.noteCutTick=n,this.activeEffects.set(e,{type:"noteCut",param:n,x:0,y:n});break;case KE:n>0&&a&&(s.noteDelayTick=n,this.activeEffects.set(e,{type:"noteDelay",param:n,x:0,y:n}));break;case $E:n>0&&(this.patternDelayCount=n,o.patternDelay=n)}}processTick(e,t,n){const s={};this.processAutoVibrato(n,s,t);const a=this.volumeColumnData.get(e)??0;a>0&&this.processVolumeColumnTickN(e,t,a,n,s);const o=this.activeEffects.get(e);if(o){const{type:e,param:a,x:r,y:i}=o;switch(e){case"arpeggio":t>0&&this.processArpeggio(t,n,r,i,s);break;case"portaUp":this.processPortaUp(n,a,s,this.minPeriod);break;case"portaDown":this.processPortaDown(n,a,s,this.maxPeriod);break;case"tonePorta":this.processTonePorta(n,a,s);break;case"vibrato":this.processVibrato(n,s,4);break;case"tonePortaVolSlide":this.processTonePorta(n,n.lastTonePortaSpeed,s),this.processVolumeSlide(n,r,i,s);break;case"vibratoVolSlide":this.processVibrato(n,s,4),this.processVolumeSlide(n,r,i,s);break;case"tremolo":this.processTremolo(n,s);break;case"volumeSlide":this.processVolumeSlide(n,r,i,s);break;case"globalVolSlide":this.processGlobalVolumeSlide(r,i,s);break;case"panSlide":r>0?n.pan=this.clampPan(n.pan+r):i>0?n.pan=this.clampPan(n.pan-i):0===a&&(n.pan=0),s.setPan=n.pan;break;case"keyOff":t===a&&(s.keyOff=!0,n.noteOn=!1);break;case"multiRetrig":t>0&&i>0&&t%i===0&&(s.triggerNote=!0,r>0&&r<jw.length&&(n.volume=this.clampVolume(jw[r](n.volume)),s.setVolume=n.volume));break;case"tremor":this.processTremor(n,s);break;case"retrig":t>0&&t%a===0&&(s.triggerNote=!0);break;case"noteCut":t===a&&(n.volume=0,s.setVolume=0,s.cutNote=!0);break;case"noteDelay":t===a&&(s.triggerNote=!0)}}return s}processVolumeColumnTickN(e,t,n,s,a){const o=15&n;switch(n>>4){case YE:this.processVolumeSlide(s,0,o,a);break;case JE:this.processVolumeSlide(s,o,0,a);break;case tk:o>0&&(s.vibratoDepth=o),this.processVibrato(s,a,4);break;case sk:s.pan=0===o?0:this.clampPan(s.pan-o),a.setPan=s.pan;break;case ak:s.pan=this.clampPan(s.pan+o),a.setPan=s.pan;break;case ok:{const e=o>0?16*o:s.lastTonePortaSpeed;this.processTonePorta(s,e,a);break}}}processVibrato(e,t,n=4){if(e.period<=0)return;const s=this.getWaveformValue(e.vibratoWaveform,e.vibratoPos),a=this.linearSlides?n:1,o=Math.floor(s*e.vibratoDepth*a),r=e.period+o;t.setPeriod=r,t.setFrequency=this.periodToHz(r),e.vibratoPos=e.vibratoPos+e.vibratoSpeed&63}processArpeggio(e,t,n,s,a){if(t.period<=0)return;const o=[0,n,s][(this.speed>0?this.speed-1-e:e)%3];if(this.linearSlides){const e=t.period-64*o;a.setPeriod=e,a.setFrequency=uw(e)}else{const e=ew(t.period)*Math.pow(2,o/12);a.setFrequency=e}}}const ik={A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:10,K:11,L:12,M:13,N:14,O:15,P:16,Q:17,R:18,S:19,T:20,U:21,V:22,W:23,X:24,Y:25,Z:26},lk=1,ck=2,uk=3,dk=4,mk=5,pk=8,hk=10,fk=11,gk=12,bk=13,vk=14;class yk extends Xw{format="S3M";stereo=!0;customPan=!1;periodToHz(e){return e<=0?0:ew(e)}activeEffects=new Map;patternDelayCount=0;highOffset=new Map;init(e){super.init(e),this.activeEffects.clear(),this.highOffset.clear(),this.patternDelayCount=0}resetAll(){super.resetAll(),this.activeEffects.clear(),this.highOffset.clear(),this.patternDelayCount=0}parseS3MEffect(e){if(!e||"..."===e||e.length<3)return null;const t=e[0].toUpperCase(),n=ik[t];if(!n)return null;const s=parseInt(e[1],16),a=parseInt(e[2],16);return isNaN(s)||isNaN(a)?null:{command:n,letter:t,x:s,y:a,param:16*s+a}}noteToS3MPeriod(e,t=0){return e&&"..."!==e&&"---"!==e?"==="===e||"^^^"===e?-1:this.noteStringToPeriod(e,t):0}processRowStart(e,t,n,s,a,o){const r={};if(this.activeEffects.delete(e),null!==n&&n>0&&(o.instrumentId=n),null!==s&&255!==s&&s<=64&&(o.volume=s,r.setVolume=s),t&&"..."!==t&&"---"!==t)if("==="===t||"^^^"===t||"..^"===t)r.cutNote=!0,o.noteOn=!1;else{const e=this.noteToS3MPeriod(t,o.finetune);if(e>0){const t=this.parseS3MEffect(a);!t||"G"!==t.letter&&"L"!==t.letter?(o.period=e,o.frequency=this.periodToHz(e),o.noteOn=!0,r.triggerNote=!0,r.setPeriod=e,r.setFrequency=o.frequency,o.vibratoRetrigger&&(o.vibratoPos=0),o.tremoloRetrigger&&(o.tremoloPos=0)):o.portamentoTarget=e}}if(a){const n=this.processEffectTick0(e,a,o,t);Object.assign(r,n);const s=this.processTick(e,0,o);Object.assign(r,s)}return r}processEffectTick0(e,t,n,s){const a={},o=this.parseS3MEffect(t);if(!o)return a;const{letter:r,x:i,y:l,param:c}=o;c>0&&["D","E","F","I","J","K","L","Q","R","S"].includes(r)&&(n.lastS3MParam=c);const u=c>0?c:n.lastS3MParam??0,d=u>>4&15,m=15&u;switch(r){case"A":c>0&&(this.speed=c,a.setSpeed=c);break;case"B":a.positionJump=c;break;case"C":a.patternBreak=10*i+l;break;case"D":15===m&&d>0?(n.volume=this.clampVolume(n.volume+d),a.setVolume=n.volume):15===d&&m>0?(n.volume=this.clampVolume(n.volume-m),a.setVolume=n.volume):this.activeEffects.set(e,{type:"volumeSlide",param:u,x:d,y:m});break;case"E":15===d?n.period>0&&(n.period+=4*m,n.frequency=this.periodToHz(n.period),a.setPeriod=n.period,a.setFrequency=n.frequency):14===d?n.period>0&&(n.period+=m,n.frequency=this.periodToHz(n.period),a.setPeriod=n.period,a.setFrequency=n.frequency):this.activeEffects.set(e,{type:"portaDown",param:u,x:d,y:m});break;case"F":15===d?n.period>0&&(n.period-=4*m,n.period<1&&(n.period=1),n.frequency=this.periodToHz(n.period),a.setPeriod=n.period,a.setFrequency=n.frequency):14===d?n.period>0&&(n.period-=m,n.period<1&&(n.period=1),n.frequency=this.periodToHz(n.period),a.setPeriod=n.period,a.setFrequency=n.frequency):this.activeEffects.set(e,{type:"portaUp",param:u,x:d,y:m});break;case"G":c>0&&(n.lastTonePortaSpeed=c),this.activeEffects.set(e,{type:"tonePorta",param:n.lastTonePortaSpeed,x:i,y:l});break;case"H":i>0&&(n.lastVibratoSpeed=i),l>0&&(n.lastVibratoDepth=l),n.vibratoSpeed=n.lastVibratoSpeed,n.vibratoDepth=n.lastVibratoDepth,this.activeEffects.set(e,{type:"vibrato",param:c,x:i,y:l});break;case"I":d>0&&(n.tremorOnTime=d),m>0&&(n.tremorOffTime=m),this.activeEffects.set(e,{type:"tremor",param:u,x:d,y:m});break;case"J":0!==u&&(n.lastArpeggio=u,this.activeEffects.set(e,{type:"arpeggio",param:u,x:d,y:m}));break;case"K":this.activeEffects.set(e,{type:"vibratoVolSlide",param:u,x:d,y:m});break;case"L":this.activeEffects.set(e,{type:"tonePortaVolSlide",param:u,x:d,y:m});break;case"O":{c>0&&(n.lastSampleOffset=c);const t=this.highOffset.get(e)??0;a.sampleOffset=65536*t+256*n.lastSampleOffset;break}case"Q":m>0&&(n.retrigTick=m),d>=0&&(n.retrigVolChange=i),this.activeEffects.set(e,{type:"retrig",param:u,x:d,y:m});break;case"R":d>0&&(n.lastTremoloSpeed=d),m>0&&(n.lastTremoloDepth=m),n.tremoloSpeed=n.lastTremoloSpeed,n.tremoloDepth=n.lastTremoloDepth,this.activeEffects.set(e,{type:"tremolo",param:u,x:d,y:m});break;case"S":this.processSCommand(e,d,m,n,s,a);break;case"T":c>=32?(this.tempo=c,a.setBPM=c):c>0&&this.activeEffects.set(e,{type:"tempoSlide",param:c,x:i,y:l});break;case"U":i>0&&(n.lastVibratoSpeed=i),l>0&&(n.lastVibratoDepth=l),n.vibratoSpeed=n.lastVibratoSpeed,n.vibratoDepth=n.lastVibratoDepth,this.activeEffects.set(e,{type:"fineVibrato",param:c,x:i,y:l});break;case"V":this.globalVolume=Math.min(c,64),a.setGlobalVolume=this.globalVolume;break;case"W":c>0&&(n.lastGlobalVolumeSlide=c),this.activeEffects.set(e,{type:"globalVolSlide",param:n.lastGlobalVolumeSlide??0,x:d,y:m});break;case"X":c<=128&&(n.pan=Math.floor(2*c),a.setPan=n.pan);break;case"Y":i>0&&(n.panbrelloSpeed=i),l>0&&(n.panbrelloDepth=l),this.activeEffects.set(e,{type:"panbrello",param:c,x:i,y:l})}return a}processSCommand(e,t,n,s,a,o){switch(t){case lk:s.glissando=n>0;break;case ck:s.finetune=n>7?n-16:n;break;case uk:this.setVibratoWaveform(s,n);break;case dk:this.setTremoloWaveform(s,n);break;case mk:{const e=["sine","rampDown","rampUp","square"];s.panbrelloWaveform=e[3&n]??"sine",s.panbrelloRetrigger=!(4&n);break}case pk:s.pan=17*n,o.setPan=s.pan;break;case hk:this.highOffset.set(e,n);break;case fk:this.processPatternLoop(e,n,o);break;case gk:s.noteCutTick=n,this.activeEffects.set(e,{type:"noteCut",param:n,x:0,y:n});break;case bk:n>0&&a&&(s.noteDelayTick=n,this.activeEffects.set(e,{type:"noteDelay",param:n,x:0,y:n}));break;case vk:n>0&&(this.patternDelayCount=n,o.patternDelay=n)}}processTick(e,t,n){const s={};"IT"===this.format&&this.processAutoVibrato(n,s,t);const a=this.activeEffects.get(e);if(!a)return s;const{type:o,param:r,x:i,y:l}=a;switch(o){case"arpeggio":this.processArpeggio(t,n,i,l,s);break;case"portaUp":if(0===t)break;this.processPortaUp(n,r,s,64);break;case"portaDown":if(0===t)break;this.processPortaDown(n,r,s,32767);break;case"tonePorta":if(0===t)break;this.processTonePorta(n,r,s),n.period<64&&(n.period=64,n.frequency=this.periodToHz(64),s.setPeriod=64,s.setFrequency=n.frequency);break;case"vibrato":this.processVibrato(n,s,4);break;case"fineVibrato":this.processVibrato(n,s,1);break;case"vibratoVolSlide":this.processVibrato(n,s,4),t>0&&this.processVolumeSlide(n,i,l,s);break;case"tonePortaVolSlide":t>0&&(this.processTonePorta(n,n.lastTonePortaSpeed,s),this.processVolumeSlide(n,i,l,s));break;case"tremolo":this.processTremolo(n,s);break;case"panbrello":this.processPanbrello(n,s);break;case"tremor":this.processTremor(n,s);break;case"volumeSlide":if(0===t)break;this.processVolumeSlide(n,i,l,s);break;case"globalVolSlide":this.processGlobalVolumeSlide(i,l,s);break;case"retrig":l>0&&t%l===0&&(s.triggerNote=!0,i>0&&(n.volume=this.applyRetrigVolume(n.volume,i),s.setVolume=n.volume));break;case"tempoSlide":0===i&&l>0?(this.tempo=Math.max(32,this.tempo-l),s.setBPM=this.tempo):1===i&&l>0&&(this.tempo=Math.min(255,this.tempo+l),s.setBPM=this.tempo);break;case"noteCut":t===r&&(n.volume=0,s.setVolume=0,s.cutNote=!0);break;case"noteDelay":t===r&&(s.triggerNote=!0)}return s}processArpeggio(e,t,n,s,a){if(t.period<=0)return;const o=[0,n,s][e%3];if(0===o)a.setPeriod=t.period;else{const e=this.periodToHz(t.period)*Math.pow(2,o/12);a.setFrequency=e}}applyRetrigVolume(e,t){switch(t){case 1:return e-1;case 2:return e-2;case 3:return e-4;case 4:return e-8;case 5:return e-16;case 6:return Math.floor(2*e/3);case 7:return Math.floor(e/2);case 8:default:return e;case 9:return e+1;case 10:return e+2;case 11:return e+4;case 12:return e+8;case 13:return e+16;case 14:return Math.floor(3*e/2);case 15:return 2*e}}processPanbrello(e,t){const n=e.panbrelloSpeed??1,s=e.panbrelloDepth??0,a=this.getWaveformValue(e.panbrelloWaveform??"sine",e.panbrelloPos??0),o=Math.floor(a*s)>>3,r=Math.max(0,Math.min(255,e.pan+o));t.setPan=r,e.panbrelloPos=(e.panbrelloPos??0)+n&63}}class xk extends yk{format="IT";periodToHz(e){return e<=0?0:26633830/e}noteStringToPeriod(e,t=0){return super.noteStringToPeriod(e,t)}processITEffectTick0(e,t,n,s){const a=t[0].toUpperCase(),o=parseInt(t.substring(1),16);switch(a){case"M":n.channelVolume=Math.min(o,64),s.setChannelVolume=n.channelVolume;break;case"N":{o>0&&(n.lastChannelVolumeSlide=o);const t=o>0?o:n.lastChannelVolumeSlide??0;this.activeEffects.set(e,{type:"channelVolSlide",param:t,x:t>>4&15,y:15&t});break}case"Z":o<=127?(n.filterCutoff=o,s.setFilterCutoff=o):o>=128&&o<=143&&(n.filterResonance=(15&o)<<3,s.setFilterResonance=n.filterResonance),127===n.filterCutoff&&0===(n.filterResonance??0)&&(s.setFilterCutoff=255,n.filterCutoff=127)}}processRowStart(e,t,n,s,a,o){if(null!==n&&n>0){o.instrumentId=n;const e=o,a=e.sampleDefaultVolume??64,r=e.sampleDefaultFinetune??0;null===s&&(o.volume=a);o.finetune;o.finetune=r,t&&"..."!==t&&"---"!==t||o.period}const r=super.processRowStart(e,t,n,s,a,o);if(this.processAutoVibrato(o,r,0),a&&a.startsWith("Z")&&this.processITEffectTick0(e,a,o,r),a&&a.toUpperCase().startsWith("S7")){const e=parseInt(a[2],16);e<=3?o.nnaMode=e:7===e?r.pastNoteAction=0:8===e?r.pastNoteAction=2:9===e&&(r.pastNoteAction=3)}return r.triggerNote&&null!==n&&(r.nnaAction=o.nnaMode??0),r}processTick(e,t,n){const s=super.processTick(e,t,n),a=this.activeEffects.get(e);if(a&&"channelVolSlide"===a.type){const{x:e,y:o}=a;15===e&&o>0?0===t&&(n.channelVolume=Math.max(0,(n.channelVolume??64)-o)):15===o&&e>0?0===t&&(n.channelVolume=Math.min(64,(n.channelVolume??64)+e)):t>0&&(e>0?n.channelVolume=Math.min(64,(n.channelVolume??64)+e):o>0&&(n.channelVolume=Math.max(0,(n.channelVolume??64)-o))),s.setChannelVolume=n.channelVolume}return s}}class Nk{overrides=new Map;patternLengthMs=4e3;cleanupInterval=null;constructor(){this.startCleanup()}updateTiming(e,t){const n=60/e*.25;this.patternLengthMs=n*t*1e3}setOverride(e,t){this.overrides.set(e,{timestamp:Date.now(),value:t})}isOverridden(e){const t=this.overrides.get(e);if(!t)return!1;return!(Date.now()-t.timestamp>this.patternLengthMs)||(this.overrides.delete(e),!1)}getOverrideValue(e){return this.isOverridden(e)?this.overrides.get(e)?.value??null:null}clearOverride(e){this.overrides.delete(e)}clearAll(){this.overrides.clear()}getOverrideStrength(e){const t=this.overrides.get(e);if(!t)return 0;const n=Date.now()-t.timestamp;return Math.max(0,this.patternLengthMs-n)/this.patternLengthMs}startCleanup(){this.cleanupInterval||(this.cleanupInterval=setInterval(()=>{const e=Date.now();for(const[t,n]of this.overrides.entries())e-n.timestamp>this.patternLengthMs&&this.overrides.delete(t)},1e3))}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}}let wk=null;class Ek{currentPattern=null;automationData={};setAutomationData(e){this.automationData=e;Object.keys(e)}setPattern(e){this.currentPattern=e}getColumnValue(e,t){const n=t.includes(".")?t.split(".").pop():t;let s;switch(n){case"cutoff":s=e.cutoff;break;case"resonance":s=e.resonance;break;case"envMod":s=e.envMod;break;case"pan":s=e.pan;break;case"volume":s=null!==e.volume&&e.volume>=16&&e.volume<=80?e.volume-16:void 0;break;default:return null}return void 0===s?null:"volume"===n?s/64:s/255}getCurveValue(e,t,n,s){const a=this.automationData[e]?.[t]?.[n];return a&&a.enabled&&0!==a.points.length?Ua(a.points,s,a.interpolation,a.mode):null}getAutomationValue(e,t,n,s,a){const o=this.getColumnValue(e,s);return null!==o?o:this.getCurveValue(t,n,s,a)}applyParameter(e,t,n,s){const a=t.includes(".")?t.split(".").pop():t;if((wk||(wk=new Nk),wk).isOverridden(a))return;const o=Bw();let r=null;if(void 0!==s&&(r=o.instruments.get(e<<16|65535&s)),r||(r=o.instruments.get(e<<16|65535)),!r)for(const[l,c]of o.instruments.entries())if(l>>16===e&&(c instanceof Er||"BuzzmachineGenerator"===c.constructor.name)){r=c;break}if(r)try{if(eo(r)&&r.set)return void r.set(a,n);if((r instanceof Er||"BuzzmachineGenerator"===r.constructor.name)&&"set"in r)return void r.set(a,n);const e=r;switch(a){case"cutoff":e.filter?.frequency&&e.filter.frequency.setValueAtTime(200*Math.pow(25,n),Y());break;case"resonance":e.filter?.Q&&e.filter.Q.setValueAtTime(30*n,Y());break;case"volume":{const t=40*n-40;e.volume&&e.volume.setValueAtTime(t,Y());break}case"pan":{const t=2*n-1;e.pan&&e.pan.setValueAtTime(t,Y());break}case"distortion":e.distortion&&e.distortion.setValueAtTime(n,Y());break;case"delay":e.delayWet&&e.delayWet.setValueAtTime(n,Y());break;case"reverb":e.reverbWet&&e.reverbWet.setValueAtTime(n,Y())}}catch(i){}}processRow(e,t,n,s,a){if(null===a)return;const o=["cutoff","resonance","envMod","pan","volume"];for(const i of o){const e=this.getColumnValue(s,i);null!==e&&this.applyParameter(a,i,e,t)}const r=this.automationData[e]?.[t];if(r)for(const i of Object.keys(r)){const s=this.getCurveValue(e,t,i,n);null!==s&&this.applyParameter(a,i,s,t)}}processPatternRow(e){this.currentPattern&&this.currentPattern.channels.forEach((t,n)=>{const s=t.rows[e],a=null!==s.instrument?s.instrument:t.instrumentId;null!==a&&this.processRow(this.currentPattern.id,n,e,s,a)})}clear(){this.currentPattern=null,this.automationData={}}getCurrentValue(e,t,n,s){if(!this.currentPattern)return null;const a=this.currentPattern.channels[t]?.rows[s];return a?this.getAutomationValue(a,e,t,n,s):null}exportAutomation(e,t){if(!this.currentPattern)return{};const n={},s=this.automationData[e]?.[t];if(!s)return n;for(const a of Object.keys(s)){const s=[];for(let n=0;n<this.currentPattern.length;n++){const o=this.currentPattern.channels[t].rows[n],r=this.getAutomationValue(o,e,t,a,n);s.push(null!==r?r:0)}n[a]=s}return n}}let kk=null;const Dk=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24];class Sk{memory={};channelStates=new Map;ticksPerRow=6;_currentTick=0;globalVolume=64;parseEffect(e){if(!e||"..."===e||"000"===e)return null;const t=e.toUpperCase().padEnd(3,"0"),n=parseInt(t[0],16),s=parseInt(t[1],16),a=parseInt(t[2],16),o=16*s+a;return isNaN(n)||isNaN(s)||isNaN(a)?null:{command:n,x:s,y:a,param:o}}noteToFrequency(e){try{return le(e.replace("-","")).toFrequency()}catch{return 440}}_frequencyToNote(e){try{return le(e).toNote()}catch{return"C4"}}getWaveformValue(e,t){const n=63&t;switch(e){case"sine":{const e=Dk[31&n];return n<32?e/255:-e/255}case"rampDown":return 1-n%32/16;case"square":return n<32?1:-1;case"random":return 2*Math.random()-1;default:return Math.sin(n/64*Math.PI*2)}}ensureMemory(e){this.memory[e]||(this.memory[e]={volume:64,pan:128,vibratoWaveform:"sine",tremoloWaveform:"sine"})}processRowStart(e,t,n,s){this.ensureMemory(e);const a={},o=this.parseEffect(n),r={};if(this.channelStates.set(e,r),t&&"==="!==t&&"..."!==t&&(this.memory[e].currentFreq=this.noteToFrequency(t)),null!==s&&s>=0&&s<=64&&(this.memory[e].volume=s,a.setVolume=s),!o)return a;const{command:i,x:l,y:c,param:u}=o,d=this.memory[e];switch(i){case 0:if(0!==l||0!==c){const e=d.currentFreq||this.noteToFrequency(t||"C4");r.arpeggio={baseNote:t||"C4",baseFreq:e,x:l,y:c,step:0}}break;case 1:u>0&&(d.portaUp=u),r.portaUp={speed:d.portaUp||1};break;case 2:u>0&&(d.portaDown=u),r.portaDown={speed:d.portaDown||1};break;case 3:u>0&&(d.tonePortaSpeed=u),t&&"==="!==t&&"..."!==t&&(d.tonePortaTarget=this.noteToFrequency(t),a.preventNoteTrigger=!0),d.tonePortaTarget&&(r.tonePorta={targetFreq:d.tonePortaTarget,speed:d.tonePortaSpeed||1});break;case 4:l>0&&(d.vibratoSpeed=l),c>0&&(d.vibratoDepth=c),r.vibrato={speed:d.vibratoSpeed||4,depth:d.vibratoDepth||4,waveform:d.vibratoWaveform||"sine"};break;case 5:d.tonePortaTarget&&(r.tonePorta={targetFreq:d.tonePortaTarget,speed:d.tonePortaSpeed||1}),l>0?r.volumeSlide={up:l,down:0}:c>0&&(r.volumeSlide={up:0,down:c});break;case 6:r.vibrato={speed:d.vibratoSpeed||4,depth:d.vibratoDepth||4,waveform:d.vibratoWaveform||"sine"},l>0?r.volumeSlide={up:l,down:0}:c>0&&(r.volumeSlide={up:0,down:c});break;case 7:l>0&&(d.tremoloSpeed=l),c>0&&(d.tremoloDepth=c),r.tremolo={speed:d.tremoloSpeed||4,depth:d.tremoloDepth||4,waveform:d.tremoloWaveform||"sine"};break;case 8:d.pan=u,a.setPan=u;break;case 9:u>0&&(d.sampleOffset=u),a.sampleOffset=256*(d.sampleOffset||0);break;case 10:l>0?(d.volumeSlideUp=l,d.volumeSlideDown=0):c>0&&(d.volumeSlideUp=0,d.volumeSlideDown=c),r.volumeSlide={up:d.volumeSlideUp||0,down:d.volumeSlideDown||0};break;case 11:a.jumpToPosition=u;break;case 12:{const e=Math.min(u,64);d.volume=e,a.setVolume=e;break}case 13:{const e=10*l+c;a.patternBreak={position:e};break}case 14:this.processECommand(e,l,c,t,r,a);break;case 15:0===u||(u<32?(this.ticksPerRow=u,a.setSpeed=u):a.setBPM=u)}const m=n?.toUpperCase()[0];if("G"===m){const e=Math.min(u,64);this.globalVolume=e,a.setGlobalVolume=e}else if("H"===m)l>0?(d.globalSlideUp=l,d.globalSlideDown=0):c>0&&(d.globalSlideUp=0,d.globalSlideDown=c);else if("L"===m);else if("P"===m)l>0?(d.panSlideRight=l,d.panSlideLeft=0):c>0&&(d.panSlideRight=0,d.panSlideLeft=c),r.panSlide={right:d.panSlideRight||0,left:d.panSlideLeft||0};else if("R"===m)l>0&&(d.retrigInterval=l),c>=0&&(d.retrigVolChange=c),r.retrig={interval:d.retrigInterval||1,volChange:d.retrigVolChange||0,tickCounter:0};else if("T"===m)l>0&&(d.tremorOnTime=l),c>0&&(d.tremorOffTime=c),r.tremor={onTime:d.tremorOnTime||1,offTime:d.tremorOffTime||1,tickCounter:0,isOn:!0};else if("X"===m)1===l?r.portaUp={speed:c/4}:2===l&&(r.portaDown={speed:c/4});else if("S"===m){if(7===l)switch(c){case 0:a.newNoteAction="cut";break;case 1:a.newNoteAction="continue";break;case 2:a.newNoteAction="noteOff";break;case 3:a.newNoteAction="noteFade";break;case 4:a.duplicateCheck="note";break;case 5:a.duplicateCheck="sample";break;case 6:a.duplicateCheck="instrument";break;case 7:a.envelopeControl={...a.envelopeControl,volume:!1};break;case 8:a.envelopeControl={...a.envelopeControl,volume:!0};break;case 9:a.envelopeControl={...a.envelopeControl,panning:!1};break;case 10:a.envelopeControl={...a.envelopeControl,panning:!0};break;case 11:a.envelopeControl={...a.envelopeControl,pitch:!1};break;case 12:a.envelopeControl={...a.envelopeControl,pitch:!0}}}else if("Z"===m){if(u<=127)d.filterCutoff=u,a.setFilterCutoff=u;else if(u>=128&&u<=143)d.filterResonance=u-128,a.setFilterResonance=u-128;else if(u>=144&&u<=159){const e=["lowpass","highpass","bandpass"],t=(u-144)%3;d.filterMode=e[t],a.setFilterMode=e[t]}}else if("W"===m){d.globalPitchShift=u;const e=(u-128)/128*12;a.setGlobalPitchShift=e}else if("\\"===n?.[0]){const e=parseInt(n.substring(1),16);if(!isNaN(e)&&e<=127){const t=d.filterCutoff??64;d.smoothMacroTarget=e,d.smoothMacroStart=t,r.smoothMacro={startValue:t,targetValue:e,ticksTotal:this.ticksPerRow},a.setFilterCutoff=t}}return a}processECommand(e,t,n,s,a,o){const r=this.memory[e];switch(t){case 0:o.setAmigaFilter=0===n;break;case 1:r.currentFreq&&(r.currentFreq*=Math.pow(2,n/192));break;case 2:r.currentFreq&&(r.currentFreq/=Math.pow(2,n/192));break;case 3:case 5:break;case 4:{const e=["sine","rampDown","square","random"];r.vibratoWaveform=e[3&n],r.vibratoNoRetrig=!!(4&n);break}case 6:0===n?r.loopStart=0:void 0===r.loopCount?r.loopCount=n:r.loopCount>0?r.loopCount--:r.loopCount=void 0;break;case 7:{const e=["sine","rampDown","square","random"];r.tremoloWaveform=e[3&n],r.tremoloNoRetrig=!!(4&n);break}case 8:r.pan=17*n,o.setPan=r.pan;break;case 9:n>0&&(a.retrig={interval:n,volChange:0,tickCounter:0});break;case 10:r.volume=Math.min(64,(r.volume??64)+n),o.setVolume=r.volume;break;case 11:r.volume=Math.max(0,(r.volume??64)-n),o.setVolume=r.volume;break;case 12:a.noteCut={tick:n};break;case 13:n>0&&s&&(a.noteDelay={tick:n,note:s,instrument:0},o.preventNoteTrigger=!0);break;case 14:a.patternDelay={rows:n}}}processTick(e,t){const n=this.channelStates.get(e),s=this.memory[e];if(!n||!s)return{};const a={};if(n.arpeggio){const{baseFreq:e,x:s,y:o}=n.arpeggio,r=[0,s,o][t%3];a.frequencySet=e*Math.pow(2,r/12),n.arpeggio.step=t%3}if(n.portaUp&&s.currentFreq&&(s.currentFreq*=Math.pow(2,n.portaUp.speed/192),a.frequencySet=s.currentFreq),n.portaDown&&s.currentFreq&&(s.currentFreq/=Math.pow(2,n.portaDown.speed/192),a.frequencySet=s.currentFreq),n.tonePorta&&s.currentFreq){const{targetFreq:e,speed:t}=n.tonePorta,o=4*t;s.currentFreq<e?(s.currentFreq*=Math.pow(2,o/192),s.currentFreq>e&&(s.currentFreq=e)):s.currentFreq>e&&(s.currentFreq/=Math.pow(2,o/192),s.currentFreq<e&&(s.currentFreq=e)),a.frequencySet=s.currentFreq}if(n.vibrato){const{speed:e,depth:t,waveform:o}=n.vibrato,r=s.vibratoPhase??0,i=this.getWaveformValue(o,r);a.frequencyMult=Math.pow(2,i*t/192),s.vibratoPhase=r+e&63}if(n.tremolo){const{speed:e,depth:t,waveform:o}=n.tremolo,r=s.tremoloPhase??0,i=this.getWaveformValue(o,r);a.volumeAdd=i*t*4,s.tremoloPhase=r+e&63}if(n.volumeSlide){const{up:e,down:t}=n.volumeSlide,o=s.volume??64;s.volume=Math.max(0,Math.min(64,o+e-t)),a.volumeSet=s.volume}if(n.panSlide){const{right:e,left:t}=n.panSlide;s.pan=Math.max(0,Math.min(255,(s.pan??128)+e-t)),a.panSet=s.pan}if(n.retrig&&(n.retrig.tickCounter++,n.retrig.tickCounter>=n.retrig.interval)){n.retrig.tickCounter=0,a.triggerNote=!0;const e=n.retrig.volChange;if(e>0){const t=[0,-1,-2,-4,-8,-16,0,0,0,1,2,4,8,16,0,0],n=[1,1,1,1,1,1,2/3,.5,1,1,1,1,1,1,1.5,2];e<=5||e>=9&&e<=13?s.volume=Math.max(0,Math.min(64,(s.volume??64)+t[e])):6!==e&&7!==e&&14!==e&&15!==e||(s.volume=Math.max(0,Math.min(64,Math.floor((s.volume??64)*n[e])))),a.volumeSet=s.volume}}if(n.tremor){n.tremor.tickCounter++;const{onTime:e,offTime:t,tickCounter:s}=n.tremor;s%(e+t)<e?n.tremor.isOn=!0:(n.tremor.isOn=!1,a.volumeSet=0)}if(n.noteCut&&t>=n.noteCut.tick&&(a.cutNote=!0,a.volumeSet=0,n.noteCut=void 0),n.noteDelay&&t===n.noteDelay.tick&&(a.triggerNote=!0,n.noteDelay=void 0),s.globalSlideUp||s.globalSlideDown){const e=s.globalSlideUp||0,t=s.globalSlideDown||0;this.globalVolume=Math.max(0,Math.min(64,this.globalVolume+e-t)),a.globalVolumeAdd=e-t}if(n.smoothMacro){const{startValue:e,targetValue:o,ticksTotal:r}=n.smoothMacro,i=Math.min(1,t/r),l=Math.round(e+(o-e)*i);s.filterCutoff=l,a.filterCutoffSet=l,t>=r&&(s.filterCutoff=o,a.filterCutoffSet=o)}return a}getCurrentFrequency(e){return this.memory[e]?.currentFreq}getCurrentVolume(e){return this.memory[e]?.volume??64}getGlobalVolume(){return this.globalVolume}setGlobalVolume(e){this.globalVolume=Math.max(0,Math.min(64,e))}getTicksPerRow(){return this.ticksPerRow}setTicksPerRow(e){this.ticksPerRow=Math.max(1,Math.min(31,e))}clearChannel(e){this.channelStates.delete(e)}clearAll(){this.channelStates.clear(),this.memory={},this.globalVolume=64,this.ticksPerRow=6}resetActiveEffects(){this.channelStates.clear()}static getEffectDescription(e){if(!e||"..."===e||"000"===e)return"";const t=e.toUpperCase()[0],n=e.substring(1),s={0:`Arpeggio +${parseInt(n[0],16)}/+${parseInt(n[1],16)} semitones`,1:`Portamento up speed ${parseInt(n,16)}`,2:`Portamento down speed ${parseInt(n,16)}`,3:`Tone portamento speed ${parseInt(n,16)}`,4:`Vibrato speed ${parseInt(n[0],16)} depth ${parseInt(n[1],16)}`,5:`Tone porta + vol slide ${n}`,6:`Vibrato + vol slide ${n}`,7:`Tremolo speed ${parseInt(n[0],16)} depth ${parseInt(n[1],16)}`,8:`Set panning ${parseInt(n,16)}`,9:"Sample offset "+256*parseInt(n,16),A:"Volume slide "+(parseInt(n[0],16)>0?"up "+n[0]:"down "+n[1]),B:`Jump to position ${parseInt(n,16)}`,C:`Set volume ${parseInt(n,16)}`,D:`Pattern break to row ${10*parseInt(n[0],10)+parseInt(n[1],10)}`,E:Sk.getECommandDescription(parseInt(n[0],16),parseInt(n[1],16)),F:parseInt(n,16)<32?`Set speed ${parseInt(n,16)}`:`Set BPM ${parseInt(n,16)}`,G:`Set global volume ${parseInt(n,16)}`,H:`Global volume slide ${n}`,L:`Set envelope position ${parseInt(n,16)}`,P:`Panning slide ${n}`,R:`Multi retrig interval ${n[0]} vol ${n[1]}`,T:`Tremor on ${n[0]} off ${n[1]}`,X:"1"===n[0]?`Extra fine porta up ${n[1]}`:`Extra fine porta down ${n[1]}`,S:Sk.getSCommandDescription(parseInt(n[0],16),parseInt(n[1],16)),Z:Sk.getZCommandDescription(parseInt(n,16))};if("\\"===e[0]){return`Smooth filter slide to ${parseInt(e.substring(1),16)}`}return s[t]||`Unknown effect ${e}`}static getECommandDescription(e,t){return{0:`Filter ${t?"on":"off"} (Amiga)`,1:`Fine porta up ${t}`,2:`Fine porta down ${t}`,3:"Glissando "+(t?"on":"off"),4:`Vibrato waveform ${t}`,5:`Set finetune ${t}`,6:0===t?"Set loop start":`Loop ${t} times`,7:`Tremolo waveform ${t}`,8:"Set panning "+17*t,9:`Retrig every ${t} ticks`,10:`Fine vol up ${t}`,11:`Fine vol down ${t}`,12:`Note cut at tick ${t}`,13:`Note delay ${t} ticks`,14:`Pattern delay ${t} rows`,15:`Funk repeat ${t}`}[e]||`E${e.toString(16)}${t.toString(16)}`}static getSCommandDescription(e,t){if(7===e){return{0:"NNA: Cut",1:"NNA: Continue",2:"NNA: Note Off",3:"NNA: Note Fade",4:"DNC: Note",5:"DNC: Sample",6:"DNC: Instrument",7:"Volume Envelope Off",8:"Volume Envelope On",9:"Panning Envelope Off",10:"Panning Envelope On",11:"Pitch/Filter Envelope Off",12:"Pitch/Filter Envelope On"}[t]||`S7${t.toString(16)}`}return 9===e?1===t?"Surround Sound":`S9${t.toString(16)}`:`S${e.toString(16)}${t.toString(16)}`}static getZCommandDescription(e){if(e<=127)return`Filter cutoff ${e} (${Math.round(e/127*100)}%)`;if(e>=128&&e<=143){const t=e-128;return`Filter resonance ${t} (${Math.round(t/15*100)}%)`}if(e>=144&&e<=159){return`Filter mode: ${["Lowpass","Highpass","Bandpass"][(e-144)%3]}`}return`Z${e.toString(16).toUpperCase().padStart(2,"0")}`}}let Mk=null;const Ck=i()(TN(ds(e=>({amigaLimits:!1,linearInterpolation:!0,masterTuning:440,formatEngine:{mod:"native",hvl:"native",med:"native",fc:"native",okt:"native",digi:"native",soundmon:"native",sidmon2:"native",fred:"native",soundfx:"native",mugician:"native",tfmx:"native",hippelCoso:"native",sidmon1:"native",davidWhittaker:"native",deltaMusic2:"native",artOfNoise:"native",benDaglish:"native",sonicArranger:"native",inStereo1:"native",inStereo2:"native",pumaTracker:"native",synthesis:"native",musicAssembler:"native",digitalSoundStudio:"native",digitalSymphony:"native",imagoOrpheus:"native",cdfm67:"native",easyTrax:"native",karlMorton:"native",ams:"native",xTracker:"native",xmf:"native",uax:"native",graoumfTracker2:"native",symphoniePro:"native",chuckBiscuits:"native",speedySystem:"uade",tronic:"uade",digiBoosterPro:"native",gameMusicCreator:"uade",faceTheMusic:"native",soundControl:"native",soundFactory:"native",actionamics:"native",activisionPro:"native",ronKlaren:"native",deltaMusic1:"native",pt36:"native",musicLine:"native",medley:"native",markCooksey:"native",jeroenTel:"native",quartet:"native",soundMaster:"native",amosMusicBank:"native",iceTracker:"native",zoundMonitor:"native",synthPack:"native",tcbTracker:"native",mmdc:"native",psa:"native",steveTurner:"native",tme:"native",jasonBrooke:"native",laxity:"native",fredGray:"native",musicMaker4V:"native",musicMaker8V:"native",maniacsOfNoise:"native",ufo:"native",iffSmus:"native",magneticFieldsPacker:"native",richardJoseph:"native",daveLowe:"native",lme:"native",jochenHippelST:"native",specialFX:"native",timeTracker:"native",kris:"native",cinemaware:"native",novoTradePacker:"native",alcatrazPacker:"native",bladePacker:"native",tomyTracker:"native",imagesMusicSystem:"native",fashionTracker:"native",multiMediaSound:"native",seanConran:"native",thomasHermann:"native",titanicsPacker:"native",krisHatlelid:"native",ntsp:"native",moshPacker:"native",coreDesign:"native",jankoMrsicFlogel:"native",soundPlayer:"native",nickPellingPacker:"native",peterVerswyvelenPacker:"native",wallyBeben:"native",steveBarrett:"native",paulSummers:"native",desire:"native",martinWalker:"native",paulShields:"native",paulRobotham:"native",pierreAdane:"native",anders0land:"native",andrewParton:"native",customMade:"native",benDaglishSID:"native",digitalSonixChrome:"native",jesperOlsen:"native",kimChristensen:"native",ashleyHogg:"native",adpcmMono:"native",janneSalmijarvi:"native",jochenHippel7V:"native",maximumEffect:"native",midiLoriciel:"native",onEscapee:"native",paulTonge:"native",robHubbardST:"native",robHubbard:"native",futurePlayer:"native",jasonPage:"native",infogrames:"native",sawteeth:"native",fmTracker:"native",madTracker2:"native",psm:"native",composer667:"native",uade:"enhanced"},performanceQuality:"high",useBLEP:!1,stereoSeparation:20,stereoSeparationMode:"pt2",modplugSeparation:100,midiPolyphonic:!0,trackerVisualBg:!1,trackerVisualMode:0,renderMode:"webgl",setAmigaLimits:t=>e(e=>{e.amigaLimits=t}),setLinearInterpolation:t=>e(e=>{e.linearInterpolation=t}),setMasterTuning:t=>e(e=>{e.masterTuning=t}),setFormatEngine:(t,n)=>e(e=>{e.formatEngine[t]=n}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setUseBLEP:t=>e(e=>{e.useBLEP=t}),setStereoSeparation:t=>e(e=>{e.stereoSeparation=Math.max(0,Math.min(100,t))}),setStereoSeparationMode:t=>e(e=>{e.stereoSeparationMode=t}),setModplugSeparation:t=>e(e=>{e.modplugSeparation=Math.max(0,Math.min(200,t))}),setMidiPolyphonic:t=>e(e=>{e.midiPolyphonic=t}),setTrackerVisualBg:t=>e(e=>{e.trackerVisualBg=t}),setTrackerVisualMode:t=>e(e=>{e.trackerVisualMode=t}),setRenderMode:t=>e(e=>{e.renderMode=t})})),{name:"devilbox-settings",version:2,migrate:(e,t)=>{const n=e??{};return t<2&&(n.renderMode="webgl"),n},merge:(e,t)=>{const n=e;return{...t,...n,renderMode:t.renderMode,formatEngine:{...t.formatEngine,...n.formatEngine??{}}}},partialize:e=>({amigaLimits:e.amigaLimits,linearInterpolation:e.linearInterpolation,masterTuning:e.masterTuning,formatEngine:e.formatEngine,performanceQuality:e.performanceQuality,useBLEP:e.useBLEP,stereoSeparation:e.stereoSeparation,stereoSeparationMode:e.stereoSeparationMode,modplugSeparation:e.modplugSeparation,midiPolyphonic:e.midiPolyphonic,trackerVisualBg:e.trackerVisualBg,trackerVisualMode:e.trackerVisualMode})}));let Vk=0;const Pk=i((e,t)=>({notifications:[],addNotification:n=>{const s="notification-"+ ++Vk,a={...n,id:s,duration:n.duration??5e3};return e(e=>({notifications:[...e.notifications,a]})),a.duration&&a.duration>0&&setTimeout(()=>{t().removeNotification(s)},a.duration),s},removeNotification:t=>{e(e=>({notifications:e.notifications.filter(e=>e.id!==t)}))},clearAll:()=>{e({notifications:[]})}})),_k={success:(e,t)=>Pk.getState().addNotification({type:"success",message:e,duration:t}),error:(e,t)=>Pk.getState().addNotification({type:"error",message:e,duration:t??8e3}),warning:(e,t)=>Pk.getState().addNotification({type:"warning",message:e,duration:t}),info:(e,t)=>Pk.getState().addNotification({type:"info",message:e,duration:t})},Ok=Object.freeze(Object.defineProperty({__proto__:null,notify:_k,useNotificationStore:Pk},Symbol.toStringTag,{value:"Module"})),Tk=new Map;function Lk(e){let t=Tk.get(e);return void 0===t&&(t=le(e).toFrequency(),Tk.set(e,t)),t}class Ak{currentPlayback=null;nextPlayback=null;activeHandler=null;activeFormat=null;onRowChange=null;onPatternEnd=null;onPatternBreak=null;onPositionJump=null;automation={};channelNotes=new Map;channelActiveInstruments=new Map;playbackErrors=new Map;errorNotificationShown=!1;ERROR_THRESHOLD=5;automationPlayer=(()=>(kk||(kk=new Ek),kk))();patternBreakScheduled=!1;currentPatternEndTime=0;nextPatternScheduled=!1;pendingPatternBreak=null;pendingPositionJump=null;effectProcessor=(()=>(Mk||(Mk=new Sk),Mk))();baseBPM=125;pitchShiftSemitones=0;globalPitchOffset=0;bpmUpdateTimer=null;trackPlaybackError(e,t){const n=t.message.split(":")[0],s=(this.playbackErrors.get(n)||0)+1;this.playbackErrors.set(n,s);if(Array.from(this.playbackErrors.values()).reduce((e,t)=>e+t,0)>=this.ERROR_THRESHOLD&&!this.errorNotificationShown){this.errorNotificationShown=!0;const e=Array.from(this.playbackErrors.entries()).map(([e,t])=>`${e} (${t})`).join(", ");_k.error(`Playback errors detected: ${e}. Check console for details or review SONG_FORMAT.md`,15e3)}}resetErrorTracking(){this.playbackErrors.clear(),this.errorNotificationShown=!1}setAutomation(e){this.automation=e}setGlobalPitchOffset(e){this.globalPitchOffset=e;const t=Math.pow(2,(this.pitchShiftSemitones+this.globalPitchOffset)/12),n=Bw();n.setGlobalPlaybackRate(t);pD().updateAllPlaybackRates(),n.setGlobalDetune(100*(this.pitchShiftSemitones+this.globalPitchOffset)),this.bpmUpdateTimer&&clearTimeout(this.bpmUpdateTimer),this.bpmUpdateTimer=setTimeout(()=>{const e=Math.round(this.baseBPM*t*100)/100;jN.getState().setBPM(e),this.bpmUpdateTimer=null},200)}computeRowTimings(e,t,n){const s=Bw().getWasmInstance(),a=s;if(s&&"function"==typeof a.computePatternTimings)try{const s=e.length,o=12+20*s,r=a.__new(o,1),i=new DataView(a.memory.buffer);i.setInt32(r,s,!0),i.setInt32(r+4,t,!0),i.setFloat32(r+8,n,!0);for(let t=0;t<s;t++){let n=0,s=0,a=0,o=0,l=0;e.channels.forEach(e=>{const r=e.rows[t];if(15===r.effTyp&&void 0!==r.eff){const e=r.eff;e>0&&e<32?(n=1,s=e):e>=32&&(a=1,o=e)}const i=r.eff??0;void 0!==r.effTyp&&0!==r.effTyp&&(14!==r.effTyp&&19!==r.effTyp||i>>4!=14||(l=15&i))});const c=r+12+20*t;i.setInt32(c,n,!0),i.setInt32(c+4,s,!0),i.setInt32(c+8,a,!0),i.setFloat32(c+12,o,!0),i.setInt32(c+16,l,!0)}const l=a.__new(16*s,1);a.computePatternTimings(r,l);const c=[];for(let e=0;e<s;e++){const t=l+16*e;c.push({time:i.getFloat32(t,!0),speed:i.getInt32(t+4,!0),bpm:i.getFloat32(t+8,!0),delay:i.getInt32(t+12,!0)})}return c}catch(c){}const o=[];let r=t,i=n,l=0;for(let u=0;u<e.length;u++){let t=0;e.channels.forEach(e=>{const n=e.rows[u];if(15===n.effTyp&&void 0!==n.eff){const e=n.eff;e>0&&e<32?r=e:e>=32&&(i=e)}const s=n.eff??0;void 0!==n.effTyp&&0!==n.effTyp&&(14!==n.effTyp&&19!==n.effTyp||s>>4!=14||(t=15&s))}),o.push({time:l,speed:r,bpm:i,delay:t});l+=2.5/i*r*(1+t)}return o}getGrooveOrSwingOffset(e,t){const n=jN.getState(),s=n.getGrooveTemplate(),a=n.swing/100;if(s&&"straight"!==s.id){const o=Math.max(1,Math.round(n.grooveSteps/s.values.length));return Ia(s,Math.floor(e/o),t)*a}return 0}applyTickEffects(e,t,n){const s=Bw();if(void 0!==t.setFrequency)s.setChannelFrequency(e,t.setFrequency);else if(void 0!==t.setPeriod&&t.setPeriod>0){const a=(n.config?.periodMultiplier||3546895)/t.setPeriod;s.setChannelFrequency(e,a)}else 0===t.setPeriod&&s.setChannelVolume(e,-1/0);if(void 0!==t.setVolume){const n=0===t.setVolume?-1/0:20*Math.log10(t.setVolume/64);s.setChannelVolume(e,n)}if(void 0!==t.setPan){const n=(t.setPan-128)/128*100;s.setChannelPan(e,n)}if(t.cutNote&&s.setChannelVolume(e,-1/0),void 0!==t.setFilterCutoff&&s.setChannelFilterCutoff(e,t.setFilterCutoff),void 0!==t.setFilterResonance&&s.setChannelFilterResonance(e,t.setFilterResonance),void 0!==t.setBPM){this.baseBPM=t.setBPM;const e=Math.pow(2,(this.pitchShiftSemitones+this.globalPitchOffset)/12),n=this.baseBPM*e;s.setBPM(n)}if(void 0!==t.setSpeed&&(n.speed=t.setSpeed),void 0!==t.setGlobalPitchShift){this.pitchShiftSemitones=t.setGlobalPitchShift;const e=Math.pow(2,(this.pitchShiftSemitones+this.globalPitchOffset)/12);s.setGlobalPlaybackRate(e);pD().updateAllPlaybackRates(),s.setGlobalDetune(100*(this.pitchShiftSemitones+this.globalPitchOffset));const n=Math.round(this.baseBPM*e*100)/100;jN.getState().setBPM(n),k().bpm.value=n}void 0!==t.funkRepeat&&s.setChannelFunkRepeat(e,t.funkRepeat)}stop(){k().stop(),this.clearSchedule()}schedulePattern(e,t,n,s=0){0===s&&this.clearSchedule(),this.onRowChange=n||null,this.nextPatternScheduled=!1;const a=e.importMetadata?.sourceFormat??"NATIVE";if(!this.activeHandler||this.activeFormat!==a||0===s){this.activeHandler=function(e){switch(e){case"MOD":case"PT36":case"SFX":return new yE;case"XM":case"DBM":case"NATIVE":default:return new rk;case"S3M":case"STM":case"STX":case"669":case"FAR":case"ULT":case"MTM":return new yk;case"IT":return new xk}}(a),this.activeFormat=a;const t=e.importMetadata?.modData?.initialBPM||125,n=e.importMetadata?.modData?.initialSpeed||6,{amigaLimits:s}=Ck.getState();this.baseBPM=t,this.pitchShiftSemitones=0,this.activeHandler.init({format:a,initialSpeed:n,initialTempo:t,numChannels:e.channels.length,emulatePTBugs:!0,linearSlides:"linear"===e.importMetadata?.xmData?.frequencyType,amigaLimits:s})}const o=this.activeHandler,r=Bw();this.automationPlayer.setPattern(e),this.automationPlayer.setAutomationData(this.automation);const i=[],l=[],c=o.speed??e.importMetadata?.modData?.initialSpeed??6,u=k().bpm.value,d=this.computeRowTimings(e,c,u),m=new Map;for(let w=0;w<t.length;w++)m.set(t[w].id,t[w]);for(let w=0;w<e.length;w++){const t=d[w],n=2.5/t.bpm,a=n*t.speed;for(let c=0;c<=t.delay;c++){const u=s+t.time+c*a+this.getGrooveOrSwingOffset(w,a);i.push({time:u,audioCallback:t=>{r.processInstrumentTicks(t),e.channels.forEach((e,n)=>{r.updateChannelEnvelopes(n);const s=e.rows[w],a=s.instrument??0,i=0!==a?a:e.instrumentId??0,l=s.note>0&&s.note<=96?Ja(s.note):97===s.note?"===":null,c=void 0!==s.effTyp&&null!==s.effTyp?$a(s.effTyp,s.eff??0):null,u=0===s.volume?255:s.volume,d=o.getChannelState(n),p=m.get(i);p?.metadata?.modPlayback&&(d.sampleDefaultVolume=p.metadata.modPlayback.defaultVolume,d.sampleDefaultFinetune=p.metadata.modPlayback.finetune),p&&(d.activeInstrument=p.metadata?.preservedSample?p.metadata:p);const h=o.processRowStart(n,l,a>0?a:null,u,c,d);if(h.triggerNote||this.applyTickEffects(n,h,o),h.stopSong)return void this.stop();if(void 0===h.patternBreak||this.pendingPatternBreak||(this.pendingPatternBreak={position:h.patternBreak}),void 0!==h.positionJump&&null===this.pendingPositionJump&&(this.pendingPositionJump=h.positionJump),void 0!==h.pastNoteAction&&r.handlePastNoteAction(n,h.pastNoteAction),97===s.note||h.keyOff){r.setChannelKeyOff(n);const e=this.channelNotes.get(n);return void(e&&0!==i&&(e.forEach(e=>{r.releaseNote(i,e,t,n)}),e.clear()))}if(h.triggerNote&&!h.preventNoteTrigger&&!r.isChannelMuted(n)&&p){const e=jN.getState(),a=e.getGrooveTemplate(),o=e.swing/100;let l=0;a&&(l=Fa(a,w)*o);let c=void 0!==h.setVolume?h.setVolume/64:null!==u&&u<=64?u/64:.8;c=Math.max(0,Math.min(1,c+l));const d=Ja(s.note);if(d){this.channelNotes.has(n)||this.channelNotes.set(n,new Set),this.channelNotes.get(n).add(d),this.channelActiveInstruments.set(n,i);const e=999;try{const a=h.setPeriod||s.period||0;r.triggerNote(i,d,e,t,c,p,1===s.flag1||1===s.flag2,2===s.flag1||2===s.flag2,n,a,h.sampleOffset,h.nnaAction),r.triggerChannelMeter(n,c)}catch(g){this.trackPlaybackError(d,g)}}}const f=h.setPeriod||d.period;if(f>0||s.note>0&&s.note<=96){let e;if(f>0){e=(p?.metadata?.modPlayback?.periodMultiplier||3546895)/f}else{const t=Ja(s.note);e=t?Lk(t):0}e>0&&r.initChannelPitch(n,i<<16|65535&n,e,1)}this.applyTickEffects(n,h,o)}),null!==this.pendingPositionJump&&(this.onPositionJump&&this.onPositionJump(this.pendingPositionJump),this.pendingPositionJump=null),this.pendingPatternBreak&&!this.patternBreakScheduled&&(this.patternBreakScheduled=!0,this.onPatternBreak?this.onPatternBreak(this.pendingPatternBreak.position):this.onPatternEnd&&this.onPatternEnd(),this.pendingPatternBreak=null)},uiCallback:()=>{0===c&&this.onRowChange&&this.onRowChange(w)}});for(let s=1;s<t.speed;s++){const t=u+s*n;l.push({time:t,callback:()=>{r.processInstrumentTicks(t),e.channels.forEach((e,t)=>{r.updateChannelEnvelopes(t);const n=o.processTick(t,s,o.getChannelState(t));this.applyTickEffects(t,n,o)})}})}}}const p=d[e.length-1],h=2.5/p.bpm*p.speed,f=s+(p.time+h);this.currentPatternEndTime=f;const g=this.onPatternEnd;if(g&&!this.nextPatternScheduled){const e=s+p.time;i.push({time:e,audioCallback:()=>{this.nextPatternScheduled||(this.nextPatternScheduled=!0,g())},uiCallback:()=>{}})}const b=k();b.loop=!1;const v=s>0;v||("started"===b.state&&b.stop(),b.position=0),!v&&this.currentPlayback&&(this.currentPlayback.rowPart.stop(),this.currentPlayback.rowPart.dispose(),this.currentPlayback.tickPart.dispose(),this.currentPlayback=null);const y=new Ee((e,t)=>{t.audioCallback(e),ke.schedule(()=>{t.uiCallback()},e)},i.map(e=>[e.time,{audioCallback:e.audioCallback,uiCallback:e.uiCallback}]));y.loop=!1,y.start(0);const x=new Ee((e,t)=>{t.callback(e)},l.map(e=>[e.time,{callback:e.callback}]));x.loop=!1,x.start(0);const N={rowPart:y,tickPart:x,handler:o,format:a};v?(this.nextPlayback&&(this.nextPlayback.rowPart.dispose(),this.nextPlayback.tickPart.dispose()),this.nextPlayback=N):(this.currentPlayback&&(this.currentPlayback.rowPart.dispose(),this.currentPlayback.tickPart.dispose()),this.currentPlayback=N),"started"!==b.state&&b.start()}getPatternEndTime(){return this.currentPatternEndTime}clearSchedule(){try{Bw().releaseAll()}catch(n){}this.pitchShiftSemitones=0;const e=Math.pow(2,this.globalPitchOffset/12),t=this.baseBPM*e;k().bpm.value=t,jN.getState().setBPM(t);Bw().setGlobalPlaybackRate(e),this.currentPlayback&&(this.currentPlayback.rowPart.dispose(),this.currentPlayback.tickPart.dispose(),this.currentPlayback=null),this.nextPlayback&&(this.nextPlayback.rowPart.dispose(),this.nextPlayback.tickPart.dispose(),this.nextPlayback=null);k().loop=!1,this.resetErrorTracking(),this.effectProcessor.clearAll(),this.channelNotes.clear(),this.channelActiveInstruments.clear(),this.patternBreakScheduled=!1,this.nextPatternScheduled=!1,this.currentPatternEndTime=0,this.pendingPatternBreak=null,this.pendingPositionJump=null}setOnRowChange(e){this.onRowChange=e}setOnPatternEnd(e){this.onPatternEnd=e}setOnPatternBreak(e){this.onPatternBreak=e}setOnPositionJump(e){this.onPositionJump=e}dispose(){this.clearSchedule(),this.onRowChange=null}}let Bk=null;const Ik=()=>(Bk||(Bk=new Ak),Bk),Fk=new Uint16Array(1936);for(let _0=0;_0<1936;_0++)Fk[_0]=4*(1936-_0);const Uk=new Uint16Array(1936);{for(let t=0;t<1919;t++)Uk[t]=Math.round(109568/Math.pow(2,(368+t)/192));const e=[22,16,8,0,16,32,24,16,8,0,16,32,24,16,8,0,0];for(let t=0;t<17;t++)Uk[1919+t]=e[t]}const Rk=[0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253],jk=new Float64Array(768),Xk=new Float64Array(32);for(let _0=0;_0<768;_0++)jk[_0]=2140928*Math.pow(2,_0/768);for(let _0=0;_0<32;_0++)Xk[_0]=1/Math.pow(2,_0);function zk(e,t,n){if(e<1||e>120)return 0;const s=16*(e-1)+(16+(t<<24>>27));return s<0||s>=1936?0:n?Fk[s]:Uk[s]}function Gk(e,t){if(0===(e&=65535))return 0;if(t){const t=9216-e&65535,n=t/768>>>0;return jk[t%768]*Xk[14-n&31]}return 14317456/e}function Hk(e,t,n){const s=49+e;if(s<1||s>120)return 8363;const a=zk(s,t,n);return 0===a?8363:Gk(a,n)}class Wk{static instance=null;static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;audioContext;workletNode=null;output;_initPromise;_resolveInit=null;_loadPromise=null;_resolveLoad=null;_rejectLoad=null;_positionCallbacks=new Set;_endedCallbacks=new Set;_playing=!1;_disposed=!1;constructor(){this.audioContext=oo(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}static getInstance(){return Wk.instance&&!Wk.instance._disposed||(Wk.instance=new Wk),Wk.instance}static hasInstance(){return!!Wk.instance&&!Wk.instance._disposed}async initialize(){try{await Wk.ensureInitialized(this.audioContext),this.createNode()}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const n=(async()=>{try{await e.audioWorklet.addModule("/musicline/MusicLine.worklet.js")}catch{}if(!this.wasmBinary||!this.jsCode){const[e,t]=await Promise.all([fetch("/musicline/MusicLine.wasm"),fetch("/musicline/MusicLine.js")]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),t.ok){let e=await t.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/HEAPU8=new Uint8Array\(b\);/,'HEAPU8=new Uint8Array(b);Module["HEAPU8"]=HEAPU8;').replace(/HEAPF32=new Float32Array\(b\);/,'HEAPF32=new Float32Array(b);Module["HEAPF32"]=HEAPF32;'),this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,n),n}createNode(){const e=this.audioContext;this.workletNode=new AudioWorkletNode(e,"musicline-processor",{outputChannelCount:[2],numberOfOutputs:1}),this.workletNode.port.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._resolveInit&&(this._resolveInit(),this._resolveInit=null);break;case"loaded":this._resolveLoad&&(this._resolveLoad({title:t.title??"",author:t.author??"",subsongs:t.subsongs??1}),this._resolveLoad=null,this._rejectLoad=null);break;case"ended":this._playing=!1;for(const e of this._endedCallbacks)e();break;case"position":for(const e of this._positionCallbacks)e({position:t.position,row:t.row,speed:t.speed});break;case"error":this._rejectLoad&&(this._rejectLoad(new Error(t.message)),this._resolveLoad=null,this._rejectLoad=null)}},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Wk.wasmBinary,jsCode:Wk.jsCode}),this.workletNode.connect(this.output)}async ready(){return this._initPromise}async loadSong(e){if(await this._initPromise,!this.workletNode)throw new Error("MusicLineEngine not initialized");this._loadPromise=new Promise((e,t)=>{this._resolveLoad=e,this._rejectLoad=t});const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return this.workletNode.port.postMessage({type:"load",buffer:t},[t]),this._loadPromise}async loadPreview(e){if(await this._initPromise,!this.workletNode)return;const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);this.workletNode.port.postMessage({type:"preview-load",buffer:t},[t])}play(){this._playing=!0,this.workletNode?.port.postMessage({type:"play"})}stop(){this._playing=!1,this.workletNode?.port.postMessage({type:"stop"})}setSubsong(e){this.workletNode?.port.postMessage({type:"set-subsong",subsong:e})}previewNoteOn(e,t,n){this.workletNode?.port.postMessage({type:"preview-note-on",instIdx:e,midiNote:t,velocity:n})}previewNoteOff(e){this.workletNode?.port.postMessage({type:"preview-note-off",instIdx:e})}previewStop(){this.workletNode?.port.postMessage({type:"preview-stop"})}isPlaying(){return this._playing}onPosition(e){return this._positionCallbacks.add(e),()=>this._positionCallbacks.delete(e)}onEnded(e){return this._endedCallbacks.add(e),()=>this._endedCallbacks.delete(e)}dispose(){this._disposed=!0,this.stop(),this.workletNode?.disconnect(),this.workletNode=null,this._positionCallbacks.clear(),this._endedCallbacks.clear(),Wk.instance===this&&(Wk.instance=null)}}const qk=Object.freeze(Object.defineProperty({__proto__:null,MusicLineEngine:Wk},Symbol.toStringTag,{value:"Module"})),Kk=3546895,$k=new Array(16);for(let _0=-8;_0<=7;_0++)$k[_0+8]=Math.pow(2,_0/96);const Yk=new Array(256);for(let _0=-128;_0<=127;_0++)Yk[_0+128]=Math.pow(2,_0/12);const Jk=new Array(11),Qk=new Array(11);for(let _0=0;_0<=10;_0++)Jk[_0]=Math.pow(2,_0),Qk[_0]=Math.pow(2,-_0);const Zk=new Int8Array(256);for(let _0=0;_0<256;_0++)Zk[_0]=Math.round(64*Math.sin(2*_0*Math.PI/256));const eD={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},tD=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114],nD=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],sD=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],aD=new Array(97);aD[0]="C4";for(let _0=1;_0<=96;_0++){const e=_0+11,t=Math.floor(e/12)-1,n=e%12;aD[_0]=`${sD[n]}${t}`}const oD=new Set(["Furnace","FurnaceOPN","FurnaceOPM","FurnaceOPL","FurnaceOPLL","FurnaceOPZ","FurnaceOPNA","FurnaceOPNB","FurnaceOPL4","FurnaceY8950","FurnaceESFM","FurnaceVRC7","FurnaceOPN2203","FurnaceOPNBB"]),rD=new Map;for(let _0=0;_0<3;_0++)for(let e=0;e<12;e++){const t=12*_0+e;if(t<36){const n=tD[t];rD.has(n)||rD.set(n,`${nD[e].replace("-","")}${_0+1}`)}}function iD(e){return aD[e]||"C4"}function lD(e){const t=rD.get(e);if(t)return t;for(let n=0;n<8;n++)for(let t=0;t<12;t++){const s=12*n+t;if(s<36&&tD[s]<=e){const s=`${nD[t].replace("-","")}${n+1}`;return rD.set(e,s),s}}return"C4"}const cD=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24],uD=new Map(Ba.map(e=>[e.id,e]));class dD{song=null;accessor=new Fw;_cachedTransportState=null;playing=!1;_songEndFiredThisBatch=!1;songPos=0;pattPos=0;currentTick=0;speed=6;bpm=125;globalVolume=64;linearPeriods=!1;useXMPeriods=!1;globalPitchTarget=0;globalPitchCurrent=0;globalPitchSlideSpeed=.5;totalRowsProcessed=0;totalTicksProcessed=0;speed2=null;speedAB=!1;channelTickCounters=[];channelPattPos=[];channelSongPos=[];channelGrooveToggle=[];pBreakPos=0;pBreakFlag=!1;posJumpFlag=!1;patternDelay=0;pattDelTime=0;pattDelTime2=0;channels=[];masterGain;separationNode;stereoMode="pt2";modplugSeparation=0;static MAX_STATE_QUEUE_SIZE=256;stateRing=Array.from({length:256},()=>({time:0,row:0,pattern:0,position:0,tick:0}));stateRingHead=0;stateRingTail=0;stateRingCount=0;lastDequeuedState=null;bufferCache=new Map;multiSampleBufferCache=new Map;_warnedMissingInstruments;instrumentMap=new Map;onRowChange=null;onSongEnd=null;onTickProcess=null;nudgeOffset=0;nudgeTicksRemaining=0;lineLoopStart=-1;lineLoopEnd=-1;lineLoopActive=!1;patternLoopStartPos=-1;patternLoopEndPos=-1;patternLoopActive=!1;slipEnabled=!1;slipSongPos=0;slipPattPos=0;isDJDeck=!1;tempoMultiplier=1;pitchMultiplier=1;deckDetuneCents=0;_suppressNotes=!1;channelMuteMask=65535;meterCallbacks=null;meterStaging=new Float64Array(64);stereoSeparation=100;routedNativeEngines=new Set;_muted=!1;onScratchEffect;constructor(e){if(this.masterGain=new m(1),this.separationNode=new Uw,this.masterGain.connect(this.separationNode.inputTone),e)this.separationNode.outputTone.connect(e),this.isDJDeck=!0;else{const e=Bw();this.separationNode.outputTone.connect(e.masterInput)}}getMasterGain(){return this.masterGain}setMuted(e){this._muted=e,this.masterGain.gain.value=e?0:1}getSeparationInput(){return this.separationNode.inputTone}getSongPos(){return this.songPos}getPattPos(){return this.pattPos}getTotalPositions(){return this.song?.songLength??0}getSong(){return this.song}jumpToPosition(e,t=0){this.seekTo(e,t)}setBPMDirect(e){this.bpm=Math.max(32,Math.min(255,e))}setNudge(e,t=8){this.nudgeOffset=e,this.nudgeTicksRemaining=t}setLineLoop(e,t){this.lineLoopStart=e,this.lineLoopEnd=e+t-1,this.lineLoopActive=!0,this.slipEnabled&&(this.slipSongPos=this.songPos,this.slipPattPos=this.pattPos)}clearLineLoop(){this.lineLoopActive=!1,this.lineLoopStart=-1,this.lineLoopEnd=-1,this.slipEnabled&&this.seekTo(this.slipSongPos,this.slipPattPos)}setPatternLoop(e,t){this.patternLoopStartPos=e,this.patternLoopEndPos=t,this.patternLoopActive=!0,this.slipEnabled&&(this.slipSongPos=this.songPos,this.slipPattPos=this.pattPos)}clearPatternLoop(){this.patternLoopActive=!1,this.patternLoopStartPos=-1,this.patternLoopEndPos=-1,this.slipEnabled&&this.seekTo(this.slipSongPos,this.slipPattPos)}setSlipEnabled(e){this.slipEnabled=e,e&&(this.slipSongPos=this.songPos,this.slipPattPos=this.pattPos)}getSlipState(){return{enabled:this.slipEnabled,songPos:this.slipSongPos,pattPos:this.slipPattPos}}setSuppressNotes(e){this._suppressNotes=e}setTempoMultiplier(e){this.tempoMultiplier=e}getTempoMultiplier(){return this.tempoMultiplier}setPitchMultiplier(e){this.pitchMultiplier=e,this.updateAllPlaybackRates()}resyncSchedulerToNow(){this.nextScheduleTime=Y()}setDetuneCents(e){this.deckDetuneCents=e}getDetuneCents(){return this.deckDetuneCents}setChannelMuteMask(e){this.channelMuteMask=e}setStereoSeparation(e){if(this.stereoSeparation=Math.max(0,Math.min(100,e)),"pt2"===this.stereoMode)for(const t of this.channels)this.applyChannelPan(t)}getStereoSeparation(){return this.stereoSeparation}setStereoSeparationMode(e){if(this.stereoMode=e,"pt2"===e){this.separationNode.setSeparation(100);for(const e of this.channels)this.applyChannelPan(e)}else{this.separationNode.setSeparation(this.modplugSeparation);for(const e of this.channels)e.panNode.pan.rampTo(e.basePan,.02)}}setModplugSeparation(e){this.modplugSeparation=Math.max(0,Math.min(200,e)),"modplug"===this.stereoMode&&this.separationNode.setSeparation(this.modplugSeparation)}getModplugSeparation(){return this.modplugSeparation}getStereoSeparationMode(){return this.stereoMode}applyChannelPan(e){const t="pt2"===this.stereoMode?e.basePan*(this.stereoSeparation/100):e.basePan;e.panNode.pan.rampTo(t,.02)}applyPanEffect(e,t,n){const s=(t-128)/128;e.basePan=s;const a="pt2"===this.stereoMode?s*(this.stereoSeparation/100):s;e.panNode.pan.setValueAtTime(a,n)}getEffectivePlaybackRate(){if(this.isDJDeck)return this.pitchMultiplier;return Bw().getGlobalPlaybackRate()}getElapsedMs(){if(!this.song)return 0;const e=2.5/(this.bpm*this.tempoMultiplier);return this.totalRowsProcessed*this.speed*e*1e3}loadSong(e){if(this.stop(),this.routedNativeEngines.size>0){const e=Bw();for(const t of this.routedNativeEngines)e.restoreNativeEngineRouting(t);this.routedNativeEngines.clear()}this.song=e,e.furnaceNative?this.accessor.setFurnace(e.furnaceNative,e.patterns,e.songPositions):e.hivelyNative?this.accessor.setHively(e.hivelyNative,e.patterns,e.songPositions):this.accessor.setClassic(e.patterns,e.songPositions),this.bufferCache.clear(),this.multiSampleBufferCache.clear(),this._warnedMissingInstruments=void 0,this.instrumentMap=new Map(e.instruments.map(e=>[e.id,e]));{const t=Bw();for(const n of e.instruments)"Sampler"===n.synthType&&n.sample?.audioBuffer&&!t.getDecodedBuffer(n.id)&&t.getInstrument(n.id,n)}e.musiclineFileData&&(async()=>{try{const t=Wk.getInstance();await t.ready(),await t.loadSong(e.musiclineFileData.slice(0))}catch(t){}})();for(const t of this.channels){for(const e of t.playerPool)try{e.dispose()}catch{}try{t.gainNode.dispose()}catch{}try{t.panNode.dispose()}catch{}try{t.muteGain.dispose()}catch{}}this.channels=[];for(let t=0;t<e.numChannels;t++)this.channels.push(this.createChannel(t,e.numChannels));if("MOD"===e.format||"AHX"===e.format||"FC"===e.format?this.stereoSeparation=20:"HVL"===e.format?this.stereoSeparation=e.hivelyMeta?.stereoMode?25*e.hivelyMeta.stereoMode:50:this.stereoSeparation=100,this.useXMPeriods="XM"===e.format||"IT"===e.format||"S3M"===e.format,this.linearPeriods=e.linearPeriods??"XM"===e.format,this.songPos=0,this.pattPos=0,this.currentTick=0,this.speed=e.initialSpeed,this.bpm=e.initialBPM,this.globalVolume=64,this.pBreakFlag=!1,this.pBreakPos=0,this.posJumpFlag=!1,this.patternDelay=0,this.pattDelTime=0,this.pattDelTime2=0,this.globalPitchCurrent=0,this.globalPitchTarget=0,this.tempoMultiplier=1,this.pitchMultiplier=1,this.deckDetuneCents=0,!this.isDJDeck){const t=Bw();t.setGlobalPlaybackRate(1),t.setGlobalDetune(0),k().bpm.value=e.initialBPM,jN.getState().setBPM(e.initialBPM),jN.getState().setGlobalPitch(0)}if(this.onRowChange=null,this.onSongEnd=null,this.onTickProcess=null,void 0!==e.speed2&&e.speed2!==e.initialSpeed?(this.speed2=e.speed2,this.speedAB=!0):(this.speed2=null,this.speedAB=!1),e.channelTrackTables){const t=e.numChannels;this.channelTickCounters=Array.from({length:t},()=>0),this.channelPattPos=Array.from({length:t},()=>0),this.channelSongPos=Array.from({length:t},()=>0),this.channelGrooveToggle=Array.from({length:t},()=>!1)}else this.channelTickCounters=[],this.channelPattPos=[],this.channelSongPos=[],this.channelGrooveToggle=[]}createChannel(e,t){let n;n=e+1>>1&1?1:-1;const s="pt2"===this.stereoMode?n*(this.stereoSeparation/100):n,a=new ue(s),o=new m(1),r=new m(1);o.connect(a),a.connect(r),r.connect(this.masterGain);const i=[];for(let l=0;l<2;l++){const e=new re;e.connect(o),i.push(e)}return{note:0,period:0,volume:64,panning:128,basePan:n,sampleNum:0,sampleOffset:0,finetune:0,relativeNote:0,portaSpeed:0,portaUpSpeed:0,portaDownSpeed:0,fPortaUpSpeed:0,fPortaDownSpeed:0,portaTarget:0,tonePortaSpeed:0,vibratoPos:0,vibratoCmd:0,tremoloPos:0,tremoloCmd:0,tremoloSpeed:0,tremoloDepth:0,waveControl:0,retrigCount:0,retrigVolSlide:0,patternLoopRow:0,patternLoopCount:0,glissandoMode:!1,tremorPos:0,tremorParam:0,efPitchSlideUpSpeed:0,efPitchSlideDownSpeed:0,prevEffTyp:0,prevEffParam:0,noteRetrigSpeed:0,noteRetrigVol:0,noteRetrigCounter:0,volColumnVol:0,oldVol:64,oldPan:128,rowInst:0,volSlideSpeed:0,fVolSlideUpSpeed:0,fVolSlideDownSpeed:0,globalVolSlide:0,panSlide:0,macroPos:0,macroReleased:!1,macroPitchOffset:0,macroArpNote:0,macroDuty:0,macroWaveform:0,keyOff:!1,fadeoutVol:32768,fadeoutSpeed:0,volEnvTick:0,volEnvPos:0,fVolEnvValue:0,fVolEnvDelta:0,panEnvTick:0,panEnvPos:0,fPanEnvValue:0,fPanEnvDelta:0,autoVibPos:0,autoVibAmp:0,autoVibSweep:0,outVol:64,outPan:128,fFinalVol:1,finalPan:128,finalPeriod:0,previousSlideFlag:!1,gateHigh:!1,lastPlayedNoteName:null,xmNote:0,player:null,playerPool:i,activePlayerIdx:0,gainNode:o,panNode:a,muteGain:r,instrument:null,_muteState:!1}}scheduleAheadTime=.1;schedulerInterval=.015;nextScheduleTime=0;lastGrooveTemplateId="straight";lastSwingAmount=100;lastGrooveSteps=2;schedulerTimerId=null;async play(){if(!this.song||this.playing)return;await VN(),await A();const e=ve.rawContext,t=()=>e.state;if("running"!==t()){await ve.resume();const e=2e3,n=Date.now();for(;"running"!==t()&&Date.now()-n<e;)await new Promise(e=>setTimeout(e,50));if("running"!==t())return}const n=Bw();if(await n.ensureWASMSynthsReady(this.song.instruments),this.song.hivelyFileData&&("HVL"===this.song.format||"AHX"===this.song.format))try{const e=Kr.getInstance();await e.ready();const t=this.song.hivelyMeta?.stereoMode??2;await e.loadTune(this.song.hivelyFileData.slice(0),t);const s=this.song.instruments.find(e=>"HivelySynth"===e.synthType);s&&n.getInstrument(s.id,s),this._muted||e.play()}catch(a){}if(this.song.musiclineFileData){this._suppressNotes=!0;try{const e=Wk.getInstance();if(await e.ready(),await e.loadSong(this.song.musiclineFileData.slice(0)),!this._muted&&(e.play(),!this.isDJDeck&&!this.routedNativeEngines.has("MusicLineSynth"))){n.routeNativeEngineOutput({name:"MusicLineSynth",output:e.output});const t=co(this.separationNode.inputTone);t&&(n.rerouteNativeEngine("MusicLineSynth",t),this.routedNativeEngines.add("MusicLineSynth"))}}catch(a){}}if(!this.isDJDeck)for(const o of this.song.instruments){const e=o.synthType;if(("UADESynth"===e||"HivelySynth"===e||"MusicLineSynth"===e)&&!this.routedNativeEngines.has(e)){const t=co(this.separationNode.inputTone);t&&(n.rerouteNativeEngine(e,t),this.routedNativeEngines.add(e))}}this.playing=!0;const s=jN.getState();this.lastGrooveTemplateId=s.grooveTemplateId,this.lastSwingAmount=s.swing,this.lastGrooveSteps=s.grooveSteps,await n.awaitPendingLoads(),this.startScheduler()}stop(){if(this.playing=!1,null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null),this.routedNativeEngines.size>0){const e=Bw();for(const t of this.routedNativeEngines)try{e.stopNativeEngine(t)}catch{}}if(this.song?.hivelyFileData&&("HVL"===this.song.format||"AHX"===this.song.format))try{Kr.hasInstance()&&Kr.getInstance().stop()}catch{}if(this.song?.musiclineFileData&&"ML"===this.song.format)try{Wk.hasInstance()&&Wk.getInstance().stop()}catch{}for(let e=0;e<this.channels.length;e++)this.stopChannel(this.channels[e],e);try{ke.cancel(0)}catch{}try{Bw().clearChannelTriggerLevels()}catch{}this.currentTick=0,this.lastGrooveTemplateId="straight",this.lastSwingAmount=100,this.lastGrooveSteps=2,this.clearStateQueue(),RN()}pause(){if(null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null),this.playing=!1,this.routedNativeEngines.size>0){const e=Bw();for(const t of this.routedNativeEngines)try{"HivelySynth"===t?Kr.getInstance().pause():e.stopNativeEngine(t)}catch{}}}resume(){this.song&&!this.playing&&(this.playing=!0,this.routedNativeEngines.has("HivelySynth")&&!this._muted&&Kr.getInstance().play(),this.startScheduler())}startScheduler(){this.nextScheduleTime=Y()+.02,this.totalRowsProcessed=0,this.totalTicksProcessed=0;const e=()=>{if(!this.playing)return;this._songEndFiredThisBatch=!1;const e=Y()+this.scheduleAheadTime,t=jN.getState();for(this._cachedTransportState=t,t.grooveTemplateId===this.lastGrooveTemplateId&&t.swing===this.lastSwingAmount&&t.grooveSteps===this.lastGrooveSteps||("undefined"!=typeof window&&window.GROOVE_DEBUG,this.lastGrooveTemplateId=t.grooveTemplateId,this.lastSwingAmount=t.swing,this.lastGrooveSteps=t.grooveSteps),Math.abs(t.bpm-this.bpm)>.1&&(this.bpm=t.bpm);this.nextScheduleTime<e&&this.playing;){this.processTick(this.nextScheduleTime);const e=2.5/((this.bpm+this.nudgeOffset)*this.tempoMultiplier);this.nextScheduleTime+=e}};e(),this.schedulerTimerId=setInterval(e,1e3*this.schedulerInterval)}calculateGrooveOffset(e,t,n){const s=uD.get(n.grooveTemplateId);if(s&&"straight"!==s.id){const a=n.swing/100,o=Math.max(1,Math.round(n.grooveSteps/s.values.length)),r=Ia(s,Math.floor(e/o),t)*a;return"undefined"!=typeof window&&window.GROOVE_DEBUG,r}return 0}processTick(e){if(!this.song||!this.playing)return;if(this.totalTicksProcessed++,this.song.channelTrackTables&&"classic"===this.accessor.getMode())return void this.processTickPerChannel(e);if(!this.useXMPeriods&&this.patternDelay>0)return void this.patternDelay--;const t=0===this.currentTick&&0===this.pattDelTime2,n=this._cachedTransportState??jN.getState(),s=2.5/this.bpm;let a=e;if(0===this.currentTick){const e=s*this.speed;a+=this.calculateGrooveOffset(this.pattPos,e,n)}if(n.jitter>0){const e=n.jitter/100*.01;a+=(2*Math.random()-1)*e}const o="classic"!==this.accessor.getMode(),r=this.song.songPositions[this.songPos],i=o?null:this.song.patterns[r];if(o||i){if(0===this.currentTick&&this.queueDisplayState(a,this.pattPos,r,this.songPos,0),!this._suppressNotes){if(!this.isDJDeck){const e=Bw();for(let t=0;t<this.channels.length;t++){const n=e.isChannelMuted(t);this.channels[t]._muteState!==n&&(this.channels[t]._muteState=n,this.channels[t].muteGain.gain.setValueAtTime(n?0:1,a))}}for(let e=0;e<this.channels.length;e++){const n=this.channels[e];let r;r=o?this.accessor.getRow(this.songPos,this.pattPos,e):i.channels[e]?.rows[this.pattPos],r&&(t?this.processRow(e,n,r,a):0!==this.currentTick&&this.processEffectTick(e,n,r,a+this.currentTick*s),this.processMacros(n,a+this.currentTick*s),this.processEnvelopesAndVibrato(n,a+this.currentTick*s))}this.doGlobalPitchSlide(a)}this.onTickProcess&&this.onTickProcess(this.currentTick,this.pattPos),this.currentTick++,this.currentTick>=this.speed&&(this.currentTick=0,null!==this.speed2&&(this.speedAB?(this.speed=this.speed2,this.speedAB=!1):(this.speed=this.song.initialSpeed,this.speedAB=!0)),this.advanceRow())}}queueDisplayState(e,t,n,s,a){const o=this.stateRing[this.stateRingHead];o.time=e,o.row=t,o.pattern=n,o.position=s,o.tick=a,this.stateRingHead=(this.stateRingHead+1)%dD.MAX_STATE_QUEUE_SIZE,this.stateRingCount<dD.MAX_STATE_QUEUE_SIZE?this.stateRingCount++:this.stateRingTail=(this.stateRingTail+1)%dD.MAX_STATE_QUEUE_SIZE}getStateAtTime(e,t=!1){if(!this.playing)return this.lastDequeuedState;if(t){let t=this.lastDequeuedState,n=this.stateRingTail;for(let s=0;s<this.stateRingCount;s++){const s=this.stateRing[n];if(!(s.time<=e))break;t=s,n=(n+1)%dD.MAX_STATE_QUEUE_SIZE}return t}let n=this.lastDequeuedState;for(;this.stateRingCount>0;){const t=this.stateRing[this.stateRingTail];if(!(t.time<=e))break;n=t,this.lastDequeuedState=n,this.stateRingTail=(this.stateRingTail+1)%dD.MAX_STATE_QUEUE_SIZE,this.stateRingCount--}return n}clearStateQueue(){this.stateRingHead=0,this.stateRingTail=0,this.stateRingCount=0,this.lastDequeuedState=null}processRow(e,t,n,s){if(!this.song)return;const a=1===n.flag1||1===n.flag2,o=2===n.flag1||2===n.flag2,r=3===n.flag1||3===n.flag2,i=4===n.flag1||4===n.flag2;if(r){if(t.gainNode.gain.setValueAtTime(0,s),t.player){try{t.player.stop(s)}catch{}t.player=null}return}const l=n.effTyp??(n.effect?parseInt(n.effect[0],16):0),c=n.eff??(n.effect?parseInt(n.effect.substring(1),16):0);t.volColumnVol=n.volume??0,this.useXMPeriods&&(0===t.prevEffTyp?t.prevEffParam>0&&this.updatePeriod(t):4!==t.prevEffTyp&&6!==t.prevEffTyp||4===l||6===l||this.updatePeriod(t),t.prevEffTyp=l,t.prevEffParam=c);const u=n.instrument??0;let d=0;if(u>0){const e=this.instrumentMap.get(u);if(e){if(t.instrument=e,t.sampleNum=u,d=u,!this.useXMPeriods){const n=e.metadata?.modPlayback?.defaultVolume;t.volume=void 0!==n?Math.min(64,n):64,t.finetune=e.metadata?.modPlayback?.finetune??0,t.relativeNote=e.metadata?.modPlayback?.relativeNote??0,t.gainNode.gain.setValueAtTime(t.volume/64,s)}}else d=0,this._warnedMissingInstruments||(this._warnedMissingInstruments=new Set),this._warnedMissingInstruments.has(u)||this._warnedMissingInstruments.add(u)}if(t.rowInst=d,this.useXMPeriods&&14===l&&208==(240&c)&&(15&c)>=1)return;const m=n.note,p=n.period,h=n.probability,f=void 0!==h&&h>0&&h<100&&100*Math.random()>=h,g=o||i;if(this.useXMPeriods){if(!(14===l&&144===c)){const a=n.volume??0,o=!(240&~a),r=3===l||5===l;if(o||r){if(o){const e=15&a;e>0&&(t.tonePortaSpeed=64*e)}if(r&&5!==l&&0!==c&&(t.tonePortaSpeed=4*c),m>0&&!f)if(97===m)this.xmKeyOff(t),t.previousSlideFlag=!1,this.releaseMacros(t);else{t.xmNote=m;const e=this.noteToPlaybackPeriod(m,p,t);t.portaTarget=e}return d>0&&(this.resetXMVolumes(t,s),97!==m&&this.triggerEnvelopes(t)),void this.processAllEffectsTick0(e,t,n,l,c,s)}if(20===l&&0===c)return this.xmKeyOff(t),d>0&&this.resetXMVolumes(t,s),void this.processAllEffectsTick0(e,t,n,l,c,s);if(!m||0===m)return d>0&&(this.resetXMVolumes(t,s),this.triggerEnvelopes(t)),void this.processAllEffectsTick0(e,t,n,l,c,s)}if(97===m)this.xmKeyOff(t),t.previousSlideFlag=!1,this.releaseMacros(t);else if(m>0&&!f){if(t.xmNote=m,t.instrument?.metadata?.sampleMap&&t.instrument.metadata.multiSamples){const e=Math.max(0,Math.min(95,m-1)),n=t.instrument.metadata.sampleMap[e]??0,s=t.instrument.metadata.multiSamples;if(n<s.length){const e=s[n];t.instrument={...t.instrument,sample:e.sample},t.finetune=e.finetune,t.relativeNote=e.relativeNote,t.oldVol=void 0!==e.defaultVolume?Math.min(64,e.defaultVolume):64,t.oldPan=e.panning??128}}else{const e=t.instrument?.metadata?.modPlayback;t.finetune=e?.finetune??0,t.relativeNote=e?.relativeNote??0,t.oldVol=void 0!==e?.defaultVolume?Math.min(64,e.defaultVolume):64,t.oldPan=e?.panning??128}14===l&&80==(240&c)&&(t.finetune=16*(15&c)-128);const n=this.noteToPlaybackPeriod(m,p,t);t.note=n,t.period=t.note;let r=0;9===l&&(r=c>0?256*c:256*t.sampleOffset,t.sampleOffset=c>0?c:t.sampleOffset);const u=t.previousSlideFlag&&null!==m&&!i,d="TB303"===t.instrument?.synthType||"Buzz3o3"===t.instrument?.synthType;if("undefined"!=typeof window&&window.TB303_DEBUG_ENABLED&&d){const e=m?m+11:0;Math.floor(e/12)}const h=this.useXMPeriods||d?iD(m??0):lD(n);t.lastPlayedNoteName=h,this.triggerNote(t,s,r,e,a,u,g,i),t.previousSlideFlag=(o||i)??!1}return d>0&&(this.resetXMVolumes(t,s),97!==m&&this.triggerEnvelopes(t)),void this.processAllEffectsTick0(e,t,n,l,c,s)}if(m&&0!==m&&97!==m&&!f){if(t.xmNote=m,14===l&&80==(240&c)){const e=15&c;t.finetune=e>7?e-16:e}const n=this.noteToPlaybackPeriod(m,p,t);if(3===l||5===l)t.portaTarget=n,0!==c&&3===l&&(t.tonePortaSpeed=c);else{t.note=n,t.period=t.note;let o=0;9===l&&(o=c>0?256*c:256*t.sampleOffset,t.sampleOffset=c>0?c:t.sampleOffset);const r=t.previousSlideFlag&&null!==m&&!i,u="TB303"===t.instrument?.synthType||"Buzz3o3"===t.instrument?.synthType;if("undefined"!=typeof window&&window.TB303_DEBUG_ENABLED&&u){const e=m?m+11:0;Math.floor(e/12)}const d=this.useXMPeriods||u?iD(m??0):lD(n);t.lastPlayedNoteName=d,this.triggerNote(t,s,o,e,a,r,g,i),this.triggerEnvelopes(t),t.outVol=t.volume,t.outPan=t.panning}}if(m&&97!==m&&(t.previousSlideFlag=(o||i)??!1),97===m){t.previousSlideFlag=!1;"TB303"===t.instrument?.synthType||t.instrument;"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,this.releaseMacros(t),this.stopChannel(t,e,s)}this.processAllEffectsTick0(e,t,n,l,c,s)}processVolColumnTick0(e,t,n){if(void 0===t.volume||t.volume<=0)return;const s=t.volume,a=s>>4,o=15&s;if(a>=1&&a<=5){const t=s-16;e.volume=t>64?64:t,e.gainNode.gain.setValueAtTime(e.volume/64,n)}else 8===a?(e.volume=Math.max(0,e.volume-o),e.gainNode.gain.setValueAtTime(e.volume/64,n)):9===a?(e.volume=Math.min(64,e.volume+o),e.gainNode.gain.setValueAtTime(e.volume/64,n)):10===a?0!==o&&(e.vibratoCmd=15&e.vibratoCmd|o<<4):12===a&&(e.panning=o<<4,this.applyPanEffect(e,e.panning,n))}processAllEffectsTick0(e,t,n,s,a,o){this.processVolColumnTick0(t,n,o),this.processEffect0(e,t,s,a,o);const r=n.effTyp2??0,i=n.eff2??0,l=(n.volume??0)>=96;0===r&&0===i||l||this.processEffect0(e,t,r,i,o),(n.effTyp3||n.eff3)&&this.processEffect0(e,t,n.effTyp3??0,n.eff3??0,o),(n.effTyp4||n.eff4)&&this.processEffect0(e,t,n.effTyp4??0,n.eff4??0,o),(n.effTyp5||n.eff5)&&this.processEffect0(e,t,n.effTyp5??0,n.eff5??0,o),(n.effTyp6||n.eff6)&&this.processEffect0(e,t,n.effTyp6??0,n.eff6??0,o),(n.effTyp7||n.eff7)&&this.processEffect0(e,t,n.effTyp7??0,n.eff7??0,o),(n.effTyp8||n.eff8)&&this.processEffect0(e,t,n.effTyp8??0,n.eff8??0,o)}processEffect0(e,t,n,s,a){const o=s>>4&15,r=15&s;if(t.instrument?.synthType?.startsWith("Furnace")){const a=Bw();11===n||13===n||15===n||(14===n?a.applyFurnaceExtendedEffect(t.instrument.id,o,r,e):a.applyFurnaceEffect(t.instrument.id,n,s,e))}switch(n){case 0:case 5:case 6:case 10:break;case 1:0!==s&&(t.portaSpeed=s,t.portaUpSpeed=s);break;case 2:0!==s&&(t.portaSpeed=s,t.portaDownSpeed=s);break;case 3:0!==s&&(t.tonePortaSpeed=this.useXMPeriods?4*s:s);break;case 4:0!==o&&(t.vibratoCmd=15&t.vibratoCmd|o<<4),0!==r&&(t.vibratoCmd=240&t.vibratoCmd|r);break;case 7:0!==o&&(t.tremoloCmd=15&t.tremoloCmd|o<<4),0!==r&&(t.tremoloCmd=240&t.tremoloCmd|r),0!==r&&(t.tremoloDepth=r),0!==o&&(t.tremoloSpeed=o<<2);break;case 8:t.panning=s,this.applyPanEffect(t,s,a);break;case 9:0!==s&&(t.sampleOffset=s);break;case 11:this.songPos=s-1,this.pBreakPos=0,this.posJumpFlag=!0;break;case 12:t.volume=Math.min(64,s),t.gainNode.gain.setValueAtTime(t.volume/64,a);break;case 13:"MOD"===this.song?.format||"XM"===this.song?.format?(this.pBreakPos=10*o+r,this.pBreakPos>63&&(this.pBreakPos=0)):(this.pBreakPos=s,this.pBreakPos>255&&(this.pBreakPos=0)),this.posJumpFlag=!0;break;case 14:this.processExtendedEffect0(e,t,o,r,a);break;case 15:0===s||(s<32?this.speed!==s&&(this.speed=s,null!==this.speed2&&(this.speed2=null),jN.getState().setSpeed(s)):this.bpm!==s&&(this.bpm=s,jN.getState().setBPM(s)));break;case 16:this.globalVolume=Math.min(64,s),this.updateAllChannelVolumes(a);break;case 17:0!==s&&(t.globalVolSlide=s);break;case 21:{if(!this.useXMPeriods||!t.instrument?.metadata)break;const e=t.instrument.metadata,n=e.originalEnvelope;if(n?.enabled&&n.points.length>0){t.volEnvTick=s-1;let e=0,a=s,o=!0;if(n.points.length>1){e=1;for(let s=0;s<n.points.length-1;s++){if(a<n.points[e].tick){if(e--,a-=n.points[e].tick,0===a){o=!1;break}const s=n.points[e+1].tick-n.points[e].tick;if(s<=0){o=!0;break}const r=255&n.points[e].value,i=255&n.points[e+1].value;t.fVolEnvDelta=(i-r)/s,t.fVolEnvValue=r+t.fVolEnvDelta*(a-1),e++,o=!1;break}e++}o&&e--}o&&(t.fVolEnvDelta=0,t.fVolEnvValue=255&n.points[Math.max(0,Math.min(e,n.points.length-1))].value),t.volEnvPos=Math.max(0,Math.min(e,n.points.length-1))}const a=e.panningEnvelope;if(n?.enabled&&a?.enabled&&a.points.length>0){t.panEnvTick=s-1;let e=0,n=s,o=!0;if(a.points.length>1){e=1;for(let s=0;s<a.points.length-1;s++){if(n<a.points[e].tick){if(e--,n-=a.points[e].tick,0===n){o=!1;break}const s=a.points[e+1].tick-a.points[e].tick;if(s<=0){o=!0;break}const r=255&a.points[e].value,i=255&a.points[e+1].value;t.fPanEnvDelta=(i-r)/s,t.fPanEnvValue=r+t.fPanEnvDelta*(n-1),e++,o=!1;break}e++}o&&e--}o&&(t.fPanEnvDelta=0,t.fPanEnvValue=255&a.points[Math.max(0,Math.min(e,a.points.length-1))].value),t.panEnvPos=Math.max(0,Math.min(e,a.points.length-1))}break}case 25:0!==s&&(t.panSlide=s);break;case 27:{let n=15&s;0===n&&(n=t.noteRetrigSpeed),t.noteRetrigSpeed=n;let o=s>>4&15;0===o&&(o=t.noteRetrigVol),t.noteRetrigVol=o,0===t.volColumnVol&&this.doMultiNoteRetrig(t,e,a);break}case 32:this.globalPitchTarget=(s-128)/128*12;break;case 33:if(this.useXMPeriods){const e=s>>4&15,n=15&s;if(1===e){const e=0!==n?n:t.efPitchSlideUpSpeed;t.efPitchSlideUpSpeed=e,t.period-=e,t.period<1&&(t.period=1),this.updatePeriod(t)}else if(2===e){const e=0!==n?n:t.efPitchSlideDownSpeed;t.efPitchSlideDownSpeed=e,t.period+=e,t.period>31999&&(t.period=31999),this.updatePeriod(t)}}else this.onScratchEffect&&this.onScratchEffect(s)}}processExtendedEffect0(e,t,n,s,a){switch(n){case 1:this.useXMPeriods?(0!==s&&(t.fPortaUpSpeed=s),t.period-=4*t.fPortaUpSpeed,t.period<1&&(t.period=1)):t.period=Math.max(113,t.period-s),this.updatePeriod(t);break;case 2:this.useXMPeriods?(0!==s&&(t.fPortaDownSpeed=s),t.period+=4*t.fPortaDownSpeed,t.period>31999&&(t.period=31999)):t.period=Math.min(856,t.period+s),this.updatePeriod(t);break;case 3:t.glissandoMode=0!==s;break;case 4:t.waveControl=240&t.waveControl|15&s;break;case 5:this.useXMPeriods?t.finetune=16*s-128:t.finetune=s>7?s-16:s;break;case 6:0===s?t.patternLoopRow=this.pattPos:(0===t.patternLoopCount?t.patternLoopCount=s:t.patternLoopCount--,0!==t.patternLoopCount&&(this.pBreakPos=t.patternLoopRow,this.pBreakFlag=!0));break;case 7:t.waveControl=15&t.waveControl|(15&s)<<4;break;case 9:t.retrigCount=s;break;case 12:0===s&&(t.volume=0,t.outVol=0,t.gainNode.gain.setValueAtTime(0,a));break;case 10:{const e=0!==s?s:t.fVolSlideUpSpeed;t.fVolSlideUpSpeed=e,t.volume=Math.min(64,t.volume+e),t.gainNode.gain.setValueAtTime(t.volume/64,a);break}case 11:{const e=0!==s?s:t.fVolSlideDownSpeed;t.fVolSlideDownSpeed=e,t.volume=Math.max(0,t.volume-e),t.gainNode.gain.setValueAtTime(t.volume/64,a);break}case 14:this.useXMPeriods?0===this.pattDelTime2&&(this.pattDelTime=s+1):this.patternDelay=s*this.speed}}processEffectTick(e,t,n,s){const a=1===n.flag1||1===n.flag2,o=2===n.flag1||2===n.flag2,r=3===n.flag1||3===n.flag2;if(4===n.flag1||n.flag2,r)return;const i=n.effTyp??(n.effect?parseInt(n.effect[0],16):0),l=n.eff??(n.effect?parseInt(n.effect.substring(1),16):0),c=l>>4&15,u=15&l,d=n.volume??0;if(this.useXMPeriods&&d>=96){const e=15&d;switch(d>>4){case 6:t.volume=Math.max(0,t.volume-e),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 7:t.volume=Math.min(64,t.volume+e),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 11:e>0&&(t.vibratoCmd=240&t.vibratoCmd|e),this.doVibrato(t);break;case 13:{const n=256-e&255,a=t.panning+n;t.panning=a<256?0:255&a,this.applyPanEffect(t,t.panning,s);break}case 14:t.panning=Math.min(255,t.panning+e),this.applyPanEffect(t,t.panning,s);break;case 15:this.doTonePortamento(t)}}const m=n.effTyp2??0,p=n.eff2??0;switch(0===m&&0===p||d>=96||this.processEffectTickSingle(e,t,n,m,p,s),(n.effTyp3||n.eff3)&&this.processEffectTickSingle(e,t,n,n.effTyp3??0,n.eff3??0,s),(n.effTyp4||n.eff4)&&this.processEffectTickSingle(e,t,n,n.effTyp4??0,n.eff4??0,s),(n.effTyp5||n.eff5)&&this.processEffectTickSingle(e,t,n,n.effTyp5??0,n.eff5??0,s),(n.effTyp6||n.eff6)&&this.processEffectTickSingle(e,t,n,n.effTyp6??0,n.eff6??0,s),(n.effTyp7||n.eff7)&&this.processEffectTickSingle(e,t,n,n.effTyp7??0,n.eff7??0,s),(n.effTyp8||n.eff8)&&this.processEffectTickSingle(e,t,n,n.effTyp8??0,n.eff8??0,s),t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,i,l,c,u),i){case 0:0!==l&&this.doArpeggio(t,l);break;case 1:this.useXMPeriods?(t.period-=4*t.portaUpSpeed,t.period<1&&(t.period=1)):t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:this.useXMPeriods?(t.period+=4*t.portaDownSpeed,t.period>31999&&(t.period=31999)):t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,l,s);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,l,s);break;case 7:this.doTremolo(t,s);break;case 10:this.doVolumeSlide(t,l,s);break;case 14:if(9===c&&u>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=u,this.triggerNote(t,s,0,e,!1,!1,!1),this.triggerEnvelopes(t));else if(12===c&&u===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,s);else if(13===c&&u===this.currentTick){const n=t.previousSlideFlag;this.triggerNote(t,s,0,e,a,n,o),t.rowInst>0&&this.resetXMVolumes(t,s),this.triggerEnvelopes(t);const r=t.volColumnVol;r>=16&&r<=80?(t.outVol=r-16,t.volume=t.outVol,t.gainNode.gain.setValueAtTime(t.volume/64,s)):r>=192&&r<=207&&(t.outPan=(15&r)<<4,t.panning=t.outPan,this.applyPanEffect(t,t.panning,s))}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,s);break;case 25:this.doPanSlide(t,t.panSlide,s);break;case 20:this.useXMPeriods?this.currentTick===(31&l)&&this.xmKeyOff(t):this.currentTick===(31&l)&&this.stopChannel(t,e,s);break;case 27:this.doMultiNoteRetrig(t,e,s);break;case 29:{const e=0!==l?l:t.tremorParam;t.tremorParam=e;let n=128&t.tremorPos,a=127&t.tremorPos;a--,(a<0||128&a)&&(128===n?(n=0,a=15&e):(n=128,a=e>>4&15)),t.tremorPos=n|127&a;const o=128===n?t.volume:0;t.gainNode.gain.setValueAtTime(o/64,s);break}}}processEffectTickSingle(e,t,n,s,a,o){const r=1===n.flag1||1===n.flag2,i=2===n.flag1||2===n.flag2,l=a>>4&15,c=15&a;switch(t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,s,a,l,c),s){case 0:0!==a&&this.doArpeggio(t,a);break;case 1:this.useXMPeriods?(t.period-=4*t.portaUpSpeed,t.period<1&&(t.period=1)):t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:this.useXMPeriods?(t.period+=4*t.portaDownSpeed,t.period>31999&&(t.period=31999)):t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,a,o);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,a,o);break;case 7:this.doTremolo(t,o);break;case 10:this.doVolumeSlide(t,a,o);break;case 14:if(9===l&&c>0)this.currentTick%c===0&&(this.triggerNote(t,o,0,e,!1,!1,!1),this.triggerEnvelopes(t));else if(12===l&&c===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,o);else if(13===l&&c===this.currentTick){const n=t.previousSlideFlag;this.triggerNote(t,o,0,e,r,n,i),t.rowInst>0&&this.resetXMVolumes(t,o),this.triggerEnvelopes(t);const s=t.volColumnVol;s>=16&&s<=80?(t.outVol=s-16,t.volume=t.outVol,t.gainNode.gain.setValueAtTime(t.volume/64,o)):s>=192&&s<=207&&(t.outPan=(15&s)<<4,t.panning=t.outPan,this.applyPanEffect(t,t.panning,o))}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,o);break;case 20:this.useXMPeriods?this.currentTick===(31&a)&&this.xmKeyOff(t):this.currentTick===(31&a)&&this.stopChannel(t,e,o);break;case 25:this.doPanSlide(t,t.panSlide,o);break;case 27:this.doMultiNoteRetrig(t,e,o);break;case 29:{const e=0!==a?a:t.tremorParam;t.tremorParam=e;let n=128&t.tremorPos,s=127&t.tremorPos;s--,(s<0||128&s)&&(128===n?(n=0,s=15&e):(n=128,s=e>>4&15)),t.tremorPos=n|127&s;const r=128===n?t.volume:0;t.gainNode.gain.setValueAtTime(r/64,o);break}}}forwardEffectToFurnace(e,t,n,s,a,o){if(11===n||13===n||15===n||0===n&&0===s)return;const r=Bw();14===n?r.applyFurnaceExtendedEffect(e.instrument.id,a,o,t):r.applyFurnaceEffect(e.instrument.id,n,s,t)}doArpeggio(e,t){if(this.useXMPeriods){const n=Rk[31&this.currentTick];if(0===n)this.updatePeriodDirect(e,e.period);else{const s=1===n?t>>4&15:15&t,a=function(e,t,n,s){if(0===e||0===t)return e;const a=s?Fk:Uk,o=16+(n<<24>>27);let r=0,i=2147483647;for(let u=1;u<=96;u++){const t=16*(u-1)+o;if(t<0||t>=1936)continue;const n=a[t],s=Math.abs(n-e);s<i&&(i=s,r=u)}if(0===r)return e;const l=r+t;if(l<1||l>96)return e;const c=16*(l-1)+o;return c<0||c>=1936?e:a[c]}(e.period,s,e.finetune,this.linearPeriods);this.updatePeriodDirect(e,a)}}else{const n=t>>4&15,s=15&t,a=this.currentTick%3;let o=e.note;1===a?o=this.periodPlusSemitones(e.note,n,e.finetune):2===a&&(o=this.periodPlusSemitones(e.note,s,e.finetune)),this.updatePeriodDirect(e,o)}}doTonePortamento(e){if(0!==e.portaTarget&&e.period!==e.portaTarget)if(e.period<e.portaTarget?(e.period+=e.tonePortaSpeed,e.period>e.portaTarget&&(e.period=e.portaTarget)):(e.period-=e.tonePortaSpeed,e.period<e.portaTarget&&(e.period=e.portaTarget)),e.glissandoMode&&this.useXMPeriods){const t=function(e,t,n){if(0===e)return 0;const s=n?Fk:Uk,a=16+(t<<24>>27);let o=1536,r=0;for(let l=0;l<8;l++){const t=(r+o>>1&-16)+a;let n=t-8;n<0&&(n=0),n>=s.length&&(n=s.length-1),e>=s[n]?o=t-a&-16:r=t-a&-16}let i=r+a;return i>=1550&&(i=1550),i<0&&(i=0),i>=s.length&&(i=s.length-1),s[i]}(e.period,e.finetune,this.linearPeriods);this.updatePeriodDirect(e,t)}else this.updatePeriod(e)}doVibrato(e){const t=e.vibratoCmd>>4&15,n=15&e.vibratoCmd;if(this.useXMPeriods){const s=3&e.waveControl;let a=e.vibratoPos>>2&31;0===s?a=cD[a]:1===s?(a<<=3,128&e.vibratoPos&&(a=255&~a)):a=255,a=a*n>>5,128&e.vibratoPos?this.updatePeriodDirect(e,e.period-a):this.updatePeriodDirect(e,e.period+a),e.vibratoPos=e.vibratoPos+4*t&255}else{const s=3&e.waveControl;let a;0===s?a=cD[31&e.vibratoPos]:1===s?(a=8*(31&e.vibratoPos),e.vibratoPos>=32&&(a=255-a)):a=255;let o=a*n>>7;e.vibratoPos>=32&&(o=-o),this.updatePeriodDirect(e,e.period+o),e.vibratoPos=e.vibratoPos+t&63}}doTremolo(e,t){if(this.useXMPeriods){const n=e.waveControl>>4&3;let s,a=e.tremoloPos>>2&31;0===n?a=cD[a]:1===n?(a<<=3,128&e.vibratoPos&&(a=255&~a)):a=255,a=a*e.tremoloDepth>>6,128&e.tremoloPos?(s=e.volume-a,s<0&&(s=0)):(s=e.volume+a,s>64&&(s=64)),e.gainNode.gain.setValueAtTime(s/64,t),e.tremoloPos=e.tremoloPos+e.tremoloSpeed&255}else{const n=e.tremoloCmd>>4&15,s=15&e.tremoloCmd,a=e.waveControl>>4&3;let o;0===a?o=cD[31&e.tremoloPos]:1===a?(o=8*(31&e.tremoloPos),e.tremoloPos>=32&&(o=255-o)):o=255;let r=o*s>>6;e.tremoloPos>=32&&(r=-r);const i=Math.max(0,Math.min(64,e.volume+r));e.gainNode.gain.setValueAtTime(i/64,t),e.tremoloPos=e.tremoloPos+n&63}}doVolumeSlide(e,t,n){0===t&&(t=e.volSlideSpeed),e.volSlideSpeed=t;const s=t>>4&15,a=15&t;s>0?e.volume=Math.min(64,e.volume+s):a>0&&(e.volume=Math.max(0,e.volume-a)),e.gainNode.gain.setValueAtTime(e.volume/64,n)}doGlobalVolumeSlide(e,t){const n=e>>4&15,s=15&e;n>0?this.globalVolume=Math.min(64,this.globalVolume+n):s>0&&(this.globalVolume=Math.max(0,this.globalVolume-s)),this.updateAllChannelVolumes(t)}doGlobalPitchSlide(e){if(Math.abs(this.globalPitchCurrent-this.globalPitchTarget)<.01)return void(this.globalPitchCurrent=this.globalPitchTarget);this.globalPitchCurrent<this.globalPitchTarget?(this.globalPitchCurrent+=this.globalPitchSlideSpeed,this.globalPitchCurrent>this.globalPitchTarget&&(this.globalPitchCurrent=this.globalPitchTarget)):(this.globalPitchCurrent-=this.globalPitchSlideSpeed,this.globalPitchCurrent<this.globalPitchTarget&&(this.globalPitchCurrent=this.globalPitchTarget));const t=Math.min(255,Math.max(0,Math.round(this.globalPitchCurrent)+128)),n=Yk[t];if(this.isDJDeck)this.updateAllPlaybackRates();else{const e=Bw();e.setGlobalPlaybackRate(n),this.updateAllPlaybackRates(),e.setGlobalDetune(100*this.globalPitchCurrent);const t=Math.round(this.bpm*n*100)/100;jN.getState().setBPM(t),k().bpm.value=t,jN.getState().setGlobalPitch(this.globalPitchCurrent);Ik().setGlobalPitchOffset(this.globalPitchCurrent)}}doPanSlide(e,t,n){const s=t>>4&15,a=15&t;s>0?e.panning=Math.min(255,e.panning+s):a>0&&(e.panning=Math.max(0,e.panning-a)),this.applyPanEffect(e,e.panning,n)}doMultiNoteRetrig(e,t,n){const s=e.noteRetrigCounter+1;if(s<e.noteRetrigSpeed)return void(e.noteRetrigCounter=s);e.noteRetrigCounter=0;let a=e.volume;switch(e.noteRetrigVol){case 1:a-=1;break;case 2:a-=2;break;case 3:a-=4;break;case 4:a-=8;break;case 5:a-=16;break;case 6:a=(a>>1)+(a>>3)+(a>>4);break;case 7:a>>=1;break;case 8:break;case 9:a+=1;break;case 10:a+=2;break;case 11:a+=4;break;case 12:a+=8;break;case 13:a+=16;break;case 14:a=(a>>1)+a;break;case 15:a+=a}a<0&&(a=0),a>64&&(a=64),e.volume=a,e.outVol=a,e.volColumnVol>=16&&e.volColumnVol<=80?(e.outVol=e.volColumnVol-16,e.volume=e.outVol):e.volColumnVol>=192&&e.volColumnVol<=207&&(e.outPan=(15&e.volColumnVol)<<4),e.gainNode.gain.setValueAtTime(e.volume/64,n),this.triggerNote(e,n,0,t,!1,!1,!1)}triggerEnvelopes(e){if(4&e.waveControl||(e.vibratoPos=0),64&e.waveControl||(e.tremoloPos=0),e.noteRetrigCounter=0,e.tremorPos=0,e.keyOff=!1,!e.instrument?.metadata)return;const t=e.instrument.metadata,n=t.originalEnvelope;n?.enabled&&(e.volEnvTick=65535,e.volEnvPos=0);const s=t.panningEnvelope;s?.enabled&&(e.panEnvTick=65535,e.panEnvPos=0),e.fadeoutSpeed=t.fadeout??t.modPlayback?.fadeout??0,e.fadeoutVol=32768;const a=t.autoVibrato;a&&a.depth>0&&(e.autoVibPos=0,a.sweep>0?(e.autoVibAmp=0,e.autoVibSweep=(a.depth<<8)/a.sweep|0):(e.autoVibAmp=a.depth<<8,e.autoVibSweep=0))}resetXMVolumes(e,t){e.volume=e.oldVol,e.outVol=e.oldVol,e.panning=e.oldPan,e.outPan=e.oldPan,e.gainNode.gain.setValueAtTime(e.volume/64,t)}xmKeyOff(e){e.keyOff=!0;const t=e.instrument?.metadata;if(!t)return;const n=t.originalEnvelope;if(n?.enabled){const t=n.points;if(t&&e.volEnvPos<t.length){const n=t[e.volEnvPos].tick;e.volEnvTick>=n&&(e.volEnvTick=n>0?n-1:0)}}else e.outVol=0,e.volume=0;const s=t.panningEnvelope;if(!s?.enabled){const t=s?.points;if(t&&e.panEnvPos<t.length){const n=t[e.panEnvPos].tick;e.panEnvTick>=n&&(e.panEnvTick=n>0?n-1:0)}}}processEnvelopesAndVibrato(e,t){if(!this.useXMPeriods)return;if(!e.instrument?.metadata)return;const n=e.instrument.metadata;e.outVol=e.volume,e.outPan=e.panning,e.keyOff&&e.fadeoutSpeed>0&&(e.fadeoutVol-=e.fadeoutSpeed,e.fadeoutVol<=0&&(e.fadeoutVol=0,e.fadeoutSpeed=0));const s=n.originalEnvelope;let a=0;if(s?.enabled&&s.points&&s.points.length>0){let t=!1,n=e.volEnvPos;if(e.volEnvTick++,e.volEnvTick===s.points[n]?.tick)if(e.fVolEnvValue=255&(s.points[n].value??0),n++,null!==s.loopEndPoint&&null!==s.loopStartPoint&&(n--,n===s.loopEndPoint&&(null===s.sustainPoint||n!==s.sustainPoint||e.keyOff)&&(n=s.loopStartPoint,e.volEnvTick=s.points[n].tick,e.fVolEnvValue=255&(s.points[n].value??0)),n++),n<s.points.length){let o=!0;if(null===s.sustainPoint||e.keyOff||n-1===s.sustainPoint&&(n--,e.fVolEnvDelta=0,o=!1),o){e.volEnvPos=n;const o=s.points[n-1].tick,r=s.points[n].tick-o;if(r>0){const o=255&(s.points[n-1].value??0),i=255&(s.points[n].value??0);e.fVolEnvDelta=(i-o)/r,a=e.fVolEnvValue,t=!0}else e.fVolEnvDelta=0}}else e.fVolEnvDelta=0;t||(e.fVolEnvValue+=e.fVolEnvDelta,a=e.fVolEnvValue,(a<0||a>64)&&(a=a<0?0:64,e.fVolEnvDelta=0));let o=this.globalVolume*e.outVol*e.fadeoutVol*(1/134217728);o*=a*(1/64),e.fFinalVol=Math.max(0,Math.min(1,o))}else{const t=this.globalVolume*e.outVol*e.fadeoutVol;e.fFinalVol=Math.max(0,Math.min(1,t*(1/134217728)))}try{e.gainNode.gain.setValueAtTime(e.fFinalVol,t)}catch{}const o=n.panningEnvelope;let r=0;if(o?.enabled&&o.points&&o.points.length>0){let n=!1,s=e.panEnvPos;if(e.panEnvTick++,e.panEnvTick===o.points[s]?.tick)if(e.fPanEnvValue=255&(o.points[s].value??0),s++,null!==o.loopEndPoint&&null!==o.loopStartPoint&&(s--,s===o.loopEndPoint&&(null===o.sustainPoint||s!==o.sustainPoint||e.keyOff)&&(s=o.loopStartPoint,e.panEnvTick=o.points[s].tick,e.fPanEnvValue=255&(o.points[s].value??0)),s++),s<o.points.length){let t=!0;if(null===o.sustainPoint||e.keyOff||s-1===o.sustainPoint&&(s--,e.fPanEnvDelta=0,t=!1),t){e.panEnvPos=s;const t=o.points[s-1].tick,a=o.points[s].tick-t;if(a>0){const t=255&(o.points[s-1].value??0),i=255&(o.points[s].value??0);e.fPanEnvDelta=(i-t)/a,r=e.fPanEnvValue,n=!0}else e.fPanEnvDelta=0}}else e.fPanEnvDelta=0;n||(e.fPanEnvValue+=e.fPanEnvDelta,r=e.fPanEnvValue,(r<0||r>64)&&(r=r<0?0:64,e.fPanEnvDelta=0)),r-=32;const a=(128-Math.abs(e.outPan-128))*r/32;e.finalPan=Math.max(0,Math.min(255,e.outPan+a|0)),this.applyPanEffect(e,e.finalPan,t)}else e.finalPan=e.outPan;const i=n.autoVibrato;if(i&&i.depth>0){let t,n;e.autoVibSweep>0?(t=e.autoVibSweep,e.keyOff||(t+=e.autoVibAmp,t>>8>i.depth&&(t=i.depth<<8,e.autoVibSweep=0),e.autoVibAmp=t)):t=e.autoVibAmp,e.autoVibPos=e.autoVibPos+i.rate&255,n="square"===i.type?e.autoVibPos>127?64:-64:"rampUp"===i.type?(64+(e.autoVibPos>>1)&127)-64:"rampDown"===i.type?(64-(e.autoVibPos>>1)&127)-64:Zk[255&e.autoVibPos],n=n*t>>14;let s=e.period+n;s<0&&(s=0),s>=32e3&&(s=0),e.finalPeriod=s,e.player&&s>0&&this.updatePeriodDirect(e,s)}else e.finalPeriod=e.period;e.keyOff&&0===e.fadeoutVol&&0===e.fadeoutSpeed&&this.stopChannel(e,void 0,t)}processMacros(e,t){if(!e.instrument?.furnace?.macros)return;const n=e.instrument.synthType;if(n&&n.startsWith("Furnace")&&!oD.has(n))return;const s=e.instrument.furnace.macros;if(0!==s.length){for(const n of s){if(!n.data||0===n.data.length)continue;let s=e.macroPos;const a=n.speed||1;if(this.currentTick%a!==0)continue;e.macroReleased&&n.release>=0&&s<n.release&&(s=n.release),s>=n.data.length&&(s=n.loop>=0&&n.loop<n.data.length?e.macroReleased&&n.release>=0&&n.loop<n.release?n.data.length-1:n.loop:n.data.length-1);const o=n.data[s]??0;this.applyMacroValue(e,n.type,o,t)}e.macroPos++}}applyMacroValue(e,t,n,s){switch(t){case ba.VOL:e.volume=Math.round(n/15*64),e.gainNode.gain.setValueAtTime(e.volume/64*(this.globalVolume/64),s);break;case ba.ARP:if(e.macroArpNote=n>127?n-256:n,e.period>0){const t=Yk[Math.min(255,Math.max(0,e.macroArpNote+128))],n=Math.round(e.note/t);this.updatePeriodDirect(e,n)}break;case ba.DUTY:e.macroDuty=n;break;case ba.WAVE:e.macroWaveform=n;break;case ba.PITCH:if(e.macroPitchOffset=n>127?n-256:n,e.period>0){const t=e.macroPitchOffset/64,n=Math.round(e.period*(1-.01*t)),s=this.useXMPeriods?1:113,a=this.useXMPeriods?31999:856;this.updatePeriodDirect(e,Math.max(s,Math.min(a,n)))}break;case ba.EX1:case ba.EX2:case ba.EX3:case ba.EX4:case ba.EX5:case ba.EX6:case ba.EX7:case ba.EX8:case ba.ALG:case ba.FB:case ba.FMS:case ba.AMS:break;case ba.PAN_L:e.panning=Math.max(0,128-8*n),this.applyPanEffect(e,e.panning,s);break;case ba.PAN_R:e.panning=Math.min(255,128+8*n),this.applyPanEffect(e,e.panning,s)}}releaseMacros(e){e.macroReleased=!0}triggerNote(e,t,n,s,a,o,r,i){if(void 0!==s)if(this.isDJDeck){if(!(this.channelMuteMask&1<<s))return}else{if(Bw().isChannelMuted(s))return}const l=t??Y();if(e.player)try{e.player.stop(l)}catch{}if(e.macroPos=0,e.macroReleased=!1,e.macroPitchOffset=0,e.macroArpNote=0,!e.instrument){if(!(this.song&&this.song.instruments.length>0))return;e.instrument=this.song.instruments[0],e.sampleNum=this.song.instruments[0].id,e.volume=64,e.finetune=e.instrument.metadata?.modPlayback?.finetune??0}const c=Bw(),u=e.instrument.synthType&&"Sampler"!==e.instrument.synthType,d=(this.useXMPeriods||u)&&e.xmNote>0&&e.xmNote<97?iD(e.xmNote):lD(e.period),m=this._cachedTransportState??jN.getState(),p=m.grooveTemplateId,h=uD.get(p),f=m.swing/100;let g=0;if(h){const e=Math.max(1,Math.round(m.grooveSteps/h.values.length));g=Fa(h,Math.floor(this.pattPos/e))*f}const b=Math.max(0,Math.min(1,e.volume/64+g));if("undefined"!=typeof window&&window.GROOVE_DEBUG&&h&&h.id,void 0!==s){if(!this.meterCallbacks){this.meterCallbacks=[],this.meterStaging=new Float64Array(64);for(let e=0;e<64;e++){const t=e;this.meterCallbacks[e]=()=>{c.triggerChannelMeter(t,this.meterStaging[t])}}}this.meterStaging[s]=b,ke.schedule(this.meterCallbacks[s],l)}if(e.instrument.synthType&&"Sampler"!==e.instrument.synthType){const t=2.5/this.bpm*this.speed,n=("TB303"===e.instrument.synthType||"Buzz3o3"===e.instrument.synthType)&&!r?.8*t:1.05*t;return void c.triggerNote(e.instrument.id,d,n,l,b,e.instrument,a,o,s,e.period,void 0,0,i)}let v=c.getDecodedBuffer(e.instrument.id);const y=e.instrument.sample,x=y?.audioBuffer instanceof ArrayBuffer,w=!(!e.instrument?.metadata?.sampleMap||!e.instrument.metadata.multiSamples);if(y?.url){const t=`${e.instrument.id}:${y.url}`,n=this.multiSampleBufferCache.get(t);if(n)v=n;else if(!v||x){if(x)try{const e=N().rawContext;e instanceof AudioContext&&e.decodeAudioData(y.audioBuffer.slice(0)).then(e=>{this.multiSampleBufferCache.set(t,e)}).catch(()=>{})}catch{}else{const e=y.url,n=N().rawContext;n instanceof AudioContext&&fetch(e).then(e=>e.arrayBuffer()).then(e=>n.decodeAudioData(e)).then(e=>{this.multiSampleBufferCache.set(t,e)}).catch(()=>{})}if(!v)return}else if(w){const e=y.url,n=N().rawContext;n instanceof AudioContext&&fetch(e).then(e=>e.arrayBuffer()).then(e=>n.decodeAudioData(e)).then(e=>{this.multiSampleBufferCache.set(t,e)}).catch(()=>{})}}if(!v)return void(y?.url&&c.getInstrument(e.instrument.id,e.instrument));if(!e.period||e.period<=0)return;let E;if(this.useXMPeriods){const t=Gk(e.period,this.linearPeriods),n=Hk(e.relativeNote,e.finetune,this.linearPeriods);E=n>0?t/n:1}else{const t=e.period<113?113:e.period,n=e.instrument?.sample?.sampleRate||8363;E=Kk/t/n}let k=this.bufferCache.get(e.instrument.id);k&&k.get()===v||(k=new xe(v),this.bufferCache.set(e.instrument.id,k));const D=(e.activePlayerIdx+1)%e.playerPool.length,S=e.playerPool[D];e.activePlayerIdx=D;try{S.stop(l)}catch{}S.buffer=k;const M=y?.sampleRate||8363,C=v.duration,V=Math.round(C*M),P=y?.loopStart??0,_=y?.loopEnd??0;if(y?.loop&&_>P&&_<=V){const e=P/M,t=_/M;e>=0&&e<C&&t>e&&t<=C+.001?(S.loop=!0,S.loopStart=Math.max(0,Math.min(e,C)),S.loopEnd=Math.min(t,C)):S.loop=!1}else S.loop=!1;const O=this.getEffectivePlaybackRate();S.playbackRate=E*O,e.player=S;try{e.gainNode.gain.setValueAtTime(0,l),e.gainNode.gain.linearRampToValueAtTime(e.fFinalVol>0?e.fFinalVol:e.volume/64,l+.002)}catch{}try{let e=0;if(n>0){n<C*M&&(e=Math.min(n/M,C-1e-4))}S.start(l,e)}catch(T){}}stopChannel(e,t,n){if(void 0!==n&&n>0)try{e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n),e.gainNode.gain.linearRampToValueAtTime(0,n+.002)}catch{}const s=void 0!==n?n+.003:void 0;for(const a of e.playerPool)try{a.loop=!1,void 0!==s?a.stop(s):a.stop()}catch{}e.player=null;try{(void 0===n||n<=0)&&(e.gainNode.gain.cancelScheduledValues(0),e.gainNode.gain.setValueAtTime(0,0))}catch{}if(e.instrument&&e.instrument.synthType&&"Sampler"!==e.instrument.synthType&&e.lastPlayedNoteName)try{Bw().triggerNoteRelease(e.instrument.id,e.lastPlayedNoteName,n??0,e.instrument,t)}catch{}e.lastPlayedNoteName=null}updatePeriod(e){this.updatePeriodDirect(e,e.period)}updatePeriodDirect(e,t){if(!e.player||0===t)return;const n=this.getEffectivePlaybackRate();if(this.useXMPeriods){const s=Gk(t,this.linearPeriods);if(s<=0)return;const a=Hk(e.relativeNote,e.finetune,this.linearPeriods);e.player.playbackRate=s/a*n}else{const s=t<113?113:t,a=e.instrument?.sample?.sampleRate||8363,o=Kk/s;e.player.playbackRate=o/a*n}}updateAllPlaybackRates(){const e=this.getEffectivePlaybackRate();for(const t of this.channels)if(t.player&&t.period>0)if(this.useXMPeriods){const n=Gk(t.period,this.linearPeriods);if(n<=0)continue;const s=Hk(t.relativeNote,t.finetune,this.linearPeriods);t.player.playbackRate=n/s*e}else{const n=t.period<113?113:t.period,s=t.instrument?.sample?.sampleRate||8363,a=Kk/n;t.player.playbackRate=a/s*e}}updateAllChannelVolumes(e){const t=this.globalVolume/64;for(const n of this.channels){const s=n.volume/64*t;n.gainNode.gain.setValueAtTime(s,e)}}noteToPlaybackPeriod(e,t,n){if(this.useXMPeriods&&e>0&&e<97){let t=e+n.relativeNote;return t<1||t>=120?0:zk(t,n.finetune,this.linearPeriods)}return t?this.rawPeriodToFinetuned(t,n.finetune):this.noteToPeriod(e,n.finetune)||0}rawPeriodToFinetuned(e,t){if(0===t||e<=0)return e;let n=0;for(let s=0;s<36;s++)if(e>=tD[s]){n=s;break}return tD[36*(t>=0?t:t+16)+n]}noteToPeriod(e,t){if("number"==typeof e&&e>0){if(e>=113&&e<=856)return e;if(e<97){let n=e-1,s=0;for(;n<12;)n+=12,s--;for(;n>47;)n-=12,s++;if(n-=12,n>=0&&n<36){let e=this.getPeriod(n,t);return s>0?e=Math.round(e/(Jk[Math.min(10,s)]??Math.pow(2,s))):s<0&&(e=Math.round(e*(Jk[Math.min(10,-s)]??Math.pow(2,-s)))),e}}}else if("string"==typeof e)return this.noteStringToPeriod(e,t);return 0}noteStringToPeriod(e,t){const n=e.match(/^([A-G][#]?)-?(\d)$/);if(!n)return 0;const s=eD[n[1]]??0,a=12*(parseInt(n[2],10)-1)+s;return a<0||a>=36?0:this.getPeriod(a,t)}getPeriod(e,t){return tD[36*(t>=0?t:t+16)+Math.min(35,Math.max(0,e))]}periodPlusSemitones(e,t,n){const s=36*(n>=0?n:n+16);let a=0;for(let r=0;r<36;r++)if(tD[s+r]<=e){a=r;break}const o=Math.min(35,Math.max(0,a+t));return tD[s+o]}processTickPerChannel(e){if(!this.song)return;const t=this.song.channelTrackTables,n=this.song.channelSpeeds,s=this.song.channelGrooves,a=this.song.initialSpeed,o=2.5/this.bpm;if(0===this.channelTickCounters[0]){const n=this.channelSongPos[0],s=this.channelPattPos[0],a=t[0]?.[n]??0;this.queueDisplayState(e,s,a,n,0),this.onRowChange&&this.onRowChange(s,a,n)}if(!this.isDJDeck){const t=Bw();for(let n=0;n<this.channels.length;n++){const s=t.isChannelMuted(n);this.channels[n]._muteState!==s&&(this.channels[n]._muteState=s,this.channels[n].muteGain.gain.setValueAtTime(s?0:1,e))}}for(let r=0;r<this.channels.length;r++){const i=this.channels[r],l=this.channelTickCounters[r],c=this.channelSongPos[r],u=this.channelPattPos[r],d=n?.[r]??a,m=s?.[r]??0,p=m>0&&this.channelGrooveToggle[r]?m:d,h=t[r]?.[c]??0,f=this.song.patterns[h]?.channels[0]?.rows[u];if(!this._suppressNotes&&f&&(0===l?this.processRow(r,i,f,e):this.processEffectTick(r,i,f,e+l*o),this.processMacros(i,e+l*o),this.processEnvelopesAndVibrato(i,e+l*o)),this.channelTickCounters[r]++,this.channelTickCounters[r]>=p){this.channelTickCounters[r]=0,m>0&&(this.channelGrooveToggle[r]=!this.channelGrooveToggle[r]),this.channelPattPos[r]++;const e=this.song.patterns[h],n=e?.channels[0]?.rows.length??128;if(this.channelPattPos[r]>=n){this.channelPattPos[r]=0,this.channelSongPos[r]++;const e=t[r];this.channelSongPos[r]>=e.length&&(this.channelSongPos[r]=0,0!==r||this._songEndFiredThisBatch||(this._songEndFiredThisBatch=!0,this.onSongEnd?.()))}}}this.onTickProcess&&this.onTickProcess(this.channelTickCounters[0],this.channelPattPos[0]),this.totalRowsProcessed++}advanceRow(){if(!this.song)return;if(this.nudgeTicksRemaining>0&&(this.nudgeTicksRemaining--,0===this.nudgeTicksRemaining&&(this.nudgeOffset=0)),this.slipEnabled&&(this.lineLoopActive||this.patternLoopActive)){this.slipPattPos++;const e=this.song.songPositions[this.slipSongPos],t=this.song.patterns[e],n=t?.length??64;this.slipPattPos>=n&&(this.slipPattPos=0,this.slipSongPos++,this.slipSongPos>=this.song.songLength&&(this.slipSongPos=this.song.restartPosition<this.song.songLength?this.song.restartPosition:0))}if(this.lineLoopActive&&this.lineLoopStart>=0){if(this.pattPos++,this.pattPos>this.lineLoopEnd&&(this.pattPos=this.lineLoopStart),this.onRowChange&&this.song){const e=this.song.songPositions[this.songPos];this.onRowChange(this.pattPos,e,this.songPos)}return void this.totalRowsProcessed++}this.pattPos++,this.useXMPeriods&&(this.pattDelTime>0&&(this.pattDelTime2=this.pattDelTime,this.pattDelTime=0),this.pattDelTime2>0&&(this.pattDelTime2--,this.pattDelTime2>0&&this.pattPos--)),this.pBreakFlag&&(this.pBreakFlag=!1,this.pattPos=this.pBreakPos);const e=this.song.songPositions[this.songPos],t="classic"!==this.accessor.getMode()?this.accessor.getPatternLength(this.songPos):this.song.patterns[e]?.length??64;if((this.pattPos>=t||this.posJumpFlag)&&(this.pattPos=this.pBreakPos,this.pBreakPos=0,this.posJumpFlag=!1,this.songPos++,this.songPos>=this.song.songLength&&(this.songPos=this.song.restartPosition<this.song.songLength?this.song.restartPosition:0,this._songEndFiredThisBatch||(this._songEndFiredThisBatch=!0,this.onSongEnd?.()))),this.patternLoopActive&&this.patternLoopStartPos>=0&&this.songPos>this.patternLoopEndPos&&(this.songPos=this.patternLoopStartPos,this.pattPos=0),this.onRowChange&&this.song){const e=this.song.songPositions[this.songPos];this.onRowChange(this.pattPos,e,this.songPos)}this.totalRowsProcessed++}seekTo(e,t){if(!this.song)return;if(this.playing){if(this.songPos=Math.max(0,Math.min(e,this.song.songLength-1)),this.pattPos=Math.max(0,t),this.currentTick=0,this.song.channelTrackTables)for(let a=0;a<this.channelTickCounters.length;a++){const n=this.song.channelTrackTables[a];this.channelSongPos[a]=Math.max(0,Math.min(e,n.length-1)),this.channelPattPos[a]=t,this.channelTickCounters[a]=0,this.channelGrooveToggle[a]=!1}const n=this.song.songPositions[this.songPos],s=this.song.patterns[n];return s&&this.pattPos>=s.length&&(this.pattPos=0),this.pBreakFlag=!1,this.posJumpFlag=!1,this.patternDelay=0,this.pattDelTime=0,this.pattDelTime2=0,null!==this.speed2&&(this.speedAB=this.pattPos%2==0,this.speed=this.pattPos%2==0?this.song.initialSpeed:this.speed2),this.nextScheduleTime=Y(),this.clearStateQueue(),RN(),void(this.onRowChange&&this.onRowChange(this.pattPos,n,this.songPos))}for(let a=0;a<this.channels.length;a++)this.stopChannel(this.channels[a],a);if(this.clearStateQueue(),RN(),this.songPos=Math.max(0,Math.min(e,this.song.songLength-1)),this.pattPos=Math.max(0,t),this.currentTick=0,this.song.channelTrackTables)for(let a=0;a<this.channelTickCounters.length;a++){const n=this.song.channelTrackTables[a];this.channelSongPos[a]=Math.max(0,Math.min(e,n.length-1)),this.channelPattPos[a]=t,this.channelTickCounters[a]=0,this.channelGrooveToggle[a]=!1}null!==this.speed2&&(this.speedAB=this.pattPos%2==0,this.speed=this.pattPos%2==0?this.song.initialSpeed:this.speed2);const n=this.song.songPositions[this.songPos],s=this.song.patterns[n];s&&this.pattPos>=s.length&&(this.pattPos=0),this.pBreakFlag=!1,this.posJumpFlag=!1,this.patternDelay=0,this.pattDelTime=0,this.pattDelTime2=0,this.onRowChange&&this.onRowChange(this.pattPos,n,this.songPos)}jumpToPattern(e,t=0){if(!this.song)return;const n=this.song.songPositions.findIndex(t=>t===e);-1!==n?this.seekTo(n,t):this.clearStateQueue()}isPlaying(){return this.playing}getBPM(){return this.bpm}getSpeed(){return this.speed}getCurrentRow(){return this.pattPos}getCurrentPosition(){return this.songPos}getCurrentTick(){return this.currentTick}setSpeed2(e){this.speed2=e,this.speedAB=null!==e}updatePatterns(e){this.song&&(this.song.patterns=e)}dispose(){if(this.stop(),this.routedNativeEngines.size>0){const e=Bw();for(const t of this.routedNativeEngines)e.restoreNativeEngineRouting(t);this.routedNativeEngines.clear()}for(const e of this.channels){for(const t of e.playerPool)try{t.dispose()}catch{}e.gainNode.dispose(),e.panNode.dispose(),e.muteGain.dispose()}this.bufferCache.clear(),this.multiSampleBufferCache.clear(),this.separationNode.dispose(),this.masterGain.dispose(),this.channels=[],this.song=null}}let mD=null;function pD(){return mD||(mD=new dD),mD}let hD=0;const fD={generate:(e="id")=>(hD++,`${e}-${hD}-${Date.now()}`),reset(){hD=0}},gD=0,bD=1,vD=2,yD=3,xD=4,ND=5,wD=(e,t=1)=>Array.from({length:e},(e,n)=>({name:`FM ${t+n}`,shortName:`F${t+n}`,type:gD})),ED=(e,t="PCM",n="P")=>Array.from({length:e},(e,s)=>({name:`${t} ${s+1}`,shortName:`${n}${s+1}`,type:xD})),kD=(e,t,n="Channel",s="CH")=>Array.from({length:e},(e,a)=>({name:`${n} ${a+1}`,shortName:`${s}${a+1}`,type:t})),DD=e=>Array.from({length:e},(e,t)=>({name:`PSG ${t+1}`,shortName:`S${t+1}`,type:bD})),SD=[{id:"none",name:"None (Default)",description:"Generic channels with no specific labels",fileID:0,fileID_DMF:0,channels:4,minChans:1,maxChans:16,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[]},{id:"ymu759",name:"Yamaha YMU759 (MA-2)",description:"A chip which found its way inside mobile phones in the 2000's.",fileID:1,fileID_DMF:1,channels:17,minChans:17,maxChans:17,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[...wD(16),{name:"PCM",shortName:"PCM",type:xD}]},{id:"ym2151",name:"Yamaha YM2151 (OPM)",description:"Yamaha's first integrated FM chip. Used in arcade boards and synths.",fileID:130,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:wD(8)},{id:"ym2612",name:"Yamaha YM2612 (OPN2)",description:"Mostly known for being in the Sega Genesis.",fileID:131,fileID_DMF:0,channels:6,minChans:6,maxChans:6,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:wD(6)},{id:"ym2612_ext",name:"Yamaha YM2612 (OPN2) Extended Channel 3",description:"YM2612 with Extended Channel mode.",fileID:160,fileID_DMF:0,channels:9,minChans:9,maxChans:9,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:[{name:"FM 1",shortName:"F1",type:gD},{name:"FM 2",shortName:"F2",type:gD},{name:"FM 3 OP1",shortName:"O1",type:ND},{name:"FM 3 OP2",shortName:"O2",type:ND},{name:"FM 3 OP3",shortName:"O3",type:ND},{name:"FM 3 OP4",shortName:"O4",type:ND},{name:"FM 4",shortName:"F4",type:gD},{name:"FM 5",shortName:"F5",type:gD},{name:"FM 6",shortName:"F6",type:gD}]},{id:"ym2612_csm",name:"Yamaha YM2612 (OPN2) CSM",description:"YM2612 with CSM mode control.",fileID:193,fileID_DMF:0,channels:10,minChans:10,maxChans:10,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:[{name:"FM 1",shortName:"F1",type:gD},{name:"FM 2",shortName:"F2",type:gD},{name:"FM 3 OP1",shortName:"O1",type:ND},{name:"FM 3 OP2",shortName:"O2",type:ND},{name:"FM 3 OP3",shortName:"O3",type:ND},{name:"FM 3 OP4",shortName:"O4",type:ND},{name:"CSM Timer",shortName:"CSM",type:vD},{name:"FM 4",shortName:"F4",type:gD},{name:"FM 5",shortName:"F5",type:gD},{name:"FM 6",shortName:"F6",type:gD}]},{id:"ym2612_dualpcm",name:"Yamaha YM2612 (OPN2) with DualPCM",description:"YM2612 with software mixing for two sample channels.",fileID:190,fileID_DMF:0,channels:7,minChans:7,maxChans:7,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:[{name:"FM 1",shortName:"F1",type:gD},{name:"FM 2",shortName:"F2",type:gD},{name:"FM 3",shortName:"F3",type:gD},{name:"FM 4",shortName:"F4",type:gD},{name:"FM 5",shortName:"F5",type:gD},{name:"FM 6/PCM 1",shortName:"P1",type:xD},{name:"PCM 2",shortName:"P2",type:xD}]},{id:"ym2203",name:"Yamaha YM2203 (OPN)",description:"Cost-reduced OPM with built-in AY-3-8910 (YM2149).",fileID:141,fileID_DMF:0,channels:6,minChans:6,maxChans:6,isFM:!0,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(3),{name:"PSG 1",shortName:"S1",type:bD},{name:"PSG 2",shortName:"S2",type:bD},{name:"PSG 3",shortName:"S3",type:bD}]},{id:"ym2203_ext",name:"Yamaha YM2203 (OPN) Extended Channel 3",description:"YM2203 with Extended Channel mode.",fileID:182,fileID_DMF:0,channels:9,minChans:9,maxChans:9,isFM:!0,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[{name:"FM 1",shortName:"F1",type:gD},{name:"FM 2",shortName:"F2",type:gD},{name:"FM 3 OP1",shortName:"O1",type:ND},{name:"FM 3 OP2",shortName:"O2",type:ND},{name:"FM 3 OP3",shortName:"O3",type:ND},{name:"FM 3 OP4",shortName:"O4",type:ND},{name:"PSG 1",shortName:"S1",type:bD},{name:"PSG 2",shortName:"S2",type:bD},{name:"PSG 3",shortName:"S3",type:bD}]},{id:"ym2608",name:"Yamaha YM2608 (OPNA)",description:"OPN with doubled FM channels, stereo, rhythm and ADPCM.",fileID:142,fileID_DMF:0,channels:16,minChans:16,maxChans:16,isFM:!0,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(6),{name:"Square 1",shortName:"S1",type:bD},{name:"Square 2",shortName:"S2",type:bD},{name:"Square 3",shortName:"S3",type:bD},{name:"Kick",shortName:"BD",type:vD},{name:"Snare",shortName:"SD",type:vD},{name:"Top",shortName:"TP",type:vD},{name:"HiHat",shortName:"HH",type:vD},{name:"Tom",shortName:"TM",type:vD},{name:"Rim",shortName:"RM",type:vD},{name:"ADPCM",shortName:"P",type:xD}]},{id:"ym2610_full",name:"Yamaha YM2610 (OPNB)",description:"Used in SNK's Neo Geo arcade board and console.",fileID:165,fileID_DMF:0,channels:14,minChans:14,maxChans:14,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(4),{name:"PSG 1",shortName:"S1",type:bD},{name:"PSG 2",shortName:"S2",type:bD},{name:"PSG 3",shortName:"S3",type:bD},{name:"ADPCM-A 1",shortName:"P1",type:xD},{name:"ADPCM-A 2",shortName:"P2",type:xD},{name:"ADPCM-A 3",shortName:"P3",type:xD},{name:"ADPCM-A 4",shortName:"P4",type:xD},{name:"ADPCM-A 5",shortName:"P5",type:xD},{name:"ADPCM-A 6",shortName:"P6",type:xD},{name:"ADPCM-B",shortName:"B",type:xD}]},{id:"ym2610b",name:"Yamaha YM2610B (OPNB2)",description:"Taito Arcade chip with FM, PSG, and ADPCM.",fileID:158,fileID_DMF:0,channels:16,minChans:16,maxChans:16,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(6),{name:"PSG 1",shortName:"S1",type:bD},{name:"PSG 2",shortName:"S2",type:bD},{name:"PSG 3",shortName:"S3",type:bD},{name:"ADPCM-A 1",shortName:"P1",type:xD},{name:"ADPCM-A 2",shortName:"P2",type:xD},{name:"ADPCM-A 3",shortName:"P3",type:xD},{name:"ADPCM-A 4",shortName:"P4",type:xD},{name:"ADPCM-A 5",shortName:"P5",type:xD},{name:"ADPCM-A 6",shortName:"P6",type:xD},{name:"ADPCM-B",shortName:"B",type:xD}]},{id:"opll",name:"Yamaha YM2413 (OPLL)",description:"Cost-reduced version of the OPL with 16 patches.",fileID:137,fileID_DMF:0,channels:9,minChans:9,maxChans:9,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:wD(9)},{id:"opll_drums",name:"Yamaha YM2413 (OPLL) with drums",description:"OPLL with drums mode enabled.",fileID:167,fileID_DMF:0,channels:11,minChans:11,maxChans:11,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:[...wD(6),{name:"Kick",shortName:"BD",type:vD},{name:"Snare",shortName:"SD",type:vD},{name:"Tom",shortName:"TM",type:vD},{name:"Top",shortName:"TP",type:vD},{name:"HiHat",shortName:"HH",type:vD}]},{id:"opl",name:"Yamaha YM3526 (OPL)",description:"OPN with two operators, no stereo, no detune.",fileID:143,fileID_DMF:0,channels:9,minChans:9,maxChans:9,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:wD(9)},{id:"opl_drums",name:"Yamaha YM3526 (OPL) with drums",description:"OPL with drums mode enabled.",fileID:162,fileID_DMF:0,channels:11,minChans:11,maxChans:11,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(6),{name:"Kick",shortName:"BD",type:vD},{name:"Snare",shortName:"SD",type:vD},{name:"Tom",shortName:"TM",type:vD},{name:"Top",shortName:"TP",type:vD},{name:"HiHat",shortName:"HH",type:vD}]},{id:"opl2",name:"Yamaha YM3812 (OPL2)",description:"OPL with more waveforms.",fileID:144,fileID_DMF:0,channels:9,minChans:9,maxChans:9,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:wD(9)},{id:"opl2_drums",name:"Yamaha YM3812 (OPL2) with drums",description:"OPL2 with drums mode enabled.",fileID:163,fileID_DMF:0,channels:11,minChans:11,maxChans:11,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(6),{name:"Kick",shortName:"BD",type:vD},{name:"Snare",shortName:"SD",type:vD},{name:"Tom",shortName:"TM",type:vD},{name:"Top",shortName:"TP",type:vD},{name:"HiHat",shortName:"HH",type:vD}]},{id:"opl3",name:"Yamaha YMF262 (OPL3)",description:"OPL2 with double channels, 4-op mode, stereo.",fileID:145,fileID_DMF:0,channels:18,minChans:18,maxChans:18,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:wD(18)},{id:"opl3_drums",name:"Yamaha YMF262 (OPL3) with drums",description:"OPL3 with drums mode enabled.",fileID:164,fileID_DMF:0,channels:20,minChans:20,maxChans:20,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(15),{name:"Kick",shortName:"BD",type:vD},{name:"Snare",shortName:"SD",type:vD},{name:"Tom",shortName:"TM",type:vD},{name:"Top",shortName:"TP",type:vD},{name:"HiHat",shortName:"HH",type:vD}]},{id:"opl4",name:"Yamaha YMF278B (OPL4)",description:"OPL3 + 24-channel MultiPCM.",fileID:174,fileID_DMF:0,channels:42,minChans:42,maxChans:42,isFM:!0,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(18),...ED(24)]},{id:"opz",name:"Yamaha YM2414 (OPZ)",description:"OPM with more waveforms, fixed frequency mode, Yamaha TX81Z.",fileID:152,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:wD(8)},{id:"y8950",name:"Yamaha Y8950",description:"OPL with ADPCM channel.",fileID:178,fileID_DMF:0,channels:10,minChans:10,maxChans:10,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(9),{name:"ADPCM",shortName:"P",type:xD}]},{id:"y8950_drums",name:"Yamaha Y8950 with drums",description:"Y8950 with drums mode enabled.",fileID:179,fileID_DMF:0,channels:12,minChans:12,maxChans:12,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:[...wD(6),{name:"Kick",shortName:"BD",type:vD},{name:"Snare",shortName:"SD",type:vD},{name:"Tom",shortName:"TM",type:vD},{name:"Top",shortName:"TP",type:vD},{name:"HiHat",shortName:"HH",type:vD},{name:"ADPCM",shortName:"P",type:xD}]},{id:"ymz280b",name:"Yamaha YMZ280B (PCMD8)",description:"Arcade boards, 4-bit ADPCM, 8-bit or 16-bit PCM.",fileID:184,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:ED(8)},{id:"esfm",name:"ESS ES1xxx series (ESFM)",description:"PC sound cards FM synth based on OPL3 design.",fileID:209,fileID_DMF:0,channels:18,minChans:18,maxChans:18,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:wD(18)},{id:"sms",name:"TI SN76489",description:"Found on the Sega Master System, ColecoVision, Tandy, and more.",fileID:3,fileID_DMF:3,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:[{name:"Square 1",shortName:"S1",type:bD},{name:"Square 2",shortName:"S2",type:bD},{name:"Square 3",shortName:"S3",type:bD},{name:"Noise",shortName:"NO",type:vD}]},{id:"gb",name:"Game Boy",description:"The most popular portable game console of the era.",fileID:4,fileID_DMF:4,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:16,vgmVersion:353,channelDefs:[{name:"Pulse 1",shortName:"S1",type:bD},{name:"Pulse 2",shortName:"S2",type:bD},{name:"Wavetable",shortName:"WA",type:yD},{name:"Noise",shortName:"NO",type:vD}]},{id:"pce",name:"PC Engine/TurboGrafx-16",description:"An '80s game console with a wavetable sound chip.",fileID:5,fileID_DMF:5,channels:6,minChans:6,maxChans:6,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:32,vgmVersion:353,channelDefs:kD(6,yD)},{id:"nes",name:"NES (Ricoh 2A03)",description:"The most well-known game console of the '80s.",fileID:6,fileID_DMF:6,channels:5,minChans:5,maxChans:5,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:[{name:"Pulse 1",shortName:"S1",type:bD},{name:"Pulse 2",shortName:"S2",type:bD},{name:"Triangle",shortName:"TR",type:yD},{name:"Noise",shortName:"NO",type:vD},{name:"DPCM",shortName:"DMC",type:xD}]},{id:"snes",name:"SNES",description:"FM? nah... samples! Nintendo's answer to Sega.",fileID:135,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:16,vgmVersion:0,channelDefs:ED(8,"Channel","CH")},{id:"nds",name:"Nintendo DS",description:"Handheld with dual screens and stylus.",fileID:214,fileID_DMF:0,channels:16,minChans:16,maxChans:16,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:32,vgmVersion:0,channelDefs:[...ED(8,"Channel",""),{name:"Channel 9",shortName:"9",type:bD},{name:"Channel 10",shortName:"10",type:bD},{name:"Channel 11",shortName:"11",type:bD},{name:"Channel 12",shortName:"12",type:bD},{name:"Channel 13",shortName:"13",type:bD},{name:"Channel 14",shortName:"14",type:bD},{name:"Channel 15",shortName:"15",type:vD},{name:"Channel 16",shortName:"16",type:vD}]},{id:"gba_dma",name:"Game Boy Advance DMA Sound",description:"Additional PCM FIFO channels in GBA.",fileID:215,fileID_DMF:0,channels:2,minChans:2,maxChans:2,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:256,vgmVersion:0,channelDefs:[{name:"PCM 1",shortName:"P1",type:xD},{name:"PCM 2",shortName:"P2",type:xD}]},{id:"gba_minmod",name:"Game Boy Advance MinMod",description:"GBA PCM FIFO with software mixing for up to 16 channels.",fileID:216,fileID_DMF:0,channels:16,minChans:16,maxChans:16,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:256,vgmVersion:0,channelDefs:ED(16,"Channel","CH")},{id:"vboy",name:"Virtual Boy",description:"Headache-inducing console by Nintendo.",fileID:156,fileID_DMF:0,channels:6,minChans:6,maxChans:6,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:64,vgmVersion:369,channelDefs:[...kD(5,yD),{name:"Noise",shortName:"NO",type:vD}]},{id:"lynx",name:"Atari Lynx",description:"Portable console with Atari's trademark waveforms.",fileID:168,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:370,channelDefs:kD(4,yD)},{id:"swan",name:"WonderSwan",description:"By makers of Game Boy and Virtual Boy.",fileID:150,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:16,vgmVersion:369,channelDefs:[{name:"Wave",shortName:"CH1",type:yD},{name:"Wave/PCM",shortName:"CH2",type:xD},{name:"Wave/Sweep",shortName:"CH3",type:yD},{name:"Wave/Noise",shortName:"CH4",type:vD}]},{id:"pokemini",name:"Pokmon Mini",description:"PC Speaker but with duty cycles.",fileID:153,fileID_DMF:0,channels:1,minChans:1,maxChans:1,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Pulse",shortName:"P",type:bD}]},{id:"supervision",name:"Watara Supervision",description:"Handheld trying to compete with Game Boy.",fileID:227,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Pulse 1",shortName:"S1",type:bD},{name:"Pulse 2",shortName:"S2",type:bD},{name:"PCM",shortName:"PCM",type:xD},{name:"Noise",shortName:"NO",type:vD}]},{id:"c64_6581",name:"Commodore 64 (SID 6581)",description:"Powered by the original SID chip with a raw, warm filter character.",fileID:71,fileID_DMF:71,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(3,vD)},{id:"c64_8580",name:"Commodore 64 (SID 8580)",description:"Powered by the SID chip with filter and ADSR.",fileID:7,fileID_DMF:7,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(3,vD)},{id:"c64_pcm",name:"Commodore 64 (SID 6581) with software PCM",description:"6581 quirk for 4-bit sample playback via volume register.",fileID:226,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[...kD(3,vD),{name:"PCM",shortName:"PCM",type:xD}]},{id:"vic20",name:"Commodore VIC-20",description:"Commodore's successor to the PET.",fileID:133,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Low",shortName:"LO",type:bD},{name:"Mid",shortName:"MID",type:bD},{name:"High",shortName:"HI",type:bD},{name:"Noise",shortName:"NO",type:vD}]},{id:"pet",name:"Commodore PET",description:"One channel of 1-bit wavetable which is better (and worse) than the PC Speaker.",fileID:134,fileID_DMF:0,channels:1,minChans:1,maxChans:1,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Wave",shortName:"PET",type:bD}]},{id:"ted",name:"MOS Technology TED",description:"Two square waves, Commodore Plus/4, 16, 116.",fileID:205,fileID_DMF:0,channels:2,minChans:2,maxChans:2,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(2,bD)},{id:"tia",name:"Atari TIA",description:"It's a challenge to make music on this chip which barely has musical capabilities.",fileID:132,fileID_DMF:0,channels:2,minChans:2,maxChans:2,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(2,yD)},{id:"pokey",name:"POKEY",description:"TIA but better, Atari 8-bit family (400/800/XL/XE).",fileID:148,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:kD(4,yD)},{id:"ay8910",name:"AY-3-8910",description:"ZX Spectrum, MSX, Amstrad CPC, Intellivision, Vectrex...",fileID:128,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:DD(3)},{id:"ay8930",name:"Microchip AY8930",description:"Improved AY-3-8910 with bigger frequency range, duty cycles, per-channel envelopes.",fileID:154,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:DD(3)},{id:"saa1099",name:"Philips SAA1099",description:"Present on Creative Music System and SAM Coup.",fileID:151,fileID_DMF:0,channels:6,minChans:6,maxChans:6,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:369,channelDefs:DD(6)},{id:"t6w28",name:"T6W28",description:"SN76489 derivative used in Neo Geo Pocket.",fileID:191,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:352,channelDefs:[{name:"Square 1",shortName:"S1",type:bD},{name:"Square 2",shortName:"S2",type:bD},{name:"Square 3",shortName:"S3",type:bD},{name:"Noise",shortName:"NO",type:vD}]},{id:"amiga",name:"Amiga",description:"The classic 4-channel PCM sampler sound.",fileID:129,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:256,vgmVersion:0,channelDefs:kD(4,xD)},{id:"rf5c68",name:"Ricoh RF5C68",description:"Like SNES but without interpolation.",fileID:149,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:kD(8,xD)},{id:"segapcm",name:"SegaPCM",description:"Used in Sega arcade boards like OutRun.",fileID:155,fileID_DMF:0,channels:16,minChans:16,maxChans:16,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:ED(16,"PCM","")},{id:"qsound",name:"Capcom QSound",description:"Used in Capcom arcade boards. Sampled sound with echo.",fileID:224,fileID_DMF:0,channels:19,minChans:19,maxChans:19,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:[...ED(16,"PCM",""),{name:"ADPCM 1",shortName:"A1",type:vD},{name:"ADPCM 2",shortName:"A2",type:vD},{name:"ADPCM 3",shortName:"A3",type:vD}]},{id:"multipcm",name:"MultiPCM",description:"How many channels of PCM do you want? MultiPCM: yes.",fileID:146,fileID_DMF:0,channels:28,minChans:28,maxChans:28,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:ED(28,"Channel","CH")},{id:"es5506",name:"Ensoniq ES5506",description:"Basis for GF1 chip in Gravis Ultrasound.",fileID:177,fileID_DMF:0,channels:32,minChans:32,maxChans:32,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:ED(32,"Channel","CH")},{id:"pcm_dac",name:"Generic PCM DAC",description:"Generic sample playback.",fileID:192,fileID_DMF:0,channels:1,minChans:1,maxChans:1,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:256,vgmVersion:0,channelDefs:[{name:"PCM",shortName:"PCM",type:xD}]},{id:"vrc6",name:"Konami VRC6",description:"Expansion chip for the Famicom, featuring a quirky sawtooth channel.",fileID:136,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"VRC6 1",shortName:"V1",type:bD},{name:"VRC6 2",shortName:"V2",type:bD},{name:"VRC6 Saw",shortName:"VS",type:yD}]},{id:"vrc7",name:"Konami VRC7",description:"OPLL with more cost reductions, no drums mode.",fileID:157,fileID_DMF:0,channels:6,minChans:6,maxChans:6,isFM:!0,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:337,channelDefs:wD(6)},{id:"fds",name:"Famicom Disk System (chip)",description:"A disk drive for the Famicom which also contains one wavetable channel.",fileID:138,fileID_DMF:0,channels:1,minChans:1,maxChans:1,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:64,waveHeight:64,vgmVersion:353,channelDefs:[{name:"FDS",shortName:"FDS",type:yD}]},{id:"mmc5",name:"MMC5",description:"Expansion chip for Famicom with little-known PCM channel.",fileID:139,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Pulse 1",shortName:"S1",type:bD},{name:"Pulse 2",shortName:"S2",type:bD},{name:"PCM",shortName:"PCM",type:xD}]},{id:"n163",name:"Namco 163",description:"Expansion chip for Famicom with full wavetable.",fileID:140,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:16,vgmVersion:0,channelDefs:kD(8,yD)},{id:"scc",name:"Konami SCC",description:"Wavetable chip for MSX, last channel shares wavetable.",fileID:161,fileID_DMF:0,channels:5,minChans:5,maxChans:5,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:256,vgmVersion:353,channelDefs:kD(5,yD)},{id:"scc_plus",name:"Konami SCC+",description:"SCC variant with independent last channel wavetable.",fileID:180,fileID_DMF:0,channels:5,minChans:5,maxChans:5,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:256,vgmVersion:353,channelDefs:kD(5,yD)},{id:"bubsys_wsg",name:"Konami Bubble System WSG",description:"Wavetable part of Bubble System.",fileID:173,fileID_DMF:0,channels:2,minChans:2,maxChans:2,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:16,vgmVersion:0,channelDefs:kD(2,yD)},{id:"k007232",name:"Konami K007232",description:"PCM chip used in Konami arcade boards 1986-1990.",fileID:198,fileID_DMF:0,channels:2,minChans:2,maxChans:2,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(2,xD)},{id:"k053260",name:"Konami K053260",description:"PCM chip used in Konami arcade boards 1990-1992.",fileID:204,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:kD(4,xD)},{id:"namco",name:"Namco WSG",description:"Wavetable chip used in Pac-Man.",fileID:185,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:16,vgmVersion:0,channelDefs:kD(3,yD)},{id:"namco_15xx",name:"Namco C15 WSG",description:"Successor of Namco WSG for later arcade games.",fileID:186,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:16,vgmVersion:0,channelDefs:kD(8,yD)},{id:"namco_cus30",name:"Namco C30 WSG",description:"Namco C15 but with stereo.",fileID:187,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:16,vgmVersion:0,channelDefs:kD(8,yD)},{id:"c140",name:"Namco C140",description:"Namco's first PCM chip from 1987.",fileID:206,fileID_DMF:0,channels:24,minChans:24,maxChans:24,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:ED(24,"Channel","CH")},{id:"c219",name:"Namco C219",description:"Namco NA-1/2 hardware, similar to C140 with noise generator.",fileID:207,fileID_DMF:0,channels:16,minChans:16,maxChans:16,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:ED(16,"Channel","CH")},{id:"msm5232",name:"OKI MSM5232",description:"Square wave additive synthesis chip from OKI.",fileID:188,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(8,bD)},{id:"msm6258",name:"OKI MSM6258",description:"ADPCM chip from OKI used in Sharp X68000.",fileID:171,fileID_DMF:0,channels:1,minChans:1,maxChans:1,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:336,channelDefs:[{name:"Sample",shortName:"PCM",type:xD}]},{id:"msm6295",name:"OKI MSM6295",description:"ADPCM chip from OKI used in many arcade boards.",fileID:170,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:kD(4,xD)},{id:"vera",name:"VERA",description:"The chip used in the Commander X16.",fileID:172,fileID_DMF:0,channels:17,minChans:17,maxChans:17,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[...Array.from({length:16},(e,t)=>({name:`Channel ${t+1}`,shortName:`${t+1}`,type:bD})),{name:"PCM",shortName:"PCM",type:xD}]},{id:"x1_010",name:"Seta/Allumer X1-010",description:"Seta/Allumer arcade boards with wavetable + samples.",fileID:176,fileID_DMF:0,channels:16,minChans:16,maxChans:16,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:128,waveHeight:256,vgmVersion:369,channelDefs:kD(16,yD)},{id:"ga20",name:"Irem GA20",description:"PCM chip from Irem, like Amiga but less pitch resolution.",fileID:199,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:369,channelDefs:kD(4,xD)},{id:"pcspkr",name:"PC Speaker",description:"One square, no volume control.",fileID:147,fileID_DMF:0,channels:1,minChans:1,maxChans:1,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Square",shortName:"SQ",type:bD}]},{id:"sfx_beeper",name:"ZX Spectrum Beeper",description:"ZX Spectrum thin pulse system.",fileID:159,fileID_DMF:0,channels:6,minChans:6,maxChans:6,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(6,yD)},{id:"sfx_beeper_quadtone",name:"ZX Spectrum Beeper (QuadTone Engine)",description:"ZX beeper with full PWM pulses and 3-level volume.",fileID:202,fileID_DMF:0,channels:5,minChans:5,maxChans:5,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Channel 1",shortName:"CH1",type:bD},{name:"Channel 2",shortName:"CH2",type:bD},{name:"Channel 3",shortName:"CH3",type:bD},{name:"Channel 4",shortName:"CH4",type:bD},{name:"PCM",shortName:"PCM",type:xD}]},{id:"sm8521",name:"Sharp SM8521",description:"SoC with wavetable sound hardware.",fileID:200,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:32,waveHeight:16,vgmVersion:0,channelDefs:[{name:"Channel 1",shortName:"CH1",type:yD},{name:"Channel 2",shortName:"CH2",type:yD},{name:"Noise",shortName:"NS",type:vD}]},{id:"pv1000",name:"Casio PV-1000",description:"Game console with 3 square waves.",fileID:203,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Square 1",shortName:"S1",type:bD},{name:"Square 2",shortName:"S2",type:bD},{name:"Square 3",shortName:"S3",type:bD}]},{id:"upd1771c",name:"NEC PD1771C-017",description:"Microcontroller used in Super Cassette Vision.",fileID:229,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Square 1",shortName:"S1",type:bD},{name:"Square 2",shortName:"S2",type:bD},{name:"Square 3",shortName:"S3",type:bD},{name:"Noise",shortName:"NO",type:vD}]},{id:"dave",name:"Dave",description:"Enterprise 128 computer, similar to POKEY with stereo.",fileID:213,fileID_DMF:0,channels:6,minChans:6,maxChans:6,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Channel 1",shortName:"CH1",type:yD},{name:"Channel 2",shortName:"CH2",type:yD},{name:"Channel 3",shortName:"CH3",type:yD},{name:"Noise",shortName:"NO",type:vD},{name:"DAC Left",shortName:"L",type:xD},{name:"DAC Right",shortName:"R",type:xD}]},{id:"sound_unit",name:"tildearrow Sound Unit",description:"Fantasy chip - SID, AY and VERA in a blender.",fileID:181,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(8,vD)},{id:"sid2",name:"SID2",description:"Fantasy chip by LTVA, similar to SID with fixes.",fileID:240,fileID_DMF:0,channels:3,minChans:3,maxChans:3,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(3,vD)},{id:"sid3",name:"SID3",description:"Fantasy sound chip rework of SID with many features.",fileID:245,fileID_DMF:0,channels:7,minChans:7,maxChans:7,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:256,waveHeight:256,vgmVersion:0,channelDefs:[...kD(6,vD),{name:"Wave",shortName:"WA",type:yD}]},{id:"powernoise",name:"PowerNoise",description:"Fantasy chip for Hexheld console.",fileID:212,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!1,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Noise 1",shortName:"N1",type:vD},{name:"Noise 2",shortName:"N2",type:vD},{name:"Noise 3",shortName:"N3",type:vD},{name:"Slope",shortName:"SL",type:yD}]},{id:"bifurcator",name:"Bifurcator",description:"Fantasy chip using logistic map iterations.",fileID:217,fileID_DMF:0,channels:4,minChans:4,maxChans:4,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(4,vD)},{id:"5e01",name:"5E01",description:"Fantasy chip based on Ricoh 2A03 with extra features.",fileID:241,fileID_DMF:0,channels:5,minChans:5,maxChans:5,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:353,channelDefs:[{name:"Pulse 1",shortName:"S1",type:bD},{name:"Pulse 2",shortName:"S2",type:bD},{name:"Wave",shortName:"WA",type:yD},{name:"Noise",shortName:"NO",type:vD},{name:"DPCM",shortName:"DMC",type:xD}]},{id:"genesis",name:"Sega Genesis / Mega Drive",description:"Compound system: YM2612 (FM) + SN76489 (PSG).",fileID:2,fileID_DMF:2,channels:10,minChans:10,maxChans:10,isFM:!0,isSTD:!0,isCompound:!0,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[...wD(6),{name:"PSG 1",shortName:"S1",type:bD},{name:"PSG 2",shortName:"S2",type:bD},{name:"PSG 3",shortName:"S3",type:bD},{name:"PSG Noise",shortName:"NO",type:vD}]},{id:"arcade",name:"DefleCade",description:"Compound system for DefleMask/Furnace arcade emulation.",fileID:8,fileID_DMF:8,channels:13,minChans:13,maxChans:13,isFM:!0,isSTD:!1,isCompound:!0,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[]},{id:"pong",name:"Pong",description:"Joke chip.",fileID:252,fileID_DMF:0,channels:1,minChans:1,maxChans:1,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:[{name:"Square",shortName:"SQ",type:bD}]},{id:"dummy",name:"Dummy System",description:"System for testing purposes.",fileID:253,fileID_DMF:0,channels:8,minChans:8,maxChans:8,isFM:!1,isSTD:!0,isCompound:!1,waveWidth:0,waveHeight:0,vgmVersion:0,channelDefs:kD(8,vD)}];function MD(){const e=[{label:"Yamaha FM",startId:"ymu759"},{label:"Yamaha OPL",startId:"opl"},{label:"Console",startId:"nes"},{label:"Commodore",startId:"sid6581"},{label:"Atari",startId:"pokey"},{label:"AY/PSG",startId:"ay8910"},{label:"Sampler",startId:"amiga"},{label:"Famicom Expansion",startId:"vrc6"},{label:"Konami",startId:"scc"},{label:"Namco",startId:"n163"},{label:"OKI",startId:"msm6258"},{label:"Other",startId:"dave"},{label:"Fantasy",startId:"tildearrow_sound_unit"},{label:"Compound",startId:"genesis"},{label:"Debug/Test",startId:"pong"}],t=[],n=new Map;SD.forEach((e,t)=>n.set(e.id,t));for(let s=0;s<e.length;s++){const a=n.get(e[s].startId);if(void 0===a)continue;const o=s+1<e.length?n.get(e[s+1].startId)??SD.length:SD.length,r=SD.slice(a,o);r.length>0&&t.push({label:e[s].label,presets:r})}return t}const CD=i()(ds((e,t)=>({undoStack:[],redoStack:[],maxStackSize:100,currentActionId:null,pushAction:(t,n,s,a,o)=>e(e=>{const r={id:`action-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,timestamp:Date.now(),description:n,patternIndex:s,beforeState:structuredClone(a),afterState:structuredClone(o)};e.undoStack.push(r),e.undoStack.length>e.maxStackSize&&e.undoStack.shift(),e.redoStack=[],e.currentActionId=r.id}),undo:()=>{const n=t();if(0===n.undoStack.length)return null;const s=n.undoStack[n.undoStack.length-1];return e(e=>{const t=e.undoStack.pop();t&&(e.redoStack.push(t),e.currentActionId=e.undoStack.length>0?e.undoStack[e.undoStack.length-1].id:null)}),s.beforeState},redo:()=>{const n=t();if(0===n.redoStack.length)return null;const s=n.redoStack[n.redoStack.length-1];return e(e=>{const t=e.redoStack.pop();t&&(e.undoStack.push(t),e.currentActionId=t.id)}),s.afterState},canUndo:()=>t().undoStack.length>0,canRedo:()=>t().redoStack.length>0,clearHistory:()=>e(e=>{e.undoStack=[],e.redoStack=[],e.currentActionId=null}),setMaxStackSize:t=>e(e=>{e.maxStackSize=Math.max(1,t),e.undoStack.length>e.maxStackSize&&(e.undoStack=e.undoStack.slice(-e.maxStackSize)),e.redoStack.length>e.maxStackSize&&(e.redoStack=e.redoStack.slice(-e.maxStackSize))}),getUndoCount:()=>t().undoStack.length,getRedoCount:()=>t().redoStack.length,getLastAction:()=>{const e=t().undoStack;return e.length>0?e[e.length-1]:null},getActionHistory:()=>t().undoStack.slice(-20)}))),VD=e=>({EDIT_CELL:"Edit Cell",PASTE_BLOCK:"Paste Block",DELETE_BLOCK:"Delete Block",CUT_BLOCK:"Cut Block",TRANSPOSE_BLOCK:"Transpose Block",AMPLIFY_BLOCK:"Amplify Block",INTERPOLATE_BLOCK:"Interpolate Block",CLEAR_CELL:"Clear Cell",CLEAR_ROW:"Clear Row",CLEAR_CHANNEL:"Clear Channel",CLEAR_PATTERN:"Clear Pattern",INSERT_ROW:"Insert Row",DELETE_ROW:"Delete Row",RESIZE_PATTERN:"Resize Pattern",CUT_SELECTION:"Cut Selection",PASTE:"Paste",PASTE_MIX:"Mix Paste",PASTE_FLOOD:"Flood Paste",PASTE_PUSH_FORWARD:"Push-Forward Paste",CUT_TRACK:"Cut Track",PASTE_TRACK:"Paste Track",READ_MACRO:"Apply Macro",TRANSPOSE:"Transpose",INTERPOLATE:"Interpolate",HUMANIZE:"Humanize",STRUM:"Strum",LEGATO:"Legato",SCALE_VOLUME:"Scale Volume",FADE_VOLUME:"Fade Volume",AMPLIFY:"Amplify Selection",SWAP_CHANNELS:"Swap Channels",JOIN_PATTERNS:"Join Patterns"}[e]||e),PD=e=>{switch(e){case"EDIT_CELL":return"text-blue-400";case"PASTE_BLOCK":case"CUT_BLOCK":case"DELETE_BLOCK":case"CUT_SELECTION":case"CUT_TRACK":case"PASTE":case"PASTE_MIX":case"PASTE_FLOOD":case"PASTE_PUSH_FORWARD":case"PASTE_TRACK":return"text-green-400";case"TRANSPOSE_BLOCK":case"AMPLIFY_BLOCK":case"INTERPOLATE_BLOCK":case"TRANSPOSE":case"INTERPOLATE":case"HUMANIZE":case"STRUM":case"LEGATO":case"SCALE_VOLUME":case"FADE_VOLUME":case"READ_MACRO":return"text-yellow-400";case"CLEAR_CELL":case"CLEAR_ROW":case"CLEAR_CHANNEL":case"CLEAR_PATTERN":return"text-red-400";case"INSERT_ROW":case"DELETE_ROW":case"RESIZE_PATTERN":return"text-purple-400";default:return"text-gray-400"}},_D=16,OD=31,TD=(e,t)=>0!==(e&t),LD=(e,t)=>e^t,AD=["note","instrument","volume","effTyp","effTyp2","flag1","flag2","probability"],BD=(e=64,t=4)=>({id:fD.generate("pattern"),name:"Untitled Pattern",length:e,channels:Array.from({length:t},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,rows:Array.from({length:e},()=>({...Us})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}),ID=i()(ds((e,t)=>({patterns:[BD()],currentPatternIndex:0,cursor:{channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},selection:null,clipboard:null,trackClipboard:null,followPlayback:!1,showGhostPatterns:!0,columnVisibility:{...Fs},copyMask:OD,pasteMask:OD,transposeMask:1,macroSlots:Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),insertMode:!1,currentOctave:4,recordMode:!1,editStep:1,multiRecEnabled:!1,multiEditEnabled:!1,multiRecChannels:Array(16).fill(!0),multiKeyJazz:!1,recQuantEnabled:!1,recQuantRes:16,recReleaseEnabled:!1,keyOnTab:Array(16).fill(0),keyOffTime:Array(16).fill(0),keyOffCounter:0,ptnJumpPos:[0,0,0,0,0,0,0,0,0,0],wrapMode:!1,recordQuantize:!1,autoRecord:!1,multiChannelRecord:!1,bookmarks:[],patternOrder:[0],currentPositionIndex:0,originalModuleData:null,editorMode:"classic",linearPeriods:!1,furnaceNative:null,hivelyNative:null,hivelyFileData:null,musiclineFileData:null,hivelyMeta:null,furnaceSubsongs:null,furnaceActiveSubsong:0,channelTrackTables:null,channelSpeeds:null,channelGrooves:null,setCurrentPattern:(t,n)=>e(e=>{if(t>=0&&t<e.patterns.length){if(e.currentPatternIndex===t)return;if(e.currentPatternIndex=t,n)return;const s=pD();s.isPlaying()&&s.jumpToPattern(t)}}),moveCursor:t=>e(e=>{const n=e.patterns[e.currentPatternIndex],s=n.channels.length,a=n.length,o=e.cursor.rowIndex,r=e.cursor.channelIndex,i=e.cursor.columnType,l=e.cursor.digitIndex,c={instrument:2,volume:2,effTyp:1,effParam:2,effTyp2:1,effParam2:2,cutoff:2,resonance:2,envMod:2,pan:2,probability:2,flag1:1,flag2:1},u=c[e.cursor.columnType]||0;switch(t){case"up":e.cursor.rowIndex>0?e.cursor.rowIndex--:e.cursor.rowIndex=a-1;break;case"down":e.cursor.rowIndex<a-1?e.cursor.rowIndex++:e.cursor.rowIndex=0;break;case"left":{if(u>0&&e.cursor.digitIndex>0){e.cursor.digitIndex--;break}const t=e.columnVisibility,n=["note"];t.instrument&&n.push("instrument"),t.volume&&n.push("volume"),t.effect&&(n.push("effTyp"),n.push("effParam")),t.effect2&&(n.push("effTyp2"),n.push("effParam2")),t.flag1&&n.push("flag1"),t.flag2&&n.push("flag2"),t.probability&&n.push("probability");const a=n.indexOf(e.cursor.columnType);if(-1===a){e.cursor.columnType="note",e.cursor.digitIndex=0;break}if(a>0){e.cursor.columnType=n[a-1];const t=c[e.cursor.columnType]||0;e.cursor.digitIndex=t>0?t-1:0}else{e.cursor.channelIndex>0?e.cursor.channelIndex--:e.cursor.channelIndex=s-1,e.cursor.columnType=n[n.length-1];const t=c[e.cursor.columnType]||0;e.cursor.digitIndex=t>0?t-1:0}break}case"right":{if(u>0&&e.cursor.digitIndex<u-1){e.cursor.digitIndex++;break}const t=e.columnVisibility,n=["note"];t.instrument&&n.push("instrument"),t.volume&&n.push("volume"),t.effect&&(n.push("effTyp"),n.push("effParam")),t.effect2&&(n.push("effTyp2"),n.push("effParam2")),t.flag1&&n.push("flag1"),t.flag2&&n.push("flag2"),t.probability&&n.push("probability");const a=n.indexOf(e.cursor.columnType);if(-1===a){e.cursor.columnType="note",e.cursor.digitIndex=0;break}a<n.length-1?(e.cursor.columnType=n[a+1],e.cursor.digitIndex=0):(e.cursor.channelIndex<s-1?e.cursor.channelIndex++:e.cursor.channelIndex=0,e.cursor.columnType="note",e.cursor.digitIndex=0);break}}if(e.cursor.rowIndex===o&&e.cursor.channelIndex===r&&e.cursor.columnType===i&&e.cursor.digitIndex===l)return e}),moveCursorToRow:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t>=0&&t<n.length){e.cursor.rowIndex=t;const n=pD();n.isPlaying()&&n.seekTo(n.getCurrentPosition(),t)}}),moveCursorToChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.channels.length&&(e.cursor.channelIndex=t)}),moveCursorToColumn:t=>e(e=>{e.cursor.columnType=t,e.cursor.digitIndex=0}),moveCursorToChannelAndColumn:(t,n)=>e(e=>{const s=e.patterns[e.currentPatternIndex];t>=0&&t<s.channels.length&&(e.cursor.channelIndex=t,e.cursor.columnType=n,e.cursor.digitIndex=0)}),setCell:(n,s,a)=>{const o=t().currentPatternIndex,r=t().patterns[o];e(e=>{const t=e.patterns[e.currentPatternIndex];n>=0&&n<t.channels.length&&s>=0&&s<t.length&&(t.channels[n].rows[s]={...t.channels[n].rows[s],...a})}),CD.getState().pushAction("EDIT_CELL","Edit cell",o,r,t().patterns[o])},clearCell:(n,s)=>{const a=t().currentPatternIndex,o=t().patterns[a];e(e=>{const t=e.patterns[e.currentPatternIndex];n>=0&&n<t.channels.length&&s>=0&&s<t.length&&(t.channels[n].rows[s]={...Us})}),CD.getState().pushAction("CLEAR_CELL","Clear cell",a,o,t().patterns[a])},clearChannel:n=>{const s=t().currentPatternIndex,a=t().patterns[s];e(e=>{const t=e.patterns[e.currentPatternIndex];n>=0&&n<t.channels.length&&(t.channels[n].rows=t.channels[n].rows.map(()=>({...Us})))}),CD.getState().pushAction("CLEAR_CHANNEL","Clear channel",s,a,t().patterns[s])},clearPattern:()=>{const n=t().currentPatternIndex,s=t().patterns[n];e(e=>{e.patterns[e.currentPatternIndex].channels.forEach(e=>{e.rows=e.rows.map(()=>({...Us}))})}),CD.getState().pushAction("CLEAR_PATTERN","Clear pattern",n,s,t().patterns[n])},insertRow:(n,s)=>{const a=t().currentPatternIndex,o=t().patterns[a];e(e=>{const t=e.patterns[e.currentPatternIndex];if(n>=0&&n<t.channels.length&&s>=0&&s<t.length){const e=t.channels[n].rows;for(let n=t.length-1;n>s;n--)e[n]={...e[n-1]};e[s]={...Us}}}),CD.getState().pushAction("INSERT_ROW","Insert row",a,o,t().patterns[a])},deleteRow:(n,s)=>{const a=t().currentPatternIndex,o=t().patterns[a];e(e=>{const t=e.patterns[e.currentPatternIndex];if(n>=0&&n<t.channels.length&&s>=0&&s<t.length){const e=t.channels[n].rows;for(let n=s;n<t.length-1;n++)e[n]={...e[n+1]};e[t.length-1]={...Us}}}),CD.getState().pushAction("DELETE_ROW","Delete row",a,o,t().patterns[a])},setFollowPlayback:t=>e(e=>{e.followPlayback=t}),setShowGhostPatterns:t=>e(e=>{e.showGhostPatterns=t}),setColumnVisibility:t=>e(e=>{Object.assign(e.columnVisibility,t)}),setCopyMask:t=>e(e=>{e.copyMask=t&OD}),setPasteMask:t=>e(e=>{e.pasteMask=t&OD}),setTransposeMask:t=>e(e=>{e.transposeMask=t&OD}),toggleMaskBit:(t,n)=>e(e=>{"copy"===t?e.copyMask=LD(e.copyMask,n):"paste"===t?e.pasteMask=LD(e.pasteMask,n):"transpose"===t&&(e.transposeMask=LD(e.transposeMask,n))}),setCurrentOctave:t=>e(e=>{e.currentOctave=Math.max(1,Math.min(7,t))}),toggleRecordMode:()=>e(e=>{e.recordMode=!e.recordMode}),setEditStep:t=>e(e=>{e.editStep=Math.max(0,Math.min(16,t))}),toggleInsertMode:()=>e(e=>{e.insertMode=!e.insertMode}),setMultiRecEnabled:t=>e(e=>{e.multiRecEnabled=t}),setMultiEditEnabled:t=>e(e=>{e.multiEditEnabled=t}),toggleMultiRecChannel:t=>e(e=>{t>=0&&t<e.multiRecChannels.length&&(e.multiRecChannels[t]=!e.multiRecChannels[t])}),setMultiKeyJazz:t=>e(e=>{e.multiKeyJazz=t}),setRecQuantEnabled:t=>e(e=>{e.recQuantEnabled=t}),setRecQuantRes:t=>e(e=>{[1,2,4,8,16].includes(t)&&(e.recQuantRes=t)}),setRecReleaseEnabled:t=>e(e=>{e.recReleaseEnabled=t}),setKeyOn:(t,n)=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOnTab[t]=n)}),setKeyOff:t=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOffCounter++,e.keyOnTab[t]=0,e.keyOffTime[t]=e.keyOffCounter)}),findBestChannel:()=>{const e=t(),n=e.patterns[e.currentPatternIndex],s=n?.channels.length||1;if(!e.multiRecEnabled&&!e.multiEditEnabled)return e.cursor.channelIndex;let a=e.cursor.channelIndex,o=1/0;for(let t=0;t<s;t++)e.multiRecChannels[t]&&0===e.keyOnTab[t]&&e.keyOffTime[t]<o&&(a=t,o=e.keyOffTime[t]);return a},resetKeyTracking:()=>e(e=>{e.keyOnTab=e.keyOnTab.map(()=>0),e.keyOffTime=e.keyOffTime.map(()=>0),e.keyOffCounter=0}),setPtnJumpPos:(t,n)=>e(e=>{t>=0&&t<10&&(e.ptnJumpPos[t]=n)}),getPtnJumpPos:e=>{const n=t();return e>=0&&e<10?n.ptnJumpPos[e]:0},startSelection:()=>e(e=>{e.selection={startChannel:e.cursor.channelIndex,endChannel:e.cursor.channelIndex,startRow:e.cursor.rowIndex,endRow:e.cursor.rowIndex,startColumn:e.cursor.columnType,endColumn:e.cursor.columnType,columnTypes:[e.cursor.columnType]}}),updateSelection:(t,n,s)=>e(e=>{if(e.selection&&(e.selection.endChannel=t,e.selection.endRow=n,s)){e.selection.endColumn=s;const t=e.selection.startColumn;let n=s;"effParam"===n&&(n="effTyp"),"effParam2"===n&&(n="effTyp2");let a=t;"effParam"===a&&(a="effTyp"),"effParam2"===a&&(a="effTyp2");const o=AD.indexOf(a),r=AD.indexOf(n);if(-1!==o&&-1!==r){const t=Math.min(o,r),n=Math.max(o,r),s=AD.slice(t,n+1);s.includes("effTyp")&&!s.includes("effParam")&&s.push("effParam"),s.includes("effTyp2")&&!s.includes("effParam2")&&s.push("effParam2"),e.selection.columnTypes=s}}}),endSelection:()=>e(e=>{e.selection&&(e.selection.endChannel=e.cursor.channelIndex,e.selection.endRow=e.cursor.rowIndex,e.selection.endColumn=e.cursor.columnType)}),clearSelection:()=>e(e=>{e.selection=null}),selectColumn:(t,n)=>e(e=>{const s=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:s.length-1,startColumn:n,endColumn:n,columnTypes:[n]}}),selectChannel:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:n.length-1,startColumn:"note",endColumn:"probability",columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),selectPattern:()=>e(e=>{const t=e.patterns[e.currentPatternIndex];e.selection={startChannel:0,endChannel:t.channels.length-1,startRow:0,endRow:t.length-1,startColumn:"note",endColumn:"probability",columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),copySelection:()=>e(e=>{const t=e.patterns[e.currentPatternIndex];let n=e.selection;n||(n={startChannel:e.cursor.channelIndex,endChannel:e.cursor.channelIndex,startRow:e.cursor.rowIndex,endRow:e.cursor.rowIndex,startColumn:e.cursor.columnType,endColumn:e.cursor.columnType,columnTypes:[e.cursor.columnType]});const{startChannel:s,endChannel:a,startRow:o,endRow:r,columnTypes:i}=n,l=Math.min(s,a),c=Math.max(s,a),u=Math.min(o,r),d=Math.max(o,r),m=[],p=!i||0===i.length||i.length>8;for(let h=l;h<=c;h++){const e=[];for(let n=u;n<=d;n++){const s=t.channels[h].rows[n];if(p)e.push({...s});else{const t={...Us};i.includes("note")&&(t.note=s.note,t.instrument=s.instrument),i.includes("instrument")&&(t.instrument=s.instrument),i.includes("volume")&&(t.volume=s.volume),(i.includes("effTyp")||i.includes("effParam"))&&(t.effTyp=s.effTyp,t.eff=s.eff),(i.includes("effTyp2")||i.includes("effParam2"))&&(t.effTyp2=s.effTyp2,t.eff2=s.eff2),i.includes("flag1")&&(t.flag1=s.flag1),i.includes("flag2")&&(t.flag2=s.flag2),i.includes("probability")&&(t.probability=s.probability),e.push(t)}}m.push(e)}e.clipboard={channels:c-l+1,rows:d-u+1,data:m,columnTypes:i}}),cutSelection:()=>{const n=t().currentPatternIndex,s=t().patterns[n];e(e=>{const t=e.patterns[e.currentPatternIndex];let n=e.selection;n||(n={startChannel:e.cursor.channelIndex,endChannel:e.cursor.channelIndex,startRow:e.cursor.rowIndex,endRow:e.cursor.rowIndex,startColumn:e.cursor.columnType,endColumn:e.cursor.columnType,columnTypes:[e.cursor.columnType]});const{startChannel:s,endChannel:a,startRow:o,endRow:r,columnTypes:i}=n,l=Math.min(s,a),c=Math.max(s,a),u=Math.min(o,r),d=Math.max(o,r),m=[],p=!i||0===i.length||i.length>8;for(let h=l;h<=c;h++){const e=[];for(let n=u;n<=d;n++){const s=t.channels[h].rows[n];if(p)e.push({...s}),t.channels[h].rows[n]={...Us};else{const t={...Us};i.includes("note")&&(t.note=s.note,t.instrument=s.instrument,s.note=0,s.instrument=0),i.includes("instrument")&&(t.instrument=s.instrument,s.instrument=0),i.includes("volume")&&(t.volume=s.volume,s.volume=0),(i.includes("effTyp")||i.includes("effParam"))&&(t.effTyp=s.effTyp,t.eff=s.eff,s.effTyp=0,s.eff=0),(i.includes("effTyp2")||i.includes("effParam2"))&&(t.effTyp2=s.effTyp2,t.eff2=s.eff2,s.effTyp2=0,s.eff2=0),i.includes("flag1")&&(t.flag1=s.flag1,s.flag1=void 0),i.includes("flag2")&&(t.flag2=s.flag2,s.flag2=void 0),i.includes("probability")&&(t.probability=s.probability,s.probability=void 0),e.push(t)}}m.push(e)}e.clipboard={channels:c-l+1,rows:d-u+1,data:m,columnTypes:i},e.selection=null}),CD.getState().pushAction("CUT_SELECTION","Cut",n,s,t().patterns[n])},setClipboard:t=>e(e=>{e.clipboard=t}),paste:()=>{if(!t().clipboard)return;const n=t().currentPatternIndex,s=t().patterns[n];e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:s}=e.cursor,{data:a,columnTypes:o}=e.clipboard,{pasteMask:r}=e,i=!!(o&&o.length>0&&o.length<=8);for(let l=0;l<a.length;l++){const e=n+l;if(e>=t.channels.length)break;for(let n=0;n<a[l].length;n++){const c=s+n;if(c>=t.length)break;const u=a[l][n],d=t.channels[e].rows[c];!TD(r,1)||i&&!o.includes("note")||(d.note=u.note,0!==u.instrument&&(d.instrument=u.instrument)),!TD(r,2)||i&&!o.includes("instrument")||(d.instrument=u.instrument),!TD(r,4)||i&&!o.includes("volume")||(d.volume=u.volume),TD(r,8)&&(!i||o.includes("effTyp")||o.includes("effParam"))&&(d.effTyp=u.effTyp,d.eff=u.eff),TD(r,_D)&&(!i||o.includes("effTyp2")||o.includes("effParam2"))&&(d.effTyp2=u.effTyp2,d.eff2=u.eff2),i?(o.includes("flag1")&&(d.flag1=u.flag1),o.includes("flag2")&&(d.flag2=u.flag2),o.includes("probability")&&(d.probability=u.probability)):(void 0!==u.flag1&&(d.flag1=u.flag1),void 0!==u.flag2&&(d.flag2=u.flag2),void 0!==u.probability&&(d.probability=u.probability))}}}),CD.getState().pushAction("PASTE","Paste",n,s,t().patterns[n])},pasteMix:()=>{if(!t().clipboard)return;const n=t().currentPatternIndex,s=t().patterns[n];e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:s}=e.cursor,{data:a}=e.clipboard,{pasteMask:o}=e;for(let r=0;r<a.length;r++){const e=n+r;if(e>=t.channels.length)break;for(let n=0;n<a[r].length;n++){const i=s+n;if(i>=t.length)break;const l=a[r][n],c=t.channels[e].rows[i];TD(o,1)&&0!==l.note&&0===c.note&&(c.note=l.note),TD(o,2)&&0!==l.instrument&&0===c.instrument&&(c.instrument=l.instrument),TD(o,4)&&0!==l.volume&&0===c.volume&&(c.volume=l.volume),!TD(o,8)||0===l.effTyp&&0===l.eff||0!==c.effTyp||0!==c.eff||(c.effTyp=l.effTyp,c.eff=l.eff),!TD(o,_D)||0===l.effTyp2&&0===l.eff2||0!==c.effTyp2||0!==c.eff2||(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),CD.getState().pushAction("PASTE_MIX","Mix paste",n,s,t().patterns[n])},pasteFlood:()=>{if(!t().clipboard)return;const n=t().currentPatternIndex,s=t().patterns[n];e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:s}=e.cursor,{data:a}=e.clipboard,{pasteMask:o}=e,r=a[0]?.length||0;if(0!==r)for(let i=0;i<a.length;i++){const e=n+i;if(e>=t.channels.length)break;let l=s;for(;l<t.length;){for(let n=0;n<a[i].length;n++){const s=l+n;if(s>=t.length)break;const r=a[i][n],c=t.channels[e].rows[s];TD(o,1)&&(c.note=r.note),TD(o,2)&&(c.instrument=r.instrument),TD(o,4)&&(c.volume=r.volume),TD(o,8)&&(c.effTyp=r.effTyp,c.eff=r.eff),TD(o,_D)&&(c.effTyp2=r.effTyp2,c.eff2=r.eff2)}l+=r}}}),CD.getState().pushAction("PASTE_FLOOD","Flood paste",n,s,t().patterns[n])},pastePushForward:()=>{if(!t().clipboard)return;const n=t().currentPatternIndex,s=t().patterns[n];e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:s}=e.cursor,{data:a}=e.clipboard,{pasteMask:o}=e,r=a[0]?.length||0;if(0!==r)for(let i=0;i<a.length;i++){const e=n+i;if(e>=t.channels.length)break;const l=t.channels[e];for(let n=t.length-1;n>=s+r;n--){const e=n-r;e>=s&&(l.rows[n]={...l.rows[e]})}for(let n=0;n<a[i].length;n++){const e=s+n;if(e>=t.length)break;const r=a[i][n],c=l.rows[e];c.note=0,c.instrument=0,c.volume=0,c.effTyp=0,c.eff=0,c.effTyp2=0,c.eff2=0,c.flag1=0,c.flag2=0,c.probability=0,TD(o,1)&&(c.note=r.note,c.flag1=r.flag1??0,c.flag2=r.flag2??0,c.probability=r.probability??0),TD(o,2)&&(c.instrument=r.instrument),TD(o,4)&&(c.volume=r.volume),TD(o,8)&&(c.effTyp=r.effTyp,c.eff=r.eff),TD(o,_D)&&(c.effTyp2=r.effTyp2,c.eff2=r.eff2)}}}),CD.getState().pushAction("PASTE_PUSH_FORWARD","Push-forward paste",n,s,t().patterns[n])},copyTrack:t=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t<0||t>=n.channels.length)return;const s=n.channels[t];e.trackClipboard=s.rows.map(e=>({...e}))}),cutTrack:n=>{const s=t().currentPatternIndex,a=t().patterns[s];if(n<0||n>=a.channels.length)return;const o=a;e(e=>{const t=e.patterns[e.currentPatternIndex];if(n<0||n>=t.channels.length)return;const s=t.channels[n];e.trackClipboard=s.rows.map(e=>({...e})),s.rows=s.rows.map(()=>({...Us}))}),CD.getState().pushAction("CUT_TRACK","Cut track",s,o,t().patterns[s])},pasteTrack:n=>{if(!t().trackClipboard)return;const s=t().currentPatternIndex,a=t().patterns[s];if(n<0||n>=a.channels.length)return;const o=a;e(e=>{if(!e.trackClipboard)return;const t=e.patterns[e.currentPatternIndex];if(n<0||n>=t.channels.length)return;const s=t.channels[n],{pasteMask:a}=e,o=Math.min(e.trackClipboard.length,t.length);for(let n=0;n<o;n++){const t=e.trackClipboard[n],o=s.rows[n];TD(a,1)&&(o.note=t.note),TD(a,2)&&(o.instrument=t.instrument),TD(a,4)&&(o.volume=t.volume),TD(a,8)&&(o.effTyp=t.effTyp,o.eff=t.eff),TD(a,_D)&&(o.effTyp2=t.effTyp2,o.eff2=t.eff2)}}),CD.getState().pushAction("PASTE_TRACK","Paste track",s,o,t().patterns[s])},writeMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const n=e.patterns[e.currentPatternIndex],{channelIndex:s,rowIndex:a}=e.cursor,o=n.channels[s].rows[a];e.macroSlots[t]={note:o.note,instrument:o.instrument,volume:o.volume,effTyp:o.effTyp,eff:o.eff,effTyp2:o.effTyp2,eff2:o.eff2}}),readMacroSlot:n=>{if(n<0||n>=8)return;const s=t().currentPatternIndex,a=t().patterns[s];e(e=>{if(n<0||n>=8)return;const t=e.macroSlots[n],s=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:o}=e.cursor,{pasteMask:r}=e;if(e.insertMode){const e=s.channels[a],n={...Us};TD(r,1)&&0!==t.note&&(n.note=t.note),TD(r,2)&&0!==t.instrument&&(n.instrument=t.instrument),TD(r,4)&&0!==t.volume&&(n.volume=t.volume),TD(r,8)&&(n.effTyp=t.effTyp,n.eff=t.eff),!TD(r,_D)||0===t.effTyp2&&0===t.eff2||(n.effTyp2=t.effTyp2,n.eff2=t.eff2),e.rows.splice(o,0,n),e.rows.length>s.length&&e.rows.pop()}else{const e=s.channels[a].rows[o];TD(r,1)&&0!==t.note&&(e.note=t.note),TD(r,2)&&0!==t.instrument&&(e.instrument=t.instrument),TD(r,4)&&0!==t.volume&&(e.volume=t.volume),TD(r,8)&&(e.effTyp=t.effTyp,e.eff=t.eff),!TD(r,_D)||0===t.effTyp2&&0===t.eff2||(e.effTyp2=t.effTyp2,e.eff2=t.eff2)}}),CD.getState().pushAction("READ_MACRO","Apply macro",s,a,t().patterns[s])},applyInstrumentToSelection:n=>{const s=t().currentPatternIndex,a=t().patterns[s];e(e=>{const t=e.patterns[e.currentPatternIndex];let s,a,o,r;e.selection?(s=Math.min(e.selection.startChannel,e.selection.endChannel),a=Math.max(e.selection.startChannel,e.selection.endChannel),o=Math.min(e.selection.startRow,e.selection.endRow),r=Math.max(e.selection.startRow,e.selection.endRow)):(s=e.cursor.channelIndex,a=e.cursor.channelIndex,o=e.cursor.rowIndex,r=e.cursor.rowIndex);for(let i=s;i<=a;i++)if(!(i>=t.channels.length))for(let e=o;e<=r;e++){if(e>=t.length)continue;const s=t.channels[i].rows[e];s.note&&0!==s.note&&(s.instrument=n)}}),CD.getState().pushAction("EDIT_CELL","Apply instrument to selection",s,a,t().patterns[s])},transposeSelection:(n,s=!1)=>{const a=t().currentPatternIndex,o=t().patterns[a];e(e=>{const t=e.patterns[e.currentPatternIndex],a=s?e.patterns[e.currentPatternIndex].channels[e.cursor.channelIndex].rows[e.cursor.rowIndex].instrument:null;let o,r,i,l;e.selection?(o=Math.min(e.selection.startChannel,e.selection.endChannel),r=Math.max(e.selection.startChannel,e.selection.endChannel),i=Math.min(e.selection.startRow,e.selection.endRow),l=Math.max(e.selection.startRow,e.selection.endRow)):(o=e.cursor.channelIndex,r=e.cursor.channelIndex,i=e.cursor.rowIndex,l=e.cursor.rowIndex);for(let c=o;c<=r;c++)if(!(c>=t.channels.length))for(let e=i;e<=l;e++){if(e>=t.length)continue;const o=t.channels[c].rows[e];if(!o.note||0===o.note||97===o.note)continue;if(s&&null!==a&&o.instrument!==a)continue;const r=Qa(o.note);if(null===r)continue;const i=r+n;i>=12&&i<=107&&(o.note=Za(i))}}),CD.getState().pushAction("TRANSPOSE","Transpose",a,o,t().patterns[a])},remapInstrument:(t,n,s)=>e(e=>{const a=(e,s,a,o)=>{const r=void 0!==s?s:0,i=void 0!==s?s:e.channels.length-1,l=void 0!==a?a:0,c=void 0!==o?o:e.length-1;for(let u=r;u<=i;u++)for(let s=l;s<=c;s++)e.channels[u].rows[s]?.instrument===t&&(e.channels[u].rows[s].instrument=n)};if("block"===s&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),n=Math.max(e.selection.startChannel,e.selection.endChannel),s=Math.min(e.selection.startRow,e.selection.endRow),o=Math.max(e.selection.startRow,e.selection.endRow);for(let r=t;r<=n;r++)a(e.patterns[e.currentPatternIndex],r,s,o)}else"track"===s?a(e.patterns[e.currentPatternIndex],e.cursor.channelIndex):"pattern"===s?a(e.patterns[e.currentPatternIndex]):"song"===s&&e.patterns.forEach(e=>a(e))}),interpolateSelection:(n,s,a,o="linear")=>{if(!t().selection)return;const r=t().currentPatternIndex,i=t().patterns[r];e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:r,endChannel:i,startRow:l,endRow:c}=e.selection,u=Math.min(r,i),d=Math.max(r,i),m=Math.min(l,c),p=Math.max(l,c),h=p-m+1;if(h<2)return;const f=e=>{switch(o){case"log":return Math.log(1+9*e)/Math.log(10);case"exp":return(Math.pow(10,e)-1)/9;case"scurve":return e*e*(3-2*e);default:return e}};for(let o=u;o<=d;o++)if(!(o>=t.channels.length))for(let e=m;e<=p;e++){if(e>=t.length)continue;const r=t.channels[o].rows[e],i=f((e-m)/(h-1)),l=Math.round(s+(a-s)*i);"volume"===n?r.volume=Math.max(16,Math.min(80,l)):"effParam"===n?(0===r.effTyp&&(r.effTyp=12),r.eff=Math.max(0,Math.min(255,l))):"effParam2"===n?(0===r.effTyp2&&(r.effTyp2=12),r.eff2=Math.max(0,Math.min(255,l))):"cutoff"===n?r.cutoff=Math.max(0,Math.min(255,l)):"resonance"===n?r.resonance=Math.max(0,Math.min(255,l)):"envMod"===n?r.envMod=Math.max(0,Math.min(255,l)):"pan"===n&&(r.pan=Math.max(0,Math.min(255,l)))}}),CD.getState().pushAction("INTERPOLATE","Interpolate",r,i,t().patterns[r])},humanizeSelection:n=>{if(!t().selection)return;const s=t().currentPatternIndex,a=t().patterns[s];e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:s,endChannel:a,startRow:o,endRow:r}=e.selection,i=Math.min(s,a),l=Math.max(s,a),c=Math.min(o,r),u=Math.max(o,r);for(let d=i;d<=l;d++)if(!(d>=t.channels.length))for(let e=c;e<=u;e++){if(e>=t.length)continue;const s=t.channels[d].rows[e];if(!s.note||0===s.note||97===s.note)continue;const a=s.volume>=16&&s.volume<=80?s.volume-16:48,o=Math.floor(a*(n/100)),r=Math.floor(Math.random()*(2*o+1))-o,i=Math.max(0,Math.min(64,a+r));s.volume=16+i}}),CD.getState().pushAction("HUMANIZE","Humanize",s,a,t().patterns[s])},strumSelection:(n,s)=>{if(!t().selection)return;const a=t().currentPatternIndex,o=t().patterns[a];e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:o,startRow:r,endRow:i}=e.selection,l=Math.min(a,o),c=Math.max(a,o),u=Math.min(r,i),d=Math.max(r,i);for(let m=u;m<=d;m++)if(!(m>=t.length))for(let e=l;e<=c;e++){if(e>=t.channels.length)continue;const a=t.channels[e].rows[m];if(!a.note||0===a.note||97===a.note)continue;const o="down"===s?e-l:c-e,r=Math.min(15,o*n);r>0&&(a.effTyp=14,a.eff=208+r)}}),CD.getState().pushAction("STRUM","Strum",a,o,t().patterns[a])},legatoSelection:()=>{if(!t().selection)return;const n=t().currentPatternIndex,s=t().patterns[n];e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:s,startRow:a,endRow:o}=e.selection,r=Math.min(n,s),i=Math.max(n,s),l=Math.min(a,o),c=Math.max(a,o);for(let u=r;u<=i;u++){if(u>=t.channels.length)continue;let e=-1;for(let n=l;n<=c;n++){if(n>=t.length)continue;const s=t.channels[u].rows[n];s.note>0&&s.note<97&&(e>=0&&n>e+1&&0===s.effTyp&&(s.effTyp=3,s.eff=255),e=n)}}}),CD.getState().pushAction("LEGATO","Legato",n,s,t().patterns[n])},scaleVolume:(n,s)=>{const a=t().currentPatternIndex,o=t().patterns[a];e(e=>{const t=e.patterns[e.currentPatternIndex];(()=>{const s=[];if("block"===n&&e.selection){const n=Math.min(e.selection.startChannel,e.selection.endChannel),a=Math.max(e.selection.startChannel,e.selection.endChannel),o=Math.min(e.selection.startRow,e.selection.endRow),r=Math.max(e.selection.startRow,e.selection.endRow);for(let e=n;e<=a;e++)for(let n=o;n<=r;n++)e<t.channels.length&&n<t.length&&s.push(t.channels[e].rows[n])}else if("track"===n){const n=e.cursor.channelIndex;n<t.channels.length&&s.push(...t.channels[n].rows)}else"pattern"===n&&t.channels.forEach(e=>{s.push(...e.rows)});return s})().forEach(e=>{null!==e.volume&&void 0!==e.volume&&(e.volume=Math.min(64,Math.max(0,Math.round(e.volume*s))))})}),CD.getState().pushAction("SCALE_VOLUME","Scale volume",a,o,t().patterns[a])},fadeVolume:(n,s,a)=>{const o=t().currentPatternIndex,r=t().patterns[o];e(e=>{const t=e.patterns[e.currentPatternIndex],o=(()=>{const s=[];if("block"===n&&e.selection){const n=Math.min(e.selection.startChannel,e.selection.endChannel),a=Math.max(e.selection.startChannel,e.selection.endChannel),o=Math.min(e.selection.startRow,e.selection.endRow),r=Math.max(e.selection.startRow,e.selection.endRow);for(let e=n;e<=a;e++)for(let n=o;n<=r;n++)e<t.channels.length&&n<t.length&&s.push(t.channels[e].rows[n])}else if("track"===n){const n=e.cursor.channelIndex;n<t.channels.length&&s.push(...t.channels[n].rows)}else"pattern"===n&&t.channels.forEach(e=>{s.push(...e.rows)});return s})(),r=o.length;r<2||o.forEach((e,t)=>{const n=t/(r-1),o=Math.round(s+n*(a-s));e.volume=Math.min(64,Math.max(0,o))})}),CD.getState().pushAction("FADE_VOLUME","Fade volume",o,r,t().patterns[o])},toggleWrapMode:()=>e(e=>{e.wrapMode=!e.wrapMode}),toggleRecordQuantize:()=>e(e=>{e.recordQuantize=!e.recordQuantize}),toggleAutoRecord:()=>e(e=>{e.autoRecord=!e.autoRecord}),toggleMultiChannelRecord:()=>e(e=>{e.multiChannelRecord=!e.multiChannelRecord}),toggleBookmark:t=>e(e=>{const n=e.bookmarks.indexOf(t);-1===n?(e.bookmarks.push(t),e.bookmarks.sort((e,t)=>e-t)):e.bookmarks.splice(n,1)}),clearBookmarks:()=>e(e=>{e.bookmarks=[]}),nextBookmark:()=>e(e=>{const t=[...e.bookmarks].sort((e,t)=>e-t).find(t=>t>e.cursor.rowIndex);void 0!==t&&(e.cursor.rowIndex=t)}),prevBookmark:()=>e(e=>{const t=[...[...e.bookmarks].sort((e,t)=>e-t)].reverse().find(t=>t<e.cursor.rowIndex);void 0!==t&&(e.cursor.rowIndex=t)}),amplifySelection:n=>{const{selection:s,currentPatternIndex:a}=t();if(!s)return;const o=t().patterns[a];e(e=>{const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:o,startRow:r,endRow:i}=s,l=Math.min(a,o),c=Math.max(a,o),u=Math.min(r,i),d=Math.max(r,i);for(let s=l;s<=c;s++)for(let e=u;e<=d;e++){const a=t.channels[s]?.rows[e];a&&null!=a.volume&&a.volume>0&&(a.volume=Math.max(0,Math.min(64,Math.round(a.volume*n))))}}),CD.getState().pushAction("AMPLIFY","Amplify selection",a,o,t().patterns[a])},growSelection:()=>{const{patterns:n,currentPatternIndex:s}=t(),a=n[s];e(e=>{const t=e.selection;t&&(t.startRow=Math.max(0,t.startRow-1),t.endRow=Math.min(a.length-1,t.endRow+1),t.startChannel=Math.max(0,t.startChannel-1),t.endChannel=Math.min(a.channels.length-1,t.endChannel+1))})},shrinkSelection:()=>{const{selection:n}=t();n&&e(e=>{const t=e.selection;if(!t)return;const n=Math.floor((t.startRow+t.endRow)/2),s=Math.floor((t.startChannel+t.endChannel)/2);t.startRow=Math.min(t.startRow+1,n),t.endRow=Math.max(t.endRow-1,n),t.startChannel=Math.min(t.startChannel+1,s),t.endChannel=Math.max(t.endChannel-1,s)})},swapChannels:(n,s)=>{const{patterns:a,currentPatternIndex:o}=t(),r=a[o];if(n<0||s<0||n>=r.channels.length||s>=r.channels.length)return;const i=r;e(e=>{const t=e.patterns[e.currentPatternIndex],a=t.channels[n].rows.map(e=>({...e}));t.channels[n].rows=t.channels[s].rows.map(e=>({...e})),t.channels[s].rows=a}),CD.getState().pushAction("SWAP_CHANNELS","Swap channels",o,i,t().patterns[o])},splitPatternAtCursor:()=>{const{patterns:n,currentPatternIndex:s,cursor:a}=t(),o=n[s],r=a.rowIndex;if(r<=0||r>=o.length)return;const i=o.length-r;e(e=>{const t=e.patterns[e.currentPatternIndex],n=t.channels.map(e=>({...e,id:`${e.id}-split`,rows:e.rows.slice(r)}));t.channels.forEach(e=>{e.rows=e.rows.slice(0,r)}),t.length=r;const s={id:fD.generate("pattern"),name:`${t.name} (split)`,length:i,channels:n};e.patterns.splice(e.currentPatternIndex+1,0,s)})},joinPatterns:()=>{const{patterns:n,currentPatternIndex:s}=t();if(s>=n.length-1)return;const a=n[s];e(e=>{const t=e.patterns[e.currentPatternIndex],n=e.patterns[e.currentPatternIndex+1],s=Math.min(t.channels.length,n.channels.length);for(let a=0;a<s;a++)t.channels[a].rows=[...t.channels[a].rows,...n.channels[a].rows];t.length=t.channels[0].rows.length,e.patterns.splice(e.currentPatternIndex+1,1)}),CD.getState().pushAction("JOIN_PATTERNS","Join patterns",s,a,t().patterns[s])},addPattern:(t=64)=>e(e=>{const n=e.patterns[0]?.channels.length||4;e.patterns.push(BD(t,n)),"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN ADDED")})}),deletePattern:t=>e(e=>{e.patterns.length>1&&t>=0&&t<e.patterns.length&&(e.patterns.splice(t,1),e.currentPatternIndex>=e.patterns.length&&(e.currentPatternIndex=e.patterns.length-1),e.patternOrder=e.patternOrder.filter(e=>e!==t).map(e=>e>t?e-1:e),0===e.patternOrder.length&&(e.patternOrder=[0]),e.currentPositionIndex>=e.patternOrder.length&&(e.currentPositionIndex=e.patternOrder.length-1),"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN DELETED")}))}),clonePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],s=structuredClone(n);s.id=fD.generate("pattern"),s.name=`${n.name} (Copy)`,e.patterns.splice(t+1,0,s),e.patternOrder=e.patternOrder.map(e=>e>t?e+1:e),"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN CLONED")})}}),resizePattern:(t,n)=>e(e=>{if(t>=0&&t<e.patterns.length&&n>0){const s=e.patterns[t],a=s.length;s.length=n,s.channels.forEach(e=>{if(n>a)for(let t=a;t<n;t++)e.rows.push({...Us});else e.rows.splice(n)})}}),resizeAllPatterns:t=>e(e=>{t>0&&e.patterns.forEach(e=>{const n=e.length;e.length=t,e.channels.forEach(e=>{if(t>n)for(let s=n;s<t;s++)e.rows.push({...Us});else e.rows.splice(t)})})}),duplicatePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],s=structuredClone(n);s.id=fD.generate("pattern"),s.name=`${n.name} (Copy)`,e.patterns.splice(t+1,0,s),e.patternOrder=e.patternOrder.map(e=>e>t?e+1:e),e.currentPatternIndex=t+1}}),expandPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],s=n.length,a=Math.min(2*s,256);if(a===s)return;n.length=a,n.channels.forEach(e=>{const t=[];for(let n=0;n<s;n++)t.push(e.rows[n]),t.push({...Us});e.rows=t})}}),shrinkPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const n=e.patterns[t],s=n.length,a=Math.max(Math.floor(s/2),1);if(a===s)return;n.length=a,n.channels.forEach(e=>{const t=[];for(let n=0;n<a;n++)t.push(e.rows[2*n]);e.rows=t})}}),reorderPatterns:(t,n)=>e(e=>{if(t>=0&&t<e.patterns.length&&n>=0&&n<e.patterns.length&&t!==n){const[s]=e.patterns.splice(t,1);e.patterns.splice(n,0,s),e.currentPatternIndex===t?e.currentPatternIndex=n:t<e.currentPatternIndex&&n>=e.currentPatternIndex?e.currentPatternIndex--:t>e.currentPatternIndex&&n<=e.currentPatternIndex&&e.currentPatternIndex++}}),updatePatternName:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&n.trim()&&(e.patterns[t].name=n.trim())}),addChannel:()=>e(e=>{const t=Is.filter(e=>null!==e),n=t[Math.floor(Math.random()*t.length)];e.patterns.forEach(e=>{if(e.channels.length<16){const t=e.channels.length;e.channels.push({id:fD.generate("channel"),name:`Channel ${t+1}`,rows:Array.from({length:e.length},()=>({...Us})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:n})}}),"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL ADDED")})}),removeChannel:t=>e(e=>{e.patterns.forEach(e=>{e.channels.length>1&&t>=0&&t<e.channels.length&&e.channels.splice(t,1)}),e.cursor.channelIndex>=e.patterns[0]?.channels.length&&(e.cursor.channelIndex=Math.max(0,e.patterns[0].channels.length-1)),"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL REMOVED")})}),toggleChannelMute:n=>{let s=!1;e(e=>{e.patterns.forEach(e=>{n>=0&&n<e.channels.length&&(e.channels[n].muted=!e.channels[n].muted,s=e.channels[n].muted)})});const a=t(),o=a.patterns[a.currentPatternIndex];if(o){Bw().updateMuteStates(o.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(s?"MUTED":"UNMUTED")})},toggleChannelSolo:n=>{let s=!1;e(e=>{e.patterns.forEach(e=>{if(n>=0&&n<e.channels.length){const t=e.channels[n].solo;e.channels.forEach(e=>{e.solo=!1}),t||(e.channels[n].solo=!0,s=!0)}})});const a=t(),o=a.patterns[a.currentPatternIndex];if(o){Bw().updateMuteStates(o.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(s?"SOLO ON":"SOLO OFF")})},toggleChannelCollapse:t=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].collapsed=!e.channels[t].collapsed)})}),setChannelVolume:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].volume=Math.max(0,Math.min(100,n)))})}),setChannelPan:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].pan=Math.max(-100,Math.min(100,n)))})}),setChannelColor:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].color=n)})}),setChannelRows:(t,n)=>e(e=>{const s=e.patterns[e.currentPatternIndex];if(t>=0&&t<s.channels.length){const e=[...n];for(;e.length<s.length;)e.push({...Us});s.channels[t].rows=e.slice(0,s.length)}}),reorderChannel:(t,n)=>e(e=>{e.patterns.forEach(e=>{if(t>=0&&t<e.channels.length&&n>=0&&n<e.channels.length&&t!==n){const[s]=e.channels.splice(t,1);e.channels.splice(n,0,s)}}),e.cursor.channelIndex===t?e.cursor.channelIndex=n:t<e.cursor.channelIndex&&n>=e.cursor.channelIndex?e.cursor.channelIndex--:t>e.cursor.channelIndex&&n<=e.cursor.channelIndex&&e.cursor.channelIndex++}),updateChannelName:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].name=n)})}),applySystemPreset:t=>e(e=>{const n=SD.find(e=>e.id===t);if(!n)return;e.patterns.forEach(e=>{"none"!==n.id?n.channelDefs.length>0&&(n.channelDefs.forEach((t,s)=>{const a=(e=>{switch(e){case gD:return Is[7];case bD:return Is[1];case yD:return Is[3];case vD:return Is[10];case xD:return Is[4];case ND:return Is[6];default:return null}})(t.type);if(s<e.channels.length)e.channels[s].name=t.name,e.channels[s].shortName=t.shortName,e.channels[s].color=a,e.channels[s].channelMeta={...e.channels[s].channelMeta,importedFromMOD:e.channels[s].channelMeta?.importedFromMOD??!1,channelType:t.type===xD?"sample":"synth",furnaceType:t.type,hardwareName:t.name,shortName:t.shortName,systemId:n.fileID};else if(e.channels.length<16){const s=e.length;e.channels.push({id:fD.generate("channel"),name:t.name,shortName:t.shortName,rows:Array.from({length:s},()=>({...Us})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:a,channelMeta:{importedFromMOD:!1,channelType:t.type===xD?"sample":"synth",furnaceType:t.type,hardwareName:t.name,shortName:t.shortName,systemId:n.fileID}})}}),e.channels.length>n.channelDefs.length&&e.channels.splice(n.channelDefs.length)):e.channels.forEach((e,t)=>{e.name=`Channel ${t+1}`,e.shortName=`${t+1}`,e.color=null,e.channelMeta&&(delete e.channelMeta.furnaceType,delete e.channelMeta.hardwareName)})}),"undefined"!=typeof window&&os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(`SYSTEM: ${n.name.toUpperCase()}`)})}),setChannelRecordGroup:(t,n)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].recordGroup=n)})}),getChannelsInRecordGroup:e=>{const n=t(),s=n.patterns[n.currentPatternIndex];return s?s.channels.map((t,n)=>t.recordGroup===e?n:-1).filter(e=>e>=0):[]},loadPatterns:t=>e(e=>{if(t.length>0){const n=t.map(e=>({...e,length:Math.max(1,e.length),channels:e.channels.map(e=>({...e,color:e.color??null}))}));e.patterns=n,e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null}}),setPatternOrder:t=>e(e=>{t.length>0&&(e.patternOrder=t,e.currentPositionIndex=0)}),setOriginalModuleData:t=>e(e=>{e.originalModuleData=t}),setEditorMode:t=>e(e=>{e.editorMode=t}),setFurnaceNative:t=>e(e=>{e.furnaceNative=t}),setFurnaceOrderEntry:(t,n,s)=>e(e=>{if(!e.furnaceNative)return;const a=e.furnaceNative.subsongs[e.furnaceNative.activeSubsong];a&&(t<0||t>=a.orders.length||n<0||n>=a.ordersLen||(a.orders[t][n]=s))}),setHivelyNative:t=>e(e=>{e.hivelyNative=t}),applyEditorMode:t=>e(e=>{e.linearPeriods=t.linearPeriods??!1,t.furnaceNative?(e.editorMode="furnace",e.furnaceNative=t.furnaceNative,e.hivelyNative=null,e.hivelyFileData=null,e.musiclineFileData=null,e.hivelyMeta=null,e.furnaceSubsongs=t.furnaceSubsongs??null,e.furnaceActiveSubsong=t.furnaceActiveSubsong??0,e.channelTrackTables=null,e.channelSpeeds=null,e.channelGrooves=null):t.hivelyNative?(e.editorMode="hively",e.hivelyNative=t.hivelyNative,e.hivelyFileData=t.hivelyFileData??null,e.musiclineFileData=null,e.hivelyMeta=t.hivelyMeta??null,e.furnaceNative=null,e.furnaceSubsongs=null,e.furnaceActiveSubsong=0,e.channelTrackTables=null,e.channelSpeeds=null,e.channelGrooves=null):t.channelTrackTables?(e.editorMode="musicline",e.furnaceNative=null,e.hivelyNative=null,e.hivelyFileData=null,e.musiclineFileData=t.musiclineFileData??null,e.hivelyMeta=null,e.furnaceSubsongs=null,e.furnaceActiveSubsong=0,e.channelTrackTables=t.channelTrackTables,e.channelSpeeds=t.channelSpeeds??null,e.channelGrooves=t.channelGrooves??null):(e.editorMode="classic",e.furnaceNative=null,e.hivelyNative=null,e.hivelyFileData=null,e.musiclineFileData=null,e.hivelyMeta=null,e.furnaceSubsongs=null,e.furnaceActiveSubsong=0,e.channelTrackTables=null,e.channelSpeeds=null,e.channelGrooves=null)}),setFurnaceActiveSubsong:t=>e(e=>{e.furnaceActiveSubsong=t}),importPattern:n=>{const s=t().patterns.length;return e(e=>{const t={...n,length:Math.max(1,n.length),channels:n.channels.map(e=>({...e,color:e.color??null}))};e.patterns.push(t)}),s},replacePattern:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&(e.patterns[t]=structuredClone(n))}),addToOrder:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&(void 0!==n&&n>=0&&n<=e.patternOrder.length?e.patternOrder.splice(n,0,t):e.patternOrder.push(t))}),removeFromOrder:t=>e(e=>{t>=0&&t<e.patternOrder.length&&e.patternOrder.length>1&&(e.patternOrder.splice(t,1),e.currentPositionIndex>=e.patternOrder.length&&(e.currentPositionIndex=e.patternOrder.length-1))}),insertInOrder:(t,n)=>e(e=>{t>=0&&t<e.patterns.length&&n>=0&&n<=e.patternOrder.length&&e.patternOrder.splice(n,0,t)}),duplicatePosition:t=>e(e=>{if(t>=0&&t<e.patternOrder.length){const n=e.patternOrder[t];e.patternOrder.splice(t+1,0,n)}}),clearOrder:()=>e(e=>{e.patternOrder=[0],e.currentPositionIndex=0}),reorderPositions:(t,n)=>e(e=>{if(t>=0&&t<e.patternOrder.length&&n>=0&&n<e.patternOrder.length){const[s]=e.patternOrder.splice(t,1);e.patternOrder.splice(n,0,s),e.currentPositionIndex===t?e.currentPositionIndex=n:t<e.currentPositionIndex&&n>=e.currentPositionIndex?e.currentPositionIndex--:t>e.currentPositionIndex&&n<=e.currentPositionIndex&&e.currentPositionIndex++}}),setCurrentPosition:(t,n)=>e(e=>{if(t>=0&&t<e.patternOrder.length){if(e.currentPositionIndex===t)return;e.currentPositionIndex=t;const s=e.patternOrder[t];if(e.currentPatternIndex=s,n)return;const a=pD();if(a.isPlaying()&&a.getCurrentPosition()!==t){const e=jN.getState().currentRow;a.seekTo(t,e)}}}),setLiveChannelData:(t,n)=>e(e=>{const s=e.patternOrder[e.currentPositionIndex]??e.currentPatternIndex,a=e.patterns[s];if(a)for(let o=0;o<Math.min(n.length,a.channels.length);o++){const e=a.channels[o]?.rows[t];if(!e)continue;const s=n[o];s.note>0&&(e.note=s.note,e.instrument=s.instrument,e.volume=s.volume)}}),reset:()=>e(e=>{e.patterns=[BD()],e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null,e.trackClipboard=null,e.currentOctave=4,e.recordMode=!1,e.editStep=1,e.insertMode=!1,e.columnVisibility={...Fs},e.copyMask=OD,e.pasteMask=OD,e.transposeMask=1,e.macroSlots=Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),e.patternOrder=[0],e.currentPositionIndex=0,e.editorMode="classic",e.furnaceNative=null,e.hivelyNative=null,e.furnaceSubsongs=null,e.furnaceActiveSubsong=0})}))),FD=Object.freeze(Object.defineProperty({__proto__:null,MASK_ALL:OD,MASK_EFFECT:8,MASK_EFFECT2:_D,MASK_INSTRUMENT:2,MASK_NOTE:1,MASK_VOLUME:4,hasMaskBit:TD,toggleMaskBit:LD,useTrackerStore:ID},Symbol.toStringTag,{value:"Module"})),UD=i()(ds((e,t)=>({initialized:!1,contextState:"suspended",masterVolume:0,masterMuted:!1,sampleBusGain:0,synthBusGain:0,autoGain:!1,analyserNode:null,fftNode:null,toneEngineInstance:null,masterEffects:[],setInitialized:t=>e(e=>{e.initialized=t}),setContextState:t=>e(e=>{e.contextState=t}),setMasterVolume:n=>e(e=>{e.masterVolume=Math.max(-60,Math.min(0,n));const s=t().toneEngineInstance;s&&s.setMasterVolume(e.masterVolume)}),setMasterMuted:n=>e(e=>{e.masterMuted=n;const s=t().toneEngineInstance;s&&s.setMasterMute(n)}),toggleMasterMute:()=>e(e=>{e.masterMuted=!e.masterMuted;const n=t().toneEngineInstance;n&&n.setMasterMute(e.masterMuted)}),setAnalyserNode:t=>e(e=>{e.analyserNode=t}),setFFTNode:t=>e(e=>{e.fftNode=t}),setToneEngineInstance:t=>e(e=>{e.toneEngineInstance=t}),setSampleBusGain:n=>e(e=>{e.sampleBusGain=n;const s=t().toneEngineInstance;s&&s.setSampleBusGain(n)}),setSynthBusGain:n=>e(e=>{e.synthBusGain=n;const s=t().toneEngineInstance;s&&s.setSynthBusGain(n)}),setAutoGain:n=>e(e=>{e.autoGain=n;const s=t().toneEngineInstance;s&&s.setAutoGain(n)}),addMasterEffect:t=>e(e=>{const n={id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:t,enabled:!0,wet:50,parameters:$N(t)};e.masterEffects.push(n)}),addMasterEffectConfig:t=>e(e=>{const n={...t,id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,parameters:{...$N(t.type),...t.parameters}};e.masterEffects.push(n)}),removeMasterEffect:t=>e(e=>{const n=e.masterEffects.findIndex(e=>e.id===t);-1!==n&&e.masterEffects.splice(n,1)}),updateMasterEffect:(n,s)=>e(e=>{const a=e.masterEffects.find(e=>e.id===n);if(a){if(s.parameters&&Object.keys(a.parameters).length<Object.keys($N(a.type)).length&&(a.parameters={...$N(a.type),...a.parameters}),Object.assign(a,s),"enabled"in s)return;const e=structuredClone(a),o=t().toneEngineInstance;if(o&&(o.updateMasterEffectParams(n,e),1===e.parameters.bpmSync)){const e=o.getBPM();o.updateBpmSyncedEffects(e)}}}),reorderMasterEffects:(t,n)=>e(e=>{const[s]=e.masterEffects.splice(t,1);e.masterEffects.splice(n,0,s)}),setMasterEffects:t=>e(e=>{const n=t.map(e=>{const t={...e,category:e.category||"tonejs"};if("Tumult"===t.type&&1===Number(t.parameters?.switchBranch)){const e=t.parameters??{};return{...t,parameters:{...e,switchBranch:0,...Number(e.mix)>=1?{mix:.5}:{},...1===Number(e.peak1Enable)?{peak1Enable:0}:{},...1===Number(e.peak2Enable)?{peak2Enable:0}:{},...Number(e.followRelease)>20?{followRelease:15}:{}}}}return t});e.masterEffects=n})}))),RD=i()(ds(e=>({metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},isDirty:!1,lastSavedAt:null,setMetadata:t=>e(e=>{Object.assign(e.metadata,t),e.metadata.modifiedAt=(new Date).toISOString(),e.isDirty=!0}),setIsDirty:t=>e(e=>{e.isDirty=t}),markAsSaved:()=>e(e=>{e.isDirty=!1,e.lastSavedAt=(new Date).toISOString()}),markAsModified:()=>e(e=>{e.isDirty=!0,e.metadata.modifiedAt=(new Date).toISOString()}),resetProject:()=>e(e=>{e.metadata={id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},e.isDirty=!1,e.lastSavedAt=null})})));function jD(e){e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}const XD=i()(ds((e,t)=>({curves:[],selectedCurveId:null,editMode:"pencil",presets:[...Ra],automation:{},channelLanes:new Map,addCurve:(t,n,s)=>{const a={id:`curve-${Date.now()}`,patternId:t,channelIndex:n,parameter:s,mode:"curve",interpolation:"linear",points:[],enabled:!0};return e(e=>{e.curves.push(a),e.selectedCurveId=a.id,jD(e)}),a.id},removeCurve:t=>e(e=>{const n=e.curves.findIndex(e=>e.id===t);-1!==n&&(e.curves.splice(n,1),e.selectedCurveId===t&&(e.selectedCurveId=null),jD(e))}),updateCurve:(t,n)=>e(e=>{const s=e.curves.find(e=>e.id===t);s&&(Object.assign(s,n),jD(e))}),setSelectedCurve:t=>e(e=>{e.selectedCurveId=t}),setEditMode:t=>e(e=>{e.editMode=t}),addPoint:(t,n,s)=>e(e=>{const a=e.curves.find(e=>e.id===t);if(a){const t=a.points.findIndex(e=>e.row===n);-1!==t?a.points[t].value=s:(a.points.push({row:n,value:s}),a.points.sort((e,t)=>e.row-t.row)),jD(e)}}),removePoint:(t,n)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.findIndex(e=>e.row===n);-1!==t&&(s.points.splice(t,1),jD(e))}}),updatePoint:(t,n,s)=>e(e=>{const a=e.curves.find(e=>e.id===t);if(a){const t=a.points.find(e=>e.row===n);t&&(t.value=s,jD(e))}}),clearPoints:t=>e(e=>{const n=e.curves.find(e=>e.id===t);n&&(n.points=[],jD(e))}),applyPreset:(t,n)=>e(e=>{const s=e.curves.find(e=>e.id===t);s&&(s.points=[...n.points],jD(e))}),getCurvesForPattern:(e,n)=>t().curves.filter(t=>t.patternId===e&&t.channelIndex===n),getValueAtRow:(e,n)=>{const s=t().curves.find(t=>t.id===e);return s&&0!==s.points.length?Ua(s.points,n,s.interpolation,s.mode):null},getAutomation:(e,n,s)=>{const a=t().curves.find(t=>t.patternId===e&&t.channelIndex===n&&t.parameter===s);return a||{id:`temp-${e}-${n}-${s}`,patternId:e,channelIndex:n,parameter:s,mode:"curve",interpolation:"linear",points:[],enabled:!0}},setAutomation:(t,n,s,a)=>e(e=>{const o=e.curves.findIndex(e=>e.patternId===t&&e.channelIndex===n&&e.parameter===s);-1!==o?e.curves[o]=a:e.curves.push(a),jD(e)}),buildAutomationData:()=>{const e=t(),n={};return e.curves.forEach(e=>{n[e.patternId]||(n[e.patternId]={}),n[e.patternId][e.channelIndex]||(n[e.patternId][e.channelIndex]={}),n[e.patternId][e.channelIndex][e.parameter]=e}),n},loadCurves:t=>e(e=>{e.curves=t,e.selectedCurveId=null,jD(e)}),getCurves:()=>t().curves,setActiveParameter:(t,n)=>e(e=>{const s=e.channelLanes.get(t)||{activeParameter:"",showLane:!1};e.channelLanes.set(t,{...s,activeParameter:n})}),getActiveParameter:e=>{const n=t();return n.channelLanes.get(e)?.activeParameter||""},setShowLane:(t,n)=>e(e=>{const s=e.channelLanes.get(t)||{activeParameter:"",showLane:!1};e.channelLanes.set(t,{...s,showLane:n})}),getShowLane:e=>{const n=t();return n.channelLanes.get(e)?.showLane||!1},reset:()=>e({curves:[],selectedCurveId:null,editMode:"pencil",automation:{},channelLanes:new Map})}))),zD=()=>{const e=ID.getState(),t=EN.getState(),n=XD.getState(),s=RD.getState(),a=jN.getState();return{patterns:structuredClone(e.patterns),currentPatternIndex:e.currentPatternIndex,instruments:structuredClone(t.instruments),currentInstrumentId:t.currentInstrumentId,automationCurves:structuredClone(n.curves),metadata:structuredClone(s.metadata),bpm:a.bpm}},GD=e=>{const t=Bw();try{t.stop()}catch{}jN.getState().reset(),jN.getState().setBPM(e.bpm),RD.getState().setMetadata(e.metadata),RD.getState().setIsDirty(!1),ID.getState().loadPatterns(e.patterns),ID.getState().setCurrentPattern(e.currentPatternIndex),EN.getState().loadInstruments(e.instruments),null!==e.currentInstrumentId&&EN.getState().setCurrentInstrument(e.currentInstrumentId),XD.getState().loadCurves(e.automationCurves)},HD=()=>({id:`tab-${Date.now()}`,name:"Untitled",isDirty:!1,state:null}),WD=HD(),qD=i()(ds((e,t)=>({tabs:[WD],activeTabId:WD.id,addTab:()=>{const n=t().activeTabId,s=zD();e(e=>{const t=e.tabs.find(e=>e.id===n);t&&(t.state=s);const a=HD();e.tabs.push(a),e.activeTabId=a.id});const a={patterns:[{id:`pattern-${Date.now()}`,name:"Untitled Pattern",length:64,channels:Array.from({length:4},(e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,rows:Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}],currentPatternIndex:0,instruments:[],currentInstrumentId:0,automationCurves:[],metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},bpm:125};GD(a)},closeTab:n=>{const s=t();if(s.tabs.length<=1)return;const a=s.tabs.findIndex(e=>e.id===n);if(-1===a)return;let o=s.activeTabId,r=!1;if(s.activeTabId===n){const e=0===a?1:a-1;o=s.tabs[e].id,r=!0}const i=s.tabs.find(e=>e.id===o),l=i?.state;e(e=>{e.activeTabId=o,e.tabs.splice(a,1);const t=e.tabs.find(e=>e.id===o);t&&(t.state=null)}),r&&l&&GD(l)},setActiveTab:n=>{const s=t();if(!s.tabs.some(e=>e.id===n))return;if(s.activeTabId===n)return;const a=s.activeTabId,o=zD(),r=s.tabs.find(e=>e.id===n),i=r?.state;e(e=>{const t=e.tabs.find(e=>e.id===a);t&&(t.state=o),e.activeTabId=n;const s=e.tabs.find(e=>e.id===n);s&&(s.state=null)}),i&&GD(i)},updateTabName:(t,n)=>e(e=>{const s=e.tabs.find(e=>e.id===t);s&&(s.name=n)}),markTabDirty:(t,n)=>e(e=>{const s=e.tabs.find(e=>e.id===t);s&&(s.isDirty=n)})}))),KD={id:"devilbox",name:"DEViLBOX",colors:{bg:"#0b0909",bgSecondary:"#131010",bgTertiary:"#1d1818",bgHover:"#262020",bgActive:"#2f2828",border:"#2f2525",borderLight:"#403535",accent:"#ef4444",accentSecondary:"#f97316",accentGlow:"rgba(239, 68, 68, 0.15)",text:"#f2f0f0",textSecondary:"#a8a0a0",textMuted:"#686060",textInverse:"#0b0909",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0f0c0c",trackerRowOdd:"#131010",trackerRowHighlight:"#181414",trackerRowCurrent:"#2a1a1a",trackerRowCursor:"#251010",cellNote:"#f2f0f0",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#ef4444",cellSlide:"#fb7185",cellEmpty:"#484040"}},$D=[KD,{id:"neodark",name:"NeoDark",colors:{bg:"#0a0a0b",bgSecondary:"#111113",bgTertiary:"#1a1a1d",bgHover:"#222226",bgActive:"#2a2a2f",border:"#2a2a2f",borderLight:"#3a3a40",accent:"#00d4aa",accentSecondary:"#7c3aed",accentGlow:"rgba(0, 212, 170, 0.15)",text:"#f0f0f2",textSecondary:"#a0a0a8",textMuted:"#606068",textInverse:"#0a0a0b",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0d0d0f",trackerRowOdd:"#111113",trackerRowHighlight:"#151518",trackerRowCurrent:"#1a2a25",trackerRowCursor:"#0d2520",cellNote:"#f0f0f2",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#00d4aa",cellSlide:"#a78bfa",cellEmpty:"#404048"}},{id:"cyan-lineart",name:"Cyan Lineart",colors:{bg:"#030808",bgSecondary:"#051010",bgTertiary:"#071414",bgHover:"#0a1a1a",bgActive:"#0c2020",border:"#00808080",borderLight:"#00b8b8",accent:"#00ffff",accentSecondary:"#00e0e0",accentGlow:"rgba(0, 255, 255, 0.12)",text:"#00ffff",textSecondary:"#00c8c8",textMuted:"#006060",textInverse:"#030808",error:"#ff4080",success:"#00ff88",warning:"#00ffaa",trackerRowEven:"#030808",trackerRowOdd:"#041010",trackerRowHighlight:"#061414",trackerRowCurrent:"#081818",trackerRowCursor:"#0a1c1c",cellNote:"#00ffff",cellInstrument:"#00e8e8",cellVolume:"#00d0d0",cellEffect:"#00b8b8",cellAccent:"#00ffff",cellSlide:"#00a0a0",cellEmpty:"#003838"}}],YD=e=>{const t=document.documentElement,{colors:n}=e;t.setAttribute("data-theme",e.id),t.style.setProperty("--color-bg",n.bg),t.style.setProperty("--color-bg-secondary",n.bgSecondary),t.style.setProperty("--color-bg-tertiary",n.bgTertiary),t.style.setProperty("--color-bg-hover",n.bgHover),t.style.setProperty("--color-bg-active",n.bgActive),t.style.setProperty("--color-border",n.border),t.style.setProperty("--color-border-light",n.borderLight),t.style.setProperty("--color-accent",n.accent),t.style.setProperty("--color-accent-secondary",n.accentSecondary),t.style.setProperty("--color-accent-glow",n.accentGlow),t.style.setProperty("--color-text",n.text),t.style.setProperty("--color-text-secondary",n.textSecondary),t.style.setProperty("--color-text-muted",n.textMuted),t.style.setProperty("--color-text-inverse",n.textInverse),t.style.setProperty("--color-error",n.error),t.style.setProperty("--color-success",n.success),t.style.setProperty("--color-warning",n.warning),t.style.setProperty("--color-tracker-row-even",n.trackerRowEven),t.style.setProperty("--color-tracker-row-odd",n.trackerRowOdd),t.style.setProperty("--color-tracker-row-highlight",n.trackerRowHighlight),t.style.setProperty("--color-tracker-row-current",n.trackerRowCurrent),t.style.setProperty("--color-tracker-row-cursor",n.trackerRowCursor),t.style.setProperty("--color-cell-note",n.cellNote),t.style.setProperty("--color-cell-instrument",n.cellInstrument),t.style.setProperty("--color-cell-volume",n.cellVolume),t.style.setProperty("--color-cell-effect",n.cellEffect),t.style.setProperty("--color-cell-accent",n.cellAccent),t.style.setProperty("--color-cell-slide",n.cellSlide),t.style.setProperty("--color-cell-empty",n.cellEmpty)},JD=i()(TN((e,t)=>({currentThemeId:"devilbox",setTheme:t=>{const n=$D.find(e=>e.id===t);n&&(YD(n),e({currentThemeId:t}))},getCurrentTheme:()=>{const{currentThemeId:e}=t();return $D.find(t=>t.id===e)||KD}}),{name:"devilbox-theme",onRehydrateStorage:()=>e=>{if(e){const t=$D.find(t=>t.id===e.currentThemeId)||KD;YD(t)}}}));if("undefined"!=typeof window){const e=localStorage.getItem("devilbox-theme");let t="devilbox";if(e)try{const n=JSON.parse(e);t=n.state?.currentThemeId||"devilbox"}catch{}const n=$D.find(e=>e.id===t)||KD;YD(n)}const QD=()=>{if("undefined"==typeof navigator)return!1;const e=navigator.userAgent||navigator.vendor,t=/Macintosh/i.test(e)&&navigator.maxTouchPoints>1,n=/iPhone|iPod/i.test(e),s=/iPad/i.test(e);return t||n||s},ZD=()=>{if("undefined"==typeof navigator)return!1;const e=navigator.userAgent||navigator.vendor;return/android/i.test(e)},eS=()=>{const e=QD(),t=ZD();return(()=>{if("undefined"==typeof navigator)return!1;const e="requestMIDIAccess"in navigator,t=window.isSecureContext,n=navigator.standalone||window.matchMedia("(display-mode: standalone)").matches;return e||(!t&&"http:"!==window.location.protocol&&window.location.hostname,n&&/iPhone|iPad|iPod/i.test(navigator.userAgent)),e})()?e?{isIOS:!0,isSupported:!0,instructions:`To connect MIDI devices on iOS:\n\nUSB MIDI (via Camera Connection Kit):\n1. Connect USB MIDI controller to Lightning/USB-C adapter\n2. DEViLBOX should detect it automatically\n3. Check MIDI settings to verify connection\n\nBluetooth MIDI:\n1. Open Settings  Bluetooth\n2. Turn on your MIDI device\n3. Pair it with your ${/iPad/i.test(navigator.userAgent)?"iPad":"iPhone"}\n4. Return to DEViLBOX (no refresh needed)\n5. Device should appear in MIDI settings\n\nNote: iOS Safari has the best MIDI support. Chrome on iOS does NOT support Web MIDI.`,requiresPairing:!0}:t?{isIOS:!1,isSupported:!0,instructions:"To connect MIDI devices on Android:\n\nUSB MIDI (via USB-C or OTG adapter):\n1. Connect USB MIDI controller via adapter\n2. Grant USB permission when prompted\n3. Check MIDI settings to verify connection\n\nBluetooth MIDI:\n1. Pair MIDI device via Android Bluetooth settings\n2. Open DEViLBOX\n3. Device should appear in MIDI settings\n\nNote: Android MIDI support varies by device and browser. Chrome 43+ required. USB works more reliably than Bluetooth.",requiresPairing:!1}:{isIOS:!1,isSupported:!0,instructions:"Connect your USB MIDI device. It should be detected automatically. Bluetooth MIDI may require pairing first.",requiresPairing:!1}:t?{isIOS:!1,isSupported:!1,instructions:"Web MIDI is not supported on Android Chrome yet.\n\nTo use MIDI on Android:\n1. Try Chrome Canary or Chrome Dev (enable chrome://flags/#enable-web-midi)\n2. Or use a desktop browser (Chrome, Edge, Opera)\n3. USB MIDI controllers work better than Bluetooth on Android\n\nAlternatively, use an iOS device with Safari for full MIDI support.",requiresPairing:!1}:{isIOS:e,isSupported:!1,instructions:"Web MIDI is not supported on this browser. Try Safari on iOS or Chrome/Edge on desktop.",requiresPairing:!1}};class tS{static instance=null;midiAccess=null;inputs=new Map;outputs=new Map;selectedInputId=null;selectedOutputId=null;messageHandlers=new Set;deviceChangeCallbacks=new Set;lastActivityTimestamp=0;boundMessageHandler=null;clockTickCount=0;lastClockTimestamp=0;clockBPM=0;clockSyncEnabled=!1;clockSyncCallbacks=new Set;transportCallbacks=new Set;constructor(){}static getInstance(){return tS.instance||(tS.instance=new tS),tS.instance}isSupported(){return"requestMIDIAccess"in navigator}async init(){if(!this.isSupported())return!1;try{const e=QD()||ZD();return this.midiAccess=await navigator.requestMIDIAccess({sysex:!e}),this.updateDevices(),this.midiAccess.onstatechange=()=>{this.updateDevices(),this.notifyDeviceChange()},!0}catch(e){return DOMException,!1}}updateDevices(){if(this.midiAccess){if(this.inputs.clear(),this.outputs.clear(),this.midiAccess.inputs.forEach((e,t)=>{this.inputs.set(t,e)}),this.midiAccess.outputs.forEach((e,t)=>{this.outputs.set(t,e)}),!this.selectedInputId){const e=this.detectTD3Devices().input;e&&this.selectInput(e.id)}if(!this.selectedOutputId){const e=this.detectTD3Devices().output;e&&this.selectOutput(e.id)}}}portToDeviceInfo(e,t){const n=e.name||"Unknown Device",s=e.manufacturer||"";return{id:e.id,name:n,manufacturer:s,type:t,isConnected:"open"===e.connection||"connected"===e.state,isTD3:this.isTD3Device(n,s)}}isTD3Device(e,t){const n=e.toLowerCase(),s=t.toLowerCase();return n.includes("td-3")||n.includes("td3")||s.includes("behringer")&&n.includes("303")}getInputDevices(){const e=[];return this.inputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"input"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}getOutputDevices(){const e=[];return this.outputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"output"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}detectTD3Devices(){const e=this.getInputDevices(),t=this.getOutputDevices();return{input:e.find(e=>e.isTD3)||null,output:t.find(e=>e.isTD3)||null}}async selectInput(e){if(this.selectedInputId){const e=this.inputs.get(this.selectedInputId);if(e){e.onmidimessage=null;try{await e.close()}catch{}}}if(this.selectedInputId=e,e){const n=this.inputs.get(e);if(n)try{await n.open(),this.boundMessageHandler=this.handleMIDIMessage.bind(this),n.onmidimessage=this.boundMessageHandler}catch(t){}}}selectOutput(e){this.selectedOutputId=e,e&&this.outputs.get(e)}getSelectedInput(){if(!this.selectedInputId)return null;const e=this.inputs.get(this.selectedInputId);return e?this.portToDeviceInfo(e,"input"):null}getSelectedOutput(){if(!this.selectedOutputId)return null;const e=this.outputs.get(this.selectedOutputId);return e?this.portToDeviceInfo(e,"output"):null}handleMIDIMessage(e){const t=e.data;if(!t||0===t.length)return;const n=t[0];this.lastActivityTimestamp=Date.now();const s=this.parseMIDIMessage(n,t,e.timeStamp);this.clockSyncEnabled&&("clock"===s.type?this.processClockTick(e.timeStamp):"start"!==s.type&&"stop"!==s.type&&"continue"!==s.type||this.processTransportCommand(s.type)),this.messageHandlers.forEach(e=>{try{e(s,this.selectedInputId||"")}catch(t){}})}processClockTick(e){if(this.clockTickCount++,this.lastClockTimestamp>0){const t=e-this.lastClockTimestamp;if(t>0){const e=2500/t;if(0===this.clockBPM?this.clockBPM=e:this.clockBPM=.9*this.clockBPM+.1*e,this.clockTickCount%24==0){const e=Math.round(10*this.clockBPM)/10;this.clockSyncCallbacks.forEach(t=>{try{t(e)}catch(n){}})}}}this.lastClockTimestamp=e}processTransportCommand(e){"start"===e&&(this.clockTickCount=0,this.lastClockTimestamp=0),this.transportCallbacks.forEach(t=>{try{t(e)}catch(n){}})}parseMIDIMessage(e,t,n){let s,a,o,r,i,l,c,u="other";if(e>=240)switch(s=-1,e){case 240:u="sysex";break;case 248:u="clock";break;case 250:u="start";break;case 251:u="continue";break;case 252:u="stop";break;default:u="other"}else{switch(s=15&e,240&e){case 144:u="noteOn",a=t[1],o=t[2],0===o&&(u="noteOff");break;case 128:u="noteOff",a=t[1],o=t[2];break;case 176:u="cc",r=t[1],i=t[2];break;case 192:u="programChange",c=t[1];break;case 224:u="pitchBend",l=(t[2]<<7|t[1])-8192;break;default:u="other"}}return{type:u,channel:s,data:t,timestamp:n,note:a,velocity:o,cc:r,value:i,pitchBend:l,program:c}}addMessageHandler(e){this.messageHandlers.add(e)}removeMessageHandler(e){this.messageHandlers.delete(e)}sendCC(e,t,n){if(!this.selectedOutputId)return;const s=this.outputs.get(this.selectedOutputId);if(!s)return;const a=new Uint8Array([176|15&e,127&t,127&n]);s.send(a)}sendSysEx(e){if(!this.selectedOutputId)return;const t=this.outputs.get(this.selectedOutputId);if(t)try{t.send(e)}catch(n){throw n}}sendNoteOn(e,t,n){if(!this.selectedOutputId)return;const s=this.outputs.get(this.selectedOutputId);if(!s)return;const a=new Uint8Array([144|15&e,127&t,127&n]);s.send(a)}sendNoteOff(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const s=new Uint8Array([128|15&e,127&t,0]);n.send(s)}sendPitchBend(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const s=Math.max(0,Math.min(16383,t+8192)),a=new Uint8Array([224|15&e,127&s,s>>7&127]);n.send(a)}sendProgramChange(e,t){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const s=new Uint8Array([192|15&e,127&t]);n.send(s)}setClockSyncEnabled(e){this.clockSyncEnabled=e,e||(this.clockTickCount=0,this.lastClockTimestamp=0,this.clockBPM=0)}isClockSyncEnabled(){return this.clockSyncEnabled}getClockBPM(){return Math.round(10*this.clockBPM)/10}onClockSync(e){return this.clockSyncCallbacks.add(e),()=>{this.clockSyncCallbacks.delete(e)}}onTransportCommand(e){return this.transportCallbacks.add(e),()=>{this.transportCallbacks.delete(e)}}onDeviceChange(e){return this.deviceChangeCallbacks.add(e),()=>{this.deviceChangeCallbacks.delete(e)}}notifyDeviceChange(){this.deviceChangeCallbacks.forEach(e=>{try{e()}catch(t){}})}getLastActivityTimestamp(){return this.lastActivityTimestamp}isInitialized(){return null!==this.midiAccess}dispose(){this.midiAccess&&(this.midiAccess.onstatechange=null),this.inputs.forEach(e=>{e.onmidimessage=null}),this.inputs.clear(),this.outputs.clear(),this.messageHandlers.clear(),this.deviceChangeCallbacks.clear(),this.clockSyncCallbacks.clear(),this.transportCallbacks.clear(),this.selectedInputId=null,this.selectedOutputId=null,this.midiAccess=null,this.clockSyncEnabled=!1,this.clockBPM=0,this.clockTickCount=0,this.lastClockTimestamp=0}}function nS(){return tS.getInstance()}class sS{static instance=null;mappings=new Map;lastCCValues=new Map;smoothedValues=new Map;globalSensitivity=.3;controlledInstrumentId=null;controlledInstrumentListeners=new Set;learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null};changeCallbacks=new Set;learnListeners=new Set;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return sS.instance||(sS.instance=new sS),sS.instance}init(){if(this.handlerRegistered)return;nS().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("cc"!==e.type||void 0===e.cc||void 0===e.value)return;if(this.learnState.isLearning&&this.learnState.callback)return void this.learnState.callback(e.cc,e.channel);const t=`${e.cc}-${e.channel}`,n=e.value,s=this.smoothedValues.get(t)??n,a=this.globalSensitivity,o=s+(n-s)*a;this.smoothedValues.set(t,o),this.mappings.forEach(t=>{if(t.ccNumber!==e.cc)return;if(void 0!==t.midiChannel&&t.midiChannel!==e.channel)return;const a=t.sensitivity??1,r=a<1?s+(n-s)*a:o,i=this.ccToParameter(r,t);this.notifyParameterChange(t.instrumentId,t.parameterPath,i)})};ccToParameter(e,t){const n=e/127;if("logarithmic"===t.curve){const e=Math.max(1,t.min),s=Math.max(e+1,t.max),a=Math.log(e),o=Math.log(s);return Math.exp(a+n*(o-a))}return t.min+n*(t.max-t.min)}parameterToCC(e,t){let n;if("logarithmic"===t.curve){const s=Math.max(1,t.min),a=Math.max(s+1,t.max),o=Math.log(s),r=Math.log(a);n=(Math.log(Math.max(s,e))-o)/(r-o)}else n=(e-t.min)/(t.max-t.min);return Math.round(Math.max(0,Math.min(127,127*n)))}startLearn(e,t,n,s,a,o="linear"){return new Promise(r=>{this.learnState={isLearning:!0,instrumentId:e,parameterPath:t,displayName:n,min:s,max:a,curve:o,callback:(e,t)=>{this.learnState.isLearning=!1,this.learnState.callback=null,this.notifyLearnChange(!1,null),r({ccNumber:e,channel:t})}},this.notifyLearnChange(!0,t)})}cancelLearn(){this.learnState.isLearning&&(this.learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null},this.notifyLearnChange(!1,null))}isLearning(){return this.learnState.isLearning}getLearningParameter(){return this.learnState.parameterPath}setMapping(e){this.mappings.forEach((t,n)=>{t.instrumentId===e.instrumentId&&t.parameterPath===e.parameterPath&&this.mappings.delete(n)}),this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}removeMappingsForInstrument(e){const t=[];this.mappings.forEach((n,s)=>{n.instrumentId===e&&t.push(s)}),t.forEach(e=>this.mappings.delete(e)),t.length>0&&(this.saveMappings(),this.notifyMappingChange())}getMappingForParameter(e,t){for(const n of this.mappings.values())if(n.instrumentId===e&&n.parameterPath===t)return n}getMappingsForInstrument(e){const t=[];return this.mappings.forEach(n=>{n.instrumentId===e&&t.push(n)}),t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}onParameterChange(e){return this.changeCallbacks.add(e),()=>this.changeCallbacks.delete(e)}onLearnChange(e){return this.learnListeners.add(e),()=>this.learnListeners.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyParameterChange(e,t,n){this.changeCallbacks.forEach(s=>{try{s(e,t,n)}catch(a){}})}notifyLearnChange(e,t){this.learnListeners.forEach(n=>{try{n(e,t)}catch(s){}})}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}setGlobalSensitivity(e){this.globalSensitivity=Math.max(.05,Math.min(1,e))}getGlobalSensitivity(){return this.globalSensitivity}resetSmoothing(){this.smoothedValues.clear(),this.lastCCValues.clear()}setControlledInstrument(e){this.controlledInstrumentId=e,this.resetSmoothing(),this.notifyControlledInstrumentChange(e)}getControlledInstrument(){return this.controlledInstrumentId}onControlledInstrumentChange(e){return this.controlledInstrumentListeners.add(e),()=>this.controlledInstrumentListeners.delete(e)}notifyControlledInstrumentChange(e){this.controlledInstrumentListeners.forEach(t=>{try{t(e)}catch(n){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("cc-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("cc-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){nS().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.changeCallbacks.clear(),this.learnListeners.clear(),this.mappingListeners.clear()}}function aS(){return sS.getInstance()}class oS{static instance=null;mappings=new Map;actionHandlers=new Map;isLearning=!1;learningAction=null;learnCallback=null;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return oS.instance||(oS.instance=new oS),oS.instance}init(){if(this.handlerRegistered)return;nS().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if(this.isLearning&&this.learnCallback)return"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?void this.learnCallback(e.note,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63?void this.learnCallback(-e.cc-1,e.channel):void 0;"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?this.triggerButtonAction(e.note,void 0,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63&&this.triggerButtonAction(void 0,e.cc,e.channel)};triggerButtonAction(e,t,n){for(const a of this.mappings.values()){const o=void 0!==e&&a.midiNote===e,r=void 0!==t&&a.ccNumber===t;if(!o&&!r)continue;if(void 0!==a.midiChannel&&void 0!==n&&a.midiChannel!==n)continue;const i=this.actionHandlers.get(a.action);if(i)i();else if(a.action.startsWith("cmd:"))try{const e=a.action.slice(4),{getGlobalRegistry:t}=require("../hooks/useGlobalKeyboardHandler");t().execute(e,"global")}catch(s){}return}}startLearn(e){return new Promise(t=>{this.isLearning=!0,this.learningAction=e,this.learnCallback=(e,n)=>{this.isLearning=!1,this.learningAction=null,this.learnCallback=null,t(e<0?{type:"cc",number:-e-1,channel:n}:{type:"note",number:e,channel:n})}})}cancelLearn(){this.isLearning=!1,this.learningAction=null,this.learnCallback=null}isInLearnMode(){return this.isLearning}getLearningAction(){return this.learningAction}setMapping(e){for(const[t,n]of this.mappings.entries())n.action===e.action&&this.mappings.delete(t);this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}getMappingForAction(e){for(const t of this.mappings.values())if(t.action===e)return t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}registerAction(e,t){return this.actionHandlers.set(e,t),()=>this.actionHandlers.delete(e)}unregisterAction(e){this.actionHandlers.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("button-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("button-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){nS().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.actionHandlers.clear(),this.mappingListeners.clear()}}function rS(){return oS.getInstance()}class iS{static instance=null;mappings=new Map;triggerCallbacks=new Set;handlerRegistered=!1;isLearning=!1;learnCallback=null;constructor(){}static getInstance(){return iS.instance||(iS.instance=new iS),iS.instance}init(){if(this.handlerRegistered)return;nS().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("noteOn"!==e.type&&"noteOff"!==e.type)return;if(void 0===e.note)return;if(this.isLearning&&"noteOn"===e.type&&this.learnCallback)return void this.learnCallback(e.note,e.channel);const t=`${e.channel}-${e.note}`,n=this.mappings.get(t);if(n){const t="noteOff"===e.type?0:e.velocity??0;this.notifyTrigger(n,t)}};onTrigger(e){return this.triggerCallbacks.add(e),()=>this.triggerCallbacks.delete(e)}notifyTrigger(e,t){this.triggerCallbacks.forEach(n=>{try{n(e,t)}catch(s){}})}setMapping(e){this.mappings.set(e.id,e),this.saveMappings()}removeMapping(e){this.mappings.delete(e),this.saveMappings()}getMapping(e,t){return this.mappings.get(`${e}-${t}`)}getAllMappings(){return Array.from(this.mappings.values())}clearMappings(){this.mappings.clear(),this.saveMappings()}startLearn(e){this.isLearning=!0,this.learnCallback=(t,n)=>{this.isLearning=!1,this.learnCallback=null,e(t,n)}}cancelLearn(){this.isLearning=!1,this.learnCallback=null}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("pad-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("pad-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>this.mappings.set(e.id,e))}}catch(e){}}dispose(){this.handlerRegistered&&(nS().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1),this.triggerCallbacks.clear()}}function lS(){return iS.getInstance()}const cS={HEADER:new Uint8Array([240,0,32,50,0,1,10]),FOOTER:247,CMD_REQUEST_PATTERN:119,CMD_SEND_PATTERN:120},uS=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function dS(e){const{name:t,octave:n}=function(e){const t=Math.floor(e/12)-1;return{name:uS[e%12],octave:t}}(e);return t.includes("#")?`${t}${n}`:`${t}-${n}`}const mS=0,pS=1,hS=2,fS=3,gS="Synthesis",bS="Filter",vS="Envelope",yS="LFO",xS="Effects",NS="Modulation",wS="Sequencer",ES="Arpeggiator",kS="Mixer",DS="Output",SS=1313559366,MS=1313428297,CS=1313426241,VS=1347179847,PS="DEViLBOX",_S="devilbox-tracker-v1",OS=[{id:"tb303.cutoff",name:"Cutoff",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:74,isAutomatable:!0},{id:"tb303.resonance",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,ccNumber:71,isAutomatable:!0},{id:"tb303.envMod",name:"Env Mod",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,ccNumber:102,isAutomatable:!0},{id:"tb303.decay",name:"Decay",section:vS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,ccNumber:103,isAutomatable:!0},{id:"tb303.accent",name:"Accent",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,ccNumber:104,isAutomatable:!0},{id:"tb303.tuning",name:"Tuning",section:gS,type:mS,min:-1,max:1,defaultValue:0,unit:"semi",formatString:"%.1f",page:0,index:5,ccNumber:105,isAutomatable:!0},{id:"tb303.waveform",name:"Waveform",section:gS,type:fS,min:0,max:1,defaultValue:0,valueStrings:["Saw","Square"],page:0,index:6,ccNumber:106,isAutomatable:!0},{id:"tb303.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"dB",formatString:"%.1f",page:0,index:7,ccNumber:7,isAutomatable:!0},{id:"tb303.distortion",name:"Distortion",section:xS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:0,ccNumber:94,isAutomatable:!0},{id:"tb303.delay.time",name:"Delay Time",section:xS,type:mS,min:0,max:1,defaultValue:.375,unit:"ms",formatString:"%.0f",page:1,index:1,ccNumber:85,isAutomatable:!0},{id:"tb303.delay.feedback",name:"Delay Fdbk",section:xS,type:mS,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,ccNumber:86,isAutomatable:!0},{id:"tb303.delay.mix",name:"Delay Mix",section:xS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,ccNumber:87,isAutomatable:!0},{id:"tb303.reverb.size",name:"Reverb Size",section:xS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:4,ccNumber:91,isAutomatable:!0},{id:"tb303.reverb.mix",name:"Reverb Mix",section:xS,type:mS,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:5,ccNumber:92,isAutomatable:!0}],TS=[{id:"dexed.algorithm",name:"Algorithm",section:gS,type:pS,min:0,max:31,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"dexed.feedback",name:"Feedback",section:gS,type:pS,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"dexed.lfoSpeed",name:"LFO Speed",section:yS,type:pS,min:0,max:99,defaultValue:35,page:0,index:2,isAutomatable:!0},{id:"dexed.lfoPitchModDepth",name:"LFO Pitch",section:yS,type:pS,min:0,max:99,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"dexed.lfoAmpModDepth",name:"LFO Amp",section:yS,type:pS,min:0,max:99,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"dexed.lfoWave",name:"LFO Wave",section:yS,type:fS,min:0,max:5,defaultValue:0,valueStrings:["Triangle","Saw Down","Saw Up","Square","Sine","S&H"],page:0,index:5,isAutomatable:!0},{id:"dexed.transpose",name:"Transpose",section:gS,type:pS,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:6,isAutomatable:!0},{id:"dexed.oscSync",name:"Osc Sync",section:gS,type:hS,min:0,max:1,defaultValue:1,page:0,index:7,isAutomatable:!0},...function(){const e=[];for(let t=0;t<6;t++){const n=t+1;e.push({id:`dexed.op${t+1}.level`,name:`OP${t+1} Level`,section:gS,type:pS,min:0,max:99,defaultValue:0===t?99:0,page:n,index:0,isAutomatable:!0},{id:`dexed.op${t+1}.coarse`,name:`OP${t+1} Coarse`,section:gS,type:pS,min:0,max:31,defaultValue:1,page:n,index:1,isAutomatable:!0},{id:`dexed.op${t+1}.fine`,name:`OP${t+1} Fine`,section:gS,type:pS,min:0,max:99,defaultValue:0,page:n,index:2,isAutomatable:!0},{id:`dexed.op${t+1}.detune`,name:`OP${t+1} Detune`,section:gS,type:pS,min:0,max:14,defaultValue:7,page:n,index:3,isAutomatable:!0},{id:`dexed.op${t+1}.egRate1`,name:`OP${t+1} R1`,section:vS,type:pS,min:0,max:99,defaultValue:99,page:n,index:4,isAutomatable:!0},{id:`dexed.op${t+1}.egRate2`,name:`OP${t+1} R2`,section:vS,type:pS,min:0,max:99,defaultValue:99,page:n,index:5,isAutomatable:!0},{id:`dexed.op${t+1}.egRate3`,name:`OP${t+1} R3`,section:vS,type:pS,min:0,max:99,defaultValue:99,page:n,index:6,isAutomatable:!0},{id:`dexed.op${t+1}.egRate4`,name:`OP${t+1} R4`,section:vS,type:pS,min:0,max:99,defaultValue:99,page:n,index:7,isAutomatable:!0})}return e}()];const LS=[{id:"v2.osc1.mode",name:"Osc1 Mode",section:gS,type:fS,min:0,max:7,defaultValue:1,valueStrings:["Off","Saw/Tri","Pulse","Sin","Noise","XX","AuxA","AuxB"],page:0,index:0,isAutomatable:!0},{id:"v2.osc1.transpose",name:"Osc1 Trans",section:gS,type:pS,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:1,isAutomatable:!0},{id:"v2.osc1.color",name:"Osc1 Color",section:gS,type:pS,min:0,max:127,defaultValue:64,page:0,index:2,isAutomatable:!0},{id:"v2.osc1.level",name:"Osc1 Level",section:gS,type:pS,min:0,max:127,defaultValue:127,page:0,index:3,isAutomatable:!0},{id:"v2.osc2.mode",name:"Osc2 Mode",section:gS,type:fS,min:0,max:7,defaultValue:0,valueStrings:["!Off","Tri","Pulse","Sin","Noise","FM","AuxA","AuxB"],page:0,index:4,isAutomatable:!0},{id:"v2.osc2.transpose",name:"Osc2 Trans",section:gS,type:pS,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:5,isAutomatable:!0},{id:"v2.osc2.detune",name:"Osc2 Detune",section:gS,type:pS,min:-64,max:63,defaultValue:10,page:0,index:6,isAutomatable:!0},{id:"v2.osc2.level",name:"Osc2 Level",section:gS,type:pS,min:0,max:127,defaultValue:0,page:0,index:7,isAutomatable:!0},{id:"v2.filter1.mode",name:"Flt1 Mode",section:bS,type:fS,min:0,max:7,defaultValue:1,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:0,isAutomatable:!0},{id:"v2.filter1.cutoff",name:"Flt1 Cutoff",section:bS,type:pS,min:0,max:127,defaultValue:127,page:1,index:1,isAutomatable:!0},{id:"v2.filter1.resonance",name:"Flt1 Reso",section:bS,type:pS,min:0,max:127,defaultValue:0,page:1,index:2,isAutomatable:!0},{id:"v2.filter2.mode",name:"Flt2 Mode",section:bS,type:fS,min:0,max:7,defaultValue:0,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:3,isAutomatable:!0},{id:"v2.filter2.cutoff",name:"Flt2 Cutoff",section:bS,type:pS,min:0,max:127,defaultValue:127,page:1,index:4,isAutomatable:!0},{id:"v2.filter2.resonance",name:"Flt2 Reso",section:bS,type:pS,min:0,max:127,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"v2.routing.mode",name:"Routing",section:bS,type:fS,min:0,max:2,defaultValue:0,valueStrings:["Single","Serial","Parallel"],page:1,index:6,isAutomatable:!0},{id:"v2.routing.balance",name:"Balance",section:bS,type:pS,min:0,max:127,defaultValue:64,page:1,index:7,isAutomatable:!0},{id:"v2.envelope.attack",name:"Amp Attack",section:vS,type:pS,min:0,max:127,defaultValue:0,page:2,index:0,isAutomatable:!0},{id:"v2.envelope.decay",name:"Amp Decay",section:vS,type:pS,min:0,max:127,defaultValue:64,page:2,index:1,isAutomatable:!0},{id:"v2.envelope.sustain",name:"Amp Sustain",section:vS,type:pS,min:0,max:127,defaultValue:127,page:2,index:2,isAutomatable:!0},{id:"v2.envelope.release",name:"Amp Release",section:vS,type:pS,min:0,max:127,defaultValue:32,page:2,index:3,isAutomatable:!0},{id:"v2.envelope2.attack",name:"Env2 Attack",section:vS,type:pS,min:0,max:127,defaultValue:0,page:2,index:4,isAutomatable:!0},{id:"v2.envelope2.decay",name:"Env2 Decay",section:vS,type:pS,min:0,max:127,defaultValue:64,page:2,index:5,isAutomatable:!0},{id:"v2.lfo1.rate",name:"LFO Rate",section:yS,type:pS,min:0,max:127,defaultValue:64,page:2,index:6,isAutomatable:!0},{id:"v2.lfo1.depth",name:"LFO Depth",section:yS,type:pS,min:0,max:127,defaultValue:0,page:2,index:7,isAutomatable:!0}],AS=[{id:"monosynth.oscillator.type",name:"Waveform",section:gS,type:fS,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"monosynth.oscillator.detune",name:"Detune",section:gS,type:mS,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"monosynth.filter.frequency",name:"Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"monosynth.filter.Q",name:"Resonance",section:bS,type:mS,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"monosynth.filterEnvelope.amount",name:"Flt Env",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"monosynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"monosynth.envelope.decay",name:"Decay",section:vS,type:mS,min:0,max:2,defaultValue:.2,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"monosynth.envelope.sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"monosynth.envelope.release",name:"Release",section:vS,type:mS,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:1,index:0,isAutomatable:!0},{id:"monosynth.portamento",name:"Portamento",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"monosynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],BS=[{id:"polysynth.oscillator.type",name:"Waveform",section:gS,type:fS,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"polysynth.oscillator.detune",name:"Detune",section:gS,type:mS,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"polysynth.filter.frequency",name:"Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"polysynth.filter.Q",name:"Resonance",section:bS,type:mS,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"polysynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"polysynth.envelope.decay",name:"Decay",section:vS,type:mS,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"polysynth.envelope.sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"polysynth.envelope.release",name:"Release",section:vS,type:mS,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"polysynth.maxPolyphony",name:"Voices",section:gS,type:pS,min:1,max:32,defaultValue:8,page:1,index:0,isAutomatable:!0},{id:"polysynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0}],IS=[{id:"noisesynth.noise.type",name:"Noise Type",section:gS,type:fS,min:0,max:2,defaultValue:0,valueStrings:["White","Pink","Brown"],page:0,index:0,isAutomatable:!0},{id:"noisesynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:.005,unit:"s",formatString:"%.3f",page:0,index:1,isAutomatable:!0},{id:"noisesynth.envelope.decay",name:"Decay",section:vS,type:mS,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"noisesynth.envelope.sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"noisesynth.envelope.release",name:"Release",section:vS,type:mS,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"noisesynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],FS=[{id:"sampler.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:0,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"sampler.release",name:"Release",section:vS,type:mS,min:0,max:5,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"sampler.baseUrl",name:"Sample",section:gS,type:fS,min:0,max:0,defaultValue:0,page:0,index:2,isAutomatable:!1},{id:"sampler.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0}],US=[{id:"drummachine.kick.tune",name:"Kick Tune",section:gS,type:mS,min:20,max:200,defaultValue:60,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"drummachine.kick.decay",name:"Kick Decay",section:vS,type:mS,min:.05,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"drummachine.snare.tune",name:"Snare Tune",section:gS,type:mS,min:100,max:400,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"drummachine.snare.snappy",name:"Snare Snap",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"drummachine.hihat.decay",name:"HiHat Decay",section:vS,type:mS,min:.01,max:1,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"drummachine.tone",name:"Tone",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"drummachine.accent",name:"Accent",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"drummachine.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],RS=[{id:"furnace.algorithm",name:"Algorithm",section:gS,type:pS,min:0,max:7,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"furnace.feedback",name:"Feedback",section:gS,type:pS,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"furnace.op1.level",name:"OP1 Level",section:gS,type:pS,min:0,max:127,defaultValue:99,page:0,index:2,isAutomatable:!0},{id:"furnace.op1.mult",name:"OP1 Mult",section:gS,type:pS,min:0,max:15,defaultValue:1,page:0,index:3,isAutomatable:!0},{id:"furnace.op2.level",name:"OP2 Level",section:gS,type:pS,min:0,max:127,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.op2.mult",name:"OP2 Mult",section:gS,type:pS,min:0,max:15,defaultValue:1,page:0,index:5,isAutomatable:!0},{id:"furnace.lfoRate",name:"LFO Rate",section:yS,type:pS,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],jS=[{id:"furnace.duty",name:"Duty Cycle",section:gS,type:fS,min:0,max:3,defaultValue:2,valueStrings:["12.5%","25%","50%","75%"],page:0,index:0,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:DS,type:pS,min:0,max:15,defaultValue:15,page:0,index:1,isAutomatable:!0},{id:"furnace.arpSpeed",name:"Arp Speed",section:ES,type:pS,min:0,max:15,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"furnace.pitchSlide",name:"Pitch Slide",section:NS,type:pS,min:-127,max:127,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"furnace.vibrato",name:"Vibrato",section:yS,type:pS,min:0,max:15,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.noise",name:"Noise",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"furnace.envelope",name:"Env Mode",section:vS,type:pS,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0}],XS=[{id:"buzzm3.osc1Wave",name:"Osc1 Wave",section:gS,type:fS,min:0,max:5,defaultValue:1,valueStrings:["Off","Saw","Pulse","Tri","Sin","Noise"],page:0,index:0,isAutomatable:!0},{id:"buzzm3.osc1PW",name:"Osc1 PW",section:gS,type:pS,min:0,max:127,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzzm3.osc2Wave",name:"Osc2 Wave",section:gS,type:fS,min:0,max:5,defaultValue:0,valueStrings:["Off","Saw","Pulse","Tri","Sin","Noise"],page:0,index:2,isAutomatable:!0},{id:"buzzm3.mix",name:"Osc Mix",section:gS,type:pS,min:0,max:127,defaultValue:64,page:0,index:3,isAutomatable:!0},{id:"buzzm3.filterCutoff",name:"Cutoff",section:bS,type:pS,min:0,max:127,defaultValue:100,page:0,index:4,isAutomatable:!0},{id:"buzzm3.filterReso",name:"Resonance",section:bS,type:pS,min:0,max:127,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"buzzm3.ampAttack",name:"Attack",section:vS,type:pS,min:0,max:127,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"buzzm3.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],zS=[{id:"generic.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:7,isAutomatable:!0},{id:"generic.pan",name:"Pan",section:DS,type:mS,min:-1,max:1,defaultValue:0,formatString:"%.2f",page:0,index:1,ccNumber:10,isAutomatable:!0}],GS={TB303:OS,Dexed:TS,OBXd:[{id:"obxd.osc1Waveform",name:"Osc1 Wave",section:gS,type:fS,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"obxd.osc1Octave",name:"Osc1 Oct",section:gS,type:pS,min:-2,max:2,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"obxd.osc1PulseWidth",name:"Osc1 PW",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"obxd.osc1Level",name:"Osc1 Level",section:gS,type:mS,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"obxd.osc2Waveform",name:"Osc2 Wave",section:gS,type:fS,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:4,isAutomatable:!0},{id:"obxd.osc2Octave",name:"Osc2 Oct",section:gS,type:pS,min:-2,max:2,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"obxd.osc2Detune",name:"Osc2 Detune",section:gS,type:mS,min:-1,max:1,defaultValue:.1,unit:"semi",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"obxd.osc2Level",name:"Osc2 Level",section:gS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"obxd.filterCutoff",name:"Cutoff",section:bS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:0,isAutomatable:!0},{id:"obxd.filterResonance",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"obxd.filterEnvAmount",name:"Env Amount",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"obxd.filterKeyTrack",name:"Key Track",section:bS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"obxd.filterAttack",name:"Flt Attack",section:vS,type:mS,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:1,index:4,isAutomatable:!0},{id:"obxd.filterDecay",name:"Flt Decay",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:5,isAutomatable:!0},{id:"obxd.filterSustain",name:"Flt Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"obxd.filterRelease",name:"Flt Release",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:7,isAutomatable:!0},{id:"obxd.ampAttack",name:"Amp Attack",section:vS,type:mS,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:2,index:0,isAutomatable:!0},{id:"obxd.ampDecay",name:"Amp Decay",section:vS,type:mS,min:0,max:1,defaultValue:.2,unit:"s",formatString:"%.2f",page:2,index:1,isAutomatable:!0},{id:"obxd.ampSustain",name:"Amp Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:2,isAutomatable:!0},{id:"obxd.ampRelease",name:"Amp Release",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:2,index:3,isAutomatable:!0},{id:"obxd.masterVolume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:4,isAutomatable:!0},{id:"obxd.portamento",name:"Portamento",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:2,index:5,isAutomatable:!0},{id:"obxd.unison",name:"Unison",section:gS,type:hS,min:0,max:1,defaultValue:0,page:2,index:6,isAutomatable:!0},{id:"obxd.unisonDetune",name:"Uni Detune",section:gS,type:mS,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:2,index:7,isAutomatable:!0},{id:"obxd.lfoRate",name:"LFO Rate",section:yS,type:mS,min:0,max:1,defaultValue:.2,unit:"Hz",formatString:"%.1f",page:3,index:0,isAutomatable:!0},{id:"obxd.lfoWaveform",name:"LFO Wave",section:yS,type:fS,min:0,max:4,defaultValue:0,valueStrings:["Sine","Triangle","Saw","Square","S&H"],page:3,index:1,isAutomatable:!0},{id:"obxd.lfoOscAmount",name:"LFO>Pitch",section:yS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:2,isAutomatable:!0},{id:"obxd.lfoFilterAmount",name:"LFO>Filter",section:yS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:3,isAutomatable:!0},{id:"obxd.lfoAmpAmount",name:"LFO>Amp",section:yS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:4,isAutomatable:!0},{id:"obxd.lfoPwAmount",name:"LFO>PW",section:yS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:5,isAutomatable:!0},{id:"obxd.oscSync",name:"Osc Sync",section:gS,type:hS,min:0,max:1,defaultValue:0,page:3,index:6,isAutomatable:!0},{id:"obxd.oscXor",name:"Ring Mod",section:gS,type:hS,min:0,max:1,defaultValue:0,page:3,index:7,isAutomatable:!0}],DubSiren:[{id:"dubsiren.oscillator.type",name:"Osc Type",section:gS,type:fS,min:0,max:3,defaultValue:0,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:0,isAutomatable:!0},{id:"dubsiren.oscillator.frequency",name:"Frequency",section:gS,type:mS,min:60,max:1e3,defaultValue:440,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"dubsiren.lfo.enabled",name:"LFO On",section:yS,type:hS,min:0,max:1,defaultValue:1,page:0,index:2,isAutomatable:!0},{id:"dubsiren.lfo.type",name:"LFO Type",section:yS,type:fS,min:0,max:3,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:3,isAutomatable:!0},{id:"dubsiren.lfo.rate",name:"LFO Rate",section:yS,type:mS,min:0,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"dubsiren.lfo.depth",name:"LFO Depth",section:yS,type:mS,min:0,max:1e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"dubsiren.filter.enabled",name:"Filter On",section:bS,type:hS,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"dubsiren.filter.frequency",name:"Filter Freq",section:bS,type:mS,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"dubsiren.delay.enabled",name:"Delay On",section:xS,type:hS,min:0,max:1,defaultValue:1,page:1,index:0,isAutomatable:!0},{id:"dubsiren.delay.time",name:"Delay Time",section:xS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"dubsiren.delay.feedback",name:"Delay Fdbk",section:xS,type:mS,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"dubsiren.delay.wet",name:"Delay Mix",section:xS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"dubsiren.reverb.enabled",name:"Reverb On",section:xS,type:hS,min:0,max:1,defaultValue:1,page:1,index:4,isAutomatable:!0},{id:"dubsiren.reverb.decay",name:"Reverb Dec",section:xS,type:mS,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"dubsiren.reverb.wet",name:"Reverb Mix",section:xS,type:mS,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],SpaceLaser:[{id:"spacelaser.laser.startFreq",name:"Start Freq",section:gS,type:mS,min:100,max:1e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"spacelaser.laser.endFreq",name:"End Freq",section:gS,type:mS,min:20,max:2e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"spacelaser.laser.sweepTime",name:"Sweep Time",section:vS,type:mS,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"spacelaser.laser.sweepCurve",name:"Curve",section:vS,type:fS,min:0,max:1,defaultValue:0,valueStrings:["Exp","Linear"],page:0,index:3,isAutomatable:!0},{id:"spacelaser.fm.amount",name:"FM Amount",section:NS,type:mS,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"spacelaser.fm.ratio",name:"FM Ratio",section:NS,type:mS,min:.5,max:16,defaultValue:1,formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"spacelaser.noise.amount",name:"Noise",section:gS,type:mS,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"spacelaser.filter.cutoff",name:"Filter",section:bS,type:mS,min:20,max:2e4,defaultValue:2e4,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"spacelaser.delay.enabled",name:"Delay On",section:xS,type:hS,min:0,max:1,defaultValue:0,page:1,index:0,isAutomatable:!0},{id:"spacelaser.delay.time",name:"Delay Time",section:xS,type:mS,min:0,max:1,defaultValue:.25,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"spacelaser.delay.feedback",name:"Delay Fdbk",section:xS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"spacelaser.delay.wet",name:"Delay Mix",section:xS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"spacelaser.reverb.enabled",name:"Reverb On",section:xS,type:hS,min:0,max:1,defaultValue:0,page:1,index:4,isAutomatable:!0},{id:"spacelaser.reverb.decay",name:"Reverb Dec",section:xS,type:mS,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"spacelaser.reverb.wet",name:"Reverb Mix",section:xS,type:mS,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],Synare:[{id:"synare.oscillator.tune",name:"Tune",section:gS,type:mS,min:20,max:1e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"synare.oscillator.fine",name:"Fine Tune",section:gS,type:mS,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"synare.oscillator2.enabled",name:"Osc2 On",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"synare.oscillator2.detune",name:"Osc2 Detune",section:gS,type:mS,min:-24,max:24,defaultValue:7,unit:"semi",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"synare.filter.cutoff",name:"Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"synare.filter.resonance",name:"Resonance",section:bS,type:mS,min:0,max:100,defaultValue:20,unit:"%",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"synare.filter.envMod",name:"Flt Env",section:bS,type:mS,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"synare.filter.decay",name:"Flt Decay",section:vS,type:mS,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"synare.envelope.decay",name:"Amp Decay",section:vS,type:mS,min:10,max:2e3,defaultValue:300,unit:"ms",formatString:"%.0f",page:1,index:0,isAutomatable:!0},{id:"synare.envelope.sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"synare.sweep.enabled",name:"Sweep On",section:NS,type:hS,min:0,max:1,defaultValue:1,page:1,index:2,isAutomatable:!0},{id:"synare.sweep.amount",name:"Sweep Amt",section:NS,type:mS,min:0,max:48,defaultValue:12,unit:"semi",formatString:"%.0f",page:1,index:3,isAutomatable:!0},{id:"synare.sweep.time",name:"Sweep Time",section:NS,type:mS,min:1,max:500,defaultValue:50,unit:"ms",formatString:"%.0f",page:1,index:4,isAutomatable:!0},{id:"synare.noise.enabled",name:"Noise On",section:gS,type:hS,min:0,max:1,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"synare.noise.mix",name:"Noise Mix",section:gS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"synare.noise.color",name:"Noise Color",section:gS,type:mS,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:1,index:7,isAutomatable:!0}],V2:LS,Sam:[{id:"sam.speed",name:"Speed",section:gS,type:pS,min:20,max:200,defaultValue:72,page:0,index:0,isAutomatable:!0},{id:"sam.pitch",name:"Pitch",section:gS,type:pS,min:20,max:200,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"sam.mouth",name:"Mouth",section:gS,type:pS,min:0,max:255,defaultValue:128,page:0,index:2,isAutomatable:!0},{id:"sam.throat",name:"Throat",section:gS,type:pS,min:0,max:255,defaultValue:128,page:0,index:3,isAutomatable:!0},{id:"sam.singMode",name:"Sing Mode",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"sam.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],MonoSynth:AS,DuoSynth:[{id:"duosynth.voice0.oscillator.type",name:"V0 Wave",section:gS,type:fS,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"duosynth.voice0.filter.frequency",name:"V0 Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"duosynth.voice0.filter.Q",name:"V0 Reso",section:bS,type:mS,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:2,isAutomatable:!0},{id:"duosynth.voice0.envelope.attack",name:"V0 Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"duosynth.voice1.oscillator.type",name:"V1 Wave",section:gS,type:fS,min:0,max:4,defaultValue:2,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:4,isAutomatable:!0},{id:"duosynth.voice1.filter.frequency",name:"V1 Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"duosynth.voice1.filter.Q",name:"V1 Reso",section:bS,type:mS,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:6,isAutomatable:!0},{id:"duosynth.harmonicity",name:"Harmonicity",section:gS,type:mS,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"duosynth.vibratoRate",name:"Vib Rate",section:yS,type:mS,min:0,max:20,defaultValue:5,unit:"Hz",formatString:"%.1f",page:1,index:0,isAutomatable:!0},{id:"duosynth.vibratoAmount",name:"Vib Amount",section:yS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"duosynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],PolySynth:BS,Synth:BS,FMSynth:[{id:"fmsynth.modulationIndex",name:"Mod Index",section:NS,type:mS,min:0,max:100,defaultValue:10,formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"fmsynth.harmonicity",name:"Harmonicity",section:gS,type:mS,min:.5,max:8,defaultValue:1,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.attack",name:"Mod Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.decay",name:"Mod Decay",section:vS,type:mS,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.sustain",name:"Mod Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"fmsynth.envelope.attack",name:"Amp Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"fmsynth.envelope.decay",name:"Amp Decay",section:vS,type:mS,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"fmsynth.envelope.sustain",name:"Amp Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],AMSynth:[{id:"amsynth.harmonicity",name:"Harmonicity",section:gS,type:mS,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"amsynth.modulationEnvelope.attack",name:"Mod Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"amsynth.modulationEnvelope.decay",name:"Mod Decay",section:vS,type:mS,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"amsynth.envelope.attack",name:"Amp Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"amsynth.envelope.decay",name:"Amp Decay",section:vS,type:mS,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"amsynth.envelope.sustain",name:"Amp Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"amsynth.envelope.release",name:"Amp Release",section:vS,type:mS,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"amsynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MembraneSynth:[{id:"membranesynth.pitchDecay",name:"Pitch Decay",section:vS,type:mS,min:0,max:.5,defaultValue:.05,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"membranesynth.octaves",name:"Octaves",section:gS,type:mS,min:.5,max:8,defaultValue:4,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"membranesynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:2,isAutomatable:!0},{id:"membranesynth.envelope.decay",name:"Decay",section:vS,type:mS,min:.01,max:2,defaultValue:.4,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"membranesynth.envelope.sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.01,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"membranesynth.envelope.release",name:"Release",section:vS,type:mS,min:.01,max:2,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"membranesynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}],MetalSynth:[{id:"metalsynth.frequency",name:"Frequency",section:gS,type:mS,min:20,max:8e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"metalsynth.harmonicity",name:"Harmonicity",section:gS,type:mS,min:1,max:10,defaultValue:5.1,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"metalsynth.modulationIndex",name:"Mod Index",section:NS,type:mS,min:0,max:100,defaultValue:32,formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"metalsynth.resonance",name:"Resonance",section:gS,type:mS,min:0,max:7e3,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"metalsynth.octaves",name:"Octaves",section:gS,type:mS,min:.5,max:4,defaultValue:1.5,formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"metalsynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:5,isAutomatable:!0},{id:"metalsynth.envelope.decay",name:"Decay",section:vS,type:mS,min:.01,max:4,defaultValue:1.4,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"metalsynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],NoiseSynth:IS,PluckSynth:[{id:"plucksynth.attackNoise",name:"Attack Noise",section:gS,type:mS,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"plucksynth.resonance",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:.9,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"plucksynth.dampening",name:"Dampening",section:bS,type:mS,min:1e3,max:1e4,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"plucksynth.release",name:"Release",section:vS,type:mS,min:.1,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"plucksynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0}],Sampler:FS,Player:FS,SuperSaw:[{id:"supersaw.detune",name:"Detune",section:gS,type:mS,min:0,max:100,defaultValue:30,unit:"ct",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"supersaw.mix",name:"Mix",section:gS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"supersaw.voices",name:"Voices",section:gS,type:pS,min:1,max:7,defaultValue:7,page:0,index:2,isAutomatable:!0},{id:"supersaw.filter.cutoff",name:"Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:8e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"supersaw.filter.resonance",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"supersaw.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"supersaw.envelope.release",name:"Release",section:vS,type:mS,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"supersaw.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Organ:[{id:"organ.drawbar1",name:"16'",section:gS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"organ.drawbar2",name:"5 1/3'",section:gS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"organ.drawbar3",name:"8'",section:gS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"organ.drawbar4",name:"4'",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"organ.drawbar5",name:"2 2/3'",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"organ.drawbar6",name:"2'",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"organ.percussion",name:"Percussion",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"organ.vibrato",name:"Vibrato",section:yS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],DrumMachine:US,ChipSynth:[{id:"chipsynth.waveform",name:"Waveform",section:gS,type:fS,min:0,max:4,defaultValue:1,valueStrings:["Square","Pulse25","Pulse12","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"chipsynth.duty",name:"Duty",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"chipsynth.pitchBend",name:"Pitch Bend",section:gS,type:pS,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:2,isAutomatable:!0},{id:"chipsynth.vibrato",name:"Vibrato",section:yS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"chipsynth.arpSpeed",name:"Arp Speed",section:ES,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"chipsynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"chipsynth.envelope.decay",name:"Decay",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"chipsynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],PWMSynth:[{id:"pwmsynth.pulseWidth",name:"Pulse Width",section:gS,type:mS,min:.01,max:.99,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"pwmsynth.lfo.rate",name:"LFO Rate",section:yS,type:mS,min:.1,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"pwmsynth.lfo.depth",name:"LFO Depth",section:yS,type:mS,min:0,max:.49,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"pwmsynth.filter.cutoff",name:"Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"pwmsynth.filter.resonance",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"pwmsynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"pwmsynth.envelope.release",name:"Release",section:vS,type:mS,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"pwmsynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],WobbleBass:[{id:"wobblebass.lfo.rate",name:"Wobble Rate",section:yS,type:mS,min:.1,max:20,defaultValue:4,unit:"Hz",formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"wobblebass.lfo.depth",name:"Wobble Depth",section:yS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"wobblebass.filter.cutoff",name:"Cutoff",section:bS,type:mS,min:20,max:5e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wobblebass.filter.resonance",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:.6,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wobblebass.distortion",name:"Distortion",section:xS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"wobblebass.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wobblebass.envelope.release",name:"Release",section:vS,type:mS,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"wobblebass.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],StringMachine:[{id:"stringmachine.ensemble",name:"Ensemble",section:xS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"stringmachine.detune",name:"Detune",section:gS,type:mS,min:0,max:50,defaultValue:15,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"stringmachine.voices",name:"Voices",section:gS,type:pS,min:2,max:8,defaultValue:4,page:0,index:2,isAutomatable:!0},{id:"stringmachine.filter.cutoff",name:"Cutoff",section:bS,type:mS,min:20,max:1e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"stringmachine.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:3,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"stringmachine.envelope.release",name:"Release",section:vS,type:mS,min:0,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"stringmachine.chorus",name:"Chorus",section:xS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"stringmachine.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],FormantSynth:[{id:"formantsynth.vowel",name:"Vowel",section:gS,type:fS,min:0,max:4,defaultValue:0,valueStrings:["A","E","I","O","U"],page:0,index:0,isAutomatable:!0},{id:"formantsynth.formant1",name:"Formant 1",section:bS,type:mS,min:200,max:2e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"formantsynth.formant2",name:"Formant 2",section:bS,type:mS,min:500,max:4e3,defaultValue:1200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"formantsynth.nasality",name:"Nasality",section:gS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"formantsynth.vibrato",name:"Vibrato",section:yS,type:mS,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"formantsynth.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"formantsynth.envelope.release",name:"Release",section:vS,type:mS,min:0,max:3,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"formantsynth.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],GranularSynth:[{id:"granular.grainSize",name:"Grain Size",section:gS,type:mS,min:.01,max:.5,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"granular.overlap",name:"Overlap",section:gS,type:mS,min:.1,max:2,defaultValue:.5,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"granular.playbackRate",name:"Speed",section:gS,type:mS,min:.25,max:4,defaultValue:1,formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"granular.detune",name:"Detune",section:gS,type:pS,min:-1200,max:1200,defaultValue:0,unit:"ct",page:0,index:3,isAutomatable:!0},{id:"granular.drift",name:"Drift",section:NS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"granular.reverse",name:"Reverse",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"granular.loop",name:"Loop",section:gS,type:hS,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"granular.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Wavetable:[{id:"wavetable.tablePosition",name:"Position",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"wavetable.morphSpeed",name:"Morph Speed",section:NS,type:mS,min:0,max:10,defaultValue:0,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"wavetable.filter.cutoff",name:"Cutoff",section:bS,type:mS,min:20,max:2e4,defaultValue:1e4,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wavetable.filter.resonance",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wavetable.envelope.attack",name:"Attack",section:vS,type:mS,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"wavetable.envelope.decay",name:"Decay",section:vS,type:mS,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wavetable.envelope.sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"wavetable.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Buzz3o3:OS,BuzzM3:XS,Buzz4FM2F:RS,BuzzDynamite6:[{id:"buzzdyn6.coarseTune",name:"Coarse",section:gS,type:pS,min:1,max:255,defaultValue:128,page:0,index:0,isAutomatable:!0},{id:"buzzdyn6.pipe1Len",name:"Pipe 1 Len",section:gS,type:pS,min:0,max:255,defaultValue:128,page:0,index:1,isAutomatable:!0},{id:"buzzdyn6.pipe1Fdbk",name:"Pipe 1 FB",section:gS,type:pS,min:0,max:255,defaultValue:128,page:0,index:2,isAutomatable:!0},{id:"buzzdyn6.pipe1Filter",name:"Pipe 1 Flt",section:bS,type:pS,min:0,max:255,defaultValue:128,page:0,index:3,isAutomatable:!0},{id:"buzzdyn6.envAttack",name:"Attack",section:vS,type:pS,min:0,max:254,defaultValue:4,page:0,index:4,isAutomatable:!0},{id:"buzzdyn6.envDecay",name:"Decay",section:vS,type:pS,min:1,max:255,defaultValue:255,page:0,index:5,isAutomatable:!0},{id:"buzzdyn6.routing",name:"Routing",section:gS,type:pS,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"buzzdyn6.amplification",name:"Amplify",section:DS,type:pS,min:1,max:255,defaultValue:32,page:0,index:7,isAutomatable:!0}],BuzzKick:[{id:"buzzkick.startFreq",name:"Start Freq",section:gS,type:pS,min:1,max:240,defaultValue:198,page:0,index:0,isAutomatable:!0},{id:"buzzkick.endFreq",name:"End Freq",section:gS,type:pS,min:1,max:240,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzzkick.toneDecay",name:"Tone Decay",section:vS,type:pS,min:1,max:240,defaultValue:46,page:0,index:2,isAutomatable:!0},{id:"buzzkick.toneShape",name:"Tone Shape",section:vS,type:pS,min:1,max:240,defaultValue:27,page:0,index:3,isAutomatable:!0},{id:"buzzkick.ampDecay",name:"Amp Decay",section:vS,type:pS,min:1,max:240,defaultValue:55,page:0,index:4,isAutomatable:!0},{id:"buzzkick.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],BuzzKickXP:[{id:"buzzkickxp.startFreq",name:"Start Freq",section:gS,type:pS,min:1,max:240,defaultValue:198,page:0,index:0,isAutomatable:!0},{id:"buzzkickxp.endFreq",name:"End Freq",section:gS,type:pS,min:1,max:240,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzzkickxp.buzzAmt",name:"Buzz",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"buzzkickxp.clickAmt",name:"Click",section:gS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"buzzkickxp.punchAmt",name:"Punch",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"buzzkickxp.toneDecay",name:"Tone Decay",section:vS,type:mS,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"buzzkickxp.decayTime",name:"Decay Time",section:vS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"buzzkickxp.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],BuzzTrilok:[{id:"buzztrilok.tone",name:"BD Tone",section:gS,type:pS,min:0,max:127,defaultValue:64,page:0,index:0,isAutomatable:!0},{id:"buzztrilok.decay",name:"BD Decay",section:vS,type:pS,min:0,max:127,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzztrilok.volume",name:"BD Volume",section:DS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0}],BuzzNoise:IS,BuzzFreqBomb:[{id:"buzzfreqbomb.freq",name:"Frequency",section:gS,type:mS,min:.01,max:655,defaultValue:50,unit:"Hz",formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"buzzfreqbomb.waveform",name:"Waveform",section:gS,type:fS,min:0,max:4,defaultValue:0,valueStrings:["Sine","Saw","Square","Triangle","Noise"],page:0,index:1,isAutomatable:!0},{id:"buzzfreqbomb.wavePower",name:"Wave Power",section:gS,type:pS,min:1,max:13,defaultValue:1,page:0,index:2,isAutomatable:!0},{id:"buzzfreqbomb.lfoRate",name:"LFO Rate",section:yS,type:mS,min:.01,max:655,defaultValue:10,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"buzzfreqbomb.lfoAmount",name:"LFO Amount",section:yS,type:mS,min:0,max:65,defaultValue:0,unit:"Hz",formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"buzzfreqbomb.freqAttack",name:"Freq Attack",section:vS,type:mS,min:0,max:655,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"buzzfreqbomb.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}],BuzzDTMF:[{id:"buzzdtmf.dialNumber",name:"Dial #",section:gS,type:pS,min:0,max:11,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"buzzdtmf.sustain",name:"Sustain",section:vS,type:pS,min:0,max:254,defaultValue:40,page:0,index:1,isAutomatable:!0},{id:"buzzdtmf.twist",name:"Twist",section:gS,type:pS,min:0,max:40,defaultValue:0,unit:"dB",page:0,index:2,isAutomatable:!0},{id:"buzzdtmf.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.75,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0}],Buzzmachine:XS,Furnace:RS,FurnaceOPN:RS,FurnaceOPN2203:RS,FurnaceOPNA:RS,FurnaceOPNB:RS,FurnaceOPNBB:RS,FurnaceOPM:RS,FurnaceOPL:RS,FurnaceOPLL:RS,FurnaceOPL4:RS,FurnaceOPZ:RS,FurnaceY8950:RS,FurnaceESFM:RS,FurnaceVRC7:RS,FurnaceNES:jS,FurnaceGB:jS,FurnacePSG:jS,FurnacePCE:jS,FurnaceSNES:jS,FurnaceVB:jS,FurnaceLynx:jS,FurnaceSWAN:jS,FurnaceNDS:jS,FurnaceGBA:jS,FurnacePOKEMINI:jS,FurnaceVRC6:jS,FurnaceN163:jS,FurnaceFDS:jS,FurnaceMMC5:jS,FurnaceC64:jS,FurnaceSID6581:jS,FurnaceSID8580:jS,FurnaceAY:jS,FurnaceAY8930:jS,FurnaceVIC:jS,FurnacePET:jS,FurnaceSAA:jS,FurnaceTED:jS,FurnaceDAVE:jS,FurnaceVERA:jS,FurnaceSCC:jS,FurnaceTIA:jS,FurnacePOKEY:jS,FurnaceZXBEEPER:jS,FurnaceAMIGA:jS,FurnacePCSPKR:jS,FurnaceSEGAPCM:FS,FurnaceQSOUND:FS,FurnaceES5506:FS,FurnaceRF5C68:FS,FurnaceC140:FS,FurnaceK007232:FS,FurnaceK053260:FS,FurnaceGA20:FS,FurnaceOKI:FS,FurnaceYMZ280B:FS,FurnaceX1_010:FS,FurnaceBUBBLE:FS,FurnaceMULTIPCM:FS,FurnaceMSM6258:FS,FurnaceMSM5232:FS,FurnaceNAMCO:jS,FurnaceSM8521:jS,FurnaceT6W28:jS,FurnaceSUPERVISION:jS,FurnaceUPD1771:jS,FurnacePONG:jS,FurnacePV1000:jS,FurnaceSU:jS,FurnacePOWERNOISE:IS,FurnaceSCVTONE:jS,FurnacePCMDAC:FS,V2Speech:LS,Buzz3o3DF:OS,BuzzM4:[{id:"buzzm4.osc1Wave",name:"Osc1 Wave",section:gS,type:pS,min:0,max:99,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"buzzm4.osc2Wave",name:"Osc2 Wave",section:gS,type:pS,min:0,max:99,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"buzzm4.oscMix",name:"Osc Mix",section:gS,type:pS,min:0,max:127,defaultValue:64,page:0,index:2,isAutomatable:!0},{id:"buzzm4.filterCutoff",name:"Cutoff",section:bS,type:pS,min:0,max:127,defaultValue:100,page:0,index:3,isAutomatable:!0},{id:"buzzm4.filterReso",name:"Resonance",section:bS,type:pS,min:0,max:127,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"buzzm4.ampAttack",name:"Attack",section:vS,type:pS,min:0,max:127,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"buzzm4.ampRelease",name:"Release",section:vS,type:pS,min:0,max:127,defaultValue:30,page:0,index:6,isAutomatable:!0},{id:"buzzm4.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],DexedBridge:TS,TonewheelOrgan:[{id:"tonewheel.drawbar16",name:"16'",section:gS,type:pS,min:0,max:8,defaultValue:8,page:0,index:0,isAutomatable:!0},{id:"tonewheel.drawbar8",name:"8'",section:gS,type:pS,min:0,max:8,defaultValue:8,page:0,index:1,isAutomatable:!0},{id:"tonewheel.drawbar4",name:"4'",section:gS,type:pS,min:0,max:8,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"tonewheel.percMode",name:"Perc Mode",section:gS,type:fS,min:0,max:2,defaultValue:0,valueStrings:["Off","2nd","3rd"],page:0,index:3,isAutomatable:!0},{id:"tonewheel.vibratoType",name:"Vib Type",section:yS,type:fS,min:0,max:5,defaultValue:0,valueStrings:["V1","V2","V3","C1","C2","C3"],page:0,index:4,isAutomatable:!0},{id:"tonewheel.click",name:"Click",section:gS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"tonewheel.overdrive",name:"Overdrive",section:xS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"tonewheel.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Melodica:[{id:"melodica.breath",name:"Breath",section:gS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"melodica.brightness",name:"Brightness",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"melodica.vibratoRate",name:"Vib Rate",section:yS,type:mS,min:0,max:10,defaultValue:4,unit:"Hz",formatString:"%.1f",page:0,index:2,isAutomatable:!0},{id:"melodica.vibratoDepth",name:"Vib Depth",section:yS,type:mS,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"melodica.detune",name:"Detune",section:gS,type:mS,min:-50,max:50,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"melodica.noise",name:"Noise",section:gS,type:mS,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"melodica.portamento",name:"Portamento",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"melodica.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Vital:[{id:"vital.osc1WaveFrame",name:"Osc1 Wave",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"vital.filter1Cutoff",name:"Cutoff",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"vital.filter1Reso",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"vital.env1Attack",name:"Attack",section:vS,type:mS,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"vital.env1Decay",name:"Decay",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"vital.env1Sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"vital.env1Release",name:"Release",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"vital.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Odin2:[{id:"odin2.osc1Type",name:"Osc1 Type",section:gS,type:pS,min:0,max:11,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"odin2.filter1Freq",name:"Flt Freq",section:bS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"odin2.filter1Reso",name:"Flt Reso",section:bS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"odin2.env1Attack",name:"Attack",section:vS,type:mS,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"odin2.env1Decay",name:"Decay",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"odin2.env1Sustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"odin2.env1Release",name:"Release",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"odin2.masterVol",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Surge:[{id:"surge.osc1Type",name:"Osc Type",section:gS,type:pS,min:0,max:11,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"surge.filterCutoff",name:"Cutoff",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"surge.filterReso",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"surge.envAttack",name:"Attack",section:vS,type:mS,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"surge.envDecay",name:"Decay",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"surge.envSustain",name:"Sustain",section:vS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"surge.envRelease",name:"Release",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"surge.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Monique:[{id:"monique.osc1Wave",name:"Osc1 Wave",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"monique.filter1Cutoff",name:"Cutoff",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"monique.filter1Reso",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"monique.filter1Dist",name:"Distortion",section:bS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"monique.envAttack",name:"Attack",section:vS,type:mS,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"monique.envRelease",name:"Release",section:vS,type:mS,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"monique.glide",name:"Glide",section:gS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"monique.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],WAM:zS,DrumKit:US,ChiptuneModule:FS,CEM3394:[{id:"cem3394.waveSelect",name:"Waveform",section:gS,type:fS,min:0,max:7,defaultValue:2,valueStrings:["Off","Tri","Saw","Tri+Saw","Pulse","Tri+Pls","Saw+Pls","All"],page:0,index:0,isAutomatable:!0},{id:"cem3394.pulseWidth",name:"Pulse Wid",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"cem3394.filterCutoff",name:"Cutoff",section:bS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"cem3394.filterReso",name:"Resonance",section:bS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"cem3394.modAmount",name:"Filter FM",section:NS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"cem3394.mixerBalance",name:"Mix Bal",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"cem3394.vcoFreq",name:"VCO Freq",section:gS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"cem3394.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],SCSP:RS,MAMEVFX:RS,MAMEDOC:RS,MAMERSA:BS,MAMESWP30:RS,CZ101:RS,MAMEYMF271:RS,MAMEYMOPQ:RS,MAMEVASynth:AS,MAMEAICA:FS,MAMEC352:FS,MAMEES5503:FS,MAMEICS2115:FS,MAMEK054539:FS,MAMERF5C400:FS,MAMETR707:US,MAMESNKWave:jS,MAMEASC:jS,MAMEAstrocade:jS,MAMESN76477:IS,MAMETIA:jS,MAMETMS36XX:jS,MAMEMSM5232:jS,MAMEMEA8000:[{id:"mea8000.noiseMode",name:"Noise Mode",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"mea8000.f1Index",name:"F1 Formant",section:bS,type:pS,min:0,max:7,defaultValue:3,page:0,index:1,isAutomatable:!0},{id:"mea8000.f2Index",name:"F2 Formant",section:bS,type:pS,min:0,max:7,defaultValue:4,page:0,index:2,isAutomatable:!0},{id:"mea8000.f3Index",name:"F3 Formant",section:bS,type:pS,min:0,max:7,defaultValue:5,page:0,index:3,isAutomatable:!0},{id:"mea8000.bwIndex",name:"Bandwidth",section:bS,type:fS,min:0,max:3,defaultValue:0,valueStrings:["Wide","Medium","Narrow","V.Narrow"],page:0,index:4,isAutomatable:!0},{id:"mea8000.amplitude",name:"Amplitude",section:gS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"mea8000.interpTime",name:"Interp Time",section:NS,type:mS,min:.1,max:10,defaultValue:1,formatString:"%.1f",page:0,index:6,isAutomatable:!0},{id:"mea8000.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMESP0250:[{id:"sp0250.vowel",name:"Vowel",section:gS,type:fS,min:0,max:7,defaultValue:0,valueStrings:["AH","EE","IH","OH","OO","NN","ZZ","HH"],page:0,index:0,isAutomatable:!0},{id:"sp0250.voiced",name:"Voiced",section:gS,type:hS,min:0,max:1,defaultValue:1,page:0,index:1,isAutomatable:!0},{id:"sp0250.brightness",name:"Brightness",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"sp0250.filterMix",name:"Filter Mix",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"sp0250.stereoWidth",name:"Stereo Wid",section:DS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"sp0250.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],MAMETMS5220:[{id:"tms5220.chirpType",name:"Chirp Type",section:gS,type:fS,min:0,max:2,defaultValue:0,valueStrings:["TMS5220","TMS5200","TI99"],page:0,index:0,isAutomatable:!0},{id:"tms5220.pitchIndex",name:"Pitch",section:gS,type:pS,min:0,max:63,defaultValue:32,page:0,index:1,isAutomatable:!0},{id:"tms5220.energyIndex",name:"Energy",section:gS,type:pS,min:0,max:15,defaultValue:10,page:0,index:2,isAutomatable:!0},{id:"tms5220.k1Index",name:"K1 Formant",section:bS,type:pS,min:0,max:31,defaultValue:15,page:0,index:3,isAutomatable:!0},{id:"tms5220.k2Index",name:"K2 Formant",section:bS,type:pS,min:0,max:31,defaultValue:15,page:0,index:4,isAutomatable:!0},{id:"tms5220.noiseMode",name:"Noise",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"tms5220.brightness",name:"Brightness",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"tms5220.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMEUPD931:[{id:"upd931.waveA",name:"Wave A",section:gS,type:pS,min:0,max:7,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"upd931.waveB",name:"Wave B",section:gS,type:pS,min:0,max:7,defaultValue:1,page:0,index:1,isAutomatable:!0},{id:"upd931.modeA",name:"Mode A",section:gS,type:fS,min:0,max:3,defaultValue:0,valueStrings:["Always","Alternate","Attack","Sustain"],page:0,index:2,isAutomatable:!0},{id:"upd931.modeB",name:"Mode B",section:gS,type:fS,min:0,max:3,defaultValue:0,valueStrings:["Always","Alternate","Attack","Sustain"],page:0,index:3,isAutomatable:!0},{id:"upd931.mirror",name:"Mirror",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"upd931.invert",name:"Invert",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"upd931.keyScaling",name:"Key Scale",section:NS,type:hS,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"upd931.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMEUPD933:[{id:"upd933.waveform1",name:"Wave 1",section:gS,type:fS,min:0,max:7,defaultValue:0,valueStrings:["Saw","Square","Pulse","Silent","DblSine","Saw+Pls","Reso","DblPls"],page:0,index:0,isAutomatable:!0},{id:"upd933.waveform2",name:"Wave 2",section:gS,type:fS,min:0,max:7,defaultValue:0,valueStrings:["Saw","Square","Pulse","Silent","DblSine","Saw+Pls","Reso","DblPls"],page:0,index:1,isAutomatable:!0},{id:"upd933.dcwDepth",name:"DCW Depth",section:bS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"upd933.dcaRate",name:"DCA Rate",section:vS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"upd933.dcwRate",name:"DCW Rate",section:vS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"upd933.dcoDepth",name:"Pitch Env",section:NS,type:mS,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"upd933.ringMod",name:"Ring Mod",section:gS,type:hS,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"upd933.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMEVotrax:[{id:"votrax.phoneme",name:"Phoneme",section:gS,type:pS,min:0,max:63,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"votrax.inflection",name:"Inflection",section:gS,type:fS,min:0,max:3,defaultValue:0,valueStrings:["Normal","Rise","Fall","Stress"],page:0,index:1,isAutomatable:!0},{id:"votrax.f1Override",name:"F1 Formant",section:bS,type:pS,min:-1,max:15,defaultValue:-1,page:0,index:2,isAutomatable:!0},{id:"votrax.f2Override",name:"F2 Formant",section:bS,type:pS,min:-1,max:15,defaultValue:-1,page:0,index:3,isAutomatable:!0},{id:"votrax.f3Override",name:"F3 Formant",section:bS,type:pS,min:-1,max:15,defaultValue:-1,page:0,index:4,isAutomatable:!0},{id:"votrax.stereoWidth",name:"Stereo Wid",section:DS,type:mS,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"votrax.volume",name:"Volume",section:DS,type:mS,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}]};function HS(e){return GS[e]||zS}function WS(e){if(e.pdi)return e.pdi;switch(e.type){case hS:return{type:"toggle",style:"power"};case fS:{const t=e.valueStrings?.length??Math.round(e.max-e.min+1),n=e.name.toLowerCase();let s="menu";return n.includes("wave")||n.includes("osc type")||n.includes("waveform")?s="waveform":n.includes("filter")&&(n.includes("mode")||n.includes("type"))&&(s="filterType"),{type:"discrete",style:s,value_count:t,display_values:e.valueStrings}}case pS:return{type:e.min<0?"discrete_bipolar":"discrete",style:"value",value_count:Math.round(e.max-e.min+1)};default:return{type:e.min<0?"continuous_bipolar":"continuous",style:"knob"}}}const qS={"tb303.cutoff":"cutoff","tb303.resonance":"resonance","tb303.envMod":"envMod","tb303.decay":"decay","tb303.accent":"accent","tb303.volume":"mixer.volume","dubsiren.oscillator.frequency":"siren.osc.frequency","dubsiren.lfo.rate":"siren.lfo.rate","dubsiren.lfo.depth":"siren.lfo.depth","dubsiren.delay.time":"siren.delay.time","dubsiren.delay.feedback":"siren.delay.feedback","dubsiren.delay.wet":"siren.delay.wet","dubsiren.filter.frequency":"siren.filter.frequency","dubsiren.reverb.wet":"siren.reverb.wet","furnace.algorithm":"furnace.algorithm","furnace.feedback":"furnace.feedback","furnace.op1.level":"furnace.op1TL","furnace.lfoRate":"furnace.fms","v2.osc1.level":"v2.osc1Level","v2.filter1.cutoff":"v2.filter1Cutoff","v2.filter1.resonance":"v2.filter1Reso","v2.envelope.attack":"v2.envAttack","v2.envelope.decay":"v2.envDecay","v2.envelope.sustain":"v2.envSustain","v2.envelope.release":"v2.envRelease","v2.lfo1.depth":"v2.lfo1Depth","synare.oscillator.tune":"synare.tune","synare.oscillator2.mix":"synare.osc2Mix","synare.filter.cutoff":"synare.filterCutoff","synare.filter.resonance":"synare.filterReso","synare.filter.envMod":"synare.filterEnvMod","synare.filter.decay":"synare.filterDecay","synare.sweep.amount":"synare.sweepAmount","synare.sweep.time":"synare.sweepTime","dexed.algorithm":"dexed.algorithm","dexed.feedback":"dexed.feedback","dexed.lfoSpeed":"dexed.lfoSpeed","dexed.lfoPitchModDepth":"dexed.lfoPitchMod","dexed.lfoAmpModDepth":"dexed.lfoAmpMod","dexed.transpose":"dexed.transpose","obxd.filterCutoff":"obxd.filterCutoff","obxd.filterResonance":"obxd.filterReso","obxd.filterEnvAmount":"obxd.filterEnv","obxd.ampAttack":"obxd.ampAttack","obxd.ampDecay":"obxd.ampDecay","obxd.masterVolume":"obxd.volume","obxd.osc1Level":"obxd.osc1Level","obxd.osc2Level":"obxd.osc2Level","spacelaser.laser.startFreq":"spacelaser.startFreq","spacelaser.laser.endFreq":"spacelaser.endFreq","spacelaser.laser.sweepTime":"spacelaser.sweepTime","spacelaser.fm.amount":"spacelaser.fmAmount","spacelaser.fm.ratio":"spacelaser.fmRatio","spacelaser.filter.cutoff":"spacelaser.filterCutoff","spacelaser.filter.resonance":"spacelaser.filterReso","spacelaser.delay.wet":"spacelaser.delayWet","sam.speed":"sam.speed","sam.pitch":"sam.pitch","sam.mouth":"sam.mouth","sam.throat":"sam.throat","generic.volume":"mixer.volume","generic.pan":"mixer.pan"};function KS(e){return e.engineParam?e.engineParam:qS[e.id]||e.id}function $S(e){return{id:e.id,name:e.name,pdi:WS(e),defaultValue:e.defaultValue,unit:e.unit,ccNumber:e.ccNumber,engineParam:KS(e)}}function YS(e){const t=HS(e),n=t.map($S),s=function(e){const t=new Map;for(const s of e)!1!==s.isAutomatable&&(t.has(s.page)||t.set(s.page,[]),t.get(s.page).push(s));const n=[];for(const[s,a]of t.entries()){a.sort((e,t)=>e.index-t.index);const e=a.map(e=>e.section),t=new Map;for(const n of e)t.set(n,(t.get(n)||0)+1);let o=e[0],r=0;for(const[n,s]of t.entries())s>r&&(o=n,r=s);n.push({id:`page_${s}`,name:`${o} ${s+1}`,parameters:a})}return n.sort((e,t)=>parseInt(e.id.split("_")[1])-parseInt(t.id.split("_")[1])),n}(t);return{synthType:e,parameters:n,navigation:{performance:s.slice(0,2).map(e=>({name:e.name,parameters:e.parameters.map($S)})),editGroups:s.length>2?s.slice(2).map(e=>({name:e.name,sections:[{name:e.name,parameters:e.parameters.map($S)}]})):void 0}}}const JS=new Map;function QS(e){const t=function(e){let t=JS.get(e);return t||(t=YS(e),JS.set(e,t)),t}(e);return t.navigation.performance.flatMap(e=>e.parameters).slice(0,16)}const ZS={303:[{cc:70,param:"cutoff",label:"Cutoff"},{cc:71,param:"resonance",label:"Resonance"},{cc:72,param:"envMod",label:"Env Mod"},{cc:73,param:"decay",label:"Decay"},{cc:74,param:"accent",label:"Accent"},{cc:75,param:"overdrive",label:"Drive"},{cc:76,param:"slideTime",label:"Slide"},{cc:77,param:"mixer.volume",label:"Volume"}],Siren:[{cc:70,param:"siren.osc.frequency",label:"Osc Freq"},{cc:71,param:"siren.lfo.rate",label:"LFO Rate"},{cc:72,param:"siren.lfo.depth",label:"LFO Depth"},{cc:73,param:"siren.delay.time",label:"Delay Time"},{cc:74,param:"siren.delay.feedback",label:"Feedback"},{cc:75,param:"siren.delay.wet",label:"Delay Mix"},{cc:76,param:"siren.filter.frequency",label:"Filter"},{cc:77,param:"siren.reverb.wet",label:"Reverb"}],Furnace:[{cc:70,param:"furnace.algorithm",label:"Algorithm"},{cc:71,param:"furnace.feedback",label:"Feedback"},{cc:72,param:"furnace.op1TL",label:"Op1 TL"},{cc:73,param:"furnace.op1AR",label:"Op1 AR"},{cc:74,param:"furnace.op1DR",label:"Op1 DR"},{cc:75,param:"furnace.op1SL",label:"Op1 SL"},{cc:76,param:"furnace.op1RR",label:"Op1 RR"},{cc:77,param:"furnace.fms",label:"FM Sens"}],V2:[{cc:70,param:"v2.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"v2.filter1Cutoff",label:"Cutoff"},{cc:72,param:"v2.filter1Reso",label:"Reso"},{cc:73,param:"v2.envAttack",label:"Attack"},{cc:74,param:"v2.envDecay",label:"Decay"},{cc:75,param:"v2.envSustain",label:"Sustain"},{cc:76,param:"v2.envRelease",label:"Release"},{cc:77,param:"v2.lfo1Depth",label:"LFO Dep"}],Synare:[{cc:70,param:"synare.tune",label:"Tune"},{cc:71,param:"synare.osc2Mix",label:"Osc2 Mix"},{cc:72,param:"synare.filterCutoff",label:"Cutoff"},{cc:73,param:"synare.filterReso",label:"Reso"},{cc:74,param:"synare.filterEnvMod",label:"Env Mod"},{cc:75,param:"synare.filterDecay",label:"Flt Dcy"},{cc:76,param:"synare.sweepAmount",label:"Sweep"},{cc:77,param:"synare.sweepTime",label:"Swp Time"}],Dexed:[{cc:70,param:"dexed.algorithm",label:"Algorithm"},{cc:71,param:"dexed.feedback",label:"Feedback"},{cc:72,param:"dexed.op1Level",label:"Op1 Lvl"},{cc:73,param:"dexed.op1Coarse",label:"Op1 Coarse"},{cc:74,param:"dexed.lfoSpeed",label:"LFO Spd"},{cc:75,param:"dexed.lfoPitchMod",label:"LFO Pitch"},{cc:76,param:"dexed.lfoAmpMod",label:"LFO Amp"},{cc:77,param:"dexed.transpose",label:"Transpose"}],OBXd:[{cc:70,param:"obxd.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"obxd.osc2Level",label:"Osc2 Lvl"},{cc:72,param:"obxd.filterCutoff",label:"Cutoff"},{cc:73,param:"obxd.filterReso",label:"Reso"},{cc:74,param:"obxd.filterEnv",label:"Flt Env"},{cc:75,param:"obxd.ampAttack",label:"Attack"},{cc:76,param:"obxd.ampDecay",label:"Decay"},{cc:77,param:"obxd.volume",label:"Volume"}],SpaceLaser:[{cc:70,param:"spacelaser.startFreq",label:"Start Hz"},{cc:71,param:"spacelaser.endFreq",label:"End Hz"},{cc:72,param:"spacelaser.sweepTime",label:"Sweep"},{cc:73,param:"spacelaser.fmAmount",label:"FM Amt"},{cc:74,param:"spacelaser.fmRatio",label:"FM Ratio"},{cc:75,param:"spacelaser.filterCutoff",label:"Cutoff"},{cc:76,param:"spacelaser.filterReso",label:"Reso"},{cc:77,param:"spacelaser.delayWet",label:"Delay"}],SAM:[{cc:70,param:"sam.pitch",label:"Pitch"},{cc:71,param:"sam.speed",label:"Speed"},{cc:72,param:"sam.mouth",label:"Mouth"},{cc:73,param:"sam.throat",label:"Throat"},{cc:74,param:"mixer.volume",label:"Volume"},{cc:75,param:"mixer.volume",label:"-"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],Organ:[{cc:70,param:"organ.drawbar16",label:"16'"},{cc:71,param:"organ.drawbar8",label:"8'"},{cc:72,param:"organ.drawbar4",label:"4'"},{cc:73,param:"organ.percussion",label:"Perc"},{cc:74,param:"organ.vibratoType",label:"Vib Type"},{cc:75,param:"organ.vibratoDepth",label:"Vib Dep"},{cc:76,param:"organ.overdrive",label:"Drive"},{cc:77,param:"organ.volume",label:"Volume"}],Melodica:[{cc:70,param:"melodica.breath",label:"Breath"},{cc:71,param:"melodica.brightness",label:"Bright"},{cc:72,param:"melodica.vibratoRate",label:"Vib Rate"},{cc:73,param:"melodica.vibratoDepth",label:"Vib Dep"},{cc:74,param:"melodica.detune",label:"Detune"},{cc:75,param:"melodica.portamento",label:"Porta"},{cc:76,param:"melodica.attack",label:"Attack"},{cc:77,param:"melodica.volume",label:"Volume"}],FX:[{cc:70,param:"echo.rate",label:"Echo Rate"},{cc:71,param:"echo.intensity",label:"Intensity"},{cc:72,param:"echo.echoVolume",label:"Echo Vol"},{cc:73,param:"echo.reverbVolume",label:"Rev Vol"},{cc:74,param:"echo.mode",label:"Echo Mode"},{cc:75,param:"biphase.rateA",label:"Phase A"},{cc:76,param:"biphase.feedback",label:"Phase FB"},{cc:77,param:"biphase.routing",label:"Routing"}],Mixer:[{cc:70,param:"mixer.volume",label:"Vol 1"},{cc:71,param:"mixer.volume",label:"Vol 2"},{cc:72,param:"mixer.volume",label:"Vol 3"},{cc:73,param:"mixer.volume",label:"Vol 4"},{cc:74,param:"mixer.pan",label:"Pan 1"},{cc:75,param:"mixer.pan",label:"Pan 2"},{cc:76,param:"mixer.pan",label:"Pan 3"},{cc:77,param:"mixer.pan",label:"Pan 4"}],MasterFX:[{cc:70,param:"masterFx.slot0.wet",label:"FX1 Wet"},{cc:71,param:"masterFx.slot0.param0",label:"FX1 P1"},{cc:72,param:"masterFx.slot1.wet",label:"FX2 Wet"},{cc:73,param:"masterFx.slot1.param0",label:"FX2 P1"},{cc:74,param:"masterFx.slot2.wet",label:"FX3 Wet"},{cc:75,param:"masterFx.slot2.param0",label:"FX3 P1"},{cc:76,param:"masterFx.masterVolume",label:"Master"},{cc:77,param:"masterFx.limiterCeiling",label:"Limiter"}]},eM=[ZS[303],[{cc:70,param:"passbandCompensation",label:"Bass"},{cc:71,param:"resTracking",label:"Rez"},{cc:72,param:"filterInputDrive",label:"Satur"},{cc:73,param:"diodeCharacter",label:"Bite"},{cc:74,param:"duffingAmount",label:"Tensn"},{cc:75,param:"filterFmDepth",label:"F.FM"},{cc:76,param:"lpBpMix",label:"LP/BP"},{cc:77,param:"filterTracking",label:"K.Trk"}],[{cc:70,param:"normalDecay",label:"N.Dec"},{cc:71,param:"accentDecay",label:"A.Dec"},{cc:72,param:"softAttack",label:"S.Atk"},{cc:73,param:"accentSoftAttack",label:"A.Atk"},{cc:74,param:"slideTime",label:"Slide"},{cc:75,param:"stageNLAmount",label:"StgNL"},{cc:76,param:"ensembleAmount",label:"Ensem"},{cc:77,param:"overdrive",label:"Drive"}],[{cc:70,param:"korgBite",label:"Bite"},{cc:71,param:"korgClip",label:"Clip"},{cc:72,param:"korgCrossmod",label:"XMod"},{cc:73,param:"korgQSag",label:"Q.Sag"},{cc:74,param:"korgSharpness",label:"Sharp"},{cc:75,param:"mixer.volume",label:"-"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],[{cc:70,param:"lfoRate",label:"Rate"},{cc:71,param:"lfoContour",label:"Contour"},{cc:72,param:"lfoPitchDepth",label:"Pitch"},{cc:73,param:"lfoPwmDepth",label:"PWM"},{cc:74,param:"lfoFilterDepth",label:"Filter"},{cc:75,param:"lfoStiffDepth",label:"Stiff"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],[{cc:70,param:"chorusMix",label:"Chorus"},{cc:71,param:"phaserRate",label:"Ph.Rate"},{cc:72,param:"phaserFeedback",label:"Ph.FB"},{cc:73,param:"phaserMix",label:"Ph.Mix"},{cc:74,param:"delayTime",label:"Dly.T"},{cc:75,param:"delayFeedback",label:"Dly.FB"},{cc:76,param:"delayMix",label:"Dly.Mix"},{cc:77,param:"delaySpread",label:"Spread"}],[{cc:70,param:"tuning",label:"Tune"},{cc:71,param:"waveform",label:"Wave"},{cc:72,param:"pulseWidth",label:"PWM"},{cc:73,param:"subOscGain",label:"SubG"},{cc:74,param:"subOscBlend",label:"SubB"},{cc:75,param:"pitchToPw",label:"PPW"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"Volume"}]],tM={303:{x:{param:"cutoff",min:0,max:1,curve:"linear"},y:{param:"resonance",min:0,max:1,curve:"linear"}},Siren:{x:{param:"siren.osc.frequency",min:60,max:1500,curve:"linear"},y:{param:"siren.lfo.rate",min:.1,max:20,curve:"linear"}},Furnace:{x:{param:"furnace.fms",min:0,max:7,curve:"linear"},y:{param:"furnace.op1SL",min:0,max:15,curve:"linear"}},V2:{x:{param:"v2.filter1Cutoff",min:0,max:127,curve:"linear"},y:{param:"v2.filter1Reso",min:0,max:127,curve:"linear"}},Synare:{x:{param:"synare.filterCutoff",min:20,max:2e4,curve:"log"},y:{param:"synare.filterEnvMod",min:0,max:100,curve:"linear"}},Dexed:{x:{param:"dexed.lfoPitchMod",min:0,max:99,curve:"linear"},y:{param:"dexed.lfoAmpMod",min:0,max:99,curve:"linear"}},OBXd:{x:{param:"obxd.filterCutoff",min:0,max:1,curve:"linear"},y:{param:"obxd.filterReso",min:0,max:1,curve:"linear"}},SpaceLaser:{x:{param:"spacelaser.fmAmount",min:0,max:100,curve:"linear"},y:{param:"spacelaser.filterCutoff",min:20,max:2e4,curve:"log"}},SAM:{x:{param:"sam.pitch",min:0,max:255,curve:"linear"},y:{param:"sam.speed",min:0,max:255,curve:"linear"}},Organ:{x:{param:"organ.vibratoDepth",min:0,max:1,curve:"linear"},y:{param:"organ.overdrive",min:0,max:1,curve:"linear"}},Melodica:{x:{param:"melodica.vibratoRate",min:0,max:10,curve:"linear"},y:{param:"melodica.brightness",min:0,max:1,curve:"linear"}}};function nM(e){return"TB303"===e||"Buzz3o3"===e||"Buzz3o3DF"===e?"303":"DubSiren"===e?"Siren":e.startsWith("Furnace")?"Furnace":"V2"===e||"V2Speech"===e?"V2":"Synare"===e?"Synare":"Dexed"===e||"DexedBridge"===e?"Dexed":"OBXd"===e?"OBXd":"SpaceLaser"===e?"SpaceLaser":"Sam"===e?"SAM":"TonewheelOrgan"===e?"Organ":"Melodica"===e?"Melodica":null}function sM(e,t){const n=nM(e);if("303"===n)return t>=0&&t<eM.length?eM[t]:[];if(n)return 0===t?ZS[n]:[];const s=QS(e);if(0===s.length)return 0===t?ZS.Mixer:[];const a=8*t;return s.slice(a,a+8).map((e,t)=>({cc:70+t,param:e.engineParam,label:e.name.substring(0,10)}))}const aM={cutoff:{type:"config",path:"tb303.filter.cutoff"},resonance:{type:"config",path:"tb303.filter.resonance"},envMod:{type:"config",path:"tb303.filterEnvelope.envMod"},decay:{type:"config",path:"tb303.filterEnvelope.decay"},accent:{type:"config",path:"tb303.accent.amount"},overdrive:{type:"config",path:"tb303.overdrive.amount"},slideTime:{type:"config",path:"tb303.slide.time"},tuning:{type:"config",path:"tb303.tuning",transform:e=>2*e-1},waveform:{type:"config",path:"tb303.oscillator.waveformBlend"},pulseWidth:{type:"config",path:"tb303.oscillator.pulseWidth"},subOscGain:{type:"config",path:"tb303.oscillator.subOscGain"},subOscBlend:{type:"config",path:"tb303.oscillator.subOscBlend"},pitchToPw:{type:"config",path:"tb303.oscillator.pitchToPw"},volume:{type:"config",path:"tb303.volume"},passbandCompensation:{type:"config",path:"tb303.devilFish.passbandCompensation"},resTracking:{type:"config",path:"tb303.devilFish.resTracking"},filterInputDrive:{type:"config",path:"tb303.devilFish.filterInputDrive"},diodeCharacter:{type:"config",path:"tb303.devilFish.diodeCharacter"},duffingAmount:{type:"config",path:"tb303.devilFish.duffingAmount",transform:e=>2*e-1},filterFmDepth:{type:"config",path:"tb303.devilFish.filterFmDepth"},lpBpMix:{type:"config",path:"tb303.devilFish.lpBpMix"},normalDecay:{type:"config",path:"tb303.devilFish.normalDecay"},accentDecay:{type:"config",path:"tb303.devilFish.accentDecay"},softAttack:{type:"config",path:"tb303.devilFish.softAttack"},accentSoftAttack:{type:"config",path:"tb303.devilFish.accentSoftAttack"},filterTracking:{type:"config",path:"tb303.devilFish.filterTracking"},stageNLAmount:{type:"config",path:"tb303.devilFish.stageNLAmount"},ensembleAmount:{type:"config",path:"tb303.devilFish.ensembleAmount"},korgBite:{type:"config",path:"tb303.devilFish.korgBite"},korgClip:{type:"config",path:"tb303.devilFish.korgClip"},korgCrossmod:{type:"config",path:"tb303.devilFish.korgCrossmod"},korgQSag:{type:"config",path:"tb303.devilFish.korgQSag"},korgSharpness:{type:"config",path:"tb303.devilFish.korgSharpness"},lfoRate:{type:"config",path:"tb303.lfo.rate"},lfoContour:{type:"config",path:"tb303.lfo.contour",transform:e=>2*e-1},lfoPitchDepth:{type:"config",path:"tb303.lfo.pitchDepth"},lfoPwmDepth:{type:"config",path:"tb303.lfo.pwmDepth"},lfoFilterDepth:{type:"config",path:"tb303.lfo.filterDepth"},lfoStiffDepth:{type:"config",path:"tb303.lfo.stiffDepth"},chorusMix:{type:"config",path:"tb303.chorus.mix"},phaserRate:{type:"config",path:"tb303.phaser.rate"},phaserWidth:{type:"config",path:"tb303.phaser.depth"},phaserFeedback:{type:"config",path:"tb303.phaser.feedback"},phaserMix:{type:"config",path:"tb303.phaser.mix"},delayTime:{type:"config",path:"tb303.delay.time"},delayFeedback:{type:"config",path:"tb303.delay.feedback"},delayTone:{type:"config",path:"tb303.delay.tone"},delayMix:{type:"config",path:"tb303.delay.mix"},delaySpread:{type:"config",path:"tb303.delay.stereo"},"siren.osc.frequency":{type:"config",path:"dubSiren.oscillator.frequency",transform:e=>60+940*e},"siren.lfo.rate":{type:"config",path:"dubSiren.lfo.rate",transform:e=>.1+19.9*e},"siren.lfo.depth":{type:"config",path:"dubSiren.lfo.depth",transform:e=>500*e},"siren.delay.time":{type:"config",path:"dubSiren.delay.time",transform:e=>.01+.99*e},"siren.delay.feedback":{type:"config",path:"dubSiren.delay.feedback",transform:e=>.95*e},"siren.delay.wet":{type:"config",path:"dubSiren.delay.wet"},"siren.filter.frequency":{type:"config",path:"dubSiren.filter.frequency",transform:e=>20+9980*e},"siren.reverb.wet":{type:"config",path:"dubSiren.reverb.wet"},"furnace.algorithm":{type:"config",path:"furnace.algorithm",transform:e=>Math.round(7*e)},"furnace.feedback":{type:"config",path:"furnace.feedback",transform:e=>Math.round(7*e)},"furnace.op1TL":{type:"config",path:"furnace.operators.0.tl",transform:e=>Math.round(127*e)},"furnace.op1AR":{type:"config",path:"furnace.operators.0.ar",transform:e=>Math.round(31*e)},"furnace.op1DR":{type:"config",path:"furnace.operators.0.dr",transform:e=>Math.round(31*e)},"furnace.op1SL":{type:"config",path:"furnace.operators.0.sl",transform:e=>Math.round(15*e)},"furnace.op1RR":{type:"config",path:"furnace.operators.0.rr",transform:e=>Math.round(15*e)},"furnace.fms":{type:"config",path:"furnace.fms",transform:e=>Math.round(7*e)},"v2.osc1Level":{type:"config",path:"v2.osc1.level",transform:e=>Math.round(127*e)},"v2.filter1Cutoff":{type:"config",path:"v2.filter1.cutoff",transform:e=>Math.round(127*e)},"v2.filter1Reso":{type:"config",path:"v2.filter1.resonance",transform:e=>Math.round(127*e)},"v2.envAttack":{type:"config",path:"v2.envelope.attack",transform:e=>Math.round(127*e)},"v2.envDecay":{type:"config",path:"v2.envelope.decay",transform:e=>Math.round(127*e)},"v2.envSustain":{type:"config",path:"v2.envelope.sustain",transform:e=>Math.round(127*e)},"v2.envRelease":{type:"config",path:"v2.envelope.release",transform:e=>Math.round(127*e)},"v2.lfo1Depth":{type:"config",path:"v2.lfo1.depth",transform:e=>Math.round(127*e)},"synare.tune":{type:"config",path:"synare.oscillator.tune",transform:e=>20+980*e},"synare.osc2Mix":{type:"config",path:"synare.oscillator2.mix"},"synare.filterCutoff":{type:"config",path:"synare.filter.cutoff",transform:e=>20*Math.pow(1e3,e)},"synare.filterReso":{type:"config",path:"synare.filter.resonance",transform:e=>100*e},"synare.filterEnvMod":{type:"config",path:"synare.filter.envMod",transform:e=>100*e},"synare.filterDecay":{type:"config",path:"synare.filter.decay",transform:e=>10+1990*e},"synare.sweepAmount":{type:"config",path:"synare.sweep.amount",transform:e=>48*e},"synare.sweepTime":{type:"config",path:"synare.sweep.time",transform:e=>5+495*e},"dexed.algorithm":{type:"config",path:"dexed.algorithm",transform:e=>Math.round(31*e)},"dexed.feedback":{type:"config",path:"dexed.feedback",transform:e=>Math.round(7*e)},"dexed.op1Level":{type:"config",path:"dexed.operators.0.level",transform:e=>Math.round(99*e)},"dexed.op1Coarse":{type:"config",path:"dexed.operators.0.coarse",transform:e=>Math.round(31*e)},"dexed.lfoSpeed":{type:"config",path:"dexed.lfoSpeed",transform:e=>Math.round(99*e)},"dexed.lfoPitchMod":{type:"config",path:"dexed.lfoPitchModDepth",transform:e=>Math.round(99*e)},"dexed.lfoAmpMod":{type:"config",path:"dexed.lfoAmpModDepth",transform:e=>Math.round(99*e)},"dexed.transpose":{type:"config",path:"dexed.transpose",transform:e=>Math.round(48*e-24)},"obxd.osc1Level":{type:"config",path:"obxd.osc1Level"},"obxd.osc2Level":{type:"config",path:"obxd.osc2Level"},"obxd.filterCutoff":{type:"config",path:"obxd.filterCutoff"},"obxd.filterReso":{type:"config",path:"obxd.filterResonance"},"obxd.filterEnv":{type:"config",path:"obxd.filterEnvAmount"},"obxd.ampAttack":{type:"config",path:"obxd.ampAttack"},"obxd.ampDecay":{type:"config",path:"obxd.ampDecay"},"obxd.volume":{type:"config",path:"obxd.masterVolume"},"spacelaser.startFreq":{type:"config",path:"spaceLaser.laser.startFreq",transform:e=>100+9900*e},"spacelaser.endFreq":{type:"config",path:"spaceLaser.laser.endFreq",transform:e=>20+4980*e},"spacelaser.sweepTime":{type:"config",path:"spaceLaser.laser.sweepTime",transform:e=>10+2990*e},"spacelaser.fmAmount":{type:"config",path:"spaceLaser.fm.amount",transform:e=>100*e},"spacelaser.fmRatio":{type:"config",path:"spaceLaser.fm.ratio",transform:e=>.5+15.5*e},"spacelaser.filterCutoff":{type:"config",path:"spaceLaser.filter.cutoff",transform:e=>20*Math.pow(1e3,e)},"spacelaser.filterReso":{type:"config",path:"spaceLaser.filter.resonance",transform:e=>100*e},"spacelaser.delayWet":{type:"config",path:"spaceLaser.delay.wet"},"sam.pitch":{type:"config",path:"sam.pitch",transform:e=>Math.round(255*e)},"sam.speed":{type:"config",path:"sam.speed",transform:e=>Math.round(255*e)},"sam.mouth":{type:"config",path:"sam.mouth",transform:e=>Math.round(255*e)},"sam.throat":{type:"config",path:"sam.throat",transform:e=>Math.round(255*e)},"organ.drawbar16":{type:"vstbridge",paramId:0,transform:e=>8*e},"organ.drawbar8":{type:"vstbridge",paramId:2,transform:e=>8*e},"organ.drawbar4":{type:"vstbridge",paramId:3,transform:e=>8*e},"organ.percussion":{type:"vstbridge",paramId:9},"organ.vibratoType":{type:"vstbridge",paramId:13,transform:e=>Math.round(5*e)},"organ.vibratoDepth":{type:"vstbridge",paramId:14},"organ.overdrive":{type:"vstbridge",paramId:15},"organ.volume":{type:"vstbridge",paramId:16},"melodica.breath":{type:"vstbridge",paramId:0},"melodica.brightness":{type:"vstbridge",paramId:1},"melodica.vibratoRate":{type:"vstbridge",paramId:2,transform:e=>10*e},"melodica.vibratoDepth":{type:"vstbridge",paramId:3},"melodica.detune":{type:"vstbridge",paramId:4,transform:e=>100*e-50},"melodica.portamento":{type:"vstbridge",paramId:6},"melodica.attack":{type:"vstbridge",paramId:7},"melodica.volume":{type:"vstbridge",paramId:9},"echo.rate":{type:"effect",effectType:"SpaceEcho",param:"rate",transform:e=>50+950*e},"echo.intensity":{type:"effect",effectType:"SpaceEcho",param:"intensity",transform:e=>1.2*e},"echo.echoVolume":{type:"effect",effectType:"SpaceEcho",param:"echoVolume"},"echo.reverbVolume":{type:"effect",effectType:"SpaceEcho",param:"reverbVolume"},"echo.mode":{type:"effect",effectType:"SpaceEcho",param:"mode",transform:e=>Math.floor(1+11*e)},"biphase.rateA":{type:"effect",effectType:"BiPhase",param:"rateA",transform:e=>.1+9.9*e},"biphase.feedback":{type:"effect",effectType:"BiPhase",param:"feedback",transform:e=>.95*e},"biphase.routing":{type:"effect",effectType:"BiPhase",param:"routing",transform:e=>e>.5?1:0},"mixer.volume":{type:"config",path:"volume",transform:e=>60*e-60},"mixer.pan":{type:"config",path:"pan",transform:e=>200*e-100},"masterFx.slot0.wet":{type:"config",path:"__masterFx__"},"masterFx.slot0.param0":{type:"config",path:"__masterFx__"},"masterFx.slot1.wet":{type:"config",path:"__masterFx__"},"masterFx.slot1.param0":{type:"config",path:"__masterFx__"},"masterFx.slot2.wet":{type:"config",path:"__masterFx__"},"masterFx.slot2.param0":{type:"config",path:"__masterFx__"},"masterFx.masterVolume":{type:"config",path:"__masterFx__"},"masterFx.limiterCeiling":{type:"config",path:"__masterFx__"}};const oM=new Map;let rM=!1;function iM(){rM=!1;const e=EN.getState();for(const[t,n]of oM)e.updateInstrument(t,n);oM.clear()}function lM(e,t){const n=oM.get(e);n?cM(n,t):oM.set(e,t),rM||(rM=!0,requestAnimationFrame(iM))}function cM(e,t){for(const n of Object.keys(t)){const s=t[n],a=e[n];"object"!=typeof s||null===s||Array.isArray(s)||"object"!=typeof a||null===a||Array.isArray(a)?e[n]=s:(Object.isFrozen(a)&&(e[n]={...a}),cM(e[n],s))}}function uM(e,t,n){if(e.startsWith("masterFx."))return void function(e,t){try{const{useAudioStore:n}=require("../../stores/useAudioStore"),s=n.getState(),a=Bw();if("masterFx.masterVolume"===e){const e=60*t-60;return void a.masterChannel.volume.rampTo(e,.02)}if("masterFx.limiterCeiling"===e){const e=20*t-20;return void a.masterChannel.volume.rampTo(Math.min(0,e),.02)}const o=e.match(/^masterFx\.slot(\d+)\.(\w+)$/);if(!o)return;const r=parseInt(o[1]),i=o[2],l=s.masterEffects;if(r>=l.length)return;const c=l[r];if(!c)return;if("wet"===i){const e=Math.round(100*t);s.updateMasterEffect(c.id,{wet:e})}else if("param0"===i){const e=Object.keys(c.parameters).filter(e=>"number"==typeof c.parameters[e]);if(e.length>0){const n=e[0],a=c.parameters[n],o="number"==typeof a&&a>1?100:1;s.updateMasterEffect(c.id,{parameters:{...c.parameters,[n]:t*o}})}}}catch{}}(e,t);const s=aM[e];if(!s)return;const a=EN.getState(),o=a.currentInstrumentId,r=a.instruments.find(e=>e.id===o);if(!r)return;const i=s.transform?s.transform(t):t;switch(s.type){case"config":{!function(e,t,n){try{Bw().instruments.forEach((s,a)=>{if(a>>>16!==e)return;const o=s;"function"==typeof o.set&&o.set(t,n)})}catch{}}(r.id,e,i);const t=function(e,t,n){const s=e.split(".");if(1===s.length)return{[s[0]]:t};const a=s[0],o=n[a]||{};if(2===s.length)return{[a]:{...o,[s[1]]:t}};if(3===s.length){const e=s[1],n=s[2],r=o[e]||{};return{[a]:{...o,[e]:{...r,[n]:t}}}}if(4===s.length&&/^\d+$/.test(s[2])){const e=s[1],n=parseInt(s[2]),r=s[3],i=o[e],l=Array.isArray(i)?[...i]:[];return l[n]={...l[n],[r]:t},{[a]:{...o,[e]:l}}}return function e(n,a){if(n===s.length-1)return t;const o=s[n],r=s[n+1];if(/^\d+$/.test(r)){const i=parseInt(r),l=a?.[o],c=Array.isArray(l)?[...l]:[],u=c[i]?{...c[i]}:{},d=s[n+2];return void 0!==d&&(u[d]=e(n+3,u),n+3>=s.length&&(u[d]=t)),c[i]=u,{...a,[o]:c}}const i=a?.[o]||{},l=e(n+1,i);return n+1===s.length-1?{...a,[o]:{...i,[s[n+1]]:l}}:{...a,[o]:l}}(0,n)}(s.path,i,r);lM(r.id,t);break}case"vstbridge":{const e=function(e){const t=e<<16|65535;return Bw().instruments.get(t)}(r.id);e&&"object"==typeof e&&"setParameter"in e&&e.setParameter(s.paramId,i);break}case"effect":{const e=r.effects.find(e=>e.type===s.effectType);e&&a.updateEffect(r.id,e.id,{parameters:{...e.parameters,[s.param]:i}});break}}}let dM=null;function mM(e,t){const n=function(){if(dM)return dM;const{getDJEngine:e}=require("../../engine/dj/DJEngine");return dM={"dj.crossfader":t=>e().setCrossfader(t),"dj.deckA.volume":t=>e().deckA.setVolume(1.5*t),"dj.deckB.volume":t=>e().deckB.setVolume(1.5*t),"dj.masterVolume":t=>e().mixer.setMasterVolume(1.5*t),"dj.deckA.eqHi":t=>e().deckA.setEQ("high",30*t-24),"dj.deckA.eqMid":t=>e().deckA.setEQ("mid",30*t-24),"dj.deckA.eqLow":t=>e().deckA.setEQ("low",30*t-24),"dj.deckB.eqHi":t=>e().deckB.setEQ("high",30*t-24),"dj.deckB.eqMid":t=>e().deckB.setEQ("mid",30*t-24),"dj.deckB.eqLow":t=>e().deckB.setEQ("low",30*t-24),"dj.deckA.filter":t=>e().deckA.setFilterPosition(2*t-1),"dj.deckB.filter":t=>e().deckB.setFilterPosition(2*t-1),"dj.deckA.filterQ":t=>e().deckA.setFilterResonance(.5+14.5*t),"dj.deckB.filterQ":t=>e().deckB.setFilterResonance(.5+14.5*t),"dj.deckA.pitch":t=>e().deckA.setPitch(12*t-6),"dj.deckB.pitch":t=>e().deckB.setPitch(12*t-6),"dj.deckA.scratchVelocity":t=>e().deckA.setScratchVelocity(8*t-4),"dj.deckB.scratchVelocity":t=>e().deckB.setScratchVelocity(8*t-4)},dM}()[e];if(n)try{n(t)}catch{}}const pM=[240,71,127],hM=100,fM=[{mode:85,cc:86,min:87,max:88,name:89},{mode:105,cc:106,min:107,max:108,name:109},{mode:125,cc:126,min:127,max:128,name:129},{mode:145,cc:146,min:147,max:148,name:149},{mode:165,cc:166,min:167,max:168,name:169},{mode:185,cc:186,min:187,max:188,name:189},{mode:205,cc:206,min:207,max:208,name:209},{mode:225,cc:226,min:227,max:228,name:229}];let gM=null;let bM=null;function vM(){if(bM)return bM;const e=new Uint8Array(246);e[0]=0,yM(e,1,"DEViLBOX        ",16),e[17]=0,e[18]=0,e[19]=0,e[20]=4;for(let t=0;t<8;t++){const n=fM[t];e[n.mode]=0,e[n.cc]=70+t,e[n.min]=0,e[n.max]=127,yM(e,n.name,`Knob ${t+1}`,16)}return bM=e,e}function yM(e,t,n,s){for(let a=0;a<s;a++)e[t+a]=a<n.length?Math.min(127,n.charCodeAt(a)):32}async function xM(e){const t=await async function(){if(gM&&"connected"===gM.state)return gM;if(!OM.getState().outputDevices.some(e=>e.name?.includes("MPK mini")))return gM=null,null;try{const e=await navigator.requestMIDIAccess({sysex:!0}),t=Array.from(e.outputs.values()).find(e=>e.name?.includes("MPK mini"));return gM=t??null,gM}catch(e){return gM=null,null}}();if(!t)return;const n=e.length>>7&127,s=127&e.length,a=new Uint8Array([...pM,73,hM,n,s,...e,247]);t.send(a)}async function NM(e,t){const n=vM();yM(n,1,e.substring(0,8).padEnd(8)+t.substring(0,8).padEnd(8),16);try{await xM(n)}catch(s){}}function wM(e,t,n,s){const a=vM(),o=n>1?` ${t+1}/${n}`:"",r=16-o.length;yM(a,1,e.substring(0,r)+o,16);for(let i=0;i<8;i++){const e=s[i],t=fM[i];if(e){const n=(e.name||e.id).replace(/Cutoff/i,"Cut").replace(/Resonance/i,"Res").replace(/Attack/i,"Atk").replace(/Decay/i,"Dec").replace(/Sustain/i,"Sus").replace(/Release/i,"Rel").replace(/Volume/i,"Vol").replace(/Feedback/i,"Fdb").replace(/Frequency/i,"Frq").replace(/Algorithm/i,"Alg").replace(/Overdrive/i,"OD").replace(/Waveform/i,"Wav");yM(a,t.name,n,16)}else yM(a,t.name,`Knob ${i+1}`,16)}xM(a).catch(()=>{})}function EM(){return"dj"===LN.getState().activeView}const kM=[[{cc:70,param:"dj.crossfader",label:"X-Fade"},{cc:71,param:"dj.deckA.volume",label:"Vol A"},{cc:72,param:"dj.deckB.volume",label:"Vol B"},{cc:73,param:"dj.deckA.filter",label:"Filt A"},{cc:74,param:"dj.deckB.filter",label:"Filt B"},{cc:75,param:"dj.masterVolume",label:"Master"},{cc:76,param:"dj.deckA.pitch",label:"Pitch A"},{cc:77,param:"dj.deckB.pitch",label:"Pitch B"}],[{cc:70,param:"dj.deckA.eqHi",label:"EQ Hi A"},{cc:71,param:"dj.deckA.eqMid",label:"EQ Mid A"},{cc:72,param:"dj.deckA.eqLow",label:"EQ Lo A"},{cc:73,param:"dj.deckA.pitch",label:"Pitch A"},{cc:74,param:"dj.deckA.volume",label:"Vol A"},{cc:75,param:"dj.deckA.filter",label:"Filt A"},{cc:76,param:"dj.deckA.filterQ",label:"Flt Q A"},{cc:77,param:"dj.crossfader",label:"X-Fade"}],[{cc:70,param:"dj.deckB.eqHi",label:"EQ Hi B"},{cc:71,param:"dj.deckB.eqMid",label:"EQ Mid B"},{cc:72,param:"dj.deckB.eqLow",label:"EQ Lo B"},{cc:73,param:"dj.deckB.pitch",label:"Pitch B"},{cc:74,param:"dj.deckB.volume",label:"Vol B"},{cc:75,param:"dj.deckB.filter",label:"Filt B"},{cc:76,param:"dj.deckB.filterQ",label:"Flt Q B"},{cc:77,param:"dj.crossfader",label:"X-Fade"}],[{cc:70,param:"dj.deckA.scratchVelocity",label:"Scr A"},{cc:71,param:"dj.deckB.scratchVelocity",label:"Scr B"},{cc:72,param:"dj.deckA.filter",label:"Filt A"},{cc:73,param:"dj.deckB.filter",label:"Filt B"},{cc:74,param:"dj.deckA.eqLow",label:"Lo A"},{cc:75,param:"dj.deckB.eqLow",label:"Lo B"},{cc:76,param:"dj.masterVolume",label:"Master"},{cc:77,param:"dj.crossfader",label:"X-Fade"}]];let DM=!1;const SM=(e,t)=>{uM(e,t/127)};function MM(e,t){return`${e}:${t}`}function CM(e,t,n,s){return t+function(e,t="linear"){const n=Math.max(0,Math.min(127,e))/127;switch(t){case"exponential":return Math.pow(n,2);case"logarithmic":return Math.sqrt(n);default:return n}}(e,s)*(n-t)}const VM=[{ccNumber:74,parameter:"cutoff",min:200,max:2e4,curve:"logarithmic"},{ccNumber:71,parameter:"resonance",min:0,max:100,curve:"linear"},{ccNumber:10,parameter:"envMod",min:0,max:100,curve:"linear"},{ccNumber:75,parameter:"decay",min:30,max:3e3,curve:"logarithmic"},{ccNumber:16,parameter:"accent",min:0,max:100,curve:"linear"}],PM=new Map,_M=new Map,OM=i()(TN(ds((e,t)=>({isSupported:null,isInitialized:!1,lastError:null,inputDevices:[],outputDevices:[],selectedInputId:null,selectedOutputId:null,ccMappings:[...VM],isLearning:!1,learningParameter:null,lastActivityTimestamp:0,controlledInstrumentId:null,knobBank:"303",padBank:"A",nksKnobAssignments:[],nksKnobPage:0,nksKnobTotalPages:0,nksActiveSynthType:null,midiOctaveOffset:0,djKnobPage:0,djKnobTotalPages:kM.length,showPatternDialog:!1,showKnobBar:!1,midiOutputEnabled:!0,init:async()=>{const n=nS();if(!n.isSupported()){if(!/iPhone|iPad|iPod/i.test(navigator.userAgent))return e(e=>{e.isSupported=!1,e.lastError="Web MIDI API not supported in this browser"}),!1;if(await new Promise(e=>setTimeout(e,500)),!n.isSupported())return e(e=>{e.isSupported=!1,e.lastError="Web MIDI API not supported  try opening in Safari (not PWA)"}),!1}e(e=>{e.isSupported=!0});try{if(await n.init()){DM||(DM=!0,n.addMessageHandler(e=>{const n=t();if(n.updateActivity(),"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity){if(lS().getMapping(e.channel,e.note))return;if(36===e.note)return void n.setKnobBank("303");if(37===e.note)return void n.setKnobBank("Siren");if(38===e.note)return void n.setKnobBank("FX");if(39===e.note)return void n.setKnobBank("Mixer");if(40===e.note)return void(EM()?n.prevDJKnobPage():n.prevKnobPage());if(41===e.note)return void(EM()?n.nextDJKnobPage():n.nextKnobPage());const t=n.midiOctaveOffset||0,s=e.note+12*t,a=dS(s).replace("-",""),o=EN.getState(),r=o.currentInstrumentId,i=o.instruments.find(e=>e.id===r),l=o.previewInstrument||i||o.instruments[0];if(l){const t=nM(l.synthType);t&&n.knobBank!==t&&n.setKnobBank(t),n.nksActiveSynthType!==l.synthType&&n.syncKnobsToSynth(l.synthType);const s=Bw(),{midiPolyphonic:o}=Ck.getState(),r=e.velocity/127,i=Math.max(.5,Math.sqrt(r));if(_M.set(e.note,a),o)s.triggerPolyNoteAttack(l.id,a,i,l);else{if(_M.size>1){for(const[n,a]of _M.entries())n!==e.note&&s.triggerPolyNoteRelease(l.id,a,l);const t=_M.get(e.note);_M.clear(),t&&_M.set(e.note,t)}s.triggerPolyNoteAttack(l.id,a,i,l)}}try{const t=require("./useTrackerStore").useTrackerStore.getState(),n=require("./useTransportStore").useTransportStore.getState();if(t.recordMode&&!n.isPlaying){const n=Za(s);if(n>=1&&n<=96){const{cursor:s,setCell:a,moveCursor:r,editStep:i}=t,c=l?.id??o.currentInstrumentId??0,u=Math.round(e.velocity/127*64),d=u>0?16+Math.min(u,64):0;a(s.channelIndex,s.rowIndex,{note:n,instrument:c,volume:d});for(let e=0;e<i;e++)r("down")}}}catch{}return}if("noteOff"===e.type&&void 0!==e.note){if(lS().getMapping(e.channel,e.note))return;const t=_M.get(e.note);if(t){_M.delete(e.note);const n=EN.getState(),s=n.currentInstrumentId,a=n.instruments.find(e=>e.id===s),o=n.previewInstrument||a||n.instruments[0];if(o){Bw().triggerPolyNoteRelease(o.id,t,o)}}return}if("pitchBend"===e.type&&void 0!==e.pitchBend){if(EM()){return void mM("dj.crossfader",(e.pitchBend+8192)/16383)}const t=tM[n.knobBank];if(t?.x){const n=Math.round((e.pitchBend+8192)/16383*127);SM(t.x.param,n)}return}if("cc"===e.type&&void 0!==e.cc&&void 0!==e.value){if(1===e.cc){if(EM())return void mM("dj.deckA.filter",e.value/127);const t=tM[n.knobBank];t?.y&&SM(t.y.param,e.value)}if(n.isLearning&&n.learningParameter)return void n.handleLearnedCC(e.cc);if(e.cc>=70&&e.cc<=77){const t=e.cc-70;if(EM()){const s=kM[n.djKnobPage]?.[t];if(s)return void mM(s.param,e.value/127)}const s=n.nksKnobAssignments[t];if(s)return void SM(s.param,e.value);const a=ZS[n.knobBank].find(t=>t.cc===e.cc);if(a)return void SM(a.param,e.value)}const t=n.ccMappings.find(t=>t.ccNumber===e.cc);if(t){const n=e.value/127;let s;if("logarithmic"===t.curve){const e=Math.max(1,t.min),a=Math.max(e+1,t.max),o=Math.log(e),r=Math.log(a);s=Math.exp(o+n*(r-o))}else s=t.min+n*(t.max-t.min);const a=PM.get(t.parameter);a&&a(s)}}})),n.onDeviceChange(()=>{t().refreshDevices();const n=t();!n.selectedInputId&&n.inputDevices.length>0&&t().selectInput(n.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0})}),t().refreshDevices();const s=t();!s.selectedInputId&&s.inputDevices.length>0&&await t().selectInput(s.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0});aS().init();return rS().init(),e(e=>{e.isInitialized=!0,e.lastError=null}),!0}return e(e=>{e.lastError="Failed to initialize MIDI access"}),!1}catch(s){return e(e=>{e.lastError=s instanceof Error?s.message:"Unknown error"}),!1}},refreshDevices:()=>{const t=nS();e(e=>{e.inputDevices=t.getInputDevices(),e.outputDevices=t.getOutputDevices();const n=t.getSelectedInput(),s=t.getSelectedOutput();e.selectedInputId=n?.id||null,e.selectedOutputId=s?.id||null})},selectInput:async t=>{const n=nS();await n.selectInput(t),e(e=>{e.selectedInputId=t})},selectOutput:t=>{nS().selectOutput(t),e(e=>{e.selectedOutputId=t})},setMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t.ccNumber&&e.parameter!==t.parameter),e.ccMappings.push(t)})},removeMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t)})},resetMappings:()=>{e(e=>{e.ccMappings=[...VM]})},startLearn:t=>{e(e=>{e.isLearning=!0,e.learningParameter=t})},cancelLearn:()=>{e(e=>{e.isLearning=!1,e.learningParameter=null})},handleLearnedCC:n=>{const{learningParameter:s}=t();if(!s)return;const a=VM.find(e=>e.parameter===s),o=a?{...a,ccNumber:n}:{ccNumber:n,parameter:s,min:0,max:100,curve:"linear"};e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==n&&e.parameter!==s),e.ccMappings.push(o),e.isLearning=!1,e.learningParameter=null})},updateActivity:()=>{const n=Date.now(),s=t().lastActivityTimestamp;n-s>100&&e(e=>{e.lastActivityTimestamp=n})},openPatternDialog:()=>{e(e=>{e.showPatternDialog=!0})},closePatternDialog:()=>{e(e=>{e.showPatternDialog=!1})},registerCCHandler:(e,t)=>{PM.set(e,t)},unregisterCCHandler:e=>{PM.delete(e)},setControlledInstrument:t=>{e(e=>{e.controlledInstrumentId=t})},setKnobBank:t=>e(e=>{e.knobBank=t}),togglePadBank:()=>e(e=>{e.padBank="A"===e.padBank?"B":"A"}),setPadBank:t=>e(e=>{e.padBank=t}),syncKnobsToSynth:t=>{const n=sM(t,0),s=function(e){const t=nM(e);if("303"===t)return eM.length;if(t)return 1;const n=QS(e);return 0===n.length?1:Math.ceil(n.length/8)}(t);e(e=>{e.nksKnobAssignments=n,e.nksKnobPage=0,e.nksKnobTotalPages=s,e.nksActiveSynthType=t});const a=n.map(e=>({id:e.param,name:e.label}));wM(t,0,s,a)},nextKnobPage:()=>{const{nksActiveSynthType:n,nksKnobPage:s,nksKnobTotalPages:a}=t();if(!n||a<=1)return;const o=(s+1)%a,r=sM(n,o);e(e=>{e.nksKnobAssignments=r,e.nksKnobPage=o});const i=r.map(e=>({id:e.param,name:e.label}));wM(n,o,a,i)},prevKnobPage:()=>{const{nksActiveSynthType:n,nksKnobPage:s,nksKnobTotalPages:a}=t();if(!n||a<=1)return;const o=(s-1+a)%a,r=sM(n,o);e(e=>{e.nksKnobAssignments=r,e.nksKnobPage=o});const i=r.map(e=>({id:e.param,name:e.label}));wM(n,o,a,i)},setKnobPage:n=>{const{nksActiveSynthType:s,nksKnobTotalPages:a}=t();if(!s||n<0||n>=a)return;const o=sM(s,n);e(e=>{e.nksKnobAssignments=o,e.nksKnobPage=n});const r=o.map(e=>({id:e.param,name:e.label}));wM(s,n,a,r)},setDJKnobPage:t=>{t<0||t>=kM.length||e(e=>{e.djKnobPage=t})},nextDJKnobPage:()=>{const{djKnobPage:n}=t(),s=(n+1)%kM.length;e(e=>{e.djKnobPage=s})},prevDJKnobPage:()=>{const{djKnobPage:n}=t(),s=(n-1+kM.length)%kM.length;e(e=>{e.djKnobPage=s})},setShowKnobBar:t=>{e(e=>{e.showKnobBar=t})},sendCC:(e,n,s=0)=>{const{midiOutputEnabled:a}=t();if(!a)return;const o=nS(),r=Math.max(0,Math.min(127,Math.round(n)));o.sendCC(s,e,r)},setMidiOutputEnabled:t=>{e(e=>{e.midiOutputEnabled=t})},setMidiOctaveOffset:t=>{e(e=>{e.midiOctaveOffset=Math.max(-4,Math.min(4,t))})},gridMappings:{},gridIsLearning:!1,gridLearningParameter:null,addGridMapping:t=>{t.channel<0||t.channel>15||t.controller<0||t.controller>127||t.min>t.max||e(e=>{const n=MM(t.channel,t.controller);e.gridMappings[n]=t})},removeGridMapping:(t,n)=>{e(e=>{const s=MM(t,n);delete e.gridMappings[s]})},getGridMapping:(e,n)=>{const s=MM(e,n);return t().gridMappings[s]},clearGridMappings:()=>{e(e=>{e.gridMappings={}})},startGridLearning:n=>{t().gridIsLearning||e(e=>{e.gridIsLearning=!0,e.gridLearningParameter=n})},stopGridLearning:()=>{e(e=>{e.gridIsLearning=!1,e.gridLearningParameter=null})},applyGridMIDIValue:(e,n,s)=>{const a=t().getGridMapping(e,n);return a?CM(s,a.min,a.max,a.curve):null}})),{name:"midi-settings",partialize:e=>({ccMappings:e.ccMappings,selectedInputId:e.selectedInputId,selectedOutputId:e.selectedOutputId,controlledInstrumentId:e.controlledInstrumentId,knobBank:e.knobBank,showKnobBar:e.showKnobBar,djKnobPage:e.djKnobPage,midiOutputEnabled:e.midiOutputEnabled,midiOctaveOffset:e.midiOctaveOffset,gridMappings:e.gridMappings})}));EN.subscribe((e,t)=>{if(e.currentInstrumentId!==t.currentInstrumentId){const t=e.instruments.find(t=>t.id===e.currentInstrumentId);if(!t)return;const n=OM.getState(),s=nM(t.synthType);s&&n.knobBank!==s&&n.setKnobBank(s),n.nksActiveSynthType!==t.synthType&&n.syncKnobsToSynth(t.synthType)}});const TM=new Map,LM=new Map,AM=new Map,BM=new Map,IM=new Map;function FM(){return{activeNotes:TM,adsrStages:LM,adsrProgress:AM,lfoPhases:BM,samplePositions:IM}}let UM=!1;function RM(){UM||(UM=!0,queueMicrotask(()=>{UM=!1,jM.setState(e=>({version:e.version+1}))}))}const jM=i(()=>({version:0,setActiveNote:(e,t)=>{const n=TM.get(e);if(n){const e=n.findIndex(e=>e.note===t.note);e>=0?n[e]=t:n.push(t)}else TM.set(e,[t]);RM()},clearActiveNote:(e,t)=>{const n=TM.get(e);if(!n)return;const s=n.filter(e=>e.note!==t);0===s.length?TM.delete(e):TM.set(e,s),RM()},clearChannelNotes:e=>{TM.delete(e),RM()},clearAllNotes:()=>{TM.clear(),RM()},setADSRStage:(e,t,n=0)=>{LM.set(e,t),AM.set(e,n),RM()},setADSRProgress:(e,t)=>{AM.set(e,t),RM()},setLFOPhase:(e,t)=>{BM.set(e,t),RM()},setSamplePosition:(e,t)=>{IM.set(e,Math.max(0,Math.min(1,t))),RM()},clearSamplePosition:e=>{IM.delete(e),RM()}})),XM=i()(ds((e,t)=>({isLiveMode:!1,pendingPatternIndex:null,pendingPositionIndex:null,queueMode:"end-of-pattern",channelQueues:new Map,showQueueCountdown:!0,barsUntilSwitch:0,toggleLiveMode:()=>{const n=!t().isLiveMode;e(e=>{e.isLiveMode=n,n||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues=new Map)})},setLiveMode:t=>{e(e=>{e.isLiveMode=t,t||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues.clear())})},queuePattern:t=>{e(e=>{e.pendingPatternIndex=t})},queuePosition:t=>{e(e=>{e.pendingPositionIndex=t})},clearQueue:()=>{e(e=>{e.pendingPatternIndex=null,e.pendingPositionIndex=null})},setQueueMode:t=>{e(e=>{e.queueMode=t})},queueChannelAction:(t,n)=>{e(e=>{const s=e.channelQueues.get(t)||[];s.push(n),e.channelQueues.set(t,s)})},clearChannelQueue:t=>{e(e=>{e.channelQueues.delete(t)})},popChannelAction:n=>{const s=t().channelQueues.get(n);if(!s||0===s.length)return;const a=s.shift();return e(e=>{0===s.length?e.channelQueues.delete(n):e.channelQueues.set(n,s)}),a},updateBarsUntilSwitch:t=>{e(e=>{e.barsUntilSwitch=t})},setShowQueueCountdown:t=>{e(e=>{e.showQueueCountdown=t})}}))),zM={horizontalZoom:24,verticalZoom:18,scrollX:0,scrollY:0,snapToGrid:!0,gridDivision:4,showVelocity:!0,showVelocityLane:!1,channelIndex:0,multiChannel:!1,scaleKey:"chromatic",scaleRoot:0,noteLengthPreset:0},GM={notes:new Set,startRow:null,endRow:null,startNote:null,endNote:null},HM=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function WM(e){const t=Math.floor(e/12)-1;return`${HM[e%12]}${t}`}function qM(e){return[1,3,6,8,10].includes(e%12)}const KM=[{label:"Grid",value:0},{label:"1/32",value:1},{label:"1/16",value:2},{label:"1/8",value:4},{label:"1/4",value:8},{label:"1/2",value:16},{label:"1/1",value:32}],$M=i()(ds((e,t)=>({view:{...zM},selection:{...GM,notes:new Set},drag:{isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},tool:"select",clipboard:null,contextMenu:{visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},ghostNotes:[],setHorizontalZoom:t=>e(e=>{e.view.horizontalZoom=Math.max(4,Math.min(64,t))}),setVerticalZoom:t=>e(e=>{e.view.verticalZoom=Math.max(8,Math.min(32,t))}),setScroll:(t,n)=>e(e=>{e.view.scrollX=Math.max(0,t),e.view.scrollY=Math.max(0,Math.min(127,n))}),scrollBy:(t,n)=>e(e=>{e.view.scrollX=Math.max(0,e.view.scrollX+t),e.view.scrollY=Math.max(0,Math.min(127,e.view.scrollY+n))}),setSnapToGrid:t=>e(e=>{e.view.snapToGrid=t}),setGridDivision:t=>e(e=>{e.view.gridDivision=t}),setShowVelocity:t=>e(e=>{e.view.showVelocity=t}),setShowVelocityLane:t=>e(e=>{e.view.showVelocityLane=t}),setChannelIndex:t=>e(e=>{e.view.channelIndex=t}),setMultiChannel:t=>e(e=>{e.view.multiChannel=t}),setScaleKey:t=>e(e=>{e.view.scaleKey=t}),setScaleRoot:t=>e(e=>{e.view.scaleRoot=Math.max(0,Math.min(11,t))}),setNoteLengthPreset:t=>e(e=>{e.view.noteLengthPreset=t}),selectNote:(t,n=!1)=>e(e=>{n?e.selection.notes.add(t):e.selection.notes=new Set([t])}),selectNotes:t=>e(e=>{e.selection.notes=new Set(t)}),selectAll:t=>e(e=>{e.selection.notes=new Set(t)}),deselectNote:t=>e(e=>{e.selection.notes.delete(t)}),clearSelection:()=>e(e=>{e.selection.notes=new Set,e.selection.startRow=null,e.selection.endRow=null,e.selection.startNote=null,e.selection.endNote=null}),setSelectionBox:(t,n,s,a)=>e(e=>{e.selection.startRow=t,e.selection.endRow=n,e.selection.startNote=s,e.selection.endNote=a}),startDrag:(t,n,s,a)=>e(e=>{e.drag.isDragging=!0,e.drag.mode=t,e.drag.startX=n,e.drag.startY=s,e.drag.currentX=n,e.drag.currentY=s,e.drag.noteId=a||null}),updateDrag:(t,n)=>e(e=>{e.drag.currentX=t,e.drag.currentY=n}),endDrag:()=>e(e=>{e.drag.isDragging=!1,e.drag.mode="none",e.drag.noteId=null,e.drag.originalNotes=[],e.ghostNotes=[]}),setTool:t=>e(e=>{e.tool=t}),copyNotes:t=>e(e=>{if(0===t.length)return;const n=Math.min(...t.map(e=>e.startRow)),s=Math.min(...t.map(e=>e.midiNote));e.clipboard={notes:t.map(e=>({...e})),minRow:n,minNote:s}}),getClipboard:()=>t().clipboard,showContextMenu:(t,n,s,a,o)=>e(e=>{e.contextMenu={visible:!0,x:t,y:n,noteId:s,row:a,midiNote:o}}),hideContextMenu:()=>e(e=>{e.contextMenu.visible=!1}),setGhostNotes:t=>e(e=>{e.ghostNotes=t}),clearGhostNotes:()=>e(e=>{e.ghostNotes=[]}),resetView:()=>e(e=>{e.view={...zM},e.selection={...GM,notes:new Set},e.drag={isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},e.tool="select",e.clipboard=null,e.contextMenu={visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},e.ghostNotes=[]})})));const YM=new class{buffer=[];encode(e){return this.buffer=[],this.writeValue(e),new Uint8Array(this.buffer)}writeValue(e){null==e?this.buffer.push(192):"boolean"==typeof e?this.buffer.push(e?195:194):"number"==typeof e?Number.isInteger(e)?this.writeInt(e):this.writeFloat64(e):"string"==typeof e?this.writeString(e):Array.isArray(e)?this.writeArray(e):"object"==typeof e&&this.writeMap(e)}writeInt(e){e>=0?e<=127?this.buffer.push(e):e<=255?this.buffer.push(204,e):e<=65535?this.buffer.push(205,e>>8&255,255&e):this.buffer.push(206,e>>24&255,e>>16&255,e>>8&255,255&e):e>=-32?this.buffer.push(255&e):e>=-128?this.buffer.push(208,255&e):e>=-32768?this.buffer.push(209,e>>8&255,255&e):this.buffer.push(210,e>>24&255,e>>16&255,e>>8&255,255&e)}writeFloat64(e){this.buffer.push(203);const t=new ArrayBuffer(8);new DataView(t).setFloat64(0,e,!1);const n=new Uint8Array(t);for(let s=0;s<8;s++)this.buffer.push(n[s])}writeString(e){const t=(new TextEncoder).encode(e),n=t.length;n<=31?this.buffer.push(160|n):n<=255?this.buffer.push(217,n):n<=65535?this.buffer.push(218,n>>8&255,255&n):this.buffer.push(219,n>>24&255,n>>16&255,n>>8&255,255&n);for(let s=0;s<n;s++)this.buffer.push(t[s])}writeArray(e){const t=e.length;t<=15?this.buffer.push(144|t):t<=65535?this.buffer.push(220,t>>8&255,255&t):this.buffer.push(221,t>>24&255,t>>16&255,t>>8&255,255&t);for(const n of e)this.writeValue(n)}writeMap(e){const t=Object.keys(e),n=t.length;n<=15?this.buffer.push(128|n):n<=65535?this.buffer.push(222,n>>8&255,255&n):this.buffer.push(223,n>>24&255,n>>16&255,n>>8&255,255&n);for(const s of t)this.writeString(s),this.writeValue(e[s])}},JM=new class{data;view;offset=0;decode(e){return this.data=e,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.offset=0,this.readValue()}readValue(){if(this.offset>=this.data.length)return null;const e=this.data[this.offset++];if(e<=127)return e;if(e>=128&&e<=143)return this.readMapEntries(15&e);if(e>=144&&e<=159)return this.readArrayEntries(15&e);if(e>=160&&e<=191)return this.readStringBytes(31&e);if(e>=224)return e-256;switch(e){case 192:default:return null;case 194:return!1;case 195:return!0;case 202:{const e=this.view.getFloat32(this.offset,!1);return this.offset+=4,e}case 203:{const e=this.view.getFloat64(this.offset,!1);return this.offset+=8,e}case 204:return this.data[this.offset++];case 205:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,e}case 206:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,e}case 208:{const e=this.view.getInt8(this.offset);return this.offset+=1,e}case 209:{const e=this.view.getInt16(this.offset,!1);return this.offset+=2,e}case 210:{const e=this.view.getInt32(this.offset,!1);return this.offset+=4,e}case 217:{const e=this.data[this.offset++];return this.readStringBytes(e)}case 218:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readStringBytes(e)}case 219:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readStringBytes(e)}case 220:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readArrayEntries(e)}case 221:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readArrayEntries(e)}case 222:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readMapEntries(e)}case 223:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readMapEntries(e)}case 196:{const e=this.data[this.offset++];return this.readBinaryBytes(e)}case 197:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readBinaryBytes(e)}case 198:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readBinaryBytes(e)}}}readStringBytes(e){const t=this.data.subarray(this.offset,this.offset+e);return this.offset+=e,(new TextDecoder).decode(t)}readBinaryBytes(e){const t=this.data.slice(this.offset,this.offset+e);return this.offset+=e,t}readArrayEntries(e){const t=[];for(let n=0;n<e;n++)t.push(this.readValue());return t}readMapEntries(e){const t={};for(let n=0;n<e;n++){t[String(this.readValue())]=this.readValue()}return t}};function QM(e){return YM.encode(e)}function ZM(e){return JM.decode(e)}const eC=1380533830,tC=1313426259,nC=1313428297,sC=1313424193,aC=1346586699,oC=1347176772;async function rC(e){const t=new DataView(e).getUint32(0,!1);if(t===eC)return function(e){const t=new DataView(e);let n=0;const s=t.getUint32(n,!1);if(s!==eC)throw new Error("Invalid RIFF header");n+=4;const a=t.getUint32(n,!0);n+=4;const o=t.getUint32(n,!1);if(o!==tC)throw new Error("Invalid NIKS form type");n+=4;const r={vendor:PS,uuid:_S,version:"1.0"},i={};let l,c;const u=Math.min(8+a,e.byteLength);for(;n+8<=u;){const s=t.getUint32(n,!1),a=t.getUint32(n+4,!0);n+=8;const o=n+a;switch(s){case nC:{const t=new Uint8Array(e,n+4,a-4);try{const e=ZM(t);e.name&&(r.name=String(e.name)),e.vendor&&(r.vendor=String(e.vendor)),e.author&&(r.author=String(e.author)),e.comment&&(r.comment=String(e.comment)),e.deviceType&&(r.deviceType=String(e.deviceType)),e.UUID&&(r.uuid=String(e.UUID)),Array.isArray(e.bankchain)&&(r.bankChain=e.bankchain.map(String).slice(0,3)),Array.isArray(e.types)&&(r.types=e.types.map(e=>Array.isArray(e)?e.map(String):[String(e),""])),Array.isArray(e.Character)&&(r.modes=e.Character.map(String))}catch(d){}break}case sC:{const t=new Uint8Array(e,n+4,a-4);try{const e=ZM(t);if(e.ni8&&Array.isArray(e.ni8)){c=e.ni8;for(const e of c)if(Array.isArray(e))for(const t of e)t&&"object"==typeof t&&"id"in t&&(i[`param.${t.id}`]=0)}}catch(d){}break}case oC:{const t=new Uint8Array(e,n+4,a-4);try{const e=ZM(t);void 0!==e["VST.magic"]&&(r.vstMagic=Number(e["VST.magic"])),Array.isArray(e["VST3.uid"])&&4===e["VST3.uid"].length&&(r.vst3Uid=e["VST3.uid"].map(Number))}catch(d){}break}case aC:l=e.slice(n+4,o)}n=o,n%2!=0&&n++}return{metadata:r,parameters:i,blob:l}}(e);if(t===SS)return function(e){const t=new DataView(e);let n=0;n+=8;const s={vendor:PS,uuid:_S,version:"1.0"},a={};let o;for(;n<e.byteLength;){const i=t.getUint32(n,!1),l=t.getUint32(n+4,!0);n+=8;const c=n;switch(i){case MS:{const t=cC(new Uint8Array(e,c,l));try{Object.assign(s,JSON.parse(t))}catch(r){}break}case CS:{const t=new DataView(e,c,l);let n=0;const s=t.getUint32(n,!0);n+=4;const o=s>0&&n<l?t.getUint8(n):0;if(o>0&&o<128&&n+1+o+4<=l)for(let r=0;r<s&&n<l;r++){const s=t.getUint8(n);n+=1;const o=new Uint8Array(e,c+n,s);n+=s,a[(new TextDecoder).decode(o)]=t.getFloat32(n,!0),n+=4}else for(let e=0;e<s&&n+8<=l;e++){const e=t.getUint32(n,!0);n+=4,a[`param.${e}`]=t.getFloat32(n,!0),n+=4}break}case VS:o=e.slice(c,c+l)}n=c+l}return{metadata:s,parameters:a,blob:o}}(e);throw new Error("Invalid NKSF file: unrecognized header")}function iC(e){const t=[],n=function(e){const t={};void 0!==e.vstMagic&&(t["VST.magic"]=e.vstMagic);e.vst3Uid&&(t["VST3.uid"]=[...e.vst3Uid]);t["VST.magic"]||t["VST3.uid"]||(t["VST.magic"]=function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t>>>0}(e.uuid||_S));const n=QM(t);return lC(oC,1,n)}(e.metadata);t.push(n);const s=function(e){const t={};t.name=e.name||"Untitled",t.vendor=e.vendor||PS,t.deviceType=e.deviceType||"INST",t.bankchain=e.bankChain||["DEViLBOX"],e.author&&(t.author=e.author);e.comment&&(t.comment=e.comment);e.uuid&&(t.UUID=e.uuid);e.types&&e.types.length>0&&(t.types=e.types.map(e=>e.length>=2?[e[0],e[1]]:[e[0]||"",""]));e.modes&&e.modes.length>0&&(t.Character=e.modes);const n=QM(t);return lC(nC,1,n)}(e.metadata);t.push(s);const a=function(e){const t=e.nicaPages;if(t&&t.length>0)return function(e){const t=[];for(const a of e){const e=[];for(let t=0;t<8;t++){const n=a[t];if(!n||void 0===n.id&&!n.name){e.push({name:""});continue}const s={name:n.name||""};void 0!==n.id&&n.id>=0&&(s.id=n.id),n.section&&(s.section=n.section),!0===n.autoname&&(s.autoname=!0),!0===n.vflag&&(s.vflag=!0),e.push(s)}t.push(e)}0===t.length&&t.push(Array.from({length:8},()=>({name:""})));const n={ni8:t},s=QM(n);return lC(sC,1,s)}(t);const n=Object.entries(e.parameters),s=[];let a=[];for(let r=0;r<n.length;r++){const[e]=n[r],t={name:e};e.startsWith("param.")?t.id=parseInt(e.replace("param.",""),10):t.id=r,a.push(t),8===a.length&&(s.push(a),a=[])}if(a.length>0){for(;a.length<8;)a.push({name:""});s.push(a)}0===s.length&&s.push(Array.from({length:8},()=>({name:""})));const o=QM({ni8:s});return lC(sC,1,o)}(e);if(t.push(a),e.blob){const n=(o=e.blob,lC(aC,1,new Uint8Array(o)));t.push(n)}var o;const r=4+t.reduce((e,t)=>e+(t.byteLength+t.byteLength%2),0),i=new ArrayBuffer(8+r),l=new DataView(i);let c=0;l.setUint32(c,eC,!1),c+=4,l.setUint32(c,r,!0),c+=4,l.setUint32(c,tC,!1),c+=4;for(const u of t)new Uint8Array(i,c,u.byteLength).set(new Uint8Array(u)),c+=u.byteLength,c%2!=0&&(l.setUint8(c,0),c++);return i}function lC(e,t,n){const s=4+n.byteLength,a=new ArrayBuffer(8+s),o=new DataView(a);return o.setUint32(0,e,!1),o.setUint32(4,s,!0),o.setUint32(8,t,!0),new Uint8Array(a,12,n.byteLength).set(n),a}function cC(e){let t=e.indexOf(0);return-1===t&&(t=e.length),(new TextDecoder).decode(e.subarray(0,t))}const uC=["Acoustic","Additive","Airy","Analog","Arpeggiated","Bright","Chord","Clean","Dark","Deep","Digital","Dirty","Distorted","Dry","Electric","Evolving","Filtered","FM","Glide / Pitch Mod","Granular","Huge","Human","Layered","Lead","Lick","Lo-Fi","Long Release","Melodic","Metallic","Mono Aftertouch","Monophonic","Percussive","Physical Model","Poly Aftertouch","Processed","Riser","Sample-based","Stabs & Hits","Sub","Surround","Synthetic","Tempo-synced","Top","Vinyl","Vocoded","Wet"],dC=new Set(["Bass","Bowed Strings","Brass","Drums","Flute","Guitar","Mallet Instruments","Organ","Percussion","Piano / Keys","Plucked Strings","Reed Instruments","Sound Effects","Soundscapes","Synth Lead","Synth Misc","Synth Pad","Vocal"]);function mC(e){return dC.has(e)}new Set(uC),new Set(["Amps & Cabinets","Audio Repair","Character","Delay","Distortion","Dynamics","EQ","Filter","Mix Chain","Modulation","Multi FX","Pitch","Reverb","Specialized","Surround","Utilities"]),new Set(["Bass","Drums","Guitar","Keys","Mastering","Mixbus","Pads","Piano","Plucks","Special FX","Strings","Synth","Vocal"]);const pC={TB303:{type:"Bass",subType:"Synth",characters:["Analog","Monophonic"]},Buzz3o3DF:{type:"Bass",subType:"Synth",characters:["Analog","Monophonic"]},FMSynth:{type:"Synth Lead",subType:"Classic Poly",characters:["FM","Digital"]},Dexed:{type:"Synth Lead",subType:"Classic Poly",characters:["FM","Digital"]},DexedBridge:{type:"Synth Lead",subType:"Classic Poly",characters:["FM","Digital"]},MonoSynth:{type:"Synth Lead",subType:"Classic Mono",characters:["Analog","Monophonic"]},PolySynth:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog"]},AMSynth:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog"]},DuoSynth:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Layered"]},Synth:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},OBXd:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Huge"]},V2:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Digital"]},V2Speech:{type:"Vocal",subType:"Computer",characters:["Synthetic","Digital"]},Wavetable:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},Vital:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},Odin2:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Digital"]},Surge:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},Monique:{type:"Synth Lead",subType:"Classic Mono",characters:["Analog","Monophonic"]},DubSiren:{type:"Sound Effects",subType:"Synth",characters:["Analog","Dirty"]},SpaceLaser:{type:"Sound Effects",subType:"Synth",characters:["Digital","Percussive"]},Synare:{type:"Drums",subType:"Tom",characters:["Analog","Percussive"]},GranularSynth:{type:"Synth Misc",subType:"Sweeps & Swells",characters:["Granular","Evolving"]},FormantSynth:{type:"Vocal",subType:"Synth Choir",characters:["Synthetic","Human"]},Sam:{type:"Vocal",subType:"Computer",characters:["Digital","Synthetic"]},PWMSynth:{type:"Synth Lead",subType:"Classic Mono",characters:["Analog","Monophonic"]},SuperSaw:{type:"Synth Lead",subType:"Classic Poly",characters:["Huge","Bright"]},WobbleBass:{type:"Bass",subType:"Synth",characters:["Digital","Filtered"]},StringMachine:{type:"Synth Pad",subType:"Basic",characters:["Analog","Layered"]},ChipSynth:{type:"Synth Misc",subType:"Classic",characters:["Digital","Lo-Fi"]},MembraneSynth:{type:"Drums",subType:"Kick",characters:["Analog","Percussive"]},MetalSynth:{type:"Drums",subType:"Hi-Hat",characters:["Metallic","Percussive"]},NoiseSynth:{type:"Sound Effects",subType:"Noise",characters:["Synthetic"]},DrumMachine:{type:"Drums",subType:"Kit",characters:["Analog","Percussive"]},DrumKit:{type:"Drums",subType:"Kit",characters:["Sample-based"]},TonewheelOrgan:{type:"Organ",subType:"Electric",characters:["Electric","Analog"]},Organ:{type:"Organ",subType:"Electric",characters:["Electric"]},PluckSynth:{type:"Plucked Strings",subType:"Other",characters:["Physical Model","Percussive"]},Melodica:{type:"Reed Instruments",subType:"Melodica",characters:["Acoustic","Airy"]},WAM:{type:"Synth Lead",subType:"Other",characters:["Digital"]}},hC={Bass:{bankChain:["DEViLBOX","Bass"],type:"Bass"},Lead:{bankChain:["DEViLBOX","Lead"],type:"Synth Lead"},Pad:{bankChain:["DEViLBOX","Pad"],type:"Synth Pad"},Drum:{bankChain:["DEViLBOX","Drum"],type:"Drums"},FX:{bankChain:["DEViLBOX","FX"],type:"Sound Effects"},User:{bankChain:["DEViLBOX","User"],type:"Synth Misc"}};function fC(e){const t=e.toLowerCase();return t.includes("bass")?"Bass":t.includes("lead")||"synth lead"===t?"Lead":t.includes("pad")||"synth pad"===t||"soundscapes"===t?"Pad":t.includes("drum")||t.includes("percussion")?"Drum":t.includes("effect")||t.includes("sound effects")?"FX":"User"}const gC={Bass:hC.Bass.bankChain,Lead:hC.Lead.bankChain,Pad:hC.Pad.bankChain,Drum:hC.Drum.bankChain,FX:hC.FX.bankChain,User:hC.User.bankChain};function bC(e){for(const n of e)if(mC(n))return fC(n);const t=e.join(" ").toLowerCase();return t.includes("bass")?"Bass":t.includes("lead")||t.includes("synth lead")?"Lead":t.includes("pad")||t.includes("ambient")||t.includes("soundscape")?"Pad":t.includes("drum")||t.includes("perc")?"Drum":t.includes("fx")||t.includes("effect")||t.includes("sound effect")?"FX":"User"}function vC(e,t){const n=[];return e&&n.push(...e.flat().filter(Boolean).map(e=>e.toLowerCase())),t&&n.push(...t.map(e=>e.toLowerCase())),[...new Set(n)]}function yC(e){const t=[],n=function(e){return e.filter(e=>uC.some(t=>t.toLowerCase()===e.toLowerCase())).map(e=>uC.find(t=>t.toLowerCase()===e.toLowerCase())||e)}(e);for(const s of e)mC(s)&&t.push(s);if(0===t.length){const n=e.join(" ").toLowerCase();n.includes("bass")?t.push("Bass"):n.includes("lead")?t.push("Synth Lead"):n.includes("pad")?t.push("Synth Pad"):n.includes("drum")||n.includes("perc")?t.push("Drums"):n.includes("fx")||n.includes("effect")?t.push("Sound Effects"):n.includes("key")||n.includes("piano")?t.push("Piano / Keys"):n.includes("organ")?t.push("Organ"):n.includes("vocal")||n.includes("voice")?t.push("Vocal"):n.includes("string")?t.push("Bowed Strings"):n.includes("brass")&&t.push("Brass")}return{types:t,modes:n}}function xC(e,t){const n=e.synthType,s=function(e,t){const n={},s=e.synthType.toLowerCase();for(const a of t){const t=a.id.replace(`${s}.`,"").split(".");let o=e;const r=e[s];r&&"object"==typeof r&&(o=r);for(const n of t){if(!o||"object"!=typeof o||!(n in o)){if("cutoff"===n&&void 0!==e.filter?.frequency){o=e.filter.frequency;break}if("resonance"===n&&void 0!==e.filter?.Q){o=e.filter.Q;break}if("attack"===n&&void 0!==e.envelope?.attack){o=e.envelope.attack;break}if("decay"===n&&void 0!==e.envelope?.decay){o=e.envelope.decay;break}if("sustain"===n&&void 0!==e.envelope?.sustain){o=e.envelope.sustain;break}if("release"===n&&void 0!==e.envelope?.release){o=e.envelope.release;break}o=void 0;break}o=o[n]}if("number"==typeof o){const e=(o-a.min)/(a.max-a.min);n[a.id]=Math.max(0,Math.min(1,e))}else if("boolean"==typeof o)n[a.id]=o?1:0;else if("string"==typeof o&&a.valueStrings){const e=a.valueStrings.indexOf(o);n[a.id]=-1!==e?e/Math.max(1,a.valueStrings.length-1):a.defaultValue}else n[a.id]=a.defaultValue}return n}(e,HS(n)),{types:a,modes:o}=yC(t?.tags||[]),r=t?.category?gC[t.category]:["DEViLBOX",e.synthType],i=function(e,t){const n=pC[e];if(n)return n;const s=e;if(s.startsWith("Furnace")||s.startsWith("MAME")||s.startsWith("Buzz"))return{type:"Synth Misc",subType:"Classic",characters:["Digital","Lo-Fi"]};if(s.includes("Bridge")||s.includes("VST"))return{type:"Synth Lead",subType:"Other",characters:["Digital"]};if(t)return{type:hC[t].type};return{type:"Synth Misc"}}(n,t?.category),l=a.length>0?a.map(e=>[e]):[[i.type]],c=o.length>0?o:i.characters;return{metadata:{vendor:PS,uuid:_S,version:"1.0",name:t?.name||e.name,author:t?.author||"DEViLBOX User",comment:t?.comment||`${n} preset for DEViLBOX`,deviceType:"INST",bankChain:r,types:l,modes:c,isUser:!0},parameters:s,blob:(new TextEncoder).encode(JSON.stringify(e)).buffer}}function NC(e,t,n){if(e.blob)try{const n=(new TextDecoder).decode(new Uint8Array(e.blob)),s=JSON.parse(n);if(s.synthType)return{...s,id:t,name:e.metadata.name||s.name||"NKS Preset"}}catch{}const s=n||function(e){const t=e.bankChain.join(" ").toLowerCase(),n=(e.types||[]).flat().join(" ").toLowerCase(),s=(e.comment||"").toLowerCase(),a=(e.name||"").toLowerCase(),o=`${t} ${n} ${s} ${a}`;return o.includes("tb303")||o.includes("db303")||o.includes("open303")?"TB303":o.includes("tb808")||o.includes("808")||o.includes("drum machine")?"DrumMachine":o.includes("dub siren")||o.includes("dubsiren")?"DubSiren":o.includes("space laser")||o.includes("spacelaser")?"SpaceLaser":o.includes("synare")?"Synare":o.includes("dexed")||o.includes("dx7")?"Dexed":o.includes("obxd")||o.includes("ob-x")?"OBXd":o.includes("v2synth")||o.includes("v2 synth")?"V2":o.includes("vital")?"Vital":o.includes("odin")?"Odin2":o.includes("surge")?"Surge":o.includes("tonewheel")||o.includes("organ")?"TonewheelOrgan":o.includes("melodica")?"Melodica":o.includes("sam")&&o.includes("speech")?"Sam":o.includes("supersaw")?"SuperSaw":o.includes("wobble")?"WobbleBass":o.includes("string machine")?"StringMachine":o.includes("chip")&&o.includes("synth")?"ChipSynth":o.includes("pwm")?"PWMSynth":o.includes("formant")?"FormantSynth":o.includes("granular")?"GranularSynth":o.includes("wavetable")?"Wavetable":o.includes("fm")||n.includes("fm")?"FMSynth":o.includes("membrane")||o.includes("kick")?"MembraneSynth":o.includes("metal")||o.includes("hihat")||o.includes("cymbal")?"MetalSynth":o.includes("pluck")?"PluckSynth":o.includes("noise")?"NoiseSynth":o.includes("duo")?"DuoSynth":o.includes("am synth")||o.includes("amsyn")?"AMSynth":n.includes("synth lead")&&o.includes("mono")?"MonoSynth":n.includes("synth lead")||n.includes("synth pad")?"PolySynth":n.includes("bass")?"MonoSynth":null}(e.metadata)||"Synth",a=HS(s),o={id:t,name:e.metadata.name||"NKS Preset",type:"synth",synthType:s,effects:[],volume:-6,pan:0};return function(e,t,n){const s=e.synthType.toLowerCase(),a={};for(const o of n){const n=t[o.id];if(void 0===n)continue;const r=n*(o.max-o.min)+o.min,i=o.id.replace(`${s}.`,""),l=i.split(".");let c=a;for(let e=0;e<l.length-1;e++)l[e]in c||(c[l[e]]={}),c=c[l[e]];const u=l[l.length-1];if(o.valueStrings&&o.valueStrings.length>0){const e=Math.round(n*(o.valueStrings.length-1));c[u]=o.valueStrings[Math.min(e,o.valueStrings.length-1)]}else 2===o.type?c[u]=n>=.5:c[u]=r;"cutoff"!==u&&"frequency"!==u||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.frequency=r),"resonance"!==u&&"Q"!==u||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.Q=r),"attack"!==u||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.attack=r),"decay"!==u||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.decay=r),"sustain"!==u||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.sustain=r),"release"!==u||i.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.release=r)}Object.keys(a).length>0&&(e[s]=a)}(o,e.parameters,a),o}function wC(e){return xC({id:0,...e.config},{name:e.name,category:e.category,tags:e.tags})}function EC(e,t){const n=NC(e,0,t),{id:s,...a}=n;return{name:e.metadata.name||"NKS Preset",category:bC(e.metadata.bankChain),synthType:n.synthType,tags:vC(e.metadata.types,e.metadata.modes),config:a}}function kC(e,t){const n=iC(xC(e,t)),s=new Blob([n],{type:"application/octet-stream"}),a=URL.createObjectURL(s),o=`${t?.name||e.name||"preset"}.nksf`,r=document.createElement("a");r.href=a,r.download=o,r.click(),URL.revokeObjectURL(a)}const DC=()=>"undefined"!=typeof window&&!0===window.electron?.isElectron,SC=()=>DC()&&!!window.electron?.fs,MC="http://localhost:3001/api",CC=i()(TN(e=>({user:null,token:null,isLoading:!1,error:null,isElectron:SC(),isServerAvailable:!1,signup:async(t,n)=>{e({isLoading:!0,error:null});try{const s=await fetch(`${MC}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})});if(!s.ok){const e=await s.json();throw new Error(e.error||"Signup failed")}const a=await s.json();e({user:a.user,token:a.token,isLoading:!1,error:null})}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"Signup failed"}),s}},login:async(t,n)=>{e({isLoading:!0,error:null});try{const s=await fetch(`${MC}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})});if(!s.ok){const e=await s.json();throw new Error(e.error||"Login failed")}const a=await s.json();e({user:a.user,token:a.token,isLoading:!1,error:null})}catch(s){throw e({isLoading:!1,error:s instanceof Error?s.message:"Login failed"}),s}},logout:()=>{e({user:null,token:null,error:null})},clearError:()=>{e({error:null})},checkServerAvailability:async()=>{try{const t=(await fetch(`${MC}/health`,{method:"GET",signal:AbortSignal.timeout(3e3)})).ok;return e({isServerAvailable:t}),t}catch(t){return e({isServerAvailable:!1}),!1}}}),{name:"devilbox-auth",partialize:e=>({user:e.user,token:e.token})}));async function VC(e,t){const n=await fetch(e,t);return 403===n.status&&CC.getState().logout(),n}const PC="http://localhost:3001/api";function _C(){const{token:e,user:t}=CC.getState();return!!e&&!!t}function OC(){const{token:e}=CC.getState();return{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}}}async function TC(e="songs"){if(!_C())throw new Error("Not authenticated");const t=await VC(`${PC}/files?type=${e}`,{headers:OC()});if(!t.ok){const e=await t.json().catch(()=>({error:"Failed to list files"}));throw new Error(e.error||"Failed to list files")}return(await t.json()).files||[]}async function LC(e){if(!_C())throw new Error("Not authenticated");const t=await VC(`${PC}/files/${e}`,{headers:OC()});if(!t.ok){const e=await t.json().catch(()=>({error:"Failed to get file"}));throw new Error(e.error||"Failed to get file")}return t.json()}async function AC(e,t,n="songs"){if(!_C())throw new Error("Not authenticated");const s=await VC(`${PC}/files`,{method:"POST",headers:OC(),body:JSON.stringify({filename:e,data:t,type:n})});if(!s.ok){const e=await s.json().catch(()=>({error:"Failed to save file"}));throw new Error(e.error||"Failed to save file")}return s.json()}let BC=null,IC=0;function FC(e){return`__sync_${e}.json`}async function UC(){const e=Date.now();if(BC&&e-IC<3e4)return BC;try{const t=await TC("presets");return BC=t.map(e=>({id:e.id,filename:e.filename})),IC=e,BC}catch{return BC||[]}}async function RC(e,t,n=1){if(!_C())return;const s=FC(e),a={version:n,data:t,updatedAt:Date.now()};try{const e=(await UC()).find(e=>e.filename===s);e?await async function(e,t,n){if(!_C())throw new Error("Not authenticated");const s=await VC(`${PC}/files/${e}`,{method:"PUT",headers:OC(),body:JSON.stringify({filename:t,data:n})});if(!s.ok){const e=await s.json().catch(()=>({error:"Failed to update file"}));throw new Error(e.error||"Failed to update file")}return s.json()}(e.id,s,a):(await AC(s,a,"presets"),BC=null,IC=0)}catch(o){}}async function jC(e){if(!_C())return null;const t=FC(e);try{const e=(await UC()).find(e=>e.filename===t);if(!e)return null;const n=(await LC(e.id)).data;return n&&void 0!==n.data?{data:n.data,updatedAt:n.updatedAt||0}:null}catch(n){return null}}const XC=Object.freeze(Object.defineProperty({__proto__:null,pullFromCloud:jC,pushToCloud:RC},Symbol.toStringTag,{value:"Module"})),zC=i()(TN(ds((e,t)=>({playlists:[],activePlaylistId:null,createPlaylist:t=>{const n=`playlist-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,s=Date.now();return e(e=>{e.playlists.push({id:n,name:t,createdAt:s,updatedAt:s,tracks:[]}),e.activePlaylistId=n}),HC(),n},deletePlaylist:t=>{e(e=>{e.playlists=e.playlists.filter(e=>e.id!==t),e.activePlaylistId===t&&(e.activePlaylistId=e.playlists[0]?.id??null)}),HC()},renamePlaylist:(t,n)=>{e(e=>{const s=e.playlists.find(e=>e.id===t);s&&(s.name=n,s.updatedAt=Date.now())}),HC()},setActivePlaylist:t=>{e(e=>{e.activePlaylistId=t})},addTrack:(t,n)=>{e(e=>{const s=e.playlists.find(e=>e.id===t);s&&(s.tracks.push(n),s.updatedAt=Date.now())}),HC()},removeTrack:(t,n)=>{e(e=>{const s=e.playlists.find(e=>e.id===t);s&&n>=0&&n<s.tracks.length&&(s.tracks.splice(n,1),s.updatedAt=Date.now())}),HC()},reorderTrack:(t,n,s)=>{e(e=>{const a=e.playlists.find(e=>e.id===t);if(a){const[e]=a.tracks.splice(n,1);a.tracks.splice(s,0,e),a.updatedAt=Date.now()}}),HC()},importPlaylists:t=>{e(e=>{for(const n of t){const t=e.playlists.find(e=>e.id===n.id);t?Object.assign(t,n):e.playlists.push(n)}})}})),{name:"devilbox-dj-playlists",version:1}));let GC=null;function HC(){GC&&clearTimeout(GC),GC=setTimeout(()=>{const{playlists:e}=zC.getState();RC(WC.DJ_PLAYLISTS,e).catch(()=>{})},2e3)}const WC={INSTRUMENT_PRESETS:"instrument-presets",MASTER_FX_PRESETS:"master-fx-presets",SETTINGS:"user-settings",MIDI_CONFIG:"midi-config",DJ_PLAYLISTS:"dj-playlists",DRUM_PADS:"drum-pads",MPC_PRESETS:"mpc-presets"};function qC(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function KC(e,t){localStorage.setItem(e,JSON.stringify(t))}function $C(){const e=CC(e=>e.user?.id??null),t=l.useRef(null);l.useEffect(()=>{e&&e!==t.current?(t.current=e,(async()=>{try{const t=await jC(WC.INSTRUMENT_PRESETS);if(t?.data){const e=JC.getState(),n=e.userPresets,s=[...t.data];for(const t of n)s.some(e=>e.id===t.id)||s.push(t);e.importPresets(s),await RC(WC.INSTRUMENT_PRESETS,s)}else{const e=JC.getState().userPresets;e.length>0&&await RC(WC.INSTRUMENT_PRESETS,e)}const n=qC("master-fx-user-presets");if(n&&Array.isArray(n)&&n.length>0){const e=await jC(WC.MASTER_FX_PRESETS);if(e?.data){if(Array.isArray(e.data)){const t=[...e.data];for(const e of n){const n=e;t.some(e=>e.name===n.name)||t.push(e)}KC("master-fx-user-presets",t),await RC(WC.MASTER_FX_PRESETS,t)}}else await RC(WC.MASTER_FX_PRESETS,n)}const s=await jC(WC.SETTINGS);if(s?.data)(e=s.data).settings&&KC("devilbox-settings",e.settings),e.keyboard&&KC("keyboard-preferences",e.keyboard),e.theme&&KC("devilbox-theme",e.theme),e.ui&&KC("devilbox-ui-settings",e.ui);else{const e={settings:qC("devilbox-settings"),keyboard:qC("keyboard-preferences"),theme:qC("devilbox-theme"),ui:qC("devilbox-ui-settings")};Object.values(e).some(Boolean)&&await RC(WC.SETTINGS,e)}const a=await jC(WC.MIDI_CONFIG);if(a?.data)!function(e){e.midiSettings&&KC("midi-settings",e.midiSettings),e.ccMappings&&KC("cc-mappings-v1",e.ccMappings),e.padMappings&&KC("pad-mappings-v1",e.padMappings),e.buttonMappings&&KC("button-mappings-v1",e.buttonMappings)}(a.data);else{const e={midiSettings:qC("midi-settings"),ccMappings:qC("cc-mappings-v1"),padMappings:qC("pad-mappings-v1"),buttonMappings:qC("button-mappings-v1")};Object.values(e).some(Boolean)&&await RC(WC.MIDI_CONFIG,e)}const o=await jC(WC.DJ_PLAYLISTS);if(o?.data&&Array.isArray(o.data))zC.getState().importPlaylists(o.data),await RC(WC.DJ_PLAYLISTS,zC.getState().playlists);else{const e=zC.getState().playlists;e.length>0&&await RC(WC.DJ_PLAYLISTS,e)}const r=qC("devilbox_drumpad");if(r){const e=await jC(WC.DRUM_PADS);e?.data?KC("devilbox_drumpad",e.data):await RC(WC.DRUM_PADS,r)}const i=qC("devilbox-mpc-presets");if(i){const e=await jC(WC.MPC_PRESETS);e?.data?KC("devilbox-mpc-presets",e.data):await RC(WC.MPC_PRESETS,i)}}catch(t){}var e})()):t.current=e},[e])}const YC=Object.freeze(Object.defineProperty({__proto__:null,SYNC_KEYS:WC,useCloudSync:$C},Symbol.toStringTag,{value:"Module"})),JC=i()(TN(ds((e,t)=>({userPresets:[],recentPresetIds:[],savePreset:(t,n,s,a=[])=>{const o=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return e(e=>{const r={id:o,name:n,category:s,synthType:t.synthType,tags:a,createdAt:Date.now(),updatedAt:Date.now(),config:{name:t.name,type:t.type,synthType:t.synthType,oscillator:t.oscillator,envelope:t.envelope,filter:t.filter,filterEnvelope:t.filterEnvelope,tb303:t.tb303,wavetable:t.wavetable,effects:t.effects?[...t.effects]:[],volume:t.volume,pan:t.pan,parameters:t.parameters}};e.userPresets.push(r)}),o},deletePreset:t=>e(e=>{const n=e.userPresets.findIndex(e=>e.id===t);-1!==n&&e.userPresets.splice(n,1);const s=e.recentPresetIds.indexOf(t);-1!==s&&e.recentPresetIds.splice(s,1)}),updatePreset:(t,n)=>e(e=>{const s=e.userPresets.find(e=>e.id===t);s&&(Object.assign(s,n),s.updatedAt=Date.now())}),getPreset:e=>t().userPresets.find(t=>t.id===e),getPresetsByCategory:e=>t().userPresets.filter(t=>t.category===e),getPresetsBySynthType:e=>t().userPresets.filter(t=>t.synthType===e),addToRecent:t=>e(e=>{const n=e.recentPresetIds.indexOf(t);-1!==n&&e.recentPresetIds.splice(n,1),e.recentPresetIds.unshift(t),e.recentPresetIds.length>10&&e.recentPresetIds.pop()}),clearRecent:()=>e(e=>{e.recentPresetIds=[]}),importPresets:t=>e(e=>{t.forEach(t=>{const n=e.userPresets.findIndex(e=>e.id===t.id);-1!==n?e.userPresets[n]=t:e.userPresets.push(t)})}),exportPresets:()=>t().userPresets,exportPresetAsNKSF:e=>{const n=t().getPreset(e);if(n)try{const e=iC(wC(n)),t=new Blob([e],{type:"application/octet-stream"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`${n.name}.nksf`,a.click(),URL.revokeObjectURL(s)}catch(s){}},exportAllPresetsAsNKSF:e=>{const n=t().userPresets;if(0!==n.length)try{const t=function(e,t){return e.map(e=>{const n=wC(e);return t&&(n.metadata.author=t),{filename:`${e.name}.nksf`,buffer:iC(n)}})}(n,e);t.forEach((e,t)=>{setTimeout(()=>{const t=new Blob([e.buffer],{type:"application/octet-stream"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=e.filename,s.click(),URL.revokeObjectURL(n)},100*t)})}catch(s){}},importNKSFFiles:async t=>{const n=[];try{const s=await async function(e){const t=[];for(const s of e)try{const e=await s.arrayBuffer(),n=await rC(e);t.push(EC(n))}catch(n){}return t}(t);for(const t of s){const s=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;e(e=>{const n={id:s,...t,createdAt:Date.now(),updatedAt:Date.now()};e.userPresets.push(n)}),n.push(s)}}catch(s){}return n}})),{name:"devilbox-user-presets",version:1}));let QC=null;JC.subscribe((e,t)=>{e.userPresets!==t.userPresets&&(QC&&clearTimeout(QC),QC=setTimeout(()=>{RC(WC.INSTRUMENT_PRESETS,e.userPresets).catch(()=>{})},2e3))});const ZC=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}];class eV{static CHUNK_SIZE=16384;pc;dataChannel=null;localStream=null;remoteAudio;_localAudioMuted=!1;_localVideoMuted=!0;_remoteVideoStream=null;onRemoteVideo=null;onLocalVideo=null;_pendingChunks=new Map;onConnected=null;onDisconnected=null;onPatch=null;onIceCandidate=null;constructor(){this.pc=new RTCPeerConnection({iceServers:ZC}),this.remoteAudio=new Audio,this.remoteAudio.autoplay=!0,this.pc.onicecandidate=e=>{e.candidate&&this.onIceCandidate&&this.onIceCandidate(e.candidate.toJSON())},this.pc.ontrack=e=>{const t=e.track;"audio"===t.kind?(this.remoteAudio.srcObject=e.streams[0],this.remoteAudio.play().catch(()=>{})):"video"===t.kind&&(this._remoteVideoStream=e.streams[0],this.onRemoteVideo?.(this._remoteVideoStream))},this.pc.onconnectionstatechange=()=>{const e=this.pc.connectionState;"failed"!==e&&"closed"!==e||this.onDisconnected?.()},this.pc.oniceconnectionstatechange=()=>{},this.pc.onicegatheringstatechange=()=>{}}async createOffer(){this.dataChannel=this.pc.createDataChannel("song",{ordered:!0}),this._setupDataChannel(this.dataChannel);const e=await this.pc.createOffer();return await this.pc.setLocalDescription(e),e}async handleOffer(e){this.pc.ondatachannel=e=>{this.dataChannel=e.channel,this._setupDataChannel(e.channel)},await this.pc.setRemoteDescription(new RTCSessionDescription(e));const t=await this.pc.createAnswer();return await this.pc.setLocalDescription(t),t}async handleAnswer(e){await this.pc.setRemoteDescription(new RTCSessionDescription(e))}addIceCandidate(e){this.pc.addIceCandidate(new RTCIceCandidate(e)).catch(e=>{})}_setupDataChannel(e){e.onopen=()=>{this.onConnected?.()},e.onclose=()=>{this.onDisconnected?.()},e.onmessage=e=>{try{const t=JSON.parse(e.data);if("__chunk"in t&&t.__chunk){const e=this._receiveChunk(t);return void(e&&this.onPatch?.(e))}this.onPatch?.(t)}catch{}},e.onerror=e=>{e.error}}send(e){if("open"!==this.dataChannel?.readyState)return;const t=JSON.stringify(e);if(t.length<=eV.CHUNK_SIZE)return void this.dataChannel.send(t);const n=Math.random().toString(36).slice(2)+Date.now().toString(36),s=Math.ceil(t.length/eV.CHUNK_SIZE);for(let a=0;a<s;a++){const e=t.slice(a*eV.CHUNK_SIZE,(a+1)*eV.CHUNK_SIZE);this.dataChannel.send(JSON.stringify({__chunk:!0,id:n,index:a,total:s,data:e}))}}_receiveChunk(e){let t=this._pendingChunks.get(e.id);return t||(t={total:e.total,received:0,chunks:new Array(e.total).fill("")},this._pendingChunks.set(e.id,t)),t.chunks[e.index]||(t.chunks[e.index]=e.data,t.received++),t.received<t.total?null:(this._pendingChunks.delete(e.id),JSON.parse(t.chunks.join("")))}async enableMedia(e={audio:!0}){try{const t={audio:!1!==e.audio,video:!!e.video&&{width:{ideal:320},height:{ideal:240},frameRate:{ideal:15}}};this.localStream=await navigator.mediaDevices.getUserMedia(t);for(const e of this.localStream.getTracks())this.pc.addTrack(e,this.localStream);e.video&&this.localStream.getVideoTracks().length>0&&this.onLocalVideo?.(this.localStream)}catch(t){throw t}}async enableVoice(){return this.enableMedia({audio:!0})}muteVoice(e){if(this._localAudioMuted=e,this.localStream)for(const t of this.localStream.getAudioTracks())t.enabled=!e}muteCamera(e){if(this._localVideoMuted=e,this.localStream)for(const t of this.localStream.getVideoTracks())t.enabled=!e}get localAudioMuted(){return this._localAudioMuted}get localVideoMuted(){return this._localVideoMuted}get remoteVideoStream(){return this._remoteVideoStream}get localVideoStream(){if(!this.localStream)return null;return 0===this.localStream.getVideoTracks().length?null:this.localStream}setRemoteVolume(e){this.remoteAudio.volume=Math.max(0,Math.min(1,e))}destroy(){this.onConnected=null,this.onDisconnected=null,this.onPatch=null,this.onIceCandidate=null,this.onRemoteVideo=null,this.onLocalVideo=null,this._pendingChunks.clear(),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onclose=null,this.dataChannel.onmessage=null,this.dataChannel.onerror=null,this.dataChannel.close(),this.dataChannel=null),this.pc.onicecandidate=null,this.pc.ontrack=null,this.pc.onconnectionstatechange=null,this.pc.ondatachannel=null,this.localStream?.getTracks().forEach(e=>e.stop()),this.localStream=null,this._remoteVideoStream=null,this.remoteAudio.srcObject=null,this.pc.close()}}class tV{ws=null;onMessage;onDisconnect;url;constructor(e,t,n){this.url=e,this.onMessage=t,this.onDisconnect=n}connect(){return new Promise((e,t)=>{this.ws=new WebSocket(this.url),this.ws.onopen=()=>e(),this.ws.onmessage=e=>{try{const t=JSON.parse(e.data);this.onMessage(t)}catch{}},this.ws.onerror=()=>{t(new Error(`Cannot reach signaling server at ${this.url}. Start it with: cd server && npm run collab`))},this.ws.onclose=()=>{this.onDisconnect()}})}send(e){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}disconnect(){this.ws?.close(),this.ws=null}}let nV=!1,sV=null,aV=null;const oV={}?.VITE_COLLAB_URL??"ws://localhost:4002";let rV=null,iV=null,lV=!1,cV=!1;function uV(){return rV}const dV=i()(ds((e,t)=>({status:"idle",roomCode:null,errorMessage:null,viewMode:"fullscreen",peerPatternIndex:0,peerCursorRow:0,peerCursorChannel:0,peerMouseNX:0,peerMouseNY:0,peerMouseActive:!1,peerSelection:null,listenMode:"shared",micMuted:!1,cameraMuted:!0,localVideoStream:null,remoteVideoStream:null,createRoom:async()=>{e(e=>{e.status="creating",e.errorMessage=null});try{mV(),lV=!0,rV=new eV,pV(),iV=new tV(oV,hV,()=>{"connected"!==dV.getState().status&&e(e=>{e.status="error",e.errorMessage="Signaling server disconnected"})}),await iV.connect(),iV.send({type:"create_room"})}catch(t){e(e=>{e.status="error",e.errorMessage=t instanceof Error?t.message:"Failed to create room"})}},joinRoom:async t=>{const n=t.toUpperCase().trim();e(e=>{e.status="joining",e.errorMessage=null,e.roomCode=n});try{mV(),lV=!1,rV=new eV,pV(),iV=new tV(oV,hV,()=>{"connected"!==dV.getState().status&&e(e=>{e.status="error",e.errorMessage="Signaling server disconnected"})}),await iV.connect(),iV.send({type:"join_room",roomCode:n})}catch(s){e(e=>{e.status="error",e.errorMessage=s instanceof Error?s.message:"Failed to join room"})}},disconnect:()=>{mV(),e(e=>{e.status="idle",e.roomCode=null,e.errorMessage=null,e.viewMode="fullscreen",e.peerPatternIndex=0,e.peerCursorRow=0,e.peerCursorChannel=0,e.peerMouseNX=0,e.peerMouseNY=0,e.peerMouseActive=!1,e.peerSelection=null,e.listenMode="shared",e.micMuted=!1,e.cameraMuted=!1,e.localVideoStream=null,e.remoteVideoStream=null})},setViewMode:t=>e(e=>{e.viewMode=t}),setListenMode:t=>{if(e(e=>{e.listenMode=t}),rV){rV.setRemoteVolume("mine"===t?0:1);try{const e=window.Tone?.getDestination();e&&(e.mute="theirs"===t)}catch{}}},toggleMic:()=>{const n=!t().micMuted;e(e=>{e.micMuted=n}),rV?.muteVoice(n)},toggleCamera:()=>{const n=!t().cameraMuted;e(e=>{e.cameraMuted=n}),rV?.muteCamera(n)}})));function mV(){sV?.(),aV?.(),sV=null,aV=null,rV?.destroy(),rV=null,iV?.disconnect(),iV=null}function pV(){rV&&(rV.onIceCandidate=e=>{iV?.send({type:"ice_candidate",candidate:e})},rV.onRemoteVideo=e=>{dV.setState(t=>{t.remoteVideoStream=e})},rV.onLocalVideo=e=>{dV.setState(t=>{t.localVideoStream=e})},rV.onConnected=()=>{var e;(dV.setState(e=>{e.status="connected",e.viewMode="split"}),rV)&&(e=rV,sV=ID.subscribe((t,n)=>{if(!nV){for(let s=0;s<t.patterns.length;s++){if(t.patterns[s]===n.patterns[s])continue;const a=t.patterns[s],o=n.patterns[s];if(!o){e.send({type:"pattern_add",pattern:a});continue}const r=[];for(let e=0;e<a.channels.length;e++){if(a.channels[e]===o.channels[e])continue;const t=a.channels[e],n=o.channels[e];for(let a=0;a<t.rows.length;a++)t.rows[a]!==n?.rows[a]&&r.push({pi:s,ci:e,ri:a,cell:t.rows[a]})}if(0===r.length)e.send({type:"full_pattern",pi:s,pattern:a});else if(1===r.length){const{pi:t,ci:n,ri:s,cell:a}=r[0];e.send({type:"cell",pi:t,ci:n,ri:s,cell:a})}else e.send({type:"patch_batch",ops:r})}if(t.patterns.length<n.patterns.length)for(let s=t.patterns.length;s<n.patterns.length;s++)e.send({type:"pattern_delete",pi:s})}}),aV=jN.subscribe((t,n)=>{nV||t.bpm!==n.bpm&&e.send({type:"bpm",value:t.bpm})}),rV.enableMedia({audio:!0,video:!0}).then(()=>{rV?.muteCamera(!0)}).catch(e=>{rV?.enableMedia({audio:!0,video:!1}).catch(e=>{})}),setTimeout(()=>{const e=ID.getState();rV?.send({type:"peer_cursor",patternIndex:e.currentPatternIndex,channelIndex:e.cursor.channelIndex,rowIndex:e.cursor.rowIndex})},300),lV&&setTimeout(()=>{try{const e=function(){const{patterns:e,patternOrder:t}=ID.getState(),{instruments:n}=EN.getState(),{bpm:s}=jN.getState(),{masterEffects:a}=UD.getState(),{metadata:o}=RD.getState();return{patterns:structuredClone(e),instruments:structuredClone(n),bpm:s,masterEffects:structuredClone(a),metadata:o?structuredClone(o):void 0,patternOrder:structuredClone(t)}}();rV?.send({type:"full_sync",project:e})}catch(e){}},500))},rV.onDisconnected=()=>{dV.getState().disconnect()},rV.onPatch=e=>{if("peer_view"===e.type)return dV.setState(t=>{t.peerPatternIndex=e.patternIndex}),void("shared"===dV.getState().listenMode&&(cV=!0,ID.getState().setCurrentPattern(e.patternIndex),cV=!1));"peer_cursor"!==e.type?"peer_mouse"!==e.type?"peer_selection"!==e.type?"peer_selection_clear"!==e.type?function(e){nV=!0;try{const t=ID.getState();if("full_sync"===e.type){const{loadPatterns:n,setPatternOrder:s}=t,{loadInstruments:a}=EN.getState(),{setBPM:o}=jN.getState(),{setMasterEffects:r}=UD.getState();n(e.project.patterns),e.project.patternOrder&&s(e.project.patternOrder),e.project.instruments&&a(e.project.instruments),e.project.bpm&&o(e.project.bpm),e.project.masterEffects&&r(e.project.masterEffects)}else if("cell"===e.type){const{patterns:n,replacePattern:s}=t,a=n[e.pi];if(!a)return;const o=a.channels[e.ci];if(!o)return;if(e.ri<0||e.ri>=o.rows.length)return;const r={...a,channels:a.channels.map((t,n)=>{if(n!==e.ci)return t;const s=[...t.rows];return s[e.ri]={...s[e.ri],...e.cell},{...t,rows:s}})};s(e.pi,r)}else if("patch_batch"===e.type){const{patterns:n,replacePattern:s}=t,a=new Map;for(const t of e.ops)a.has(t.pi)||a.set(t.pi,[]),a.get(t.pi).push(t);for(const[e,t]of a){const a=n[e];if(!a)continue;const o=a.channels.map((e,n)=>{const s=t.filter(e=>e.ci===n);if(0===s.length)return e;const a=[...e.rows];for(const t of s)t.ri>=0&&t.ri<a.length&&(a[t.ri]={...a[t.ri],...t.cell});return{...e,rows:a}});s(e,{...a,channels:o})}}else"full_pattern"===e.type?t.replacePattern(e.pi,e.pattern):"pattern_add"===e.type?t.importPattern(e.pattern):"bpm"===e.type&&jN.getState().setBPM(e.value)}finally{nV=!1}}(e):dV.setState(e=>{e.peerSelection=null}):dV.setState(t=>{t.peerSelection={startChannel:e.startChannel,endChannel:e.endChannel,startRow:e.startRow,endRow:e.endRow,patternIndex:e.patternIndex}}):dV.setState(t=>{t.peerMouseNX=e.nx,t.peerMouseNY=e.ny,t.peerMouseActive=!0}):dV.setState(t=>{t.peerPatternIndex=e.patternIndex,t.peerCursorRow=e.rowIndex,t.peerCursorChannel=e.channelIndex})})}const hV=async e=>{if(rV&&iV)switch(e.type){case"room_created":dV.setState(t=>{t.status="waiting",t.roomCode=e.roomCode});break;case"peer_joined":{const e=await rV.createOffer();iV.send({type:"offer",sdp:e});break}case"offer":{const t=await rV.handleOffer(e.sdp);iV.send({type:"answer",sdp:t});break}case"answer":await rV.handleAnswer(e.sdp);break;case"ice_candidate":rV.addIceCandidate(e.candidate);break;case"peer_left":dV.getState().disconnect();break;case"error":dV.setState(t=>{t.status="error",t.errorMessage=e.message})}};ID.subscribe((e,t)=>{e.currentPatternIndex!==t.currentPatternIndex&&(cV||"connected"===dV.getState().status&&rV?.send({type:"peer_view",patternIndex:e.currentPatternIndex}))}),ID.subscribe((e,t)=>{e.cursor.rowIndex===t.cursor.rowIndex&&e.cursor.channelIndex===t.cursor.channelIndex&&e.currentPatternIndex===t.currentPatternIndex||"connected"===dV.getState().status&&rV?.send({type:"peer_cursor",patternIndex:e.currentPatternIndex,channelIndex:e.cursor.channelIndex,rowIndex:e.cursor.rowIndex})});const fV="1713",gV="598ce6ff",bV="1.0.1713",vV=[{version:"1.0.1713",date:"2026-02-28",changes:[{type:"fix",description:"Fix silent audio failure when AudioContext is suspended on iOS"},{type:"feature",description:"Phase 3b  read instrument names from Amiga chip RAM"},{type:"feature",description:"CIA-A tick counter, native parser routing, expanded effects"},{type:"fix",description:"Eliminate remaining visible= BindingErrors on layout containers"},{type:"feature",description:"Infinite canvas workbench with floating windows"},{type:"fix",description:"Rewrite PixiFurnaceView and PixiHivelyView to pure Pixi"},{type:"fix",description:"Fix TS6133/TS2322 errors in new Pixi tracker components"},{type:"feature",description:"Replace all DOM overlays with pure Pixi components in PixiTrackerView"},{type:"fix",description:"Run Vite in foreground so errors are always visible; fix vite PATH"},{type:"fix",description:"Use npx vite instead of bare vite (not in PATH outside npm scripts)"},{type:"fix",description:"Eliminate all visible= BindingErrors on layout containers"},{type:"fix",description:"Replace DOM overlays with pure Pixi equivalents"},{type:"fix",description:"Kill all 3 ports and start all 3 servers in dev.sh"},{type:"feature",description:"Add 3D tilt toggle to settings modal"},{type:"fix",description:"Fix PixiDropdownPanel BindingError using alpha+renderable instead of visible"},{type:"fix",description:"Strip duplicate controls from PixiEditorControlsBar to match DOM"},{type:"fix",description:"Guarantee webgl mode on every startup regardless of localStorage"},{type:"fix",description:"Fix FT2 toolbar visualizer rendering"},{type:"fix",description:"Fix PixiSelect BindingError and default to workbench mode"},{type:"fix",description:"Fix status bar label spacing and add TIPS button"},{type:"fix",description:"Surface TypeScript errors in dev.sh and fix PixiFT2Toolbar type errors"},{type:"fix",description:"Route GL modal triggers through UIStore instead of createPortal"},{type:"fix",description:"Fix FurnaceLynx silence by uploading DIV_INS_MIKEY instrument with duty=1"},{type:"fix",description:"Fix Yoga BindingErrors in PixiPatternEditor on scroll"},{type:"fix",description:"Correctly load MSDF bitmap fonts from JSON"},{type:"fix",description:"Fix red tab bar  eliminate Yoga BindingErrors and font flash"},{type:"fix",description:"Eliminate Yoga BindingError and Cache key warnings"},{type:"fix",description:"Fix build errors in pure WebGL UI components"},{type:"improvement",description:"Chore(pixi): remove dead EditorControlsBar DOM overlay code from PixiTrackerView"},{type:"feature",description:"Chore(pixi): export new pure Pixi components from index"},{type:"feature",description:"Rewrite PixiFT2Toolbar as pure Pixi  removes last PixiDOMOverlay from tracker"},{type:"feature",description:"Rewrite PixiNavBar as pure Pixi  removes PixiDOMOverlay"},{type:"feature",description:"Rewrite EditorControlsBar as pure Pixi  removes PixiDOMOverlay"},{type:"feature",description:"Rewrite PixiStatusBar as pure Pixi  removes PixiDOMOverlay"},{type:"feature",description:"Add PixiCheckbox, PixiSelect, PixiMenuBar, PixiTabBar components"},{type:"fix",description:"Share engine.output across all SunVoxSynth instances"},{type:"feature",description:"Add PixiPureTextInput  pure Pixi text input with no DOM backing"},{type:"feature",description:"Generate and commit MSDF font atlases for pure WebGL text rendering"},{type:"improvement",description:"Add pure WebGL UI implementation plan (12 tasks, 7 phases)"},{type:"improvement",description:"Add pure WebGL UI design document"},{type:"fix",description:"Add 400ms tail wait after phrase so last note rings out before next test"},{type:"improvement",description:"Chore: regenerate changelog to build 1670"},{type:"fix",description:"SunVox worklet cleanup + keyboard handler improvements"},{type:"feature",description:"Error line highlighting, raw output display, param management"},{type:"feature",description:"Add MAME chips + phrase-based test sounds to synth test runner"},{type:"fix",description:"Init WASM directly in onmessage, add _rejectInit"},{type:"feature",description:"Show banner when Vite dev server is unreachable"},{type:"fix",description:"Cast preSunVoxModules to fix tsc -b type errors"},{type:"fix",description:"Add status message feedback to keyboard commands missing user feedback"}]}],yV=bV,xV=bV,NV=({label:e,devices:t,selectedId:n,onSelect:s,disabled:a=!1})=>{const o=t.find(e=>e.id===n);return Yn.jsxDEV("div",{className:"space-y-1",children:[Yn.jsxDEV("label",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:28,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV("select",{value:n||"",onChange:e=>s(e.target.value||null),disabled:a,className:`\n            w-full px-3 py-2 pr-8 rounded-md text-sm\n            bg-dark-bgTertiary border border-dark-border\n            text-text-primary appearance-none cursor-pointer\n            hover:border-dark-borderLight focus:border-accent-primary focus:outline-none\n            disabled:opacity-50 disabled:cursor-not-allowed\n            ${o?.isTD3?"border-accent-success/50":""}\n          `,children:[Yn.jsxDEV("option",{value:"",children:"No device"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:45,columnNumber:11},void 0),t.map(e=>Yn.jsxDEV("option",{value:e.id,children:[e.isTD3?" ":"",e.name,e.manufacturer?` (${e.manufacturer})`:""]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:47,columnNumber:13},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:32,columnNumber:9},void 0),Yn.jsxDEV(De,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:53,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:31,columnNumber:7},void 0),o?.isTD3&&Yn.jsxDEV("div",{className:"flex items-center gap-1 text-xs text-accent-success",children:[Yn.jsxDEV(Se,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:60,columnNumber:11},void 0),Yn.jsxDEV("span",{children:"TD-3 detected"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:61,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:59,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIDeviceSelector.tsx",lineNumber:27,columnNumber:5},void 0)};function wV(){const[e,t]=l.useState([]),[n]=l.useState(()=>"requestMIDIAccess"in navigator),[s,a]=l.useState(!1),[o,r]=l.useState(null),i=l.useRef(null),c=l.useRef(null),u=l.useRef(new Set),d=l.useCallback(e=>{const t=e;if(!t.data)return;const n=function(e){if(e.length<1)return{type:"unknown",channel:0,raw:e};const[t,n=0,s=0]=e,a=15&t;switch(t>>4&15){case 9:return{type:s>0?"noteon":"noteoff",channel:a,note:n,velocity:s,raw:e};case 8:return{type:"noteoff",channel:a,note:n,velocity:s,raw:e};case 11:return{type:"cc",channel:a,controller:n,value:s,raw:e};case 14:return{type:"pitchbend",channel:a,value:s<<7|n,raw:e};case 13:return{type:"aftertouch",channel:a,value:n,raw:e};default:return{type:"unknown",channel:a,raw:e}}}(t.data);r(n),u.current.forEach(e=>{e(n)})},[]),m=l.useCallback(e=>{const n=[];e.inputs.forEach(e=>{n.push({id:e.id,name:e.name||"Unknown Device",manufacturer:e.manufacturer||"Unknown",state:e.state})}),t(n)},[]),p=l.useCallback(async()=>{if(!n)throw new Error("Web MIDI API not supported in this browser");if(s)return;const e=await navigator.requestMIDIAccess();i.current=e,e.inputs.forEach(e=>{e.addEventListener("midimessage",d)});const t=()=>{m(e),e.inputs.forEach(e=>{e.removeEventListener("midimessage",d),e.addEventListener("midimessage",d)})};c.current=t,e.addEventListener("statechange",t),m(e),a(!0)},[n,s,d,m]),h=l.useCallback(()=>{i.current&&(i.current.inputs.forEach(e=>{e.removeEventListener("midimessage",d)}),c.current&&(i.current.removeEventListener("statechange",c.current),c.current=null),i.current=null),a(!1),t([]),r(null)},[d]),f=l.useCallback(e=>(u.current.add(e),()=>{u.current.delete(e)}),[]);return l.useEffect(()=>()=>{h()},[h]),{devices:e,isSupported:n,isEnabled:s,lastMessage:o,enableMIDI:p,disableMIDI:h,onMessage:f}}const EV={1:{mode:92,cc:93,min:94,max:95,name:96},2:{mode:112,cc:113,min:114,max:115,name:116},3:{mode:132,cc:133,min:134,max:135,name:136},4:{mode:152,cc:153,min:154,max:155,name:156},5:{mode:172,cc:173,min:174,max:175,name:176},6:{mode:192,cc:193,min:194,max:195,name:196},7:{mode:212,cc:213,min:214,max:215,name:216},8:{mode:232,cc:233,min:234,max:235,name:236}};class kV{static instance=null;currentPreset=null;deviceName=null;constructor(){}static getInstance(){return kV.instance||(kV.instance=new kV),kV.instance}checkConnection(){const e=nS().getInputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return this.deviceName=t.name||"MPK Mini",!0}return this.deviceName=null,!1}getDeviceName(){return this.deviceName}createDefaultPreset(){const e=new Uint8Array(246);e[0]=0;const t=this.stringToBytes("DEViLBOX       ",16);e.set(t,1),e[17]=0,e[18]=0,e[19]=0,e[20]=4;for(let n=1;n<=8;n++){const t=EV[n];e[t.mode-7]=0,e[t.cc-7]=70+n-1,e[t.min-7]=0,e[t.max-7]=127;const s=`Knob ${n}        `,a=this.stringToBytes(s,16);e.set(a,t.name-7)}return e}stringToBytes(e,t){const n=new Uint8Array(t);for(let s=0;s<t;s++)s<e.length?n[s]=Math.min(127,e.charCodeAt(s)):n[s]=32;return n}buildSysExMessage(e){const t=e.length,n=t>>7&127,s=127&t,a=new Uint8Array(7+e.length+1);return a[0]=240,a[1]=71,a[2]=127,a[3]=73,a[4]=100,a[5]=n,a[6]=s,a.set(e,7),a[a.length-1]=247,a}findMPKMiniOutputId(){const e=nS().getOutputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return t.id}return null}async sendSysEx(e){const t=nS(),n=this.findMPKMiniOutputId();if(!n)return!1;const s=t.getSelectedOutput(),a=s?.id||null;try{return t.selectOutput(n),t.sendSysEx(e),a&&a!==n&&t.selectOutput(a),!0}catch(o){if(a)try{t.selectOutput(a)}catch{}return!1}}async setKnobName(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const n=EV[e],s=this.stringToBytes(t,16);this.currentPreset.set(s,n.name-7);const a=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(a)}async setKnobNames(e){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());for(const[n,s]of Object.entries(e)){const e=parseInt(n);if(e>=1&&e<=8){const t=EV[e],n=this.stringToBytes(s,16);this.currentPreset.set(n,t.name-7)}}const t=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(t)}async setKnobConfig(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const n=EV[e];void 0!==t.mode&&(this.currentPreset[n.mode-7]="relative"===t.mode?1:0),void 0!==t.cc&&(this.currentPreset[n.cc-7]=127&t.cc),void 0!==t.min&&(this.currentPreset[n.min-7]=127&t.min),void 0!==t.max&&(this.currentPreset[n.max-7]=127&t.max);const s=this.stringToBytes(t.name,16);this.currentPreset.set(s,n.name-7);const a=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(a)}async applyDEViLBOXPreset(){return this.setKnobNames({1:"Cutoff",2:"Resonance",3:"Env Mod",4:"Decay",5:"Accent",6:"Overdrive",7:"Slide Time",8:"Filter FM"})}async resetKnobNames(){this.currentPreset=this.createDefaultPreset();const e=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(e)}}function DV(){return kV.getInstance()}const SV={"transport.play":{label:"Play",category:"Transport"},"transport.stop":{label:"Stop",category:"Transport"},"transport.pause":{label:"Pause",category:"Transport"},"transport.record":{label:"Record",category:"Transport"},"transport.loop":{label:"Toggle Loop",category:"Transport"},"nav.patternUp":{label:"Pattern Up",category:"Navigation"},"nav.patternDown":{label:"Pattern Down",category:"Navigation"},"nav.positionUp":{label:"Song Position Up",category:"Navigation"},"nav.positionDown":{label:"Song Position Down",category:"Navigation"},"nav.rowUp":{label:"Row Up",category:"Navigation"},"nav.rowDown":{label:"Row Down",category:"Navigation"},"nav.toStart":{label:"Go to Start",category:"Navigation"},"nav.toEnd":{label:"Go to End",category:"Navigation"},"edit.octaveUp":{label:"Octave Up",category:"Editing"},"edit.octaveDown":{label:"Octave Down",category:"Editing"},"edit.instrumentUp":{label:"Instrument Up",category:"Editing"},"edit.instrumentDown":{label:"Instrument Down",category:"Editing"},"edit.undo":{label:"Undo",category:"Editing"},"edit.redo":{label:"Redo",category:"Editing"},"edit.copy":{label:"Copy",category:"Editing"},"edit.paste":{label:"Paste",category:"Editing"},"edit.delete":{label:"Delete",category:"Editing"},"edit.insertRow":{label:"Insert Row",category:"Editing"},"edit.deleteRow":{label:"Delete Row",category:"Editing"},"channel.mute1":{label:"Mute Ch 1",category:"Channels"},"channel.mute2":{label:"Mute Ch 2",category:"Channels"},"channel.mute3":{label:"Mute Ch 3",category:"Channels"},"channel.mute4":{label:"Mute Ch 4",category:"Channels"},"channel.mute5":{label:"Mute Ch 5",category:"Channels"},"channel.mute6":{label:"Mute Ch 6",category:"Channels"},"channel.mute7":{label:"Mute Ch 7",category:"Channels"},"channel.mute8":{label:"Mute Ch 8",category:"Channels"},"channel.solo1":{label:"Solo Ch 1",category:"Channels"},"channel.solo2":{label:"Solo Ch 2",category:"Channels"},"channel.solo3":{label:"Solo Ch 3",category:"Channels"},"channel.solo4":{label:"Solo Ch 4",category:"Channels"},"pattern.new":{label:"New Pattern",category:"Pattern"},"pattern.clone":{label:"Clone Pattern",category:"Pattern"},"pattern.delete":{label:"Delete Pattern",category:"Pattern"},"view.toggleEditor":{label:"Toggle Editor",category:"View"},"view.toggleMixer":{label:"Toggle Mixer",category:"View"},"dj.deckA.play":{label:"DJ Deck A Play",category:"DJ Transport"},"dj.deckA.pause":{label:"DJ Deck A Pause",category:"DJ Transport"},"dj.deckA.stop":{label:"DJ Deck A Stop",category:"DJ Transport"},"dj.deckA.cue":{label:"DJ Deck A Cue",category:"DJ Transport"},"dj.deckB.play":{label:"DJ Deck B Play",category:"DJ Transport"},"dj.deckB.pause":{label:"DJ Deck B Pause",category:"DJ Transport"},"dj.deckB.stop":{label:"DJ Deck B Stop",category:"DJ Transport"},"dj.deckB.cue":{label:"DJ Deck B Cue",category:"DJ Transport"},"dj.sync":{label:"DJ Sync BA",category:"DJ Transport"},"dj.killAll":{label:"DJ Kill All",category:"DJ Transport"},"dj.knobPage.next":{label:"DJ Next Knob Page",category:"DJ Navigation"},"dj.knobPage.prev":{label:"DJ Prev Knob Page",category:"DJ Navigation"},"dj.deckA.eqKillLow":{label:"DJ Kill Lo A",category:"DJ EQ Kill"},"dj.deckA.eqKillMid":{label:"DJ Kill Mid A",category:"DJ EQ Kill"},"dj.deckA.eqKillHi":{label:"DJ Kill Hi A",category:"DJ EQ Kill"},"dj.deckB.eqKillLow":{label:"DJ Kill Lo B",category:"DJ EQ Kill"},"dj.deckB.eqKillMid":{label:"DJ Kill Mid B",category:"DJ EQ Kill"},"dj.deckB.eqKillHi":{label:"DJ Kill Hi B",category:"DJ EQ Kill"}},MV={"tb303.cutoff":{label:"Cutoff",min:200,max:5e3,category:"303 Main"},"tb303.resonance":{label:"Resonance",min:0,max:100,category:"303 Main"},"tb303.envMod":{label:"Env Mod",min:0,max:100,category:"303 Main"},"tb303.decay":{label:"Decay",min:200,max:2e3,category:"303 Main"},"tb303.accent":{label:"Accent",min:0,max:100,category:"303 Main"},"tb303.slideTime":{label:"Slide Time",min:2,max:360,category:"303 Main"},"tb303.overdrive":{label:"Overdrive",min:0,max:100,category:"303 Main"},"tb303.normalDecay":{label:"Normal Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.accentDecay":{label:"Accent Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.softAttack":{label:"Soft Attack",min:.3,max:30,category:"Devil Fish"},"tb303.vegSustain":{label:"VEG Sustain",min:0,max:100,category:"Devil Fish"},"tb303.filterFM":{label:"Filter FM",min:0,max:100,category:"Devil Fish"},"tb303.filterTracking":{label:"Key Track",min:0,max:200,category:"Devil Fish"}},CV=[{id:"akai-mpk-mini-mk3",name:"MPK Mini MK3",manufacturer:"Akai",detectPatterns:["mpk mini","mpk mini mk3","mpkmini"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8",defaultMapping:"tb303.normalDecay"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"}],extras:{pitchBend:!0,modWheel:{cc:1}},suggestedLayout:{knobs:{70:"tb303.cutoff",71:"tb303.resonance",72:"tb303.envMod",73:"tb303.decay",74:"tb303.accent",75:"tb303.overdrive",76:"tb303.slideTime",77:"tb303.normalDecay"},pads:{36:"transport.play",37:"transport.stop",38:"transport.record",39:"transport.loop",40:"nav.patternDown",41:"nav.patternUp",42:"edit.octaveDown",43:"edit.octaveUp"}}},{id:"akai-mpk-mini-plus",name:"MPK Mini Plus",manufacturer:"Akai",detectPatterns:["mpk mini plus","mpkminiplus"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8",defaultMapping:"tb303.normalDecay"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"}],extras:{pitchBend:!0,modWheel:{cc:1}},suggestedLayout:{knobs:{70:"tb303.cutoff",71:"tb303.resonance",72:"tb303.envMod",73:"tb303.decay",74:"tb303.accent",75:"tb303.overdrive",76:"tb303.slideTime",77:"tb303.normalDecay"},pads:{36:"transport.play",37:"transport.stop",38:"transport.record",39:"transport.loop",40:"nav.patternDown",41:"nav.patternUp",42:"edit.octaveDown",43:"edit.octaveUp"}}},{id:"novation-launchkey-mini-mk3",name:"Launchkey Mini MK3",manufacturer:"Novation",detectPatterns:["launchkey mini","launchkey"],knobs:[{cc:21,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:22,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:23,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:24,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:25,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:26,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:27,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:28,name:"Knob 8",defaultMapping:"tb303.normalDecay"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"},{note:44,name:"Pad 9",defaultMapping:"edit.undo"},{note:45,name:"Pad 10",defaultMapping:"edit.redo"},{note:46,name:"Pad 11",defaultMapping:"edit.copy"},{note:47,name:"Pad 12",defaultMapping:"edit.paste"},{note:48,name:"Pad 13",defaultMapping:"dj.deckA.play"},{note:49,name:"Pad 14",defaultMapping:"dj.deckA.cue"},{note:50,name:"Pad 15",defaultMapping:"dj.deckB.play"},{note:51,name:"Pad 16",defaultMapping:"dj.deckB.cue"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}},suggestedLayout:{knobs:{21:"tb303.cutoff",22:"tb303.resonance",23:"tb303.envMod",24:"tb303.decay",25:"tb303.accent",26:"tb303.overdrive",27:"tb303.slideTime",28:"tb303.normalDecay"},pads:{36:"transport.play",37:"transport.stop",38:"transport.record",39:"transport.loop",40:"nav.patternDown",41:"nav.patternUp",42:"edit.octaveDown",43:"edit.octaveUp",44:"edit.undo",45:"edit.redo",46:"edit.copy",47:"edit.paste",48:"dj.deckA.play",49:"dj.deckA.cue",50:"dj.deckB.play",51:"dj.deckB.cue"}}},{id:"arturia-minilab-3",name:"MiniLab 3",manufacturer:"Arturia",detectPatterns:["minilab","arturia minilab"],knobs:[{cc:74,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:71,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:76,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:77,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:93,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:73,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:75,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:114,name:"Knob 8",defaultMapping:"tb303.normalDecay"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64},faders:[{cc:85,name:"Fader 1",defaultMapping:"mixer.volume"},{cc:86,name:"Fader 2",defaultMapping:"mixer.pan"},{cc:87,name:"Fader 3",defaultMapping:"tb303.volume"},{cc:88,name:"Fader 4",defaultMapping:"masterFx.masterVolume"}]},suggestedLayout:{knobs:{74:"tb303.cutoff",71:"tb303.resonance",76:"tb303.envMod",77:"tb303.decay",93:"tb303.accent",73:"tb303.overdrive",75:"tb303.slideTime",114:"tb303.normalDecay"},pads:{36:"transport.play",37:"transport.stop",38:"transport.record",39:"transport.loop",40:"nav.patternDown",41:"nav.patternUp",42:"edit.octaveDown",43:"edit.octaveUp"},faders:{85:"mixer.volume",86:"mixer.pan",87:"tb303.volume",88:"masterFx.masterVolume"}}},{id:"korg-nanokontrol2",name:"nanoKONTROL2",manufacturer:"Korg",detectPatterns:["nanokontrol","nano kontrol","korg nano"],knobs:[{cc:16,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:17,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:18,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:19,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:20,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:21,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:22,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:23,name:"Knob 8",defaultMapping:"tb303.normalDecay"}],pads:[{cc:32,name:"S1",defaultMapping:"channel.solo1"},{cc:33,name:"S2",defaultMapping:"channel.solo2"},{cc:34,name:"S3",defaultMapping:"channel.solo3"},{cc:35,name:"S4",defaultMapping:"channel.solo4"},{cc:36,name:"S5",defaultMapping:"edit.undo"},{cc:37,name:"S6",defaultMapping:"edit.redo"},{cc:38,name:"S7",defaultMapping:"edit.octaveDown"},{cc:39,name:"S8",defaultMapping:"edit.octaveUp"},{cc:48,name:"M1",defaultMapping:"channel.mute1"},{cc:49,name:"M2",defaultMapping:"channel.mute2"},{cc:50,name:"M3",defaultMapping:"channel.mute3"},{cc:51,name:"M4",defaultMapping:"channel.mute4"},{cc:52,name:"M5",defaultMapping:"channel.mute5"},{cc:53,name:"M6",defaultMapping:"channel.mute6"},{cc:54,name:"M7",defaultMapping:"channel.mute7"},{cc:55,name:"M8",defaultMapping:"channel.mute8"},{cc:64,name:"R1",defaultMapping:"nav.patternDown"},{cc:65,name:"R2",defaultMapping:"nav.patternUp"},{cc:66,name:"R3",defaultMapping:"dj.knobPage.prev"},{cc:67,name:"R4",defaultMapping:"dj.knobPage.next"},{cc:68,name:"R5",defaultMapping:"dj.deckA.play"},{cc:69,name:"R6",defaultMapping:"dj.deckA.cue"},{cc:70,name:"R7",defaultMapping:"dj.deckB.play"},{cc:71,name:"R8",defaultMapping:"dj.deckB.cue"},{cc:41,name:"Play",defaultMapping:"transport.play"},{cc:42,name:"Stop",defaultMapping:"transport.stop"},{cc:43,name:"Rewind",defaultMapping:"nav.toStart"},{cc:44,name:"Forward",defaultMapping:"nav.toEnd"},{cc:45,name:"Record",defaultMapping:"transport.record"},{cc:46,name:"Cycle",defaultMapping:"transport.loop"}],extras:{faders:[{cc:0,name:"Fader 1",defaultMapping:"mixer.volume"},{cc:1,name:"Fader 2",defaultMapping:"mixer.volume"},{cc:2,name:"Fader 3",defaultMapping:"mixer.volume"},{cc:3,name:"Fader 4",defaultMapping:"mixer.volume"},{cc:4,name:"Fader 5",defaultMapping:"mixer.volume"},{cc:5,name:"Fader 6",defaultMapping:"mixer.volume"},{cc:6,name:"Fader 7",defaultMapping:"mixer.volume"},{cc:7,name:"Fader 8",defaultMapping:"masterFx.masterVolume"}]},suggestedLayout:{knobs:{16:"tb303.cutoff",17:"tb303.resonance",18:"tb303.envMod",19:"tb303.decay",20:"tb303.accent",21:"tb303.overdrive",22:"tb303.slideTime",23:"tb303.normalDecay"},faders:{0:"mixer.volume",1:"mixer.volume",2:"mixer.volume",3:"mixer.volume",4:"mixer.volume",5:"mixer.volume",6:"mixer.volume",7:"masterFx.masterVolume"}}},{id:"behringer-xtouch-mini",name:"X-Touch Mini",manufacturer:"Behringer",detectPatterns:["x-touch","xtouch","behringer x-touch"],knobs:[{cc:1,name:"Encoder 1",defaultMapping:"tb303.cutoff"},{cc:2,name:"Encoder 2",defaultMapping:"tb303.resonance"},{cc:3,name:"Encoder 3",defaultMapping:"tb303.envMod"},{cc:4,name:"Encoder 4",defaultMapping:"tb303.decay"},{cc:5,name:"Encoder 5",defaultMapping:"tb303.accent"},{cc:6,name:"Encoder 6",defaultMapping:"tb303.overdrive"},{cc:7,name:"Encoder 7",defaultMapping:"tb303.slideTime"},{cc:8,name:"Encoder 8",defaultMapping:"tb303.normalDecay"}],pads:[{note:0,name:"Button 1",defaultMapping:"transport.play"},{note:1,name:"Button 2",defaultMapping:"transport.stop"},{note:2,name:"Button 3",defaultMapping:"transport.record"},{note:3,name:"Button 4",defaultMapping:"transport.loop"},{note:4,name:"Button 5",defaultMapping:"nav.patternDown"},{note:5,name:"Button 6",defaultMapping:"nav.patternUp"},{note:6,name:"Button 7",defaultMapping:"edit.octaveDown"},{note:7,name:"Button 8",defaultMapping:"edit.octaveUp"},{note:8,name:"Button 9",defaultMapping:"edit.undo"},{note:9,name:"Button 10",defaultMapping:"edit.redo"},{note:10,name:"Button 11",defaultMapping:"dj.knobPage.prev"},{note:11,name:"Button 12",defaultMapping:"dj.knobPage.next"},{note:12,name:"Button 13",defaultMapping:"dj.deckA.play"},{note:13,name:"Button 14",defaultMapping:"dj.deckA.cue"},{note:14,name:"Button 15",defaultMapping:"dj.deckB.play"},{note:15,name:"Button 16",defaultMapping:"dj.deckB.cue"}],extras:{faders:[{cc:9,name:"Fader",defaultMapping:"masterFx.masterVolume"}]},suggestedLayout:{knobs:{1:"tb303.cutoff",2:"tb303.resonance",3:"tb303.envMod",4:"tb303.decay",5:"tb303.accent",6:"tb303.overdrive",7:"tb303.slideTime",8:"tb303.normalDecay"},pads:{0:"transport.play",1:"transport.stop",2:"transport.record",3:"transport.loop",4:"nav.patternDown",5:"nav.patternUp",6:"edit.octaveDown",7:"edit.octaveUp",8:"edit.undo",9:"edit.redo",10:"dj.knobPage.prev",11:"dj.knobPage.next",12:"dj.deckA.play",13:"dj.deckA.cue",14:"dj.deckB.play",15:"dj.deckB.cue"},faders:{9:"masterFx.masterVolume"}}},{id:"behringer-td3",name:"TD-3",manufacturer:"Behringer",detectPatterns:["td-3","td3","behringer td"],knobs:[{cc:74,name:"Cutoff",defaultMapping:"tb303.cutoff"},{cc:71,name:"Resonance",defaultMapping:"tb303.resonance"},{cc:10,name:"Env Mod",defaultMapping:"tb303.envMod"},{cc:75,name:"Decay",defaultMapping:"tb303.decay"},{cc:16,name:"Accent",defaultMapping:"tb303.accent"},{cc:7,name:"Volume",defaultMapping:"tb303.volume"}],pads:[],suggestedLayout:{knobs:{74:"tb303.cutoff",71:"tb303.resonance",10:"tb303.envMod",75:"tb303.decay",16:"tb303.accent",7:"tb303.volume"}}},{id:"akai-apc-mini-mk2",name:"APC Mini MK2",manufacturer:"Akai",detectPatterns:["apc mini","apc mini mk2"],knobs:[],pads:[{note:0,name:"Grid 1:1",defaultMapping:"transport.play"},{note:1,name:"Grid 1:2",defaultMapping:"transport.stop"},{note:2,name:"Grid 1:3",defaultMapping:"transport.record"},{note:3,name:"Grid 1:4",defaultMapping:"transport.loop"},{note:4,name:"Grid 1:5",defaultMapping:"nav.patternDown"},{note:5,name:"Grid 1:6",defaultMapping:"nav.patternUp"},{note:6,name:"Grid 1:7",defaultMapping:"edit.octaveDown"},{note:7,name:"Grid 1:8",defaultMapping:"edit.octaveUp"},{note:8,name:"Grid 2:1",defaultMapping:"dj.deckA.play"},{note:9,name:"Grid 2:2",defaultMapping:"dj.deckA.stop"},{note:10,name:"Grid 2:3",defaultMapping:"dj.deckA.cue"},{note:11,name:"Grid 2:4",defaultMapping:"dj.killAll"},{note:12,name:"Grid 2:5",defaultMapping:"dj.deckB.play"},{note:13,name:"Grid 2:6",defaultMapping:"dj.deckB.stop"},{note:14,name:"Grid 2:7",defaultMapping:"dj.deckB.cue"},{note:15,name:"Grid 2:8",defaultMapping:"dj.sync"},{note:16,name:"Grid 3:1",defaultMapping:"dj.deckA.eqKillLow"},{note:17,name:"Grid 3:2",defaultMapping:"dj.deckA.eqKillMid"},{note:18,name:"Grid 3:3",defaultMapping:"dj.deckA.eqKillHi"},{note:19,name:"Grid 3:4",defaultMapping:"dj.knobPage.prev"},{note:20,name:"Grid 3:5",defaultMapping:"dj.deckB.eqKillLow"},{note:21,name:"Grid 3:6",defaultMapping:"dj.deckB.eqKillMid"},{note:22,name:"Grid 3:7",defaultMapping:"dj.deckB.eqKillHi"},{note:23,name:"Grid 3:8",defaultMapping:"dj.knobPage.next"},{note:24,name:"Grid 4:1",defaultMapping:"edit.undo"},{note:25,name:"Grid 4:2",defaultMapping:"edit.redo"},{note:26,name:"Grid 4:3",defaultMapping:"edit.copy"},{note:27,name:"Grid 4:4",defaultMapping:"edit.paste"},{note:28,name:"Grid 4:5",defaultMapping:"edit.delete"},{note:29,name:"Grid 4:6",defaultMapping:"edit.insertRow"},{note:30,name:"Grid 4:7",defaultMapping:"edit.deleteRow"},{note:31,name:"Grid 4:8",defaultMapping:"pattern.clone"},{note:32,name:"Grid 5:1",defaultMapping:"channel.mute1"},{note:33,name:"Grid 5:2",defaultMapping:"channel.mute2"},{note:34,name:"Grid 5:3",defaultMapping:"channel.mute3"},{note:35,name:"Grid 5:4",defaultMapping:"channel.mute4"},{note:36,name:"Grid 5:5",defaultMapping:"channel.mute5"},{note:37,name:"Grid 5:6",defaultMapping:"channel.mute6"},{note:38,name:"Grid 5:7",defaultMapping:"channel.mute7"},{note:39,name:"Grid 5:8",defaultMapping:"channel.mute8"}],extras:{faders:[{cc:48,name:"Fader 1",defaultMapping:"mixer.volume"},{cc:49,name:"Fader 2",defaultMapping:"mixer.volume"},{cc:50,name:"Fader 3",defaultMapping:"mixer.volume"},{cc:51,name:"Fader 4",defaultMapping:"mixer.volume"},{cc:52,name:"Fader 5",defaultMapping:"mixer.volume"},{cc:53,name:"Fader 6",defaultMapping:"mixer.volume"},{cc:54,name:"Fader 7",defaultMapping:"mixer.volume"},{cc:55,name:"Fader 8",defaultMapping:"mixer.volume"},{cc:56,name:"Master",defaultMapping:"masterFx.masterVolume"}]},suggestedLayout:{pads:{0:"transport.play",1:"transport.stop",2:"transport.record",3:"transport.loop",4:"nav.patternDown",5:"nav.patternUp",6:"edit.octaveDown",7:"edit.octaveUp",8:"dj.deckA.play",9:"dj.deckA.stop",10:"dj.deckA.cue",11:"dj.killAll",12:"dj.deckB.play",13:"dj.deckB.stop",14:"dj.deckB.cue",15:"dj.sync"},faders:{48:"mixer.volume",49:"mixer.volume",50:"mixer.volume",51:"mixer.volume",52:"mixer.volume",53:"mixer.volume",54:"mixer.volume",55:"mixer.volume",56:"masterFx.masterVolume"}}},{id:"novation-launch-control-xl",name:"Launch Control XL",manufacturer:"Novation",detectPatterns:["launch control xl","launchcontrol xl"],knobs:[{cc:13,name:"Send A1",defaultMapping:"tb303.cutoff"},{cc:14,name:"Send A2",defaultMapping:"tb303.resonance"},{cc:15,name:"Send A3",defaultMapping:"tb303.envMod"},{cc:16,name:"Send A4",defaultMapping:"tb303.decay"},{cc:17,name:"Send A5",defaultMapping:"tb303.accent"},{cc:18,name:"Send A6",defaultMapping:"tb303.overdrive"},{cc:19,name:"Send A7",defaultMapping:"tb303.slideTime"},{cc:20,name:"Send A8",defaultMapping:"tb303.normalDecay"},{cc:29,name:"Send B1",defaultMapping:"delayTime"},{cc:30,name:"Send B2",defaultMapping:"delayFeedback"},{cc:31,name:"Send B3",defaultMapping:"delayMix"},{cc:32,name:"Send B4",defaultMapping:"chorusMix"},{cc:33,name:"Send B5",defaultMapping:"phaserRate"},{cc:34,name:"Send B6",defaultMapping:"phaserMix"},{cc:35,name:"Send B7",defaultMapping:"masterFx.slot0.wet"},{cc:36,name:"Send B8",defaultMapping:"masterFx.slot1.wet"},{cc:49,name:"Pan 1",defaultMapping:"mixer.pan"},{cc:50,name:"Pan 2",defaultMapping:"mixer.pan"},{cc:51,name:"Pan 3",defaultMapping:"mixer.pan"},{cc:52,name:"Pan 4",defaultMapping:"mixer.pan"},{cc:53,name:"Pan 5",defaultMapping:"mixer.pan"},{cc:54,name:"Pan 6",defaultMapping:"mixer.pan"},{cc:55,name:"Pan 7",defaultMapping:"mixer.pan"},{cc:56,name:"Pan 8",defaultMapping:"mixer.pan"}],pads:[{cc:41,name:"Focus 1",defaultMapping:"channel.solo1"},{cc:42,name:"Focus 2",defaultMapping:"channel.solo2"},{cc:43,name:"Focus 3",defaultMapping:"channel.solo3"},{cc:44,name:"Focus 4",defaultMapping:"channel.solo4"},{cc:73,name:"Control 1",defaultMapping:"channel.mute1"},{cc:74,name:"Control 2",defaultMapping:"channel.mute2"},{cc:75,name:"Control 3",defaultMapping:"channel.mute3"},{cc:76,name:"Control 4",defaultMapping:"channel.mute4"}],extras:{faders:[{cc:77,name:"Fader 1",defaultMapping:"mixer.volume"},{cc:78,name:"Fader 2",defaultMapping:"mixer.volume"},{cc:79,name:"Fader 3",defaultMapping:"mixer.volume"},{cc:80,name:"Fader 4",defaultMapping:"mixer.volume"},{cc:81,name:"Fader 5",defaultMapping:"mixer.volume"},{cc:82,name:"Fader 6",defaultMapping:"mixer.volume"},{cc:83,name:"Fader 7",defaultMapping:"mixer.volume"},{cc:84,name:"Fader 8",defaultMapping:"masterFx.masterVolume"}]},suggestedLayout:{knobs:{13:"tb303.cutoff",14:"tb303.resonance",15:"tb303.envMod",16:"tb303.decay",17:"tb303.accent",18:"tb303.overdrive",19:"tb303.slideTime",20:"tb303.normalDecay"},faders:{77:"mixer.volume",78:"mixer.volume",79:"mixer.volume",80:"mixer.volume",81:"mixer.volume",82:"mixer.volume",83:"mixer.volume",84:"masterFx.masterVolume"}}},{id:"arturia-keylab-essential",name:"KeyLab Essential",manufacturer:"Arturia",detectPatterns:["keylab essential","keylab 49","keylab 61","arturia keylab"],knobs:[{cc:10,name:"Encoder 1",defaultMapping:"tb303.cutoff"},{cc:74,name:"Encoder 2",defaultMapping:"tb303.resonance"},{cc:71,name:"Encoder 3",defaultMapping:"tb303.envMod"},{cc:76,name:"Encoder 4",defaultMapping:"tb303.decay"},{cc:77,name:"Encoder 5",defaultMapping:"tb303.accent"},{cc:93,name:"Encoder 6",defaultMapping:"tb303.overdrive"},{cc:73,name:"Encoder 7",defaultMapping:"tb303.slideTime"},{cc:75,name:"Encoder 8",defaultMapping:"tb303.normalDecay"},{cc:114,name:"Encoder 9",defaultMapping:"tb303.accentDecay"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"},{note:44,name:"Pad 9",defaultMapping:"dj.deckA.play"},{note:45,name:"Pad 10",defaultMapping:"dj.deckA.cue"},{note:46,name:"Pad 11",defaultMapping:"dj.deckB.play"},{note:47,name:"Pad 12",defaultMapping:"dj.deckB.cue"},{note:48,name:"Pad 13",defaultMapping:"edit.undo"},{note:49,name:"Pad 14",defaultMapping:"edit.redo"},{note:50,name:"Pad 15",defaultMapping:"dj.knobPage.prev"},{note:51,name:"Pad 16",defaultMapping:"dj.knobPage.next"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64},faders:[{cc:73,name:"Fader 1",defaultMapping:"mixer.volume"},{cc:74,name:"Fader 2",defaultMapping:"mixer.volume"},{cc:75,name:"Fader 3",defaultMapping:"mixer.volume"},{cc:76,name:"Fader 4",defaultMapping:"mixer.volume"},{cc:18,name:"Fader 5",defaultMapping:"mixer.volume"},{cc:19,name:"Fader 6",defaultMapping:"mixer.volume"},{cc:16,name:"Fader 7",defaultMapping:"mixer.volume"},{cc:17,name:"Fader 8",defaultMapping:"mixer.volume"},{cc:7,name:"Fader 9",defaultMapping:"masterFx.masterVolume"}]},suggestedLayout:{knobs:{10:"tb303.cutoff",74:"tb303.resonance",71:"tb303.envMod",76:"tb303.decay",77:"tb303.accent",93:"tb303.overdrive",73:"tb303.slideTime",75:"tb303.normalDecay"},pads:{36:"transport.play",37:"transport.stop",38:"transport.record",39:"transport.loop",40:"nav.patternDown",41:"nav.patternUp",42:"edit.octaveDown",43:"edit.octaveUp"}}},{id:"akai-apc-key-25-mk2",name:"APC Key 25 MK2",manufacturer:"Akai",detectPatterns:["apc key 25","apc key25","apckey25"],knobs:[{cc:48,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:49,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:50,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:51,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:52,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:53,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:54,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:55,name:"Knob 8",defaultMapping:"tb303.normalDecay"}],pads:[{note:0,name:"Grid 1:1",defaultMapping:"transport.play"},{note:1,name:"Grid 1:2",defaultMapping:"transport.stop"},{note:2,name:"Grid 1:3",defaultMapping:"transport.record"},{note:3,name:"Grid 1:4",defaultMapping:"transport.loop"},{note:4,name:"Grid 1:5",defaultMapping:"nav.patternDown"},{note:5,name:"Grid 1:6",defaultMapping:"nav.patternUp"},{note:6,name:"Grid 1:7",defaultMapping:"edit.octaveDown"},{note:7,name:"Grid 1:8",defaultMapping:"edit.octaveUp"},{note:8,name:"Grid 2:1",defaultMapping:"dj.deckA.play"},{note:9,name:"Grid 2:2",defaultMapping:"dj.deckA.cue"},{note:10,name:"Grid 2:3",defaultMapping:"dj.deckB.play"},{note:11,name:"Grid 2:4",defaultMapping:"dj.deckB.cue"},{note:12,name:"Grid 2:5",defaultMapping:"dj.killAll"},{note:13,name:"Grid 2:6",defaultMapping:"dj.sync"},{note:14,name:"Grid 2:7",defaultMapping:"dj.knobPage.prev"},{note:15,name:"Grid 2:8",defaultMapping:"dj.knobPage.next"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}},suggestedLayout:{knobs:{48:"tb303.cutoff",49:"tb303.resonance",50:"tb303.envMod",51:"tb303.decay",52:"tb303.accent",53:"tb303.overdrive",54:"tb303.slideTime",55:"tb303.normalDecay"},pads:{0:"transport.play",1:"transport.stop",2:"transport.record",3:"transport.loop",4:"nav.patternDown",5:"nav.patternUp",6:"edit.octaveDown",7:"edit.octaveUp"}}},{id:"korg-nanokey2",name:"nanoKEY2",manufacturer:"Korg",detectPatterns:["nanokey","nano key"],knobs:[],pads:[],extras:{pitchBend:!0,modWheel:{cc:1}}},{id:"korg-nanopad2",name:"nanoPAD2",manufacturer:"Korg",detectPatterns:["nanopad","nano pad"],knobs:[],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"},{note:44,name:"Pad 9",defaultMapping:"edit.undo"},{note:45,name:"Pad 10",defaultMapping:"edit.redo"},{note:46,name:"Pad 11",defaultMapping:"dj.deckA.play"},{note:47,name:"Pad 12",defaultMapping:"dj.deckA.cue"},{note:48,name:"Pad 13",defaultMapping:"dj.deckB.play"},{note:49,name:"Pad 14",defaultMapping:"dj.deckB.cue"},{note:50,name:"Pad 15",defaultMapping:"dj.knobPage.prev"},{note:51,name:"Pad 16",defaultMapping:"dj.knobPage.next"}],extras:{modWheel:{cc:1}},suggestedLayout:{pads:{36:"transport.play",37:"transport.stop",38:"transport.record",39:"transport.loop",40:"nav.patternDown",41:"nav.patternUp",42:"edit.octaveDown",43:"edit.octaveUp",44:"edit.undo",45:"edit.redo",46:"dj.deckA.play",47:"dj.deckA.cue",48:"dj.deckB.play",49:"dj.deckB.cue",50:"dj.knobPage.prev",51:"dj.knobPage.next"}}},{id:"novation-launchpad-mini-mk3",name:"Launchpad Mini MK3",manufacturer:"Novation",detectPatterns:["launchpad mini","launchpad mk3"],knobs:[],pads:[{note:11,name:"Grid 1:1",defaultMapping:"transport.play"},{note:12,name:"Grid 1:2",defaultMapping:"transport.stop"},{note:13,name:"Grid 1:3",defaultMapping:"transport.record"},{note:14,name:"Grid 1:4",defaultMapping:"transport.loop"},{note:15,name:"Grid 1:5",defaultMapping:"nav.patternDown"},{note:16,name:"Grid 1:6",defaultMapping:"nav.patternUp"},{note:17,name:"Grid 1:7",defaultMapping:"edit.octaveDown"},{note:18,name:"Grid 1:8",defaultMapping:"edit.octaveUp"},{note:21,name:"Grid 2:1",defaultMapping:"dj.deckA.play"},{note:22,name:"Grid 2:2",defaultMapping:"dj.deckA.cue"},{note:23,name:"Grid 2:3",defaultMapping:"dj.deckB.play"},{note:24,name:"Grid 2:4",defaultMapping:"dj.deckB.cue"},{note:25,name:"Grid 2:5",defaultMapping:"dj.killAll"},{note:26,name:"Grid 2:6",defaultMapping:"dj.sync"},{note:27,name:"Grid 2:7",defaultMapping:"dj.knobPage.prev"},{note:28,name:"Grid 2:8",defaultMapping:"dj.knobPage.next"},{note:31,name:"Grid 3:1",defaultMapping:"channel.mute1"},{note:32,name:"Grid 3:2",defaultMapping:"channel.mute2"},{note:33,name:"Grid 3:3",defaultMapping:"channel.mute3"},{note:34,name:"Grid 3:4",defaultMapping:"channel.mute4"},{note:35,name:"Grid 3:5",defaultMapping:"channel.mute5"},{note:36,name:"Grid 3:6",defaultMapping:"channel.mute6"},{note:37,name:"Grid 3:7",defaultMapping:"channel.mute7"},{note:38,name:"Grid 3:8",defaultMapping:"channel.mute8"}],suggestedLayout:{pads:{11:"transport.play",12:"transport.stop",13:"transport.record",14:"transport.loop",15:"nav.patternDown",16:"nav.patternUp",17:"edit.octaveDown",18:"edit.octaveUp",21:"dj.deckA.play",22:"dj.deckA.cue",23:"dj.deckB.play",24:"dj.deckB.cue"}}},{id:"generic",name:"Generic MIDI Controller",manufacturer:"Unknown",detectPatterns:[],knobs:[{cc:1,name:"CC 1 (Mod)",defaultMapping:"tb303.cutoff"},{cc:7,name:"CC 7 (Volume)",defaultMapping:"tb303.volume"},{cc:10,name:"CC 10 (Pan)",defaultMapping:"mixer.pan"},{cc:11,name:"CC 11 (Expression)",defaultMapping:"tb303.envMod"},{cc:74,name:"CC 74 (Cutoff)",defaultMapping:"tb303.cutoff"},{cc:71,name:"CC 71 (Resonance)",defaultMapping:"tb303.resonance"}],pads:[],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}},suggestedLayout:{knobs:{74:"tb303.cutoff",71:"tb303.resonance",7:"tb303.volume",11:"tb303.envMod"}}}];function VV(e){const t=e.toLowerCase();for(const n of CV)for(const e of n.detectPatterns)if(t.includes(e.toLowerCase()))return n;return null}const PV=({isOpen:e,onClose:t})=>{const{devices:n,isSupported:s,isEnabled:a,lastMessage:o,enableMIDI:r}=wV(),i=aS(),c=EN(e=>e.instruments);l.useEffect(()=>{e&&a&&i.init()},[e,a,i]);const[u,d]=l.useState("devices"),[m,p]=l.useState(null),[h,f]=l.useState(null),[g,b]=l.useState(!1),[v,y]=l.useState(null),[x,N]=l.useState([]),[w,E]=l.useState(new Set(["Transport","303 Main"])),[k,D]=l.useState(i.getGlobalSensitivity()),[S,M]=l.useState(!1),[C,V]=l.useState("idle"),[P,_]=l.useState(i.getControlledInstrument());l.useEffect(()=>i.onControlledInstrumentChange(e=>{_(e)}),[i]);const O=l.useCallback(e=>{i.setControlledInstrument(e),_(e)},[i]);l.useEffect(()=>{if(a&&n.length>0){const e=DV();requestAnimationFrame(()=>M(e.checkConnection()))}},[a,n]);const T=l.useCallback(async()=>{const e=DV();if(!e.checkConnection())return void V("error");V("syncing");const t={},n={70:1,71:2,72:3,73:4,74:5,75:6,76:7,77:8};x.forEach(e=>{const s=n[e.ccNumber];s&&e.displayName&&(t[s]=e.displayName.substring(0,16))});try{const n=await e.setKnobNames(t);V(n?"success":"error"),n&&setTimeout(()=>V("idle"),2e3)}catch{V("error")}},[x]),L=l.useCallback(async()=>{const e=DV();V("syncing");try{const t=await e.applyDEViLBOXPreset();V(t?"success":"error"),t&&setTimeout(()=>V("idle"),2e3)}catch{V("error")}},[]),A=l.useCallback(()=>{N(i.getAllMappings())},[i]);l.useEffect(()=>{if(n.length>0){const e=VV(n[0].name||"");requestAnimationFrame(()=>{p(e),e&&!h&&f(e)})}},[n,h]),l.useEffect(()=>(requestAnimationFrame(()=>A()),i.onMappingChange(A)),[i,A]),l.useEffect(()=>{if(!g||!v)return;return i.onLearnChange(e=>{e||(b(!1),y(null),A())})},[g,v,i,A]);const B=async e=>{b(!0),y(e);const t=await i.startLearn(0,e.id,e.label,"parameter"===e.type?e.min:0,"parameter"===e.type?e.max:127,"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear");t&&i.setMapping({id:`${t.channel}-${t.ccNumber}-${e.id}`,ccNumber:t.ccNumber,midiChannel:t.channel,instrumentId:0,parameterPath:e.id,min:"parameter"===e.type?e.min:0,max:"parameter"===e.type?e.max:127,curve:"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear",displayName:e.label}),b(!1),y(null)},I=()=>{h&&(h.knobs.forEach(e=>{if(e.defaultMapping){const t=MV[e.defaultMapping];t&&i.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:t.min,max:t.max,curve:e.defaultMapping.includes("cutoff")?"logarithmic":"linear",displayName:t.label})}}),h.pads.forEach(e=>{if(e.defaultMapping&&void 0!==e.cc){const t=SV[e.defaultMapping];t&&i.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:0,max:127,curve:"linear",displayName:t.label})}}),A())},F=()=>{i.clearAllMappings(),A()},U=e=>{E(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},R=e=>x.some(t=>t.parameterPath===e),j=e=>x.find(t=>t.parameterPath===e);if(!e)return null;const X=Object.entries(MV).reduce((e,[t,n])=>{const s=n.category;return e[s]||(e[s]=[]),e[s].push({id:t,...n}),e},{}),z=Object.entries(SV).reduce((e,[t,n])=>{const s=n.category;return e[s]||(e[s]=[]),e[s].push({id:t,...n}),e},{});return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:Yn.jsxDEV("div",{className:"bg-dark-bg border border-dark-border rounded-lg w-[800px] max-h-[85vh] flex flex-col",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Yn.jsxDEV("h2",{className:"text-lg font-semibold text-text-primary flex items-center gap-2",children:[Yn.jsxDEV(Me,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:355,columnNumber:13},void 0),"MIDI Controller Setup"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:354,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary transition-colors",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:362,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:358,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:353,columnNumber:9},void 0),g&&v&&Yn.jsxDEV("div",{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-10 rounded-lg",children:[Yn.jsxDEV(Ve,{size:48,className:"text-accent-primary animate-spin mb-4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:369,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-text-primary text-lg mb-2",children:"Move a controller to map to:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:370,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-accent-primary text-xl font-bold mb-4",children:v.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:373,columnNumber:13},void 0),o&&"cc"===o.type&&Yn.jsxDEV("p",{className:"text-text-muted text-sm mb-4",children:["Last: CH",o.channel+1," CC",o.controller," = ",o.value]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:377,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>{i.cancelLearn(),b(!1),y(null)},className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:381,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:368,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex border-b border-dark-border",children:[{id:"devices",label:"Devices",icon:Me},{id:"parameters",label:"TB-303",icon:Pe},{id:"actions",label:"Tracker",icon:_e},{id:"mappings",label:"Mappings",icon:Oe},{id:"settings",label:"Settings",icon:Te}].map(e=>Yn.jsxDEV("button",{onClick:()=>d(e.id),className:`\n                flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors\n                ${u===e.id?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-secondary"}\n              `,children:[Yn.jsxDEV(e.icon,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:410,columnNumber:15},void 0),e.label]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:399,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:391,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4",children:["devices"===u&&Yn.jsxDEV("div",{className:"space-y-4",children:s?a?0===n.length?Yn.jsxDEV("div",{className:"text-center py-8",children:[Yn.jsxDEV(Me,{size:48,className:"mx-auto text-text-muted mb-4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:446,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-secondary",children:"No MIDI devices detected"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:447,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-sm mt-2",children:"Connect a MIDI controller and refresh"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:450,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:445,columnNumber:17},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Connected Devices"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:457,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:n.map(e=>Yn.jsxDEV("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded p-3",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:467,columnNumber:29},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("div",{className:"text-text-primary font-medium",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:469,columnNumber:31},void 0),Yn.jsxDEV("div",{className:"text-text-muted text-xs",children:e.manufacturer},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:470,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:468,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:466,columnNumber:27},void 0),m&&e.name?.toLowerCase().includes(m.detectPatterns[0])&&Yn.jsxDEV("span",{className:"text-xs bg-accent-primary/20 text-accent-primary px-2 py-1 rounded",children:["Auto-detected: ",m.name]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:474,columnNumber:29},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:462,columnNumber:25},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:460,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:456,columnNumber:19},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Controller Profile"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:484,columnNumber:21},void 0),Yn.jsxDEV("select",{value:h?.id||"",onChange:e=>{const t=CV.find(t=>t.id===e.target.value);f(t||null)},className:"w-full bg-dark-bgSecondary border border-dark-border rounded px-3 py-2 text-text-primary",children:[Yn.jsxDEV("option",{value:"",children:"Select a profile..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:495,columnNumber:23},void 0),CV.map(e=>Yn.jsxDEV("option",{value:e.id,children:[e.manufacturer," ",e.name]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:497,columnNumber:25},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:487,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:483,columnNumber:19},void 0),h&&Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded p-4",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[Yn.jsxDEV("h4",{className:"text-sm font-medium text-text-primary",children:[h.manufacturer," ",h.name]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:507,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:I,className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white text-sm rounded transition-colors",children:"Apply Suggested Mappings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:510,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:506,columnNumber:23},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Knobs:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:519,columnNumber:27},void 0)," ",Yn.jsxDEV("span",{className:"text-text-secondary",children:h.knobs.length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:520,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:518,columnNumber:25},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Pads:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:523,columnNumber:27},void 0)," ",Yn.jsxDEV("span",{className:"text-text-secondary",children:h.pads.length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:524,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:522,columnNumber:25},void 0),h.extras?.faders&&Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Faders:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:528,columnNumber:29},void 0)," ",Yn.jsxDEV("span",{className:"text-text-secondary",children:h.extras.faders.length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:529,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:527,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:517,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:505,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:455,columnNumber:17},void 0):Yn.jsxDEV("div",{className:"text-center py-8",children:[Yn.jsxDEV(Me,{size:48,className:"mx-auto text-text-muted mb-4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:433,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-secondary mb-4",children:"Enable MIDI to connect your controller"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:434,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:r,className:"px-6 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded font-medium transition-colors",children:"Enable MIDI"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:437,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:432,columnNumber:17},void 0):Yn.jsxDEV("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-4",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 text-accent-error",children:[Yn.jsxDEV(Le,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:424,columnNumber:21},void 0),Yn.jsxDEV("span",{children:"Web MIDI API not supported"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:425,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:423,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-sm mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:427,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:422,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:420,columnNumber:13},void 0),"parameters"===u&&Yn.jsxDEV("div",{className:"space-y-3",children:Object.entries(X).map(([e,t])=>Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[Yn.jsxDEV("button",{onClick:()=>U(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[Yn.jsxDEV("span",{className:"text-sm font-medium text-text-secondary",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:549,columnNumber:21},void 0),w.has(e)?Yn.jsxDEV(De,{size:16,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:551,columnNumber:23},void 0):Yn.jsxDEV(Ae,{size:16,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:553,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:545,columnNumber:19},void 0),w.has(e)&&Yn.jsxDEV("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=R(e.id),n=j(e.id),s=g&&v?.id===e.id;return Yn.jsxDEV("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${s?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[t&&Yn.jsxDEV(Be,{size:14,className:"text-accent-success"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:577,columnNumber:42},void 0),Yn.jsxDEV("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:578,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:576,columnNumber:29},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[n&&Yn.jsxDEV("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",n.ccNumber]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:584,columnNumber:33},void 0),Yn.jsxDEV("button",{onClick:()=>B({type:"parameter",id:e.id,label:e.label,min:e.min,max:e.max,category:e.category}),disabled:g,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${s?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:s?"Learning...":"Learn"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:588,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:582,columnNumber:29},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:564,columnNumber:27},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:557,columnNumber:21},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:544,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:542,columnNumber:13},void 0),"actions"===u&&Yn.jsxDEV("div",{className:"space-y-3",children:Object.entries(z).map(([e,t])=>Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[Yn.jsxDEV("button",{onClick:()=>U(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[Yn.jsxDEV("span",{className:"text-sm font-medium text-text-secondary",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:630,columnNumber:21},void 0),w.has(e)?Yn.jsxDEV(De,{size:16,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:632,columnNumber:23},void 0):Yn.jsxDEV(Ae,{size:16,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:634,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:626,columnNumber:19},void 0),w.has(e)&&Yn.jsxDEV("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=R(e.id),n=j(e.id),s=g&&v?.id===e.id;return Yn.jsxDEV("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${s?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[t&&Yn.jsxDEV(Be,{size:14,className:"text-accent-success"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:658,columnNumber:42},void 0),Yn.jsxDEV("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:659,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:657,columnNumber:29},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[n&&Yn.jsxDEV("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",n.ccNumber]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:665,columnNumber:33},void 0),Yn.jsxDEV("button",{onClick:()=>B({type:"action",id:e.id,label:e.label,category:e.category}),disabled:g,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${s?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:s?"Learning...":"Learn"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:669,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:663,columnNumber:29},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:645,columnNumber:27},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:638,columnNumber:21},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:625,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:623,columnNumber:13},void 0),"mappings"===u&&Yn.jsxDEV("div",{className:"space-y-4",children:0===x.length?Yn.jsxDEV("div",{className:"text-center py-8",children:[Yn.jsxDEV(Oe,{size:48,className:"mx-auto text-text-muted mb-4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:705,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-secondary",children:"No mappings configured"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:706,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-sm mt-2",children:"Go to TB-303 or Tracker tabs to create mappings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:707,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:704,columnNumber:17},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"flex justify-end",children:Yn.jsxDEV("button",{onClick:F,className:"flex items-center gap-1 text-sm text-accent-error hover:underline",children:[Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:718,columnNumber:23},void 0),"Clear All"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:714,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:713,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:x.map(e=>Yn.jsxDEV("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded px-4 py-3",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("div",{className:"text-text-primary font-medium",children:e.displayName||e.parameterPath},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:729,columnNumber:27},void 0),Yn.jsxDEV("div",{className:"text-text-muted text-xs",children:e.parameterPath},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:732,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:728,columnNumber:25},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[Yn.jsxDEV("div",{className:"text-right",children:[Yn.jsxDEV("div",{className:"text-text-secondary font-mono text-sm",children:[void 0!==e.midiChannel?`CH${e.midiChannel+1} `:"","CC",e.ccNumber]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:738,columnNumber:29},void 0),Yn.jsxDEV("div",{className:"text-text-muted text-xs",children:[e.min," - ",e.max," (",e.curve,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:741,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:737,columnNumber:27},void 0),Yn.jsxDEV("button",{onClick:()=>{return t=e.id,i.removeMapping(t),void A();var t},className:"text-accent-error hover:text-accent-error/80 transition-colors",children:Yn.jsxDEV(Ie,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:749,columnNumber:29},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:745,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:736,columnNumber:25},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:724,columnNumber:23},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:722,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:712,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:702,columnNumber:13},void 0),"settings"===u&&Yn.jsxDEV("div",{className:"space-y-6",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Knob Sensitivity"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:764,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded p-4",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[Yn.jsxDEV("span",{className:"text-text-muted text-sm",children:"Slow (Smooth)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:769,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:k.toFixed(2)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:770,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-muted text-sm",children:"Fast (Direct)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:771,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:768,columnNumber:19},void 0),Yn.jsxDEV("input",{type:"range",min:"0.05",max:"1",step:"0.05",value:k,onChange:e=>{return t=parseFloat(e.target.value),D(t),void i.setGlobalSensitivity(t);var t},className:"w-full accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:773,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs mt-2",children:"Lower values make knobs respond more smoothly but slower. Higher values give immediate response."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:782,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:767,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:763,columnNumber:15},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[Yn.jsxDEV(Pe,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:792,columnNumber:19},void 0),"Controlled Instrument"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:791,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded p-4",children:[Yn.jsxDEV("select",{value:P??"all",onChange:e=>{const t=e.target.value;O("all"===t?null:parseInt(t))},className:"w-full bg-dark-bgTertiary border border-dark-border rounded px-3 py-2 text-text-primary mb-2",children:[Yn.jsxDEV("option",{value:"all",children:"All TB-303 Instruments"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:804,columnNumber:21},void 0),c.map(e=>Yn.jsxDEV("option",{value:e.id,children:[e.id,". ",e.name," (",e.synthType||"Sampler",")"]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:806,columnNumber:23},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:796,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs",children:'Choose which instrument responds to MIDI CC knobs. "All TB-303" controls every TB-303 synth at once.'},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:811,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:795,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:790,columnNumber:15},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Quick Setup"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:819,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:[Yn.jsxDEV("button",{onClick:I,disabled:!h,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgSecondary disabled:text-text-muted text-white rounded font-medium transition-colors",children:[Yn.jsxDEV(Oe,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:828,columnNumber:21},void 0),"Apply Suggested Mappings"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:823,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:F,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:[Yn.jsxDEV(Ie,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:835,columnNumber:21},void 0),"Clear All Mappings"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:831,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:822,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:818,columnNumber:15},void 0),S&&Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[Yn.jsxDEV(Fe,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:845,columnNumber:21},void 0),"MPK Mini MK3 Display"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:844,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded p-4 space-y-3",children:[Yn.jsxDEV("p",{className:"text-text-muted text-xs",children:"Sync parameter names to your MPK Mini's OLED display. Names will show when you turn the knobs."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:849,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:[Yn.jsxDEV("button",{onClick:T,disabled:"syncing"===C||0===x.length,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgTertiary disabled:text-text-muted text-white rounded text-sm transition-colors",children:[Yn.jsxDEV(Fe,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:859,columnNumber:25},void 0),"syncing"===C?"Syncing...":"Sync Current Mappings"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:854,columnNumber:23},void 0),Yn.jsxDEV("button",{onClick:L,disabled:"syncing"===C,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-sm transition-colors",children:[Yn.jsxDEV(Oe,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:867,columnNumber:25},void 0),"Apply DEViLBOX Preset (TB-303)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:862,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:853,columnNumber:21},void 0),"success"===C&&Yn.jsxDEV("p",{className:"text-accent-success text-xs flex items-center gap-1",children:[Yn.jsxDEV(Be,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:873,columnNumber:25},void 0)," Display updated!"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:872,columnNumber:23},void 0),"error"===C&&Yn.jsxDEV("p",{className:"text-accent-error text-xs flex items-center gap-1",children:[Yn.jsxDEV(Le,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:878,columnNumber:25},void 0)," Failed to update display"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:877,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:848,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:843,columnNumber:17},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Supported Controllers"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:886,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2 text-sm",children:CV.filter(e=>"generic"!==e.id).map(e=>Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded px-3 py-2 text-text-muted",children:[e.manufacturer," ",e.name]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:891,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:889,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:885,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:762,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:417,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-t border-dark-border",children:[Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:[x.length," mapping",1!==x.length?"s":""," active"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:906,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Close"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:909,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:905,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:351,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDILearnModal.tsx",lineNumber:350,columnNumber:5},void 0)},_V=()=>{const e=OM(e=>e.nksKnobAssignments),t=OM(e=>e.nksKnobPage),n=OM(e=>e.nksKnobTotalPages),s=OM(e=>e.nksActiveSynthType),a=OM(e=>e.nextKnobPage),o=OM(e=>e.prevKnobPage),r=OM(e=>e.outputDevices).some(e=>e.name?.toLowerCase().includes("mpk mini"));return Yn.jsxDEV("div",{className:"nks-settings-panel p-4 space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-sm font-semibold text-text-primary",children:"NKS Performance"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:43,columnNumber:11},void 0),s&&Yn.jsxDEV("div",{className:"text-xs text-accent-primary mt-0.5",children:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:45,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:42,columnNumber:9},void 0),n>1&&Yn.jsxDEV("div",{className:"text-xs text-text-muted font-mono",children:["Page ",t+1,"/",n]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:49,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:41,columnNumber:7},void 0),e.length>0?Yn.jsxDEV("div",{className:"space-y-2",children:[Yn.jsxDEV("div",{className:"grid grid-cols-4 gap-1.5",children:e.map((e,t)=>Yn.jsxDEV("div",{className:"flex flex-col items-center p-1.5 rounded bg-dark-bgSecondary border border-dark-border",children:[Yn.jsxDEV("span",{className:"text-[8px] font-mono text-text-muted",children:["K",t+1]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:64,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[10px] font-bold text-accent-primary uppercase truncate w-full text-center",children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:67,columnNumber:17},void 0)]},`${e.param}-${t}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:60,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:58,columnNumber:11},void 0),n>1&&Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("button",{onClick:o,className:"flex-1 px-2 py-1 bg-dark-bgSecondary hover:bg-dark-bgHover text-text-secondary rounded transition-colors text-xs",children:"Prev"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:77,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"px-3 py-1 bg-dark-bgSecondary rounded text-text-primary text-xs font-mono",children:[t+1," / ",n]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:83,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:a,className:"flex-1 px-2 py-1 bg-dark-bgSecondary hover:bg-dark-bgHover text-text-secondary rounded transition-colors text-xs",children:"Next"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:86,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:76,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:57,columnNumber:9},void 0):Yn.jsxDEV("div",{className:"text-xs text-text-muted py-2",children:"Play a note to auto-detect synth and load knob assignments."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:96,columnNumber:9},void 0),r&&Yn.jsxDEV("div",{className:"space-y-1.5 pt-2 border-t border-dark-border",children:[Yn.jsxDEV("div",{className:"text-[10px] font-medium text-text-muted uppercase",children:"Display"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:104,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:async()=>{await NM(" ** TEST ","** READY"),setTimeout(()=>{NM("DEViLBOX"," Tracker ")},2e3)},className:"w-full px-3 py-1.5 bg-accent-primary/20 hover:bg-accent-primary/30 text-accent-primary rounded transition-colors text-xs",children:"Test Display"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:105,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"text-[9px] text-text-muted",children:"MK3 pad LEDs are hardware-only (not MIDI controllable)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:111,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:103,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/PerformancePanel.tsx",lineNumber:39,columnNumber:5},void 0)},OV=a.memo(({inline:e=!1})=>{const[t,n]=l.useState(e),[s,a]=l.useState(!1),[o,r]=l.useState(!1),i=l.useRef(null),c=OM(e=>e.isSupported),u=OM(e=>e.isInitialized),d=OM(e=>e.lastError),m=OM(e=>e.inputDevices),p=OM(e=>e.outputDevices),h=OM(e=>e.selectedInputId),f=OM(e=>e.selectedOutputId),g=OM(e=>e.isLearning),b=OM(e=>e.lastActivityTimestamp),v=OM(e=>e.init),y=OM(e=>e.selectInput),x=OM(e=>e.selectOutput),N=OM(e=>e.cancelLearn),w=OM(e=>e.openPatternDialog);l.useEffect(()=>{u||null!==c||(requestAnimationFrame(()=>a(!0)),v().finally(()=>requestAnimationFrame(()=>a(!1))))},[u,c,v]);l.useEffect(()=>{if(!t)return;const e=e=>{i.current&&!i.current.contains(e.target)&&(n(!1),g&&N())};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[t,g,N]);const[E,k]=l.useState(!1);l.useEffect(()=>{if(b>0){requestAnimationFrame(()=>k(!0));const e=setTimeout(()=>k(!1),100);return()=>clearTimeout(e)}},[b]);const D=eS();return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:e?"w-full":"relative",ref:e?void 0:i,children:[!e&&Yn.jsxDEV("button",{onClick:()=>n(!t),className:`\n            flex items-center gap-2 px-2 py-1 rounded text-sm font-medium\n            transition-all duration-150\n            ${t?"bg-dark-bgActive text-text-primary":"hover:bg-dark-bgHover"}\n            ${null===c||!1===c?"text-text-muted":d?"text-accent-error":u?h||f?"text-accent-success":"text-accent-warning":"text-text-muted"}\n          `,title:c?u?h||f?"MIDI connected":"No MIDI device":"MIDI not initialized":"MIDI not supported",children:[Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV(Me,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:122,columnNumber:13},void 0),E&&Yn.jsxDEV("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-accent-primary rounded-full animate-ping"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:124,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:121,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"hidden sm:inline",children:"MIDI"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:127,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:103,columnNumber:9},void 0),t&&Yn.jsxDEV("div",{className:e?"w-full":"absolute right-0 top-full mt-1 w-80 max-h-[80vh] bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl z-50 overflow-y-auto",children:[!e&&Yn.jsxDEV("div",{className:"px-4 py-3 border-b border-dark-border bg-dark-bgSecondary",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("h3",{className:"text-sm font-bold text-text-primary",children:"MIDI Settings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:138,columnNumber:17},void 0),s&&Yn.jsxDEV(Ue,{size:14,className:"animate-spin text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:139,columnNumber:36},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:137,columnNumber:15},void 0),d&&Yn.jsxDEV("div",{className:"flex items-center gap-2 mt-1 text-xs text-accent-error",children:[Yn.jsxDEV(Le,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:143,columnNumber:19},void 0),Yn.jsxDEV("span",{children:d},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:144,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:142,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:136,columnNumber:13},void 0),!1===c?Yn.jsxDEV("div",{className:"px-4 py-6",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 mb-3 justify-center",children:D.isIOS||D.instructions?.includes("Android")?Yn.jsxDEV(Re,{size:24,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:154,columnNumber:19},void 0):Yn.jsxDEV(Le,{size:24,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:156,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:152,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-secondary text-center mb-3",children:"Web MIDI API is not supported in this browser."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:159,columnNumber:15},void 0),D.isIOS&&d&&Yn.jsxDEV("div",{className:"text-xs bg-accent-warning/10 border border-accent-warning/30 rounded p-3 mb-3",children:[Yn.jsxDEV("p",{className:"font-bold text-accent-warning mb-2",children:"Safari Troubleshooting:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:166,columnNumber:19},void 0),Yn.jsxDEV("ul",{className:"list-disc list-inside space-y-1 text-text-secondary",children:[Yn.jsxDEV("li",{children:["Make sure you're using ",Yn.jsxDEV("strong",{children:"Safari"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:168,columnNumber:48},void 0)," (not Chrome on iOS)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:168,columnNumber:21},void 0),Yn.jsxDEV("li",{children:["Web MIDI requires ",Yn.jsxDEV("strong",{children:"HTTPS"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:169,columnNumber:43},void 0)," - check the URL starts with https://"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:169,columnNumber:21},void 0),Yn.jsxDEV("li",{children:["Disable ",Yn.jsxDEV("strong",{children:"Private Browsing Mode"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:170,columnNumber:33},void 0)," - MIDI doesn't work in private mode"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:170,columnNumber:21},void 0),Yn.jsxDEV("li",{children:["Check ",Yn.jsxDEV("strong",{children:"Settings  Safari  Advanced  Experimental Features"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:171,columnNumber:31},void 0)," and ensure 'Web MIDI API' is ON"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:171,columnNumber:21},void 0),Yn.jsxDEV("li",{children:[Yn.jsxDEV("strong",{children:"Home Screen Apps (PWA):"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:172,columnNumber:25},void 0)," Apple sometimes disables MIDI for apps saved to the home screen. Try using the regular Safari browser tab."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:172,columnNumber:21},void 0),Yn.jsxDEV("li",{children:["Update to ",Yn.jsxDEV("strong",{children:"iOS 15+"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:173,columnNumber:35},void 0)," for full MIDI support"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:173,columnNumber:21},void 0),Yn.jsxDEV("li",{children:"Check browser console for detailed error messages"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:174,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:167,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"mt-3 pt-3 border-t border-accent-warning/20 font-mono text-[10px] text-text-muted space-y-1",children:[Yn.jsxDEV("div",{className:"flex justify-between",children:[Yn.jsxDEV("span",{children:"Secure Context:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:180,columnNumber:23},void 0),Yn.jsxDEV("span",{className:window.isSecureContext?"text-accent-success":"text-accent-error",children:window.isSecureContext?"YES":"NO"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:181,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:179,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between",children:[Yn.jsxDEV("span",{children:"PWA Mode:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:186,columnNumber:23},void 0),Yn.jsxDEV("span",{children:navigator.standalone||window.matchMedia("(display-mode: standalone)").matches?"YES":"NO"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:187,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:185,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between",children:[Yn.jsxDEV("span",{children:"Protocol:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:193,columnNumber:23},void 0),Yn.jsxDEV("span",{children:window.location.protocol},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:194,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:192,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:178,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:165,columnNumber:17},void 0),D.instructions&&Yn.jsxDEV("div",{className:"text-xs text-text-muted text-left bg-dark-bgSecondary rounded p-3 max-h-64 overflow-y-auto whitespace-pre-line",children:D.instructions},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:201,columnNumber:17},void 0),Yn.jsxDEV("button",{onClick:async()=>{a(!0),OM.setState(e=>{e.isSupported=null,e.lastError=null}),await v(),a(!1)},disabled:s,className:"w-full mt-3 px-4 py-2.5 bg-accent-primary/20 border border-accent-primary/30 rounded-lg text-sm font-bold text-accent-primary hover:bg-accent-primary/30 transition-colors disabled:opacity-50",children:s?"Checking...":"Retry MIDI Detection"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:207,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:151,columnNumber:13},void 0):null===c?Yn.jsxDEV("div",{className:"px-4 py-6 text-center",children:[Yn.jsxDEV(Ue,{size:24,className:"mx-auto mb-2 text-text-muted animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:217,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-secondary",children:"Checking MIDI support..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:218,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:216,columnNumber:13},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"px-4 py-3 space-y-3 border-b border-dark-border",children:[Yn.jsxDEV(NV,{label:"Input Device",devices:m,selectedId:h,onSelect:y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:226,columnNumber:17},void 0),Yn.jsxDEV(NV,{label:"Output Device",devices:p,selectedId:f,onSelect:x},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:232,columnNumber:17},void 0),(D.isIOS||D.instructions?.includes("Android"))&&0===m.length&&0===p.length&&d&&Yn.jsxDEV("div",{className:"mt-2 p-3 bg-dark-bgSecondary rounded border border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 mb-2",children:[Yn.jsxDEV(Re,{size:14,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:243,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-xs font-medium text-text-primary",children:"Mobile MIDI Setup"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:244,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:242,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"text-xs text-text-muted whitespace-pre-line max-h-48 overflow-y-auto",children:D.instructions},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:248,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:241,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:225,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"px-4 py-2 border-b border-dark-border space-y-2",children:[Yn.jsxDEV("button",{onClick:()=>{n(!1),r(!0)},className:"w-full px-3 py-2 text-sm font-medium bg-accent-primary/20 border border-accent-primary/30 rounded flex items-center justify-center gap-2 hover:bg-accent-primary/30 transition-colors text-accent-primary",children:[Yn.jsxDEV(je,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:265,columnNumber:19},void 0),"MIDI Controller Setup..."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:258,columnNumber:17},void 0),Yn.jsxDEV("button",{onClick:()=>{n(!1),w()},className:"w-full px-3 py-2 text-sm font-medium bg-dark-bgActive rounded flex items-center justify-center gap-2 hover:bg-dark-bgHover transition-colors",children:[Yn.jsxDEV(Xe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:276,columnNumber:19},void 0),"TD-3 Patterns..."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:269,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:256,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"border-t border-dark-border",children:Yn.jsxDEV(_V,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:283,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:282,columnNumber:15},void 0),h&&Yn.jsxDEV("div",{className:"px-4 py-2 border-t border-dark-border bg-dark-bgSecondary",children:Yn.jsxDEV("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[Yn.jsxDEV(ze,{size:10,className:E?"text-accent-success":"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:290,columnNumber:21},void 0),Yn.jsxDEV("span",{children:E?"Receiving MIDI...":"Listening for MIDI input"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:294,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:289,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:288,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:223,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:133,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:100,columnNumber:5},void 0),Yn.jsxDEV(PV,{isOpen:o,onClose:()=>r(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:307,columnNumber:5},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/midi/MIDIToolbarDropdown.tsx",lineNumber:99,columnNumber:5},void 0)}),TV=({variant:e="default",size:t="md",color:n="default",fullWidth:s=!1,loading:a=!1,icon:o,iconPosition:r="left",children:i,className:l="",disabled:c,...u})=>{const d={primary:"btn-primary",default:"btn",ghost:"btn-ghost",icon:"btn-icon",danger:"btn-danger",ft2:""},m={sm:"btn-sm",md:"btn-md",lg:"btn-lg",icon:""};let p="inline-flex items-center justify-center gap-2 font-medium transition-colors focus:outline-none";if("ft2"===e)p+=` ft2-btn ${{sm:"ft2-btn-small",md:"",lg:"",icon:""}[t]} ${{default:"",red:"ft2-btn-red",green:"ft2-btn-green",yellow:"ft2-btn-yellow",blue:"ft2-btn-blue",purple:"ft2-btn-purple",cyan:"",amber:""}[n]}`;else{p+=` ${d[e]||d.default}`,m[t]&&(p+=` ${m[t]}`)}s&&(p+=" w-full"),(c||a)&&(p+=" opacity-50 cursor-not-allowed"),l&&(p+=` ${l}`);const h=Yn.jsxDEV("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[Yn.jsxDEV("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/Button.tsx",lineNumber:104,columnNumber:7},void 0),Yn.jsxDEV("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/Button.tsx",lineNumber:112,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/Button.tsx",lineNumber:103,columnNumber:5},void 0);return Yn.jsxDEV("button",{...u,className:p,disabled:c||a,children:[a&&h,!a&&o&&"left"===r&&o,i,!a&&o&&"right"===r&&o]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/Button.tsx",lineNumber:121,columnNumber:5},void 0)},LV=({isOpen:e,onClose:t})=>{if(!e)return null;const n=[{name:"Windows",icon:Yn.jsxDEV(Fe,{size:24},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:23,columnNumber:13},void 0),desc:"Installer (.exe) or Portable (.zip)",color:"text-blue-400"},{name:"macOS",icon:Yn.jsxDEV(We,{size:24},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:29,columnNumber:13},void 0),desc:"Disk Image (.dmg) for Intel/Apple Silicon",color:"text-gray-300"},{name:"Linux",icon:Yn.jsxDEV(qe,{size:24},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:35,columnNumber:13},void 0),desc:"AppImage, Debian, or Tarball",color:"text-orange-400"}];return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100] animate-fade-in",children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden animate-slide-in-up",children:[Yn.jsxDEV("div",{className:"bg-dark-bgTertiary px-6 py-4 flex items-center justify-between border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("div",{className:"p-2 rounded-lg bg-accent-primary/20 text-accent-primary",children:Yn.jsxDEV(Ge,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:48,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:47,columnNumber:13},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("h2",{className:"text-lg font-bold text-text-primary",children:"Download DEViLBOX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:51,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted font-mono",children:"Native Desktop Applications"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:52,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:50,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:46,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"icon",size:"icon",onClick:t,"aria-label":"Close dialog",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:61,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:55,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:45,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-6",children:[Yn.jsxDEV("p",{className:"text-sm text-text-secondary mb-6 leading-relaxed",children:"Experience DEViLBOX with lower latency, better performance, and offline support. Native apps provide full access to system audio and MIDI resources."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:67,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:n.map(e=>Yn.jsxDEV("a",{href:"https://github.com/spotUP/DEViLBOX/releases/latest",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-4 p-4 rounded-xl border border-dark-border bg-dark-bg hover:bg-dark-bgHover hover:border-accent-primary/50 transition-all duration-200 shadow-sm",children:[Yn.jsxDEV("div",{className:`p-3 rounded-lg bg-dark-bgSecondary ${e.color} group-hover:scale-110 transition-transform duration-200`,children:e.icon},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:81,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex-1",children:[Yn.jsxDEV("h3",{className:"font-semibold text-text-primary group-hover:text-accent-primary transition-colors",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:85,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:e.desc},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:88,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:84,columnNumber:17},void 0),Yn.jsxDEV(He,{size:16,className:"text-text-muted group-hover:text-text-primary group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:90,columnNumber:17},void 0)]},e.name,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:74,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:72,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"mt-8 pt-6 border-t border-dark-border text-center",children:Yn.jsxDEV("p",{className:"text-[10px] text-text-muted font-mono uppercase tracking-widest",children:"Built with Electron & Tone.js"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:96,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:95,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:66,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:43,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/DownloadModal.tsx",lineNumber:42,columnNumber:5},void 0)},AV=Object.freeze(Object.defineProperty({__proto__:null,DownloadModal:LV},Symbol.toStringTag,{value:"Module"})),BV=({isOpen:e,onClose:t,onSuccess:n})=>{const[s,a]=l.useState("login"),[o,r]=l.useState(""),[i,c]=l.useState(""),[u,d]=l.useState(""),{signup:m,login:p,isLoading:h,error:f,clearError:g}=CC();return e?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/70 z-[10001]",onClick:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:49,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"fixed inset-x-4 top-1/2 -translate-y-1/2 max-w-md mx-auto bg-dark-bgTertiary border-2 border-dark-border rounded-lg shadow-2xl z-[10002]",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-dark-border bg-dark-bgSecondary",children:[Yn.jsxDEV("h2",{className:"font-bold text-lg text-text-primary",children:"login"===s?"Login to DEViLBOX":"Create Account"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:58,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors","aria-label":"Close",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:66,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:61,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:57,columnNumber:9},void 0),Yn.jsxDEV("form",{onSubmit:async e=>{if(e.preventDefault(),g(),"signup"!==s||i===u)try{"signup"===s?await m(o,i):await p(o,i),n?.(),t()}catch(a){}},className:"p-6 space-y-4",children:[Yn.jsxDEV("div",{className:"bg-accent-info/10 border border-accent-info/30 rounded p-3",children:Yn.jsxDEV("p",{className:"text-xs text-accent-info",children:"login"===s?"Login to save your songs to the server and access them from any device.":"Create an account to save your songs to the server. No email required!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:74,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:73,columnNumber:11},void 0),f&&Yn.jsxDEV("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-3 flex items-start gap-2",children:[Yn.jsxDEV(Le,{size:16,className:"text-accent-error flex-shrink-0 mt-0.5"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:84,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-xs text-accent-error",children:f},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:85,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:83,columnNumber:13},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Username"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:91,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV(Ke,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:95,columnNumber:15},void 0),Yn.jsxDEV("input",{type:"text",value:o,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-bgSecondary border border-dark-border rounded text-text-primary focus:outline-none focus:border-accent-primary",placeholder:"Enter username",required:!0,minLength:3,maxLength:20,autoComplete:"username"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:96,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:94,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted mt-1",children:"3-20 characters"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:108,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:90,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Password"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:113,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV($e,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:117,columnNumber:15},void 0),Yn.jsxDEV("input",{type:"password",value:i,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-bgSecondary border border-dark-border rounded text-text-primary focus:outline-none focus:border-accent-primary",placeholder:"Enter password",required:!0,minLength:6,autoComplete:"signup"===s?"new-password":"current-password"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:118,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:116,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted mt-1",children:"At least 6 characters"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:129,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:112,columnNumber:11},void 0),"signup"===s&&Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Confirm Password"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:135,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV($e,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:139,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"password",value:u,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-dark-bgSecondary border border-dark-border rounded text-text-primary focus:outline-none focus:border-accent-primary",placeholder:"Confirm password",required:!0,autoComplete:"new-password"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:140,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:138,columnNumber:15},void 0),u&&i!==u&&Yn.jsxDEV("p",{className:"text-xs text-accent-error mt-1",children:"Passwords don't match"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:151,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:134,columnNumber:13},void 0),Yn.jsxDEV("button",{type:"submit",disabled:h||"signup"===s&&i!==u,className:"w-full py-3 bg-accent-primary hover:bg-accent-primary/90 disabled:bg-accent-primary/50 disabled:cursor-not-allowed text-white font-bold rounded transition-colors",children:h?"Please wait...":"login"===s?"Login":"Create Account"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:157,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"text-center pt-2",children:Yn.jsxDEV("button",{type:"button",onClick:()=>{a("login"===s?"signup":"login"),g()},className:"text-sm text-accent-primary hover:underline",children:"login"===s?"Don't have an account? Sign up":"Already have an account? Login"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:167,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:166,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:71,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:55,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AuthModal.tsx",lineNumber:47,columnNumber:5},void 0):null},IV=Object.freeze(Object.defineProperty({__proto__:null,AuthModal:BV},Symbol.toStringTag,{value:"Module"})),FV=({isOpen:e,onClose:t})=>{const{status:n,roomCode:s,errorMessage:a,createRoom:o,joinRoom:r}=dV(),[i,c]=l.useState(""),[u,d]=l.useState(!1),[m,p]=l.useState("pick"),h=l.useCallback(async()=>{p("create"),await o()},[o]),f=l.useCallback(async()=>{i.trim().length<6||await r(i)},[r,i]),g=l.useCallback(()=>{s&&navigator.clipboard.writeText(s).then(()=>{d(!0),setTimeout(()=>d(!1),2e3)})},[s]);return e?Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:Yn.jsxDEV("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary rounded-xl p-6 max-w-md w-full mx-4 animate-slide-in-up shadow-2xl",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-6",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("div",{className:"p-2 rounded-lg bg-accent-primary/20 text-accent-primary",children:Yn.jsxDEV(Ye,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:51,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:50,columnNumber:13},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("h2",{className:"text-xl font-bold text-text-primary",children:"Live Collaboration"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:54,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-muted",children:"Jam together in real-time"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:55,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:53,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:49,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary transition-colors p-1 rounded","aria-label":"Close",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:63,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:58,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:48,columnNumber:9},void 0),a&&Yn.jsxDEV("div",{className:"mb-4 px-4 py-3 rounded-lg bg-accent-error/10 border border-accent-error/30 text-accent-error text-sm",children:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:69,columnNumber:11},void 0),"pick"===m&&Yn.jsxDEV("div",{className:"flex flex-col gap-3",children:[Yn.jsxDEV(TV,{variant:"primary",fullWidth:!0,onClick:h,children:"Create Room"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:77,columnNumber:13},void 0),Yn.jsxDEV(TV,{variant:"default",fullWidth:!0,onClick:()=>p("join"),children:"Join Room"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:80,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:76,columnNumber:11},void 0),"create"===m&&Yn.jsxDEV("div",{className:"text-center",children:["creating"===n&&Yn.jsxDEV("div",{className:"flex items-center justify-center gap-3 text-text-muted py-4",children:[Yn.jsxDEV(Ue,{size:20,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:91,columnNumber:17},void 0),Yn.jsxDEV("span",{children:"Connecting to server..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:92,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:90,columnNumber:15},void 0),("waiting"===n||"error"===n)&&s&&Yn.jsxDEV("div",{className:"py-2",children:[Yn.jsxDEV("p",{className:"text-text-secondary text-sm mb-3",children:"Share this code with your friend:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:97,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-center gap-3 px-6 py-4 rounded-xl bg-dark-bgSecondary border-2 border-accent-primary/50 cursor-pointer hover:border-accent-primary transition-colors group",onClick:g,title:"Click to copy",children:[Yn.jsxDEV("span",{className:"font-mono text-3xl font-bold text-accent-primary tracking-widest",children:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:103,columnNumber:19},void 0),u?Yn.jsxDEV(Be,{size:20,className:"text-accent-success"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:107,columnNumber:23},void 0):Yn.jsxDEV(Je,{size:20,className:"text-text-muted group-hover:text-accent-primary transition-colors"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:108,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:98,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-center gap-2 mt-4 text-text-muted text-sm",children:[Yn.jsxDEV(Ue,{size:14,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:112,columnNumber:19},void 0),Yn.jsxDEV("span",{children:"Waiting for friend..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:113,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:111,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:96,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:88,columnNumber:11},void 0),"join"===m&&Yn.jsxDEV("div",{className:"flex flex-col gap-4",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm text-text-secondary mb-2",children:"Room Code"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:124,columnNumber:15},void 0),Yn.jsxDEV("input",{type:"text",value:i,onChange:e=>c(e.target.value.toUpperCase()),onKeyDown:e=>"Enter"===e.key&&f(),placeholder:"XXXXXX",maxLength:6,className:"w-full px-4 py-3 rounded-lg bg-dark-bgSecondary border border-dark-border text-text-primary font-mono text-xl text-center tracking-widest focus:outline-none focus:border-accent-primary transition-colors",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:125,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:123,columnNumber:13},void 0),Yn.jsxDEV(TV,{variant:"primary",fullWidth:!0,onClick:f,disabled:i.trim().length<6||"joining"===n,loading:"joining"===n,children:"joining"===n?"Connecting...":"Join Room"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:136,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>p("pick"),className:"text-sm text-text-muted hover:text-text-secondary transition-colors",children:" Back"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:145,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:122,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:46,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/CollaborationModal.tsx",lineNumber:45,columnNumber:5},void 0):null},UV=Object.freeze(Object.defineProperty({__proto__:null,CollaborationModal:FV},Symbol.toStringTag,{value:"Module"})),RV=a.memo(()=>{const e=RD(e=>e.metadata),t=RD(e=>e.isDirty),n=UD(e=>e.masterVolume),s=UD(e=>e.setMasterVolume),a=qD(e=>e.tabs),o=qD(e=>e.activeTabId),r=qD(e=>e.addTab),i=qD(e=>e.closeTab),c=qD(e=>e.setActiveTab),u=qD(e=>e.updateTabName),d=qD(e=>e.markTabDirty),m=JD(e=>e.currentThemeId),p=JD(e=>e.setTheme),h=JD(e=>e.getCurrentTheme),f=Ck(e=>e.renderMode),g=Ck(e=>e.setRenderMode),[b,v]=l.useState(!1),[y,x]=l.useState(!1),[N,w]=l.useState(!1),[E,k]=l.useState(!1),[D,S]=l.useState(!1),M=dV(e=>e.status),C=dV(e=>e.viewMode),V=dV(e=>e.setViewMode),P=CC(e=>e.user),_=CC(e=>e.logout),O=CC(e=>e.isServerAvailable),T=CC(e=>e.checkServerAvailability);l.useEffect(()=>{T()},[T]),l.useEffect(()=>{if(!E)return;const e=e=>{e.target.closest("[data-user-menu]")||k(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[E]);const L=h();l.useEffect(()=>{e.name&&o&&u(o,e.name)},[e.name,o,u]),l.useEffect(()=>{o&&d(o,t)},[t,o,d]),l.useEffect(()=>{"connected"===M&&S(!1)},[M]),l.useEffect(()=>{if(!b)return;const e=e=>{e.target.closest("[data-theme-menu]")||v(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[b]);return Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-b border-dark-border relative z-40",children:[Yn.jsxDEV("nav",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[Yn.jsxDEV("h1",{className:"font-bold text-lg tracking-tight",children:Yn.jsxDEV("span",{className:"text-accent-primary",children:"DEViLBOX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:149,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:148,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-xs font-medium text-text-inverse bg-accent-primary px-2 py-0.5 rounded cursor-help",title:`${gV}  2026-02-28`,children:["1.0.",fV]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:151,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:147,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[!DC()&&O&&Yn.jsxDEV("div",{className:"relative","data-user-menu":!0,children:P?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:()=>k(!E),className:"flex items-center gap-2 px-2 py-1 rounded text-text-secondary hover:text-text-primary hover:bg-dark-bgHover transition-colors",title:`Logged in as ${P.username}`,children:[Yn.jsxDEV(Qe,{size:16,className:"text-accent-success"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:172,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-sm hidden sm:inline",children:P.username},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:173,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:167,columnNumber:19},void 0),E&&Yn.jsxDEV("div",{className:"absolute right-0 top-full mt-1 bg-dark-bgTertiary border border-dark-border rounded-md shadow-lg z-50 min-w-[160px]",children:[Yn.jsxDEV("div",{className:"px-3 py-2 border-b border-dark-border",children:[Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Signed in as"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:178,columnNumber:25},void 0),Yn.jsxDEV("p",{className:"text-sm font-medium text-text-primary truncate",children:P.username},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:179,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:177,columnNumber:23},void 0),Yn.jsxDEV("button",{onClick:()=>{_(),k(!1)},className:"w-full text-left px-3 py-2 text-sm text-text-secondary hover:bg-dark-bgHover hover:text-text-primary transition-colors flex items-center gap-2",children:[Yn.jsxDEV(Ze,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:188,columnNumber:25},void 0),"Sign Out"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:181,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:176,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:166,columnNumber:17},void 0):Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>w(!0),icon:Yn.jsxDEV(et,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:200,columnNumber:25},void 0),iconPosition:"left",title:"Sign in to save files to the cloud",children:Yn.jsxDEV("span",{className:"hidden sm:inline",children:"Sign In"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:204,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:196,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:163,columnNumber:13},void 0),Yn.jsxDEV(TV,{variant:"connected"===M?"primary":"ghost",size:"sm",onClick:()=>{"connected"===M&&"split"===C||("connected"===M?V("split"):S(!0))},icon:Yn.jsxDEV(Ye,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:215,columnNumber:19},void 0),iconPosition:"left",title:"connected"===M?"Collaboration active":"Start live collaboration",children:[Yn.jsxDEV("span",{className:"hidden sm:inline",children:"Collab"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:219,columnNumber:13},void 0),"connected"===M&&Yn.jsxDEV("span",{className:"w-1.5 h-1.5 rounded-full bg-accent-success animate-pulse ml-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:223,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:211,columnNumber:11},void 0),!DC()&&Yn.jsxDEV(TV,{variant:"primary",size:"sm",onClick:()=>x(!0),icon:Yn.jsxDEV(Ge,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:233,columnNumber:21},void 0),iconPosition:"left",title:"Download Desktop App",children:Yn.jsxDEV("span",{className:"hidden sm:inline uppercase whitespace-nowrap",children:"Desktop App"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:237,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:229,columnNumber:13},void 0),"webgl"===f&&Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>g("dom"),icon:Yn.jsxDEV(Fe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:247,columnNumber:21},void 0),iconPosition:"left",title:"Switch to DOM rendering mode",children:Yn.jsxDEV("span",{className:"hidden sm:inline",children:"DOM"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:251,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:243,columnNumber:13},void 0),Yn.jsxDEV(OV,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:256,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"relative","data-theme-menu":!0,children:[Yn.jsxDEV("button",{onClick:()=>v(!b),className:"flex items-center gap-2 px-2 py-1 rounded text-text-secondary hover:text-text-primary hover:bg-dark-bgHover transition-colors whitespace-nowrap",title:"Change theme",children:[Yn.jsxDEV(tt,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:265,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm",children:L.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:266,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:260,columnNumber:13},void 0),b&&Yn.jsxDEV("div",{className:"absolute right-0 top-full mt-1 bg-dark-bgTertiary border border-dark-border rounded-md shadow-lg z-50 min-w-[140px]",children:$D.map(e=>Yn.jsxDEV("button",{onClick:()=>{p(e.id),v(!1)},className:`\n                      w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2\n                      ${m===e.id?"bg-dark-bgActive text-text-primary":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"}\n                    `,children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-full border border-dark-borderLight",style:{backgroundColor:e.colors.accent}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:285,columnNumber:21},void 0),e.name]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:271,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:269,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:259,columnNumber:11},void 0),Yn.jsxDEV("input",{type:"range",value:n,onChange:e=>{const t=parseInt(e.target.value,10);s(t)},min:"-60",max:"0",step:"1",className:"w-24",title:`Volume: ${n} dB`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:297,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:160,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:145,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex items-center px-2 py-1 border-b border-dark-border bg-dark-bgTertiary",children:[Yn.jsxDEV("div",{className:"flex items-center gap-1 flex-1 overflow-x-auto scrollbar-none",children:a.map(e=>Yn.jsxDEV("button",{onClick:()=>c(e.id),className:`\n                group flex items-center gap-2 px-3 py-1.5 rounded-t-md text-sm font-medium\n                transition-all duration-150 min-w-0 max-w-[200px]\n                ${o===e.id?"bg-dark-bg text-text-primary border-t border-x border-dark-border -mb-px":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary hover:bg-dark-bg/50"}\n              `,children:[Yn.jsxDEV("span",{className:"truncate",children:[e.name||"Untitled",e.isDirty&&Yn.jsxDEV("span",{className:"text-accent-primary ml-1",children:"*"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:329,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:327,columnNumber:15},void 0),a.length>1&&Yn.jsxDEV("span",{onClick:t=>((e,t)=>{e.stopPropagation(),i(t)})(t,e.id),className:`\n                    flex-shrink-0 p-0.5 rounded hover:bg-dark-border/50\n                    ${o===e.id?"opacity-60 hover:opacity-100":"opacity-0 group-hover:opacity-60 hover:!opacity-100"}\n                  `,children:Yn.jsxDEV(Ce,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:339,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:332,columnNumber:17},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:315,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:313,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{r()},className:"flex-shrink-0 p-1.5 ml-1 rounded hover:bg-dark-border/50 text-text-muted hover:text-text-primary transition-colors",title:"New project tab",children:Yn.jsxDEV(nt,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:352,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:347,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:311,columnNumber:7},void 0),Yn.jsxDEV(LV,{isOpen:y,onClose:()=>x(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:357,columnNumber:7},void 0),Yn.jsxDEV(BV,{isOpen:N,onClose:()=>w(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:363,columnNumber:7},void 0),D&&Yn.jsxDEV(FV,{isOpen:D,onClose:()=>S(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:370,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/NavBar.tsx",lineNumber:143,columnNumber:5},void 0)}),jV=({isOpen:e,onClose:t})=>{const[n,s]=l.useState(null),[a,o]=l.useState(!1),[r,i]=l.useState(!1);l.useEffect(()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent);o(e);const t=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone;i(t);const n=e=>{e.preventDefault(),s(e)};return window.addEventListener("beforeinstallprompt",n),()=>{window.removeEventListener("beforeinstallprompt",n)}},[]);return e?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/70 z-[10001]",onClick:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:67,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"fixed inset-x-4 top-1/2 -translate-y-1/2 max-w-md mx-auto bg-dark-bgTertiary border-2 border-dark-border rounded-lg shadow-2xl z-[10002]",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between p-4 border-b border-dark-border bg-dark-bgSecondary",children:[Yn.jsxDEV("h2",{className:"font-bold text-lg text-text-primary",children:"Add to Home Screen"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:76,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors","aria-label":"Close",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:82,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:77,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:75,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-6 space-y-4",children:r?Yn.jsxDEV("div",{className:"text-center py-8",children:[Yn.jsxDEV("div",{className:"text-accent-success text-5xl mb-4",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:90,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-text-primary font-bold mb-2",children:"Already Installed!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:91,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-text-secondary text-sm",children:"DEViLBOX is already running in fullscreen mode from your home screen."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:92,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:89,columnNumber:13},void 0):a?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("p",{className:"text-text-primary",children:"Add DEViLBOX to your home screen for a fullscreen app experience:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:98,columnNumber:15},void 0),Yn.jsxDEV("ol",{className:"space-y-4 text-text-secondary text-sm",children:[Yn.jsxDEV("li",{className:"flex gap-3",children:[Yn.jsxDEV("span",{className:"font-bold text-accent-primary flex-shrink-0",children:"1."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:104,columnNumber:19},void 0),Yn.jsxDEV("div",{children:Yn.jsxDEV("p",{className:"mb-2",children:["Tap the ",Yn.jsxDEV("strong",{className:"text-text-primary",children:"Share button"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:107,columnNumber:31},void 0),Yn.jsxDEV(st,{size:16,className:"inline mx-1 text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:108,columnNumber:23},void 0),"at the bottom of Safari"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:106,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:105,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:103,columnNumber:17},void 0),Yn.jsxDEV("li",{className:"flex gap-3",children:[Yn.jsxDEV("span",{className:"font-bold text-accent-primary flex-shrink-0",children:"2."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:115,columnNumber:19},void 0),Yn.jsxDEV("div",{children:Yn.jsxDEV("p",{className:"mb-2",children:["Scroll and tap ",Yn.jsxDEV("strong",{className:"text-text-primary",children:'"Add to Home Screen"'},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:118,columnNumber:38},void 0),Yn.jsxDEV(nt,{size:16,className:"inline mx-1 text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:119,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:117,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:116,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:114,columnNumber:17},void 0),Yn.jsxDEV("li",{className:"flex gap-3",children:[Yn.jsxDEV("span",{className:"font-bold text-accent-primary flex-shrink-0",children:"3."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:125,columnNumber:19},void 0),Yn.jsxDEV("div",{children:Yn.jsxDEV("p",{children:["Tap ",Yn.jsxDEV("strong",{className:"text-text-primary",children:'"Add"'},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:128,columnNumber:27},void 0)," to confirm"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:127,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:126,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:124,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:102,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"bg-accent-info/10 border border-accent-info/30 rounded p-3 mt-4",children:Yn.jsxDEV("p",{className:"text-xs text-accent-info",children:[Yn.jsxDEV("strong",{children:"Tip:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:136,columnNumber:19},void 0)," Once added, launch DEViLBOX from your home screen for true fullscreen mode without the Safari browser UI."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:135,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:134,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:97,columnNumber:13},void 0):n?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("p",{className:"text-text-primary mb-4",children:"Install DEViLBOX as a standalone app for the best experience:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:143,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:async()=>{if(!n)return;n.prompt();const{outcome:e}=await n.userChoice;s(null),t()},className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-accent-primary hover:bg-accent-primary/90 text-white font-bold rounded-lg transition-colors",children:[Yn.jsxDEV(at,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:151,columnNumber:17},void 0),"Install DEViLBOX"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:147,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"bg-accent-info/10 border border-accent-info/30 rounded p-3 mt-4",children:Yn.jsxDEV("p",{className:"text-xs text-accent-info",children:"Runs fullscreen without browser UI, can be launched from your app drawer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:156,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:155,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:142,columnNumber:13},void 0):Yn.jsxDEV("div",{className:"text-center py-8",children:[Yn.jsxDEV("p",{className:"text-text-primary mb-4",children:'To install DEViLBOX, use your browser\'s menu and select "Install" or "Add to Home Screen"'},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:163,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-text-secondary text-sm",children:"The install option may appear in your browser's settings menu ( or )"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:166,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:162,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:87,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 border-t border-dark-border bg-dark-bgSecondary",children:Yn.jsxDEV("button",{onClick:t,className:"w-full px-4 py-2 bg-dark-bgHover hover:bg-dark-border text-text-primary font-medium rounded transition-colors",children:"Close"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:175,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:174,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:73,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AddToHomeScreenModal.tsx",lineNumber:65,columnNumber:5},void 0):null},XV=({onShowSettings:e,onShowExport:t,onShowHelp:n,onShowMasterFX:s,onShowPatterns:a,onLoad:o,onSave:r,onNew:i,onClear:c,onShowInstruments:u,onShowPatternOrder:d,onShowDrumpads:m,onShowGrooveSettings:p,onShowAuth:h})=>{const[f,g]=l.useState(!1),[b,v]=l.useState(!1),{user:y,logout:x,isServerAvailable:N}=CC(),w=e=>{e&&e(),g(!1)};return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:()=>g(!f),className:"fixed z-[10000] p-2 bg-dark-bgSecondary border border-dark-border rounded-lg shadow-lg hover:bg-dark-bgHover transition-colors",style:{top:"calc(0.5rem + env(safe-area-inset-top, 0px))",right:"calc(0.5rem + env(safe-area-inset-right, 0px))"},"aria-label":"Menu",children:f?Yn.jsxDEV(Ce,{size:24},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:66,columnNumber:19},void 0):Yn.jsxDEV(ot,{size:24},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:66,columnNumber:37},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:57,columnNumber:7},void 0),f&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/50 z-[9998]",onClick:()=>g(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:73,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"fixed top-0 right-0 bottom-0 w-80 max-w-[85vw] bg-dark-bgTertiary border-l border-dark-border z-[9999] flex flex-col",children:[Yn.jsxDEV("div",{className:"flex-shrink-0 bg-dark-bgSecondary border-b border-dark-border p-4 flex items-center justify-between",children:[Yn.jsxDEV("h2",{className:"font-bold text-lg text-text-primary",children:"Menu"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:82,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>g(!1),className:"p-1 hover:bg-dark-bgHover rounded transition-colors","aria-label":"Close menu",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:88,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:83,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:81,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[N&&Yn.jsxDEV("div",{className:"mb-4",children:[Yn.jsxDEV("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3",children:"Account"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:97,columnNumber:19},void 0),y?Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg p-3",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 mb-3",children:[Yn.jsxDEV("div",{className:"p-2 rounded-full bg-accent-primary/20 text-accent-primary",children:Yn.jsxDEV(Ke,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:104,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:103,columnNumber:25},void 0),Yn.jsxDEV("div",{className:"flex-1",children:[Yn.jsxDEV("div",{className:"text-sm font-medium text-text-primary",children:y.username},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:107,columnNumber:27},void 0),Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:"Signed in"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:108,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:106,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:102,columnNumber:23},void 0),Yn.jsxDEV("button",{onClick:()=>{x(),g(!1)},className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded bg-dark-bgTertiary hover:bg-dark-bgHover transition-colors text-text-secondary hover:text-text-primary text-sm",children:[Yn.jsxDEV(Ze,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:118,columnNumber:25},void 0),"Sign Out"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:111,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:101,columnNumber:21},void 0):h?Yn.jsxDEV("button",{onClick:()=>w(h),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(et,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:127,columnNumber:23},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("div",{className:"text-text-primary font-medium",children:"Sign In"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:129,columnNumber:25},void 0),Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:"Save files to the cloud"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:130,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:128,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:123,columnNumber:21},void 0):null]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:96,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"mb-4",children:[Yn.jsxDEV("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3",children:"MIDI Settings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:139,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg p-3",children:Yn.jsxDEV(OV,{inline:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:143,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:142,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:138,columnNumber:15},void 0),Yn.jsxDEV("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3 mt-6",children:"File"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:148,columnNumber:15},void 0),o&&Yn.jsxDEV("button",{onClick:()=>w(o),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(rt,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:157,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Load"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:158,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:153,columnNumber:17},void 0),r&&Yn.jsxDEV("button",{onClick:()=>w(r),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(it,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:167,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Save / Download"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:168,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:163,columnNumber:17},void 0),i&&Yn.jsxDEV("button",{onClick:()=>w(i),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(lt,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:177,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"New"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:178,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:173,columnNumber:17},void 0),c&&Yn.jsxDEV("button",{onClick:()=>w(c),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(Ie,{size:20,className:"text-accent-warning"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:187,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Clear"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:188,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:183,columnNumber:17},void 0),t&&Yn.jsxDEV("button",{onClick:()=>w(t),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(Ge,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:197,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Export / Import"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:198,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:193,columnNumber:17},void 0),Yn.jsxDEV("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3 mt-6",children:"View"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:203,columnNumber:15},void 0),d&&Yn.jsxDEV("button",{onClick:()=>w(d),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(ct,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:212,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Pattern Order"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:213,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:208,columnNumber:17},void 0),u&&Yn.jsxDEV("button",{onClick:()=>w(u),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(_e,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:222,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Instruments"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:223,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:218,columnNumber:17},void 0),m&&Yn.jsxDEV("button",{onClick:()=>w(m),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(ut,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:232,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Drum Pads"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:233,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:228,columnNumber:17},void 0),a&&Yn.jsxDEV("button",{onClick:()=>w(a),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(Oe,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:242,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Patterns"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:243,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:238,columnNumber:17},void 0),s&&Yn.jsxDEV("button",{onClick:()=>w(s),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(Pe,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:252,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Master Effects"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:253,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:248,columnNumber:17},void 0),Yn.jsxDEV("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3 mt-6",children:"Options"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:258,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>{v(!0),g(!1)},className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(Re,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:270,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Add to Home Screen"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:271,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:263,columnNumber:15},void 0),p&&Yn.jsxDEV("button",{onClick:()=>w(p),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(dt,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:279,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Groove Settings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:280,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:275,columnNumber:17},void 0),e&&Yn.jsxDEV("button",{onClick:()=>w(e),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(Te,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:289,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Settings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:290,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:285,columnNumber:17},void 0),n&&Yn.jsxDEV("button",{onClick:()=>w(n),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Yn.jsxDEV(mt,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:299,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:"Help"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:300,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:295,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:93,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:79,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:71,columnNumber:9},void 0),Yn.jsxDEV(jV,{isOpen:b,onClose:()=>v(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:309,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileMenu.tsx",lineNumber:55,columnNumber:5},void 0)};function zV(){const[e,t]=l.useState(()=>{const e="undefined"!=typeof window?window.innerWidth:1024;return{width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024}});return l.useEffect(()=>{const e=()=>{const e=window.innerWidth;t({width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}const GV=({children:e,onShowSettings:t,onShowExport:n,onShowHelp:s,onShowMasterFX:a,onShowPatterns:o,onLoad:r,onSave:i,onNew:l,onClear:c,onShowInstruments:u,onShowPatternOrder:d,onShowDrumpads:m,onShowGrooveSettings:p,onShowAuth:h})=>{const{isMobile:f}=zV(),g=LN(e=>e.activeView),b="dj"===g||"drumpad"===g||"vj"===g;return Yn.jsxDEV("div",{className:"h-screen w-screen flex flex-col bg-dark-bg text-text-primary overflow-hidden",children:[!b&&Yn.jsxDEV("div",{className:f?"hidden":"block",children:Yn.jsxDEV(RV,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/AppLayout.tsx",lineNumber:55,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/AppLayout.tsx",lineNumber:54,columnNumber:9},void 0),f&&Yn.jsxDEV(XV,{onShowSettings:t,onShowExport:n,onShowHelp:s,onShowMasterFX:a,onShowPatterns:o,onLoad:r,onSave:i,onNew:l,onClear:c,onShowInstruments:u,onShowPatternOrder:d,onShowDrumpads:m,onShowGrooveSettings:p,onShowAuth:h},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/AppLayout.tsx",lineNumber:61,columnNumber:9},void 0),Yn.jsxDEV("main",{className:"flex-1 flex min-h-0 min-w-0 overflow-hidden",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/AppLayout.tsx",lineNumber:80,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/AppLayout.tsx",lineNumber:51,columnNumber:5},void 0)};function HV(e){switch(e){case bS:return"var(--color-synth-filter)";case vS:return"var(--color-synth-envelope)";case gS:return"var(--color-synth-accent)";case yS:case NS:return"var(--color-synth-pan)";case xS:return"var(--color-synth-effects)";case DS:case kS:return"var(--color-synth-volume)";case wS:case ES:return"var(--color-synth-drive)";default:return"var(--color-synth-filter)"}}function WV(e){const t={Cutoff:"Cut",Resonance:"Res",Volume:"Vol",Feedback:"Fb",Algorithm:"Alg",Decay:"Dec",Attack:"Atk",Release:"Rel",Sustain:"Sus",Detune:"Det",Level:"Lvl","Env Mod":"Env",Accent:"Acc",Tuning:"Tun",Waveform:"Wav",Distortion:"Dst",Portamento:"Prt",Unison:"Uni"};return t[e]?t[e]:e.replace(/[^A-Za-z0-9]/g,"").slice(0,3)}function qV(e){const t=ID(t=>t.patterns[t.currentPatternIndex]?.channels[e]?.instrumentId??null),n=EN(us(e=>{if(null===t)return null;const n=e.instruments.find(e=>e.id===t);return n?{synthType:n.synthType,name:n.name}:null}));return l.useMemo(()=>{if(!n)return{params:[],groups:[],synthType:null,instrumentName:null};const e=function(e){return e.filter(e=>e.isAutomatable).map(e=>({key:e.id,name:e.name,shortLabel:WV(e.name),section:e.section,color:HV(e.section),min:e.min,max:e.max}))}(HS(n.synthType)),t=function(e){const t=new Map;for(const n of e)t.has(n.section)||t.set(n.section,[]),t.get(n.section).push(n);return Array.from(t.entries()).map(([e,t])=>({label:e,section:e,params:t}))}(e);return{params:e,groups:t,synthType:n.synthType,instrumentName:n.name}},[n])}const KV=20,$V=({patternId:e,patternLength:t,rowHeight:n,channelCount:s,channelOffsets:a,channelWidths:o,rowNumWidth:r,scrollOffset:i,visibleStart:c,parameter:u="cutoff",prevPatternId:d,prevPatternLength:m,nextPatternId:p,nextPatternLength:h})=>{const f=XD(e=>e.curves),g=XD(e=>e.addPoint),b=XD(e=>e.removePoint),v=XD(e=>e.channelLanes),[y,x]=l.useState(null),N=l.useRef(null),w=l.useMemo(()=>{const e=[];for(let t=0;t<s;t++){const n=v.get(t);e.push(n?.activeParameter||u)}return e},[s,v,u]),E=l.useMemo(()=>{const t=[];for(let n=0;n<s;n++){const s=w[n],a=f.find(t=>t.patternId===e&&t.channelIndex===n&&t.parameter===s);t.push(a&&a.points.length>0?a:null)}return t},[e,s,w,f]),k=l.useMemo(()=>{if(!d)return[];const e=[];for(let t=0;t<s;t++){const n=w[t],s=f.find(e=>e.patternId===d&&e.channelIndex===t&&e.parameter===n);e.push(s&&s.points.length>0?s:null)}return e},[d,s,w,f]),D=l.useMemo(()=>{if(!p)return[];const e=[];for(let t=0;t<s;t++){const n=w[t],s=f.find(e=>e.patternId===p&&e.channelIndex===t&&e.parameter===n);e.push(s&&s.points.length>0?s:null)}return e},[p,s,w,f]),S=function(e){const t=ID(e=>e.patterns),n=ID(e=>e.currentPatternIndex),s=EN(e=>e.instruments);return l.useMemo(()=>{const a=t[n];if(!a)return"var(--color-synth-filter)";for(const t of a.channels){if(null===t.instrumentId)continue;const n=s.find(e=>e.id===t.instrumentId);if(!n)continue;const a=HS(n.synthType).find(t=>t.id===e);if(a)return HV(a.section)}return"var(--color-synth-filter)"},[e,t,n,s])}(w.find(e=>e!==u)||u),M=d?m||t:0,C=p?h||t:0,V=M*n+t*n+C*n,P=l.useCallback((e,s,a,o,r)=>{if(0!==e.button)return;e.preventDefault(),e.stopPropagation();const i=N.current?.getBoundingClientRect();if(!i)return;const l=e.clientY-i.top-r,c=Math.floor(l/n);if(c<0||c>=t)return;const u=e.clientX-i.left-o,d=Math.max(0,Math.min(1,(u-1)/18));g(s.id,c,d),x({curveId:s.id,row:c,channelIndex:a})},[t,n,g]),_=l.useCallback(e=>{if(!y||!N.current)return;const s=N.current.getBoundingClientRect(),i=E[y.channelIndex];if(!i)return;const l=a[y.channelIndex]-r+o[y.channelIndex]-KV-4,c=M*n,u=e.clientY-s.top-c,d=Math.floor(u/n);if(d<0||d>=t)return;const m=e.clientX-s.left-l,p=Math.max(0,Math.min(1,(m-1)/18));g(i.id,d,p)},[y,E,o,r,M,n,t,g]),O=l.useCallback(()=>{x(null)},[]),T=l.useCallback((e,s,a)=>{const o=N.current?.getBoundingClientRect();if(!o)return;const r=e.clientY-o.top-a,i=Math.floor(r/n);if(i<0||i>=t)return;s.points.find(e=>e.row===i)&&b(s.id,i)},[t,n,b]);if(!(E.some(e=>null!==e)||k.some(e=>null!==e)||D.some(e=>null!==e)))return null;const L=(e,t,s,i,l,c)=>e.map((e,u)=>{if(!e)return null;const d=a[u]-r,m=o[u];if(m<20)return null;const p=d+m-KV-4,h=t*n,f=s*n,g=[],b=[`M 20 ${h}`];for(let s=0;s<t;s++){const t=Ua(e.points,s,e.interpolation,e.mode);if(null!==t){const e=18*t+1,a=s*n+n/2;g.push(`${0===g.length?"M":"L"} ${e} ${a}`)}}for(let s=t-1;s>=0;s--){const t=Ua(e.points,s,e.interpolation,e.mode);if(null!==t){const e=18*t+1,a=s*n+n/2;b.push(`L ${e} ${a}`)}}return b.push("L 20 0 Z"),Yn.jsxDEV("div",{style:{position:"absolute",left:p,top:f,width:KV,height:h,cursor:c?"crosshair":"default"},onMouseDown:c?t=>P(t,e,u,p,f):void 0,onDoubleClick:c?t=>T(t,e,f):void 0,children:Yn.jsxDEV("svg",{width:KV,height:h,children:[Yn.jsxDEV("path",{d:b.join(" "),fill:S,fillOpacity:.1*i},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/AutomationLanes.tsx",lineNumber:312,columnNumber:13},void 0),Yn.jsxDEV("path",{d:g.join(" "),fill:"none",stroke:S,strokeWidth:1.5,strokeOpacity:.6*i,strokeLinecap:"round",strokeLinejoin:"round"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/AutomationLanes.tsx",lineNumber:318,columnNumber:13},void 0),1===i&&e.points.map((e,t)=>Yn.jsxDEV("circle",{cx:18*e.value+1,cy:e.row*n+n/2,r:2,fill:S,fillOpacity:.8},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/AutomationLanes.tsx",lineNumber:329,columnNumber:15},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/AutomationLanes.tsx",lineNumber:310,columnNumber:11},void 0)},`${l}-${u}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/AutomationLanes.tsx",lineNumber:297,columnNumber:9},void 0)});return Yn.jsxDEV("div",{ref:N,className:"automation-lanes",style:{position:"absolute",top:i-c*n-M*n,left:r,right:0,height:V,zIndex:5},onMouseMove:_,onMouseUp:O,onMouseLeave:O,children:[k.length>0&&L(k,M,0,.5,"prev",!1),L(E,t,M,1,"current",!0),D.length>0&&L(D,C,M+t,.5,"next",!1)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/AutomationLanes.tsx",lineNumber:350,columnNumber:5},void 0)},YV=({pattern:e,rowHeight:t,channelCount:n,channelOffsets:s,channelWidths:o,rowNumWidth:r})=>{const i=ID(e=>e.columnVisibility),c=ID(e=>e.setCell),[u,d]=l.useState(!1),[m,p]=l.useState(null),h=l.useRef(null),f=l.useMemo(()=>{const e=[];return i.cutoff&&e.push("cutoff"),i.resonance&&e.push("resonance"),i.envMod&&e.push("envMod"),i.pan&&e.push("pan"),e},[i]),g=l.useCallback(n=>{if(!u||!h.current)return;const{channelIndex:s,parameter:a}=h.current,o=n.currentTarget.getBoundingClientRect(),r=n.clientY-o.top,i=Math.floor(r/t);if(i>=0&&i<e.length){const e=n.clientX-o.left,t=Math.max(0,Math.min(1,(e-2)/10)),r=Math.round(255*t);c(s,i,{[a]:r})}},[u,e.length,t,c]),b=l.useCallback(()=>{d(!1),h.current=null,p(null)},[d,p]);return a.useEffect(()=>{if(u)return window.addEventListener("mouseup",b),()=>window.removeEventListener("mouseup",b)},[u,b]),0===f.length?null:Yn.jsxDEV("div",{className:"macro-lanes",style:{position:"absolute",top:0,left:0,right:0,height:e.length*t,zIndex:5,pointerEvents:"none"},children:e.channels.map((a,r)=>{if(r>=n)return null;if(a.collapsed)return null;const i=s[r],l=o[r];return f.map(n=>{const{linePath:s,points:o}=((e,t,n)=>{const s=[],a=[];for(let o=0;o<e.length;o++){const r=e[o][t];if(null!=r){const e=r/255*10+2,t=o*n+n/2;s.push(`${0===s.length?"M":"L"} ${e} ${t}`),a.push({x:e,y:t})}}return{linePath:s.join(" "),points:a}})(a.rows,n,t),b={cutoff:"#22c55e",resonance:"#eab308",envMod:"#06b6d4",pan:"#3b82f6"}[n]||"#22c55e";const v=f.indexOf(n),y=i+l-16*(f.length-v)-4;return Yn.jsxDEV("div",{onMouseDown:s=>((n,s,a)=>{if(a.shiftKey){const o=a.currentTarget.getBoundingClientRect(),r=a.clientY-o.top,i=Math.floor(r/t);return void(i>=0&&i<e.length&&c(n,i,{[s]:void 0}))}d(!0);const o={channelIndex:n,parameter:s};h.current=o,p(o),g(a)})(r,n,s),onMouseMove:g,className:"group cursor-crosshair",style:{position:"absolute",left:y,top:0,width:14,height:e.length*t,pointerEvents:"auto",backgroundColor:u&&m?.channelIndex===r&&m?.parameter===n?"rgba(255,255,255,0.05)":"transparent"},children:[Yn.jsxDEV("div",{className:"absolute inset-y-0 left-[2px] right-[2px] bg-white/5 opacity-0 group-hover:opacity-100"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroLanes.tsx",lineNumber:186,columnNumber:15},void 0),Yn.jsxDEV("svg",{width:14,height:e.length*t,children:[s&&Yn.jsxDEV("path",{d:s,fill:"none",stroke:b,strokeWidth:1.5,strokeOpacity:.6},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroLanes.tsx",lineNumber:190,columnNumber:19},void 0),o.map((e,t)=>Yn.jsxDEV("rect",{x:e.x-1.5,y:e.y-1.5,width:3,height:3,fill:b,fillOpacity:.9,className:"shadow-glow"},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroLanes.tsx",lineNumber:199,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroLanes.tsx",lineNumber:188,columnNumber:15},void 0)]},`${r}-${n}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroLanes.tsx",lineNumber:168,columnNumber:13},void 0)})})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroLanes.tsx",lineNumber:141,columnNumber:5},void 0)},JV=a.memo(({level:e,isActive:t})=>null);JV.displayName="ChannelVUMeter";const QV=l.memo(({channelOffsets:e=[],channelWidths:t=[],scrollLeft:n=0})=>{const{patterns:s,currentPatternIndex:a}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),o=s[a],r=o?.channels.length||4,i=l.useRef(null),c=l.useRef([]),u=l.useRef(null),d=l.useRef([]),m=l.useRef(r),p=l.useRef(n),h=l.useRef(e),f=l.useRef(t);return l.useEffect(()=>{m.current=r},[r]),l.useEffect(()=>{p.current=n},[n]),l.useEffect(()=>{h.current=e},[e]),l.useEffect(()=>{f.current=t},[t]),l.useEffect(()=>{c.current=Array.from({length:r},()=>({level:0}))},[r]),l.useEffect(()=>{const e=i.current;if(!e)return;const t=e.parentElement;if(!t)return;const n=window.devicePixelRatio||1,s=new ResizeObserver(t=>{const s=t[0];if(!s)return;const{width:a,height:o}=s.contentRect,r=Math.round(a*n),i=Math.round(o*n);e.width===r&&e.height===i||(e.width=r,e.height=i)});return s.observe(t),()=>s.disconnect()},[]),l.useEffect(()=>{const e=()=>{const t=i.current;if(!t)return void(u.current=requestAnimationFrame(e));const n=t.getContext("2d");if(!n)return void(u.current=requestAnimationFrame(e));const s=window.devicePixelRatio||1,a=t.width/s,o=t.height/s;n.setTransform(s,0,0,s,0,0),n.clearRect(0,0,a,o);const r=Bw(),l=m.current,g=r.getChannelTriggerLevels(l),b=r.getChannelTriggerGenerations(l),v=p.current,y=h.current,x=f.current;if(d.current.length<l){const e=d.current;d.current=new Array(l).fill(0);for(let t=0;t<e.length;t++)d.current[t]=e[t]}for(let e=0;e<l;e++){const t=c.current[e];if(!t)continue;if(x[e]&&x[e]<20)continue;const s=b[e]!==d.current[e],a=.012*e;if(jN.getState().isPlaying)if(s&&g[e]>0)t.level=g[e],d.current[e]=b[e];else{const e=.92-a;t.level=t.level*e,t.level<.01&&(t.level=0)}else t.level=0;const r=t.level>.02?25*Math.sin(.0025*performance.now()+.45*e):0;let i;if(y[e]&&x[e]){i=y[e]-40+x[e]/2}else i=260*e+130;const l=i-14-v+r,u=Math.round(26*t.level);for(let e=0;e<u;e++){const t=e/25,s=o-2-8*e-4;let a;a=t<.6?"#22c55e":t<.85?"#eab308":"#ef4444",n.fillStyle=a,n.fillRect(Math.round(l),Math.round(s),28,4)}}u.current=requestAnimationFrame(e)};return u.current=requestAnimationFrame(e),()=>{u.current&&(cancelAnimationFrame(u.current),u.current=null)}},[]),Yn.jsxDEV("canvas",{ref:i,className:"vu-meters-canvas",style:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelVUMeters.tsx",lineNumber:212,columnNumber:5},void 0)});QV.displayName="ChannelVUMeters";var ZV=t();const eP=({currentColor:e,onColorSelect:t})=>{const[n,s]=l.useState(!1),[a,o]=l.useState({top:0,left:0}),r=l.useRef(null),i=l.useRef(null);l.useEffect(()=>{if(n&&r.current){const e=r.current.getBoundingClientRect();o({top:e.bottom+4,left:e.left})}},[n]),l.useEffect(()=>{const e=e=>{i.current&&!i.current.contains(e.target)&&r.current&&!r.current.contains(e.target)&&s(!1)};if(n)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]),l.useEffect(()=>{const e=e=>{"Escape"===e.key&&s(!1)};if(n)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]);const c=n?Yn.jsxDEV("div",{ref:i,className:"fixed bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-2 animate-fade-in",style:{top:a.top,left:a.left,zIndex:9999,minWidth:"140px"},children:[Yn.jsxDEV("div",{className:"text-xs text-text-muted mb-2 px-1",children:"Channel Color"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:92,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-4 gap-1",children:Is.map((n,a)=>Yn.jsxDEV("button",{type:"button",onClick:e=>((e,n)=>{n.stopPropagation(),t(e),s(!1)})(n,e),className:"w-7 h-7 rounded border-2 transition-all flex items-center justify-center "+(e===n?"border-accent-primary scale-110":"border-transparent hover:border-dark-borderLight hover:scale-105"),style:{backgroundColor:n||"transparent"},title:n||"No color",children:null===n&&Yn.jsxDEV(Ce,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:110,columnNumber:15},void 0)},a,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:95,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:93,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:82,columnNumber:5},void 0):null;return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{ref:r,type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),s(!n)},className:"p-1 rounded transition-colors "+(e?"text-text-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),style:e?{color:e}:void 0,title:"Channel Color",children:Yn.jsxDEV(tt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:132,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:120,columnNumber:7},void 0),c&&ZV.createPortal(c,document.body)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelColorPicker.tsx",lineNumber:119,columnNumber:5},void 0)},tP=({items:e,position:t,onClose:n,className:s=""})=>{const a=l.useRef(null),[o,r]=l.useState(t),[i,c]=l.useState(null),[u,d]=l.useState(null),m=l.useRef(null);l.useEffect(()=>{if(!t||!a.current)return;const e=a.current.getBoundingClientRect(),n=window.innerWidth,s=window.innerHeight;let o=t.x,i=t.y;o+e.width>n-10&&(o=n-e.width-10),o<10&&(o=10),i+e.height>s-10&&(i=s-e.height-10),i<10&&(i=10);const l=requestAnimationFrame(()=>{r({x:o,y:i})});return()=>cancelAnimationFrame(l)},[t]),l.useEffect(()=>{const e=e=>{if(a.current&&!a.current.contains(e.target)){const t=e.target;if(t.closest?.("[data-context-menu]"))return;n()}},t=e=>{"Escape"===e.key&&n()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),m.current&&clearTimeout(m.current)}},[n]);const p=l.useCallback((e,t)=>{m.current&&(clearTimeout(m.current),m.current=null);const n=t.getBoundingClientRect(),s=window.innerWidth,a=n.right+180<s-10;c(e),d({x:a?n.right-2:n.left-180+2,y:n.top-4})},[]),h=l.useCallback(()=>{m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{c(null),d(null)},300)},[]),f=l.useCallback(()=>{m.current&&(clearTimeout(m.current),m.current=null)},[]);return t?ZV.createPortal(Yn.jsxDEV("div",{ref:a,"data-context-menu":!0,className:`\n        fixed z-[100] min-w-[180px] py-1\n        bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl\n        ${s}\n      `,style:{left:o?.x??t.x,top:o?.y??t.y},onMouseEnter:f,children:0===e.length?Yn.jsxDEV("div",{className:"px-4 py-2 text-xs text-text-muted italic",children:"Empty"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:161,columnNumber:9},void 0):e.map((e,t)=>{if(!e)return null;if("divider"===e.type)return Yn.jsxDEV("div",{className:"h-px bg-dark-border my-1 mx-2"},`divider-${t}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:169,columnNumber:15},void 0);const s=e.submenu&&e.submenu.length>0;return Yn.jsxDEV("div",{className:`\n                flex items-center gap-2 px-3 py-1.5 text-sm cursor-pointer transition-colors\n                ${e.disabled?"opacity-50 cursor-not-allowed":"hover:bg-dark-bgHover"}\n                ${e.danger?"text-accent-error hover:bg-accent-error/10":"text-text-secondary"}\n                ${i===e.id?"bg-dark-bgHover":""}\n                ${e.className||""}\n              `,onClick:()=>{e.disabled||s||(e.onClick?.(),n())},onMouseEnter:t=>{s?p(e.id,t.currentTarget):(c(null),d(null))},onMouseLeave:()=>{s&&h()},children:[void 0!==e.checked&&Yn.jsxDEV("span",{className:"w-4 flex justify-center",children:e.radio?e.checked?Yn.jsxDEV(pt,{size:8,className:"fill-accent-primary text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:214,columnNumber:23},void 0):null:e.checked?Yn.jsxDEV(Be,{size:14,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:217,columnNumber:21},void 0):null},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:211,columnNumber:17},void 0),e.icon&&Yn.jsxDEV("span",{className:"w-4 flex justify-center",children:e.icon},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:223,columnNumber:29},void 0),Yn.jsxDEV("span",{className:"flex-1",children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:226,columnNumber:15},void 0),e.shortcut&&Yn.jsxDEV("span",{className:"text-xs text-text-muted ml-4",children:e.shortcut},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:230,columnNumber:17},void 0),s&&Yn.jsxDEV(Ae,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:234,columnNumber:30},void 0),s&&i===e.id&&u&&Yn.jsxDEV(nP,{items:e.submenu,position:u,onClose:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:238,columnNumber:17},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:179,columnNumber:13},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:146,columnNumber:5},void 0),document.body):null},nP=e=>Yn.jsxDEV(tP,{...e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:255,columnNumber:10},void 0),sP=()=>{const[e,t]=l.useState(null);return{position:e,open:l.useCallback(e=>{e.preventDefault(),e.stopPropagation(),t({x:e.clientX,y:e.clientY})},[]),close:l.useCallback(()=>{t(null)},[]),isOpen:null!==e}},aP=({items:e,children:t,className:n="",disabled:s=!1})=>{const a=l.useRef(null),[o,r]=l.useState(!1),[i,c]=l.useState(null),u=l.useCallback(()=>{if(!s&&a.current){const e=a.current.getBoundingClientRect();c({x:e.left,y:e.bottom+4}),r(!0)}},[s]),d=l.useCallback(()=>{r(!1),c(null)},[]);return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{ref:a,onClick:u,disabled:s,className:n,children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:319,columnNumber:7},void 0),o&&i&&Yn.jsxDEV(tP,{items:e,position:i,onClose:d},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:328,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/common/ContextMenu.tsx",lineNumber:318,columnNumber:5},void 0)},oP=()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}),rP=(e,t,n=64,s=!1)=>({note:e,instrument:t,volume:16+n,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:s?1:0});const iP={"4on4":{name:"4/4 Kicks",description:"Every 4 rows on beat",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=64,accent:o}=e,r=[];for(let i=0;i<t;i++)if(i%4==0){const e=i%16==0;r.push(rP(s,n,a,o||e))}else r.push(oP());return r}},offbeat:{name:"Offbeat",description:"Every 4 rows, offset by 2",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=56,accent:o}=e,r=[];for(let i=0;i<t;i++)(i+2)%4==0?r.push(rP(s,n,a,o)):r.push(oP());return r}},"8ths":{name:"8th Notes",description:"Every 2 rows",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=56,accent:o}=e,r=[];for(let i=0;i<t;i++)if(i%2==0){const e=i%8==0;r.push(rP(s,n,e?a:a-8,o))}else r.push(oP());return r}},"16ths":{name:"16th Notes",description:"Every row",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=48,accent:o}=e,r=[];for(let i=0;i<t;i++){const e=i%4==0?a:i%2==0?a-8:a-16;r.push(rP(s,n,Math.max(16,e),o))}return r}},backbeat:{name:"Backbeat (2&4)",description:"Snare on beats 2 and 4",category:"drums",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=64,accent:o}=e,r=[];for(let i=0;i<t;i++)i%16==4||i%16==12?r.push(rP(s,n,a,o)):r.push(oP());return r}},random:{name:"Random",description:"30% density random fill",category:"general",generate:e=>function(e,t=.3){const{patternLength:n,instrumentId:s,note:a,velocity:o=64,accent:r}=e,i=[];for(let l=0;l<n;l++)if(Math.random()<t){const e=Math.max(32,o-Math.floor(16*Math.random())),t=r||Math.random()<.25;i.push(rP(a,s,e,t))}else i.push(oP());return i}(e,.3)},build:{name:"Build",description:"Increasing density for transitions",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=64,accent:o}=e,r=[],i=t/4;for(let l=0;l<t;l++){const e=Math.floor(l/i);let t;switch(e){case 0:t=8;break;case 1:default:t=4;break;case 2:t=2;break;case 3:t=1}if(l%t===0){const t=Math.min(64,a-16+8*e);r.push(rP(s,n,t,o))}else r.push(oP())}return r}},breakdown:{name:"Breakdown",description:"Sparse, minimal pattern",category:"general",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=48,accent:o}=e,r=[];for(let i=0;i<t;i++)i%16==0?r.push(rP(s,n,a,o)):r.push(oP());return r}},syncopated:{name:"Syncopated",description:"Offbeat acid pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=64,accent:o}=e,r=[],i=[0,3,8,11,14];for(let l=0;l<t;l++){const e=l%16;if(i.includes(e)){const t=3===e||11===e,i=rP(s,n,a,o);i.flag2=t?2:0,r.push(i)}else r.push(oP())}return r}},walking:{name:"Walking Bass",description:"Simple ascending pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:n,note:s,velocity:a=56}=e,o=[],r=s||Xa("C-4"),i=Qa(r);if(null===i)return o;const l=e=>{const t=i+e;return t>=12&&t<=107?Za(t):r},c=[0,5,7,5];for(let u=0;u<t;u++)if(u%4==0){const e=l(c[Math.floor(u/4)%c.length]);o.push(rP(e,n,a,!1))}else o.push(oP());return o}},hiHats:{name:"Hi-Hats",description:"Open/closed hat pattern",category:"drums",generate:function(e,t){const{patternLength:n,instrumentId:s,note:a,velocity:o=56,accent:r}=e,i=[],l=t||Xa("A#3");for(let c=0;c<n;c++)if(c%2==0){const e=(c+4)%8==0,t=e?l:a,n=e?o:o-8;i.push(rP(t,s,n,r))}else i.push(oP());return i}},clear:{name:"Clear",description:"Remove all notes",category:"general",generate:e=>{return t=e.patternLength,Array(t).fill(null).map(()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));var t}}},lP=[{name:"Clean Master",description:"Gentle glue compression + tonal balance  transparent finishing",category:"Clean",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:1,mid:0,high:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:2.5,attack:.01,release:.2}}]},{name:"Transparent",description:"Barely-there bus compression  preserves full dynamics",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:1.5,attack:.03,release:.3}}]},{name:"Balanced",description:"EQ sculpting + light compression for a polished, even mix",category:"Clean",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:1.5,mid:-.5,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:2,attack:.015,release:.25}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.55}}]},{name:"Analog Warmth",description:"Tape saturation + compression  the sound of a warm analog mix bus",category:"Warm",effects:[{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:30,parameters:{drive:35,tone:1e4}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:3,attack:.01,release:.2}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:1.5,mid:0,high:-.5}}]},{name:"Tape Machine",description:"Tape simulator for subtle wow, saturation, and head-bump warmth",category:"Warm",effects:[{category:"wasm",type:"TapeSimulator",enabled:!0,wet:40,parameters:{drive:25,character:35,bias:45,shame:15,hiss:5,speed:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:2.5,attack:.015,release:.25}}]},{name:"Tube Console",description:"Chebyshev harmonics + EQ shaping  tube mixing desk vibe",category:"Warm",effects:[{category:"tonejs",type:"Chebyshev",enabled:!0,wet:12,parameters:{order:2}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:.5,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:3,attack:.008,release:.18}}]},{name:"Club Ready",description:"Punchy compression with sub boost  loud and dancefloor-ready",category:"Loud",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-14,ratio:4,attack:.005,release:.12}},{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:18,parameters:{drive:40,tone:11e3}}]},{name:"Brick Wall",description:"Hard limiting for maximum loudness  squashed but punchy",category:"Loud",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-8,ratio:12,attack:.001,release:.05}}]},{name:"Pumping",description:"Aggressive sidechain-style compression  obvious pump for EDM",category:"Loud",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-2,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.15}},{category:"tonejs",type:"Distortion",enabled:!0,wet:10,parameters:{distortion:.1}}]},{name:"Stereo Wide",description:"Subtle stereo widening + glue compression for an expansive mix",category:"Wide",effects:[{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.7}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:2.5,attack:.015,release:.25}}]},{name:"Room Glue",description:"Short plate reverb to glue the mix in a shared acoustic space",category:"Wide",effects:[{category:"wasm",type:"MVerb",enabled:!0,wet:15,parameters:{damping:.6,density:.5,bandwidth:.7,decay:.3,predelay:0,size:.4,gain:1,mix:.3,earlyMix:.7}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:2.5,attack:.01,release:.2}}]},{name:"Immersive",description:"Plate reverb + widener + chorus shimmer  large, immersive soundstage",category:"Wide",effects:[{category:"tonejs",type:"Chorus",enabled:!0,wet:10,parameters:{frequency:.2,depth:.15}},{category:"wasm",type:"MVerb",enabled:!0,wet:12,parameters:{damping:.5,density:.6,bandwidth:.6,decay:.4,predelay:.01,size:.6,gain:1,mix:.35,earlyMix:.6}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:2,attack:.02,release:.25}}]},{name:"Vinyl Press",description:"ToneArm vinyl simulation  RIAA EQ, rolloff, and subtle crackle on the master",category:"Vinyl",effects:[{category:"wasm",type:"ToneArm",enabled:!0,wet:35,parameters:{wow:8,coil:40,flutter:5,riaa:60,stylus:25,hiss:10,pops:8,rpm:33.333}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:2.5,attack:.015,release:.25}}]},{name:"Dusty Grooves",description:"Vinyl noise + tape warmth  dusty crate-digger character",category:"Vinyl",effects:[{category:"wasm",type:"VinylNoise",enabled:!0,wet:25,parameters:{hiss:30,dust:40,age:35,speed:5.5,riaa:45,stylusResonance:40,wornStylus:20,pinch:25,innerGroove:15,ghostEcho:10,dropout:5,warp:5,eccentricity:10}},{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:20,parameters:{drive:30,tone:9e3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:2.5,attack:.015,release:.25}}]},{name:"Lo-Fi Master",description:"Tape sim + vinyl + gentle rolloff  nostalgic warmth across the whole mix",category:"Vinyl",effects:[{category:"wasm",type:"TapeSimulator",enabled:!0,wet:30,parameters:{drive:20,character:30,bias:40,shame:12,hiss:8,speed:1}},{category:"wasm",type:"ToneArm",enabled:!0,wet:20,parameters:{wow:10,coil:35,flutter:8,riaa:55,stylus:20,hiss:5,pops:3,rpm:33.333}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:12e3,type:"lowpass",Q:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:2.5,attack:.02,release:.3}}]},{name:"Techno",description:"Hard-hitting sub boost + brick compression + subtle grit",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-2,high:1}},{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:15,parameters:{drive:40,tone:11e3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}}]},{name:"House",description:"Warm low-end + smooth tops + glue comp  classic house mastering",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:.5,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:3,attack:.008,release:.18}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.5}}]},{name:"Drum & Bass",description:"Tight transients + sub weight + air  fast and heavy",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:5,attack:.002,release:.08}}]},{name:"Hip Hop",description:"Fat low-end + warm saturation + controlled dynamics",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:1,high:0}},{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:20,parameters:{drive:30,tone:8e3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:3.5,attack:.01,release:.2}}]},{name:"Dub / Reggae",description:"Heavy subs + warm mids + spring tank glue",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:-1}},{category:"wasm",type:"SpringReverb",enabled:!0,wet:10,parameters:{decay:.3,damping:.5,tension:.4,mix:.25,drip:.2,diffusion:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.25}}]},{name:"Ambient",description:"Spacious plate + gentle compression  ethereal finishing",category:"Genre",effects:[{category:"wasm",type:"MVerb",enabled:!0,wet:20,parameters:{damping:.4,density:.7,bandwidth:.5,decay:.6,predelay:.04,size:.85,gain:1,mix:.4,earlyMix:.4}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2,attack:.03,release:.4}}]},{name:"Hardstyle",description:"Maximum sub impact + hard limiting + grit  loud and aggressive",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:20,parameters:{drive:50,tone:12e3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-8,ratio:8,attack:.002,release:.08}}]},{name:"DJ Booth",description:"Club-standard bus compression + EQ + tape warmth  ready to mix",category:"DJ",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}},{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:15,parameters:{drive:30,tone:11e3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-14,ratio:3.5,attack:.005,release:.12}}]},{name:"Dub Sirens Live",description:"Space Echo + spring reverb on the master  live dub FX send",category:"DJ",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:35,parameters:{mode:4,rate:300,intensity:.55,echoVolume:.75,reverbVolume:.2,bpmSync:1,syncDivision:"1/4"}},{category:"wasm",type:"SpringReverb",enabled:!0,wet:20,parameters:{decay:.5,damping:.4,tension:.45,mix:.3,drip:.5,diffusion:.6}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-1,high:0}}]},{name:"Big Room",description:"Plate reverb + wide stereo + punchy comp  festival main stage",category:"DJ",effects:[{category:"wasm",type:"MVerb",enabled:!0,wet:12,parameters:{damping:.5,density:.6,bandwidth:.7,decay:.35,predelay:0,size:.5,gain:1,mix:.35,earlyMix:.7}},{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:4,attack:.005,release:.12}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}}]},{name:"Vinyl DJ",description:"ToneArm simulation + warmth  vinyl turntable character on the output",category:"DJ",effects:[{category:"wasm",type:"ToneArm",enabled:!0,wet:30,parameters:{wow:6,coil:35,flutter:4,riaa:55,stylus:20,hiss:8,pops:5,rpm:33.333}},{category:"tonejs",type:"TapeSaturation",enabled:!0,wet:15,parameters:{drive:25,tone:1e4}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:3,attack:.01,release:.2}}]},{name:"Echo Out",description:"BPM-synced tape echo for live transitions  wash to echo and back",category:"DJ",effects:[{category:"tonejs",type:"RETapeEcho",enabled:!0,wet:40,parameters:{mode:3,repeatRate:.5,intensity:.55,echoVolume:.8,wow:.15,flutter:.1,dirt:.1,inputBleed:.05,loopAmount:0,playheadFilter:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-14,ratio:3,attack:.008,release:.15}}]},{name:"Warehouse Rave",description:"Gritty tape saturation + hard compression  raw warehouse energy",category:"DJ",effects:[{category:"wasm",type:"TapeSimulator",enabled:!0,wet:35,parameters:{drive:40,character:45,bias:40,shame:20,hiss:10,speed:1}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-2,high:2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:6,attack:.003,release:.1}}]}],cP=({channelIndex:e,channel:t,patternId:n,onFillPattern:s,onClearChannel:a,onCopyChannel:o,onCutChannel:r,onPasteChannel:i,onTranspose:c,onHumanize:u,onInterpolate:d,onAcidGenerator:m,onRandomize:p,onToggleCollapse:h,onReverseVisual:f,onPolyrhythm:g,onFibonacci:b,onEuclidean:v,onPingPong:y,onGlitch:x,onStrobe:N,onVisualEcho:w,onConverge:E,onSpiral:k,onBounce:D,onChaos:S})=>{const{isLiveMode:M,queueChannelAction:C}=XM(),{toggleChannelMute:V,toggleChannelSolo:P,removeChannel:_,setChannelColor:O,toggleChannelCollapse:T,patterns:L}=ID(us(e=>({toggleChannelMute:e.toggleChannelMute,toggleChannelSolo:e.toggleChannelSolo,removeChannel:e.removeChannel,setChannelColor:e.setChannelColor,toggleChannelCollapse:e.toggleChannelCollapse,patterns:e.patterns}))),{setActiveParameter:A,setShowLane:B,getShowLane:I,removeCurve:F,getCurvesForPattern:U}=XD(us(e=>({setActiveParameter:e.setActiveParameter,setShowLane:e.setShowLane,getShowLane:e.getShowLane,removeCurve:e.removeCurve,getCurvesForPattern:e.getCurvesForPattern}))),{updateInstrument:R}=EN(us(e=>({updateInstrument:e.updateInstrument}))),j=l.useCallback(n=>{const s=lP.find(e=>e.name===n);if(!s||!t.instrumentId)return;const a=s.effects.map((e,t)=>({...e,id:`channel-fx-${Date.now()}-${t}`}));R(t.instrumentId,{effects:a}),_k.success(`Applied ${s.name} to CH ${(e+1).toString().padStart(2,"0")}`)},[t.instrumentId,e,R]),X=I(e),z=U(n,e),G=z.length>0,{params:H}=qV(e),W=l.useMemo(()=>H.slice(0,8).map(e=>({id:e.key,label:e.name,color:e.color})),[H]),q=l.useMemo(()=>M?[{id:"trigger",label:"Trigger",icon:Yn.jsxDEV(Oe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:162,columnNumber:17},void 0),submenu:[{id:"trigger-kicks",label:"4/4 Kicks",onClick:()=>{C(e,{type:"trigger",pattern:"kicks"}),s(e,"4on4")}},{id:"trigger-build",label:"Build",onClick:()=>{C(e,{type:"trigger",pattern:"build"}),s(e,"build")}},{id:"trigger-drop",label:"Drop",onClick:()=>{C(e,{type:"trigger",pattern:"drop"}),s(e,"16ths")}},{id:"trigger-breakdown",label:"Breakdown",onClick:()=>{C(e,{type:"trigger",pattern:"breakdown"}),s(e,"breakdown")}}]},{id:"stutter",label:"Stutter",icon:Yn.jsxDEV(ht,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:202,columnNumber:17},void 0),onClick:()=>C(e,{type:"stutter"})},{id:"roll",label:"Roll",icon:Yn.jsxDEV(Ve,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:209,columnNumber:17},void 0),submenu:[{id:"roll-4",label:"1/4 Note",onClick:()=>C(e,{type:"roll",division:"1/4"})},{id:"roll-8",label:"1/8 Note",onClick:()=>C(e,{type:"roll",division:"1/8"})},{id:"roll-16",label:"1/16 Note",onClick:()=>C(e,{type:"roll",division:"1/16"})}]},{type:"divider"},{id:"automation",label:"Automation",icon:Yn.jsxDEV(ft,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:233,columnNumber:17},void 0),submenu:[{id:"auto-sweep-up",label:"Filter Sweep Up",onClick:()=>C(e,{type:"filterSweep",direction:"up",bars:4})},{id:"auto-sweep-down",label:"Filter Sweep Down",onClick:()=>C(e,{type:"filterSweep",direction:"down",bars:4})},{id:"auto-fade-in",label:"Volume Fade In",onClick:()=>C(e,{type:"volumeFade",direction:"in",bars:4})},{id:"auto-fade-out",label:"Volume Fade Out",onClick:()=>C(e,{type:"volumeFade",direction:"out",bars:4})},{type:"divider"},...W.slice(0,2).map(t=>({id:`auto-show-${t.id}`,label:`Show ${t.label}`,onClick:()=>{A(e,t.id),B(e,!0)}}))]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?Yn.jsxDEV(gt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:271,columnNumber:33},void 0):Yn.jsxDEV(bt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:271,columnNumber:57},void 0),checked:t.muted,onClick:()=>V(e)},{id:"solo",label:"Solo",icon:Yn.jsxDEV(vt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:278,columnNumber:17},void 0),checked:t.solo,onClick:()=>P(e)},{id:"kill",label:"Kill",icon:Yn.jsxDEV(Oe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:286,columnNumber:17},void 0),danger:!0,onClick:()=>{C(e,{type:"kill"}),V(e)}}]:[{id:"collapse",label:t.collapsed?"Expand Channel":"Collapse Channel",icon:t.collapsed?Yn.jsxDEV(yt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:302,columnNumber:35},void 0):Yn.jsxDEV(xt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:302,columnNumber:61},void 0),onClick:()=>{h?h(e):T(e)}},{type:"divider"},{id:"fill",label:"Fill",icon:Yn.jsxDEV(_e,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:313,columnNumber:15},void 0),submenu:[{id:"fill-4on4",label:iP["4on4"].name,onClick:()=>s(e,"4on4")},{id:"fill-offbeat",label:iP.offbeat.name,onClick:()=>s(e,"offbeat")},{id:"fill-backbeat",label:iP.backbeat.name,onClick:()=>s(e,"backbeat")},{id:"fill-hihats",label:iP.hiHats.name,onClick:()=>s(e,"hiHats")},{type:"divider"},{id:"fill-8ths",label:iP["8ths"].name,onClick:()=>s(e,"8ths")},{id:"fill-16ths",label:iP["16ths"].name,onClick:()=>s(e,"16ths")},{id:"fill-random",label:iP.random.name,onClick:()=>s(e,"random")},{id:"fill-acid",label:" Acid Generator...",icon:Yn.jsxDEV(Nt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:356,columnNumber:19},void 0),onClick:()=>m(e)},{id:"fill-randomize",label:" Randomize...",icon:Yn.jsxDEV(wt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:362,columnNumber:19},void 0),onClick:()=>p(e)},{type:"divider"},{id:"fill-syncopated",label:iP.syncopated.name,onClick:()=>s(e,"syncopated")},{id:"fill-walking",label:iP.walking.name,onClick:()=>s(e,"walking")},{type:"divider"},{id:"fill-build",label:iP.build.name,onClick:()=>s(e,"build")},{id:"fill-breakdown",label:iP.breakdown.name,onClick:()=>s(e,"breakdown")}]},{id:"clear",label:"Clear Channel",icon:Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:395,columnNumber:15},void 0),onClick:()=>a(e)},{id:"copy",label:"Copy Track",icon:Yn.jsxDEV(Je,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:402,columnNumber:15},void 0),onClick:()=>o(e)},{id:"cut",label:"Cut Track",icon:Yn.jsxDEV(Et,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:408,columnNumber:15},void 0),onClick:()=>r(e)},{id:"paste",label:"Paste Track",icon:Yn.jsxDEV(kt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:414,columnNumber:15},void 0),onClick:()=>i(e)},{type:"divider"},{id:"fx-presets",label:"FX Presets",icon:Yn.jsxDEV(Dt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:422,columnNumber:15},void 0),submenu:(()=>{const e={};return lP.forEach(t=>{const n=t.category||"General";e[n]||(e[n]=[]),e[n].push(t)}),Object.keys(e).sort().map(t=>({id:`fx-cat-${t.toLowerCase()}`,label:t,submenu:e[t].map(e=>({id:`fx-preset-${e.name.replace(/\s+/g,"-")}`,label:e.name,onClick:()=>j(e.name)}))}))})()},{type:"divider"},{id:"transpose",label:"Transpose",icon:Yn.jsxDEV(Xe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:450,columnNumber:15},void 0),submenu:[{id:"transpose-12",label:"+12 (Octave Up)",onClick:()=>c(e,12)},{id:"transpose-7",label:"+7 (Fifth)",onClick:()=>c(e,7)},{id:"transpose-1",label:"+1 (Semitone)",onClick:()=>c(e,1)},{type:"divider"},{id:"transpose--1",label:"-1 (Semitone)",onClick:()=>c(e,-1)},{id:"transpose--7",label:"-7 (Fifth)",onClick:()=>c(e,-7)},{id:"transpose--12",label:"-12 (Octave Down)",onClick:()=>c(e,-12)}]},{id:"humanize",label:"Humanize",icon:Yn.jsxDEV(Nt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:465,columnNumber:15},void 0),shortcut:"Ctrl+H",onClick:()=>u(e)},{id:"interpolate",label:"Interpolate",icon:Yn.jsxDEV(St,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:473,columnNumber:15},void 0),shortcut:"Ctrl+I",onClick:()=>d(e)},{type:"divider"},{id:"bd-animations",label:"B/D Animations",icon:Yn.jsxDEV(Dt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:482,columnNumber:15},void 0),submenu:[{id:"bd-reverse-visual",label:"Reverse Visual",icon:Yn.jsxDEV(Mt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:487,columnNumber:19},void 0),onClick:()=>f?.(e),disabled:!f},{type:"divider"},{id:"bd-polyrhythm",label:"Polyrhythm (E6x)...",icon:Yn.jsxDEV(ht,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:495,columnNumber:19},void 0),onClick:()=>g?.(e),disabled:!g},{id:"bd-fibonacci",label:"Fibonacci Sequence",onClick:()=>b?.(e),disabled:!b},{id:"bd-euclidean",label:"Euclidean Pattern...",icon:Yn.jsxDEV(wt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:508,columnNumber:19},void 0),onClick:()=>v?.(e),disabled:!v},{type:"divider"},{id:"bd-pingpong",label:"Ping-Pong",icon:Yn.jsxDEV(Xe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:516,columnNumber:19},void 0),onClick:()=>y?.(e),disabled:!y},{id:"bd-glitch",label:"Random Glitch",icon:Yn.jsxDEV(Oe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:523,columnNumber:19},void 0),onClick:()=>x?.(e),disabled:!x},{id:"bd-strobe",label:"Strobe Visual",icon:Yn.jsxDEV(ft,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:530,columnNumber:19},void 0),onClick:()=>N?.(e),disabled:!N},{id:"bd-echo",label:"Visual Echo",icon:Yn.jsxDEV(Ct,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:537,columnNumber:19},void 0),onClick:()=>w?.(e),disabled:!w},{type:"divider"},{id:"bd-converge",label:"Converge",onClick:()=>E?.(e),disabled:!E},{id:"bd-spiral",label:"Spiral Out",onClick:()=>k?.(e),disabled:!k},{id:"bd-bounce",label:"Bounce",onClick:()=>D?.(e),disabled:!D},{id:"bd-chaos",label:"Chaos",onClick:()=>S?.(e),disabled:!S}]},{type:"divider"},{id:"automation",label:"Automation",icon:Yn.jsxDEV(Ct,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:573,columnNumber:15},void 0),submenu:[...W.map(t=>({id:`auto-${t.id}`,label:t.label,icon:Yn.jsxDEV("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:579,columnNumber:19},void 0),onClick:()=>{A(e,t.id),B(e,!0)}})),{type:"divider"},{id:"auto-toggle-lane",label:X?"Hide Lane":"Show Lane",icon:X?Yn.jsxDEV(Vt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:590,columnNumber:30},void 0):Yn.jsxDEV(Pt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:590,columnNumber:53},void 0),onClick:()=>B(e,!X)},{id:"auto-clear-all",label:"Clear All Automation",icon:Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:597,columnNumber:19},void 0),danger:!0,disabled:!G,onClick:()=>{z.forEach(e=>F(e.id))}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?Yn.jsxDEV(gt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:611,columnNumber:31},void 0):Yn.jsxDEV(bt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:611,columnNumber:55},void 0),checked:t.muted,onClick:()=>V(e)},{id:"solo",label:"Solo",icon:Yn.jsxDEV(vt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:618,columnNumber:15},void 0),checked:t.solo,onClick:()=>P(e)},{id:"color",label:"Color",icon:Yn.jsxDEV(tt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:626,columnNumber:15},void 0),submenu:Is.map((n,s)=>({id:`color-${s}`,label:null===n?"None":"",icon:n?Yn.jsxDEV("span",{className:"w-4 h-4 rounded",style:{backgroundColor:n}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:631,columnNumber:13},void 0):Yn.jsxDEV("span",{className:"w-4 h-4 rounded border border-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:633,columnNumber:13},void 0),checked:t.color===n,onClick:()=>O(e,n)}))},{id:"delete",label:"Delete Channel",icon:Yn.jsxDEV(_t,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:643,columnNumber:15},void 0),danger:!0,disabled:L[0]?.channels.length<=1,onClick:()=>_(e)}],[M,e,t,X,G,z,L,s,a,o,r,i,c,u,d,m,p,h,f,g,b,v,y,x,N,w,E,k,D,S,V,P,_,O,T,C,A,B,F,j,W]);return Yn.jsxDEV(aP,{items:q,className:`\n        p-1 rounded transition-colors\n        ${M?"text-accent-error hover:bg-accent-error/20":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"}\n      `,children:Yn.jsxDEV("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[Yn.jsxDEV("circle",{cx:"12",cy:"12",r:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:714,columnNumber:9},void 0),Yn.jsxDEV("circle",{cx:"12",cy:"5",r:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:715,columnNumber:9},void 0),Yn.jsxDEV("circle",{cx:"12",cy:"19",r:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:716,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:704,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ChannelContextMenu.tsx",lineNumber:694,columnNumber:5},void 0)},uP=({position:e,onClose:t,rowIndex:n,channelIndex:s,onInterpolate:a,onHumanize:o,onStrum:r,onLegato:i,onOpenParameterEditor:c,onReverseVisual:u,onPolyrhythm:d,onFibonacci:m,onEuclidean:p,onPingPong:h,onGlitch:f,onStrobe:g,onVisualEcho:b,onConverge:v,onSpiral:y,onBounce:x,onChaos:N})=>{const{patterns:w,currentPatternIndex:E,setCell:k,cursor:D,selection:S,selectColumn:M,selectChannel:C,copySelection:V,cutSelection:P,paste:_,transposeSelection:O,interpolateSelection:T,clearSelection:L}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,setCell:e.setCell,cursor:e.cursor,selection:e.selection,selectColumn:e.selectColumn,selectChannel:e.selectChannel,copySelection:e.copySelection,cutSelection:e.cutSelection,paste:e.paste,transposeSelection:e.transposeSelection,interpolateSelection:e.interpolateSelection,clearSelection:e.clearSelection}))),A=w[E],B=!!S,I=l.useCallback(()=>{B&&(V(),t())},[B,V,t]),F=l.useCallback(()=>{B&&(P(),t())},[B,P,t]),U=l.useCallback(()=>{_(),t()},[_,t]),R=l.useCallback(e=>{B&&(O(e),t())},[B,O,t]),j=l.useCallback(e=>{if(!S||!A)return;const n=Math.min(S.startRow,S.endRow),a=Math.max(S.startRow,S.endRow),o=s,r="effParam"===e?"eff":"effParam2"===e?"eff2":e;let i=null;for(let t=n;t<=a;t++){const e=A.channels[o].rows[t][r];if(void 0!==e&&0!==e){i=e;break}}let l=null;for(let t=a;t>=n;t--){const e=A.channels[o].rows[t][r];if(void 0!==e&&0!==e){l=e;break}}null!==i&&null!==l?(T(e,i,l),t()):t()},[S,A,s,T,t]),X=l.useCallback(()=>{L(),t()},[L,t]),z=l.useCallback(()=>{if(!A)return;const e=A.channels[s].rows[n];localStorage.setItem("devilbox-cell-clipboard",JSON.stringify(e))},[A,s,n]),G=l.useCallback(()=>{z(),k(s,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[z,k,s,n]),H=l.useCallback(()=>{const e=localStorage.getItem("devilbox-cell-clipboard");if(e)try{const t=JSON.parse(e);k(s,n,t)}catch(t){}},[k,s,n]),W=l.useCallback(()=>{k(s,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[k,s,n]),q=l.useCallback(()=>{if(A){for(let e=A.length-1;e>n;e--){const t=A.channels[s].rows[e-1];k(s,e,t)}k(s,n,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[A,s,n,k]),K=l.useCallback(()=>{if(A){for(let e=n;e<A.length-1;e++){const t=A.channels[s].rows[e+1];k(s,e,t)}k(s,A.length-1,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[A,s,n,k]),$=l.useCallback(()=>{M(s,D.columnType),t()},[s,D.columnType,M,t]),Y=l.useCallback(()=>{C(s),t()},[s,C,t]),J=l.useMemo(()=>[...B?[{id:"block-header",label:"BLOCK OPERATIONS",disabled:!0,className:"text-accent-primary font-bold text-[10px] tracking-widest"},{id:"block-copy",label:"Copy Block",icon:Yn.jsxDEV(Je,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:285,columnNumber:15},void 0),onClick:I},{id:"block-cut",label:"Cut Block",icon:Yn.jsxDEV(Et,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:291,columnNumber:15},void 0),onClick:F},{id:"block-paste",label:"Paste Block",icon:Yn.jsxDEV(kt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:297,columnNumber:15},void 0),onClick:U},{id:"block-transpose",label:"Transpose Block",icon:Yn.jsxDEV(St,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:303,columnNumber:15},void 0),submenu:[{id:"transpose-up-1",label:"+1 Semitone",onClick:()=>R(1)},{id:"transpose-down-1",label:"-1 Semitone",onClick:()=>R(-1)},{id:"transpose-up-12",label:"+1 Octave",onClick:()=>R(12)},{id:"transpose-down-12",label:"-1 Octave",onClick:()=>R(-12)}]},{id:"block-interpolate",label:"Interpolate Block",icon:Yn.jsxDEV(St,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:314,columnNumber:15},void 0),submenu:[{id:"interp-vol",label:"Interpolate Volume",onClick:()=>j("volume")},{id:"interp-eff1",label:"Interpolate Effect 1",onClick:()=>j("effParam")},{id:"interp-eff2",label:"Interpolate Effect 2",onClick:()=>j("effParam2")},{id:"interp-cutoff",label:"Interpolate Cutoff",onClick:()=>j("cutoff")},{id:"interp-res",label:"Interpolate Resonance",onClick:()=>j("resonance")}]},{id:"block-bd-ops",label:"B/D Operations",icon:Yn.jsxDEV(Oe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:326,columnNumber:15},void 0),submenu:[{id:"bd-reverse",label:"Reverse Visual",onClick:u},{id:"bd-poly",label:"Polyrhythm",onClick:d},{id:"bd-fib",label:"Fibonacci Sequence",onClick:m},{id:"bd-eucl",label:"Euclidean Pattern",onClick:p},{id:"bd-pingpong",label:"Ping-Pong",onClick:h},{id:"bd-glitch",label:"Glitch",onClick:f},{id:"bd-strobe",label:"Strobe",onClick:g},{id:"bd-echo",label:"Visual Echo",onClick:b},{id:"bd-converge",label:"Converge",onClick:v},{id:"bd-spiral",label:"Spiral",onClick:y},{id:"bd-bounce",label:"Bounce",onClick:x},{id:"bd-chaos",label:"Chaos",onClick:N}]},{id:"block-clear",label:"Deselect Block",icon:Yn.jsxDEV(Ce,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:345,columnNumber:15},void 0),onClick:X},{type:"divider"}]:[],{id:"cell-header",label:"CELL OPERATIONS",disabled:!0,className:"text-text-muted font-bold text-[10px] tracking-widest"},{id:"cut",label:"Cut Cell",icon:Yn.jsxDEV(Et,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:362,columnNumber:13},void 0),shortcut:"Ctrl+X",onClick:G},{id:"copy",label:"Copy Cell",icon:Yn.jsxDEV(Je,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:369,columnNumber:13},void 0),shortcut:"Ctrl+C",onClick:z},{id:"paste",label:"Paste Cell",icon:Yn.jsxDEV(kt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:376,columnNumber:13},void 0),shortcut:"Ctrl+V",onClick:H},{id:"clear",label:"Clear",icon:Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:383,columnNumber:13},void 0),shortcut:"Del",onClick:W},{type:"divider"},{id:"insert-row",label:"Insert Row",icon:Yn.jsxDEV(Ot,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:392,columnNumber:13},void 0),shortcut:"Ins",onClick:q},{id:"delete-row",label:"Delete Row",icon:Yn.jsxDEV(Tt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:399,columnNumber:13},void 0),shortcut:"Backspace",onClick:K},{type:"divider"},{id:"interpolate",label:"Interpolate",icon:Yn.jsxDEV(St,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:408,columnNumber:13},void 0),shortcut:"Ctrl+I",onClick:a},{id:"humanize",label:"Humanize",icon:Yn.jsxDEV(Nt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:415,columnNumber:13},void 0),shortcut:"Ctrl+H",onClick:o},{id:"strum",label:"Strum/Arpeggiate",icon:Yn.jsxDEV(_e,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:422,columnNumber:13},void 0),onClick:r},{id:"legato",label:"Legato (Connect Notes)",icon:Yn.jsxDEV(Lt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:428,columnNumber:13},void 0),onClick:i},{type:"divider"},{id:"param-editor",label:"Visual Parameter Editor",icon:Yn.jsxDEV(At,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:436,columnNumber:13},void 0),submenu:[{id:"param-volume",label:"Edit Volume...",onClick:()=>c?.("volume")},{id:"param-effect",label:"Edit Effect Type...",onClick:()=>c?.("effect")},{id:"param-effectparam",label:"Edit Effect Parameter...",onClick:()=>c?.("effectParam")}]},{type:"divider"},{id:"select-column",label:"Select Column",icon:Yn.jsxDEV(Bt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:460,columnNumber:13},void 0),onClick:$},{id:"select-channel",label:"Select Channel",icon:Yn.jsxDEV(It,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:466,columnNumber:13},void 0),onClick:Y}],[G,z,H,W,q,K,a,o,r,i,c,$,Y]);return e?Yn.jsxDEV(tP,{items:J,position:e,onClose:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/CellContextMenu.tsx",lineNumber:488,columnNumber:5},void 0):null},dP=()=>{const[e,t]=a.useState({position:null,rowIndex:0,channelIndex:0}),n=l.useCallback((e,n,s)=>{e.preventDefault(),e.stopPropagation(),t({position:{x:e.clientX,y:e.clientY},rowIndex:n,channelIndex:s})},[]),s=l.useCallback(()=>{t(e=>({...e,position:null}))},[]),o=l.useCallback(e=>{e.preventDefault()},[]);return{...e,openMenu:n,closeMenu:s,isOpen:null!==e.position,handleContextMenu:o,cellInfo:e.position?{rowIndex:e.rowIndex,channelIndex:e.channelIndex}:null}},mP={volume:{label:"Volume",min:0,max:64,default:64,color:"#22c55e",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effectParam:{label:"Effect Parameter",min:0,max:255,default:0,color:"#f59e0b",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effect:{label:"Effect Type",min:0,max:35,default:0,color:"#8b5cf6",format:e=>e<10?e.toString():String.fromCharCode(55+e)},note:{label:"Note",min:0,max:119,default:48,color:"#3b82f6",format:e=>{const t=Math.floor(e/12);return`${["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"][e%12]}${t}`}},instrument:{label:"Instrument",min:0,max:99,default:1,color:"#ec4899",format:e=>e.toString().padStart(2,"0")}},pP=({onClose:e,channelIndex:t,startRow:n,endRow:s,field:a})=>{const o=l.useRef(null),r=l.useRef(null),i=ID(e=>e.patterns),c=ID(e=>e.currentPatternIndex),u=ID(e=>e.setCell),d=mP[a],m=s-n+1,[p,h]=l.useState(!1),[f,g]=l.useState("overwrite"),[b,v]=l.useState(null),y=LN(e=>e.useHexNumbers),x=l.useMemo(()=>{const e=i[c];if(!e)return[];const o=e.channels[t];if(!o)return[];const r=[];for(let t=n;t<=s;t++){const e=o.rows[t];if(!e){r.push(d.default);continue}let n=d.default;switch(a){case"volume":n=e.volume??d.default;break;case"effect":e.effect&&"..."!==e.effect&&(n=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(n=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(n=e.note);break;case"instrument":n=e.instrument??d.default}r.push(n)}return r},[i,c,t,n,s,a,d.default]),[N,w]=l.useState(x),[E,k]=l.useState(()=>`${c}-${t}-${n}-${s}-${a}`),D=`${c}-${t}-${n}-${s}-${a}`;D!==E&&(k(D),w(x));const S=12,M=20,C=Math.max(400,14*m+40),V=200,P=l.useCallback(()=>{const e=o.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.fillStyle="#1a1a2e",t.fillRect(0,0,C,V),t.strokeStyle="#2a2a4a",t.lineWidth=1;for(let n=0;n<=4;n++){const e=M+n/4*160;t.beginPath(),t.moveTo(M,e),t.lineTo(C-M,e),t.stroke();const s=Math.round(d.max-(d.max-d.min)*(n/4));t.fillStyle="#666",t.font="10px monospace",t.textAlign="right",t.fillText(d.format(s),16,e+3)}(b||N).forEach((e,s)=>{const a=M+14*s,o=160*((e-d.min)/(d.max-d.min)),r=180-o,i=t.createLinearGradient(a,r,a,180);i.addColorStop(0,d.color),i.addColorStop(1,d.color+"40"),t.fillStyle=i,t.fillRect(a,r,S,o),t.strokeStyle=d.color,t.lineWidth=1,t.strokeRect(a,r,S,o),(n+s)%4==0&&(t.fillStyle="#888",t.font="9px monospace",t.textAlign="center",t.fillText(y?(n+s).toString(16).toUpperCase().padStart(2,"0"):(n+s).toString().padStart(2,"0"),a+6,196))})},[N,b,C,V,d,n,y]);l.useEffect(()=>{P()},[P]);const _=l.useCallback(e=>{const t=o.current;if(!t)return null;const n=t.getBoundingClientRect(),s=e.clientX-n.left,a=e.clientY-n.top,r=Math.floor((s-M)/14);if(r<0||r>=m)return null;const i=1-(a-M)/160,l=Math.round(d.min+i*(d.max-d.min));return{rowIndex:r,value:Math.max(d.min,Math.min(d.max,l))}},[m,d,V]),O=l.useCallback((e,t,n)=>{w(s=>{const a=[...s],o=a[e];switch(n){case"overwrite":a[e]=t;break;case"fill_blanks":0!==o&&o!==d.default||(a[e]=t);break;case"add":a[e]=Math.max(d.min,Math.min(d.max,o+(t-d.max/2)));break;case"scale":{const n=t/d.max;a[e]=Math.round(o*n);break}}return a})},[d]),T=l.useCallback(e=>{const t=_(e);if(t){if(2===e.button)return e.preventDefault(),void O(t.rowIndex,t.value,"overwrite");h(!0),O(t.rowIndex,t.value,f)}},[_,O,f]),L=l.useCallback(e=>{if(!p){const t=_(e);return void(t&&v(()=>{const e=[...N];return e[t.rowIndex]=t.value,e}))}const t=_(e);t&&O(t.rowIndex,t.value,f)},[p,_,O,f,N]),A=l.useCallback(()=>{h(!1)},[]),B=l.useCallback(()=>{h(!1),v(null)},[]),I=l.useCallback(e=>{e.preventDefault()},[]),F=l.useCallback(()=>{N.forEach((e,s)=>{const o=n+s,r=i[c];if(!r)return;const l=r.channels[t]?.rows[o];if(!l)return;const m={};switch(a){case"volume":m.volume=e;break;case"effect":{const t=l.effect||"000",n=t.length>=3?t.substring(1):"00";m.effect=d.format(e)+n;break}case"effectParam":{const t=l.effect?.[0]||"0";m.effect=t+e.toString(16).toUpperCase().padStart(2,"0");break}case"note":m.note=e;break;case"instrument":m.instrument=e}u(t,o,m)}),e()},[N,n,i,c,t,a,d,u,e]),U=l.useCallback(e=>{const t=Array(m).fill(0).map((t,n)=>{const s=n/(m-1||1),a=d.max-d.min;switch(e){case"ramp_up":return Math.round(d.min+s*a);case"ramp_down":return Math.round(d.max-s*a);case"triangle":return Math.round(d.min+Math.abs(1-2*s)*a);case"random":return Math.round(d.min+Math.random()*a);case"sine":return Math.round(d.min+(Math.sin(s*Math.PI*2)+1)/2*a);default:return d.default}});w(t)},[m,d]),R=l.useCallback(()=>{if(N.length<2)return;const e=N[0],t=N[N.length-1],n=N.map((n,s)=>{const a=s/(N.length-1);return Math.round(e+(t-e)*a)});w(n)},[N]),j=l.useCallback(()=>{w(x)},[x]);return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:Yn.jsxDEV("div",{ref:r,className:"bg-dark-bg border border-dark-border rounded-lg shadow-2xl max-w-[95vw] overflow-hidden",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 bg-dark-bgSecondary border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("h2",{className:"text-text-primary font-bold",children:[d.label," Editor"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:434,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-secondary",children:["Channel ",t+1,", Rows ",n,"-",s]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:435,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:433,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:e,children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:440,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:439,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:432,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2 px-4 py-2 bg-dark-bgSecondary/50 border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-1 mr-4",children:[Yn.jsxDEV("span",{className:"text-xs text-text-secondary mr-1",children:"Mode:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:448,columnNumber:13},void 0),["overwrite","fill_blanks","add","scale"].map(e=>Yn.jsxDEV("button",{onClick:()=>g(e),className:"px-2 py-1 text-xs rounded "+(f===e?"bg-blue-600 text-white":"bg-dark-bg text-text-secondary hover:bg-dark-bgSecondary"),children:"fill_blanks"===e?"Fill Empty":e.charAt(0).toUpperCase()+e.slice(1)},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:450,columnNumber:15},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:447,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[Yn.jsxDEV("span",{className:"text-xs text-text-secondary mr-1",children:"Generate:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:466,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>U("ramp_up"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Up",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:467,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>U("ramp_down"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Down",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:468,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>U("triangle"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Triangle",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:469,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>U("sine"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Sine",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:470,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>U("random"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Random",children:"?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:471,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:465,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:R,title:"Interpolate between first and last",children:Yn.jsxDEV(Xe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:477,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:476,columnNumber:13},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:j,title:"Reset to original",children:Yn.jsxDEV(Ft,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:480,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:479,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:475,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:445,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 overflow-x-auto",children:Yn.jsxDEV("canvas",{ref:o,width:C,height:V,onMouseDown:T,onMouseMove:L,onMouseUp:A,onMouseLeave:B,onContextMenu:I,className:"cursor-crosshair border border-dark-border rounded",style:{minWidth:C}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:487,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:486,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-4 py-2 text-xs text-text-secondary bg-dark-bgSecondary/30 border-t border-dark-border",children:[Yn.jsxDEV("span",{className:"font-medium",children:"Tips:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:503,columnNumber:11},void 0)," Click + drag to paint values. Right-click for single-row precision."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:502,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 bg-dark-bgSecondary border-t border-dark-border",children:[Yn.jsxDEV(TV,{variant:"ghost",onClick:e,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:508,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",onClick:F,children:[Yn.jsxDEV(Nt,{size:14,className:"mr-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:510,columnNumber:13},void 0),"Apply"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:509,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:507,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:427,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ParameterEditor.tsx",lineNumber:426,columnNumber:5},void 0)},hP=()=>"vibrate"in navigator,fP=e=>{if(!hP())return!1;try{return navigator.vibrate(e)}catch(t){return!1}},gP={light:()=>fP(10),medium:()=>fP(20),heavy:()=>fP(30),success:()=>fP([10,50,10]),error:()=>fP([20,100,20]),warning:()=>fP([15,75,15,75,15]),selection:()=>fP([5,30,5]),soft:()=>fP(5),rigid:()=>fP(40),cancel:()=>fP(0),isSupported:()=>hP()};function bP(e,t){const n=t.clientX-e.clientX,s=t.clientY-e.clientY;return Math.sqrt(n*n+s*s)}function vP({onSwipeUp:e,onSwipeDown:t,onSwipeLeft:n,onSwipeRight:s,onTap:a,onLongPress:o,onPinchZoom:r,onScroll:i,onHorizontalScroll:c,onTouchStart:u,swipeThreshold:d=50,longPressDelay:m=500,enabled:p=!0}){const h=l.useRef(null),f=l.useCallback(()=>{h.current?.longPressTimer&&(clearTimeout(h.current.longPressTimer),h.current.longPressTimer=null)},[]);return{onTouchStart:l.useCallback(e=>{if(!p)return;const t=e.touches[0],n=e.touches.length;u&&u(),h.current={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY,lastX:t.clientX,lastY:t.clientY,startTime:Date.now(),touches:n,initialDistance:2===n?bP(e.touches[0],e.touches[1]):0,longPressTimer:null,hasMoved:!1},1===n&&o&&(h.current.longPressTimer=setTimeout(()=>{h.current&&!h.current.hasMoved&&(gP.heavy(),o(h.current.startX,h.current.startY),h.current=null)},m))},[p,o,m]),onTouchMove:l.useCallback(e=>{if(!p||!h.current)return;const t=e.touches[0],n=e.touches.length;h.current.currentX=t.clientX,h.current.currentY=t.clientY;const s=t.clientX-h.current.startX,a=t.clientY-h.current.startY;if(Math.sqrt(s*s+a*a)>10&&(h.current.hasMoved=!0,f()),2===n&&r&&2===e.touches.length){const t=bP(e.touches[0],e.touches[1]),n=t-h.current.initialDistance;if(Math.abs(n)>50){const e=t/h.current.initialDistance;r(e),h.current.initialDistance=t}e.preventDefault()}if(1===n&&(i||c)){const n=h.current.lastX-t.clientX,s=h.current.lastY-t.clientY,a=Math.abs(n),o=Math.abs(s);(a>5||o>5)&&e.preventDefault(),i&&o>1.5*a&&Math.abs(s)>1?(i(s),h.current.lastY=t.clientY):c&&a>1.5*o&&Math.abs(n)>1&&(c(n),h.current.lastX=t.clientX)}},[p,r,i,c,f]),onTouchEnd:l.useCallback(o=>{if(!p||!h.current)return;f();const r=o.changedTouches[0],i=r.clientX-h.current.startX,l=r.clientY-h.current.startY,c=Date.now()-h.current.startTime,u=Math.sqrt(i*i+l*l);if(!h.current.hasMoved&&u<10&&c<300&&1===h.current.touches&&a)return gP.soft(),a(h.current.startX,h.current.startY),void(h.current=null);if(h.current.hasMoved&&c<500&&1===h.current.touches){const a=Math.abs(i),r=Math.abs(l);a>r&&a>d?(o.preventDefault(),gP.selection(),i>0&&s?s():i<0&&n&&n()):r>a&&r>d&&(gP.selection(),l>0&&t?t():l<0&&e&&e())}h.current=null},[p,d,e,t,n,s,a,f]),onTouchCancel:l.useCallback(()=>{f(),h.current=null},[f])}}const yP=640,xP=1024;function NP(){const[e,t]=l.useState(()=>"undefined"!=typeof window?window.innerWidth:1024);return l.useEffect(()=>{if("undefined"==typeof window)return;let e;requestAnimationFrame(()=>t(window.innerWidth));const n=()=>{clearTimeout(e),e=setTimeout(()=>{t(window.innerWidth)},100)};return window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{clearTimeout(e),window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),l.useMemo(()=>{const t=function(e){return e<yP?"mobile":e<xP?"tablet":"desktop"}(e);return{breakpoint:t,isMobile:"mobile"===t,isTablet:"tablet"===t,isDesktop:"desktop"===t,width:e}},[e])}const wP=l.createContext(null);function EP({children:e}){const t={...NP(),isTouch:function(){const[e]=l.useState(()=>"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0));return e}()};return Yn.jsxDEV(wP.Provider,{value:t,children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/contexts/ResponsiveContext.tsx",lineNumber:32,columnNumber:5},this)}const kP=.003;class DP{captureNode;playbackNode;playbackGain;initialized=!1;static loadedCtxs=new WeakSet;static initPromises=new WeakMap;ctx;bufferId;constructor(e,t){this.ctx=e,this.bufferId=t}async init(){if(!DP.loadedCtxs.has(this.ctx)){let e=DP.initPromises.get(this.ctx);if(!e){const t="/";e=this.ctx.audioWorklet.addModule(`${t}worklets/scratch-buffer.worklet.js`),DP.initPromises.set(this.ctx,e)}await e,DP.loadedCtxs.add(this.ctx)}const e={processorOptions:{bufferId:this.bufferId},channelCount:2,channelCountMode:"explicit"};this.captureNode=new AudioWorkletNode(this.ctx,"scratch-capture",{...e,numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]}),this.playbackNode=new AudioWorkletNode(this.ctx,"scratch-reverse",{...e,numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.playbackNode.port.onmessage=e=>{e.data.type},this.playbackGain=this.ctx.createGain(),this.playbackGain.gain.value=0,this.playbackNode.connect(this.playbackGain),this.initialized=!0}wireIntoChain(e,t){if(!this.initialized)return;const n=co(e),s=co(t);n&&s&&(n.connect(this.captureNode),this.playbackGain.connect(s))}freezeCapture(){this.initialized&&this.captureNode.port.postMessage({type:"freeze"})}unfreezeCapture(){this.initialized&&this.captureNode.port.postMessage({type:"unfreeze"})}startScratch(e){if(!this.initialized)return;this.freezeCapture();const t=this.ctx.currentTime;this.playbackGain.gain.cancelScheduledValues(t),this.playbackGain.gain.setValueAtTime(this.playbackGain.gain.value,t),this.playbackGain.gain.linearRampToValueAtTime(1,t+kP),this.playbackNode.port.postMessage({type:"startFromWrite",rate:e})}setScratchRate(e){this.initialized&&this.playbackNode.port.postMessage({type:"setRate",rate:e})}snapScratchRate(e){this.initialized&&this.playbackNode.port.postMessage({type:"snapRate",rate:e})}stopScratch(){if(!this.initialized)return Promise.resolve(0);const e=this.ctx.currentTime;return this.playbackGain.gain.cancelScheduledValues(e),this.playbackGain.gain.setValueAtTime(this.playbackGain.gain.value,e),this.playbackGain.gain.linearRampToValueAtTime(0,e+kP),new Promise(e=>{const t=n=>{"stopped"===n.data.type&&(this.playbackNode.port.removeEventListener("message",t),e(n.data.framesBack))};this.playbackNode.port.addEventListener("message",t),setTimeout(()=>{this.playbackNode.port.postMessage({type:"stop"}),this.unfreezeCapture()},4)})}silenceAndStop(){if(!this.initialized)return;this.playbackNode.port.postMessage({type:"setRate",rate:0});const e=this.ctx.currentTime;this.playbackGain.gain.cancelScheduledValues(e),this.playbackGain.gain.setValueAtTime(0,e),this.playbackNode.port.postMessage({type:"stop"}),this.unfreezeCapture()}startScratchPlayback(e){this.startScratch(e)}stopScratchPlayback(){this.stopScratch()}startReverseFromWritePos(e){this.startScratch(-Math.abs(e))}startReverse(e){this.startScratch(-Math.abs(e))}setRate(e){this.setScratchRate(e)}stopReverse(){return this.stopScratch()}dispose(){try{this.captureNode?.disconnect()}catch{}try{this.playbackNode?.disconnect()}catch{}try{this.playbackGain?.disconnect()}catch{}}}const SP={name:"Transformer",shortName:"Trans",durationBeats:1,durationMs:null,loop:!0,quantize:!1,frames:[{timeMs:0,velocity:1,faderGain:1}]},MP={name:"Crab",shortName:"Crab",durationBeats:1,durationMs:null,loop:!0,quantize:!1,frames:[{timeMs:0,velocity:1,faderGain:1}]},CP={name:"8-Finger Crab",shortName:"8Crb",durationBeats:1,durationMs:null,loop:!0,quantize:!1,frames:[{timeMs:0,velocity:1,faderGain:1}]},VP=[{name:"Baby Scratch",shortName:"Baby",durationBeats:1,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeFraction:0,velocity:0,faderGain:1},{timeFraction:.25,velocity:2.4,faderGain:1},{timeFraction:.5,velocity:0,faderGain:1},{timeFraction:.75,velocity:-1.2,faderGain:1}]},SP,{name:"Flare",shortName:"Flare",durationBeats:1,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeFraction:0,velocity:0,faderGain:1},{timeFraction:.1,velocity:2.2,faderGain:1},{timeFraction:.15,velocity:2.2,faderGain:0},{timeFraction:.19,velocity:2.2,faderGain:1},{timeFraction:.33,velocity:2,faderGain:0},{timeFraction:.37,velocity:1.5,faderGain:1},{timeFraction:.5,velocity:0,faderGain:1},{timeFraction:.65,velocity:-1,faderGain:1},{timeFraction:.9,velocity:-.3,faderGain:1}]},{name:"Hydroplane",shortName:"Hydro",durationBeats:null,durationMs:500,loop:!0,quantize:!1,interpolateVelocity:!0,trueReverse:!1,frames:[{timeMs:0,velocity:1,faderGain:1},{timeMs:70,velocity:.15,faderGain:1},{timeMs:130,velocity:1.1,faderGain:1},{timeMs:190,velocity:.15,faderGain:1},{timeMs:250,velocity:1,faderGain:1},{timeMs:310,velocity:.2,faderGain:1},{timeMs:370,velocity:1,faderGain:1},{timeMs:430,velocity:.25,faderGain:1}]},MP,{name:"Orbit",shortName:"Orbit",durationBeats:1,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeFraction:0,velocity:0,faderGain:1},{timeFraction:.12,velocity:2.2,faderGain:1},{timeFraction:.2,velocity:2.2,faderGain:0},{timeFraction:.24,velocity:2,faderGain:1},{timeFraction:.42,velocity:.5,faderGain:1},{timeFraction:.5,velocity:0,faderGain:1},{timeFraction:.62,velocity:-1.2,faderGain:1},{timeFraction:.7,velocity:-1.2,faderGain:0},{timeFraction:.74,velocity:-1,faderGain:1},{timeFraction:.92,velocity:-.3,faderGain:1}]},{name:"Chirp",shortName:"Chirp",durationBeats:.5,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeFraction:0,velocity:0,faderGain:0},{timeFraction:.06,velocity:.5,faderGain:1},{timeFraction:.25,velocity:2,faderGain:1},{timeFraction:.44,velocity:.3,faderGain:0},{timeFraction:.5,velocity:0,faderGain:0},{timeFraction:.56,velocity:-.3,faderGain:1},{timeFraction:.75,velocity:-1.2,faderGain:1},{timeFraction:.94,velocity:-.3,faderGain:0}]},{name:"Stab",shortName:"Stab",durationBeats:null,durationMs:180,loop:!0,quantize:!1,frames:[{timeMs:0,velocity:3,faderGain:1},{timeMs:70,velocity:-1,faderGain:0}]},{name:"Scribble",shortName:"Scrbl",durationBeats:null,durationMs:160,loop:!0,quantize:!1,interpolateVelocity:!0,trueReverse:!1,frames:[{timeMs:0,velocity:1.5,faderGain:1},{timeMs:20,velocity:.3,faderGain:1},{timeMs:40,velocity:1.5,faderGain:1},{timeMs:60,velocity:.3,faderGain:1},{timeMs:80,velocity:1.5,faderGain:1},{timeMs:100,velocity:.3,faderGain:1},{timeMs:120,velocity:1.5,faderGain:1},{timeMs:140,velocity:.3,faderGain:1}]},{name:"Tear",shortName:"Tear",durationBeats:1,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeFraction:0,velocity:0,faderGain:1},{timeFraction:.12,velocity:2,faderGain:1},{timeFraction:.25,velocity:0,faderGain:1},{timeFraction:.32,velocity:0,faderGain:1},{timeFraction:.45,velocity:2,faderGain:1},{timeFraction:.55,velocity:0,faderGain:1},{timeFraction:.7,velocity:-1.2,faderGain:1},{timeFraction:.9,velocity:0,faderGain:1}]},{name:"Uzi",shortName:"Uzi",durationBeats:null,durationMs:60,loop:!0,quantize:!1,interpolateVelocity:!0,trueReverse:!1,frames:[{timeMs:0,velocity:1.4,faderGain:1},{timeMs:8,velocity:.6,faderGain:1},{timeMs:15,velocity:1.4,faderGain:1},{timeMs:23,velocity:.6,faderGain:1},{timeMs:30,velocity:1.4,faderGain:1},{timeMs:38,velocity:.6,faderGain:1},{timeMs:45,velocity:1.4,faderGain:1},{timeMs:53,velocity:.6,faderGain:1}]},{name:"Twiddle",shortName:"Twdl",durationBeats:1,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeFraction:0,velocity:0,faderGain:1},{timeFraction:.05,velocity:1,faderGain:1},{timeFraction:.09,velocity:1.5,faderGain:0},{timeFraction:.12,velocity:1.8,faderGain:1},{timeFraction:.18,velocity:2.2,faderGain:0},{timeFraction:.21,velocity:2.2,faderGain:1},{timeFraction:.3,velocity:1.8,faderGain:0},{timeFraction:.33,velocity:1.5,faderGain:1},{timeFraction:.45,velocity:.3,faderGain:1},{timeFraction:.5,velocity:0,faderGain:1},{timeFraction:.55,velocity:-.5,faderGain:1},{timeFraction:.59,velocity:-.8,faderGain:0},{timeFraction:.62,velocity:-1,faderGain:1},{timeFraction:.68,velocity:-1.2,faderGain:0},{timeFraction:.71,velocity:-1,faderGain:1},{timeFraction:.8,velocity:-.6,faderGain:0},{timeFraction:.83,velocity:-.4,faderGain:1},{timeFraction:.95,velocity:-.1,faderGain:1}]},CP,{name:"3-Click Flare",shortName:"3Flr",durationBeats:1,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeFraction:0,velocity:0,faderGain:1},{timeFraction:.06,velocity:2.4,faderGain:1},{timeFraction:.09,velocity:2.4,faderGain:0},{timeFraction:.12,velocity:2.4,faderGain:1},{timeFraction:.18,velocity:2.2,faderGain:0},{timeFraction:.21,velocity:2,faderGain:1},{timeFraction:.28,velocity:1.8,faderGain:0},{timeFraction:.31,velocity:1.5,faderGain:1},{timeFraction:.42,velocity:.5,faderGain:1},{timeFraction:.5,velocity:0,faderGain:1},{timeFraction:.65,velocity:-1,faderGain:1},{timeFraction:.9,velocity:-.3,faderGain:1}]},{name:"Laser",shortName:"Laser",durationBeats:null,durationMs:150,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeMs:0,velocity:5,faderGain:1},{timeMs:30,velocity:2.5,faderGain:1},{timeMs:60,velocity:.8,faderGain:1},{timeMs:90,velocity:.2,faderGain:1},{timeMs:110,velocity:-1,faderGain:0}]},{name:"Phaser",shortName:"Phasr",durationBeats:null,durationMs:120,loop:!0,quantize:!1,interpolateVelocity:!0,frames:[{timeMs:0,velocity:5,faderGain:1},{timeMs:20,velocity:2,faderGain:1},{timeMs:35,velocity:0,faderGain:1},{timeMs:55,velocity:0,faderGain:1},{timeMs:80,velocity:-.8,faderGain:0}]},{name:"Tweak",shortName:"Tweak",durationBeats:2,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,trueReverse:!1,frames:[{timeFraction:0,velocity:1,faderGain:1},{timeFraction:.12,velocity:1.5,faderGain:1},{timeFraction:.25,velocity:.6,faderGain:1},{timeFraction:.37,velocity:1.3,faderGain:1},{timeFraction:.5,velocity:.7,faderGain:1},{timeFraction:.62,velocity:1.6,faderGain:1},{timeFraction:.75,velocity:.5,faderGain:1},{timeFraction:.87,velocity:1.4,faderGain:1}]},{name:"Drag",shortName:"Drag",durationBeats:2,durationMs:null,loop:!0,quantize:!1,interpolateVelocity:!0,trueReverse:!1,frames:[{timeFraction:0,velocity:1,faderGain:1},{timeFraction:.2,velocity:.7,faderGain:1},{timeFraction:.4,velocity:.4,faderGain:1},{timeFraction:.6,velocity:.2,faderGain:1},{timeFraction:.75,velocity:.15,faderGain:1},{timeFraction:.9,velocity:.8,faderGain:1}]},{name:"Vibrato",shortName:"Vibr",durationBeats:null,durationMs:100,loop:!0,quantize:!1,interpolateVelocity:!0,trueReverse:!1,frames:[{timeMs:0,velocity:1.25,faderGain:1},{timeMs:25,velocity:.75,faderGain:1},{timeMs:50,velocity:1.25,faderGain:1},{timeMs:75,velocity:.75,faderGain:1}]}];const PP={"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125},_P=128;class OP{patternIntervalId=null;patternTimeoutId=null;patternFaderTimeoutId=null;getDeck;getEffectiveBPM;faderLFOTimeoutId=null;faderLFOActive=!1;currentLFODivision=null;scheduledLFOBPM=0;activePattern=null;patternElapsedMs=0;patternLastTick=0;patternDurationMs=0;pendingStop=!1;currentVelocity=0;currentFaderGain=1;onPatternEnd;constructor(e,t){this.getDeck=e,this.getEffectiveBPM=t}msUntilNextBeat(e){const t=this.getEffectiveBPM();if(t<30)return 0;const n=6e4/t,s="1/8"===e?n/2:n;let a=0;try{a=this.getDeck().replayer.getElapsedMs()}catch{return 0}const o=a%s,r=o<20?0:s-o;return Math.min(r,500)}play(e,t){this.stopPattern();const n=this.getEffectiveBPM();this.patternDurationMs=null!==e.durationBeats?6e4/n*e.durationBeats:e.durationMs??400;const s=()=>{this.activePattern=e,this.patternElapsedMs=0,this.patternLastTick=performance.now(),this._startPatternInterval()};if(e.quantize){const n=this.msUntilNextBeat(e.quantize);if(n>20)return t?.(n),void(this.patternTimeoutId=setTimeout(s,n))}s()}_startPatternInterval(){null!==this.patternIntervalId&&clearInterval(this.patternIntervalId),this.patternIntervalId=setInterval(()=>this._tickPattern(),10)}_tickPattern(){const e=this.activePattern;if(!e)return;const t=performance.now();if(this.patternElapsedMs+=t-this.patternLastTick,this.patternLastTick=t,this.patternElapsedMs>=this.patternDurationMs){if(!e.loop||this.pendingStop)return this.stopPattern(),void this.onPatternEnd?.();this.patternElapsedMs=this.patternElapsedMs%this.patternDurationMs}const n=e.frames,s=this.patternDurationMs,a=e=>void 0!==e.timeFraction?e.timeFraction*s:e.timeMs??0;let o=0;for(let l=n.length-1;l>=0;l--)if(this.patternElapsedMs>=a(n[l])){o=l;break}const r=n[o];let i;if(e.interpolateVelocity&&n.length>1){const e=(o+1)%n.length,t=n[e],l=a(r),c=(e>o?a(t):s)-l,u=c>0?Math.max(0,Math.min(1,(this.patternElapsedMs-l)/c)):0;i=r.velocity+(t.velocity-r.velocity)*u}else i=r.velocity;if(!1===e.trueReverse&&(i=Math.abs(i)),this.currentVelocity=i,e===SP||e===MP||e===CP){const t=6e4/this.getEffectiveBPM()/(e===CP?8:4),n=e===SP?.4:e===MP?.28:.2,s=this.patternElapsedMs%t;this.currentFaderGain=s<t*n?1:0}else if(this.faderLFOActive){const e=this.getEffectiveBPM(),t=this.currentLFODivision;if(t){const n=6e4/e*PP[t],s=this.patternElapsedMs%n;this.currentFaderGain=s<.5*n?1:0}}else this.currentFaderGain=r.faderGain;try{const t=this.getDeck();if(t.setScratchVelocity(i),e!==SP&&e!==MP&&e!==CP&&!this.faderLFOActive){const e=t.getChannelGainParam(),n=N().rawContext;e.cancelScheduledValues(n.currentTime),e.setValueAtTime(r.faderGain,n.currentTime)}}catch{}}stopPattern(){if(null!==this.patternTimeoutId&&(clearTimeout(this.patternTimeoutId),this.patternTimeoutId=null),null!==this.patternIntervalId&&(clearInterval(this.patternIntervalId),this.patternIntervalId=null),null!==this.patternFaderTimeoutId&&(clearTimeout(this.patternFaderTimeoutId),this.patternFaderTimeoutId=null),this.activePattern=null,this.patternElapsedMs=0,this.pendingStop=!1,this.currentVelocity=0,this.currentFaderGain=1,!this.faderLFOActive)try{const e=this.getDeck().getChannelGainParam(),t=N().rawContext;e.cancelScheduledValues(t.currentTime),e.setValueAtTime(1,t.currentTime)}catch{}}isPatternActive(){return null!==this.activePattern||null!==this.patternTimeoutId}isWaiting(){return null!==this.patternTimeoutId&&null===this.activePattern}finishCurrentCycle(){this.pendingStop=!0}startFaderLFO(e,t){this.stopFaderLFO(),this.faderLFOActive=!0,this.currentLFODivision=t,this.scheduledLFOBPM=e,this._scheduleFaderLFO(e,t)}_scheduleFaderLFO(e,t){try{const n=this.getDeck().getChannelGainParam(),s=N().rawContext,a=60/e*PP[t],o=s.currentTime,r=Math.round(16/PP[t]);n.cancelScheduledValues(o);for(let e=0;e<r;e++){const t=o+e*a;n.setValueAtTime(1,t),n.setValueAtTime(0,t+.5*a)}const i=r*a*1e3;this.faderLFOTimeoutId=setTimeout(()=>{this.faderLFOActive&&this.currentLFODivision===t&&this._scheduleFaderLFO(e,t)},Math.max(50,i-200))}catch{}}stopFaderLFO(){this.faderLFOActive=!1,this.currentLFODivision=null,null!==this.faderLFOTimeoutId&&(clearTimeout(this.faderLFOTimeoutId),this.faderLFOTimeoutId=null);try{const e=this.getDeck().getChannelGainParam(),t=N().rawContext;e.cancelScheduledValues(t.currentTime),e.linearRampToValueAtTime(1,t.currentTime+.02)}catch{}}onBPMChange(e){this.faderLFOActive&&null!==this.currentLFODivision&&Math.abs(e-this.scheduledLFOBPM)/this.scheduledLFOBPM>.02&&(null!==this.faderLFOTimeoutId&&(clearTimeout(this.faderLFOTimeoutId),this.faderLFOTimeoutId=null),this._scheduleFaderLFO(e,this.currentLFODivision),this.scheduledLFOBPM=e)}scheduleTransformerFader(e){null!==this.patternFaderTimeoutId&&(clearTimeout(this.patternFaderTimeoutId),this.patternFaderTimeoutId=null);try{const t=this.getDeck().getChannelGainParam(),n=N().rawContext,s=60/e/4,a=n.currentTime;t.cancelScheduledValues(a);for(let e=0;e<_P;e++){const n=a+e*s;t.setValueAtTime(1,n),t.setValueAtTime(0,n+.4*s)}const o=_P*s*1e3;this.patternFaderTimeoutId=setTimeout(()=>{this.patternFaderTimeoutId=null,this.activePattern===SP&&this.scheduleTransformerFader(this.getEffectiveBPM())},Math.max(50,o-300))}catch{}}scheduleCrabFader(e){null!==this.patternFaderTimeoutId&&(clearTimeout(this.patternFaderTimeoutId),this.patternFaderTimeoutId=null);try{const t=this.getDeck().getChannelGainParam(),n=N().rawContext,s=60/e/4,a=n.currentTime;t.cancelScheduledValues(a);for(let e=0;e<_P;e++){const n=a+e*s;t.setValueAtTime(1,n),t.setValueAtTime(0,n+.28*s)}const o=_P*s*1e3;this.patternFaderTimeoutId=setTimeout(()=>{this.patternFaderTimeoutId=null,this.activePattern===MP&&this.scheduleCrabFader(this.getEffectiveBPM())},Math.max(50,o-300))}catch{}}scheduleEightFingerCrabFader(e){null!==this.patternFaderTimeoutId&&(clearTimeout(this.patternFaderTimeoutId),this.patternFaderTimeoutId=null);try{const t=this.getDeck().getChannelGainParam(),n=N().rawContext,s=60/e/8,a=n.currentTime;t.cancelScheduledValues(a);for(let e=0;e<_P;e++){const n=a+e*s;t.setValueAtTime(1,n),t.setValueAtTime(0,n+.2*s)}const o=_P*s*1e3;this.patternFaderTimeoutId=setTimeout(()=>{this.patternFaderTimeoutId=null,this.activePattern===CP&&this.scheduleEightFingerCrabFader(this.getEffectiveBPM())},Math.max(50,o-300))}catch{}}dispose(){this.stopPattern(),this.stopFaderLFO()}}const TP=2*Math.PI*33.333/60,LP=.02025;class AP{_omega=TP;_motorPlatterOmega=TP;_theta=0;_touching=!1;_handOmega=0;_motorEnabled=!0;_targetOmega=TP;_I=LP;_impulse=0;_spinbackActive=!1;_spinbackWentReverse=!1;_onSpinbackComplete=null;_powerCutActive=!1;_onPowerCutComplete=null;_releaseElapsed=-1;get _inReleaseRamp(){return this._releaseElapsed>=0&&this._releaseElapsed<.6}get omega(){return this._omega}get playbackRate(){return this._omega/TP}get touching(){return this._touching}get motorEnabled(){return this._motorEnabled}get spinbackActive(){return this._spinbackActive}get powerCutActive(){return this._powerCutActive}get theta(){return this._theta}setMass(e){const t=Math.max(0,Math.min(1,e));this._I=.005*Math.pow(12,t)}setTargetSpeed(e){this._targetOmega=TP*e}setMotorEnabled(e){this._motorEnabled=e}applyImpulse(e){this._impulse+=e}setTouching(e){this._touching&&!e&&(this._releaseElapsed=0),e&&(this._releaseElapsed=-1),this._touching=e,e||(this._handOmega=0)}setHandVelocity(e){this._handOmega=e}triggerSpinback(e){this._spinbackActive=!0,this._spinbackWentReverse=!1,this._powerCutActive=!1,this._motorEnabled=!0,this._onSpinbackComplete=e??null;const t=this._omega>=0?-1:1;this._impulse+=.3*t}triggerPowerCut(e){this._powerCutActive=!0,this._spinbackActive=!1,this._spinbackWentReverse=!1,this._motorEnabled=!1,this._onPowerCutComplete=e??null}reset(){this._omega=TP,this._motorPlatterOmega=TP,this._theta=0,this._touching=!1,this._handOmega=0,this._motorEnabled=!0,this._impulse=0,this._spinbackActive=!1,this._spinbackWentReverse=!1,this._onSpinbackComplete=null,this._powerCutActive=!1,this._onPowerCutComplete=null,this._releaseElapsed=-1}tick(e){const t=Math.min(e,.05);if(this._motorEnabled){const e=this._targetOmega-this._motorPlatterOmega,n=this._spinbackActive?20:8,s=(Math.max(-.147,Math.min(.147,e*n*(this._I/LP)))+-.008*this._motorPlatterOmega)/this._I;this._motorPlatterOmega+=s*t,this._motorPlatterOmega=Math.max(0,Math.min(4*TP,this._motorPlatterOmega))}else{const e=-.004*this._motorPlatterOmega,n=this._motorPlatterOmega>0?-.001:0;this._motorPlatterOmega+=(e+n)/this._I*t,this._motorPlatterOmega<0&&(this._motorPlatterOmega=0)}let n=0;const s=this._motorPlatterOmega-this._omega,a=Math.abs(s);let o;if(this._touching)o=3.5;else if(this._inReleaseRamp){const e=Math.min(1,this._releaseElapsed/.6);o=3.5+10.5*(e*e*(3-2*e))}else o=a<.15?8:14;n+=s*o*this._I;const r=this._spinbackActive?2:this._powerCutActive?.5:1;if(n+=-.008*r*this._omega+-5e-4*r*this._omega*Math.abs(this._omega),this._powerCutActive&&0!==this._omega){n+=.001*(this._omega>0?-1:1)}if(this._touching){n+=80*(this._handOmega-this._omega)*this._I}0!==this._impulse&&(n+=this._impulse/t,this._impulse=0);const i=n/this._I;if(this._omega+=i*t,this._omega=Math.max(-4*TP,Math.min(4*TP,this._omega)),this._releaseElapsed>=0&&(this._releaseElapsed+=t,this._releaseElapsed>=.6&&(this._releaseElapsed=-1)),this._theta+=this._omega*t,this._theta>=2*Math.PI&&(this._theta-=2*Math.PI),this._theta<0&&(this._theta+=2*Math.PI),this._spinbackActive&&(this._omega<-1*TP&&(this._omega=-1*TP),this._omega<.05*-TP&&(this._spinbackWentReverse=!0),this._spinbackWentReverse&&this._omega>0&&Math.abs(this._omega-this._targetOmega)<.05*TP&&(this._spinbackActive=!1,this._spinbackWentReverse=!1,this._omega=this._targetOmega,this._onSpinbackComplete))){const e=this._onSpinbackComplete;this._onSpinbackComplete=null,e()}if(this._powerCutActive&&(this._omega<0&&(this._omega=0),this._omega<.01*TP&&(this._powerCutActive=!1,this._omega=0,this._onPowerCutComplete))){const e=this._onPowerCutComplete;this._onPowerCutComplete=null,e()}return this._omega/TP}static deltaToImpulse(e,t=0){let n=e;return 1===t&&(n*=40),2===t&&(n*=800),15e-5*n*LP}static deltaToAngularVelocity(e,t){if(t<=0)return 0;return e/t/300*TP}static midiJogToAngularVelocity(e){let t;return t=e<=63?e/32:-(128-e)/32,t*TP}static midiJogToImpulse(e){let t;return t=e<=63?e/63:-(128-e)/63,.003*t*LP}}const BP=TP;class IP{physics=new AP;_isActive=!1;lastEventTime=0;rafId=null;lastTickTime=0;scratchBuffer=null;scratchBufferReady=!1;_accelerationEnabled=!0;originalGainValue=1;originalSmoothScrolling=!1;lastExitTime=0;grabLastY=0;grabLastTime=0;get isActive(){return this._isActive}get accelerationEnabled(){return this._accelerationEnabled}set accelerationEnabled(e){this._accelerationEnabled=e}get turntable(){return this.physics}async initScratchBuffer(){if(this.scratchBufferReady)return;const e=N().rawContext;this.scratchBuffer=new DP(e,0),await this.scratchBuffer.init();const t=pD(),n=Bw(),s=co(t.getMasterGain()),a=co(n.masterInput);s&&a&&(s.connect(this.scratchBuffer.captureNode),this.scratchBuffer.playbackGain.connect(a),this.scratchBufferReady=!0)}onScrollDelta(e,t,n=0){const s=Math.abs(e);if(!this._isActive&&s<3)return!1;if(!this._isActive&&t-this.lastExitTime<1500)return!1;if(this._isActive&&t-this.lastEventTime>300)return!0;const a=pD();this._isActive||this.enterScratchMode(a),s>=10&&(this.lastEventTime=t),this._accelerationEnabled=LN.getState().scratchAcceleration;const o=AP.deltaToImpulse(e,n),r=this._accelerationEnabled?o:1.5*o;return this.physics.applyImpulse(r),!0}isGrabTouch(e){try{if(!pD().isPlaying())return!1}catch{return!1}return e>=3}onGrabStart(e,t){const n=pD();return!!n.isPlaying()&&(this._isActive||this.enterScratchMode(n),this.lastEventTime=t,this.grabLastY=e,this.grabLastTime=t,this.physics.setTouching(!0),this.physics.setHandVelocity(0),!0)}onGrabMove(e,t){if(!this._isActive||!this.physics.touching)return;this.lastEventTime=t;const n=e-this.grabLastY,s=Math.max(.001,(t-this.grabLastTime)/1e3);this.grabLastY=e,this.grabLastTime=t;const a=AP.deltaToAngularVelocity(n,s);this.physics.setHandVelocity(a)}onGrabEnd(e){this.physics.touching&&(this.lastEventTime=e,this.physics.setTouching(!1))}onMidiJogTouch(e){const t=pD();t.isPlaying()&&(!this._isActive&&e&&this.enterScratchMode(t),this.lastEventTime=performance.now(),this.physics.setTouching(e),e&&this.physics.setHandVelocity(0))}onMidiJogSpin(e,t){const n=pD();if(n.isPlaying())if(this._isActive||this.enterScratchMode(n),this.lastEventTime=performance.now(),t){const t=AP.midiJogToAngularVelocity(e);this.physics.setHandVelocity(t)}else{const t=AP.midiJogToImpulse(e);this.physics.applyImpulse(t)}}triggerSpinback(){const e=pD();e.isPlaying()&&(this._isActive||this.enterScratchMode(e),this.physics.triggerSpinback())}triggerPowerCut(){const e=pD();e.isPlaying()&&(this._isActive||this.enterScratchMode(e),this.physics.triggerPowerCut(()=>{this.exitScratchModeAndStop()}))}exitScratchModeAndStop(){this._isActive=!1,this.lastExitTime=performance.now(),this.stopPhysicsLoop(),this.scratchBuffer&&(this.scratchBuffer.silenceAndStop(),this.scratchBuffer.unfreezeCapture());const e=pD();e.getMasterGain().gain.rampTo(this.originalGainValue,.01),e.stop(),jN.getState().stop(),Bw().stop(),this.physics.reset(),jN.getState().setSmoothScrolling(this.originalSmoothScrolling)}enterScratchMode(e){this._isActive=!0,this.originalGainValue=1,this.lastEventTime=performance.now();const t=jN.getState();this.originalSmoothScrolling=t.smoothScrolling,t.smoothScrolling||t.setSmoothScrolling(!0);const n=LN.getState().platterMass;"number"==typeof n&&this.physics.setMass(n),this.scratchBufferReady?this.engageScratchAudio(e):this.initScratchBuffer().then(()=>{this._isActive&&this.scratchBuffer&&this.engageScratchAudio(e)}),this.startPhysicsLoop()}engageScratchAudio(e){if(!this.scratchBufferReady||!this.scratchBuffer)return;const t=this.physics.playbackRate;this.scratchBuffer.startScratch(t),this.scratchBuffer.snapScratchRate(t);const n=N().rawContext.currentTime,s=e.getMasterGain().gain;s.cancelScheduledValues(n),s.setValueAtTime(0,n),e.setSuppressNotes(!0),e.setTempoMultiplier(.001),e.setPitchMultiplier(.001)}static EXIT_CROSSFADE_SEC=.15;exitScratchMode(e){this._isActive=!1,this.lastExitTime=performance.now(),this.stopPhysicsLoop();const t=IP.EXIT_CROSSFADE_SEC,n=1e3*t;e.resyncSchedulerToNow(),e.setTempoMultiplier(1),e.setPitchMultiplier(1),e.setSuppressNotes(!1);const s=e.getMasterGain();if(s&&(s.gain.value=this.originalGainValue),this.scratchBuffer&&this.scratchBufferReady){this.scratchBuffer.setScratchRate(1);const e=this.scratchBuffer.ctx.currentTime,s=this.scratchBuffer.playbackGain.gain;s.cancelScheduledValues(e),s.setValueAtTime(s.value,e),s.linearRampToValueAtTime(0,e+t),setTimeout(()=>{this.scratchBuffer&&(this.scratchBuffer.playbackNode.port.postMessage({type:"stop"}),this.scratchBuffer.unfreezeCapture())},n+10)}this.physics.reset(),jN.getState().setSmoothScrolling(this.originalSmoothScrolling)}startPhysicsLoop(){if(null!==this.rafId)return;this.lastTickTime=performance.now();const e=t=>{if(!this._isActive)return void(this.rafId=null);const n=(t-this.lastTickTime)/1e3;this.lastTickTime=t;const s=this.physics.tick(n);this.applyPlaybackRate(s);if(t-this.lastEventTime>300&&!this.physics.touching&&!this.physics.spinbackActive&&!this.physics.powerCutActive){const e=pD();return void this.exitScratchMode(e)}this.rafId=requestAnimationFrame(e)};this.rafId=requestAnimationFrame(e)}stopPhysicsLoop(){null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}applyPlaybackRate(e){this.scratchBufferReady&&this.scratchBuffer&&this.scratchBuffer.setScratchRate(e)}_faderCutActive=!1;get faderCutActive(){return this._faderCutActive}setFaderCut(e){if(this._faderCutActive!==e){this._faderCutActive=e;try{const t=pD(),n=N().rawContext,s=co(t.getMasterGain());if(!s)return;const a=s.gain;a.cancelScheduledValues(n.currentTime),a.setValueAtTime(e?0:1,n.currentTime)}catch{}}}faderPatternTimerId=null;_activePatternName=null;patternElapsedMs=0;patternStartTime=0;get activePatternName(){return this._activePatternName}startFaderPattern(e){if(this._activePatternName===e)return;null!==this._activePatternName&&this.stopFaderPattern();const t=VP.find(t=>t.name===e);t&&(this._activePatternName=e,this.patternElapsedMs=0,this.patternStartTime=performance.now(),"Transformer"!==e&&"Crab"!==e&&"8-Finger Crab"!==e?this.faderPatternTimerId=setInterval(()=>{this.tickFaderPattern(t)},10):this.scheduleChopPattern(t))}stopFaderPattern(){this._activePatternName=null,this.patternElapsedMs=0,null!==this.faderPatternTimerId&&(clearInterval(this.faderPatternTimerId),this.faderPatternTimerId=null);try{const e=N().rawContext,t=co(pD().getMasterGain());if(t){const n=t.gain;n.cancelScheduledValues(e.currentTime),n.setValueAtTime(1,e.currentTime)}}catch{}}toggleFaderPattern(e){this._activePatternName===e?this.stopFaderPattern():this.startFaderPattern(e)}tickFaderPattern(e){const t=performance.now();let n;if(this.patternElapsedMs=t-this.patternStartTime,null!==e.durationMs)n=e.durationMs;else if(null!==e.durationBeats){let t=125;try{t=k().bpm.value||125}catch{}n=6e4/t*e.durationBeats}else n=500;const s=this.patternElapsedMs%n,a=s/n,o=this.interpolateFaderGain(e,a,s,n);try{const e=N().rawContext,t=co(pD().getMasterGain());if(t){const n=t.gain;n.cancelScheduledValues(e.currentTime),n.setValueAtTime(o,e.currentTime)}}catch{}}interpolateFaderGain(e,t,n,s){const a=e.frames;if(0===a.length)return 1;let o=a[0],r=a[0];for(let i=0;i<a.length;i++){const e=a[i];(e.timeFraction??(null!=e.timeMs?e.timeMs/s:0))<=t&&(o=e,r=a[(i+1)%a.length],r.timeFraction??(null==r.timeMs||r.timeMs))}return o.faderGain}scheduleChopPattern(e){try{const t=N().rawContext,n=co(pD().getMasterGain());if(!n)return;const s=n.gain;s.cancelScheduledValues(t.currentTime);let a=4,o=.5;"Crab"===e.name?(a=4,o=.6):"8-Finger Crab"===e.name&&(a=8,o=.2);let r=125;try{r=k().bpm.value||125}catch{}const i=60/r/a,l=i*o,c=i-l,u=128;let d=t.currentTime;for(let e=0;e<u;e++)s.setValueAtTime(1,d),s.setValueAtTime(0,d+l),d+=l+c;const m=u*i*1e3-300;this.faderPatternTimerId=setTimeout(()=>{this._activePatternName===e.name&&this.scheduleChopPattern(e)},m)}catch{}}forceStop(){if(null!==this._activePatternName&&this.stopFaderPattern(),this._faderCutActive&&this.setFaderCut(!1),!this._isActive)return;const e=pD();this.exitScratchMode(e)}dispose(){this.forceStop(),this.scratchBuffer&&(this.scratchBuffer.dispose(),this.scratchBuffer=null,this.scratchBufferReady=!1)}}let FP=null;function UP(){return FP||(FP=new IP,os(async()=>{const{useTransportStore:e}=await Promise.resolve().then(()=>XN);return{useTransportStore:e}},void 0).then(({useTransportStore:e})=>{e.subscribe((e,t)=>{t.isPlaying&&!e.isPlaying&&FP?.forceStop()})})),FP}class RP{static generateReverseVisual(e,t,n){if(0===e.length)return{commands:[],patternOrderEntries:[],warnings:["No notes to reverse"],success:!1,patternOrderSlotsUsed:0};const s=[...e].sort((e,t)=>e.originalRow-t.originalRow),a=Math.floor(n/(e.length+1)),o=[],r=[];return s.forEach((e,t)=>{const i=n-a*(t+1);if(o.push({row:i,channel:e.originalChannel,cell:{...e.cell}}),t<s.length-1){const s=n-a*(t+2),o=16*Math.floor(s/10)+s%10;r.push({row:i,channel:e.originalChannel,effTyp:13,eff:o})}else r.push({row:i,channel:e.originalChannel,effTyp:13,eff:0})}),{commands:r,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:o,commands:r,length:n},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generatePolyrhythm(e,t,n,s){const a=[],o=[];if(e.length!==t.length)return{commands:[],patternOrderEntries:[],warnings:["Channel count must match loop length count"],success:!1,patternOrderSlotsUsed:0};for(let r=0;r<t.length;r++)(t[r]<1||t[r]>15)&&(a.push(`Channel ${e[r]}: Loop count ${t[r]} out of range (1-15), clamping`),t[r]=Math.max(1,Math.min(15,t[r])));return e.forEach((e,a)=>{o.push({row:n,channel:e,effTyp:14,eff:96}),o.push({row:s,channel:e,effTyp:14,eff:96|t[a]})}),{commands:o,patternOrderEntries:[],warnings:a,success:!0,patternOrderSlotsUsed:0}}static canInsertCommand(e){return 0===e.effTyp?{canInsert:!0,useSecondColumn:!1}:0===e.effTyp2?{canInsert:!0,useSecondColumn:!0}:{canInsert:!1,useSecondColumn:!1}}static generateFibonacciSequence(e,t,n,s){const a=[],o=[],r=[],i=[],l=[1,1];for(;l[l.length-1]+l[l.length-2]<n;)l.push(l[l.length-1]+l[l.length-2]);const c=[];let u=t;for(const d of l){if(u+=d,u>=n)break;c.push(u)}return 0===c.length?(i.push("Pattern too short for Fibonacci sequence"),{commands:[],patternOrderEntries:[],warnings:i,success:!1,patternOrderSlotsUsed:0}):(s.forEach(e=>{c.forEach((t,n)=>{if(r.push({row:t,channel:e.channel,cell:e.cell}),n<c.length-1){const s=c[n+1],a=16*Math.floor(s/10)+s%10;o.push({row:t,channel:e.channel,effTyp:13,eff:a})}else o.push({row:t,channel:e.channel,effTyp:13,eff:0})})}),a.push({patternIndex:e}),{commands:o,patternOrderEntries:a,warnings:i,success:!0,helperPattern:{notes:r,commands:o,length:n},patternOrderSlotsUsed:1})}static generateEuclideanPattern(e,t,n,s,a,o){const r=[],i=[],l=[],c=[];t>n&&(c.push("Pulses cannot exceed steps, clamping"),t=n);const u=[],d=[];let m=n-t;d[0]=t;let p=0;for(;d[p]>1;)u[p]=Math.floor(m/d[p]),d[p+1]=m%d[p],m=d[p],p++;u[p]=m;const h=e=>{if(-1===e)return[!1];if(-2===e)return[!0];const t=[];for(let n=0;n<u[e];n++)t.push(...h(e-1));return 0!==d[e]&&t.push(...h(e-2)),t},f=h(p),g=[];return f.forEach((e,t)=>{e&&g.push(s+t*a)}),0===g.length?(c.push("No pulses generated"),{commands:[],patternOrderEntries:[],warnings:c,success:!1,patternOrderSlotsUsed:0}):(o.forEach(e=>{g.forEach((t,n)=>{if(l.push({row:t,channel:e.channel,cell:e.cell}),n<g.length-1){const s=g[n+1],a=16*Math.floor(s/10)+s%10;i.push({row:t,channel:e.channel,effTyp:13,eff:a})}else i.push({row:t,channel:e.channel,effTyp:13,eff:0})})}),r.push({patternIndex:e}),{commands:i,patternOrderEntries:r,warnings:c,success:!0,helperPattern:{notes:l,commands:i,length:s+n*a},patternOrderSlotsUsed:1})}static generatePingPong(e,t,n){if(e.length<2)return{commands:[],patternOrderEntries:[],warnings:["Need at least 2 notes for Ping-Pong"],success:!1,patternOrderSlotsUsed:0};const s=[...e].sort((e,t)=>e.originalRow-t.originalRow),a=[],o=[];s.forEach((e,t)=>{a.push({row:t,channel:e.channel,cell:e.cell});const n=t+1,s=16*Math.floor(n/10)+n%10;o.push({row:t,channel:e.channel,effTyp:13,eff:s})});let r=s.length;for(let i=s.length-2;i>0;i--){const e=s[i];a.push({row:r,channel:e.channel,cell:e.cell});const t=r+1,n=16*Math.floor(t/10)+t%10;o.push({row:r,channel:e.channel,effTyp:13,eff:n}),r++}return o[o.length-1].eff=0,{commands:o,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:a,commands:o,length:r},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generateGlitch(e,t,n){if(0===e.length)return{commands:[],patternOrderEntries:[],warnings:["No notes"],success:!1,patternOrderSlotsUsed:0};const s=[...e].sort(()=>Math.random()-.5),a=[],o=[];return s.forEach((e,t)=>{const n=4*t;if(a.push({row:n,channel:e.channel,cell:e.cell}),t<s.length-1){const s=4*(t+1),a=16*Math.floor(s/10)+s%10;o.push({row:n,channel:e.channel,effTyp:13,eff:a})}else o.push({row:n,channel:e.channel,effTyp:13,eff:0})}),{commands:o,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:a,commands:o,length:4*s.length},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generateStrobe(e,t,n){const s=[],a=[];return e.forEach((t,n)=>{const o=2*n;if(s.push({row:o,channel:t.channel,cell:t.cell}),n<e.length-1){const e=2*(n+1),s=16*Math.floor(e/10)+e%10;a.push({row:o,channel:t.channel,effTyp:13,eff:s})}else a.push({row:o,channel:t.channel,effTyp:13,eff:0})}),{commands:a,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:s,commands:a,length:2*e.length},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generateVisualEcho(e,t,n,s=3){const a=[],o=[];return e.forEach((t,n)=>{for(let r=0;n*(s+1)+r<256&&r<=s;r++){const i=n*(s+1)+r,l={...t.cell},c=l.volume>=16&&l.volume<=80?l.volume-16:64,u=Math.floor(c*Math.pow(.5,r));l.volume=16+u,a.push({row:i,channel:t.channel,cell:l});const d=r===s||n*(s+1)+r===255,m=n===e.length-1;if(d&&m)o.push({row:i,channel:t.channel,effTyp:13,eff:0});else{const e=i+1,n=16*Math.floor(e/10)+e%10;o.push({row:i,channel:t.channel,effTyp:13,eff:n})}}}),{commands:o,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:a,commands:o,length:Math.min(256,e.length*(s+1))},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generateConverge(e,t,n){const s=[],a=[],o=[...e].sort((e,t)=>e.originalRow-t.originalRow);return o.forEach((e,t)=>{const r=t%2==0?t:n-1-t;if(s.push({row:r,channel:e.channel,cell:e.cell}),t<o.length-1){const s=(t+1)%2==0?t+1:n-1-(t+1),o=16*Math.floor(s/10)+s%10;a.push({row:r,channel:e.channel,effTyp:13,eff:o})}else a.push({row:r,channel:e.channel,effTyp:13,eff:0})}),{commands:a,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:s,commands:a,length:n},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generateSpiral(e,t,n){const s=[],a=[],o=[...e].sort((e,t)=>e.originalRow-t.originalRow),r=Math.floor(n/2);return o.forEach((e,t)=>{const i=Math.floor((t+1)/2)*(t%2==0?1:-1),l=Math.max(0,Math.min(n-1,r+i));if(s.push({row:l,channel:e.channel,cell:e.cell}),t<o.length-1){const s=Math.floor((t+2)/2)*((t+1)%2==0?1:-1),o=Math.max(0,Math.min(n-1,r+s)),i=16*Math.floor(o/10)+o%10;a.push({row:l,channel:e.channel,effTyp:13,eff:i})}else a.push({row:l,channel:e.channel,effTyp:13,eff:0})}),{commands:a,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:s,commands:a,length:n},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generateBounce(e,t,n){const s=[],a=[];return e.forEach((t,o)=>{const r=Math.abs(o%(2*n)-n);if(s.push({row:r,channel:t.channel,cell:t.cell}),o<e.length-1){const e=Math.abs((o+1)%(2*n)-n),s=16*Math.floor(e/10)+e%10;a.push({row:r,channel:t.channel,effTyp:13,eff:s})}else a.push({row:r,channel:t.channel,effTyp:13,eff:0})}),{commands:a,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:s,commands:a,length:n},warnings:[],success:!0,patternOrderSlotsUsed:1}}static generateChaos(e,t,n){const s=[],a=[];return e.forEach((t,o)=>{const r=Math.floor(Math.random()*n);if(s.push({row:r,channel:t.channel,cell:t.cell}),o<e.length-1){const e=Math.floor(Math.random()*n),s=16*Math.floor(e/10)+e%10;a.push({row:r,channel:t.channel,effTyp:13,eff:s})}else a.push({row:r,channel:t.channel,effTyp:13,eff:0})}),{commands:a,patternOrderEntries:[{patternIndex:t}],helperPattern:{notes:s,commands:a,length:n},warnings:[],success:!0,patternOrderSlotsUsed:1}}}class jP{static insertCommand(e,t,n){const{canInsert:s,useSecondColumn:a}=RP.canInsertCommand(e);return s?(a?(e.effTyp2=t,e.eff2=n):(e.effTyp=t,e.eff=n),{success:!0}):{success:!1,error:"Both effect columns occupied"}}static validateNoInfiniteLoops(e){const t=e.filter(e=>11===e.effTyp);if(0===t.length)return{valid:!0};if(t.filter(e=>0===e.eff).length>0)return{valid:!1,error:"B command jumps to order position 0  song will loop from the beginning indefinitely"};const n=new Map;for(const s of t)n.has(s.channel)||n.set(s.channel,[]),n.get(s.channel).push(s);for(const[,s]of n)if(s.length>1)return{valid:!1,error:`Channel ${s[0].channel} has ${s.length} B commands  only the first reached will execute`};return{valid:!0}}}class XP{static createReverseOrderSequence(e,t){return[...t].sort((e,t)=>t-e).map(t=>({patternIndex:e,startRow:t}))}static createPingPongSequence(e,t,n){const s=[],a=[...t].sort((e,t)=>e-t);for(let o=0;o<n;o++){a.forEach(t=>{s.push({patternIndex:e,startRow:t})});for(let t=a.length-2;t>0;t--)s.push({patternIndex:e,startRow:a[t]})}return s}static estimateOrderSlots(e){return e.length}static canFitInPatternOrder(e,t,n=256){const s=n-e;return{fits:t<=s,slotsNeeded:t,slotsAvailable:s}}}const zP={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0},GP=()=>{const e=ID(),{patterns:t,patternOrder:n,setCell:s,addToOrder:a,setCurrentPosition:o}=e,{setStatusMessage:r}=LN.getState(),i=l.useCallback(e=>{const n=t[0]?.channels.length||4,s={id:`pattern-helper-${Date.now()}-${Math.floor(1e3*Math.random())}`,name:"B/D Animation Helper",length:e.length,channels:Array.from({length:n},(t,n)=>({id:`channel-${n}-${Date.now()}`,name:`Channel ${n+1}`,rows:Array.from({length:e.length},()=>({...zP})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))};e.notes.forEach(({row:e,channel:t,cell:n})=>{s.channels[t]&&(s.channels[t].rows[e]={...n})}),e.commands.forEach(({row:e,channel:t,effTyp:n,eff:a})=>{if(s.channels[t]){const o=s.channels[t].rows[e];jP.insertCommand(o,n,a)}});const a=t.length;return ID.setState(e=>{e.patterns.push(s)}),a},[t]),c=l.useCallback(e=>{const{patternIndex:n,channelIndex:s,startRow:a,endRow:o}=e,r=t[n];if(!r)return[];const i=[],l=r.channels[s];if(!l)return[];for(let t=a;t<=o;t++){const e=l.rows[t];e&&e.note>0&&e.note<97&&i.push({originalRow:t,originalChannel:s,channel:s,cell:{...e},timing:t})}return i},[t]),u=l.useCallback((e,t)=>{let n=0;const a=ID.getState().patterns[t];return a?(e.forEach(e=>{const t=a.channels[e.channel];if(!t)return;const o=t.rows[e.row];if(!o)return;const r={...o};jP.insertCommand(r,e.effTyp,e.eff).success?(s(e.channel,e.row,r),n++):0}),n):0},[s]),d=l.useCallback((e,t)=>{let s=e[0]?.patternIndex;t&&(s=i(t));const r=n.length;return e.forEach(()=>{a(s)}),o(r),e.length},[a,i,n.length,o]);return{applyReverseVisual:l.useCallback(e=>{const n=c(e);if(0===n.length)return r("No notes to reverse"),!1;const s=t[e.patternIndex];if(!s)return r("Pattern not found"),!1;const a=RP.generateReverseVisual(n,e.patternIndex,s.length);return a.success?(d(a.patternOrderEntries,a.helperPattern),r("REVERSE VISUAL: Created animation pattern at end of song"),!0):(r(a.warnings.join(", ")||"Failed to generate reverse animation"),!1)},[c,t,d]),applyPolyrhythm:l.useCallback((e,t,n,s,a)=>{const o=RP.generatePolyrhythm(t,n,s,a);if(!o.success)return r(o.warnings.join(", ")||"Failed to generate polyrhythm"),!1;const i=u(o.commands,e);return r(`POLYRHYTHM: Applied ${i} loop commands (${n.join(":")} ratio)`),!0},[u]),applyFibonacciSequence:l.useCallback(e=>{const n=c(e);if(0===n.length)return r("No notes for Fibonacci sequence"),!1;const s=t[e.patternIndex];if(!s)return r("Pattern not found"),!1;const a=RP.generateFibonacciSequence(e.patternIndex,e.startRow,s.length,n);return a.success?(d(a.patternOrderEntries,a.helperPattern),r("FIBONACCI: Created animation pattern at end of song"),!0):(r(a.warnings.join(", ")||"Failed to generate Fibonacci sequence"),!1)},[c,t,d]),applyEuclideanPattern:l.useCallback((e,t,n,s=4)=>{const a=c(e);if(0===a.length)return r("No notes for Euclidean pattern"),!1;const o=RP.generateEuclideanPattern(e.patternIndex,t,n,e.startRow,s,a);return o.success?(d(o.patternOrderEntries,o.helperPattern),r(`EUCLIDEAN [${t},${n}]: Created animation pattern at end of song`),!0):(r(o.warnings.join(", ")||"Failed to generate Euclidean pattern"),!1)},[c,d]),applyPingPong:l.useCallback(e=>{const n=c(e),s=RP.generatePingPong(n,e.patternIndex,t[e.patternIndex]?.length||64);return s.success?(d(s.patternOrderEntries,s.helperPattern),r("PING-PONG: Created animation pattern"),!0):(r(s.warnings[0]),!1)},[c,t,d]),applyGlitch:l.useCallback(e=>{const n=c(e),s=RP.generateGlitch(n,e.patternIndex,t[e.patternIndex]?.length||64);return s.success?(d(s.patternOrderEntries,s.helperPattern),r("GLITCH: Created animation pattern"),!0):(r(s.warnings[0]),!1)},[c,t,d]),applyStrobe:l.useCallback(e=>{const n=c(e),s=RP.generateStrobe(n,e.patternIndex,t[e.patternIndex]?.length||64);return d(s.patternOrderEntries,s.helperPattern),r("STROBE: Created animation pattern"),!0},[c,t,d]),applyVisualEcho:l.useCallback(e=>{const n=c(e),s=RP.generateVisualEcho(n,e.patternIndex,t[e.patternIndex]?.length||64);return d(s.patternOrderEntries,s.helperPattern),r("VISUAL ECHO: Created animation pattern"),!0},[c,t,d]),applyConverge:l.useCallback(e=>{const n=c(e),s=RP.generateConverge(n,e.patternIndex,t[e.patternIndex]?.length||64);return d(s.patternOrderEntries,s.helperPattern),r("CONVERGE: Created animation pattern"),!0},[c,t,d]),applySpiral:l.useCallback(e=>{const n=c(e),s=RP.generateSpiral(n,e.patternIndex,t[e.patternIndex]?.length||64);return d(s.patternOrderEntries,s.helperPattern),r("SPIRAL: Created animation pattern"),!0},[c,t,d]),applyBounce:l.useCallback(e=>{const n=c(e),s=RP.generateBounce(n,e.patternIndex,t[e.patternIndex]?.length||64);return d(s.patternOrderEntries,s.helperPattern),r("BOUNCE: Created animation pattern"),!0},[c,t,d]),applyChaos:l.useCallback(e=>{const n=c(e),s=RP.generateChaos(n,e.patternIndex,t[e.patternIndex]?.length||64);return d(s.patternOrderEntries,s.helperPattern),r("CHAOS: Created animation pattern"),!0},[c,t,d]),canApplyAnimation:l.useCallback(e=>{const t=XP.canFitInPatternOrder(n.length,e);return t.fits?{can:!0}:{can:!1,message:`Not enough pattern order slots. Need ${t.slotsNeeded}, have ${t.slotsAvailable}`}},[n]),collectNotes:c}},HP=["pattern","spectrumBars","circularSpectrum","waveformTerrain","plasmaField","starfield","particleBurst","amLED","amBars","amMirror","amGraphLine","amRadial","amRadialGraph","amStereo","amLumi","amAlpha","amOutline","amDualVert","amDualOverlay","amBark","amMel","amOctave","amNotes","amMirrorReflex","amRadialInvert","amRadialLED","amLinear","amAWeighted","amLumiMirror"],WP={pattern:"PATTERN",spectrumBars:"SPECTRUM",circularSpectrum:"RADIAL",waveformTerrain:"TERRAIN",plasmaField:"PLASMA",starfield:"STARFIELD",particleBurst:"PARTICLES",amLED:"LED BARS",amBars:"SMOOTH BARS",amMirror:"MIRROR BARS",amGraphLine:"GRAPH LINE",amRadial:"RADIAL SPIN",amRadialGraph:"RADIAL GRAPH",amStereo:"DUAL STEREO",amLumi:"LUMI BARS",amAlpha:"GHOST BARS",amOutline:"OUTLINE",amDualVert:"DUAL VERTICAL",amDualOverlay:"DUAL OVERLAY",amBark:"BARK",amMel:"MEL GRAPH",amOctave:"OCTAVE BANDS",amNotes:"NOTE LABELS",amMirrorReflex:"MIRROR REFLEX",amRadialInvert:"RADIAL INVERT",amRadialLED:"RADIAL LED",amLinear:"LINEAR",amAWeighted:"A-WEIGHTED",amLumiMirror:"LUMI MIRROR"},qP={amLED:"ledBars",amBars:"smoothBars",amMirror:"mirrorBars",amGraphLine:"graphLine",amRadial:"radialSpectrum",amRadialGraph:"radialGraph",amStereo:"dualStereo",amLumi:"lumiBars",amAlpha:"alphaBars",amOutline:"outlineBars",amDualVert:"dualVertical",amDualOverlay:"dualOverlay",amBark:"barkSpectrum",amMel:"melGraph",amOctave:"octaveBands",amNotes:"noteLabels",amMirrorReflex:"mirrorReflex",amRadialInvert:"radialInvert",amRadialLED:"radialLED",amLinear:"linearBars",amAWeighted:"aWeighted",amLumiMirror:"lumiMirror"};function KP(e){return e.startsWith("am")}function $P(){const e=[];for(let t=0;t<300;t++)e.push({x:2*(Math.random()-.5),y:2*(Math.random()-.5),z:Math.random(),speed:.002+.005*Math.random(),prevX:0,prevY:0});return{smoothedBars:new Float32Array(64),peakHold:new Float32Array(64),peakDecay:new Float32Array(64),terrainHistory:Array.from({length:40},()=>new Float32Array(256)),terrainFrame:0,plasmaTime:0,stars:e,particles:[],prevRms:0}}function YP(e,t,n){const s=e.createShader(t);if(e.shaderSource(s,n),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(s);throw e.deleteShader(s),new Error(`Shader compile error: ${t}`)}return s}function JP(e){const t=e.createVertexArray(),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),{gl:e,programs:new Map,fftTexture:n,waveTexture:s,vao:t}}function QP(e){const{gl:t}=e;e.programs.forEach(e=>t.deleteProgram(e)),t.deleteTexture(e.fftTexture),t.deleteTexture(e.waveTexture),t.deleteVertexArray(e.vao)}function ZP(e,t,n){let s=e.programs.get(t);return s||(s=function(e,t,n){const s=YP(e,e.VERTEX_SHADER,t),a=YP(e,e.FRAGMENT_SHADER,n),o=e.createProgram();if(e.attachShader(o,s),e.attachShader(o,a),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){const t=e.getProgramInfoLog(o);throw e.deleteProgram(o),new Error(`Program link error: ${t}`)}return e.deleteShader(s),e.deleteShader(a),o}(e.gl,"#version 300 es\nprecision highp float;\nout vec2 vUv;\nvoid main() {\n  float x = float((gl_VertexID & 1) << 2);\n  float y = float((gl_VertexID & 2) << 1);\n  vUv = vec2(x * 0.5, y * 0.5);\n  gl_Position = vec4(x - 1.0, y - 1.0, 0.0, 1.0);\n}\n",n),e.programs.set(t,s)),s}function e_(e,t,n,s,a,o){const{gl:r}=e;r.useProgram(t),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e.fftTexture);const i=new Float32Array(n.fft.length);for(let l=0;l<n.fft.length;l++)i[l]=Math.max(0,(n.fft[l]+100)/100);r.texImage2D(r.TEXTURE_2D,0,r.R32F,n.fft.length,1,0,r.RED,r.FLOAT,i),r.uniform1i(r.getUniformLocation(t,"uFFT"),0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,e.waveTexture),r.texImage2D(r.TEXTURE_2D,0,r.R32F,n.waveform.length,1,0,r.RED,r.FLOAT,n.waveform),r.uniform1i(r.getUniformLocation(t,"uWaveform"),1),r.uniform1f(r.getUniformLocation(t,"uTime"),s),r.uniform2f(r.getUniformLocation(t,"uResolution"),a,o),r.uniform1f(r.getUniformLocation(t,"uRms"),n.rms),r.uniform1f(r.getUniformLocation(t,"uPeak"),n.peak),r.uniform1f(r.getUniformLocation(t,"uBass"),n.bassEnergy),r.uniform1f(r.getUniformLocation(t,"uMid"),n.midEnergy),r.uniform1f(r.getUniformLocation(t,"uHigh"),n.highEnergy),r.bindVertexArray(e.vao),r.drawArrays(r.TRIANGLES,0,3)}const t_={spectrumBars:function(e,t,n,s,a,o){e_(e,ZP(e,"spectrumBars","#version 300 es\nprecision highp float;\n\nin vec2 vUv;\nout vec4 fragColor;\n\nuniform sampler2D uFFT;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform float uRms;\nuniform float uBass;\n\n// Design system colors\nconst vec3 RED    = vec3(0.937, 0.267, 0.267);\nconst vec3 ORANGE = vec3(0.976, 0.451, 0.086);\nconst vec3 AMBER  = vec3(0.961, 0.620, 0.043);\nconst vec3 GREEN  = vec3(0.063, 0.725, 0.506);\n\nvec3 barColor(float t) {\n  // Green at bottom  Amber  Orange  Red at top\n  if (t < 0.33) return mix(GREEN, AMBER, t / 0.33);\n  if (t < 0.66) return mix(AMBER, ORANGE, (t - 0.33) / 0.33);\n  return mix(ORANGE, RED, (t - 0.66) / 0.34);\n}\n\nvoid main() {\n  vec2 uv = vUv;\n  float aspect = uResolution.x / uResolution.y;\n\n  // 64 bars with logarithmic frequency mapping\n  float numBars = 64.0;\n  float barIdx = floor(uv.x * numBars);\n  float barCenter = (barIdx + 0.5) / numBars;\n\n  // Logarithmic mapping: more bars for low frequencies\n  float logPos = pow(barCenter, 2.0);\n  float fftVal = texture(uFFT, vec2(logPos, 0.5)).r;\n  // Boost and smooth\n  fftVal = pow(fftVal, 0.7) * 1.4;\n\n  float barWidth = 0.7 / numBars;\n  float barX = fract(uv.x * numBars);\n\n  // Mirror around center line\n  float centerY = 0.5;\n  float dist = abs(uv.y - centerY);\n  float barHeight = fftVal * 0.45;\n\n  // Bar body\n  float inBar = step(dist, barHeight) * step(0.15, barX) * step(barX, 0.85);\n\n  // Color gradient based on height\n  float heightRatio = dist / max(barHeight, 0.001);\n  vec3 col = barColor(1.0 - heightRatio);\n\n  // Reflection below center (dimmer)\n  float isBelow = step(uv.y, centerY);\n  float reflectionFade = isBelow * 0.35 * (1.0 - dist / 0.45);\n\n  // Glow around bars\n  float glow = exp(-dist * dist * 80.0 / max(fftVal * fftVal, 0.01)) * fftVal * 0.3;\n  vec3 glowCol = barColor(logPos);\n\n  // Peak hold dots\n  float peakDist = abs(dist - barHeight);\n  float peakDot = smoothstep(0.008, 0.002, peakDist) * step(0.15, barX) * step(barX, 0.85);\n  vec3 peakCol = vec3(1.0);\n\n  // Background pulse\n  float bgPulse = uBass * 0.03;\n\n  vec3 finalCol = vec3(0.043, 0.035, 0.035) * (1.0 + bgPulse);\n  finalCol += col * inBar * (isBelow > 0.5 ? reflectionFade : 1.0);\n  finalCol += glowCol * glow;\n  finalCol += peakCol * peakDot * 0.8;\n\n  // Scanline effect\n  float scanline = 0.95 + 0.05 * sin(uv.y * uResolution.y * 1.5);\n  finalCol *= scanline;\n\n  fragColor = vec4(finalCol, 1.0);\n}\n"),t,s,a,o)},circularSpectrum:function(e,t,n,s,a,o){e_(e,ZP(e,"circularSpectrum","#version 300 es\nprecision highp float;\n\nin vec2 vUv;\nout vec4 fragColor;\n\nuniform sampler2D uFFT;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform float uRms;\nuniform float uPeak;\nuniform float uBass;\nuniform float uMid;\nuniform float uHigh;\n\nconst float PI = 3.14159265;\nconst float TAU = 6.28318530;\n\nvec3 hsl2rgb(float h, float s, float l) {\n  vec3 rgb = clamp(abs(mod(h * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);\n  return l + s * (rgb - 0.5) * (1.0 - abs(2.0 * l - 1.0));\n}\n\nvoid main() {\n  vec2 center = vec2(0.5);\n  float aspect = uResolution.x / uResolution.y;\n  vec2 p = (vUv - center) * vec2(aspect, 1.0);\n  float dist = length(p);\n  float angle = atan(p.y, p.x);\n  float normAngle = (angle + PI) / TAU;\n\n  // Inner pulsing core\n  float coreRadius = 0.08 + uRms * 0.06;\n  float coreDist = dist / coreRadius;\n  float core = smoothstep(1.2, 0.0, coreDist);\n  vec3 coreCol = vec3(0.063, 0.725, 0.506) * core * (1.5 + uRms);\n\n  // Secondary core glow\n  float innerGlow = exp(-coreDist * coreDist * 2.0) * 0.4;\n  coreCol += vec3(0.2, 0.9, 0.6) * innerGlow;\n\n  // Radial FFT bars (128 segments)\n  float segments = 128.0;\n  float segAngle = floor(normAngle * segments) / segments;\n  float fftVal = texture(uFFT, vec2(pow(segAngle, 1.5), 0.5)).r;\n  fftVal = pow(fftVal, 0.6) * 1.5;\n\n  float barStart = coreRadius + 0.02;\n  float barEnd = barStart + fftVal * 0.35;\n\n  float inRadialBar = step(barStart, dist) * step(dist, barEnd);\n  float segFract = fract(normAngle * segments);\n  inRadialBar *= step(0.08, segFract) * step(segFract, 0.92);\n\n  // Hue rotates around circle + over time\n  float hue = fract(normAngle + uTime * 0.05);\n  vec3 barCol = hsl2rgb(hue, 0.9, 0.55) * inRadialBar;\n  float barBright = 1.0 - smoothstep(barStart, barEnd, dist) * 0.5;\n  barCol *= barBright;\n\n  // Outer halo ring on peaks\n  float haloDist = abs(dist - (coreRadius + 0.38));\n  float haloGlow = exp(-haloDist * haloDist * 200.0) * uPeak * 2.0;\n  vec3 haloCol = vec3(1.0, 0.85, 0.7) * haloGlow;\n\n  // Rotating particle ring\n  float ringAngle = angle + uTime * 0.8;\n  float ringPulse = sin(ringAngle * 12.0) * 0.5 + 0.5;\n  float ringDist = abs(dist - (coreRadius + 0.01));\n  float ring = exp(-ringDist * ringDist * 3000.0) * ringPulse * uMid * 1.5;\n  vec3 ringCol = hsl2rgb(fract(normAngle + uTime * 0.1), 1.0, 0.6) * ring;\n\n  // Background radial glow\n  float bgGlow = exp(-dist * dist * 3.0) * uRms * 0.15;\n\n  vec3 finalCol = vec3(0.043, 0.035, 0.035);\n  finalCol += vec3(bgGlow * 0.2, bgGlow * 0.5, bgGlow * 0.3);\n  finalCol += coreCol;\n  finalCol += barCol;\n  finalCol += haloCol;\n  finalCol += ringCol;\n\n  fragColor = vec4(finalCol, 1.0);\n}\n"),t,s,a,o)},waveformTerrain:function(e,t,n,s,a,o){e_(e,ZP(e,"waveformTerrain","#version 300 es\nprecision highp float;\n\nin vec2 vUv;\nout vec4 fragColor;\n\nuniform sampler2D uWaveform;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform float uRms;\nuniform float uBass;\n\nvoid main() {\n  vec2 uv = vUv;\n\n  // Create terrain rows (40 lines, back to front with perspective)\n  float numRows = 40.0;\n  vec3 col = vec3(0.043, 0.035, 0.035);\n\n  for (float i = 0.0; i < 40.0; i++) {\n    float row = i / numRows;\n    // Perspective: rows further back are higher and smaller\n    float yBase = 0.15 + row * 0.7;\n    float amplitude = (0.04 + row * 0.08) * (1.0 + uBass * 0.5);\n\n    // Sample waveform at this x position with time offset per row\n    float waveX = uv.x;\n    float timeOffset = row * 0.3 + uTime * 0.2;\n    float wave = texture(uWaveform, vec2(fract(waveX + timeOffset * 0.1), 0.5)).r;\n\n    // Add some harmonic richness\n    float wave2 = texture(uWaveform, vec2(fract(waveX * 2.0 + timeOffset * 0.05), 0.5)).r;\n    wave = wave * 0.7 + wave2 * 0.3;\n    wave *= amplitude;\n\n    float yPos = yBase + wave;\n    float dist = uv.y - yPos;\n\n    // Mountain fill (occlusion): everything below this line and above previous lines\n    float fill = smoothstep(0.0, -0.003, dist);\n\n    // Line stroke\n    float line = exp(-dist * dist * 40000.0);\n\n    // Brightness: newest (front/bottom) is brightest\n    float brightness = (1.0 - row) * 0.8 + 0.2;\n    brightness *= 1.0 + uRms * 0.5;\n\n    // Fill with dark background (occlusion)\n    col = mix(col, vec3(0.043, 0.035, 0.035), fill * step(row, numRows - 1.0));\n\n    // Green-tinted lines\n    vec3 lineCol = vec3(0.063, 0.725, 0.506) * brightness;\n    // Add red/amber tint based on amplitude\n    lineCol += vec3(0.9, 0.4, 0.1) * abs(wave) * 4.0;\n\n    col += lineCol * line * brightness;\n  }\n\n  // Subtle vignette\n  float vignette = 1.0 - dot((uv - 0.5) * 1.2, (uv - 0.5) * 1.2);\n  col *= vignette;\n\n  fragColor = vec4(col, 1.0);\n}\n"),t,s,a,o)},plasmaField:function(e,t,n,s,a,o){e_(e,ZP(e,"plasmaField","#version 300 es\nprecision highp float;\n\nin vec2 vUv;\nout vec4 fragColor;\n\nuniform float uTime;\nuniform vec2 uResolution;\nuniform float uRms;\nuniform float uBass;\nuniform float uMid;\nuniform float uHigh;\n\nconst vec3 RED    = vec3(0.937, 0.267, 0.267);\nconst vec3 ORANGE = vec3(0.976, 0.451, 0.086);\nconst vec3 AMBER  = vec3(0.961, 0.620, 0.043);\nconst vec3 GREEN  = vec3(0.063, 0.725, 0.506);\nconst vec3 CYAN   = vec3(0.1, 0.8, 0.9);\n\nvec3 plasmaColor(float t) {\n  t = fract(t);\n  if (t < 0.2) return mix(RED, ORANGE, t / 0.2);\n  if (t < 0.4) return mix(ORANGE, AMBER, (t - 0.2) / 0.2);\n  if (t < 0.6) return mix(AMBER, GREEN, (t - 0.4) / 0.2);\n  if (t < 0.8) return mix(GREEN, CYAN, (t - 0.6) / 0.2);\n  return mix(CYAN, RED, (t - 0.8) / 0.2);\n}\n\nvoid main() {\n  vec2 uv = vUv;\n  float aspect = uResolution.x / uResolution.y;\n  vec2 p = uv * vec2(aspect, 1.0);\n\n  float speed = 0.3 + uRms * 2.0;\n  float t = uTime * speed;\n\n  // Four overlapping sine wave patterns\n  float v1 = sin(p.x * 6.0 + t * 0.7 + uBass * 3.0);\n  float v2 = sin(p.y * 8.0 - t * 0.5 + uMid * 2.0);\n  float v3 = sin((p.x + p.y) * 5.0 + t * 0.9);\n  float v4 = sin(length(p - vec2(aspect * 0.5, 0.5)) * 10.0 - t * 1.2 + uHigh * 4.0);\n\n  // Additional distortion waves driven by audio\n  float v5 = sin(p.x * 12.0 * (1.0 + uBass) + p.y * 8.0 + t * 1.5) * uMid;\n  float v6 = cos(length(p - vec2(aspect * 0.3, 0.7)) * 15.0 + t * 2.0) * uHigh;\n\n  float plasma = (v1 + v2 + v3 + v4 + v5 + v6) / 6.0;\n  plasma = plasma * 0.5 + 0.5; // normalize to 0..1\n\n  // Add bass pulse\n  float pulse = uBass * 0.3 * sin(length(p - vec2(aspect * 0.5, 0.5)) * 3.0 - t * 3.0);\n  plasma += pulse;\n\n  vec3 col = plasmaColor(plasma + uTime * 0.02);\n\n  // Brightness modulation\n  col *= 0.7 + uRms * 0.6;\n\n  // Vignette\n  float vignette = 1.0 - dot((uv - 0.5) * 1.3, (uv - 0.5) * 1.3);\n  col *= max(vignette, 0.0);\n\n  fragColor = vec4(col, 1.0);\n}\n"),t,s,a,o)},starfield:function(e,t,n,s,a,o){e_(e,ZP(e,"starfield","#version 300 es\nprecision highp float;\n\nin vec2 vUv;\nout vec4 fragColor;\n\nuniform float uTime;\nuniform vec2 uResolution;\nuniform float uRms;\nuniform float uBass;\nuniform float uPeak;\nuniform float uMid;\n\n// Hash function for procedural stars\nfloat hash(vec2 p) {\n  p = fract(p * vec2(123.34, 456.21));\n  p += dot(p, p + 45.32);\n  return fract(p.x * p.y);\n}\n\nvoid main() {\n  vec2 uv = (vUv - 0.5) * vec2(uResolution.x / uResolution.y, 1.0);\n\n  float speed = 0.5 + uBass * 3.0 + uRms * 1.0;\n  float t = uTime * speed;\n\n  vec3 col = vec3(0.0);\n\n  // Multiple star layers for depth\n  for (float layer = 0.0; layer < 4.0; layer++) {\n    float depth = 1.0 + layer * 0.5;\n    float layerSpeed = t * (1.0 + layer * 0.3);\n\n    // Tile space for star field\n    vec2 starUv = uv * (5.0 + layer * 3.0);\n    vec2 id = floor(starUv);\n    vec2 f = fract(starUv) - 0.5;\n\n    // Random star position within cell\n    float h = hash(id + layer * 100.0);\n    vec2 starPos = vec2(hash(id + 0.1 + layer * 100.0), hash(id + 0.2 + layer * 100.0)) - 0.5;\n\n    // Only some cells have stars\n    if (h > 0.6) {\n      float starDist = length(f - starPos * 0.3);\n\n      // Stars move toward camera (radial from center)\n      vec2 dir = normalize(id + starPos - vec2(0.0));\n      float movement = fract(h + layerSpeed * 0.1);\n\n      // Size varies with depth and movement\n      float size = (0.005 + h * 0.01) * (1.0 + movement * 2.0) / depth;\n      size *= 1.0 + uRms * 0.5;\n\n      // Star brightness with twinkle\n      float brightness = smoothstep(size, size * 0.1, starDist);\n      brightness *= 0.5 + 0.5 * sin(h * 100.0 + uTime * (2.0 + h * 3.0));\n\n      // Motion streak toward camera\n      float streak = exp(-starDist * 80.0 / max(movement * speed * 0.5, 0.01));\n      streak *= movement * speed * 0.15;\n\n      // Color varies by layer\n      vec3 starCol;\n      if (layer < 1.0) starCol = vec3(0.9, 0.95, 1.0);\n      else if (layer < 2.0) starCol = vec3(0.5, 0.7, 1.0);\n      else if (layer < 3.0) starCol = vec3(1.0, 0.6, 0.3);\n      else starCol = vec3(0.3, 1.0, 0.5);\n\n      col += starCol * (brightness + streak) / depth;\n    }\n  }\n\n  // Warp flash on peaks\n  float warpDist = length(uv);\n  float warp = exp(-warpDist * warpDist * 8.0) * uPeak * 0.8;\n  col += vec3(0.4, 0.6, 1.0) * warp;\n\n  // Radial speed lines\n  float angle = atan(uv.y, uv.x);\n  float radialLines = pow(abs(sin(angle * 30.0 + uTime * 2.0)), 20.0);\n  radialLines *= smoothstep(0.0, 0.5, warpDist) * uBass * 0.2;\n  col += vec3(0.2, 0.4, 0.8) * radialLines;\n\n  // Central nebula glow\n  float nebula = exp(-warpDist * warpDist * 4.0) * 0.1;\n  col += vec3(0.1, 0.2, 0.4) * nebula * (1.0 + uMid);\n\n  // Very subtle vignette\n  float vignette = 1.0 - warpDist * 0.4;\n  col *= max(vignette, 0.3);\n\n  fragColor = vec4(col, 1.0);\n}\n"),t,s,a,o)},particleBurst:function(e,t,n,s,a,o){e_(e,ZP(e,"particleBurst","#version 300 es\nprecision highp float;\n\nin vec2 vUv;\nout vec4 fragColor;\n\nuniform sampler2D uFFT;\nuniform float uTime;\nuniform vec2 uResolution;\nuniform float uRms;\nuniform float uBass;\nuniform float uPeak;\nuniform float uMid;\nuniform float uHigh;\n\nfloat hash(vec2 p) {\n  p = fract(p * vec2(123.34, 456.21));\n  p += dot(p, p + 45.32);\n  return fract(p.x * p.y);\n}\n\nfloat hash1(float p) {\n  p = fract(p * 0.1031);\n  p *= p + 33.33;\n  p *= p + p;\n  return fract(p);\n}\n\nvoid main() {\n  vec2 uv = vUv;\n  float aspect = uResolution.x / uResolution.y;\n  vec2 p = (uv - vec2(0.5)) * vec2(aspect, 1.0);\n\n  vec3 col = vec3(0.02, 0.015, 0.015);\n\n  // Simulate multiple burst sources\n  float burstIntensity = uPeak * 1.5 + uBass * 0.5;\n\n  for (float burst = 0.0; burst < 6.0; burst++) {\n    // Each burst has a different origin and timing\n    float burstSeed = burst * 7.31;\n    float burstTime = uTime * 1.5 + burstSeed;\n    float burstPhase = fract(burstTime * 0.15);\n    float burstAge = burstPhase;\n\n    // Burst origin position (scattered around center)\n    vec2 origin = vec2(\n      sin(burstSeed * 2.4 + uTime * 0.3) * 0.25,\n      cos(burstSeed * 1.7 + uTime * 0.2) * 0.15 + 0.1\n    );\n\n    // Particles per burst\n    for (float i = 0.0; i < 30.0; i++) {\n      float seed = hash1(i * 0.1 + burstSeed);\n      float angle = seed * 6.28318;\n      float speed = 0.3 + seed * 0.7;\n\n      // Gravity + drag\n      float particleAge = burstAge * (1.5 + burstIntensity);\n      vec2 vel = vec2(cos(angle), sin(angle)) * speed;\n      vec2 particlePos = origin + vel * particleAge;\n      particlePos.y -= particleAge * particleAge * 0.4; // gravity\n\n      float dist = length(p - particlePos);\n\n      // Fade out with age\n      float life = 1.0 - smoothstep(0.0, 1.0, burstAge * 1.5);\n      life *= burstIntensity;\n\n      // Ember glow\n      float glow = exp(-dist * dist * 2000.0) * life;\n\n      // Trailing spark\n      float trail = exp(-dist * 300.0) * life * 0.3;\n\n      // Color based on burst index\n      vec3 burstCol;\n      if (burst < 1.0) burstCol = vec3(0.937, 0.267, 0.267); // red\n      else if (burst < 2.0) burstCol = vec3(0.976, 0.451, 0.086); // orange\n      else if (burst < 3.0) burstCol = vec3(0.961, 0.620, 0.043); // amber\n      else if (burst < 4.0) burstCol = vec3(0.063, 0.725, 0.506); // green\n      else if (burst < 5.0) burstCol = vec3(0.3, 0.6, 1.0); // blue\n      else burstCol = vec3(0.8, 0.3, 1.0); // purple\n\n      // Hot white core\n      vec3 coreCol = mix(burstCol, vec3(1.0), smoothstep(0.005, 0.0, dist));\n\n      col += coreCol * glow + burstCol * trail;\n    }\n  }\n\n  // Ground glow on beats\n  float groundGlow = exp(-((uv.y - 0.95) * (uv.y - 0.95)) * 100.0) * uBass * 0.5;\n  col += vec3(0.937, 0.267, 0.267) * groundGlow;\n\n  // Ambient embers (always present)\n  for (float i = 0.0; i < 20.0; i++) {\n    float seed = hash1(i * 0.37);\n    vec2 emberPos = vec2(\n      sin(seed * 30.0 + uTime * 0.5 * (0.5 + seed)) * 0.4,\n      mod(seed * 5.0 - uTime * 0.1 * (0.3 + seed), 1.5) - 0.5\n    );\n    float dist = length(p - emberPos);\n    float flicker = 0.5 + 0.5 * sin(uTime * (3.0 + seed * 5.0));\n    float ember = exp(-dist * dist * 1000.0) * flicker * uRms * 0.5;\n    col += vec3(1.0, 0.5, 0.2) * ember;\n  }\n\n  // Subtle vignette\n  float vignette = 1.0 - dot((uv - 0.5) * 1.4, (uv - 0.5) * 1.4);\n  col *= max(vignette, 0.1);\n\n  fragColor = vec4(col, 1.0);\n}\n"),t,s,a,o)}},n_=Math.PI,s_=2*n_,a_=n_/2,o_=8.17579892,r_="dual-combined",i_="dual-horizontal",l_="single",c_="dual-vertical",u_="bar-index",d_="bar-level",m_="gradient",p_="click",h_="resize",f_="sans-serif",g_=10,b_="create",v_="fschange",y_=h_,x_="user",N_="#fff",w_="#888",E_="bark",k_="linear",D_="log",S_="mel",M_=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],C_=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:M_}],["rainbow",{dir:"h",colorStops:["#817",...M_,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],V_={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:l_,colorMode:m_,fadePeaks:!1,fftSize:8192,fillAlpha:1,frequencyScale:D_,gradient:C_[0][0],gravity:3.8,height:void 0,ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:"",width:void 0},P_=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],__=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],O_=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],T_=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],L_=["ERR_INVALID_MODE","Invalid mode"],A_=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],B_=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],I_=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],F_=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],U_=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class R_ extends Error{constructor(e,t){const[n,s]=e;super(s+(void 0!==t?`: ${t}`:"")),this.name="AudioMotionError",this.code=n}}const j_=e=>{for(const t in e)return!1;return!0},X_=(e,t,n="toLowerCase")=>t[Math.max(0,t.indexOf((""+e)[n]()))],z_=(e,t,n,s,a)=>t+(s-t)*(a-e)/(n-e);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(e){let t=this.length;for(;t-- >0;)if(e(this[t]))return t;return-1});class G_{constructor(e,t={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[],e instanceof Element||(j_(t)&&!j_(e)&&(t=e),e=null),this._ownCanvas=!(t.canvas instanceof HTMLCanvasElement);const n=this._ownCanvas?document.createElement("canvas"):t.canvas;n.style="max-width: 100%;",this._ctx=n.getContext("2d");for(const[d,m]of C_)this.registerGradient(d,m);let s;if(this._container=e||!this._ownCanvas&&n.parentElement||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270,t.source&&(s=t.source.context));else if(s=t.audioCtx);else try{s=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch(u){throw new R_(P_)}if(!s.createGain)throw new R_(__);const a=this._analyzer=[s.createAnalyser(),s.createAnalyser()],o=this._splitter=s.createChannelSplitter(2),r=this._merger=s.createChannelMerger(2);this._input=s.createGain(),this._output=s.createGain(),t.source&&this.connectInput(t.source);for(const d of[0,1])o.connect(a[d],d);r.connect(this._output),!1!==t.connectSpeakers&&this.connectOutput();for(const d of["_scaleX","_scaleR"])this[d]=document.createElement("canvas").getContext("2d");this._fsEl=t.fsElement||n;const i=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(y_),this._fsTimeout=0)},60))};window.ResizeObserver&&(this._observer=new ResizeObserver(i),this._observer.observe(this._container)),this._controller=new AbortController;const l=this._controller.signal;window.addEventListener(h_,i,{signal:l}),n.addEventListener("fullscreenchange",()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(v_),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},60)},{signal:l});const c=()=>{"suspended"==s.state&&s.resume().then(()=>window.removeEventListener(p_,c))};window.addEventListener(p_,c),document.addEventListener("visibilitychange",()=>{"hidden"!=document.visibilityState&&(this._frames=0,this._time=performance.now())},{signal:l}),this._setProps(t,!0),this.useCanvas&&this._ownCanvas&&this._container.appendChild(n),this._ready=!0,this._setCanvas(b_)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=X_(e,[l_,i_,c_,r_]),this._input.disconnect(),this._input.connect(this._chLayout!=l_?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=l_?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=X_(e,[m_,u_,d_])}get fadePeaks(){return this._fadePeaks}set fadePeaks(e){this._fadePeaks=!!e}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const n of[0,1])this._analyzer[n].fftSize=e;const t=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(t),new Float32Array(t)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=X_(e,[D_,E_,S_,k_]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get gravity(){return this._gravity}set gravity(e){this._gravity=e>0?+e:this._gravity||V_.gravity}get height(){return this._height}set height(e){this._height=e,this._setCanvas(x_)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas("lores")}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const t of[0,1])this._analyzer[t].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new R_(T_);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const t of[0,1])this._analyzer[t].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new R_(T_);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=0|Math.sign(e),this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const t=0|e;if(!(t>=0&&t<=10&&9!=t))throw new R_(L_,e);this._mode=t,this._calcBars(),this._makeGrad()}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakFadeTime(){return this._peakFadeTime}set peakFadeTime(e){this._peakFadeTime=e>=0?+e:this._peakFadeTime||V_.peakFadeTime}get peakHoldTime(){return this._peakHoldTime}set peakHoldTime(e){this._peakHoldTime=+e||0}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get radialInvert(){return this._radialInvert}set radialInvert(e){this._radialInvert=!!e,this._calcBars(),this._makeGrad()}get radius(){return this._radius}set radius(e){this._radius=+e||0,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if((e=+e||0)<0||e>=1)throw new R_(A_);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const t of[0,1])this._analyzer[t].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,void 0!==this._spinSpeed&&0!=e||(this._spinAngle=-a_),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return this._chLayout!=l_}set stereo(e){this.channelLayout=e?c_:l_}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=X_(e,["","A","B","C","D","468"],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(x_)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return"4.5.4"}connectInput(e){const t=e instanceof HTMLMediaElement;if(!t&&!e.connect)throw new R_(B_);const n=t?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(n)||(n.connect(this._input),this._sources.push(n)),n}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),1==this._outNodes.length))for(const t of[0,1])this._analyzer[t].connect(this._chLayout!=l_||t?this._merger:this._output,0,t)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:t,_controller:n,_input:s,_merger:a,_observer:o,_ownCanvas:r,_ownContext:i,_splitter:l}=this;this._destroyed=!0,this._ready=!1,this.stop(),n.abort(),o&&o.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),s.disconnect(),l.disconnect(),a.disconnect(),i&&e.close(),r&&t.remove(),this._calcBars()}disconnectInput(e,t){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const n of e){const e=this._sources.indexOf(n);if(t&&n.mediaStream)for(const t of n.mediaStream.getAudioTracks())t.stop();e>=0&&(n.disconnect(this._input),this._sources.splice(e,1))}}disconnectOutput(e){if((!e||this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(t=>t!==e):[],0==this._outNodes.length))for(const t of[0,1])this._analyzer[t].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:t,freqLo:n,freqHi:s,hold:a,peak:o,value:r})=>({posX:e,freq:t,freqLo:n,freqHi:s,hold:a,peak:o,value:r}))}getEnergy(e,t){if(void 0===e)return this._energy.val;if(e!=+e){if("peak"==e)return this._energy.peak;const n={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!n[e])return null;[e,t]=n[e]}const n=this._freqToBin(e),s=t?this._freqToBin(t):n,a=this._chLayout==l_?1:2;let o=0;for(let r=0;r<a;r++)for(let e=n;e<=s;e++)o+=this._normalizedB(this._fftData[r][e]);return o/(s-n+1)/a}getOptions(e){Array.isArray(e)||(e=[e]);let t={};for(const n of Object.keys(V_))e.includes(n)||("gradient"==n&&this.gradientLeft!=this.gradientRight?(t.gradientLeft=this.gradientLeft,t.gradientRight=this.gradientRight):"start"!=n&&(t[n]=this[n]));return t}registerGradient(e,t){if("string"!=typeof e||0==e.trim().length)throw new R_(I_);if("object"!=typeof t)throw new R_(F_);const{colorStops:n}=t;if(!Array.isArray(n)||!n.length)throw new R_(U_);const s=n.length,a=e=>+e!=e||e<0||e>1;n.forEach((e,t)=>{const o=t/Math.max(1,s-1);"object"!=typeof e?n[t]={pos:o,color:e}:a(e.pos)&&(e.pos=o),a(e.level)&&(n[t].level=1-t/s)}),n.sort((e,t)=>e.level<t.level?1:e.level>t.level?-1:0),n[0].level=1,this._gradients[e]={bgColor:t.bgColor||"#111",dir:t.dir,colorStops:n},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,t){this._width=e,this._height=t,this._setCanvas(x_)}setFreqRange(e,t){if(e<1||t<1)throw new R_(T_);this._minFreq=Math.min(e,t),this.maxFreq=Math.max(e,t)}setLedParams(e){let t,n,s;e&&(t=0|e.maxLeds,n=+e.spaceV,s=+e.spaceH),this._ledParams=t>0&&n>0&&s>=0?[t,n,s]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,t){for(const n of[0,1])this._analyzer[n].minDecibels=Math.min(e,t),this._analyzer[n].maxDecibels=Math.max(e,t)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const t=this.isOn;return void 0===e&&(e=!t),t&&!e?(cancelAnimationFrame(this._runId),this._runId=0):t||!e||this._destroyed||(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(e=>this._draw(e))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready)return void(this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1});const{_ansiBands:t,_barSpace:n,canvas:s,_chLayout:a,_maxFreq:o,_minFreq:r,_mirror:i,_mode:l,_radial:c,_radialInvert:u,_reflexRatio:d}=this,m=s.width>>1,p=s.height>>1,h=a==c_&&!c,f=a==i_,g=l%10!=0,b=g&&this._frequencyScale==D_,v=this._showLeds&&g&&!c,y=this._lumiBars&&g&&!c,x=this._alphaBars&&!y&&l!=g_,N=this._outlineBars&&g&&!y&&!v,w=this._roundBars&&g&&!y&&!v,E=a!=c_||d>0&&!y,k=s.height-(h&&!v?.5:0)>>h,D=k*(y||c?1:1-d)|0,S=s.width-m*(f||0!=i),M=h?s.height-2*k:0,C=m*(-1==i&&!f&&!c);let V=.375*Math.min(s.width,s.height)*(a==c_?1:this._radius)|0,P=Math.min(m,p);u&&a!=c_&&([V,P]=[P,V]);const _=t=>e.push({...t,peak:[0,0],hold:[0],alpha:[0],value:[0]}),O=e=>{const t=this._freqToBin(e,"floor"),n=this._binToFreq(t),s=this._binToFreq(t+1);return[t,Math.log2(e/n)/Math.log2(s/n)]};let T,L,A;if(b){const n=(e,t,n)=>+e.toPrecision(n?Math.max(t,1+Math.log10(e)|0):t),s=e=>{const t=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],n=0|Math.log10(e),s=e/10**n;let a=1;for(;a<t.length&&s>t[a];)a++;return s-t[a-1]<t[a]-s&&a--,(t[a]*10**(n+5)|0)/1e5},a=[0,24,12,8,6,4,3,2,1][l],i=t?10**(3/(10*a)):2**(1/a),c=i**.5;let u=t?7.94328235/(a%2?1:c):o_;do{let e=u;const o=n(e/c,4,!0),l=n(e*c,4,!0),[d,m]=O(o),[p,h]=O(l);e=t?a<4?s(e):n(e,e.toString()[0]<5?3:2):n(e,4,!0),e>=r&&_({posX:0,freq:e,freqLo:o,freqHi:l,binLo:d,binHi:p,ratioLo:m,ratioHi:h}),u*=i}while(u<=o);T=S/e.length,e.forEach((e,t)=>e.posX=C+t*T);const d=e[0],m=e[e.length-1];L=this._freqScaling(d.freqLo),A=S/(this._freqScaling(m.freqHi)-L),d.freqLo<r&&(d.freqLo=r,[d.binLo,d.ratioLo]=O(r)),m.freqHi>o&&(m.freqHi=o,[m.binHi,m.ratioHi]=O(o))}else if(g){const e=10*[0,24,12,8,6,4,3,2,1][l],t=e=>{switch(this._frequencyScale){case E_:return 1960/(26.81/(e+.53)-1);case S_:return 700*(2**e-1);case k_:return e}};T=S/e,L=this._freqScaling(r),A=S/(this._freqScaling(o)-L);for(let n=0,s=0;n<e;n++,s+=T){const e=t(L+s/A),n=t(L+(s+T/2)/A),a=t(L+(s+T)/A),[o,r]=O(e),[i,l]=O(a);_({posX:C+s,freq:n,freqLo:e,freqHi:a,binLo:o,binHi:i,ratioLo:r,ratioHi:l})}}else{T=1,L=this._freqScaling(r),A=S/(this._freqScaling(o)-L);const t=this._freqToBin(r,"floor"),n=this._freqToBin(o);let s=-999;for(let a=t;a<=n;a++){const t=this._binToFreq(a),n=C+Math.round(A*(this._freqScaling(t)-L));if(n>s)_({posX:n,freq:t,freqLo:t,freqHi:t,binLo:a,binHi:a,ratioLo:0,ratioHi:0}),s=n;else if(e.length){const n=e[e.length-1];n.binHi=a,n.freqHi=t,n.freq=(n.freqLo*t)**.5}}}let B=0,I=0;if(v){const e=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),t=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],n=this._ledParams,[s,a,o]=n||t[l];let r,i=D;if(n){const t=2*e;let n;r=s+1;do{r--,n=i/r/(1+a),I=n*a}while((n<t||I<t)&&r>1)}else{const t=540/a;I=Math.min(a*e,Math.max(2,i/t+.1|0))}E&&(i+=I),n||(r=Math.min(s,i/(2*I)|0)),B=o>=1?o:T*o,this._leds=[r,B,I,i/r-I]}const F=Math.min(T-1,n*(n>0&&n<1?T:1));g&&(T-=Math.max(v?B:0,F)),e.forEach((t,s)=>{let a=t.posX,o=T;g&&(0!=n||v?a+=Math.max(v?B:0,F)/2:(a|=0,o|=0,s>0&&a>e[s-1].posX+e[s-1].width&&(a--,o++)),t.posX=a),t.barCenter=a+(1==T?0:o/2),t.width=o});const U=[];for(const R of[0,1]){const e=a==c_?(k+M)*R:0,t=e+k,n=e+D-(!v||E?0:I);U.push({channelTop:e,channelBottom:t,analyzerBottom:n})}this._aux={analyzerHeight:D,analyzerWidth:S,centerX:m,centerY:p,channelCoords:U,channelHeight:k,channelGap:M,initialX:C,innerRadius:V,outerRadius:P,scaleMin:L,unitWidth:A},this._flg={isAlpha:x,isBands:g,isLeds:v,isLumi:y,isOctaves:b,isOutline:N,isRound:w,noLedGap:E},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:t,innerRadius:n,scaleMin:s,unitWidth:a}=this._aux,{canvas:o,_frequencyScale:r,_mirror:i,_noteLabels:l,_radial:c,_scaleX:u,_scaleR:d}=this,m=u.canvas,p=d.canvas,h=[],f=this._chLayout==i_,g=this._chLayout==c_,b=Math.min(o.width,o.height),v=["C",,"D",,"E","F",,"G",,"A",,"B"],y=b/34|0,x=m.height>>1,N=y>>1,w=x*(l?.7:1.5),E=N*(l?1:2),k=2**(1/12);if(l||!this._ansiBands&&r==D_){let e=o_;for(let t=-1;t<11;t++)for(let n=0;n<12;n++){if(e>=this._minFreq&&e<=this._maxFreq){const s=v[n],a="C"==s;(s&&l&&!i&&!f||a)&&h.push(l?[e,s+(a?t:"")]:e)}e*=k}}else h.push(16,31.5,63,125,250,500,1e3,2e3,4e3),r==k_?h.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):h.push(8e3,16e3);p.width=p.height=Math.max(.15*b,(n<<1)+g*y);const D=p.width>>1,S=D-.7*y,M=(e,t)=>{const n=s_*(e/o.width),s=n-a_,a=S*Math.cos(s),r=S*Math.sin(s);d.save(),d.translate(D+a,D+r),d.rotate(n),d.fillText(t,0,0),d.restore()};m.width|=0,u.fillStyle=d.strokeStyle="#000c",u.fillRect(0,0,m.width,m.height),d.arc(D,D,D-y/2,0,s_),d.lineWidth=y,d.stroke(),u.fillStyle=d.fillStyle=N_,u.font=`${x}px ${f_}`,d.font=`${N}px ${f_}`,u.textAlign=d.textAlign="center";let C=-w/4,V=-E;for(const P of h){const[n,p]=Array.isArray(P)?P:[P,P<1e3?0|P:(P/100|0)/10+"k"],h=a*(this._freqScaling(n)-s),b=.75*m.height,v="C"==p[0],y=x*(!l||i||f?3:v?1.2:.6);if(u.fillStyle=d.fillStyle=!v||i||f?N_:"#4f4",l){const e=r==D_,t=r==k_;let s=["C"];if((e||n>2e3||!t&&n>250||(!c||g)&&(!t&&n>125||n>1e3))&&s.push("G"),(e||n>4e3||!t&&n>500||(!c||g)&&(!t&&n>250||n>2e3))&&s.push("E"),(t&&n>4e3||(!c||g)&&(e||n>2e3||!t&&n>500))&&s.push("D","F","A","B"),!s.includes(p[0]))continue}h>=C+w/2&&h<=e&&(u.fillText(p,f&&-1==i?e-h:t+h,b,y),(f||i&&(h>w||1==i))&&u.fillText(p,f&&1!=i?e+h:(t||o.width)-h,b,y),C=h+Math.min(y,u.measureText(p).width)/2),h>=V+E&&h<e-E&&(M(f&&1==i?e-h:h,p),(f||i&&(h>E||1==i))&&M(f&&-1!=i?e+h:-h,p),V=h)}}_draw(e){this._runId=requestAnimationFrame(e=>this._draw(e));const t=e-this._time,n=e-this._last,s=this._maxFPS?975/this._maxFPS:0;if(n<s)return;this._last=e-(s?n%s:0),this._frames++,t>=1e3&&(this._fps=this._frames/t*1e3,this._frames=0,this._time=e);const{isAlpha:a,isBands:o,isLeds:r,isLumi:i,isOctaves:l,isOutline:c,isRound:u,noLedGap:d}=this._flg,{analyzerHeight:m,centerX:p,centerY:h,channelCoords:f,channelHeight:g,channelGap:b,initialX:v,innerRadius:y,outerRadius:x}=this._aux,{_bars:N,canvas:w,_canvasGradients:E,_chLayout:k,_colorMode:D,_ctx:S,_energy:M,_fadePeaks:C,fillAlpha:V,_fps:P,_linearAmplitude:_,_lineWidth:O,maxDecibels:T,minDecibels:L,_mirror:A,_mode:B,overlay:I,_radial:F,showBgColor:U,showPeaks:R,useCanvas:j,_weightingFilter:X}=this,z=this._scaleX.canvas,G=this._scaleR.canvas,H=P*this._peakFadeTime/1e3,W=P**2,q=1e3*this._gravity,K=P*this._peakHoldTime/1e3,$=k==r_,Y=k==i_,J=k==c_,Q=k==l_,Z=r&&this._trueLeds&&D==m_,ee=F?w.width:this._aux.analyzerWidth,te=v+ee,ne=R&&this._peakLine&&B==g_,se=F?x-y:m,ae=se/this._pixelRatio,[oe,re,ie,le]=this._leds||[];M.val>0&&P>0&&(this._spinAngle+=this._spinSpeed*s_/60/P);const ce=e=>{if(this._reflexRatio>0&&!i&&!F){let t,n;this.reflexFit||J?(t=J&&0==e?g+b:0,n=g-m):(t=w.height-2*m,n=m),S.save(),S.globalAlpha=this.reflexAlpha,1!=this.reflexBright&&(S.filter=`brightness(${this.reflexBright})`),S.setTransform(1,0,0,-1,0,w.height),S.drawImage(w,0,f[e].channelTop,w.width,m,0,t,w.width,n),S.restore()}},ue=()=>{this.showScaleX&&(F?(S.save(),S.translate(p,h),this._spinSpeed&&S.rotate(this._spinAngle+a_),S.drawImage(G,-G.width>>1,-G.width>>1),S.restore()):S.drawImage(z,0,w.height-z.height))},de=e=>{const t=e**2,n=424.36,s=148693636,a=e=>20*Math.log10(e);switch(X){case"A":return 2+a(s*t**2/((t+n)*Math.sqrt((t+11599.29)*(t+544496.41))*(t+s)));case"B":return.17+a(s*t*e/((t+n)*Math.sqrt(t+25122.25)*(t+s)));case"C":return.06+a(s*t/((t+n)*(t+s)));case"D":const o=((1037918.48-t)**2+1080768.16*t)/((9837328-t)**2+11723776*t);return a(e/68966888496476e-18*Math.sqrt(o/((t+79919.29)*(t+1345600))));case"468":const r=-4737338981378384e-39*e**6+2043828333606125e-30*e**4-1.363894795463638e-7*t+1,i=1306612257412824e-34*e**5-2118150887518656e-26*e**3+.0005559488023498642*e;return 18.2+a(.0001246332637532143*e/Math.hypot(r,i))}return 0},me=(e,t,n)=>{S.beginPath(),S.moveTo(e,t),S.lineTo(e,n),S.stroke()},pe=e=>{if(e&&O){const e=S.globalAlpha;S.globalAlpha=1,S.stroke(),S.globalAlpha=e}},he=e=>Math.max(0,(e*oe|0)*(le+ie)-ie);I&&S.clearRect(0,0,w.width,w.height);let fe=0;const ge=N.length,be=Q?1:2;for(let ve=0;ve<be;ve++){const{channelTop:e,channelBottom:t,analyzerBottom:n}=f[ve],s=this._gradients[this._selectedGrads[ve]],o=s.colorStops,l=o.length,d=!U||r&&!I?"#000":s.bgColor,x=J&&F&&ve?-1:1,k=!ve&&-1==A||ve&&1==A,M=!Y||ve&&1!=A?0:ee>>(ve||!k),P=Y&&k?-1:1,G=()=>{const t=z.height,n=t>>1,s=_?100:T,a=_?0:L,o=_?20:5,r=m/(s-a),i=-1!=A&&(!Y||0==ve||1==A),l=1!=A&&(!Y||ve!=A);S.save(),S.fillStyle=w_,S.font=`${n}px ${f_}`,S.textAlign="right",S.lineWidth=1;for(let c=s;c>a;c-=o){const a=e+(s-c)*r,o=c%2==0|0;if(o){const s=a+n*(a==e?.8:.35);i&&S.fillText(c,.85*t,s),l&&S.fillText(c,(Y?ee:w.width)-.1*t,s),S.strokeStyle=w_,S.setLineDash([2,4]),S.lineDashOffset=0}else S.strokeStyle="#555",S.setLineDash([2,8]),S.lineDashOffset=1;S.beginPath(),S.moveTo(v+t*o*i,.5+~~a),S.lineTo(te-t*o*l,.5+~~a),S.stroke()}S.restore()},Q=(e,t)=>{const n=ye[e]+(e<ye.length-1?(ye[e+1]-ye[e])*t:0);return isNaN(n)?-1/0:n},oe=(e,t=P)=>t*s_*((e+M)/w.width)+this._spinAngle,re=(e,t,n)=>{const s=y+t*x,a=oe(e,n);return[p+s*Math.cos(a),h+s*Math.sin(a)]},ue=(e,t,n,s,a)=>{S.beginPath();for(const o of A&&!Y?[1,-1]:[P]){const[r,i]=u?[oe(e,o),oe(e+n,o)]:[];S.moveTo(...re(e,t,o)),S.lineTo(...re(e,t+s,o)),u?S.arc(p,h,y+(t+s)*x,r,i,1!=o):S.lineTo(...re(e+n,t+s,o)),S.lineTo(...re(e+n,t,o)),u&&!a&&S.arc(p,h,y+t*x,i,r,1==o)}pe(a),S.fill()},be=(e=0,t=0)=>{let n;if(D==m_&&!Z||B==g_)n=E[ve];else{const s=D==u_?t%l:o.findLastIndex(t=>r?he(e)<=he(t.level):e<=t.level);n=o[s].color}S.fillStyle=S.strokeStyle=n};if(j){if(Y&&!F){const e=ee*(ve+k),t=k?-1:1;S.setTransform(t,0,0,1,e,0)}if(I&&!U||(I&&(S.globalAlpha=this.bgAlpha),S.fillStyle=d,0!=ve&&(F||$)||S.fillRect(v,e-b,ee,(I&&1==this.reflexAlpha?m:g)+b),S.globalAlpha=1),!this.showScaleY||i||F||0!=ve&&$||G(),r?(S.setLineDash([le,ie]),S.lineWidth=N[0].width):S.lineWidth=c?Math.min(O,N[0].width/2):O,S.save(),!F){const t=new Path2D;t.rect(0,e,w.width,m),S.clip(t)}}let ye=this._fftData[ve];this._analyzer[ve].getFloatFrequencyData(ye),X&&(ye=ye.map((e,t)=>e+de(this._binToFreq(t)))),S.beginPath();let xe=[];for(let m=0;m<ge;m++){const t=N[m],{posX:s,barCenter:d,width:p,freq:h,binLo:f,binHi:g,ratioLo:b,ratioHi:x}=t;let w=Math.max(Q(f,b),Q(g,x));for(let e=f+1;e<g;e++)ye[e]>w&&(w=ye[e]);if(w=this._normalizedB(w),t.value[ve]=w,fe+=w,t.peak[ve]>0&&t.alpha[ve]>0&&(t.hold[ve]--,t.hold[ve]<0)){if(C&&!ne){const e=!a||c&&O>0?1:a?t.peak[ve]:V;t.alpha[ve]=e*(1+t.hold[ve]/H)}else t.peak[ve]+=t.hold[ve]*q/W/Math.abs(ae);t.alpha[ve]<=0&&(t.peak[ve]=0)}if(w>=t.peak[ve]&&(t.peak[ve]=w,t.hold[ve]=K,t.alpha[ve]=!a||c&&O>0?1:a?w:V),!j)continue;S.globalAlpha=i||a?w:c?V:1,be(w,m);const E=i?se:r?he(w):w*se|0;if(B==g_){const e=m?0:(this._normalizedB(ye[N[1].binLo])*se+E)/2;if(F){if(0==m&&(Y&&S.moveTo(...re(0,0)),S.lineTo(...re(0,s<0?e:E))),s>=0){const e=[s,E];S.lineTo(...re(...e)),xe.push(e)}}else{if(0==m)if(-1!=A||Y){const e=f?this._normalizedB(ye[f-1])*se:E;S.moveTo(v-O,n-e)}else S.moveTo(v,n-(s<v?e:E));(Y||-1!=A||s>=v)&&S.lineTo(s,n-E)}}else if(r){if(U&&!I&&(0==ve||!$)){const t=S.globalAlpha;S.strokeStyle="#7f7f7f22",S.globalAlpha=1,me(d,e,n),S.strokeStyle=S.fillStyle,S.globalAlpha=t}if(Z){const e=i?0:o.findLastIndex(e=>he(w)<=he(e.level));let t=n;for(let s=l-1;s>=e;s--){S.strokeStyle=o[s].color;let a=n-(s==e?E:he(o[s].level));me(d,t,a),t=a-ie}}else me(d,n,n-E)}else if(s>=v)if(F)ue(s,0,p,E,c);else if(u){const e=p/2,t=n+e;S.beginPath(),S.moveTo(s,t),S.lineTo(s,t-E),S.arc(d,t-E,e,n_,s_),S.lineTo(s+p,t),pe(c),S.fill()}else{const e=c?S.lineWidth:0;S.beginPath(),S.rect(s,n+e,p,-E-e),pe(c),S.fill()}const k=t.peak[ve],M=t.alpha[ve];if(k>0&&M>0&&R&&!ne&&!i&&s>=v&&s<te)if(C?S.globalAlpha=M:c&&O>0?S.globalAlpha=1:a&&(S.globalAlpha=k),(D==d_||Z)&&be(k),r){const e=he(k);e>=ie&&S.fillRect(s,n-e,p,le)}else if(F){if(B!=g_){const e=k*se;ue(s,e,p,!this._radialInvert||J||e+y>=2?-2:2)}}else S.fillRect(s,n-k*se,p,2)}if(j){if(S.globalAlpha=1,B==g_){if(be(),F&&!Y){if(A){let e;for(;e=xe.pop();)S.lineTo(...re(...e,-1))}S.closePath()}if(O>0&&S.stroke(),V>0){if(F){const e=Y?oe(ee>>1):0,t=Y?oe(ee):s_;S.moveTo(...re(Y?ee>>1:0,0)),S.arc(p,h,y,e,t,!Y||!k)}else S.lineTo(te,n),S.lineTo(v,n);S.globalAlpha=V,S.fill(),S.globalAlpha=1}if((ne||F&&R)&&(xe=[],S.beginPath(),N.forEach((e,t)=>{let s=e.posX,a=e.peak[ve],o=t?"lineTo":"moveTo";if(F&&s<0){const e=N[t+1];a=z_(s,a,e.posX,e.peak[ve],0),s=0}a*=se,ne?(S[o](...F?re(s,a):[s,n-a]),F&&A&&!Y&&xe.push([s,a])):e.peak[ve]>0&&(C&&(S.globalAlpha=e.alpha[ve]),ue(s,a,1,-2))}),ne)){let e;for(;e=xe.pop();)S.lineTo(...re(...e,-1));S.lineWidth=1,S.stroke()}}S.restore(),Y&&!F&&S.setTransform(1,0,0,1,0,0),(!Y&&!$||ve)&&ce(ve)}}if((e=>{M.val=e,M.peak>0&&(M.hold--,M.hold<0&&(M.peak+=M.hold*q/W/w.height*this._pixelRatio)),e>=M.peak&&(M.peak=e,M.hold=K)})(fe/(ge<<be-1)),j&&(!A||F||Y||(S.setTransform(-1,0,0,1,w.width-v,0),S.drawImage(w,v,0,p,w.height,0,0,p,w.height),S.setTransform(1,0,0,1,0,0)),S.setLineDash([]),ue()),this.showFPS){const e=z.height;S.font=`bold ${e}px ${f_}`,S.fillStyle="#0f0",S.textAlign="right",S.fillText(Math.round(P),w.width-e,2*e)}this.onCanvasDraw&&(S.save(),S.fillStyle=S.strokeStyle=E[0],this.onCanvasDraw(this,{timestamp:e,canvasGradients:E}),S.restore())}_freqScaling(e){switch(this._frequencyScale){case D_:return Math.log2(e);case E_:return 26.81*e/(1960+e)-.53;case S_:return Math.log2(1+e/700);case k_:return e}}_freqToBin(e,t="round"){const n=this._analyzer[0].frequencyBinCount-1,s=Math[t](e*this.fftSize/this.audioCtx.sampleRate);return s<n?s:n}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:t,_radial:n,_reflexRatio:s}=this,{analyzerWidth:a,centerX:o,centerY:r,initialX:i,innerRadius:l,outerRadius:c}=this._aux,{isLumi:u}=this._flg,d=this._chLayout==c_,m=1-s,p=u?e.height:e.height*(1-s*!d)|0;for(const h of[0,1]){const e=this._gradients[this._selectedGrads[h]],f=e.colorStops,g="h"==e.dir;let b;if(b=n?t.createRadialGradient(o,r,c,o,r,l-(c-l)*d):t.createLinearGradient(...g?[i,0,i+a,0]:[0,0,0,p]),f){const e=d&&!this._splitGradient&&(!g||n);for(let t=0;t<1+e;t++){const a=f.length-1;f.forEach((o,r)=>{let i=o.pos;if(e&&(i/=2),!d||u||n||g||(i*=m,!e&&i>.5*m&&(i+=.5*s)),1==t)if(n||u){i=1-(o=f[a-r]).pos/2}else 0==r&&i>0&&b.addColorStop(.5,o.color),i+=.5;b.addColorStop(i,o.color),d&&r==a&&i<.5&&b.addColorStop(.5,o.color)})}}this._canvasGradients[h]=b}}_normalizedB(e){const t=this._linearAmplitude,n=t?1/this._linearBoost:1,s=e=>10**(e/20);let a=this.maxDecibels,o=this.minDecibels;return t&&(a=s(a),o=s(o),e=s(e)**n),l=1,(r=(e-o)/(a-o)**n)<=(i=0)?i:r>=l?l:r;var r,i,l}_setCanvas(e){if(!this._ready)return;const{canvas:t,_ctx:n}=this,s=this._scaleX.canvas,a=window.devicePixelRatio/(this._loRes+1);let o=window.screen.width*a,r=window.screen.height*a;90==Math.abs(window.orientation)&&o<r&&([o,r]=[r,o]);const i=this.isFullscreen,l=i&&this._fsEl==t,c=l?o:(this._width||this._container.clientWidth||this._defaultWidth)*a|0,u=l?r:(this._height||this._container.clientHeight||this._defaultHeight)*a|0;this._pixelRatio=a,this._fsWidth=o,this._fsHeight=r,e!=b_&&t.width==c&&t.height==u||(t.width=c,t.height=u,this.overlay||(n.fillStyle="#000",n.fillRect(0,0,c,u)),n.lineJoin="bevel",s.width=c,s.height=Math.max(20*a,Math.min(c,u)/32|0),this._calcBars(),this._makeGrad(),void 0!==this._fsStatus&&this._fsStatus!==i&&(e=v_),this._fsStatus=i,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,t){if(!this._gradients.hasOwnProperty(e))throw new R_(O_,e);[0,1].includes(t)||(this._selectedGrads[1]=e,t=0),this._selectedGrads[t]=e,this._makeGrad()}_setProps(e,t){const n=["onCanvasDraw","onCanvasResize"],s=Object.keys(V_).filter(e=>"start"!=e).concat(n,["gradientLeft","gradientRight","stereo"]);(t||void 0===e)&&(e={...V_,...e});for(const a of Object.keys(e))n.includes(a)&&"function"!=typeof e[a]?this[a]=void 0:s.includes(a)&&(this[a]=e[a]);void 0!==e.start&&this.toggleAnalyzer(e.start)}}const H_={fileName:null,trackName:"",detectedBPM:125,isPlaying:!1,songPos:0,pattPos:0,totalPositions:0,elapsedMs:0,pitchOffset:0,effectiveBPM:125,repitchLock:!1,keyLockEnabled:!1,eqLow:0,eqMid:0,eqHigh:0,eqLowKill:!1,eqMidKill:!1,eqHighKill:!1,filterPosition:0,filterResonance:1,volume:1,trimGain:0,autoGainEnabled:!0,rmsDb:-100,peakDb:-100,cuePoint:0,pflEnabled:!1,hotCues:Array(8).fill(null),loopActive:!1,lineLoopSize:4,patternLoopStart:0,patternLoopEnd:0,loopMode:"off",audioLoopIn:null,audioLoopOut:null,slipEnabled:!1,slipSongPos:0,slipPattPos:0,channelMask:65535,scratchActive:!1,scratchVelocity:0,scratchFaderGain:1,faderLFOActive:!1,faderLFODivision:null,activePatternName:null,playbackMode:"tracker",durationMs:0,audioPosition:0,waveformPeaks:null,seratoCuePoints:[],seratoLoops:[],seratoBeatGrid:[],seratoKey:null,analysisState:"none",analysisProgress:0,beatGrid:null,musicalKey:null,keyConfidence:0,frequencyPeaks:null},W_=i()(PN(ds(e=>({djModeActive:!1,deckViewMode:"visualizer",thirdDeckActive:!1,crossfaderPosition:.5,crossfaderCurve:"smooth",hamsterSwitch:!1,masterVolume:1,boothVolume:1,sessionMonitorVolume:1,cueMix:.5,jogWheelSensitivity:1,decks:{A:{...H_},B:{...H_},C:{...H_}},cueMode:"none",cueDeviceId:null,cueVolume:1,pipelineActive:!1,pipelineQueue:0,pipelineCurrentTask:null,setDJModeActive:t=>e(e=>{e.djModeActive=t}),cycleDeckViewMode:()=>e(e=>{const t=["visualizer","vinyl","3d"],n=t.indexOf(e.deckViewMode);e.deckViewMode=t[(n+1)%t.length]}),setDeckViewMode:t=>e(e=>{e.deckViewMode=t}),setThirdDeckActive:t=>e(e=>{e.thirdDeckActive=t}),setCrossfader:t=>e(e=>{e.crossfaderPosition=Math.max(0,Math.min(1,t))}),setCrossfaderCurve:t=>e(e=>{e.crossfaderCurve=t}),setHamsterSwitch:t=>e(e=>{e.hamsterSwitch=t}),setMasterVolume:t=>e(e=>{e.masterVolume=Math.max(0,Math.min(1.5,t))}),setBoothVolume:t=>e(e=>{e.boothVolume=Math.max(0,Math.min(1.5,t))}),setSessionMonitorVolume:t=>e(e=>{e.sessionMonitorVolume=Math.max(0,Math.min(1.5,t))}),setCueMix:t=>e(e=>{e.cueMix=Math.max(0,Math.min(1,t))}),setJogWheelSensitivity:t=>e(e=>{e.jogWheelSensitivity=Math.max(.5,Math.min(2,t))}),setDeckState:(t,n)=>e(e=>{Object.assign(e.decks[t],n)}),setDeckPlaying:(t,n)=>e(e=>{e.decks[t].isPlaying=n}),setDeckPosition:(t,n,s)=>e(e=>{e.decks[t].songPos=n,e.decks[t].pattPos=s}),setDeckPitch:(t,n)=>e(e=>{const s=Math.max(-16,Math.min(16,n));e.decks[t].pitchOffset=s;const a=e.decks[t].detectedBPM;e.decks[t].effectiveBPM=Math.round(a*Math.pow(2,s/12)*100)/100}),setDeckEQ:(t,n,s)=>e(e=>{const a=`eq${n.charAt(0).toUpperCase()+n.slice(1)}`;e.decks[t][a]=Math.max(-24,Math.min(6,s))}),setDeckEQKill:(t,n,s)=>e(e=>{const a=`eq${n.charAt(0).toUpperCase()+n.slice(1)}Kill`;e.decks[t][a]=s}),setDeckFilter:(t,n)=>e(e=>{e.decks[t].filterPosition=Math.max(-1,Math.min(1,n))}),setDeckVolume:(t,n)=>e(e=>{e.decks[t].volume=Math.max(0,Math.min(1.5,n))}),setDeckTrimGain:(t,n)=>e(e=>{e.decks[t].trimGain=Math.max(-12,Math.min(12,n))}),setDeckAutoGain:(t,n)=>e(e=>{e.decks[t].autoGainEnabled=n}),setDeckCuePoint:(t,n)=>e(e=>{e.decks[t].cuePoint=n}),setDeckPFL:(t,n)=>e(e=>{e.decks[t].pflEnabled=n}),togglePFL:t=>e(e=>{e.decks[t].pflEnabled=!e.decks[t].pflEnabled}),setDeckLoop:(t,n,s)=>e(e=>{e.decks[t].loopMode=n,e.decks[t].loopActive=s}),setDeckLoopSize:(t,n)=>e(e=>{e.decks[t].lineLoopSize=n}),setLineLoopSize:(t,n)=>e(e=>{e.decks[t].lineLoopSize=n}),toggleLoop:t=>e(e=>{e.decks[t].loopActive=!e.decks[t].loopActive}),setHotCue:(t,n,s)=>e(e=>{n>=0&&n<8&&(e.decks[t].hotCues[n]=s)}),deleteHotCue:(t,n)=>e(e=>{n>=0&&n<8&&(e.decks[t].hotCues[n]=null)}),setAudioLoopIn:(t,n)=>e(e=>{e.decks[t].audioLoopIn=n}),setAudioLoopOut:(t,n)=>e(e=>{e.decks[t].audioLoopOut=n}),setDeckSlip:(t,n)=>e(e=>{e.decks[t].slipEnabled=n}),setDeckKeyLock:(t,n)=>e(e=>{e.decks[t].keyLockEnabled=n}),toggleDeckChannel:(t,n)=>e(e=>{e.decks[t].channelMask^=1<<n}),setAllDeckChannels:(t,n)=>e(e=>{e.decks[t].channelMask=n?65535:0}),resetDeck:t=>e(e=>{e.decks[t]={...H_}}),setDeckScratchActive:(t,n)=>e(e=>{e.decks[t].scratchActive=n}),setDeckFaderLFO:(t,n,s)=>e(e=>{e.decks[t].faderLFOActive=n,void 0!==s?e.decks[t].faderLFODivision=n?s:null:n||(e.decks[t].faderLFODivision=null)}),setDeckPattern:(t,n)=>e(e=>{e.decks[t].activePatternName=n}),setCueMode:t=>e(e=>{e.cueMode=t}),setCueDevice:t=>e(e=>{e.cueDeviceId=t}),setCueVolume:t=>e(e=>{e.cueVolume=Math.max(0,Math.min(1.5,t))}),setPipelineState:(t,n)=>e(e=>{e.pipelineQueue=t,e.pipelineCurrentTask=n,e.pipelineActive=t>0||null!==n}),setDeckAnalysisProgress:(t,n)=>e(e=>{e.decks[t].analysisProgress=n})})))),q_=()=>W_(e=>e.thirdDeckActive),K_={mp3:"audio/mpeg",wav:"audio/wav",flac:"audio/flac",ogg:"audio/ogg; codecs=vorbis",opus:"audio/ogg; codecs=opus",aac:"audio/aac",m4a:"audio/mp4; codecs=mp4a.40.2",aiff:"audio/aiff",alac:"audio/mp4; codecs=alac",wma:"audio/x-ms-wma",webm:"audio/webm; codecs=opus",unknown:""},$_={".mp3":"mp3",".wav":"wav",".flac":"flac",".ogg":"ogg",".oga":"ogg",".opus":"opus",".aac":"aac",".m4a":"m4a",".m4b":"m4a",".mp4":"m4a",".aif":"aiff",".aiff":"aiff",".alac":"alac",".wma":"wma",".webm":"webm"},Y_=new Map;function J_(e,t){const n=function(e){const t=new DataView(e),n=new Uint8Array(e.slice(0,12));if(102===n[0]&&76===n[1]&&97===n[2]&&67===n[3])return"flac";if(79===n[0]&&103===n[1]&&103===n[2]&&83===n[3]){if(e.byteLength>36){const t=new Uint8Array(e.slice(28,36));if("OpusHead"===String.fromCharCode(...t))return"opus"}return"ogg"}if(82===n[0]&&73===n[1]&&70===n[2]&&70===n[3]&&87===n[8]&&65===n[9]&&86===n[10]&&69===n[11])return"wav";if(70===n[0]&&79===n[1]&&82===n[2]&&77===n[3]&&65===n[8]&&73===n[9]&&70===n[10]&&70===n[11])return"aiff";if(73===n[0]&&68===n[1]&&51===n[2])return"mp3";if(255===n[0]&&!(224&~n[1]))return"mp3";if(t.byteLength>=8&&102===n[4]&&116===n[5]&&121===n[6]&&112===n[7]){const e=String.fromCharCode(n[8],n[9],n[10],n[11]);if("M4A "===e||"mp42"===e||"isom"===e||"MSNV"===e)return"m4a";if("M4B "===e)return"m4a"}if(26===n[0]&&69===n[1]&&223===n[2]&&163===n[3])return"webm";const s=[48,38,178,117,142,102,207,17];let a=!0;for(let o=0;o<8&&o<n.length;o++)if(n[o]!==s[o]){a=!1;break}return a?"wma":"unknown"}(e);return"unknown"!==n?n:function(e){const t=e.slice(e.lastIndexOf(".")).toLowerCase();return $_[t]??"unknown"}(t)}function Q_(e){return"unknown"===e||"wma"===e?"wma"===e:!function(e){if(Y_.has(e))return Y_.get(e);const t=K_[e];if(!t)return Y_.set(e,!1),!1;const n=""!==document.createElement("audio").canPlayType(t);return Y_.set(e,n),n}(e)}let Z_=null,eO=null,tO=null,nO=null;async function sO(e,t,n){const s=await async function(e){switch(e){case"flac":{if(!Z_){const e=await os(()=>import("./index-R3wesNBw.js"),__vite__mapDeps([5,6,1,7]));Z_=e.FLACDecoder}const e=new Z_;return await e.ready,e}case"ogg":{if(!eO){const e=await os(()=>import("./index-Bfh3Z1G8.js"),__vite__mapDeps([8,6,1,7]));eO=e.OggVorbisDecoder}const e=new eO;return await e.ready,e}case"opus":{if(!tO){const e=await os(()=>import("./index-WUZHuUYq.js"),__vite__mapDeps([9,6,1]));tO=e.OpusDecoder}const e=new tO;return await e.ready,e}case"mp3":{if(!nO){const e=await os(()=>import("./index-CHnF7Z66.js"),__vite__mapDeps([10,6,1]));nO=e.MPEGDecoder}const e=new nO;return await e.ready,e}default:return null}}(n);if(!s)throw new Error(`No WASM decoder available for format: ${n}`);try{const a=new Uint8Array(t),o=s.decodeFile?s.decodeFile(a):s.decode(a);if(!o.channelData||0===o.channelData.length)throw new Error(`WASM decoder returned no channel data for ${n}`);return o.errors&&o.errors.length,function(e,t,n){const s=t.length,a=t[0]?.length??0;if(0===a)throw new Error("Decoded audio has no samples");const o=e.createBuffer(s,a,n);for(let r=0;r<s;r++)o.copyToChannel(new Float32Array(t[r]),r);return o}(e,o.channelData,o.sampleRate)}finally{s.free()}}async function aO(e,t){return e.decodeAudioData(t.slice(0))}class oO{player;_duration=0;_sampleRate=0;_numberOfChannels=0;_waveformPeaks=null;_loaded=!1;_playbackRate=1;_pendingOffset=null;_loopIn=null;_loopOut=null;_loopCheckTimer=null;constructor(e){this.player=new re({loop:!0,autostart:!1}),this.player.connect(e)}async loadAudioFile(e,t){const n=N().rawContext,s=await async function(e,t,n={}){const{forceWasm:s=!1,filename:a}=n,o=J_(t,a??"");if(!o)throw new Error("Unable to detect audio format");let r,i=!1;if(s||Q_(o))try{r=await sO(e,t,o),i=!0}catch(l){try{r=await aO(e,t)}catch(c){throw new Error(`Failed to decode ${o} with WASM: ${l}. Native also failed: ${c}`)}}else try{r=await aO(e,t)}catch(c){try{r=await sO(e,t,o),i=!0}catch(l){throw new Error(`Failed to decode ${o}: Native error: ${c}, WASM error: ${l}`)}}return{audioBuffer:r,format:o,usedWasm:i,duration:r.duration}}(n,e,{filename:t}),a=s.audioBuffer;s.usedWasm;const o=new xe(a);return this.player.buffer=o,this._duration=a.duration,this._sampleRate=a.sampleRate,this._numberOfChannels=a.numberOfChannels,this._loaded=!0,this._waveformPeaks=this.computeWaveformPeaks(a,800),{duration:this._duration,sampleRate:this._sampleRate,numberOfChannels:this._numberOfChannels,waveformPeaks:this._waveformPeaks}}async play(){this._loaded&&this.player.buffer.loaded&&"started"!==this.player.state&&("running"!==N().state&&await A(),this.player.fadeIn=.01,null!==this._pendingOffset?(this.player.start(void 0,this._pendingOffset),this._pendingOffset=null):this.player.start())}pause(){"started"===this.player.state&&(this.player.fadeOut=.01,this.player.stop())}stop(){"started"===this.player.state&&(this.player.fadeOut=.01,this.player.stop()),this._pendingOffset=null,this.player.seek(0)}seek(e){const t="started"===this.player.state,n=Math.max(0,Math.min(e,this._duration));t?(this.player.stop(),this.player.start(void 0,n)):this._pendingOffset=n}setPlaybackRate(e){this._playbackRate=e,this.player.playbackRate=e}getPlaybackRate(){return this._playbackRate}getPosition(){if(!this._loaded)return 0;if(null!==this._pendingOffset)return this._pendingOffset;try{const e=Y(),t=this.player._state;if(t){if("started"===t.getValueAtTime(e)){const n=t._timeline;if(n&&n.length>0)for(let t=n.length-1;t>=0;t--){const s=n[t];if("started"===s.state){const t=(e-s.time)*this._playbackRate,n=(s.offset||0)+t;return this._duration>0?n%this._duration:0}}}}}catch{}return 0}getDuration(){return this._duration}isLoaded(){return this._loaded}isCurrentlyPlaying(){return"started"===this.player.state}getWaveformPeaks(){return this._waveformPeaks}computeWaveformPeaks(e,t){const n=new Float32Array(t),s=Math.floor(e.length/t),a=e.getChannelData(0),o=e.numberOfChannels>1?e.getChannelData(1):null;for(let r=0;r<t;r++){const t=r*s,i=Math.min(t+s,e.length);let l=0;for(let e=t;e<i;e++){let t=Math.abs(a[e]);o&&(t=(t+Math.abs(o[e]))/2),t>l&&(l=t)}n[r]=l}return n}setLoopRegion(e,t){this._loopIn=e,this._loopOut=t,null!==e&&null!==t&&t>e?this.startLoopCheck():this.stopLoopCheck()}getLoopIn(){return this._loopIn}getLoopOut(){return this._loopOut}startLoopCheck(){this.stopLoopCheck();const e=()=>{if(null===this._loopIn||null===this._loopOut)return void this.stopLoopCheck();this.getPosition()>=this._loopOut&&this.seek(this._loopIn),this._loopCheckTimer=requestAnimationFrame(e)};this._loopCheckTimer=requestAnimationFrame(e)}stopLoopCheck(){null!==this._loopCheckTimer&&(cancelAnimationFrame(this._loopCheckTimer),this._loopCheckTimer=null)}dispose(){this.stopLoopCheck();try{this.player.stop()}catch{}this.player.disconnect(),this.player.dispose(),this._loaded=!1,this._waveformPeaks=null}}const rO=re.prototype._onSourceEnd;rO&&!re.prototype.__scratchPatched&&(re.prototype.__scratchPatched=!0,re.prototype._onSourceEnd=function(...e){try{return rO.apply(this,e)}catch{}});class iO{id;replayer;audioPlayer;_playbackMode="audio";deckGain;eq3;filter;pitchShift;channelGain;meter;waveformAnalyser;fftAnalyser;currentSongInstrumentIds=[];routedNativeEngines=new Set;scratchPlayback;restMultiplier=1;isScratchActive=!1;backwardPauseTimeoutId=null;decayRafId=null;patternScratchActive=!1;patternScratchDir=1;patternStartSongPos=0;patternStartPattPos=0;patternStartAudioPos=0;scratchBuffer=null;scratchBufferReady=!1;scratchDirection=1;backwardStartSongPos=0;backwardStartPattPos=0;backwardStartElapsedMs=0;songTimeIndex=[];eqKillState={low:!1,mid:!1,high:!1};eqValues={low:0,mid:0,high:0};filterPosition=0;filterResonance=1;keyLockEnabled=!1;currentPitchSemitones=0;_slipEnabled=!1;slipGhostPosition=0;slipGhostStartTime=0;slipGhostRate=1;constructor(e){this.id=e.id,this.deckGain=new m(1),this.eq3=new f({low:0,mid:0,high:0}),this.filter=new h({type:"lowpass",frequency:2e4,Q:1}),this.pitchShift=new F({pitch:0,windowSize:.1,delayTime:0}),this.channelGain=new m(1),this.meter=new E({smoothing:.8}),this.waveformAnalyser=new pe("waveform",256),this.fftAnalyser=new he(1024),this.deckGain.connect(this.eq3),this.eq3.connect(this.filter),this.filter.connect(this.pitchShift),this.pitchShift.connect(this.channelGain),this.channelGain.connect(e.outputNode),this.channelGain.connect(this.meter),this.channelGain.connect(this.waveformAnalyser),this.channelGain.connect(this.fftAnalyser),this.replayer=new dD(this.deckGain),this.replayer.setMuted(!0),this.audioPlayer=new oO(this.deckGain),this.scratchPlayback=new OP(()=>this,()=>this.getEffectiveBPM()),this.scratchPlayback.onPatternEnd=()=>{this._endPatternScratch(),this.isScratchActive||(null!==this.decayRafId&&(cancelAnimationFrame(this.decayRafId),this.decayRafId=null),this.replayer.setPitchMultiplier(this.restMultiplier),this.replayer.setTempoMultiplier(this.restMultiplier))},this.replayer.onScratchEffect=e=>this._handleScratchEffect(e),this._initScratchBuffer()}async hotSwapToAudio(e,t){const n=this.isPlaying(),s=this.replayer.getElapsedMs()/1e3,a=this.currentPitchSemitones,o=await this.loadAudioFile(e,t);this.setPitch(a),this.audioPlayer.seek(s),W_.getState().setDeckState(this.id,{playbackMode:"audio",durationMs:1e3*o.duration,waveformPeaks:o.waveformPeaks,audioPosition:s,elapsedMs:1e3*s}),n?(this.replayer.stop(),await this.audioPlayer.play()):this.replayer.stop(),this.restoreNativeRouting(),this.unregisterOutputOverrides()}async _initScratchBuffer(){try{const e=N().rawContext,t="A"===this.id?0:"B"===this.id?1:2;this.scratchBuffer=new DP(e,t),await this.scratchBuffer.init(),this.scratchBuffer.wireIntoChain(this.filter,this.channelGain),this.scratchBufferReady=!0}catch(e){}}async loadSong(e){this.audioPlayer.stop(),this._playbackMode="audio",this.unregisterOutputOverrides(),this.restoreNativeRouting();const t=Bw();this.currentSongInstrumentIds=e.instruments.map(e=>e.id);for(const o of this.currentSongInstrumentIds)t.setInstrumentOutputOverride(o,this.deckGain);this.replayer.loadSong(e);const n=Ck.getState();if(this.replayer.setStereoSeparation(n.stereoSeparation),this.replayer.setStereoSeparationMode(n.stereoSeparationMode),this.replayer.setModplugSeparation(n.modplugSeparation),e.compatFlags&&Object.keys(e.compatFlags).length>0){const{FurnaceDispatchEngine:t}=await os(async()=>{const{FurnaceDispatchEngine:e}=await Promise.resolve().then(()=>Ec);return{FurnaceDispatchEngine:e}},void 0);t.getInstance().setCompatFlags(e.compatFlags)}this.songTimeIndex=this._buildTimeIndex(e),await t.preloadInstruments(e.instruments),await t.ensureWASMSynthsReady(e.instruments);const s=co(this.deckGain),a=co(this.replayer.getSeparationInput());if(s)for(const o of e.instruments){const e=o.synthType||"";e.startsWith("Furnace")?(t.rerouteNativeEngine("FurnaceChipEngine",s),t.rerouteNativeEngine("FurnaceDispatchEngine",s),this.routedNativeEngines.add("FurnaceChipEngine"),this.routedNativeEngines.add("FurnaceDispatchEngine")):"UADESynth"!==e&&"HivelySynth"!==e||!a||(t.rerouteNativeEngine(e,a),this.routedNativeEngines.add(e))}}async loadAudioFile(e,t){return this.replayer.stop(),this.audioPlayer.stop(),this._playbackMode="audio",this.audioPlayer.loadAudioFile(e,t)}get playbackMode(){return this._playbackMode}async play(){"audio"===this._playbackMode?await this.audioPlayer.play():"tracker"===this._playbackMode&&await this.replayer.play()}pause(){"audio"===this._playbackMode?this.audioPlayer.pause():"tracker"===this._playbackMode&&this.replayer.pause()}async resume(){"audio"===this._playbackMode?await this.audioPlayer.play():"tracker"===this._playbackMode&&this.replayer.resume()}stop(){"audio"===this._playbackMode?this.audioPlayer.stop():"tracker"===this._playbackMode&&this.replayer.stop()}isPlaying(){return"audio"===this._playbackMode?this.audioPlayer.isCurrentlyPlaying():this.replayer.isPlaying()}cue(e,t=0){"audio"===this._playbackMode?this.audioPlayer.seek(e):this.replayer.jumpToPosition(e,t)}setPitch(e){const t=Math.pow(2,e/12);this.restMultiplier=t,this.currentPitchSemitones=e,"audio"===this._playbackMode?(this.audioPlayer.setPlaybackRate(t),this.replayer.setTempoMultiplier(1),this.replayer.setPitchMultiplier(1),this.replayer.setDetuneCents(0)):(this.replayer.setTempoMultiplier(t),this.replayer.setPitchMultiplier(t),this.replayer.setDetuneCents(100*e),this.audioPlayer.setPlaybackRate(1)),this.keyLockEnabled&&Math.abs(e)>.01?this.pitchShift.pitch=-e:this.keyLockEnabled||(this.pitchShift.pitch=0)}nudge(e,t=8){this.replayer.setNudge(e,t)}setKeyLock(e){this.keyLockEnabled=e,e&&Math.abs(this.currentPitchSemitones)>.01?this.pitchShift.pitch=-this.currentPitchSemitones:this.pitchShift.pitch=0}getKeyLock(){return this.keyLockEnabled}_buildTimeIndex(e){const t=e.initialBPM??125,n=2.5*(e.initialSpeed??6)/t*1e3,s=[0];for(let a=0;a<e.songLength;a++){const t=e.songPositions[a],o=e.patterns[t];s.push(s[a]+(o?.length??64)*n)}return s}getPositionAtTime(e){const t=this.replayer.getSong();if(!t||this.songTimeIndex.length<=1)return null;let n=0,s=this.songTimeIndex.length-2;for(;n<s;){const t=n+s+1>>1;(this.songTimeIndex[t]??0)<=e?n=t:s=t-1}const a=n,o=2.5*(t.initialSpeed??6)/(t.initialBPM??125)*1e3,r=Math.max(0,Math.floor((e-(this.songTimeIndex[a]??0))/o)),i=t.songPositions[a],l=t.patterns[i];return{songPos:a,pattPos:Math.min(r,(l?.length??64)-1)}}getEffectiveBPM(){return this.replayer.getBPM()*this.replayer.getTempoMultiplier()}startScratch(){this.isScratchActive||(this.isScratchActive=!0,null!==this.decayRafId&&(cancelAnimationFrame(this.decayRafId),this.decayRafId=null),this.scratchDirection=1,this._slipEnabled&&"audio"===this._playbackMode&&(this.slipGhostPosition=this.audioPlayer.getPosition(),this.slipGhostStartTime=performance.now(),this.slipGhostRate=this.audioPlayer.getPlaybackRate()))}setScratchVelocity(e){const t=Math.max(-4,Math.min(4,e));if(this.patternScratchActive){const e=Math.abs(t),n="audio"===this._playbackMode;if(e<.1)return void(1===this.patternScratchDir?n?this.audioPlayer.setPlaybackRate(.15):(this.replayer.setTempoMultiplier(.15),this.replayer.setPitchMultiplier(.15)):this.scratchBuffer?.setRate(.05));if(t>0){const e=Math.max(.15,t);-1===this.patternScratchDir&&(this.scratchBuffer?.silenceAndStop(),this.scratchBuffer?.unfreezeCapture(),this.deckGain.gain.rampTo(1,.005),this.patternScratchDir=1),n?this.audioPlayer.setPlaybackRate(e):(this.replayer.setTempoMultiplier(e),this.replayer.setPitchMultiplier(e))}else 1===this.patternScratchDir?(this.scratchBuffer?.freezeCapture(),this.deckGain.gain.rampTo(0,.005),this.scratchBuffer?.startReverseFromWritePos(e),n?this.audioPlayer.setPlaybackRate(.001):(this.replayer.setTempoMultiplier(.001),this.replayer.setPitchMultiplier(.001)),this.patternScratchDir=-1):this.scratchBuffer?.setRate(e);return}if("audio"===this._playbackMode)t>=0?-1===this.scratchDirection?this._switchToForward(Math.max(.15,t)):this.audioPlayer.setPlaybackRate(Math.max(.15,t)):-1!==this.scratchDirection?this._switchToBackward(Math.abs(t)):this.scratchBuffer?.setRate(Math.abs(t));else if(t>=0)if(-1===this.scratchDirection)this._switchToForward(Math.max(.15,t));else{const e=Math.max(.15,t);this.replayer.setPitchMultiplier(e),this.replayer.setTempoMultiplier(e)}else-1!==this.scratchDirection?this._switchToBackward(Math.abs(t)):this.scratchBuffer?.setRate(Math.abs(t))}stopScratch(e=200){this.isScratchActive&&(this.isScratchActive=!1,this.slipSnapBack(),-1===this.scratchDirection?this._switchToForward(1).then(()=>this._decayToRest(e)):this._decayToRest(e))}_switchToBackward(e){this.scratchBufferReady&&this.scratchBuffer?(this.backwardStartSongPos=this.replayer.getSongPos(),this.backwardStartPattPos=this.replayer.getPattPos(),this.backwardStartElapsedMs="audio"===this._playbackMode?1e3*this.audioPlayer.getPosition():this.replayer.getElapsedMs(),this.scratchPlayback.stopPattern(),this.deckGain.gain.rampTo(0,.02),this.scratchBuffer.startReverse(e),this.scratchDirection=-1,this.backwardPauseTimeoutId=setTimeout(()=>{this.backwardPauseTimeoutId=null,-1===this.scratchDirection&&("audio"===this._playbackMode?this.audioPlayer.setPlaybackRate(.001):this.replayer.pause())},25)):"audio"===this._playbackMode?this.audioPlayer.setPlaybackRate(.02):(this.replayer.setPitchMultiplier(.02),this.replayer.setTempoMultiplier(.02))}async _switchToForward(e){this.scratchDirection=1;const t=(this.scratchBuffer?await this.scratchBuffer.stopReverse():0)/N().rawContext.sampleRate*1e3,n=Math.max(0,this.backwardStartElapsedMs-t);if("audio"===this._playbackMode)this.audioPlayer.seek(n/1e3),this.deckGain.gain.rampTo(1,.02),this.audioPlayer.setPlaybackRate(e);else{const t=this.replayer.getSong();if(t&&this.songTimeIndex.length>1){let e=0,s=this.songTimeIndex.length-2;for(;e<s;){const t=e+s+1>>1;(this.songTimeIndex[t]??0)<=n?e=t:s=t-1}const a=e,o=2.5*(t.initialSpeed??6)/(t.initialBPM??125)*1e3,r=Math.max(0,Math.floor((n-(this.songTimeIndex[a]??0))/o)),i=t.songPositions[a],l=t.patterns[i],c=Math.min(r,(l?.length??64)-1);this.replayer.seekTo(a,c)}else this.replayer.seekTo(this.backwardStartSongPos,this.backwardStartPattPos);this.replayer.resume(),this.deckGain.gain.rampTo(1,.02),this.replayer.setPitchMultiplier(e),this.replayer.setTempoMultiplier(e)}}_decayToRest(e=200){null!==this.decayRafId&&(cancelAnimationFrame(this.decayRafId),this.decayRafId=null);const t="audio"===this._playbackMode,n=t?this.audioPlayer.getPlaybackRate():this.replayer.getTempoMultiplier(),s=this.restMultiplier;if(Math.abs(n-s)<.001)return void(t?this.audioPlayer.setPlaybackRate(s):(this.replayer.setPitchMultiplier(s),this.replayer.setTempoMultiplier(s)));const a=performance.now(),o=()=>{const r=Math.min(1,(performance.now()-a)/e),i=1-Math.pow(1-r,3),l=n+(s-n)*i;t?this.audioPlayer.setPlaybackRate(l):(this.replayer.setPitchMultiplier(l),this.replayer.setTempoMultiplier(l)),this.decayRafId=r<1?requestAnimationFrame(o):null};this.decayRafId=requestAnimationFrame(o)}getChannelGainParam(){return this.channelGain.gain._param}playPattern(e,t){const n=function(e){return VP.find(t=>t.name===e)}(e);if(!n)return;null!==this.decayRafId&&(cancelAnimationFrame(this.decayRafId),this.decayRafId=null),this.patternStartSongPos=this.replayer.getSongPos(),this.patternStartPattPos=this.replayer.getPattPos(),"audio"===this._playbackMode&&(this.patternStartAudioPos=this.audioPlayer.getPosition()),this.patternScratchActive=!0,this.patternScratchDir=1;const s=this.getEffectiveBPM();"Transformer"===n.name?this.scratchPlayback.scheduleTransformerFader(s):"Crab"===n.name?this.scratchPlayback.scheduleCrabFader(s):"8-Finger Crab"===n.name&&this.scratchPlayback.scheduleEightFingerCrabFader(s),this.scratchPlayback.play(n,t)}stopPattern(){this.scratchPlayback.stopPattern(),this._endPatternScratch(),this.isScratchActive||this._decayToRest(300)}_endPatternScratch(){this.patternScratchActive&&(this.patternScratchActive=!1,-1===this.patternScratchDir&&this.scratchBufferReady&&this.scratchBuffer&&(this.scratchBuffer.silenceAndStop(),this.scratchBuffer.unfreezeCapture(),this.deckGain.gain.rampTo(1,.005)),"audio"===this._playbackMode?(this.audioPlayer.seek(this.patternStartAudioPos),this.audioPlayer.setPlaybackRate(this.restMultiplier)):(this.replayer.seekTo(this.patternStartSongPos,this.patternStartPattPos),this.replayer.setTempoMultiplier(this.restMultiplier),this.replayer.setPitchMultiplier(this.restMultiplier)),this.patternScratchDir=1)}isPatternWaiting(){return this.scratchPlayback.isWaiting()}isPatternActive(){return this.scratchPlayback.isPatternActive()}finishPatternCycle(){this.scratchPlayback.finishCurrentCycle()}startFaderLFO(e){this.scratchPlayback.startFaderLFO(this.getEffectiveBPM(),e)}stopFaderLFO(){this.scratchPlayback.stopFaderLFO()}notifyBPMChange(e){this.scratchPlayback.onBPMChange(e)}getScratchState(){return{velocity:this.scratchPlayback.currentVelocity,faderGain:this.scratchPlayback.currentFaderGain}}_handleScratchEffect(e){const t=e>>4&15,n=15&e;if(0===t){const e=["","Baby Scratch","Transformer","Flare","Hydroplane","Crab","Orbit"];0===n?this.stopPattern():n<e.length&&(this.stopPattern(),this.playPattern(e[n]))}else if(1===t){const e=[null,"1/4","1/8","1/16","1/32"][n]??null;null===e?this.stopFaderLFO():this.startFaderLFO(e)}}setEQ(e,t){const n=Math.max(-24,Math.min(6,t));this.eqValues[e]=n,this.eqKillState[e]||(this.eq3[e].value=n)}setEQKill(e,t){this.eqKillState[e]=t,this.eq3[e].value=t?-1/0:this.eqValues[e]}getEQKill(e){return this.eqKillState[e]}setFilterPosition(e){if(this.filterPosition=Math.max(-1,Math.min(1,e)),this.filterPosition>=0){this.filter.type="lowpass";const e=2e4*Math.pow(.005,this.filterPosition);this.filter.frequency.rampTo(e,.05)}else{this.filter.type="highpass";const e=-this.filterPosition,t=20*Math.pow(500,e);this.filter.frequency.rampTo(t,.05)}}setFilterResonance(e){this.filterResonance=Math.max(.5,Math.min(15,e)),this.filter.Q.rampTo(this.filterResonance,.05)}setTrimGain(e){const t=Math.pow(10,e/20);this.deckGain.gain.rampTo(Math.max(0,Math.min(4,t)),.05)}setVolume(e){this.channelGain.gain.rampTo(Math.max(0,Math.min(1.5,e)),.02)}getVolume(){return this.channelGain.gain.value}getChannelGain(){return this.channelGain}getLevel(){return this.meter.getValue()}setLineLoop(e){const t=this.replayer.getCurrentRow(),n=Math.floor(t/e)*e;this.replayer.setLineLoop(n,e)}clearLineLoop(){this.replayer.clearLineLoop()}setPatternLoop(e,t){this.replayer.setPatternLoop(e,t)}clearPatternLoop(){this.replayer.clearPatternLoop()}setAudioLoop(e,t){this.audioPlayer.setLoopRegion(e,t)}clearAudioLoop(){this.audioPlayer.setLoopRegion(null,null)}setSlipEnabled(e){this._slipEnabled=e,"audio"===this._playbackMode?e&&(this.slipGhostPosition=this.audioPlayer.getPosition(),this.slipGhostStartTime=performance.now(),this.slipGhostRate=this.audioPlayer.getPlaybackRate()):this.replayer.setSlipEnabled(e)}getSlipGhostPosition(){if(!this._slipEnabled)return-1;if("audio"===this._playbackMode){const e=(performance.now()-this.slipGhostStartTime)/1e3;return this.slipGhostPosition+e*this.slipGhostRate}const e=this.replayer.getSlipState();return e.enabled?e.songPos:-1}slipSnapBack(){if(this._slipEnabled&&"audio"===this._playbackMode){const e=this.getSlipGhostPosition();e>=0&&(this.audioPlayer.seek(e),this.slipGhostPosition=e,this.slipGhostStartTime=performance.now())}}getWaveform(){return this.waveformAnalyser.getValue()}getFFT(){return this.fftAnalyser.getValue()}unregisterOutputOverrides(){if(this.currentSongInstrumentIds.length>0){const e=Bw();for(const t of this.currentSongInstrumentIds)e.removeInstrumentOutputOverride(t);this.currentSongInstrumentIds=[]}}restoreNativeRouting(){if(this.routedNativeEngines.size>0){const e=Bw();for(const t of this.routedNativeEngines)e.restoreNativeEngineRouting(t);this.routedNativeEngines.clear()}}dispose(){this.unregisterOutputOverrides(),this.restoreNativeRouting(),this.scratchPlayback.dispose(),this.scratchBuffer?.dispose(),null!==this.decayRafId&&(cancelAnimationFrame(this.decayRafId),this.decayRafId=null),null!==this.backwardPauseTimeoutId&&(clearTimeout(this.backwardPauseTimeoutId),this.backwardPauseTimeoutId=null),this.replayer.dispose(),this.audioPlayer.dispose(),this.fftAnalyser.dispose(),this.waveformAnalyser.dispose(),this.meter.dispose(),this.channelGain.dispose(),this.filter.dispose(),this.pitchShift.dispose(),this.eq3.dispose(),this.deckGain.dispose()}}class lO{inputA;inputB;inputC;samplerInput;masterGain;limiter;masterMeter;masterEffectsNodes=[];masterEffectsRebuildVersion=0;cueEngine=null;pflConnections=new Map;position=.5;curve="smooth";constructor(){this.inputA=new m(1),this.inputB=new m(1),this.inputC=new m(1);const e=N().rawContext;this.samplerInput=e.createGain(),this.samplerInput.gain.value=1,this.masterGain=new m(1),this.limiter=new w({threshold:-1,ratio:20,attack:.003,release:.1}),this.masterMeter=new E({smoothing:.8}),this.inputA.connect(this.masterGain),this.inputB.connect(this.masterGain),this.inputC.connect(this.masterGain);const t=this.masterGain.input;this.samplerInput.connect(t),this.masterGain.connect(this.limiter),this.limiter.toDestination(),this.limiter.connect(this.masterMeter),this.applyCrossfader()}setCrossfader(e){this.position=Math.max(0,Math.min(1,e)),this.applyCrossfader()}getCrossfader(){return this.position}setCurve(e){this.curve=e,this.applyCrossfader()}getCurve(){return this.curve}applyCrossfader(){let e,t;switch(this.curve){case"linear":e=1-this.position,t=this.position;break;case"cut":{const n=.05;e=this.position>1-n?0:1,t=this.position<n?0:1;break}default:e=Math.cos(this.position*Math.PI/2),t=Math.sin(this.position*Math.PI/2)}this.inputA.gain.rampTo(e,.01),this.inputB.gain.rampTo(t,.01)}setMasterVolume(e){this.masterGain.gain.rampTo(Math.max(0,Math.min(1.5,e)),.02)}getMasterVolume(){return this.masterGain.gain.value}getMasterLevel(){return this.masterMeter.getValue()}getMasterGain(){return this.masterGain}setCueEngine(e){this.cueEngine=e}setPFL(e,t){if(!this.cueEngine)return;const n=this.getInputForDeck(e);if(n){if(t){let t=this.pflConnections.get(e);t||(t=new m(1),this.pflConnections.set(e,t),n.connect(t),t.connect(this.cueEngine.getCueInput()))}else{const t=this.pflConnections.get(e);t&&(t.disconnect(),t.dispose(),this.pflConnections.delete(e))}this.cueEngine.setPFL(e,t)}}getInputForDeck(e){switch(e){case"A":return this.inputA;case"B":return this.inputB;case"C":return this.inputC;default:return null}}async rebuildMasterEffects(e){const t=++this.masterEffectsRebuildVersion;this.masterGain.disconnect();for(const o of this.masterEffectsNodes)try{o.disconnect(),o.dispose()}catch{}this.masterEffectsNodes=[];const n=e.filter(e=>e.enabled);if(0===n.length)return void this.masterGain.connect(this.limiter);if("suspended"===N().state)try{await A()}catch{}const s=[];for(const o of n){if(t!==this.masterEffectsRebuildVersion)return void s.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}});try{const e=await JN.createEffect(o);s.push(e)}catch(a){}}if(t===this.masterEffectsRebuildVersion)if(0!==s.length){this.masterEffectsNodes=s,this.masterGain.connect(s[0]);for(let e=0;e<s.length-1;e++)s[e].connect(s[e+1]);s[s.length-1].connect(this.limiter)}else this.masterGain.connect(this.limiter);else s.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}})}dispose(){this.pflConnections.forEach(e=>{e.disconnect(),e.dispose()}),this.pflConnections.clear();for(const e of this.masterEffectsNodes)try{e.disconnect(),e.dispose()}catch{}this.masterEffectsNodes=[],this.inputA.dispose(),this.inputB.dispose(),this.inputC.dispose(),this.samplerInput.disconnect(),this.masterGain.dispose(),this.limiter.dispose(),this.masterMeter.dispose()}}class cO{cueGain;cueMode="none";mediaStreamDest=null;audioElement=null;merger=null;mainSplitGain=null;cueSplitGain=null;pflA=!1;pflB=!1;constructor(){this.cueGain=new m(1)}getCueInput(){return this.cueGain}static supportsSetSinkId(){return"undefined"!=typeof HTMLAudioElement&&"setSinkId"in HTMLAudioElement.prototype}static async getOutputDevices(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(e=>"audiooutput"===e.kind)}catch{return[]}}async init(){return cO.supportsSetSinkId()?(this.cueMode="multi-output",await this.initMultiOutput()):this.cueMode="none",this.cueMode}getCueMode(){return this.cueMode}async initMultiOutput(){const e=N().rawContext;this.mediaStreamDest=e.createMediaStreamDestination(),this.cueGain.connect(this.mediaStreamDest),this.audioElement=new Audio,this.audioElement.srcObject=this.mediaStreamDest.stream,this.audioElement.autoplay=!0}async setCueDevice(e){if("multi-output"===this.cueMode&&this.audioElement)try{await this.audioElement.setSinkId(e)}catch(t){}}initSplitStereo(e){const t=N().rawContext;this.merger=t.createChannelMerger(2),this.mainSplitGain=t.createGain(),this.cueSplitGain=t.createGain(),e.connect(this.mainSplitGain),this.mainSplitGain.connect(this.merger,0,0),this.cueGain.connect(this.cueSplitGain),this.cueSplitGain.connect(this.merger,0,1),this.merger.connect(t.destination),this.cueMode="split-stereo"}setPFL(e,t){"A"===e?this.pflA=t:this.pflB=t}getPFL(e){return"A"===e?this.pflA:this.pflB}setCueVolume(e){this.cueGain.gain.rampTo(Math.max(0,Math.min(1.5,e)),.02)}dispose(){this.audioElement&&(this.audioElement.pause(),this.audioElement.srcObject=null,this.audioElement=null),this.mediaStreamDest&&(this.mediaStreamDest=null),this.merger&&(this.merger.disconnect(),this.merger=null),this.mainSplitGain&&(this.mainSplitGain.disconnect(),this.mainSplitGain=null),this.cueSplitGain&&(this.cueSplitGain.disconnect(),this.cueSplitGain=null),this.cueGain.dispose()}}const uO={A:1e4,B:2e4,C:3e4};class dO{deckA;deckB;deckC;mixer;cueEngine;disposed=!1;constructor(){this.cueEngine=new cO,this.mixer=new lO,this.mixer.setCueEngine(this.cueEngine),this.deckA=new iO({id:"A",outputNode:this.mixer.inputA}),this.deckB=new iO({id:"B",outputNode:this.mixer.inputB}),this.deckC=new iO({id:"C",outputNode:this.mixer.inputC}),this.cueEngine.init().catch(e=>{})}getDeck(e){switch(e){case"A":return this.deckA;case"B":return this.deckB;case"C":return this.deckC}}async loadToDeck(e,t,n,s){const a=uO[e];this.remapInstrumentIds(t,a);const o=this.getDeck(e);await o.loadSong(t),W_.getState().setDeckState(e,{fileName:n,trackName:t.name||n,detectedBPM:s,effectiveBPM:s,playbackMode:"tracker",durationMs:0,waveformPeaks:null,totalPositions:t.songLength,songPos:0,pattPos:0,elapsedMs:0})}remapInstrumentIds(e,t){for(const n of e.instruments)n.id=n.id+t;for(const n of e.patterns)for(const e of n.channels){e.instrumentId&&e.instrumentId>0&&(e.instrumentId=e.instrumentId+t);for(const n of e.rows)n.instrument&&n.instrument>0&&(n.instrument=n.instrument+t)}}async loadAudioToDeck(e,t,n,s,a,o){const r=this.getDeck(e);if(o){const t=uO[e];this.remapInstrumentIds(o,t),await r.loadSong(o)}const i=await r.loadAudioFile(t,n);return W_.getState().setDeckState(e,{fileName:n,trackName:s||n,detectedBPM:a||125,effectiveBPM:a||125,playbackMode:"audio",durationMs:1e3*i.duration,waveformPeaks:i.waveformPeaks,audioPosition:0,elapsedMs:0,...o?{totalPositions:o.songLength,songPos:0,pattPos:0}:{}}),i}setCrossfader(e){this.mixer.setCrossfader(e)}setCrossfaderCurve(e){this.mixer.setCurve(e)}killAll(){this.deckA.stop(),this.deckB.stop(),this.deckC.stop(),this.mixer.setCrossfader(.5)}dispose(){this.disposed||(this.disposed=!0,this.deckA.dispose(),this.deckB.dispose(),this.deckC.dispose(),this.mixer.dispose(),this.cueEngine.dispose())}}let mO=null;function pO(){return mO||(mO=new dO),mO}function hO(){return mO}function fO(){mO&&(mO.dispose(),mO=null)}const gO={overlay:!0,showBgColor:!1,showScaleX:!1,showScaleY:!1,fftSize:8192,smoothing:.7,frequencyScale:"log",showPeaks:!0,weightingFilter:""},bO={ledBars:{...gO,mode:6,ledBars:!0,trueLeds:!0,gradient:"classic",barSpace:.5,showPeaks:!0},smoothBars:{...gO,mode:4,roundBars:!0,barSpace:.25,gradient:"prism",showPeaks:!0},mirrorBars:{...gO,mode:5,mirror:-1,reflexRatio:.35,reflexAlpha:.25,gradient:"prism",barSpace:.3},graphLine:{...gO,mode:10,fillAlpha:.5,lineWidth:1.5,peakLine:!0,gradient:"rainbow"},radialSpectrum:{...gO,mode:3,radial:!0,gradient:"rainbow",spinSpeed:1,barSpace:.3},radialGraph:{...gO,mode:10,radial:!0,fillAlpha:.6,reflexRatio:.4,reflexAlpha:.2,gradient:"prism",lineWidth:1.5},dualStereo:{...gO,mode:6,channelLayout:"dual-horizontal",ledBars:!0,gradient:"classic",barSpace:.5,stereo:!0},lumiBars:{...gO,mode:4,lumiBars:!0,gradient:"orangered",barSpace:.1,showPeaks:!1},alphaBars:{...gO,mode:3,alphaBars:!0,roundBars:!0,barSpace:.4,gradient:"steelblue",showPeaks:!1},outlineBars:{...gO,mode:5,outlineBars:!0,barSpace:.3,gradient:"prism",lineWidth:1.5,fillAlpha:0,showPeaks:!0,fadePeaks:!0},dualVertical:{...gO,mode:6,channelLayout:"dual-vertical",roundBars:!0,gradient:"rainbow",barSpace:.3,splitGradient:!0},dualOverlay:{...gO,mode:10,channelLayout:"dual-combined",fillAlpha:.4,lineWidth:1.5,gradient:"steelblue"},barkSpectrum:{...gO,mode:4,frequencyScale:"bark",roundBars:!0,barSpace:.2,gradient:"orangered",reflexRatio:.3,reflexAlpha:.2},melGraph:{...gO,mode:10,frequencyScale:"mel",fillAlpha:.6,lineWidth:2,gradient:"prism",peakLine:!0},octaveBands:{...gO,mode:8,roundBars:!0,barSpace:.15,gradient:"classic",showPeaks:!0,fadePeaks:!0,peakFadeTime:1e3,peakHoldTime:200},noteLabels:{...gO,mode:7,ledBars:!0,trueLeds:!0,gradient:"rainbow",barSpace:.4,noteLabels:!0,showScaleX:!0},mirrorReflex:{...gO,mode:4,mirror:1,reflexRatio:.5,reflexAlpha:.3,reflexBright:.8,roundBars:!0,barSpace:.2,gradient:"rainbow",fadePeaks:!0},radialInvert:{...gO,mode:4,radial:!0,radialInvert:!0,gradient:"orangered",barSpace:.2,spinSpeed:-2,radius:.3},radialLED:{...gO,mode:6,radial:!0,ledBars:!0,trueLeds:!0,gradient:"classic",barSpace:.5,spinSpeed:.5,radius:.2},linearBars:{...gO,mode:3,linearAmplitude:!0,linearBoost:1.8,roundBars:!0,barSpace:.3,gradient:"steelblue",showPeaks:!0},aWeighted:{...gO,mode:5,weightingFilter:"A",roundBars:!0,barSpace:.25,gradient:"prism",reflexRatio:.2,reflexAlpha:.15},lumiMirror:{...gO,mode:3,lumiBars:!0,mirror:-1,gradient:"orangered",barSpace:.05,showPeaks:!1}},vO=({preset:e,audioSource:t,height:n})=>{const s=l.useRef(null),a=l.useRef(null);return l.useEffect(()=>{const o=s.current;if(!o)return;let r;try{r=oo()}catch{return}const i=new G_(o,{audioCtx:r,connectSpeakers:!1,overlay:!0,...bO[e]??bO.ledBars,loRes:void 0!==n&&n<=100});a.current=i;let l=!1;try{if("master"===t){const e=Bw();e.enableAnalysers();const t=co(e.masterChannel);t&&(i.connectInput(t),l=!0)}else{const e="deckA"===t?"A":"B",n=co(pO().getDeck(e).getChannelGain());n&&i.connectInput(n)}}catch(c){}return()=>{try{i.destroy()}catch{}if(a.current=null,l)try{Bw().disableAnalysers()}catch{}}},[t]),l.useEffect(()=>{const t=a.current;if(!t||t.isDestroyed)return;const n=bO[e]??bO.ledBars;t.setOptions(n)},[e]),Yn.jsxDEV("div",{ref:s,style:{width:"100%",height:void 0!==n?n:"100%",position:"relative",overflow:"hidden"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/AudioMotionVisualizer.tsx",lineNumber:110,columnNumber:5},void 0)},yO=[...HP.filter(e=>"pattern"!==e&&!e.startsWith("am")).map(e=>({type:"webgl",mode:e})),{type:"am",preset:"ledBars",label:"LED BARS"},{type:"am",preset:"smoothBars",label:"SMOOTH BARS"},{type:"am",preset:"mirrorBars",label:"MIRROR BARS"},{type:"am",preset:"graphLine",label:"GRAPH LINE"},{type:"am",preset:"radialSpectrum",label:"RADIAL SPIN"},{type:"am",preset:"radialGraph",label:"RADIAL GRAPH"},{type:"am",preset:"dualStereo",label:"DUAL STEREO"},{type:"am",preset:"lumiBars",label:"LUMI BARS"},{type:"am",preset:"alphaBars",label:"GHOST BARS"},{type:"am",preset:"outlineBars",label:"OUTLINE"},{type:"am",preset:"dualVertical",label:"DUAL VERTICAL"},{type:"am",preset:"dualOverlay",label:"DUAL OVERLAY"},{type:"am",preset:"barkSpectrum",label:"BARK"},{type:"am",preset:"melGraph",label:"MEL GRAPH"},{type:"am",preset:"octaveBands",label:"OCTAVE BANDS"},{type:"am",preset:"noteLabels",label:"NOTE LABELS"},{type:"am",preset:"mirrorReflex",label:"MIRROR REFLEX"},{type:"am",preset:"radialInvert",label:"RADIAL INVERT"},{type:"am",preset:"radialLED",label:"RADIAL LED"},{type:"am",preset:"linearBars",label:"LINEAR"},{type:"am",preset:"aWeighted",label:"A-WEIGHTED"},{type:"am",preset:"lumiMirror",label:"LUMI MIRROR"}];function xO(e){return"am"===e.type?e.label:WP[e.mode]??e.mode}const NO={waveform:new Float32Array(256),fft:new Float32Array(1024),rms:0,peak:0,bassEnergy:0,midEnergy:0,highEnergy:0};const wO=a.memo(({width:e,height:t})=>{const n=l.useRef(null),s=l.useRef(null),a=l.useRef(null),o=l.useRef($P()),r=l.useRef(0),i=l.useRef(performance.now()/1e3),c=Ck(e=>e.trackerVisualMode),u=Ck(e=>e.setTrackerVisualMode),d=yO[c%yO.length],m="am"===d.type,p=l.useRef(d);p.current=d;const h=xO(d),f=l.useCallback(()=>{u((c+1)%yO.length)},[c,u]);return l.useEffect(()=>{const l=n.current;if(!l||0===e||0===t)return;if(!s.current){const e=l.getContext("webgl2",{alpha:!0,antialias:!1,depth:!1,stencil:!1,powerPreference:"high-performance",premultipliedAlpha:!1});if(!e)return;e.getExtension("EXT_color_buffer_float"),s.current=e,a.current=JP(e)}const c=s.current,u=a.current,d=o.current;let m=!0;const h=Math.min(window.devicePixelRatio,2),f=Math.round(e*h),g=Math.round(t*h);l.width===f&&l.height===g||(l.width=f,l.height=g);const b=()=>{if(!m)return;const e=p.current;if("webgl"===e.type){c.viewport(0,0,f,g);const t=function(){try{const e=Bw();e.enableAnalysers();const t=e.getWaveform(),n=e.getFFT();let s=0,a=0;for(let m=0;m<t.length;m++){const e=t[m];s+=e*e;const n=Math.abs(e);n>a&&(a=n)}const o=Math.sqrt(s/t.length),r=e=>Math.max(0,(e+100)/100);let i=0,l=0,c=0;const u=10,d=100;for(let m=0;m<n.length;m++){const e=r(n[m]);m<u?i+=e:m<d?l+=e:c+=e}return{waveform:t,fft:n,rms:o,peak:a,bassEnergy:i/u,midEnergy:l/(d-u),highEnergy:c/(n.length-d)}}catch{return NO}}(),n=performance.now()/1e3-i.current,s=t_[e.mode];s&&s(u,t,d,n,f,g)}r.current=requestAnimationFrame(b)};return r.current=requestAnimationFrame(b),()=>{m=!1,cancelAnimationFrame(r.current);try{Bw().disableAnalysers()}catch{}}},[e,t]),l.useEffect(()=>()=>{cancelAnimationFrame(r.current),a.current&&(QP(a.current),a.current=null,s.current=null)},[]),Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("canvas",{ref:n,style:{position:"absolute",inset:0,width:e,height:t,zIndex:0,pointerEvents:"none",opacity:.45,display:m?"none":"block"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerVisualBackground.tsx",lineNumber:232,columnNumber:7},void 0),m&&Yn.jsxDEV("div",{style:{position:"absolute",inset:0,width:e,height:t,zIndex:0,pointerEvents:"none",opacity:.45},children:Yn.jsxDEV(vO,{preset:"am"===d.type?d.preset:"ledBars",audioSource:"master"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerVisualBackground.tsx",lineNumber:258,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerVisualBackground.tsx",lineNumber:247,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:f,style:{position:"absolute",top:4,right:4,zIndex:3,background:"rgba(0,0,0,0.6)",border:"1px solid rgba(255,255,255,0.15)",borderRadius:3,color:"rgba(255,255,255,0.5)",fontSize:9,fontFamily:"monospace",padding:"2px 6px",cursor:"pointer",lineHeight:1.2},title:"Cycle visual mode",children:h},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerVisualBackground.tsx",lineNumber:265,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerVisualBackground.tsx",lineNumber:230,columnNumber:5},void 0)});wO.displayName="TrackerVisualBackground";class EO{worker;disposed=!1;constructor(e,t={}){this.worker=new e,this.worker.onmessage=e=>{"ready"===e.data.type?t.onReady?.():t.onMessage?.(e.data)},this.worker.onerror=e=>{t.onError?.(e)}}post(e,t){this.disposed||(t&&t.length>0?this.worker.postMessage(e,t):this.worker.postMessage(e))}dispose(){this.disposed||(this.disposed=!0,this.worker.terminate())}}class kO extends EO{constructor(e,t={}){super(e,t)}}function DO(e){return new Worker("/assets/tracker-render.worker-D2CElVOs.js",{name:e?.name})}const SO=40,MO=a.memo(({onAcidGenerator:e,onRandomize:t,visibleChannels:n,startChannel:s=0,onSwipeLeft:a,onSwipeRight:o,onSwipeUp:r,onSwipeDown:i})=>{const{isMobile:c}=l.useContext(wP)||{breakpoint:"desktop",isMobile:!1,isTablet:!1,isDesktop:!0,width:1024,isTouch:!1},u=l.useRef(null),d=l.useRef(null),m=l.useRef(null),p=l.useRef(null),[h,f]=l.useState({width:800,height:600}),[g,b]=l.useState(0),v=l.useRef(0),y=l.useRef(0),x=l.useRef(null),N=l.useRef(null),w=l.useRef({row:0,channel:0,active:!1,patternIndex:-1}),E=l.useRef(null),k=l.useRef(null),D=l.useRef([]),S=l.useRef([]),M=dP(),C=l.useRef([]),V=l.useRef(0),P=l.useRef(null),_=l.useRef(0),O=l.useRef(24),{pattern:T,patterns:L,currentPatternIndex:A,addChannel:B,toggleChannelMute:I,toggleChannelSolo:F,toggleChannelCollapse:U,setChannelColor:R,updateChannelName:j,setCell:X,moveCursorToChannelAndColumn:z,copyTrack:G,cutTrack:H,pasteTrack:W,mobileChannelIndex:q,cursor:K,selection:$,showGhostPatterns:J,columnVisibility:Q}=ID(us(e=>({pattern:e.patterns[e.currentPatternIndex],patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,addChannel:e.addChannel,toggleChannelMute:e.toggleChannelMute,toggleChannelSolo:e.toggleChannelSolo,toggleChannelCollapse:e.toggleChannelCollapse,setChannelColor:e.setChannelColor,updateChannelName:e.updateChannelName,setCell:e.setCell,moveCursorToChannelAndColumn:e.moveCursorToChannelAndColumn,copyTrack:e.copyTrack,cutTrack:e.cutTrack,pasteTrack:e.pasteTrack,mobileChannelIndex:e.cursor.channelIndex,cursor:e.cursor,selection:e.selection,showGhostPatterns:e.showGhostPatterns,columnVisibility:e.columnVisibility}))),{instruments:Z}=EN(us(e=>({instruments:e.instruments}))),ee=Ck(e=>e.trackerVisualBg),te=LN(e=>e.trackerZoom),ne=LN(e=>e.showChannelNames),se=LN(e=>e.showAutomationLanes),ae=LN(e=>e.showMacroLanes),oe=Math.round(te/100*24);l.useEffect(()=>{O.current=oe},[oe]),l.useEffect(()=>dV.subscribe(e=>{w.current={row:e.peerCursorRow,channel:e.peerCursorChannel,active:"connected"===e.status&&"shared"===e.listenMode,patternIndex:e.peerPatternIndex},k.current="connected"===e.status&&"shared"===e.listenMode?e.peerSelection:null}),[]),l.useEffect(()=>ID.subscribe((e,t)=>{if(e.selection===t.selection)return;if("connected"!==dV.getState().status)return;const n=e.selection;n?uV()?.send({type:"peer_selection",patternIndex:e.currentPatternIndex,startChannel:n.startChannel,endChannel:n.endChannel,startRow:n.startRow,endRow:n.endRow}):uV()?.send({type:"peer_selection_clear"})}),[]);const re=GP(),{numChannels:ie,channelOffsets:le,channelWidths:ce,totalChannelsWidth:ue}=l.useMemo(()=>{if(!T)return{numChannels:0,channelOffsets:[],channelWidths:[],totalChannelsWidth:0};const e=T.channels.length,t=Q.flag1||Q.flag2,n=Q.probability,s=[],a=[];let o=SO;for(let r=0;r<e;r++){const e=T.channels[r],i=e?.collapsed;if(i){const e=74;s.push(o),a.push(e),o+=e}else{const r=34+(48+34*(e?.channelMeta?.effectCols??2)+(t?28:0)+(n?24:0))+60;s.push(o),a.push(r),o+=r}}return{numChannels:e,channelOffsets:s,channelWidths:a,totalChannelsWidth:o-SO}},[T,Z,Q]);l.useEffect(()=>{D.current=le,S.current=ce},[le,ce]);const de=l.useMemo(()=>!T||0===ie||SO+ue<=h.width,[ue,ie,h.width,T]),me=l.useCallback(()=>{if(!T||!c)return;const e=Math.max(0,K.rowIndex-4);ID.getState().moveCursorToRow(e)},[T,c,K.rowIndex]),pe=l.useCallback(()=>{if(!T||!c)return;const e=Math.min(T.length-1,K.rowIndex+4);ID.getState().moveCursorToRow(e)},[T,c,K.rowIndex]),he=l.useCallback(e=>{if(!T||!c)return;const t=jN.getState().isPlaying,n=LN.getState(),s="dj"===n.activeView,a=n.scratchEnabled;if(s||a||t){return void UP().onScrollDelta(e,performance.now(),0)}const o=Math.round(e/O.current);if(Math.abs(o)>0){const e=Math.max(0,Math.min(T.length+31,K.rowIndex+o));ID.getState().moveCursorToRow(e)}},[T,c,K.rowIndex]),fe=l.useRef(0),ge=l.useCallback(e=>{if(!T||!c)return;if(fe.current+=e,Math.abs(fe.current)>=25){const e=Math.trunc(fe.current/25);fe.current-=25*e;const t=ID.getState();for(let n=0;n<Math.abs(e);n++)t.moveCursor(e>0?"right":"left")}},[T,c]),be=l.useCallback((e,t)=>{if(!T||!d.current)return null;const n=d.current.getBoundingClientRect(),s=e-n.left+g,a=t-n.top,o=Math.floor(h.height/2)-O.current/2,r=Math.floor((a-o)/O.current),i=jN.getState(),l=(i.isPlaying?i.currentRow:K.rowIndex)+r;let c=0,u=-1,m=!1;for(let d=0;d<ie;d++){const e=le[d]-g,t=ce[d];if(s>=e&&s<e+t){c=d,u=s-e-8,m=!0;break}}if(!m){if(!(s<SO))return null;c=0,u=-1}const p=T.channels[c]?.collapsed;if(p)return{rowIndex:Math.max(0,Math.min(l,T.length-1)),channelIndex:c,columnType:"note"};let f="note";const b=T.channels[c]?.rows[0];if(u>=38){const e=u-42;e<24?f="instrument":e<48?f="volume":e<82?f="effTyp":e<116?f="effTyp2":(void 0!==b?.flag1||void 0!==b?.flag2)&&e<144?f=e<130?"flag1":"flag2":void 0!==b?.probability&&(f="probability")}return{rowIndex:Math.max(0,Math.min(l,T.length-1)),channelIndex:c,columnType:f}},[T,h.height,g,K.rowIndex,le,ce,ie]),[ve,ye]=l.useState(!1),xe=l.useRef(!1),[,Ne]=l.useState(null),we=l.useCallback(e=>{e.preventDefault();const t=be(e.clientX,e.clientY);t?(Ne({channelIndex:t.channelIndex,rowIndex:t.rowIndex}),P.current?.post({type:"dragOver",cell:{channelIndex:t.channelIndex,rowIndex:t.rowIndex}}),e.dataTransfer.dropEffect="copy"):(Ne(null),P.current?.post({type:"dragOver",cell:null}))},[be]),Ee=l.useCallback(()=>{Ne(null),P.current?.post({type:"dragOver",cell:null})},[]),ke=l.useCallback(e=>{Ne(null),P.current?.post({type:"dragOver",cell:null});const t=e.dataTransfer.getData("application/x-devilbox-instrument");if(!t)return;e.preventDefault(),e.stopPropagation();const n=be(e.clientX,e.clientY);if(n)try{const{id:e}=JSON.parse(t);ID.getState().setCell(n.channelIndex,n.rowIndex,{instrument:e}),gP.success()}catch(s){}},[be]),De=l.useCallback(e=>{if(c||0!==e.button)return;const t=be(e.clientX,e.clientY);if(!t)return;const n=jN.getState().isPlaying,s=LN.getState(),a="dj"===s.activeView,o=s.scratchEnabled;if((a||o)&&n&&!e.shiftKey&&!e.metaKey&&!e.ctrlKey){xe.current=!0;return void UP().onGrabStart(e.clientY,performance.now())}if((a||o)&&!n)return;const r=ID.getState();e.shiftKey?r.updateSelection(t.channelIndex,t.rowIndex):(r.moveCursorToRow(t.rowIndex),r.moveCursorToChannelAndColumn(t.channelIndex,t.columnType),r.startSelection()),ye(!0)},[c,be]),Se=l.useCallback(e=>{if(xe.current)return void UP().onGrabMove(e.clientY,performance.now());if(!ve||c)return;const t=be(e.clientX,e.clientY);if(!t)return;ID.getState().updateSelection(t.channelIndex,t.rowIndex,t.columnType)},[ve,c,be]),Me=l.useCallback(()=>{if(xe.current)return xe.current=!1,void UP().onGrabEnd(performance.now());ve&&ye(!1)},[ve]),Ce=l.useCallback((e,t)=>{if(!c)return;const n=be(e,t);if(!n)return;const s=ID.getState();s.moveCursorToRow(n.rowIndex),s.moveCursorToChannelAndColumn(n.channelIndex,n.columnType),s.startSelection(),gP.heavy(),LN.getState().setStatusMessage("BLOCK START")},[c,be]),Ve=l.useCallback(e=>{e.preventDefault();const t=be(e.clientX,e.clientY);t&&M.openMenu(e,t.rowIndex,t.channelIndex)},[be,M]),Pe=l.useCallback((e,t)=>{if(!(T&&c&&d.current&&u.current))return;const n=d.current.getBoundingClientRect(),s=e-n.left,a=t-n.top+d.current.scrollTop,o=Math.floor(a/O.current),r=T.channels[0]?.rows[0],i=void 0!==r?.flag1||void 0!==r?.flag2,l=void 0!==r?.probability,m=34+(116+(i?28:0)+(l?24:0)+20+4)+20+20;let p=0,h=s-SO;s>SO?(p=Math.floor(h/m),p=Math.max(0,Math.min(p,T.channels.length-1)),h%=m):(p=0,h=-1);let f="note";if(h<38)f="note";else{const e=h-42;e<24?f="instrument":e<48?f="volume":e<82?f="effTyp":e<116?f="effTyp2":i&&e<144?f=e<130?"flag1":"flag2":l&&(f="probability")}const g=Math.max(0,Math.min(o,T.length-1)),b=ID.getState();b.selection?(b.updateSelection(p,g),gP.soft(),LN.getState().setStatusMessage("BLOCK UPDATED")):(b.moveCursorToRow(g),b.moveCursorToChannelAndColumn(p,f))},[T,c,q,K.columnType,z]),_e=l.useCallback(e=>{if(d.current&&Math.abs(e.deltaY)>Math.abs(e.deltaX)){const t=ID.getState(),n=Math.round(e.deltaY/20);if(0!==n){const e=Math.max(0,Math.min(T.length-1,K.rowIndex+n));t.moveCursorToRow(e)}}},[T.length,K.rowIndex]),Oe=l.useCallback(()=>{if(!T||!c)return;const e=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2"],t=T.channels[q]?.rows[0];void 0===t?.flag1&&void 0===t?.flag2||e.push("flag1","flag2"),void 0!==t?.probability&&e.push("probability");const n=e.indexOf(K.columnType);if(-1!==n&&n<e.length-1)ID.getState().moveCursorToColumn(e[n+1]);else{const e=Math.min(T.channels.length-1,q+1);e!==q&&z(e,"note")}},[T,c,q,K.columnType,z]),Te=l.useCallback(()=>{if(!T||!c)return;const e=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2"],t=T.channels[q]?.rows[0];void 0===t?.flag1&&void 0===t?.flag2||e.push("flag1","flag2"),void 0!==t?.probability&&e.push("probability");const n=e.indexOf(K.columnType);if(n>0)ID.getState().moveCursorToColumn(e[n-1]);else{const e=Math.max(0,q-1);if(e!==q){const t=T.channels[e]?.rows[0];let n="effParam2";void 0!==t?.probability?n="probability":void 0!==t?.flag2&&(n="flag2"),z(e,n)}}},[T,c,q,K.columnType,z]),Le=l.useCallback(()=>{if(!T||!c)return;const e=Math.min(T.channels.length-1,q+1);e!==q&&z(e,"note")},[T,c,q,z]),Be=l.useCallback(()=>{if(!T||!c)return;const e=Math.max(0,q-1);e!==q&&z(e,"note")},[T,c,q,z]),Ie=vP({onSwipeLeft:Oe,onSwipeRight:Te,onSwipeUp:me,onSwipeDown:pe,onTap:Pe,onLongPress:Ce,onScroll:he,onHorizontalScroll:ge,onTouchStart:()=>{fe.current=0},swipeThreshold:30,enabled:c}),Fe=vP({onSwipeLeft:Le,onSwipeRight:Be,enabled:c}),Ue=JD(e=>e.currentThemeId),Re=JD(e=>e.getCurrentTheme),[je,Xe]=l.useState(null),ze=l.useCallback(e=>{if(!T)return;const t=M.cellInfo?.channelIndex??K.channelIndex,n=$?.startRow??K.rowIndex,s=$?.endRow??Math.min(K.rowIndex+15,T.length-1);Xe({isOpen:!0,field:e,channelIndex:t,startRow:n,endRow:s}),M.closeMenu()},[M,K,$,T]);l.useEffect(()=>{P.current?.post({type:"theme",theme:Ge()})},[Ue]),l.useEffect(()=>{if(c&&T){const e=34,t=T.channels[0]?.rows[0],n=q*(e+(116+(void 0!==t?.flag1||void 0!==t?.flag2?28:0)+(void 0!==t?.probability?24:0)+20+4)+20+20);_.current=n,P.current?.post({type:"scroll",x:n}),b(n)}},[c,q,T]);const Ge=l.useCallback(()=>{const e=Re();return{accent:e.colors.accent,accentSecondary:e.colors.accentSecondary,accentGlow:e.colors.accentGlow,bg:e.colors.trackerRowEven,rowNormal:e.colors.trackerRowOdd,rowHighlight:e.colors.trackerRowHighlight,border:e.colors.border,textNote:e.colors.textSecondary,textNoteActive:e.colors.text,textMuted:e.colors.cellEmpty,textInstrument:e.colors.cellInstrument,textVolume:e.colors.cellVolume,textEffect:e.colors.cellEffect,lineNumber:e.colors.textMuted,lineNumberHighlight:e.colors.accentSecondary,selection:e.colors.accentGlow}},[Re]),He=l.useCallback(()=>{const e=LN.getState(),t=Ck.getState(),n=ID.getState();return{useHex:e.useHexNumbers,blankEmpty:e.blankEmptyCells,showGhostPatterns:n.showGhostPatterns,columnVisibility:n.columnVisibility,trackerVisualBg:t.trackerVisualBg,recordMode:n.recordMode,rowHeight:Math.round(e.trackerZoom/100*24),rowHighlightInterval:e.rowHighlightInterval,showBeatLabels:e.showBeatLabels}},[]),We=l.useCallback(()=>ID.getState().patterns.map(e=>({id:e.id,length:e.length,channels:e.channels.map(e=>({id:e.id,name:e.name,color:e.color??void 0,muted:e.muted,solo:e.solo,collapsed:e.collapsed,effectCols:e.channelMeta?.effectCols??2,rows:e.rows.map(e=>({note:e.note??0,instrument:e.instrument??0,volume:e.volume??0,effTyp:e.effTyp??0,eff:e.eff??0,effTyp2:e.effTyp2??0,eff2:e.eff2??0,flag1:e.flag1,flag2:e.flag2,probability:e.probability}))}))})),[]),qe=l.useCallback(()=>({offsets:le,widths:ce,totalWidth:ue}),[le,ce,ue]),Ke=l.useCallback((e,t)=>{if(!T)return;const n=iP[t];if(!n)return;const s=T.channels[e].instrumentId??1;n.generate({patternLength:T.length,instrumentId:s,note:49,velocity:64}).forEach((t,n)=>{X(e,n,t)})},[T,X]),$e=l.useCallback(e=>{if(T){for(let t=0;t<T.length;t++)X(e,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0});LN.getState().setStatusMessage("CHANNEL CLEARED")}},[T,X]),Ye=l.useCallback(e=>{G(e)},[G]),Je=l.useCallback(e=>{H(e)},[H]),Qe=l.useCallback(e=>{W(e)},[W]),Ze=l.useCallback((e,t)=>{if(T){for(let n=0;n<T.length;n++){const s=T.channels[e].rows[n];if(s.note&&0!==s.note&&97!==s.note){let a=s.note+t;a=Math.max(1,Math.min(96,a)),X(e,n,{...s,note:a})}}LN.getState().setStatusMessage(`TRANSPOSE ${t>0?"+":""}${t}`)}},[T,X]),et=l.useCallback(e=>{if(T){for(let t=0;t<T.length;t++){const n=T.channels[e].rows[t];if(null!==n.volume&&n.volume>=16){const s=Math.floor(8*Math.random())-4,a=Math.max(16,Math.min(80,n.volume+s));X(e,t,{...n,volume:a})}}LN.getState().setStatusMessage("HUMANIZED")}},[T,X]),tt=l.useCallback(e=>{if(!T)return;const t=T.channels[e];if(!t)return;let n=-1,s=-1,a=0,o=0;for(let i=0;i<T.length;i++){const e=t.rows[i];null!==e.volume&&e.volume>=16&&e.volume<=80&&(-1===n&&(n=i,a=e.volume),s=i,o=e.volume)}if(-1===n||-1===s||s-n<2)return;const r=s-n;for(let i=n+1;i<s;i++){const s=(i-n)/r,l=Math.round(a+(o-a)*s),c=t.rows[i];X(e,i,{...c,volume:l})}LN.getState().setStatusMessage("INTERPOLATED")},[T,X]),st=l.useCallback(e=>{const t=$?Math.min($.startRow,$.endRow):0,n=$?Math.max($.startRow,$.endRow):(T?.length??64)-1;return{patternIndex:A,channelIndex:e,startRow:t,endRow:n}},[$,A,T?.length]),at=l.useCallback(e=>{re.applyReverseVisual(st(e))},[re,st]),ot=l.useCallback(e=>{const t=st(e);re.applyPolyrhythm(t.patternIndex,[e],[3],t.startRow,t.endRow)},[re,st]),rt=l.useCallback(e=>{re.applyFibonacciSequence(st(e))},[re,st]),it=l.useCallback(e=>{re.applyEuclideanPattern(st(e),5,8)},[re,st]),lt=l.useCallback(e=>{re.applyPingPong(st(e))},[re,st]),ct=l.useCallback(e=>{re.applyGlitch(st(e))},[re,st]),ut=l.useCallback(e=>{re.applyStrobe(st(e))},[re,st]),dt=l.useCallback(e=>{re.applyVisualEcho(st(e))},[re,st]),mt=l.useCallback(e=>{re.applyConverge(st(e))},[re,st]),pt=l.useCallback(e=>{re.applySpiral(st(e))},[re,st]),ht=l.useCallback(e=>{re.applyBounce(st(e))},[re,st]),ft=l.useCallback(e=>{re.applyChaos(st(e))},[re,st]);l.useEffect(()=>{T&&(C.current=T.channels.map(()=>({level:0,triggered:!1})))},[T?.channels.length]),l.useEffect(()=>{const e=d.current;if(!e)return;if(!("transferControlToOffscreen"in HTMLCanvasElement.prototype))return;const t=document.createElement("canvas");t.style.cssText=`display:block;width:${h.width}px;height:${h.height}px;`,e.appendChild(t),u.current=t;let n=!1;const s=setTimeout(()=>{n||mc("Tracker Worker","Pattern editor failed to start (no ready signal after 10 s). Try reloading the page. If this persists, your browser may not support OffscreenCanvas WebGL2.",{errorType:"init",debugData:{offscreenCanvasSupported:!0}})},1e4),a=new kO(DO,{onReady:()=>{n=!0,clearTimeout(s),a.post({type:"channelLayout",channelLayout:qe()})},onMessage:()=>{},onError:e=>{clearTimeout(s),mc("Tracker Worker",e.message||"Pattern editor worker crashed unexpectedly.",{errorType:"runtime",debugData:{filename:e.filename,lineno:e.lineno}})}});P.current=a;const o=requestAnimationFrame(()=>{const n=window.devicePixelRatio||1,s=Math.max(1,e.clientWidth),o=Math.max(1,e.clientHeight),r=ID.getState(),i=t.transferControlToOffscreen();a.post({type:"init",canvas:i,dpr:n,width:s,height:o,theme:Ge(),uiState:He(),patterns:We(),currentPatternIndex:r.currentPatternIndex,cursor:{rowIndex:r.cursor.rowIndex,channelIndex:r.cursor.channelIndex,columnType:r.cursor.columnType,digitIndex:r.cursor.digitIndex},selection:r.selection?{startChannel:r.selection.startChannel,endChannel:r.selection.endChannel,startRow:r.selection.startRow,endRow:r.selection.endRow,columnTypes:r.selection.columnTypes}:null,channelLayout:qe()},[i])}),r=ID.subscribe((e,t)=>{const n=P.current;n&&(e.patterns===t.patterns&&e.currentPatternIndex===t.currentPatternIndex||n.post({type:"patterns",patterns:We(),currentPatternIndex:e.currentPatternIndex}),e.cursor===t.cursor||jN.getState().isPlaying||n.post({type:"cursor",cursor:{rowIndex:e.cursor.rowIndex,channelIndex:e.cursor.channelIndex,columnType:e.cursor.columnType,digitIndex:e.cursor.digitIndex}}),e.selection!==t.selection&&n.post({type:"selection",selection:e.selection?{startChannel:e.selection.startChannel,endChannel:e.selection.endChannel,startRow:e.selection.startRow,endRow:e.selection.endRow,columnTypes:e.selection.columnTypes}:null}),e.columnVisibility===t.columnVisibility&&e.showGhostPatterns===t.showGhostPatterns&&e.recordMode===t.recordMode||n.post({type:"uiState",uiState:He()}))}),i=LN.subscribe((e,t)=>{e.useHexNumbers===t.useHexNumbers&&e.blankEmptyCells===t.blankEmptyCells&&e.trackerZoom===t.trackerZoom&&e.rowHighlightInterval===t.rowHighlightInterval&&e.showBeatLabels===t.showBeatLabels&&e.showAutomationLanes===t.showAutomationLanes&&e.showMacroLanes===t.showMacroLanes||P.current?.post({type:"uiState",uiState:He()})}),l=Ck.subscribe((e,t)=>{e.trackerVisualBg!==t.trackerVisualBg&&P.current?.post({type:"uiState",uiState:He()})});return()=>{cancelAnimationFrame(o),clearTimeout(s),r(),i(),l(),a.dispose(),P.current=null,t.remove(),u.current=null}},[]),l.useEffect(()=>{P.current?.post({type:"channelLayout",channelLayout:qe()})},[qe]),l.useEffect(()=>{let e;const t=jN.getState().bpm,n=jN.getState().speed;let s=-1,a=-1,o=-1,r=!1;const i=()=>{const l=jN.getState(),c=ID.getState(),u=l.isPlaying,d=l.smoothScrolling;let m=c.cursor.rowIndex,p=0,f=c.currentPatternIndex;if(u){const e=pD(),s=Y()+.01,a=e.getStateAtTime(s);if(a){if(m=a.row,f=a.pattern,d){const o=e.getStateAtTime(s+.5,!0),r=o&&o.row!==a.row?o.time-a.time:2.5/t*n;p=Math.min(Math.max((s-a.time)/r,0),1)*O.current}}else m=l.currentRow}(m!==s||f!==o||u!==r||Math.abs(p-a)>.5)&&(s=m,a=p,o=f,r=u,P.current?.post({type:"playback",row:m,smoothOffset:p,patternIndex:f,isPlaying:u}));const g=h.height,b=O.current,M=Math.ceil(g/b)+2,C=Math.floor(M/2),V=m-C,T=Math.floor(g/2)-b/2-C*b-p;if(v.current=T,y.current=V,x.current&&(x.current.style.top=`${T}px`),N.current){const e=w.current,t=ID.getState().currentPatternIndex,n=D.current;if(e.active&&e.patternIndex===t&&n.length>e.channel){const t=T+(e.row-V)*b,s=n[e.channel]-_.current+8;N.current.style.display="block",N.current.style.transform=`translate(${s}px, ${t}px)`}else N.current.style.display="none"}if(E.current){const e=k.current,t=ID.getState().currentPatternIndex;if(e&&e.patternIndex===t){const t=D.current,n=S.current,s=Math.min(e.startChannel,e.endChannel),a=Math.max(e.startChannel,e.endChannel),o=Math.min(e.startRow,e.endRow),r=Math.max(e.startRow,e.endRow);if(t.length>a){const e=t[s]+SO-_.current,i=t[a]+n[a]-t[s],l=T+(o-V)*b,c=(r-o+1)*b;E.current.style.display="block",E.current.style.left=`${e}px`,E.current.style.top=`${l}px`,E.current.style.width=`${i}px`,E.current.style.height=`${c}px`}}else E.current.style.display="none"}e=requestAnimationFrame(i)};return e=requestAnimationFrame(i),()=>cancelAnimationFrame(e)},[h.height]),l.useEffect(()=>{const e=d.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:n}=t.contentRect;e>0&&n>0&&f({width:e,height:n})}});t.observe(e);const n=e.getBoundingClientRect();return n.width>0&&n.height>0&&f({width:n.width,height:n.height}),()=>t.disconnect()},[]),l.useEffect(()=>{const e=window.devicePixelRatio||1;P.current?.post({type:"resize",w:h.width,h:h.height,dpr:e}),u.current&&(u.current.style.width=`${h.width}px`,u.current.style.height=`${h.height}px`)},[h]),l.useEffect(()=>{u.current&&(u.current.style.position=ee?"relative":"",u.current.style.zIndex=ee?"1":"")},[ee]),l.useEffect(()=>{de&&g>0&&(_.current=0,P.current?.post({type:"scroll",x:0}),b(0))},[de,g]),l.useEffect(()=>{const e=d.current;if(!e)return;const t=t=>{t.preventDefault();const n=jN.getState().isPlaying,s=LN.getState(),a="dj"===s.activeView,o=s.scratchEnabled;if((a||o||n)&&Math.abs(t.deltaY)>Math.abs(t.deltaX)){return void UP().onScrollDelta(t.deltaY,performance.now(),t.deltaMode)}if(!n)if(Math.abs(t.deltaY)>Math.abs(t.deltaX)){const e=2*Math.sign(t.deltaY),n=ID.getState(),s=n.patterns[n.currentPatternIndex];if(!s)return;const a=n.cursor.rowIndex,o=Math.min(s.length+32,a+e);ID.getState().moveCursorToRow(o)}else{const n=Math.max(0,SO+ue-e.clientWidth);if(n>0){V.current+=t.deltaX;const e=50;if(Math.abs(V.current)>e){const e=Math.sign(V.current);if(V.current=0,0===e)return;let t=0;for(let n=0;n<le.length;n++){if(!(le[n]-SO<=g+5))break;t=n}let s=t+e;s=Math.max(0,Math.min(le.length-1,s));const a=Math.max(0,Math.min(n,le[s]-SO));_.current=a,P.current?.post({type:"scroll",x:a}),b(a),m.current&&(m.current.scrollLeft=a),p.current&&(p.current.scrollLeft=a)}}}};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[g,ue,h.width,le]);const yt=l.useCallback(e=>{const t=e.currentTarget.scrollLeft;_.current=t,P.current?.post({type:"scroll",x:t}),b(t),p.current&&(p.current.scrollLeft=t)},[]),xt=l.useCallback(e=>{const t=e.currentTarget.scrollLeft;_.current=t,P.current?.post({type:"scroll",x:t}),b(t),m.current&&(m.current.scrollLeft=t)},[]);if(!T)return Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1539,columnNumber:7},void 0);const Nt=T.channels[q],wt=0,Et=!1;return Yn.jsxDEV("div",{className:"flex flex-col h-full",children:[c&&Yn.jsxDEV("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border relative touch-none",...Fe,children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-3 py-2",children:[Yn.jsxDEV("button",{onClick:Be,disabled:q<=0,className:"p-2 rounded-lg transition-colors "+(q<=0?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:Yn.jsxDEV(Ut,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1562,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1555,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex flex-col items-center",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("span",{className:"font-bold font-mono text-lg",style:{color:Nt?.color||"var(--color-accent)"},children:["CH ",(q+1).toString().padStart(2,"0")]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1567,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted",children:["/ ",T.channels.length.toString().padStart(2,"0")]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1573,columnNumber:17},void 0),Yn.jsxDEV(JV,{level:wt,isActive:Et},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1576,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1566,columnNumber:15},void 0),Yn.jsxDEV("input",{type:"text",className:"bg-dark-bgPrimary/50 border border-dark-border/30 rounded px-2 py-0.5 mt-1 font-mono text-[10px] text-accent-primary text-center uppercase focus:border-accent-primary outline-none min-w-[120px]",value:Nt?.name||`Channel ${q+1}`,onChange:e=>j(q,e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.target.blur()}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1578,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1565,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:Le,disabled:q>=T.channels.length-1,className:"p-2 rounded-lg transition-colors "+(q>=T.channels.length-1?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:Yn.jsxDEV(Ae,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1598,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1591,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1554,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-center gap-2 px-3 py-1 border-t border-dark-border/50",children:[Yn.jsxDEV("button",{onClick:()=>I(q),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(Nt?.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:bg-dark-bgHover"),children:Nt?.muted?Yn.jsxDEV(bt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1609,columnNumber:39},void 0):Yn.jsxDEV(gt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1609,columnNumber:63},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1603,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>F(q),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(Nt?.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:bg-dark-bgHover"),children:Yn.jsxDEV(vt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1617,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1611,columnNumber:13},void 0),Yn.jsxDEV(eP,{currentColor:Nt?.color,onColorSelect:e=>R(q,e)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1619,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1602,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1553,columnNumber:9},void 0),!c&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{ref:p,onScroll:xt,className:"flex-shrink-0 h-3 bg-dark-bgTertiary border-b border-dark-border overflow-x-auto "+(de?"hidden":""),style:{paddingLeft:SO},children:Yn.jsxDEV("div",{style:{width:ue,height:1}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1637,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1631,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-dark-border z-20 relative h-[28px]",children:Yn.jsxDEV("div",{className:"flex h-full",children:[Yn.jsxDEV("div",{className:"flex-shrink-0 px-2 text-text-muted text-xs font-medium text-center border-r border-dark-border flex items-center justify-center",style:{width:SO},children:"ROW"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1643,columnNumber:13},void 0),Yn.jsxDEV("div",{ref:m,onScroll:yt,className:"overflow-x-hidden overflow-y-hidden flex-1","data-vu-scroll":!0,children:Yn.jsxDEV("div",{className:"flex",style:{width:ue},children:[T.channels.map((n,s)=>{const a=0,o=!1,r=ce[s],i=n.collapsed;return Yn.jsxDEV("div",{className:`flex-shrink-0 flex items-center justify-between gap-1 ${i?"px-1":"px-2"} py-1\n                        border-r border-dark-border transition-colors relative\n                        ${n.muted?"opacity-50":""}\n                        ${n.solo?"bg-accent-primary/10":""}`,style:{width:r,backgroundColor:n.color?`${n.color}15`:void 0,boxShadow:n.color?`inset 2px 0 0 ${n.color}`:void 0},children:[!i&&Yn.jsxDEV("div",{className:"flex items-center gap-1.5 overflow-hidden flex-1 min-w-0",children:[Yn.jsxDEV("span",{className:"font-bold font-mono text-[11px] flex-shrink-0 opacity-80",style:{color:n.color||"var(--color-accent)"},children:(s+1).toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1678,columnNumber:25},void 0),ne&&Yn.jsxDEV("input",{type:"text",className:"bg-transparent border-none outline-none font-mono text-[10px] font-bold text-text-primary focus:text-accent-primary transition-colors min-w-0 flex-1 overflow-hidden text-ellipsis uppercase px-0 placeholder:text-text-muted/50",value:n.name||"",placeholder:`CH${s+1}`,onChange:e=>j(s,e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.target.blur()},title:`Click to rename channel (Short: ${n.shortName||s+1})`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1685,columnNumber:27},void 0),Yn.jsxDEV("div",{className:"flex-shrink-0",children:Yn.jsxDEV(JV,{level:a,isActive:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1700,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1699,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1677,columnNumber:25},void 0),!i&&Yn.jsxDEV("div",{className:"flex items-center gap-0.5 flex-shrink-0 ml-1",children:[Yn.jsxDEV(cP,{channelIndex:s,channel:n,patternId:T.id,patternLength:T.length,onFillPattern:Ke,onClearChannel:$e,onCopyChannel:Ye,onCutChannel:Je,onPasteChannel:Qe,onTranspose:Ze,onHumanize:et,onInterpolate:tt,onAcidGenerator:e||(()=>{}),onRandomize:t||(()=>{}),onReverseVisual:at,onPolyrhythm:ot,onFibonacci:rt,onEuclidean:it,onPingPong:lt,onGlitch:ct,onStrobe:ut,onVisualEcho:dt,onConverge:mt,onSpiral:pt,onBounce:ht,onChaos:ft},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1707,columnNumber:25},void 0),Yn.jsxDEV(eP,{currentColor:n.color,onColorSelect:e=>R(s,e)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1735,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:()=>I(s),className:"p-1 rounded transition-colors "+(n.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:n.muted?"Unmute":"Mute",children:n.muted?Yn.jsxDEV(bt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1748,columnNumber:44},void 0):Yn.jsxDEV(gt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1748,columnNumber:68},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1739,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:()=>F(s),className:"p-1 rounded transition-colors "+(n.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:n.solo?"Unsolo":"Solo",children:Yn.jsxDEV(vt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1759,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1750,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:()=>U(s),className:"p-1 rounded transition-colors text-text-muted hover:text-text-primary hover:bg-dark-bgHover",title:"Collapse Channel",children:Yn.jsxDEV(Ut,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1766,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1761,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1706,columnNumber:25},void 0),i&&Yn.jsxDEV("div",{className:"flex items-center justify-between w-full px-1",children:[Yn.jsxDEV("span",{className:"font-bold font-mono text-[9px] flex-shrink-0 opacity-80",style:{color:n.color||"var(--color-accent)"},children:(s+1).toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1774,columnNumber:27},void 0),Yn.jsxDEV("button",{onClick:()=>U(s),className:"p-0.5 rounded transition-colors text-text-muted hover:text-text-primary hover:bg-dark-bgHover",title:"Expand Channel",children:Yn.jsxDEV(Ae,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1785,columnNumber:29},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1780,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1773,columnNumber:25},void 0)]},n.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1664,columnNumber:21},void 0)}),T.channels.length<16&&Yn.jsxDEV("button",{onClick:B,className:"flex-shrink-0 w-12 flex items-center justify-center border-r border-dark-border\n                      text-text-muted hover:text-accent-primary hover:bg-dark-bgHover transition-colors",title:"Add Channel",children:Yn.jsxDEV(nt,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1801,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1795,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1655,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1649,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1641,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1640,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1629,columnNumber:9},void 0),Yn.jsxDEV("div",{ref:d,className:"flex-1 relative bg-dark-bg overflow-hidden touch-none focus:outline-none focus:ring-1 focus:ring-accent-primary/30",style:{minHeight:200},tabIndex:0,onContextMenu:Ve,onMouseDown:De,onMouseMove:Se,onMouseUp:Me,onMouseLeave:Me,onWheel:_e,onDragOver:we,onDragLeave:Ee,onDrop:ke,...Ie,children:[ee&&Yn.jsxDEV(wO,{width:h.width,height:h.height},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1830,columnNumber:11},void 0),T&&Yn.jsxDEV(Yn.Fragment,{children:[se&&Yn.jsxDEV($V,{patternId:T.id,patternLength:T.length,rowHeight:oe,channelCount:T.channels.length,channelOffsets:le,channelWidths:ce,rowNumWidth:SO,scrollOffset:v.current,visibleStart:y.current,prevPatternId:J?A>0?L[A-1]?.id:L.length>1?L[L.length-1]?.id:void 0:void 0,prevPatternLength:J?A>0?L[A-1]?.length:L.length>1?L[L.length-1]?.length:void 0:void 0,nextPatternId:J?A<L.length-1?L[A+1]?.id:L.length>1?L[0]?.id:void 0:void 0,nextPatternLength:J?A<L.length-1?L[A+1]?.length:L.length>1?L[0]?.length:void 0:void 0},`automation-${T.id}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1838,columnNumber:15},void 0),ae&&Yn.jsxDEV("div",{ref:x,style:{position:"absolute",top:v.current,left:0,right:0,height:T.length*oe,pointerEvents:"none",transform:`translateX(${-g}px)`},children:Yn.jsxDEV(YV,{pattern:T,rowHeight:oe,channelCount:T.channels.length,channelOffsets:le,channelWidths:ce,rowNumWidth:SO},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1870,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1858,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1836,columnNumber:11},void 0),Yn.jsxDEV("div",{ref:N,style:{position:"absolute",top:0,left:0,width:34,height:oe,display:"none",pointerEvents:"none",backgroundColor:"rgba(168, 85, 247, 0.55)",zIndex:25}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1884,columnNumber:9},void 0),Yn.jsxDEV("div",{ref:E,style:{position:"absolute",display:"none",pointerEvents:"none",zIndex:20,backgroundColor:"rgba(168, 85, 247, 0.12)",border:"1px solid rgba(168, 85, 247, 0.45)",boxSizing:"border-box"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1900,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"absolute right-0 pointer-events-none z-30 overflow-hidden",style:{top:0,left:SO,height:`calc(50% - ${oe/2}px)`},children:Yn.jsxDEV(QV,{channelOffsets:le,channelWidths:ce,scrollLeft:g},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1915,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1911,columnNumber:9},void 0),Yn.jsxDEV(uP,{isOpen:M.isOpen,position:M.position,onClose:M.closeMenu,channelIndex:M.cellInfo?.channelIndex??0,rowIndex:M.cellInfo?.rowIndex??0,onOpenParameterEditor:ze,onReverseVisual:()=>at(M.cellInfo?.channelIndex??0),onPolyrhythm:()=>ot(M.cellInfo?.channelIndex??0),onFibonacci:()=>rt(M.cellInfo?.channelIndex??0),onEuclidean:()=>it(M.cellInfo?.channelIndex??0),onPingPong:()=>lt(M.cellInfo?.channelIndex??0),onGlitch:()=>ct(M.cellInfo?.channelIndex??0),onStrobe:()=>ut(M.cellInfo?.channelIndex??0),onVisualEcho:()=>dt(M.cellInfo?.channelIndex??0),onConverge:()=>mt(M.cellInfo?.channelIndex??0),onSpiral:()=>pt(M.cellInfo?.channelIndex??0),onBounce:()=>ht(M.cellInfo?.channelIndex??0),onChaos:()=>ft(M.cellInfo?.channelIndex??0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1923,columnNumber:9},void 0),je?.isOpen&&Yn.jsxDEV(pP,{onClose:()=>Xe(null),channelIndex:je.channelIndex,startRow:je.startRow,endRow:je.endRow,field:je.field},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1946,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1812,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternEditorCanvas.tsx",lineNumber:1550,columnNumber:5},void 0)}),CO=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],VO={noteIndex:null,octaveShift:0,accent:!1,slide:!1,tie:!1,mute:!1,hammer:!1,velocity:100};function PO(e,t){if(!e||0===e||97===e)return null;const n=Ga(e).match(/^([A-G])(#?)(-?\d)$/);if(!n)return null;const[,s,a,o]=n,r=parseInt(o,10),i=s+(a||""),l=CO.indexOf(i);if(-1===l)return null;const c=r-t;return c<-1||c>1?{noteIndex:l,octaveShift:Math.max(-1,Math.min(1,c))}:{noteIndex:l,octaveShift:c}}function _O(e,t){if(null===e.noteIndex)return 0;const n=CO[e.noteIndex],s=t+e.octaveShift;let a;return a=n.includes("#")?`${n}${s}`:`${n}-${s}`,Xa(a)}function OO(e){const{patterns:t,currentPatternIndex:n,setCell:s,resizePattern:a,resizeAllPatterns:o}=ID(),[r,i]=l.useState(3),c=t[n],u=c?.channels[e],d=u?.rows||[],m=c?.length||16,p=l.useCallback(e=>{a(n,e)},[n,a]),h=l.useMemo(()=>function(e,t,n){const s=[];for(let a=0;a<n;a++){const n=e[a];if(!n){s.push({...VO});continue}const o=PO(n.note,t);let r=!1;if(a>0&&o&&e[a-1]){const n=PO(e[a-1].note,t);n&&n.noteIndex===o.noteIndex&&n.octaveShift===o.octaveShift&&(r=!0)}s.push({noteIndex:o?.noteIndex??null,octaveShift:o?.octaveShift??0,accent:1===n.flag1||1===n.flag2,slide:2===n.flag1||2===n.flag2,tie:r,mute:3===n.flag1||3===n.flag2,hammer:4===n.flag1||4===n.flag2,velocity:n.volume??100})}return{steps:s,baseOctave:t,length:n}}(d,r,m),[d,r,m]),f=l.useCallback((t,n,a=0)=>{if(t<0||t>=m)return;const o=null!==n?_O({noteIndex:n,octaveShift:a},r):0,i=d[t];if(0!==o&&0===(i?.instrument||0)){s(e,t,{note:o,instrument:u?.instrumentId??1})}else s(e,t,{note:o})},[e,s,r,m,d,u]),g=l.useCallback(t=>{if(t<0||t>=d.length)return;const n=1===d[t]?.flag1||1===d[t]?.flag2;s(e,t,{flag1:n?0:1})},[e,d,s]),b=l.useCallback(t=>{if(t<0||t>=d.length)return;const n=2===d[t]?.flag1||2===d[t]?.flag2;s(e,t,{flag2:n?0:2})},[e,d,s]),v=l.useCallback((t,n)=>{if(t<0||t>=d.length)return;const a=d[t];if(!a?.note)return;const o=PO(a.note,r);if(!o)return;const i=_O({noteIndex:o.noteIndex,octaveShift:n},r);s(e,t,{note:i})},[e,d,s,r]),y=l.useCallback(t=>{t<0||t>=m||s(e,t,{note:0,flag1:0,flag2:0})},[e,s,m]),x=l.useCallback(()=>{for(let t=0;t<m;t++)s(e,t,{note:0,flag1:0,flag2:0})},[e,s,m]),N=l.useCallback((t,n)=>{if(t<0||t>=d.length)return;const a=Math.max(0,Math.min(127,n));s(e,t,{volume:a})},[e,d,s]),w=l.useCallback(t=>{if(t<0||t>=d.length)return;const n=3===d[t]?.flag1||3===d[t]?.flag2;s(e,t,{flag1:n?0:3})},[e,d,s]),E=l.useCallback(t=>{if(t<0||t>=d.length)return;const n=4===d[t]?.flag1||4===d[t]?.flag2;s(e,t,{flag2:n?0:4})},[e,d,s]);return{gridPattern:h,baseOctave:r,setBaseOctave:i,maxSteps:m,setMaxSteps:p,resizeAllPatterns:o,setNote:f,toggleAccent:g,toggleSlide:b,toggleMute:w,toggleHammer:E,setOctaveShift:v,setVelocity:N,clearStep:y,clearAll:x}}const TO={chromatic:{name:"Chromatic",intervals:[0,1,2,3,4,5,6,7,8,9,10,11],description:"All notes"},major:{name:"Major",intervals:[0,2,4,5,7,9,11],description:"Ionian mode"},minor:{name:"Natural Minor",intervals:[0,2,3,5,7,8,10],description:"Aeolian mode"},harmonicMinor:{name:"Harmonic Minor",intervals:[0,2,3,5,7,8,11],description:"Minor with raised 7th"},melodicMinor:{name:"Melodic Minor",intervals:[0,2,3,5,7,9,11],description:"Minor with raised 6th and 7th"},dorian:{name:"Dorian",intervals:[0,2,3,5,7,9,10],description:"Minor with raised 6th"},phrygian:{name:"Phrygian",intervals:[0,1,3,5,7,8,10],description:"Minor with lowered 2nd"},lydian:{name:"Lydian",intervals:[0,2,4,6,7,9,11],description:"Major with raised 4th"},mixolydian:{name:"Mixolydian",intervals:[0,2,4,5,7,9,10],description:"Major with lowered 7th"},locrian:{name:"Locrian",intervals:[0,1,3,5,6,8,10],description:"Diminished scale"},pentatonicMajor:{name:"Pentatonic Major",intervals:[0,2,4,7,9],description:"5-note major scale"},pentatonicMinor:{name:"Pentatonic Minor",intervals:[0,3,5,7,10],description:"5-note minor scale"},blues:{name:"Blues",intervals:[0,3,5,6,7,10],description:"Minor pentatonic + blue note"},wholeTone:{name:"Whole Tone",intervals:[0,2,4,6,8,10],description:"All whole steps"},diminished:{name:"Diminished",intervals:[0,2,3,5,6,8,9,11],description:"Half-whole diminished"}};function LO(e,t,n){if(e<0||e>11)return!1;if(t<0||t>11)return!1;const s=(e-t+12)%12;return n.intervals.includes(s)}const AO=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],BO=({scaleKey:e,rootNote:t,onScaleChange:n,onRootNoteChange:s})=>{const a=l.useMemo(()=>Object.entries(TO).map(([e,t])=>({value:e,label:t.name,description:t.description})),[]),o=l.useMemo(()=>TO[e]||TO.chromatic,[e]);return Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Root:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:34,columnNumber:9},void 0),Yn.jsxDEV("select",{value:t,onChange:e=>s(parseInt(e.target.value,10)),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary",children:AO.map((e,t)=>Yn.jsxDEV("option",{value:t,children:e},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:41,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:35,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:33,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Scale:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:49,columnNumber:9},void 0),Yn.jsxDEV("select",{value:e,onChange:e=>n(e.target.value),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary min-w-[140px]",title:o?.description,children:a.map(e=>Yn.jsxDEV("option",{value:e.value,title:e.description,children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:57,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:50,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:48,columnNumber:7},void 0),"Chromatic"!==o.name&&Yn.jsxDEV("span",{className:"text-[10px] text-text-muted",children:["(",o.intervals.length," notes)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:65,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/ScaleSelector.tsx",lineNumber:32,columnNumber:5},void 0)},IO={baseOctave:{label:"Base Octave",min:1,max:6,group:"General"},velocity:{label:"Velocity",min:0,max:127,group:"General"},cutoff:{label:"Cutoff",min:200,max:5e3,group:"303 Main"},resonance:{label:"Resonance",min:0,max:100,group:"303 Main"},envMod:{label:"Env Mod",min:0,max:100,group:"303 Main"},decay:{label:"Decay",min:200,max:2e3,group:"303 Main"},accent:{label:"Accent",min:0,max:100,group:"303 Main"},slideTime:{label:"Slide Time",min:2,max:360,group:"303 Main"},overdrive:{label:"Overdrive",min:0,max:100,group:"303 Main"},normalDecay:{label:"Normal Decay",min:30,max:3e3,group:"Devil Fish"},accentDecay:{label:"Accent Decay",min:30,max:3e3,group:"Devil Fish"},softAttack:{label:"Soft Attack",min:.3,max:30,group:"Devil Fish"},vegSustain:{label:"VEG Sustain",min:0,max:100,group:"Devil Fish"},filterFM:{label:"Filter FM",min:0,max:100,group:"Devil Fish"},filterTracking:{label:"Key Track",min:0,max:200,group:"Devil Fish"}},FO=({onClose:e})=>{const{devices:t,isSupported:n,isEnabled:s,lastMessage:a,enableMIDI:o,disableMIDI:r,onMessage:i}=wV(),{gridMappings:c,gridIsLearning:u,gridLearningParameter:d,addGridMapping:m,removeGridMapping:p,clearGridMappings:h,startGridLearning:f,stopGridLearning:g}=OM(),[b,v]=l.useState(null);l.useEffect(()=>{if(!u||!d)return;return i(e=>{if("cc"===e.type&&void 0!==e.controller&&void 0!==e.value){const t=IO[d];m({channel:e.channel,controller:e.controller,parameter:d,min:t.min,max:t.max,curve:"linear"}),g()}})},[u,d,i,m,g]);return n?Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4 space-y-4",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("h3",{className:"text-sm font-semibold text-text-primary flex items-center gap-2",children:[Yn.jsxDEV(Me,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:101,columnNumber:11},void 0),"MIDI Learn"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:100,columnNumber:9},void 0),e&&Yn.jsxDEV("button",{onClick:e,className:"text-text-muted hover:text-text-primary text-xs",children:"Close"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:105,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:99,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3",children:s?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:r,className:"px-3 py-1.5 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-xs transition-colors",children:"Disable MIDI"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:125,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"flex items-center gap-1 text-xs text-accent-success",children:[Yn.jsxDEV("span",{className:"w-2 h-2 bg-accent-success rounded-full animate-pulse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:132,columnNumber:15},void 0),"Connected"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:131,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:124,columnNumber:11},void 0):Yn.jsxDEV("button",{onClick:async()=>{try{v(null),await o()}catch(e){v(e instanceof Error?e.message:"Failed to enable MIDI")}},className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white rounded text-xs font-medium transition-colors",children:"Enable MIDI"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:117,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:115,columnNumber:7},void 0),b&&Yn.jsxDEV("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-2 text-xs text-accent-error",children:b},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:140,columnNumber:9},void 0),s&&t.length>0&&Yn.jsxDEV("div",{children:[Yn.jsxDEV("h4",{className:"text-xs font-medium text-text-secondary mb-2",children:"Connected Devices"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:148,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"space-y-1",children:t.map(e=>Yn.jsxDEV("div",{className:"flex items-center gap-2 text-xs text-text-muted bg-dark-bgTertiary rounded px-2 py-1",children:[Yn.jsxDEV("span",{className:"w-2 h-2 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:155,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"flex-1",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:156,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[10px] opacity-60",children:e.manufacturer},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:157,columnNumber:17},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:151,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:149,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:147,columnNumber:9},void 0),s&&a&&"cc"===a.type&&Yn.jsxDEV("div",{className:"bg-dark-bgTertiary rounded p-2",children:[Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:"Last CC Message:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:167,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"text-xs font-mono text-text-primary mt-1",children:["CH",a.channel+1," CC",a.controller," = ",a.value]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:168,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:166,columnNumber:9},void 0),s&&Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("h4",{className:"text-xs font-medium text-text-secondary",children:"Map Parameters"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:177,columnNumber:11},void 0),["General","303 Main","Devil Fish"].map(e=>{const t=Object.keys(IO).filter(t=>IO[t].group===e);return 0===t.length?null:Yn.jsxDEV("div",{children:[Yn.jsxDEV("div",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide mb-1.5",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:187,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-1.5",children:t.map(e=>{const t=Object.values(c).some(t=>t.parameter===e),n=u&&d===e;return Yn.jsxDEV("button",{onClick:()=>{n?g():f(e)},className:`\n                          flex items-center gap-2 px-2 py-1.5 rounded text-xs transition-colors\n                          ${n?"bg-accent-primary text-white animate-pulse":t?"bg-accent-success/20 text-accent-success border border-accent-success/30":"bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary"}\n                        `,children:[n&&Yn.jsxDEV(Ve,{size:12,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:215,columnNumber:49},void 0),Yn.jsxDEV("span",{className:"flex-1 text-left",children:IO[e].label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:216,columnNumber:25},void 0),t&&!n&&Yn.jsxDEV("span",{className:"text-[10px]",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:217,columnNumber:62},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:196,columnNumber:23},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:190,columnNumber:17},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:186,columnNumber:15},void 0)}),u&&Yn.jsxDEV("p",{className:"text-xs text-accent-primary mt-2 animate-pulse",children:["Move a MIDI controller to assign it to ",IO[d].label,"..."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:226,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:176,columnNumber:9},void 0),s&&Object.keys(c).length>0&&Yn.jsxDEV("div",{children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[Yn.jsxDEV("h4",{className:"text-xs font-medium text-text-secondary",children:"Active Mappings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:237,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:h,className:"flex items-center gap-1 text-xs text-accent-error hover:underline",children:[Yn.jsxDEV(Ie,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:242,columnNumber:15},void 0),"Clear All"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:238,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:236,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(c).map(([e,t])=>Yn.jsxDEV("div",{className:"flex items-center justify-between bg-dark-bgTertiary rounded px-2 py-1 text-xs",children:[Yn.jsxDEV("span",{className:"text-text-primary",children:IO[t.parameter].label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:252,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"font-mono text-text-muted text-[10px]",children:["CH",t.channel+1," CC",t.controller]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:256,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>p(t.channel,t.controller),className:"text-accent-error hover:text-accent-error/80",children:Yn.jsxDEV(Ie,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:263,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:259,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:255,columnNumber:17},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:248,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:246,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:235,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:97,columnNumber:5},void 0):Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 text-accent-error",children:[Yn.jsxDEV(Rt,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:86,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-sm",children:"Web MIDI API not supported in this browser"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:87,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:85,columnNumber:9},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:89,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/MIDILearnPanel.tsx",lineNumber:84,columnNumber:7},void 0)},UO=({baseOctave:e,onBaseOctaveChange:t,maxSteps:n,onMaxStepsChange:s,onResizeAllPatterns:a,scaleKey:o,rootNote:r,onScaleChange:i,onRootNoteChange:c,onClearAll:u,onRandomize:d,onAcidGenerator:m,cellSize:p=28})=>{const[h,f]=l.useState(!1);return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"flex items-center gap-4 p-2 bg-dark-bgSecondary border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-xs text-text-muted uppercase",children:"Octave"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:50,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center",children:[Yn.jsxDEV("button",{onClick:()=>t(Math.max(1,e-1)),disabled:e<=1,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:Yn.jsxDEV(De,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:57,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:52,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"w-8 text-center text-sm font-mono text-text-primary",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:59,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>t(Math.min(6,e+1)),disabled:e>=6,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:Yn.jsxDEV(jt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:67,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:62,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:51,columnNumber:9},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted",children:["C",e," - C",e+2]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:70,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:49,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-6 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:76,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-xs text-text-muted uppercase",children:"Steps"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:80,columnNumber:9},void 0),Yn.jsxDEV("select",{value:n,onChange:e=>s(Number(e.target.value)),className:"px-2 py-1 text-sm bg-dark-bgTertiary border border-dark-border rounded text-text-primary",children:[Yn.jsxDEV("option",{value:4,children:"4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:86,columnNumber:11},void 0),Yn.jsxDEV("option",{value:8,children:"8"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:87,columnNumber:11},void 0),Yn.jsxDEV("option",{value:12,children:"12"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:88,columnNumber:11},void 0),Yn.jsxDEV("option",{value:16,children:"16"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:89,columnNumber:11},void 0),Yn.jsxDEV("option",{value:24,children:"24"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:90,columnNumber:11},void 0),Yn.jsxDEV("option",{value:32,children:"32"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:91,columnNumber:11},void 0),Yn.jsxDEV("option",{value:64,children:"64"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:92,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:81,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>a(n),className:"px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Apply this step count to all patterns",children:"Apply All"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:94,columnNumber:9},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted",title:"Auto-calculated cell size to fit viewport",children:["Zoom: ",p,"px"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:103,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:79,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-6 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:109,columnNumber:7},void 0),Yn.jsxDEV(BO,{scaleKey:o,rootNote:r,onScaleChange:i,onRootNoteChange:c},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:112,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-6 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:120,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV("button",{onClick:()=>f(!h),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors "+(h?"bg-accent-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-dark-bgActive"),title:"MIDI Learn",children:[Yn.jsxDEV(Me,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:133,columnNumber:11},void 0),"MIDI"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:124,columnNumber:9},void 0),m&&Yn.jsxDEV("button",{onClick:m,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate 303 acid pattern",children:[Yn.jsxDEV(Nt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:142,columnNumber:13},void 0),"Acid"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:137,columnNumber:11},void 0),d&&Yn.jsxDEV("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate random pattern",children:[Yn.jsxDEV(wt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:152,columnNumber:13},void 0),"Random"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:147,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-accent-error hover:bg-accent-error/10 rounded transition-colors",title:"Clear all steps",children:[Yn.jsxDEV(Ie,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:161,columnNumber:11},void 0),"Clear"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:156,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:123,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:47,columnNumber:7},void 0),h&&Yn.jsxDEV("div",{className:"border-b border-dark-border p-3 bg-dark-bg",children:Yn.jsxDEV(FO,{onClose:()=>f(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:170,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:169,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridControls.tsx",lineNumber:46,columnNumber:5},void 0)},RO=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],jO=127,XO=l.memo(({isActive:e,isCurrentStep:t=!1,onClick:n,color:s="default",size:a="normal"})=>{const o="small"===a?"w-5 h-5":"w-7 h-7";return Yn.jsxDEV("button",{onClick:n,className:`\n        ${o} rounded transition-all duration-75 border\n        ${(()=>{if(!e)return"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border";switch(s){case"accent":return"bg-accent-warning hover:bg-accent-warning/80 border-accent-warning/50";case"slide":return"bg-accent-secondary hover:bg-accent-secondary/80 border-accent-secondary/50";case"octave":return"bg-accent-primary/50 hover:bg-accent-primary/70 border-accent-primary/50";default:return"bg-accent-primary hover:bg-accent-primary/80 border-accent-primary/50"}})()}\n        ${t?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":""}\n        ${e?"shadow-sm":""}\n      `},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:55,columnNumber:5},void 0)}),zO=({x:e,y:t,accent:n,slide:s,mute:a,hammer:o,octaveShift:r,velocity:i,onToggleAccent:c,onToggleSlide:u,onToggleMute:d,onToggleHammer:m,onSetOctave:p,onSetVelocity:h,onClose:f})=>{const[g,b]=l.useState(i);return l.useEffect(()=>{const e=e=>{"Escape"===e.key&&f()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]),Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"fixed inset-0 z-40",onClick:f},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:125,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"fixed z-50 bg-dark-bgSecondary border border-dark-border rounded shadow-lg py-1 min-w-[160px]",style:{left:e,top:t},children:[Yn.jsxDEV("button",{onClick:()=>{c(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(n?"text-accent-warning":"text-text-secondary"),children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm "+(n?"bg-accent-warning":"border border-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:135,columnNumber:11},void 0),"Accent ",n&&""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:131,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{u(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(s?"text-accent-secondary":"text-text-secondary"),children:[Yn.jsxDEV("span",{className:"w-3 h-3 "+(s?"text-accent-secondary":"text-text-muted"),children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:142,columnNumber:11},void 0),"Slide ",s&&""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:138,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"border-t border-dark-border my-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:145,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{d(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(a?"text-yellow-400":"text-text-secondary"),children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm "+(a?"bg-yellow-400":"border border-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:151,columnNumber:11},void 0),"Mute ",a&&""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:147,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{m(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(o?"text-cyan-400":"text-text-secondary"),children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm "+(o?"bg-cyan-400":"border border-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:158,columnNumber:11},void 0),"Hammer ",o&&""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:154,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"border-t border-dark-border my-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:161,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{p(1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(1===r?"text-cyan-400":"text-text-secondary"),children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm "+(1===r?"bg-accent-primary ring-2 ring-cyan-400 ring-inset":"border border-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:166,columnNumber:11},void 0),"Oct+ ",1===r&&""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:162,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{p(0),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(0===r?"text-accent-primary":"text-text-secondary"),children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm "+(0===r?"bg-accent-primary":"border border-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:173,columnNumber:11},void 0),"Normal ",0===r&&""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:169,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{p(-1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(-1===r?"text-pink-400":"text-text-secondary"),children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm "+(-1===r?"bg-accent-primary ring-2 ring-pink-400 ring-inset":"border border-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:180,columnNumber:11},void 0),"Oct- ",-1===r&&""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:176,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"border-t border-dark-border my-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:183,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-3 py-2",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-1",children:[Yn.jsxDEV("span",{className:"text-xs text-text-secondary",children:"Velocity"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:187,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-primary font-mono",children:g},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:188,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:186,columnNumber:11},void 0),Yn.jsxDEV("input",{type:"range",min:1,max:jO,value:g,onChange:e=>{const t=parseInt(e.target.value,10);b(t),h(t)},className:"w-full h-1 bg-dark-bgTertiary rounded-lg appearance-none cursor-pointer accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:190,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex justify-between mt-1 text-[10px] text-text-muted",children:[Yn.jsxDEV("button",{onClick:()=>{h(64),b(64)},className:"hover:text-text-secondary",children:"50%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:199,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>{h(100),b(100)},className:"hover:text-text-secondary",children:"Default"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:205,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>{h(jO),b(jO)},className:"hover:text-text-secondary",children:"Max"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:211,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:198,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:185,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:127,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:123,columnNumber:5},void 0)},GO=l.memo(({noteIndex:e,stepIndex:t,isActive:n,isCurrentStep:s,isTriggered:a=!1,isFocused:o=!1,accent:r=!1,slide:i=!1,mute:c=!1,hammer:u=!1,octaveShift:d=0,velocity:m=100,cellSize:p=28,trailOpacity:h=0,isBeatMarker:f=!1,onClick:g,onToggleAccent:b,onToggleSlide:v,onToggleMute:y,onToggleHammer:x,onSetOctave:N,onSetVelocity:w,onFocus:E})=>{const[k,D]=l.useState(null),S=l.useCallback(s=>{if(n){if(s.shiftKey&&b)return void b(t);if((s.ctrlKey||s.metaKey)&&v)return void v(t);if(s.altKey&&N){return void N(t,0===d?1:1===d?-1:0)}}g(e,t,{shift:s.shiftKey,ctrl:s.ctrlKey||s.metaKey,alt:s.altKey})},[g,e,t,n,b,v,N,d]),M=l.useCallback(e=>{n&&(e.preventDefault(),D({x:e.clientX,y:e.clientY}))},[n]),C=l.useCallback(()=>{D(null)},[]),V=l.useCallback(()=>{b?.(t)},[b,t]),P=l.useCallback(()=>{v?.(t)},[v,t]),_=l.useCallback(()=>{y?.(t)},[y,t]),O=l.useCallback(()=>{x?.(t)},[x,t]),T=l.useCallback(e=>{N?.(t,e)},[N,t]),L=l.useCallback(e=>{w?.(t,e)},[w,t]),A=l.useCallback(e=>{if(!n||!w)return;e.preventDefault();const s=e.deltaY>0?-5:5,a=Math.max(1,Math.min(jO,m+s));w(t,a)},[n,w,t,m]),B=l.useCallback(()=>{E?.()},[E]);return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:S,onContextMenu:M,onWheel:A,onFocus:B,tabIndex:o?0:-1,style:{width:`${p}px`,height:`${p}px`,...n&&!a&&{backgroundColor:r?"#ef4444":"#ef4444CC"}},className:`\n          rounded relative\n          transition-[transform,box-shadow] duration-75\n          ${n?"hover:brightness-110":f?"bg-dark-bgActive hover:bg-dark-bgHover":"bg-dark-bgTertiary hover:bg-dark-bgActive"}\n          ${n&&0!==d?d>0?"ring-2 ring-cyan-400 ring-inset":"ring-2 ring-pink-400 ring-inset":""}\n          ${o&&!s?"ring-2 ring-text-secondary ring-offset-1 ring-offset-dark-bg":""}\n          ${n?"shadow-sm":""}\n          ${a&&n?"!bg-white scale-[1.35] shadow-2xl shadow-white/70":""}\n          ${!n||m>=100?"":m<50?"ring-1 ring-inset ring-black/30":m<80?"ring-1 ring-inset ring-black/15":""}\n          focus:outline-none\n        `,title:n?`Velocity: ${m} | Shift+click: accent, Ctrl+click: slide, Alt+click: octave, Scroll: velocity`:"","aria-label":`Step ${t+1}, Note ${RO[e]}${n?", Active":""}`,"aria-pressed":n,children:[s&&!a&&Yn.jsxDEV("div",{className:"absolute rounded pointer-events-none",style:{inset:"0",backgroundColor:"#ef4444",opacity:.35,zIndex:4}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:413,columnNumber:11},void 0),h>0&&Yn.jsxDEV("div",{className:"absolute rounded pointer-events-none",style:{inset:"0",backgroundColor:"#ef4444",opacity:.45*h,zIndex:5}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:425,columnNumber:11},void 0),n&&i&&!c&&Yn.jsxDEV("span",{className:"absolute inset-0 flex items-center justify-center text-white/90 text-xs font-bold z-10",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:437,columnNumber:11},void 0),n&&c&&Yn.jsxDEV("span",{className:"absolute inset-0 flex items-center justify-center text-yellow-400 text-xs font-bold z-10",children:"M"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:443,columnNumber:11},void 0),n&&u&&!c&&Yn.jsxDEV("span",{className:"absolute inset-0 flex items-center justify-center text-cyan-400 text-xs font-bold z-10",children:"H"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:449,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:383,columnNumber:7},void 0),k&&Yn.jsxDEV(zO,{x:k.x,y:k.y,accent:r,slide:i,mute:c,hammer:u,octaveShift:d,velocity:m,onToggleAccent:V,onToggleSlide:P,onToggleMute:_,onToggleHammer:O,onSetOctave:T,onSetVelocity:L,onClose:C},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:457,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:382,columnNumber:5},void 0)});l.memo(({stepIndex:e,isActive:t,isCurrentStep:n,color:s,onClick:o})=>{const r=a.useCallback(()=>{o(e)},[o,e]);return Yn.jsxDEV(XO,{isActive:t,isCurrentStep:n,onClick:r,color:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridCell.tsx",lineNumber:500,columnNumber:5},void 0)});const HO=["MINOR","MAJOR","DORIAN","MIXOLYDIAN","PHRYGIAN","HARMONIC_MINOR","PHRYGIAN_DOMINANT","MELODIC_MINOR","LYDIAN_DOMINANT","HUNGARIAN_MINOR"],WO={MINOR:[0,2,3,5,7,8,10],MAJOR:[0,2,4,5,7,9,11],DORIAN:[0,2,3,5,7,9,10],MIXOLYDIAN:[0,2,4,5,7,9,10],PHRYGIAN:[0,1,3,5,7,8,10],HARMONIC_MINOR:[0,2,3,5,7,8,11],PHRYGIAN_DOMINANT:[0,1,4,5,7,8,10],MELODIC_MINOR:[0,2,3,5,7,9,11],LYDIAN_DOMINANT:[0,2,4,6,7,9,10],HUNGARIAN_MINOR:[0,2,3,6,7,8,11]};function qO(e,t){return Math.floor(Math.random()*(t-e+1))+e}function KO(e,t){const n=[...e],s=[],a=Math.min(t,e.length);for(let o=0;o<a;o++){const e=Math.floor(Math.random()*(n.length-o))+o;[n[o],n[e]]=[n[e],n[o]],s.push(n[o])}return s}function $O(e){const t=e.match(/^([A-G][b#]?)(-?\d+)$/);if(!t)return 36;const[,n,s]=t,a=parseInt(s,10),o={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[n];return void 0===o?36:o+12*(a+1)}function YO(e={}){const{patternLength:t=16,density:n=60,spread:s=60,accentsDensity:a=50,slidesDensity:o=40,scale:r="MINOR",rootNote:i="C2",instrumentId:l=1}=e,c=function(e){const{patternLength:t,density:n,spread:s,accentsDensity:a,slidesDensity:o}=e,r=Array.from({length:t},(e,t)=>t),i=Math.round(t*(n/100)),l=qO(Math.round(i/2),i),c=KO(r,l),u=Math.max(1,Math.round(l/2*(a/100))),d=Math.round(l/2*(o/100)),m=KO(c,qO(1,u)),p=KO(c,qO(0,d)),h=Math.round(s/100*6),f=KO(Array.from({length:7},(e,t)=>t),Math.max(1,h)),g=KO(c,qO(0,l));return r.map(e=>{if(!c.includes(e))return{note:null,octave:null,accent:null,slide:null};const t=qO(-1,1);return{note:g.includes(e)&&f.length>0?f[qO(0,f.length-1)]:0,octave:t,accent:m.includes(e),slide:p.includes(e)}})}({patternLength:t,density:n,spread:s,accentsDensity:a,slidesDensity:o}),u=WO[r],d=$O(i);return c.map(e=>{if(null===e.note||null===e.octave)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const t=function(e,t,n,s){return t[e]+n+12*s}(e.note,u,d,e.octave),n=Za(t),s=e.accent?64:qO(48,56);return{note:n,instrument:l,volume:16+s,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:void 0,flag2:e.slide?2:void 0}})}function JO(e){return{MINOR:"Minor (Natural)",MAJOR:"Major",DORIAN:"Dorian",MIXOLYDIAN:"Mixolydian",PHRYGIAN:"Phrygian",HARMONIC_MINOR:"Harmonic Minor",PHRYGIAN_DOMINANT:"Phrygian Dominant",MELODIC_MINOR:"Melodic Minor",LYDIAN_DOMINANT:"Lydian Dominant",HUNGARIAN_MINOR:"Hungarian Minor"}[e]}function QO(e){return e.some(e=>0!==e.note||0!==e.instrument||0!==e.effTyp||0!==e.eff)}const ZO=({channelIndex:e,onClose:t})=>{const{patterns:n,currentPatternIndex:s,setChannelRows:a}=ID(),o=EN(e=>e.instruments),r=EN(e=>e.createInstrument),i=n[s],[c,u]=l.useState(e),d=i?.channels[c],[m,p]=l.useState(!1),h=l.useMemo(()=>o.find(e=>"TB303"===e.synthType||"Buzz3o3"===e.synthType),[o]),[f,g]=l.useState(h?.id??-1),[b,v]=l.useState(60),[y,x]=l.useState(60),[N,w]=l.useState(50),[E,k]=l.useState(40),[D,S]=l.useState("MINOR"),[M,C]=l.useState("C2"),V=["C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3"],P=l.useCallback(()=>{if(!d||!i)return;let e=f;-1===e&&(e=r({name:"TB-303",synthType:"TB303"}));const t=YO({patternLength:i.length,density:b,spread:y,accentsDensity:N,slidesDensity:E,scale:D,rootNote:M,instrumentId:e});a(c,t)},[d,i,f,r,b,y,N,E,D,M,c,a]),_=l.useCallback(()=>{d&&(QO(d.rows)?p(!0):(P(),t()))},[d,P,t]),O=l.useCallback(()=>{p(!1),P(),t()},[P,t]);return i?m?Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:()=>p(!1),children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-2 border-accent-warning rounded-lg shadow-2xl w-full max-w-sm",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-ft2-border bg-accent-warning/10",children:[Yn.jsxDEV(Xt,{size:20,className:"text-accent-warning"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:134,columnNumber:13},void 0),Yn.jsxDEV("h3",{className:"font-bold text-ft2-text",children:"Overwrite Channel?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:135,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:133,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"px-4 py-4 text-sm text-ft2-textDim",children:["Channel ",(c+1).toString().padStart(2,"0")," already contains note data. Generating will replace all existing data in this channel."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:137,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-ft2-border",children:[Yn.jsxDEV("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:142,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:O,className:"px-4 py-2 bg-accent-warning hover:bg-accent-warning/80 text-black rounded transition-colors font-medium",children:"Overwrite"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:148,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:141,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:129,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:125,columnNumber:7},void 0):Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:t,children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(Nt,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:172,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-lg font-bold text-ft2-text",children:"Acid Pattern Generator"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:173,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:171,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:180,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:175,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:170,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Channel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:190,columnNumber:15},void 0),Yn.jsxDEV("select",{value:c,onChange:e=>u(parseInt(e.target.value)),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:i.channels.map((e,t)=>Yn.jsxDEV("option",{value:t,children:[(t+1).toString().padStart(2,"0"),": ",e.name,QO(e.rows)?" *":""]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:197,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:191,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:189,columnNumber:13},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Instrument"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:207,columnNumber:15},void 0),Yn.jsxDEV("select",{value:f,onChange:e=>g(parseInt(e.target.value)),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[Yn.jsxDEV("option",{value:-1,children:"+ New TB-303"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:213,columnNumber:17},void 0),o.map(e=>Yn.jsxDEV("option",{value:e.id,children:[e.id,": ",e.name," (",e.synthType,")"]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:215,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:208,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:206,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:187,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-3",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Scale"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:226,columnNumber:15},void 0),Yn.jsxDEV("select",{value:D,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:HO.map(e=>Yn.jsxDEV("option",{value:e,children:JO(e)},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:233,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:227,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:225,columnNumber:13},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Root Note"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:241,columnNumber:15},void 0),Yn.jsxDEV("select",{value:M,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:V.map(e=>Yn.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:248,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:242,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:240,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:224,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Density: ",Yn.jsxDEV("span",{className:"font-mono text-accent-primary",children:[b,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:259,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:258,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:b,onChange:e=>v(parseInt(e.target.value)),className:"w-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:261,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many notes in the pattern (sparse - dense)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:266,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:257,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Spread: ",Yn.jsxDEV("span",{className:"font-mono text-accent-primary",children:[y,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:274,columnNumber:28},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:273,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:y,onChange:e=>x(parseInt(e.target.value)),className:"w-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:276,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mt-1",children:"Note range variety (narrow - wide)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:281,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:272,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Accents: ",Yn.jsxDEV("span",{className:"font-mono text-accent-primary",children:[N,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:289,columnNumber:24},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:288,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:N,onChange:e=>w(parseInt(e.target.value)),className:"w-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:291,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many accented notes (subtle - punchy)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:296,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:287,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Slides: ",Yn.jsxDEV("span",{className:"font-mono text-accent-primary",children:[E,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:304,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:303,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:E,onChange:e=>k(parseInt(e.target.value)),className:"w-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:306,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many slides/portamento (few - many)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:311,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:302,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:185,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-t border-ft2-border bg-dark-bgTertiary",children:[Yn.jsxDEV("button",{onClick:()=>{v(Math.floor(60*Math.random())+40),x(Math.floor(60*Math.random())+40),w(Math.floor(60*Math.random())+20),k(Math.floor(60*Math.random())+20),S(HO[Math.floor(Math.random()*HO.length)]),C(V[Math.floor(Math.random()*V.length)])},className:"flex items-center gap-2 px-3 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:[Yn.jsxDEV(zt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:323,columnNumber:13},void 0),"Randomize"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:319,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-2",children:[Yn.jsxDEV("button",{onClick:t,className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:328,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:_,className:"px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors font-medium",children:"Generate Pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:334,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:327,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:318,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:165,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AcidPatternGeneratorDialog.tsx",lineNumber:161,columnNumber:5},void 0):null},eT=["B","A#","A","G#","G","F#","F","E","D#","D","C#","C"],tT=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],nT=[11,10,9,8,7,6,5,4,3,2,1,0],sT=({channelIndex:e})=>{const{gridPattern:t,baseOctave:n,setBaseOctave:s,maxSteps:a,setMaxSteps:o,resizeAllPatterns:r,setNote:i,toggleAccent:c,toggleSlide:u,toggleMute:d,toggleHammer:m,setOctaveShift:p,setVelocity:h,clearAll:f}=OO(e),{currentRow:g,isPlaying:b,smoothScrolling:v}=jN(us(e=>({currentRow:e.currentRow,isPlaying:e.isPlaying,smoothScrolling:e.smoothScrolling}))),y=b?g%a:-1,x=l.useMemo(()=>y<0?[]:[{step:(y-1+a)%a,opacity:.5},{step:(y-2+a)%a,opacity:.4},{step:(y-3+a)%a,opacity:.3},{step:(y-4+a)%a,opacity:.2},{step:(y-5+a)%a,opacity:.15},{step:(y-6+a)%a,opacity:.1},{step:(y-7+a)%a,opacity:.05}],[y,a]),N=l.useRef(null),w=l.useRef(0),E=l.useRef(0),k=l.useRef(t.steps);l.useEffect(()=>{k.current=t.steps},[t.steps]);const[D,S]=l.useState(null),M=l.useRef(null),[C,V]=l.useState("chromatic"),[P,_]=l.useState(0),[O,T]=l.useState(!1),[L,A]=l.useState(28),{onMessage:B}=wV(),{applyGridMIDIValue:I}=OM();l.useEffect(()=>{null===D&&a>0&&requestAnimationFrame(()=>S({noteIndex:11,stepIndex:0}))},[D,a]),l.useEffect(()=>{const e=N.current;if(!e)return;const t=()=>{const t=e.clientWidth-48-16,n=Math.floor(t/a),s=Math.max(14,Math.min(28,n-4));A(s)};t();const n=new ResizeObserver(t);return n.observe(e),()=>n.disconnect()},[a]),l.useEffect(()=>{if(!b||!v)return void(E.current&&(cancelAnimationFrame(E.current),E.current=0));const e=N.current;if(!e)return;const t=L+4,n=()=>{const s=48+y*t,a=e.clientWidth,o=Math.max(0,s-.4*a);w.current+=.3*(o-w.current),e.scrollLeft=w.current,E.current=requestAnimationFrame(n)};return w.current=e.scrollLeft,E.current=requestAnimationFrame(n),()=>{E.current&&(cancelAnimationFrame(E.current),E.current=0)}},[b,v,L,y]),l.useEffect(()=>B(e=>{if("cc"!==e.type||void 0===e.controller||void 0===e.value)return;const t=I(e.channel,e.controller,e.value);if(null===t)return;const n=OM.getState().getGridMapping(e.channel,e.controller);if(n&&"baseOctave"===n.parameter)s(Math.round(t))}),[B,I,s]);const[F]=l.useState(!0),U=l.useCallback((t,s=0,a=!1,o=!1)=>{if(F)try{const r=Bw();if(!r)return;const{patterns:i,currentPatternIndex:l}=ID.getState(),c=i[l],u=c?.channels[e],d=u?.instrumentId??1,m=EN.getState().instruments.find(e=>e.id===d);if(m){const e=`${tT[t]}${n+s}`;r.triggerNote(d,e,.2,Y(),.8,m,a,o)}}catch(r){}},[F,e,n]),R=l.useCallback((e,t)=>{const n=k.current[t];if(n?.noteIndex===e)i(t,null);else{const s=null!==n?.noteIndex?n.octaveShift:0;i(t,e,s),U(e,s,n?.accent||!1,n?.slide||!1)}},[i,U]),j=l.useCallback((e,t)=>{p(e,t)},[p]),X=l.useCallback(()=>{for(let e=0;e<a;e++)if(Math.random()<.7){const t=Math.floor(12*Math.random()),n=Math.random()<.3?Math.random()<.5?-1:1:0;i(e,t,n),Math.random()<.25&&c(e),e>0&&Math.random()<.2&&u(e)}else i(e,null)},[a,i,c,u]),z=l.useCallback(()=>{T(!0)},[]),G=l.useMemo(()=>Array.from({length:a},(e,t)=>t),[a]),H=l.useMemo(()=>{const e=TO[C];return e&&"chromatic"!==C?nT.filter(t=>LO(t,P,e)):nT},[C,P]),W=l.useCallback(e=>{if(!D)return;const{noteIndex:t,stepIndex:n}=D,s=k.current[n],o=s?.noteIndex===t;if("ArrowRight"===e.key)e.preventDefault(),S({noteIndex:t,stepIndex:Math.min(n+1,a-1)});else if("ArrowLeft"===e.key)e.preventDefault(),S({noteIndex:t,stepIndex:Math.max(n-1,0)});else if("ArrowDown"===e.key){e.preventDefault();const s=nT.indexOf(t),a=Math.min(s+1,nT.length-1);S({noteIndex:nT[a],stepIndex:n})}else if("ArrowUp"===e.key){e.preventDefault();const s=nT.indexOf(t),a=Math.max(s-1,0);S({noteIndex:nT[a],stepIndex:n})}else if("Enter"===e.key||" "===e.key)e.preventDefault(),R(t,n);else if(o)if("a"===e.key||"A"===e.key)e.preventDefault(),c(n);else if("s"===e.key||"S"===e.key)e.preventDefault(),u(n);else if("m"===e.key||"M"===e.key)e.preventDefault(),d(n);else if("h"===e.key||"H"===e.key)e.preventDefault(),m(n);else if("o"===e.key||"O"===e.key){e.preventDefault();const t=s?.octaveShift??0;p(n,0===t?1:1===t?-1:0)}else if("v"===e.key||"V"===e.key)e.preventDefault(),h(n,100);else if("+"===e.key||"="===e.key){e.preventDefault();const t=s?.velocity??100;h(n,Math.min(127,t+10))}else if("-"===e.key||"_"===e.key){e.preventDefault();const t=s?.velocity??100;h(n,Math.max(1,t-10))}},[D,R,a,c,u,d,m,p,h]);return Yn.jsxDEV("div",{className:"flex flex-col h-full bg-dark-bg",children:[Yn.jsxDEV(UO,{baseOctave:n,onBaseOctaveChange:s,maxSteps:a,onMaxStepsChange:o,onResizeAllPatterns:r,scaleKey:C,rootNote:P,onScaleChange:V,onRootNoteChange:_,onClearAll:f,onRandomize:X,onAcidGenerator:z,cellSize:L},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:416,columnNumber:7},void 0),Yn.jsxDEV("div",{ref:N,className:"flex-1 overflow-auto p-2",children:[Yn.jsxDEV("div",{ref:M,className:"inline-block min-w-full relative",role:"grid","aria-label":"TB-303 Pattern Grid",onKeyDown:W,tabIndex:0,children:[Yn.jsxDEV("div",{className:"flex items-center mb-1 pl-12 relative",role:"row",style:{zIndex:10},children:G.map(e=>{const t=y===e,n=e%4==0;return Yn.jsxDEV("div",{className:`flex items-center justify-center text-[10px] font-mono mx-0.5 rounded-sm relative overflow-hidden\n                    ${n?"text-text-tertiary":"text-text-muted"}\n                    ${t?"text-white font-bold":""}\n                  `,style:{width:`${L}px`,height:`${L}px`},children:[t&&Yn.jsxDEV("div",{className:"absolute inset-0",style:{backgroundColor:"#ef4444",opacity:.6,zIndex:1}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:460,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"relative z-10",children:e.toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:465,columnNumber:19},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:448,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:443,columnNumber:11},void 0),H.map(e=>{const n=nT.indexOf(e),s=e===P;return Yn.jsxDEV("div",{className:"flex items-center mb-0.5 relative",role:"row",style:{isolation:"isolate"},children:[Yn.jsxDEV("div",{className:`w-10 mr-2 text-right text-xs font-mono\n                    ${s?"text-accent-primary font-bold":eT[n].includes("#")?"text-text-muted":"text-text-secondary"}\n                  `,"aria-label":`Note ${eT[n]}${s?" (Root)":""}`,children:[eT[n],s&&Yn.jsxDEV("span",{className:"ml-0.5 text-[8px]",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:486,columnNumber:34},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:479,columnNumber:17},void 0),G.map(n=>{const s=t.steps[n],a=s?.noteIndex===e,o=D?.noteIndex===e&&D?.stepIndex===n,r=x.find(e=>e.step===n)?.opacity||0,i=y===n,l=n%4==0;return Yn.jsxDEV("div",{className:"mx-0.5 rounded-sm relative",role:"gridcell",children:Yn.jsxDEV(GO,{noteIndex:e,stepIndex:n,isActive:a,isCurrentStep:i,isTriggered:y===n&&a,isFocused:o,accent:!!a&&s?.accent,slide:!!a&&s?.slide,mute:!!a&&s?.mute,hammer:!!a&&s?.hammer,octaveShift:a?s?.octaveShift:0,velocity:a?s?.velocity:100,cellSize:L,trailOpacity:r,isBeatMarker:l,onClick:R,onToggleAccent:c,onToggleSlide:u,onToggleMute:d,onToggleHammer:m,onSetOctave:j,onSetVelocity:h,onFocus:()=>S({noteIndex:e,stepIndex:n})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:506,columnNumber:21},void 0)},n,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:501,columnNumber:19},void 0)})]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:477,columnNumber:15},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:434,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"mt-4 pt-3 border-t border-dark-border space-y-2",children:[Yn.jsxDEV("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[Yn.jsxDEV("span",{children:"Click: note"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:542,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"flex items-center gap-1",children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm bg-accent-warning/80"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:544,columnNumber:15},void 0)," Shift+click: accent"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:543,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"flex items-center gap-1",children:[Yn.jsxDEV("span",{className:"text-accent-secondary",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:547,columnNumber:15},void 0)," Ctrl+click: slide"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:546,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"flex items-center gap-1",children:[Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-cyan-400 ring-inset"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:550,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-pink-400 ring-inset"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:551,columnNumber:15},void 0),"Alt+click: octave"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:549,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Right-click: menu"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:554,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Scroll: velocity"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:555,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:541,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[Yn.jsxDEV("span",{className:"font-semibold text-text-secondary",children:"Keyboard:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:558,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Arrows: navigate"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:559,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Enter/Space: toggle"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:560,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"A: accent"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:561,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"S: slide"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:562,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"M: mute"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:563,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"H: hammer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:564,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"O: octave"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:565,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"V: velocity reset"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:566,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"+/-: velocity 10"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:567,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:557,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:540,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:433,columnNumber:7},void 0),O&&Yn.jsxDEV(ZO,{channelIndex:e,onClose:()=>T(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:574,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/grid/GridSequencer.tsx",lineNumber:414,columnNumber:5},void 0)},aT={z:{note:"C",octaveOffset:0},s:{note:"C#",octaveOffset:0},x:{note:"D",octaveOffset:0},d:{note:"D#",octaveOffset:0},c:{note:"E",octaveOffset:0},v:{note:"F",octaveOffset:0},g:{note:"F#",octaveOffset:0},b:{note:"G",octaveOffset:0},h:{note:"G#",octaveOffset:0},n:{note:"A",octaveOffset:0},j:{note:"A#",octaveOffset:0},m:{note:"B",octaveOffset:0},",":{note:"C",octaveOffset:1},q:{note:"C",octaveOffset:1},2:{note:"C#",octaveOffset:1},w:{note:"D",octaveOffset:1},3:{note:"D#",octaveOffset:1},e:{note:"E",octaveOffset:1},r:{note:"F",octaveOffset:1},5:{note:"F#",octaveOffset:1},t:{note:"G",octaveOffset:1},6:{note:"G#",octaveOffset:1},y:{note:"A",octaveOffset:1},7:{note:"A#",octaveOffset:1},u:{note:"B",octaveOffset:1},i:{note:"C",octaveOffset:2},9:{note:"C#",octaveOffset:2},o:{note:"D",octaveOffset:2},0:{note:"D#",octaveOffset:2},p:{note:"E",octaveOffset:2}},oT={q:0,w:1,e:2,r:3,t:4,y:5,u:6,i:7},rT={a:8,s:9,d:10,f:11,g:12,h:13,j:14,k:15},iT="0123456789ABCDEFabcdef",lT={0:0,1:1,2:2,3:3,4:4,"-":6,"+":7,d:8,u:9,s:10,v:11,p:12,l:13,r:14,m:15},cT={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35},uT=()=>{const{cursor:e,patterns:t,currentPatternIndex:n,selection:s,currentOctave:a,recordMode:o,editStep:r,insertMode:i,multiRecEnabled:c,multiEditEnabled:u,recReleaseEnabled:d}=ID(us(e=>({cursor:e.cursor,patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,selection:e.selection,currentOctave:e.currentOctave,recordMode:e.recordMode,editStep:e.editStep,insertMode:e.insertMode,multiRecEnabled:e.multiRecEnabled,multiEditEnabled:e.multiEditEnabled,recReleaseEnabled:e.recReleaseEnabled}))),m=ID(e=>e.moveCursor),p=ID(e=>e.moveCursorToRow),h=ID(e=>e.moveCursorToChannel),f=ID(e=>e.moveCursorToColumn),g=ID(e=>e.setCell),b=ID(e=>e.clearCell),v=ID(e=>e.setCurrentPattern),y=ID(e=>e.startSelection),x=ID(e=>e.endSelection),N=ID(e=>e.clearSelection),w=ID(e=>e.copySelection),E=ID(e=>e.cutSelection),k=ID(e=>e.paste),D=ID(e=>e.pasteMix),S=ID(e=>e.pasteFlood),M=ID(e=>e.pastePushForward),C=ID(e=>e.setCurrentOctave),V=ID(e=>e.transposeSelection),P=ID(e=>e.toggleRecordMode),_=ID(e=>e.setEditStep),O=ID(e=>e.writeMacroSlot),T=ID(e=>e.readMacroSlot),L=ID(e=>e.toggleInsertMode),A=ID(e=>e.setKeyOn),B=ID(e=>e.setKeyOff),I=ID(e=>e.findBestChannel),F=ID(e=>e.insertRow),U=ID(e=>e.deleteRow),R=ID(e=>e.setPtnJumpPos),j=ID(e=>e.getPtnJumpPos),X=ID(e=>e.interpolateSelection),z=ID(e=>e.replacePattern),G=ID(e=>e.setColumnVisibility),{isPlaying:H,currentRow:W,stop:q,play:K,setIsLooping:$}=jN(us(e=>({isPlaying:e.isPlaying,currentRow:e.currentRow,stop:e.stop,play:e.play,setIsLooping:e.setIsLooping}))),{instruments:Y,currentInstrumentId:J,setCurrentInstrument:Q}=EN(),Z=t[n],ee=l.useRef(new Map),te=l.useRef(0),ne=l.useCallback(()=>u&&(o&&!H)||c&&(o&&H)?I():e.channelIndex,[e.channelIndex,o,H,u,c,I]),se=l.useCallback(async(e,t,n,s=!1)=>{if(null===J)return;const a=Bw(),o=Y.find(e=>e.id===J);if(!o)return;const r=`${e}${t}`,i=Xa(`${e}-${t}`);if(ee.current.has(n))return;const l=ee.current.size>0,c="TB303"===o.synthType||"Buzz3o3"===o.synthType,u=l&&c,d=s,m=ne();await a.ensureInstrumentReady(o);const{midiPolyphonic:p}=Ck.getState();p?a.triggerPolyNoteAttack(J,r,1,o,d,u):a.triggerNoteAttack(J,r,0,1,o,void 0,d,u),ee.current.set(n,{note:r,xmNote:i,instrumentId:J,channelIndex:m}),A(m,i)},[J,Y,ne,A]),ae=l.useCallback(e=>{const t=ee.current.get(e);if(!t)return;const n=Bw(),s=Y.find(e=>e.id===t.instrumentId),{midiPolyphonic:a}=Ck.getState();a&&s?n.triggerPolyNoteRelease(t.instrumentId,t.note,s):n.releaseNote(t.instrumentId,t.note),B(t.channelIndex),d&&o&&H&&g(t.channelIndex,W,{note:97}),ee.current.delete(e)},[Y,B,d,o,H,g,W]),oe=l.useCallback((t,n,s)=>{const a=Xa(`${t}-${n}`);if(0===a)return;const l=void 0!==s?s:ne(),c=o&&H?W:e.rowIndex;if(i&&!H&&F(l,c),g(l,c,{note:a,instrument:null!==J?J:void 0}),null!==J){const e=Y.find(e=>e.id===J);if(e&&("TB303"===e.synthType||"Buzz3o3"===e.synthType)){const e=ID.getState().columnVisibility;e.flag1&&e.flag2||G({flag1:!0,flag2:!0})}}if(LN.getState().chordEntryMode&&!H&&void 0===s){const t=Z.channels.length,n=e.channelIndex+1;if(n<t)return void h(n)}r>0&&!H&&p((e.rowIndex+r)%Z.length)},[e,g,o,r,Z,p,h,H,W,i,F,ne,J,Y,G]),re=l.useCallback(()=>{F(e.channelIndex,e.rowIndex)},[e,F]),ie=l.useCallback(()=>{U(e.channelIndex,e.rowIndex)},[e,U]),le=l.useCallback(i=>{if("tracker"!==LN.getState().activeView)return;if(i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement||i.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const l=i.key,c=l.toLowerCase();if("F9"===l){if(i.preventDefault(),i.shiftKey)R(0,e.rowIndex);else if(i.ctrlKey||i.metaKey){const e=j(0);p(e),H&&q(),$(!1),Bw().init().then(()=>K())}else p(0);return}if("F10"===l){if(i.preventDefault(),i.shiftKey)R(1,e.rowIndex);else if(i.ctrlKey||i.metaKey){const e=j(1);p(e),H&&q(),$(!1),Bw().init().then(()=>K())}else p(Math.floor(.25*Z.length));return}if("F11"===l){if(i.preventDefault(),i.shiftKey)R(2,e.rowIndex);else if(i.ctrlKey||i.metaKey){const e=j(2);p(e),H&&q(),$(!1),Bw().init().then(()=>K())}else p(Math.floor(.5*Z.length));return}if("F12"===l){if(i.preventDefault(),i.shiftKey)R(3,e.rowIndex);else if(i.ctrlKey||i.metaKey){const e=j(3);p(e),H&&q(),$(!1),Bw().init().then(()=>K())}else p(Math.floor(.75*Z.length));return}if("PageUp"===l)return i.preventDefault(),void p(Math.max(0,e.rowIndex-16));if("PageDown"===l)return i.preventDefault(),void p(Math.min(Z.length-1,e.rowIndex+16));if("Home"===l)return i.preventDefault(),void p(0);if("End"===l)return i.preventDefault(),void p(Z.length-1);if("Tab"===l)return i.preventDefault(),i.shiftKey?"note"===e.columnType&&(e.channelIndex>0?h(e.channelIndex-1):h(Z.channels.length-1)):e.channelIndex<Z.channels.length-1?h(e.channelIndex+1):h(0),void f("note");if(i.altKey&&void 0!==oT[c]){i.preventDefault();const e=oT[c]%Z.channels.length;return h(e),void f("note")}if(i.altKey&&void 0!==rT[c]){i.preventDefault();const e=rT[c]%Z.channels.length;return h(e),void f("note")}if((i.ctrlKey||i.metaKey)&&"z"===c&&!i.altKey){if(i.preventDefault(),i.shiftKey){const e=CD.getState();if(e.canRedo()){const t=e.redo();if(t){const s=e.getLastAction();z(s?.patternIndex??n,t),LN.getState().setStatusMessage(`REDO: ${s?.description??""}`)}}else LN.getState().setStatusMessage("NOTHING TO REDO")}else{const e=CD.getState();if(e.canUndo()){const t=e.getLastAction(),n=e.undo();n&&t&&(z(t.patternIndex,n),LN.getState().setStatusMessage(`UNDO: ${t.description}`))}else LN.getState().setStatusMessage("NOTHING TO UNDO")}return}if((i.ctrlKey||i.metaKey)&&"y"===c&&!i.altKey&&!i.shiftKey){i.preventDefault();const e=CD.getState();if(e.canRedo()){const t=e.redo();if(t){const s=e.getLastAction();z(s?.patternIndex??n,t),LN.getState().setStatusMessage(`REDO: ${s?.description??""}`)}}else LN.getState().setStatusMessage("NOTHING TO REDO");return}if((i.ctrlKey||i.metaKey)&&l>="1"&&l<="8"&&!i.altKey){i.preventDefault();const e=parseInt(l)-1;return void(i.shiftKey?O(e):T(e))}if("Insert"===l){if(i.preventDefault(),o)if(i.shiftKey)for(let t=0;t<Z.channels.length;t++)F(t,e.rowIndex);else re();else L();return}if(o&&(i.ctrlKey||i.metaKey)&&"ArrowUp"===l&&!i.altKey)return i.preventDefault(),void(i.shiftKey?V(12):V(1));if(o&&(i.ctrlKey||i.metaKey)&&"ArrowDown"===l&&!i.altKey)return i.preventDefault(),void(i.shiftKey?V(-12):V(-1));if("ArrowUp"===l)return i.preventDefault(),void(i.altKey||i.shiftKey?(s||y(),m("up"),x()):m("up"));if("ArrowDown"===l)return i.preventDefault(),void(i.altKey||i.shiftKey?(s||y(),m("down"),x()):m("down"));if("ArrowLeft"===l)return i.preventDefault(),void(i.shiftKey&&!i.altKey?n>0&&v(n-1):i.altKey?(s||y(),m("left"),x()):m("left"));if("ArrowRight"===l)return i.preventDefault(),void(i.shiftKey&&!i.altKey?n<t.length-1&&v(n+1):i.altKey?(s||y(),m("right"),x()):m("right"));if("Delete"===l&&o)return i.preventDefault(),i.shiftKey?g(e.channelIndex,e.rowIndex,{note:0,instrument:0,volume:0,effTyp:0,eff:0}):i.ctrlKey||i.metaKey?g(e.channelIndex,e.rowIndex,{volume:0,effTyp:0,eff:0}):i.altKey?g(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"note"===e.columnType?g(e.channelIndex,e.rowIndex,{note:0,instrument:0}):"instrument"===e.columnType?g(e.channelIndex,e.rowIndex,{instrument:0}):"volume"===e.columnType?g(e.channelIndex,e.rowIndex,{volume:0}):"effTyp"===e.columnType||"effParam"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"effTyp2"===e.columnType||"effParam2"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp2:0,eff2:0}):"probability"===e.columnType?g(e.channelIndex,e.rowIndex,{probability:void 0}):b(e.channelIndex,e.rowIndex),void(r>0&&!H&&p((e.rowIndex+r)%Z.length));if("Backspace"===l&&o)return i.preventDefault(),void(i.metaKey?("note"===e.columnType?g(e.channelIndex,e.rowIndex,{note:0,instrument:0}):"instrument"===e.columnType?g(e.channelIndex,e.rowIndex,{instrument:0}):"volume"===e.columnType?g(e.channelIndex,e.rowIndex,{volume:0}):"effTyp"===e.columnType||"effParam"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"effTyp2"===e.columnType||"effParam2"===e.columnType?g(e.channelIndex,e.rowIndex,{effTyp2:0,eff2:0}):"probability"===e.columnType?g(e.channelIndex,e.rowIndex,{probability:void 0}):b(e.channelIndex,e.rowIndex),r>0&&!H&&p((e.rowIndex+r)%Z.length)):i.shiftKey?e.rowIndex>0&&(m("up"),ie()):e.rowIndex>0?(m("up"),b(e.channelIndex,e.rowIndex)):b(e.channelIndex,0));if("F3"===l)return i.preventDefault(),void((i.altKey||i.ctrlKey||i.metaKey||i.shiftKey)&&E());if("F4"===l)return i.preventDefault(),void((i.altKey||i.ctrlKey||i.metaKey||i.shiftKey)&&w());if("F5"===l)return i.preventDefault(),void((i.altKey||i.ctrlKey||i.metaKey||i.shiftKey)&&k());if((i.ctrlKey||i.metaKey)&&"c"===c&&!i.altKey)return i.preventDefault(),w(),void LN.getState().setStatusMessage("COPY");if((i.ctrlKey||i.metaKey)&&"x"===c&&!i.altKey)return i.preventDefault(),E(),void LN.getState().setStatusMessage("CUT");if((i.ctrlKey||i.metaKey)&&"v"===c&&!i.altKey)return i.preventDefault(),void(i.shiftKey?(D(),LN.getState().setStatusMessage("MIX PASTE")):(k(),LN.getState().setStatusMessage("PASTE")));if((i.ctrlKey||i.metaKey)&&i.shiftKey&&"f"===c)return i.preventDefault(),void S();if((i.ctrlKey||i.metaKey)&&i.shiftKey&&"i"===c)return i.preventDefault(),void M();if(!("i"!==c||i.ctrlKey||i.metaKey||i.altKey||i.shiftKey||"volume"!==e.columnType)){if(i.preventDefault(),s){const t=Math.min(s.startRow,s.endRow),n=Math.max(s.startRow,s.endRow),a=e.channelIndex,o=Z.channels[a].rows[t],r=Z.channels[a].rows[n],i=o.volume||0,l=r.volume||64;X("volume",i,l,"linear"),LN.getState().setStatusMessage(`INTERPOLATE: ${i}  ${l}`)}else LN.getState().setStatusMessage("SELECT VOLUME RANGE FIRST");return}if((i.ctrlKey||i.metaKey)&&"h"===c&&!i.altKey){if(i.preventDefault(),"note"===e.columnType){const t=Z.channels[e.channelIndex].rows[e.rowIndex];if(t.note&&t.note>0&&t.note<97){const n=t.note,s=n+4,a=n+7;e.channelIndex+2<Z.channels.length?(g(e.channelIndex+1,e.rowIndex,{note:s,instrument:t.instrument}),g(e.channelIndex+2,e.rowIndex,{note:a,instrument:t.instrument}),LN.getState().setStatusMessage("CHORD: MAJOR")):LN.getState().setStatusMessage("CHORD: NOT ENOUGH CHANNELS")}else LN.getState().setStatusMessage("CHORD: NO NOTE")}return}if("Escape"===l){i.preventDefault();const e=Date.now();return void(e-te.current<500?(Bw().releaseAll(),LN.getState().setStatusMessage("PANIC - ALL NOTES OFF"),te.current=0):(N(),te.current=e))}if("Shift"===i.key&&2===i.location){if(UP().isActive)return;return i.preventDefault(),o||P(),H&&q(),$(!0),void Bw().init().then(()=>K())}if("Control"===i.key&&2===i.location){if(UP().isActive)return;return i.preventDefault(),H&&q(),$(!1),void Bw().init().then(()=>K())}if("Alt"===i.key&&2===i.location){if(UP().isActive)return;return i.preventDefault(),H&&q(),$(!0),void Bw().init().then(()=>K())}if(" "===l){if(i.preventDefault(),H)pD().stop(),q(),Bw().releaseAll(),LN.getState().setStatusMessage("STOPPED");else{P();const e=ID.getState().recordMode;LN.getState().setStatusMessage(e?"RECORD ON":"RECORD OFF")}return}if("Enter"===l&&(i.ctrlKey||i.metaKey))return i.preventDefault(),H&&q(),$(!1),Bw().init().then(()=>K()),void LN.getState().setStatusMessage("PLAYING");if("CapsLock"===l){if(i.preventDefault(),"note"===e.columnType){const t=o&&H?W:e.rowIndex;g(e.channelIndex,t,{note:97}),r>0&&!H&&p((e.rowIndex+r)%Z.length)}return}if(l>="F1"&&l<="F7"){i.preventDefault();const e=parseInt(l.substring(1));return C(e),void LN.getState().setStatusMessage(`OCTAVE ${e}`)}if("`"===l||"~"===l){let e;return i.preventDefault(),e=i.shiftKey?0===r?16:r-1:16===r?0:r+1,_(e),void LN.getState().setStatusMessage(`EDIT STEP ${e}`)}if("NumpadAdd"===i.code||"+"===l&&!i.shiftKey&&3===i.location)return i.preventDefault(),void(a<7&&C(a+1));if("NumpadSubtract"===i.code||"-"===l&&3===i.location)return i.preventDefault(),void(a>1&&C(a-1));if(aT[c]&&!i.altKey&&!i.ctrlKey&&!i.metaKey&&!i.repeat&&"note"===e.columnType){i.preventDefault();const{note:e,octaveOffset:t}=aT[c],n=a+t;if(se(e,n,c,i.shiftKey),o){const t=ee.current.get(c),s=t?.channelIndex;oe(e,n,s)}return}if(aT[c]&&i.repeat&&"note"===e.columnType){if(i.preventDefault(),o&&!H){const{note:e,octaveOffset:t}=aT[c],n=a+t,s=ee.current.get(c);oe(e,n,s?.channelIndex)}return}const u=Z.channels[e.channelIndex].rows[e.rowIndex];if(o&&"instrument"===e.columnType&&iT.includes(l)&&!i.altKey&&!i.ctrlKey&&!i.metaKey){i.preventDefault();const t=parseInt(l,16),n=u.instrument||0;let s;return s=0===e.digitIndex?t<<4|15&n:240&n|t,s>128&&(s=128),g(e.channelIndex,e.rowIndex,{instrument:s}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}if(o&&"volume"===e.columnType&&!i.altKey&&!i.ctrlKey&&!i.metaKey){const t=u.volume||0;if(0===e.digitIndex){const n=lT[c];if(void 0!==n){i.preventDefault();let s=n<<4|15&t;return s>=81&&s<=95&&(s=80),g(e.channelIndex,e.rowIndex,{volume:s}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}}else if(iT.includes(l)){i.preventDefault();const n=parseInt(l,16);let s;return s=t<16?16+n:240&t|n,s>=81&&s<=95&&(s=80),g(e.channelIndex,e.rowIndex,{volume:s}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}}if(o&&"effTyp"===e.columnType&&!i.altKey&&!i.ctrlKey&&!i.metaKey){const t=cT[c];if(void 0!==t){i.preventDefault();const n=(t<10?t.toString():String.fromCharCode(55+t))+(u.eff||0).toString(16).padStart(2,"0").toUpperCase();return g(e.channelIndex,e.rowIndex,{effTyp:t,effect:n}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}}if(o&&"effParam"===e.columnType&&iT.includes(l)&&!i.altKey&&!i.ctrlKey&&!i.metaKey){i.preventDefault();const t=parseInt(l,16),n=u.eff||0;let s;s=0===e.digitIndex?t<<4|15&n:240&n|t;const a=u.effTyp||0,o=(a<10?a.toString():String.fromCharCode(55+a))+s.toString(16).padStart(2,"0").toUpperCase();return g(e.channelIndex,e.rowIndex,{eff:s,effect:o}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}if(o&&"effTyp2"===e.columnType&&!i.altKey&&!i.ctrlKey&&!i.metaKey){const t=cT[c];if(void 0!==t){i.preventDefault();const n=(t<10?t.toString():String.fromCharCode(55+t))+(u.eff2||0).toString(16).padStart(2,"0").toUpperCase();return g(e.channelIndex,e.rowIndex,{effTyp2:t,effect2:n}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}}if(o&&("flag1"===e.columnType||"flag2"===e.columnType)&&!i.altKey&&!i.ctrlKey&&!i.metaKey){const t=e.columnType;if("a"===c)return i.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:1}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length));if("s"===c)return i.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:2}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length));if("m"===c)return i.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:3}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length));if("h"===c)return i.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:4}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length));if("0"===l||"."===l)return i.preventDefault(),g(e.channelIndex,e.rowIndex,{[t]:0}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}if(o&&"effParam2"===e.columnType&&iT.includes(l)&&!i.altKey&&!i.ctrlKey&&!i.metaKey){i.preventDefault();const t=parseInt(l,16),n=u.eff2||0;let s;s=0===e.digitIndex?t<<4|15&n:240&n|t;const a=u.effTyp2||0,o=(a<10?a.toString():String.fromCharCode(55+a))+s.toString(16).padStart(2,"0").toUpperCase();return g(e.channelIndex,e.rowIndex,{eff2:s,effect2:o}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}if(o&&"probability"===e.columnType&&/^[0-9]$/.test(l)&&!i.altKey&&!i.ctrlKey&&!i.metaKey){i.preventDefault();const t=parseInt(l,10),n=u.probability||0;let s;return s=0===e.digitIndex?10*t+n%10:10*Math.floor(n/10)+t,s=Math.min(99,Math.max(0,s)),g(e.channelIndex,e.rowIndex,{probability:s}),void(r>0&&!H&&p((e.rowIndex+r)%Z.length))}},[e,Z,t,n,H,W,a,J,Y,s,o,P,r,_,m,p,h,f,g,b,v,Q,q,K,y,x,N,w,E,k,D,S,M,se,oe,re,ie,V,R,j,T,O,C,L]),ce=l.useCallback(e=>{if("tracker"!==LN.getState().activeView)return;const t=e.key.toLowerCase();aT[t]&&ae(t)},[ae]);return l.useEffect(()=>(window.addEventListener("keydown",le,{capture:!0}),window.addEventListener("keyup",ce,{capture:!0}),()=>{window.removeEventListener("keydown",le,{capture:!0}),window.removeEventListener("keyup",ce,{capture:!0})}),[le,ce]),{previewNote:se,enterNote:oe,currentOctave:a,setCurrentOctave:C}},dT=()=>{const{cursor:e,selection:t,clipboard:n,patterns:s,currentPatternIndex:a,startSelection:o,endSelection:r,clearSelection:i,copySelection:c,cutSelection:u,paste:d,setCell:m}=ID(),[p,h]=l.useState({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}),f=s[a],g=l.useCallback(()=>{o(),h(e=>({...e,blockStartMarked:!0,blockEndMarked:!1,isBlockSelected:!1}))},[o,e]),b=l.useCallback(()=>{r(),h(e=>({...e,blockEndMarked:!0,isBlockSelected:!0}))},[r,e]),v=l.useCallback(()=>{t&&c()},[t,c]),y=l.useCallback(()=>{n&&d()},[n,d,e]),x=l.useCallback(()=>{t&&(u(),h({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}))},[t,u]),N=l.useCallback(()=>{i(),h({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1})},[i]),w=l.useCallback(()=>t?{startChannel:Math.min(t.startChannel,t.endChannel),endChannel:Math.max(t.startChannel,t.endChannel),startRow:Math.min(t.startRow,t.endRow),endRow:Math.max(t.startRow,t.endRow)}:null,[t]),E=l.useCallback((e,t)=>{const n=w();return!!n&&(e>=n.startChannel&&e<=n.endChannel&&t>=n.startRow&&t<=n.endRow)},[w]),k=l.useCallback(e=>{const t=w();if(t)for(let n=t.startChannel;n<=t.endChannel;n++)for(let s=t.startRow;s<=t.endRow;s++){const t=f.channels[n].rows[s];if(t.note&&0!==t.note&&97!==t.note){const a=Qa(t.note);if(null!==a){const t=a+e;if(t>=12&&t<=107){const e=Za(t);m(n,s,{note:e})}}}}},[w,f,m]),D=l.useCallback(e=>{const t=w();if(t)for(let n=t.startChannel;n<=t.endChannel;n++)for(let s=t.startRow;s<=t.endRow;s++){const t=f.channels[n].rows[s];if(null!==t.volume){const a=Math.min(64,Math.max(0,Math.round(t.volume*e)));m(n,s,{volume:a})}}},[w,f,m]),S=l.useCallback(e=>{const t=w();if(t)for(let n=t.startChannel;n<=t.endChannel;n++){const s=f.channels[n].rows[t.startRow],a=f.channels[n].rows[t.endRow],o=s[e]||0,r=a[e]||0,i=t.endRow-t.startRow;if(!(i<=1))for(let l=1;l<i;l++){const s=l/i,a=Math.round(o+(r-o)*s),c=t.startRow+l;m(n,c,{[e]:a})}}},[w,f,m]),M=l.useCallback(()=>{const e=w();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const n=[];for(let s=e.startChannel;s<=e.endChannel;s++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[s].rows[n]});n.push(t)}for(let s=e.startChannel;s<=e.endChannel;s++){const a=s-e.startChannel;for(let o=0;o<t;o++){const r=n[a][t-1-o];m(s,e.startRow+o,{note:r.note,instrument:r.instrument,volume:r.volume,effTyp:r.effTyp,eff:r.eff,effTyp2:r.effTyp2,eff2:r.eff2,flag1:r.flag1,flag2:r.flag2})}}},[w,f,m]),C=l.useCallback(()=>{const e=w();if(!e)return;const t=e.endRow-e.startRow+1,n=f.channels[0]?.rows.length||64,s=[];for(let a=e.startChannel;a<=e.endChannel;a++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[a].rows[n]});s.push(t)}for(let a=e.startChannel;a<=e.endChannel;a++){const o=a-e.startChannel;for(let r=0;r<2*t;r++){const t=e.startRow+r;if(t>=n)break;if(r%2==0){const e=s[o][r/2];m(a,t,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else m(a,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}},[w,f,m]),V=l.useCallback(()=>{const e=w();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const n=[];for(let s=e.startChannel;s<=e.endChannel;s++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[s].rows[n]});n.push(t)}for(let s=e.startChannel;s<=e.endChannel;s++){const a=s-e.startChannel;for(let o=0;o<t;o++){const r=e.startRow+o,i=2*o;if(i<t){const e=n[a][i];m(s,r,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else m(s,r,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}},[w,f,m]),P=l.useCallback((e,t,n)=>{const s=w();if(s)for(let a=s.startChannel;a<=s.endChannel;a++)for(let o=s.startRow;o<=s.endRow;o++){const s=f.channels[a].rows[o][n];if(0===s&&"volume"===n)continue;let r;switch(e){case"add":r=s+t;break;case"sub":r=s-t;break;case"mul":r=Math.round(s*t);break;case"div":r=0!==t?Math.round(s/t):s}const i="volume"===n?80:255;r=Math.max(0,Math.min(i,r)),m(a,o,{[n]:r})}},[w,f,m]),_=l.useCallback(()=>{const e=w();if(!e)return;const t=e.endRow-e.startRow+1,n=f.channels[0]?.rows.length||64,s=[];for(let o=e.startChannel;o<=e.endChannel;o++){const t=[];for(let n=e.startRow;n<=e.endRow;n++)t.push({...f.channels[o].rows[n]});s.push(t)}let a=e.endRow+1;for(;a<n;){for(let n=e.startChannel;n<=e.endChannel;n++){const o=n-e.startChannel,r=(a-e.endRow-1)%t,i=s[o][r];m(n,a,{note:i.note,instrument:i.instrument,volume:i.volume,effTyp:i.effTyp,eff:i.eff,effTyp2:i.effTyp2,eff2:i.eff2,flag1:i.flag1,flag2:i.flag2})}a++}},[w,f,m]);return l.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return e.altKey&&"b"===e.key.toLowerCase()?(e.preventDefault(),void g()):e.altKey&&"e"===e.key.toLowerCase()?(e.preventDefault(),void b()):e.altKey&&"c"===e.key.toLowerCase()?(e.preventDefault(),void v()):!e.altKey||"v"!==e.key.toLowerCase()&&"p"!==e.key.toLowerCase()?e.altKey&&"x"===e.key.toLowerCase()?(e.preventDefault(),void x()):"Escape"===e.key&&t?(e.preventDefault(),void N()):e.altKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void k(1)):e.altKey&&e.shiftKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void k(-1)):!e.altKey||"r"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?!e.altKey||"d"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?void 0:(e.preventDefault(),void _()):(e.preventDefault(),void M()):(e.preventDefault(),void y())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g,b,v,y,x,N,k,M,_,t]),{blockState:p,selection:t,clipboard:n,markBlockStart:g,markBlockEnd:b,copyBlock:v,pasteBlock:y,cutBlock:x,clearBlock:N,isCellInBlock:E,getBlockBounds:w,transposeBlock:k,amplifyBlock:D,interpolateBlock:S,reverseBlock:M,expandBlock:C,shrinkBlock:V,mathBlock:P,duplicateBlock:_}};let mT=0,pT=0,hT=60,fT=60,gT=0,bT=0;const vT=new Set,yT=[];let xT=0,NT=0;function wT(e){mT++,0===pT&&(pT=e);const t=e-pT;if(t>=1e3){hT=Math.round(1e3*mT/t),mT=0,pT=e,yT.push(hT),yT.length>4&&yT.shift(),fT=Math.round(yT.reduce((e,t)=>e+t,0)/yT.length);for(const e of vT)e(hT,fT);const n=fT>=50?"high":fT>=30?"medium":"low",s=LN.getState();s.performanceQuality!==n&&s.setPerformanceQuality(n);const a=e-NT;"low"===n&&yT.length>=4&&a>5e3&&e-xT>6e4&&(xT=e,_k.warning(`Low performance (${fT} FPS). Playback may stutter. Try closing other tabs or switching to DOM mode in Settings.`,1e4))}gT=requestAnimationFrame(wT)}function ET(){const[e,t]=l.useState({fps:60,averageFps:60}),n=LN(e=>e.performanceQuality);return l.useEffect(()=>{bT++,1===bT&&(pT=0,mT=0,yT.length=0,hT=60,fT=60,NT=performance.now(),xT=0,gT=requestAnimationFrame(wT));const e=(e,n)=>{t({fps:e,averageFps:n})};return vT.add(e),()=>{vT.delete(e),bT--,bT<=0&&(bT=0,cancelAnimationFrame(gT),gT=0)}},[]),{fps:e.fps,averageFps:e.averageFps,quality:n}}const kT=({isOpen:e,onClose:t,children:n,theme:s="modern",size:a="md",backdropOpacity:o="medium",rounded:r=!0,closeOnBackdropClick:i=!0,closeOnEscape:c=!0,animation:u="fade",className:d=""})=>{l.useEffect(()=>{if(!e||!c)return;const n=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,c,t]);if(!e)return null;const m=`\n    fixed inset-0 z-50 flex items-center justify-center p-4\n    ${{light:"bg-black/50",medium:"bg-black/60",dark:"bg-black/80"}[o]}\n  `,p=`\n    ${{sm:"w-80 max-w-sm",md:"w-96 max-w-md",lg:"max-w-2xl w-full",xl:"max-w-4xl w-full",fullscreen:"w-full h-full"}[a]}\n    ${"retro"===s?"bg-ft2-bg border-ft2-border":"bg-dark-bg border-dark-border"}\n    ${"retro"===s?"border-2":"border"}\n    ${r?"rounded-lg":""}\n    ${{fade:"animate-fade-in",slide:"animate-slide-in-up",scale:"animate-scale-in"}[u]}\n    ${"fullscreen"!==a?"shadow-xl max-h-[90vh] overflow-hidden":""}\n    ${d}\n    flex flex-col\n  `;return Yn.jsxDEV("div",{className:m,onClick:e=>{i&&e.target===e.currentTarget&&t()},children:Yn.jsxDEV("div",{className:p,children:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/Modal.tsx",lineNumber:122,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/Modal.tsx",lineNumber:118,columnNumber:5},void 0)},DT=({title:e,subtitle:t,icon:n,onClose:s,theme:a="modern",showCloseButton:o=!0,className:r=""})=>{const i="retro"===a?"bg-ft2-header border-ft2-border text-ft2-highlight":"bg-dark-bgSecondary border-dark-border text-text-primary",l="retro"===a?"border-b-2":"border-b",c="retro"===a?"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none":"p-2 rounded-lg hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors focus:outline-none";return Yn.jsxDEV("div",{className:`flex items-center justify-between px-4 py-3 ${l} ${i} ${r}`,children:[Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[n&&Yn.jsxDEV("div",{className:"text-accent-primary",children:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:42,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("h2",{className:"font-bold tracking-wide "+("retro"===a?"text-sm":"text-base"),children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:47,columnNumber:11},void 0),t&&Yn.jsxDEV("p",{className:"text-text-secondary "+("retro"===a?"text-xs":"text-sm"),children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:51,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:46,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:40,columnNumber:7},void 0),o&&s&&Yn.jsxDEV("button",{onClick:s,className:c,"aria-label":"Close",title:"Close (Esc)",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:64,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:58,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalHeader.tsx",lineNumber:39,columnNumber:5},void 0)},ST=({children:e,theme:t="modern",align:n="right"})=>{const s="retro"===t?"bg-ft2-header border-ft2-border":"bg-dark-bgSecondary border-dark-border",a="retro"===t?"border-t-2":"border-t";return Yn.jsxDEV("div",{className:`flex gap-2 px-4 py-3 ${a} ${s} ${{left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"}[n]}`,children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ModalFooter.tsx",lineNumber:34,columnNumber:5},void 0)};function MT({isOpen:e,onConfirm:t,onCancel:n,confirmDisabled:s=!1,enableEnter:a=!0,enableEscape:o=!0,enableCtrlEnter:r=!0,onCtrlEnter:i,ctrlEnterDisabled:c=!1,preventEnterInTextarea:u=!0}){const d=l.useRef(null);l.useEffect(()=>{e?(d.current=document.activeElement,setTimeout(()=>{const e=document.querySelector('input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])');e?.focus()},100)):d.current&&(d.current.focus(),d.current=null)},[e]);const m=l.useCallback(l=>{if(!e)return;const d=l.target,m="TEXTAREA"===d.tagName,p="SELECT"===d.tagName,h="BUTTON"===d.tagName;if(o&&"Escape"===l.key)return l.preventDefault(),l.stopPropagation(),void n();if(r&&"Enter"===l.key&&(l.ctrlKey||l.metaKey))i&&!c?(l.preventDefault(),l.stopPropagation(),i()):s||(l.preventDefault(),l.stopPropagation(),t());else if(a&&"Enter"===l.key&&!l.ctrlKey&&!l.metaKey&&!l.shiftKey){if(m&&u)return;if(p)return;if(h)return;s||(l.preventDefault(),l.stopPropagation(),t())}},[e,t,n,s,a,o,r,u]);return l.useEffect(()=>{if(e)return document.addEventListener("keydown",m,{capture:!0}),()=>document.removeEventListener("keydown",m,{capture:!0})},[e,m]),{shortcuts:{confirm:r&&!i?" or Ctrl+":a?"":null,ctrlEnter:r&&i?"Ctrl+":null,cancel:o?"Esc":null}}}const CT=[{value:"volume",label:"Volume",min:0,max:64},{value:"cutoff",label:"Cutoff",min:0,max:127},{value:"resonance",label:"Resonance",min:0,max:127},{value:"envMod",label:"Env Mod",min:0,max:127},{value:"pan",label:"Pan",min:-100,max:100}],VT=[{value:"linear",label:"Linear",description:"Constant rate of change"},{value:"log",label:"Logarithmic",description:"Fast start, gradual end"},{value:"exp",label:"Exponential",description:"Gradual start, fast end"},{value:"scurve",label:"S-Curve",description:"Smooth ease in/out"}],PT=({isOpen:e,onClose:t})=>{const{selection:n,interpolateSelection:s}=ID(),[a,o]=l.useState("volume"),[r,i]=l.useState(64),[c,u]=l.useState(0),[d,m]=l.useState("linear"),p=CT.find(e=>e.value===a),h=()=>{n?(s(a,r,c,d),t()):alert("Please select a region first (Alt+Arrow keys to select)")},{shortcuts:f}=MT({isOpen:e,onConfirm:h,onCancel:t,confirmDisabled:!n});return Yn.jsxDEV(kT,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Yn.jsxDEV(DT,{title:"Interpolate Selection",icon:Yn.jsxDEV(St,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:90,columnNumber:15},void 0),onClose:t,theme:"modern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:88,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:"Column"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:99,columnNumber:11},void 0),Yn.jsxDEV("select",{value:a,onChange:e=>(e=>{o(e);const t=CT.find(t=>t.value===e);"pan"===e?(i(-100),u(100)):(i(t.max),u(0))})(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:CT.map(e=>Yn.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:106,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:100,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:98,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:["Start Value (",p.min," - ",p.max,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:113,columnNumber:11},void 0),Yn.jsxDEV("input",{type:"number",value:r,onChange:e=>i(Math.max(p.min,Math.min(p.max,parseInt(e.target.value)||0))),min:p.min,max:p.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:116,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:112,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:["End Value (",p.min," - ",p.max,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:128,columnNumber:11},void 0),Yn.jsxDEV("input",{type:"number",value:c,onChange:e=>u(Math.max(p.min,Math.min(p.max,parseInt(e.target.value)||0))),min:p.min,max:p.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:131,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:127,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:"Curve"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:143,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-4 gap-1",children:VT.map(e=>Yn.jsxDEV("button",{onClick:()=>m(e.value),className:"px-2 py-1.5 text-xs rounded border transition-colors "+(d===e.value?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),title:e.description,children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:146,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:144,columnNumber:11},void 0),Yn.jsxDEV("p",{className:"text-[10px] text-text-muted mt-1",children:VT.find(e=>e.value===d)?.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:160,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:142,columnNumber:9},void 0),!n&&Yn.jsxDEV("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:167,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:96,columnNumber:7},void 0),Yn.jsxDEV(ST,{theme:"modern",align:"right",children:[Yn.jsxDEV(TV,{variant:"ghost",onClick:t,children:["Cancel ",f.cancel&&Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:f.cancel},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:175,columnNumber:39},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:174,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"primary",onClick:h,disabled:!n,children:["Apply ",f.confirm&&!n?null:f.confirm&&Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:f.confirm},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:182,columnNumber:80},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:177,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:173,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/InterpolateDialog.tsx",lineNumber:79,columnNumber:5},void 0)},_T=Object.freeze(Object.defineProperty({__proto__:null,InterpolateDialog:PT},Symbol.toStringTag,{value:"Module"})),OT=({isOpen:e,onClose:t})=>{const{selection:n,humanizeSelection:s}=ID(),[a,o]=l.useState(15),r=()=>{n?(s(a),t()):alert("Please select a region first (Alt+Arrow keys to select)")},{shortcuts:i}=MT({isOpen:e,onConfirm:r,onCancel:t,confirmDisabled:!n});return Yn.jsxDEV(kT,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Yn.jsxDEV(DT,{title:"Humanize Selection",icon:Yn.jsxDEV(Dt,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:54,columnNumber:15},void 0),onClose:t,theme:"modern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:52,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4",children:[Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Add random variation to volume values to create a more human feel."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:61,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-2",children:["Volume Variation: ",Yn.jsxDEV("span",{className:"text-accent-primary font-mono",children:[a,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:68,columnNumber:31},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:67,columnNumber:11},void 0),Yn.jsxDEV("input",{type:"range",value:a,onChange:e=>o(parseInt(e.target.value)),min:0,max:50,className:"w-full accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:70,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-xs text-text-muted mt-1",children:[Yn.jsxDEV("span",{children:"0% (none)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:79,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"50% (max)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:80,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:78,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:66,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"bg-dark-bg rounded p-3 text-xs text-text-secondary",children:Yn.jsxDEV("p",{children:["Each note's volume will be randomly adjusted by up to ",a,"% of its current value."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:86,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:85,columnNumber:9},void 0),!n&&Yn.jsxDEV("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:91,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:60,columnNumber:7},void 0),Yn.jsxDEV(ST,{theme:"modern",align:"right",children:[Yn.jsxDEV(TV,{variant:"ghost",onClick:t,children:["Cancel ",i.cancel&&Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:i.cancel},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:99,columnNumber:39},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:98,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"primary",onClick:r,disabled:!n,children:["Apply ",i.confirm&&!n?null:i.confirm&&Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:i.confirm},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:106,columnNumber:80},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:101,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:97,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/HumanizeDialog.tsx",lineNumber:43,columnNumber:5},void 0)},TT=Object.freeze(Object.defineProperty({__proto__:null,HumanizeDialog:OT},Symbol.toStringTag,{value:"Module"})),LT=({isOpen:e,onClose:t})=>{const{patterns:n,currentPatternIndex:s,selection:a}=ID(),[o,r]=l.useState("note"),[i,c]=l.useState("pattern"),[u,d]=l.useState(""),[m,p]=l.useState(""),[h,f]=l.useState(null),[g,b]=l.useState(null),v=n[s],y=()=>{let e=0;const t="all"===i?n:[v];for(const n of t)for(const t of n.channels)for(let s=0;s<n.length;s++){if("selection"===i&&a){const e=Math.min(a.startChannel,a.endChannel),o=Math.max(a.startChannel,a.endChannel),r=Math.min(a.startRow,a.endRow),i=Math.max(a.startRow,a.endRow),l=n.channels.indexOf(t);if(l<e||l>o||s<r||s>i)continue}const r=t.rows[s];if("note"===o&&r.note&&0!==r.note&&97!==r.note){Ga(r.note).toLowerCase().includes(u.toLowerCase())&&e++}else if("instrument"===o&&0!==r.instrument){r.instrument.toString(16).toUpperCase().padStart(2,"0").includes(u.toUpperCase())&&e++}else if("effect"===o&&(0!==r.effTyp||0!==r.eff)){$a(r.effTyp,r.eff).toLowerCase().includes(u.toLowerCase())&&e++}}f(e),b(null)},x=()=>{if(!u)return;let e=0;ID.setState(t=>{const n="all"===i?t.patterns:[t.patterns[s]];for(const s of n)for(let t=0;t<s.channels.length;t++){const n=s.channels[t];for(let r=0;r<s.length;r++){if("selection"===i&&a){const e=Math.min(a.startChannel,a.endChannel),n=Math.max(a.startChannel,a.endChannel),s=Math.min(a.startRow,a.endRow),o=Math.max(a.startRow,a.endRow);if(t<e||t>n||r<s||r>o)continue}const s=n.rows[r];if("note"===o&&s.note&&0!==s.note&&97!==s.note){Ga(s.note).toLowerCase().includes(u.toLowerCase())&&(s.note=""===m?0:Xa(m.toUpperCase()),e++)}else if("instrument"===o&&0!==s.instrument){s.instrument.toString(16).toUpperCase().padStart(2,"0").includes(u.toUpperCase())&&(s.instrument=""===m?0:parseInt(m,16)||0,e++)}else if("effect"===o&&(0!==s.effTyp||0!==s.eff)){if($a(s.effTyp,s.eff).toLowerCase().includes(u.toLowerCase())){if(""===m)s.effTyp=0,s.eff=0;else{const[e,t]=qa(m.toUpperCase());s.effTyp=e,s.eff=t}e++}}}}}),b(e),f(null)};return MT({isOpen:e,onConfirm:y,onCancel:t,onCtrlEnter:x,confirmDisabled:!u,ctrlEnterDisabled:!u}),Yn.jsxDEV(kT,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Yn.jsxDEV(DT,{title:"Find & Replace",icon:Yn.jsxDEV(Gt,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:164,columnNumber:15},void 0),onClose:t,theme:"modern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:162,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4",children:[Yn.jsxDEV("div",{className:"flex gap-2",children:["note","instrument","effect"].map(e=>Yn.jsxDEV("button",{onClick:()=>r(e),className:"flex-1 px-3 py-2 text-xs rounded transition-colors "+(o===e?"bg-accent-primary text-white":"bg-dark-bg text-text-secondary hover:text-text-primary"),children:e.charAt(0).toUpperCase()+e.slice(1)},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:174,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:172,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:"Scope"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:190,columnNumber:11},void 0),Yn.jsxDEV("select",{value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[Yn.jsxDEV("option",{value:"selection",disabled:!a,children:["Selection ",!a&&"(none)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:196,columnNumber:13},void 0),Yn.jsxDEV("option",{value:"pattern",children:"Current Pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:197,columnNumber:13},void 0),Yn.jsxDEV("option",{value:"all",children:"All Patterns"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:198,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:191,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:189,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:"Find"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:204,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV(Gt,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:206,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"note"===o?"e.g., C-4":"instrument"===o?"e.g., 01":"e.g., A0F",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:207,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:205,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:203,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:"Replace with (empty to clear)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:219,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV(Ht,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:221,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"text",value:m,onChange:e=>p(e.target.value),placeholder:"Leave empty to clear",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:222,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:220,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:218,columnNumber:9},void 0),null!==h&&Yn.jsxDEV("p",{className:"text-xs text-accent-primary",children:["Found ",h," match",1!==h?"es":""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:234,columnNumber:11},void 0),null!==g&&Yn.jsxDEV("p",{className:"text-xs text-accent-success",children:["Replaced ",g," occurrence",1!==g?"s":""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:237,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:170,columnNumber:7},void 0),Yn.jsxDEV(ST,{theme:"modern",align:"right",children:[Yn.jsxDEV(TV,{variant:"ghost",onClick:t,children:["Close ",Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:"Esc"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:243,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:242,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"default",onClick:y,disabled:!u,children:["Find ",u?Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:250,columnNumber:37},void 0):null]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:245,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"primary",onClick:x,disabled:!u,children:["Replace All ",u?Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:"Ctrl+"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:257,columnNumber:44},void 0):null]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:252,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:241,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FindReplaceDialog.tsx",lineNumber:153,columnNumber:5},void 0)},AT=Object.freeze(Object.defineProperty({__proto__:null,FindReplaceDialog:LT},Symbol.toStringTag,{value:"Module"}));class BT{context=null;gain=null;processNode=null;config;handlers=new Map;initialized=!1;initError=null;initPromise=null;meta=null;duration=0;currentTime=0;order=0;pattern=0;row=0;constructor(e={}){this.config={repeatCount:-1,stereoSeparation:100,interpolationFilter:0,...e}}async ensureInitialized(){return!!this.initialized||!this.initError&&(this.initPromise?(await this.initPromise,this.initialized):(this.initPromise=this.initWorklet(),await this.initPromise,this.initialized))}async initWorklet(){try{try{this.context=oo()}catch{this.context=new AudioContext}"suspended"===this.context.state&&await this.context.resume(),this.gain=this.context.createGain(),this.gain.gain.value=1;const e="/";await this.context.audioWorklet.addModule(`${e}chiptune3/chiptune3.worklet.js`),this.processNode=new AudioWorkletNode(this.context,"libopenmpt-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.processNode.port.onmessage=this.handleMessage.bind(this),this.processNode.port.postMessage({cmd:"config",val:this.config}),this.processNode.connect(this.gain),this.gain.connect(this.context.destination),this.initialized=!0,this.fireEvent("onInitialized")}catch(e){const t=e instanceof Error?e.message:String(e);this.initError=t,this.fireEvent("onError",{type:"init",message:t})}}handleMessage(e){const{cmd:t,meta:n,pos:s,order:a,pattern:o,row:r,val:i}=e.data;switch(t){case"meta":this.meta=n,this.duration=n?.dur||0,this.fireEvent("onMetadata",n);break;case"pos":this.currentTime=s,this.order=a,this.pattern=o,this.row=r,this.fireEvent("onProgress",e.data);break;case"end":this.fireEvent("onEnded");break;case"err":this.fireEvent("onError",{type:i})}}fireEvent(e,t){const n=this.handlers.get(e);n&&n.forEach(e=>e(t))}addHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}onInitialized(e){this.initialized?e():this.initError?this.fireEvent("onError",{type:"init",message:this.initError}):(this.addHandler("onInitialized",e),this.ensureInitialized())}onEnded(e){this.addHandler("onEnded",e)}onError(e){this.addHandler("onError",e)}onMetadata(e){this.addHandler("onMetadata",e)}onProgress(e){this.addHandler("onProgress",e)}async play(e){await this.ensureInitialized()&&this.processNode&&this.context?("suspended"===this.context.state&&await this.context.resume(),this.processNode.port.postMessage({cmd:"play",val:e})):this.fireEvent("onError",{type:"not_initialized"})}stop(){this.processNode?.port.postMessage({cmd:"stop"})}pause(){this.processNode?.port.postMessage({cmd:"pause"})}unpause(){this.processNode?.port.postMessage({cmd:"unpause"})}setVol(e){this.gain&&(this.gain.gain.value=e)}setPos(e){this.processNode?.port.postMessage({cmd:"setPos",val:e})}setRepeatCount(e){this.processNode?.port.postMessage({cmd:"repeatCount",val:e})}isAvailable(){return this.initialized&&!this.initError}getInitError(){return this.initError}}function IT(e,t=0){const n={attack:10,decay:500,sustain:t,release:100};if(!e||!e.enabled||e.points.length<2)return n;const s=e.points;try{const t=function(e){if(0===e.length)return 10;const t=e[0];let n=0,s=e[0].value;for(let i=1;i<e.length;i++)if(e[i].value>s)s=e[i].value,n=i;else if(e[i].value<s-5)break;const a=e[n],o=a.tick-t.tick,r=32;return Math.max(1,o*r)}(s),{decay:n,sustain:a}=function(e,t,n){if(0===e.length)return{decay:500,sustain:0};let s=0,a=e[0].value;for(let m=0;m<e.length;m++)e[m].value>a&&(a=e[m].value,s=m);const o=null!==n&&n>=0&&n<e.length?n:null;let r=o??s,i=e[r]?.value??a;if(null!==o)i=e[o].value;else for(let m=s+1;m<e.length;m++){if(Math.abs(e[m].value-e[m-1].value)<6){r=m,i=e[m].value;break}}const l=(r<e.length?e[r].tick:e[s].tick)-e[s].tick,c=32,u=Math.max(0,l*c),d=i/64*100;return{decay:u,sustain:d}}(s,0,e.sustainPoint),o=function(e,t){if(0===e.length)return 100;const n=t??Math.max(0,e.length-2);if(n>=e.length-1)return 100;let s=e.length-1;for(let r=n+1;r<e.length;r++)if(e[r].value<5){s=r;break}const a=e[s].tick-e[n].tick,o=32;return Math.max(10,a*o)}(s,e.sustainPoint);return{attack:Math.max(0,Math.min(2e3,t)),decay:Math.max(0,Math.min(2e3,n)),sustain:Math.max(0,Math.min(100,a)),release:Math.max(0,Math.min(5e3,o))}}catch(a){return n}}function FT(e,t,n){const s=[];if(e.furnace){const a=e.furnace.synthType;if("Sampler"===a||"Player"===a){if(e.samples.length>0)for(let a=0;a<e.samples.length;a++){const o=RT(e.samples[a],e,t+a,n);s.push(o)}else{const n=UT(e,t);s.push(n)}return s}const o=UT(e,t);s.push(o);for(let r=0;r<e.samples.length;r++){const a=RT(e.samples[r],e,t+r+1,n);s.push(a)}return s}for(let a=0;a<e.samples.length;a++){const o=RT(e.samples[a],e,t,n);0===a&&s.push(o)}if(e.samples.length>1&&s.length>0){const t=s[0];t.metadata&&(t.metadata.multiSamples=e.samples.map(e=>{const{audioBuffer:t,blobUrl:n,loopStart:s,loopEnd:a}=jT(e),o=XT(e.relativeNote,e.finetune),r=100*e.finetune/128,i=e.sampleRate||8363;return{sample:{audioBuffer:t,url:n,baseNote:o,detune:r,loop:"none"!==e.loopType,loopStart:s,loopEnd:a,sampleRate:i,reverse:!1,playbackRate:1},finetune:e.finetune,relativeNote:e.relativeNote,defaultVolume:e.volume}}))}return s}function UT(e,t){const n=e.furnace,s=n.synthType,a={chipType:n.chipType,furnaceIndex:e.id-1,rawBinaryData:e.rawBinaryData,algorithm:n.fm?.algorithm??0,feedback:n.fm?.feedback??0,fms:n.fm?.fms??0,ams:n.fm?.ams??0,ops:n.fm?.ops??4,opllPreset:n.fm?.opllPreset??0,operators:n.fm?.operators?.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r??0,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2??0,rs:e.rs??0,am:e.am??!1,ksr:e.ksr??!1,ksl:e.ksl??0,sus:e.sus??!1,vib:e.vib??!1,ws:e.ws??0,ssg:e.ssg??0}))??[],macros:n.macros.map(e=>({code:e.type,type:e.type,data:[...e.data],loop:e.loop,release:e.release,mode:e.mode??0,delay:e.delay,speed:e.speed})),opMacros:[],opMacroArrays:n.opMacroArrays?.map(e=>e.map(e=>({code:e.type,type:e.type,data:[...e.data],loop:e.loop,release:e.release,mode:e.mode??0,delay:e.delay,speed:e.speed}))),wavetables:n.wavetables.map(e=>({id:e.id,data:[...e.data],len:e.len,max:e.max}))};if(n.chipConfig){const e=n.chipConfig;if(e.gb){const t=e.gb;a.gb={envVol:t.envVol,envDir:t.envDir,envLen:t.envLen,soundLen:t.soundLen,softEnv:t.softEnv,alwaysInit:t.alwaysInit,hwSeqLen:t.hwSeqLen,hwSeq:t.hwSeq}}if(e.c64){const t=e.c64;a.c64={triOn:t.triOn,sawOn:t.sawOn,pulseOn:t.pulseOn,noiseOn:t.noiseOn,a:t.a,d:t.d,s:t.s,r:t.r,duty:t.duty,ringMod:t.ringMod,oscSync:t.oscSync,toFilter:t.toFilter,initFilter:t.initFilter,filterResonance:t.res,filterCutoff:t.cut,filterLP:t.lp,filterBP:t.bp,filterHP:t.hp,filterCh3Off:t.ch3off,dutyIsAbs:t.dutyIsAbs,filterIsAbs:t.filterIsAbs,noTest:t.noTest,resetDuty:t.resetDuty}}if(e.snes){const t=e.snes;a.snes={useEnv:t.useEnv,gainMode:t.gainMode,gain:t.gain,a:t.a,d:t.d,s:t.s,r:t.r,d2:t.d2,sus:t.sus}}if(e.n163){const t=e.n163;a.n163={wave:t.wave,wavePos:t.wavePos,waveLen:t.waveLen,waveMode:t.waveMode,perChPos:t.perChanPos??!1}}if(e.fds){const t=e.fds;a.fds={modSpeed:t.modSpeed,modDepth:t.modDepth,modTable:[...t.modTable],initModTableWithFirstWave:t.initModTableWithFirstWave}}}if(n.amiga){const e=n.amiga;a.amiga={initSample:e.initSample,useNoteMap:e.useNoteMap,useSample:e.useSample,useWave:e.useWave,waveLen:e.waveLen??0,noteMap:e.noteMap?.map(e=>({note:0,sample:e.map,frequency:e.freq}))??[]}}const o={id:t,name:e.name||`Furnace Inst ${t}`,type:"synth",synthType:s,envelope:{attack:10,decay:100,sustain:80,release:100},effects:[],volume:0,pan:0,metadata:{importedFrom:"FUR"},furnace:a,parameters:{}};n.chipConfig&&Object.keys(n.chipConfig).join(","),n.macros.map(e=>`${e.type}:${e.data?.length||0}`).join(",");return o}function RT(e,t,n,s){const{audioBuffer:a,blobUrl:o,loopStart:r,loopEnd:i}=jT(e),l=(e.sampleRate,XT(e.relativeNote,e.finetune)),c=100*e.finetune/128,u=IT(t.volumeEnvelope),d=e.sampleRate||8363,m={audioBuffer:a,url:o,baseNote:l,detune:c,loop:"none"!==e.loopType,loopStart:r,loopEnd:i,sampleRate:d,reverse:!1,playbackRate:1},p={importedFrom:"FUR"===s||"DMF"===s?"FUR":s,originalEnvelope:t.volumeEnvelope,panningEnvelope:t.panningEnvelope,autoVibrato:t.autoVibrato,fadeout:t.fadeout,sampleMap:t.sampleMap,preservedSample:{audioBuffer:m.audioBuffer,url:m.url,baseNote:m.baseNote,detune:m.detune,loop:m.loop,loopStart:m.loopStart,loopEnd:m.loopEnd,envelope:u},modPlayback:{usePeriodPlayback:!0,periodMultiplier:3546895,finetune:e.finetune,relativeNote:e.relativeNote,defaultVolume:e.volume,fadeout:t.fadeout}};return{id:n,name:e.name||t.name||`Instrument ${n}`,type:"sample",synthType:"Sampler",sample:m,envelope:u,effects:[],volume:0,pan:(e.panning-128)/127*100,metadata:p,parameters:{sampleUrl:o}}}function jT(e){const t=e.sampleRate||8363,n=Math.max(1,e.length),s=new Int16Array(n);if(8===e.bitDepth){const t=e.pcmData instanceof Float32Array?new Float32Array(e.pcmData):new Int8Array(e.pcmData);for(let e=0;e<n;e++)t instanceof Float32Array?s[e]=Math.round(32767*t[e]):s[e]=256*t[e]}else if(16===e.bitDepth){const t=new Int16Array(e.pcmData);for(let e=0;e<n;e++)s[e]=t[e]}let a=s,o=e.loopStart,r=e.loopLength;if("pingpong"===e.loopType&&e.loopLength>2){const t=e.loopStart,o=e.loopLength,i=t+o,l=o-2,c=Math.max(n,i)+l;a=new Int16Array(c);for(let e=0;e<Math.min(i,n);e++)a[e]=s[e];for(let e=0;e<l;e++)a[i+e]=s[i-2-e];r=o+l}const i=function(e,t,n){const s=1,a=2*e.length,o=n?68:0,r=44+a+o,i=new ArrayBuffer(r),l=new DataView(i),c=(e,t)=>{for(let n=0;n<t.length;n++)l.setUint8(e+n,t.charCodeAt(n))};c(0,"RIFF"),l.setUint32(4,r-8,!0),c(8,"WAVE"),c(12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,s,!0),l.setUint32(24,t,!0),l.setUint32(28,t*s*2,!0),l.setUint16(32,2*s,!0),l.setUint16(34,16,!0),c(36,"data"),l.setUint32(40,a,!0);let u=44;for(let d=0;d<e.length;d++)l.setInt16(u,e[d],!0),u+=2;n&&(c(u,"smpl"),l.setUint32(u+4,60,!0),l.setUint32(u+8,0,!0),l.setUint32(u+12,0,!0),l.setUint32(u+16,Math.floor(1e9/t),!0),l.setUint32(u+20,60,!0),l.setUint32(u+24,0,!0),l.setUint32(u+28,0,!0),l.setUint32(u+32,0,!0),l.setUint32(u+36,1,!0),l.setUint32(u+40,0,!0),l.setUint32(u+44,0,!0),l.setUint32(u+48,0,!0),l.setUint32(u+52,n.start,!0),l.setUint32(u+56,n.end-1,!0),l.setUint32(u+60,0,!0),l.setUint32(u+64,0,!0));return i}(a,t,"none"!==e.loopType?{start:o,end:o+r}:void 0);return{audioBuffer:i,blobUrl:`data:audio/wav;base64,${function(e){const t=new Uint8Array(e);let n="";for(let s=0;s<t.byteLength;s++)n+=String.fromCharCode(t[s]);return btoa(n)}(i)}`,loopStart:o,loopEnd:o+r}}function XT(e,t){const n=48+e,s=Math.floor(n/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n%12]}${s}`}const zT=Object.freeze(Object.defineProperty({__proto__:null,analyzeSample:function(e,t){const n=function(e){if(!e||!e.enabled||e.points.length<2)return{type:"unknown",hasQuickAttack:!1,hasSustain:!1,hasLongRelease:!1};const t=IT(e),n=t.attack<20,s=t.sustain>20,a=t.release>500;let o="unknown";return n&&!s&&t.decay<300?o="pluck":n&&!s&&t.decay<100?o="percussive":!n&&s?o="pad":n&&s&&(o="sustained"),{type:o,hasQuickAttack:n,hasSustain:s,hasLongRelease:a}}(t),s="none"!==e.loopType,a=0!==e.relativeNote||s;return{dominantFrequency:a?440:null,harmonicContent:e.length<8e3&&!s&&"percussive"===n.type?"noise":a?"rich":"pure",envelopeShape:n.type,hasLoop:s,isPitched:a,bandwidth:1e3}},convertToInstrument:FT,suggestSynthConfig:function(e,t){switch(e){case"TB303":return{oscillator:{type:"rich"===t.harmonicContent?"sawtooth":"square"},filter:{cutoff:t.dominantFrequency?500:1e3,resonance:70},filterEnvelope:{envMod:60,decay:"pluck"===t.envelopeShape?200:500},accent:{amount:70},slide:{time:60,mode:"exponential"}};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:"pad"===t.envelopeShape?200:50,decay:500,sustain:t.hasLoop?50:0,release:100},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:"rich"===t.harmonicContent?3:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:"percussive"===t.envelopeShape?100:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100}}}}},Symbol.toStringTag,{value:"Module"}));async function GT(e){const t=new DataView(e);let n=0;const s=function(e,t){const n=YT(e,t,17);if("Extended Module: "!==n)throw new Error("Invalid XM file: incorrect header signature");const s=YT(e,t+17,20).trim();t+=38;const a=YT(e,t,20).trim();t+=20;const o=e.getUint16(t,!0);t+=2;const r=e.getUint32(t,!0);t+=4;const i=e.getUint16(t,!0);t+=2;const l=e.getUint16(t,!0);t+=2;const c=e.getUint16(t,!0);t+=2;const u=e.getUint16(t,!0);t+=2;const d=e.getUint16(t,!0);t+=2;const m=e.getUint16(t,!0);t+=2;const p=e.getUint16(t,!0);t+=2;const h=e.getUint16(t,!0);t+=2;const f=[];for(let g=0;g<256;g++)f.push(e.getUint8(t+g));return{idText:n,moduleName:s,trackerName:a,versionNumber:o,headerSize:r,songLength:i,restartPosition:l,channelCount:c,patternCount:u,instrumentCount:d,flags:m,defaultTempo:p,defaultBPM:h,patternOrderTable:f}}(t,n);n=60+s.headerSize;const a=[];for(let i=0;i<s.patternCount;i++){const e=HT(t,n,s.channelCount);a.push(e.notes),n+=e.totalSize}const o=[];for(let i=0;i<s.instrumentCount;i++){const e=WT(t,n);e.parsed.id=i+1,e.parsed.samples.forEach(e=>{e.id=i+1}),o.push(e.parsed),n+=e.totalSize}const r={sourceFormat:"XM",sourceFile:s.moduleName,importedAt:(new Date).toISOString(),originalChannelCount:s.channelCount,originalPatternCount:s.patternCount,originalInstrumentCount:s.instrumentCount,modData:{moduleType:"XM",initialSpeed:s.defaultTempo,initialBPM:s.defaultBPM,amigaPeriods:!(1&s.flags),channelNames:Array.from({length:s.channelCount},(e,t)=>`Channel ${t+1}`),songLength:s.songLength,restartPosition:s.restartPosition,patternOrderTable:s.patternOrderTable},xmData:{frequencyType:1&s.flags?"linear":"amiga",defaultPanning:Array.from({length:s.channelCount},()=>128)},originalSamples:{},envelopes:{}};return o.forEach(e=>{e.samples.forEach(e=>{r.originalSamples[e.id]=e}),r.envelopes[e.id]={volumeEnvelope:e.volumeEnvelope,panningEnvelope:e.panningEnvelope,autoVibrato:e.autoVibrato,fadeout:e.fadeout}}),{header:s,patterns:a,instruments:o,metadata:r}}function HT(e,t,n){const s=t;e.getUint32(t,!0),t+=4,e.getUint8(t),t+=1;const a=e.getUint16(t,!0)||64;t+=2;const o=e.getUint16(t,!0);t+=2;const r=[],i=new Uint8Array(e.buffer,t,o);t+=o;let l=0;for(let c=0;c<a;c++){const e=[];for(let t=0;t<n;t++){const t={note:0,instrument:0,volume:0,effectType:0,effectParam:0};if(l>=i.length){e.push(t);continue}const n=i[l++];128&n?(1&n&&(t.note=i[l++]),2&n&&(t.instrument=i[l++]),4&n&&(t.volume=i[l++]),8&n&&(t.effectType=i[l++]),16&n&&(t.effectParam=i[l++])):(t.note=n,t.instrument=i[l++],t.volume=i[l++],t.effectType=i[l++],t.effectParam=i[l++]),e.push(t)}r.push(e)}return{notes:r,totalSize:t-s}}function WT(e,t){const n=t,s=e.getUint32(t,!0),a=YT(e,t+=4,22).trim();t+=22,e.getUint8(t),t+=1;const o=e.getUint16(t,!0);t+=2;let r,i,l,c=0,u=[],d=0;if(o>0){c=e.getUint32(t,!0),t+=4,u=[];for(let r=0;r<96;r++)u.push(e.getUint8(t+r));r=qT(e,t+=96),i=qT(e,t+=48),t+=48;const n=e.getUint8(t);t+=1;const s=e.getUint8(t);t+=1,r.enabled=!!(1&n),i.enabled=!!(1&s);const a=e.getUint8(t);t+=1;const o=e.getUint8(t);t+=1;const m=e.getUint8(t);t+=1;const p=e.getUint8(t);t+=1,l={type:["sine","square","rampDown","rampUp"][a],sweep:o,depth:m,rate:p},d=e.getUint16(t,!0),t+=2,t+=22}t=n+s;const m=[];for(let h=0;h<o;h++)m.push(KT(e,t)),t+=c;const p=[];for(let h=0;h<o;h++){const n=m[h],s=$T(e,t,n);t+=n.length,p.push({id:h,name:n.name,pcmData:s,loopStart:n.loopStart/(16&n.type?2:1),loopLength:n.loopLength/(16&n.type?2:1),loopType:3&n.type?1==(3&n.type)?"forward":"pingpong":"none",volume:n.volume,finetune:n.finetune,relativeNote:n.relativeNote,panning:n.panning,bitDepth:16&n.type?16:8,sampleRate:8363,length:n.length/(16&n.type?2:1)})}return{parsed:{id:0,name:a,samples:p,volumeEnvelope:r,panningEnvelope:i,autoVibrato:l,fadeout:d,sampleMap:u,volumeType:"envelope",panningType:"envelope"},totalSize:t-n}}function qT(e,t){const n=[];for(let i=0;i<12;i++){const s=e.getUint16(t+4*i,!0),a=e.getUint16(t+4*i+2,!0);n.push({tick:s,value:a})}const s=e.getUint8(t+48),a=e.getUint8(t+49),o=e.getUint8(t+50),r=e.getUint8(t+51);return{enabled:!1,points:n.slice(0,s),sustainPoint:s>0?a:null,loopStartPoint:s>0?o:null,loopEndPoint:s>0?r:null}}function KT(e,t){return{length:e.getUint32(t,!0),loopStart:e.getUint32(t+4,!0),loopLength:e.getUint32(t+8,!0),volume:e.getUint8(t+12),finetune:e.getInt8(t+13),type:e.getUint8(t+14),panning:e.getUint8(t+15),relativeNote:e.getInt8(t+16),reserved:e.getUint8(t+17),name:YT(e,t+18,22).trim()}}function $T(e,t,n){const s=!!(16&n.type),a=n.length;if(s){const n=new Int16Array(a/2);let s=0;for(let a=0;a<n.length;a++){s+=e.getInt16(t+2*a,!0),n[a]=s}return n.buffer}{const n=new Int8Array(a);let s=0;for(let a=0;a<n.length;a++){s+=e.getInt8(t+a),n[a]=s}return n.buffer}}function YT(e,t,n){const s=[];for(let a=0;a<n;a++){const n=e.getUint8(t+a);if(0===n)break;s.push(n)}return String.fromCharCode(...s)}const JT=Object.freeze(Object.defineProperty({__proto__:null,isXMFormat:function(e){if(e.byteLength<17)return!1;const t=new Uint8Array(e,0,17);for(let n=0;n<17;n++)if(t[n]!=="Extended Module: ".charCodeAt(n))return!1;return!0},parseXM:GT,parseXMFile:async function(e,t){const{header:n,patterns:s,instruments:a}=await GT(e),o=a.map((e,t)=>{const n=t+1,s=FT(e,n,"XM");return s.length>0?{...s[0],id:n}:((e,t)=>({id:e,name:t||`Instrument ${e}`,type:"sample",synthType:"Sampler",effects:[],volume:-60,pan:0}))(n,e.name)}),r=s.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:e.length,channels:Array.from({length:n.channelCount},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n];return!t||0===t.note&&0===t.instrument&&0===t.volume&&0===t.effectType&&0===t.effectParam?{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}:{note:t.note,instrument:t.instrument,volume:t.volume,effTyp:t.effectType,eff:t.effectParam,effTyp2:0,eff2:0}})}))})),i=n.patternOrderTable.slice(0,n.songLength);return{name:n.moduleName.replace(/\0/g,"").trim()||t.replace(/\.[^/.]+$/,""),format:"XM",patterns:r,instruments:o,songPositions:i,songLength:n.songLength,restartPosition:n.restartPosition,numChannels:n.channelCount,initialSpeed:n.defaultTempo,initialBPM:n.defaultBPM,linearPeriods:!!(1&n.flags)}}},Symbol.toStringTag,{value:"Module"})),QT={"M.K.":4,"M!K!":4,FLT4:4,FLT8:8,"4CHN":4,"6CHN":6,"8CHN":8,OCTA:8,CD81:8,"2CHN":2,TDZ1:1,TDZ2:2,TDZ3:3};async function ZT(e){const t=new DataView(e);let n=0;const s=function(e){let t=0;const n=nL(e,t,20).trim();t+=20;const s=[];for(let c=0;c<31;c++){const n=nL(e,t,22).trim(),a=e.getUint16(t+22,!1),o=15&e.getUint8(t+24),r=Math.min(e.getUint8(t+25),64),i=e.getUint16(t+26,!1),l=e.getUint16(t+28,!1);s.push({name:n,length:a,finetune:o>7?o-16:o,volume:r,loopStart:i,loopLength:l}),t+=30}const a=e.getUint8(t);t+=1;const o=e.getUint8(t);t+=1;const r=[];let i=0;for(let c=0;c<128;c++){const n=e.getUint8(t+c);r.push(n),c<a&&n>i&&(i=n)}t+=128;const l=nL(e,t,4);return{title:n,samples:s,songLength:a,restartPosition:o,patternOrderTable:r,formatTag:l,channelCount:QT[l]||4,patternCount:i+1}}(t);n=1084;const a=[];for(let c=0;c<s.patternCount;c++){const e=eL(t,n,s.channelCount);a.push(e),n+=64*s.channelCount*4}const{initialSpeed:o,initialBPM:r}=function(e,t){let n=6,s=125,a=!1,o=!1;const r=[];for(let u=0;u<e.length;u++){const t=e[u];if(t)for(let e=0;e<t.length;e++){const n=t[e];if(n)for(let t=0;t<n.length;t++){const s=n[t];15===s.effect&&0!==s.effectParam&&r.push({pat:u,row:e,ch:t,param:s.effectParam})}}}r.length;const i=t[0],l=e[i];if(!l)return{initialSpeed:n,initialBPM:s};const c=Math.min(16,l.length);for(let u=0;u<c&&(!a||!o);u++){const e=l[u];if(e)for(const t of e)if(15===t.effect){const e=t.effectParam;if(0===e)continue;e<32?a||(n=e,a=!0):o||(s=e,o=!0)}}return{initialSpeed:n,initialBPM:s}}(a,s.patternOrderTable),i=[];for(let c=0;c<31;c++){const e=s.samples[c];if(0===e.length)continue;const a=tL(t,n,e);n+=2*e.length;const o=2*e.loopStart,r=2*e.loopLength,l=c+1,u={id:l,name:e.name,pcmData:a,loopStart:o,loopLength:r,loopType:e.loopLength>1?"forward":"none",volume:e.volume,finetune:e.finetune,relativeNote:0,panning:128,bitDepth:8,sampleRate:8363,length:2*e.length};i.push({id:l,name:e.name,samples:[u],fadeout:0,volumeType:"none",panningType:"none"})}const l={sourceFormat:"MOD",sourceFile:s.title,importedAt:(new Date).toISOString(),originalChannelCount:s.channelCount,originalPatternCount:s.patternCount,originalInstrumentCount:i.length,modData:{moduleType:s.formatTag,initialSpeed:o,initialBPM:r,amigaPeriods:!0,channelNames:Array.from({length:s.channelCount},(e,t)=>`Channel ${t+1}`),songLength:s.songLength,restartPosition:s.restartPosition,patternOrderTable:s.patternOrderTable},originalSamples:{},envelopes:{}};return i.forEach(e=>{e.samples.forEach(e=>{l.originalSamples[e.id]=e})}),{header:s,patterns:a,instruments:i,metadata:l}}function eL(e,t,n){const s=[];for(let a=0;a<64;a++){const a=[];for(let s=0;s<n;s++){const n=e.getUint8(t++),s=e.getUint8(t++),o=e.getUint8(t++),r=(15&n)<<8|s,i=240&n|(240&o)>>4,l=15&o,c=e.getUint8(t++);a.push({period:r,instrument:i,effect:l,effectParam:c})}s.push(a)}return s}function tL(e,t,n){const s=2*n.length,a=new Int8Array(s);for(let o=0;o<s;o++)a[o]=e.getInt8(t+o);return a.buffer}function nL(e,t,n){const s=[];for(let a=0;a<n;a++){const n=e.getUint8(t+a);if(0===n)break;s.push(n)}return String.fromCharCode(...s)}function sL(e){if(0===e)return null;const t={1712:"C-0",1616:"C#0",1525:"D-0",1440:"D#0",1357:"E-0",1281:"F-0",1209:"F#0",1141:"G-0",1077:"G#0",1017:"A-0",960:"A#0",907:"B-0",856:"C-1",808:"C#1",762:"D-1",720:"D#1",678:"E-1",640:"F-1",604:"F#1",570:"G-1",538:"G#1",508:"A-1",480:"A#1",453:"B-1",428:"C-2",404:"C#2",381:"D-2",360:"D#2",339:"E-2",320:"F-2",302:"F#2",285:"G-2",269:"G#2",254:"A-2",240:"A#2",226:"B-2",214:"C-3",202:"C#3",190:"D-3",180:"D#3",170:"E-3",160:"F-3",151:"F#3",143:"G-3",135:"G#3",127:"A-3",120:"A#3",113:"B-3"};let n=null,s=1/0;for(const[a,o]of Object.entries(t)){const t=parseInt(a),r=Math.abs(t-e);r<s&&(s=r,n=o)}return s>100?null:n}function aL(e,t){return`${e.toString(16).toUpperCase()}${t.toString(16).padStart(2,"0").toUpperCase()}`}const oL=new Set(["M.K.","M!K!","FLT4","FLT8","4CHN","6CHN","8CHN","OCTA","CD81","2CHN","TDZ1","TDZ2","TDZ3"]);const rL={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11};const iL=Object.freeze(Object.defineProperty({__proto__:null,convertMODEffect:aL,isMODFormat:function(e){if(e.byteLength<1084)return!1;const t=new Uint8Array(e,1080,4),n=String.fromCharCode(t[0],t[1],t[2],t[3]);return oL.has(n)},parseMOD:ZT,parseMODFile:async function(e,t){const{header:n,patterns:s,instruments:a,metadata:o}=await ZT(e),r=a.map(e=>{const t=e.id,n=FT(e,t,"S3M");return n.length>0?{...n[0],id:t}:((e,t)=>({id:e,name:t||`Sample ${e}`,type:"sample",synthType:"Sampler",effects:[],volume:-60,pan:0}))(t,e.name)}),i=s.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:e.length,channels:Array.from({length:n.channelCount},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n];if(!t||0===t.period&&0===t.instrument&&0===t.effect&&0===t.effectParam)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const s=sL(t.period);return{note:s?function(e){const t=e.match(/^([A-G]#?)[-]?(\d)$/);if(!t)return 0;const n=rL[t[1]]??0;return 12*parseInt(t[2])+n+1}(s):0,instrument:t.instrument,volume:0,effTyp:t.effect,eff:t.effectParam,effTyp2:0,eff2:0}})}))})),l=n.patternOrderTable.slice(0,n.songLength),c=o.modData?.initialSpeed??6,u=o.modData?.initialBPM??125;return{name:n.title.replace(/\0/g,"").trim()||t.replace(/\.[^/.]+$/,""),format:"MOD",patterns:i,instruments:r,songPositions:l,songLength:n.songLength,restartPosition:n.restartPosition,numChannels:n.channelCount,initialSpeed:c,initialBPM:u,linearPeriods:!1}},periodToNote:sL},Symbol.toStringTag,{value:"Module"}));function lL(e){let t=e.length;for(;--t>=0;)e[t]=0}const cL=256,uL=286,dL=30,mL=15,pL=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),hL=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),fL=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),gL=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bL=new Array(576);lL(bL);const vL=new Array(60);lL(vL);const yL=new Array(512);lL(yL);const xL=new Array(256);lL(xL);const NL=new Array(29);lL(NL);const wL=new Array(dL);function EL(e,t,n,s,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=a,this.has_stree=e&&e.length}let kL,DL,SL;function ML(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}lL(wL);const CL=e=>e<256?yL[e]:yL[256+(e>>>7)],VL=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},PL=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,VL(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},_L=(e,t,n)=>{PL(e,n[2*t],n[2*t+1])},OL=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},TL=(e,t,n)=>{const s=new Array(16);let a,o,r=0;for(a=1;a<=mL;a++)r=r+n[a-1]<<1,s[a]=r;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=OL(s[t]++,t))}},LL=e=>{let t;for(t=0;t<uL;t++)e.dyn_ltree[2*t]=0;for(t=0;t<dL;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},AL=e=>{e.bi_valid>8?VL(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},BL=(e,t,n,s)=>{const a=2*t,o=2*n;return e[a]<e[o]||e[a]===e[o]&&s[t]<=s[n]},IL=(e,t,n)=>{const s=e.heap[n];let a=n<<1;for(;a<=e.heap_len&&(a<e.heap_len&&BL(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!BL(t,s,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=s},FL=(e,t,n)=>{let s,a,o,r,i=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+i++],s+=(255&e.pending_buf[e.sym_buf+i++])<<8,a=e.pending_buf[e.sym_buf+i++],0===s?_L(e,a,t):(o=xL[a],_L(e,o+cL+1,t),r=pL[o],0!==r&&(a-=NL[o],PL(e,a,r)),s--,o=CL(s),_L(e,o,n),r=hL[o],0!==r&&(s-=wL[o],PL(e,s,r)))}while(i<e.sym_next);_L(e,256,t)},UL=(e,t)=>{const n=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.elems;let r,i,l,c=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<o;r++)0!==n[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):n[2*r+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[2*l]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=s[2*l+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)IL(e,n,r);l=o;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],IL(e,n,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,n[2*l]=n[2*r]+n[2*i],e.depth[l]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,n[2*r+1]=n[2*i+1]=l,e.heap[1]=l++,IL(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,s=t.max_code,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,i=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,d,m,p,h,f=0;for(m=0;m<=mL;m++)e.bl_count[m]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],m=n[2*n[2*u+1]+1]+1,m>l&&(m=l,f++),n[2*u+1]=m,u>s||(e.bl_count[m]++,p=0,u>=i&&(p=r[u-i]),h=n[2*u],e.opt_len+=h*(m+p),o&&(e.static_len+=h*(a[2*u+1]+p)));if(0!==f){do{for(m=l-1;0===e.bl_count[m];)m--;e.bl_count[m]--,e.bl_count[m+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(m=l;0!==m;m--)for(u=e.bl_count[m];0!==u;)d=e.heap[--c],d>s||(n[2*d+1]!==m&&(e.opt_len+=(m-n[2*d+1])*n[2*d],n[2*d+1]=m),u--)}})(e,t),TL(n,c,e.bl_count)},RL=(e,t,n)=>{let s,a,o=-1,r=t[1],i=0,l=7,c=4;for(0===r&&(l=138,c=3),t[2*(n+1)+1]=65535,s=0;s<=n;s++)a=r,r=t[2*(s+1)+1],++i<l&&a===r||(i<c?e.bl_tree[2*a]+=i:0!==a?(a!==o&&e.bl_tree[2*a]++,e.bl_tree[32]++):i<=10?e.bl_tree[34]++:e.bl_tree[36]++,i=0,o=a,0===r?(l=138,c=3):a===r?(l=6,c=3):(l=7,c=4))},jL=(e,t,n)=>{let s,a,o=-1,r=t[1],i=0,l=7,c=4;for(0===r&&(l=138,c=3),s=0;s<=n;s++)if(a=r,r=t[2*(s+1)+1],!(++i<l&&a===r)){if(i<c)do{_L(e,a,e.bl_tree)}while(0!==--i);else 0!==a?(a!==o&&(_L(e,a,e.bl_tree),i--),_L(e,16,e.bl_tree),PL(e,i-3,2)):i<=10?(_L(e,17,e.bl_tree),PL(e,i-3,3)):(_L(e,18,e.bl_tree),PL(e,i-11,7));i=0,o=a,0===r?(l=138,c=3):a===r?(l=6,c=3):(l=7,c=4)}};let XL=!1;const zL=(e,t,n,s)=>{PL(e,0+(s?1:0),3),AL(e),VL(e,n),VL(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var GL={_tr_init:e=>{XL||((()=>{let e,t,n,s,a;const o=new Array(16);for(n=0,s=0;s<28;s++)for(NL[s]=n,e=0;e<1<<pL[s];e++)xL[n++]=s;for(xL[n-1]=s,a=0,s=0;s<16;s++)for(wL[s]=a,e=0;e<1<<hL[s];e++)yL[a++]=s;for(a>>=7;s<dL;s++)for(wL[s]=a<<7,e=0;e<1<<hL[s]-7;e++)yL[256+a++]=s;for(t=0;t<=mL;t++)o[t]=0;for(e=0;e<=143;)bL[2*e+1]=8,e++,o[8]++;for(;e<=255;)bL[2*e+1]=9,e++,o[9]++;for(;e<=279;)bL[2*e+1]=7,e++,o[7]++;for(;e<=287;)bL[2*e+1]=8,e++,o[8]++;for(TL(bL,287,o),e=0;e<dL;e++)vL[2*e+1]=5,vL[2*e]=OL(e,5);kL=new EL(bL,pL,257,uL,mL),DL=new EL(vL,hL,0,dL,mL),SL=new EL(new Array(0),fL,0,19,7)})(),XL=!0),e.l_desc=new ML(e.dyn_ltree,kL),e.d_desc=new ML(e.dyn_dtree,DL),e.bl_desc=new ML(e.bl_tree,SL),e.bi_buf=0,e.bi_valid=0,LL(e)},_tr_stored_block:zL,_tr_flush_block:(e,t,n,s)=>{let a,o,r=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<cL;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),UL(e,e.l_desc),UL(e,e.d_desc),r=(e=>{let t;for(RL(e,e.dyn_ltree,e.l_desc.max_code),RL(e,e.dyn_dtree,e.d_desc.max_code),UL(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*gL[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=a&&(a=o)):a=o=n+5,n+4<=a&&-1!==t?zL(e,t,n,s):4===e.strategy||o===a?(PL(e,2+(s?1:0),3),FL(e,bL,vL)):(PL(e,4+(s?1:0),3),((e,t,n,s)=>{let a;for(PL(e,t-257,5),PL(e,n-1,5),PL(e,s-4,4),a=0;a<s;a++)PL(e,e.bl_tree[2*gL[a]+1],3);jL(e,e.dyn_ltree,t-1),jL(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),FL(e,e.dyn_ltree,e.dyn_dtree)),LL(e),s&&AL(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(xL[n]+cL+1)]++,e.dyn_dtree[2*CL(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{PL(e,2,3),_L(e,256,bL),(e=>{16===e.bi_valid?(VL(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var HL=(e,t,n,s)=>{let a=65535&e,o=e>>>16&65535,r=0;for(;0!==n;){r=n>2e3?2e3:n,n-=r;do{a=a+t[s++]|0,o=o+a|0}while(--r);a%=65521,o%=65521}return a|o<<16};const WL=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var qL=(e,t,n,s)=>{const a=WL,o=s+n;e^=-1;for(let r=s;r<o;r++)e=e>>>8^a[255&(e^t[r])];return-1^e},KL={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},$L={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:YL,_tr_stored_block:JL,_tr_flush_block:QL,_tr_tally:ZL,_tr_align:eA}=GL,{Z_NO_FLUSH:tA,Z_PARTIAL_FLUSH:nA,Z_FULL_FLUSH:sA,Z_FINISH:aA,Z_BLOCK:oA,Z_OK:rA,Z_STREAM_END:iA,Z_STREAM_ERROR:lA,Z_DATA_ERROR:cA,Z_BUF_ERROR:uA,Z_DEFAULT_COMPRESSION:dA,Z_FILTERED:mA,Z_HUFFMAN_ONLY:pA,Z_RLE:hA,Z_FIXED:fA,Z_DEFAULT_STRATEGY:gA,Z_UNKNOWN:bA,Z_DEFLATED:vA}=$L,yA=258,xA=262,NA=42,wA=113,EA=666,kA=(e,t)=>(e.msg=KL[t],t),DA=e=>2*e-(e>4?9:0),SA=e=>{let t=e.length;for(;--t>=0;)e[t]=0},MA=e=>{let t,n,s,a=e.w_size;t=e.hash_size,s=t;do{n=e.head[--s],e.head[s]=n>=a?n-a:0}while(--t);t=a,s=t;do{n=e.prev[--s],e.prev[s]=n>=a?n-a:0}while(--t)};let CA=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const VA=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},PA=(e,t)=>{QL(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,VA(e.strm)},_A=(e,t)=>{e.pending_buf[e.pending++]=t},OA=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},TA=(e,t,n,s)=>{let a=e.avail_in;return a>s&&(a=s),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),1===e.state.wrap?e.adler=HL(e.adler,t,a,n):2===e.state.wrap&&(e.adler=qL(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},LA=(e,t)=>{let n,s,a=e.max_chain_length,o=e.strstart,r=e.prev_length,i=e.nice_match;const l=e.strstart>e.w_size-xA?e.strstart-(e.w_size-xA):0,c=e.window,u=e.w_mask,d=e.prev,m=e.strstart+yA;let p=c[o+r-1],h=c[o+r];e.prev_length>=e.good_match&&(a>>=2),i>e.lookahead&&(i=e.lookahead);do{if(n=t,c[n+r]===h&&c[n+r-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<m);if(s=yA-(m-o),o=m-yA,s>r){if(e.match_start=t,r=s,s>=i)break;p=c[o+r-1],h=c[o+r]}}}while((t=d[t&u])>l&&0!==--a);return r<=e.lookahead?r:e.lookahead},AA=e=>{const t=e.w_size;let n,s,a;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-xA)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),MA(e),s+=t),0===e.strm.avail_in)break;if(n=TA(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=CA(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=CA(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<xA&&0!==e.strm.avail_in)},BA=(e,t)=>{let n,s,a,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r=0,i=e.strm.avail_in;do{if(n=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>a&&(n=a),n<o&&(0===n&&t!==aA||t===tA||n!==s+e.strm.avail_in))break;r=t===aA&&n===s+e.strm.avail_in?1:0,JL(e,0,0,r),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,VA(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(TA(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===r);return i-=e.strm.avail_in,i&&(i>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=i&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-i,e.strm.next_in),e.strstart),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?4:t!==tA&&t!==aA&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(TA(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,o=a>e.w_size?e.w_size:a,s=e.strstart-e.block_start,(s>=o||(s||t===aA)&&t!==tA&&0===e.strm.avail_in&&s<=a)&&(n=s>a?a:s,r=t===aA&&0===e.strm.avail_in&&n===s?1:0,JL(e,e.block_start,n,r),e.block_start+=n,VA(e.strm)),r?3:1)},IA=(e,t)=>{let n,s;for(;;){if(e.lookahead<xA){if(AA(e),e.lookahead<xA&&t===tA)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=CA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-xA&&(e.match_length=LA(e,n)),e.match_length>=3)if(s=ZL(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=CA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=CA(e,e.ins_h,e.window[e.strstart+1]);else s=ZL(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(PA(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===aA?(PA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(PA(e,!1),0===e.strm.avail_out)?1:2},FA=(e,t)=>{let n,s,a;for(;;){if(e.lookahead<xA){if(AA(e),e.lookahead<xA&&t===tA)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=CA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-xA&&(e.match_length=LA(e,n),e.match_length<=5&&(e.strategy===mA||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,s=ZL(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=CA(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(PA(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=ZL(e,0,e.window[e.strstart-1]),s&&PA(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=ZL(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===aA?(PA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(PA(e,!1),0===e.strm.avail_out)?1:2};function UA(e,t,n,s,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=a}const RA=[new UA(0,0,0,0,BA),new UA(4,4,8,4,IA),new UA(4,5,16,8,IA),new UA(4,6,32,32,IA),new UA(4,4,16,16,FA),new UA(8,16,32,32,FA),new UA(8,16,128,128,FA),new UA(8,32,128,256,FA),new UA(32,128,258,1024,FA),new UA(32,258,258,4096,FA)];function jA(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=vA,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),SA(this.dyn_ltree),SA(this.dyn_dtree),SA(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),SA(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),SA(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const XA=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==NA&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==wA&&t.status!==EA?1:0},zA=e=>{if(XA(e))return kA(e,lA);e.total_in=e.total_out=0,e.data_type=bA;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?NA:wA,e.adler=2===t.wrap?0:1,t.last_flush=-2,YL(t),rA},GA=e=>{const t=zA(e);var n;return t===rA&&((n=e.state).window_size=2*n.w_size,SA(n.head),n.max_lazy_match=RA[n.level].max_lazy,n.good_match=RA[n.level].good_length,n.nice_match=RA[n.level].nice_length,n.max_chain_length=RA[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},HA=(e,t,n,s,a,o)=>{if(!e)return lA;let r=1;if(t===dA&&(t=6),s<0?(r=0,s=-s):s>15&&(r=2,s-=16),a<1||a>9||n!==vA||s<8||s>15||t<0||t>9||o<0||o>fA||8===s&&1!==r)return kA(e,lA);8===s&&(s=9);const i=new jA;return e.state=i,i.strm=e,i.status=NA,i.wrap=r,i.gzhead=null,i.w_bits=s,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=a+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<a+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.sym_buf=i.lit_bufsize,i.sym_end=3*(i.lit_bufsize-1),i.level=t,i.strategy=o,i.method=n,GA(e)};var WA={deflateInit:(e,t)=>HA(e,t,vA,15,8,gA),deflateInit2:HA,deflateReset:GA,deflateResetKeep:zA,deflateSetHeader:(e,t)=>XA(e)||2!==e.state.wrap?lA:(e.state.gzhead=t,rA),deflate:(e,t)=>{if(XA(e)||t>oA||t<0)return e?kA(e,lA):lA;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===EA&&t!==aA)return kA(e,0===e.avail_out?uA:lA);const s=n.last_flush;if(n.last_flush=t,0!==n.pending){if(VA(e),0===e.avail_out)return n.last_flush=-1,rA}else if(0===e.avail_in&&DA(t)<=DA(s)&&t!==aA)return kA(e,uA);if(n.status===EA&&0!==e.avail_in)return kA(e,uA);if(n.status===NA&&0===n.wrap&&(n.status=wA),n.status===NA){let t=vA+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=pA||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=s<<6,0!==n.strstart&&(t|=32),t+=31-t%31,OA(n,t),0!==n.strstart&&(OA(n,e.adler>>>16),OA(n,65535&e.adler)),e.adler=1,n.status=wA,VA(e),0!==n.pending)return n.last_flush=-1,rA}if(57===n.status)if(e.adler=0,_A(n,31),_A(n,139),_A(n,8),n.gzhead)_A(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),_A(n,255&n.gzhead.time),_A(n,n.gzhead.time>>8&255),_A(n,n.gzhead.time>>16&255),_A(n,n.gzhead.time>>24&255),_A(n,9===n.level?2:n.strategy>=pA||n.level<2?4:0),_A(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(_A(n,255&n.gzhead.extra.length),_A(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=qL(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(_A(n,0),_A(n,0),_A(n,0),_A(n,0),_A(n,0),_A(n,9===n.level?2:n.strategy>=pA||n.level<2?4:0),_A(n,3),n.status=wA,VA(e),0!==n.pending)return n.last_flush=-1,rA;if(69===n.status){if(n.gzhead.extra){let t=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=qL(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=a,VA(e),0!==n.pending)return n.last_flush=-1,rA;t=0,s-=a}let a=new Uint8Array(n.gzhead.extra);n.pending_buf.set(a.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>t&&(e.adler=qL(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=qL(e.adler,n.pending_buf,n.pending-s,s)),VA(e),0!==n.pending)return n.last_flush=-1,rA;s=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,_A(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=qL(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=qL(e.adler,n.pending_buf,n.pending-s,s)),VA(e),0!==n.pending)return n.last_flush=-1,rA;s=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,_A(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=qL(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(VA(e),0!==n.pending))return n.last_flush=-1,rA;_A(n,255&e.adler),_A(n,e.adler>>8&255),e.adler=0}if(n.status=wA,VA(e),0!==n.pending)return n.last_flush=-1,rA}if(0!==e.avail_in||0!==n.lookahead||t!==tA&&n.status!==EA){let s=0===n.level?BA(n,t):n.strategy===pA?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(AA(e),0===e.lookahead)){if(t===tA)return 1;break}if(e.match_length=0,n=ZL(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(PA(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===aA?(PA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(PA(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===hA?((e,t)=>{let n,s,a,o;const r=e.window;for(;;){if(e.lookahead<=yA){if(AA(e),e.lookahead<=yA&&t===tA)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,s=r[a],s===r[++a]&&s===r[++a]&&s===r[++a])){o=e.strstart+yA;do{}while(s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&a<o);e.match_length=yA-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=ZL(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=ZL(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(PA(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===aA?(PA(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(PA(e,!1),0===e.strm.avail_out)?1:2})(n,t):RA[n.level].func(n,t);if(3!==s&&4!==s||(n.status=EA),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),rA;if(2===s&&(t===nA?eA(n):t!==oA&&(JL(n,0,0,!1),t===sA&&(SA(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),VA(e),0===e.avail_out))return n.last_flush=-1,rA}return t!==aA?rA:n.wrap<=0?iA:(2===n.wrap?(_A(n,255&e.adler),_A(n,e.adler>>8&255),_A(n,e.adler>>16&255),_A(n,e.adler>>24&255),_A(n,255&e.total_in),_A(n,e.total_in>>8&255),_A(n,e.total_in>>16&255),_A(n,e.total_in>>24&255)):(OA(n,e.adler>>>16),OA(n,65535&e.adler)),VA(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?rA:iA)},deflateEnd:e=>{if(XA(e))return lA;const t=e.state.status;return e.state=null,t===wA?kA(e,cA):rA},deflateSetDictionary:(e,t)=>{let n=t.length;if(XA(e))return lA;const s=e.state,a=s.wrap;if(2===a||1===a&&s.status!==NA||s.lookahead)return lA;if(1===a&&(e.adler=HL(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){0===a&&(SA(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(n-s.w_size,n),0),t=e,n=s.w_size}const o=e.avail_in,r=e.next_in,i=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,AA(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=CA(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,AA(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=r,e.input=i,e.avail_in=o,s.wrap=a,rA},deflateInfo:"pako deflate (from Nodeca project)"};const qA=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var KA=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)qA(n,t)&&(e[t]=n[t])}}return e},$A=e=>{let t=0;for(let s=0,a=e.length;s<a;s++)t+=e[s].length;const n=new Uint8Array(t);for(let s=0,a=0,o=e.length;s<o;s++){let t=e[s];n.set(t,a),a+=t.length}return n};let YA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(P0){YA=!1}const JA=new Uint8Array(256);for(let _0=0;_0<256;_0++)JA[_0]=_0>=252?6:_0>=248?5:_0>=240?4:_0>=224?3:_0>=192?2:1;JA[254]=JA[254]=1;var QA=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,s,a,o,r=e.length,i=0;for(a=0;a<r;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<r&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),a++)),i+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(i),o=0,a=0;o<i;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<r&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),a++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},ZA=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,a;const o=new Array(2*n);for(a=0,s=0;s<n;){let t=e[s++];if(t<128){o[a++]=t;continue}let r=JA[t];if(r>4)o[a++]=65533,s+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&s<n;)t=t<<6|63&e[s++],r--;r>1?o[a++]=65533:t<65536?o[a++]=t:(t-=65536,o[a++]=55296|t>>10&1023,o[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&YA)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n})(o,a)},eB=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+JA[e[n]]>t?n:t};var tB=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const nB=Object.prototype.toString,{Z_NO_FLUSH:sB,Z_SYNC_FLUSH:aB,Z_FULL_FLUSH:oB,Z_FINISH:rB,Z_OK:iB,Z_STREAM_END:lB,Z_DEFAULT_COMPRESSION:cB,Z_DEFAULT_STRATEGY:uB,Z_DEFLATED:dB}=$L;function mB(e){this.options=KA({level:cB,method:dB,chunkSize:16384,windowBits:15,memLevel:8,strategy:uB},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tB,this.strm.avail_out=0;let n=WA.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==iB)throw new Error(KL[n]);if(t.header&&WA.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?QA(t.dictionary):"[object ArrayBuffer]"===nB.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=WA.deflateSetDictionary(this.strm,e),n!==iB)throw new Error(KL[n]);this._dict_set=!0}}function pB(e,t){const n=new mB(t);if(n.push(e,!0),n.err)throw n.msg||KL[n.err];return n.result}mB.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize;let a,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?rB:sB,"string"==typeof e?n.input=QA(e):"[object ArrayBuffer]"===nB.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(o===aB||o===oB)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=WA.deflate(n,o),a===lB)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=WA.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===iB;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},mB.prototype.onData=function(e){this.chunks.push(e)},mB.prototype.onEnd=function(e){e===iB&&(this.result=$A(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var hB={Deflate:mB,deflate:pB,deflateRaw:function(e,t){return(t=t||{}).raw=!0,pB(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,pB(e,t)}};const fB=16209;var gB=function(e,t){let n,s,a,o,r,i,l,c,u,d,m,p,h,f,g,b,v,y,x,N,w,E,k,D;const S=e.state;n=e.next_in,k=e.input,s=n+(e.avail_in-5),a=e.next_out,D=e.output,o=a-(t-e.avail_out),r=a+(e.avail_out-257),i=S.dmax,l=S.wsize,c=S.whave,u=S.wnext,d=S.window,m=S.hold,p=S.bits,h=S.lencode,f=S.distcode,g=(1<<S.lenbits)-1,b=(1<<S.distbits)-1;e:do{p<15&&(m+=k[n++]<<p,p+=8,m+=k[n++]<<p,p+=8),v=h[m&g];t:for(;;){if(y=v>>>24,m>>>=y,p-=y,y=v>>>16&255,0===y)D[a++]=65535&v;else{if(!(16&y)){if(64&y){if(32&y){S.mode=16191;break e}e.msg="invalid literal/length code",S.mode=fB;break e}v=h[(65535&v)+(m&(1<<y)-1)];continue t}for(x=65535&v,y&=15,y&&(p<y&&(m+=k[n++]<<p,p+=8),x+=m&(1<<y)-1,m>>>=y,p-=y),p<15&&(m+=k[n++]<<p,p+=8,m+=k[n++]<<p,p+=8),v=f[m&b];;){if(y=v>>>24,m>>>=y,p-=y,y=v>>>16&255,16&y){if(N=65535&v,y&=15,p<y&&(m+=k[n++]<<p,p+=8,p<y&&(m+=k[n++]<<p,p+=8)),N+=m&(1<<y)-1,N>i){e.msg="invalid distance too far back",S.mode=fB;break e}if(m>>>=y,p-=y,y=a-o,N>y){if(y=N-y,y>c&&S.sane){e.msg="invalid distance too far back",S.mode=fB;break e}if(w=0,E=d,0===u){if(w+=l-y,y<x){x-=y;do{D[a++]=d[w++]}while(--y);w=a-N,E=D}}else if(u<y){if(w+=l+u-y,y-=u,y<x){x-=y;do{D[a++]=d[w++]}while(--y);if(w=0,u<x){y=u,x-=y;do{D[a++]=d[w++]}while(--y);w=a-N,E=D}}}else if(w+=u-y,y<x){x-=y;do{D[a++]=d[w++]}while(--y);w=a-N,E=D}for(;x>2;)D[a++]=E[w++],D[a++]=E[w++],D[a++]=E[w++],x-=3;x&&(D[a++]=E[w++],x>1&&(D[a++]=E[w++]))}else{w=a-N;do{D[a++]=D[w++],D[a++]=D[w++],D[a++]=D[w++],x-=3}while(x>2);x&&(D[a++]=D[w++],x>1&&(D[a++]=D[w++]))}break}if(64&y){e.msg="invalid distance code",S.mode=fB;break e}v=f[(65535&v)+(m&(1<<y)-1)]}}break}}while(n<s&&a<r);x=p>>3,n-=x,p-=x<<3,m&=(1<<p)-1,e.next_in=n,e.next_out=a,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=a<r?r-a+257:257-(a-r),S.hold=m,S.bits=p};const bB=15,vB=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),yB=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),xB=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),NB=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var wB=(e,t,n,s,a,o,r,i)=>{const l=i.bits;let c,u,d,m,p,h,f=0,g=0,b=0,v=0,y=0,x=0,N=0,w=0,E=0,k=0,D=null;const S=new Uint16Array(16),M=new Uint16Array(16);let C,V,P,_=null;for(f=0;f<=bB;f++)S[f]=0;for(g=0;g<s;g++)S[t[n+g]]++;for(y=l,v=bB;v>=1&&0===S[v];v--);if(y>v&&(y=v),0===v)return a[o++]=20971520,a[o++]=20971520,i.bits=1,0;for(b=1;b<v&&0===S[b];b++);for(y<b&&(y=b),w=1,f=1;f<=bB;f++)if(w<<=1,w-=S[f],w<0)return-1;if(w>0&&(0===e||1!==v))return-1;for(M[1]=0,f=1;f<bB;f++)M[f+1]=M[f]+S[f];for(g=0;g<s;g++)0!==t[n+g]&&(r[M[t[n+g]]++]=g);if(0===e?(D=_=r,h=20):1===e?(D=vB,_=yB,h=257):(D=xB,_=NB,h=0),k=0,g=0,f=b,p=o,x=y,N=0,d=-1,E=1<<y,m=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){C=f-N,r[g]+1<h?(V=0,P=r[g]):r[g]>=h?(V=_[r[g]-h],P=D[r[g]-h]):(V=96,P=0),c=1<<f-N,u=1<<x,b=u;do{u-=c,a[p+(k>>N)+u]=C<<24|V<<16|P}while(0!==u);for(c=1<<f-1;k&c;)c>>=1;if(0!==c?(k&=c-1,k+=c):k=0,g++,0===--S[f]){if(f===v)break;f=t[n+r[g]]}if(f>y&&(k&m)!==d){for(0===N&&(N=y),p+=b,x=f-N,w=1<<x;x+N<v&&(w-=S[x+N],!(w<=0));)x++,w<<=1;if(E+=1<<x,1===e&&E>852||2===e&&E>592)return 1;d=k&m,a[d]=y<<24|x<<16|p-o}}return 0!==k&&(a[p+k]=f-N<<24|64<<16),i.bits=y,0};const{Z_FINISH:EB,Z_BLOCK:kB,Z_TREES:DB,Z_OK:SB,Z_STREAM_END:MB,Z_NEED_DICT:CB,Z_STREAM_ERROR:VB,Z_DATA_ERROR:PB,Z_MEM_ERROR:_B,Z_BUF_ERROR:OB,Z_DEFLATED:TB}=$L,LB=16180,AB=16190,BB=16191,IB=16192,FB=16194,UB=16199,RB=16200,jB=16206,XB=16209,zB=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function GB(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const HB=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<LB||t.mode>16211?1:0},WB=e=>{if(HB(e))return VB;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=LB,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,SB},qB=e=>{if(HB(e))return VB;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,WB(e)},KB=(e,t)=>{let n;if(HB(e))return VB;const s=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?VB:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,qB(e))},$B=(e,t)=>{if(!e)return VB;const n=new GB;e.state=n,n.strm=e,n.window=null,n.mode=LB;const s=KB(e,t);return s!==SB&&(e.state=null),s};let YB,JB,QB=!0;const ZB=e=>{if(QB){YB=new Int32Array(512),JB=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(wB(1,e.lens,0,288,YB,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;wB(2,e.lens,0,32,JB,0,e.work,{bits:5}),QB=!1}e.lencode=YB,e.lenbits=9,e.distcode=JB,e.distbits=5},eI=(e,t,n,s)=>{let a;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),s>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(a=o.wsize-o.wnext,a>s&&(a=s),o.window.set(t.subarray(n-s,n-s+a),o.wnext),(s-=a)?(o.window.set(t.subarray(n-s,n),0),o.wnext=s,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0};var tI={inflateReset:qB,inflateReset2:KB,inflateResetKeep:WB,inflateInit:e=>$B(e,15),inflateInit2:$B,inflate:(e,t)=>{let n,s,a,o,r,i,l,c,u,d,m,p,h,f,g,b,v,y,x,N,w,E,k=0;const D=new Uint8Array(4);let S,M;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(HB(e)||!e.output||!e.input&&0!==e.avail_in)return VB;n=e.state,n.mode===BB&&(n.mode=IB),r=e.next_out,a=e.output,l=e.avail_out,o=e.next_in,s=e.input,i=e.avail_in,c=n.hold,u=n.bits,d=i,m=l,E=SB;e:for(;;)switch(n.mode){case LB:if(0===n.wrap){n.mode=IB;break}for(;u<16;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,D[0]=255&c,D[1]=c>>>8&255,n.check=qL(n.check,D,2,0),c=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=XB;break}if((15&c)!==TB){e.msg="unknown compression method",n.mode=XB;break}if(c>>>=4,u-=4,w=8+(15&c),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){e.msg="invalid window size",n.mode=XB;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:BB,c=0,u=0;break;case 16181:for(;u<16;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(n.flags=c,(255&n.flags)!==TB){e.msg="unknown compression method",n.mode=XB;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=XB;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(D[0]=255&c,D[1]=c>>>8&255,n.check=qL(n.check,D,2,0)),c=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(D[0]=255&c,D[1]=c>>>8&255,D[2]=c>>>16&255,D[3]=c>>>24&255,n.check=qL(n.check,D,4,0)),c=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(D[0]=255&c,D[1]=c>>>8&255,n.check=qL(n.check,D,2,0)),c=0,u=0,n.mode=16184;case 16184:if(1024&n.flags){for(;u<16;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(D[0]=255&c,D[1]=c>>>8&255,n.check=qL(n.check,D,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(p=n.length,p>i&&(p=i),p&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(o,o+p),w)),512&n.flags&&4&n.wrap&&(n.check=qL(n.check,s,p,o)),i-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===i)break e;p=0;do{w=s[o+p++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&p<i);if(512&n.flags&&4&n.wrap&&(n.check=qL(n.check,s,p,o)),i-=p,o+=p,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===i)break e;p=0;do{w=s[o+p++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&p<i);if(512&n.flags&&4&n.wrap&&(n.check=qL(n.check,s,p,o)),i-=p,o+=p,w)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;u<16;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=XB;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=BB;break;case 16189:for(;u<32;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}e.adler=n.check=zB(c),c=0,u=0,n.mode=AB;case AB:if(0===n.havedict)return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=i,n.hold=c,n.bits=u,CB;e.adler=n.check=1,n.mode=BB;case BB:if(t===kB||t===DB)break e;case IB:if(n.last){c>>>=7&u,u-=7&u,n.mode=jB;break}for(;u<3;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}switch(n.last=1&c,c>>>=1,u-=1,3&c){case 0:n.mode=16193;break;case 1:if(ZB(n),n.mode=UB,t===DB){c>>>=2,u-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=XB}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=XB;break}if(n.length=65535&c,c=0,u=0,n.mode=FB,t===DB)break e;case FB:n.mode=16195;case 16195:if(p=n.length,p){if(p>i&&(p=i),p>l&&(p=l),0===p)break e;a.set(s.subarray(o,o+p),r),i-=p,o+=p,l-=p,r+=p,n.length-=p;break}n.mode=BB;break;case 16196:for(;u<14;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(n.nlen=257+(31&c),c>>>=5,u-=5,n.ndist=1+(31&c),c>>>=5,u-=5,n.ncode=4+(15&c),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=XB;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}n.lens[C[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[C[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S={bits:n.lenbits},E=wB(0,n.lens,0,19,n.lencode,0,n.work,S),n.lenbits=S.bits,E){e.msg="invalid code lengths set",n.mode=XB;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;k=n.lencode[c&(1<<n.lenbits)-1],g=k>>>24,b=k>>>16&255,v=65535&k,!(g<=u);){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(M=g+2;u<M;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=XB;break}w=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(M=g+3;u<M;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}c>>>=g,u-=g,w=0,p=3+(7&c),c>>>=3,u-=3}else{for(M=g+7;u<M;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}c>>>=g,u-=g,w=0,p=11+(127&c),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=XB;break}for(;p--;)n.lens[n.have++]=w}}if(n.mode===XB)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=XB;break}if(n.lenbits=9,S={bits:n.lenbits},E=wB(1,n.lens,0,n.nlen,n.lencode,0,n.work,S),n.lenbits=S.bits,E){e.msg="invalid literal/lengths set",n.mode=XB;break}if(n.distbits=6,n.distcode=n.distdyn,S={bits:n.distbits},E=wB(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,S),n.distbits=S.bits,E){e.msg="invalid distances set",n.mode=XB;break}if(n.mode=UB,t===DB)break e;case UB:n.mode=RB;case RB:if(i>=6&&l>=258){e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=i,n.hold=c,n.bits=u,gB(e,m),r=e.next_out,a=e.output,l=e.avail_out,o=e.next_in,s=e.input,i=e.avail_in,c=n.hold,u=n.bits,n.mode===BB&&(n.back=-1);break}for(n.back=0;k=n.lencode[c&(1<<n.lenbits)-1],g=k>>>24,b=k>>>16&255,v=65535&k,!(g<=u);){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(b&&!(240&b)){for(y=g,x=b,N=v;k=n.lencode[N+((c&(1<<y+x)-1)>>y)],g=k>>>24,b=k>>>16&255,v=65535&k,!(y+g<=u);){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===b){n.mode=16205;break}if(32&b){n.back=-1,n.mode=BB;break}if(64&b){e.msg="invalid literal/length code",n.mode=XB;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(M=n.extra;u<M;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;k=n.distcode[c&(1<<n.distbits)-1],g=k>>>24,b=k>>>16&255,v=65535&k,!(g<=u);){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(!(240&b)){for(y=g,x=b,N=v;k=n.distcode[N+((c&(1<<y+x)-1)>>y)],g=k>>>24,b=k>>>16&255,v=65535&k,!(y+g<=u);){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}c>>>=y,u-=y,n.back+=y}if(c>>>=g,u-=g,n.back+=g,64&b){e.msg="invalid distance code",n.mode=XB;break}n.offset=v,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(M=n.extra;u<M;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=XB;break}n.mode=16204;case 16204:if(0===l)break e;if(p=m-l,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=XB;break}p>n.wnext?(p-=n.wnext,h=n.wsize-p):h=n.wnext-p,p>n.length&&(p=n.length),f=n.window}else f=a,h=r-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{a[r++]=f[h++]}while(--p);0===n.length&&(n.mode=RB);break;case 16205:if(0===l)break e;a[r++]=n.length,l--,n.mode=RB;break;case jB:if(n.wrap){for(;u<32;){if(0===i)break e;i--,c|=s[o++]<<u,u+=8}if(m-=l,e.total_out+=m,n.total+=m,4&n.wrap&&m&&(e.adler=n.check=n.flags?qL(n.check,a,m,r-m):HL(n.check,a,m,r-m)),m=l,4&n.wrap&&(n.flags?c:zB(c))!==n.check){e.msg="incorrect data check",n.mode=XB;break}c=0,u=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;u<32;){if(0===i)break e;i--,c+=s[o++]<<u,u+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=XB;break}c=0,u=0}n.mode=16208;case 16208:E=MB;break e;case XB:E=PB;break e;case 16210:return _B;default:return VB}return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=i,n.hold=c,n.bits=u,(n.wsize||m!==e.avail_out&&n.mode<XB&&(n.mode<jB||t!==EB))&&eI(e,e.output,e.next_out,m-e.avail_out),d-=e.avail_in,m-=e.avail_out,e.total_in+=d,e.total_out+=m,n.total+=m,4&n.wrap&&m&&(e.adler=n.check=n.flags?qL(n.check,a,m,e.next_out-m):HL(n.check,a,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===BB?128:0)+(n.mode===UB||n.mode===FB?256:0),(0===d&&0===m||t===EB)&&E===SB&&(E=OB),E},inflateEnd:e=>{if(HB(e))return VB;let t=e.state;return t.window&&(t.window=null),e.state=null,SB},inflateGetHeader:(e,t)=>{if(HB(e))return VB;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,SB):VB},inflateSetDictionary:(e,t)=>{const n=t.length;let s,a,o;return HB(e)?VB:(s=e.state,0!==s.wrap&&s.mode!==AB?VB:s.mode===AB&&(a=1,a=HL(a,t,n,0),a!==s.check)?PB:(o=eI(e,t,n,n),o?(s.mode=16210,_B):(s.havedict=1,SB)))},inflateInfo:"pako inflate (from Nodeca project)"};var nI=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const sI=Object.prototype.toString,{Z_NO_FLUSH:aI,Z_FINISH:oI,Z_OK:rI,Z_STREAM_END:iI,Z_NEED_DICT:lI,Z_STREAM_ERROR:cI,Z_DATA_ERROR:uI,Z_MEM_ERROR:dI}=$L;function mI(e){this.options=KA({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new tB,this.strm.avail_out=0;let n=tI.inflateInit2(this.strm,t.windowBits);if(n!==rI)throw new Error(KL[n]);if(this.header=new nI,tI.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=QA(t.dictionary):"[object ArrayBuffer]"===sI.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=tI.inflateSetDictionary(this.strm,t.dictionary),n!==rI)))throw new Error(KL[n])}function pI(e,t){const n=new mI(t);if(n.push(e),n.err)throw n.msg||KL[n.err];return n.result}mI.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize,a=this.options.dictionary;let o,r,i;if(this.ended)return!1;for(r=t===~~t?t:!0===t?oI:aI,"[object ArrayBuffer]"===sI.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),o=tI.inflate(n,r),o===lI&&a&&(o=tI.inflateSetDictionary(n,a),o===rI?o=tI.inflate(n,r):o===uI&&(o=lI));n.avail_in>0&&o===iI&&n.state.wrap>0&&0!==e[n.next_in];)tI.inflateReset(n),o=tI.inflate(n,r);switch(o){case cI:case uI:case lI:case dI:return this.onEnd(o),this.ended=!0,!1}if(i=n.avail_out,n.next_out&&(0===n.avail_out||o===iI))if("string"===this.options.to){let e=eB(n.output,n.next_out),t=n.next_out-e,a=ZA(n.output,e);n.next_out=t,n.avail_out=s-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(a)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==rI||0!==i){if(o===iI)return o=tI.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},mI.prototype.onData=function(e){this.chunks.push(e)},mI.prototype.onEnd=function(e){e===rI&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=$A(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var hI={Inflate:mI,inflate:pI,inflateRaw:function(e,t){return(t=t||{}).raw=!0,pI(e,t)},ungzip:pI};const{Deflate:fI,deflate:gI,deflateRaw:bI,gzip:vI}=hB,{Inflate:yI,inflate:xI,inflateRaw:NI,ungzip:wI}=hI;var EI={Deflate:fI,deflate:gI,deflateRaw:bI,gzip:vI,Inflate:yI,inflate:xI,inflateRaw:NI,ungzip:wI,constants:$L};const kI={0:"ChipSynth",1:"FurnaceOPN",2:"FurnaceGB",3:"FurnaceC64",4:"Sampler",5:"FurnacePCE",6:"FurnaceAY",7:"FurnaceAY",8:"FurnaceTIA",9:"FurnaceSAA",10:"FurnaceVIC",11:"ChipSynth",12:"FurnaceVRC6",13:"FurnaceOPLL",14:"FurnaceOPL",15:"FurnaceFDS",16:"FurnaceVB",17:"FurnaceN163",18:"FurnaceSCC",19:"FurnaceOPZ",20:"ChipSynth",21:"ChipSynth",22:"FurnaceSWAN",23:"FurnaceLynx",24:"FurnaceVERA",25:"FurnaceX1_010",26:"FurnaceVRC6",27:"FurnaceES5506",28:"Sampler",29:"FurnaceSNES",30:"ChipSynth",31:"ChipSynth",32:"FurnaceOPL",33:"FurnaceOPM",34:"FurnaceNES",35:"Sampler",36:"FurnaceOKI",37:"Sampler",38:"Sampler",39:"FurnaceSEGAPCM",40:"FurnaceQSOUND",41:"FurnaceYMZ280B",42:"FurnaceRF5C68",43:"ChipSynth",44:"FurnaceT6W28",45:"FurnaceK007232",46:"FurnaceGA20",47:"ChipSynth",48:"FurnaceSM8521",49:"ChipSynth",50:"FurnaceK053260",52:"FurnaceTED",53:"FurnaceC140",54:"Sampler",55:"FurnaceESFM",56:"ChipSynth",57:"ChipSynth",58:"ChipSynth",59:"Sampler",60:"Sampler",61:"Sampler",62:"ChipSynth",63:"FurnaceC64",64:"FurnaceSUPERVISION",65:"FurnaceUPD1771",66:"FurnaceC64"};const DI=[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],SI=[250,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,253,253,253,253,254,254,254,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9],MI=new Set([3,4,5,6,7,71,240,128,130,131,132,135,136,137,138,141,142,143,144,145,151,152,160,2]),CI={2:0,3:3,4:5,5:6,6:4,7:10,71:10,240:10,128:12,129:0,130:1,131:0,132:15,135:24,136:9,137:11,138:16,141:47,142:13,143:2,144:2,145:2,151:18,152:22,160:0},VI={2:1,3:0,4:2,5:5,6:34,7:3,71:3,128:6,129:4,130:33,131:1,132:8,133:10,135:29,136:12,137:13,138:15,141:1,142:1,143:14,144:14,145:14,151:9,152:19,154:7,160:1},PI={0:0,1:17,2:10,3:4,4:4,5:6,6:5,7:3,71:3,128:3,129:4,130:8,131:6,132:2,133:4,134:1,135:8,136:3,137:9,138:1,139:3,140:8,141:6,142:16,143:9,144:9,145:18,146:28,147:1,148:4,149:8,150:4,151:6,152:8,153:1,154:3,155:16,156:6,157:6,158:16,159:6,160:9,161:5,162:11,163:11,164:20,165:14,166:17,167:11,168:4,170:4,171:1,172:17,173:2,174:42,175:44,176:16,177:32,178:10,179:12,180:5,181:8,182:9,183:19,184:8,185:3,186:8,187:8,188:8,189:11,190:7,191:4,192:1,193:10,194:18,195:10,196:20,197:20,198:2,199:4,200:3,202:5,203:3,204:4,205:2,206:24,207:16,209:18,212:4,213:6,214:16,215:2,216:16,217:4,222:19,224:19,226:4,227:4,229:4,240:3,241:5,245:7,252:1,253:8};function _I(e){let t="";for(;!e.isEOF();){const n=e.readUint8();if(0===n)break;t+=String.fromCharCode(n)}return t}async function OI(e){const t=function(e){if(120===e[0])try{return EI.inflate(e)}catch(t){throw new Error("Failed to decompress Furnace file: "+t)}return e}(new Uint8Array(e)),n=new sN(t.buffer),s=n.readMagic(16);if(!s.startsWith("-Furnace module-"))throw new Error(`Invalid Furnace file header: "${s}"`);const a=n.readUint16();n.skip(2);const o=n.readUint32();n.seek(o);const r={name:"",author:"",category:"",systemName:"",tuning:440,masterVol:1,version:a,systemLen:0,systems:[],systemChans:[],systemVol:[],systemPan:[],systemPanFR:[],chans:0,subsongs:[],instruments:[],wavetables:[],samples:[],patterns:new Map,comment:"",compatFlags:{},grooves:[]};return a>=240?await async function(e,t,n){const s=e.readMagic(4);if("INF2"!==s)throw new Error(`Expected INF2 block, got: "${s}"`);if(e.readUint32(),t.name=_I(e),t.author=_I(e),t.systemName=_I(e),t.category=_I(e),_I(e),_I(e),_I(e),_I(e),t.tuning=e.readFloat32(),e.readUint8(),t.masterVol=e.readFloat32(),t.chans=e.readUint16(),t.systemLen=e.readUint16(),t.systemLen<1)throw new Error("Zero chips in module!");let a=0;for(let h=0;h<t.systemLen;h++){const n=e.readUint16();t.systems.push(n);const s=e.readUint16();t.systemChans.push(s),a+=s,t.systemVol.push(e.readFloat32()),t.systemPan.push(e.readFloat32()),t.systemPanFR.push(e.readFloat32())}t.chans!==a&&(t.chans=a);const o=e.readUint32();e.skip(4*o),e.readUint8();const r=[],i=[],l=[],c=[],u=[];let d=0;const m=[];let p=!0;for(;p;){switch(e.readUint8()){case 0:p=!1;break;case 1:{const t=e.readUint32();for(let n=0;n<t;n++)c.push(e.readUint32());break}case 2:{const t=e.readUint32();e.skip(4*t);break}case 3:{const t=e.readUint32();e.skip(4*t);break}case 4:{const t=e.readUint32();for(let n=0;n<t;n++)r.push(e.readUint32());break}case 5:{const t=e.readUint32();for(let n=0;n<t;n++)i.push(e.readUint32());break}case 6:{const t=e.readUint32();for(let n=0;n<t;n++)l.push(e.readUint32());break}case 7:{const t=e.readUint32();for(let n=0;n<t;n++)u.push(e.readUint32());break}case 8:e.readUint32(),e.readUint32();break;case 9:e.readUint32(),d=e.readUint32();break;case 10:{const t=e.readUint32();for(let n=0;n<t;n++)m.push(e.readUint32());break}default:{const t=e.readUint32();e.skip(4*t);break}}}for(const h of m){e.seek(h);if("GROV"===e.readMagic(4)){e.readUint32();const n=e.readUint8(),s=[];for(let t=0;t<16;t++)s.push(e.readUint16());t.grooves.push({len:n,val:s})}}for(const h of c){e.seek(h);const s=TI(e,t.chans,n);t.subsongs.push(s)}for(let h=0;h<r.length;h++){const n=r[h];e.seek(n);const s=e.getOffset(),a=LI(e),o=e.getOffset();if(a.c64){if(!(a.c64.triOn||a.c64.sawOn||a.c64.pulseOn||a.c64.noiseOn)){const e=a.macros?.find(e=>3===e.code);if(e&&e.data&&e.data.length>0){const t=e.data[0];a.c64.noiseOn=!!(8&t),a.c64.pulseOn=!!(4&t),a.c64.sawOn=!!(2&t),a.c64.triOn=!!(1&t)}else a.c64.duty&&a.c64.duty,a.c64.pulseOn=!0}}const i=o-s;e.seek(s);const l=e.readBytes(i);a.rawBinaryData=l,t.instruments.push(a)}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],n=VI[e]??0;t.instruments.push({name:"Default",type:n,macros:[],samples:[],wavetables:[]})}for(const h of i){e.seek(h);const n=FI(e);t.wavetables.push(n)}for(const h of l){e.seek(h);const s=UI(e,n);t.samples.push(s)}for(const h of u){e.seek(h);const s=RI(e,t.chans,t.subsongs,n),a=`${s.subsong}_${s.channel}_${s.index}`;if(t.patterns.set(a,s),t.patterns.size<=3){if(s.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)){s.rows.findIndex(e=>e.note>=0||e.instrument>=0)}}}if(d>0){e.seek(d);"CMNT"===e.readMagic(4)&&(e.readUint32(),t.comment=_I(e))}}(n,r,a):await async function(e,t,n){const s=e.readMagic(4);if("INFO"!==s)throw new Error(`Expected INFO block, got: "${s}"`);e.readUint32();const a={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};a.timeBase=e.readUint8(),a.speed1=e.readUint8(),a.speed2=e.readUint8(),a.arpLen=e.readUint8(),a.hz=e.readFloat32(),a.patLen=e.readUint16(),a.ordersLen=e.readUint16(),a.hilightA=e.readUint8(),a.hilightB=e.readUint8();const o=e.readUint16(),r=e.readUint16(),i=e.readUint16(),l=e.readUint32();const c=[];for(let b=0;b<32;b++){const t=e.readUint8();0!==t&&c.push(t)}t.systems=c.filter(e=>0!==e),t.systemLen=t.systems.length;for(let b=0;b<32;b++){const n=e.readInt8();b<t.systemLen&&t.systemVol.push(n/64)}for(let b=0;b<32;b++){const n=e.readInt8();b<t.systemLen&&t.systemPan.push(n/127)}e.skip(128);t.name=_I(e),t.author=_I(e),t.tuning=e.readFloat32();const u={};n>=37?(u.limitSlides=!!e.readUint8(),u.linearPitch=e.readUint8(),u.loopModality=e.readUint8(),u.properNoiseLayout=n>=43?!!e.readUint8():(e.readUint8(),!1),u.waveDutyIsVol=n>=43?!!e.readUint8():(e.readUint8(),!1),u.resetMacroOnPorta=n>=45?!!e.readUint8():(e.readUint8(),!1),u.legacyVolumeSlides=n>=45?!!e.readUint8():(e.readUint8(),!1),u.compatibleArpeggio=n>=45?!!e.readUint8():(e.readUint8(),!1),u.noteOffResetsSlides=n>=45?!!e.readUint8():(e.readUint8(),!1),u.targetResetsSlides=n>=45?!!e.readUint8():(e.readUint8(),!1),u.arpNonPorta=n>=47?!!e.readUint8():(e.readUint8(),!1),u.algMacroBehavior=n>=47?!!e.readUint8():(e.readUint8(),!1),u.brokenShortcutSlides=n>=49?!!e.readUint8():(e.readUint8(),!1),u.ignoreDuplicateSlides=n>=50?!!e.readUint8():(e.readUint8(),!1),u.stopPortaOnNoteOff=n>=62?!!e.readUint8():(e.readUint8(),!1),u.continuousVibrato=n>=62?!!e.readUint8():(e.readUint8(),!1),u.brokenDACMode=n>=64?!!e.readUint8():(e.readUint8(),!1),u.oneTickCut=n>=65?!!e.readUint8():(e.readUint8(),!1),u.newInsTriggersInPorta=n>=66?!!e.readUint8():(e.readUint8(),!1),u.arp0Reset=n>=69?!!e.readUint8():(e.readUint8(),!1)):e.skip(20);const d=[],m=[],p=[],h=[];for(let b=0;b<o;b++)d.push(e.readUint32());for(let b=0;b<r;b++)m.push(e.readUint32());for(let b=0;b<i;b++)p.push(e.readUint32());let f=0;for(const b of t.systems){const e=PI[b]||4;t.systemChans.push(e),f+=e}t.chans=f;for(let b=0;b<l;b++)h.push(e.readUint32());a.orders=[];for(let b=0;b<t.chans;b++){const t=[];for(let n=0;n<a.ordersLen;n++)t.push(e.readUint8());a.orders.push(t)}a.effectColumns=[];for(let b=0;b<t.chans;b++)a.effectColumns.push(e.readUint8());if(n>=39){e.skip(2*t.chans);for(let n=0;n<t.chans;n++)a.channelNames.push(_I(e));for(let n=0;n<t.chans;n++)a.channelShortNames.push(_I(e));t.comment=_I(e)}t.masterVol=n>=59?e.readFloat32():2;n>=70&&(u.brokenSpeedSel=!!e.readUint8(),u.noSlidesOnFirstTick=n>=71?!!e.readUint8():(e.readUint8(),!1),u.rowResetsArpPos=n>=71?!!e.readUint8():(e.readUint8(),!1),u.ignoreJumpAtEnd=n>=71?!!e.readUint8():(e.readUint8(),!1),u.buggyPortaAfterSlide=n>=72?!!e.readUint8():(e.readUint8(),!1),u.gbInsAffectsEnvelope=n>=72?!!e.readUint8():(e.readUint8(),!1),u.sharedExtStat=n>=78?!!e.readUint8():(e.readUint8(),!1),u.ignoreDACModeOutsideChannel=n>=83?!!e.readUint8():(e.readUint8(),!1),u.e1e2AlsoTakePriority=n>=83?!!e.readUint8():(e.readUint8(),!1),u.newSegaPCM=n>=84?!!e.readUint8():(e.readUint8(),!1),u.fbPortaPause=n>=85?!!e.readUint8():(e.readUint8(),!1),u.snDutyReset=n>=86?!!e.readUint8():(e.readUint8(),!1),u.pitchMacroIsLinear=n>=90?!!e.readUint8():(e.readUint8(),!1),u.pitchSlideSpeed=n>=94?e.readUint8():(e.readUint8(),0),u.oldOctaveBoundary=n>=97?!!e.readUint8():(e.readUint8(),!1),u.noOPN2Vol=n>=98?!!e.readUint8():(e.readUint8(),!1),u.newVolumeScaling=n>=99?!!e.readUint8():(e.readUint8(),!1),u.volMacroLinger=n>=99?!!e.readUint8():(e.readUint8(),!1),u.brokenOutVol=n>=99?!!e.readUint8():(e.readUint8(),!1),u.e1e2StopOnSameNote=n>=100?!!e.readUint8():(e.readUint8(),!1),u.brokenPortaArp=n>=101?!!e.readUint8():(e.readUint8(),!1),u.snNoLowPeriods=n>=108?!!e.readUint8():(e.readUint8(),!1),u.delayBehavior=n>=110?e.readUint8():(e.readUint8(),0),u.jumpTreatment=n>=113?e.readUint8():(e.readUint8(),0),e.readUint8(),u.disableSampleMacro=n>=117?!!e.readUint8():(e.readUint8(),!1),u.brokenOutVol2=n>=121?!!e.readUint8():(e.readUint8(),!1),u.oldArpStrategy=n>=130?!!e.readUint8():(e.readUint8(),!1));n>=96?(a.virtualTempo=e.readUint16(),a.virtualTempoD=e.readUint16()):e.skip(4);if(n>=95){_I(e),_I(e);const t=e.readUint8();e.skip(3);for(let n=0;n<t;n++)e.readUint32()}n>=103&&(_I(e),_I(e),_I(e),_I(e),_I(e),_I(e));if(n>=135){for(let s=0;s<t.systems.length;s++)e.skip(12);const n=e.readUint32();e.skip(4*n)}n>=136&&e.readUint8();n>=138&&(u.brokenPortaLegato=!!e.readUint8(),u.brokenFMOff=n>=155?!!e.readUint8():(e.readUint8(),!1),u.preNoteNoEffect=n>=168?!!e.readUint8():(e.readUint8(),!1),u.oldDPCM=n>=183?!!e.readUint8():(e.readUint8(),!1),u.resetArpPhaseOnNewNote=n>=184?!!e.readUint8():(e.readUint8(),!1),u.ceilVolumeScaling=n>=188?!!e.readUint8():(e.readUint8(),!1),u.oldAlwaysSetVolume=n>=191?!!e.readUint8():(e.readUint8(),!1),u.oldSampleOffset=n>=200?!!e.readUint8():(e.readUint8(),!1));if(t.compatFlags=u,n>=139){const n=e.readUint8(),s=[];for(let t=0;t<16;t++)s.push(e.readUint8());n>=1&&(a.speed1=s[0]||a.speed1),n>=2&&(a.speed2=s[1]||a.speed2);const o=e.readUint8();for(let a=0;a<o;a++){const n=e.readUint8(),s=[];for(let t=0;t<16;t++)s.push(e.readUint8());t.grooves.push({len:n,val:s})}}n>=156&&e.skip(12);t.subsongs.push(a);for(let b=0;b<d.length;b++){const n=d[b];if(0===n)continue;e.seek(n);const s=e.getOffset();try{const n=LI(e),a=e.getOffset()-s;e.seek(s);const o=e.readBytes(a);n.rawBinaryData=o,t.instruments.push(n)}catch(g){t.instruments.push({name:"Error",type:0,macros:[],samples:[],wavetables:[]})}}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],n=VI[e]??0;t.instruments.push({name:"Default",type:n,macros:[],samples:[],wavetables:[]})}for(const b of m)if(0!==b){e.seek(b);try{const n=FI(e);t.wavetables.push(n)}catch(g){}}for(const b of p)if(0!==b){e.seek(b);try{const s=UI(e,n);t.samples.push(s)}catch(g){}}for(const b of h)if(0!==b){e.seek(b);try{const s=RI(e,t.chans,t.subsongs,n),a=`${s.subsong}_${s.channel}_${s.index}`;if(t.patterns.set(a,s),t.patterns.size<=3){s.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)}}catch(g){}}}(n,r,a),r}function TI(e,t,n){const s=e.readMagic(4);if("SNG2"!==s&&"SONG"!==s)throw new Error(`Expected SNG2/SONG block, got: "${s}"`);e.readUint32();const a={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};if("SNG2"===s){a.hz=e.readFloat32(),a.arpLen=e.readUint8(),e.readUint8(),a.patLen=e.readUint16(),a.ordersLen=e.readUint16(),a.hilightA=e.readUint8(),a.hilightB=e.readUint8(),a.virtualTempo=e.readUint16(),a.virtualTempoD=e.readUint16();const t=e.readUint8(),n=[];for(let s=0;s<16;s++)n.push(e.readUint16());a.speed1=n[0]||6,a.speed2=t>1?n[1]:a.speed1,a.name=_I(e),a.comment=_I(e)}else a.timeBase=e.readUint8(),a.speed1=e.readUint8(),a.speed2=e.readUint8(),a.arpLen=e.readUint8(),a.hz=e.readFloat32(),a.patLen=e.readUint16(),a.ordersLen=e.readUint16(),a.hilightA=e.readUint8(),a.hilightB=e.readUint8(),a.virtualTempo=e.readUint16(),a.virtualTempoD=e.readUint16(),a.name=_I(e),a.comment=_I(e);for(let o=0;o<t;o++){const t=[];for(let n=0;n<a.ordersLen;n++)t.push(e.readUint8());a.orders.push(t)}for(let o=0;o<t;o++)a.effectColumns.push(e.readUint8());e.skip(2*t);for(let o=0;o<t;o++)a.channelNames.push(_I(e));for(let o=0;o<t;o++)a.channelShortNames.push(_I(e));return n>=240&&e.skip(4*t),a}function LI(e){const t=e.readMagic(4),n={name:"",type:0,macros:[],samples:[],wavetables:[]};if("INS2"===t||"FINS"===t)for("INS2"===t&&e.readUint32(),e.readUint16(),n.type=e.readUint16();!e.isEOF();){const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const s=e.readUint16(),a=e.getOffset()+s;switch(t){case"NA":n.name=_I(e);break;case"FM":n.fm=AI(e);break;case"MA":BI(e,n,a);break;case"SM":{const t=e.readInt16(),s=e.readUint8(),a=e.readUint8(),o=!!(1&s),r=!!(2&s),i=!!(4&s);if(t>=0&&n.samples.push(t),n.amiga={initSample:t,useNoteMap:o,useSample:r,useWave:i,waveLen:a},o){n.amiga.noteMap=[];const t=new Set(n.samples);for(let s=0;s<120;s++){const s=e.readInt16(),a=e.readInt16();n.amiga.noteMap.push({freq:s,map:a}),a>=0&&!t.has(a)&&(t.add(a),n.samples.push(a))}}break}case"SL":case"LS":{const s="LS"===t?e.readUint16():e.readUint8();for(let a=0;a<s;a++)"LS"===t?n.samples.push(e.readUint16()):n.samples.push(e.readUint8());break}case"WL":case"LW":{const s="LW"===t?e.readUint16():e.readUint8();for(let a=0;a<s;a++)"LW"===t?n.wavetables.push(e.readUint16()):n.wavetables.push(e.readUint8());break}case"GB":{const t=e.readUint8(),s=e.readUint8(),a=e.readUint8(),o=e.readUint8(),r=[];for(let n=0;n<o;n++)r.push({cmd:e.readUint8(),data:e.readInt16()});n.gb={envVol:15&t,envDir:16&t?1:0,envLen:t>>5&7,soundLen:s,softEnv:!!(1&a),alwaysInit:!!(2&a),doubleWave:!!(4&a),hwSeqLen:o,hwSeq:r};break}case"64":{const t=e.readUint8(),s=e.readUint8(),o=e.readUint8(),r=e.readUint8(),i=4095&e.readUint16(),l=e.readUint16();let c=l>>12,u=!1;if(e.getOffset()<a){const t=e.readUint8();c|=(15&t)<<4,u=!!(16&t)}n.c64={triOn:!!(1&t),sawOn:!!(2&t),pulseOn:!!(4&t),noiseOn:!!(8&t),toFilter:!!(16&t),initFilter:!!(64&t),dutyIsAbs:!!(128&t),lp:!!(1&s),bp:!!(4&s),hp:!!(2&s),ch3off:!!(8&s),filterIsAbs:!!(16&s),noTest:!!(32&s),ringMod:!!(64&s),oscSync:!!(128&s),a:o>>4&15,d:15&o,s:r>>4&15,r:15&r,duty:i,cut:4095&l,res:c,resetDuty:u};break}case"SN":{const t=e.readUint8(),s=e.readUint8(),o=e.readUint8(),r=e.readUint8();let i=8&o?1:0,l=0;if(e.getOffset()<a){const t=e.readUint8();i=t>>5&3,l=31&t}n.snes={a:15&t,d:t>>4&7,s:s>>5&7,r:31&s,useEnv:!!(16&o),sus:i,gainMode:7&o,gain:r,d2:l};break}case"N1":{const t=e.readInt32(),s=e.readUint8(),o=e.readUint8(),r=e.readUint8();let i=!1;if(e.getOffset()<a&&(i=0!==e.readUint8(),i)){for(let t=0;t<8;t++)e.readUint8();for(let t=0;t<8;t++)e.readUint8()}n.n163={wave:t,wavePos:s,waveLen:o,waveMode:r,perChanPos:i};break}case"FD":{const t=e.readInt32(),s=e.readInt32(),a=0!==e.readUint8(),o=[];for(let n=0;n<32;n++)o.push(e.readInt8());n.fds={modSpeed:t,modDepth:s,initModTableWithFirstWave:a,modTable:o};break}case"O1":case"O2":case"O3":case"O4":{const s=t.charCodeAt(1)-"1".charCodeAt(0);n.opMacroArrays||(n.opMacroArrays=[[],[],[],[]]),II(e,n.opMacroArrays[s],a);break}}e.seek(a)}else{if("INST"!==t)throw new Error(`Unknown instrument format: "${t}"`);{e.readUint32();const t=e.readUint16();n.type=e.readUint8(),e.readUint8(),n.name=_I(e);const s=e.readUint8(),a=e.readUint8(),o=e.readUint8(),r=e.readUint8(),i=e.readUint8(),l=t>=60?e.readUint8():(e.readUint8(),0);e.skip(2);const c=[];for(let n=0;n<4;n++){const n=e.readUint8(),s=e.readUint8(),a=e.readUint8(),o=e.readUint8(),r=e.readUint8(),i=e.readUint8(),l=e.readUint8(),u=e.readUint8(),d=e.readUint8(),m=e.readUint8(),p=e.readUint8(),h=e.readUint8(),f=e.readUint8(),g=e.readUint8(),b=e.readUint8(),v=e.readUint8(),y=e.readUint8(),x=e.readUint8(),N=e.readUint8(),w=e.readUint8(),E=t>=114?e.readUint8():(e.readUint8(),1),k=t>=115?e.readUint8():(e.readUint8(),2);e.skip(10),c.push({enabled:!!E,mult:o,tl:l,ar:s,dr:a,d2r:p,sl:i,rr:r,dt:m,dt2:u,rs:d,am:!!n,ksr:!!w,ksl:v,sus:!!y,vib:!!x,ws:N,ssg:h,dam:f,dvb:g,egt:!!b,kvs:k})}n.fm={...va,algorithm:s,feedback:a,fms:o,ams:r,ops:i,opllPreset:l,operators:c,macros:[],opMacros:[],wavetables:[]};const u=e.readUint8(),d=e.readUint8(),m=e.readUint8(),p=e.readUint8();n.gb={envVol:u,envDir:d,envLen:m,soundLen:p,softEnv:!1,alwaysInit:!1,doubleWave:!1,hwSeqLen:0,hwSeq:[]};const h=0!==e.readUint8(),f=0!==e.readUint8(),g=0!==e.readUint8(),b=0!==e.readUint8(),v=e.readUint8(),y=e.readUint8(),x=e.readUint8(),N=e.readUint8(),w=e.readUint16(),E=0!==e.readUint8(),k=0!==e.readUint8(),D=0!==e.readUint8(),S=0!==e.readUint8();e.readUint8();const M=e.readUint8(),C=0!==e.readUint8(),V=0!==e.readUint8(),P=0!==e.readUint8(),_=0!==e.readUint8(),O=e.readUint16(),T=0!==e.readUint8(),L=0!==e.readUint8();n.c64={triOn:h,sawOn:f,pulseOn:g,noiseOn:b,a:v,d:y,s:x,r:N,duty:w,ringMod:E,oscSync:k,toFilter:D,initFilter:S,res:M,lp:C,bp:V,hp:P,ch3off:_,cut:O,dutyIsAbs:T,filterIsAbs:L,noTest:!1,resetDuty:!1};const A=e.readInt16(),B=t>=82?!!e.readUint8():(e.readUint8(),!1),I=t>=82?e.readUint8():(e.readUint8(),0);e.skip(12),A>=0&&n.samples.push(A),n.amiga={initSample:A,useNoteMap:!1,useSample:A>=0,useWave:B,waveLen:I};const F=e.readInt32(),U=e.readInt32(),R=e.readInt32(),j=e.readInt32();let X=0,z=0,G=0,H=0;t>=17&&(X=e.readInt32(),z=e.readInt32(),G=e.readInt32(),H=e.readInt32());const W=e.readInt32(),q=e.readInt32(),K=e.readInt32(),$=e.readInt32();let Y=-1,J=-1,Q=-1,Z=-1;t>=17&&(Y=e.readInt32(),J=e.readInt32(),Q=e.readInt32(),Z=e.readInt32());const ee=e.readUint8();e.skip(3);const te=t=>{const n=[];for(let s=0;s<t;s++)n.push(e.readInt32());return n},ne=te(F),se=te(U),ae=te(R),oe=te(j);if(t>=17){const e=te(X),t=te(z),s=te(G),a=te(H);X>0&&n.macros.push({code:4,length:X,loop:Y,release:-1,mode:0,type:0,delay:0,speed:1,data:e}),z>0&&n.macros.push({code:5,length:z,loop:J,release:-1,mode:0,type:0,delay:0,speed:1,data:t}),G>0&&n.macros.push({code:6,length:G,loop:Q,release:-1,mode:0,type:0,delay:0,speed:1,data:s}),H>0&&n.macros.push({code:7,length:H,loop:Z,release:-1,mode:0,type:0,delay:0,speed:1,data:a})}F>0&&n.macros.push({code:0,length:F,loop:W,release:-1,mode:0,type:0,delay:0,speed:1,data:ne}),U>0&&n.macros.push({code:1,length:U,loop:q,release:-1,mode:ee,type:0,delay:0,speed:1,data:se}),R>0&&n.macros.push({code:2,length:R,loop:K,release:-1,mode:0,type:0,delay:0,speed:1,data:ae}),j>0&&n.macros.push({code:3,length:j,loop:$,release:-1,mode:0,type:0,delay:0,speed:1,data:oe})}}return n}function AI(e){const t={...va,operators:[],macros:[],opMacros:[],wavetables:[]},n=e.readUint8(),s=15&n,a=n>>4&15;t.ops=s;const o=e.readUint8();t.algorithm=o>>4&7,t.feedback=7&o;const r=e.readUint8();t.fms2=r>>5&7,t.ams=r>>3&3,t.fms=7&r;const i=e.readUint8();t.ams2=i>>6&3,t.opllPreset=31&i;for(let l=0;l<s;l++){const n=e.readUint8(),s=e.readUint8(),o=e.readUint8(),r=e.readUint8(),i=e.readUint8(),c=e.readUint8(),u=e.readUint8(),d=e.readUint8(),m={enabled:!!(a>>l&1),mult:15&n,dt:n>>4&7,ksr:!!(n>>7&1),tl:127&s,sus:!!(s>>7&1),ar:31&o,vib:!!(o>>5&1),rs:o>>6&3,dr:31&r,ksl:r>>5&3,am:!!(r>>7&1),egt:!!(i>>7&1),kvs:i>>5&3,d2r:31&i,sl:c>>4&15,rr:15&c,dvb:u>>4&15,ssg:15&u,dam:d>>5&7,dt2:d>>3&3,ws:7&d};t.operators.push(m)}return t}function BI(e,t,n){const s=e.readUint16();if(!(0===s||s>32))for(;e.getOffset()<n;){const a=e.getOffset(),o=e.readUint8();if(255===o)break;const r={code:o,length:e.readUint8(),loop:e.readUint8(),release:e.readUint8(),mode:e.readUint8(),type:e.readUint8(),delay:e.readUint8(),speed:e.readUint8(),data:[]},i=a+s;e.getOffset()<i&&i<=n&&e.seek(i);const l=r.type>>6&3;for(let t=0;t<r.length&&e.getOffset()<n;t++)switch(l){case 0:r.data.push(e.readUint8());break;case 1:r.data.push(e.readInt8());break;case 2:r.data.push(e.readInt16());break;case 3:r.data.push(e.readInt32())}t.macros.push(r)}}function II(e,t,n){const s=e.readUint16();if(!(0===s||s>32))for(;e.getOffset()<n;){const a=e.getOffset(),o=e.readUint8();if(255===o)break;const r={code:o,length:e.readUint8(),loop:e.readUint8(),release:e.readUint8(),mode:e.readUint8(),type:e.readUint8(),delay:e.readUint8(),speed:e.readUint8(),data:[]},i=a+s;e.getOffset()<i&&i<=n&&e.seek(i);const l=r.type>>6&3;for(let t=0;t<r.length&&e.getOffset()<n;t++)switch(l){case 0:r.data.push(e.readUint8());break;case 1:r.data.push(e.readInt8());break;case 2:r.data.push(e.readInt16());break;case 3:r.data.push(e.readInt32())}t.push(r)}}function FI(e){const t=e.readMagic(4);if("WAVE"!==t)throw new Error(`Expected WAVE block, got: "${t}"`);e.readUint32();const n={name:_I(e),width:e.readUint32(),height:0,data:[]};e.readUint32(),n.height=e.readUint32();for(let s=0;s<n.width;s++)n.data.push(e.readInt32());return n}function UI(e,t){const n=e.readMagic(4),s={name:"",length:0,compatRate:0,c4Rate:0,depth:16,loopStart:-1,loopEnd:-1,loopDirection:0,data:new Int16Array(0)};if("SMP2"===n)if(e.readUint32(),s.name=_I(e),s.length=e.readUint32(),s.compatRate=e.readUint32(),s.c4Rate=e.readUint32(),s.depth=e.readUint8(),s.loopDirection=t>=123?e.readUint8():0,e.readUint8(),e.readUint8(),s.loopStart=e.readInt32(),s.loopEnd=e.readInt32(),e.skip(16),16===s.depth){const t=new Int16Array(s.length);for(let n=0;n<s.length;n++)t[n]=e.readInt16();s.data=t}else if(8===s.depth){const t=new Int8Array(s.length);for(let n=0;n<s.length;n++)t[n]=e.readInt8();s.data=t}else s.data=e.readBytes(s.length);else{if("SMPL"!==n)throw new Error(`Unknown sample format: "${n}"`);{e.readUint32(),s.name=_I(e),s.length=e.readUint32(),s.compatRate=e.readUint32(),t<58?(e.readUint16(),e.readUint16()):e.skip(4),s.depth=e.readUint8(),e.readUint8(),t>=32&&(s.c4Rate=e.readUint16()),t>=19&&(s.loopStart=e.readInt32());const n=t<58?2*s.length:s.length;if(16===s.depth){const t=new Int16Array(s.length);for(let n=0;n<s.length;n++)t[n]=e.readInt16();s.data=t}else{const t=new Int8Array(n);for(let s=0;s<n;s++)t[s]=e.readInt8();s.data=t}}}return s}function RI(e,t,n,s){const a=e.readMagic(4),o={subsong:0,channel:0,index:0,name:"",rows:[]};if("PATN"===a){e.readUint32(),o.subsong=e.readUint8(),o.channel=e.readUint8(),o.index=e.readUint16(),s>=51&&(o.name=_I(e));const t=n[o.subsong]||n[0],a=t?.patLen||64;t?.effectColumns[o.channel];for(let e=0;e<a;e++)o.rows.push({note:-1,octave:0,instrument:-1,volume:-1,effects:[]});let r=0;for(;r<a&&!e.isEOF();){const t=e.readUint8();if(255===t)break;if(128&t){r+=2+(127&t);continue}if(0===t){r++;continue}const n=o.rows[r],s=!!(1&t),a=!!(2&t),i=!!(4&t),l=!!(8&t),c=!!(16&t),u=!!(64&t);let d=0,m=0;if(!!(32&t)&&(d=e.readUint8()),u&&(m=e.readUint8()),s){const t=e.readUint8();t>=180?(n.note=t,n.octave=0):t<180&&(n.note=DI[t]||0,n.octave=SI[t]||0,n.octave>=250&&(n.octave=n.octave-256))}if(a&&(n.instrument=e.readUint8()),i&&(n.volume=e.readUint8()),l){const t=e.readUint8(),s=c?e.readUint8():0;n.effects.push({type:t,value:s})}else c&&e.readUint8();for(let o=1;o<=3;o++){const t=!!(d&1<<2*o+1);if(!!(d&1<<2*o)){const s=e.readUint8(),a=t?e.readUint8():0;n.effects.push({type:s,value:a})}else t&&e.readUint8()}for(let o=4;o<=7;o++){const t=!!(m&1<<2*(o-4)+1);if(!!(m&1<<2*(o-4))){const s=e.readUint8(),a=t?e.readUint8():0;n.effects.push({type:s,value:a})}else t&&e.readUint8()}r++}}else{if("PATR"!==a)throw new Error(`Unknown pattern format: "${a}"`);{e.readUint32(),o.channel=e.readUint16(),o.index=e.readUint16(),s>=95&&(o.subsong=e.readUint16()),e.skip(2);const t=n[o.subsong]||n[0],a=t?.patLen||64,r=t?.effectColumns[o.channel]||1;for(let n=0;n<a;n++){const t={note:e.readInt16(),octave:e.readInt16(),instrument:e.readInt16(),volume:e.readInt16(),effects:[]};0===t.note&&0===t.octave?t.note=-1:100===t.note?(t.note=180,t.octave=0):101===t.note?(t.note=181,t.octave=0):102===t.note?(t.note=182,t.octave=0):12===t.note?(t.note=12,t.octave++):t.note>=1&&t.note<=11&&t.octave>=128&&(t.octave=t.octave-256);for(let n=0;n<r;n++){const n=e.readInt16(),s=e.readInt16();n>=0&&t.effects.push({type:n,value:s>=0?s:0})}o.rows.push(t)}s>=51&&(o.name=_I(e))}}return o}function jI(e,t=0){const n=function(e){const t={2:[1,1,1,1,1,1,4,0,0,0,0]},n=[];let s=0;for(let a=0;a<e.systemLen;a++){const o=e.systems[a],r=e.systemChans[a]??0,i=t[o];if(i)for(let e=0;e<r;e++)n[s+e]=i[e]??0;else{const e=VI[o]??0;for(let t=0;t<r;t++)n[s+t]=e}s+=r}return n}(e),s=function(e){const t=[];let n=0;for(let s=0;s<e.systemLen;s++){const a=e.systems[s],o=e.systemChans[s]??0;for(let e=0;e<o;e++)t[n+e]=a;n+=o}return t}(e),a=function(e){const t=new Map;for(let n=0;n<e.subsongs.length;n++){const s=e.subsongs[n];if(s)for(let a=0;a<s.ordersLen;a++)for(let o=0;o<e.chans;o++){const r=`${n}_${o}_${s.orders[o]?.[a]??0}`,i=e.patterns.get(r);if(i)for(const e of i.rows)if(e.instrument>=0){let n=t.get(e.instrument);n||(n=new Set,t.set(e.instrument,n)),n.add(o)}}}return t}(e),o=e.instruments.map((t,o)=>{const r=[];let i=(l=t.type,kI[l]||"ChipSynth");var l;if(0===t.type&&"ChipSynth"===i){const t=a.get(o);if(t&&t.size>0){const e=new Map;for(const o of t){const t=n[o];void 0!==t&&0!==t&&e.set(t,(e.get(t)||0)+1)}let s=0,a=0;for(const[t,n]of e)n>a&&(s=t,a=n);if(s>0){const e=kI[s];e&&(i=e)}}else if(e.systems.length>0){const t=e.systems[0],n=VI[t];if(void 0!==n&&0!==n){const e=kI[n];e&&(i=e)}}}if("FurnaceC64"===i){const t=a.get(o);let n=e.systems.length>0?e.systems[0]:0;if(t&&t.size>0){const e=t.values().next().value;void 0!==e&&void 0!==s[e]&&(n=s[e])}71===n||240===n?i="FurnaceSID6581":7===n&&(i="FurnaceSID8580")}const c="Sampler"===i||"Player"===i;if(t.samples&&t.samples.length>0){for(const n of t.samples)if(n<e.samples.length){const t=e.samples[n];r.push(GI(t,n))}}else if(c&&o<e.samples.length){const t=e.samples[o];r.push(GI(t,o))}const u=e.systems.length>0?e.systems[0]:0,d={chipType:CI[u]??t.type,synthType:i,macros:t.macros.map(e=>({code:e.code,type:e.code,data:[...e.data],loop:e.loop,release:e.release,speed:e.speed,mode:e.mode,delay:e.delay})),wavetables:t.wavetables.filter(t=>t<e.wavetables.length).map(t=>{const n=e.wavetables[t];return{id:t,data:[...n.data],len:n.width,max:n.height}})};t.opMacroArrays&&(d.opMacroArrays=t.opMacroArrays.map(e=>e.map(e=>({code:e.code,type:e.code,data:[...e.data],loop:e.loop,release:e.release,speed:e.speed,mode:e.mode,delay:e.delay})))),t.fm&&(d.fm={algorithm:t.fm.algorithm,feedback:t.fm.feedback,fms:t.fm.fms,ams:t.fm.ams,ops:t.fm.ops,opllPreset:t.fm.opllPreset,operators:t.fm.operators.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2,rs:e.rs,am:e.am,ksr:e.ksr,ksl:e.ksl,sus:e.sus,vib:e.vib,ws:e.ws,ssg:e.ssg,egt:e.egt,kvs:e.kvs,dvb:e.dvb,dam:e.dam}))}),t.amiga&&(d.amiga={initSample:t.amiga.initSample,useNoteMap:t.amiga.useNoteMap,useSample:t.amiga.useSample,useWave:t.amiga.useWave,waveLen:t.amiga.waveLen,noteMap:t.amiga.noteMap});const m={};return t.gb&&(m.gb=t.gb),t.c64&&(m.c64=t.c64),t.snes&&(m.snes=t.snes),t.n163&&(m.n163=t.n163),t.fds&&(m.fds=t.fds),Object.keys(m).length>0&&(d.chipConfig=m),{id:o+1,name:t.name||`Instrument ${o+1}`,samples:r,fadeout:0,volumeType:"none",panningType:"none",furnace:d,rawBinaryData:t.rawBinaryData}}),r=[],i=e.subsongs[t]||e.subsongs[0];if(!i)return{instruments:o,patterns:[],metadata:zI(e,t),wavetables:[],samples:[],furnaceNative:{subsongs:[],activeSubsong:t}};const l=e.systems[0]||0,c=MI.has(l);const u=[];for(let m=0;m<i.ordersLen;m++){const n=[];for(let s=0;s<i.patLen;s++){const a=[];for(let n=0;n<e.chans;n++){const o=`${t}_${n}_${i.orders[n]?.[m]??0}`,r=e.patterns.get(o);if(r&&r.rows[s]){const t=r.rows[s];t.note>=1&&t.note<=12&&0,t.effects.length>0&&t.effects.some(e=>e.type>=0)&&0;const o=HI(t,c,e.grooves);if(o.note>0&&o.note<97&&0,t.note>=1&&t.note<=12&&0===o.note&&u.length<5){const e=["?","C#","D","D#","E","F","F#","G","G#","A","A#","B","C"];u.push(`${e[t.note]||"?"}${t.octave} (ord=${m} ch=${n} row=${s})`)}a.push(o)}else 0===s&&0===m&&0,a.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0,effectType2:0,effectParam2:0})}n.push(a)}r.push(n)}r.filter(e=>e.some(e=>e.some(e=>e.note>0||e.instrument>0||e.effectType>0)));if(u.length,r.length>0){r[0]}const d=function(e){const t=e.subsongs.map((t,n)=>{const s=[];for(let a=0;a<e.chans;a++){const o=new Map,r=new Set;for(let e=0;e<t.ordersLen;e++){const n=t.orders[a]?.[e];void 0!==n&&r.add(n)}for(const t of r){const s=`${n}_${a}_${t}`,r=e.patterns.get(s);if(r){const e=r.rows.map(e=>({note:XI(e),ins:e.instrument,vol:e.volume,effects:e.effects.map(e=>({cmd:e.type,val:e.value}))}));o.set(t,{rows:e})}}s.push({name:t.channelNames?.[a]||`CH ${a}`,effectCols:t.effectColumns?.[a]||1,patterns:o})}return{name:t.name||`Subsong ${n}`,patLen:t.patLen,ordersLen:t.ordersLen,orders:t.orders,channels:s,speed1:t.speed1,speed2:t.speed2,hz:t.hz,virtualTempoN:t.virtualTempo,virtualTempoD:t.virtualTempoD}});return{subsongs:t,activeSubsong:0}}(e);return{instruments:o,patterns:r,metadata:zI(e,t),wavetables:e.wavetables.map(e=>({data:[...e.data],width:e.width,height:e.height})),samples:e.samples.map(e=>({data:e.data,rate:e.c4Rate,depth:e.depth,loopStart:e.loopStart,loopEnd:e.loopEnd,loopMode:e.loopDirection??0,name:e.name})),furnaceNative:d}}function XI(e){if(0===e.note&&0===e.octave)return-1;if(180===e.note||100===e.note)return 253;if(181===e.note||101===e.note)return 254;if(182===e.note||102===e.note)return 255;if(e.note>=1&&e.note<=12){const t=12*(e.octave>127?e.octave-256:e.octave)+(e.note-1);return Math.max(0,Math.min(179,t))}return e.note>=0&&e.note<180?e.note:-1}function zI(e,t=0){const n=e.subsongs[t]||e.subsongs[0],s=n?.virtualTempo||150,a=n?.virtualTempoD||150,o=n?.hz||60,r=n?.speed1||6,i=Math.round(2.5*o*(s/a));return{sourceFormat:"XM",sourceFile:e.name||"Furnace Module",importedAt:(new Date).toISOString(),originalChannelCount:e.chans,originalPatternCount:e.patterns.size,originalInstrumentCount:e.instruments.length,modData:{moduleType:"FUR",initialSpeed:r,initialBPM:i,amigaPeriods:!1,channelNames:n?.channelNames||Array.from({length:e.chans},(e,t)=>`Ch ${t+1}`),songLength:n?.ordersLen||1,restartPosition:0,patternOrderTable:Array.from({length:n?.ordersLen||1},(e,t)=>t),songMessage:e.comment},furnaceData:{speed2:n?.speed2,hz:n?.hz,virtualTempoN:n?.virtualTempo,virtualTempoD:n?.virtualTempoD,compatFlags:e.compatFlags,systems:e.systems,systemChans:e.systemChans,grooves:e.grooves.length>0?e.grooves.map(e=>e.val.slice(0,e.len)):void 0}}}function GI(e,t){let n;if(16===e.depth&&e.data instanceof Int16Array)n=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength);else if(e.data instanceof Int8Array){const t=new Int16Array(e.length);for(let n=0;n<e.length;n++)t[n]=256*e.data[n];n=t.buffer}else n=new ArrayBuffer(2*e.length);return{id:t,name:e.name,pcmData:n,loopStart:e.loopStart>=0?e.loopStart:0,loopLength:e.loopEnd>e.loopStart?e.loopEnd-e.loopStart:0,loopType:e.loopStart<0?"none":2===e.loopDirection?"pingpong":"forward",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:e.c4Rate||e.compatRate||22050,length:e.length}}function HI(e,t=!1,n){let s=0;if(180===e.note||181===e.note||182===e.note)s=97;else if(e.note>=1&&e.note<=12){const n=12===e.note?0:e.note;s=12*(12===e.note?e.octave+1:e.octave)+n+1+(t?0:-24),s>96&&(s=96),s<1&&(s=0)}let a=0;e.volume>=0&&(a=16+Math.min(64,Math.round(64*e.volume/127)));const o=[];for(let l=0;l<Math.min(8,e.effects.length);l++){const t=e.effects[l];let s=WI(t.type);if(s<0)continue;let a=255&t.value;if(9===t.type&&n&&n.length>0){const e=n[a];e&&e.len>0&&(a=e.val[0])}if(s>=224&&s<=239){const e=15&s;s=14,a=e<<4|15&a}o.push({type:s,param:a})}const r=e=>o[e]??{type:0,param:0},i={note:s,instrument:e.instrument>=0?e.instrument+1:0,volume:a,effectType:r(0).type,effectParam:r(0).param,effectType2:r(1).type,effectParam2:r(1).param};return o.length>2&&(i.effectType3=r(2).type,i.effectParam3=r(2).param),o.length>3&&(i.effectType4=r(3).type,i.effectParam4=r(3).param),o.length>4&&(i.effectType5=r(4).type,i.effectParam5=r(4).param),o.length>5&&(i.effectType6=r(5).type,i.effectParam6=r(5).param),o.length>6&&(i.effectType7=r(6).type,i.effectParam7=r(6).param),o.length>7&&(i.effectType8=r(7).type,i.effectParam8=r(7).param),i}function WI(e){return{0:0,1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:8,9:15,10:10,11:11,12:233,13:13,15:15,16:16,17:17,128:8,129:8,130:8,131:25,132:25,136:8,137:8,138:8,144:9,145:9,146:9,147:9,148:9,149:9,150:9,151:9,152:9,153:9,154:9,155:9,156:9,157:9,158:9,159:9,192:15,193:15,194:15,195:15,211:10,212:10,220:236,224:-1,225:225,226:226,227:228,228:4,229:-1,230:3,231:-1,232:3,233:3,234:-1,235:-1,236:236,237:237,238:-1,240:15,241:225,242:226,243:234,244:235,245:-1,246:-1,247:-1,248:234,249:235,250:10,252:236,253:15,254:15,255:-1}[e]??e}const qI=Object.freeze(Object.defineProperty({__proto__:null,convertFurnaceToDevilbox:jI,convertSubsongForPlayback:function(e,t){const n=e.systems[0]||0,s=MI.has(n),a=e.subsongs[t]||e.subsongs[0];if(!a)return{patterns:[],metadata:zI(e,t)};const o=[];for(let r=0;r<a.ordersLen;r++){const n=[];for(let o=0;o<a.patLen;o++){const i=[];for(let n=0;n<e.chans;n++){const l=`${t}_${n}_${a.orders[n]?.[r]??0}`,c=e.patterns.get(l);c&&c.rows[o]?i.push(HI(c.rows[o],s,e.grooves)):i.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0,effectType2:0,effectParam2:0})}n.push(i)}o.push(n)}return{patterns:o,metadata:zI(e,t)}},parseFurnaceSong:OI},Symbol.toStringTag,{value:"Module"}));async function KI(e){return new Promise((t,n)=>{const s=new FileReader;s.onload=async s=>{const a=s.target?.result;if(!a)return void n(new Error("Failed to read file"));const o=e.name.toLowerCase().slice(e.name.lastIndexOf(".")),r=".xm"===o||".mod"===o||".fur"===o||".dmf"===o;try{if(r)try{const n=await async function(e,t){try{if(".xm"===t){const t=await GT(e);return{format:"XM",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".mod"===t){const t=await ZT(e);return{format:"MOD",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".fur"===t){const t=jI(await OI(e));if(t.metadata.furnaceData?.compatFlags)try{const e=wc.getInstance();e.getEffectRouter().setCompatFlags(t.metadata)}catch(n){}return{format:"FUR",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".dmf"===t){const t=function(e){const t=e.instruments.map((e,t)=>({id:t+1,name:e.name||`Instrument ${t+1}`,samples:[],fadeout:0,volumeType:"none",panningType:"none"})),n=[];for(let r=0;r<e.matrixRows;r++){const t=[];for(let n=0;n<e.patternRows;n++){const s=[];for(let t=0;t<e.channelCount;t++){const a=e.patternMatrix[t]?.[r]||0,o=t*e.matrixRows+a,i=e.patterns[o],l=i?.rows?.[n]?.[t];l?s.push(eF(l)):s.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0})}t.push(s)}n.push(t)}const s=60,a=Math.round(2.5*s/(e.timeBase+1)/e.ticksPerRow[0]*4),o={sourceFormat:"XM",sourceFile:e.name||"DefleMask Module",importedAt:(new Date).toISOString(),originalChannelCount:e.channelCount,originalPatternCount:n.length,originalInstrumentCount:e.instruments.length,modData:{moduleType:"DMF",initialSpeed:e.ticksPerRow[0],initialBPM:a>0?a:125,amigaPeriods:!1,channelNames:Array.from({length:e.channelCount},(e,t)=>`Ch ${t+1}`),songLength:e.matrixRows,restartPosition:0,patternOrderTable:Array.from({length:e.matrixRows},(e,t)=>t),songMessage:`${e.name} by ${e.author}`}};return{instruments:t,patterns:n,metadata:o}}(rN.parse(e,"dmf"));return{format:"DMF",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}}catch(n){return null}return null}(a,o);if(n){const s={title:n.importMetadata.sourceFile,type:".fur"===o?"Furnace":".dmf"===o?"DefleMask":n.format,channels:n.importMetadata.originalChannelCount,patterns:n.importMetadata.originalPatternCount,orders:n.importMetadata.modData?.songLength||1,instruments:n.importMetadata.originalInstrumentCount,samples:n.importMetadata.originalInstrumentCount,duration:0,message:n.importMetadata.modData?.songMessage};let r;return".fur"!==o&&".dmf"!==o&&(r=await JI(a)),void t({metadata:s,arrayBuffer:a,player:r,file:e,nativeData:n})}}catch(i){if(".fur"===o||".dmf"===o)return void n(new Error(`Failed to parse ${o} file: ${i instanceof Error?i.message:"unknown error"}`))}const s=await JI(a),l=await new Promise((t,n)=>{const a=setTimeout(()=>{n(new Error("Timeout waiting for metadata"))},5e3);s.onMetadata(n=>{let s;clearTimeout(a),n.song&&(s={channels:n.song.channels||[],instruments:n.song.instruments||[],samples:n.song.samples||[],orders:n.song.orders||[],patterns:n.song.patterns||[],numSubsongs:n.song.numSubsongs||1}),t({title:n.title||e.name.replace(/\.[^/.]+$/,""),type:n.type||"Unknown",channels:n.song?.channels?.length||n.channels||4,patterns:n.song?.patterns?.length||n.totalPatterns||n.patterns||1,orders:n.song?.orders?.length||n.totalOrders||n.orders||1,instruments:n.song?.instruments?.length||n.instruments||0,samples:n.song?.samples?.length||n.samples||0,duration:n.dur||0,message:n.message,song:s})}),s.onError(e=>{clearTimeout(a),n(new Error(`Failed to load module: ${e.type||e.message||"unknown error"}`))})});t({metadata:l,arrayBuffer:a,player:s,file:e})}catch(l){n(l)}},s.onerror=()=>n(new Error("Failed to read file")),s.readAsArrayBuffer(e)})}async function $I(e){e.player&&await e.player.play(e.arrayBuffer)}function YI(e){e.player&&e.player.stop()}async function JI(e){const t=new BT({repeatCount:0});if(!(await new Promise(e=>{const n=setTimeout(()=>{e(!1)},1e4);t.onInitialized(()=>{clearTimeout(n),e(!0)}),t.onError(t=>{"init"===t.type&&(clearTimeout(n),e(!1))})})))throw new Error("Module player not available. The audio worklet failed to load.");return await t.play(e),t.stop(),t}function QI(){return[".mid",".midi",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".j2b",".m15",".mdl",".mt2",".mtm",".psm",".pt36",".ptm",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".hvl",".ahx",".okt",".med",".mmd0",".mmd1",".mmd2",".mmd3",".digi",".fc",".fc13",".fc14",".sfc",".fc2",".fc3",".fc4",".smod",".hip",".hip7",".sog",".s7g",".hipc",".hst",".soc",".coso",".tfmx",".mdat",".tfmxpro",".tfmx1.5",".tfmx7v",".tfhd1.5",".tfhd7v",".tfhdpro",".fred",".gray",".sm",".sm1",".sm2",".sm3",".smpro",".bd",".bds",".dw",".dwold",".mc",".mcr",".mco",".jp",".jpn",".jpnd",".rj",".rjp",".dm",".dm1",".dm2",".dlm1",".dlm2",".sa",".sa-p",".sa_old",".sonic",".lion",".abk",".aam",".aon",".aon4",".aon8",".adpcm",".adsc",".mod_adsc4",".bss",".bfc",".bsi",".core",".cin",".dl",".dl_deli",".dln",".ea",".mg",".fp",".fw",".gmc",".gm",".glue",".hd",".ims",".jam",".jc",".kris",".kh",".lme",".ma",".max",".mdst",".mkii",".mk2",".mkiio",".ntp",".osp",".ps",".psf",".pt",".ptm",".puma",".rh",".rhp",".rho",".riff",".sas",".sb",".scr",".sdr",".sg",".snk",".ss",".st26",".sun",".syn",".dh",".uds",".octamed",".tpu",".tcb",".ufo",".mus",".wn",".wb",".ym",".ymst",".sid",".sid1",".sid2",".smn",".bp",".bp3",".sndmon",".sfx",".sfx13",".sfx20",".mms",".smus",".snx",".agi",".vss",".ml",".sng",".qpa",".qts",".sqt",".ash",".aps",".ast",".alp",".amc",".dsc",".dsr",".dss",".dns",".dmu",".dmu2",".ems",".emsv6",".emod",".jmf",".jo",".js",".jb",".jcb",".jcbo",".jd",".jt",".kim",".mon",".mon_old",".mfp",".mosh",".mmdc",".mug",".mug2",".mm4",".mm8",".psa",".prt",".pn",".pap",".pvp",".pat",".sc",".sct",".scn",".scumm",".sjs",".spl",".syn",".synmod",".tf",".thm",".tmk",".tme",".dp",".trc",".tro",".tronic",".dat",".dum",".doda",".dz",".ex",".cm",".cus",".cust",".custom",".hot",".bye",".one",".two",".avp",".mw",".md",".mok",".tiny",".sdata",".npp",".is",".is20",".jpo",".jpold",".powt",".hn",".mtp2",".thn",".arp",".tits",".mcmd",".mcmd_org",".ac1",".ac1d",".aval",".chan",".cp",".cplx",".crb",".di",".eu",".fc-m",".fcm",".ft",".fuz",".fuzz",".gv",".hmc",".hrt",".ice",".it1",".kef",".kef7",".krs",".ksm",".lax",".mexxmp",".mpro",".np",".np1",".np2",".np3",".nr",".nru",".ntpk",".p10",".p21",".p30",".p40a",".p40b",".p41a",".p4x",".p50a",".p5a",".p5x",".p60",".p60a",".p61",".p61a",".p6x",".pha",".pin",".pm",".pm0",".pm01",".pm1",".pm10c",".pm18a",".pm2",".pm20",".pm4",".pm40",".pmz",".polk",".pp10",".pp20",".pp21",".pp30",".ppk",".pr1",".pr2",".prom",".pru",".pru1",".pru2",".prun",".prun1",".prun2",".pwr",".pyg",".pygm",".pygmy",".skt",".skyt",".snt",".st",".st2",".st30",".star",".stpk",".tp",".tp1",".tp2",".tp3",".un2",".unic",".unic2",".wn",".xan",".xann",".zen",".mod_doc",".mod15",".mod15_mst",".mod_ntk",".mod_ntk1",".mod_ntk2",".mod_ntkamp",".mod_flt4",".mod_comp",".mod15_ust",".mod15_st-iv",".mod3",".gt2",".gtk",".dsym",".cba",".act",".c67",".667",".fmt",".dtm",".etx",".is10",".plm",".qc",".rk",".rkb",".rtm",".tfx",".uax",".xmf",".mxtx",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".vgm",".vgz",".nsf",".nsfe",".sap",".ay"]}function ZI(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mid",".midi",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".j2b",".m15",".mdl",".mt2",".mtm",".psm",".pt36",".ptm",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".hvl",".ahx",".okt",".med",".mmd0",".mmd1",".mmd2",".mmd3",".digi",".fc",".fc13",".fc14",".sfc",".fc2",".fc3",".fc4",".smod",".hip",".hip7",".sog",".s7g",".hipc",".hst",".soc",".coso",".tfmx",".mdat",".tfmxpro",".tfmx1.5",".tfmx7v",".tfhd1.5",".tfhd7v",".tfhdpro",".fred",".gray",".sm",".sm1",".sm2",".sm3",".smpro",".bd",".bds",".dw",".dwold",".mc",".mcr",".mco",".jp",".jpn",".jpnd",".rj",".rjp",".dm",".dm1",".dm2",".dlm1",".dlm2",".sa",".sa-p",".sa_old",".sonic",".lion",".abk",".aam",".aon",".aon4",".aon8",".adpcm",".adsc",".mod_adsc4",".bss",".bfc",".bsi",".core",".cin",".dl",".dl_deli",".dln",".ea",".mg",".fp",".fw",".gmc",".gm",".glue",".hd",".ims",".jam",".jc",".kris",".kh",".lme",".ma",".max",".mdst",".mkii",".mk2",".mkiio",".ntp",".osp",".ps",".psf",".pt",".ptm",".puma",".rh",".rhp",".rho",".riff",".sas",".sb",".scr",".sdr",".sg",".snk",".ss",".st26",".sun",".syn",".dh",".uds",".octamed",".tpu",".tcb",".ufo",".mus",".wn",".wb",".ym",".ymst",".sid",".sid1",".sid2",".smn",".bp",".bp3",".sndmon",".sfx",".sfx13",".sfx20",".mms",".smus",".snx",".agi",".vss",".ml",".sng",".qpa",".qts",".sqt",".ash",".aps",".ast",".alp",".amc",".dsc",".dsr",".dss",".dns",".dmu",".dmu2",".ems",".emsv6",".emod",".jmf",".jo",".js",".jb",".jcb",".jcbo",".jd",".jt",".kim",".mon",".mon_old",".mfp",".mosh",".mmdc",".mug",".mug2",".mm4",".mm8",".psa",".prt",".pn",".pap",".pvp",".pat",".sc",".sct",".scn",".scumm",".sjs",".spl",".syn",".synmod",".tf",".thm",".tmk",".tme",".dp",".trc",".tro",".tronic",".dat",".dum",".doda",".dz",".ex",".cm",".cus",".cust",".custom",".hot",".bye",".one",".two",".avp",".mw",".md",".mok",".tiny",".sdata",".npp",".is",".is20",".jpo",".jpold",".powt",".hn",".mtp2",".thn",".arp",".tits",".mcmd",".mcmd_org",".ac1",".ac1d",".aval",".chan",".cp",".cplx",".crb",".di",".eu",".fc-m",".fcm",".ft",".fuz",".fuzz",".gv",".hmc",".hrt",".ice",".it1",".kef",".kef7",".krs",".ksm",".lax",".mexxmp",".mpro",".np",".np1",".np2",".np3",".nr",".nru",".ntpk",".p10",".p21",".p30",".p40a",".p40b",".p41a",".p4x",".p50a",".p5a",".p5x",".p60",".p60a",".p61",".p61a",".p6x",".pha",".pin",".pm",".pm0",".pm01",".pm1",".pm10c",".pm18a",".pm2",".pm20",".pm4",".pm40",".pmz",".polk",".pp10",".pp20",".pp21",".pp30",".ppk",".pr1",".pr2",".prom",".pru",".pru1",".pru2",".prun",".prun1",".prun2",".pwr",".pyg",".pygm",".pygmy",".skt",".skyt",".snt",".st",".st2",".st30",".star",".stpk",".tp",".tp1",".tp2",".tp3",".un2",".unic",".unic2",".wn",".xan",".xann",".zen",".mod_doc",".mod15",".mod15_mst",".mod_ntk",".mod_ntk1",".mod_ntk2",".mod_ntkamp",".mod_flt4",".mod_comp",".mod15_ust",".mod15_st-iv",".mod3",".gt2",".gtk",".dsym",".cba",".act",".c67",".667",".fmt",".dtm",".etx",".is10",".plm",".qc",".rk",".rkb",".rtm",".tfx",".uax",".xmf",".mxtx",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".vgm",".vgz",".nsf",".nsfe",".sap",".ay"].includes(t)}function eF(e){let t=0;if(100===e.note)t=97;else if(e.note>=0&&e.note<=11){t=12*Math.max(0,Math.min(7,e.octave))+e.note+1,t>96&&(t=96),t<1&&(t=0)}let n=0;e.volume>=0&&(n=16+Math.floor(4*e.volume));let s=0,a=0;if(e.effects.length>0){const t=e.effects[0];s={0:0,1:1,2:2,3:3,4:4,7:7,8:8,9:9,10:10,11:11,12:12,13:13,15:15,16:16,225:225,226:226,233:233,234:234,235:235,236:236,237:237}[t.code]??0,a=255&t.value}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:n,effectType:s,effectParam:a}}const tF=Object.freeze(Object.defineProperty({__proto__:null,getSupportedExtensions:QI,isSupportedModule:ZI,loadModuleFile:KI,previewModule:$I,stopPreview:YI},Symbol.toStringTag,{value:"Module"})),nF=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113];function sF(e){if(0===e)return 0;let t=0,n=1/0;for(let s=0;s<nF.length;s++){const a=Math.abs(nF[s]-e);a<n&&(n=a,t=s)}return t+1}function aF(e){return 0===e?0:e+12}function oF(e,t=8287,n=0,s=0){const a=e.length,o=2*a,r=44+o,i=new ArrayBuffer(r),l=new DataView(i);rF(l,0,"RIFF"),l.setUint32(4,r-8,!0),rF(l,8,"WAVE"),rF(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,1,!0),l.setUint32(24,t,!0),l.setUint32(28,2*t,!0),l.setUint16(32,2,!0),l.setUint16(34,16,!0),rF(l,36,"data"),l.setUint32(40,o,!0);let c=44;for(let u=0;u<a;u++){const t=e[u]<128?e[u]:e[u]-256;l.setInt16(c,256*t,!0),c+=2}return i}function rF(e,t,n){for(let s=0;s<n.length;s++)e.setUint8(t+s,n.charCodeAt(s))}function iF(e,t,n,s,a,o,r){const i=r>o&&r>2,l=oF(n,a,o,r),c=new Uint8Array(l);let u="";for(let m=0;m<c.length;m+=8192)u+=String.fromCharCode(...Array.from(c.subarray(m,Math.min(m+8192,c.length))));const d=`data:audio/wav;base64,${btoa(u)}`;return{id:e,name:t.replace(/\0/g,"").trim()||`Sample ${e}`,type:"sample",synthType:"Sampler",effects:[],volume:s>0?20*Math.log10(s/64):-60,pan:0,sample:{audioBuffer:l,url:d,baseNote:"C3",detune:0,loop:i,loopType:i?"forward":"off",loopStart:o,loopEnd:r>0?r:n.length,sampleRate:a,reverse:!1,playbackRate:1},metadata:{modPlayback:{usePeriodPlayback:!0,periodMultiplier:3546895,finetune:0,defaultVolume:s}}}}const lF=Object.freeze(Object.defineProperty({__proto__:null,amigaNoteToXM:aF,createSamplerInstrument:iF,pcm8ToWAV:oF,periodToNoteIndex:sF},Symbol.toStringTag,{value:"Module"})),cF=new Set(["aps","ast","adpcm","amc","abk","hot","aam","alp","bye","aon","aon4","aon8","ash","adsc","mod_adsc4","bss","bd","bds","uds","kris","cin","core","cus","cust","custom","cm","rk","rkb","dz","mkiio","dl","dl_deli","dln","dh","dw","dwold","dlm1","dlm2","dm","dm1","dm2","dsr","dsc","dss","dns","ems","emsv6","ex","fc","fc13","fc14","sfc","bfc","bsi","fc-bsi","fc2","fc3","fc4","smod","fred","gray","fp","fw","glue","gm","gmc","ea","mg","hd","hip","hip7","hipc","hst","mcmd","mcmd_org","soc","sog","s7g","emod","qc","ims","dum","is","is20","jam","jc","jmf","js","jcb","jcbo","jb","jpn","jpnd","jp","jt","mon_old","jo","kim","kh","powt","pt","lme","mon","mfp","hn","mtp2","thn","arp","mc","mcr","mco","mk2","mkii","avp","mw","max","md","mosh","mmdc","dmu","dmu2","mug","mug2","ma","mm4","mm8","sdata","mms","sfx20","npp","ntp","two","octamed","one","dat","ps","snk","pat","pvp","pap","pn","prt","psa","ptm","mod3","puma","rj","rjp","riff","rh","rho","scumm","s-c","scn","scr","sid","sid1","sid2","smn","mok","sa","sa-p","sa_old","sonic","lion","smus","snx","tiny","spl","sc","sct","psf","sfx","sfx13","tw","sm","sm1","sm2","sm3","smpro","bp","bp3","sndmon","sjs","jd","doda","sas","ss","sb","jpo","jpold","sun","syn","sdr","osp","st","synmod","tcb","tfmx","mdat","tfmxpro","tfmx1.5","tfmx7v","tfhd1.5","tfhd7v","tfhdpro","thm","tmk","tf","tits","tme","sg","dp","trc","tro","tronic","mus","ufo","vss","wb","ym","ymst","ml","agi","tpu","qpa","qts","sqt","sng","symmod","dbm","ams","ftm","gt2","gtk","dsym","cba","act","fmt","c67","667","mod_doc","mod15","mod15_mst","mod_ntk","mod_ntk1","mod_ntk2","mod_ntkamp","mod_flt4","mod_comp","mod15_ust","mod15_st-iv","ac1","ac1d","aval","chan","cp","cplx","crb","di","eu","fc-m","fcm","ft","fuz","fuzz","gv","hmc","hrt","ice","it1","kef","kef7","krs","ksm","lax","mexxmp","mpro","np","np1","np2","np3","nr","nru","ntpk","p10","p21","p30","p40a","p40b","p41a","p4x","p50a","p5a","p5x","p60","p60a","p61","p61a","p6x","pha","pin","pm","pm0","pm01","pm1","pm10c","pm18a","pm2","pm20","pm4","pm40","pmz","polk","pp10","pp20","pp21","pp30","ppk","pr1","pr2","prom","pru","pru1","pru2","prun","prun1","prun2","pwr","pyg","pygm","pygmy","skt","skyt","snt","st2","st26","st30","star","stpk","tp","tp1","tp2","tp3","un2","unic","unic2","wn","xan","xann","zen"]);function uF(e){const t=e.split(".").pop()?.toLowerCase()??"";return cF.has(t)}function dF(e,t){if(e.byteLength<64)return null;const n=new Uint8Array(e),s=new DataView(e);if("cus"===t||"cust"===t||"custom"===t)return null;if("rjp"===t||"rj"===t)return null;if("jpn"===t||"jp"===t||"jpnd"===t)return null;if("dl"===t)return null;if("bd"===t)return null;if("wb"===t)return null;if("jb"===t||"jcb"===t||"jcbo"===t)return null;if("jt"===t||"mon_old"===t)return null;if("mc"===t||"mcr"===t||"mco"===t)return null;if("dln"===t||"dl_deli"===t)return null;if("dw"===t||"dwold"===t)return null;if("hip"===t||"hip7"===t)return null;if("rh"===t||"rho"===t)return null;if("mk2"===t||"mkii"===t||"mkiio"===t)return null;if("mxtx"===t)return null;if("hipc"===t||"soc"===t||"sog"===t||"s7g"===t||"hst"===t)return null;if("mon"===t)return null;if("glue"===t||"gm"===t)return null;if("kim"===t)return null;if("kh"===t)return null;if("fc"===t||"fc13"===t||"fc14"===t||"sfc"===t||"bfc"===t||"bsi"===t||"smod"===t||"fc2"===t||"fc3"===t||"fc4"===t)return null;if("fred"===t)return null;if("sm"===t||"sm2"===t||"sm3"===t||"sm4"===t||"sid2"===t)return null;if("dmu"===t||"dmu2"===t||"mug"===t||"mug2"===t)return null;if("powt"===t||"pt"===t)return null;if("is"===t||"is20"===t)return null;if("dm2"===t||"dm"===t){if("DM2!"===String.fromCharCode(n[0],n[1],n[2],n[3])){const e=58,t=32,s=31,a=[];for(let o=0;o<s;o++){const s=e+o*t+8;if(s+22>n.length)break;const r=mF(n,s,22);r&&a.push(r)}if(a.length>0)return a}}if("sa"===t||"sa-p"===t||"sa_old"===t||"sonic"===t||"lion"===t){if("SOAR"===String.fromCharCode(n[0],n[1],n[2],n[3])&&e.byteLength>=16){let e=16+12*s.getUint32(12,!1);for(;e+8<=n.length;){const t=String.fromCharCode(n[e],n[e+1],n[e+2],n[e+3]),a=s.getUint32(e+4,!1);if(e+=8,"OVTB"!==t){if("NTBL"!==t){if("INST"===t){const t=152,s=122,o=30,r=[];for(let i=0;i<a;i++){const a=e+i*t;if(a+t>n.length)break;let l="";for(let e=0;e<o;e++){const t=n[a+s+e];if(0===t)break;if(t<32||t>126){l="";break}l+=String.fromCharCode(t)}const c=l.trim();c&&r.push(c)}if(r.length>0)return r;break}break}e+=4*a}else e+=16*a}}}if("sfx"===t||"sfx13"===t){const e=30,t=22;let s=0,a=0;if(n.length>=64){"SONG"===String.fromCharCode(n[60],n[61],n[62],n[63])&&(s=15,a=80)}if(0===s&&n.length>=128){"SONG"===String.fromCharCode(n[124],n[125],n[126],n[127])&&(s=31,a=144)}if(s>0){const o=[];for(let r=0;r<s;r++){const s=a+r*e;if(s+t>n.length)break;const i=mF(n,s,t);i&&o.push(i)}if(o.length>0)return o}}if("jam"===t||"jc"===t){if("BeEp"===String.fromCharCode(n[0],n[1],n[2],n[3])&&n.length>=6){const e=s.getUint16(4,!1),t=40,a=6,o=31,r=[];for(let s=0;s<e;s++){const e=a+s*t;if(e+o>n.length)break;let i="";for(let t=0;t<o;t++){const s=n[e+t];if(0===s)break;if(s<32||s>126){i="";break}i+=String.fromCharCode(s)}const l=i.trim();l&&r.push(l)}if(r.length>0)return r}}if("tcb"===t&&n.length>=274){if("AN COO"===String.fromCharCode(n[0],n[1],n[2],n[3],n[4],n[5])){const e=[];for(let t=0;t<16;t++){const s=146+8*t;let a="";for(let e=0;e<8;e++){const t=n[s+e];if(0===t)break;if(t<32||t>126){a="";break}a+=String.fromCharCode(t)}const o=a.trim();o&&e.push(o)}if(e.length>0)return e}}if("emod"===t||"qc"===t){if("FORM"===String.fromCharCode(n[0],n[1],n[2],n[3])&&n.length>=48){const e=String.fromCharCode(n[8],n[9],n[10],n[11]),t=String.fromCharCode(n[12],n[13],n[14],n[15]);if("EMOD"===e&&"EMIC"===t){const e=20,t=n[e+43],s=e+44,a=34,o=4,r=20,i=[];for(let l=0;l<t;l++){const e=s+l*a+o;if(e+r>n.length)break;const t=mF(n,e,r);t&&i.push(t)}if(i.length>0)return i}}}if("abk"===t){if("AmBk"===String.fromCharCode(n[0],n[1],n[2],n[3])&&n.length>=32){const e=20,t=e+s.getUint32(e+0,!1);if(t+2>n.length);else{const e=s.getUint16(t,!1),a=t+2,o=32,r=16,i=16,l=[];for(let t=0;t<e;t++){const e=a+t*o+r;if(e+i>n.length)break;const s=mF(n,e,i);s&&l.push(s)}if(l.length>0)return l}}}if(("okt"===t||"okta"===t)&&n.length>=16){if("OKTASONG"===String.fromCharCode(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7])){let e=8;for(;e+8<=n.length;){const t=String.fromCharCode(n[e],n[e+1],n[e+2],n[e+3]),a=s.getUint32(e+4,!1);if(e+=8,"SAMP"===t){const t=Math.min(Math.floor(a/32),36),s=[];for(let a=0;a<t;a++){const t=e+32*a;if(t+20>n.length)break;const o=mF(n,t,20);o&&s.push(o)}if(s.length>0)return s;break}if(0===a||e+a>n.length)break;e+=a}}}const a=Math.min(8192,e.byteLength),o=22;let r=-1,i=0;for(let l=0;l+o<=a;l+=2){let e=0,t=l;for(;t+o<=a;){if(null===mF(n,t,o))break;e++,t+=o}if(e>i&&(i=e,r=l),i>=3)break}if(i>=2&&r>=0){const e=[];let t=r;for(let s=0;s<i&&s<32;s++){const s=mF(n,t,o);null!==s&&e.push(s),t+=o}return e.length>0?e:null}return null}function mF(e,t,n){let s="",a=!1;for(let o=0;o<n;o++){const n=e[t+o];if(0!==n){if(a)return null;if(n<32||n>126)return null;s+=String.fromCharCode(n)}else a=!0}return s.trim()||null}function pF(e,t,n){const s=String(e).padStart(2,"0"),a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];let o="";if(t>0){const e=3546895/t,n=Math.round(69+12*Math.log2(e/440));if(n>=0&&n<=127){const e=Math.floor(n/12)-1;o=` ${a[n%12]}-${e}`}}return`Sample ${s}${o}${n>0?" (loop)":""}`}function hF(e,t,n,s,a,o,r){const i=new Map;let l=2;for(const f of o)for(const e of f)e.samplePtr>0&&!i.has(e.samplePtr)&&i.set(e.samplePtr,l++);const c=[{id:1,name:e||"UADE Song",type:"synth",synthType:"UADESynth",effects:[],volume:-6,pan:0,uade:{type:"uade",filename:n,fileData:s,subsongCount:a.subsongCount,currentSubsong:0,metadata:{player:a.player,formatName:a.formatName||fF(t),minSubsong:a.minSubsong,maxSubsong:a.maxSubsong}}}];for(const[,f]of i)c.push({id:f,name:`Sample ${String(f-1).padStart(2,"0")}`,type:"synth",synthType:"Sampler",effects:[],volume:0,pan:0});const u=["Paula 1","Paula 2","Paula 3","Paula 4"],d=o.length,m=Math.max(1,Math.ceil(d/64)),p=[],h=[];for(let f=0;f<m;f++){const e=64*f,t=Math.min(e+64,d),s=u.map((n,s)=>({id:`channel-${s}`,name:n,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===s||3===s?-50:50,instrumentId:null,color:null,rows:Array.from({length:t-e},(t,n)=>{const a=e+n;if(a>=o.length)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const l=o[a][s];if(!l||l.period<=0)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const c=r(l.period),u=c>0?c-23:0;return{note:u>0&&u<=96?u:0,instrument:l.samplePtr>0?i.get(l.samplePtr)??0:0,volume:Math.min(80,16+l.volume),effTyp:0,eff:0,effTyp2:0,eff2:0}})}));p.push({id:`pattern-${f}`,name:0===f?"Song":`Pattern ${f}`,length:t-e,channels:s,importMetadata:{sourceFormat:"UADE",sourceFile:n,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:m,originalInstrumentCount:c.length}}),h.push(f)}return{name:e,format:"UADE",patterns:p,instruments:c,songPositions:h,songLength:m,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125}}function fF(e){return{hip:"Jochen Hippel",hip7:"Jochen Hippel 7V",sog:"Jochen Hippel Song",tfmx:"TFMX",mdat:"TFMX",tfx:"TFMX",fc:"Future Composer",sfc:"Future Composer",fred:"FRED Editor",sm:"SidMon",sm2:"SidMon 2",bd:"Ben Daglish",bd5:"Ben Daglish 5",bdm:"Ben Daglish MOD",dw:"David Whittaker",mc:"Mark Cooksey",jp:"Jason Page",rj:"Richard Joseph",dm:"Delta Music",dm2:"Delta Music 2",sa:"Sonic Arranger",abk:"AMOS AMBank",aon:"Art of Noise"}[e]??`Amiga ${e.toUpperCase()}`}const gF=Object.freeze(Object.defineProperty({__proto__:null,isUADEFormat:uF,parseUADEFile:async function(e,t,n="enhanced",s=0,a){const{UADEEngine:o}=await os(async()=>{const{UADEEngine:e}=await Promise.resolve().then(()=>Si);return{UADEEngine:e}},void 0),{periodToNoteIndex:r}=await os(async()=>{const{periodToNoteIndex:e}=await Promise.resolve().then(()=>pw);return{periodToNoteIndex:e}},void 0),i=t.replace(/\.[^/.]+$/,""),l=t.split(".").pop()?.toLowerCase()??"",c=o.getInstance();await c.ready();const u=a??await c.load(e,t),d=u.scanData??[];if("enhanced"===n){const n={ProTracker:async()=>{const{parseMODFile:n}=await os(async()=>{const{parseMODFile:e}=await Promise.resolve().then(()=>iL);return{parseMODFile:e}},void 0);return n(e,t)},Noisetracker:async()=>{const{parseMODFile:n}=await os(async()=>{const{parseMODFile:e}=await Promise.resolve().then(()=>iL);return{parseMODFile:e}},void 0);return n(e,t)},Soundtracker:async()=>{const{parseMODFile:n}=await os(async()=>{const{parseMODFile:e}=await Promise.resolve().then(()=>iL);return{parseMODFile:e}},void 0);return n(e,t)},Oktalyzer:async()=>{const{parseOktalyzerFile:n}=await os(async()=>{const{parseOktalyzerFile:e}=await import("./OktalyzerParser-CvdIxak4.js");return{parseOktalyzerFile:e}},__vite__mapDeps([11,1,2,3,4]));return n(e,t)},MED:async()=>{const{parseMEDFile:n}=await os(async()=>{const{parseMEDFile:e}=await import("./MEDParser-Cvlqop0f.js");return{parseMEDFile:e}},__vite__mapDeps([12,1,2,3,4]));return n(e,t)},SoundFX:async()=>{const{parseSoundFXFile:n}=await os(async()=>{const{parseSoundFXFile:e}=await import("./SoundFXParser-CqtV9caO.js");return{parseSoundFXFile:e}},__vite__mapDeps([13,1,2,3,4]));return n(e,t)},SoundMon:async()=>{const{parseSoundMonFile:n}=await os(async()=>{const{parseSoundMonFile:e}=await import("./SoundMonParser-10KzVYhW.js");return{parseSoundMonFile:e}},__vite__mapDeps([14,1,2,3,4]));return n(e,t)},JamCracker:async()=>{const{parseJamCrackerFile:n}=await os(async()=>{const{parseJamCrackerFile:e}=await import("./JamCrackerParser-Dj4gIqAE.js");return{parseJamCrackerFile:e}},__vite__mapDeps([15,1,2,3,4]));return n(e,t)},"Quadra Composer":async()=>{const{parseQuadraComposerFile:n}=await os(async()=>{const{parseQuadraComposerFile:e}=await import("./QuadraComposerParser-CEl0y8K6.js");return{parseQuadraComposerFile:e}},__vite__mapDeps([16,1,2,3,4]));return n(e,t)}}[u.formatName];if(n)try{const e=await n();if(e)return e}catch(f){}}let m=d,p=u.enhancedScan;if(s>0&&"enhanced"===n)try{const e=await c.scanSubsong(s);m=e.scanResult.rows,p=e.scanResult}catch(f){}const h=s>0?`${i} (${s+1})`:i;if("enhanced"===n&&new Set(["fc3","sfc","bfc","bsi","bp","bp3","sm","sm2","sm3","sm4","fred","sid","sid2","dmu","dmu2","mug","mug2"]).has(l)){const n=hF(h,l,t,e,u,m,r),s=["Ch0 (L)","Ch1 (R)","Ch2 (R)","Ch3 (L)"],a=2e3;try{const e=await Promise.allSettled([c.isolateChannel(0,a),c.isolateChannel(1,a),c.isolateChannel(2,a),c.isolateChannel(3,a)]);let t=Math.max(...n.instruments.map(e=>e.id),0)+1;for(let a=0;a<4;a++){const o=e[a];if("fulfilled"!==o.status)continue;const{pcm:r,sampleRate:i,framesWritten:c}=o.value;if(!c)continue;const u=new Float32Array(r,0,c),d=new Uint8Array(c);for(let e=0;e<c;e++){const t=Math.round(127*Math.max(-1,Math.min(1,u[e])));d[e]=t<0?t+256:t}n.instruments.push(iF(t++,`${l.toUpperCase()} ${s[a]}`,d,64,i,0,0))}}catch(f){}return n}if("enhanced"===n&&"fc"===l){const n=new Uint8Array(e,0,4),s=String.fromCharCode(n[0],n[1],n[2],n[3]);if("FC13"===s||"FC14"===s||"SMOD"===s)return hF(h,l,t,e,u,m,r)}if("enhanced"===n&&p){const n=await async function(e){const t=new Set(["M.K.","M!K!","M&K!","FLT4","FLT8","4CHN","6CHN","8CHN","2CHN","3CHN","5CHN","7CHN","9CHN","10CH","11CH","12CH","13CH","14CH","15CH","16CH","18CH","20CH","22CH","24CH","26CH","28CH","30CH","32CH"]);try{const n=await e.readStringFromMemory(1080,5);if(!t.has(n))return null;const s=Array.from({length:31},(t,n)=>e.readStringFromMemory(20+30*n,23)),a=(await Promise.all(s)).map(e=>e.trim());return a.some(Boolean)?a:null}catch{return null}}(c),s=function(e,t,n,s,a,o,r,i){const l=a.enhancedScan,c=i??dF(s,t),u=new Map,d=[];let m=1;for(const E of Object.keys(l.samples)){const e=Number(E),t=l.samples[e];if(!t||!t.pcm||t.length<=4)continue;const n=m++;u.set(e,n);const s=t.typicalPeriod>0?Math.round(3546895/t.typicalPeriod):8287,a=Math.max(8e3,Math.min(96e3,s)),o=t.pcm instanceof Uint8Array?t.pcm:new Uint8Array(t.pcm),r=t.loopLength>0?t.loopStart+t.loopLength:0,i=r>0?Math.min(r,o.length):0,p=c?.[n-1],h=iF(n,p||pF(n,t.typicalPeriod,t.loopLength),o,64,a,t.loopStart,i);h.sample&&(h.sample.uadeSamplePtr=e),d.push(h)}const p=new Map;for(const E of Object.keys(l.samples)){const e=Number(E),t=l.samples[e];t?.loopStart>0&&p.set(e+t.loopStart,e)}const h=m++,f={type:"uade",filename:n,fileData:s,subsongCount:a.subsongCount,currentSubsong:0,metadata:{player:a.player,formatName:a.formatName||fF(t),minSubsong:a.minSubsong,maxSubsong:a.maxSubsong}};d.push({id:h,name:"UADE Reference",type:"synth",synthType:"UADESynth",effects:[],volume:-60,pan:0,uade:f});const g=64,b=["Paula 1","Paula 2","Paula 3","Paula 4"],v=o.length,y=Math.max(1,Math.ceil(v/g)),x=[],N=[],w=[-1,-1,-1,-1];for(let E=0;E<y;E++){const e=E*g,t=Math.min(e+g,v),s=b.map((n,s)=>({id:`channel-${s}`,name:n,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===s||3===s?-50:50,instrumentId:null,color:null,rows:Array.from({length:t-e},(t,n)=>{const a=e+n;if(a>=o.length)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const i=o[a][s];if(!i||i.period<=0){const e=i?.effTyp??0,t=i?.eff??0;return e>0||t>0?{note:0,instrument:0,volume:0,effTyp:e,eff:t,effTyp2:0,eff2:0}:{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}}const l=r(i.period),c=l>0?l-23:0,d=c>0&&c<=96?c:0,m=i.samplePtr,h=m>0&&!u.has(m)?p.get(m)??m:m,f=h>0?u.get(h)??0:0,g=Math.min(80,16+i.volume),b=g!==w[s]?g:0;w[s]=g;const v=i?.effTyp??0,y=i?.eff??0;return{note:d,period:i.period>0?i.period:void 0,instrument:f,volume:b,effTyp:v,eff:y,effTyp2:0,eff2:0}})})),a=l.tempoChanges||[];for(const n of a)if(n.row>=e&&n.row<t){const t=n.row-e,a=s[0].rows[t];0===a.effTyp&&0===a.eff&&n.bpm!==l.bpm&&(a.effTyp=15,a.eff=n.bpm>=32?n.bpm:n.speed)}x.push({id:`pattern-${E}`,name:0===E?"Song":`Pattern ${E}`,length:t-e,channels:s,importMetadata:{sourceFormat:"MOD",sourceFile:n,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:y,originalInstrumentCount:d.length}}),N.push(E)}return{name:e,format:"MOD",patterns:x,instruments:d,songPositions:N,songLength:y,restartPosition:0,numChannels:4,initialSpeed:l.speed||6,initialBPM:l.bpm||125}}(h,l,t,e,{...u,enhancedScan:p},m,r,n);if(s.instruments.some(e=>"Sampler"===e.synthType&&e.sample?.audioBuffer)){const e=p?.warnings??[];return e.length>0&&(s.name=`${s.name} [${e.join("; ")}]`),s}}return hF(h,l,t,e,u,m,r)},tryExtractInstrumentNames:dF},Symbol.toStringTag,{value:"Module"})),bF={channels:-1,patterns:-1,orders:-1,instruments:-1,samples:-1};function vF(e,t){return e[t]<<8|e[t+1]}function yF(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function xF(e,t,n){let s="";for(let a=0;a<n&&t+a<e.length;a++)s+=String.fromCharCode(e[t+a]);return s}function NF(e,t){const n=new Uint8Array(t);switch(e){case"fc":return function(e){if(e.length<100)return bF;const t=xF(e,0,4);if("FC13"!==t&&"FC14"!==t&&"SMOD"!==t)return bF;const n=yF(e,4),s=yF(e,12),a=yF(e,28),o=Math.floor(n/13),r=Math.floor(s/64),i=Math.floor(a/64);let l=0;for(let c=0;c<10;c++)vF(e,40+6*c)>0&&l++;return{channels:4,patterns:r,orders:o,instruments:i,samples:l}}(n);case"hvl":return function(e){if(e.length<14)return bF;const t=xF(e,0,3),n=(15&e[6])<<8|e[7],s=e[11],a=e[12];if("THX"===t)return{channels:4,patterns:s,orders:n,instruments:a,samples:-1};if("HVL"===t)return{channels:4+(e[8]>>2),patterns:s,orders:n,instruments:a,samples:-1};return bF}(n);case"okt":return function(e){if(e.length<16)return bF;if("FORM"!==xF(e,0,4)||"OKTA"!==xF(e,8,4))return bF;let t=12,n=-1,s=-1,a=-1;for(;t+8<=e.length;){const o=xF(e,t,4),r=yF(e,t+4),i=t+8;if(t+=8+r+(1&r),"SLEN"===o?n=vF(e,i):"PLEN"===o?s=vF(e,i):"SAMP"===o&&(a=Math.floor(r/32)),-1!==n&&-1!==s&&-1!==a)break}return{channels:8,patterns:s,orders:n,instruments:a,samples:a}}(n);case"med":return function(e){if(e.length<16)return bF;const t=xF(e,0,4);if("MMD0"!==t&&"MMD1"!==t&&"MMD2"!==t&&"MMD3"!==t)return bF;const n=yF(e,8)+504;if(n+268>e.length)return bF;const s=vF(e,n),a=vF(e,n+2),o=e[n+267];let r="MMD0"===t?4:-1;if("MMD0"!==t){const t=yF(e,16);if(t>0&&t+4<=e.length){const n=yF(e,t);n>0&&n+2<=e.length&&(r=Math.max(1,Math.min(64,vF(e,n))))}}return{channels:r,patterns:s,orders:a,instruments:o,samples:o}}(n);case"digi":return function(e){if(e.length<8)return bF;const t=xF(e,0,4);if("DBM0"!==t&&"DBMX"!==t)return bF;let n="DBM0"===t?12:4,s=-1,a=-1,o=-1,r=-1,i=-1;for(;n+8<e.length;){const l=xF(e,n,4),c=n+8;if(n+=8+yF(e,n+4),"INFO"===l?"DBM0"===t?(r=vF(e,c),i=vF(e,c+2),a=vF(e,c+6),s=vF(e,c+8)):(s=vF(e,c),a=vF(e,c+2),r=vF(e,c+4),i=vF(e,c+6)):"SONG"===l&&-1===o&&c+46<=e.length&&(o=vF(e,c+44)),-1!==s&&-1!==a&&-1!==o&&-1!==r&&-1!==i)break}return{channels:s,patterns:a,orders:o,instruments:r,samples:i}}(n);case"soundmon":return function(e){if(e.length<32)return bF;const t=xF(e,26,4),n=t.substring(0,3);if("BPSM"!==t&&"V.2"!==n&&"V.3"!==n)return bF;const s=vF(e,30),a=512;if(e.length<a)return{channels:4,patterns:-1,orders:s,instruments:15,samples:-1};let o=0;for(let c=0;c<15;c++){const t=32+32*c;255!==e[t]&&vF(e,t+24)>0&&o++}const r=4*s,i=a+4*r;let l=0;for(let c=0;c<r&&a+4*c+1<e.length&&a+4*c<i;c++){const t=vF(e,a+4*c);t>l&&(l=t)}return{channels:4,patterns:l>0?l:-1,orders:s,instruments:15,samples:o}}(n);case"sidmon2":return function(e){if(e.length<90)return bF;if("SIDMON II - THE MIDI VERSION"!==xF(e,58,28))return bF;const t=e[2],n=vF(e,4)>>6,s=yF(e,26)>>5,a=yF(e,14);let o=0;const r=Math.min(90+a,e.length);for(let i=90;i<r;i++)e[i]>o&&(o=e[i]);return{channels:4,patterns:r>90?o+1:-1,orders:t,instruments:s,samples:n}}(n);case"fred":return function(e){const t={channels:4,patterns:-1,orders:-1,instruments:-1,samples:-1};if(e.length<1024)return t;for(let h=0;h<16;h+=4)if(20218!=(e[h]<<8|e[h+1]))return t;let n=0,s=0,a=16;for(;a<1024&&a+6<=e.length;){const t=e[a]<<8|e[a+1];if(4666===t&&a+5<e.length){const t=e[a+2]<<8|e[a+3];45057==(e[a+4]<<8|e[a+5])&&(n=a+2+t-2197)}else if(8522===t&&a+7<e.length&&18426==(e[a+4]<<8|e[a+5])){const t=e[a+6]<<8|e[a+7];s=a+6+(t>=32768?t-65536:t);break}a+=2}if(0===s)return t;const o=n+2210;if(o+8>e.length)return t;const r=yF(e,o),i=yF(e,o+4);let l=s+r,c=0;for(;l+64<=e.length;){const t=yF(e,l);if(0===t||t>=e.length||t<l)break;c++,l+=64}const u=n+2830,d=s+i-u;let m=-1,p=-1;if(u+8<=e.length&&d>0){const t=vF(e,u),n=vF(e,u+2),s=vF(e,u+4),a=vF(e,u+6),o=n-t>>1,r=s-n>>1,i=a-s>>1,l=d-a>>1,c=Math.max(o,r,i);c>0&&(m=c);const h=[t,n,s,a],f=[o,r,i,l],g=new Set;for(let d=0;d<4;d++)for(let t=0;t<f[d];t++){const n=u+h[d]+2*t;if(n+2>e.length)break;const s=vF(e,n);32768&s||g.add(s)}g.size>0&&(p=g.size)}return{channels:4,patterns:p,orders:m,instruments:c,samples:c}}(n);case"soundfx":return function(e){if(e.length<64)return bF;let t,n;if("SONG"===xF(e,60,4))t=0,n=16;else{if(e.length<128||"SO31"!==xF(e,124,4))return bF;t=544,n=32}const s=530+t;if(s>=e.length)return bF;const a=e[s];let o=-1;for(let l=0;l<a&&s+2+l<e.length;l++){const t=e[s+2+l];t>o&&(o=t)}const r=o>=0?o+1:-1;let i=0;for(let l=1;l<n;l++)yF(e,4*l)>0&&i++;return{channels:4,patterns:r,orders:a,instruments:n-1,samples:i}}(n);case"mugician":return function(e){if(e.length<80)return bF;const t=xF(e,0,24);if(" MUGICIAN/SOFTEYES 1990 "!==t&&" MUGICIAN2/SOFTEYES 1990"!==t)return bF;const n=yF(e,60),s=e[79],a=204+2*(yF(e,28)<<2);let o=-1;for(let r=204;r+1<e.length&&r<a;r+=2)e[r]>o&&(o=e[r]);return{channels:4,patterns:o>=0?o+1:-1,orders:s,instruments:n,samples:n}}(n);case"musicLine":return function(e){if(e.length<12)return bF;if("MLEDMODL"!==xF(e,0,8))return bF;let t=12+yF(e,8),n=-1,s=0,a=0,o=0;for(;t+8<=e.length;){const r=xF(e,t,4),i=yF(e,t+4),l=t+8;if("TUNE"===r){if(l+40<=e.length){const t=e[l+39];n=t>=1&&t<=8?t:-1}if(0===i||l+i>e.length)break;t=l+i}else if("PART"===r){if(s++,0===i||l+i>e.length)break;t=l+i}else if("ARPG"===r||"VERS"===r){if(0===i||l+i>e.length)break;t=l+i}else if("INST"===r){if(a++,0===i||l+i>e.length)break;t=l+i}else{if("SMPL"!==r)break;if(o++,0===i||l+i>e.length)break;t=l+i}}return{channels:n,patterns:s>0?s:-1,orders:-1,instruments:a>0?a:-1,samples:o>0?o:-1}}(n);case"tfmx":return function(e){const t=Math.min(2944,e.length-5);let n=-1;for(let s=0;s<t;s++)if(84===e[s]&&70===e[s+1]&&77===e[s+2]&&88===e[s+3]&&0===e[s+4]){n=s;break}return n<0||n+20+2>e.length?bF:{channels:4,patterns:vF(e,n+8)+1,orders:vF(e,n+10)+1,instruments:vF(e,n+6)+1,samples:vF(e,n+18)}}(n);default:return{...bF}}}const wF=[{key:"hvl",regex:/\.(hvl|ahx)$/i,label:"HivelyTracker",description:"HivelyTracker/AHX  native parser or UADE."},{key:"okt",regex:/\.okt$/i,label:"Oktalyzer",description:"Oktalyzer 8-channel  native parser or UADE."},{key:"med",regex:/\.(med|mmd[0-3])$/i,label:"OctaMED",description:"OctaMED/MED  native parser or UADE."},{key:"digi",regex:/\.digi$/i,label:"DigiBooster",description:"DigiBooster (v1)  native parser or UADE."},{key:"fc",regex:/\.(fc|fc2|fc3|fc4|fc13|fc14|sfc|smod|bfc|bsi)$/i,label:"Future Composer",description:"Handles FC 1.3/1.4. FC2 auto-falls back to UADE."},{key:"soundmon",regex:/\.(bp|bp3|sndmon)$/i,label:"SoundMon",description:"Brian Postma's SoundMon V1/V2/V3."},{key:"sidmon2",regex:/\.(sid2|smn)$/i,label:"SidMon II",description:"SidMon II  native parser or UADE."},{key:"fred",regex:/\.fred$/i,label:"Fred Editor",description:"Fred Editor by Software of Sweden."},{key:"soundfx",regex:/\.(sfx|sfx2|sfx13)$/i,label:"Sound-FX",description:"Sound-FX v1.0 and v2.0."},{key:"mugician",regex:/\.(dmu|dmu2|mug|mug2)$/i,label:"Digital Mugician",description:"Digital Mugician V1/V2 by Rob Hubbard."},{key:"tfmx",regex:/\.(tfmx|mdat|tfx)$/i,label:"TFMX",description:"Jochen Hippel TFMX  native parser or UADE."},{key:"hippelCoso",regex:/\.(hipc|soc|coso)$/i,label:"Hippel-CoSo",description:"Jochen Hippel CoSo  native parser or UADE."},{key:"robHubbard",regex:/^rh\.[^.]+$/i,label:"Rob Hubbard",description:"Rob Hubbard Amiga prefix format (rh.*)  native parser or UADE."},{key:"davidWhittaker",regex:/\.(dw|dwold)$/i,label:"David Whittaker",description:"David Whittaker format  native parser or UADE."},{key:"benDaglish",regex:/^bd\.[^.]+$/i,label:"Ben Daglish",description:"Ben Daglish format  native parser or UADE."},{key:"jeroenTel",regex:/^(jt|mon_old)\.[^.]+$/i,label:"Jeroen Tel",description:"Jeroen Tel format  native parser or UADE."},{key:"jasonPage",regex:/^(jpn|jpnd|jp)\.[^.]+$/i,label:"Jason Page",description:"Jason Page format  native parser or UADE."},{key:"steveTurner",regex:/^(jpo|jpold)\.[^.]+$/i,label:"Steve Turner",description:"Steve Turner/JasonPage Old  native parser or UADE."},{key:"ronKlaren",regex:/\.(rk|rkb)$/i,label:"Ron Klaren",description:"Ron Klaren format  native parser or UADE."},{key:"richardJoseph",regex:/\.(rj|rjp)$/i,label:"Richard Joseph",description:"Richard Joseph format  native parser or UADE."},{key:"infogrames",regex:/\.dum$/i,label:"Infogrames",description:"Infogrames/CPC  native parser or UADE."},{key:"sidmon1",regex:/\.sid1$/i,label:"SidMon 1",description:"SidMon 1.0  native parser or UADE."},{key:"deltaMusic2",regex:/\.dm2$/i,label:"Delta Music 2",description:"Delta Music 2.0  native parser or UADE."},{key:"deltaMusic1",regex:/\.(dm|dm1)$/i,label:"Delta Music",description:"Delta Music 1.x  native parser or UADE."},{key:"artOfNoise",regex:/\.(aon|aon8)$/i,label:"Art of Noise",description:"Art of Noise  native parser or UADE."},{key:"sonicArranger",regex:/\.(sa|sonic)$/i,label:"Sonic Arranger",description:"Sonic Arranger  native parser or UADE."},{key:"inStereo1",regex:/\.is10$/i,label:"InStereo! 1",description:"InStereo! 1.0  native parser or UADE."},{key:"inStereo2",regex:/\.is20$/i,label:"InStereo! 2",description:"InStereo! 2.0  native parser or UADE."},{key:"pumaTracker",regex:/\.puma$/i,label:"Puma Tracker",description:"Puma Tracker  native parser or UADE."},{key:"synthesis",regex:/\.syn$/i,label:"Synthesis",description:"Synthesis  native parser or UADE."},{key:"musicAssembler",regex:/\.ma$/i,label:"Music Assembler",description:"Music Assembler  native parser or UADE."},{key:"digitalSoundStudio",regex:/\.dss$/i,label:"Digital Sound Studio",description:"Digital Sound Studio  native parser or UADE."},{key:"digitalSymphony",regex:/\.dsym$/i,label:"Digital Symphony",description:"Digital Symphony  native parser or UADE."},{key:"daveLowe",regex:/\.(dl|dln|dl_deli)$/i,label:"Dave Lowe",description:"Dave Lowe format  native parser or UADE."},{key:"ams",regex:/\.ams$/i,label:"AMS / Velvet Studio",description:"AMS (Extreme's Tracker / Velvet Studio)  native parser or UADE."},{key:"fmTracker",regex:/\.fmt$/i,label:"FM Tracker",description:"Davey W Taylor FM Tracker  native parser or UADE."},{key:"graoumfTracker2",regex:/\.(gt2|gtk)$/i,label:"Graoumf Tracker 2",description:"Graoumf Tracker 2  native parser or UADE."},{key:"symphoniePro",regex:/\.symmod$/i,label:"Symphonie Pro",description:"Symphonie Pro  native parser or UADE."},{key:"composer667",regex:/\.(667|c67)$/i,label:"Composer 667",description:"CDFM/Composer 667  native parser or UADE."},{key:"chuckBiscuits",regex:/\.cba$/i,label:"Chuck Biscuits",description:"Chuck Biscuits Atari ST  native parser or UADE."},{key:"speedySystem",regex:/\.ss$/i,label:"Speedy System",description:"Speedy System A1  native parser or UADE."},{key:"tronic",regex:/\.(trc|dp|tro|tronic)$/i,label:"Tronic",description:"Tronic  native parser or UADE."},{key:"digiBoosterPro",regex:/\.dbm$/i,label:"DigiBooster Pro",description:"DigiBooster Pro  native parser or UADE."},{key:"gameMusicCreator",regex:/\.gmc$/i,label:"Game Music Creator",description:"Game Music Creator  native parser or UADE."},{key:"faceTheMusic",regex:/\.ftm$/i,label:"Face the Music",description:"Face the Music  native parser or UADE."},{key:"soundControl",regex:/\.(sc|sct)$/i,label:"Sound Control",description:"Sound Control  native parser or UADE."},{key:"soundFactory",regex:/\.psf$/i,label:"Sound Factory",description:"Sound Factory Pro  native parser or UADE."},{key:"actionamics",regex:/\.act$/i,label:"Actionamics",description:"Actionamics  native parser or UADE."},{key:"activisionPro",regex:/\.(avp|mw)$/i,label:"Activision Pro",description:"Activision Pro  native parser or UADE."},{key:"iffSmus",regex:/\.(smus|snx|tiny)$/i,label:"IFF SMUS",description:"IFF SMUS Sonix  native parser or UADE."},{key:"lme",regex:/\.lme$/i,label:"LME",description:"Leggless Music Editor  native parser or UADE."},{key:"musicLine",regex:/\.ml$/i,label:"MusicLine Editor",description:"MusicLine Editor  native WASM engine (no UADE fallback).",nativeOnly:!0},{key:"medley",regex:/\.ml$/i,label:"Medley",description:"Medley  native parser or UADE."},{key:"futurePlayer",regex:/\.fp$/i,label:"Future Player",description:"Future Player  native parser or UADE."},{key:"ufo",regex:/\.ufo$/i,label:"UFO",description:"UFO format  native parser or UADE."},{key:"tme",regex:/\.tme$/i,label:"TME",description:"The Musical Enlightenment  native parser or UADE."},{key:"markCooksey",regex:/^(mc|mcr|mco)\.[^.]+$/i,label:"Mark Cooksey",description:"Mark Cooksey format  native parser or UADE."},{key:"quartet",regex:/^(qpa|sqt|qts)\.[^.]+$/i,label:"Quartet",description:"Quartet (Atari ST)  native parser or UADE."},{key:"soundMaster",regex:/^(sm|sm1|sm2|sm3|smpro)\.[^.]+$/i,label:"Sound Master",description:"Sound Master  native parser or UADE."},{key:"zoundMonitor",regex:/^sng\.[^.]+$/i,label:"Zound Monitor",description:"Zound Monitor  native parser or UADE."},{key:"tcbTracker",regex:/^tcb\.[^.]+$/i,label:"TCB Tracker",description:"TCB Tracker (Atari ST)  native parser or UADE."},{key:"mmdc",regex:/^mmdc\.[^.]+$/i,label:"MMDC",description:"MMDC  native parser or UADE."},{key:"psa",regex:/^psa\.[^.]+$/i,label:"PSA",description:"Professional Sound Artists  native parser or UADE."},{key:"magneticFieldsPacker",regex:/^mfp\.[^.]+$/i,label:"MFP",description:"Magnetic Fields Packer  native parser or UADE."},{key:"maniacsOfNoise",regex:/^mon\.[^.]+$/i,label:"Maniacs of Noise",description:"Maniacs of Noise (mon.*)  native parser or UADE."},{key:"synthPack",regex:/^osp\.[^.]+$/i,label:"Synth Pack",description:"Synth Pack (osp.*)  native parser or UADE."},{key:"jasonBrooke",regex:/^(jcbo|jcb|jb)\.[^.]+$/i,label:"Jason Brooke",description:"Jason Brooke (jcbo/jcb/jb.*)  native parser or UADE."},{key:"laxity",regex:/^(powt|pt)\.[^.]+$/i,label:"Laxity",description:"Laxity (powt/pt.*)  native parser or UADE."},{key:"fredGray",regex:/^gray\.[^.]+$/i,label:"Fred Gray",description:"Fred Gray (gray.*)  native parser or UADE."},{key:"musicMaker4V",regex:/^(mm4|sdata)\.[^.]+$/i,label:"Music Maker 4V",description:"Music Maker 4-Voice (mm4/sdata.*)  native parser or UADE."},{key:"musicMaker8V",regex:/^mm8\.[^.]+$/i,label:"Music Maker 8V",description:"Music Maker 8-Voice (mm8.*)  native parser or UADE."},{key:"jochenHippelST",regex:/^(hst|mdst)\.[^.]+$/i,label:"Jochen Hippel ST",description:"Jochen Hippel Atari ST (hst/mdst.*)  native parser or UADE."},{key:"specialFX",regex:/^(jd|doda)\.[^.]+$/i,label:"Special FX",description:"Special FX (jd/doda.*)  native parser or UADE."},{key:"timeTracker",regex:/^tmk\.[^.]+$/i,label:"Time Tracker",description:"Time Tracker (tmk.*)  native parser or UADE."},{key:"kris",regex:/^kris\.[^.]+$/i,label:"KRIS",description:"KRIS format (kris.*)  native parser or UADE."},{key:"cinemaware",regex:/^cin\.[^.]+$/i,label:"Cinemaware",description:"Cinemaware (cin.*)  native parser or UADE."},{key:"novoTradePacker",regex:/^ntp\.[^.]+$/i,label:"Novo Trade Packer",description:"Novo Trade Packer (ntp.*)  native parser or UADE."},{key:"alcatrazPacker",regex:/^alp\.[^.]+$/i,label:"Alcatraz Packer",description:"Alcatraz Packer (alp.*)  native parser or UADE."},{key:"bladePacker",regex:/^uds\.[^.]+$/i,label:"Blade Packer",description:"Blade Packer (uds.*)  native parser or UADE."},{key:"tomyTracker",regex:/^sg\.[^.]+$/i,label:"Tomy Tracker",description:"Tomy Tracker (sg.*)  native parser or UADE."},{key:"fashionTracker",regex:/^ex\.[^.]+$/i,label:"Fashion Tracker",description:"Fashion Tracker (ex.*)  native parser or UADE."},{key:"multiMediaSound",regex:/^(mms|sfx20)\.[^.]+$/i,label:"Multi Media Sound",description:"Multi Media Sound (mms/sfx20.*)  native parser or UADE."},{key:"seanConran",regex:/^scr\.[^.]+$/i,label:"Sean Conran",description:"Sean Conran (scr.*)  native parser or UADE."},{key:"thomasHermann",regex:/^thm\.[^.]+$/i,label:"Thomas Hermann",description:"Thomas Hermann (thm.*)  native parser or UADE."},{key:"titanicsPacker",regex:/^tits\.[^.]+$/i,label:"Titanics Packer",description:"Titanics Packer (tits.*)  native parser or UADE."},{key:"krisHatlelid",regex:/^kh\.[^.]+$/i,label:"Kris Hatlelid",description:"Kris Hatlelid (kh.*)  native parser or UADE."},{key:"ntsp",regex:/^two\.[^.]+$/i,label:"NTSP",description:"NTSP (two.*)  native parser or UADE."},{key:"moshPacker",regex:/^mosh\.[^.]+$/i,label:"Mosh Packer",description:"Mosh Packer (mosh.*)  native parser or UADE."},{key:"coreDesign",regex:/^core\.[^.]+$/i,label:"Core Design",description:"Core Design (core.*)  native parser or UADE."},{key:"jankoMrsicFlogel",regex:/^jmf\.[^.]+$/i,label:"Janko Mrsic-Flogel",description:"Janko Mrsic-Flogel (jmf.*)  native parser or UADE."},{key:"soundPlayer",regex:/^sjs\.[^.]+$/i,label:"Sound Player",description:"Sound Player (sjs.*)  native parser or UADE."},{key:"nickPellingPacker",regex:/^npp\.[^.]+$/i,label:"Nick Pelling Packer",description:"Nick Pelling Packer (npp.*)  native parser or UADE."},{key:"peterVerswyvelenPacker",regex:/^pvp\.[^.]+$/i,label:"Peter Verswyvelen Packer",description:"Peter Verswyvelen Packer (pvp.*)  native parser or UADE."},{key:"wallyBeben",regex:/^wb\.[^.]+$/i,label:"Wally Beben",description:"Wally Beben (wb.*)  native parser or UADE."},{key:"steveBarrett",regex:/^sb\.[^.]+$/i,label:"Steve Barrett",description:"Steve Barrett (sb.*)  native parser or UADE."},{key:"paulSummers",regex:/^snk\.[^.]+$/i,label:"Paul Summers",description:"Paul Summers (snk.*)  native parser or UADE."},{key:"desire",regex:/^dsr\.[^.]+$/i,label:"Desire",description:"Desire (dsr.*)  native parser or UADE."},{key:"martinWalker",regex:/^(avp|mw)\.[^.]+$/i,label:"Martin Walker",description:"Martin Walker prefix form (avp/mw.*)  native parser or UADE."},{key:"paulShields",regex:/^ps\.[^.]+$/i,label:"Paul Shields",description:"Paul Shields (ps.*)  native parser or UADE."},{key:"paulRobotham",regex:/^dat\.[^.]+$/i,label:"Paul Robotham",description:"Paul Robotham (dat.*)  native parser or UADE."},{key:"pierreAdane",regex:/^pap\.[^.]+$/i,label:"Pierre Adane",description:"Pierre Adane Packer (pap.*)  native parser or UADE."},{key:"anders0land",regex:/^hot\.[^.]+$/i,label:"Anders land",description:"Anders land (hot.*)  native parser or UADE."},{key:"andrewParton",regex:/^bye\.[^.]+$/i,label:"Andrew Parton",description:"Andrew Parton (bye.*)  native parser or UADE."},{key:"customMade",regex:/^(cm|rk|rkb)\.[^.]+$/i,label:"Custom Made",description:"Custom Made prefix form (cm/rk/rkb.*)  native parser or UADE."},{key:"benDaglishSID",regex:/^bds\.[^.]+$/i,label:"Ben Daglish SID",description:"Ben Daglish SID (bds.*)  native parser or UADE."},{key:"digitalSonixChrome",regex:/^dsc\.[^.]+$/i,label:"Digital Sonix Chrome",description:"Digital Sonix Chrome (dsc.*)  native parser or UADE."},{key:"jesperOlsen",regex:/^jo\.[^.]+$/i,label:"Jesper Olsen",description:"Jesper Olsen (jo.*)  native parser or UADE."},{key:"kimChristensen",regex:/^kim\.[^.]+$/i,label:"Kim Christensen",description:"Kim Christensen (kim.*)  native parser or UADE."},{key:"ashleyHogg",regex:/^ash\.[^.]+$/i,label:"Ashley Hogg",description:"Ashley Hogg (ash.*)  native parser or UADE."},{key:"adpcmMono",regex:/^adpcm\.[^.]+$/i,label:"ADPCM Mono",description:"ADPCM Mono (adpcm.*)  native parser or UADE."},{key:"janneSalmijarvi",regex:/^js\.[^.]+$/i,label:"Janne Salmijrvi",description:"Janne Salmijrvi (js.*)  native parser or UADE."},{key:"jochenHippel7V",regex:/^(hip7|s7g)\.[^.]+$/i,label:"Jochen Hippel 7V",description:"Jochen Hippel 7-Voice (hip7/s7g.*)  native parser or UADE."},{key:"midiLoriciel",regex:/^midi\.[^.]+$/i,label:"MIDI Loriciel",description:"MIDI Loriciel Atari ST (midi.*)  native parser or UADE."},{key:"onEscapee",regex:/^one\.[^.]+$/i,label:"On Escapee",description:"On Escapee (one.*)  native parser or UADE."},{key:"paulTonge",regex:/^pat\.[^.]+$/i,label:"Paul Tonge",description:"Paul Tonge (pat.*)  native parser or UADE."},{key:"robHubbardST",regex:/^rho\.[^.]+$/i,label:"Rob Hubbard ST",description:"Rob Hubbard Atari ST (rho.*)  native parser or UADE."},{key:"karlMorton",regex:/\.mus$/i,label:"Karl Morton",description:"Karl Morton (.mus)  native parser or libopenmpt."},{key:"xmf",regex:/\.xmf$/i,label:"XMF",description:"XMF format (Astroidea/Imperium Galactica)  native parser or UADE."},{key:"uax",regex:/\.uax$/i,nativeOnly:!0,label:"UAX",description:"Unreal Audio Package (.uax)  native parser only (no UADE fallback)."},{key:"amosMusicBank",regex:/\.abk$/i,nativeOnly:!0,label:"AMOS Music Bank",description:"AMOS Music Bank  native parser (magic-detected), UADE fallback."},{key:"iceTracker",regex:/\.ice$/i,nativeOnly:!0,label:"ICE Tracker",description:"ICE Tracker / SoundTracker 2.6  native parser (magic-detected), UADE fallback."},{key:"imagesMusicSystem",regex:/\.ims$/i,label:"Images Music System",description:"Images Music System  native parser or UADE."},{key:"sawteeth",regex:/\.st$/i,label:"Sawteeth",description:"Sawteeth (SWTD magic)  native parser or UADE."},{key:"maximumEffect",regex:/\.(mxtx|max)$/i,label:"Maximum Effect / MaxTrax",description:"Maximum Effect (max.*) and MaxTrax (.mxtx)  native parser or UADE."},{key:"imagoOrpheus",regex:/\.imf$/i,label:"Imago Orpheus",description:"Imago Orpheus  native parser or libopenmpt."},{key:"cdfm67",regex:/\.c67$/i,label:"CDFM 670",description:"CDFM Composer 670  native parser or libopenmpt."},{key:"easyTrax",regex:/\.etx$/i,label:"EasyTrax",description:"EasyTrax (Edlund Tracker)  native parser or libopenmpt."},{key:"madTracker2",regex:/\.mt2$/i,label:"MadTracker 2",description:"MadTracker 2  native parser or libopenmpt."},{key:"psm",regex:/\.psm$/i,label:"PSM",description:"PSM (Epic MegaGames SAGA)  native parser or libopenmpt."},{key:"pt36",regex:/\.pt36$/i,label:"ProTracker 3.6",description:"ProTracker 3.6  native parser or libopenmpt."}],EF=/\.(fur|dmf)$/i,kF=/\.(vgm|vgz|ym|nsf|nsfe|sid1?|sap|ay)$/i;function DF(e){return wF.find(t=>t.regex.test(e))??null}const SF=({isOpen:e,onClose:t,onImport:n,initialFile:s})=>{const[a,o]=l.useState(null),[r,i]=l.useState(""),[c,u]=l.useState(!1),[d,m]=l.useState(null),[p,h]=l.useState(!1),[f,g]=l.useState(!0),[b,v]=l.useState(null),[y,x]=l.useState(0),N=l.useRef(!1),w=l.useRef(null),E=Ck(e=>e.formatEngine),k=Ck(e=>e.setFormatEngine),D=DF(r),S=kF.test(r),M=!D&&!S&&uF(r),C=!!D?.nativeOnly,V=!!D&&(C||"uade"!==E[D.key]),P=E.uade??"enhanced";l.useEffect(()=>{D&&C&&"uade"===E[D.key]&&k(D.key,"native")},[D,C,E,k]);const _=l.useCallback(async e=>{if(!ZI(e.name))return void m(`Unsupported file format. Supported: ${[".mid",".midi",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".j2b",".m15",".mdl",".mt2",".mtm",".psm",".pt36",".ptm",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".hvl",".ahx",".okt",".med",".mmd0",".mmd1",".mmd2",".mmd3",".digi",".fc",".fc13",".fc14",".sfc",".fc2",".fc3",".fc4",".smod",".hip",".hip7",".sog",".s7g",".hipc",".hst",".soc",".coso",".tfmx",".mdat",".tfmxpro",".tfmx1.5",".tfmx7v",".tfhd1.5",".tfhd7v",".tfhdpro",".fred",".gray",".sm",".sm1",".sm2",".sm3",".smpro",".bd",".bds",".dw",".dwold",".mc",".mcr",".mco",".jp",".jpn",".jpnd",".rj",".rjp",".dm",".dm1",".dm2",".dlm1",".dlm2",".sa",".sa-p",".sa_old",".sonic",".lion",".abk",".aam",".aon",".aon4",".aon8",".adpcm",".adsc",".mod_adsc4",".bss",".bfc",".bsi",".core",".cin",".dl",".dl_deli",".dln",".ea",".mg",".fp",".fw",".gmc",".gm",".glue",".hd",".ims",".jam",".jc",".kris",".kh",".lme",".ma",".max",".mdst",".mkii",".mk2",".mkiio",".ntp",".osp",".ps",".psf",".pt",".ptm",".puma",".rh",".rhp",".rho",".riff",".sas",".sb",".scr",".sdr",".sg",".snk",".ss",".st26",".sun",".syn",".dh",".uds",".octamed",".tpu",".tcb",".ufo",".mus",".wn",".wb",".ym",".ymst",".sid",".sid1",".sid2",".smn",".bp",".bp3",".sndmon",".sfx",".sfx13",".sfx20",".mms",".smus",".snx",".agi",".vss",".ml",".sng",".qpa",".qts",".sqt",".ash",".aps",".ast",".alp",".amc",".dsc",".dsr",".dss",".dns",".dmu",".dmu2",".ems",".emsv6",".emod",".jmf",".jo",".js",".jb",".jcb",".jcbo",".jd",".jt",".kim",".mon",".mon_old",".mfp",".mosh",".mmdc",".mug",".mug2",".mm4",".mm8",".psa",".prt",".pn",".pap",".pvp",".pat",".sc",".sct",".scn",".scumm",".sjs",".spl",".syn",".synmod",".tf",".thm",".tmk",".tme",".dp",".trc",".tro",".tronic",".dat",".dum",".doda",".dz",".ex",".cm",".cus",".cust",".custom",".hot",".bye",".one",".two",".avp",".mw",".md",".mok",".tiny",".sdata",".npp",".is",".is20",".jpo",".jpold",".powt",".hn",".mtp2",".thn",".arp",".tits",".mcmd",".mcmd_org",".ac1",".ac1d",".aval",".chan",".cp",".cplx",".crb",".di",".eu",".fc-m",".fcm",".ft",".fuz",".fuzz",".gv",".hmc",".hrt",".ice",".it1",".kef",".kef7",".krs",".ksm",".lax",".mexxmp",".mpro",".np",".np1",".np2",".np3",".nr",".nru",".ntpk",".p10",".p21",".p30",".p40a",".p40b",".p41a",".p4x",".p50a",".p5a",".p5x",".p60",".p60a",".p61",".p61a",".p6x",".pha",".pin",".pm",".pm0",".pm01",".pm1",".pm10c",".pm18a",".pm2",".pm20",".pm4",".pm40",".pmz",".polk",".pp10",".pp20",".pp21",".pp30",".ppk",".pr1",".pr2",".prom",".pru",".pru1",".pru2",".prun",".prun1",".prun2",".pwr",".pyg",".pygm",".pygmy",".skt",".skyt",".snt",".st",".st2",".st30",".star",".stpk",".tp",".tp1",".tp2",".tp3",".un2",".unic",".unic2",".wn",".xan",".xann",".zen",".mod_doc",".mod15",".mod15_mst",".mod_ntk",".mod_ntk1",".mod_ntk2",".mod_ntkamp",".mod_flt4",".mod_comp",".mod15_ust",".mod15_st-iv",".mod3",".gt2",".gtk",".dsym",".cba",".act",".c67",".667",".fmt",".dtm",".etx",".is10",".plm",".qc",".rk",".rkb",".rtm",".tfx",".uax",".xmf",".mxtx",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".vgm",".vgz",".nsf",".nsfe",".sap",".ay"].slice(0,5).join(", ")}...`);const t=e.name.toLowerCase(),n=DF(t),s=EF.test(t),a=kF.test(t),r=!n&&!s&&!a&&uF(t);if(u(!0),m(null),o(null),v(null),x(0),i(t),r)try{const t=await e.arrayBuffer(),{UADEEngine:n}=await os(async()=>{const{UADEEngine:e}=await Promise.resolve().then(()=>Si);return{UADEEngine:e}},void 0),s=n.getInstance();await s.ready(),N.current=!0;const a=await s.load(t,e.name);v(a),o({metadata:{title:e.name.replace(/\.[^/.]+$/,""),type:a.formatName||"UADE",channels:4,patterns:1,orders:a.subsongCount,instruments:0,samples:0,duration:0},arrayBuffer:t,file:e})}catch(l){l instanceof Error&&"Scan cancelled"===l.message||m(l instanceof Error?l.message:"Failed to load UADE format")}finally{N.current=!1,u(!1)}else if(n||s)try{const t=await e.arrayBuffer(),a=n?NF(n.key,t):{channels:-1,patterns:-1,orders:-1,instruments:-1,samples:-1};o({metadata:{title:e.name.replace(/\.[^/.]+$/,""),type:s?"Furnace":n.label,channels:a.channels,patterns:a.patterns,orders:a.orders,instruments:a.instruments,samples:a.samples,duration:0},arrayBuffer:t,file:e})}catch(l){m(l instanceof Error?l.message:"Failed to read file")}finally{u(!1)}else try{const t=await KI(e);o(t)}catch(l){m(l instanceof Error?l.message:"Failed to load module")}finally{u(!1)}},[]);l.useEffect(()=>{s&&e&&_(s)},[s,e,_]);const O=new Set(["okt","med","digiBoosterPro","ams","faceTheMusic","imagoOrpheus","madTracker2","psm","pt36","symphoniePro"]),T="musicLine"===D?.key,L="hvl"===D?.key,A=!b&&(!D||T||L||O.has(D.key)),B=l.useCallback(()=>{if(w.current){w.current.stop();try{w.current.output.disconnect()}catch{}w.current=null}},[]),I=l.useCallback(async()=>{if(a)if(T||L)if(p)B(),h(!1);else try{if(T){const{MusicLineEngine:e}=await os(async()=>{const{MusicLineEngine:e}=await Promise.resolve().then(()=>qk);return{MusicLineEngine:e}},void 0),t=e.getInstance();await t.ready(),await t.loadSong(new Uint8Array(a.arrayBuffer)),t.output.connect(t.output.context.destination),w.current={stop:()=>t.stop(),output:t.output},t.play()}else{const{HivelyEngine:e}=await os(async()=>{const{HivelyEngine:e}=await Promise.resolve().then(()=>$r);return{HivelyEngine:e}},void 0),t=e.getInstance();await t.ready(),await t.loadTune(a.arrayBuffer.slice(0)),t.output.connect(t.output.context.destination),w.current={stop:()=>t.stop(),output:t.output},t.play()}h(!0)}catch(e){}else p?(YI(a),h(!1)):($I(a),h(!0))},[a,p,T,L,B]),F=l.useCallback(()=>{a&&(p&&(T||L?B():YI(a),h(!1)),n(a,{useLibopenmpt:f,subsong:y,uadeMetadata:b??void 0}),t())},[a,p,T,L,B,n,t,f,y]),U=l.useCallback(()=>{p&&(T||L?B():a&&YI(a)),N.current&&os(async()=>{const{UADEEngine:e}=await Promise.resolve().then(()=>Si);return{UADEEngine:e}},void 0).then(({UADEEngine:e})=>{e.hasInstance()&&e.getInstance().cancelLoad()}).catch(()=>{}),o(null),i(""),m(null),h(!1),v(null),x(0),t()},[a,p,T,L,B,t]);if(!e)return null;const R=M||D&&!V;return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[480px] max-h-[80vh] overflow-hidden",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(Wt,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:527,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-sm font-semibold text-text-primary",children:"Import Tracker Module"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:528,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:526,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"icon",size:"icon",onClick:U,"aria-label":"Close dialog",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:531,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:530,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:525,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[calc(80vh-110px)]",children:[c&&Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("div",{className:"w-4 h-4 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:540,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted",children:"Loading"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:541,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:539,columnNumber:13},void 0),d&&Yn.jsxDEV("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[Yn.jsxDEV(Le,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:548,columnNumber:15},void 0),d]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:547,columnNumber:13},void 0),a&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(_e,{size:16,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:558,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"font-medium text-text-primary",children:a.metadata.title},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:559,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:557,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:b?b.formatName||"UADE":a.metadata.type},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:561,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:556,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2 text-xs",children:b?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Player:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:571,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:b.player||"Unknown"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:572,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:570,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Subsongs:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:575,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:b.subsongCount},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:576,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:574,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Channels:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:579,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:"4 (Paula)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:580,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:578,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Samples:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:583,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:Object.keys(b.enhancedScan?.samples??{}).length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:584,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:582,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:569,columnNumber:19},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Channels:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:594,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.metadata.channels<0?"--":a.metadata.channels},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:595,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:593,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Patterns:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:598,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.metadata.patterns<0?"--":a.metadata.patterns},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:599,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:597,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Instruments:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:602,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.metadata.instruments<0?"--":a.metadata.instruments},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:603,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:601,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Samples:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:606,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.metadata.samples<0?"--":a.metadata.samples},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:607,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:605,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Orders:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:610,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.metadata.orders<0?"--":a.metadata.orders},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:611,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:609,columnNumber:21},void 0),a.metadata.duration>0&&Yn.jsxDEV("div",{className:"flex justify-between text-text-muted",children:[Yn.jsxDEV("span",{children:"Duration:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:615,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:[Math.floor(a.metadata.duration/60),":",String(Math.floor(a.metadata.duration%60)).padStart(2,"0")]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:616,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:614,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:592,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:566,columnNumber:15},void 0),b&&b.subsongCount>1&&Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("label",{className:"text-xs text-text-muted whitespace-nowrap",children:"Import subsong:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:628,columnNumber:19},void 0),b.subsongCount>20?Yn.jsxDEV("div",{className:"flex items-center gap-2 flex-1",children:[Yn.jsxDEV("input",{type:"number",min:1,max:b.subsongCount,value:y+1,onChange:e=>{const t=Math.max(1,Math.min(b.subsongCount,Number(e.target.value)));x(t-1)},className:"w-20 text-xs bg-dark-bgSecondary border border-dark-border rounded px-2 py-1.5 text-text-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:632,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted",children:["of ",b.subsongCount]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:643,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:631,columnNumber:21},void 0):Yn.jsxDEV("select",{value:y,onChange:e=>x(Number(e.target.value)),className:"flex-1 text-xs bg-dark-bgSecondary border border-dark-border rounded px-2 py-1.5 text-text-primary",children:Array.from({length:b.subsongCount},(e,t)=>Yn.jsxDEV("option",{value:t,children:`Subsong ${t+1}${0===t?" (default)":""}`},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:652,columnNumber:25},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:646,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:627,columnNumber:17},void 0),a.metadata.message&&Yn.jsxDEV("div",{className:"text-xs text-text-muted bg-dark-bgSecondary p-2 rounded max-h-20 overflow-y-auto font-mono whitespace-pre-wrap",children:a.metadata.message},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:662,columnNumber:17},void 0),A&&Yn.jsxDEV(TV,{variant:"ghost",fullWidth:!0,onClick:I,icon:p?Yn.jsxDEV(at,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:673,columnNumber:37},void 0):Yn.jsxDEV(qt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:673,columnNumber:60},void 0),className:p?"text-red-400 hover:text-red-300":"text-green-400 hover:text-green-300",children:p?"Stop Preview":"Preview"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:669,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:555,columnNumber:13},void 0),a&&D&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[Yn.jsxDEV("p",{className:"text-xs font-medium text-text-primary",children:["Import Engine  ",Yn.jsxDEV("span",{className:"text-accent-primary",children:D.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:686,columnNumber:33},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:685,columnNumber:15},void 0),C?Yn.jsxDEV("div",{className:"flex items-start gap-2",children:[Yn.jsxDEV(Kt,{size:12,className:"mt-0.5 text-accent-primary shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:692,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:D.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:693,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:691,columnNumber:17},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("label",{className:"flex items-start gap-2 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",name:"nativeEngine",checked:V,onChange:()=>k(D.key,"native"),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:699,columnNumber:21},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-sm text-text-primary",children:"Native Parser (Fully Editable)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:707,columnNumber:23},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:D.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:708,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:706,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:698,columnNumber:19},void 0),Yn.jsxDEV("label",{className:"flex items-start gap-2 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",name:"nativeEngine",checked:!V,onChange:()=>k(D.key,"uade"),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:714,columnNumber:21},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-sm text-text-primary",children:"UADE (Amiga Emulation)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:722,columnNumber:23},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Use UADE emulator instead of native parser."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:723,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:721,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:713,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:696,columnNumber:17},void 0),!C&&R&&Yn.jsxDEV("div",{className:"mt-2 ml-5 pl-3 border-l border-dark-border space-y-1.5",children:[Yn.jsxDEV("p",{className:"text-xs text-text-muted font-medium",children:"UADE Mode"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:732,columnNumber:19},void 0),Yn.jsxDEV("label",{className:"flex items-start gap-2 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",name:"uadeMode",checked:"enhanced"===P,onChange:()=>k("uade","enhanced"),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:734,columnNumber:21},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-sm text-text-primary",children:"Enhanced (Editable)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:742,columnNumber:23},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Extracts real samples, detects effects."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:743,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:741,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:733,columnNumber:19},void 0),Yn.jsxDEV("label",{className:"flex items-start gap-2 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",name:"uadeMode",checked:"classic"===P,onChange:()=>k("uade","classic"),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:747,columnNumber:21},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-sm text-text-primary",children:"Classic (Playback Only)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:755,columnNumber:23},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Authentic emulation, display-only patterns."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:756,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:754,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:746,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3 pt-1",children:[Yn.jsxDEV("label",{className:"text-xs text-text-muted whitespace-nowrap",children:"Subsong:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:761,columnNumber:21},void 0),Yn.jsxDEV("input",{type:"number",min:1,value:y+1,onChange:e=>x(Math.max(0,Number(e.target.value)-1)),className:"w-16 text-xs bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-text-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:762,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted",children:"(1 = default)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:769,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:760,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:731,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:684,columnNumber:13},void 0),a&&M&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[Yn.jsxDEV("p",{className:"text-xs font-medium text-text-primary",children:"Import Engine"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:779,columnNumber:15},void 0),Yn.jsxDEV("label",{className:"flex items-start gap-2 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",name:"uadeMode",checked:"enhanced"===P,onChange:()=>k("uade","enhanced"),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:781,columnNumber:17},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-sm text-text-primary",children:"Enhanced (Editable)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:789,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Extracts real samples, detects effects. Fully editable patterns."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:790,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:788,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:780,columnNumber:15},void 0),Yn.jsxDEV("label",{className:"flex items-start gap-2 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",name:"uadeMode",checked:"classic"===P,onChange:()=>k("uade","classic"),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:796,columnNumber:17},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-sm text-text-primary",children:"Classic (UADE Playback)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:804,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Authentic emulation, display-only patterns."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:805,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:803,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:795,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:778,columnNumber:13},void 0),a&&!D&&!M&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"checkbox",id:"useLibopenmpt",checked:f,onChange:e=>g(e.target.checked),className:"w-4 h-4 rounded border-dark-border bg-dark-bgSecondary accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:817,columnNumber:17},void 0),Yn.jsxDEV("label",{htmlFor:"useLibopenmpt",className:"text-sm text-text-primary cursor-pointer",children:"Use libopenmpt for sample-accurate playback"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:824,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:816,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-start gap-2 text-xs text-text-muted",children:[Yn.jsxDEV(Kt,{size:12,className:"mt-0.5 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:829,columnNumber:17},void 0),Yn.jsxDEV("span",{children:"When enabled, uses libopenmpt WASM for authentic tracker effects (smooth vibrato, portamento). Editing will use Tone.js approximation."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:830,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:828,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:815,columnNumber:13},void 0),a&&!D&&!M&&!f&&Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Note: Importing will create patterns and sampler instruments from this module. Complex effects may not translate perfectly."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:840,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:536,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border",children:[Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:U,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:849,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",size:"sm",onClick:F,disabled:!a,children:"Import Module"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:850,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:848,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:523,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportModuleDialog.tsx",lineNumber:522,columnNumber:5},void 0)},MF=Object.freeze(Object.defineProperty({__proto__:null,ImportModuleDialog:SF},Symbol.toStringTag,{value:"Module"})),CF={0:"None",1:"YMU759",2:"Genesis (YM2612+SN76489)",3:"SMS (SN76489)",4:"Game Boy (DMG)",5:"PC Engine (HuC6280)",6:"NES (2A03)",7:"C64 (6581)",8:"Amiga (Paula)",9:"YM2151",10:"YM2612",11:"TIA",12:"SAA1099",13:"AY-3-8910",14:"AY8930",15:"POKEY",16:"QSound",17:"ZX Spectrum Beeper",18:"YM2203",19:"YM2608",20:"YM2610",21:"YM2610B",22:"YM2610B (OPN2C variant)",23:"SMS + YM2413",24:"NeoGeo (YM2610+SSG)",25:"MSX (AY-3-8910)",26:"OPL (YM3526)",27:"OPL2 (YM3812)",28:"OPL3 (YMF262)",29:"MultiPCM",30:"PC Speaker",31:"Dummy System",32:"YM2413",33:"SN76489 (extra)",34:"OPN2 (YM2612)",35:"OPM (YM2151)",36:"NES + VRC6",37:"NES + VRC7",38:"NES + FDS",39:"NES + MMC5",40:"NES + Namco 163",41:"NES + Sunsoft 5B",42:"SNES (SPC700)",43:"Virtual Boy (VSU)",44:"MSX + SCC",45:"RF5C68",46:"WonderSwan",47:"Coleco ColecoVision (SN76489)",48:"OPL4 (YMF278)",49:"OPLL (YM2413)",50:"NES (extra)",51:"OPN (YM2203, extra)",52:"PC-88 (OPNA+SSG)",53:"GBA (Direct Sound)",54:"KurumiOscillator",55:"OPL2 (4-op)",56:"OPL3 (4-op)",57:"YM2610",58:"ZX Spectrum AY",59:"SCC+",66:"C64 (8580)",67:"YM2612 (Ext. Ch3)",70:"GBC (extra)",71:"PC-98 (OPNA)",72:"Lynx",74:"OPZ (YM2414)",76:"X1-010",77:"VERA",79:"Sega PCM",80:"Namco 163",83:"ESFM",170:"Sega Master System"};const VF=({isOpen:e,onClose:t,onImport:n,initialFile:s})=>{const[a,o]=l.useState(null),[r,i]=l.useState(null),[c,u]=l.useState(null),[d,m]=l.useState(!1),[p,h]=l.useState(null),[f,g]=l.useState(0),b=l.useRef(null),v=l.useCallback(async e=>{if(/\.(fur|dmf)$/i.test(e.name)){m(!0),h(null),o(null),i(null),u(null),g(0);try{const t=await e.arrayBuffer(),{parseFurnaceSong:n}=await os(async()=>{const{parseFurnaceSong:e}=await Promise.resolve().then(()=>qI);return{parseFurnaceSong:e}},void 0),s=await n(t);o(s),i(t),u(e)}catch(t){h(t instanceof Error?t.message:"Failed to parse Furnace file")}finally{m(!1)}}else h("Please select a Furnace (.fur) or DefleMask (.dmf) file.")},[]);l.useEffect(()=>{s&&e&&v(s)},[s,e,v]);const y=l.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&v(t)},[v]),x=l.useCallback(e=>{e.preventDefault()},[]),N=l.useCallback(e=>{const t=e.target.files?.[0];t&&v(t)},[v]),w=l.useCallback(()=>{if(!a||!r||!c)return;const e={metadata:{title:a.name||c.name.replace(/\.[^/.]+$/,""),type:"Furnace",channels:a.chans,patterns:a.patterns.size,orders:a.subsongs[f]?.ordersLen??0,instruments:a.instruments.length,samples:a.samples.length,duration:0},arrayBuffer:r,file:c};n(e,{useLibopenmpt:!1,subsong:f}),t()},[a,r,c,f,n,t]),E=l.useCallback(()=>{o(null),i(null),u(null),h(null),g(0),t()},[t]);if(!e)return null;const k=a?.subsongs[f]??a?.subsongs[0],D=k?Math.round(2.5*(k.hz||60)*((k.virtualTempo||150)/(k.virtualTempoD||150))):0;return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[500px] max-h-[85vh] overflow-hidden flex flex-col",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border flex-shrink-0",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV($t,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:211,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-sm font-semibold text-text-primary",children:"Import Furnace Module"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:212,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:210,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"icon",size:"icon",onClick:E,"aria-label":"Close dialog",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:215,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:214,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:209,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4 overflow-y-auto flex-1",children:[Yn.jsxDEV("div",{onDrop:y,onDragOver:x,onClick:()=>b.current?.click(),className:`\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ${d?"border-accent-primary/50 bg-accent-primary/5":"border-dark-border hover:border-accent-primary/50 hover:bg-dark-bgHover"}\n            `,children:[Yn.jsxDEV("input",{ref:b,type:"file",accept:".fur,.dmf",onChange:N,className:"hidden"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:234,columnNumber:13},void 0),d?Yn.jsxDEV("div",{className:"flex flex-col items-center gap-2",children:[Yn.jsxDEV("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:243,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-muted",children:"Parsing Furnace file"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:244,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:242,columnNumber:15},void 0):Yn.jsxDEV("div",{className:"flex flex-col items-center gap-2",children:[Yn.jsxDEV(Wt,{size:32,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:248,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Drop a .fur or .dmf file here or click to browse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:249,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Furnace tracker and DefleMask modules"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:250,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:247,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:223,columnNumber:11},void 0),p&&Yn.jsxDEV("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[Yn.jsxDEV(Le,{size:16,className:"flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:258,columnNumber:15},void 0),p]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:257,columnNumber:13},void 0),a&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-start justify-between gap-3",children:[Yn.jsxDEV("div",{className:"min-w-0",children:[Yn.jsxDEV("p",{className:"font-medium text-text-primary truncate",children:a.name||c?.name.replace(/\.[^/.]+$/,"")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:270,columnNumber:21},void 0),a.author&&Yn.jsxDEV("p",{className:"text-xs text-text-muted mt-0.5",children:["by ",a.author]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:272,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:269,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded flex-shrink-0",children:["Furnace v",a.version]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:275,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:268,columnNumber:17},void 0),a.systems.length>0&&Yn.jsxDEV("div",{className:"flex flex-wrap gap-1.5",children:a.systems.map((e,t)=>{return Yn.jsxDEV("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 bg-dark-bgSecondary border border-dark-border rounded",children:[Yn.jsxDEV($t,{size:10,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:288,columnNumber:25},void 0),(n=e,CF[n]??`Chip 0x${n.toString(16).toUpperCase()}`),a.systemChans[t]?Yn.jsxDEV("span",{className:"text-text-muted",children:[a.systemChans[t],"ch"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:291,columnNumber:27},void 0):null]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:284,columnNumber:23},void 0);var n})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:282,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Channels"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:301,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.chans},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:302,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:300,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Instruments"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:305,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.instruments.length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:306,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:304,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Samples"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:309,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.samples.length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:310,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:308,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Subsongs"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:313,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.subsongs.length},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:314,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:312,columnNumber:19},void 0),k&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Pattern len"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:319,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:[k.patLen," rows"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:320,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:318,columnNumber:23},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"BPM"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:323,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:[D," @ ",k.hz,"Hz"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:324,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:322,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:317,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:299,columnNumber:17},void 0),a.comment&&Yn.jsxDEV("div",{className:"text-xs text-text-muted bg-dark-bgSecondary p-2 rounded max-h-20 overflow-y-auto font-mono whitespace-pre-wrap border border-dark-border/50",children:a.comment},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:332,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:267,columnNumber:15},void 0),a.subsongs.length>1&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[Yn.jsxDEV("p",{className:"text-xs font-medium text-text-primary",children:"Import Subsong"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:341,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV("select",{value:f,onChange:e=>g(Number(e.target.value)),className:"w-full text-sm bg-dark-bgSecondary border border-dark-border rounded px-3 py-2 pr-8 text-text-primary appearance-none cursor-pointer",children:a.subsongs.map((e,t)=>Yn.jsxDEV("option",{value:t,children:[t+1,". ",e.name||`Subsong ${t+1}`,0===t?" (default)":""]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:349,columnNumber:25},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:343,columnNumber:21},void 0),Yn.jsxDEV(De,{size:14,className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:355,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:342,columnNumber:19},void 0),k?.comment&&Yn.jsxDEV("p",{className:"text-xs text-text-muted italic",children:k.comment},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:358,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:340,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Furnace files are always imported using the native parser. Chip-specific instruments (FM, PSG, Amiga, etc.) are preserved and routed to their original synthesis engines."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:364,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:265,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:220,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border flex-shrink-0",children:[Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:E,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:374,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",size:"sm",onClick:w,disabled:!a,children:"Import Module"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:375,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:373,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:206,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportFurnaceDialog.tsx",lineNumber:205,columnNumber:5},void 0)},PF=Object.freeze(Object.defineProperty({__proto__:null,ImportFurnaceDialog:VF},Symbol.toStringTag,{value:"Module"})),_F=[{value:0,label:"None"},{value:1,label:"1 row"},{value:2,label:"2 rows ( beat)"},{value:4,label:"4 rows (1 beat)"},{value:8,label:"8 rows (2 beats)"}],OF=[32,64,128,256],TF=({isOpen:e,onClose:t,onImport:n,initialFile:s})=>{const[a,o]=l.useState(null),[r,i]=l.useState(null),[c,u]=l.useState(!1),[d,m]=l.useState(null),[p,h]=l.useState(1),[f,g]=l.useState(!1),[b,v]=l.useState(!0),[y,x]=l.useState(64),N=l.useRef(null),w=l.useCallback(async e=>{if(/\.(mid|midi)$/i.test(e.name)){u(!0),m(null),o(null),i(null);try{const t=await e.arrayBuffer(),{Midi:n}=await os(async()=>{const{Midi:e}=await Promise.resolve().then(()=>Nj);return{Midi:e}},void 0),s=new n(t),a=s.header.tempos.length>0?Math.round(s.header.tempos[0].bpm):120,r=s.header.timeSignatures.length>0?[s.header.timeSignatures[0].timeSignature[0],s.header.timeSignatures[0].timeSignature[1]]:[4,4];o({bpm:a,timeSignature:r,tracks:s.tracks.length,totalSeconds:Math.round(s.duration),name:e.name.replace(/\.[^/.]+$/,"")}),i(e)}catch(t){m(t instanceof Error?t.message:"Failed to parse MIDI file")}finally{u(!1)}}else m("Please select a MIDI file (.mid or .midi).")},[]);l.useEffect(()=>{s&&e&&w(s)},[s,e,w]);const E=l.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&w(t)},[w]),k=l.useCallback(e=>{e.preventDefault()},[]),D=l.useCallback(e=>{const t=e.target.files?.[0];t&&w(t)},[w]),S=l.useCallback(()=>{if(!r||!a)return;const e={quantize:p,mergeChannels:f,velocityToVolume:b,defaultPatternLength:y},s={metadata:{title:a.name,type:"MIDI",channels:a.tracks,patterns:0,orders:0,instruments:0,samples:0,duration:a.totalSeconds},arrayBuffer:new ArrayBuffer(0),file:r};n(s,{useLibopenmpt:!1,midiOptions:e}),t()},[r,a,p,f,b,y,n,t]),M=l.useCallback(()=>{o(null),i(null),m(null),t()},[t]);if(!e)return null;const C=a?`${Math.floor(a.totalSeconds/60)}:${String(a.totalSeconds%60).padStart(2,"0")}`:"0:00";return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[480px] max-h-[85vh] overflow-hidden flex flex-col",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border flex-shrink-0",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(_e,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:170,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-sm font-semibold text-text-primary",children:"Import MIDI File"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:171,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:169,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"icon",size:"icon",onClick:M,"aria-label":"Close dialog",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:174,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:173,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:168,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4 overflow-y-auto flex-1",children:[Yn.jsxDEV("div",{onDrop:E,onDragOver:k,onClick:()=>N.current?.click(),className:`\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ${c?"border-accent-primary/50 bg-accent-primary/5":"border-dark-border hover:border-accent-primary/50 hover:bg-dark-bgHover"}\n            `,children:[Yn.jsxDEV("input",{ref:N,type:"file",accept:".mid,.midi",onChange:D,className:"hidden"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:193,columnNumber:13},void 0),c?Yn.jsxDEV("div",{className:"flex flex-col items-center gap-2",children:[Yn.jsxDEV("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:202,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-muted",children:"Parsing MIDI file"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:203,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:201,columnNumber:15},void 0):Yn.jsxDEV("div",{className:"flex flex-col items-center gap-2",children:[Yn.jsxDEV(Wt,{size:32,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:207,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Drop a .mid or .midi file here or click to browse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:208,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Standard MIDI Format 0 and 1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:209,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:206,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:182,columnNumber:11},void 0),d&&Yn.jsxDEV("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[Yn.jsxDEV(Le,{size:16,className:"flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:217,columnNumber:15},void 0),d]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:216,columnNumber:13},void 0),a&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-start justify-between gap-3",children:[Yn.jsxDEV("p",{className:"font-medium text-text-primary truncate",children:a.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:226,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded flex-shrink-0",children:"MIDI"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:227,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:225,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"BPM"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:233,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.bpm},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:234,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:232,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Time sig"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:237,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:[a.timeSignature[0],"/",a.timeSignature[1]]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:238,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:236,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Tracks"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:241,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:a.tracks},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:242,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:240,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Duration"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:245,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:C},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:246,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:244,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:231,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:224,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[Yn.jsxDEV("p",{className:"text-xs font-medium text-text-primary",children:"Import Options"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:254,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between gap-3",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Quantize"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:259,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Snap notes to grid"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:260,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:258,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV("select",{value:p,onChange:e=>h(Number(e.target.value)),className:"text-sm bg-dark-bgSecondary border border-dark-border rounded px-3 py-1.5 pr-7 text-text-primary appearance-none cursor-pointer",children:_F.map(e=>Yn.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:269,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:263,columnNumber:17},void 0),Yn.jsxDEV(De,{size:12,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:272,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:262,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:257,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between gap-3",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Pattern Length"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:279,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Rows per pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:280,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:278,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV("select",{value:y,onChange:e=>x(Number(e.target.value)),className:"text-sm bg-dark-bgSecondary border border-dark-border rounded px-3 py-1.5 pr-7 text-text-primary appearance-none cursor-pointer",children:OF.map(e=>Yn.jsxDEV("option",{value:e,children:[e," rows"]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:289,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:283,columnNumber:17},void 0),Yn.jsxDEV(De,{size:12,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:292,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:282,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:277,columnNumber:13},void 0),Yn.jsxDEV("label",{className:"flex items-center justify-between cursor-pointer",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Velocity  Volume"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:299,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Map note velocity to tracker volume column"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:300,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:298,columnNumber:15},void 0),Yn.jsxDEV("input",{type:"checkbox",checked:b,onChange:e=>v(e.target.checked),className:"w-4 h-4 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:302,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:297,columnNumber:13},void 0),Yn.jsxDEV("label",{className:"flex items-center justify-between cursor-pointer",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Merge Channels"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:313,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Combine all MIDI channels into fewer tracker channels"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:314,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:312,columnNumber:15},void 0),Yn.jsxDEV("input",{type:"checkbox",checked:f,onChange:e=>g(e.target.checked),className:"w-4 h-4 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:316,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:311,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:253,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:179,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border flex-shrink-0",children:[Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:M,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:328,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",size:"sm",onClick:S,disabled:!r,children:[Yn.jsxDEV(Yt,{size:14,className:"mr-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:330,columnNumber:13},void 0),"Import MIDI"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:329,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:327,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:165,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportMIDIDialog.tsx",lineNumber:164,columnNumber:5},void 0)},LF=Object.freeze(Object.defineProperty({__proto__:null,ImportMIDIDialog:TF},Symbol.toStringTag,{value:"Module"})),AF=/\.(iff|8svx)$/i,BF=/\.(wav|mp3|ogg|flac|aiff?|m4a|iff|8svx)$/i,IF=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],FF=Array.from({length:9},(e,t)=>IF.map(e=>`${e}${t}`)).flat(),UF=[{value:"off",label:"No loop"},{value:"forward",label:"Forward loop"},{value:"pingpong",label:"Ping-pong loop"}];function RF(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}const jF=({isOpen:e,onClose:t,initialFile:n})=>{const[s,a]=l.useState(null),[o,r]=l.useState(null),[i,c]=l.useState(null),[u,d]=l.useState(!1),[m,p]=l.useState(null),[h,f]=l.useState("C3"),[g,b]=l.useState("off"),[v,y]=l.useState(0),[x,N]=l.useState(0),w=l.useRef(null),E=l.useCallback(async e=>{if(BF.test(e.name))if(p(null),c(null),y(0),N(0),b("off"),AF.test(e.name)){d(!0);try{const t=await e.arrayBuffer(),{parseIFF8SVX:n}=await os(async()=>{const{parseIFF8SVX:e}=await import("./IFF8SVXParser-DlzVl9uR.js");return{parseIFF8SVX:e}},[]),s=n(t);c(s),s.hasLoop&&s.loopEnd>s.loopStart&&(b("forward"),y(s.loopStart),N(s.loopEnd));const o=s.name||e.name.replace(/\.[^/.]+$/,"");a({name:o,extension:e.name.split(".").pop()?.toUpperCase()??"IFF",size:RF(e.size),iff:{sampleRate:s.sampleRate,samples:s.pcm.length,compressed:!1,octaves:s.octaves,nativeLoop:s.hasLoop,nativeLoopStart:s.loopStart,nativeLoopEnd:s.loopEnd}}),r(e)}catch(t){p(t instanceof Error?t.message:"Failed to parse IFF/8SVX file")}finally{d(!1)}}else a({name:e.name.replace(/\.[^/.]+$/,""),extension:e.name.split(".").pop()?.toUpperCase()??"",size:RF(e.size)}),r(e);else p("Please select a supported audio file (.wav, .mp3, .flac, .ogg, .aiff, .m4a, .iff, .8svx).")},[]);l.useEffect(()=>{n&&e&&E(n)},[n,e,E]);const k=l.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&E(t)},[E]),D=l.useCallback(e=>{e.preventDefault()},[]),S=l.useCallback(e=>{const t=e.target.files?.[0];t&&E(t)},[E]),M=l.useCallback(async()=>{if(o&&s){d(!0),p(null);try{const{addInstrument:e}=EN.getState(),n="off"!==g;if(i){const{pcm8ToWAV:t}=await os(async()=>{const{pcm8ToWAV:e}=await Promise.resolve().then(()=>lF);return{pcm8ToWAV:e}},void 0),a=n?x:0,o=t(new Uint8Array(i.pcm.buffer),i.sampleRate,n?v:0,a),r=new Uint8Array(o);let l="";const c=8192;for(let e=0;e<r.length;e+=c)l+=String.fromCharCode(...Array.from(r.subarray(e,Math.min(e+c,r.length))));const u=`data:audio/wav;base64,${btoa(l)}`,d=i.volume>0?Math.max(-60,20*Math.log10(i.volume)):-60;e({id:Date.now()%128||1,name:s.name,type:"sample",synthType:"Sampler",effects:[],volume:d,pan:0,sample:{audioBuffer:o,url:u,baseNote:h,detune:0,loop:n,loopType:g,loopStart:n?v:0,loopEnd:n?a:0,sampleRate:i.sampleRate,reverse:!1,playbackRate:1}})}else{const t=await o.arrayBuffer(),a=new Uint8Array(t);let r="";const i=8192;for(let e=0;e<a.length;e+=i)r+=String.fromCharCode(...Array.from(a.subarray(e,Math.min(e+i,a.length))));const l=`data:${o.type||"audio/wav"};base64,${btoa(r)}`;e({id:Date.now()%128||1,name:s.name,type:"sample",synthType:"Sampler",effects:[],volume:0,pan:0,sample:{audioBuffer:t,url:l,baseNote:h,detune:0,loop:n,loopType:g,loopStart:0,loopEnd:0,sampleRate:44100,reverse:!1,playbackRate:1}})}t()}catch(e){p(e instanceof Error?e.message:"Failed to import audio file")}finally{d(!1)}}},[o,s,i,h,g,v,x,t]),C=l.useCallback(()=>{a(null),r(null),c(null),p(null),b("off"),y(0),N(0),t()},[t]);return e?Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[440px] max-h-[85vh] overflow-hidden flex flex-col",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border flex-shrink-0",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(gt,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:292,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-sm font-semibold text-text-primary",children:"Import Audio Sample"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:293,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:291,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"icon",size:"icon",onClick:C,"aria-label":"Close dialog",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:296,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:295,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:290,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4 overflow-y-auto flex-1",children:[Yn.jsxDEV("div",{onDrop:k,onDragOver:D,onClick:()=>w.current?.click(),className:`\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ${u?"border-accent-primary/50 bg-accent-primary/5":"border-dark-border hover:border-accent-primary/50 hover:bg-dark-bgHover"}\n            `,children:[Yn.jsxDEV("input",{ref:w,type:"file",accept:".wav,.mp3,.ogg,.flac,.aif,.aiff,.m4a,.iff,.8svx",onChange:S,className:"hidden"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:315,columnNumber:13},void 0),u?Yn.jsxDEV("div",{className:"flex flex-col items-center gap-2",children:[Yn.jsxDEV("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:324,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-muted",children:"Parsing audio"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:325,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:323,columnNumber:15},void 0):Yn.jsxDEV("div",{className:"flex flex-col items-center gap-2",children:[Yn.jsxDEV(Wt,{size:32,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:329,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Drop an audio file here or click to browse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:330,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"WAV  MP3  FLAC  OGG  AIFF  M4A  IFF  8SVX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:331,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:328,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:304,columnNumber:11},void 0),m&&Yn.jsxDEV("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[Yn.jsxDEV(Le,{size:16,className:"flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:339,columnNumber:15},void 0),m]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:338,columnNumber:13},void 0),s&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-2",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between gap-3",children:[Yn.jsxDEV("p",{className:"font-medium text-text-primary truncate",children:s.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:348,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded flex-shrink-0",children:s.extension},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:349,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:347,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:s.size},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:353,columnNumber:15},void 0),s.iff&&Yn.jsxDEV("div",{className:"grid grid-cols-3 gap-2 pt-1 text-xs border-t border-dark-border/50",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Rate"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:359,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:(V=s.iff.sampleRate,V>=1e3?`${(V/1e3).toFixed(2)} kHz`:`${V} Hz`)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:360,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:358,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Samples"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:363,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:s.iff.samples.toLocaleString()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:364,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:362,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Duration"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:367,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:[(s.iff.samples/s.iff.sampleRate).toFixed(3),"s"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:368,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:366,columnNumber:19},void 0),s.iff.nativeLoop&&Yn.jsxDEV("div",{className:"col-span-3 flex items-center gap-1 text-accent-primary",children:Yn.jsxDEV("span",{className:"text-xs",children:[" Native loop: ",s.iff.nativeLoopStart.toLocaleString(),"",s.iff.nativeLoopEnd.toLocaleString()]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:374,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:373,columnNumber:21},void 0),s.iff.octaves>1&&Yn.jsxDEV("div",{className:"col-span-3 text-text-muted text-xs",children:["Multi-octave (",s.iff.octaves," octaves)  importing first octave"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:378,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:357,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:346,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[Yn.jsxDEV("p",{className:"text-xs font-medium text-text-primary",children:"Sampler Settings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:389,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between gap-3",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Root Note"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:394,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Note played at original pitch"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:395,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:393,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV("select",{value:h,onChange:e=>f(e.target.value),className:"text-sm bg-dark-bgSecondary border border-dark-border rounded px-3 py-1.5 pr-7 text-text-primary appearance-none cursor-pointer",children:FF.map(e=>Yn.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:404,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:398,columnNumber:17},void 0),Yn.jsxDEV(De,{size:12,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:407,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:397,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:392,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between gap-3",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Loop"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:414,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:i?.hasLoop?"Loop points pre-filled from file":"Looping mode"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:415,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:413,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV("select",{value:g,onChange:e=>b(e.target.value),className:"text-sm bg-dark-bgSecondary border border-dark-border rounded px-3 py-1.5 pr-7 text-text-primary appearance-none cursor-pointer",children:UF.map(e=>Yn.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:426,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:420,columnNumber:17},void 0),Yn.jsxDEV(De,{size:12,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:429,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:419,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:412,columnNumber:13},void 0),i&&"off"!==g&&Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Loop Start"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:437,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:v.toLocaleString()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:438,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:436,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("span",{className:"text-text-muted",children:"Loop End"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:441,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-mono",children:x>0?x.toLocaleString():"(end)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:442,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:440,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:435,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:388,columnNumber:11},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"The sample will be added as a new Sampler instrument. Use the instrument editor to adjust loop points, volume envelope, and other parameters after import."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:448,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:301,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border flex-shrink-0",children:[Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:C,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:455,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",size:"sm",onClick:M,disabled:!o||u,children:"Add to Instruments"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:456,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:454,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:287,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportAudioDialog.tsx",lineNumber:286,columnNumber:5},void 0):null;var V},XF=Object.freeze(Object.defineProperty({__proto__:null,ImportAudioDialog:jF},Symbol.toStringTag,{value:"Module"})),zF=({isOpen:e,onClose:t,initialFile:n,onImport:s})=>{const[a,o]=l.useState(null),[r,i]=l.useState(null),[c,u]=l.useState(!1),[d,m]=l.useState(null),[p,h]=l.useState(!1),f=l.useCallback(async e=>{u(!0),m(null),o(null),i(null);try{const t=await e.arrayBuffer(),{parseTD3File:n}=await os(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),s=await n(t);o({name:s.name||e.name.replace(/\.[^/.]+$/,""),version:s.version||"Unknown",patternNames:s.patterns.map((e,t)=>e.name||`Pattern ${t+1}`)}),i(e)}catch(t){m(t instanceof Error?t.message:"Failed to parse TD-3 file")}finally{u(!1)}},[]);l.useEffect(()=>{n&&e&&f(n)},[n,e,f]);const g=l.useCallback(()=>{r&&(s(r,p),t())},[r,p,s,t]),b=l.useCallback(()=>{o(null),i(null),m(null),t()},[t]);return e?Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[420px] max-h-[75vh] overflow-hidden flex flex-col",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border flex-shrink-0",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(Jt,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:93,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-sm font-semibold text-text-primary",children:"Import TD-3 / TB-303 Patterns"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:94,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:92,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"icon",size:"icon",onClick:b,"aria-label":"Close dialog",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:97,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:96,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:91,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4 overflow-y-auto flex-1",children:[c&&Yn.jsxDEV("div",{className:"flex items-center justify-center p-6",children:Yn.jsxDEV("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:106,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:105,columnNumber:13},void 0),d&&Yn.jsxDEV("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[Yn.jsxDEV(Le,{size:16,className:"flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:112,columnNumber:15},void 0),d]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:111,columnNumber:13},void 0),a&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-2",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("p",{className:"font-medium text-text-primary",children:a.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:122,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:["v",a.version]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:123,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:121,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:[a.patternNames.length," pattern",1!==a.patternNames.length?"s":""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:127,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:120,columnNumber:15},void 0),a.patternNames.length>0&&Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-3 space-y-1 max-h-40 overflow-y-auto",children:a.patternNames.map((e,t)=>Yn.jsxDEV("div",{className:"flex items-center gap-2 text-xs",children:[Yn.jsxDEV("span",{className:"text-text-muted w-6 text-right font-mono",children:t+1},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:135,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-text-primary",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:136,columnNumber:23},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:134,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:132,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"bg-dark-bg rounded-lg p-4 space-y-2",children:[Yn.jsxDEV("p",{className:"text-xs font-medium text-text-primary",children:"Import Mode"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:144,columnNumber:17},void 0),Yn.jsxDEV("label",{className:"flex items-start gap-3 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",checked:!p,onChange:()=>h(!1),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:146,columnNumber:19},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Append to project"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:153,columnNumber:21},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Add patterns alongside existing patterns"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:154,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:152,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:145,columnNumber:17},void 0),Yn.jsxDEV("label",{className:"flex items-start gap-3 cursor-pointer",children:[Yn.jsxDEV("input",{type:"radio",checked:p,onChange:()=>h(!0),className:"mt-0.5 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:158,columnNumber:19},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("p",{className:"text-sm text-text-primary",children:"Replace project"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:165,columnNumber:21},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:"Clear all existing patterns first"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:166,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:164,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:157,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:143,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:118,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:102,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border flex-shrink-0",children:[Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:b,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:176,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",size:"sm",onClick:g,disabled:!r,children:"Import Patterns"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:177,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:175,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:88,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportTD3Dialog.tsx",lineNumber:87,columnNumber:5},void 0):null},GF=Object.freeze(Object.defineProperty({__proto__:null,ImportTD3Dialog:zF},Symbol.toStringTag,{value:"Module"})),HF=({onClose:e,onImport:t,initialFile:n})=>{const[s,a]=l.useState(null),[o,r]=l.useState(""),[i,c]=l.useState(null);l.useEffect(()=>{if(!n)return;const e=n.name.replace(/\.(sunsynth|sunvox)$/i,""),t=n.name.toLowerCase().endsWith(".sunvox");if(r(n.name),t)return void a({name:e,config:{patchData:new ArrayBuffer(0),patchName:e,isSong:!0,controlValues:{}}});(async()=>{try{const t=await n.arrayBuffer();a({name:e,config:{patchData:t,patchName:e,isSong:!1,controlValues:{}}}),c(null)}catch(t){a(null),c(`Could not read file: ${t instanceof Error?t.message:String(t)}`)}})()},[n]);const u=(n?.name??o).toLowerCase().endsWith(".sunvox");return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[10050]",onClick:e,children:Yn.jsxDEV("div",{className:"bg-ft2-bg border border-ft2-border p-4 rounded min-w-[340px] max-w-[500px] shadow-xl",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("h2",{className:"text-ft2-highlight font-mono font-bold text-sm mb-3",children:u?"Load SunVox Song":"Import SunSynth Patch"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:94,columnNumber:9},void 0),!n&&Yn.jsxDEV("input",{type:"file",accept:".sunsynth,.sunvox",onChange:async e=>{const t=e.target.files?.[0];if(t){r(t.name);try{const e=await t.arrayBuffer(),n=t.name.replace(/\.(sunsynth|sunvox)$/i,""),s={patchData:e,patchName:n,isSong:t.name.toLowerCase().endsWith(".sunvox"),controlValues:{}};a({name:n,config:s}),c(null)}catch(n){a(null),c(`Could not read file: ${n instanceof Error?n.message:String(n)}`)}}},className:"block w-full mb-3 text-ft2-text text-xs font-mono cursor-pointer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:99,columnNumber:11},void 0),o&&!i&&Yn.jsxDEV("p",{className:"text-ft2-textDim text-xs font-mono mb-2",children:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:108,columnNumber:11},void 0),i&&Yn.jsxDEV("p",{className:"text-red-400 text-xs font-mono mb-2",children:i},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:112,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-2 justify-end",children:[Yn.jsxDEV("button",{onClick:e,className:"px-3 py-1 text-xs font-mono text-ft2-text border border-ft2-border hover:border-ft2-highlight transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:116,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>{if(u&&n){const s=n.name.replace(/\.(sunsynth|sunvox)$/i,"");return t(s,{patchData:new ArrayBuffer(0),patchName:s,isSong:!0,controlValues:{}}),void e()}s&&(t(s.name,s.config),e())},disabled:!u&&null===s,className:"px-3 py-1 text-xs font-mono bg-ft2-highlight text-ft2-bg disabled:opacity-40 disabled:cursor-default",children:"Import"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:122,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:115,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:90,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/SunVoxImportDialog.tsx",lineNumber:89,columnNumber:5},void 0)},WF=Object.freeze(Object.defineProperty({__proto__:null,SunVoxImportDialog:HF},Symbol.toStringTag,{value:"Module"})),qF=({scope:e,onConfirm:t,onCancel:n})=>{const[s,a]=l.useState(1),o=()=>{t(s)};return Yn.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:Yn.jsxDEV("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),o()):"Escape"===e.key&&(e.preventDefault(),n())},children:[Yn.jsxDEV("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Scale Volume (",e,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:46,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"space-y-4",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Scale Factor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:52,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[Yn.jsxDEV("input",{type:"range",min:"0",max:"2",step:"0.05",value:s,onChange:e=>a(parseFloat(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:56,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-neutral-100 font-mono text-sm w-20 text-right",children:[s.toFixed(2)," (",Math.round(100*s),"%)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:66,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:55,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-xs text-neutral-500 mt-1",children:[Yn.jsxDEV("span",{children:"0 (silence)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:71,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"1 (unchanged)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:72,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"2 (double)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:73,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:70,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:51,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[Yn.jsxDEV("p",{className:"mb-1",children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Tip:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:79,columnNumber:15},void 0)," Scale volume multiplies all volume values by the factor."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:78,columnNumber:13},void 0),Yn.jsxDEV("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[Yn.jsxDEV("li",{children:"0.5 = half volume (50%)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:82,columnNumber:15},void 0),Yn.jsxDEV("li",{children:"1.0 = no change (100%)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:83,columnNumber:15},void 0),Yn.jsxDEV("li",{children:"2.0 = double volume (200%, clamped to max)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:84,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:81,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:77,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:50,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 mt-6",children:[Yn.jsxDEV("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",Yn.jsxDEV("span",{className:"text-neutral-500",children:"(Esc)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:94,columnNumber:20},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:90,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",Yn.jsxDEV("span",{className:"opacity-75",children:"(Enter)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:100,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:96,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:89,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:41,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/ScaleVolumeDialog.tsx",lineNumber:37,columnNumber:5},void 0)},KF=Object.freeze(Object.defineProperty({__proto__:null,ScaleVolumeDialog:qF},Symbol.toStringTag,{value:"Module"})),$F=({scope:e,onConfirm:t,onCancel:n})=>{const[s,a]=l.useState(64),[o,r]=l.useState(0),i=()=>{t(s,o)};return Yn.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:Yn.jsxDEV("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),i()):"Escape"===e.key&&(e.preventDefault(),n())},children:[Yn.jsxDEV("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Fade Volume (",e,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:47,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"space-y-4",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Start Volume"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:53,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[Yn.jsxDEV("input",{type:"range",min:"0",max:"64",step:"1",value:s,onChange:e=>a(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:57,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:s.toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:67,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:56,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:52,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"End Volume"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:74,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[Yn.jsxDEV("input",{type:"range",min:"0",max:"64",step:"1",value:o,onChange:e=>r(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:78,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:o.toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:87,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:77,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:73,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3",children:Yn.jsxDEV("div",{className:"text-xs text-neutral-400 space-y-2",children:[Yn.jsxDEV("p",{children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Fade Direction:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:96,columnNumber:17},void 0)," ",s>o?Yn.jsxDEV("span",{className:"text-red-400",children:"Fade out (loud  quiet)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:98,columnNumber:19},void 0):s<o?Yn.jsxDEV("span",{className:"text-green-400",children:"Fade in (quiet  loud)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:100,columnNumber:19},void 0):Yn.jsxDEV("span",{className:"text-neutral-400",children:"No change (flat)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:102,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:95,columnNumber:15},void 0),Yn.jsxDEV("p",{children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Tip:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:106,columnNumber:17},void 0)," Fade volume applies linear interpolation from start to end across all rows in the ",e,"."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:105,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:94,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:93,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:51,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 mt-6",children:[Yn.jsxDEV("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",Yn.jsxDEV("span",{className:"text-neutral-500",children:"(Esc)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:118,columnNumber:20},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:114,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",Yn.jsxDEV("span",{className:"opacity-75",children:"(Enter)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:124,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:120,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:113,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:42,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FadeVolumeDialog.tsx",lineNumber:38,columnNumber:5},void 0)},YF=Object.freeze(Object.defineProperty({__proto__:null,FadeVolumeDialog:$F},Symbol.toStringTag,{value:"Module"})),JF=({scope:e,onConfirm:t,onCancel:n})=>{const[s,a]=l.useState(0),[o,r]=l.useState(0),i=()=>{t(s,o)};return Yn.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:n,children:Yn.jsxDEV("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),i()):"Escape"===e.key&&(e.preventDefault(),n())},children:[Yn.jsxDEV("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Remap Instrument (",e,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:47,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"space-y-4",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Source Instrument"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:53,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"number",min:"0",max:"255",value:s,onChange:e=>a(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:56,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to find (0-255)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:65,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:52,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Destination Instrument"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:71,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"number",min:"0",max:"255",value:o,onChange:e=>r(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:74,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to replace with (0-255)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:82,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:70,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[Yn.jsxDEV("p",{className:"mb-1",children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Tip:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:89,columnNumber:15},void 0)," Remap instrument replaces all occurrences of the source instrument ID with the destination ID."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:88,columnNumber:13},void 0),Yn.jsxDEV("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[Yn.jsxDEV("li",{children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Block:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:92,columnNumber:19},void 0)," Only in selected region"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:92,columnNumber:15},void 0),Yn.jsxDEV("li",{children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Track:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:93,columnNumber:19},void 0)," Entire current channel"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:93,columnNumber:15},void 0),Yn.jsxDEV("li",{children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Pattern:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:94,columnNumber:19},void 0)," Entire current pattern"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:94,columnNumber:15},void 0),Yn.jsxDEV("li",{children:[Yn.jsxDEV("strong",{className:"text-neutral-300",children:"Song:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:95,columnNumber:19},void 0)," All patterns"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:95,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:91,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:87,columnNumber:11},void 0),s===o&&Yn.jsxDEV("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded p-3 text-xs text-yellow-300",children:" Source and destination are the same - no changes will be made."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:100,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:51,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 mt-6",children:[Yn.jsxDEV("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",Yn.jsxDEV("span",{className:"text-neutral-500",children:"(Esc)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:111,columnNumber:20},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:107,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:i,disabled:s===o,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Remap ",Yn.jsxDEV("span",{className:"opacity-75",children:"(Enter)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:118,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:113,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:106,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:42,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/RemapInstrumentDialog.tsx",lineNumber:38,columnNumber:5},void 0)};function QF(e){return e.some(e=>0!==e.note||0!==e.instrument||0!==e.effTyp||0!==e.eff)}const ZF={MINOR:[0,2,3,5,7,8,10],MAJOR:[0,2,4,5,7,9,11],DORIAN:[0,2,3,5,7,9,10],MIXOLYDIAN:[0,2,4,5,7,9,10],PHRYGIAN:[0,1,3,5,7,8,10],HARMONIC_MINOR:[0,2,3,5,7,8,11],PHRYGIAN_DOMINANT:[0,1,4,5,7,8,10],MELODIC_MINOR:[0,2,3,5,7,9,11],LYDIAN_DOMINANT:[0,2,4,6,7,9,10],HUNGARIAN_MINOR:[0,2,3,6,7,8,11]},eU=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function tU(e,t){return Math.floor(Math.random()*(t-e+1))+e}const nU=({channelIndex:e,onClose:t})=>{const{patterns:n,currentPatternIndex:s,setChannelRows:a}=ID(),o=n[s],[r,i]=l.useState(e),c=o?.channels[r],[u,d]=l.useState(!1),[m,p]=l.useState(null),[h,f]=l.useState(50),[g,b]=l.useState(!0),[v,y]=l.useState("MINOR"),[x,N]=l.useState("C"),[w,E]=l.useState(!0),[k,D]=l.useState(2),[S,M]=l.useState(4),[C,V]=l.useState(!1),[P,_]=l.useState(1),[O,T]=l.useState(4),[L,A]=l.useState(!0),[B,I]=l.useState(20),[F,U]=l.useState(64),[R,j]=l.useState(!0),[X,z]=l.useState(30),[G,H]=l.useState(!1),[W,q]=l.useState(20),[K,$]=l.useState(!1),Y=l.useCallback(()=>{if(!c||!o)return;const e=function(e,t,n){const s=ZF[n.scale],a=$O(n.rootNote+"0"),o=[];for(let r=0;r<e;r++){if(100*Math.random()>=t){o.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0});continue}let e=0;if(n.noteEnabled){const t=n.octaveEnabled?tU(n.octaveMin,n.octaveMax):3,o=a+s[tU(0,s.length-1)]+12*t;e=Za(Math.max(0,Math.min(127,o)))}else e=Za(60);const r=n.instrumentEnabled?tU(n.instrumentMin,n.instrumentMax):0;let i=0;n.volumeEnabled&&(i=16+tU(n.volumeMin,n.volumeMax));const l=n.accentEnabled&&100*Math.random()<n.accentDensity?1:void 0,c=n.slideEnabled&&100*Math.random()<n.slideDensity?2:void 0;let u=0,d=0;if(n.effectsEnabled){const e=[{type:10,paramFn:()=>tU(1,15)<<4},{type:10,paramFn:()=>tU(1,15)},{type:12,paramFn:()=>tU(16,64)},{type:0,paramFn:()=>tU(1,7)<<4|tU(1,7)}];if(Math.random()<.3){const t=e[tU(0,e.length-1)];u=t.type,d=t.paramFn()}}o.push({note:e,instrument:r,volume:i,effTyp:u,eff:d,effTyp2:0,eff2:0,flag1:l,flag2:c})}return o}(o.length,h,{noteEnabled:g,scale:v,rootNote:x,octaveEnabled:w,octaveMin:k,octaveMax:S,instrumentEnabled:C,instrumentMin:P,instrumentMax:O,volumeEnabled:L,volumeMin:B,volumeMax:F,accentEnabled:R,accentDensity:X,slideEnabled:G,slideDensity:W,effectsEnabled:K});a(r,e)},[c,o,h,r,a,g,v,x,w,k,S,C,P,O,L,B,F,R,X,G,W,K]),J=l.useCallback(e=>{if(c){if(QF(c.rows))return p(e),void d(!0);Y(),"apply"===e&&t()}},[c,Y,t]),Q=l.useCallback(()=>{d(!1),Y(),"apply"===m&&t(),p(null)},[Y,t,m]);if(!o)return null;if(u)return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:()=>{d(!1),p(null)},children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-2 border-accent-warning rounded-lg shadow-2xl w-full max-w-sm",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-ft2-border bg-accent-warning/10",children:[Yn.jsxDEV(Xt,{size:20,className:"text-accent-warning"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:240,columnNumber:13},void 0),Yn.jsxDEV("h3",{className:"font-bold text-ft2-text",children:"Overwrite Channel?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:241,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:239,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"px-4 py-4 text-sm text-ft2-textDim",children:["Channel ",(r+1).toString().padStart(2,"0")," already contains note data. Randomizing will replace all existing data in this channel."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:243,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-ft2-border",children:[Yn.jsxDEV("button",{onClick:()=>{d(!1),p(null)},className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:248,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:Q,className:"px-4 py-2 bg-accent-warning hover:bg-accent-warning/80 text-black rounded transition-colors font-medium",children:"Overwrite"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:254,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:247,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:235,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:231,columnNumber:7},void 0);const Z="w-full px-3 py-1.5 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary text-sm",ee="accent-accent-primary";return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:t,children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(Qt,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:281,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-lg font-bold text-ft2-text",children:"Randomize"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:282,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:280,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:289,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:284,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:279,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-dark-bg",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-1 text-ft2-text",children:"Channel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:297,columnNumber:13},void 0),Yn.jsxDEV("select",{value:r,onChange:e=>i(parseInt(e.target.value)),className:Z,children:o.channels.map((e,t)=>Yn.jsxDEV("option",{value:t,children:[(t+1).toString().padStart(2,"0"),": ",e.name,QF(e.rows)?" *":""]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:304,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:298,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:296,columnNumber:11},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-sm font-medium mb-1 text-ft2-text",children:["Density: ",Yn.jsxDEV("span",{className:"font-mono text-accent-primary",children:[h,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:315,columnNumber:24},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:314,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:h,onChange:e=>f(parseInt(e.target.value)),className:"w-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:317,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:313,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 p-2 bg-dark-bgTertiary rounded",children:[Yn.jsxDEV("input",{type:"checkbox",checked:g,onChange:e=>b(e.target.checked),className:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:328,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-ft2-text w-16 shrink-0",children:"Note"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:329,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 flex gap-2",children:[Yn.jsxDEV("select",{value:v,onChange:e=>y(e.target.value),className:Z,disabled:!g,children:HO.map(e=>Yn.jsxDEV("option",{value:e,children:JO(e)},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:338,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:331,columnNumber:17},void 0),Yn.jsxDEV("select",{value:x,onChange:e=>N(e.target.value),className:`${Z} w-20 shrink-0`,disabled:!g,children:eU.map(e=>Yn.jsxDEV("option",{value:e,children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:348,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:341,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:330,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:327,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3 p-2 bg-dark-bgTertiary rounded",children:[Yn.jsxDEV("input",{type:"checkbox",checked:w,onChange:e=>E(e.target.checked),className:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:356,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-ft2-text w-16 shrink-0",children:"Octave"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:357,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 flex items-center gap-2 text-sm text-ft2-textDim",children:[Yn.jsxDEV("span",{children:"Min"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:359,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"number",min:0,max:7,value:k,onChange:e=>D(Math.min(parseInt(e.target.value)||0,S)),className:"w-14 px-2 py-1 bg-dark-bg text-ft2-text border border-ft2-border rounded text-center",disabled:!w},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:360,columnNumber:17},void 0),Yn.jsxDEV("span",{children:"Max"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:366,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"number",min:0,max:7,value:S,onChange:e=>M(Math.max(parseInt(e.target.value)||0,k)),className:"w-14 px-2 py-1 bg-dark-bg text-ft2-text border border-ft2-border rounded text-center",disabled:!w},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:367,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:358,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:355,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3 p-2 bg-dark-bgTertiary rounded",children:[Yn.jsxDEV("input",{type:"checkbox",checked:C,onChange:e=>V(e.target.checked),className:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:378,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-ft2-text w-16 shrink-0",children:"Instr"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:379,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 flex items-center gap-2 text-sm text-ft2-textDim",children:[Yn.jsxDEV("span",{children:"Min"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:381,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"number",min:1,max:128,value:P,onChange:e=>_(Math.min(parseInt(e.target.value)||1,O)),className:"w-14 px-2 py-1 bg-dark-bg text-ft2-text border border-ft2-border rounded text-center",disabled:!C},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:382,columnNumber:17},void 0),Yn.jsxDEV("span",{children:"Max"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:388,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"number",min:1,max:128,value:O,onChange:e=>T(Math.max(parseInt(e.target.value)||1,P)),className:"w-14 px-2 py-1 bg-dark-bg text-ft2-text border border-ft2-border rounded text-center",disabled:!C},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:389,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:380,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:377,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3 p-2 bg-dark-bgTertiary rounded",children:[Yn.jsxDEV("input",{type:"checkbox",checked:L,onChange:e=>A(e.target.checked),className:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:400,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-ft2-text w-16 shrink-0",children:"Volume"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:401,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 flex items-center gap-2 text-sm text-ft2-textDim",children:[Yn.jsxDEV("span",{children:"Min"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:403,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"number",min:0,max:64,value:B,onChange:e=>I(Math.min(parseInt(e.target.value)||0,F)),className:"w-14 px-2 py-1 bg-dark-bg text-ft2-text border border-ft2-border rounded text-center",disabled:!L},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:404,columnNumber:17},void 0),Yn.jsxDEV("span",{children:"Max"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:410,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"number",min:0,max:64,value:F,onChange:e=>U(Math.max(parseInt(e.target.value)||0,B)),className:"w-14 px-2 py-1 bg-dark-bg text-ft2-text border border-ft2-border rounded text-center",disabled:!L},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:411,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:402,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:399,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3 p-2 bg-dark-bgTertiary rounded",children:[Yn.jsxDEV("input",{type:"checkbox",checked:R,onChange:e=>j(e.target.checked),className:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:422,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-ft2-text w-16 shrink-0",children:"Accent"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:423,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:X,onChange:e=>z(parseInt(e.target.value)),className:"flex-1",disabled:!R},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:425,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-xs font-mono text-accent-primary w-10 text-right",children:[X,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:431,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:424,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:421,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3 p-2 bg-dark-bgTertiary rounded",children:[Yn.jsxDEV("input",{type:"checkbox",checked:G,onChange:e=>H(e.target.checked),className:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:437,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-ft2-text w-16 shrink-0",children:"Slide"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:438,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:W,onChange:e=>q(parseInt(e.target.value)),className:"flex-1",disabled:!G},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:440,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-xs font-mono text-accent-primary w-10 text-right",children:[W,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:446,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:439,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:436,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3 p-2 bg-dark-bgTertiary rounded",children:[Yn.jsxDEV("input",{type:"checkbox",checked:K,onChange:e=>$(e.target.checked),className:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:452,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-ft2-text w-16 shrink-0",children:"Effects"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:453,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-xs text-ft2-textDim",children:"Random from common types (arpeggio, vol slide, etc.)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:454,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:451,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:325,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:294,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-t border-ft2-border bg-dark-bgTertiary",children:[Yn.jsxDEV("button",{onClick:()=>J("randomize"),className:"flex items-center gap-2 px-3 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:[Yn.jsxDEV(zt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:465,columnNumber:13},void 0),"Randomize"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:461,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-2",children:[Yn.jsxDEV("button",{onClick:t,className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:470,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>J("apply"),className:"px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors font-medium",children:"Apply"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:476,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:469,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:460,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:274,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RandomizeDialog.tsx",lineNumber:270,columnNumber:5},void 0)},sU="#808080",aU=({onSeek:e})=>{const t=ID(e=>e.channelTrackTables),n=ID(e=>e.channelSpeeds),s=ID(e=>e.currentPositionIndex),a=jN(e=>e.speed);if(!t||0===t.length)return null;const o=t.length,r=Math.max(0,...t.map(e=>e.length)),i=Math.floor(3.5),l=Math.max(0,Math.min(s-i,r-7)),c=Math.min(r,l+7),u=Array.from({length:c-l},(e,t)=>l+t),d=36+52*o;return Yn.jsxDEV("div",{style:{width:d,height:146,overflow:"hidden",backgroundColor:"#000000",fontFamily:"JetBrains Mono, monospace",fontSize:11,userSelect:"none",flexShrink:0},children:[Yn.jsxDEV("div",{style:{display:"flex",height:20,lineHeight:"20px",borderBottom:"1px solid #333"},children:[Yn.jsxDEV("div",{style:{width:36,textAlign:"center",color:sU},children:"Pos"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:79,columnNumber:9},void 0),Array.from({length:o},(e,t)=>{const s=n?.[t],o=void 0!==s&&s!==a;return Yn.jsxDEV("div",{style:{width:52,textAlign:"center",color:sU,borderLeft:"1px solid #333",display:"flex",flexDirection:"column",justifyContent:"center",lineHeight:1.1,paddingTop:1},children:[Yn.jsxDEV("span",{children:["CH",t+1]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:97,columnNumber:15},void 0),o&&Yn.jsxDEV("span",{style:{fontSize:9,color:"#fbbf24"},children:["S:",s]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:99,columnNumber:17},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:86,columnNumber:13},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:73,columnNumber:7},void 0),u.map(n=>{const a=n===s;return Yn.jsxDEV("div",{onClick:()=>e?.(n),style:{display:"flex",height:18,lineHeight:"18px",backgroundColor:a?"#780000":"transparent",cursor:"pointer"},children:[Yn.jsxDEV("div",{style:{width:36,textAlign:"right",paddingRight:4,color:a?"#ffff88":sU},children:[a?">":"",n.toString().padStart(2,"0")]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:122,columnNumber:13},void 0),Array.from({length:o},(e,s)=>{const a=t[s]?.[n],o=void 0===a;return Yn.jsxDEV("div",{style:{width:52,textAlign:"center",borderLeft:"1px solid #222",color:o?sU:"#ffffff"},children:o?"":a.toString().padStart(3,"0")},s,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:136,columnNumber:17},void 0)})]},n,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:110,columnNumber:11},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLineTrackTableEditor.tsx",lineNumber:60,columnNumber:5},void 0)},oU=({onClose:e})=>{const t=ID(e=>!!e.channelTrackTables),n=ID(e=>e.patternOrder),s=ID(e=>e.currentPositionIndex),a=ID(e=>e.currentPatternIndex),o=ID(e=>e.addToOrder),r=ID(e=>e.removeFromOrder),i=ID(e=>e.duplicatePosition),c=ID(e=>e.clearOrder),u=ID(e=>e.reorderPositions),d=ID(e=>e.setCurrentPosition),[m,p]=l.useState(null),h=e=>{e.currentTarget.classList.remove("bg-accent-primary/20")},f=()=>{p(null),document.querySelectorAll(".bg-accent-primary\\/20").forEach(e=>{e.classList.remove("bg-accent-primary/20")})};return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl max-w-4xl w-full max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center justify-between bg-ft2-header",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-lg font-bold text-ft2-text",children:t?"Track Table":"Pattern Order"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:112,columnNumber:13},void 0),t?Yn.jsxDEV("span",{className:"text-xs text-accent-primary bg-accent-primary/10 px-1.5 py-0.5 rounded border border-accent-primary/30",children:"per-channel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:116,columnNumber:15},void 0):Yn.jsxDEV("span",{className:"text-sm text-ft2-textDim",children:["(",n.length," positions)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:120,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:111,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:e,className:"p-1 rounded hover:bg-dark-bgHover transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:128,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:123,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:110,columnNumber:9},void 0),!t&&Yn.jsxDEV("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center gap-2 bg-dark-bgTertiary",children:[Yn.jsxDEV("button",{onClick:()=>{o(a),_k.success(`Added Pattern ${a.toString(16).padStart(2,"0").toUpperCase()}`,2e3)},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Add current pattern to order",children:[Yn.jsxDEV(nt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:140,columnNumber:15},void 0),"Add Current Pattern"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:135,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>{confirm("Clear all positions? This will reset to just the first pattern.")&&(c(),_k.info("Pattern order cleared",2e3))},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Clear all positions",children:[Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:148,columnNumber:15},void 0),"Clear All"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:143,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"ml-auto text-xs text-ft2-textDim",children:["Current Pattern: ",a.toString(16).padStart(2,"0").toUpperCase()]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:151,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:134,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 bg-ft2-bg",children:t?Yn.jsxDEV(aU,{onSeek:e=>{d(e),pD().jumpToPosition(e,0)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:160,columnNumber:13},void 0):Yn.jsxDEV("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 xl:grid-cols-16 gap-2",children:n.map((e,t)=>Yn.jsxDEV("div",{draggable:!0,onDragStart:e=>((e,t)=>{p(t),e.dataTransfer.effectAllowed="move"})(e,t),onDragOver:e=>((e,t)=>{e.preventDefault(),null!==m&&m!==t&&e.currentTarget.classList.add("bg-accent-primary/20")})(e,t),onDragLeave:h,onDrop:e=>((e,t)=>{e.preventDefault(),e.currentTarget.classList.remove("bg-accent-primary/20"),null!==m&&m!==t&&(u(m,t),p(null),_k.success("Position reordered",2e3))})(e,t),onDragEnd:f,onClick:()=>d(t),onContextMenu:e=>{e.preventDefault(),e.shiftKey?(i(t),_k.success("Position duplicated",2e3)):(e.ctrlKey||e.metaKey)&&(e=>{n.length>1?(r(e),_k.info("Position removed",2e3)):_k.warning("Cannot remove last position",2e3)})(t)},className:`\n                    relative px-3 py-2 rounded border cursor-pointer transition-all\n                    ${t===s?"bg-dark-bgActive border-accent-primary text-accent-primary font-bold":"bg-dark-bgTertiary border-dark-border text-text-secondary hover:bg-dark-bgHover hover:border-dark-borderLight"}\n                    ${m===t?"opacity-50":""}\n                  `,title:`Position ${t.toString(16).padStart(2,"0").toUpperCase()}: Pattern ${e.toString(16).padStart(2,"0").toUpperCase()}\nClick to select\nShift+Click to duplicate\nCtrl+Click to remove\nDrag to reorder`,children:[Yn.jsxDEV("div",{className:"text-xs text-center leading-none opacity-60",children:t.toString(16).padStart(2,"0").toUpperCase()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:197,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"text-lg text-center font-mono leading-none mt-1",children:e.toString(16).padStart(2,"0").toUpperCase()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:200,columnNumber:19},void 0)]},`pos-${t}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:169,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:167,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:158,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-4 py-3 border-t border-ft2-border text-sm text-ft2-textDim bg-dark-bgTertiary",children:t?Yn.jsxDEV("span",{children:"Per-channel track table (read-only)  click a cell to seek to that position"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:212,columnNumber:15},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("strong",{children:"Controls:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:213,columnNumber:17},void 0)," Click: Select  Drag: Reorder  Shift+Click: Duplicate  Ctrl+Click: Remove"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:213,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:210,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:105,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/PatternOrderModal.tsx",lineNumber:101,columnNumber:5},void 0)},rU=Object.freeze(Object.defineProperty({__proto__:null,PatternOrderModal:oU},Symbol.toStringTag,{value:"Module"})),iU=({isOpen:e,onClose:t})=>{const{selection:n,strumSelection:s}=ID(),[a,o]=l.useState(1),[r,i]=l.useState("down"),c=()=>{n?(s(a,r),t()):alert("Please select a region first (Alt+Arrow keys to select)")},{shortcuts:u}=MT({isOpen:e,onConfirm:c,onCancel:t,confirmDisabled:!n});return Yn.jsxDEV(kT,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Yn.jsxDEV(DT,{title:"Strum / Arpeggiate",icon:Yn.jsxDEV(_e,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:55,columnNumber:15},void 0),onClose:t,theme:"modern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:53,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4",children:[Yn.jsxDEV("div",{className:"text-xs text-text-secondary",children:"Add incremental note delays (EDx) across channels to create a strum or arpeggio effect."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:61,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:"Ticks per channel (1-15)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:67,columnNumber:11},void 0),Yn.jsxDEV("input",{type:"number",value:a,onChange:e=>o(Math.max(1,Math.min(15,parseInt(e.target.value)||1))),min:1,max:15,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:70,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:66,columnNumber:9},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("label",{className:"block text-xs text-text-muted mb-1",children:"Direction"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:82,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[Yn.jsxDEV("button",{onClick:()=>i("down"),className:"px-3 py-2 text-xs rounded border transition-colors "+("down"===r?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Down (left to right)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:84,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>i("up"),className:"px-3 py-2 text-xs rounded border transition-colors "+("up"===r?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Up (right to left)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:94,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:83,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:81,columnNumber:9},void 0),!n&&Yn.jsxDEV("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:108,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:60,columnNumber:7},void 0),Yn.jsxDEV(ST,{theme:"modern",align:"right",children:[Yn.jsxDEV(TV,{variant:"ghost",onClick:t,children:["Cancel ",u.cancel&&Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:u.cancel},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:116,columnNumber:39},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:115,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"primary",onClick:c,disabled:!n,children:["Apply ",u.confirm&&!n?null:u.confirm&&Yn.jsxDEV("span",{className:"text-xs opacity-70 ml-2",children:u.confirm},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:123,columnNumber:80},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:118,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:114,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/StrumDialog.tsx",lineNumber:44,columnNumber:5},void 0)},lU=Object.freeze(Object.defineProperty({__proto__:null,StrumDialog:iU},Symbol.toStringTag,{value:"Module"})),cU=()=>{const e=ID(e=>e.macroSlots),t=ID(e=>e.writeMacroSlot),n=ID(e=>e.readMacroSlot),s=e=>null==e?"..":"string"==typeof e?e:e.toString(16).padStart(2,"0").toUpperCase();return Yn.jsxDEV("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[Yn.jsxDEV("h4",{className:"text-sm font-semibold text-neutral-100",children:"Macro Slots"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:24,columnNumber:9},void 0),Yn.jsxDEV("span",{className:"text-xs text-neutral-500",children:"FT2-Style Quick Entry"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:25,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:23,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:e.map((e,a)=>{const o=0===e.note&&0===e.instrument&&0===e.volume&&0===e.effTyp&&0===e.eff&&0===e.effTyp2&&0===e.eff2;return Yn.jsxDEV("div",{className:"flex items-center gap-2 p-2 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:[Yn.jsxDEV("div",{className:"flex items-center justify-center w-8 h-8 bg-neutral-700 border border-neutral-600 rounded text-xs font-bold text-neutral-300",children:a+1},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:43,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 font-mono text-xs text-neutral-300 flex items-center gap-1",children:[Yn.jsxDEV("span",{className:e.note?"text-blue-400":"text-neutral-600",children:e.note||"..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:48,columnNumber:17},void 0),Yn.jsxDEV("span",{className:null!==e.instrument?"text-green-400":"text-neutral-600",children:s(e.instrument)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:51,columnNumber:17},void 0),Yn.jsxDEV("span",{className:null!==e.volume?"text-yellow-400":"text-neutral-600",children:s(e.volume)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:54,columnNumber:17},void 0),Yn.jsxDEV("span",{className:0!==e.effTyp||0!==e.eff?"text-purple-400":"text-neutral-600",children:0!==e.effTyp||0!==e.eff?`${e.effTyp.toString(16).toUpperCase()}${e.eff.toString(16).padStart(2,"0").toUpperCase()}`:"..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:57,columnNumber:17},void 0),Yn.jsxDEV("span",{className:0!==e.effTyp2||0!==e.eff2?"text-pink-400":"text-neutral-600",children:0!==e.effTyp2||0!==e.eff2?`${e.effTyp2.toString(16).toUpperCase()}${e.eff2.toString(16).padStart(2,"0").toUpperCase()}`:"..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:62,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:47,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex gap-1",children:[Yn.jsxDEV("button",{onClick:()=>t(a),className:"px-2 py-1 text-xs font-medium text-neutral-300 bg-neutral-700 border border-neutral-600 rounded hover:bg-neutral-600 transition-colors",title:`Write current cell to slot ${a+1} (Ctrl+Shift+${a+1})`,children:"Write"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:70,columnNumber:17},void 0),Yn.jsxDEV("button",{onClick:()=>n(a),disabled:o,className:"px-2 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:`Paste macro slot ${a+1} (Ctrl+${a+1})`,children:"Read"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:77,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:69,columnNumber:15},void 0)]},a,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:39,columnNumber:13},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:28,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"mt-4 p-3 bg-neutral-800/50 border border-neutral-700 rounded text-xs text-neutral-400",children:[Yn.jsxDEV("div",{className:"font-semibold text-neutral-300 mb-2",children:"Keyboard Shortcuts:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:92,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"space-y-1",children:[Yn.jsxDEV("div",{className:"flex justify-between",children:[Yn.jsxDEV("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+1-8"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:95,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Read macro slot 1-8"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:98,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:94,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex justify-between",children:[Yn.jsxDEV("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+Shift+1-8"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:101,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Write current cell to slot 1-8"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:104,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:100,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:93,columnNumber:9},void 0),Yn.jsxDEV("p",{className:"mt-2 text-neutral-500",children:"Macros store cell data for quick entry. Perfect for repeated patterns!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:107,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:91,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MacroSlotsPanel.tsx",lineNumber:22,columnNumber:5},void 0)},uU=({onClose:e,onShowScaleVolume:t,onShowFadeVolume:n,onShowRemapInstrument:s,onExportPattern:a,onExportTrack:o,onReverse:r,onExpand:i,onShrink:c,onDuplicate:u,onMath:d})=>{const{selection:m}=ID(),[p,h]=l.useState("macros"),[f,g]=l.useState(1),[b,v]=l.useState("volume"),y=null!==m,x=e=>{h(p===e?null:e)};return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-2xl flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(Pe,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:61,columnNumber:13},void 0),Yn.jsxDEV("h2",{className:"text-lg font-bold text-ft2-text",children:"FT2 Advanced Edit"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:62,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:60,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:e,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:69,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:64,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:59,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[Yn.jsxDEV("div",{className:"border border-ft2-border rounded",children:[Yn.jsxDEV("button",{onClick:()=>x("volume"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Yn.jsxDEV("span",{children:"Volume Operations"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:81,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"volume"===p?"":""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:82,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:77,columnNumber:13},void 0),"volume"===p&&Yn.jsxDEV("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform volume values across selection, track, or pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:86,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[Yn.jsxDEV("button",{onClick:()=>t?.("block"),disabled:!y,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Scale Block"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:91,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>n?.("block"),disabled:!y,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Fade Block"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:98,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>t?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Track"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:105,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>n?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Track"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:111,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>t?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:117,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>n?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:123,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:90,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:85,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:76,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"border border-ft2-border rounded",children:[Yn.jsxDEV("button",{onClick:()=>x("blockops"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Yn.jsxDEV("span",{className:"flex items-center gap-2",children:[Yn.jsxDEV(Xe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:141,columnNumber:17},void 0),"Block Operations"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:140,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"blockops"===p?"":""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:144,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:136,columnNumber:13},void 0),"blockops"===p&&Yn.jsxDEV("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform selected block content"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:148,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[Yn.jsxDEV("button",{onClick:r,disabled:!y,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Yn.jsxDEV(Xe,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:158,columnNumber:21},void 0),"Reverse"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:153,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:u,disabled:!y,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Yn.jsxDEV(Je,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:166,columnNumber:21},void 0),"Duplicate"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:161,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:i,disabled:!y,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Yn.jsxDEV(yt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:174,columnNumber:21},void 0),"Expand 2x"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:169,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:c,disabled:!y,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Yn.jsxDEV(xt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:182,columnNumber:21},void 0),"Shrink 2x"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:177,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:152,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"mt-3 pt-2 border-t border-ft2-border",children:[Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mb-2 flex items-center gap-1",children:[Yn.jsxDEV(Zt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:190,columnNumber:21},void 0),"Math Operations"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:189,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1 mb-2",children:[Yn.jsxDEV("select",{value:b,onChange:e=>v(e.target.value),className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text",children:[Yn.jsxDEV("option",{value:"volume",children:"Volume"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:199,columnNumber:23},void 0),Yn.jsxDEV("option",{value:"eff",children:"Effect"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:200,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:194,columnNumber:21},void 0),Yn.jsxDEV("input",{type:"number",value:f,onChange:e=>{const t=Number(e.target.value);isNaN(t)||g(Math.max(0,Math.min(255,t)))},className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text w-16",min:0,max:255},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:202,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:193,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-4 gap-1",children:[Yn.jsxDEV("button",{onClick:()=>d?.("add",f,b),disabled:!y,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"+"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:212,columnNumber:21},void 0),Yn.jsxDEV("button",{onClick:()=>d?.("sub",f,b),disabled:!y,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:219,columnNumber:21},void 0),Yn.jsxDEV("button",{onClick:()=>d?.("mul",f,b),disabled:!y,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:226,columnNumber:21},void 0),Yn.jsxDEV("button",{onClick:()=>d?.("div",f,b),disabled:!y,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:233,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:211,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:188,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"text-[10px] text-ft2-textDim mt-1",children:"Alt+R = Reverse | Alt+D = Duplicate"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:243,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:147,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:135,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"border border-ft2-border rounded",children:[Yn.jsxDEV("button",{onClick:()=>x("remap"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Yn.jsxDEV("span",{className:"flex items-center gap-2",children:[Yn.jsxDEV(wt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:257,columnNumber:17},void 0),"Instrument Remap"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:256,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"remap"===p?"":""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:260,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:252,columnNumber:13},void 0),"remap"===p&&Yn.jsxDEV("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mb-2",children:"Find and replace instrument IDs"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:264,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[Yn.jsxDEV("button",{onClick:()=>s?.("block"),disabled:!y,className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Remap Block"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:269,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>s?.("track"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Track"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:276,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>s?.("pattern"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:282,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>s?.("song"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Song"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:288,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:268,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:263,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:251,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"border border-ft2-border rounded",children:[Yn.jsxDEV("button",{onClick:()=>x("export"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Yn.jsxDEV("span",{className:"flex items-center gap-2",children:[Yn.jsxDEV(Ge,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:306,columnNumber:17},void 0),"Export/Import"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:305,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"export"===p?"":""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:309,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:301,columnNumber:13},void 0),"export"===p&&Yn.jsxDEV("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mb-2",children:"Export patterns and tracks as FT2-compatible files"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:313,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[Yn.jsxDEV("button",{onClick:a,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[Yn.jsxDEV(Ge,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:322,columnNumber:21},void 0),"Pattern (.xp)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:318,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:o,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[Yn.jsxDEV(Ge,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:329,columnNumber:21},void 0),"Track (.xt)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:325,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:317,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mt-2",children:"Import: Use File  Open Module"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:334,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:312,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:300,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"border border-ft2-border rounded",children:[Yn.jsxDEV("button",{onClick:()=>x("help"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Yn.jsxDEV("span",{className:"flex items-center gap-2",children:[Yn.jsxDEV(en,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:348,columnNumber:17},void 0),"Help & Reference"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:347,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"help"===p?"":""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:351,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:343,columnNumber:13},void 0),"help"===p&&Yn.jsxDEV("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Yn.jsxDEV("div",{className:"text-xs text-ft2-textDim mb-2",children:"Quick access to command references and documentation"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:355,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[Yn.jsxDEV("button",{onClick:()=>{e();const t=new KeyboardEvent("keydown",{key:"?"});window.dispatchEvent(t)},className:"px-3 py-1.5 text-xs bg-neutral-700 hover:bg-neutral-600 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[Yn.jsxDEV(en,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:368,columnNumber:21},void 0),"Full Reference (?)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:360,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>{e();const t=new KeyboardEvent("keydown",{key:"?",shiftKey:!0});window.dispatchEvent(t)},className:"px-3 py-1.5 text-xs bg-pink-700 hover:bg-pink-600 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[Yn.jsxDEV(Pe,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:380,columnNumber:21},void 0),"Chip Reference"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:371,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:359,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:354,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:342,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"border border-ft2-border rounded",children:[Yn.jsxDEV("button",{onClick:()=>x("macros"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Yn.jsxDEV("span",{children:"Macro Slots"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:394,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"macros"===p?"":""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:395,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:390,columnNumber:13},void 0),"macros"===p&&Yn.jsxDEV("div",{className:"p-3 bg-dark-bgSecondary",children:Yn.jsxDEV(cU,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:399,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:398,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:389,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:74,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:54,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/AdvancedEditModal.tsx",lineNumber:50,columnNumber:5},void 0)},dU=Object.freeze(Object.defineProperty({__proto__:null,AdvancedEditModal:uU},Symbol.toStringTag,{value:"Module"})),mU=[{title:"Navigation",shortcuts:[{keys:"Arrow Up/Down",action:"Move cursor up/down"},{keys:"Arrow Left/Right",action:"Move cursor left/right"},{keys:"Tab / Shift+Tab",action:"Next/prev channel"},{keys:"PageUp / PageDown",action:"Jump 16 rows"},{keys:"Home / End",action:"Jump to first/last row"},{keys:"F9-F12",action:"Jump to 0%/25%/50%/75%"},{keys:"Shift+Arrow L/R",action:"Prev/next pattern"},{keys:"Alt+Q-I",action:"Jump to tracks 0-7"},{keys:"Alt+A-K",action:"Jump to tracks 8-15"}]},{title:"Playback",shortcuts:[{keys:"Space",action:"Stop / toggle edit mode"},{keys:"Right Shift",action:"Record + play pattern"},{keys:"Right Ctrl",action:"Play song"},{keys:"Right Alt",action:"Play pattern"},{keys:"Ctrl+Enter",action:"Play song"}]},{title:"Note Entry",shortcuts:[{keys:"Z-M (bottom row)",action:"Notes C-B (lower octave)"},{keys:"Q-P (top row)",action:"Notes C-E (upper octave)"},{keys:"F1-F7",action:"Select octave 1-7"},{keys:"Numpad +/-",action:"Octave up/down"},{keys:"CapsLock",action:"Note off"},{keys:"` / ~",action:"Edit step +1 / -1"}]},{title:"Editing",shortcuts:[{keys:"Delete",action:"Delete at cursor"},{keys:"Shift+Delete",action:"Delete entire cell"},{keys:"Backspace",action:"Delete previous & move up"},{keys:"Insert",action:"Insert row / toggle insert mode"},{keys:"Shift+Insert",action:"Insert entire line"}]},{title:"Block Operations",shortcuts:[{keys:"Alt+B / Alt+E",action:"Mark block start/end"},{keys:"Ctrl+C / Ctrl+X",action:"Copy / Cut"},{keys:"Ctrl+V",action:"Paste"},{keys:"Ctrl+Shift+V",action:"Mix paste (fill empty)"},{keys:"Ctrl+Shift+F",action:"Flood paste (to end)"},{keys:"F3 / F4 / F5",action:"Cut / Copy / Paste (FT2)"},{keys:"Alt+Arrow keys",action:"Extend selection"}]},{title:"Transpose",shortcuts:[{keys:"Ctrl+Up/Down",action:"Transpose 1 semitone"},{keys:"Ctrl+Shift+Up/Down",action:"Transpose 1 octave"},{keys:"Alt+T / Alt+Shift+T",action:"Block transpose 1"}]},{title:"Macros & Dialogs",shortcuts:[{keys:"Ctrl+1-8",action:"Recall macro slot"},{keys:"Ctrl+Shift+1-8",action:"Save macro slot"},{keys:"Ctrl+I",action:"Interpolate"},{keys:"Ctrl+H",action:"Humanize"},{keys:"Ctrl+F",action:"Find & Replace"},{keys:"Ctrl+O",action:"Import module"},{keys:"?",action:"This shortcut sheet"}]},{title:"Effect Commands",shortcuts:[{keys:"0xy",action:"Arpeggio"},{keys:"1/2xx",action:"Pitch slide up/down"},{keys:"3xx",action:"Tone portamento"},{keys:"4xy",action:"Vibrato"},{keys:"Axy",action:"Volume slide"},{keys:"Cxx",action:"Set volume (00-40)"},{keys:"Fxx",action:"Speed (01-1F) / BPM (20-FF)"},{keys:"Exy",action:"Extended commands"}]}],pU=({isOpen:e,onClose:t})=>{const n=l.useRef(null),[s,a]=l.useState("");if(l.useEffect(()=>{if(!e)return;const n=e=>{"Escape"===e.key&&(e.preventDefault(),t())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[e,t]),!e)return null;const o=s.toLowerCase(),r=mU.map(e=>({...e,shortcuts:e.shortcuts.filter(e=>e.keys.toLowerCase().includes(o)||e.action.toLowerCase().includes(o))})).filter(e=>e.shortcuts.length>0);return Yn.jsxDEV("div",{ref:n,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",onClick:t,children:Yn.jsxDEV("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[720px] max-w-[90vw] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-5 py-3 border-b border-neutral-700",children:[Yn.jsxDEV("h2",{className:"text-lg font-semibold text-neutral-100",children:"Keyboard Shortcuts"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:155,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("input",{type:"text",placeholder:"Filter...",value:s,onChange:e=>a(e.target.value),className:"bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 w-32 focus:outline-none focus:border-blue-500",autoFocus:!0,"aria-label":"Filter keyboard shortcuts"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:157,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:t,className:"text-neutral-400 hover:text-neutral-200 transition-colors",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:170,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:166,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:156,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:154,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"overflow-y-auto p-5",children:Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:r.map(e=>Yn.jsxDEV("div",{className:"space-y-1",children:[Yn.jsxDEV("h3",{className:"text-xs font-bold text-blue-400 uppercase tracking-wide mb-2",children:e.title},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:180,columnNumber:17},void 0),e.shortcuts.map((t,n)=>Yn.jsxDEV("div",{className:"flex items-center justify-between gap-2 py-0.5",children:[Yn.jsxDEV("kbd",{className:"text-[10px] font-mono bg-neutral-800 border border-neutral-600 rounded px-1.5 py-0.5 text-yellow-300 whitespace-nowrap",children:t.keys},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:185,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-[11px] text-neutral-300 text-right",children:t.action},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:188,columnNumber:21},void 0)]},`${e.title}-${n}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:184,columnNumber:19},void 0))]},e.title,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:179,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:177,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:176,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-5 py-2 border-t border-neutral-700 text-[10px] text-neutral-500 text-center",children:["Press ",Yn.jsxDEV("kbd",{className:"bg-neutral-800 border border-neutral-600 rounded px-1 text-yellow-400",children:"Esc"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:198,columnNumber:17},void 0)," to close"," "," | Ctrl/Cmd shown as Ctrl (use Cmd on macOS)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:197,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:149,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/KeyboardShortcutSheet.tsx",lineNumber:144,columnNumber:5},void 0)},hU=Object.freeze(Object.defineProperty({__proto__:null,KeyboardShortcutSheet:pU},Symbol.toStringTag,{value:"Module"})),fU={0:{command:"0xy",name:"Arpeggio",description:"Rapidly cycle between note, note+x semitones, note+y semitones",parameters:"x=1st offset (0-F hex), y=2nd offset (0-F hex)",tick:"tick-N",category:"misc"},1:{command:"1xx",name:"Pitch Slide Up",description:"Slide pitch upward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},2:{command:"2xx",name:"Pitch Slide Down",description:"Slide pitch downward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},3:{command:"3xx",name:"Tone Portamento",description:"Slide pitch toward target note",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},4:{command:"4xy",name:"Vibrato",description:"Oscillate pitch up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"pitch"},5:{command:"5xy",name:"Tone Porta + Vol Slide",description:"Continue tone portamento while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},6:{command:"6xy",name:"Vibrato + Vol Slide",description:"Continue vibrato while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},7:{command:"7xy",name:"Tremolo",description:"Oscillate volume up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"volume"},8:{command:"8xx",name:"Set Panning",description:"Set channel panning position",parameters:"xx=position (00=left, 80=center, FF=right)",tick:"tick-0",category:"panning"},9:{command:"9xx",name:"Sample Offset",description:"Start sample playback at offset",parameters:"xx=offset (multiply by 256 samples)",tick:"tick-0",category:"sample"},A:{command:"Axy",name:"Volume Slide",description:"Slide volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"volume"},B:{command:"Bxx",name:"Position Jump",description:"Jump to pattern in order list",parameters:"xx=position (00-FF hex)",tick:"tick-0",category:"global"},C:{command:"Cxx",name:"Set Volume",description:"Set channel volume directly",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"volume"},D:{command:"Dxx",name:"Pattern Break",description:"Break pattern and jump to row in next pattern",parameters:"xx=row (00-3F hex, 0-63 decimal)",tick:"tick-0",category:"global"},E:{command:"Exy",name:"Extended Command",description:"Extended effects (see E-commands)",parameters:"x=sub-command (0-F), y=parameter",tick:"both",category:"misc"},F:{command:"Fxx",name:"Set Speed/BPM",description:"Set speed (01-1F) or BPM (20-FF)",parameters:"xx=speed/BPM (01-1F=speed, 20-FF=BPM)",tick:"tick-0",category:"global"},G:{command:"Gxx",name:"Set Global Volume",description:"Set global volume for all channels",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"global"},H:{command:"Hxy",name:"Global Volume Slide",description:"Slide global volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"global"},W:{command:"Wxx",name:"Global Pitch Shift",description:"DJ-style pitch shift affecting entire song playback (like a turntable)",parameters:"xx=pitch (00=-12 semitones, 80=0/neutral, FF=+12 semitones)",tick:"tick-0",category:"global"},Z:{command:"Zxx",name:"MIDI Macro",description:"IT-style filter control (cutoff/resonance/mode)",parameters:"xx: 00-7F=cutoff, 80-8F=resonance, 90-9F=filter mode",tick:"tick-0",category:"misc"}},gU={E0:{command:"E0x",name:"Set Filter (Amiga)",description:"Enable/disable Amiga LED filter",parameters:"x=0 (filter on) or 1 (filter off)",tick:"tick-0",category:"misc"},E1:{command:"E1x",name:"Fine Pitch Slide Up",description:"Slide pitch up once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E2:{command:"E2x",name:"Fine Pitch Slide Down",description:"Slide pitch down once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E3:{command:"E3x",name:"Glissando Control",description:"Enable/disable glissando (semitone portamento)",parameters:"x=0 (off) or 1 (on)",tick:"tick-0",category:"pitch"},E4:{command:"E4x",name:"Set Vibrato Waveform",description:"Set vibrato waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"pitch"},E5:{command:"E5x",name:"Set Finetune",description:"Set sample finetune",parameters:"x=finetune (-8 to +7, stored as 0-F)",tick:"tick-0",category:"sample"},E6:{command:"E6x",name:"Pattern Loop",description:"Loop pattern section",parameters:"x=0 (set loop start) or 1-F (loop count)",tick:"tick-0",category:"global"},E7:{command:"E7x",name:"Set Tremolo Waveform",description:"Set tremolo waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"volume"},E8:{command:"E8x",name:"Set Panning (Fine)",description:"Set panning with fine control",parameters:"x=panning (0=left, 8=center, F=right)",tick:"tick-0",category:"panning"},E9:{command:"E9x",name:"Retrigger Note",description:"Retrigger note every x ticks",parameters:"x=retrigger rate (1-F ticks)",tick:"tick-N",category:"timing"},EA:{command:"EAx",name:"Fine Volume Slide Up",description:"Slide volume up once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EB:{command:"EBx",name:"Fine Volume Slide Down",description:"Slide volume down once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EC:{command:"ECx",name:"Note Cut",description:"Cut note (set volume to 0) at tick x",parameters:"x=tick to cut (0=immediate, 1-F=delayed)",tick:"both",category:"timing"},ED:{command:"EDx",name:"Note Delay",description:"Delay note trigger by x ticks",parameters:"x=delay in ticks (0-F)",tick:"tick-N",category:"timing"},EE:{command:"EEx",name:"Pattern Delay",description:"Delay pattern by x rows",parameters:"x=rows to delay (0-F)",tick:"tick-0",category:"global"},EF:{command:"EFx",name:"Funk Repeat (Invert Loop)",description:"Invert sample loop at speed x (Amiga)",parameters:"x=invert speed (0-F)",tick:"tick-N",category:"sample"}},bU={10:{command:"10xx",name:"Set LFO Speed",description:"Set the LFO speed for FM chip vibrato/tremolo",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set TL (Total Level)",description:"Set operator total level (volume)",parameters:"xx=TL value (00-7F, lower=louder)",tick:"tick-0",category:"volume"},12:{command:"12xx",name:"Set AR (Attack Rate)",description:"Set operator attack rate",parameters:"xx=AR value (00-1F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set DR (Decay Rate)",description:"Set operator decay rate",parameters:"xx=DR value (00-1F)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set MULT (Multiplier)",description:"Set operator frequency multiplier",parameters:"xx=MULT value (00-0F)",tick:"tick-0",category:"pitch"},15:{command:"15xx",name:"Set RR (Release Rate)",description:"Set operator release rate",parameters:"xx=RR value (00-0F)",tick:"tick-0",category:"misc"},16:{command:"16xx",name:"Set SL (Sustain Level)",description:"Set operator sustain level",parameters:"xx=SL value (00-0F)",tick:"tick-0",category:"volume"},17:{command:"17xx",name:"Set DT (Detune)",description:"Set operator detune",parameters:"xx=DT value (00-07)",tick:"tick-0",category:"pitch"},18:{command:"18xx",name:"Set SSG-EG",description:"Set SSG envelope generator mode",parameters:"xx=SSG-EG mode (00-0F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"Set Algorithm",description:"Set FM algorithm (operator routing)",parameters:"xx=algorithm (00-07)",tick:"tick-0",category:"misc"},"1A":{command:"1Axx",name:"Set Feedback",description:"Set operator 1 feedback level",parameters:"xx=feedback (00-07)",tick:"tick-0",category:"misc"},"1B":{command:"1Bxy",name:"Set AM/PM Depth",description:"Set amplitude/phase modulation depth",parameters:"x=AM depth (0-3), y=PM depth (0-7)",tick:"tick-0",category:"misc"},"1C":{command:"1Cxx",name:"FM Hard Reset",description:"Force hard reset on note (key-off before key-on)",parameters:"xx=01 (enable), 00 (disable)",tick:"tick-0",category:"misc"}},vU={10:{command:"10xx",name:"Set Filter Cutoff",description:"Set SID filter cutoff frequency",parameters:"xx=cutoff (00-FF, 11-bit scaled)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Filter Resonance",description:"Set SID filter resonance",parameters:"xx=resonance (00-0F)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Filter Mode",description:"Set SID filter mode",parameters:"xx: 0=off, 1=LP, 2=BP, 4=HP (can combine)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Ring Mod",description:"Enable/disable ring modulation",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Hard Sync",description:"Enable/disable oscillator hard sync",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pulse Width",description:"Set pulse wave width",parameters:"xx=pulse width (00-FF, scaled to 12-bit)",tick:"tick-0",category:"misc"}},yU={11:{command:"11xx",name:"Set DMC",description:"Set DMC sample parameters",parameters:"xx=DMC control value",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty/Noise",description:"Set pulse duty or noise mode",parameters:"xx: pulse 0-3=duty, noise 0=short 1=long",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (pulse channels)",parameters:"x=period, y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Envelope Mode",description:"Set envelope/length counter mode",parameters:"xx=envelope settings",tick:"tick-0",category:"misc"},18:{command:"18xx",name:"FDS Mod Depth",description:"Set FDS modulation depth",parameters:"xx=mod depth (00-3F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"FDS Mod Speed High",description:"Set FDS modulation speed (high byte)",parameters:"xx=speed high byte",tick:"tick-0",category:"misc"}},xU={10:{command:"10xx",name:"Set Envelope Shape",description:"Set AY envelope shape",parameters:"xx=shape (00-0F)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Envelope Period Low",description:"Set AY envelope period (low byte)",parameters:"xx=period low byte",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Envelope Period High",description:"Set AY envelope period (high byte)",parameters:"xx=period high byte",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Auto-Envelope",description:"Enable auto-envelope (track note pitch)",parameters:"xx=auto-envelope numerator",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Noise Freq",description:"Set noise frequency",parameters:"xx=noise period (00-1F)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Noise Mode",description:"Set noise/tone mixing mode",parameters:"xx=mode bits (tone/noise enable)",tick:"tick-0",category:"misc"}},NU={10:{command:"10xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Wave Position",description:"Set wave position in RAM",parameters:"xx=position (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave Length",description:"Set wave length",parameters:"xx=length (must be power of 2)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Wave Load",description:"Load wave from position",parameters:"xx=load parameters",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Channel Limit",description:"Set max active channels (N163)",parameters:"xx=channel count (1-8)",tick:"tick-0",category:"misc"}},wU={10:{command:"10xx",name:"Set Sample Mode",description:"Set sample playback mode",parameters:"xx=mode (chip-specific)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Sample Bank",description:"Set sample bank",parameters:"xx=bank number",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Direction",description:"Set sample playback direction",parameters:"xx: 0=forward, 1=reverse",tick:"tick-0",category:"sample"},20:{command:"20xx",name:"ES5506 Filter Mode",description:"Set ES5506 filter mode",parameters:"xx=filter mode (00-03)",tick:"tick-0",category:"misc"},21:{command:"21xx",name:"ES5506 Filter K1",description:"Set ES5506 filter K1 coefficient",parameters:"xx=K1 value",tick:"tick-0",category:"misc"},22:{command:"22xx",name:"ES5506 Filter K2",description:"Set ES5506 filter K2 coefficient",parameters:"xx=K2 value",tick:"tick-0",category:"misc"},30:{command:"30xx",name:"QSound Echo",description:"Set QSound echo feedback",parameters:"xx=echo feedback",tick:"tick-0",category:"misc"},31:{command:"31xx",name:"QSound Surround",description:"Set QSound surround/3D position",parameters:"xx=surround position",tick:"tick-0",category:"panning"}},EU={FurnaceOPN:bU,FurnaceOPN2:bU,FurnaceOPM:bU,FurnaceOPL:bU,FurnaceOPL2:bU,FurnaceOPL3:bU,FurnaceOPLL:bU,FurnaceOPZ:bU,FurnaceESFM:bU,FurnaceC64:vU,FurnaceSID2:vU,FurnaceSID3:vU,FurnaceGB:{10:{command:"10xx",name:"Set Envelope",description:"Set volume envelope (NRx2 register)",parameters:"xx: high nibble=volume, low nibble=direction+period",tick:"tick-0",category:"volume"},11:{command:"11xx",name:"Set Wave",description:"Load wavetable into wave channel",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty",description:"Set pulse wave duty cycle",parameters:"xx: 0=12.5%, 1=25%, 2=50%, 3=75%",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (channel 1 only)",parameters:"x=period (0-7), y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Noise Mode",description:"Set noise channel width mode",parameters:"xx: 0=15-bit (normal), 1=7-bit (metallic)",tick:"tick-0",category:"misc"}},FurnaceNES:yU,FurnaceFDS:yU,FurnaceVRC6:yU,Furnace5E01:yU,FurnacePCE:{10:{command:"10xx",name:"Set LFO Mode",description:"Set PCE LFO mode",parameters:"xx=LFO mode (00-03)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set LFO Speed",description:"Set PCE LFO speed",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"}},FurnaceAY:xU,FurnaceAY8930:xU,FurnaceSAA:xU,FurnaceSMS:xU,FurnaceT6W28:xU,FurnaceN163:NU,FurnaceSCC:NU,FurnaceVB:NU,FurnaceSWAN:NU,FurnaceX1_010:NU,FurnaceSNES:{10:{command:"10xx",name:"Set Echo Enable",description:"Enable/disable echo for channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Echo Delay",description:"Set echo delay time",parameters:"xx=delay (00-0F, 16ms steps)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Echo Feedback",description:"Set echo feedback amount",parameters:"xx=feedback (-80 to 7F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Echo Volume",description:"Set echo volume",parameters:"xx=volume (-80 to 7F)",tick:"tick-0",category:"volume"},14:{command:"14xx",name:"Set Echo FIR",description:"Set echo FIR filter coefficient",parameters:"xx=coefficient index and value",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pitch Mod",description:"Enable pitch modulation from prev channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"pitch"},16:{command:"16xx",name:"Set Gain Mode",description:"Set ADSR/gain mode",parameters:"xx=gain mode (see SNES docs)",tick:"tick-0",category:"misc"},17:{command:"17xx",name:"Set Invert",description:"Invert waveform phase",parameters:"xx: 1=left, 2=right, 3=both",tick:"tick-0",category:"misc"}},FurnaceAmiga:wU,FurnaceSEGAPCM:wU,FurnaceQSOUND:wU,FurnaceES5506:wU,FurnaceRF5C68:wU,FurnaceC140:wU,FurnaceC219:wU,FurnaceK054539:wU,FurnaceYMZ280B:wU,FurnaceGA20:wU,FurnaceK007232:wU,FurnaceK053260:wU,FurnaceOKI:wU};const kU={pitch:"Pitch",volume:"Volume",panning:"Panning",timing:"Timing",global:"Global",sample:"Sample",misc:"Misc",chip:"Chip"},DU=["pitch","volume","panning","timing","global","sample","misc"],SU={pitch:"text-blue-400",volume:"text-emerald-400",panning:"text-purple-400",timing:"text-yellow-400",global:"text-red-400",sample:"text-cyan-400",misc:"text-orange-400",chip:"text-pink-400"},MU=({isOpen:e,position:t,onSelect:n,onClose:s,synthType:a})=>{const[o,r]=l.useState(""),[i,c]=l.useState("all"),u=l.useRef(null),d=l.useRef(null);l.useEffect(()=>{e&&d.current&&d.current.focus()},[e]),l.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&(e.preventDefault(),s())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,s]);const m=a&&function(e){return e.startsWith("Furnace")||e in EU}(a),p=l.useMemo(()=>{const e=[];if(Object.entries(fU).forEach(([t,n])=>{e.push({...n,key:t,isExtended:!1,isFurnace:!1})}),Object.entries(gU).forEach(([t,n])=>{e.push({...n,key:t,isExtended:!0,isFurnace:!1})}),m&&a){const t=function(e){return e&&EU[e]?Object.values(EU[e]):Object.values(bU)}(a);t.forEach(t=>{const n=t.command.substring(0,2);e.push({...t,key:n,isExtended:!1,isFurnace:!0,category:"misc"})})}return e},[m,a]),h=l.useMemo(()=>{const e=o.toLowerCase();return p.filter(t=>{if("chip"===i){if(!t.isFurnace)return!1}else if("all"!==i){if(t.isFurnace)return!1;if(t.category!==i)return!1}return!o||(t.name.toLowerCase().includes(e)||t.command.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))})},[p,o,i]);if(!e)return null;const f=t?{position:"fixed",left:Math.max(0,Math.min(t.x,window.innerWidth-400)),top:Math.max(0,Math.min(t.y,window.innerHeight-500)),zIndex:60}:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:60};return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/40 z-50",onClick:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:167,columnNumber:7},void 0),Yn.jsxDEV("div",{ref:u,className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[380px] max-h-[480px] flex flex-col z-[60]",style:f,children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("h3",{className:"text-sm font-semibold text-neutral-100",children:"Effect Commands"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:176,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>{s();const e=new KeyboardEvent("keydown",{key:"?"});window.dispatchEvent(e)},className:"p-1 text-neutral-500 hover:text-accent-primary transition-colors",title:"Open full reference",children:Yn.jsxDEV(mt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:188,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:177,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:175,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:s,className:"text-neutral-400 hover:text-neutral-200","aria-label":"Close effect picker",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:192,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:191,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:174,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-3 py-2 border-b border-neutral-800",children:Yn.jsxDEV("input",{ref:d,type:"text",placeholder:"Search effects...",value:o,onChange:e=>r(e.target.value),className:"w-full bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 focus:outline-none focus:border-blue-500","aria-label":"Search effects"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:198,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:197,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex flex-wrap gap-1 px-3 py-1.5 border-b border-neutral-800",children:[Yn.jsxDEV("button",{onClick:()=>c("all"),className:"px-2 py-0.5 text-[10px] rounded "+("all"===i?"bg-neutral-700 text-white":"text-neutral-400 hover:text-neutral-200"),children:"All"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:211,columnNumber:11},void 0),DU.map(e=>Yn.jsxDEV("button",{onClick:()=>c(e),className:"px-2 py-0.5 text-[10px] rounded "+(i===e?"bg-neutral-700 text-white":`${SU[e]} hover:opacity-80`),children:kU[e]},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:222,columnNumber:13},void 0)),m&&Yn.jsxDEV("button",{onClick:()=>c("chip"),className:"px-2 py-0.5 text-[10px] rounded "+("chip"===i?"bg-pink-700 text-white":`${SU.chip} hover:opacity-80`),children:[kU.chip," (",a?.replace("Furnace",""),")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:236,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:210,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"overflow-y-auto flex-1 p-1",children:0===h.length?Yn.jsxDEV("div",{className:"text-center text-neutral-500 text-xs py-4",children:"No effects match"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:252,columnNumber:13},void 0):h.map(e=>{const t=e.isFurnace?SU.chip:SU[e.category];return Yn.jsxDEV("button",{onClick:()=>(e=>{if(e.isExtended){const t=parseInt(e.key.substring(1),16);n(14,t<<4)}else if(e.isFurnace){const t=parseInt(e.key,16);n(t,0)}else{const t=parseInt(e.key,16);n(t,0)}s()})(e),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded hover:bg-neutral-800 transition-colors text-left group",children:[Yn.jsxDEV("span",{className:`font-mono text-xs font-bold w-8 ${t}`,children:e.command.substring(0,3)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:264,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex-1 min-w-0",children:[Yn.jsxDEV("div",{className:"text-xs text-neutral-200 truncate",children:[e.name,e.isFurnace&&Yn.jsxDEV("span",{className:"ml-1 text-[9px] text-pink-400",children:"(Chip)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:270,columnNumber:41},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:268,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"text-[10px] text-neutral-500 truncate",children:e.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:272,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:267,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-neutral-600 group-hover:text-neutral-400",children:"tick-0"===e.tick?"T0":"tick-N"===e.tick?"TN":"T*"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:274,columnNumber:19},void 0)]},e.isFurnace?`f-${e.key}`:e.isExtended?`e-${e.key}`:`n-${e.key}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:259,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:250,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:168,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/EffectPicker.tsx",lineNumber:166,columnNumber:5},void 0)},CU=Object.freeze(Object.defineProperty({__proto__:null,EffectPicker:MU},Symbol.toStringTag,{value:"Module"})),VU={"text-blue-400":"bg-blue-400","text-green-400":"bg-green-400","text-yellow-400":"bg-yellow-400","text-red-400":"bg-red-400","text-purple-400":"bg-purple-400","text-orange-400":"bg-orange-400","text-cyan-400":"bg-cyan-400","text-neutral-400":"bg-neutral-400"},PU=e=>VU[e]||"bg-neutral-400",_U=({isOpen:e,onClose:t})=>{const{undoStack:n,redoStack:s,undo:a,redo:o}=CD();if(!e)return null;const r=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return Yn.jsxDEV("div",{className:"absolute right-0 top-0 w-64 h-full bg-neutral-900 border-l border-neutral-700 flex flex-col z-30 shadow-xl",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(tn,{size:14,className:"text-neutral-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:46,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-xs font-semibold text-neutral-200",children:"History"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:47,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:45,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV("button",{onClick:a,disabled:0===n.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Undo","aria-label":"Undo",children:Yn.jsxDEV(nn,{size:12,className:"text-neutral-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:57,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:50,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:o,disabled:0===s.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Redo","aria-label":"Redo",children:Yn.jsxDEV(sn,{size:12,className:"text-neutral-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:66,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:59,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors text-xs","aria-label":"Close history panel",children:"x"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:68,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:49,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:44,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto",children:[s.length>0&&Yn.jsxDEV("div",{className:"opacity-40",children:[Yn.jsxDEV("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Redo (",s.length,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:83,columnNumber:13},void 0),[...s].reverse().map((e,t)=>Yn.jsxDEV("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>o(),title:"Redo one step",children:[Yn.jsxDEV("div",{className:`w-1.5 h-1.5 rounded-full ${PU(PD(e.type))}`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:93,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex-1 min-w-0",children:Yn.jsxDEV("div",{className:"text-[10px] text-neutral-400 truncate",children:VD(e.type)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:95,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:94,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-neutral-600",children:r(e.timestamp)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:99,columnNumber:17},void 0)]},`redo-${e.id}-${t}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:87,columnNumber:15},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:82,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"px-3 py-1 bg-blue-900/30 border-y border-blue-800/50",children:Yn.jsxDEV("span",{className:"text-[10px] text-blue-400 font-medium",children:"Current State"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:107,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:106,columnNumber:9},void 0),n.length>0?Yn.jsxDEV("div",{children:[Yn.jsxDEV("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Undo (",n.length,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:113,columnNumber:13},void 0),[...n].reverse().map((e,t)=>Yn.jsxDEV("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>a(),title:"Undo one step",children:[Yn.jsxDEV("div",{className:`w-1.5 h-1.5 rounded-full ${PU(PD(e.type))}`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:123,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex-1 min-w-0",children:[Yn.jsxDEV("div",{className:"text-[10px] text-neutral-300 truncate",children:VD(e.type)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:125,columnNumber:19},void 0),e.description&&Yn.jsxDEV("div",{className:"text-[9px] text-neutral-500 truncate",children:e.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:129,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:124,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-neutral-600",children:r(e.timestamp)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:132,columnNumber:17},void 0)]},`undo-${e.id}-${t}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:117,columnNumber:15},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:112,columnNumber:11},void 0):Yn.jsxDEV("div",{className:"text-center text-neutral-600 text-xs py-8",children:"No history yet"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:137,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:79,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"px-3 py-1.5 border-t border-neutral-700 text-[9px] text-neutral-600 text-center",children:"Ctrl+Z undo | Ctrl+Y redo"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:142,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/UndoHistoryPanel.tsx",lineNumber:42,columnNumber:5},void 0)},OU=Object.freeze(Object.defineProperty({__proto__:null,UndoHistoryPanel:_U},Symbol.toStringTag,{value:"Module"})),TU=({isOpen:e,onClose:t})=>{const{patterns:n,patternOrder:s,currentPositionIndex:a,setCurrentPosition:o,addToOrder:r,removeFromOrder:i}=ID(us(e=>({patterns:e.patterns,patternOrder:e.patternOrder,currentPositionIndex:e.currentPositionIndex,setCurrentPosition:e.setCurrentPosition,addToOrder:e.addToOrder,removeFromOrder:e.removeFromOrder}))),c=l.useCallback(e=>{o(e)},[o]),u=l.useCallback(()=>{r(0)},[r]),d=l.useCallback(e=>{s.length>1&&i(e)},[i,s.length]),m=l.useCallback((e,t)=>{ID.setState(n=>{const s=[...n.patternOrder];return s[e]=t,{patternOrder:s}})},[]);return e?Yn.jsxDEV("div",{className:"absolute left-0 top-0 w-56 h-full bg-neutral-900 border-r border-neutral-700 flex flex-col z-30 shadow-xl",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[Yn.jsxDEV("span",{className:"text-xs font-semibold text-neutral-200",children:"Pattern Matrix"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:65,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors",children:Yn.jsxDEV(Ce,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:70,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:66,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:64,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-2",children:Yn.jsxDEV("table",{className:"w-full border-collapse",children:[Yn.jsxDEV("thead",{children:Yn.jsxDEV("tr",{children:[Yn.jsxDEV("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pos"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:79,columnNumber:15},void 0),Yn.jsxDEV("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:80,columnNumber:15},void 0),Yn.jsxDEV("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-right",children:"Len"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:81,columnNumber:15},void 0),Yn.jsxDEV("th",{className:"w-6"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:82,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:78,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:77,columnNumber:11},void 0),Yn.jsxDEV("tbody",{children:s.map((e,t)=>{const o=t===a,r=n[e];return Yn.jsxDEV("tr",{className:"cursor-pointer transition-colors "+(o?"bg-blue-900/40 text-blue-300":"hover:bg-neutral-800 text-neutral-300"),onClick:()=>c(t),children:[Yn.jsxDEV("td",{className:"text-[10px] font-mono px-1 py-0.5 text-neutral-500",children:t.toString(16).toUpperCase().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:99,columnNumber:19},void 0),Yn.jsxDEV("td",{className:"px-1 py-0.5",children:Yn.jsxDEV("select",{value:e,onChange:e=>{e.stopPropagation(),m(t,parseInt(e.target.value))},onClick:e=>e.stopPropagation(),className:"w-full bg-transparent text-[10px] font-mono cursor-pointer focus:outline-none "+(o?"text-blue-300":"text-neutral-300"),children:n.map((e,t)=>Yn.jsxDEV("option",{value:t,className:"bg-neutral-900 text-neutral-200",children:[t.toString(16).toUpperCase().padStart(2,"0"),n[t]?.name?` ${n[t].name}`:""]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:115,columnNumber:25},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:103,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:102,columnNumber:19},void 0),Yn.jsxDEV("td",{className:"text-[10px] font-mono px-1 py-0.5 text-right text-neutral-500",children:r?.length||"?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:122,columnNumber:19},void 0),Yn.jsxDEV("td",{className:"px-0.5 py-0.5",children:Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),d(t)},className:"p-0.5 rounded hover:bg-red-900/50 text-neutral-600 hover:text-red-400 transition-colors",title:"Remove position",disabled:s.length<=1,children:Yn.jsxDEV(Ce,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:135,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:126,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:125,columnNumber:19},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:90,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:85,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:76,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:75,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"px-3 py-2 border-t border-neutral-700 flex items-center justify-between",children:[Yn.jsxDEV("span",{className:"text-[9px] text-neutral-500",children:[s.length," positions | ",n.length," patterns"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:147,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-[10px] bg-neutral-800 hover:bg-neutral-700 text-neutral-300 rounded transition-colors",children:[Yn.jsxDEV(nt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:154,columnNumber:11},void 0),"Add"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:150,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:146,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMatrix.tsx",lineNumber:62,columnNumber:5},void 0):null},LU=Object.freeze(Object.defineProperty({__proto__:null,PatternMatrix:TU},Symbol.toStringTag,{value:"Module"})),AU=({label:e,value:t,onChange:n,min:s=0,max:a=999,step:o=1,format:r="decimal",throttleMs:i=0,presets:c})=>{const u=l.useRef(null),d=l.useRef(null),m=l.useRef(t),p=l.useRef(0),h=l.useRef(null),[f,g]=l.useState(!1),[b,v]=l.useState({x:0,y:0});l.useEffect(()=>{m.current=t},[t]),l.useEffect(()=>()=>{u.current&&clearInterval(u.current),d.current&&clearTimeout(d.current)},[]),l.useEffect(()=>{if(!f)return;const e=e=>{h.current&&!h.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]);const y=l.useCallback(e=>{c&&0!==c.length&&(e.preventDefault(),v({x:e.clientX,y:e.clientY}),g(!0))},[c]),x=l.useCallback(e=>{n(e),g(!1)},[n]),N=l.useCallback(e=>{const t=Date.now();i>0&&t-p.current<i||(p.current=t,n(e))},[n,i]),w=l.useCallback(()=>{const e=Math.min(a,m.current+o);m.current=e,N(e)},[a,o,N]),E=l.useCallback(()=>{const e=Math.max(s,m.current-o);m.current=e,N(e)},[s,o,N]),k=l.useCallback(e=>{e(),d.current&&clearTimeout(d.current),u.current&&clearInterval(u.current),d.current=window.setTimeout(()=>{u.current=window.setInterval(e,80)},300)},[]),D=l.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u.current&&(clearInterval(u.current),u.current=null)},[]);return Yn.jsxDEV("div",{ref:h,className:"ft2-numeric-group",onContextMenu:y,title:c?"Right-click for presets":void 0,children:[Yn.jsxDEV("span",{className:"ft2-numeric-label",children:[e,":"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:149,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"ft2-numeric-value",children:(S=t,"hex"===r?S.toString(16).toUpperCase().padStart(2,"0"):S.toString().padStart(3,"0"))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:150,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"ft2-numeric-arrows",children:[Yn.jsxDEV("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>k(w),onMouseUp:D,onMouseLeave:D,onTouchStart:()=>k(w),onTouchEnd:D,title:`Increase ${e}`,children:Yn.jsxDEV("span",{className:"ft2-arrow-icon",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:163,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:154,columnNumber:9},void 0),Yn.jsxDEV("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>k(E),onMouseUp:D,onMouseLeave:D,onTouchStart:()=>k(E),onTouchEnd:D,title:`Decrease ${e}`,children:Yn.jsxDEV("span",{className:"ft2-arrow-icon",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:174,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:165,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:153,columnNumber:7},void 0),f&&c&&Yn.jsxDEV("div",{className:"ft2-presets-menu",style:{position:"fixed",left:b.x,top:b.y,zIndex:1e3,backgroundColor:"#1a1a1d",border:"1px solid #333",borderRadius:"4px",padding:"4px 0",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",minWidth:"100px"},children:c.map(e=>Yn.jsxDEV("button",{onClick:()=>x(e.value),className:"ft2-preset-item",style:{display:"block",width:"100%",padding:"6px 12px",textAlign:"left",background:t===e.value?"#333":"transparent",border:"none",color:t===e.value?"#ef4444":"#e0e0e0",cursor:"pointer",fontSize:"12px",fontFamily:"monospace"},onMouseEnter:e=>e.currentTarget.style.background="#2a2a2d",onMouseLeave:n=>n.currentTarget.style.background=t===e.value?"#333":"transparent",children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:196,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:180,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2NumericInput.tsx",lineNumber:143,columnNumber:5},void 0);var S};function BU(e){const[t,n]=l.useState(0),[s,a]=l.useState(null),[o,r]=l.useState(!1),i=l.useRef([]),c=l.useRef(null),u=l.useCallback(()=>{i.current=[],n(0),a(null),r(!1),c.current&&(clearTimeout(c.current),c.current=null)},[]);l.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]);return{bpm:s,tapCount:t,isActive:o,tap:l.useCallback(()=>{const t=performance.now();c.current&&clearTimeout(c.current);const s=i.current[i.current.length-1];s&&t-s>2e3&&(i.current=[]),i.current.push(t),r(!0),i.current.length>8&&(i.current=i.current.slice(-8));const o=i.current;if(n(o.length),o.length>=2){const t=[];for(let e=1;e<o.length;e++)t.push(o[e]-o[e-1]);const n=t.reduce((e,t)=>e+t,0)/t.length;let s=Math.round(6e4/n);s=Math.max(20,Math.min(999,s)),a(s),e&&e(s)}c.current=setTimeout(()=>{r(!1)},2e3)},[e]),reset:u}}const IU=new Map;function FU(e){const t=IU.get(e);return!(!t||t.closed)&&(t.focus(),!0)}const UU=({isOpen:e,onClose:t,title:n="DEViLBOX",width:s=900,height:a=600,fitContent:o=!1,children:r})=>{const i=l.useRef(null),c=l.useRef(!1),[u,d]=l.useState(!1),[m,p]=l.useState(null),h=l.useRef(t);return l.useEffect(()=>{h.current=t}),l.useEffect(()=>{if(!e){i.current&&!i.current.closed&&i.current.close(),i.current=null;const e=requestAnimationFrame(()=>{p(null),d(!1)});return()=>cancelAnimationFrame(e)}if(i.current&&!i.current.closed)return void i.current.focus();const r=Math.round(screen.width/2-s/2),l=Math.round(screen.height/2-a/2),u=["popup=yes",`width=${s}`,`height=${a}`,`left=${r}`,`top=${l}`,"toolbar=no","location=no","menubar=no","status=no"].join(","),m=window.open("","",u);if(!m)return _k.warning("Popup blocked  please allow popups for this site"),void t();i.current=m,IU.set(n,m),m.document.open(),m.document.write(`<!DOCTYPE html><html><head><title>${n}</title><style>\n      html, body { margin: 0; padding: 0; background: #0b0909; color: #f2f0f0; overflow: auto; height: 100%; }\n      #popout-root { display: inline-block; min-width: 100%; }\n    </style></head><body><div id="popout-root"></div></body></html>`),m.document.close(),m.document.title=n;const f=m.document.head;document.head.querySelectorAll("style").forEach(e=>{const t=m.document.createElement("style");t.textContent=e.textContent,t.dataset.cloned="true",f.appendChild(t)}),document.head.querySelectorAll('link[rel="stylesheet"]').forEach(e=>{const t=m.document.createElement("link");t.rel="stylesheet",t.href=e.href,t.dataset.cloned="true",f.appendChild(t)});const g=m.document.getElementById("popout-root");requestAnimationFrame(()=>{p(g),d(!0)});let b=null;if(o){let e=!1;b=new ResizeObserver(()=>{e||m.closed||requestAnimationFrame(()=>{if(m.closed)return;const t=g.scrollWidth,n=g.scrollHeight;if(t>0&&n>0){const s=t+(m.outerWidth-m.innerWidth),a=n+(m.outerHeight-m.innerHeight),o=Math.round(screen.width/2-s/2),r=Math.round(screen.height/2-a/2);m.moveTo(Math.max(0,o),Math.max(0,r)),m.resizeTo(Math.min(s,screen.availWidth),Math.min(a,screen.availHeight)),e=!0}})}),b.observe(g)}const v=new MutationObserver(e=>{if(!m.closed)for(const t of e){for(const e of t.addedNodes){if(e instanceof HTMLStyleElement){const t=m.document.createElement("style");t.textContent=e.textContent,t.dataset.cloned="true",m.document.head.appendChild(t)}if(e instanceof HTMLLinkElement&&"stylesheet"===e.rel){const t=m.document.createElement("link");t.rel="stylesheet",t.href=e.href,t.dataset.cloned="true",m.document.head.appendChild(t)}}for(const e of t.removedNodes){if(m.closed)return;if(e instanceof HTMLStyleElement||e instanceof HTMLLinkElement){m.document.head.querySelectorAll('[data-cloned="true"]').forEach(t=>{(t instanceof HTMLStyleElement&&e instanceof HTMLStyleElement&&t.textContent===e.textContent||t instanceof HTMLLinkElement&&e instanceof HTMLLinkElement&&t.href===e.href)&&t.remove()})}}}});v.observe(document.head,{childList:!0}),c.current=!1;const y=()=>{c.current||(c.current=!0,p(null),d(!1),setTimeout(()=>h.current(),0))};return m.addEventListener("pagehide",y),m.onbeforeunload=y,()=>{b?.disconnect(),v.disconnect(),c.current=!0,IU.delete(n),m&&!m.closed&&(m.removeEventListener("pagehide",y),m.onbeforeunload=null,m.close()),i.current=null,p(null),d(!1)}},[e,n,s,a,o]),e&&u&&m?ZV.createPortal(r,m):null},RU=({children:e,className:t="",variant:n="default",style:s})=>Yn.jsxDEV("div",{className:`viz-frame viz-frame--${n} ${t}`,style:s,children:[Yn.jsxDEV("div",{className:"viz-frame__content",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/VisualizerFrame.tsx",lineNumber:33,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"viz-frame__vignette"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/VisualizerFrame.tsx",lineNumber:37,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/VisualizerFrame.tsx",lineNumber:28,columnNumber:5},void 0),jU=({width:e=800,height:t=120,mode:n="waveform"})=>{const s=l.useRef(null),a=l.useRef(null),o=l.useRef(0),{analyserNode:r,fftNode:i}=UD(),[c,u]=l.useState(800),d="auto"!==e?e:c;l.useEffect(()=>{if("auto"!==e)return;const t=s.current;if(!t)return;const n=()=>{const e=t.getBoundingClientRect();u(Math.floor(e.width))};n();const a=new ResizeObserver(n);return a.observe(t),()=>a.disconnect()},[e]);const{currentThemeId:m}=JD(),p="cyan-lineart"===m,h=jN(e=>e.isPlaying);return l.useEffect(()=>{const e=a.current;if(!e)return;const s=e.getContext("2d");if(!s)return;const l=window.devicePixelRatio||1;if(e.width=d*l,e.height=t*l,s.setTransform(l,0,0,l,0,0),!h){const e=p?"#030808":"#0a0a0b",n=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",a=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)";s.fillStyle=e,s.fillRect(0,0,d,t),s.strokeStyle=n,s.lineWidth=1;for(let o=0;o<d;o+=50)s.beginPath(),s.moveTo(o,0),s.lineTo(o,t),s.stroke();for(let o=0;o<t;o+=30)s.beginPath(),s.moveTo(0,o),s.lineTo(d,o),s.stroke();return s.strokeStyle=a,s.beginPath(),s.moveTo(0,t/2),s.lineTo(d,t/2),void s.stroke()}let c=!0,u=0;const m=1e3/30,f=p?"#030808":"#0a0a0b",g=p?"rgba(0, 255, 255, 0.08)":"#1a1a1d",b=p?"#00ffff":"#00d4aa",v=p?"#00ffff":"#7c3aed",y=p?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)",x=s.createLinearGradient(0,0,d,0);x.addColorStop(0,b),x.addColorStop(.5,b),x.addColorStop(1,v);const N=[];if("spectrum"===n)for(let t=0;t<1024;t++)if(p)N.push("rgba(0, 255, 255, 0.75)");else{const e=160+t/1024*120;N.push(`hsla(${e}, 80%, 50%, 0.8)`)}const w=a=>{if(!c||!e||!s)return;const l=a-u;if(l<m)o.current=requestAnimationFrame(w);else{u=a-l%m,s.fillStyle=f,s.fillRect(0,0,d,t),s.strokeStyle=g,s.lineWidth=1;for(let e=0;e<d;e+=50)s.beginPath(),s.moveTo(e,0),s.lineTo(e,t),s.stroke();for(let e=0;e<t;e+=30)s.beginPath(),s.moveTo(0,e),s.lineTo(d,e),s.stroke();if("waveform"===n&&r){const e=r.getValue();s.strokeStyle=x,s.lineWidth=2,s.beginPath();const n=d/e.length;let a=0;for(let o=0;o<e.length;o++){const r=(e[o]+1)/2*t;0===o?s.moveTo(a,r):s.lineTo(a,r),a+=n}s.stroke(),s.strokeStyle=y,s.lineWidth=1,s.beginPath(),s.moveTo(0,t/2),s.lineTo(d,t/2),s.stroke()}else if("spectrum"===n&&i){const e=i.getValue(),n=d/e.length;let a=0;for(let o=0;o<e.length;o++){const r=(e[o]+100)/100,i=r*t;p?(s.globalAlpha=.5+.5*r,s.fillStyle="rgb(0, 255, 255)"):s.fillStyle=N[o]||N[N.length-1],s.fillRect(a,t-i,n-1,i),a+=n}s.globalAlpha=1}o.current=requestAnimationFrame(w)}};return o.current=requestAnimationFrame(w),()=>{c=!1,o.current&&cancelAnimationFrame(o.current)}},[d,t,n,r,i,p,h]),Yn.jsxDEV("div",{ref:s,className:"auto"===e?"w-full":"",children:Yn.jsxDEV("canvas",{ref:a,style:{width:"auto"===e?"100%":`${d}px`,height:`${t}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/Oscilloscope.tsx",lineNumber:243,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/Oscilloscope.tsx",lineNumber:242,columnNumber:5},void 0)},XU=({height:e=100,width:t="auto"})=>{const n=l.useRef(null),s=l.useRef(null),a=l.useRef(null),o=l.useRef([]),r=l.useRef([]),i=l.useRef([]),c=l.useRef(null),{patterns:u,currentPatternIndex:d}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),m=jN(e=>e.isPlaying),{currentThemeId:p}=JD(),h=u[d],f=h?.channels.length||4,g="cyan-lineart"===p;l.useEffect(()=>{o.current=new Array(f).fill(0),r.current=new Array(f).fill(null).map(()=>({level:0,frames:0}))},[f]);const b=l.useRef(f),v=l.useRef(e),y=l.useRef(g);return l.useEffect(()=>{b.current=f},[f]),l.useEffect(()=>{v.current=e},[e]),l.useEffect(()=>{y.current=g},[g]),l.useEffect(()=>{if(!m){a.current&&(cancelAnimationFrame(a.current),a.current=null);const t=s.current,i=n.current;if(t&&i){const n=t.getContext("2d");if(n){const s=window.devicePixelRatio||1,a=i.clientWidth;t.width=a*s,t.height=e*s,n.setTransform(s,0,0,s,0,0);const o=g?"#030808":"#0a0a0b";n.fillStyle=o,n.fillRect(0,0,a,e);const r=Math.max(6,(e-24-3*(f-1))/f),l=a-40,c=12;for(let e=0;e<f;e++){const t=c+e*(r+3);n.fillStyle=g?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",n.font="9px monospace",n.textAlign="left",n.fillText(`${e+1}`,4,t+r-1),n.fillStyle=g?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",n.fillRect(20,t,l,r)}n.fillStyle=g?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",n.font="10px sans-serif",n.textAlign="center",n.fillText("Channel Levels",a/2,e-3)}}return o.current=new Array(f).fill(0),void(r.current=new Array(f).fill(null).map(()=>({level:0,frames:0})))}const t=()=>{const e=s.current,l=n.current;if(!e||!l)return void(a.current=requestAnimationFrame(t));const u=e.getContext("2d");if(!u)return void(a.current=requestAnimationFrame(t));const d=b.current,m=v.current,p=y.current,h=window.devicePixelRatio||1,f=l.clientWidth;e.width===Math.ceil(f*h)&&e.height===Math.ceil(m*h)||(e.width=Math.ceil(f*h),e.height=Math.ceil(m*h)),u.setTransform(h,0,0,h,0,0);const g=Bw(),x=g.getChannelTriggerLevels(d),N=g.getChannelTriggerGenerations(d);if(i.current.length<d){const e=i.current;i.current=new Array(d).fill(0);for(let t=0;t<e.length;t++)i.current[t]=e[t]}for(let t=0;t<d;t++){const e=N[t]!==i.current[t],n=e&&x[t]||0;e&&(i.current[t]=N[t]);const s=o.current[t]||0;n>s?o.current[t]=s+.7*(n-s):(o.current[t]=.88*s,o.current[t]<.01&&(o.current[t]=0));const a=r.current[t];o.current[t]>=a.level?(a.level=o.current[t],a.frames=30):a.frames>0?a.frames--:(a.level*=.95,a.level<.01&&(a.level=0))}const w=p?"#030808":"#0a0a0b";u.fillStyle=w,u.fillRect(0,0,f,m);const E=Math.max(6,(m-24-3*(d-1))/d),k=f-40,D=c.current;let S;D&&D.width===k&&D.cyan===p?S=D.gradient:(S=u.createLinearGradient(20,0,20+k,0),p?(S.addColorStop(0,"rgba(0, 200, 200, 0.8)"),S.addColorStop(.7,"rgba(0, 255, 255, 1)"),S.addColorStop(1,"rgba(255, 100, 100, 1)")):(S.addColorStop(0,"rgba(0, 180, 140, 0.8)"),S.addColorStop(.7,"rgba(0, 212, 170, 1)"),S.addColorStop(1,"rgba(255, 80, 80, 1)")),c.current={gradient:S,width:k,cyan:p});const M=p?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",C=p?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",V=p?"#00ffff":"#ff4444";u.font="9px monospace",u.textAlign="left";for(let t=0;t<d;t++){const e=12+t*(E+3),n=o.current[t],s=r.current[t],a=n*k,i=20+s.level*k;u.fillStyle=M,u.fillText(`${t+1}`,4,e+E-1),u.fillStyle=C,u.fillRect(20,e,k,E),a>0&&(u.fillStyle=S,u.fillRect(20,e,a,E)),s.level>.02&&(u.fillStyle=V,u.fillRect(i-1,e,2,E))}u.fillStyle=p?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",u.font="10px sans-serif",u.textAlign="center",u.fillText("Channel Levels",f/2,m-3),a.current=requestAnimationFrame(t)};return a.current=requestAnimationFrame(t),()=>{a.current&&(cancelAnimationFrame(a.current),a.current=null)}},[m,f,e,g]),Yn.jsxDEV("div",{ref:n,className:"auto"===t?"w-full":"",children:Yn.jsxDEV("canvas",{ref:s,style:{width:"100%",height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelLevelsCompact.tsx",lineNumber:252,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelLevelsCompact.tsx",lineNumber:251,columnNumber:5},void 0)},zU=a.memo(({height:e=100,onComplete:t})=>{const n=l.useRef(null),s=l.useRef(null),[a,o]=l.useState(null),r=l.useRef(null),i=l.useRef(null),c=l.useRef(t);l.useEffect(()=>{c.current=t},[t]);const u=l.useRef(!1),{currentThemeId:d}=JD(),m="cyan-lineart"===d;l.useEffect(()=>{fetch("/assets/up-rough-logo.svg").then(e=>e.text()).then(e=>{let t=e;t=t.replace(/stroke="#000"/g,'stroke="currentColor"'),t=t.replace(/stroke-width="0"/g,'stroke-width="0" fill="currentColor"'),o(t)}).catch(e=>{})},[]);l.useEffect(()=>(u.current=!1,i.current=setTimeout(()=>{(()=>{if(!s.current)return;const e=s.current.querySelector("svg");e&&(e.querySelectorAll("*").forEach(e=>{e.style.animationPlayState="paused"}),e.style.animationPlayState="paused")})(),u.current=!0,c.current?.()},1e4),()=>{i.current&&clearTimeout(i.current)}),[]);const p=l.useRef(m);l.useEffect(()=>{p.current=m},[m]),l.useEffect(()=>{const e=()=>{if(!s.current)return void(r.current=requestAnimationFrame(e));const t=s.current,n=p.current?"#00ffff":"#00d4aa";t.style.color=n,t.style.transform="scale(1.5)",t.style.filter="",r.current=requestAnimationFrame(e)};return r.current=requestAnimationFrame(e),()=>{r.current&&(cancelAnimationFrame(r.current),r.current=null)}},[]);const h=m?"#00ffff":"#00d4aa";return Yn.jsxDEV("div",{ref:n,className:"w-full flex items-center justify-center overflow-hidden",style:{height:`${e}px`},onClick:e=>{e.stopPropagation(),i.current&&clearTimeout(i.current),r.current&&cancelAnimationFrame(r.current),c.current?.()},title:"Click to skip",children:a?Yn.jsxDEV("div",{ref:s,className:"flex items-center justify-center",style:{height:"100%",width:"100%",color:h,transformOrigin:"center center",transform:"scale(1.5)"},dangerouslySetInnerHTML:{__html:a}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/LogoAnimation.tsx",lineNumber:148,columnNumber:9},void 0):Yn.jsxDEV("span",{className:"text-text-muted text-sm",children:"Loading..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/LogoAnimation.tsx",lineNumber:161,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/LogoAnimation.tsx",lineNumber:138,columnNumber:5},void 0)}),GU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),s=l.useRef([]),[a,o]=l.useState(300);return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const o=t.current;if(!o)return;const r=o.getContext("2d");if(!r)return;const i=window.devicePixelRatio||1;o.width=a*i,o.height=e*i,r.scale(i,i);const l=a/2,c=e/2,u=.4*Math.min(a,e);s.current=[];for(let e=0;e<3;e++){const t=u*(.4+.2*e),n=r.createLinearGradient(l-t,c,l+t,c);n.addColorStop(0,"#00d4aa"),n.addColorStop(.5,"#00ffff"),n.addColorStop(1,"#00d4aa"),s.current.push(n)}const d=()=>{if(document.hidden)return void(n.current=requestAnimationFrame(d));r.clearRect(0,0,a,e);const t=Bw().getWaveform();let o=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);o=Math.min(1,10*e)}r.strokeStyle="#333",r.lineWidth=2,r.beginPath(),r.arc(l,c,u,0,2*Math.PI),r.stroke();for(let e=0;e<3;e++){const t=u*(.4+.2*e),n=Math.max(0,o-.3*e);if(n>0){const a=2*Math.PI*Math.min(2*n,1);r.strokeStyle=s.current[e],r.lineWidth=8,r.lineCap="round",r.beginPath(),r.arc(l,c,t,-Math.PI/2,-Math.PI/2+a),r.stroke()}}r.fillStyle=o>.5?"#00ffff":"#333",r.beginPath(),r.arc(l,c,4,0,2*Math.PI),r.fill(),n.current=requestAnimationFrame(d)};return d(),()=>{n.current&&cancelAnimationFrame(n.current)}},[a,e]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/CircularVU.tsx",lineNumber:126,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/CircularVU.tsx",lineNumber:125,columnNumber:5},void 0)},HU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),o=l.useRef([]);return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const r=a.getContext("2d");if(!r)return;const i=window.devicePixelRatio||1;a.width=s*i,a.height=e*i,r.scale(i,i);const l=s/32,c=new Array(32).fill(0);o.current=Array.from({length:32},(t,n)=>{const s=n*l,a=r.createLinearGradient(s,0,s,e);return a.addColorStop(0,"#00ffff"),a.addColorStop(.5,"#00d4aa"),a.addColorStop(1,"#006655"),a});const u=Bw();u.enableAnalysers();const d=()=>{if(document.hidden)return void(n.current=requestAnimationFrame(d));r.fillStyle="#0a0a0b",r.fillRect(0,0,s,e);const t=Bw().getFFT();if(t){const n=t,s=Math.floor(n.length/32);for(let t=0;t<32;t++){const a=(n[t*s]+140)/140,i=Math.max(0,Math.min(1,a))*e*.9;c[t]+=.3*(i-c[t]);const u=t*l,d=c[t];r.fillStyle=o.current[t],r.fillRect(u+1,e-d,l-2,d),r.fillStyle="rgba(0, 255, 255, 0.5)",r.fillRect(u+1,e-d,l-2,2),r.fillStyle="rgba(0, 0, 0, 0.3)",r.fillRect(u+l-2,e-d,1,d)}}n.current=requestAnimationFrame(d)};return d(),()=>{n.current&&cancelAnimationFrame(n.current),u.disableAnalysers()}},[s,e]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/FrequencyBars.tsx",lineNumber:121,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/FrequencyBars.tsx",lineNumber:120,columnNumber:5},void 0)},WU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),s=l.useRef([]),[a,o]=l.useState(300);return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const o=t.current;if(!o)return;const r=o.getContext("2d");if(!r)return;const i=window.devicePixelRatio||1;o.width=a*i,o.height=e*i,r.scale(i,i);const l=s.current,c=Bw();c.enableAnalysers();const u=(e,t,n)=>({x:e,y:t,vx:(Math.random()-.5)*n*4,vy:(Math.random()-.5)*n*4,size:3*Math.random()+1,life:1}),d=()=>{if(document.hidden)return void(n.current=requestAnimationFrame(d));r.fillStyle="rgba(10, 10, 11, 0.15)",r.fillRect(0,0,a,e);const t=Bw().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}if(s>.1&&l.length<150){const t=Math.floor(8*s);for(let n=0;n<t;n++)l.push(u(a/2+40*(Math.random()-.5),e/2+40*(Math.random()-.5),s))}for(let n=l.length-1;n>=0;n--){const t=l[n];t.x+=t.vx,t.y+=t.vy,t.life-=.015;const o=a/2-t.x,i=e/2-t.y,c=o*o+i*i;if(c>400){const e=2/c;t.vx+=o*e,t.vy+=i*e}if(t.vx*=.98,t.vy*=.98,t.life<=0){l.splice(n,1);continue}const u=t.life,d=(60*t.life+160)%360;r.fillStyle=`hsla(${d}, 100%, 60%, ${u})`,r.beginPath(),r.arc(t.x,t.y,t.size*t.life,0,2*Math.PI),r.fill(),s>.5&&(r.fillStyle=`hsla(${d}, 100%, 80%, ${.3*u})`,r.beginPath(),r.arc(t.x,t.y,t.size*t.life*2,0,2*Math.PI),r.fill())}n.current=requestAnimationFrame(d)};return d(),()=>{n.current&&cancelAnimationFrame(n.current),s.current=[],c.disableAnalysers()}},[a,e]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ParticleField.tsx",lineNumber:164,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ParticleField.tsx",lineNumber:163,columnNumber:5},void 0)},qU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),{patterns:o,currentPatternIndex:r}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),i=o[r],c=i?.channels.length||4;return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const o=a.getContext("2d");if(!o)return;let r=!0;const l=window.devicePixelRatio||1;a.width=s*l,a.height=e*l,o.scale(l,l);const u=Math.min(4,c),d=Math.ceil(c/u),m=s/u,p=e/d,h=Bw();h.enableAnalysers();const f=()=>{if(!r)return;if(document.hidden)return void(n.current=requestAnimationFrame(f));o.fillStyle="#0a0a0b",o.fillRect(0,0,s,e);const t=Bw().getWaveform();if(t){const e=t;for(let t=0;t<c;t++){const n=Math.floor(t/u),s=t%u*m,a=n*p;o.strokeStyle="#222",o.lineWidth=1,o.strokeRect(s,a,m,p),o.fillStyle="#555",o.font="8px monospace",o.fillText(`CH${t+1}`,s+4,a+10);const r=4,l=p-2*r-12,d=a+r+12,h=Math.max(1,Math.floor(e.length/(m-2*r))),f=Math.floor(t/c*e.length),g=123*t%e.length;o.strokeStyle=i?.channels[t]?.muted?"#333":"#00d4aa",o.lineWidth=1.5,o.beginPath();for(let i=0;i<m-2*r;i++){let n=e[(f+i*h+g)%e.length];n=n*(.3+t/c*.5)*(1+t%3);const a=s+r+i,u=d+l/2+n*l*.4;0===i?o.moveTo(a,u):o.lineTo(a,u)}o.stroke()}}n.current=requestAnimationFrame(f)};return f(),()=>{r=!1,n.current&&cancelAnimationFrame(n.current),h.disableAnalysers()}},[s,e,c,i]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelWaveforms.tsx",lineNumber:151,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelWaveforms.tsx",lineNumber:150,columnNumber:5},void 0)},KU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),{patterns:o,currentPatternIndex:r}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),i=o[r],c=i?.channels.length||4,u=l.useRef(new Array(32).fill(0));return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const o=a.getContext("2d");if(!o)return;let r=!0;const l=window.devicePixelRatio||1;a.width=s*l,a.height=e*l,o.scale(l,l);const d=Math.min(8,c),m=Math.ceil(c/d),p=s/d,h=e/m,f=()=>{if(!r)return;if(document.hidden)return void(n.current=requestAnimationFrame(f));o.fillStyle="#0a0a0b",o.fillRect(0,0,s,e);const t=Bw();let a=0;if(jN.getState().isPlaying){const e=t.getWaveform();if(e&&e.length>0){const t=Math.sqrt(e.reduce((e,t)=>e+t*t,0)/e.length);a=Math.min(1,10*t)}}for(let e=0;e<c;e++){const t=Math.floor(e/d),n=e%d*p,s=t*h,r=Date.now()/1e3,l=2.1*e,c=.4*Math.sin(2*r+l)+.3*Math.cos(1.3*r+.7*l),m=.5+e%4*.2,f=i?.channels[e]?.muted?0:Math.max(0,Math.min(1,a*m+c));u.current[e]+=.2*(f-u.current[e]);const g=u.current[e],b=2;o.fillStyle="#111",o.fillRect(n+b,s+b,p-2*b,h-2*b);const v=(h-2*b)*g,y=o.createLinearGradient(n,s+h,n,s+h-v);g>.8?(y.addColorStop(0,"#ff0000"),y.addColorStop(.3,"#ffff00"),y.addColorStop(1,"#00ff00")):g>.5?(y.addColorStop(0,"#ffff00"),y.addColorStop(1,"#00ff00")):(y.addColorStop(0,"#00ff00"),y.addColorStop(1,"#00d4aa")),o.fillStyle=y,o.fillRect(n+b,s+h-b-v,p-2*b,v),o.fillStyle=g>.5?"#000":"#666",o.font="9px monospace",o.textAlign="center",o.fillText((e+1).toString(),n+p/2,s+h/2+3),o.strokeStyle=i?.channels[e]?.solo?"#00ffff":"#222",o.lineWidth=i?.channels[e]?.solo?2:1,o.strokeRect(n+b,s+b,p-2*b,h-2*b)}n.current=requestAnimationFrame(f)};return f(),()=>{r=!1,n.current&&cancelAnimationFrame(n.current)}},[s,e,c,i]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelActivityGrid.tsx",lineNumber:159,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelActivityGrid.tsx",lineNumber:158,columnNumber:5},void 0)},$U=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),{patterns:o,currentPatternIndex:r}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),i=o[r],c=i?.channels.length||4;return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const o=a.getContext("2d");if(!o)return;let r=!0;const l=window.devicePixelRatio||1;a.width=s*l,a.height=e*l,o.scale(l,l);const u=Math.min(4,c),d=Math.ceil(c/u),m=s/u,p=e/d,h=Bw();h.enableAnalysers();const f=()=>{if(!r)return;if(document.hidden)return void(n.current=requestAnimationFrame(f));o.fillStyle="#0a0a0b",o.fillRect(0,0,s,e);const t=Bw().getFFT();if(t){const e=t,n=16,s=Date.now()/1e3;for(let t=0;t<c;t++){const a=Math.floor(t/u),r=t%u*m,l=a*p;o.strokeStyle="#222",o.lineWidth=1,o.strokeRect(r,l,m,p),o.fillStyle="#555",o.font="8px monospace",o.fillText(`CH${t+1}`,r+4,l+10);const d=4,h=(m-2*d)/n,f=p-2*d-12;for(let u=0;u<n;u++){const a=Math.floor(t/c*e.length*.6),m=(e[(Math.floor(u/n*e.length)+a)%e.length]+140)/140,p=1.7*t,g=.4+t%3*.3,b=Math.max(0,Math.min(1,m))*f*(i?.channels[t]?.muted?0:.3*Math.sin(1.5*s+p+.4*u)+g),v=r+d+u*h,y=l+d+12+f-b,x=u/n*180+180;o.fillStyle=`hsl(${x}, 80%, 50%)`,o.fillRect(v,y,h-1,b)}}}n.current=requestAnimationFrame(f)};return f(),()=>{r=!1,n.current&&cancelAnimationFrame(n.current),h.disableAnalysers()}},[s,e,c,i]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelSpectrums.tsx",lineNumber:147,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelSpectrums.tsx",lineNumber:146,columnNumber:5},void 0)},YU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),{patterns:o,currentPatternIndex:r}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),i=o[r],c=i?.channels.length||4;return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const o=a.getContext("2d");if(!o)return;let r=!0;const l=window.devicePixelRatio||1;a.width=s*l,a.height=e*l,o.scale(l,l);const u=Math.min(4,c),d=Math.ceil(c/u),m=s/u,p=e/d,h=()=>{if(!r)return;if(document.hidden)return void(n.current=requestAnimationFrame(h));o.fillStyle="#0a0a0b",o.fillRect(0,0,s,e);const t=Bw();let a=0;if(jN.getState().isPlaying){const e=t.getWaveform();if(e&&e.length>0){const t=Math.sqrt(e.reduce((e,t)=>e+t*t,0)/e.length);a=Math.min(1,10*t)}}for(let e=0;e<c;e++){const t=Math.floor(e/u),n=e%u*m,s=t*p,r=Date.now()/1e3,l=2.5*e,d=.3*Math.sin(2*r+l),h=.6+e%3*.2,f=i?.channels[e]?.muted?0:Math.max(0,Math.min(1,a*h+d));o.strokeStyle="#222",o.lineWidth=1,o.strokeRect(n,s,m,p),o.fillStyle="#555",o.font="8px monospace",o.fillText(`CH${e+1}`,n+4,s+10);const g=n+m/2,b=s+p/2,v=Math.min(m,p)/2-12;o.strokeStyle="#333",o.lineWidth=1,o.beginPath(),o.arc(g,b,v,0,2*Math.PI),o.stroke();const y=2;for(let a=0;a<y;a++){const t=v*(.5+.3*a),n=Math.max(0,f-.4*a);if(n>0){const s=2*Math.PI*Math.min(1.5*n,1),a=(r+.3*e)%(2*Math.PI),i=160+e/c*60;o.strokeStyle=`hsl(${i}, 80%, 50%)`,o.lineWidth=4,o.lineCap="round",o.beginPath(),o.arc(g,b,t,-Math.PI/2+a,-Math.PI/2+a+s),o.stroke()}}o.fillStyle=f>.5?"#00ffff":"#333",o.beginPath(),o.arc(g,b,3,0,2*Math.PI),o.fill()}n.current=requestAnimationFrame(h)};return h(),()=>{r=!1,n.current&&cancelAnimationFrame(n.current)}},[s,e,c,i]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelCircularVU.tsx",lineNumber:161,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelCircularVU.tsx",lineNumber:160,columnNumber:5},void 0)},JU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),s=l.useRef([]),[a,o]=l.useState(300),{patterns:r,currentPatternIndex:i}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),c=r[i],u=c?.channels.length||4;return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const o=t.current;if(!o)return;const r=o.getContext("2d");if(!r)return;let i=!0;const l=window.devicePixelRatio||1;o.width=a*l,o.height=e*l,r.scale(l,l);const d=Math.min(4,u),m=Math.ceil(u/d),p=a/d,h=e/m;s.current=Array(u).fill(0).map(()=>[]);const f=()=>{if(!i)return;if(document.hidden)return void(n.current=requestAnimationFrame(f));r.fillStyle="#0a0a0b",r.fillRect(0,0,a,e);const t=Bw();let o=0;if(jN.getState().isPlaying){const e=t.getWaveform();if(e&&e.length>0){const t=Math.sqrt(e.reduce((e,t)=>e+t*t,0)/e.length);o=Math.min(1,10*t)}}for(let e=0;e<u;e++){const t=Math.floor(e/d),n=e%d*p,a=t*h,i=Date.now()/1e3,l=2.3*e,m=.35*Math.sin(2.5*i+l),f=.5+e%4*.25,g=c?.channels[e]?.muted?0:Math.max(0,Math.min(1,o*f+m));r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(n,a,p,h),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${e+1}`,n+4,a+10);const b=n+p/2,v=a+h/2,y=20,x=s.current[e];if(g>.1&&x.length<y){const t=Math.floor(3*g);for(let n=0;n<t;n++){const t=Math.random()*Math.PI*2,n=.5+1.5*Math.random();x.push({x:b,y:v,vx:Math.cos(t)*n,vy:Math.sin(t)*n,life:1,maxLife:.5+.5*Math.random(),channelIndex:e})}}for(let s=x.length-1;s>=0;s--){const t=x[s];t.x+=t.vx,t.y+=t.vy;const n=b-t.x,a=v-t.y;if(Math.sqrt(n*n+a*a)>5&&(t.vx+=.01*n,t.vy+=.01*a),t.vx*=.98,t.vy*=.98,t.life-=.02,t.life<=0){x.splice(s,1);continue}const o=t.life,i=160+e/u*60,l=2+2*o;r.fillStyle=`hsla(${i}, 80%, 50%, ${.8*o})`,r.beginPath(),r.arc(t.x,t.y,l,0,2*Math.PI),r.fill(),r.fillStyle=`hsla(${i}, 80%, 50%, ${.2*o})`,r.beginPath(),r.arc(t.x,t.y,2*l,0,2*Math.PI),r.fill()}}n.current=requestAnimationFrame(f)};return f(),()=>{i=!1,n.current&&cancelAnimationFrame(n.current)}},[a,e,u,c]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${a}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelParticles.tsx",lineNumber:208,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelParticles.tsx",lineNumber:207,columnNumber:5},void 0)},QU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),{patterns:o,currentPatternIndex:r}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),i=o[r],c=i?.channels.length||4,u=l.useRef(new Array(32).fill(0));return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const o=a.getContext("2d");if(!o)return;let r=!0;const l=window.devicePixelRatio||1;a.width=s*l,a.height=e*l,o.scale(l,l);const d=Math.min(4,c),m=Math.ceil(c/d),p=s/d,h=e/m,f=()=>{if(!r)return;if(document.hidden)return void(n.current=requestAnimationFrame(f));o.fillStyle="#000",o.fillRect(0,0,s,e);const t=Bw().getWaveform();let a=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);a=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/d),n=e%d*p,s=t*h,r=Date.now()/1e3,l=1.5*e,m=.2*Math.sin(3*r+l),f=i?.channels[e]?.muted?0:Math.max(0,Math.min(1,a+m));u.current[e]+=.15*(f-u.current[e]);const g=u.current[e],b=n+p/2,v=s+h/2,y=Math.min(p,h)/2-10;o.fillStyle="#333",o.font="8px monospace",o.fillText((e+1).toString(),n+4,s+10);const x=3;for(let a=0;a<x;a++){const t=Math.max(0,g-.2*a),n=y/x*(a+1)+10*t,s=.2+.8*t,r=180+e/c*120+20*a;o.beginPath(),o.arc(b,v,n,0,2*Math.PI),o.strokeStyle=`hsla(${r}, 80%, 50%, ${s})`,o.lineWidth=1+3*t,o.stroke(),t>.3&&(o.shadowBlur=10*t,o.shadowColor=`hsla(${r}, 100%, 50%, 0.5)`,o.stroke(),o.shadowBlur=0)}o.strokeStyle="#111",o.lineWidth=1,o.beginPath(),o.moveTo(b-5,v),o.lineTo(b+5,v),o.moveTo(b,v-5),o.lineTo(b,v+5),o.stroke()}n.current=requestAnimationFrame(f)};return f(),()=>{r=!1,n.current&&cancelAnimationFrame(n.current)}},[s,e,c,i]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelRings.tsx",lineNumber:154,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelRings.tsx",lineNumber:153,columnNumber:5},void 0)},ZU=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),{patterns:o,currentPatternIndex:r}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),i=o[r],c=i?.channels.length||4,u=l.useRef(0);return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const o=a.getContext("2d");if(!o)return;let r=!0;const l=window.devicePixelRatio||1;a.width=s*l,a.height=e*l,o.scale(l,l);const d=Math.min(4,c),m=Math.ceil(c/d),p=s/d,h=e/m,f=()=>{if(!r)return;if(document.hidden)return void(n.current=requestAnimationFrame(f));o.fillStyle="#000",o.fillRect(0,0,s,e);const t=Bw().getFFT();u.current+=.05;for(let e=0;e<c;e++){const n=Math.floor(e/d),s=e%d*p,a=n*h,r=s+p/2,l=a+h/2;let m=0;if(t&&t.length>0){const n=e*Math.floor(t.length/c);let s=0;for(let e=0;e<10;e++)s+=(t[n+e]+140)/140;m=Math.max(0,Math.min(1,s/10))}i?.channels[e]?.muted&&(m=0);const f=8;for(let t=0;t<f;t++){const n=(t/f+u.current%(1/f))%1,i=1-n,d=.8*n,g=200+e/c*100+50*n;o.strokeStyle=`hsla(${g}, 80%, 50%, ${d})`,o.lineWidth=1+2*m;const b=p*i,v=h*i;o.strokeRect(r-b/2,l-v/2,b,v),0===t&&m>.5&&(o.beginPath(),o.moveTo(s,a),o.lineTo(r-b/2,l-v/2),o.moveTo(s+p,a),o.lineTo(r+b/2,l-v/2),o.moveTo(s,a+h),o.lineTo(r-b/2,l+v/2),o.moveTo(s+p,a+h),o.lineTo(r+b/2,l+v/2),o.stroke())}const g=o.createRadialGradient(r,l,0,r,l,10+20*m),b=180+e/c*60;g.addColorStop(0,`hsla(${b}, 100%, 70%, ${.5*m})`),g.addColorStop(1,"transparent"),o.fillStyle=g,o.fillRect(s,a,p,h)}n.current=requestAnimationFrame(f)};return f(),()=>{r=!1,n.current&&cancelAnimationFrame(n.current)}},[s,e,c,i]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelTunnel.tsx",lineNumber:156,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelTunnel.tsx",lineNumber:155,columnNumber:5},void 0)},eR=({height:e=100})=>{const t=l.useRef(null),n=l.useRef(void 0),[s,a]=l.useState(300),{patterns:o,currentPatternIndex:r}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),i=o[r],c=i?.channels.length||4,u=l.useRef(0),d=l.useRef([]);return l.useEffect(()=>{const e=t.current;if(!e)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&a(e)}});return n.observe(e.parentElement),()=>n.disconnect()},[]),l.useEffect(()=>{const a=t.current;if(!a)return;const o=a.getContext("2d");if(!o)return;let r=!0;const l=window.devicePixelRatio||1;a.width=s*l,a.height=e*l,o.scale(l,l);const m=Math.min(4,c),p=Math.ceil(c/m),h=s/m,f=e/p;d.current.length!==c&&(d.current=Array(c).fill(0).map(()=>[]));const g=()=>{if(!r)return;o.fillStyle="#000",o.fillRect(0,0,s,e);const t=Bw(),a=jN.getState().isPlaying?t.getWaveform():null;u.current+=.05;for(let e=0;e<c;e++){const t=Math.floor(e/m),n=e%m*h+h/2,s=t*f+f/2,r=Math.min(h,f)/2-5;o.strokeStyle="#111",o.lineWidth=1,o.beginPath(),o.arc(n,s,r,0,2*Math.PI),o.stroke(),o.beginPath(),o.arc(n,s,.6*r,0,2*Math.PI),o.stroke(),o.beginPath(),o.arc(n,s,.3*r,0,2*Math.PI),o.stroke(),o.beginPath(),o.moveTo(n-r,s),o.lineTo(n+r,s),o.moveTo(n,s-r),o.lineTo(n,s+r),o.stroke();let l=0;if(a&&a.length>0){const t=Math.floor(e/c*a.length),n=Math.floor((e+1)/c*a.length);let s=0;for(let e=t;e<n;e+=10)s+=Math.abs(a[e]);l=Math.min(1,s/((n-t)/10)*5)}if(i?.channels[e]?.muted&&(l=0),l>.3){const t=u.current%(2*Math.PI),a=(.2+.8*Math.random())*r;d.current[e].push({x:n+Math.cos(t)*a,y:s+Math.sin(t)*a,age:1,hue:120+e/c*100})}for(let a=d.current[e].length-1;a>=0;a--){const t=d.current[e][a];o.fillStyle=`hsla(${t.hue}, 100%, 50%, ${t.age})`,o.beginPath(),o.arc(t.x,t.y,2*t.age,0,2*Math.PI),o.fill(),t.age-=.01,t.age<=0&&d.current[e].splice(a,1)}const p=o.createConicGradient(u.current,n,s),g=120+e/c*100;p.addColorStop(0,`hsla(${g}, 100%, 50%, 0.5)`),p.addColorStop(.1,`hsla(${g}, 100%, 50%, 0)`),p.addColorStop(1,`hsla(${g}, 100%, 50%, 0)`),o.fillStyle=p,o.beginPath(),o.moveTo(n,s),o.arc(n,s,r,u.current,u.current-.5,!0),o.fill(),o.strokeStyle=`hsla(${g}, 100%, 70%, 0.8)`,o.lineWidth=2,o.beginPath(),o.moveTo(n,s),o.lineTo(n+Math.cos(u.current)*r,s+Math.sin(u.current)*r),o.stroke()}n.current=requestAnimationFrame(g)};return g(),()=>{r=!1,n.current&&cancelAnimationFrame(n.current)}},[s,e,c,i]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center",children:Yn.jsxDEV("canvas",{ref:t,style:{width:`${s}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelRadar.tsx",lineNumber:184,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/ChannelRadar.tsx",lineNumber:183,columnNumber:5},void 0)},tR=[{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,2,2,2,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,9,8,9,9,8,9,9,9,9,9,10,9,10,10,9,10,10,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,10,10,9,10,10,9,10,9,9,9,9,9,8,9,9,8,9,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,8,1,8,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,1,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,2,3,2,3,4,3,4,4,4,3,4,3,2,3,2,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,10,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,10,9,10,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,9,10,9,9,9,8,8,9,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,8,8,9,9,9,10,9,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,3,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,1,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,1,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,1,1,1,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,1,0,0,0,0,0,0,0,0,0,0,2,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,4,4,4,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,9,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,1,8,8,8,9,9,9,10,9,10,10,10,10,9,10,9,9,9,8,9,8,8,8,1,8,1,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,1,4,1,4,4,3,4,3,3,3,4,3,4,4,1,4,1,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,1,1,4,1,4,4,3,4,3,3,2,2,3,4,3,4,4,1,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:0,p2Dir:5,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,3,4,4,4,4,4,0,0,2,2,2,3,4,4,4,4,4,0,0,9,9,9,9,9,10,10,10,0,0,9,9,9,9,9,10,10,10,0,0,0,7,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,4,0,0,2,0,0,0,0,0,0,0,4,0,0,9,0,0,0,0,9,10,10,0,0,9,0,0,0,0,9,10,10,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0],[0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,10,10,9,0,0,0,0,0,9,0,0,10,10,9,0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,2,0,0,4,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,6,0,0,10,10,10,9,9,9,9,9,9,0,0,10,10,10,9,9,9,9,9,9,0,0,4,4,4,4,3,2,2,2,0,0,4,4,4,4,3,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,2,2,2,3,3,4,4,1,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,0,1,0,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,1,4,4,3,3,2,2,2,2],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,4,4,3,3,2,2,2,2,3,3,4,0,0,0,0,0,0,0,4,3,3,2,2,2,2,3,3,4,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,1,0,1,0,4,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,7,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,0,8,8,8,8,0,8,8,8,8,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,8,8,8,8,0,8,8,8,8,0,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,3,2,2,2,2,2,3,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0],[0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0],[0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,9,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,1,9,0,0,0,0,0,0,10,1,10,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,9,9,9,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,8,8,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,8,8,8,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,10,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,1,9,0,0,0,0,0],[0,0,10,1,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,0,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,2,0,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,0,0,0,2,2,0,0,0,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,0,0,0,0,3,3,3,3,3,3,0,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,3,0,3,2,2,2,3,3,0,3,4,4,4,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,3,3,0,2,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,1,0,4,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,0,2,2,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,4,1,0,1,4,4,0,3,3,3,0,2,2,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,2,2,2,0,3,3,4,4,4,0,1,1,1,4,4,0,3,3,3,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,10,10,10,10,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,8,8,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,0,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,7,0],[0,0,0,0,0,8,0,9,0,1,0,9,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,2,0,3,0,4,0,1,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,9,0,10,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,4,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,8,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,4,0,3,0,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,2,0,4,0,2,2,2,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,9,0,1,0,10,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,1,0,9,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,3,0,4,4,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,1,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,9,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,3,3,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,4,0,1,0,3,0,2,0,0,0,0,0],[0,0,0,0,0,9,0,8,0,9,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,9,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,0,1,0,4,0,2,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,3,0,4,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,8,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,3,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,3,3,3,0,4,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,8,0,9,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,1,0,9,9,9,0,8,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,3,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,0,2,0,3,0,0,0,0,0],[0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,2,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,3,0,1,0,0,0,0,0],[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[6,0,0,0,0,3,4,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,2,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,3,0,1,0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,1,0,0,0,3,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,3,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,3,0,3,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,2,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,3,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,1,4,0],[0,4,3,0,1,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1,0,0,0,2,2,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,3,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,2,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0],[0,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,4,1,4,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,2,0,0,0,3,0,0,0,0,0,0,1,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,1,0,0,0,0,0,0,2,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,3,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,1,0,7]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,9,9,9,9,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,4,4,4,4,4,4,4,4,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,0],[0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}],nR="nibbles";const sR=new class{db=null;initPromise=null;async init(){if(!this.db)return this.initPromise||(this.initPromise=new Promise((e,t)=>{const n=indexedDB.open("devilbox-scores",1);n.onerror=()=>{t(n.error)},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(nR)){const e=t.createObjectStore(nR,{keyPath:"id",autoIncrement:!0});e.createIndex("score","score",{unique:!1}),e.createIndex("date","date",{unique:!1})}}})),this.initPromise}async ensureDb(){if(await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async saveScore(e){const t=await this.ensureDb(),n={...e,date:new Date};return new Promise((e,s)=>{const a=t.transaction([nR],"readwrite").objectStore(nR).add(n);a.onsuccess=()=>{e(a.result)},a.onerror=()=>{s(a.error)}})}async getTopScores(e=10){const t=await this.ensureDb();return new Promise((n,s)=>{const a=t.transaction([nR],"readonly").objectStore(nR).index("score").openCursor(null,"prev"),o=[];a.onsuccess=()=>{const t=a.result;t&&o.length<e?(o.push(t.value),t.continue()):n(o)},a.onerror=()=>{s(a.error)}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,n)=>{const s=e.transaction([nR],"readwrite").objectStore(nR).clear();s.onsuccess=()=>t(),s.onerror=()=>n(s.error)})}},aR=[12,8,6,4],oR=51,rR=23,iR=["#000000","#5397FF","#000067","#4BFFFF","#AB7787","#FFFFFF","#7F7F7F","#ABCDEF","#733747","#F7CBDB","#434343","#D3D3D3","#FFFF00"],lR=["#1a1a2e","#16213e","#0f3460","#533483","#7b2cbf","#9d4edd","#c77dff","#e0aaff","#ff006e","#fb5607","#ffbe0b","#8ac926","#1982c4","#6a4c93","#06ffa5","#fffb00"],cR=({height:e=120,onExit:t})=>{const n=l.useRef(null),s=l.useRef(null),[o,r]=l.useState(200),[i,c]=l.useState(e),[u,d]=l.useState({level:0,score1:0,score2:0,lives1:3,lives2:3,isPlaying:!1,showMenu:!1,showHighScores:!1}),[m,p]=l.useState(1),[h,f]=l.useState(1),[g,b]=l.useState(!1),[v,y]=l.useState(!0),[x,N]=l.useState(!1),[w,E]=l.useState(!0),[k,D]=l.useState(!0),[S,M]=l.useState([]),[C,V]=l.useState(!1),[P,_]=l.useState(1),[O,T]=l.useState(0),[L,A]=l.useState(0),[B,I]=l.useState(""),[F,U]=l.useState(new Uint8Array(128)),[R,j]=l.useState(0),X=l.useRef(null),z=l.useRef(0),G=l.useRef(null),[H,W]=l.useState(0),[q,K]=l.useState(1),[$,Y]=l.useState(1),J=l.useRef(0),Q=l.useRef(0),Z=l.useRef(0),ee=l.useRef([]),te=l.useRef(0),ne=l.useRef(0),se=l.useRef(0),ae=l.useRef(3),oe=l.useRef(3),re=l.useRef(!1),ie=l.useRef([]),le=l.useRef([]),ce=l.useRef([]),ue=l.useRef(0),de=l.useRef(0),me=l.useRef(5),pe=l.useRef(5),he=l.useRef(0),fe=l.useRef(0),ge=l.useRef(0),be=l.useRef([]),ve=l.useRef([]),ye=l.useRef(null),xe=l.useCallback(()=>{d({level:te.current,score1:ne.current,score2:se.current,lives1:ae.current,lives2:oe.current,isPlaying:re.current,showMenu:!1,showHighScores:!1})},[]),Ne=e=>d(t=>({...t,showMenu:e})),we=e=>d(t=>({...t,showHighScores:e})),Ee=e=>{re.current=e,d(t=>({...t,isPlaying:e}))},ke=l.useCallback(async()=>{const e=await sR.getTopScores(10);M(e)},[]),De=l.useCallback(()=>{let e=0;for(;e<1e3;){const t=Math.floor(Math.random()*oR),n=Math.floor(Math.random()*rR),s=ie.current[n]?.[t];if(0===s)return ge.current++,void(ie.current[n][t]=16+ge.current);e++}},[]),Se=l.useCallback(e=>{const t=tR[e%tR.length],n=t.grid.map(e=>[...e]);let s=2,a=2,o=48,r=20;for(let l=0;l<rR;l++)for(let e=0;e<oR;e++){const t=n[l]?.[e];6===t&&(s=e,a=l,n[l][e]=0),7===t&&(o=e,r=l,n[l][e]=0)}ie.current=n;const i=e=>0===e?2:5===e?3:6===e?0:7===e?1:0;ue.current=i(t.p1Dir),de.current=i(t.p2Dir),le.current=Array(256).fill(null),le.current[0]={x:s,y:a},ce.current=Array(256).fill(null),ce.current[0]={x:o,y:r},me.current=5,pe.current=5,he.current=0,fe.current=0,ge.current=0,ie.current[a]&&(ie.current[a][s]=6),2===h&&ie.current[r]&&(ie.current[r][o]=7),be.current=[],ve.current=[],De()},[h,De]),Me=l.useCallback(()=>{re.current=!1,te.current=0,ne.current=0,se.current=0,ae.current=3,oe.current=3,j(0),W(0),K(1),Y(1),ee.current=[],Z.current=0,Q.current=0,J.current=0,Se(0),xe()},[Se,xe]);l.useEffect(()=>{requestAnimationFrame(()=>ke())},[ke]);const Ce=l.useCallback(()=>{try{const{analyserNode:e}=UD.getState();if(!e)return;const t=e.context.rawContext||e.context;if(!t)return;const n=t.createAnalyser();n.fftSize=256,n.smoothingTimeConstant=.8,e.connect(n),X.current=n}catch(e){}},[]),Ve=l.useCallback(()=>aR[m]*(.9+.3*(F.length>0?F.reduce((e,t)=>e+t,0)/F.length/255:0)),[m,F]),Pe=l.useCallback(()=>{const e=X.current;if(!e)return;let t=G.current;t&&t.length===e.frequencyBinCount||(t=new Uint8Array(e.frequencyBinCount),G.current=t),e.getByteFrequencyData(t),U(t);const n=t.reduce((e,t)=>e+t,0)/t.length,s=n-z.current;if(s>15){const e=Math.min(s/30,1);j(e),W(e),K(1+.15*e),e>.5&&Date.now()-Q.current>2e3&&(Z.current++,Q.current=Date.now())}else j(e=>Math.max(0,e-.05)),W(e=>Math.max(0,e-.08)),K(e=>Math.max(1,e-.02));z.current=n},[]);l.useEffect(()=>{Ce()},[Ce]),l.useEffect(()=>{const e=()=>{s.current&&(r(s.current.clientWidth),c(s.current.clientHeight))};e();const t=new ResizeObserver(e);return s.current&&t.observe(s.current),()=>t.disconnect()},[]);const _e=l.useCallback((e,t,n,s)=>{ee.current=ee.current.filter(a=>{if(a.x+=a.vx,a.y+=a.vy,a.life-=.02,a.vy+=.1,a.life>0){e.globalAlpha=a.life,e.fillStyle=a.color;const o=n+a.x*t,r=s+a.y*t;e.fillRect(o-a.size/2,r-a.size/2,a.size,a.size),e.globalAlpha=1}return a.life>0})},[]),Oe=l.useCallback((e,t,n)=>{const s=n?ce.current:le.current,a=n?pe.current:me.current;for(let o=0;o<a;o++){const n=s[o];if(n&&n.x===e&&n.y===t)return o}return 0},[]),Te=l.useCallback((e,t)=>{if(0===F.length)return iR[t];const n=3*e%F.length;if(F[n]/255>.3){const e=Math.min(Math.floor(n/F.length*lR.length),lR.length-1);return lR[e]}return iR[t]},[F]),Le=l.useCallback((e,t)=>{if(!F||0===F.length)return;for(let n=0;n<51;n++){const s=Math.floor(n/51*F.length),a=F[s]/255;if(a<=.05)continue;const o=Math.floor(23*a),r=Math.min(Math.floor(s/F.length*lR.length),lR.length-1),i=lR[r],l=.2+.4*a,c=n*t;e.fillStyle=i,e.globalAlpha=l;for(let n=23-o;n<23;n++){const s=n*t;e.fillRect(c,s,t,t)}e.globalAlpha=1}},[F]),Ae=l.useCallback(async()=>{Ee(!1);const e=ne.current,t=se.current,n=te.current,s=S.length<10?0:S[S.length-1].score;return e>s?(_(1),T(e),A(n+1),I("Player 1"),void V(!0)):2===h&&t>s?(_(2),T(t),A(n+1),I("Player 2"),void V(!0)):(ke(),we(!0),void Me())},[h,m,S,ke,Me]),Be=l.useCallback(async()=>{if(B.trim()&&await sR.saveScore({name:B.trim(),score:O,level:L,players:h,speed:m}),V(!1),1===P&&2===h){const e=se.current,t=te.current;if(e>(S.length<10?0:S[S.length-1].score))return _(2),T(e),A(t+1),I("Player 2"),void V(!0)}ke(),we(!0),Me()},[B,O,L,P,h,m,S,ke,Me]),Ie=l.useCallback((e,t,n)=>{let s=e,a=t;if(0===n?s++:1===n?a--:2===n?s--:3===n&&a++,g)s<0&&(s=50),s>=oR&&(s=0),a<0&&(a=22),a>=rR&&(a=0);else if(s<0||s>=oR||a<0||a>=rR)return!0;const o=ie.current[a]?.[s];return o>=1&&o<=15},[g]),Fe=l.useCallback(()=>{if(!re.current)return;if(Pe(),Z.current>0&&(De(),Z.current--),be.current.length>0){const e=be.current.shift();0===e&&2===ue.current||2===e&&0===ue.current||1===e&&3===ue.current||3===e&&1===ue.current||(ue.current=e)}if(2===h&&ve.current.length>0){const e=ve.current.shift();0===e&&2===de.current||2===e&&0===de.current||1===e&&3===de.current||3===e&&1===de.current||(de.current=e)}const e=(e,t)=>{let{x:n,y:s}=e;return 0===t?n++:1===t?s--:2===t?n--:3===t&&s++,n<0&&(n=50),n>=oR&&(n=0),s<0&&(s=22),s>=rR&&(s=0),{x:n,y:s}},t=Ie(le.current[0].x,le.current[0].y,ue.current),n=2===h&&Ie(ce.current[0].x,ce.current[0].y,de.current),s=e(le.current[0],ue.current),a=2===h?e(ce.current[0],de.current):null,o=a&&s.x===a.x&&s.y===a.y;if(t||n||o)return ae.current-=t||o?1:0,oe.current-=n||o?1:0,void(ae.current<=0||2===h&&oe.current<=0?Ae():(Ee(!1),Se(te.current),xe()));let r=!1,i=!1;const l=ie.current[s.y][s.x];if(l>=16){const e=Date.now(),t=999*(l-16)*(te.current+1),n=R>.3,a=n?2:1;ne.current+=t*a,he.current=me.current>>1,r=!0,n&&(Y(2),setTimeout(()=>Y(1),500)),J.current=e;const o=s.x,i=s.y;for(let s=0;s<8;s++){const e=2*Math.PI*s/8,t=2+3*Math.random();ee.current.push({x:o,y:i,vx:Math.cos(e)*t,vy:Math.sin(e)*t,life:1,color:iR[12],size:3+3*Math.random()})}}if(a){const e=ie.current[a.y][a.x];if(e>=16){const t=Date.now(),n=999*(e-16)*(te.current+1),s=R>.3,o=s?2:1;se.current+=n*o,fe.current=pe.current>>1,i=!0,s&&(Y(2),setTimeout(()=>Y(1),500)),J.current=t;const r=a.x,l=a.y;for(let e=0;e<8;e++){const t=2*Math.PI*e/8,n=2+3*Math.random();ee.current.push({x:r,y:l,vx:Math.cos(t)*n,vy:Math.sin(t)*n,life:1,color:iR[12],size:3+3*Math.random()})}}}if(r||i){if(9===ge.current)return te.current++,Se(te.current),void xe();De()}for(let c=255;c>0;c--){const e=le.current[c-1];if(le.current[c]=e?{x:e.x,y:e.y}:null,2===h){const e=ce.current[c-1];ce.current[c]=e?{x:e.x,y:e.y}:null}}if(le.current[0]=s,a&&(ce.current[0]=a),!x){if(he.current>0&&me.current<255)he.current--,me.current++;else{const e=le.current[me.current];e&&ie.current[e.y]&&(ie.current[e.y][e.x]=0)}if(2===h)if(fe.current>0&&pe.current<255)fe.current--,pe.current++;else{const e=ce.current[pe.current];e&&ie.current[e.y]&&(ie.current[e.y][e.x]=0)}}ne.current=Math.max(0,ne.current-17),2===h&&(se.current=Math.max(0,se.current-17)),ie.current[s.y]&&(ie.current[s.y][s.x]=6),a&&ie.current[a.y]&&(ie.current[a.y][a.x]=7),xe()},[h,g,x,Se,Ae,xe,Ie,Pe]);return l.useEffect(()=>{let e=0;const t=n=>{re.current&&n-e>=16.67*Ve()&&(e=n,Fe()),ye.current=requestAnimationFrame(t)};return ye.current=requestAnimationFrame(t),()=>{ye.current&&cancelAnimationFrame(ye.current)}},[m,Fe,Ve]),l.useEffect(()=>{const e=e=>{if(re.current)if(w){if("ArrowLeft"===e.key){e.preventDefault();const t=(ue.current+1)%4;be.current.push(t)}if("ArrowRight"===e.key){e.preventDefault();const t=(ue.current+3)%4;be.current.push(t)}if("a"===e.key.toLowerCase()){e.preventDefault();const t=(de.current+1)%4;ve.current.push(t)}if("d"===e.key.toLowerCase()){e.preventDefault();const t=(de.current+3)%4;ve.current.push(t)}}else"ArrowRight"===e.key&&(e.preventDefault(),be.current.push(0)),"ArrowUp"===e.key&&(e.preventDefault(),be.current.push(1)),"ArrowLeft"===e.key&&(e.preventDefault(),be.current.push(2)),"ArrowDown"===e.key&&(e.preventDefault(),be.current.push(3)),"d"===e.key.toLowerCase()&&(e.preventDefault(),ve.current.push(0)),"w"===e.key.toLowerCase()&&(e.preventDefault(),ve.current.push(1)),"a"===e.key.toLowerCase()&&(e.preventDefault(),ve.current.push(2)),"s"===e.key.toLowerCase()&&(e.preventDefault(),ve.current.push(3))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[w]),l.useEffect(()=>{const e=n.current;if(!e)return;const t=e.getContext("2d");if(!t)return;let s=!0,a=null;const o=()=>{if(!s)return;if(t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),u.showMenu||u.showHighScores)return void(a=requestAnimationFrame(o));const n=Math.min(e.width/oR,e.height/rR),r=oR*n,i=rR*n,l=(e.width-r)/2,c=(e.height-i)/2;x?(t.strokeStyle=iR[11],t.lineWidth=2,H>.1&&(t.shadowColor=iR[11],t.shadowBlur=10*H),t.strokeRect(l,c,r,i),t.shadowBlur=0):(t.strokeStyle="rgba(34, 211, 238, 0.3)",t.lineWidth=2,t.strokeRect(l,c,r,i));for(let e=0;e<rR;e++)for(let s=0;s<oR;s++){const a=ie.current[e]?.[s];if(void 0===a||0===a)continue;const o=l+s*n,r=c+e*n;if(a>=16)v?(t.fillStyle="#000",t.fillRect(o,r,n,n),t.fillStyle=iR[12],t.fillRect(o+2,r+2,n-4,n-4)):(t.fillStyle=iR[12],t.fillRect(o,r,n,n)),t.fillStyle="#000",t.font=`bold ${Math.floor(.7*n)}px monospace`,t.textAlign="center",t.textBaseline="middle",t.fillText((a-16).toString(),o+n/2,r+n/2+1);else{let e=iR[a]||"#fff";if(v){t.fillStyle="#000",t.fillRect(o,r,n,n),t.fillStyle=e;const s=2/q,a=(n-4)*q;t.fillRect(o+s,r+s,a,a)}else t.fillStyle=e,t.fillRect(o,r,n,n)}}_e(t,n,l,c),a=requestAnimationFrame(o)};return a=requestAnimationFrame(o),()=>{s=!1,null!==a&&cancelAnimationFrame(a)}},[v,x,H,q,u.showMenu,u.showHighScores,k,Le,_e,Oe,Te]),l.useEffect(()=>{Se(0),xe()},[]),Yn.jsxDEV("div",{ref:s,className:"w-full h-full flex flex-col items-stretch relative group overflow-hidden",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"absolute top-0 left-0 w-full flex justify-between px-2 py-0.5 pointer-events-none z-10 bg-black/40 backdrop-blur-sm transition-opacity opacity-0 "+(u.isPlaying?"group-hover:opacity-100":""),children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"font-mono text-[8px] text-white uppercase",children:["P1: ",u.score1," | L:",u.lives1]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1016,columnNumber:11},void 0),$>1&&Yn.jsxDEV("span",{className:"text-yellow-400 font-bold text-[9px] animate-pulse",children:["x",$]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1018,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1015,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"font-mono text-[8px] text-accent-primary font-bold",children:["LVL ",u.level+1]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1023,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"font-mono text-[8px] text-white uppercase",children:["P2: ",u.score2," | L:",u.lives2]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1024,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1014,columnNumber:7},void 0),Yn.jsxDEV("canvas",{ref:n,width:o,height:i,className:"cursor-pointer w-full h-full",onClick:e=>{e.stopPropagation(),u.isPlaying||(Me(),Ee(!0))}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1027,columnNumber:7},void 0),!u.isPlaying&&!u.showMenu&&!u.showHighScores&&Yn.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-20",children:Yn.jsxDEV("div",{className:"flex flex-col items-center gap-2 scale-75 md:scale-100",children:[Yn.jsxDEV("h3",{className:"text-white font-bold text-sm tracking-widest uppercase",children:"NIBBLES"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1045,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Me(),Ee(!0)},className:"bg-accent-primary hover:bg-accent-secondary text-white px-6 py-1 rounded-full text-xs font-bold uppercase transition-all shadow-glow-sm",children:"Start Game"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1046,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex gap-4",children:[Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Ne(!0)},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"Options"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1057,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),we(!0),ke()},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"High Scores"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1063,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),t?.()},className:"text-red-400/70 hover:text-red-400 text-[9px] uppercase font-mono",children:"Exit"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1069,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1056,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1044,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1043,columnNumber:9},void 0),u.showHighScores&&!u.isPlaying&&Yn.jsxDEV("div",{className:"absolute inset-0 bg-black z-40 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[Yn.jsxDEV("span",{className:"text-accent-primary font-bold text-[10px] uppercase tracking-wider",children:"Fasttracker Nibbles Highscore"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1087,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),we(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1088,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1086,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex-1 flex flex-col gap-1 mt-1",children:0===S.length?Yn.jsxDEV("div",{className:"text-center text-text-muted py-4 text-[9px] uppercase font-mono",children:"No high scores yet!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1098,columnNumber:15},void 0):Yn.jsxDEV("div",{className:"grid grid-cols-[1fr_auto_auto] gap-x-4 gap-y-1",children:[Yn.jsxDEV("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30",children:"Player"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1101,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Score"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1102,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Lvl"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1103,columnNumber:17},void 0),S.map((e,t)=>Yn.jsxDEV(a.Fragment,{children:[Yn.jsxDEV("div",{className:"text-text-primary text-[9px] truncate font-mono",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1106,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"text-accent-secondary text-[9px] font-mono text-right",children:e.score.toLocaleString()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1107,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"text-text-secondary text-[9px] font-mono text-right",children:e.level},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1108,columnNumber:21},void 0)]},e.id||t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1105,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1100,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1096,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:async e=>{e.stopPropagation(),confirm("Are you sure you want to clear all high scores?")&&(await sR.clearAll(),ke())},className:"text-red-500/50 hover:text-red-500 uppercase text-[8px] font-mono mt-auto pt-2",children:"Clear All"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1115,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1082,columnNumber:9},void 0),u.showMenu&&!u.isPlaying&&Yn.jsxDEV("div",{className:"absolute inset-0 bg-black z-30 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[Yn.jsxDEV("span",{className:"text-white font-bold text-[10px] uppercase",children:"Options"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1137,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Ne(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1138,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1136,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-2 text-[9px] font-mono uppercase text-text-secondary",children:[Yn.jsxDEV("div",{className:"flex flex-col gap-1",children:[Yn.jsxDEV("span",{children:"Speed:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1148,columnNumber:15},void 0),Yn.jsxDEV("select",{value:m,onChange:e=>{e.stopPropagation(),p(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[Yn.jsxDEV("option",{value:0,children:"Novice"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1154,columnNumber:17},void 0),Yn.jsxDEV("option",{value:1,children:"Average"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1155,columnNumber:17},void 0),Yn.jsxDEV("option",{value:2,children:"Pro"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1156,columnNumber:17},void 0),Yn.jsxDEV("option",{value:3,children:"Up Rough"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1157,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1149,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1147,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex flex-col gap-1",children:[Yn.jsxDEV("span",{children:"Players:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1161,columnNumber:15},void 0),Yn.jsxDEV("select",{value:h,onChange:e=>{e.stopPropagation(),f(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[Yn.jsxDEV("option",{value:1,children:"1 Player"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1167,columnNumber:17},void 0),Yn.jsxDEV("option",{value:2,children:"2 Players"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1168,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1162,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1160,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1146,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex flex-wrap gap-3 mt-1",children:[Yn.jsxDEV("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Yn.jsxDEV("input",{type:"checkbox",checked:g,onChange:e=>{e.stopPropagation(),b(e.target.checked)},className:"accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1175,columnNumber:15},void 0),"Wrap"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1174,columnNumber:13},void 0),Yn.jsxDEV("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Yn.jsxDEV("input",{type:"checkbox",checked:v,onChange:e=>{e.stopPropagation(),y(e.target.checked)},className:"accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1184,columnNumber:15},void 0),"Grid"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1183,columnNumber:13},void 0),Yn.jsxDEV("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Yn.jsxDEV("input",{type:"checkbox",checked:x,onChange:e=>{e.stopPropagation(),N(e.target.checked)},className:"accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1193,columnNumber:15},void 0),"Surround"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1192,columnNumber:13},void 0),Yn.jsxDEV("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Yn.jsxDEV("input",{type:"checkbox",checked:w,onChange:e=>{e.stopPropagation(),E(e.target.checked)},className:"accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1202,columnNumber:15},void 0),"2-Key"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1201,columnNumber:13},void 0),Yn.jsxDEV("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Yn.jsxDEV("input",{type:"checkbox",checked:k,onChange:e=>{e.stopPropagation(),D(e.target.checked)},className:"accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1211,columnNumber:15},void 0),"Music FX"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1210,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1173,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1132,columnNumber:9},void 0),C&&Yn.jsxDEV("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:e=>e.stopPropagation(),children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-accent-primary rounded p-4 flex flex-col gap-3 min-w-[200px]",children:[Yn.jsxDEV("div",{className:"text-accent-primary font-bold text-[11px] uppercase tracking-wider text-center",children:"High Score!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1230,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"text-text-secondary text-[9px] font-mono text-center",children:["Player ",P," - ",O.toLocaleString()," pts"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1233,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"text",value:B,onChange:e=>I(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),Be()),"Escape"===e.key&&(e.preventDefault(),Be())},maxLength:20,placeholder:"Enter your name",autoFocus:!0,className:"bg-dark-bgTertiary border border-dark-border rounded px-2 py-1 text-white text-[10px] font-mono focus:border-accent-primary focus:outline-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1236,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex gap-2",children:[Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),Be()},className:"flex-1 bg-accent-primary hover:bg-accent-secondary text-white px-3 py-1 rounded text-[9px] font-bold uppercase transition-all",children:"Submit"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1256,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation(),I(""),Be()},className:"bg-dark-bgTertiary hover:bg-dark-border text-text-muted px-3 py-1 rounded text-[9px] uppercase transition-all",children:"Skip"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1265,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1255,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1229,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1225,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/NibblesGame.tsx",lineNumber:1008,columnNumber:5},void 0)},uR=({height:e=100,text:t="*** GREETINGS FLIES OUT TO....     AEROSOL   AFRIKA   ANDROMEDA   ATE BIT   ATLANTIS   BLACK MAIDEN   BOOZE DESIGN   BOOZOHOLICS   BYTERAPERS   CENSOR DESIGN   DA JORMAS  DCS   DEKADENCE   DEPTH   DESIRE   DIVINE STYLERS   DUREX   ELCREW   ELUDE   EPHIDRENA   EPSILON DESIGN   FAIRLIGHT   FATZONE   FIT   FLUSH  FUNKTION   GENESIS PROJECT   HACK N TRADE   HAUJOBB   HARD BOYLING BOYS   HOAXERS   LFT  IMPURE ASCII 1940  INSANE   INSTINCT   IRIS  JOSSYSTEM   JUDAS   KESO   LA PAZ   LAXATIVE EFFECTS   LEMON  LOONIES     MAHONEY   MANKIND  MAWI   MOODS PLATEAU   NATURE  NONAMENO   NUKLEUS   OFFENCE  ONSALA SECTOR     ONSLAUGHT   OUTBREAK   OXYRON   PACIF!C   PANDA DESIGN   PARADOX   PERFOMERS   PLANET JAZZ   POWERLINE   RAZOR 1911   REALITY   RELAPSE  RNO   RESISTANCE SCARAB   SCENESAT   SCOOPEX   SHARE AND ENJOY   SHAPE   SIGFLUP   SPACEBALLS   STRUTS SUBSPACE   STYLE   THE ELECTRONIC KNIGHTS   THE BLACK LOTUS   THE GANG   TITAN   TPOLM   TRAKTOR   TRIAD   TRSI   TULOU   UK SCENE ALLSTARS   UNIQUE   UNSTABLE LABEL   Y-CREW   AND   ZENON ***"})=>{const n=l.useRef(null),s=l.useRef(void 0),a=l.useRef(0),[o,r]=l.useState(800);return l.useEffect(()=>{const e=n.current;if(!e)return;const t=e.parentElement;if(!t)return;const s=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return s.observe(t),()=>s.disconnect()},[]),l.useEffect(()=>{const r=n.current;if(!r)return;const i=r.getContext("2d");if(!i)return;const l=window.devicePixelRatio||1;r.width=o*l,r.height=e*l,i.scale(l,l);let c=!0;const u=[];for(let t=0;t<200;t++)u.push({x:(Math.random()-.5)*o*2,y:(Math.random()-.5)*e*2,z:1e3*Math.random(),speed:.5+1.5*Math.random()});const d=Math.min(.4*e,32),m=.6*d,p=.2*e;let h=0,f=1,g=0;const b=(t+"     ").repeat(5);let v=null,y="";const x=()=>{if(!c)return;if(document.hidden)return void(s.current=requestAnimationFrame(x));const{bpm:n,isPlaying:r}=jN.getState(),l=Bw().getWaveform();let N=0;if(l&&l.length>0&&r){const e=Math.sqrt(l.reduce((e,t)=>e+t*t,0)/l.length);N=Math.min(1,10*e)}g+=.15*(N-g),i.fillStyle="#0a0a0b",i.fillRect(0,0,o,e);const w=o/2,E=e/2;for(const t of u){t.z-=t.speed*(1+1*g),t.z<=0&&(t.x=(Math.random()-.5)*o*2,t.y=(Math.random()-.5)*e*2,t.z=1e3);const n=200/t.z,s=w+t.x*n,a=E+t.y*n;if(s<0||s>o||a<0||a>e)continue;const r=Math.max(1,3*(1-t.z/1e3)),l=Math.floor(255*(1-t.z/1e3));i.fillStyle=`rgb(${.8*l}, ${.9*l}, ${l})`,i.beginPath(),i.arc(s,a,r,0,2*Math.PI),i.fill()}const k=Date.now()/1e3;f=1+.8*g,h=Math.sin(.5*k*f)*e*.3;const D=p,S=2*(r?n/125:1);a.current+=S,a.current>m*(t.length+5)&&(a.current=0),i.font=`bold ${d}px monospace`,i.textBaseline="middle";const M=30*k*f%360,C=`${Math.round(h)}:${Math.round(M)}`;C!==y&&(v=i.createLinearGradient(0,h,0,e+h),v.addColorStop(0,`hsl(${M}, 100%, 60%)`),v.addColorStop(.25,`hsl(${(M+60)%360}, 100%, 70%)`),v.addColorStop(.5,`hsl(${(M+120)%360}, 100%, 70%)`),v.addColorStop(.75,`hsl(${(M+180)%360}, 100%, 70%)`),v.addColorStop(1,`hsl(${(M+240)%360}, 100%, 60%)`),y=C);const V=10+8*g;for(let t=0;t<b.length;t++){const n=b[t];if(" "===n)continue;const s=o+t*m-a.current;if(s<-m||s>o+m)continue;const r=.035*(a.current+t*m),l=e/2+Math.sin(r)*D,c=(M+.3*s)%360;i.shadowColor=`hsla(${c}, 100%, 50%, ${.5+.3*g})`,i.shadowBlur=V,i.fillStyle=v,i.fillText(n,s,l),i.shadowBlur=0,i.strokeStyle="rgba(0, 0, 0, 0.6)",i.lineWidth=2,i.strokeText(n,s,l)}s.current=requestAnimationFrame(x)};return s.current=requestAnimationFrame(x),()=>{c=!1,s.current&&cancelAnimationFrame(s.current)}},[o,e,t]),Yn.jsxDEV("div",{className:"w-full h-full flex items-center justify-center overflow-hidden",children:Yn.jsxDEV("canvas",{ref:n,style:{width:`${o}px`,height:`${e}px`}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/SineScroller.tsx",lineNumber:242,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/visualization/SineScroller.tsx",lineNumber:241,columnNumber:5},void 0)},dR=i()(TN(e=>({activeScheme:"fasttracker2",platformOverride:"auto",setActiveScheme:t=>{t&&"string"==typeof t&&e({activeScheme:t})},setPlatformOverride:t=>e({platformOverride:t})}),{name:"keyboard-preferences"})),mR=a.memo(({label:e,value:t,onChange:n,color:s="#00d4aa",size:a="md",disabled:o=!1,title:r})=>{const i="cyan-lineart"===JD(e=>e.currentThemeId),l=i?"#00ffff":s,c=i?"#0a1a1f":"#1a1a1f",u=i?"#0a3333":"#333",d=i?"#0a6666":"#666",{width:m,height:p,fontSize:h}={sm:{width:36,height:18,fontSize:9},md:{width:44,height:22,fontSize:10}}[a];return Yn.jsxDEV("div",{className:"toggle-container",style:{width:m+10,opacity:o?.4:1},children:[Yn.jsxDEV("div",{className:"toggle-label",style:{fontSize:h-1},children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Toggle.tsx",lineNumber:44,columnNumber:7},void 0),Yn.jsxDEV("button",{className:"toggle-switch "+(t?"toggle-on":"toggle-off"),onClick:()=>!o&&n(!t),disabled:o,title:r,style:{width:m,height:p,borderRadius:p/2,backgroundColor:t?l:c,border:`2px solid ${t?l:u}`,cursor:o?"not-allowed":"pointer"},children:Yn.jsxDEV("div",{className:"toggle-thumb",style:{width:p-6,height:p-6,borderRadius:"50%",backgroundColor:t?"#fff":d,transform:`translateX(${t?m-p+2:0}px)`,transition:"transform 0.15s ease-out, background-color 0.15s",boxShadow:t?`0 0 6px ${l}`:"none"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Toggle.tsx",lineNumber:61,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Toggle.tsx",lineNumber:47,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Toggle.tsx",lineNumber:43,columnNumber:5},void 0)},(e,t)=>e.value===t.value&&e.label===t.label&&e.disabled===t.disabled&&e.color===t.color&&e.size===t.size);mR.displayName="Toggle";const pR=[{id:"fasttracker2",name:"FastTracker 2",description:"Classic FT2 layout (DOS/PC) - from ft2-clone source"},{id:"impulse-tracker",name:"Impulse Tracker",description:"IT/Schism Tracker style - from schismtracker source"},{id:"protracker",name:"ProTracker",description:"Amiga MOD tracker layout - from pt2-clone source"},{id:"octamed",name:"OctaMED SoundStudio",description:"Amiga OctaMED layout - from official documentation"},{id:"renoise",name:"Renoise",description:"Modern DAW/tracker layout - from official documentation"},{id:"openmpt",name:"OpenMPT",description:"ModPlug Tracker layout - from official wiki documentation"}],hR=({onClose:e})=>{const{useHexNumbers:t,setUseHexNumbers:n,blankEmptyCells:s,setBlankEmptyCells:a,tb303Collapsed:o,setTB303Collapsed:r,oscilloscopeVisible:i,setOscilloscopeVisible:c,compactToolbar:u,setCompactToolbar:d}=LN(),{currentThemeId:m,setTheme:p}=JD(),{amigaLimits:h,setAmigaLimits:f,linearInterpolation:g,setLinearInterpolation:b,useBLEP:v,setUseBLEP:y,stereoSeparation:x,setStereoSeparation:N,stereoSeparationMode:w,modplugSeparation:E,setStereoSeparationMode:k,setModplugSeparation:D,midiPolyphonic:S,setMidiPolyphonic:M,trackerVisualBg:C,setTrackerVisualBg:V,trackerVisualMode:P,setTrackerVisualMode:_,renderMode:O,setRenderMode:T}=Ck(),{sampleBusGain:L,setSampleBusGain:A,synthBusGain:B,setSynthBusGain:I,autoGain:F,setAutoGain:U}=UD(),{editStep:R,setEditStep:j,insertMode:X,toggleInsertMode:z,recQuantEnabled:G,setRecQuantEnabled:H,recQuantRes:W,setRecQuantRes:q,recReleaseEnabled:K,setRecReleaseEnabled:$}=ID(),{activeScheme:Y,setActiveScheme:J,platformOverride:Q,setPlatformOverride:Z}=dR(),[ee,te]=l.useState(!!document.fullscreenElement),[ne,se]=l.useState(!1);l.useEffect(()=>{const e=()=>{te(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:[Yn.jsxDEV("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-lg shadow-xl",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[Yn.jsxDEV("h2",{className:"text-ft2-highlight font-bold text-sm tracking-wide",children:"SETTINGS"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:129,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none","aria-label":"Close",children:Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:135,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:130,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:128,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-6 max-h-[70vh] overflow-y-auto scrollbar-ft2",children:[Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"DISPLAY"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:143,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Theme:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:147,columnNumber:17},void 0),Yn.jsxDEV("select",{value:m,onChange:e=>p(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:$D.map(e=>Yn.jsxDEV("option",{value:e.id,className:"bg-ft2-bg text-ft2-text",children:e.name},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:154,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:148,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:146,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"UI Render Mode:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:164,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Switch between DOM and WebGL rendering"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:165,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:163,columnNumber:17},void 0),Yn.jsxDEV("select",{value:O,onChange:e=>T(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[Yn.jsxDEV("option",{value:"dom",className:"bg-ft2-bg text-ft2-text",children:"DOM (React + Tailwind)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:172,columnNumber:19},void 0),Yn.jsxDEV("option",{value:"webgl",className:"bg-ft2-bg text-ft2-text",children:"WebGL (PixiJS v8)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:173,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:167,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:162,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Number Format:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:179,columnNumber:17},void 0),Yn.jsxDEV("select",{value:t?"hex":"dec",onChange:e=>n("hex"===e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[Yn.jsxDEV("option",{value:"hex",className:"bg-ft2-bg text-ft2-text",children:"Hexadecimal (01, 02, 0A, 0F)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:185,columnNumber:19},void 0),Yn.jsxDEV("option",{value:"dec",className:"bg-ft2-bg text-ft2-text",children:"Decimal (01, 02, 10, 15)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:186,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:180,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:178,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Blank Empty Cells:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:193,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Hide ---, .., ... on empty rows"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:194,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:192,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:s,onChange:a,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:196,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:191,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Visual Background:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:207,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"WebGL audio-reactive effects behind tracker"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:208,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:206,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:C,onChange:V,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:210,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:205,columnNumber:15},void 0),C&&Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Visual Mode:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:221,columnNumber:19},void 0),Yn.jsxDEV("select",{value:P,onChange:e=>_(Number(e.target.value)),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:yO.map((e,t)=>Yn.jsxDEV("option",{value:t,className:"bg-ft2-bg text-ft2-text",children:xO(e)},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:228,columnNumber:23},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:222,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:220,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:144,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:142,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"WORKBENCH"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:240,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:Yn.jsxDEV("div",{className:"text-[9px] text-ft2-textDim font-mono leading-tight",children:[Yn.jsxDEV("span",{className:"text-ft2-highlight",children:"Tab"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:244,columnNumber:17},void 0),"  hold for Expos (fit all windows)  release to restore"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:243,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:241,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:239,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"LAYOUT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:251,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"TB-303 Panel:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:255,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:!o,onChange:e=>r(!e),size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:256,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:254,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Oscilloscope:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:266,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:i,onChange:c,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:267,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:265,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Compact Toolbar:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:277,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:u,onChange:d,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:278,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:276,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(yt,{size:14,className:"text-ft2-textDim"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:289,columnNumber:19},void 0),Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Fullscreen:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:290,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:288,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:ee,onChange:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:292,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:287,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:252,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:250,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"RECORDING"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:304,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Edit Step:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:308,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"number",value:R,onChange:e=>j(Number(e.target.value)),min:0,max:16,className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono w-12 px-1 py-0.5"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:310,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"rows"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:318,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:309,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:307,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Edit Mode:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:324,columnNumber:17},void 0),Yn.jsxDEV("select",{value:X?"insert":"overwrite",onChange:e=>{"insert"===e.target.value!==X&&z()},className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[Yn.jsxDEV("option",{value:"overwrite",children:"Overwrite"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:333,columnNumber:19},void 0),Yn.jsxDEV("option",{value:"insert",children:"Insert (Shift Rows)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:334,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:325,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:323,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Record Key-Off:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:341,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Record === when keys are released"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:342,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:340,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:K,onChange:$,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:344,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:339,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Quantization:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:354,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(mR,{label:"",value:G,onChange:H,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:356,columnNumber:19},void 0),Yn.jsxDEV("select",{value:W,onChange:e=>q(Number(e.target.value)),disabled:!G,className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight disabled:opacity-30",children:[Yn.jsxDEV("option",{value:1,children:"1 row"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:368,columnNumber:21},void 0),Yn.jsxDEV("option",{value:2,children:"2 rows"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:369,columnNumber:21},void 0),Yn.jsxDEV("option",{value:4,children:"4 rows (1/4)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:370,columnNumber:21},void 0),Yn.jsxDEV("option",{value:8,children:"8 rows (1/2)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:371,columnNumber:21},void 0),Yn.jsxDEV("option",{value:16,children:"16 rows (1 beat)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:372,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:362,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:355,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:353,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:305,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:303,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"MIDI"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:381,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Polyphonic Mode:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:386,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Play multiple notes simultaneously"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:387,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:385,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:S,onChange:M,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:389,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:384,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"pt-3 border-t border-ft2-border/30",children:Yn.jsxDEV("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-2",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-ft2-highlight",children:"Mobile MIDI:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:401,columnNumber:21},void 0),Yn.jsxDEV("span",{children:(()=>{const e=/iPad|iPhone|iPod/i.test(navigator.userAgent)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1;return"requestMIDIAccess"in navigator?e?" iOS (Bluetooth pairing required)":" Supported":" Not supported"})()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:402,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:400,columnNumber:19},void 0),/iPad|iPhone|iPod/i.test(navigator.userAgent)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1?Yn.jsxDEV("div",{className:"bg-ft2-bg/50 rounded p-2 text-[9px] leading-relaxed",children:[Yn.jsxDEV("div",{className:"font-bold mb-1",children:"To connect Bluetooth MIDI:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:420,columnNumber:27},void 0),Yn.jsxDEV("ol",{className:"list-decimal list-inside space-y-0.5 ml-1",children:[Yn.jsxDEV("li",{children:"Open Settings  Bluetooth"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:422,columnNumber:29},void 0),Yn.jsxDEV("li",{children:"Turn on your MIDI device"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:423,columnNumber:29},void 0),Yn.jsxDEV("li",{children:"Pair it with your device"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:424,columnNumber:29},void 0),Yn.jsxDEV("li",{children:"Return to DEViLBOX and refresh"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:425,columnNumber:29},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:421,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:419,columnNumber:25},void 0):null]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:399,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:398,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:382,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:380,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"DJ / SCRATCH"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:439,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Scroll Acceleration:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:444,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Smooth scroll-to-scratch (off = raw 1:1)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:445,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:443,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:LN.getState().scratchAcceleration,onChange:e=>LN.getState().setScratchAcceleration(e),size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:447,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:442,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"pt-2 border-t border-ft2-border/30",children:Yn.jsxDEV("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-1",children:[Yn.jsxDEV("div",{className:"text-ft2-highlight font-bold",children:"Scratch during playback:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:458,columnNumber:19},void 0),Yn.jsxDEV("div",{children:"Scroll wheel/trackpad controls speed & direction"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:459,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"mt-1 text-ft2-highlight font-bold",children:"Keyboard (Shift+Alt):"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:460,columnNumber:19},void 0),Yn.jsxDEV("div",{children:"F = Fader cut (hold)  1 = Trans  2 = Crab"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:461,columnNumber:19},void 0),Yn.jsxDEV("div",{children:"3 = Flare  4 = Chirp  5 = Stab"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:462,columnNumber:19},void 0),Yn.jsxDEV("div",{children:"6 = 8-Finger Crab  7 = Twiddle  0 = Stop"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:463,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:457,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:456,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:440,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:438,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"ENGINE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:471,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Amiga Limits:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:476,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Clamp periods to 113-856"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:477,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:475,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:h,onChange:f,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:479,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:474,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Sample Interpolation:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:490,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Linear (clean) vs None (crunchy)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:491,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:489,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:g,onChange:b,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:493,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:488,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"BLEP Synthesis:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:504,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Band-limited (reduces aliasing)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:505,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:503,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:v,onChange:y,size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:507,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:502,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex flex-col gap-2",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Stereo Separation:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:518,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex gap-1",children:["pt2","modplug"].map(e=>Yn.jsxDEV("button",{onClick:()=>{k(e),(e=>{pD().setStereoSeparationMode(e);const t=hO();t&&(t.deckA.replayer.setStereoSeparationMode(e),t.deckB.replayer.setStereoSeparationMode(e))})(e)},className:["text-[9px] font-mono px-2 py-0.5 rounded border transition-colors",w===e?"bg-ft2-cursor border-ft2-cursor text-black":"bg-transparent border-ft2-border text-ft2-textDim hover:border-ft2-text"].join(" "),children:"pt2"===e?"PT2-Clone":"ModPlug"},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:522,columnNumber:23},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:520,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:517,columnNumber:17},void 0),"pt2"===w?Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"0% mono  20% Amiga  100% full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:543,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"range",min:0,max:100,step:5,value:x,onChange:e=>{const t=Number(e.target.value);N(t),pD().setStereoSeparation(t);const n=hO();n&&(n.deckA.replayer.setStereoSeparation(t),n.deckB.replayer.setStereoSeparation(t))},className:"w-20 accent-ft2-cursor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:545,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-ft2-text text-[10px] font-mono w-8 text-right",children:[x,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:563,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:544,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:542,columnNumber:19},void 0):Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"0% mono  100% normal  200% wide"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:568,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"range",min:0,max:200,step:5,value:E,onChange:e=>{const t=Number(e.target.value);D(t),(e=>{pD().setModplugSeparation(e);const t=hO();t&&(t.deckA.replayer.setModplugSeparation(e),t.deckB.replayer.setModplugSeparation(e))})(t)},className:"w-20 accent-ft2-cursor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:570,columnNumber:23},void 0),Yn.jsxDEV("span",{className:"text-ft2-text text-[10px] font-mono w-8 text-right",children:[E,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:583,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:569,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:567,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:516,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex flex-col gap-2",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Bus Gain Balance:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:592,columnNumber:19},void 0),Yn.jsxDEV("label",{className:"flex items-center gap-1 cursor-pointer",children:[Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Auto"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:594,columnNumber:21},void 0),Yn.jsxDEV("input",{type:"checkbox",checked:F,onChange:e=>U(e.target.checked),className:"accent-ft2-cursor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:595,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:593,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:591,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:F?"Auto-balancing active  plays at least 1s to calibrate":"Balance sample vs synth/chip engine levels"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:603,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("span",{className:"text-[9px] font-mono w-16 text-ft2-textDim",children:"Samples"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:607,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"range",min:-12,max:12,step:1,value:L,onChange:e=>A(Number(e.target.value)),disabled:F,className:"w-20 accent-ft2-cursor disabled:opacity-40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:609,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-ft2-text text-[10px] font-mono w-10 text-right",children:[L>0?`+${L}`:L," dB"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:619,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:608,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:606,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono w-16",children:"Synths"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:625,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"range",min:-12,max:12,step:1,value:B,onChange:e=>I(Number(e.target.value)),disabled:F,className:"w-20 accent-ft2-cursor disabled:opacity-40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:627,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-ft2-text text-[10px] font-mono w-10 text-right",children:[B>0?`+${B}`:B," dB"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:637,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:626,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:624,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:590,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:472,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:470,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"SCRATCH"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:648,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Scratch Toggle:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:653,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Always enable scratch (OFF = only during playback)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:654,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:652,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:LN.getState().scratchEnabled,onChange:e=>LN.getState().setScratchEnabled(e),size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:656,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:651,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Scroll Acceleration:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:667,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Smooth velocity curve vs raw 1:1 scroll"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:668,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:666,columnNumber:17},void 0),Yn.jsxDEV(mR,{label:"",value:LN.getState().scratchAcceleration,onChange:e=>LN.getState().setScratchAcceleration(e),size:"sm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:670,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:665,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"text-[9px] text-ft2-textDim font-mono leading-tight",children:["Scroll the pattern editor during playback to vinyl scratch. Hold ",Yn.jsxDEV("kbd",{className:"px-1 py-0.5 bg-ft2-border text-ft2-text rounded text-[8px]",children:"Z"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:679,columnNumber:22},void 0)," for fader cut (mute), hold ",Yn.jsxDEV("kbd",{className:"px-1 py-0.5 bg-ft2-border text-ft2-text rounded text-[8px]",children:"X"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:680,columnNumber:22},void 0)," for crab scratch while scrolling. On touchscreens: 2-finger swipe = nudge, 3-finger touch = grab (hand on record). In DJ view, scratch is always enabled."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:677,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Platter Mass:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:688,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"CDJ  Technics 1200  Heavy"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:689,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:687,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:Math.round(100*LN.getState().platterMass),onChange:e=>LN.getState().setPlatterMass(parseInt(e.target.value)/100),className:"w-20 accent-ft2-cursor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:692,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-ft2-text text-[10px] font-mono w-8 text-right",children:[Math.round(100*LN.getState().platterMass),"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:700,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:691,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:686,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:649,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:647,columnNumber:11},void 0),Yn.jsxDEV("section",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"KEYBOARD"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:710,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"space-y-3",children:[Yn.jsxDEV("div",{className:"flex flex-col gap-2",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Keyboard Scheme:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:715,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("button",{onClick:()=>se(!0),className:"p-1.5 bg-ft2-bg border border-ft2-border text-ft2-text hover:text-ft2-highlight hover:border-ft2-highlight transition-colors focus:outline-none flex items-center justify-center",title:"View current keybindings",children:Yn.jsxDEV(an,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:722,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:717,columnNumber:21},void 0),Yn.jsxDEV("select",{value:Y,onChange:e=>J(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:pR.map(e=>Yn.jsxDEV("option",{value:e.id,children:e.name},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:730,columnNumber:25},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:724,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:716,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:714,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono leading-tight",children:pR.find(e=>e.id===Y)?.description||"Select a tracker layout"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:737,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:713,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-ft2-text text-xs font-mono",children:"Platform:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:745,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Override Cmd/Ctrl detection"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:746,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:744,columnNumber:17},void 0),Yn.jsxDEV("select",{value:Q,onChange:e=>Z(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[Yn.jsxDEV("option",{value:"auto",children:"Auto-detect"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:753,columnNumber:19},void 0),Yn.jsxDEV("option",{value:"mac",children:"Mac (Cmd)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:754,columnNumber:19},void 0),Yn.jsxDEV("option",{value:"pc",children:"PC (Ctrl)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:755,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:748,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:743,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:711,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:709,columnNumber:11},void 0),Yn.jsxDEV("section",{className:"pt-4 border-t border-ft2-border",children:[Yn.jsxDEV("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-1 mb-4",children:[Yn.jsxDEV("div",{children:"DEViLBOX v1.0.0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:764,columnNumber:15},void 0),Yn.jsxDEV("div",{children:"TB-303 Acid Tracker"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:765,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"text-ft2-highlight",children:"Settings are saved automatically"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:766,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:763,columnNumber:13},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold mb-2 tracking-wide",children:"DANGER ZONE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:769,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-ft2-textDim text-[9px] font-mono mb-2",children:"If the app fails to load or behaves unexpectedly, clearing all local state will reset it to factory defaults. Your project will be lost if not exported first."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:770,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>{confirm("Clear all app state and reload? This will delete your unsaved project and all settings.")&&navigator.serviceWorker.getRegistrations().then(e=>Promise.all(e.map(e=>e.unregister()))).then(()=>caches.keys()).then(e=>Promise.all(e.map(e=>caches.delete(e)))).then(()=>(localStorage.clear(),indexedDB.databases())).then(e=>Promise.all(e.map(e=>indexedDB.deleteDatabase(e.name)))).then(()=>location.reload())},className:"px-3 py-1.5 bg-transparent border border-red-700 text-red-500 text-[10px] font-mono hover:bg-red-900/30 transition-colors focus:outline-none",children:"CLEAR ALL STATE & RELOAD"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:774,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:768,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:762,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:140,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-end",children:Yn.jsxDEV("button",{onClick:e,className:"px-4 py-1.5 bg-ft2-cursor border border-ft2-cursor text-ft2-bg text-xs font-bold hover:bg-ft2-highlight hover:border-ft2-highlight transition-colors focus:outline-none",children:"CLOSE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:795,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:794,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:126,columnNumber:7},void 0),Yn.jsxDEV(pU,{isOpen:ne,onClose:()=>se(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:805,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/SettingsModal.tsx",lineNumber:125,columnNumber:5},void 0)},fR=Object.freeze(Object.defineProperty({__proto__:null,SettingsModal:hR},Symbol.toStringTag,{value:"Module"})),gR=({onClose:e})=>{const{swing:t,setSwing:n,grooveSteps:s,setGrooveSteps:a,jitter:o,setJitter:r,useMpcScale:i,setUseMpcScale:l,grooveTemplateId:c,setGrooveTemplate:u}=jN();return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4 backdrop-blur-sm",children:Yn.jsxDEV("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:Yn.jsxDEV("h2",{className:"text-ft2-highlight font-bold text-sm tracking-widest uppercase",children:"Groove & Swing Settings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:34,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:33,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:40,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:36,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:32,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-hidden p-0 flex flex-col md:flex-row min-h-0",children:[Yn.jsxDEV("div",{className:"w-full md:w-72 flex flex-col bg-dark-bgSecondary border-r border-ft2-border min-h-0",children:Yn.jsxDEV("section",{className:"flex flex-col flex-1 min-h-0 p-6",children:[Yn.jsxDEV("h3",{className:"flex-shrink-0 text-ft2-highlight text-xs font-bold mb-4 tracking-wider uppercase flex items-center gap-2",children:"Groove Templates"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:49,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-ft2 space-y-4",children:["straight","shuffle","swing","funk","hip-hop","custom"].map(e=>{const t=Ba.filter(t=>t.category===e);return 0===t.length?null:Yn.jsxDEV("div",{className:"space-y-1",children:[Yn.jsxDEV("div",{className:"text-[10px] font-bold text-text-muted uppercase px-1 pb-1 border-b border-dark-border",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:60,columnNumber:23},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-1 gap-1 pt-1",children:t.map(e=>Yn.jsxDEV("button",{onClick:()=>u(e.id),className:"w-full text-left px-3 py-2 text-xs font-mono transition-all rounded "+(e.id===c?"bg-accent-primary text-white font-bold shadow-glow-sm":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary bg-dark-bgSecondary border border-transparent hover:border-ft2-border"),children:[Yn.jsxDEV("div",{className:"flex justify-between items-center",children:[Yn.jsxDEV("span",{children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:75,columnNumber:31},void 0),e.id===c&&Yn.jsxDEV("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:76,columnNumber:66},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:74,columnNumber:29},void 0),e.description&&Yn.jsxDEV("div",{className:"text-[10px] mt-0.5 leading-tight "+(e.id===c?"text-white":"opacity-60"),children:e.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:79,columnNumber:31},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:65,columnNumber:27},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:63,columnNumber:23},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:59,columnNumber:21},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:53,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:48,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:47,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto scrollbar-ft2 p-6 space-y-8 min-h-0",children:[Yn.jsxDEV("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Global Intensity"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:98,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:Yn.jsxDEV("label",{className:"flex items-center gap-1.5 cursor-pointer group bg-dark-bgTertiary px-2 py-1 rounded border border-ft2-border hover:border-accent-primary transition-colors",title:"Use authentic MPC 50-75% scale",children:[Yn.jsxDEV("input",{type:"checkbox",checked:i,onChange:e=>l(e.target.checked),className:"w-3 h-3 accent-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:101,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-[10px] text-text-muted group-hover:text-text-secondary font-bold uppercase",children:"MPC SCALE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:107,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:100,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:99,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:97,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:[Yn.jsxDEV("div",{className:"flex justify-between items-end",children:[Yn.jsxDEV("span",{className:"text-[10px] text-text-secondary font-mono uppercase",children:"Groove Amount"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:114,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-xl font-mono text-accent-primary font-bold leading-none",children:i?t:`${t}%`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:115,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:113,columnNumber:17},void 0),Yn.jsxDEV("input",{type:"range",min:i?50:0,max:i?75:200,value:t,onChange:e=>n(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),n(i?50:100)},className:"w-full h-2 accent-accent-primary cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:119,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[Yn.jsxDEV("span",{children:i?"50%":"Fixed"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:132,columnNumber:19},void 0),Yn.jsxDEV("span",{children:i?"66%":"100%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:133,columnNumber:19},void 0),Yn.jsxDEV("span",{children:i?"75%":"200%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:134,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:131,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:i?"Authentic MPC timing. 66% is the perfect triplet ratio. Right-click to reset.":"Scales template intensity. 100% is standard. Right-click to reset."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:136,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:112,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:96,columnNumber:13},void 0),Yn.jsxDEV("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[Yn.jsxDEV("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Swing Resolution"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:146,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-3 gap-2",children:[2,4,8,16,32,64].map(e=>Yn.jsxDEV("button",{onClick:()=>{a(e)},className:"px-2 py-2 text-[10px] font-mono border rounded transition-all "+(s===e?"bg-accent-primary border-accent-primary text-white font-bold":"bg-dark-bgTertiary border-ft2-border text-text-secondary hover:border-text-muted"),children:[2===e?"16th":4===e?"8th":8===e?"4th":e/16+"b",Yn.jsxDEV("div",{className:"text-[8px] opacity-60",children:["(",e," stp)"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:161,columnNumber:21},void 0)]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:149,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:147,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-[10px] text-text-muted italic leading-relaxed",children:"Determines which notes in the pattern cycle are swung. 16th is standard for electronic music."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:165,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:145,columnNumber:13},void 0),Yn.jsxDEV("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("h3",{className:"text-cyan-400 text-xs font-bold tracking-wider uppercase",children:"Humanization (Jitter)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:173,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-lg font-mono text-cyan-400 font-bold leading-none",children:[o,"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:174,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:172,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"space-y-2",children:[Yn.jsxDEV("input",{type:"range",min:"0",max:"100",value:o,onChange:e=>r(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),r(0)},className:"w-full h-2 accent-cyan-500 cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:178,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[Yn.jsxDEV("span",{children:"Robotic"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:191,columnNumber:19},void 0),Yn.jsxDEV("span",{children:"Loose"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:192,columnNumber:19},void 0),Yn.jsxDEV("span",{children:"Drunken"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:193,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:190,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:"Adds random micro-timing offsets (0-10ms) to every note. Simulates unstable vintage clocks or human performance."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:195,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:177,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:171,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:94,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:45,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-between items-center",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[Yn.jsxDEV(Kt,{size:12,className:"text-ft2-highlight"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:206,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Groove affects all patterns globally"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:207,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:205,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:e,className:"px-6 py-1.5 bg-accent-primary border border-accent-primary text-white text-xs font-bold hover:bg-accent-secondary hover:border-accent-secondary transition-all rounded shadow-glow-sm focus:outline-none uppercase tracking-widest",children:"Accept"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:209,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:204,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:30,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/GrooveSettingsModal.tsx",lineNumber:29,columnNumber:5},void 0)},bR=Object.freeze(Object.defineProperty({__proto__:null,GrooveSettingsModal:gR},Symbol.toStringTag,{value:"Module"})),vR=()=>"showOpenFilePicker"in window&&"showDirectoryPicker"in window;let yR=null;function xR(){return yR}async function NR(e,t){const n=await e.createWritable();await n.write(t),await n.close()}const wR=JSON.parse('["/public/data/instruments/furnace/AY/Closed Hat.fui","/public/data/instruments/furnace/AY/Hat-EnvBass.fui","/public/data/instruments/furnace/AY/Heavy Kick and Snare.fui","/public/data/instruments/furnace/AY/Heavy Kick.fui","/public/data/instruments/furnace/AY/Kick E-1.fui","/public/data/instruments/furnace/AY/Open Hat.fui","/public/data/instruments/furnace/AY/Snare A#3.fui","/public/data/instruments/furnace/AY/kick.fui","/public/data/instruments/furnace/AY/snare.fui","/public/data/instruments/furnace/C64/C64Lead.fui","/public/data/instruments/furnace/C64/C64_Bass.fui","/public/data/instruments/furnace/C64/Castanets.fui","/public/data/instruments/furnace/C64/Closed_Hi-hat.fui","/public/data/instruments/furnace/C64/Gunshot.fui","/public/data/instruments/furnace/C64/Open_Hi-hat.fui","/public/data/instruments/furnace/C64/Side_Stick.fui","/public/data/instruments/furnace/C64/Snare.fui","/public/data/instruments/furnace/C64/string_c64.fui","/public/data/instruments/furnace/ESFM/ESFM Guitar Power Chord (note cut for palm mute).fui","/public/data/instruments/furnace/ESFM/Hi-Hat_ESFM.fui","/public/data/instruments/furnace/ESFM/Synth Bass.fui","/public/data/instruments/furnace/ESFM/deep_bass.fui","/public/data/instruments/furnace/ESFM/delayed.fui","/public/data/instruments/furnace/ESFM/djtBMX_1chostinato.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opBassESFM.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings2.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings3.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings4.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opRubbaBassESFM.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMBRAS.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMBRASSSECT.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMGIT.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMPWM.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMSYN.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresobell-short.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresobell.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresopipe.fui","/public/data/instruments/furnace/ESFM/djtBMX_PULSELESSBUZZER.fui","/public/data/instruments/furnace/ESFM/djtBMX_analogoctbas.fui","/public/data/instruments/furnace/ESFM/djtBMX_bells.fui","/public/data/instruments/furnace/ESFM/djtBMX_brarsesin.fui","/public/data/instruments/furnace/ESFM/djtBMX_brassin.fui","/public/data/instruments/furnace/ESFM/djtBMX_bwaro.fui","/public/data/instruments/furnace/ESFM/djtBMX_chorbel.fui","/public/data/instruments/furnace/ESFM/djtBMX_chorpad.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger2.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger3.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger4.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-basskick.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-closehh.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-marimba.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-openhh.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-padbrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-sinetom.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-snare.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-springbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compileagogo.fui","/public/data/instruments/furnace/ESFM/djtBMX_compilebrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compilefartbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_didgeritune.fui","/public/data/instruments/furnace/ESFM/djtBMX_drlead.fui","/public/data/instruments/furnace/ESFM/djtBMX_egless-kick.fui","/public/data/instruments/furnace/ESFM/djtBMX_explosion.fui","/public/data/instruments/furnace/ESFM/djtBMX_falcomkey.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitbsyn3.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitbsyn4.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitsyn2.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitty.fui","/public/data/instruments/furnace/ESFM/djtBMX_hammeredkeypad.fui","/public/data/instruments/furnace/ESFM/djtBMX_kikbas.fui","/public/data/instruments/furnace/ESFM/djtBMX_lfotest.fui","/public/data/instruments/furnace/ESFM/djtBMX_lofibrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_lylemays.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino2.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino3.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino4.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino5.fui","/public/data/instruments/furnace/ESFM/djtBMX_nearest-drone.fui","/public/data/instruments/furnace/ESFM/djtBMX_neophytekick.fui","/public/data/instruments/furnace/ESFM/djtBMX_neophytekick2.fui","/public/data/instruments/furnace/ESFM/djtBMX_noisytom.fui","/public/data/instruments/furnace/ESFM/djtBMX_panfluter.fui","/public/data/instruments/furnace/ESFM/djtBMX_pianoyorgan.fui","/public/data/instruments/furnace/ESFM/djtBMX_piezoclavi.fui","/public/data/instruments/furnace/ESFM/djtBMX_pulselesspulse.fui","/public/data/instruments/furnace/ESFM/djtBMX_pulselesspwm.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwm2.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwm3.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwminv.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope2.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope3.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizeddrone2.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedhorn.fui","/public/data/instruments/furnace/ESFM/djtBMX_santur.fui","/public/data/instruments/furnace/ESFM/djtBMX_santurys.fui","/public/data/instruments/furnace/ESFM/djtBMX_segapiano.fui","/public/data/instruments/furnace/ESFM/djtBMX_shttomsz.fui","/public/data/instruments/furnace/ESFM/djtBMX_sinusoidgit.fui","/public/data/instruments/furnace/ESFM/djtBMX_sitardrone.fui","/public/data/instruments/furnace/ESFM/djtBMX_slapbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_softstar-string-enhanced.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass2.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass3.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass4.fui","/public/data/instruments/furnace/ESFM/djtBMX_squeiuz.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass2.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass3.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass4.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass5.fui","/public/data/instruments/furnace/ESFM/djtBMX_superpwm.fui","/public/data/instruments/furnace/ESFM/djtBMX_sync-invtest.fui","/public/data/instruments/furnace/ESFM/djtBMX_syncpwm-abuse.fui","/public/data/instruments/furnace/ESFM/djtBMX_tabla.fui","/public/data/instruments/furnace/ESFM/djtBMX_tarnceseq.fui","/public/data/instruments/furnace/ESFM/djtBMX_vic20square.fui","/public/data/instruments/furnace/ESFM/djtBMX_vic20squaretest.fui","/public/data/instruments/furnace/ESFM/djtBMX_wurly.fui","/public/data/instruments/furnace/ESFM/fakebits.fui","/public/data/instruments/furnace/ESFM/maj_chord.fui","/public/data/instruments/furnace/ESFM/min_chord.fui","/public/data/instruments/furnace/ESFM/obligatory_supersaw.fui","/public/data/instruments/furnace/ESFM/phat_square.fui","/public/data/instruments/furnace/ESFM/sine_w_reverb.fui","/public/data/instruments/furnace/ESFM/squishsine_organ.fui","/public/data/instruments/furnace/ESFM/stereo_brass_or_strings.fui","/public/data/instruments/furnace/ESFM/weird_bass.fui","/public/data/instruments/furnace/ESFM/wood_block.fui","/public/data/instruments/furnace/GB/GB_Kick.fui","/public/data/instruments/furnace/GB/GB_Lead.fui","/public/data/instruments/furnace/GB/GB_Snare.fui","/public/data/instruments/furnace/GB/closed hi-hat.fui","/public/data/instruments/furnace/GB/kick.fui","/public/data/instruments/furnace/GB/open hihat.fui","/public/data/instruments/furnace/GB/snare.fui","/public/data/instruments/furnace/GB/square fade-in.fui","/public/data/instruments/furnace/Lynx/harmonica.fui","/public/data/instruments/furnace/NES/0-2-5_arp_lead.fui","/public/data/instruments/furnace/NES/0-3-5_arp_lead.fui","/public/data/instruments/furnace/NES/Noise Hi-Hat Closed.fui","/public/data/instruments/furnace/NES/Noise Hi-Hat Open.fui","/public/data/instruments/furnace/NES/Noise Kick.fui","/public/data/instruments/furnace/NES/Noise Snare.fui","/public/data/instruments/furnace/NES/Triangle Kick+Bass.fui","/public/data/instruments/furnace/NES/Triangle Kick.fui","/public/data/instruments/furnace/NES/Triangle Snare+Bass.fui","/public/data/instruments/furnace/NES/Triangle Snare.fui","/public/data/instruments/furnace/OPL/2-OP OPL3 Slap Bass.fui","/public/data/instruments/furnace/OPL/2-op strings.fui","/public/data/instruments/furnace/OPL/2OP Compressed Snare C-3 (Part 1).fui","/public/data/instruments/furnace/OPL/2OP Compressed Snare C-3 (Part 2).fui","/public/data/instruments/furnace/OPL/4op Bass.fui","/public/data/instruments/furnace/OPL/Chorus Organ.fui","/public/data/instruments/furnace/OPL/Closed Hi-hat.fui","/public/data/instruments/furnace/OPL/Crystal.fui","/public/data/instruments/furnace/OPL/DX7 Electric Piano.fui","/public/data/instruments/furnace/OPL/Distortion Guitar.fui","/public/data/instruments/furnace/OPL/Guitar 2.fui","/public/data/instruments/furnace/OPL/Guitar.fui","/public/data/instruments/furnace/OPL/Low Overdriven Guitar (Sine Carrier).fui","/public/data/instruments/furnace/OPL/Low Overdriven Guitar (Square Carrier).fui","/public/data/instruments/furnace/OPL/OPL-ClickKik.fui","/public/data/instruments/furnace/OPL/OPL-RhythmTemplate.fui","/public/data/instruments/furnace/OPL/OPL-RollingDrum.fui","/public/data/instruments/furnace/OPL/OPL1_Ride_Closed.fui","/public/data/instruments/furnace/OPL/OPL2-TwinkleBlare.fui","/public/data/instruments/furnace/OPL/OPL3-4opbrass11.fui","/public/data/instruments/furnace/OPL/OPL3-4opharmonica.fui","/public/data/instruments/furnace/OPL/OPL3-4opsitar.fui","/public/data/instruments/furnace/OPL/OPL3-FakeFalcomGuitar.fui","/public/data/instruments/furnace/OPL/OPL3-FakeFalcomString.fui","/public/data/instruments/furnace/OPL/OPL3-GabberKick.fui","/public/data/instruments/furnace/OPL/OPL3-GabberKick3-60hz-.fui","/public/data/instruments/furnace/OPL/OPL3-MajorSquare.fui","/public/data/instruments/furnace/OPL/OPL3-PWM.fui","/public/data/instruments/furnace/OPL/OPL3-PeriodicNoise.fui","/public/data/instruments/furnace/OPL/OPL3-SegaBass.fui","/public/data/instruments/furnace/OPL/OPL3-SyncDuck.fui","/public/data/instruments/furnace/OPL/OPL3-TwinkleKey.fui","/public/data/instruments/furnace/OPL/OPL3-clap.fui","/public/data/instruments/furnace/OPL/OPL3-easyhoova.fui","/public/data/instruments/furnace/OPL/OPL3_-_C64_like_sqr_snare.fui","/public/data/instruments/furnace/OPL/OPL3_-_PWM_Lead.fui","/public/data/instruments/furnace/OPL/OPL3_BigBass.fui","/public/data/instruments/furnace/OPL/OPL3_C64_Kick_or_Snare_Start.fui","/public/data/instruments/furnace/OPL/OPL3_C64_Snare_Carry.fui","/public/data/instruments/furnace/OPL/OPL3_Slap_Bass.fui","/public/data/instruments/furnace/OPL/OPL3_Springybass.fui","/public/data/instruments/furnace/OPL/OPL_GoodPanFlute.fui","/public/data/instruments/furnace/OPL/OPL_KoreanSquare.fui","/public/data/instruments/furnace/OPL/OPL_SupersawUnit.fui","/public/data/instruments/furnace/OPL/OPL_horn.fui","/public/data/instruments/furnace/OPL/Open Hi-hat.fui","/public/data/instruments/furnace/OPL/Overdriven Guitar.fui","/public/data/instruments/furnace/OPL/Psuedo-PoKEY Perodic Noise (4OP).fui","/public/data/instruments/furnace/OPL/Snare Drum 2.fui","/public/data/instruments/furnace/OPL/Snare Drum.fui","/public/data/instruments/furnace/OPL/Synth Brass.fui","/public/data/instruments/furnace/OPL/Synth Guitar.fui","/public/data/instruments/furnace/OPL/Timpani (OPL3).fui","/public/data/instruments/furnace/OPL/Violin.fui","/public/data/instruments/furnace/OPL/asterix gb clarinet.fui","/public/data/instruments/furnace/OPL/clavinetmaybe.fui","/public/data/instruments/furnace/OPL/detuneexample.fui","/public/data/instruments/furnace/OPL/grand piano.fui","/public/data/instruments/furnace/OPL/kalimba or plain sine i cant tell.fui","/public/data/instruments/furnace/OPL/key.fui","/public/data/instruments/furnace/OPL/marimba.fui","/public/data/instruments/furnace/OPL/opl1 square.fui","/public/data/instruments/furnace/OPL/opl1-hat.fui","/public/data/instruments/furnace/OPL/opl1-kick.fui","/public/data/instruments/furnace/OPL/opl1-snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_1.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_2.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_3.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_kick.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_power_snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_tom.fui","/public/data/instruments/furnace/OPL/opl3_4op_growl_synth.fui","/public/data/instruments/furnace/OPL/opl3_4op_lead_guitar.fui","/public/data/instruments/furnace/OPL/opl3_4op_piano_bell.fui","/public/data/instruments/furnace/OPL/opl3_4op_rhythm_guitar_1.fui","/public/data/instruments/furnace/OPL/opl3_4op_rhythm_guitar_2.fui","/public/data/instruments/furnace/OPL/opl3_4op_strings.fui","/public/data/instruments/furnace/OPL/sax.fui","/public/data/instruments/furnace/OPL/tuba trumpet thing.fui","/public/data/instruments/furnace/OPLL/Acoustic Bass.fui","/public/data/instruments/furnace/OPLL/Almost_Sine.fui","/public/data/instruments/furnace/OPLL/Alt_Oboe.fui","/public/data/instruments/furnace/OPLL/Better_Electric_Guitar.fui","/public/data/instruments/furnace/OPLL/Chime.fui","/public/data/instruments/furnace/OPLL/Electric_Guitar_2.fui","/public/data/instruments/furnace/OPLL/Electric_Guitar_3.fui","/public/data/instruments/furnace/OPLL/Finger_Bass.fui","/public/data/instruments/furnace/OPLL/Glass_and_Wood.fui","/public/data/instruments/furnace/OPLL/Half_Sine.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Hi-Hat.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Kick.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Snare.fui","/public/data/instruments/furnace/OPLL/Hihat_Plus_Brass.fui","/public/data/instruments/furnace/OPLL/OPLL_Clickik.fui","/public/data/instruments/furnace/OPLL/Overdriven_Guitar.fui","/public/data/instruments/furnace/OPLL/Rainbow_Bell.fui","/public/data/instruments/furnace/OPLL/Reedlike_Sound.fui","/public/data/instruments/furnace/OPLL/Soft_Bass.fui","/public/data/instruments/furnace/OPLL/Soft_Clarinet.fui","/public/data/instruments/furnace/OPLL/Soft_EP.fui","/public/data/instruments/furnace/OPLL/Soft_Flute.fui","/public/data/instruments/furnace/OPLL/Steel_Guitar.fui","/public/data/instruments/furnace/OPLL/Synth_Marimba.fui","/public/data/instruments/furnace/OPLL/Triangle_Recorder.fui","/public/data/instruments/furnace/OPLL/Weeppiko-piano_guitar_idk.fui","/public/data/instruments/furnace/OPM/Acid_Bass.fui","/public/data/instruments/furnace/OPM/OPM Power Snare.fui","/public/data/instruments/furnace/OPM/OPMSquare.fui","/public/data/instruments/furnace/OPM/OPMTrumpet.fui","/public/data/instruments/furnace/OPM/Picked_Bass.fui","/public/data/instruments/furnace/OPM/Timpani (OPM).fui","/public/data/instruments/furnace/OPM/dx7tubularbell_opm.fui","/public/data/instruments/furnace/OPN/bass/4-OP_Vowel_Bass.fui","/public/data/instruments/furnace/OPN/bass/4_OP_Funky_Bass.fui","/public/data/instruments/furnace/OPN/bass/A.Bass1.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2a.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2b.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2c.fui","/public/data/instruments/furnace/OPN/bass/Algorithmic Bass.fui","/public/data/instruments/furnace/OPN/bass/Bass.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass1.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass2.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass3.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1d.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1e.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3d.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3e.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3f.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3g.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass5.fui","/public/data/instruments/furnace/OPN/bass/E.Bass6.fui","/public/data/instruments/furnace/OPN/bass/E.Bass7.fui","/public/data/instruments/furnace/OPN/bass/FM_CriminalBass.fui","/public/data/instruments/furnace/OPN/bass/Finger Bass.fui","/public/data/instruments/furnace/OPN/bass/FingerBass.fui","/public/data/instruments/furnace/OPN/bass/House Bass 2.fui","/public/data/instruments/furnace/OPN/bass/House Bass.fui","/public/data/instruments/furnace/OPN/bass/House_Bass.fui","/public/data/instruments/furnace/OPN/bass/PickBass.fui","/public/data/instruments/furnace/OPN/bass/PickMD.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 2.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 3.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 4.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass.fui","/public/data/instruments/furnace/OPN/bass/bass1.fui","/public/data/instruments/furnace/OPN/bass/bass2.fui","/public/data/instruments/furnace/OPN/bass/bass3.fui","/public/data/instruments/furnace/OPN/bass/bass4.fui","/public/data/instruments/furnace/OPN/bass/bass5.fui","/public/data/instruments/furnace/OPN/bass/bass6.fui","/public/data/instruments/furnace/OPN/bass/bass_acoustic_00.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_00.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_01.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_02.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_03_muffled.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_04.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_05_amp.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_00_wobbly.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_01_wobbly2.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_02_wobbly3.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_00.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_01_snappy.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_02.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_00.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_01.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_02.fui","/public/data/instruments/furnace/OPN/bass/fm_bass1.fui","/public/data/instruments/furnace/OPN/bass/fm_bass2.fui","/public/data/instruments/furnace/OPN/bass/fm_bass3.fui","/public/data/instruments/furnace/OPN/bass/opm_nestri.fui","/public/data/instruments/furnace/OPN/bass/tarylbass1.fui","/public/data/instruments/furnace/OPN/default.fui","/public/data/instruments/furnace/OPN/drums/4-7 Snare.fui","/public/data/instruments/furnace/OPN/drums/Compressed Clap.fui","/public/data/instruments/furnace/OPN/drums/Compressed FM Snare Drum.fui","/public/data/instruments/furnace/OPN/drums/Cymbal.fui","/public/data/instruments/furnace/OPN/drums/Drum.fui","/public/data/instruments/furnace/OPN/drums/GB Tom.fui","/public/data/instruments/furnace/OPN/drums/Heavy EDM Kick F#5.fui","/public/data/instruments/furnace/OPN/drums/Heavy EDM Kick+Snare F#5.fui","/public/data/instruments/furnace/OPN/drums/Heavy Kick.fui","/public/data/instruments/furnace/OPN/drums/Kick Drum.fui","/public/data/instruments/furnace/OPN/drums/OPM-lowpitch-fmclap.fui","/public/data/instruments/furnace/OPN/drums/Single Clap.fui","/public/data/instruments/furnace/OPN/drums/Snare Drum.fui","/public/data/instruments/furnace/OPN/drums/Squishy Snare.fui","/public/data/instruments/furnace/OPN/drums/crash_00.fui","/public/data/instruments/furnace/OPN/drums/fmbigkick.fui","/public/data/instruments/furnace/OPN/drums/fmclap.fui","/public/data/instruments/furnace/OPN/drums/fmclap2.fui","/public/data/instruments/furnace/OPN/drums/fmhat.fui","/public/data/instruments/furnace/OPN/drums/fmopenhat.fui","/public/data/instruments/furnace/OPN/drums/hihat_00.fui","/public/data/instruments/furnace/OPN/drums/idk_something_percussion.fui","/public/data/instruments/furnace/OPN/drums/kick_00_classic.fui","/public/data/instruments/furnace/OPN/drums/kick_01_power.fui","/public/data/instruments/furnace/OPN/drums/kick_02_power2.fui","/public/data/instruments/furnace/OPN/drums/kick_03_muffled.fui","/public/data/instruments/furnace/OPN/drums/kick_04_bassdrum.fui","/public/data/instruments/furnace/OPN/drums/kick_05_noisy.fui","/public/data/instruments/furnace/OPN/drums/kick_06_fat.fui","/public/data/instruments/furnace/OPN/drums/kick_07_fat2.fui","/public/data/instruments/furnace/OPN/drums/powersnare.fui","/public/data/instruments/furnace/OPN/drums/snare_00_simple.fui","/public/data/instruments/furnace/OPN/drums/snare_01_curvy.fui","/public/data/instruments/furnace/OPN/drums/snare_02_weak.fui","/public/data/instruments/furnace/OPN/drums/snare_03_weak2.fui","/public/data/instruments/furnace/OPN/drums/snare_04_muffled.fui","/public/data/instruments/furnace/OPN/drums/snare_05_intense.fui","/public/data/instruments/furnace/OPN/drums/snareclap_G-2.fui","/public/data/instruments/furnace/OPN/effect/Wind.fui","/public/data/instruments/furnace/OPN/effect/fm_propeller.fui","/public/data/instruments/furnace/OPN/effect/weird.fui","/public/data/instruments/furnace/OPN/guitar/ElectricGuitar.fui","/public/data/instruments/furnace/OPN/guitar/Funk Guitar.fui","/public/data/instruments/furnace/OPN/guitar/Hard Guitar.fui","/public/data/instruments/furnace/OPN/guitar/YM2151_DistGuitar.fui","/public/data/instruments/furnace/OPN/guitar/distguitar_00.fui","/public/data/instruments/furnace/OPN/guitar/distortion2.fui","/public/data/instruments/furnace/OPN/guitar/powerchord.fui","/public/data/instruments/furnace/OPN/horn/Brass Lead 1.fui","/public/data/instruments/furnace/OPN/horn/Brass Lead 2.fui","/public/data/instruments/furnace/OPN/horn/SynthBrass.fui","/public/data/instruments/furnace/OPN/horn/Trumpet 1.fui","/public/data/instruments/furnace/OPN/horn/Trumpet 2.fui","/public/data/instruments/furnace/OPN/horn/Tuba.fui","/public/data/instruments/furnace/OPN/horn/brass_00_wobbly.fui","/public/data/instruments/furnace/OPN/horn/brass_01_bassish.fui","/public/data/instruments/furnace/OPN/horn/brass_02_boring.fui","/public/data/instruments/furnace/OPN/horn/brass_03_boring2.fui","/public/data/instruments/furnace/OPN/keys/Acoustic E-Piano.fui","/public/data/instruments/furnace/OPN/keys/Circus Organ.fui","/public/data/instruments/furnace/OPN/keys/Digital Clav 1.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 1.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 2.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 3.fui","/public/data/instruments/furnace/OPN/keys/ElisOrgan.fui","/public/data/instruments/furnace/OPN/keys/Organ 3.fui","/public/data/instruments/furnace/OPN/keys/Organ 4.fui","/public/data/instruments/furnace/OPN/keys/Piano.fui","/public/data/instruments/furnace/OPN/keys/PianoMD.fui","/public/data/instruments/furnace/OPN/keys/YM2151_E-PIANO.fui","/public/data/instruments/furnace/OPN/keys/fmpiano.fui","/public/data/instruments/furnace/OPN/percussion/BellMD.fui","/public/data/instruments/furnace/OPN/percussion/ChurchBell.fui","/public/data/instruments/furnace/OPN/percussion/Dangerously Cheap Timpani.fui","/public/data/instruments/furnace/OPN/percussion/Kalimba.fui","/public/data/instruments/furnace/OPN/percussion/Marimba.fui","/public/data/instruments/furnace/OPN/percussion/MusicBox.fui","/public/data/instruments/furnace/OPN/percussion/Music_Box.fui","/public/data/instruments/furnace/OPN/percussion/OPM-lowpitch-fmclap.fui","/public/data/instruments/furnace/OPN/percussion/Timpani (OPN).fui","/public/data/instruments/furnace/OPN/percussion/agogo.fui","/public/data/instruments/furnace/OPN/percussion/bell_00_glockenspiel.fui","/public/data/instruments/furnace/OPN/percussion/bell_01_glockenspiel_echoing.fui","/public/data/instruments/furnace/OPN/percussion/bell_02_glockenspiel_wobbly.fui","/public/data/instruments/furnace/OPN/percussion/dx7tubularbell_opn.fui","/public/data/instruments/furnace/OPN/percussion/fm_cowbell.fui","/public/data/instruments/furnace/OPN/percussion/octave_8_bell.fui","/public/data/instruments/furnace/OPN/strings/5thsPad.fui","/public/data/instruments/furnace/OPN/strings/Slow Strings.fui","/public/data/instruments/furnace/OPN/strings/String.fui","/public/data/instruments/furnace/OPN/strings/Violin.fui","/public/data/instruments/furnace/OPN/strings/ViolinMD.fui","/public/data/instruments/furnace/OPN/strings/strings_00.fui","/public/data/instruments/furnace/OPN/synth/Cricket Chorus.fui","/public/data/instruments/furnace/OPN/synth/FM_noname1.fui","/public/data/instruments/furnace/OPN/synth/Kirby SNES Synth Pad.fui","/public/data/instruments/furnace/OPN/synth/Metallic FM Lead.fui","/public/data/instruments/furnace/OPN/synth/Octave_Square.fui","/public/data/instruments/furnace/OPN/synth/Octave_Square2.fui","/public/data/instruments/furnace/OPN/synth/Reverby_Live_Chords.fui","/public/data/instruments/furnace/OPN/synth/Saw Lead.fui","/public/data/instruments/furnace/OPN/synth/Square.fui","/public/data/instruments/furnace/OPN/synth/dodo.fui","/public/data/instruments/furnace/OPN/synth/fm_grinder.fui","/public/data/instruments/furnace/OPN/synth/fm_horror.fui","/public/data/instruments/furnace/OPN/synth/fm_noname2.fui","/public/data/instruments/furnace/OPN/synth/fm_noname3.fui","/public/data/instruments/furnace/OPN/synth/fm_noname4.fui","/public/data/instruments/furnace/OPN/synth/fm_noname5.fui","/public/data/instruments/furnace/OPN/synth/fm_noname6.fui","/public/data/instruments/furnace/OPN/synth/fm_noname7.fui","/public/data/instruments/furnace/OPN/synth/growl.fui","/public/data/instruments/furnace/OPN/synth/pateta.fui","/public/data/instruments/furnace/OPN/wind/BottleBlow.fui","/public/data/instruments/furnace/OPN/wind/Clarinet.fui","/public/data/instruments/furnace/OPN/wind/FM_4OP_-_Tenor_Sax.fui","/public/data/instruments/furnace/OPN/wind/Harmonica 2.fui","/public/data/instruments/furnace/OPN/wind/Sax 1.fui","/public/data/instruments/furnace/OPN/wind/Sax 2 (Bari).fui","/public/data/instruments/furnace/OPN/wind/bassoon.fui","/public/data/instruments/furnace/OPN/wind/bassoon_clarinet.fui","/public/data/instruments/furnace/OPN/wind/fm_pipeflute.fui","/public/data/instruments/furnace/OPN/wind/woodwind_00.fui","/public/data/instruments/furnace/OPZ/Another_Synth_Bass.fui","/public/data/instruments/furnace/OPZ/Banjo.fui","/public/data/instruments/furnace/OPZ/Fake SNES Bass_OPZ.fui","/public/data/instruments/furnace/OPZ/Fake_Famicom_Tri.fui","/public/data/instruments/furnace/OPZ/Funky_Bass.fui","/public/data/instruments/furnace/OPZ/Heavy_synth_bass.fui","/public/data/instruments/furnace/OPZ/Organ_OPZ.fui","/public/data/instruments/furnace/OPZ/Synth Bass.fui","/public/data/instruments/furnace/OPZ/accordion.fui","/public/data/instruments/furnace/OPZ/accordion2.fui","/public/data/instruments/furnace/OPZ/bagpipe.fui","/public/data/instruments/furnace/OPZ/distortedhalfsinepad.fui","/public/data/instruments/furnace/OPZ/funkysynthbass.fui","/public/data/instruments/furnace/OPZ/halfsine_pad.fui","/public/data/instruments/furnace/OPZ/horrorpad.fui","/public/data/instruments/furnace/OPZ/overdriven_guitar.fui","/public/data/instruments/furnace/OPZ/pickbass.fui","/public/data/instruments/furnace/OPZ/reedorgan.fui","/public/data/instruments/furnace/OPZ/rimshot.fui","/public/data/instruments/furnace/OPZ/sitar.fui","/public/data/instruments/furnace/OPZ/synthdulcimer.fui","/public/data/instruments/furnace/OPZ/timpani_oct2.fui","/public/data/instruments/furnace/SAA/EnvBass.fui","/public/data/instruments/furnace/SAA/RanedomHatC.fui","/public/data/instruments/furnace/SAA/RanedomKick.fui","/public/data/instruments/furnace/SAA/RanedomSnare.fui","/public/data/instruments/furnace/SN7/0-2-5_arp_lead.fui","/public/data/instruments/furnace/SN7/0-3-5_arp_lead.fui","/public/data/instruments/furnace/SN7/Echo.fui","/public/data/instruments/furnace/SN7/Flute.fui","/public/data/instruments/furnace/SN7/Follin Guitar 2.fui","/public/data/instruments/furnace/SN7/Follin Guitar.fui","/public/data/instruments/furnace/SN7/Guitar.fui","/public/data/instruments/furnace/SN7/Octave Arp.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [Hat] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [KickSnare] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [Nothing] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Hat_Closed CH4 [D].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Hat_Open CH4 [D].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Kick CH4 [C].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc KickSnare CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Snare CH4 [D].fui","/public/data/instruments/furnace/SN7/compatibility.fui","/public/data/instruments/furnace/TIA/Bass Drum.fui","/public/data/instruments/furnace/TIA/Clap.fui","/public/data/instruments/furnace/TIA/Hi-Hat Long.fui","/public/data/instruments/furnace/TIA/Hi-Hat.fui","/public/data/instruments/furnace/TIA/Snare Drum.fui","/public/data/instruments/furnace/TODO/(WSG) Supersaw.fui","/public/data/instruments/furnace/TODO/FDS-oneofthosejapaneseguitarsidkhowtheyarecalledyeah.fui","/public/data/instruments/furnace/TODO/FDS-overfuckingholyshitdriven-guitar.fui","/public/data/instruments/furnace/TODO/FDS-slapassbass.fui","/public/data/instruments/furnace/VERA/0-2-5_arp_lead.fui","/public/data/instruments/furnace/VERA/0-3-5_arp_lead.fui","/public/data/instruments/furnace/VERA/Noise_Kick.fui","/public/data/instruments/furnace/VERA/Noise_Snare.fui","/public/data/instruments/furnace/VIC/kick.fui","/public/data/samples/packs/casio-mt40/leads/accordion.wav","/public/data/samples/packs/casio-mt40/leads/banjo.wav","/public/data/samples/packs/casio-mt40/leads/bass.wav","/public/data/samples/packs/casio-mt40/leads/brass.wav","/public/data/samples/packs/casio-mt40/leads/celesta.wav","/public/data/samples/packs/casio-mt40/leads/cello.wav","/public/data/samples/packs/casio-mt40/leads/clarinet.wav","/public/data/samples/packs/casio-mt40/leads/elec piano.wav","/public/data/samples/packs/casio-mt40/leads/flute.wav","/public/data/samples/packs/casio-mt40/leads/folk flute.wav","/public/data/samples/packs/casio-mt40/leads/funny fuzz.wav","/public/data/samples/packs/casio-mt40/leads/glocken.wav","/public/data/samples/packs/casio-mt40/leads/guitar.wav","/public/data/samples/packs/casio-mt40/leads/harpsichord.wav","/public/data/samples/packs/casio-mt40/leads/organ.wav","/public/data/samples/packs/casio-mt40/leads/oriental.wav","/public/data/samples/packs/casio-mt40/leads/pipe-organ.wav","/public/data/samples/packs/casio-mt40/leads/recorder.wav","/public/data/samples/packs/casio-mt40/leads/st ensemble.wav","/public/data/samples/packs/casio-mt40/leads/synth fuzz.wav","/public/data/samples/packs/casio-mt40/leads/trumpet.wav","/public/data/samples/packs/casio-mt40/leads/violin.wav","/public/data/samples/packs/casio-mt40/leads/xylophone.wav","/public/data/samples/packs/drumnibus/fx/FX_AnalogFX1.wav","/public/data/samples/packs/drumnibus/fx/FX_AnalogFX2.wav","/public/data/samples/packs/drumnibus/fx/FX_Blarper.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst2.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst3.wav","/public/data/samples/packs/drumnibus/fx/FX_Burst1.wav","/public/data/samples/packs/drumnibus/fx/FX_Burst2.wav","/public/data/samples/packs/drumnibus/fx/FX_Chainmalz.wav","/public/data/samples/packs/drumnibus/fx/FX_Digidap2.wav","/public/data/samples/packs/drumnibus/fx/FX_Digidap3.wav","/public/data/samples/packs/drumnibus/fx/FX_Drumaxia.wav","/public/data/samples/packs/drumnibus/fx/FX_Drumaxia2.wav","/public/data/samples/packs/drumnibus/fx/FX_ElectroIsland.wav","/public/data/samples/packs/drumnibus/fx/FX_ElectroIsland2.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx1.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx2.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx3.wav","/public/data/samples/packs/drumnibus/fx/FX_LofiHuman.wav","/public/data/samples/packs/drumnibus/fx/FX_LofiHuman2.wav","/public/data/samples/packs/drumnibus/fx/FX_Magstorm1.wav","/public/data/samples/packs/drumnibus/fx/FX_Magstorm2.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiElastiek.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLectric.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLectric2.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiSnip.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiSpring.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni1.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni2.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni3.wav","/public/data/samples/packs/drumnibus/fx/FX_Quarkulator.wav","/public/data/samples/packs/drumnibus/fx/FX_Quarkulator2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sloiz.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon1.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon2.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon3.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon3B.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon5.wav","/public/data/samples/packs/drumnibus/fx/FX_Sonar.wav","/public/data/samples/packs/drumnibus/fx/FX_Sonar2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum1.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum3.wav","/public/data/samples/packs/drumnibus/fx/FX_Timpio.wav","/public/data/samples/packs/drumnibus/hihats/CH_Digidap.wav","/public/data/samples/packs/drumnibus/hihats/CH_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/hihats/CH_DraconisD921.wav","/public/data/samples/packs/drumnibus/hihats/CH_DraconisD922.wav","/public/data/samples/packs/drumnibus/hihats/CH_Fantio_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Filtix_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/CH_LofiHuman.wav","/public/data/samples/packs/drumnibus/hihats/CH_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/CH_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/CH_Rezmatix_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Rubydub.wav","/public/data/samples/packs/drumnibus/hihats/CH_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/CH_Sizzel_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Synthique.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogOpenhatwav.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogVeryLongHat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Digidap.wav","/public/data/samples/packs/drumnibus/hihats/OH_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/hihats/OH_DraconisD921.wav","/public/data/samples/packs/drumnibus/hihats/OH_DraconisD922.wav","/public/data/samples/packs/drumnibus/hihats/OH_Drumaxia.wav","/public/data/samples/packs/drumnibus/hihats/OH_Fantio_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Filtix_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/OH_LofiHuman.wav","/public/data/samples/packs/drumnibus/hihats/OH_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/OH_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rezmatix_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rezmatix_Open_Hat_Long.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rubydub.wav","/public/data/samples/packs/drumnibus/hihats/OH_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/OH_Sizzel_Open_Hat.wav","/public/data/samples/packs/drumnibus/kicks/BB_Electro1short.wav","/public/data/samples/packs/drumnibus/kicks/BD_808A1200.wav","/public/data/samples/packs/drumnibus/kicks/BD_DiggerLong.wav","/public/data/samples/packs/drumnibus/kicks/BD_Digidap.wav","/public/data/samples/packs/drumnibus/kicks/BD_Digimozzy.wav","/public/data/samples/packs/drumnibus/kicks/BD_Dikkie.wav","/public/data/samples/packs/drumnibus/kicks/BD_Dome_Long.wav","/public/data/samples/packs/drumnibus/kicks/BD_Drumaxia.wav","/public/data/samples/packs/drumnibus/kicks/BD_EchoRam1.wav","/public/data/samples/packs/drumnibus/kicks/BD_EchoRam2.wav","/public/data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav","/public/data/samples/packs/drumnibus/kicks/BD_Juxtapos.wav","/public/data/samples/packs/drumnibus/kicks/BD_Lite2021.wav","/public/data/samples/packs/drumnibus/kicks/BD_LofiHuman.wav","/public/data/samples/packs/drumnibus/kicks/BD_Losamplix.wav","/public/data/samples/packs/drumnibus/kicks/BD_Magnotron..wav","/public/data/samples/packs/drumnibus/kicks/BD_Matrixtape1.wav","/public/data/samples/packs/drumnibus/kicks/BD_Matrixtape2.wav","/public/data/samples/packs/drumnibus/kicks/BD_Plastiklog.wav","/public/data/samples/packs/drumnibus/kicks/BD_Pufsub.wav","/public/data/samples/packs/drumnibus/kicks/BD_Punchtron.wav","/public/data/samples/packs/drumnibus/kicks/BD_Punchysplur.wav","/public/data/samples/packs/drumnibus/kicks/BD_Pziforze.wav","/public/data/samples/packs/drumnibus/kicks/BD_Ritmo.wav","/public/data/samples/packs/drumnibus/kicks/BD_Romkick1.wav","/public/data/samples/packs/drumnibus/kicks/BD_Rubydub.wav","/public/data/samples/packs/drumnibus/kicks/BD_Ruflex.wav","/public/data/samples/packs/drumnibus/kicks/BD_Simpletron.wav","/public/data/samples/packs/drumnibus/kicks/BD_Springworth.wav","/public/data/samples/packs/drumnibus/kicks/BD_Spriverbion.wav","/public/data/samples/packs/drumnibus/kicks/BD_Stuf.wav","/public/data/samples/packs/drumnibus/kicks/BD_SubThud.wav","/public/data/samples/packs/drumnibus/kicks/BD_Zistort.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Darkgong.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Filterbell.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal2.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal3.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Ryhtmbox.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Ryhtmbox2.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Simple.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_LofiHuman.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Ruflex.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Singalique.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Syntheticblox.wav","/public/data/samples/packs/drumnibus/percussion/CONGA_Lowpark.wav","/public/data/samples/packs/drumnibus/percussion/CONGA_Syntique.wav","/public/data/samples/packs/drumnibus/percussion/COW_Syntique.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip3.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Chewy1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Digidap.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Drumaxia.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Lectrophy.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Lectrophy2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Mambalazesnare.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_R900.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond3.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix3.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Losimple.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker1.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker2.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker3.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_Ritmo.wav","/public/data/samples/packs/drumnibus/percussion/SNAP_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/TABLA_Mamba.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_Tamb&Shaker.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake1.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake2.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake3.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DistortedRitmoHi.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DraconisDS92.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DraconisDS92high.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Druimaxia.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/TOM_LofiHuman.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Osciaz.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Ruflex.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Stofelectro1.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom2.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom3.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Warped.wav","/public/data/samples/packs/drumnibus/percussion/TOM_digger.wav","/public/data/samples/packs/drumnibus/snares/SD_808A1200.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_2.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_4.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_5.wav","/public/data/samples/packs/drumnibus/snares/SD_CompuCrunchy.wav","/public/data/samples/packs/drumnibus/snares/SD_Digidap.wav","/public/data/samples/packs/drumnibus/snares/SD_Draconis1.wav","/public/data/samples/packs/drumnibus/snares/SD_Draconis2.wav","/public/data/samples/packs/drumnibus/snares/SD_Drumaxia.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram1.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram2.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram3.wav","/public/data/samples/packs/drumnibus/snares/SD_Hark.wav","/public/data/samples/packs/drumnibus/snares/SD_Juxtapos.wav","/public/data/samples/packs/drumnibus/snares/SD_Kitcatlitter.wav","/public/data/samples/packs/drumnibus/snares/SD_LoDigital_1.wav","/public/data/samples/packs/drumnibus/snares/SD_LoDigital_2.wav","/public/data/samples/packs/drumnibus/snares/SD_LofiHuman.wav","/public/data/samples/packs/drumnibus/snares/SD_Magnotron.wav","/public/data/samples/packs/drumnibus/snares/SD_Mamba.wav","/public/data/samples/packs/drumnibus/snares/SD_Mambalazesnare.wav","/public/data/samples/packs/drumnibus/snares/SD_Mambalazesnare2.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnare.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnareLazer.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnareWhip.wav","/public/data/samples/packs/drumnibus/snares/SD_Punchtron..wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz1.wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz2.wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz3.wav","/public/data/samples/packs/drumnibus/snares/SD_Ritmo.wav","/public/data/samples/packs/drumnibus/snares/SD_Rubydubwav.wav","/public/data/samples/packs/drumnibus/snares/SD_Ruflex.wav","/public/data/samples/packs/drumnibus/snares/SD_Strakker.wav","/public/data/samples/packs/drumnibus/snares/SD_Turbosound.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf1.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf2.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_3.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_5.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_6.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_7.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_8.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_9.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolfsweep1.wav","/public/data/samples/packs/drumnibus/snares/SD_electro7000.wav","/public/data/samples/packs/scratch-originals/manifest.json","/public/data/samples/packs/scratch-originals/scratch_001.wav","/public/data/samples/packs/scratch-originals/scratch_002.wav","/public/data/samples/packs/scratch-originals/scratch_003.wav","/public/data/samples/packs/scratch-originals/scratch_004.wav","/public/data/samples/packs/scratch-originals/scratch_005.wav","/public/data/samples/packs/scratch-originals/scratch_006.wav","/public/data/samples/packs/scratch-originals/scratch_007.wav","/public/data/samples/packs/scratch-originals/scratch_008.wav","/public/data/samples/packs/scratch-originals/scratch_009.wav","/public/data/samples/packs/scratch-originals/scratch_010.wav","/public/data/samples/packs/scratch-originals/scratch_011.wav","/public/data/samples/packs/scratch-originals/scratch_012.wav","/public/data/samples/packs/scratch-originals/scratch_013.wav","/public/data/samples/packs/scratch-originals/scratch_014.wav","/public/data/samples/packs/scratch-originals/scratch_015.wav","/public/data/samples/packs/scratch-originals/scratch_016.wav","/public/data/samples/packs/scratch-originals/scratch_017.wav","/public/data/samples/packs/scratch-originals/scratch_018.wav","/public/data/samples/packs/scratch-originals/scratch_019.wav","/public/data/samples/packs/scratch-originals/scratch_020.wav","/public/data/samples/packs/scratch-originals/scratch_021.wav","/public/data/samples/packs/scratch-originals/scratch_022.wav","/public/data/samples/packs/scratch-originals/scratch_023.wav","/public/data/samples/packs/scratch-originals/scratch_024.wav","/public/data/samples/packs/scratch-originals/scratch_025.wav","/public/data/samples/packs/scratch-originals/scratch_026.wav","/public/data/samples/packs/scratch-originals/scratch_027.wav","/public/data/samples/packs/scratch-originals/scratch_028.wav","/public/data/samples/packs/scratch-originals/scratch_029.wav","/public/data/samples/packs/scratch-originals/scratch_030.wav","/public/data/samples/packs/scratch-originals/scratch_031.wav","/public/data/samples/packs/scratch-originals/scratch_032.wav","/public/data/samples/packs/scratch-originals/scratch_033.wav","/public/data/samples/packs/scratch-originals/scratch_034.wav","/public/data/samples/packs/scratch-originals/scratch_035.wav","/public/data/samples/packs/scratch-originals/scratch_036.wav","/public/data/samples/packs/scratch-originals/scratch_037.wav","/public/data/samples/packs/scratch-originals/scratch_038.wav","/public/data/samples/packs/scratch-originals/scratch_039.wav","/public/data/samples/packs/scratch-originals/scratch_040.wav","/public/data/samples/packs/scratch-originals/scratch_041.wav","/public/data/samples/packs/scratch-originals/scratch_042.wav","/public/data/samples/packs/scratch-originals/scratch_043.wav","/public/data/samples/packs/scratch-originals/scratch_044.wav","/public/data/samples/packs/scratch-originals/scratch_045.wav","/public/data/samples/packs/scratch-originals/scratch_046.wav","/public/data/samples/packs/scratch-originals/scratch_047.wav","/public/data/samples/packs/scratch-originals/scratch_048.wav","/public/data/samples/packs/scratch-originals/scratch_049.wav","/public/data/samples/packs/scratch-originals/scratch_050.wav","/public/data/samples/packs/scratch-originals/scratch_051.wav","/public/data/samples/packs/scratch-originals/scratch_053.wav","/public/data/samples/packs/st-01/Alien.wav","/public/data/samples/packs/st-01/Aligator.wav","/public/data/samples/packs/st-01/AnalogString.wav","/public/data/samples/packs/st-01/Asia.wav","/public/data/samples/packs/st-01/BassDrum1.wav","/public/data/samples/packs/st-01/BassDrum2.wav","/public/data/samples/packs/st-01/BassDrum3.wav","/public/data/samples/packs/st-01/BassDrum4.wav","/public/data/samples/packs/st-01/BigBow.wav","/public/data/samples/packs/st-01/Blast.wav","/public/data/samples/packs/st-01/Blubzing.wav","/public/data/samples/packs/st-01/Breath.wav","/public/data/samples/packs/st-01/Call.wav","/public/data/samples/packs/st-01/Celeste.wav","/public/data/samples/packs/st-01/Chink.wav","/public/data/samples/packs/st-01/Cinema.wav","/public/data/samples/packs/st-01/Claps1.wav","/public/data/samples/packs/st-01/Claps2.wav","/public/data/samples/packs/st-01/Claves.wav","/public/data/samples/packs/st-01/CloseHiHat.wav","/public/data/samples/packs/st-01/Conga.wav","/public/data/samples/packs/st-01/CowBell.wav","/public/data/samples/packs/st-01/DXBass.wav","/public/data/samples/packs/st-01/Dangerous.wav","/public/data/samples/packs/st-01/DeepBass.wav","/public/data/samples/packs/st-01/Detune.wav","/public/data/samples/packs/st-01/DigDug.wav","/public/data/samples/packs/st-01/DigiHarp.wav","/public/data/samples/packs/st-01/DreamBells.wav","/public/data/samples/packs/st-01/DxTom.wav","/public/data/samples/packs/st-01/EPiano.wav","/public/data/samples/packs/st-01/ElecTom.wav","/public/data/samples/packs/st-01/ExBells.wav","/public/data/samples/packs/st-01/FaeryTale.wav","/public/data/samples/packs/st-01/FilterBass.wav","/public/data/samples/packs/st-01/FunBass.wav","/public/data/samples/packs/st-01/FunkBass.wav","/public/data/samples/packs/st-01/Gato.wav","/public/data/samples/packs/st-01/Great.wav","/public/data/samples/packs/st-01/HallBrass.wav","/public/data/samples/packs/st-01/Heaven.wav","/public/data/samples/packs/st-01/HeavySynth.wav","/public/data/samples/packs/st-01/Heifer.wav","/public/data/samples/packs/st-01/HiHat1.wav","/public/data/samples/packs/st-01/HiHat2.wav","/public/data/samples/packs/st-01/Hooman.wav","/public/data/samples/packs/st-01/Horns.wav","/public/data/samples/packs/st-01/JahrMarkt1.wav","/public/data/samples/packs/st-01/JahrMarkt2.wav","/public/data/samples/packs/st-01/Jetes.wav","/public/data/samples/packs/st-01/Klickorgan.wav","/public/data/samples/packs/st-01/KorgBass.wav","/public/data/samples/packs/st-01/KorgBeau.wav","/public/data/samples/packs/st-01/KorgBow.wav","/public/data/samples/packs/st-01/KorgFilter.wav","/public/data/samples/packs/st-01/KorgString.wav","/public/data/samples/packs/st-01/Koto.wav","/public/data/samples/packs/st-01/Leader.wav","/public/data/samples/packs/st-01/Licks.wav","/public/data/samples/packs/st-01/Magic.wav","/public/data/samples/packs/st-01/Marimba.wav","/public/data/samples/packs/st-01/Mechanic1.wav","/public/data/samples/packs/st-01/Mechanic2.wav","/public/data/samples/packs/st-01/MetalKeys.wav","/public/data/samples/packs/st-01/MonoBass.wav","/public/data/samples/packs/st-01/MonsterBass.wav","/public/data/samples/packs/st-01/MuteClav.wav","/public/data/samples/packs/st-01/Nice.wav","/public/data/samples/packs/st-01/NightMare.wav","/public/data/samples/packs/st-01/NoteMan.wav","/public/data/samples/packs/st-01/Organ.wav","/public/data/samples/packs/st-01/Outlaw.wav","/public/data/samples/packs/st-01/PanFlute.wav","/public/data/samples/packs/st-01/Perco.wav","/public/data/samples/packs/st-01/PingBells.wav","/public/data/samples/packs/st-01/Pizza.wav","/public/data/samples/packs/st-01/PolySynth.wav","/public/data/samples/packs/st-01/PopBass.wav","/public/data/samples/packs/st-01/PopSnare1.wav","/public/data/samples/packs/st-01/PopSnare2.wav","/public/data/samples/packs/st-01/PopSnare3.wav","/public/data/samples/packs/st-01/Pulse.wav","/public/data/samples/packs/st-01/RichString.wav","/public/data/samples/packs/st-01/RingPiano.wav","/public/data/samples/packs/st-01/RoomBrass.wav","/public/data/samples/packs/st-01/RubberBass.wav","/public/data/samples/packs/st-01/Shaker.wav","/public/data/samples/packs/st-01/Shamus.wav","/public/data/samples/packs/st-01/SineCZ.wav","/public/data/samples/packs/st-01/SixTease.wav","/public/data/samples/packs/st-01/SlapBass.wav","/public/data/samples/packs/st-01/Smash1.wav","/public/data/samples/packs/st-01/Smash2.wav","/public/data/samples/packs/st-01/Snare1.wav","/public/data/samples/packs/st-01/Snare2.wav","/public/data/samples/packs/st-01/Snare3.wav","/public/data/samples/packs/st-01/Snare4.wav","/public/data/samples/packs/st-01/Snare5.wav","/public/data/samples/packs/st-01/SoftBass.wav","/public/data/samples/packs/st-01/Soundtrack.wav","/public/data/samples/packs/st-01/Squares.wav","/public/data/samples/packs/st-01/Stabs.wav","/public/data/samples/packs/st-01/Steinway.wav","/public/data/samples/packs/st-01/Strange.wav","/public/data/samples/packs/st-01/Strings1.wav","/public/data/samples/packs/st-01/Strings2.wav","/public/data/samples/packs/st-01/Strings3.wav","/public/data/samples/packs/st-01/Strings4.wav","/public/data/samples/packs/st-01/Strings5.wav","/public/data/samples/packs/st-01/Strings7.wav","/public/data/samples/packs/st-01/Strings8.wav","/public/data/samples/packs/st-01/Sweep.wav","/public/data/samples/packs/st-01/SynBrass.wav","/public/data/samples/packs/st-01/SynClaves.wav","/public/data/samples/packs/st-01/SynthPiano.wav","/public/data/samples/packs/st-01/SyntheBass.wav","/public/data/samples/packs/st-01/TechBass.wav","/public/data/samples/packs/st-01/TheEgg.wav","/public/data/samples/packs/st-01/TineWave.wav","/public/data/samples/packs/st-01/Touch.wav","/public/data/samples/packs/st-01/TuneBass.wav","/public/data/samples/packs/st-01/Voices.wav","/public/data/samples/packs/st-01/WabberString.wav","/public/data/samples/packs/st-01/WoodBlock.wav","/public/data/samples/packs/st-01/WowBass.wav","/public/data/samples/packs/st-01/strings6.wav","/public/data/samples/packs/st-02/AccGit.wav","/public/data/samples/packs/st-02/AcoPiano.wav","/public/data/samples/packs/st-02/AhhVox.wav","/public/data/samples/packs/st-02/Alcom.wav","/public/data/samples/packs/st-02/Aloog.wav","/public/data/samples/packs/st-02/Balance.wav","/public/data/samples/packs/st-02/BassDrum5.wav","/public/data/samples/packs/st-02/Blower.wav","/public/data/samples/packs/st-02/Bouncy.wav","/public/data/samples/packs/st-02/Bratz.wav","/public/data/samples/packs/st-02/Brian.wav","/public/data/samples/packs/st-02/Bright.wav","/public/data/samples/packs/st-02/Bubble.wav","/public/data/samples/packs/st-02/China.wav","/public/data/samples/packs/st-02/Cliop.wav","/public/data/samples/packs/st-02/CordPiano.wav","/public/data/samples/packs/st-02/Cowbell2.wav","/public/data/samples/packs/st-02/Cymbal1.wav","/public/data/samples/packs/st-02/Cymbal2.wav","/public/data/samples/packs/st-02/DigiPop.wav","/public/data/samples/packs/st-02/DumpfBass.wav","/public/data/samples/packs/st-02/ElecGuitar.wav","/public/data/samples/packs/st-02/EloPin.wav","/public/data/samples/packs/st-02/Friday.wav","/public/data/samples/packs/st-02/GlassMute.wav","/public/data/samples/packs/st-02/Glockenspiel.wav","/public/data/samples/packs/st-02/Growl.wav","/public/data/samples/packs/st-02/HammerBass.wav","/public/data/samples/packs/st-02/Hapsi.wav","/public/data/samples/packs/st-02/HiHat3.wav","/public/data/samples/packs/st-02/HiHat4.wav","/public/data/samples/packs/st-02/HighVibes.wav","/public/data/samples/packs/st-02/HitBass.wav","/public/data/samples/packs/st-02/HitMe1.wav","/public/data/samples/packs/st-02/HitMe2.wav","/public/data/samples/packs/st-02/HosBass.wav","/public/data/samples/packs/st-02/IceRain.wav","/public/data/samples/packs/st-02/JamJam.wav","/public/data/samples/packs/st-02/Licks2.wav","/public/data/samples/packs/st-02/LongSlap.wav","/public/data/samples/packs/st-02/MilBass.wav","/public/data/samples/packs/st-02/MiniMoog.wav","/public/data/samples/packs/st-02/Monkey.wav","/public/data/samples/packs/st-02/Paper.wav","/public/data/samples/packs/st-02/Peck.wav","/public/data/samples/packs/st-02/Perc-Agogo.wav","/public/data/samples/packs/st-02/Perc-Bongo.wav","/public/data/samples/packs/st-02/Perc-HandDrum.wav","/public/data/samples/packs/st-02/Perc-Taiko.wav","/public/data/samples/packs/st-02/Perc-Timbale.wav","/public/data/samples/packs/st-02/Perc-Timpani.wav","/public/data/samples/packs/st-02/PinVoice.wav","/public/data/samples/packs/st-02/PitchBrass.wav","/public/data/samples/packs/st-02/Pizza2.wav","/public/data/samples/packs/st-02/Poison.wav","/public/data/samples/packs/st-02/RealKoto1.wav","/public/data/samples/packs/st-02/RealKoto2.wav","/public/data/samples/packs/st-02/Reflex.wav","/public/data/samples/packs/st-02/Reverb2.wav","/public/data/samples/packs/st-02/Ringtone.wav","/public/data/samples/packs/st-02/SawJump.wav","/public/data/samples/packs/st-02/Sequencer.wav","/public/data/samples/packs/st-02/Sinbad.wav","/public/data/samples/packs/st-02/SingerBell.wav","/public/data/samples/packs/st-02/Siren.wav","/public/data/samples/packs/st-02/SmartBrass.wav","/public/data/samples/packs/st-02/Snare6.wav","/public/data/samples/packs/st-02/Snare7.wav","/public/data/samples/packs/st-02/Snare8.wav","/public/data/samples/packs/st-02/Snare9.wav","/public/data/samples/packs/st-02/SoloBass.wav","/public/data/samples/packs/st-02/SpeOwl.wav","/public/data/samples/packs/st-02/Spoils.wav","/public/data/samples/packs/st-02/SqBrass.wav","/public/data/samples/packs/st-02/Squint.wav","/public/data/samples/packs/st-02/Starpeace.wav","/public/data/samples/packs/st-02/Stars.wav","/public/data/samples/packs/st-02/SynBuz.wav","/public/data/samples/packs/st-02/SynPia.wav","/public/data/samples/packs/st-02/Take.wav","/public/data/samples/packs/st-02/Tallic.wav","/public/data/samples/packs/st-02/TeaPiano.wav","/public/data/samples/packs/st-02/Telephone.wav","/public/data/samples/packs/st-02/Trio.wav","/public/data/samples/packs/st-02/Tubes.wav","/public/data/samples/packs/st-02/WarmBells.wav","/public/data/samples/packs/st-02/Warmth.wav","/public/data/samples/packs/st-02/YaskMe.wav","/public/data/samples/packs/st-02/accordion.wav","/public/data/samples/packs/st-02/aeh.wav","/public/data/samples/packs/st-02/baba.wav","/public/data/samples/packs/st-02/bassdrum8.wav","/public/data/samples/packs/st-02/break.wav","/public/data/samples/packs/st-02/fatbrass.wav","/public/data/samples/packs/st-02/guitar1.wav","/public/data/samples/packs/st-02/ha.wav","/public/data/samples/packs/st-02/he.wav","/public/data/samples/packs/st-02/importdev.wav","/public/data/samples/packs/st-02/k.wav","/public/data/samples/packs/st-02/kermie1.wav","/public/data/samples/packs/st-02/kermie2.wav","/public/data/samples/packs/st-02/kermie3.wav","/public/data/samples/packs/st-02/kermie4.wav","/public/data/samples/packs/st-02/kermie5.wav","/public/data/samples/packs/st-02/kermie6.wav","/public/data/samples/packs/st-02/kermie7.wav","/public/data/samples/packs/st-02/linnkick.wav","/public/data/samples/packs/st-02/master.wav","/public/data/samples/packs/st-02/o.wav","/public/data/samples/packs/st-02/ok.wav","/public/data/samples/packs/st-02/perc-drytom.wav","/public/data/samples/packs/st-02/ridecymbal.wav","/public/data/samples/packs/st-02/s.wav","/public/data/samples/packs/st-02/servant.wav","/public/data/samples/packs/st-02/slapbass2.wav","/public/data/samples/packs/st-02/snare10.wav","/public/data/samples/packs/st-02/snx.drum2.wav","/public/data/samples/packs/st-02/snx.drum3.wav","/public/data/samples/packs/st-02/stoehn.wav","/public/data/samples/packs/st-02/stringsc.wav","/public/data/samples/packs/st-02/swoop.wav","/public/data/samples/tr505/tr505-clap.wav","/public/data/samples/tr505/tr505-conga-h.wav","/public/data/samples/tr505/tr505-conga-l.wav","/public/data/samples/tr505/tr505-cowb-h.wav","/public/data/samples/tr505/tr505-cowb-l.wav","/public/data/samples/tr505/tr505-crash.wav","/public/data/samples/tr505/tr505-hihat-closed.wav","/public/data/samples/tr505/tr505-hihat-open.wav","/public/data/samples/tr505/tr505-kick.wav","/public/data/samples/tr505/tr505-ride.wav","/public/data/samples/tr505/tr505-rim.wav","/public/data/samples/tr505/tr505-snare.wav","/public/data/samples/tr505/tr505-timbal.wav","/public/data/samples/tr505/tr505-tom-h.wav","/public/data/samples/tr505/tr505-tom-l.wav","/public/data/samples/tr505/tr505-tom-m.wav","/public/data/samples/tr707/tr707-clap.wav","/public/data/samples/tr707/tr707-cowbell.wav","/public/data/samples/tr707/tr707-crash.wav","/public/data/samples/tr707/tr707-hihat-closed.wav","/public/data/samples/tr707/tr707-hihat-open.wav","/public/data/samples/tr707/tr707-kick-rumble.wav","/public/data/samples/tr707/tr707-kick.wav","/public/data/samples/tr707/tr707-ride.wav","/public/data/samples/tr707/tr707-rim.wav","/public/data/samples/tr707/tr707-snare.wav","/public/data/samples/tr707/tr707-tambourine.wav","/public/data/samples/tr707/tr707-tom-h.wav","/public/data/samples/tr707/tr707-tom-l-rumble.wav","/public/data/samples/tr707/tr707-tom-l.wav","/public/data/samples/tr707/tr707-tom-m.wav","/public/data/songs/behringer_td-3_patterns/Acid Pattern 1.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 10.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 2.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 3.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 4.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 5.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 6.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 7.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 8.seq","/public/data/songs/behringer_td-3_patterns/Acid Pattern 9.seq","/public/data/songs/behringer_td-3_patterns/Aphex Twin - Orphans.seq","/public/data/songs/behringer_td-3_patterns/Armando - Downfall.seq","/public/data/songs/behringer_td-3_patterns/Charanjit Singh - Teen Ragas to a Disco Beat.seq","/public/data/songs/behringer_td-3_patterns/DJ Misjah & DJ Timm - Acces.seq","/public/data/songs/behringer_td-3_patterns/DJ Misjah - Keep Your Love.seq","/public/data/songs/behringer_td-3_patterns/Daft Punk - Da Funk.seq","/public/data/songs/behringer_td-3_patterns/Donna Summer - I Fel Love.seq","/public/data/songs/behringer_td-3_patterns/Emanuel Top - Rubicon.seq","/public/data/songs/behringer_td-3_patterns/Emmanuel Top - Turkish Bazar.seq","/public/data/songs/behringer_td-3_patterns/Eurythmics - Sweet Dreams 1.seq","/public/data/songs/behringer_td-3_patterns/Eurythmics - Sweet Dreams 2.seq","/public/data/songs/behringer_td-3_patterns/Fatboy Slim - Everybody Needs A 303.seq","/public/data/songs/behringer_td-3_patterns/Hardfloor - Acperience.seq","/public/data/songs/behringer_td-3_patterns/Josh Wink - Higher State Of Consciousness.seq","/public/data/songs/behringer_td-3_patterns/Kai Trancid - Destructions.seq","/public/data/songs/behringer_td-3_patterns/Lochi - London Acid City.seq","/public/data/songs/behringer_td-3_patterns/Pepe Deluxe - Big Mufff.seq","/public/data/songs/behringer_td-3_patterns/Phuture - Acid Traxx.seq","/public/data/songs/behringer_td-3_patterns/Pink Floyd - 0n the Run.seq","/public/data/songs/behringer_td-3_patterns/Planetary Assault System - In From The Night.seq","/public/data/songs/behringer_td-3_patterns/Publlic Energy - Three O Three.seq","/public/data/songs/behringer_td-3_patterns/Regal - Still Raving.seq","/public/data/songs/behringer_td-3_patterns/Rob Threezy - Chicago On Acid.seq","/public/data/songs/behringer_td-3_patterns/Seven Nation Acid (Part 1).seq","/public/data/songs/behringer_td-3_patterns/Seven Nation Acid (Part 2).seq","/public/data/songs/behringer_td-3_patterns/Seven Nation Acid (Part 3).seq","/public/data/songs/behringer_td-3_patterns/Seven Nation Acid (Part 4).seq","/public/data/songs/behringer_td-3_patterns/Seven Nation Acid (Part 5).seq","/public/data/songs/behringer_td-3_patterns/Seven Nation Acid (Part 6).seq","/public/data/songs/behringer_td-3_patterns/Seven Nation Acid (Part 7).seq","/public/data/songs/behringer_td-3_patterns/Stamatis Stabos - Acid Trinity.seq","/public/data/songs/behringer_td-3_patterns/Tame Impala - Breathe Deeper.seq","/public/data/songs/behringer_td-3_patterns/The KLF - What Time is Love.seq","/public/data/songs/behringer_td-3_patterns/The Prodigy - Claustrophobic String.seq","/public/data/songs/behringer_td-3_patterns/The Prodigy - Weather Experience.seq","/public/data/songs/behringer_td-3_patterns/The Pump Panel - Confusion (Blade).seq","/public/data/songs/behringer_td-3_patterns/The Subjects Vs. Jeff Mills - Beyond (1993).seq","/public/data/songs/behringer_td-3_patterns/Underground Ressistance - The Seawolf.seq","/public/data/songs/behringer_td-3_patterns/Union Jack - Two Full Moons and a Trout.seq","/public/data/songs/behringer_td-3_patterns/Woody McBride - The Birdman.seq","/public/data/songs/furnace/a2600/Balmeranda.fur","/public/data/songs/furnace/a2600/Funky_Afternoon.fur","/public/data/songs/furnace/a2600/Slam_the_Door.fur","/public/data/songs/furnace/a2600/Watch My Tone.fur","/public/data/songs/furnace/a2600/morepain.fur","/public/data/songs/furnace/a2600/twin.fur","/public/data/songs/furnace/amiga/Ibiza.fur","/public/data/songs/furnace/amiga/a_wave_powerhouse.fur","/public/data/songs/furnace/amiga/bruno_time.fur","/public/data/songs/furnace/amiga/m7 vibe.fur","/public/data/songs/furnace/amiga/serendipid.fur","/public/data/songs/furnace/arcade/Changsha_DnB_Inferno_NamcoNA1.fur","/public/data/songs/furnace/arcade/Crystal Dimension Section 2 WSG Mix.fur","/public/data/songs/furnace/arcade/Destiny_Islands_Irem_M92.fur","/public/data/songs/furnace/arcade/Eternal_Forest_TaitoArcade.fur","/public/data/songs/furnace/arcade/Grape_Jelly_Alpha5232.fur","/public/data/songs/furnace/arcade/Hexionology.fur","/public/data/songs/furnace/arcade/Ice_Wind_SegaPCM.fur","/public/data/songs/furnace/arcade/JoyfulStart_Seta.fur","/public/data/songs/furnace/arcade/Mars_Bar_On_Mars_NamcoWSG.fur","/public/data/songs/furnace/arcade/Maximum_Overdrive_NamcoWSG.fur","/public/data/songs/furnace/arcade/Phoenix_cover_NamcoWSG.fur","/public/data/songs/furnace/arcade/Physics_Exam_TaitoArcade.fur","/public/data/songs/furnace/arcade/Point_of_No_Return_SegaPCM.fur","/public/data/songs/furnace/arcade/QSound_smile.fur","/public/data/songs/furnace/arcade/REPROGRAMMED.fur","/public/data/songs/furnace/arcade/SHIN_YA.fur","/public/data/songs/furnace/arcade/Salamander_Starfield.fur","/public/data/songs/furnace/arcade/Slow Brew.fur","/public/data/songs/furnace/arcade/Some_Creatures_SegaPCM.fur","/public/data/songs/furnace/arcade/The_Good_Times_SegaPCM.fur","/public/data/songs/furnace/arcade/ToHeart_QoH98_TPower_Asuka120Style.fur","/public/data/songs/furnace/arcade/Tubelectric_Fictional_Arcade.fur","/public/data/songs/furnace/arcade/U.N. Owen Was Her (NS2).fur","/public/data/songs/furnace/arcade/UT99_Run_TaitoArcade.fur","/public/data/songs/furnace/arcade/WSG_Loop_Tune_NamcoWSG.fur","/public/data/songs/furnace/arcade/eek_qsound.fur","/public/data/songs/furnace/arcade/ice_cap_NamcoC30.fur","/public/data/songs/furnace/arcade/last_day_of_summer_NamcoC15.fur","/public/data/songs/furnace/arcade/living crystal cave.fur","/public/data/songs/furnace/arcade/the_machines_are_socialising_SegaPCM.fur","/public/data/songs/furnace/arcade/trance_TaitoArcade.fur","/public/data/songs/furnace/ay8910/AY-3-8910_Jam.fur","/public/data/songs/furnace/ay8910/AyMate.fur","/public/data/songs/furnace/ay8910/Drifting in Colour.fur","/public/data/songs/furnace/ay8910/Flat Wave Society.fur","/public/data/songs/furnace/ay8910/Second_Addition.fur","/public/data/songs/furnace/ay8910/cardboardmywater.fur","/public/data/songs/furnace/ay8910/demoscenetypebeat.fur","/public/data/songs/furnace/ay8910/remark_music.fur","/public/data/songs/furnace/ay8910/vibe_zone.fur","/public/data/songs/furnace/ay8930/AY8930Shuffle.fur","/public/data/songs/furnace/ay8930/Obscure_Temptation.fur","/public/data/songs/furnace/ay8930/One_Minute_Waltz.fur","/public/data/songs/furnace/ay8930/Playing_On_The_Stairs.fur","/public/data/songs/furnace/ay8930/Red_Planet.fur","/public/data/songs/furnace/ay8930/duty fun.fur","/public/data/songs/furnace/ay8930/joyful.fur","/public/data/songs/furnace/ay8930/powerful-sample-generator.fur","/public/data/songs/furnace/blank/5 AM Sunrise.fur","/public/data/songs/furnace/blank/Electric Blanket.fur","/public/data/songs/furnace/blank/Electrical Inteference.fur","/public/data/songs/furnace/blank/Empty Aquatic.fur","/public/data/songs/furnace/blank/Exquisite Invitation.fur","/public/data/songs/furnace/blank/For the 19 bonus points NES DPCM only.fur","/public/data/songs/furnace/blank/Planet Zero-Algorima.fur","/public/data/songs/furnace/blank/SURVIVE.fur","/public/data/songs/furnace/blank/Super_Instrumentless_Echo_Synth_Demonstration.fur","/public/data/songs/furnace/blank/The Emptyness.fur","/public/data/songs/furnace/blank/WHERE DID I PUT IT.fur","/public/data/songs/furnace/blank/Wandering.fur","/public/data/songs/furnace/blank/emotional_blackmail.fur","/public/data/songs/furnace/blank/enterthering.fur","/public/data/songs/furnace/blank/hope_in_a_time_of_monsters.fur","/public/data/songs/furnace/blank/map01.fur","/public/data/songs/furnace/blank/samba_do_SID.fur","/public/data/songs/furnace/blank/sawvibes.fur","/public/data/songs/furnace/blank/they dont know im empty inside.fur","/public/data/songs/furnace/blank/waytoohard.fur","/public/data/songs/furnace/c64/C64 junk.fur","/public/data/songs/furnace/c64/ChaosTune.fur","/public/data/songs/furnace/c64/FairlightC64.fur","/public/data/songs/furnace/c64/Hellcharger.fur","/public/data/songs/furnace/c64/LowBeatz.fur","/public/data/songs/furnace/c64/PICOHOTCREDITS.fur","/public/data/songs/furnace/c64/deadlock.fur","/public/data/songs/furnace/c64/yeah!.fur","/public/data/songs/furnace/esfm/AAAA.fur","/public/data/songs/furnace/esfm/ALCATRAZ_ALWAYS.fur","/public/data/songs/furnace/esfm/CampingJourney.fur","/public/data/songs/furnace/esfm/Deadline.fur","/public/data/songs/furnace/esfm/Devil_Detective.fur","/public/data/songs/furnace/esfm/EdgeRunning_2078.fur","/public/data/songs/furnace/esfm/Fighting_the_Dimensions_Big_Bad_Because_its_Fun.fur","/public/data/songs/furnace/esfm/I_Cant_Escape_Your_Memory.fur","/public/data/songs/furnace/esfm/Just_me_and_my_Brain.fur","/public/data/songs/furnace/esfm/Ken_Stage.fur","/public/data/songs/furnace/esfm/Magician_Lake_Cover.fur","/public/data/songs/furnace/esfm/Napalm-Loader.fur","/public/data/songs/furnace/esfm/Perilous059.fur","/public/data/songs/furnace/esfm/Poets_I.fur","/public/data/songs/furnace/esfm/Redial.fur","/public/data/songs/furnace/esfm/SearchPrincess.fur","/public/data/songs/furnace/esfm/Second_Start.fur","/public/data/songs/furnace/esfm/Strange_Sunset.fur","/public/data/songs/furnace/esfm/Tangent_to_a_Segue.fur","/public/data/songs/furnace/esfm/TheOneWayFuture.fur","/public/data/songs/furnace/esfm/Unconscious_Unravelling.fur","/public/data/songs/furnace/esfm/Unknown_Location.fur","/public/data/songs/furnace/esfm/WalkInThePark.fur","/public/data/songs/furnace/esfm/WindFjordsESFM.fur","/public/data/songs/furnace/esfm/act_of_fighter.fur","/public/data/songs/furnace/esfm/cielos_esfumados.fur","/public/data/songs/furnace/esfm/experiment.fur","/public/data/songs/furnace/esfm/flashback.fur","/public/data/songs/furnace/esfm/frosty_dusk.fur","/public/data/songs/furnace/esfm/haunted_castle.fur","/public/data/songs/furnace/esfm/her_wishes.fur","/public/data/songs/furnace/esfm/ledstorm.fur","/public/data/songs/furnace/esfm/loneguitarist.fur","/public/data/songs/furnace/esfm/moon_closedspace.fur","/public/data/songs/furnace/esfm/pcbend.fur","/public/data/songs/furnace/esfm/sticker1.fur","/public/data/songs/furnace/esfm/synthy.fur","/public/data/songs/furnace/esfm/wack.fur","/public/data/songs/furnace/esfm/x_evil_soul.fur","/public/data/songs/furnace/gameboy/GB_WaitForMe.fur","/public/data/songs/furnace/gameboy/On_Hold.fur","/public/data/songs/furnace/gameboy/Pleasure_of_Tension.fur","/public/data/songs/furnace/gameboy/You\'re_Doing_Well!.fur","/public/data/songs/furnace/gameboy/cheap.fur","/public/data/songs/furnace/gameboy/contested.fur","/public/data/songs/furnace/gameboy/dancing_to_the_death.fur","/public/data/songs/furnace/gameboy/finger.fur","/public/data/songs/furnace/gameboy/lagtrain.fur","/public/data/songs/furnace/gameboy/minos.fur","/public/data/songs/furnace/gameboy/puggs_in_space.fur","/public/data/songs/furnace/gameboy/snowdin.fur","/public/data/songs/furnace/gameboy/spreadtro.fur","/public/data/songs/furnace/genesis/All Good Times.fur","/public/data/songs/furnace/genesis/ChocolateFactory.fur","/public/data/songs/furnace/genesis/Electric Keet - Imperfectionist.fur","/public/data/songs/furnace/genesis/Equinox Intro.fur","/public/data/songs/furnace/genesis/Fancy_Promenard.fur","/public/data/songs/furnace/genesis/Kobito_of_the_Shining_Needle.fur","/public/data/songs/furnace/genesis/MegadriveOverdrive.fur","/public/data/songs/furnace/genesis/Plok_Beach.fur","/public/data/songs/furnace/genesis/Puyopuyo~n_DopplegangerArle-TsuuStyle.fur","/public/data/songs/furnace/genesis/RaveOfDoom.fur","/public/data/songs/furnace/genesis/RubyIllusions_Genesis.fur","/public/data/songs/furnace/genesis/Shovel_Knight_Title.fur","/public/data/songs/furnace/genesis/Solar_Man.fur","/public/data/songs/furnace/genesis/SpareHalloween2.fur","/public/data/songs/furnace/genesis/Stereotactics_Rewritten.fur","/public/data/songs/furnace/genesis/darkstar.fur","/public/data/songs/furnace/genesis/djtBMX_zweitrigger_bluesky_badfmmix.fur","/public/data/songs/furnace/genesis/eternallydoomedtogroove.fur","/public/data/songs/furnace/genesis/flatulence mountain\'s fm orchestra.fur","/public/data/songs/furnace/genesis/golden_shit.fur","/public/data/songs/furnace/genesis/highscorefollin.fur","/public/data/songs/furnace/genesis/imaginarium.fur","/public/data/songs/furnace/genesis/mm5_boss.fur","/public/data/songs/furnace/genesis/newer_song_lol.fur","/public/data/songs/furnace/genesis/notime.fur","/public/data/songs/furnace/genesis/shiningcrystal_cave.fur","/public/data/songs/furnace/genesis/the_serenity_of_lonliness.fur","/public/data/songs/furnace/genesis/waterfall.fur","/public/data/songs/furnace/genesis/wwfrtw_credits_arrange.fur","/public/data/songs/furnace/lynx/LedStorm.fur","/public/data/songs/furnace/lynx/Road_Rash_Grass_Valley.fur","/public/data/songs/furnace/lynx/Tyrian-Camanis.fur","/public/data/songs/furnace/lynx/chippylotus.fur","/public/data/songs/furnace/lynx/insert_title_here.fur","/public/data/songs/furnace/misc/Back_In_Detroit_Supervision.fur","/public/data/songs/furnace/misc/CORRUPT.FUR","/public/data/songs/furnace/misc/Dreamliner_FMTowns.fur","/public/data/songs/furnace/misc/FiveTwoThreeTwo_MSM5232.fur","/public/data/songs/furnace/misc/Fly_to_the_Sky_Sharp_X1.fur","/public/data/songs/furnace/misc/Galactic_Melody_PowerNoise.fur","/public/data/songs/furnace/misc/GreenIdeas_PET.fur","/public/data/songs/furnace/misc/Inner Machinations YM2610B.fur","/public/data/songs/furnace/misc/IntoTheLight_CapcomQSound.fur","/public/data/songs/furnace/misc/Miami_Ice_Sharp_X1.fur","/public/data/songs/furnace/misc/Playground_2xT6W28.fur","/public/data/songs/furnace/misc/Someting_I_can_feel_MSM5232.fur","/public/data/songs/furnace/misc/Special Stage Sonic 3 (GBA).fur","/public/data/songs/furnace/misc/SplittersGroove_bifurcator.fur","/public/data/songs/furnace/misc/StrobesPowerNoise.fur","/public/data/songs/furnace/misc/T_Six_T6W28.fur","/public/data/songs/furnace/misc/TerminalZone_SM8521.fur","/public/data/songs/furnace/misc/Weightlessness_ES5506.fur","/public/data/songs/furnace/misc/Yellow_Desert_bifurcator.fur","/public/data/songs/furnace/misc/ZX Extinction Sequence.fur","/public/data/songs/furnace/misc/ZetaForceLevel2.fur","/public/data/songs/furnace/misc/beeper_torture.fur","/public/data/songs/furnace/misc/biffy_bifurcator.fur","/public/data/songs/furnace/misc/combat_vehicle_pokey.fur","/public/data/songs/furnace/misc/cutbluetape_PV1000.fur","/public/data/songs/furnace/misc/david.fur","/public/data/songs/furnace/misc/deepmist_dave.fur","/public/data/songs/furnace/misc/feeding_my_pet_peeve_PV1000.fur","/public/data/songs/furnace/misc/firetrucking_PV1000.fur","/public/data/songs/furnace/misc/fragments_turbosound.fur","/public/data/songs/furnace/misc/fursuits_for_the_suspiciously_rich_MSM5232.fur","/public/data/songs/furnace/misc/hittingtherevlimiter_RF5C68.fur","/public/data/songs/furnace/misc/horizon_beyond_gba.fur","/public/data/songs/furnace/misc/mainframe_pokemini.fur","/public/data/songs/furnace/misc/meaningful_connection_es5506.fur","/public/data/songs/furnace/misc/midnight_freeze_bifurcator.fur","/public/data/songs/furnace/misc/mushroomhill_SM8521.fur","/public/data/songs/furnace/misc/nails_PV1000.fur","/public/data/songs/furnace/misc/navi_clash_GBA.fur","/public/data/songs/furnace/misc/pseudogba_pwaa_godot.fur","/public/data/songs/furnace/misc/sawmen_break_SM8521.fur","/public/data/songs/furnace/misc/space_mackerel_bifurcator.fur","/public/data/songs/furnace/misc/sparkling_aria_pokemini.fur","/public/data/songs/furnace/misc/spite_is_the_best_motivator_PV1000.fur","/public/data/songs/furnace/misc/sucked_something_zx.fur","/public/data/songs/furnace/misc/tech_low_qual_era_RF5C68.fur","/public/data/songs/furnace/misc/teddy_bear_midnight_jam_ted.fur","/public/data/songs/furnace/misc/teknofurcator.fur","/public/data/songs/furnace/misc/this_is_kind_of_better_PV1000.fur","/public/data/songs/furnace/misc/walkontheroof_T6W28.fur","/public/data/songs/furnace/msx/2024 BOTB MSX-MUSIC GRINDCORE LIVE ON STAGE (MSX-MUSIC).fur","/public/data/songs/furnace/msx/21492413.fur","/public/data/songs/furnace/msx/BREEZE_SENSATION.fur","/public/data/songs/furnace/msx/Gyruss_Stage_2.fur","/public/data/songs/furnace/msx/Juice_Stand.fur","/public/data/songs/furnace/msx/Morning_Alarm.fur","/public/data/songs/furnace/msx/Nemesis2AirBattle.fur","/public/data/songs/furnace/msx/OPLL_High_and_Rising.fur","/public/data/songs/furnace/msx/OPLL_OperationPleaseLeaveLeave.fur","/public/data/songs/furnace/msx/Port Sun.fur","/public/data/songs/furnace/msx/Princess_of_the_Dead.fur","/public/data/songs/furnace/msx/Striking_Towards_Opposition.fur","/public/data/songs/furnace/multichip/1_bit_bros.fur","/public/data/songs/furnace/multichip/Between_the_Circuits.fur","/public/data/songs/furnace/multichip/CR_yasui_cs.fur","/public/data/songs/furnace/multichip/Chip_Duel_AY-3-8910+SN76489.fur","/public/data/songs/furnace/multichip/Cossack Stage Boss.fur","/public/data/songs/furnace/multichip/Entry_2xSID3+ES5506.fur","/public/data/songs/furnace/multichip/FamiMega Aliance.fur","/public/data/songs/furnace/multichip/Fantasy_Chip_Christmas.fur","/public/data/songs/furnace/multichip/Fight Against the Dark Matter.fur","/public/data/songs/furnace/multichip/Furnace-tan VS the spirit of the Mask.fur","/public/data/songs/furnace/multichip/Fusion.fur","/public/data/songs/furnace/multichip/HoldOn.fur","/public/data/songs/furnace/multichip/Jet_Pack_Adventure_GBAesque.fur","/public/data/songs/furnace/multichip/MegaMari-Cirno.fur","/public/data/songs/furnace/multichip/Melancholy_Girl_multichip.fur","/public/data/songs/furnace/multichip/MetalSlug_BaseCamp_SMS_TIA.fur","/public/data/songs/furnace/multichip/Namco_C30_C219_Loop.fur","/public/data/songs/furnace/multichip/OPL3_SegaPCM_Xeno_Crisis_-_Facility_Area_2.fur","/public/data/songs/furnace/multichip/PinBot-C30C140.fur","/public/data/songs/furnace/multichip/Sunset Hill Zone Act 2.fur","/public/data/songs/furnace/multichip/TheOnlyWayIsForward.fur","/public/data/songs/furnace/multichip/WakeUpAndDance_MMC5_SM8521.fur","/public/data/songs/furnace/multichip/all_old_zero_new.fur","/public/data/songs/furnace/multichip/collab.fur","/public/data/songs/furnace/multichip/cueball.fur","/public/data/songs/furnace/multichip/double-dragon-stage1.fur","/public/data/songs/furnace/multichip/government funding breakcore-ish remix.fur","/public/data/songs/furnace/multichip/invicibility_mmc5_n163_fds.fur","/public/data/songs/furnace/multichip/meteor_shower.fur","/public/data/songs/furnace/multichip/one.fur","/public/data/songs/furnace/multichip/pont of noreturn.fur","/public/data/songs/furnace/multichip/ridiculous_game.fur","/public/data/songs/furnace/multichip/satellite_interconnects.fur","/public/data/songs/furnace/multichip/second_dimension_demo.fur","/public/data/songs/furnace/multichip/silverlining.fur","/public/data/songs/furnace/multichip/skate_or_die.fur","/public/data/songs/furnace/multichip/splashingwater.fur","/public/data/songs/furnace/multichip/steak.fur","/public/data/songs/furnace/multichip/sunlight.fur","/public/data/songs/furnace/multichip/super_fantasy_zone_mango.fur","/public/data/songs/furnace/multichip/the tempest\'s melody.fur","/public/data/songs/furnace/multichip/track8_n163_k053260.fur","/public/data/songs/furnace/multichip/urgency.fur","/public/data/songs/furnace/nes/Byte-Sized Bop.fur","/public/data/songs/furnace/nes/Famitune1.fur","/public/data/songs/furnace/nes/Fur_Nes.fur","/public/data/songs/furnace/nes/Future_Re-ference.fur","/public/data/songs/furnace/nes/Rise_against_the_ashes_to_the_new_dawn.fur","/public/data/songs/furnace/nes/Sky Sanctuary Zone.fur","/public/data/songs/furnace/nes/Super cool and awesome samurai.fur","/public/data/songs/furnace/nes/Super_Space_Invaders_Title.fur","/public/data/songs/furnace/nes/The Cheetahmen.fur","/public/data/songs/furnace/nes/The East.fur","/public/data/songs/furnace/nes/blanketcritter release ver.fur","/public/data/songs/furnace/nes/carve_your_own_path.fur","/public/data/songs/furnace/nes/christmas-fever.fur","/public/data/songs/furnace/nes/going_up_a_step_at_time.fur","/public/data/songs/furnace/nes/infinity.fur","/public/data/songs/furnace/nes/oby1_ingame.fur","/public/data/songs/furnace/nes/one_sided_love.fur","/public/data/songs/furnace/nes/smashtv.fur","/public/data/songs/furnace/nes/sweatsmile_bossfight.fur","/public/data/songs/furnace/nes/the_best-1990.fur","/public/data/songs/furnace/nes/turtle_byte.fur","/public/data/songs/furnace/opl/Air_Combat_Over_the_Vast_Mountain.fur","/public/data/songs/furnace/opl/Contraduct Design OPL3 Cover.fur","/public/data/songs/furnace/opl/Egyptian_Rule.fur","/public/data/songs/furnace/opl/Memories_of_Triumph.fur","/public/data/songs/furnace/opl/Midnight_Dog_Orchestra.fur","/public/data/songs/furnace/opl/Moon.fur","/public/data/songs/furnace/opl/Oh no, more sine waves.fur","/public/data/songs/furnace/opl/One_Sided_Love_Again.fur","/public/data/songs/furnace/opl/Perpetual_Motion.fur","/public/data/songs/furnace/opl/PhantomBreakerBattleGrounds_ShinjukuStage-OPL3.fur","/public/data/songs/furnace/opl/Sliding_on_a_Rainbow.fur","/public/data/songs/furnace/opl/TeamInnocent-BGM4-OPL3Plus.fur","/public/data/songs/furnace/opl/Time_Is_Lost_OPL4.fur","/public/data/songs/furnace/opl/Waterworld_-_Map.fur","/public/data/songs/furnace/opl/femteknyl.fur","/public/data/songs/furnace/opl/fight and flight.fur","/public/data/songs/furnace/opl/green_biker_dude_opl.fur","/public/data/songs/furnace/opl/home_wfl_opl3.fur","/public/data/songs/furnace/opl/rain.cloud.sunset.fur","/public/data/songs/furnace/opl/the_foggy_cave_in_the_darkness.fur","/public/data/songs/furnace/opm/hope_for_the_dream.fur","/public/data/songs/furnace/opm/lagrange_point_2023.fur","/public/data/songs/furnace/opm/the_king_of_crisp.fur","/public/data/songs/furnace/opm/vortex.fur","/public/data/songs/furnace/opm/waterworld_map.fur","/public/data/songs/furnace/opz/\'90 lost media.fur","/public/data/songs/furnace/opz/Clashing Angels.fur","/public/data/songs/furnace/opz/Fly to the Leaden Sky.fur","/public/data/songs/furnace/opz/Glacier BM0.fur","/public/data/songs/furnace/opz/The Hedgehog Knows One Thing.fur","/public/data/songs/furnace/opz/The bongos and teh base OPZx2.fur","/public/data/songs/furnace/opz/boost.fur","/public/data/songs/furnace/opz/goodbye my dreams.fur","/public/data/songs/furnace/opz/massive_x_opz.fur","/public/data/songs/furnace/opz/myst_grove.fur","/public/data/songs/furnace/opz/only_dream_opz.fur","/public/data/songs/furnace/opz/sea of crises.fur","/public/data/songs/furnace/pc98/Blue_Nebula.fur","/public/data/songs/furnace/pc98/CT_maintheme.fur","/public/data/songs/furnace/pc98/Counterattack.fur","/public/data/songs/furnace/pc98/atomic_failure.fur","/public/data/songs/furnace/pce/Contest thing 2025.fur","/public/data/songs/furnace/pce/Fake Gameboy.fur","/public/data/songs/furnace/pce/Final_Fight_Metro_City_Slums.fur","/public/data/songs/furnace/pce/Ma-Da-Ra.fur","/public/data/songs/furnace/pce/Peace.fur","/public/data/songs/furnace/pce/Processing Plant 2025 Edit.fur","/public/data/songs/furnace/pce/Warpdrive_Engage.fur","/public/data/songs/furnace/pce/continuity_error.fur","/public/data/songs/furnace/pce/fd_PCB.fur","/public/data/songs/furnace/pce/pcengineasdmo.fur","/public/data/songs/furnace/quickstart.fur","/public/data/songs/furnace/sn7/456nm_TI994A.fur","/public/data/songs/furnace/sn7/FlowOfSN7.fur","/public/data/songs/furnace/sn7/Last Frecuency System.fur","/public/data/songs/furnace/sn7/Night_Market_TI994A.fur","/public/data/songs/furnace/sn7/Protaras.fur","/public/data/songs/furnace/sn7/Tidal_Tempest_Zone.fur","/public/data/songs/furnace/sn7/Updraft Flight.fur","/public/data/songs/furnace/sn7/doorintosummer.fur","/public/data/songs/furnace/sn7/gg_silver_surfer_st1.fur","/public/data/songs/furnace/sn7/gg_soniccd_collision_chaos.fur","/public/data/songs/furnace/sn7/thunderblade-type-ii.fur","/public/data/songs/furnace/snes/64kb.fur","/public/data/songs/furnace/snes/Breezy.fur","/public/data/songs/furnace/snes/Cosmic_Warehouse.fur","/public/data/songs/furnace/snes/Dear Blue SNES.fur","/public/data/songs/furnace/snes/IMU Caf.fur","/public/data/songs/furnace/snes/MM8_Frost_Man.fur","/public/data/songs/furnace/snes/ManbowSMW.fur","/public/data/songs/furnace/snes/Sadness.fur","/public/data/songs/furnace/snes/Sunken Lights.fur","/public/data/songs/furnace/snes/Unreal_Something_SNES.fur","/public/data/songs/furnace/snes/XCDunes_SNES.fur","/public/data/songs/furnace/snes/XCHQ_SPC700.fur","/public/data/songs/furnace/snes/amalgam.fur","/public/data/songs/furnace/snes/analog.fur","/public/data/songs/furnace/snes/aurora.fur","/public/data/songs/furnace/snes/changeyourheart.fur","/public/data/songs/furnace/snes/encjslt.fur","/public/data/songs/furnace/snes/segacd.fur","/public/data/songs/furnace/snes/sound processing unit.fur","/public/data/songs/furnace/snes/spd10.fur","/public/data/songs/furnace/snes/spd24.fur","/public/data/songs/furnace/snes/tetristheme.fur","/public/data/songs/furnace/snes/time_of_the_dreamwatch.fur","/public/data/songs/furnace/snes/very chill snes.fur","/public/data/songs/furnace/snes/wonders_of_synthia.fur","/public/data/songs/furnace/specs2/Tim_Follin.fur","/public/data/songs/furnace/specs2/acidic_juice_of_hell.fur","/public/data/songs/furnace/specs2/atmosphere.fur","/public/data/songs/furnace/specs2/back_into_adventure.fur","/public/data/songs/furnace/specs2/object.fur","/public/data/songs/furnace/specs2/rastaline_dub.fur","/public/data/songs/furnace/specs2/spa.fur","/public/data/songs/furnace/specs2/thick bass test.fur","/public/data/songs/furnace/vic20/BlueBolt.fur","/public/data/songs/furnace/vic20/h.fur","/public/data/songs/furnace/virtualboy/4_dimensionnal_goddess_of_existance.fur","/public/data/songs/furnace/virtualboy/Cherry_Vertex.fur","/public/data/songs/furnace/virtualboy/Dimensional.fur","/public/data/songs/furnace/virtualboy/Double_Puzzle_Trouble.fur","/public/data/songs/furnace/virtualboy/DoublingDown.fur","/public/data/songs/furnace/virtualboy/God_Rest_Ye_Deadly_Gentlemen.fur","/public/data/songs/furnace/virtualboy/Iridion_3D_Stage_3.fur","/public/data/songs/furnace/virtualboy/LN2StreetLoader-VB.fur","/public/data/songs/furnace/virtualboy/La_Folia_ground_bass.fur","/public/data/songs/furnace/virtualboy/No_Such_Thing.fur","/public/data/songs/furnace/virtualboy/Professional_Beat.fur","/public/data/songs/furnace/virtualboy/Rave_Dancetune.fur","/public/data/songs/furnace/virtualboy/Red_And_Black_Orchid.fur","/public/data/songs/furnace/virtualboy/Red_Revolver.fur","/public/data/songs/furnace/virtualboy/Redworld.fur","/public/data/songs/furnace/virtualboy/Scarlet_Horizons.fur","/public/data/songs/furnace/virtualboy/SeeingRed.fur","/public/data/songs/furnace/virtualboy/StuckTerminologyRealVB.fur","/public/data/songs/furnace/virtualboy/Virtual_Promises.fur","/public/data/songs/furnace/virtualboy/air_fight.fur","/public/data/songs/furnace/virtualboy/blueseed.fur","/public/data/songs/furnace/virtualboy/devil_crash.fur","/public/data/songs/furnace/virtualboy/eek.fur","/public/data/songs/furnace/virtualboy/ghx_melodic.fur","/public/data/songs/furnace/virtualboy/groove_in_the_virtual_realm.fur","/public/data/songs/furnace/virtualboy/honeydippedkiwis.fur","/public/data/songs/furnace/virtualboy/lastninja-sewersloader.fur","/public/data/songs/furnace/virtualboy/mission_breafing.fur","/public/data/songs/furnace/virtualboy/needforspeed2semainmenu.fur","/public/data/songs/furnace/virtualboy/red_joke.fur","/public/data/songs/furnace/virtualboy/redboas.fur","/public/data/songs/furnace/virtualboy/redshift.fur","/public/data/songs/furnace/virtualboy/virtual_namachuukei_pennant_race.fur","/public/data/songs/furnace/wonderswan/Bullet_Hell.fur","/public/data/songs/furnace/wonderswan/Rusty_-_Queen_in_the_Dark_Night.fur","/public/data/songs/furnace/wonderswan/Space Station of Enormous Proportions.fur","/public/data/songs/furnace/wonderswan/TimeTrial.fur","/public/data/songs/furnace/wonderswan/sijofsjfsoeife.fur","/public/data/songs/furnace/wonderswan/thesign_ws.fur","/public/data/songs/furnace/x16/Cafe - 010 Editor 2.0kg.fur","/public/data/songs/furnace/x16/Exerion_II_Tune.fur","/public/data/songs/furnace/x16/Identity_Believer.fur","/public/data/songs/furnace/x16/Shades of Blue.fur","/public/data/songs/furnace/x16/TFV_Rise.fur","/public/data/songs/furnace/x16/dance with me.fur","/public/data/songs/furnace/x16/her11.fur","/public/data/songs/furnace/x16/keygen19.fur","/public/data/songs/furnace/x16/richca.fur","/public/data/songs/furnace/x16/watching_paint_dry.fur","/public/data/songs/furnace/x68000/LN2_Office_Loader.fur","/public/data/songs/furnace/x68000/Optimistic.fur","/public/data/songs/furnace/x68000/TimeMan.fur","/public/data/songs/furnace/x68000/Wicked_Express.fur","/public/data/songs/furnace/x68000/boomer.fur","/public/data/songs/furnace/ymz280b/evilevilsong.fur","/public/data/songs/furnace/ymz280b/notreallyfm.fur","/public/data/songs/midi/303-pattern_3.mid","/public/data/songs/midi/303-pattern_4.mid","/public/data/songs/midi/303_pattern_1.mid","/public/data/songs/midi/303_pattern_2.mid","/public/data/songs/midi/darker_shade_of_black.mid","/public/data/songs/midi/death_in_the_arena.mid","/public/data/songs/midi/drum_song.mid","/public/data/songs/midi/dub_organizer.mid","/public/data/songs/midi/ethiopian_kings.mid","/public/data/songs/midi/every_tongue_shall_tell.mid","/public/data/songs/midi/fade_away.mid","/public/data/songs/midi/fisherman.mid","/public/data/songs/midi/freedom_blues.mid","/public/data/songs/midi/ghetto_people_song.mid","/public/data/songs/midi/grab_your_lass_and_come.mid","/public/data/songs/midi/gunman.mid","/public/data/songs/midi/heathen.mid","/public/data/songs/midi/java.mid","/public/data/songs/midi/johnny_dollar.mid","/public/data/songs/midi/jump_up.mid","/public/data/songs/midi/liberation.mid","/public/data/songs/midi/mathew.mid","/public/data/songs/midi/mr_bassie.mid","/public/data/songs/midi/nanny_goat.mid","/public/data/songs/midi/peanie_peanie.mid","/public/data/songs/midi/queen_majesty.mid","/public/data/songs/midi/real_rock.mid","/public/data/songs/midi/revolution.mid","/public/data/songs/midi/rockfort_rock.mid","/public/data/songs/midi/rougher_yet.mid","/public/data/songs/midi/run_down_the_world.mid","/public/data/songs/midi/satta.mid","/public/data/songs/midi/shank_i_sheck.mid","/public/data/songs/midi/skylarking.mid","/public/data/songs/midi/sleng_teng.mid","/public/data/songs/midi/stalag.mid","/public/data/songs/midi/swing_easy.mid","/public/data/songs/midi/tempo.mid","/public/data/songs/midi/the_whip.mid","/public/data/songs/midi/warning.mid","/public/data/songs/midi/warriors_dont_cry.mid","/public/data/songs/midi/when_i_fall_in_love.mid","/public/data/songs/mod/break the box.mod","/public/data/songs/modules.json"]'),ER="http://localhost:3001/api";function kR(){return Array.isArray(wR)&&wR.length>0}async function DR(e){const t=e.replace(/^\/+/,"");let n="songs",s="";""===t||"songs"===t?(n="songs",s=""):"instruments"===t?(n="instruments",s=""):t.startsWith("instruments/")?(n="instruments",s=t.replace(/^instruments\/?/,"")):t.startsWith("songs/")?(n="songs",s=t.replace(/^songs\/?/,"")):(n="songs",s=t);const a=await fetch(`${ER}/demo/${n}/${s}`);if(!a.ok)throw new Error(`Failed to read file: ${a.statusText}`);return a.arrayBuffer()}async function SR(e){const t=`/data/${e.replace(/^\/+/,"")}`,n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch static file: ${n.status} ${t}`);return n.arrayBuffer()}const MR="http://localhost:3001/api";async function CR(e){const t=new URLSearchParams;e.q&&t.set("q",e.q),e.format&&t.set("format",e.format),e.author&&t.set("author",e.author),e.limit&&t.set("limit",e.limit.toString()),e.offset&&t.set("offset",e.offset.toString());const n=await fetch(`${MR}/modland/search?${t}`);if(!n.ok){const e=await n.json().catch(()=>({error:"Search failed"}));throw new Error(e.error||"Search failed")}return n.json()}async function VR(){const e=await fetch(`${MR}/modland/formats`);if(!e.ok)throw new Error("Failed to get formats");return(await e.json()).formats}async function PR(e){const t=await fetch(`${MR}/modland/download?path=${encodeURIComponent(e)}`);if(!t.ok){if(429===t.status)throw new Error("Rate limited  try again in a moment");const e=await t.json().catch(()=>({error:"Download failed"}));throw new Error(e.error||"Download failed")}return t.arrayBuffer()}async function _R(e){const t=e.lastIndexOf("/"),n=t>=0?e.slice(0,t+1):"",s=t>=0?e.slice(t+1):e;if(!s.toLowerCase().startsWith("mdat."))return null;const a="smpl."+s.slice(5),o=n+a;try{return{filename:a,buffer:await PR(o)}}catch{return null}}async function OR(){const e=await fetch(`${MR}/modland/status`);if(!e.ok)throw new Error("Failed to get status");return e.json()}const TR=Object.freeze(Object.defineProperty({__proto__:null,downloadModlandFile:PR,downloadTFMXCompanion:_R,getModlandFormats:VR,getModlandStatus:OR,searchModland:CR},Symbol.toStringTag,{value:"Module"}));var LR,AR,BR,IR,FR,UR={},RR={};function jR(){if(AR)return LR;function e(e){for(var n,s=new t(e),a=[];!s.eof();){var o=r();a.push(o)}return a;function r(){var e={};e.deltaTime=s.readVarInt();var t=s.readUInt8();if(240&~t){var a;if(128&t)a=s.readUInt8(),n=t;else{if(null===n)throw"Running status byte encountered before status byte";a=t,t=n,e.running=!0}var o=t>>4;switch(e.channel=15&t,o){case 8:return e.type="noteOff",e.noteNumber=a,e.velocity=s.readUInt8(),e;case 9:var r=s.readUInt8();return e.type=0===r?"noteOff":"noteOn",e.noteNumber=a,e.velocity=r,0===r&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=a,e.amount=s.readUInt8(),e;case 11:return e.type="controller",e.controllerType=a,e.value=s.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=a,e;case 13:return e.type="channelAftertouch",e.amount=a,e;case 14:return e.type="pitchBend",e.value=a+(s.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+o}}else{if(255!==t){if(240==t){e.type="sysEx";l=s.readVarInt();return e.data=s.readBytes(l),e}if(247==t){e.type="endSysEx";l=s.readVarInt();return e.data=s.readBytes(l),e}throw"Unrecognised MIDI event type byte: "+t}e.meta=!0;var i=s.readUInt8(),l=s.readVarInt();switch(i){case 0:if(e.type="sequenceNumber",2!==l)throw"Expected length for sequenceNumber event is 2, got "+l;return e.number=s.readUInt16(),e;case 1:return e.type="text",e.text=s.readString(l),e;case 2:return e.type="copyrightNotice",e.text=s.readString(l),e;case 3:return e.type="trackName",e.text=s.readString(l),e;case 4:return e.type="instrumentName",e.text=s.readString(l),e;case 5:return e.type="lyrics",e.text=s.readString(l),e;case 6:return e.type="marker",e.text=s.readString(l),e;case 7:return e.type="cuePoint",e.text=s.readString(l),e;case 32:if(e.type="channelPrefix",1!=l)throw"Expected length for channelPrefix event is 1, got "+l;return e.channel=s.readUInt8(),e;case 33:if(e.type="portPrefix",1!=l)throw"Expected length for portPrefix event is 1, got "+l;return e.port=s.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=l)throw"Expected length for endOfTrack event is 0, got "+l;return e;case 81:if(e.type="setTempo",3!=l)throw"Expected length for setTempo event is 3, got "+l;return e.microsecondsPerBeat=s.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=l)throw"Expected length for smpteOffset event is 5, got "+l;var c=s.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&c],e.hour=31&c,e.min=s.readUInt8(),e.sec=s.readUInt8(),e.frame=s.readUInt8(),e.subFrame=s.readUInt8(),e;case 88:if(e.type="timeSignature",2!=l&&4!=l)throw"Expected length for timeSignature event is 4 or 2, got "+l;return e.numerator=s.readUInt8(),e.denominator=1<<s.readUInt8(),4===l?(e.metronome=s.readUInt8(),e.thirtyseconds=s.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",2!=l)throw"Expected length for keySignature event is 2, got "+l;return e.key=s.readInt8(),e.scale=s.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=s.readBytes(l),e;default:return e.type="unknownMeta",e.data=s.readBytes(l),e.metatypeByte=i,e}}}}function t(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}return AR=1,t.prototype.eof=function(){return this.pos>=this.bufferLen},t.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},t.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},t.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},t.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},t.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},t.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},t.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},t.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},LR=function(n){var s=new t(n),a=s.readChunk();if("MThd"!=a.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var o=function(e){var n=new t(e),s=n.readUInt16(),a=n.readUInt16(),o={format:s,numTracks:a},r=n.readUInt16();32768&r?(o.framesPerSecond=256-(r>>8),o.ticksPerFrame=255&r):o.ticksPerBeat=r;return o}(a.data),r=[],i=0;!s.eof()&&i<o.numTracks;i++){var l=s.readChunk();if("MTrk"!=l.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var c=e(l.data);r.push(c)}return{header:o,tracks:r}}}function XR(){if(IR)return BR;function e(e,s,a){var o,r=new n,i=s.length,l=null;for(o=0;o<i;o++)!1!==a.running&&(a.running||s[o].running)||(l=null),l=t(r,s[o],l,a.useByte9ForNoteOff);e.writeChunk("MTrk",r.buffer)}function t(e,t,n,s){var a=t.type,o=t.deltaTime,r=t.text||"",i=t.data||[],l=null;switch(e.writeVarInt(o),a){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(r.length),e.writeString(r);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(r.length),e.writeString(r);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(r.length),e.writeString(r);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(r.length),e.writeString(r);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(r.length),e.writeString(r);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(r.length),e.writeString(r);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(r.length),e.writeString(r);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(c),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var u=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(u),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(i.length),e.writeBytes(i);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(i.length),e.writeBytes(i));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(i.length),e.writeBytes(i);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(i.length),e.writeBytes(i);break;case"noteOff":(l=(!1!==s&&t.byte9||s&&0==t.velocity?144:128)|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(l=144|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(l=160|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(l=176|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(l=192|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(l=208|t.channel)!==n&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":(l=224|t.channel)!==n&&e.writeUInt8(l);var d=8192+t.value,m=127&d,p=d>>7&127;e.writeUInt8(m),e.writeUInt8(p);break;default:throw"Unrecognized event type: "+a}return l}function n(){this.buffer=[]}return IR=1,n.prototype.writeUInt8=function(e){this.buffer.push(255&e)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(e){var t=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(n)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,s=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(s)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,s=e>>8&255,a=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(s),this.writeUInt8(a)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},n.prototype.writeString=function(e){var t,n=e.length,s=[];for(t=0;t<n;t++)s.push(e.codePointAt(t));this.writeBytes(s)},n.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(127&t),t>>=7;t;){var s=127&t|128;n.push(s),t>>=7}this.writeBytes(n.reverse())}},n.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},BR=function(t,s){if("object"!=typeof t)throw"Invalid MIDI data";s=s||{};var a,o=t.header||{},r=t.tracks||[],i=r.length,l=new n;for(function(e,t,s){var a=null==t.format?1:t.format,o=128;t.timeDivision?o=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?o=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(o=32767&t.ticksPerBeat);var r=new n;r.writeUInt16(a),r.writeUInt16(s),r.writeUInt16(o),e.writeChunk("MThd",r.buffer)}(l,o,i),a=0;a<i;a++)e(l,r[a],s);return l.buffer}}function zR(){return FR||(FR=1,RR.parseMidi=jR(),RR.writeMidi=XR()),RR}var GR,HR,WR={},qR={};function KR(){if(GR)return qR;function e(e,t,n){void 0===n&&(n="ticks");var s=0,a=e.length,o=a;if(a>0&&e[a-1][n]<=t)return a-1;for(;s<o;){var r=Math.floor(s+(o-s)/2),i=e[r],l=e[r+1];if(i[n]===t){for(var c=r;c<e.length;c++){e[c][n]===t&&(r=c)}return r}if(i[n]<t&&l[n]>t)return r;i[n]>t?o=r:i[n]<t&&(s=r+1)}return-1}return GR=1,Object.defineProperty(qR,"__esModule",{value:!0}),qR.insert=qR.search=void 0,qR.search=e,qR.insert=function(t,n,s){if(void 0===s&&(s="ticks"),t.length){var a=e(t,n[s],s);t.splice(a+1,0,n)}else t.push(n)},qR}function $R(){return HR||(HR=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=KR(),n=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=function(){function s(t){var s=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",n.set(this,480),t){n.set(this,t.header.ticksPerBeat),t.tracks.forEach(function(t){t.forEach(function(t){t.meta&&("timeSignature"===t.type?s.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?s.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&s.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))})});var a=0;t.tracks[0].forEach(function(e){a+=e.deltaTime,e.meta&&("trackName"===e.type?s.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||s.meta.push({text:e.text,ticks:a,type:e.type}))}),this.update()}}return s.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort(function(e,t){return e.ticks-t.ticks}),this.tempos.forEach(function(s,a){var o=a>0?e.tempos[a-1].bpm:e.tempos[0].bpm,r=s.ticks/e.ppq-n,i=60/o*r;s.time=i+t,t=s.time,n+=r}),this.timeSignatures.sort(function(e,t){return e.ticks-t.ticks}),this.timeSignatures.forEach(function(t,n){var s=n>0?e.timeSignatures[n-1]:e.timeSignatures[0],a=(t.ticks-s.ticks)/e.ppq/s.timeSignature[0]/(s.timeSignature[1]/4);s.measures=s.measures||0,t.measures=a+s.measures})},s.prototype.ticksToSeconds=function(e){var n=(0,t.search)(this.tempos,e);if(-1!==n){var s=this.tempos[n],a=s.time,o=(e-s.ticks)/this.ppq;return a+60/s.bpm*o}return.5*(e/this.ppq)},s.prototype.ticksToMeasures=function(e){var n=(0,t.search)(this.timeSignatures,e);if(-1!==n){var s=this.timeSignatures[n],a=(e-s.ticks)/this.ppq;return s.measures+a/(s.timeSignature[0]/s.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(s.prototype,"ppq",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),s.prototype.secondsToTicks=function(e){var n=(0,t.search)(this.tempos,e,"time");if(-1!==n){var s=this.tempos[n],a=(e-s.time)/(60/s.bpm);return Math.round(s.ticks+a*this.ppq)}var o=e/.5;return Math.round(o*this.ppq)},s.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},s.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(e){return Object.assign({},e)}),this.timeSignatures=e.timeSignatures.map(function(e){return Object.assign({},e)}),this.keySignatures=e.keySignatures.map(function(e){return Object.assign({},e)}),this.meta=e.meta.map(function(e){return Object.assign({},e)}),n.set(this,e.ppq),this.update()},s.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},s}();e.Header=s}(WR)),WR}var YR,JR={},QR={};function ZR(){return YR||(YR=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(t,n){return t[e.controlChangeNames[n]]=n,t},{});var t=new WeakMap,n=new WeakMap,s=function(){function s(e,s){t.set(this,s),n.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(s.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"time",{get:function(){return t.get(this).ticksToSeconds(this.ticks)},set:function(e){var n=t.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},s}();e.ControlChange=s}(QR)),QR}var ej,tj={};var nj,sj={};var aj,oj,rj={},ij={};function lj(){if(oj)return rj;oj=1,Object.defineProperty(rj,"__esModule",{value:!0}),rj.Instrument=void 0;var e=(aj||(aj=1,Object.defineProperty(ij,"__esModule",{value:!0}),ij.DrumKitByPatchID=ij.InstrumentFamilyByID=ij.instrumentByPatchID=void 0,ij.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],ij.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],ij.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),ij),t=new WeakMap,n=function(){function n(e,n){if(this.number=0,t.set(this,n),this.number=0,e){var s=e.find(function(e){return"programChange"===e.type});s&&(this.number=s.programNumber)}}return Object.defineProperty(n.prototype,"name",{get:function(){return this.percussion?e.DrumKitByPatchID[this.number]:e.instrumentByPatchID[this.number]},set:function(t){var n=e.instrumentByPatchID.indexOf(t);-1!==n&&(this.number=n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"family",{get:function(){return this.percussion?"drums":e.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"percussion",{get:function(){return 9===t.get(this).channel},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},n.prototype.fromJSON=function(e){this.number=e.number},n}();return rj.Instrument=n,rj}var cj,uj,dj={};function mj(){if(cj)return dj;function e(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}cj=1,Object.defineProperty(dj,"__esModule",{value:!0}),dj.Note=void 0;var t=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var s=e.exec(n),a=s[1],o=s[2];return t[a.toLowerCase()]+12*(parseInt(o,10)+1)}}(),n=new WeakMap,s=function(){function s(e,t,s){n.set(this,s),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(s.prototype,"name",{get:function(){return t=this.midi,n=Math.floor(t/12)-1,e(t)+n.toString();var t,n},set:function(e){this.midi=t(e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"pitch",{get:function(){return e(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"duration",{get:function(){var e=n.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"bars",{get:function(){return n.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},s}();return dj.Note=s,dj}function pj(){if(uj)return JR;uj=1,Object.defineProperty(JR,"__esModule",{value:!0}),JR.Track=void 0;var e=KR(),t=ZR(),n=function(){if(ej)return tj;ej=1,Object.defineProperty(tj,"__esModule",{value:!0}),tj.createControlChanges=void 0;var e=ZR();return tj.createControlChanges=function(){return new Proxy({},{get:function(t,n){return t[n]?t[n]:e.controlChangeIds.hasOwnProperty(n)?t[e.controlChangeIds[n]]:void 0},set:function(t,n,s){return e.controlChangeIds.hasOwnProperty(n)?t[e.controlChangeIds[n]]=s:t[n]=s,!0}})},tj}(),s=function(){if(nj)return sj;nj=1,Object.defineProperty(sj,"__esModule",{value:!0}),sj.PitchBend=void 0;var e=new WeakMap,t=function(){function t(t,n){e.set(this,n),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return e.get(this).ticksToSeconds(this.ticks)},set:function(t){var n=e.get(this);this.ticks=n.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return sj.PitchBend=t,sj}(),a=lj(),o=mj(),r=new WeakMap,i=function(){function i(e,t){var s=this;if(this.name="",this.notes=[],this.controlChanges=(0,n.createControlChanges)(),this.pitchBends=[],r.set(this,t),e){var o=e.find(function(e){return"trackName"===e.type});this.name=o?o.text:""}if(this.instrument=new a.Instrument(e,this),this.channel=0,e){for(var i=e.filter(function(e){return"noteOn"===e.type}),l=e.filter(function(e){return"noteOff"===e.type}),c=function(){var e=i.shift();u.channel=e.channel;var t=l.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime});if(-1!==t){var n=l.splice(t,1)[0];u.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},u=this;i.length;)c();e.filter(function(e){return"controller"===e.type}).forEach(function(e){s.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})}),e.filter(function(e){return"pitchBend"===e.type}).forEach(function(e){s.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})});var d=e.find(function(e){return"endOfTrack"===e.type});this.endOfTrackTicks=void 0!==d?d.absoluteTime:void 0}}return i.prototype.addNote=function(t){var n=r.get(this),s=new o.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},n);return Object.assign(s,t),(0,e.insert)(this.notes,s,"ticks"),this},i.prototype.addCC=function(n){var s=r.get(this),a=new t.ControlChange({controllerType:n.number},s);return delete n.number,Object.assign(a,n),Array.isArray(this.controlChanges[a.number])||(this.controlChanges[a.number]=[]),(0,e.insert)(this.controlChanges[a.number],a,"ticks"),this},i.prototype.addPitchBend=function(t){var n=r.get(this),a=new s.PitchBend({},n);return Object.assign(a,t),(0,e.insert)(this.pitchBends,a,"ticks"),this},Object.defineProperty(i.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),i.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new a.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach(function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})});e.notes.forEach(function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})})},i.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(e){return e.toJSON()}));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(e){return e.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(e){return e.toJSON()})};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},i}();return JR.Track=i,JR}var hj={};function fj(e,t){for(var n=0;n<e.length;n++){var s=e[n];Array.isArray(s)?fj(s,t):t.push(s)}}const gj=s(Object.freeze(Object.defineProperty({__proto__:null,flatten:function(e){var t=[];return fj(e,t),t}},Symbol.toStringTag,{value:"Module"})));var bj,vj;function yj(){if(bj)return hj;bj=1;var e=hj&&hj.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var s,a=0,o=t.length;a<o;a++)!s&&a in t||(s||(s=Array.prototype.slice.call(t,0,a)),s[a]=t[a]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(hj,"__esModule",{value:!0}),hj.encode=void 0;var t=zR(),n=$R(),s=gj;function a(e){return(0,s.flatten)(e.notes.map(function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)}))}function o(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function r(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}return hj.encode=function(s){var i={header:{format:1,numTracks:s.tracks.length+1,ticksPerBeat:s.header.ppq},tracks:e([e(e(e(e([{absoluteTime:0,deltaTime:0,meta:!0,text:s.header.name,type:"trackName"}],s.header.keySignatures.map(function(e){return function(e){var t=n.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)}),!0),s.header.meta.map(function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t}),!0),s.header.tempos.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)}),!0),s.header.timeSignatures.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)}),!0)],s.tracks.map(function(t){return e(e(e([(n=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:n,type:"trackName"}),r(t)],a(t),!0),function(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach(function(n){t.push(o(n,e.channel))});return t}(t),!0),function(e){var t=[];return e.pitchBends.forEach(function(n){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(n,e.channel))}),t}(t),!0);var n}),!0)};return i.tracks=i.tracks.map(function(e){e=e.sort(function(e,t){return e.absoluteTime-t.absoluteTime});var t=0;return e.forEach(function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime}),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e}),new Uint8Array((0,t.writeMidi)(i))},hj}var xj=(vj||(vj=1,function(e){var t=UR&&UR.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(a,o){function r(e){try{l(s.next(e))}catch(t){o(t)}}function i(e){try{l(s.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,i)}l((s=s.apply(e,t||[])).next())})},n=UR&&UR.__generator||function(e,t){var n,s,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(a=2&o[0]?s.return:o[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,o[1])).done)return a;switch(s=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((a=(a=r.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(i){o=[6,i],s=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var s=zR(),a=$R(),o=pj(),r=yj(),i=function(){function e(e){var t=this,n=null;if(e){var r=e instanceof ArrayBuffer?new Uint8Array(e):e;(n=(0,s.parseMidi)(r)).tracks.forEach(function(e){var t=0;e.forEach(function(e){t+=e.deltaTime,e.absoluteTime=t})}),n.tracks=function(e){for(var t=[],n=0;n<e.length;n++)for(var s=t.length,a=new Map,o=Array(16).fill(0),r=0,i=e[n];r<i.length;r++){var l=i[r],c=s,u=l.channel;if(void 0!==u){"programChange"===l.type&&(o[u]=l.programNumber);var d=o[u],m="".concat(d," ").concat(u);a.has(m)?c=a.get(m):(c=s+a.size,a.set(m,c))}t[c]||t.push([]),t[c].push(l)}return t}(n.tracks)}this.header=new a.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map(function(e){return new o.Track(e,t.header)}),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(s){return t(this,void 0,void 0,function(){var t;return n(this,function(n){switch(n.label){case 0:return[4,fetch(s)];case 1:return(t=n.sent()).ok?[4,t.arrayBuffer()]:[3,3];case 2:return[2,new e(n.sent())];case 3:throw new Error("Could not load '".concat(s,"'"))}})})},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map(function(e){return e.duration});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(e){return e.durationTicks});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(){var e=new o.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return(0,r.encode)(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},e.prototype.fromJSON=function(e){var t=this;this.header=new a.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(e){var n=new o.Track(void 0,t.header);return n.fromJSON(e),n})},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();e.Midi=i;var l=pj();Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var c=$R();Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}})}(UR)),UR);const Nj=Rn({__proto__:null},[xj]),wj=(e,t=0)=>({type:e,detune:0,octave:t}),Ej=(e,t,n,s)=>({attack:e,decay:t,sustain:n,release:s}),kj=(e,t=1)=>({type:"lowpass",frequency:e,Q:t,rolloff:-24}),Dj={type:"synth",effects:[],volume:-6,pan:0},Sj=["Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Rhodes Piano","Chorused Electric Piano","Harpsichord","Clavinet","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Hammond Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","French Accordion","Harmonica","Bandoneon","Nylon String Guitar","Steel String Guitar","Jazz Guitar","Clean Electric Guitar","Muted Electric Guitar","Overdriven Guitar","Distortion Guitar","Guitar Harmonics","Acoustic Bass","Finger Bass","Pick Bass","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","Slow String Ensemble","Synth Strings 1","Synth Strings 2","Choir Aahs","Voice Oohs","Synth Choir","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet","French Horn","Brass Section","Synth Brass 1","Synth Brass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Whistle","Ocarina","Lead 1 Square","Lead 2 Sawtooth","Lead 3 Calliope","Lead 4 Chiff","Lead 5 Charang","Lead 6 Voice","Lead 7 Fifths","Lead 8 Bass+Lead","Pad 1 New Age","Pad 2 Warm","Pad 3 Polysynth","Pad 4 Space Voice","Pad 5 Bowed Glass","Pad 6 Metallic","Pad 7 Halo","Pad 8 Sweep","FX 1 Ice Rain","FX 2 Soundtrack","FX 3 Crystal","FX 4 Atmosphere","FX 5 Brightness","FX 6 Goblins","FX 7 Echo Drops","FX 8 Star Theme","Sitar","Banjo","Shamisen","Koto","Kalimba","Bagpipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Melodic Tom","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gun Shot"];const Mj={35:{name:"Acoustic Bass Drum",drumType:"kick",machineType:"808"},36:{name:"Bass Drum 1",drumType:"kick",machineType:"808"},37:{name:"Side Stick",drumType:"rimshot",machineType:"808"},38:{name:"Acoustic Snare",drumType:"snare",machineType:"808"},39:{name:"Hand Clap",drumType:"clap",machineType:"808"},40:{name:"Electric Snare",drumType:"snare",machineType:"808"},41:{name:"Low Floor Tom",drumType:"tom",machineType:"808"},42:{name:"Closed Hi-Hat",drumType:"hihat",machineType:"808"},43:{name:"High Floor Tom",drumType:"tom",machineType:"808"},44:{name:"Pedal Hi-Hat",drumType:"hihat",machineType:"808"},45:{name:"Low Tom",drumType:"tom",machineType:"808"},46:{name:"Open Hi-Hat",drumType:"hihat",machineType:"808"},47:{name:"Low-Mid Tom",drumType:"tom",machineType:"808"},48:{name:"Hi-Mid Tom",drumType:"tom",machineType:"808"},49:{name:"Crash Cymbal 1",drumType:"cymbal",machineType:"808"},50:{name:"High Tom",drumType:"tom",machineType:"808"},51:{name:"Ride Cymbal 1",drumType:"cymbal",machineType:"808"},52:{name:"Chinese Cymbal",drumType:"cymbal",machineType:"808"},53:{name:"Ride Bell",drumType:"cowbell",machineType:"808"},54:{name:"Tambourine",drumType:"maracas",machineType:"808"},55:{name:"Splash Cymbal",drumType:"cymbal",machineType:"808"},56:{name:"Cowbell",drumType:"cowbell",machineType:"808"},57:{name:"Crash Cymbal 2",drumType:"cymbal",machineType:"808"},58:{name:"Vibraslap",drumType:"maracas",machineType:"808"},59:{name:"Ride Cymbal 2",drumType:"cymbal",machineType:"808"},60:{name:"Hi Bongo",drumType:"conga",machineType:"808"},61:{name:"Low Bongo",drumType:"conga",machineType:"808"},62:{name:"Mute Hi Conga",drumType:"conga",machineType:"808"},63:{name:"Open Hi Conga",drumType:"conga",machineType:"808"},64:{name:"Low Conga",drumType:"conga",machineType:"808"},65:{name:"High Timbale",drumType:"tom",machineType:"808"},66:{name:"Low Timbale",drumType:"tom",machineType:"808"},67:{name:"High Agogo",drumType:"cowbell",machineType:"808"},68:{name:"Low Agogo",drumType:"cowbell",machineType:"808"},69:{name:"Cabasa",drumType:"maracas",machineType:"808"},70:{name:"Maracas",drumType:"maracas",machineType:"808"},71:{name:"Short Whistle",drumType:"hihat",machineType:"808"},72:{name:"Long Whistle",drumType:"hihat",machineType:"808"},73:{name:"Short Guiro",drumType:"clave",machineType:"808"},74:{name:"Long Guiro",drumType:"clave",machineType:"808"},75:{name:"Claves",drumType:"clave",machineType:"808"},76:{name:"Hi Wood Block",drumType:"rimshot",machineType:"808"},77:{name:"Low Wood Block",drumType:"rimshot",machineType:"808"},78:{name:"Mute Cuica",drumType:"conga",machineType:"808"},79:{name:"Open Cuica",drumType:"conga",machineType:"808"},80:{name:"Mute Triangle",drumType:"hihat",machineType:"808"},81:{name:"Open Triangle",drumType:"hihat",machineType:"808"}};function Cj(e,t,n){const s=Math.max(0,Math.min(127,e));return s<8?function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj(e<4?"triangle":"sine"),envelope:Ej(2,1500,30,500),filter:kj(4e3,.5)}}(s,t):s<16?function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"AMSynth",oscillator:wj("sine"),envelope:Ej(1,400,0,200)}}(s,t):s<24?function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"Organ",oscillator:wj(18===e?"square":"sine"),envelope:Ej(10,100,100,100)}}(s,t):s<32?function(e,t){const n=29===e||30===e;return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj(n?"square":"sawtooth"),envelope:Ej(1,n?600:350,10,200),filter:kj(n?1500:3500)}}(s,t):s<40?function(e,t){const n=e>=38;return{...Dj,id:t,name:Sj[e],synthType:"MonoSynth",oscillator:wj(n?"square":"sawtooth",-1),envelope:Ej(5,n?400:200,20,100),filter:kj(n?800:1500,n?4:1),monophonic:!0}}(s,t):s<48?function(e,t){const n=47===e;return 45===e||46===e?{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj("triangle"),envelope:Ej(1,400,0,200)}:n?{...Dj,id:t,name:Sj[e],synthType:"MembraneSynth",envelope:Ej(1,500,0,200)}:{...Dj,id:t,name:Sj[e],synthType:"StringMachine",oscillator:wj("sawtooth"),envelope:Ej(44===e?5:60,2e3,80,600)}}(s,t):s<56?function(e,t){const n=55===e;return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj(n?"square":"sine"),envelope:Ej(n?1:80,n?200:3e3,n?0:70,800),filter:kj(2e3,.5)}}(s,t):s<64?function(e,t){const n=e>=62;return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj(n?"sawtooth":"square"),envelope:Ej(n?5:15,500,60,200),filter:kj(n?2e3:3e3)}}(s,t):s<72?function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj("sawtooth"),envelope:Ej(20,1e3,70,300),filter:kj(2500,2)}}(s,t):s<80?function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj(e<74?"sine":"triangle"),envelope:Ej(30,2e3,80,400),filter:kj(5e3)}}(s,t):s<88?function(e,t){const n=81===e;return{...Dj,id:t,name:Sj[e],synthType:"FMSynth",oscillator:wj(n?"sawtooth":"sine"),envelope:Ej(1,500,50,200)}}(s,t):s<96?function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj(e>=91?"triangle":"sine"),envelope:Ej(200,3e3,80,1500),filter:kj(1500,.5)}}(s,t):s<104?function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"FMSynth",oscillator:wj("sine"),envelope:Ej(100,2e3,50,1e3)}}(s,t):s<112?function(e,t){const n=109===e||110===e;return{...Dj,id:t,name:Sj[e],synthType:"PolySynth",oscillator:wj("triangle"),envelope:Ej(n?30:1,n?1500:500,n?50:0,200),filter:kj(3e3)}}(s,t):s<120?function(e,t){const n=e>=116;return{...Dj,id:t,name:Sj[e],synthType:n?"MembraneSynth":"MetalSynth",envelope:Ej(1,n?400:200,0,n?300:100)}}(s,t):function(e,t){return{...Dj,id:t,name:Sj[e],synthType:"FMSynth",oscillator:wj("sine"),envelope:Ej(50,1e3,30,500)}}(s,t)}function Vj(e="id"){return`${e}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}const Pj={quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64};async function _j(e,t={}){const n={...Pj,...t},s=await e.arrayBuffer(),a=new xj.Midi(s),o=a.header.ppq||480;if(0===o)throw new Error("Invalid MIDI file: PPQ (pulses per quarter note) cannot be zero");const r=a.header.tempos.length>0?Math.round(a.header.tempos[0].bpm):120,i=a.header.timeSignatures.length>0?[a.header.timeSignatures[0].timeSignature[0],a.header.timeSignatures[0].timeSignature[1]]:[4,4],l=[],c=[];if(n.mergeChannels){const e=new Map;let t=1;a.tracks.forEach((n,s)=>{0===n.notes.length||n.instrument.percussion||(e.set(s,t),c.push(Cj(n.instrument.number,t)),t++)});const s=function(e,t,n,s,a){const o=e.duration*(e.header.tempos[0]?.bpm||120)/60*s,r=o>0?Math.min(256,16*Math.ceil(o/16)):Math.min(256,t.defaultPatternLength||16),i=new Map;e.tracks.forEach((e,t)=>{e.notes.forEach(e=>{i.has(t)||i.set(t,[]),i.get(t).push({tick:e.ticks,note:e})})});const l=Array.from(i.entries()).sort((e,t)=>e[0]-t[0]).map(([e,o])=>{const i=a.get(e)??1,l=Array.from({length:r},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return o.forEach(({tick:e,note:a})=>{const o=Lj(e,n,s,t.quantize);if(o<0||o>=r)return;const c=Za(a.midi);if(!c)return;if(l[o].note=c,l[o].instrument=i,t.velocityToVolume){const e=Aj(127*a.velocity);l[o].volume=16+Math.round(e/64*64)}const u=Lj(e+a.durationTicks,n,s,t.quantize);u<r&&u>o&&(l[u].note=97)}),{id:Vj("channel"),name:`Ch ${e+1}`,instrumentId:i,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:l}});return{id:Vj("pattern"),name:e.name||"MIDI Import",length:r,channels:l}}(a,n,o,4,e);a.tracks.forEach((e,a)=>{if(0===e.notes.length||!e.instrument.percussion)return;const r=Oj(e,a,n,o,4,t);s.channels.push(...r.pattern.channels),c.push(...r.instruments),t+=r.instruments.length}),l.push(s)}else{let e=1;for(let t=0;t<a.tracks.length;t++){const s=a.tracks[t];if(0!==s.notes.length)if(s.instrument.percussion){const a=Oj(s,t,n,o,4,e);l.push(a.pattern),c.push(...a.instruments),e+=a.instruments.length}else c.push(Cj(s.instrument.number,e)),l.push(Tj(s,t,e,n,o,4)),e++}}return{patterns:l,instruments:c,bpm:r,timeSignature:i,metadata:{name:a.name||e.name.replace(/\.[^/.]+$/,""),tracks:a.tracks.length,totalTicks:a.durationTicks}}}function Oj(e,t,n,s,a,o){const r=e.notes.reduce((e,t)=>Math.max(e,t.ticks),0)/s*a,i=r>0?Math.min(256,16*Math.ceil(r/16)):Math.min(256,n.defaultPatternLength||16),l=new Map;e.notes.forEach(e=>{l.has(e.midi)||l.set(e.midi,[]),l.get(e.midi).push({tick:e.ticks,velocity:e.velocity})});const c=[],u=[];let d=o;return Array.from(l.entries()).sort((e,t)=>e[0]-t[0]).forEach(([e,t])=>{const o=function(e,t){const n=Mj[e]??{name:`Perc ${e}`,drumType:"snare",machineType:"808"};return{...Dj,id:t,name:n.name,synthType:"DrumMachine",drumMachine:{drumType:n.drumType,machineType:n.machineType}}}(e,d);u.push(o);const r=Array.from({length:i},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));t.forEach(({tick:e,velocity:t})=>{const o=Lj(e,s,a,n.quantize);if(!(o<0||o>=i)&&(r[o].note=1,r[o].instrument=d,n.velocityToVolume)){const e=Aj(127*t);r[o].volume=16+Math.round(e/64*64)}}),c.push({id:Vj("channel"),name:o.name,instrumentId:d,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:r}),d++}),{pattern:{id:Vj("pattern"),name:e.name||`Drums ${t+1}`,length:i,channels:c},instruments:u}}function Tj(e,t,n,s,a,o){const r=e.notes.length>0?e.notes[e.notes.length-1]:null,i=(r?r.ticks+r.durationTicks:0)/a*o,l=i>0?Math.min(256,16*Math.ceil(i/16)):Math.min(256,s.defaultPatternLength||16),c=Array.from({length:l},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return e.notes.forEach(e=>{const t=Lj(e.ticks,a,o,s.quantize);if(t<0||t>=l)return;const r=Za(e.midi);if(!r)return;if(c[t].note=r,c[t].instrument=n,s.velocityToVolume){const n=Aj(127*e.velocity);c[t].volume=16+Math.round(n/64*64)}const i=Lj(e.ticks+e.durationTicks,a,o,s.quantize);i<l&&i>t&&(c[i].note=97)}),{id:Vj("pattern"),name:e.name||`Track ${t+1}`,length:l,channels:[{id:Vj("channel"),name:"Channel 1",instrumentId:n,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:c}]}}function Lj(e,t,n,s=0){if(0===t)return 0;const a=Math.round(e/t*n);return s>0?Math.round(a/s)*s:a}function Aj(e){return Math.round(e/127*64)}function Bj(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return".mid"===t||".midi"===t}function Ij(){return[".mid",".midi"]}const Fj=Object.freeze(Object.defineProperty({__proto__:null,getSupportedMIDIExtensions:Ij,importMIDIFile:_j,isMIDIFile:Bj},Symbol.toStringTag,{value:"Module"})),Uj=[".json",".dbx",".dbox",".xml",".mid",".midi",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".j2b",".m15",".mdl",".mt2",".mtm",".psm",".pt36",".ptm",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".hvl",".ahx",".okt",".med",".mmd0",".mmd1",".mmd2",".mmd3",".digi",".fc",".fc13",".fc14",".sfc",".fc2",".fc3",".fc4",".smod",".hip",".hip7",".sog",".s7g",".hipc",".hst",".soc",".coso",".tfmx",".mdat",".tfmxpro",".tfmx1.5",".tfmx7v",".tfhd1.5",".tfhd7v",".tfhdpro",".fred",".gray",".sm",".sm1",".sm2",".sm3",".smpro",".bd",".bds",".dw",".dwold",".mc",".mcr",".mco",".jp",".jpn",".jpnd",".rj",".rjp",".dm",".dm1",".dm2",".dlm1",".dlm2",".sa",".sa-p",".sa_old",".sonic",".lion",".abk",".aam",".aon",".aon4",".aon8",".adpcm",".adsc",".mod_adsc4",".bss",".bfc",".bsi",".core",".cin",".dl",".dl_deli",".dln",".ea",".mg",".fp",".fw",".gmc",".gm",".glue",".hd",".ims",".jam",".jc",".kris",".kh",".lme",".ma",".max",".mdst",".mkii",".mk2",".mkiio",".ntp",".osp",".ps",".psf",".pt",".ptm",".puma",".rh",".rhp",".rho",".riff",".sas",".sb",".scr",".sdr",".sg",".snk",".ss",".st26",".sun",".syn",".dh",".uds",".octamed",".tpu",".tcb",".ufo",".mus",".wn",".wb",".ym",".ymst",".sid",".sid1",".sid2",".smn",".bp",".bp3",".sndmon",".sfx",".sfx13",".sfx20",".mms",".smus",".snx",".agi",".vss",".ml",".sng",".qpa",".qts",".sqt",".ash",".aps",".ast",".alp",".amc",".dsc",".dsr",".dss",".dns",".dmu",".dmu2",".ems",".emsv6",".emod",".jmf",".jo",".js",".jb",".jcb",".jcbo",".jd",".jt",".kim",".mon",".mon_old",".mfp",".mosh",".mmdc",".mug",".mug2",".mm4",".mm8",".psa",".prt",".pn",".pap",".pvp",".pat",".sc",".sct",".scn",".scumm",".sjs",".spl",".syn",".synmod",".tf",".thm",".tmk",".tme",".dp",".trc",".tro",".tronic",".dat",".dum",".doda",".dz",".ex",".cm",".cus",".cust",".custom",".hot",".bye",".one",".two",".avp",".mw",".md",".mok",".tiny",".sdata",".npp",".is",".is20",".jpo",".jpold",".powt",".hn",".mtp2",".thn",".arp",".tits",".mcmd",".mcmd_org",".ac1",".ac1d",".aval",".chan",".cp",".cplx",".crb",".di",".eu",".fc-m",".fcm",".ft",".fuz",".fuzz",".gv",".hmc",".hrt",".ice",".it1",".kef",".kef7",".krs",".ksm",".lax",".mexxmp",".mpro",".np",".np1",".np2",".np3",".nr",".nru",".ntpk",".p10",".p21",".p30",".p40a",".p40b",".p41a",".p4x",".p50a",".p5a",".p5x",".p60",".p60a",".p61",".p61a",".p6x",".pha",".pin",".pm",".pm0",".pm01",".pm1",".pm10c",".pm18a",".pm2",".pm20",".pm4",".pm40",".pmz",".polk",".pp10",".pp20",".pp21",".pp30",".ppk",".pr1",".pr2",".prom",".pru",".pru1",".pru2",".prun",".prun1",".prun2",".pwr",".pyg",".pygm",".pygmy",".skt",".skyt",".snt",".st",".st2",".st30",".star",".stpk",".tp",".tp1",".tp2",".tp3",".un2",".unic",".unic2",".wn",".xan",".xann",".zen",".mod_doc",".mod15",".mod15_mst",".mod_ntk",".mod_ntk1",".mod_ntk2",".mod_ntkamp",".mod_flt4",".mod_comp",".mod15_ust",".mod15_st-iv",".mod3",".gt2",".gtk",".dsym",".cba",".act",".c67",".667",".fmt",".dtm",".etx",".is10",".plm",".qc",".rk",".rkb",".rtm",".tfx",".uax",".xmf",".mxtx",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".vgm",".vgz",".nsf",".nsfe",".sap",".ay",".mid",".midi"].join(","),Rj=[".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx",".hvl",".ahx",".mmd0",".mmd1",".mmd2",".mmd3",".digi",".hip",".hip7",".hipc",".hst",".soc",".sog",".s7g",".mcmd",".tfmx",".mdat",".mdst",".fc",".fc13",".fc14",".fc2",".fc3",".fc4",".sfc",".smod",".bfc",".bsi",".fred",".gray",".sid1",".sid2",".smn",".bp",".bp3",".sndmon",".bd",".bds",".dl",".dln",".dw",".dwold",".dh",".rjp",".rh",".rho",".mc",".mcr",".mco",".jcb",".jcbo",".jp",".jpn",".jpnd",".jt",".jo",".jmf",".jpo",".jpold",".kim",".kh",".avp",".mw",".md",".thm",".tf",".tmk",".sb",".wb",".hn",".tpu",".hot",".bye",".ash",".dz",".scn",".scr",".snk",".ps",".pvp",".pap",".pat",".dat",".sa",".sonic",".jam",".jc",".ims",".emod",".qc",".kris",".puma",".tcb",".prt",".synmod",".ex",".sg",".mkii",".mk2",".lme",".ma",".ml",".bss",".dns",".vss",".sdr",".osp",".psa",".sm",".sc",".sct",".tw",".spl",".sfx13",".sfx20",".psf",".sjs",".mms",".smus",".snx",".dm",".dm1",".dm2",".dlm1",".dlm2",".dmu",".dmu2",".mug",".mug2",".mm4",".mm8",".sdata",".aam",".aon",".aon4",".aon8",".adsc",".core",".cin",".ea",".mg",".fw",".glue",".gm",".gmc",".dum",".scumm",".mok",".riff",".max",".mon",".dsr",".dsc",".dss",".ems",".emsv6",".is",".is20",".mfp",".ntp",".mosh",".npp",".tits",".alp",".uds",".sas",".ss",".fp",".sun",".trc",".tro",".tronic",".dp",".ufo",".mus",".abk",".cust",".custom",".cm",".rk",".ast",".aps",".amc",".mmdc",".qpa",".sqt",".qts",".jd",".doda",".ym",".ymst",".agi",".mso",".sng",".tiny",".one",".two"],jj=[...Rj,".sqs",".seq",".mid",".midi"];function Xj(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return Rj.includes(t)}function zj(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return jj.includes(t)}const Gj=({isOpen:e,onClose:t,onLoad:n,onLoadTrackerModule:s,mode:a,currentProjectData:o,suggestedFilename:r="untitled.dbx"})=>{const[i,c]=l.useState([]),[u,d]=l.useState(!1),[m,p]=l.useState(null),[h,f]=l.useState(null),[g,b]=l.useState(r),[v,y]=l.useState(!1),[x,N]=l.useState(!1),[w,E]=l.useState(""),[k,D]=l.useState(null),[S,M]=l.useState("demo"),[C,V]=l.useState([]),[P,_]=l.useState(""),[O,T]=l.useState(""),[L,A]=l.useState([]),[B,I]=l.useState([]),[F,U]=l.useState(null),[R,j]=l.useState(!1),[X,z]=l.useState(null),[G,H]=l.useState(0),[W,q]=l.useState(!1),[K,$]=l.useState(new Set),Y=l.useRef(null),J=l.useRef(null),[Q,Z]=l.useState(!1),[ee,te]=l.useState([]),[ne,se]=l.useState(!1),[ae,oe]=l.useState(null),[re,ie]=l.useState(""),le=l.useRef({id:"",time:0}),ce=l.useRef(null),ue=l.useRef({key:"",index:-1,time:0}),de=CC(e=>e.user),me=CC(e=>e.isServerAvailable);l.useEffect(()=>{e&&(async()=>{const e=SC(),t=vR()&&!!xR();if(y(e||t),!e&&!t){const e=await async function(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),1e3),n=await fetch(`${ER}/demo/songs/`,{method:"HEAD",signal:e.signal});return clearTimeout(t),n.ok}catch{return!1}}();N(e)}})()},[e]),l.useEffect(()=>{if(!e||"modland"===S)return;const t=e=>{const t=e.target?.tagName;if("INPUT"===t||"SELECT"===t||"TEXTAREA"===t)return;const n=e.key.toLowerCase();if(!/^[a-z0-9]$/.test(n))return;e.preventDefault();const s=[];if(i.forEach((e,t)=>{e.name.toLowerCase().startsWith(n)&&s.push(t)}),0===s.length)return;const a=Date.now();let o;if(ue.current.key===n&&a-ue.current.time<1e3){const e=s.indexOf(ue.current.index),t=e>=0?(e+1)%s.length:0;o=s[t]}else o=s[0];ue.current={key:n,index:o,time:a};const r=i[o];r&&!r.isDirectory&&f(r);const l=""!==w&&"demo"===S?o+1:o,c=ce.current;if(c){const e=c.querySelectorAll("[data-file-row]")[l];e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[e,S,i,w]);const pe=l.useCallback(async()=>{if("modland"!==S){d(!0),p(null);try{let e=[];if("cloud"===S&&_C()){const t=await TC("songs");return V(t),e=t.map(e=>({id:e.id,name:e.filename,isDirectory:!1,path:e.filename,modifiedAt:new Date(e.updatedAt),source:"cloud",cloudId:e.id})),e.sort((e,t)=>e.name.localeCompare(t.name)),c(e),void d(!1)}if(SC()&&window.electron?.fs){if(!k)return void d(!1);const t=k||w;if(t){e=(await window.electron.fs.readdir(t,[])).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),e.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}}else{if(x)try{const t=w||"songs";e=(await async function(e){const t=e.replace(/^\/+/,"");let n="songs",s="";""===t||"songs"===t?(n="songs",s=""):"instruments"===t?(n="instruments",s=""):t.startsWith("instruments/")?(n="instruments",s=t.replace(/^instruments\/?/,"")):t.startsWith("songs/")?(n="songs",s=t.replace(/^songs\/?/,"")):(n="songs",s=t);const a=await fetch(`${ER}/demo/${n}/${s}`);if(!a.ok)throw new Error(`Failed to list directory: ${a.statusText}`);const o=await a.json();return Array.isArray(o)?o.map(e=>({name:e.name,path:t?`${t}/${e.name}`:e.name,isDirectory:e.isDirectory,size:e.size,modifiedAt:e.modifiedAt})):o.items||[]}(t)).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),e.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}catch{}if(0===e.length&&kR()){const t=function(e){const t=e.replace(/^\/+/,"").replace(/\/+$/,""),n=new Set,s=[];for(const o of wR){const e=o.replace(/^\/public\/data\//,"");if(t&&!e.startsWith(t+"/"))continue;const a=t?e.slice(t.length+1):e;if(!a)continue;const r=a.indexOf("/");if(-1!==r){const e=a.slice(0,r);n.add(e)}else{if("modules.json"===a)continue;s.push({name:a,path:t?`${t}/${a}`:a,isDirectory:!1})}}const a=Array.from(n).sort().map(e=>({name:e,path:t?`${t}/${e}`:e,isDirectory:!0}));return s.sort((e,t)=>e.name.localeCompare(t.name)),[...a,...s]}(w||"");e=t.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,source:"filesystem"}))}if(0===e.length){const t=xR();if(t){const n=await async function(e,t){const n=e||yR;if(!n)throw new Error("No directory handle available");const s=[];for await(const[a,o]of n.entries()){const e="directory"===o.kind;let r,i;if(!e&&t&&t.length>0){const e="."+a.split(".").pop()?.toLowerCase();if(!t.includes(e))continue}if(!e)try{const e=await o.getFile();r=e.size,i=new Date(e.lastModified)}catch{}s.push({name:a,path:`${n.name}/${a}`,isDirectory:e,size:r,modifiedAt:i,handle:o})}return s.sort((e,t)=>e.isDirectory!==t.isDirectory?e.isDirectory?-1:1:e.name.localeCompare(t.name)),s}(t,[]);e=n.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt,source:"filesystem",handle:e.handle}))}}}c(e)}catch(e){p(e instanceof Error?e.message:"Failed to load files")}finally{d(!1)}}},[w,k,x,S]);l.useEffect(()=>{e&&pe()},[e,pe,S]);const he=l.useCallback(async(e,t)=>{se(!0),oe(e),ie(t),Z(!0);try{const t=await async function(e){if(!_C())throw new Error("Not authenticated");const t=await VC(`${PC}/files/${e}/revisions`,{headers:OC()});if(!t.ok){const e=await t.json().catch(()=>({error:"Failed to list revisions"}));throw new Error(e.error||"Failed to list revisions")}return t.json()}(e);te(t.revisions)}catch(n){te([])}finally{se(!1)}},[]),fe=l.useCallback(async e=>{if(ae){se(!0);try{await async function(e,t){if(!_C())throw new Error("Not authenticated");const n=await VC(`${PC}/files/${e}/revisions/${t}/restore`,{method:"POST",headers:OC()});if(!n.ok){const e=await n.json().catch(()=>({error:"Failed to restore revision"}));throw new Error(e.error||"Failed to restore revision")}return n.json()}(ae,e),await pe(),Z(!1),te([]),oe(null)}catch(t){p(t instanceof Error?t.message:"Failed to restore revision")}finally{se(!1)}}},[ae,pe]),ge=async()=>{const e=await async function(){if(!vR())return null;try{const e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return yR=e,e}catch(m){if("AbortError"===m.name)return null;throw m}}();e&&y(!0)},be=async()=>{if(h){d(!0),p(null);try{if("cloud"===h.source&&h.cloudId){const e=await LC(h.cloudId);return n(e.data,e.filename),void t()}if(zj(h.name)){if(!s)throw new Error("Binary file loading not supported");let e;if("filesystem"!==h.source)throw new Error("Cannot read tracker module");if(SC()&&window.electron?.fs&&h.path)e=await window.electron.fs.readFile(h.path);else if(x&&h.path)try{e=await DR(h.path)}catch{if(!h.path||!kR())throw new Error("Cannot read tracker module");e=await SR(h.path)}else if(h.handle){const t=await h.handle.getFile();e=await t.arrayBuffer()}else{if(!h.path||!kR())throw new Error("Cannot read tracker module");e=await SR(h.path)}return await s(e,h.name),void t()}let e;const a=h.name.toLowerCase().endsWith(".xml");if(SC()&&window.electron?.fs&&h.path){const t=await window.electron.fs.readFile(h.path),n=(new TextDecoder).decode(t);e=a?n:JSON.parse(n)}else if(x&&h.path){let t;try{t=await DR(h.path)}catch{if(!h.path||!kR())throw new Error("Cannot read file");t=await SR(h.path)}const n=(new TextDecoder).decode(t);e=a?n:JSON.parse(n)}else if(h.handle){const t=await async function(e){return(await e.getFile()).text()}(h.handle);e=a?t:JSON.parse(t)}else{if(!h.path||!kR())throw new Error("Cannot read file");{const t=await SR(h.path),n=(new TextDecoder).decode(t);e=a?n:JSON.parse(n)}}n(e,h.name),t()}catch(e){p(e instanceof Error?e.message:"Failed to load file")}finally{d(!1)}}},ve=async e=>{if(confirm(`Delete "${e.name}"?`))try{if("cloud"===e.source&&e.cloudId)return await async function(e){if(!_C())throw new Error("Not authenticated");const t=await VC(`${PC}/files/${e}`,{method:"DELETE",headers:OC()});if(!t.ok){const e=await t.json().catch(()=>({error:"Failed to delete file"}));throw new Error(e.error||"Failed to delete file")}return t.json()}(e.cloudId),void pe();const t=xR();t&&await async function(e,t){const n=t||yR;if(!n)throw new Error("No directory handle available");await n.removeEntry(e)}(e.name,t),pe()}catch(t){p(t instanceof Error?t.message:"Failed to delete file")}};l.useEffect(()=>{e&&"modland"===S&&(OR().then(U).catch(()=>{}),VR().then(I).catch(()=>{}),setTimeout(()=>J.current?.focus(),100))},[e,S]);const ye=l.useCallback(async(e,t,n,s)=>{if(e||t){j(!0),z(null);try{const a=await CR({q:e||void 0,format:t||void 0,limit:50,offset:n});A(s?e=>[...e,...a.results]:a.results),q(50===a.results.length),H(n)}catch(a){z(a instanceof Error?a.message:"Search failed")}finally{j(!1)}}else s||A([])},[]);l.useEffect(()=>{if("modland"===S)return Y.current&&clearTimeout(Y.current),Y.current=setTimeout(()=>{ye(P,O,0,!1)},300),()=>{Y.current&&clearTimeout(Y.current)}},[P,O,ye,S]);const xe=l.useCallback(()=>{ye(P,O,G+50,!0)},[P,O,G,ye]),Ne=l.useCallback(async e=>{if(s){$(t=>new Set(t).add(e.full_path)),z(null);try{const[n,a]=await Promise.all([PR(e.full_path),_R(e.full_path)]);if(a){const{UADEEngine:e}=await os(async()=>{const{UADEEngine:e}=await Promise.resolve().then(()=>Si);return{UADEEngine:e}},void 0);await e.getInstance().addCompanionFile(a.filename,a.buffer)}await s(n,e.filename),t()}catch(n){z(n instanceof Error?n.message:"Failed to download")}finally{$(t=>{const n=new Set(t);return n.delete(e.full_path),n})}}},[s,t]);return e?Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:t,children:[Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[800px] max-w-[90vw] h-[600px] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Yn.jsxDEV("h2",{className:"text-lg font-bold text-text-primary",children:"load"===a?"Load Module":"Save Module"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:806,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary","aria-label":"Close",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:814,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:809,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:805,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-shrink-0 flex border-b border-dark-border bg-dark-bgTertiary",children:[Yn.jsxDEV("button",{onClick:()=>{M("demo"),f(null)},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium transition-colors "+("demo"===S?"text-accent-primary border-b-2 border-accent-primary bg-dark-bgSecondary":"text-text-muted hover:text-text-primary"),children:[Yn.jsxDEV(on,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:832,columnNumber:13},void 0),"Demo Files"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:821,columnNumber:11},void 0),de&&me&&Yn.jsxDEV("button",{onClick:()=>{M("cloud"),f(null),E("")},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium transition-colors "+("cloud"===S?"text-accent-primary border-b-2 border-accent-primary bg-dark-bgSecondary":"text-text-muted hover:text-text-primary"),children:[Yn.jsxDEV(Qe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:850,columnNumber:15},void 0),"My Files"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:838,columnNumber:13},void 0),"load"===a&&s&&Yn.jsxDEV("button",{onClick:()=>{M("modland"),f(null)},className:"flex items-center gap-2 px-4 py-2 text-sm font-medium transition-colors "+("modland"===S?"text-green-400 border-b-2 border-green-400 bg-dark-bgSecondary":"text-text-muted hover:text-text-primary"),children:[Yn.jsxDEV(rn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:868,columnNumber:15},void 0),"Modland"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:857,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:874,columnNumber:11},void 0),"load"===a&&Yn.jsxDEV("button",{onClick:async()=>{d(!0),p(null);try{if(vR()){const e=await async function(e){if(!vR())throw new Error("File System Access API not supported");try{return await window.showOpenFilePicker({multiple:e?.multiple??!1,types:e?.types??[{description:"DEViLBOX Modules",accept:{"application/json":[".dbox"]}},{description:"Tracker Modules",accept:{"audio/x-mod":[".mod",".xm",".it",".s3m",".fur"]}}]})}catch(m){if("AbortError"===m.name)return[];throw m}}({multiple:!1,types:[{description:"All Supported Files",accept:{"application/octet-stream":[".dbx",".dbox",".mod",".xm",".it",".s3m",".fur",".mptm",".dmf",".ftm",".sqs",".seq",".mid",".midi"]}}]});if(e.length>0){const a=await e[0].getFile(),o=a.name;if(zj(o)){if(!s)throw new Error("Binary file loading not supported");{const e=await a.arrayBuffer();await s(e,o),t()}}else{const e=await a.text(),s=JSON.parse(e);n(s,o),t()}}}else{const e=document.createElement("input");e.type="file",e.accept=Uj,e.onchange=async e=>{const a=e.target.files?.[0];if(a){const e=a.name;if(zj(e)){if(s){const n=await a.arrayBuffer();await s(n,e),t()}}else{const s=await a.text(),o=JSON.parse(s);n(o,e),t()}}},e.click()}}catch(e){p(e instanceof Error?e.message:"Failed to load file")}finally{d(!1)}},className:"px-4 py-2 text-sm font-medium text-text-muted hover:text-text-primary transition-colors",children:"Browse Files..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:878,columnNumber:13},void 0),!SC()&&"demo"===S&&Yn.jsxDEV("button",{onClick:ge,className:"px-4 py-2 text-sm font-medium text-text-muted hover:text-text-primary transition-colors",children:v?"Filesystem":"Open Folder..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:888,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:819,columnNumber:9},void 0),w&&"demo"===S&&Yn.jsxDEV("div",{className:"flex-shrink-0 px-4 py-2 bg-dark-bgTertiary border-b border-dark-border",children:Yn.jsxDEV("div",{className:"flex items-center gap-1.5 text-xs text-text-muted font-mono truncate",children:[Yn.jsxDEV(rt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:901,columnNumber:15},void 0)," ",w]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:900,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:899,columnNumber:11},void 0),"cloud"===S&&de&&Yn.jsxDEV("div",{className:"flex-shrink-0 px-4 py-2 bg-accent-primary/10 border-b border-dark-border",children:Yn.jsxDEV("div",{className:"flex items-center gap-1.5 text-xs text-accent-primary",children:[Yn.jsxDEV(Qe,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:910,columnNumber:15},void 0)," Your saved files (",C.length,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:909,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:908,columnNumber:11},void 0),"modland"===S&&Yn.jsxDEV("div",{className:"flex-shrink-0 px-4 py-2 bg-dark-bgTertiary border-b border-dark-border flex gap-2 items-center",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 text-xs text-text-muted font-mono",children:["ready"===F?.status&&Yn.jsxDEV("span",{children:[F.totalFiles.toLocaleString()," files"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:920,columnNumber:17},void 0),"indexing"===F?.status&&Yn.jsxDEV("span",{className:"text-amber-400 flex items-center gap-1",children:[Yn.jsxDEV(Ue,{size:10,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:924,columnNumber:19},void 0)," Indexing..."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:923,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:918,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-1 relative",children:[Yn.jsxDEV(Gt,{size:12,className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:929,columnNumber:15},void 0),Yn.jsxDEV("input",{ref:J,value:P,onChange:e=>_(e.target.value),placeholder:"Search modules...",className:"w-full pl-7 pr-2 py-1.5 text-xs font-mono bg-dark-bg border border-dark-borderLight\n                           rounded text-text-primary placeholder:text-text-muted/40\n                           focus:border-green-600 focus:outline-none transition-colors"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:930,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:928,columnNumber:13},void 0),Yn.jsxDEV("select",{value:O,onChange:e=>T(e.target.value),className:"px-2 py-1.5 text-[11px] font-mono bg-dark-bg border border-dark-borderLight\n                         rounded text-text-secondary cursor-pointer hover:bg-dark-bgHover transition-colors",children:[Yn.jsxDEV("option",{value:"",children:"All formats"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:946,columnNumber:15},void 0),B.map(e=>Yn.jsxDEV("option",{value:e.format,children:[e.format," (",e.count.toLocaleString(),")"]},e.format,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:948,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:940,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:917,columnNumber:11},void 0),Yn.jsxDEV("div",{ref:ce,className:"flex-1 min-h-0 overflow-auto p-4",children:[m&&Yn.jsxDEV("div",{className:"bg-red-900/30 border border-red-500 text-red-300 px-4 py-2 rounded mb-4 select-text",children:m},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:959,columnNumber:13},void 0),"modland"===S?Yn.jsxDEV("div",{className:"flex flex-col gap-1",children:[X&&Yn.jsxDEV("div",{className:"flex items-center gap-1.5 text-red-400 text-xs font-mono px-3 py-2 mb-2 bg-red-900/20 rounded border border-red-900/30",children:[Yn.jsxDEV(Le,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:969,columnNumber:19},void 0),X]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:968,columnNumber:17},void 0),0!==L.length||R?Yn.jsxDEV(Yn.Fragment,{children:[L.map(e=>Yn.jsxDEV("div",{className:"flex items-center gap-3 px-3 py-2 bg-dark-bgTertiary rounded border border-transparent\n                                 hover:bg-dark-bgHover hover:border-dark-border transition-colors group",children:[Yn.jsxDEV(Wt,{size:16,className:"text-text-muted flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:992,columnNumber:23},void 0),Yn.jsxDEV("div",{className:"flex-1 min-w-0",children:[Yn.jsxDEV("div",{className:"text-text-primary text-sm font-mono truncate",children:e.filename},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:994,columnNumber:25},void 0),Yn.jsxDEV("div",{className:"flex gap-3 text-xs text-text-muted",children:[Yn.jsxDEV("span",{className:"text-green-400/70",children:e.format},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:998,columnNumber:27},void 0),Yn.jsxDEV("span",{children:e.author},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:999,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:997,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:993,columnNumber:23},void 0),K.has(e.full_path)?Yn.jsxDEV(Ue,{size:14,className:"animate-spin text-green-400 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1004,columnNumber:25},void 0):Yn.jsxDEV("button",{onClick:()=>Ne(e),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium rounded\n                                     bg-green-900/30 text-green-400 border border-green-800/50\n                                     hover:bg-green-800/40 hover:text-green-300 transition-colors\n                                     opacity-0 group-hover:opacity-100 flex-shrink-0",children:[Yn.jsxDEV(Ge,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1013,columnNumber:27},void 0),"Load"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1006,columnNumber:25},void 0)]},e.full_path,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:987,columnNumber:21},void 0)),W&&Yn.jsxDEV("button",{onClick:xe,disabled:R,className:"mt-2 py-2 text-xs font-mono text-text-secondary bg-dark-bgTertiary\n                                 border border-dark-borderLight rounded hover:bg-dark-bgHover\n                                 hover:text-text-primary transition-colors disabled:opacity-50",children:R?Yn.jsxDEV("span",{className:"flex items-center justify-center gap-1",children:[Yn.jsxDEV(Ue,{size:12,className:"animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1030,columnNumber:27},void 0)," Loading..."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1029,columnNumber:25},void 0):"Load more results"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1021,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:985,columnNumber:17},void 0):Yn.jsxDEV("div",{className:"flex flex-col items-center justify-center py-16 text-text-muted",children:[Yn.jsxDEV(rn,{size:32,className:"mb-3 opacity-40"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:976,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-sm font-mono",children:P||O?"No results found":"Search the modland archive"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:977,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted/60 mt-1",children:"165K+ tracker modules from ftp.modland.com"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:980,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:975,columnNumber:17},void 0),R&&0===L.length&&Yn.jsxDEV("div",{className:"flex items-center justify-center py-16",children:Yn.jsxDEV(Ue,{size:20,className:"animate-spin text-green-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1042,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1041,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:966,columnNumber:13},void 0):u?Yn.jsxDEV("div",{className:"flex items-center justify-center py-16 text-text-muted",children:"Loading..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1047,columnNumber:13},void 0):"cloud"!==S||de?0===i.length?Yn.jsxDEV("div",{className:"flex flex-col items-center justify-center py-16 text-text-muted",children:["cloud"===S?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(Qe,{size:48,className:"mb-4 text-text-muted/50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1069,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"mb-2",children:"No saved files yet"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1070,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-sm text-center max-w-md",children:"save"===a?"Enter a filename below and click Save to save your first file.":"Save a project first to see it here."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1071,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1068,columnNumber:17},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("p",{className:"mb-4",children:"No files found"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1079,columnNumber:19},void 0),!SC()&&!x&&!v&&Yn.jsxDEV("button",{onClick:ge,className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Open Folder"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1081,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1078,columnNumber:17},void 0),SC()&&!k&&"demo"===S&&Yn.jsxDEV("button",{onClick:async()=>{if(window.electron?.fs){const e=await window.electron.fs.openDirectory();e&&(D(e),E(e),pe())}},className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Select Folder"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1091,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1066,columnNumber:13},void 0):Yn.jsxDEV("div",{className:"grid grid-cols-1 gap-2",children:[""!==w&&"demo"===S&&Yn.jsxDEV("div",{onClick:()=>{if(SC()&&w){const e=w.split("/").slice(0,-1).join("/")||"/";E(e),D(e)}else if(w){const e=w.split("/").slice(0,-1).join("/")||"";E(e)}f(null)},"data-file-row":!0,className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors bg-dark-bgSecondary hover:bg-dark-bgHover border border-dark-border",children:[Yn.jsxDEV(ln,{size:18,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1129,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex-1",children:Yn.jsxDEV("div",{className:"font-medium text-text-primary",children:".. (back)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1131,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1130,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1112,columnNumber:17},void 0),i.map(e=>Yn.jsxDEV("div",{"data-file-row":!0,onClick:()=>{if(e.isDirectory)return SC()?(E(e.path),D(e.path)):E(e.path),void f(null);const t=Date.now();if(le.current.id===e.id&&t-le.current.time<500)return f(e),"load"===a&&be(),void(le.current={id:"",time:0});le.current={id:e.id,time:t},f(e)},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors "+(h?.id===e.id?"bg-accent-primary/20 border border-accent-primary":"bg-dark-bgTertiary hover:bg-dark-bgHover border border-transparent"),children:[Yn.jsxDEV("div",{className:"text-text-muted flex-shrink-0",children:e.isDirectory?Yn.jsxDEV(cn,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1177,columnNumber:25},void 0):Xj(e.name)?Yn.jsxDEV(Wt,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1179,columnNumber:27},void 0):Yn.jsxDEV(un,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1180,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1175,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex-1 min-w-0",children:[Yn.jsxDEV("div",{className:"font-medium text-text-primary truncate",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1183,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:[e.size?`${(e.size/1024).toFixed(1)} KB`:"",e.modifiedAt&&`  ${e.modifiedAt.toLocaleDateString()}`]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1184,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1182,columnNumber:19},void 0),"cloud"===e.source&&e.cloudId&&Yn.jsxDEV("button",{onClick:t=>{t.stopPropagation(),he(e.cloudId,e.name)},className:"text-text-muted hover:text-accent-primary p-1",title:"Version History","aria-label":"Version History",children:Yn.jsxDEV(tn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1200,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1191,columnNumber:21},void 0),Yn.jsxDEV("button",{onClick:t=>{t.stopPropagation(),ve(e)},className:"text-text-muted hover:text-red-400 p-1",title:"Delete","aria-label":"Delete",children:Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1212,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1203,columnNumber:19},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1136,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1109,columnNumber:13},void 0):Yn.jsxDEV("div",{className:"flex flex-col items-center justify-center py-16 text-text-muted",children:[Yn.jsxDEV(Qe,{size:48,className:"mb-4 text-text-muted/50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1053,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"mb-2 text-lg font-medium",children:"Sign in to save files"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1054,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"mb-4 text-sm text-center max-w-md",children:"Create a free account to save your songs to the cloud and access them from any device."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1055,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>M("demo"),className:"px-4 py-2 text-text-muted hover:text-text-primary",children:"View Demo Files Instead"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1058,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1052,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:957,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-shrink-0 flex items-center gap-4 px-4 py-3 border-t border-dark-border",children:["save"===a&&"modland"!==S&&Yn.jsxDEV("input",{type:"text",value:g,onChange:e=>b(e.target.value),placeholder:"Filename",className:"flex-1 px-3 py-2 bg-dark-bgTertiary border border-dark-border rounded text-text-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1223,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1231,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"px-4 py-2 text-text-muted hover:text-text-primary",children:"modland"===S?"Close":"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1232,columnNumber:11},void 0),"modland"!==S&&Yn.jsxDEV("button",{onClick:"load"===a?be:async()=>{if(o){d(!0),p(null);try{const e=o(),n=g.endsWith(".dbx")?g:`${g}.dbx`;if("cloud"===S&&_C())return await AC(n,e,"songs"),pe(),void t();if(SC()&&window.electron?.fs){const t=`${k||w}/${n}`,s=JSON.stringify(e,null,2),a=(new TextEncoder).encode(s);await window.electron.fs.writeFile(t,a)}else if(x){const t=w?`${w}/${n}`:`songs/${n}`,s=JSON.stringify(e,null,2),a=(new TextEncoder).encode(s);await async function(e,t){const n=e.replace(/^\/+/,""),s=t instanceof ArrayBuffer?new Uint8Array(t):t,a=btoa(String.fromCharCode(...s)),o=await fetch(`${ER}/files/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:a})});if(!o.ok)throw new Error(`Failed to write file: ${o.statusText}`)}(t,a)}else{const t=xR();if(t)await async function(e,t,n){const s=n||yR;if(!s)throw new Error("No directory handle available");const a=await s.getFileHandle(e,{create:!0});return await NR(a,t),a}(n,JSON.stringify(e,null,2),t);else{const t=await async function(e,t){if(!vR())throw new Error("File System Access API not supported");try{return await window.showSaveFilePicker({suggestedName:e,types:t??[{description:"DEViLBOX Module",accept:{"application/json":[".dbox"]}}]})}catch(m){if("AbortError"===m.name)return null;throw m}}(n);t&&await NR(t,JSON.stringify(e,null,2))}}pe(),t()}catch(e){p(e instanceof Error?e.message:"Failed to save file")}finally{d(!1)}}},disabled:"load"===a&&(!h||h.isDirectory),className:"flex items-center gap-2 px-6 py-2 rounded font-medium "+("load"!==a||h&&!h.isDirectory?"bg-accent-primary text-white hover:bg-accent-primaryHover":"bg-dark-bgTertiary text-text-muted cursor-not-allowed"),children:["cloud"===S&&Yn.jsxDEV(Qe,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1248,columnNumber:42},void 0),"load"===a?"Load":"cloud"===S?"Save to Cloud":"Save"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1239,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1221,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:800,columnNumber:7},void 0),Q&&Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[60]",children:Yn.jsxDEV("div",{className:"bg-dark-bgPrimary border border-dark-border rounded-lg w-[400px] h-[500px] max-h-[80vh] flex flex-col",children:[Yn.jsxDEV("div",{className:"flex-shrink-0 flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(tn,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1262,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"font-semibold text-text-primary",children:"Version History"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1263,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1261,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>{Z(!1),te([]),oe(null)},className:"text-text-muted hover:text-text-primary",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1273,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1265,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1260,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-shrink-0 px-4 py-2 bg-dark-bgSecondary border-b border-dark-border",children:[Yn.jsxDEV("span",{className:"text-sm text-text-muted",children:"File: "},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1279,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm text-text-primary font-medium",children:re},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1280,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1278,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-1 min-h-0 overflow-y-auto p-4",children:ne?Yn.jsxDEV("div",{className:"flex items-center justify-center py-8",children:Yn.jsxDEV("div",{className:"animate-spin w-6 h-6 border-2 border-accent-primary border-t-transparent rounded-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1287,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1286,columnNumber:17},void 0):0===ee.length?Yn.jsxDEV("div",{className:"text-center py-8 text-text-muted",children:["No previous versions available.",Yn.jsxDEV("br",{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1292,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-sm",children:"Versions are saved when you update a file."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1293,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1290,columnNumber:17},void 0):Yn.jsxDEV("div",{className:"space-y-2",children:ee.map(e=>Yn.jsxDEV("div",{className:"flex items-center justify-between p-3 bg-dark-bgTertiary rounded border border-dark-border",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("div",{className:"text-text-primary font-medium",children:["Version ",e.revisionNumber]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1303,columnNumber:25},void 0),Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:new Date(e.createdAt).toLocaleString()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1306,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1302,columnNumber:23},void 0),Yn.jsxDEV("button",{onClick:()=>fe(e.revisionNumber),disabled:ne,className:"flex items-center gap-1 px-3 py-1.5 bg-accent-primary/20 text-accent-primary hover:bg-accent-primary/30 rounded text-sm font-medium disabled:opacity-50",children:[Yn.jsxDEV(Ft,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1315,columnNumber:25},void 0),"Restore"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1310,columnNumber:23},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1298,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1296,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1284,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"px-4 py-3 border-t border-dark-border text-xs text-text-muted",children:"Up to 10 versions are kept. Restoring creates a backup of the current version."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1325,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1258,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:1257,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/FileBrowser.tsx",lineNumber:799,columnNumber:5},void 0):null},Hj=Object.freeze(Object.defineProperty({__proto__:null,FileBrowser:Gj,default:Gj},Symbol.toStringTag,{value:"Module"}));var Wj=c();function qj(e,t,n,s,a,o,r,i,l={},c){const u={format:"devilbox-song",version:xV,metadata:e,bpm:t,instruments:n,patterns:s,sequence:a,...o&&Object.keys(o).length>0?{automation:o}:{},...i&&i.length>0?{automationCurves:i}:{},...r&&r.length>0?{masterEffects:r}:{},...c&&"straight"!==c?{grooveTemplateId:c}:{}},d=l.prettify?JSON.stringify(u,null,2):JSON.stringify(u),m=new Blob([d],{type:"application/json"}),p=`${eX(e.name)}.dbx`;Wj.saveAs(m,p)}function Kj(e,t,n,s,a={}){const o={format:"devilbox-sfx",version:xV,name:e,instrument:t,pattern:n,bpm:s},r=a.prettify?JSON.stringify(o,null,2):JSON.stringify(o),i=new Blob([r],{type:"application/json"}),l=`${eX(e)}.sfx.json`;Wj.saveAs(i,l)}function $j(e,t={}){const n={format:"devilbox-instrument",version:xV,instrument:e},s=t.prettify?JSON.stringify(n,null,2):JSON.stringify(n),a=new Blob([s],{type:"application/json"}),o=`${eX(e.name)}.dbi`;Wj.saveAs(a,o)}async function Yj(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-song"!==n.format)throw new Error("Invalid song format");return n}catch(t){return null}}async function Jj(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-sfx"!==n.format)throw new Error("Invalid SFX format");return n}catch(t){return null}}async function Qj(e){try{const t=await e.text(),n=JSON.parse(t);if("devilbox-instrument"!==n.format)throw new Error("Invalid instrument format");return n}catch(t){return null}}async function Zj(e){try{const t=await e.text(),n=JSON.parse(t);return"devilbox-song"===n.format?"song":"devilbox-sfx"===n.format?"sfx":"devilbox-instrument"===n.format?"instrument":"unknown"}catch{return"unknown"}}function eX(e){return e.replace(/[^a-z0-9_-]/gi,"_").replace(/_{2,}/g,"_").toLowerCase()}const tX=Object.freeze(Object.defineProperty({__proto__:null,detectFileFormat:Zj,exportInstrument:$j,exportSFX:Kj,exportSong:qj,importInstrument:Qj,importSFX:Jj,importSong:Yj},Symbol.toStringTag,{value:"Module"}));function nX(e){const t=new Uint8Array(e),n=[];for(let s=0;s<t.length;s+=32768){const e=t.subarray(s,Math.min(s+32768,t.length));n.push(String.fromCharCode.apply(null,e))}return btoa(n.join(""))}function sX(e){const[t,n,,s,a,o]=e;let r=0;t>0&&t<=120?r=Math.max(1,t-12):254!==t&&255!==t||(r=97);return{note:r,instrument:n>0?n:0,volume:a>0?Math.min(16+Math.min(a,64),80):0,effTyp:s,eff:o,effTyp2:0,eff2:0}}function aX(e){const t=e.note,n=e.effectType,s=e.effectParam,a=e.volume,o=e.instrument;let r=0,i=0;if(a>=96){const e=function(e){const t=15&e;switch(e>>4){case 6:return[10,t];case 7:return[10,t<<4];case 8:return[14,176+t];case 9:return[14,160+t];case 11:return[4,t];case 12:return[8,17*t];case 13:return[25,t];case 14:return[25,t<<4];case 15:return[3,t>0?16*t:0];default:return null}}(a);null!==e&&(r=e[0],i=e[1])}return{note:t,instrument:o,volume:a,effTyp:n,eff:s,effTyp2:r,eff2:i}}function oX(e){const t=function(e){if(0===e)return 0;const t=[1712,1616,1525,1440,1357,1281,1209,1141,1077,1017,961,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,75,71,67,63,60,56,53,50,47,45,42,40,37,35,33,31,30,28];let n=0,s=1/0;for(let o=0;o<t.length;o++){const a=Math.abs(t[o]-e);a<s&&(s=a,n=o+1)}const a=n;return Math.min(96,Math.max(1,a))}(e.period),n=e.instrument,s=aL(e.effect,e.effectParam),[a,o]=s?qa(s):[0,0];return{note:t,instrument:n,volume:0,effTyp:a,eff:o,effTyp2:0,eff2:0,period:e.period}}function rX(e){if(!e.patterns||0===e.patterns.length)return[];const t=[],n=e.channels.length;for(let s=0;s<e.patterns.length;s++){const a=e.patterns[s],o=a.rows.length;if(0===o)continue;const r=[];for(let t=0;t<n;t++){const n=e.channels[t]||`Channel ${t+1}`,i=[];let l=null;for(let e=0;e<o;e++){const n=a.rows[e];if(n&&n[t]){const e=sX(n[t]);0!==e.instrument&&(l=e.instrument),i.push(e)}else i.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const c=null!==l&&0!==l?l:1;r.push({id:`import-ch-${s}-${t}-${Date.now()}`,name:n||`Ch ${t+1}`,rows:i,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:c,color:null})}const i=a.name||`Pattern ${s}`;t.push({id:`import-pat-${s}-${Date.now()}`,name:i,length:o,channels:r})}return t}function iX(e){return e.orders?e.orders.map(e=>e.pat):[]}function lX(e){return e.instruments||[]}function cX(e){return e.samples||[]}function uX(e){const t=rX(e),n=iX(e);let s;return s=n.length>0?n.map((e,n)=>{const s=t[e];return s?{...s,id:`import-pos-${n}-pat-${e}-${Date.now()}`,name:`${String(n).padStart(2,"0")}: ${s.name}`,channels:s.channels.map(e=>({...e,id:`${e.id}-pos-${n}`,rows:[...e.rows]}))}:t[0]}):t,{patterns:s,order:n,instrumentNames:lX(e),sampleNames:cX(e),channelCount:e.channels?.length||4}}function dX(e,t,n,s,a){const o=[];for(let u=0;u<e.length;u++){const s=e[u],a=s.length,r=[];for(let e=0;e<t;e++){const t=[];let o=null;for(let n=0;n<a;n++){const a=s[n]?.[e];if(a){const e=aX(a);null!==e.instrument&&(o=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const i=null!==o?o:0;r.push({id:`xm-ch-${u}-${e}-${Date.now()}`,name:n.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:i,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}o.push({id:`xm-pat-${u}-${Date.now()}`,name:`Pattern ${u}`,length:a,channels:r,importMetadata:n})}const r=n.modData?.patternOrderTable||Array.from({length:o.length},(e,t)=>t),i=n.modData?.songLength||r.length,l=r.slice(0,i);let c;return a&&(c={base64:nX(a),format:"XM",sourceFile:n.sourceFile}),{patterns:o,order:l,instrumentNames:s,sampleNames:s,channelCount:t,metadata:n,originalModuleData:c}}function mX(e,t,n,s,a){const o=[];for(let u=0;u<e.length;u++){const s=e[u],a=[];for(let e=0;e<t;e++){const t=[];let o=null;for(let n=0;n<64;n++){const a=s[n]?.[e];if(a){const e=oX(a);null!==e.instrument&&(o=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const r=null!==o?o:0;a.push({id:`mod-ch-${u}-${e}-${Date.now()}`,name:n.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:r,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}o.push({id:`mod-pat-${u}-${Date.now()}`,name:`Pattern ${u}`,length:64,channels:a,importMetadata:n})}const r=n.modData?.patternOrderTable||Array.from({length:o.length},(e,t)=>t),i=n.modData?.songLength||r.length,l=r.slice(0,i);let c;return a&&(c={base64:nX(a),format:"MOD",sourceFile:n.sourceFile}),{patterns:o,order:l,instrumentNames:s,sampleNames:s,channelCount:t,metadata:n,originalModuleData:c}}const pX=Object.freeze(Object.defineProperty({__proto__:null,convertMODModule:mX,convertModule:uX,convertSongToPatterns:rX,convertXMModule:dX,getInstrumentNames:lX,getPatternOrder:iX,getSampleNames:cX},Symbol.toStringTag,{value:"Module"}));let hX=1;function fX(e){return`${e}-${Date.now()}-${hX++}`}const gX=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6b7280"],bX=i()(ds((e,t)=>({tracks:[],clips:[],markers:[],groups:[],automationLanes:[],view:{pixelsPerRow:4,scrollRow:0,scrollY:0,snapDivision:1,followPlayback:!0,loopStart:null,loopEnd:null},tool:"select",isArrangementMode:!1,selectedClipIds:new Set,selectedTrackId:null,drag:null,playbackRow:0,undoStack:[],redoStack:[],addClip:t=>{const n=fX("clip");return e(e=>{e.clips.push({id:n,...t,fadeInRows:t.fadeInRows??0,fadeOutRows:t.fadeOutRows??0,fadeInCurve:t.fadeInCurve??"linear",fadeOutCurve:t.fadeOutCurve??"linear",gain:t.gain??1,transpose:t.transpose??0,reversed:t.reversed??!1,timeStretch:t.timeStretch??1,crossfadeInRows:t.crossfadeInRows??0,crossfadeOutRows:t.crossfadeOutRows??0})}),n},removeClip:t=>e(e=>{e.clips=e.clips.filter(e=>e.id!==t),e.selectedClipIds.delete(t)}),removeClips:t=>e(e=>{const n=new Set(t);e.clips=e.clips.filter(e=>!n.has(e.id));for(const s of t)e.selectedClipIds.delete(s)}),moveClip:(t,n,s)=>e(e=>{const a=e.clips.find(e=>e.id===t);a&&(a.startRow=Math.max(0,n),a.trackId=s)}),moveClips:(t,n,s)=>e(e=>{const a=[...e.tracks].sort((e,t)=>e.index-t.index);for(const o of t){const t=e.clips.find(e=>e.id===o);if(t&&(t.startRow=Math.max(0,t.startRow+n),0!==s)){const n=e.tracks.find(e=>e.id===t.trackId);if(n){const e=a[Math.max(0,Math.min(a.length-1,n.index+s))];e&&(t.trackId=e.id)}}}}),resizeClipStart:(t,n)=>e(e=>{const s=e.clips.find(e=>e.id===t);if(!s)return;const a=Math.max(0,n),o=a-s.startRow;0!==o&&(s.offsetRows=Math.max(0,s.offsetRows+o),s.startRow=a,null!==s.clipLengthRows&&(s.clipLengthRows=Math.max(1,s.clipLengthRows-o)))}),resizeClipEnd:(t,n)=>e(e=>{const s=e.clips.find(e=>e.id===t);if(!s)return;const a=Math.max(1,n-s.startRow);s.clipLengthRows=a}),splitClip:(t,n)=>e(e=>{const s=e.clips.find(e=>e.id===t);if(!s)return;const a=s.startRow+(s.clipLengthRows??64);if(n<=s.startRow||n>=a)return;const o=fX("clip"),r=n-s.startRow;e.clips.push({...s,id:o,startRow:n,offsetRows:s.offsetRows+r,clipLengthRows:null!==s.clipLengthRows?s.clipLengthRows-r:null}),s.clipLengthRows=r}),duplicateClips:t=>{const n=[];return e(e=>{for(const s of t){const t=e.clips.find(e=>e.id===s);if(!t)continue;const a=fX("clip"),o=t.clipLengthRows??64;e.clips.push({...t,id:a,startRow:t.startRow+o}),n.push(a)}}),n},toggleClipMute:t=>e(e=>{const n=e.clips.find(e=>e.id===t);n&&(n.muted=!n.muted)}),setClipColor:(t,n)=>e(e=>{const s=e.clips.find(e=>e.id===t);s&&(s.color=n)}),addTrack:(t,n)=>{const s=fX("track");return e(e=>{const a=e.tracks.length;e.tracks.push({id:s,name:t??`Track ${a+1}`,index:a,color:gX[a%gX.length],volume:100,pan:0,muted:!1,solo:!1,collapsed:!1,height:80,groupId:null,instrumentId:n??null,automationVisible:!1,automationParameter:null,frozen:!1,armRecord:!1})}),s},removeTrack:t=>e(e=>{e.tracks=e.tracks.filter(e=>e.id!==t),e.clips=e.clips.filter(e=>e.trackId!==t),e.automationLanes=e.automationLanes.filter(e=>e.trackId!==t),e.tracks.sort((e,t)=>e.index-t.index).forEach((e,t)=>{e.index=t})}),reorderTrack:(t,n)=>e(e=>{const s=e.tracks.find(e=>e.id===t);if(!s)return;const a=s.index;if(a!==n)for(const o of e.tracks)o.id===t?o.index=n:a<n&&o.index>a&&o.index<=n?o.index--:a>n&&o.index>=n&&o.index<a&&o.index++}),updateTrack:(t,n)=>e(e=>{const s=e.tracks.find(e=>e.id===t);if(!s)return;const{id:a,...o}=n;Object.assign(s,o)}),toggleTrackMute:t=>e(e=>{const n=e.tracks.find(e=>e.id===t);n&&(n.muted=!n.muted)}),toggleTrackSolo:t=>e(e=>{const n=e.tracks.find(e=>e.id===t);n&&(n.solo=!n.solo)}),setTrackHeight:(t,n)=>e(e=>{const s=e.tracks.find(e=>e.id===t);s&&(s.height=Math.max(30,Math.min(200,n)))}),addMarker:t=>{const n=fX("marker");return e(e=>{e.markers.push({...t,id:n})}),n},removeMarker:t=>e(e=>{e.markers=e.markers.filter(e=>e.id!==t)}),moveMarker:(t,n)=>e(e=>{const s=e.markers.find(e=>e.id===t);s&&(s.row=Math.max(0,n))}),updateMarker:(t,n)=>e(e=>{const s=e.markers.find(e=>e.id===t);s&&Object.assign(s,n)}),addGroup:t=>{const n=fX("group");return e(e=>{e.groups.push({id:n,name:t,color:null,collapsed:!1,folded:!1,index:e.groups.length})}),n},removeGroup:t=>e(e=>{e.groups=e.groups.filter(e=>e.id!==t);for(const n of e.tracks)n.groupId===t&&(n.groupId=null)}),assignTrackToGroup:(t,n)=>e(e=>{const s=e.tracks.find(e=>e.id===t);s&&(s.groupId=n)}),toggleGroupCollapse:t=>e(e=>{const n=e.groups.find(e=>e.id===t);n&&(n.collapsed=!n.collapsed)}),toggleGroupFold:t=>e(e=>{const n=e.groups.find(e=>e.id===t);n&&(n.folded=!n.folded)}),selectClip:(t,n=!1)=>e(e=>{n?e.selectedClipIds.add(t):e.selectedClipIds=new Set([t])}),selectClips:t=>e(e=>{e.selectedClipIds=new Set(t)}),clearSelection:()=>e(e=>{e.selectedClipIds=new Set}),selectClipsInRange:(t,n,s)=>e(e=>{const a=Math.min(t,n),o=Math.max(t,n),r=new Set(s),i=new Set;for(const t of e.clips){if(!r.has(t.trackId))continue;const e=t.startRow+(t.clipLengthRows??64);t.startRow<o&&e>a&&i.add(t.id)}e.selectedClipIds=i}),selectAllClipsOnTrack:t=>e(e=>{e.selectedClipIds=new Set(e.clips.filter(e=>e.trackId===t).map(e=>e.id))}),setPixelsPerRow:t=>e(e=>{e.view.pixelsPerRow=Math.max(.5,Math.min(32,t))}),setScrollRow:t=>e(e=>{e.view.scrollRow=Math.max(0,t)}),setScrollY:t=>e(e=>{e.view.scrollY=Math.max(0,t)}),setSnapDivision:t=>e(e=>{e.view.snapDivision=t}),setFollowPlayback:t=>e(e=>{e.view.followPlayback=t}),setLoopRegion:(t,n)=>e(e=>{e.view.loopStart=t,e.view.loopEnd=n}),clearLoopRegion:()=>e(e=>{e.view.loopStart=null,e.view.loopEnd=null}),zoomToFit:()=>e(e=>{const t=xX(e);t<=0||(e.view.pixelsPerRow=Math.max(.5,Math.min(32,800/t)),e.view.scrollRow=0,e.view.scrollY=0)}),setTool:t=>e(e=>{e.tool=t}),setIsArrangementMode:t=>e(e=>{e.isArrangementMode=t}),setDrag:t=>e(e=>{e.drag=t}),setPlaybackRow:t=>e(e=>{e.playbackRow=t}),addAutomationLane:(t,n)=>{const s=fX("autolane");return e(e=>{e.automationLanes.push({id:s,trackId:t,parameter:n,points:[],enabled:!0,visible:!0})}),s},removeAutomationLane:t=>e(e=>{e.automationLanes=e.automationLanes.filter(e=>e.id!==t)}),addAutomationPoint:(t,n)=>e(e=>{const s=e.automationLanes.find(e=>e.id===t);if(!s)return;const a={...n,curve:n.curve??"linear",tension:n.tension??.5},o=s.points.findIndex(e=>e.row>n.row);-1===o?s.points.push(a):s.points.splice(o,0,a)}),removeAutomationPoint:(t,n)=>e(e=>{const s=e.automationLanes.find(e=>e.id===t);s&&n>=0&&n<s.points.length&&s.points.splice(n,1)}),moveAutomationPoint:(t,n,s,a)=>e(e=>{const o=e.automationLanes.find(e=>e.id===t);if(!o||!o.points[n])return;const[r]=o.points.splice(n,1);r.row=Math.max(0,s),r.value=Math.max(0,Math.min(1,a));const i=o.points.findIndex(e=>e.row>r.row);-1===i?o.points.push(r):o.points.splice(i,0,r)}),toggleAutomationLaneVisibility:t=>e(e=>{const n=e.automationLanes.find(e=>e.id===t);n&&(n.visible=!n.visible)}),pushUndo:t=>e(e=>{const n=t??vX(e);e.undoStack.push(n),e.undoStack.length>50&&e.undoStack.shift(),e.redoStack=[]}),undo:()=>e(e=>{if(0===e.undoStack.length)return;const t=vX(e);e.redoStack.push(t);const n=e.undoStack.pop();yX(e,n)}),redo:()=>e(e=>{if(0===e.redoStack.length)return;const t=vX(e);e.undoStack.push(t);const n=e.redoStack.pop();yX(e,n)}),canUndo:()=>t().undoStack.length>0,canRedo:()=>t().redoStack.length>0,importFromPatternOrder:(t,n)=>e(e=>{if(0===n.length||0===t.length)return;const s=n[0]?.channels?.length??1;e.tracks=[];for(let t=0;t<s;t++){const s=n[0].channels[t];e.tracks.push({id:fX("track"),name:s?.name??`Track ${t+1}`,index:t,color:s?.color??gX[t%gX.length],volume:s?.volume??100,pan:s?.pan??0,muted:s?.muted??!1,solo:s?.solo??!1,collapsed:!1,height:80,groupId:null,instrumentId:s?.instrumentId??null,automationVisible:!1,automationParameter:null,frozen:!1,armRecord:!1})}e.clips=[];let a=0;for(const o of t){const t=n[o];if(t){for(let n=0;n<s;n++){const s=e.tracks[n];s&&e.clips.push({id:fX("clip"),patternId:t.id,trackId:s.id,startRow:a,offsetRows:0,clipLengthRows:null,sourceChannelIndex:n,color:null,muted:!1,fadeInRows:0,fadeOutRows:0,fadeInCurve:"linear",fadeOutCurve:"linear",gain:1,transpose:0,reversed:!1,timeStretch:1,crossfadeInRows:0,crossfadeOutRows:0})}a+=t.length}}e.markers=[],e.groups=[],e.automationLanes=[],e.isArrangementMode=!0}),getSnapshot:()=>vX(t()),loadSnapshot:t=>e(e=>{yX(e,t)}),getTotalRows:()=>xX(t()),getClipsForTrack:e=>t().clips.filter(t=>t.trackId===e),getClipEndRow:(e,t)=>{if(null!==e.clipLengthRows)return e.startRow+e.clipLengthRows;const n=t.find(t=>t.id===e.patternId);return e.startRow+(n?.length??64)-e.offsetRows}})));function vX(e){return structuredClone({tracks:e.tracks,clips:e.clips,markers:e.markers,groups:e.groups,automationLanes:e.automationLanes})}function yX(e,t){e.tracks=t.tracks,e.clips=t.clips,e.markers=t.markers,e.groups=t.groups,e.automationLanes=t.automationLanes}function xX(e){let t=0;for(const n of e.clips){const e=n.startRow+(n.clipLengthRows??64);e>t&&(t=e)}return t}const NX="project",wX="revisions",EX="current",kX="undefined"!=typeof window&&window.requestIdleCallback||(e=>setTimeout(()=>e({didTimeout:!1,timeRemaining:()=>50}),1)),DX="undefined"!=typeof window&&window.cancelIdleCallback||(e=>clearTimeout(e)),SX=kX,MX=DX;let CX=null;function VX(){return CX?Promise.resolve(CX):new Promise((e,t)=>{const n=indexedDB.open("devilbox",2);n.onupgradeneeded=()=>{const e=n.result;if(e.objectStoreNames.contains(NX)||e.createObjectStore(NX),!e.objectStoreNames.contains(wX)){e.createObjectStore(wX,{autoIncrement:!0}).createIndex("savedAt","savedAt")}},n.onsuccess=()=>{CX=n.result,CX.onclose=()=>{CX=null},e(CX)},n.onerror=()=>t(n.error)})}function PX(){return VX().then(e=>new Promise((t,n)=>{const s=e.transaction(NX,"readwrite");s.objectStore(NX).delete(EX),s.oncomplete=()=>t(),s.onerror=()=>n(s.error)}))}async function _X(){try{const t=function(){const e=ID.getState(),t=EN.getState(),n=RD.getState(),s=jN.getState(),a=XD.getState(),o=UD.getState(),r=bX.getState();return{version:"1.0.0",schemaVersion:14,savedAt:(new Date).toISOString(),metadata:n.metadata,bpm:s.bpm,patterns:e.patterns,patternOrder:e.patternOrder,instruments:t.instruments.map(e=>{if(e.metadata?.preservedSynth&&e.sample?.url?.startsWith("blob:")){const t={...e};return t.sample={...e.sample,url:""},t}if(e.sample?.audioBuffer||e.metadata?.preservedSample?.audioBuffer||e.metadata?.multiSamples?.some(e=>e.sample?.audioBuffer)){const t={...e};if(t.sample?.audioBuffer&&(t.sample={...t.sample,audioBuffer:void 0}),t.metadata){const e={...t.metadata};e.preservedSample?.audioBuffer&&(e.preservedSample={...e.preservedSample,audioBuffer:void 0}),e.multiSamples&&(e.multiSamples=e.multiSamples.map(e=>e.sample?.audioBuffer?{...e,sample:{...e.sample,audioBuffer:void 0}}:e)),t.metadata=e}return t}return e}),automation:a.curves,masterEffects:o.masterEffects,..."straight"!==s.grooveTemplateId?{grooveTemplateId:s.grooveTemplateId}:{},...r.tracks.length>0?{arrangement:r.getSnapshot()}:{}}}();return await(e=t,VX().then(t=>new Promise((n,s)=>{const a=t.transaction(NX,"readwrite");a.objectStore(NX).put(e,EX),a.oncomplete=()=>n(),a.onerror=()=>s(a.error)}))),function(e){return VX().then(t=>new Promise((n,s)=>{const a=t.transaction(wX,"readwrite");a.objectStore(wX).add(e),a.oncomplete=()=>n(),a.onerror=()=>s(a.error)}))}(t).then(()=>{return e=50,VX().then(t=>new Promise((n,s)=>{const a=t.transaction(wX,"readwrite"),o=a.objectStore(wX),r=o.count();r.onsuccess=()=>{const t=r.result;if(t<=e)return void n();const s=t-e,a=o.openCursor();let i=0;a.onsuccess=()=>{const e=a.result;e&&i<s&&(e.delete(),i++,e.continue())}},a.oncomplete=()=>n(),a.onerror=()=>s(a.error)}));var e}).catch(e=>{}),RD.getState().markAsSaved(),!0}catch(t){return os(async()=>{const{notify:e}=await Promise.resolve().then(()=>Ok);return{notify:e}},void 0).then(({notify:e})=>{e.error("Failed to save project.")}),!1}var e}async function OX(){try{const e=await VX().then(e=>new Promise((t,n)=>{const s=e.transaction(NX,"readonly").objectStore(NX).get(EX);s.onsuccess=()=>t(s.result),s.onerror=()=>n(s.error)}));if(!e)return!1;if(!e.version||!e.patterns||!e.instruments)return!1;if(!e.schemaVersion||e.schemaVersion<14)return await PX().catch(()=>{}),!1;if(fN(e.patterns,e.instruments)){const t=gN(e.patterns,e.instruments);e.patterns=t.patterns,e.instruments=t.instruments}const t=ID.getState(),n=EN.getState(),s=RD.getState(),a=jN.getState(),o=XD.getState(),r=UD.getState();if(t.loadPatterns(e.patterns),e.patternOrder&&e.patternOrder.length>0&&t.setPatternOrder(e.patternOrder),n.loadInstruments(e.instruments),s.setMetadata(e.metadata),a.setBPM(e.bpm),e.automation&&o.loadCurves(e.automation),e.masterEffects&&r.setMasterEffects(e.masterEffects),a.setGrooveTemplate(e.grooveTemplateId||"straight"),e.arrangement){bX.getState().loadSnapshot(e.arrangement)}return n.autoBakeInstruments(),s.markAsSaved(),!0}catch(e){return!1}}async function TX(){try{return await VX().then(e=>new Promise((t,n)=>{const s=e.transaction(NX,"readonly").objectStore(NX).count(EX);s.onsuccess=()=>t(s.result>0),s.onerror=()=>n(s.error)}))}catch{return!1}}async function LX(){try{await PX()}catch{}}async function AX(){try{return await VX().then(e=>new Promise((t,n)=>{const s=e.transaction(wX,"readonly").objectStore(wX).openCursor(null,"prev"),a=[];s.onsuccess=()=>{const e=s.result;if(e){const t=e.value;a.push({key:e.key,savedAt:t.savedAt,name:t.metadata?.name||"Untitled",patternCount:t.patterns?.length||0,instrumentCount:t.instruments?.length||0}),e.continue()}else t(a)},s.onerror=()=>n(s.error)}))}catch(e){return[]}}async function BX(e){try{const t=await function(e){return VX().then(t=>new Promise((n,s)=>{const a=t.transaction(wX,"readonly").objectStore(wX).get(e);a.onsuccess=()=>n(a.result),a.onerror=()=>s(a.error)}))}(e);if(!t)return!1;if(!t.version||!t.patterns||!t.instruments)return!1;if(fN(t.patterns,t.instruments)){const e=gN(t.patterns,t.instruments);t.patterns=e.patterns,t.instruments=e.instruments}const n=ID.getState(),s=EN.getState(),a=RD.getState(),o=jN.getState(),r=XD.getState(),i=UD.getState();if(n.loadPatterns(t.patterns),t.patternOrder&&t.patternOrder.length>0&&n.setPatternOrder(t.patternOrder),s.loadInstruments(t.instruments),a.setMetadata(t.metadata),o.setBPM(t.bpm),t.automation&&r.loadCurves(t.automation),t.masterEffects&&i.setMasterEffects(t.masterEffects),o.setGrooveTemplate(t.grooveTemplateId||"straight"),t.arrangement){bX.getState().loadSnapshot(t.arrangement)}return s.autoBakeInstruments(),a.markAsSaved(),!0}catch(t){return!1}}async function IX(e){try{await function(e){return VX().then(t=>new Promise((n,s)=>{const a=t.transaction(wX,"readwrite");a.objectStore(wX).delete(e),a.oncomplete=()=>n(),a.onerror=()=>s(a.error)}))}(e)}catch(t){}}const FX=({isOpen:e,onClose:t})=>{const[n,s]=l.useState([]),[a,o]=l.useState(!1),[r,i]=l.useState(null),c=l.useCallback(async()=>{o(!0);try{const e=await AX();s(e)}finally{o(!1)}},[]);l.useEffect(()=>{e&&(c(),i(null))},[e,c]);return e?Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999]",children:Yn.jsxDEV("div",{className:"bg-dark-bgPrimary border border-dark-border rounded-lg w-[440px] max-h-[520px] flex flex-col",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(tn,{size:18,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:62,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"font-semibold text-text-primary",children:"Local Revisions"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:63,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:61,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"text-text-muted hover:text-text-primary",children:Yn.jsxDEV(Ce,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:66,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:65,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:60,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4",children:a?Yn.jsxDEV("div",{className:"flex items-center justify-center py-8",children:Yn.jsxDEV("div",{className:"animate-spin w-6 h-6 border-2 border-accent-primary border-t-transparent rounded-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:74,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:73,columnNumber:13},void 0):0===n.length?Yn.jsxDEV("div",{className:"text-center py-8 text-text-muted",children:["No revisions yet.",Yn.jsxDEV("br",{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:79,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-sm",children:"Revisions are created automatically when you save."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:80,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:77,columnNumber:13},void 0):Yn.jsxDEV("div",{className:"space-y-2",children:n.map(e=>Yn.jsxDEV("div",{className:"flex items-center justify-between p-3 bg-dark-bgTertiary rounded border border-dark-border",children:[Yn.jsxDEV("div",{className:"min-w-0 flex-1",children:[Yn.jsxDEV("div",{className:"text-text-primary font-medium truncate",children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:90,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:new Date(e.savedAt).toLocaleString()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:91,columnNumber:21},void 0),Yn.jsxDEV("div",{className:"text-xs text-text-muted",children:[e.patternCount," pattern",1!==e.patternCount?"s":"",", ",e.instrumentCount," instrument",1!==e.instrumentCount?"s":""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:94,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:89,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1 ml-2 flex-shrink-0",children:r===e.key?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:()=>(async e=>{await BX(e)?(_k.success("Revision restored"),t()):_k.error("Failed to restore revision"),i(null)})(e.key),className:"px-2 py-1 bg-amber-500/20 text-amber-400 hover:bg-amber-500/30 rounded text-xs font-medium",children:"Confirm"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:101,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:()=>i(null),className:"px-2 py-1 text-text-muted hover:text-text-primary rounded text-xs",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:107,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:100,columnNumber:23},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:()=>i(e.key),className:"flex items-center gap-1 px-3 py-1.5 bg-accent-primary/20 text-accent-primary hover:bg-accent-primary/30 rounded text-sm font-medium",title:"Restore this revision",children:[Yn.jsxDEV(Ft,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:121,columnNumber:27},void 0),"Restore"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:116,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:()=>(async e=>{await IX(e),s(t=>t.filter(t=>t.key!==e)),_k.success("Revision deleted")})(e.key),className:"p-1.5 text-text-muted hover:text-red-400 rounded",title:"Delete this revision",children:Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:129,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:124,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:115,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:98,columnNumber:19},void 0)]},e.key,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:85,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:83,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:71,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-4 py-3 border-t border-dark-border text-xs text-text-muted",children:"Up to 50 revisions are kept. Restoring overwrites current project state."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:141,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:58,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/RevisionBrowserDialog.tsx",lineNumber:57,columnNumber:5},void 0):null},UX=Object.freeze(Object.defineProperty({__proto__:null,RevisionBrowserDialog:FX},Symbol.toStringTag,{value:"Module"}));function RX(e,t="DB303 Pattern",n=1){const s=(new DOMParser).parseFromString(e,"text/xml"),a=s.querySelector("parsererror");if(a)throw new Error("Invalid XML: "+a.textContent);const o=s.querySelector("db303-pattern");if(!o)throw new Error("Invalid pattern XML: missing db303-pattern element");const r=parseInt(o.getAttribute("numSteps")||"16",10),i=Math.max(1,Math.min(256,isNaN(r)?16:r)),l=parseInt(o.getAttribute("rootNote")||"48",10),c=o.getAttribute("tempo")?parseInt(o.getAttribute("tempo"),10):void 0,u=o.getAttribute("swing")?parseFloat(o.getAttribute("swing")):void 0,d=[];s.querySelectorAll("step").forEach(e=>{const t=parseInt(e.getAttribute("index")||"0",10),n=parseInt(e.getAttribute("key")||"0",10),s=parseInt(e.getAttribute("octave")||"0",10),a="true"===e.getAttribute("gate"),o="true"===e.getAttribute("accent"),r="true"===e.getAttribute("slide"),i="true"===e.getAttribute("mute"),l="true"===e.getAttribute("hammer");d.push({index:t,key:n,octave:s,gate:a,accent:o,slide:r,mute:i,hammer:l})}),d.sort((e,t)=>e.index-t.index);const m=new Map(d.map(e=>[e.index,e])),p=[];let h=-1;for(let f=0;f<i;f++){const e=m.get(f);if(e){let t=0;if(e.gate){t=l+e.key+12*e.octave-11,t=Math.max(1,Math.min(96,t)),h=f}else h>=0&&(t=97);p.push({note:t,instrument:e.gate?n:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:e.mute?3:e.hammer?4:void 0,flag2:e.slide?2:!e.hammer||e.accent||e.mute?void 0:4})}else p.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}return{pattern:{id:`db303-${Date.now()}`,name:t,length:i,channels:[{id:"ch-1",name:"TB-303",rows:p,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:"#22c55e"}]},tempo:c,swing:u}}function jX(e,t=120,n=0,s=48){const a=[];a.push('<?xml version="1.0" encoding="UTF-8"?>');const o=e.channels?.[0];if(!o)throw new Error("Pattern has no channels to export");const r=Math.min(e.length,32),i=n>0?` swing="${n.toFixed(2)}"`:"";a.push(`<db303-pattern version="1.0" numSteps="${r}" tempo="${Math.round(t)}"${i} rootNote="${s}">`);for(let l=0;l<r;l++){const e=o?.rows[l];if(!e){a.push(`  <step index="${l}" key="0" octave="0" gate="false" accent="false" slide="false" mute="false" hammer="false"/>`);continue}const t=e.note>0&&e.note<=96,n=t,r=1===e.flag1||1===e.flag2,i=2===e.flag1||2===e.flag2,c=3===e.flag1||3===e.flag2,u=4===e.flag1||4===e.flag2;let d=0,m=0;if(t){const t=e.note+11-s;m=Math.floor(t/12),d=(t%12+12)%12,m=Math.max(-1,Math.min(1,m))}a.push(`  <step index="${l}" key="${d}" octave="${m}" gate="${n}" accent="${r}" slide="${i}" mute="${c}" hammer="${u}"/>`)}return a.push("</db303-pattern>"),a.join("\n")}function XX(e,t="pattern",n=120,s=0,a=48){const o=jX(e,n,s,a),r=new Blob([o],{type:"application/xml"}),i=URL.createObjectURL(r),l=document.createElement("a");l.href=i,l.download=`${t}.xml`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}async function zX(e=0,t){const{useTrackerStore:n}=await os(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>FD);return{useTrackerStore:e}},void 0),{useTransportStore:s}=await os(async()=>{const{useTransportStore:e}=await Promise.resolve().then(()=>XN);return{useTransportStore:e}},void 0),a=n.getState(),o=s.getState(),r=a.patterns,i=a.currentPatternIndex;if(!r||0===r.length)return;const l=r[i];if(!l)return;let c=l;e>0&&l.channels[e]&&(c={...l,channels:[l.channels[e]]});const u=o.bpm||120,d=o.swing||0;XX(c,t||l.name?.replace(/[^a-zA-Z0-9-_]/g,"_")||"pattern",u,d,48)}if("undefined"!=typeof window){const e=window;e.exportCurrentPatternToDb303=zX,e.convertToDb303Pattern=jX,e.downloadDb303Pattern=XX}const GX=Object.freeze(Object.defineProperty({__proto__:null,convertToDb303Pattern:jX,downloadDb303Pattern:XX,exportCurrentPatternToDb303:zX,parseDb303Pattern:RX},Symbol.toStringTag,{value:"Module"})),HX=[".json",".dbx",".xml",".mid",".midi",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".j2b",".m15",".mdl",".mt2",".mtm",".psm",".pt36",".ptm",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".hvl",".ahx",".okt",".med",".mmd0",".mmd1",".mmd2",".mmd3",".digi",".fc",".fc13",".fc14",".sfc",".fc2",".fc3",".fc4",".smod",".hip",".hip7",".sog",".s7g",".hipc",".hst",".soc",".coso",".tfmx",".mdat",".tfmxpro",".tfmx1.5",".tfmx7v",".tfhd1.5",".tfhd7v",".tfhdpro",".fred",".gray",".sm",".sm1",".sm2",".sm3",".smpro",".bd",".bds",".dw",".dwold",".mc",".mcr",".mco",".jp",".jpn",".jpnd",".rj",".rjp",".dm",".dm1",".dm2",".dlm1",".dlm2",".sa",".sa-p",".sa_old",".sonic",".lion",".abk",".aam",".aon",".aon4",".aon8",".adpcm",".adsc",".mod_adsc4",".bss",".bfc",".bsi",".core",".cin",".dl",".dl_deli",".dln",".ea",".mg",".fp",".fw",".gmc",".gm",".glue",".hd",".ims",".jam",".jc",".kris",".kh",".lme",".ma",".max",".mdst",".mkii",".mk2",".mkiio",".ntp",".osp",".ps",".psf",".pt",".ptm",".puma",".rh",".rhp",".rho",".riff",".sas",".sb",".scr",".sdr",".sg",".snk",".ss",".st26",".sun",".syn",".dh",".uds",".octamed",".tpu",".tcb",".ufo",".mus",".wn",".wb",".ym",".ymst",".sid",".sid1",".sid2",".smn",".bp",".bp3",".sndmon",".sfx",".sfx13",".sfx20",".mms",".smus",".snx",".agi",".vss",".ml",".sng",".qpa",".qts",".sqt",".ash",".aps",".ast",".alp",".amc",".dsc",".dsr",".dss",".dns",".dmu",".dmu2",".ems",".emsv6",".emod",".jmf",".jo",".js",".jb",".jcb",".jcbo",".jd",".jt",".kim",".mon",".mon_old",".mfp",".mosh",".mmdc",".mug",".mug2",".mm4",".mm8",".psa",".prt",".pn",".pap",".pvp",".pat",".sc",".sct",".scn",".scumm",".sjs",".spl",".syn",".synmod",".tf",".thm",".tmk",".tme",".dp",".trc",".tro",".tronic",".dat",".dum",".doda",".dz",".ex",".cm",".cus",".cust",".custom",".hot",".bye",".one",".two",".avp",".mw",".md",".mok",".tiny",".sdata",".npp",".is",".is20",".jpo",".jpold",".powt",".hn",".mtp2",".thn",".arp",".tits",".mcmd",".mcmd_org",".ac1",".ac1d",".aval",".chan",".cp",".cplx",".crb",".di",".eu",".fc-m",".fcm",".ft",".fuz",".fuzz",".gv",".hmc",".hrt",".ice",".it1",".kef",".kef7",".krs",".ksm",".lax",".mexxmp",".mpro",".np",".np1",".np2",".np3",".nr",".nru",".ntpk",".p10",".p21",".p30",".p40a",".p40b",".p41a",".p4x",".p50a",".p5a",".p5x",".p60",".p60a",".p61",".p61a",".p6x",".pha",".pin",".pm",".pm0",".pm01",".pm1",".pm10c",".pm18a",".pm2",".pm20",".pm4",".pm40",".pmz",".polk",".pp10",".pp20",".pp21",".pp30",".ppk",".pr1",".pr2",".prom",".pru",".pru1",".pru2",".prun",".prun1",".prun2",".pwr",".pyg",".pygm",".pygmy",".skt",".skyt",".snt",".st",".st2",".st30",".star",".stpk",".tp",".tp1",".tp2",".tp3",".un2",".unic",".unic2",".wn",".xan",".xann",".zen",".mod_doc",".mod15",".mod15_mst",".mod_ntk",".mod_ntk1",".mod_ntk2",".mod_ntkamp",".mod_flt4",".mod_comp",".mod15_ust",".mod15_st-iv",".mod3",".gt2",".gtk",".dsym",".cba",".act",".c67",".667",".fmt",".dtm",".etx",".is10",".plm",".qc",".rk",".rkb",".rtm",".tfx",".uax",".xmf",".mxtx",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".vgm",".vgz",".nsf",".nsfe",".sap",".ay",".mid",".midi"].join(",");const WX=a.memo(({onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstruments:s,onShowPatternOrder:o,onShowDrumpads:r,showMasterFX:i})=>{const{patterns:c,currentPatternIndex:u,setCurrentPattern:d,resizePattern:m,loadPatterns:p,setPatternOrder:h,patternOrder:f,currentPositionIndex:g,setCurrentPosition:b,editStep:v,setEditStep:y,reset:x,duplicatePosition:N,removeFromOrder:w}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,setCurrentPattern:e.setCurrentPattern,resizePattern:e.resizePattern,loadPatterns:e.loadPatterns,setPatternOrder:e.setPatternOrder,patternOrder:e.patternOrder,currentPositionIndex:e.currentPositionIndex,setCurrentPosition:e.setCurrentPosition,editStep:e.editStep,setEditStep:e.setEditStep,reset:e.reset,duplicatePosition:e.duplicatePosition,removeFromOrder:e.removeFromOrder}))),{isPlaying:E,isLooping:k,bpm:D,setBPM:S,speed:M,setSpeed:C,setIsLooping:V,play:P,stop:_,setCurrentRow:O,grooveTemplateId:T,setGrooveTemplate:L,swing:B,jitter:I,useMpcScale:F,reset:U}=jN(us(e=>({isPlaying:e.isPlaying,isLooping:e.isLooping,bpm:e.bpm,setBPM:e.setBPM,speed:e.speed,setSpeed:e.setSpeed,setIsLooping:e.setIsLooping,play:e.play,stop:e.stop,setCurrentRow:e.setCurrentRow,grooveTemplateId:e.grooveTemplateId,setGrooveTemplate:e.setGrooveTemplate,swing:e.swing,jitter:e.jitter,useMpcScale:e.useMpcScale,reset:e.reset}))),{isDirty:R,setMetadata:j,metadata:X}=RD(us(e=>({isDirty:e.isDirty,setMetadata:e.setMetadata,metadata:e.metadata}))),{instruments:z,loadInstruments:G,updateInstrument:H,addInstrument:W,reset:q}=EN(us(e=>({instruments:e.instruments,loadInstruments:e.loadInstruments,updateInstrument:e.updateInstrument,addInstrument:e.addInstrument,reset:e.reset}))),{masterEffects:K}=UD(us(e=>({masterEffects:e.masterEffects}))),{oscilloscopeVisible:$,compactToolbar:Y}=LN(us(e=>({oscilloscopeVisible:e.oscilloscopeVisible,compactToolbar:e.compactToolbar}))),{curves:J,reset:Q}=XD(us(e=>({curves:e.curves,reset:e.reset}))),Z=qD(e=>e.addTab),ee=Bw(),te=l.useRef(null),[ne,se]=l.useState(!1),[ae,oe]=l.useState("logo"),{tap:re,tapCount:ie,isActive:le}=BU(S),[ce,ue]=l.useState(!1),[de,me]=l.useState(!1),[pe,he]=l.useState(!1),[fe,ge]=l.useState(!1),[be,ve]=l.useState(null),[ye,xe]=l.useState(!1),[Ne,we]=l.useState(!1),[Ee,ke]=l.useState(!1),[De,Se]=l.useState(!!document.fullscreenElement),Me=l.useCallback(()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf("logo")+1)%e.length;oe(e[t])},[]);a.useEffect(()=>{const e=()=>{Se(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),a.useEffect(()=>{},[]);const Ce=l.useRef(null);a.useEffect(()=>{if(!ce)return;const e=e=>{ce&&Ce.current&&!Ce.current.contains(e.target)&&ue(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[ce]);const Ve=()=>{try{const e=c.map(e=>e.id),t={};c.forEach(e=>{e.channels.forEach((n,s)=>{const a=J.filter(t=>t.patternId===e.id&&t.channelIndex===s);a.length>0&&(t[e.id]||(t[e.id]={}),t[e.id][s]=a.reduce((e,t)=>(e[t.parameter]=t,e),{}))})}),qj(X,D,z,c,e,Object.keys(t).length>0?t:void 0,K.length>0?K:void 0,J.length>0?J:void 0,{prettify:!0},T),_k.success("Song downloaded!",2e3)}catch(e){_k.error("Failed to download file")}},Pe=c[u],_e=Pe?.length||64,Oe=f.length,Te=e=>{const t=f.length;if(e>t){const n=[...f];for(let s=t;s<e;s++)n.push(f[f.length-1]??0);h(n)}else if(e<t&&e>=1){const t=f.slice(0,e);h(t),g>=e&&b(e-1)}},Le=E&&!k,Ae=E&&k;return Yn.jsxDEV("div",{className:"ft2-toolbar",children:[Yn.jsxDEV("div",{className:"flex flex-1 min-w-0 overflow-hidden justify-between",children:[Yn.jsxDEV("div",{className:"flex-shrink min-w-0",children:[Yn.jsxDEV("div",{className:"ft2-toolbar-row",children:[Yn.jsxDEV("div",{className:"ft2-section ft2-col-1",children:[Yn.jsxDEV(AU,{label:"Position",value:g,onChange:e=>{b(e)},min:0,max:f.length-1},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:668,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex gap-1 ml-auto",children:[Yn.jsxDEV(TV,{variant:le?"primary":"default",size:"sm",onClick:re,title:`Tap Tempo (${ie} taps)`,className:"min-w-[32px]",children:Yn.jsxDEV(dn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:677,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:670,columnNumber:17},void 0),Yn.jsxDEV(TV,{variant:"default",size:"sm",onClick:()=>N(g),className:"min-w-[32px]",children:"Ins"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:679,columnNumber:17},void 0),Yn.jsxDEV(TV,{variant:"default",size:"sm",onClick:()=>{f.length>1&&w(g)},disabled:f.length<=1,className:"min-w-[32px]",children:"Del"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:680,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:669,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:667,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"ft2-section ft2-col-2",children:Yn.jsxDEV(AU,{label:"BPM",value:D,onChange:S,min:32,max:255,throttleMs:50},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:684,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:683,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"ft2-section ft2-col-3",children:Yn.jsxDEV(AU,{label:"Pattern",value:f[g]??u,onChange:e=>{const t=[...f];t[g]=e,h(t),d(e)},min:0,max:c.length-1},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:694,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:693,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"ft2-section ft2-col-4",children:Yn.jsxDEV(AU,{label:"Edit Step",value:v,onChange:y,min:0,max:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:697,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:696,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"ft2-section ft2-section-playback",children:[Yn.jsxDEV(TV,{variant:Le?"danger":"primary",size:"sm",onClick:e=>{Le&&e.shiftKey?(e.preventDefault(),UP().triggerPowerCut()):(async()=>{if(A(),E)return pD().stop(),_(),void ee.releaseAll();V(!1),O(0),await ee.init(),await P()})()},onContextMenu:e=>{Le&&(e.preventDefault(),UP().triggerPowerCut())},title:Le?"Click: Stop  Shift+click/Right-click: Power off":"Play Song",className:"min-w-[72px]",children:Le?"Stop Song":"Play Song"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:700,columnNumber:15},void 0),Yn.jsxDEV(TV,{variant:Ae?"danger":"primary",size:"sm",onClick:e=>{Ae&&e.shiftKey?(e.preventDefault(),UP().triggerPowerCut()):(async()=>{A(),E&&k?(pD().stop(),_(),ee.releaseAll()):(E&&(pD().stop(),_(),ee.releaseAll()),V(!0),O(0),await ee.init(),await P())})()},onContextMenu:e=>{Ae&&(e.preventDefault(),UP().triggerPowerCut())},title:Ae?"Click: Stop  Shift+click/Right-click: Power off":"Play Pattern",className:"min-w-[88px]",children:Ae?"Stop Pattern":"Play Pattern"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:707,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:699,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:666,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"ft2-toolbar-row",children:[Yn.jsxDEV("div",{className:"ft2-section ft2-col-1",children:Yn.jsxDEV(AU,{label:"Song Len",value:Oe,onChange:Te,min:1,max:256},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:719,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:718,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"ft2-section ft2-col-2",children:[Yn.jsxDEV(AU,{label:"Speed",value:M,onChange:C,min:1,max:31},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:722,columnNumber:17},void 0),Yn.jsxDEV(TV,{variant:"default",size:"sm",onClick:()=>me(!0),title:`Groove & Swing Settings (Current: ${Ba.find(e=>e.id===T)?.name||"None"})`,className:"min-w-[32px] ml-1 "+("straight"!==T||B!==(F?50:100)||I>0?"text-accent-primary font-bold shadow-glow-sm border-accent-primary/50":""),children:"Groove"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:723,columnNumber:17},void 0),de&&Yn.jsxDEV(gR,{onClose:()=>me(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:732,columnNumber:40},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:721,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"ft2-section ft2-col-3",children:Yn.jsxDEV(AU,{label:"Length",value:_e,onChange:e=>{e>=1&&e<=256&&m(u,e)},min:1,max:256,presets:[{label:"16 rows",value:16},{label:"32 rows",value:32},{label:"48 rows",value:48},{label:"64 rows (default)",value:64},{label:"96 rows",value:96},{label:"128 rows",value:128},{label:"192 rows",value:192},{label:"256 rows (max)",value:256}]},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:735,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:734,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"ft2-section ft2-col-4",children:Yn.jsxDEV(AU,{label:"Song Len",value:Oe,onChange:Te,min:1,max:256},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:754,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:753,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:717,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:665,columnNumber:9},void 0),Yn.jsxDEV(RU,{variant:"compact",className:"min-w-[120px] max-w-[350px] flex-shrink-0 border-l border-dark-border cursor-pointer group ml-auto",style:{display:"flex",alignItems:"stretch",justifyContent:"center"},children:Yn.jsxDEV("div",{className:"relative w-full h-full flex items-center justify-center",onClick:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll","amLED","amBars","amMirror","amRadial","amGraph","amRadialGraph","amDualStereo","amLumi","amAlpha","amOutline","amDualV","amDualOverlay","amBark","amMel","amOctave","amNotes","amMirrorReflex","amRadialInvert","amRadialLED","amLinear","amAWeight","amLumiMirror"],t=(e.indexOf(ae)+1)%e.length;oe(e[t])},children:[Yn.jsxDEV("button",{onClick:e=>{e.stopPropagation();LN.getState().oscilloscopePoppedOut?FU("DEViLBOX  Visualizer"):LN.getState().setOscilloscopePoppedOut(!0)},className:"absolute top-1 right-1 p-0.5 rounded text-text-muted/0 group-hover:text-text-muted hover:!text-cyan-400 transition-all z-10",title:"Pop out visualizer",children:Yn.jsxDEV(He,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:780,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:767,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"absolute bottom-1 right-2 text-[9px] font-mono text-text-muted opacity-40 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:["v",yV]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:783,columnNumber:11},void 0),$&&Yn.jsxDEV(Yn.Fragment,{children:[("waveform"===ae||"spectrum"===ae)&&Yn.jsxDEV(jU,{width:"auto",height:Y?70:100,mode:ae},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:789,columnNumber:70},void 0),"channels"===ae&&Yn.jsxDEV(XU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:790,columnNumber:42},void 0),"logo"===ae&&Yn.jsxDEV(zU,{height:Y?70:100,onComplete:Me},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:791,columnNumber:38},void 0),"circular"===ae&&Yn.jsxDEV(GU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:792,columnNumber:42},void 0),"bars"===ae&&Yn.jsxDEV(HU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:793,columnNumber:38},void 0),"particles"===ae&&Yn.jsxDEV(WU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:794,columnNumber:43},void 0),"chanWaves"===ae&&Yn.jsxDEV(qU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:795,columnNumber:43},void 0),"chanActivity"===ae&&Yn.jsxDEV(KU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:796,columnNumber:46},void 0),"chanSpectrum"===ae&&Yn.jsxDEV($U,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:797,columnNumber:46},void 0),"chanCircular"===ae&&Yn.jsxDEV(YU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:798,columnNumber:46},void 0),"chanParticles"===ae&&Yn.jsxDEV(JU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:799,columnNumber:47},void 0),"chanRings"===ae&&Yn.jsxDEV(QU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:800,columnNumber:43},void 0),"chanTunnel"===ae&&Yn.jsxDEV(ZU,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:801,columnNumber:44},void 0),"chanRadar"===ae&&Yn.jsxDEV(eR,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:802,columnNumber:43},void 0),"chanNibbles"===ae&&Yn.jsxDEV(cR,{height:Y?70:100,onExit:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll","amLED","amBars","amMirror","amRadial","amGraph","amRadialGraph","amDualStereo","amLumi","amAlpha","amOutline","amDualV","amDualOverlay","amBark","amMel","amOctave","amNotes","amMirrorReflex","amRadialInvert","amRadialLED","amLinear","amAWeight","amLumiMirror"],t=(e.indexOf("chanNibbles")+1)%e.length;oe(e[t])}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:804,columnNumber:17},void 0),"sineScroll"===ae&&Yn.jsxDEV(uR,{height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:814,columnNumber:44},void 0),"amLED"===ae&&Yn.jsxDEV(vO,{preset:"ledBars",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:815,columnNumber:39},void 0),"amBars"===ae&&Yn.jsxDEV(vO,{preset:"smoothBars",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:816,columnNumber:40},void 0),"amMirror"===ae&&Yn.jsxDEV(vO,{preset:"mirrorBars",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:817,columnNumber:42},void 0),"amRadial"===ae&&Yn.jsxDEV(vO,{preset:"radialSpectrum",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:818,columnNumber:42},void 0),"amGraph"===ae&&Yn.jsxDEV(vO,{preset:"graphLine",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:819,columnNumber:41},void 0),"amRadialGraph"===ae&&Yn.jsxDEV(vO,{preset:"radialGraph",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:820,columnNumber:47},void 0),"amDualStereo"===ae&&Yn.jsxDEV(vO,{preset:"dualStereo",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:821,columnNumber:46},void 0),"amLumi"===ae&&Yn.jsxDEV(vO,{preset:"lumiBars",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:822,columnNumber:40},void 0),"amAlpha"===ae&&Yn.jsxDEV(vO,{preset:"alphaBars",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:823,columnNumber:41},void 0),"amOutline"===ae&&Yn.jsxDEV(vO,{preset:"outlineBars",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:824,columnNumber:43},void 0),"amDualV"===ae&&Yn.jsxDEV(vO,{preset:"dualVertical",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:825,columnNumber:41},void 0),"amDualOverlay"===ae&&Yn.jsxDEV(vO,{preset:"dualOverlay",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:826,columnNumber:47},void 0),"amBark"===ae&&Yn.jsxDEV(vO,{preset:"barkSpectrum",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:827,columnNumber:40},void 0),"amMel"===ae&&Yn.jsxDEV(vO,{preset:"melGraph",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:828,columnNumber:39},void 0),"amOctave"===ae&&Yn.jsxDEV(vO,{preset:"octaveBands",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:829,columnNumber:42},void 0),"amNotes"===ae&&Yn.jsxDEV(vO,{preset:"noteLabels",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:830,columnNumber:41},void 0),"amMirrorReflex"===ae&&Yn.jsxDEV(vO,{preset:"mirrorReflex",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:831,columnNumber:48},void 0),"amRadialInvert"===ae&&Yn.jsxDEV(vO,{preset:"radialInvert",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:832,columnNumber:48},void 0),"amRadialLED"===ae&&Yn.jsxDEV(vO,{preset:"radialLED",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:833,columnNumber:45},void 0),"amLinear"===ae&&Yn.jsxDEV(vO,{preset:"linearBars",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:834,columnNumber:42},void 0),"amAWeight"===ae&&Yn.jsxDEV(vO,{preset:"aWeighted",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:835,columnNumber:43},void 0),"amLumiMirror"===ae&&Yn.jsxDEV(vO,{preset:"lumiMirror",audioSource:"master",height:Y?70:100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:836,columnNumber:46},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:788,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:760,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:759,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:664,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1.5 py-1 w-full overflow-x-auto no-scrollbar",children:[Yn.jsxDEV("input",{ref:te,type:"file",accept:HX,onChange:async e=>{const t=e.target.files?.[0];if(t){if(e.target.value="",ZI(t.name))return ve(t),void ge(!0);E&&(_(),ee.releaseAll()),se(!0);try{if(t.name.toLowerCase().endsWith(".xml")){const e=await t.text(),n=t.name.replace(".xml","")||"Imported Pattern",{pattern:s}=RX(e,n),a=[...c,s];return p(a),d(a.length-1),_k.success(`Loaded DB303 pattern: ${s.name}`),void se(!1)}if(Bj(t.name)){const e=await _j(t,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64});Q(),U(),q(),ee.disposeAllInstruments(),p(e.patterns),e.instruments.length>0&&G(e.instruments),h(e.patterns.map((e,t)=>t)),d(0),j({name:e.metadata.name,author:"",description:`Imported from ${t.name} (${e.metadata.tracks} tracks)`}),S(e.bpm),_k.success(`Imported: ${e.metadata.name}  ${e.instruments.length} instrument(s), BPM: ${e.bpm}`)}else{const e=await Yj(t);if(!e)return void _k.error("Failed to import song");const{needsMigration:n,migrateProject:s}=await os(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>bN);return{needsMigration:e,migrateProject:t}},void 0);let a=e.patterns,o=e.instruments;if(n(a,o)){const e=s(a,o);a=e.patterns,o=e.instruments}if(p(a),e.sequence&&Array.isArray(e.sequence)){const t=new Map(a.map((e,t)=>[e.id,t])),n=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);n.length>0&&h(n)}o&&G(o),e.masterEffects&&UD.getState().setMasterEffects(e.masterEffects),S(e.bpm),j(e.metadata),L(e.grooveTemplateId||"straight"),_k.success(`Loaded: ${e.metadata?.name||t.name}`)}}catch(n){_k.error(`Failed to load ${t.name}`)}finally{se(!1)}}},className:"hidden"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:844,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>xe(!0),disabled:ne,loading:ne,children:"Load"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:845,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:Ve,children:R?"Save*":"Save"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:846,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>ke(!0),children:"Revisions"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:847,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:Ve,children:"Download"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:848,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:e,children:"Export"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:849,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>Z(),icon:Yn.jsxDEV(lt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:850,columnNumber:74},void 0),iconPosition:"left",children:"New"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:850,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>we(!0),children:"Clear"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:851,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:o,children:"Order"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:852,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:s,children:"Instruments"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:853,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:r,children:"Pads"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:854,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:i?"primary":"ghost",size:"sm",onClick:n,children:"Master FX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:855,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>t?.("chip-effects"),children:"Reference"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:857,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>t?.("shortcuts"),children:"Help"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:858,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>he(!0),children:"Settings"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:859,columnNumber:9},void 0),Yn.jsxDEV(TV,{variant:De?"primary":"ghost",size:"sm",onClick:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},title:De?"Exit Fullscreen (F11)":"Enter Fullscreen (F11)",children:De?Yn.jsxDEV(xt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:866,columnNumber:27},void 0):Yn.jsxDEV(yt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:866,columnNumber:53},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:860,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:843,columnNumber:7},void 0),pe&&Yn.jsxDEV(hR,{onClose:()=>he(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:870,columnNumber:24},void 0),Yn.jsxDEV(FX,{isOpen:Ee,onClose:()=>ke(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:871,columnNumber:7},void 0),Yn.jsxDEV(SF,{isOpen:fe,onClose:()=>{ge(!1),ve(null)},onImport:async(e,t={useLibopenmpt:!0})=>{E&&_(),ee.releaseAll(),Q(),U(),q(),ee.disposeAllInstruments(),se(!0);try{let n,s;if(e.nativeData?.patterns){const{format:t,patterns:s,importMetadata:a,instruments:o}=e.nativeData,r=a.originalChannelCount,i=o?.map(e=>e.name)||[];if("XM"===t)n=dX(s,r,a,i,e.arrayBuffer);else if("MOD"===t)n=mX(s,r,a,i,e.arrayBuffer);else{if("FUR"!==t&&"DMF"!==t)return void _k.error(`Unsupported native format: ${t}`);{const e=a.modData?.patternOrderTable||[],t=s[0]?.length||64,o=a.originalChannelCount||s[0]?.[0]?.length||4;n={patterns:s.map((e,n)=>({id:`pattern-${n}`,name:`Pattern ${n}`,length:t,importMetadata:a,channels:Array.from({length:o},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[n]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0}})}))})),order:e.length>0?e:[0],instrumentNames:i}}}}else{if(!e.metadata.song){const{parseModuleToSong:n}=await os(async()=>{const{parseModuleToSong:e}=await import("./parseModuleToSong-BCo4MrbT.js").then(e=>e.b);return{parseModuleToSong:e}},[]),s=e.file||new File([e.arrayBuffer],e.metadata.title||"track"),a=await n(s,t.subsong??0,t.uadeMetadata);return G(a.instruments),p(a.patterns),d(0),a.songPositions.length>0&&h(a.songPositions),S(a.initialBPM),C(a.initialSpeed),j({name:a.name,author:"",description:`Imported from ${e.metadata.title||"module"}`}),ID.getState().applyEditorMode(a),await ee.preloadInstruments(a.instruments),void _k.success(`Imported: ${a.name}  ${a.instruments.length} instrument(s)`,3e3)}n=uX(e.metadata.song)}if(e.nativeData?.instruments){const t=e.nativeData.instruments,n=e.nativeData.format;let a=1;s=[];for(const e of t){const t=FT(e,a,n);s.push(...t),a+=t.length}}else s=function(e,t){const n=new Set;for(const o of e)for(const e of o.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&n.add(t.instrument);const s=[],a=["sawtooth","square","triangle","sine"];for(const o of Array.from(n).sort((e,t)=>e-t)){const e=t[o-1]||`Instrument ${o}`;{const t=a[(o-1)%a.length];s.push({id:o,name:e.trim()||`Instrument ${o}`,type:"synth",synthType:"Synth",oscillator:{..._a,type:t},envelope:{...Oa},filter:{...Ta},effects:[],volume:-6,pan:0})}}for(const o of[0,1])n.has(o)||s.push({id:o,name:0===o?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{..._a,type:"sawtooth"},envelope:{...Oa},filter:{...Ta},effects:[],volume:-6,pan:0});return s.sort((e,t)=>e.id-t.id),s}(n.patterns,n.instrumentNames);G(s),p(n.patterns),n.order&&n.order.length>0&&(h(n.order),d(n.order[0])),j({name:e.metadata.title,author:"",description:`Imported from ${e.metadata.type}`});const a=e.nativeData?.importMetadata.modData?.initialBPM;a&&S(a);const o=e.nativeData?.importMetadata.modData?.initialSpeed;o&&C(o),_k.success(`Imported ${e.metadata.type}: ${e.metadata.title}`,3e3),await ee.preloadInstruments(s)}catch{_k.error("Failed to import module")}finally{se(!1)}},initialFile:be},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:872,columnNumber:7},void 0),Yn.jsxDEV(Gj,{isOpen:ye,onClose:()=>xe(!1),mode:"load",onLoad:async(e,t)=>{E&&(_(),ee.releaseAll());try{const a="string"==typeof e?e:null;if(a&&t.toLowerCase().endsWith(".xml"))try{const e=a.includes("<db303-preset"),n=a.includes("<db303-pattern");if(e){const{parseDb303Preset:e}=await os(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-Dp8mjs8G.js");return{parseDb303Preset:e}},[]),n=e(a);let s=z.find(e=>"TB303"===e.synthType);if(!s){const{createDefaultTB303Instrument:e}=await os(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-CRsYYbpw.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([17,1,2,3,4])),t=e();W(t),s=t}const o={...s.tb303,...n};H(s.id,{tb303:o});z.find(e=>e.id===s.id);return void _k.success(`Loaded DB303 preset: ${t.replace(".xml","")}`)}if(n){const e=t.replace(".xml","")||"Imported Pattern";let n=z.find(e=>"TB303"===e.synthType);if(!n){const{createDefaultTB303Instrument:e}=await os(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-CRsYYbpw.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([17,1,2,3,4])),t=e();W(t),n=t}const{pattern:s,tempo:o}=RX(a,e,n.id);s.channels[0].instrumentId=n.id;const r=[...c,s];return p(r),d(r.length-1),h([r.length-1]),void 0!==o&&S(o),void _k.success(`Loaded DB303 pattern: ${s.name} (${s.length} steps${o?`, ${o} BPM`:""})`)}return void _k.error("Unknown XML format. Expected db303-pattern or db303-preset.")}catch(n){return void _k.error(`Failed to parse XML: ${n instanceof Error?n.message:"Unknown error"}`)}if(t.toLowerCase().endsWith(".mid")||t.toLowerCase().endsWith(".midi"))try{const{importMIDIFile:n}=await os(async()=>{const{importMIDIFile:e}=await Promise.resolve().then(()=>Fj);return{importMIDIFile:e}},void 0),s=e instanceof ArrayBuffer?new Blob([e],{type:"audio/midi"}):e instanceof Blob?e:new Blob([JSON.stringify(e)],{type:"audio/midi"}),a=new File([s],t,{type:"audio/midi"}),o=await n(a,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64});return Q(),U(),q(),ee.disposeAllInstruments(),p(o.patterns),o.instruments.length>0&&G(o.instruments),S(o.bpm),d(0),h(o.patterns.map((e,t)=>t)),j({name:o.metadata.name,author:"",description:`Imported from ${t} (${o.metadata.tracks} track${1!==o.metadata.tracks?"s":""})`}),void _k.success(`Imported: ${o.metadata.name||t}  ${o.instruments.length} instrument(s), BPM: ${o.bpm}`)}catch(s){return void _k.error(`Failed to import MIDI: ${s instanceof Error?s.message:"Unknown error"}`)}const o=e,{needsMigration:r,migrateProject:i}=await os(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>bN);return{needsMigration:e,migrateProject:t}},void 0);let l=o.patterns,u=o.instruments;if(r(l,u)){const e=i(l,u);l=e.patterns,u=e.instruments}if(l&&(p(l),o.sequence&&Array.isArray(o.sequence))){const e=new Map(l.map((e,t)=>[e.id,t])),t=o.sequence.map(t=>e.get(t)).filter(e=>void 0!==e);t.length>0&&h(t)}u&&G(u),o.metadata&&j(o.metadata),o.bpm&&S(o.bpm),L(o.grooveTemplateId||"straight"),_k.success(`Loaded: ${o.metadata?.name||t}`)}catch{_k.error("Failed to load file")}},onLoadTrackerModule:async(e,t)=>{E&&(_(),ee.releaseAll());try{const n=t.toLowerCase();if(n.endsWith(".sqs")||n.endsWith(".seq")){const{parseTD3File:t}=await os(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:n}=await os(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-RYXvH-yI.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([18,1,2,3,4])),{loadPatterns:s,setCurrentPattern:a,setPatternOrder:o}=ID.getState(),{instruments:r,addInstrument:i}=EN.getState();let l=r.find(e=>"TB303"===e.synthType);if(!l){const{createDefaultTB303Instrument:e}=await os(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-CRsYYbpw.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([17,1,2,3,4])),t=e();i(t),l=t}const c=await t(e);if(0===c.patterns.length)return void _k.error("No patterns found in file");const u=EN.getState().instruments.findIndex(e=>e.id===l.id)+1||1,d=c.patterns.map((e,t)=>{const s=n(e.steps,2),a=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:a,channels:[{id:`ch-${l.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:l.id,color:"#ec4899",rows:s.slice(0,a).map(e=>({...e,instrument:e.note?u:0}))}]}});s(d),a(0),o(d.map((e,t)=>t)),_k.success(`Imported ${d.length} TD-3 pattern(s)`)}else if(Bj(n)){const n=await _j(new File([e],t),{mergeChannels:!0});if(0===n.patterns.length)return void _k.error("No patterns found in MIDI file");Q(),U(),q(),ee.disposeAllInstruments(),p(n.patterns),n.instruments.length>0&&G(n.instruments),h(n.patterns.map((e,t)=>t)),d(0),S(n.bpm),j({name:n.metadata.name,author:"",description:`Imported from MIDI (${n.metadata.tracks} track${1!==n.metadata.tracks?"s":""})`}),_k.success(`Imported: ${n.metadata.name}  ${n.instruments.length} instrument(s), BPM: ${n.bpm}`)}else{if(ZI(t))return ve(new File([e],t)),void ge(!0);const{parseModuleToSong:n}=await os(async()=>{const{parseModuleToSong:e}=await import("./parseModuleToSong-BCo4MrbT.js").then(e=>e.b);return{parseModuleToSong:e}},[]);ee.releaseAll(),Q(),U(),q(),ee.disposeAllInstruments(),se(!0);try{const s=await n(new File([e],t));G(s.instruments),p(s.patterns),d(0),s.songPositions.length>0&&h(s.songPositions),S(s.initialBPM),C(s.initialSpeed),j({name:s.name,author:"",description:`Imported from ${t}`}),ID.getState().applyEditorMode(s),await ee.preloadInstruments(s.instruments),_k.success(`Imported: ${s.name}  ${s.instruments.length} instrument(s)`,3e3)}finally{se(!1)}}}catch{_k.error("Failed to load file")}}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:878,columnNumber:7},void 0),Ne&&Yn.jsxDEV("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60",children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl",children:[Yn.jsxDEV("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Clear Project"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1197,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-secondary mb-6",children:"What would you like to clear?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1198,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex flex-col gap-2",children:[Yn.jsxDEV(TV,{variant:"default",size:"sm",onClick:()=>{E&&(_(),ee.releaseAll()),q(),we(!1),_k.success("Instruments cleared")},children:"Clear Instruments"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1200,columnNumber:15},void 0),Yn.jsxDEV(TV,{variant:"default",size:"sm",onClick:()=>{E&&(_(),ee.releaseAll()),x(),we(!1),_k.success("Song data cleared")},children:"Clear Song Data"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1212,columnNumber:15},void 0),Yn.jsxDEV(TV,{variant:"default",size:"sm",onClick:()=>{E&&(_(),ee.releaseAll()),q(),x(),we(!1),_k.success("Project cleared")},children:"Clear Both"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1224,columnNumber:15},void 0),Yn.jsxDEV(TV,{variant:"danger",size:"sm",onClick:()=>{E&&(_(),ee.releaseAll()),q(),x(),U(),LX(),we(!1),_k.success("Reset to defaults")},children:"Reset to Defaults"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1237,columnNumber:15},void 0),Yn.jsxDEV(TV,{variant:"ghost",size:"sm",onClick:()=>we(!1),children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1252,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1199,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1196,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:1195,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/FT2Toolbar/FT2Toolbar.tsx",lineNumber:663,columnNumber:5},void 0)}),qX=(e,t,n)=>{const s=Math.log(t),a=Math.log(n);return(Math.log(e)-s)/(a-s)},KX=a.memo(({value:e,min:t,max:n,label:s,title:a,unit:o="",onChange:r,logarithmic:i=!1,defaultValue:c,size:u="md",color:d="#00d4aa",displayValue:m,isActive:p=!1,bipolar:h=!1,formatValue:f,step:g,disabled:b=!1})=>{const v=l.useRef(null),[y,x]=l.useState(!1),[N,w]=l.useState(!1),[E,k]=l.useState(!1),[D,S]=l.useState({x:0,y:0}),M=l.useRef(0),C=l.useRef(0),V=l.useRef(0),P=l.useRef(0),_=l.useRef(null),O=l.useRef(null),T=l.useRef(null),L=l.useId(),A=l.useRef(r),B=l.useRef(t),I=l.useRef(n),F=l.useRef(i),U=l.useRef(g);l.useEffect(()=>{A.current=r,B.current=t,I.current=n,F.current=i,U.current=g},[r,t,n,i,g]);const R="cyan-lineart"===JD(e=>e.currentThemeId),j=R?"#00ffff":d,X=R?"#0a3a3a":"#2a2a2a",z=R?"#0a4a4a":"#444",G=R?"#0a4a4a":"#4a4a4a",H=R?"#0a3a3a":"#3a3a3a",W=R?"#0a2a2a":"#2a2a2a",{knob:q,fontSize:K,stroke:$}={sm:{knob:40,fontSize:10,stroke:3},md:{knob:56,fontSize:11,stroke:4},lg:{knob:72,fontSize:12,stroke:5}}[u],Y=l.useCallback(()=>i?qX(Math.max(t,Math.min(n,e)),t,n):(e-t)/(n-t),[e,t,n,i]),J=l.useCallback(()=>{const s=void 0!==m?m:e,a=Math.max(t,Math.min(n,s));return i?qX(a,t,n):(a-t)/(n-t)},[m,e,t,n,i])(),Q=isNaN(J)||!isFinite(J)?-135:270*J-135,Z=f||(e=>isNaN(e)||null==e?"0":e>=1e3?`${(e/1e3).toFixed(1)}k`:e<10?e.toFixed(1):Math.round(e).toString()),ee=h?0:-135,te=Q,ne=(q-2*$)/2,se=q/2,ae=e=>{const t=((isNaN(e)||!isFinite(e)?-135:e)-90)*Math.PI/180;return{x:se+ne*Math.cos(t),y:se+ne*Math.sin(t)}},oe=(e,t)=>{const n=ae(e),s=ae(t),a=Math.abs(t-e)>180?1:0,o=t>e?1:0;return`M ${n.x} ${n.y} A ${ne} ${ne} 0 ${a} ${o} ${s.x} ${s.y}`},re=l.useCallback(()=>{_.current&&(clearTimeout(_.current),_.current=null)},[]),ie=l.useCallback(e=>{if(b)return;const t=Date.now();t-P.current<300?(re(),gP.medium(),w(!0),P.current=0):P.current=t},[b,re]),le=l.useCallback(e=>{if(b)return;const t=v.current?.getBoundingClientRect();t&&S({x:t.left+t.width/2,y:t.top}),_.current=setTimeout(()=>{gP.heavy(),k(!0)},500)},[b]),ce=l.useCallback(e=>{gP.success(),r(e),k(!1)},[r]),ue=l.useCallback(e=>{const s=Math.max(t,Math.min(n,e));gP.success(),r(s),w(!1)},[t,n,r]),de=l.useCallback(e=>{if(b)return;e.preventDefault();const t="touches"in e,n=t?e.touches[0].clientY:e.clientY,s=t?e.touches[0].clientX:e.clientX;t&&(ie(e),le(e)),x(!0),M.current=n,C.current=s,V.current=Y();const a=v.current?.ownerDocument??document,o=a.defaultView??window;a.body.style.cursor="ns-resize";const r=e=>{re();const t="touches"in e?e.touches[0].clientY:e.clientY,n="touches"in e?e.touches[0].clientX:e.clientX,s=M.current-t,a=n-C.current,o=(Math.abs(a)>Math.abs(s)?a:s)/150,r=Math.max(0,Math.min(1,V.current+o));let i;i=F.current?((e,t,n)=>{const s=Math.log(t),a=Math.log(n);return Math.exp(s+e*(a-s))})(r,B.current,I.current):B.current+r*(I.current-B.current);const l=U.current;i=void 0!==l&&l>0?Math.round(i/l)*l:Math.round(100*i)/100,T.current=i,O.current||(O.current=requestAnimationFrame(()=>{null!==T.current&&(A.current(T.current),T.current=null),O.current=null}))},i=()=>{re(),x(!1),a.body.style.cursor="",o.removeEventListener("mousemove",r),o.removeEventListener("mouseup",i),o.removeEventListener("touchmove",r),o.removeEventListener("touchend",i),O.current&&(cancelAnimationFrame(O.current),O.current=null)};o.addEventListener("mousemove",r),o.addEventListener("mouseup",i),o.addEventListener("touchmove",r,{passive:!1}),o.addEventListener("touchend",i)},[Y,b,ie,le,re]),me=l.useCallback(()=>{b||r(void 0!==c?c:h?(n+t)/2:t)},[c,h,t,n,r,b]),pe=l.useCallback(e=>{e.preventDefault(),b||r(void 0!==c?c:h?(n+t)/2:t)},[c,h,t,n,r,b]),he=l.useCallback(s=>{let a=e;const o=g||(i?(n-t)/100:(n-t)/50),l=10*o;switch(s.key){case"ArrowUp":case"ArrowRight":s.preventDefault(),a=Math.min(n,e+(s.shiftKey?l:o));break;case"ArrowDown":case"ArrowLeft":s.preventDefault(),a=Math.max(t,e-(s.shiftKey?l:o));break;case"Home":s.preventDefault(),a=t;break;case"End":s.preventDefault(),a=n;break;case"PageUp":s.preventDefault(),a=Math.min(n,e+l);break;case"PageDown":s.preventDefault(),a=Math.max(t,e-l);break;default:return}a=void 0!==g&&g>0?Math.round(a/g)*g:n-t>100?Math.round(a):Math.round(10*a)/10,r(a)},[e,t,n,i,g,r]);l.useEffect(()=>()=>{O.current&&cancelAnimationFrame(O.current),re()},[re]);const fe=ae(Q),ge={x:se+(ne-8)*Math.cos((Q-90)*Math.PI/180),y:se+(ne-8)*Math.sin((Q-90)*Math.PI/180)};return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"knob-container",style:{width:q+20,opacity:b?.4:1,pointerEvents:b?"none":"auto",touchAction:"none"},title:a,children:[s&&Yn.jsxDEV("div",{className:"knob-label",style:{fontSize:K-1},children:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:434,columnNumber:9},void 0),Yn.jsxDEV("div",{ref:v,className:"knob-body "+(y?"cursor-grabbing":""),style:{width:q,height:q,touchAction:"none"},onMouseDown:de,onTouchStart:de,onDoubleClick:me,onContextMenu:pe,onKeyDown:he,role:"slider","aria-label":`${s||"Knob"}${o?` (${o})`:""}`,"aria-valuemin":t,"aria-valuemax":n,"aria-valuenow":Math.round(10*e)/10,"aria-valuetext":`${Z(void 0!==m?m:e)}${o}`,tabIndex:0,children:Yn.jsxDEV("svg",{width:q,height:q,viewBox:`0 0 ${q} ${q}`,children:[Yn.jsxDEV("path",{d:oe(-135,135),fill:"none",stroke:X,strokeWidth:$,strokeLinecap:"round"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:466,columnNumber:11},void 0),h?.5!==J&&Yn.jsxDEV("path",{d:oe(J>.5?ee:te,J>.5?te:ee),fill:"none",stroke:j,strokeWidth:$,strokeLinecap:"round",style:{filter:p?`drop-shadow(0 0 4px ${j})`:`drop-shadow(0 0 2px ${j})`,transition:void 0!==m?"none":"stroke-dasharray 0.05s ease-out"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:478,columnNumber:15},void 0):Yn.jsxDEV("path",{d:oe(-135,Q),fill:"none",stroke:j,strokeWidth:$,strokeLinecap:"round",style:{filter:p?`drop-shadow(0 0 4px ${j})`:`drop-shadow(0 0 2px ${j})`,transition:void 0!==m?"none":"stroke-dasharray 0.05s ease-out"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:495,columnNumber:13},void 0),Yn.jsxDEV("circle",{cx:se,cy:se,r:ne-$-4,fill:`url(#kg-${L})`,stroke:z,strokeWidth:"1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:509,columnNumber:11},void 0),Yn.jsxDEV("line",{x1:ge.x,y1:ge.y,x2:fe.x,y2:fe.y,stroke:j,strokeWidth:"2",strokeLinecap:"round",style:{filter:p?`drop-shadow(0 0 3px ${j})`:"none",transition:void 0!==m?"transform 0.016s linear":"transform 0.1s ease-out"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:519,columnNumber:11},void 0),Yn.jsxDEV("defs",{children:Yn.jsxDEV("linearGradient",{id:`kg-${L}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[Yn.jsxDEV("stop",{offset:"0%",stopColor:G},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:536,columnNumber:15},void 0),Yn.jsxDEV("stop",{offset:"50%",stopColor:H},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:537,columnNumber:15},void 0),Yn.jsxDEV("stop",{offset:"100%",stopColor:W},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:538,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:535,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:534,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:464,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:443,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"knob-value",style:{fontSize:K,color:p?j:void 0,textShadow:p?`0 0 4px ${j}80`:"none"},children:[Z(void 0!==m?m:e),o]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:545,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:422,columnNumber:5},void 0),y&&ZV.createPortal(Yn.jsxDEV("div",{className:"fixed pointer-events-none z-[9999] px-2 py-1 bg-black/90 border border-accent-primary rounded text-xs font-mono font-bold text-white shadow-xl transform -translate-x-1/2 -translate-y-full",style:{left:(v.current?.getBoundingClientRect().left||0)+q/2,top:(v.current?.getBoundingClientRect().top||0)-8},children:[Z(void 0!==m?m:e),o]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:559,columnNumber:7},void 0),v.current?.ownerDocument.body??document.body),N&&Yn.jsxDEV("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center",onClick:()=>w(!1),children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg p-6 shadow-xl",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"text-sm font-mono text-text-secondary mb-3",children:s||"Value"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:581,columnNumber:11},void 0),Yn.jsxDEV("input",{type:"number",min:t,max:n,step:g,defaultValue:e,autoFocus:!0,className:"w-full px-4 py-3 text-lg font-mono bg-dark-bg border-2 border-accent-primary rounded-lg text-text-primary focus:outline-none",onKeyDown:e=>{"Enter"===e.key?ue(parseFloat(e.currentTarget.value)):"Escape"===e.key&&w(!1)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:584,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-2 mt-4",children:[Yn.jsxDEV("button",{onClick:()=>ue(parseFloat(document.querySelector('input[type="number"]')?.value||String(e))),className:"flex-1 py-2 bg-accent-primary text-text-inverse rounded-lg font-mono text-sm",children:"OK"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:601,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>w(!1),className:"flex-1 py-2 bg-dark-bgTertiary text-text-secondary rounded-lg font-mono text-sm",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:607,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:600,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:577,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:573,columnNumber:7},void 0),E&&Yn.jsxDEV("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>k(!1),children:Yn.jsxDEV("div",{className:"absolute bg-dark-bgSecondary rounded-lg shadow-xl p-2 min-w-[120px]",style:{left:`${D.x}px`,top:`${D.y}px`,transform:"translate(-50%, -100%) translateY(-8px)"},onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"text-xs font-mono text-text-muted text-center mb-2 px-2 py-1",children:s||"Preset"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:633,columnNumber:11},void 0),[0,.25,.5,.75,1].map(e=>{const s=t+e*(n-t);return Yn.jsxDEV("button",{onClick:()=>ce(s),className:"w-full px-3 py-2 text-sm font-mono text-text-secondary hover:bg-accent-primary hover:text-text-inverse rounded transition-colors",children:[(100*e).toFixed(0),"% (",Z(s),o,")"]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:639,columnNumber:15},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:624,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:620,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/controls/Knob.tsx",lineNumber:421,columnNumber:5},void 0)},(e,t)=>e.value===t.value&&e.displayValue===t.displayValue&&e.isActive===t.isActive&&e.min===t.min&&e.max===t.max&&e.label===t.label&&e.color===t.color&&e.size===t.size&&e.disabled===t.disabled);KX.displayName="Knob";const $X=200,YX=["ACID SCREAM: Cutoff LOW (20-30%) + Resonance HIGH (90%+) + Env Mod HIGH (90%+) = maximum squelch","The filter envelope is the soul of acid. Env Mod controls HOW FAR the filter sweeps, Decay controls HOW LONG","For fat basslines, keep Resonance below 40% and Cutoff around 50%. Resonance scoops out the bass!","Accent doesn't just add volume  it pushes the filter HARDER. Accent + high Env Mod = face-melting sweep","Classic 303 trick: Set Cutoff to 0%, Env Mod to 100%, Resonance to 80%. Every note becomes a filter sweep from zero","Slides are everything in acid. Enable Devil Fish mods and crank the Slide time for long, gliding portamento","SAW wave = buzzy, aggressive acid. SQR wave = hollow, woody, more vintage. Mix with Sub Osc for both","PWM on square wave adds movement and thickness. Automate it with the LFO for evolving textures","Sub Oscillator adds weight without muddying the filter. Set SubG to 30-50% for solid low-end foundation","Devil Fish 'Drive' pushes the filter into saturation. Even small amounts (10-20%) add analog warmth","The Korg Ladder filter (in Mods) has a completely different character  darker, more aggressive self-oscillation","For dub techno bass: Cutoff 40%, Reso 30%, Env Mod 50%, Decay 70%. Warm and deep, not screaming","Quick reset: Double-click any knob to snap it back to its default value","Try the Phaser effect at low mix (10-20%) for subtle stereo movement on your acid lines","Delay + high feedback + short time = metallic resonance. Great for industrial acid textures","LFO  Filter at slow rate creates classic auto-wah. Speed it up for ring-mod-like timbres","Accent works best on every 2nd or 4th note. Too many accents = no accents. Let them breathe","Diode character (in Mods) adds asymmetric distortion  the secret sauce of real 303 clones","LP/BP mix blends lowpass and bandpass. Bandpass at high resonance creates nasal, vocal-like tones","For TB-303 authenticity: SAW wave, Cutoff 25%, Reso 60%, Env Mod 75%, Decay 40%. Pure Roland acid"],JX=l.memo(({config:e,instrumentId:t})=>{const n=l.useRef(null),s=l.useRef(null),a=l.useRef(null),[o,r]=l.useState(200),i=l.useRef(e);l.useEffect(()=>{i.current=e});l.useEffect(()=>{const e=n.current;if(!e)return;const t=()=>{const t=e.getBoundingClientRect();t.width>0&&r(Math.floor(t.width))};t();const s=new ResizeObserver(t);return s.observe(e),()=>s.disconnect()},[]),l.useLayoutEffect(()=>{const e=s.current;if(!e)return;const t=e.getContext("2d",{alpha:!1});if(!t)return;const n=window.devicePixelRatio||1;e.width=o*n,e.height=80*n,t.setTransform(1,0,0,1,0,0),t.scale(n,n),a.current=t},[o]);const c=l.useCallback(()=>{const e=a.current;if(!e)return!1;const n=o,s=80,r=i.current;e.fillStyle="#0d0d0d",e.fillRect(0,0,n,s);const l=Bw().getInstrumentAnalyser(t);let c=!1;if(l){const t=l.getWaveform();if(l.hasActivity()){c=!0,e.strokeStyle="#ffcc00",e.lineWidth=1.5,e.shadowColor="#ffcc00",e.shadowBlur=4,e.beginPath();const a=n/t.length;for(let n=0;n<t.length;n++){const o=(t[n]+1)/2*s;0===n?e.moveTo(n*a,o):e.lineTo(n*a,o)}e.stroke(),e.shadowBlur=0}}if(!c){const t=r.filter?.cutoff??.5,s=r.filter?.resonance??0,a=r.filterEnvelope?.envMod??.5,o=.5+24.5*s,i=36,l=1.6,c=(e,t,n)=>{if(t<=.001)return e<.001?1:1e-4;const s=e/t,a=s*s;return 1/Math.max(Math.sqrt((1-a)*(1-a)+a/(n*n)),1e-4)},u=(t,s,a,o,r)=>{e.beginPath(),e.strokeStyle=a,e.lineWidth=o,r?e.setLineDash(r):e.setLineDash([]);for(let u=0;u<n;u++){const a=u/n,o=20*Math.log10(Math.max(c(a,t,s),1e-4)),r=Math.max(2,Math.min(78,i-o*l));0===u?e.moveTo(u,r):e.lineTo(u,r)}e.stroke(),e.setLineDash([])};if(a>.02){u(Math.min(1,t+a*(1-t)),o,"rgba(255, 204, 0, 0.12)",1,[4,4])}u(t,o,"rgba(255, 204, 0, 0.4)",1.5),e.shadowColor="#ffcc00",e.shadowBlur=3,u(t,o,"rgba(255, 204, 0, 0.15)",1),e.shadowBlur=0,e.fillStyle="rgba(255, 204, 0, 0.25)",e.font="7px monospace",e.fillText("FILTER",4,76)}return c},[t,o]);return l.useEffect(()=>{let e,t=!0,n=0;const s=a=>{t&&(a-n>=33&&(n=a,c()),e=requestAnimationFrame(s))};return e=requestAnimationFrame(s),()=>{t=!1,cancelAnimationFrame(e)}},[c]),Yn.jsxDEV("div",{ref:n,className:"w-full",style:{height:"80px"},children:Yn.jsxDEV("canvas",{ref:s,className:"rounded",style:{width:"100%",height:"80px",display:"block"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:207,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:206,columnNumber:5},void 0)});JX.displayName="DB303Scope";const QX=({instrumentId:e})=>{const[t,n]=l.useState(null),[s,a]=l.useState(!1);return l.useEffect(()=>{const e=()=>{a("undefined"!=typeof window&&!!window.DB303_TRACE)};e();const t=setInterval(e,2e3);return()=>clearInterval(t)},[]),l.useEffect(()=>{if(!s)return void n(null);let t=!1;const a=async()=>{try{const{getToneEngine:s}=await os(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>Iw);return{getToneEngine:e}},void 0),a=s().instruments,o=a?.get(e);if(o?.getDiagnostics){const e=await o.getDiagnostics();!t&&e&&Object.keys(e).length>0&&n(e)}}catch{}};a();const o=setInterval(a,500);return()=>{t=!0,clearInterval(o)}},[e,s]),s&&t?Yn.jsxDEV("div",{className:"absolute inset-0 flex items-end pointer-events-none",style:{fontSize:"8px",fontFamily:"monospace"},children:Yn.jsxDEV("div",{className:"bg-black/70 text-green-400 px-2 py-0.5 rounded-t flex gap-3 flex-wrap",children:[void 0!==t.cutoff&&Yn.jsxDEV("span",{children:["CUT:",t.cutoff.toFixed(3)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:256,columnNumber:39},void 0),void 0!==t.resonance&&Yn.jsxDEV("span",{children:["RES:",t.resonance.toFixed(3)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:257,columnNumber:42},void 0),void 0!==t.envMod&&Yn.jsxDEV("span",{children:["ENV:",t.envMod.toFixed(3)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:258,columnNumber:39},void 0),void 0!==t.volume&&Yn.jsxDEV("span",{children:["VOL:",t.volume.toFixed(3)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:259,columnNumber:39},void 0),void 0!==t.peakAmplitude&&Yn.jsxDEV("span",{children:["PEAK:",t.peakAmplitude.toFixed(4)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:260,columnNumber:46},void 0),void 0!==t.currentNote&&Yn.jsxDEV("span",{children:["NOTE:",t.currentNote]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:261,columnNumber:44},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:255,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:254,columnNumber:5},void 0):null},ZX=l.memo(({config:e,onChange:t,onPresetLoad:n,isBuzz3o3:s=!1,instrumentId:a,headerActions:o})=>{const r={...La,...e,oscillator:{...La.oscillator,...e.oscillator},filter:{...La.filter,...e.filter},filterEnvelope:{...La.filterEnvelope,...e.filterEnvelope},accent:{...La.accent,...e.accent},slide:{...La.slide,...e.slide}},i=l.useRef(null),[c,u]=l.useState("osc"),d=!s||"lfo"!==c&&"fx"!==c?c:"osc",m=l.useRef(r);l.useEffect(()=>{m.current=r});const p=OM(e=>e.setKnobPage);l.useEffect(()=>{const e={osc:1,mojo:2,lfo:3,devilfish:4,fx:5}[d];void 0!==e&&p(e)},[d,p]);const[h,f]=l.useState(()=>Math.floor(Math.random()*YX.length)),[g,b]=l.useState(!1),v=l.useCallback(e=>{b(!0),setTimeout(()=>{f(t=>(t+e+YX.length)%YX.length),b(!1)},200)},[]);l.useEffect(()=>{const e=setInterval(()=>v(1),12e3);return()=>clearInterval(e)},[v]);const[y,x]=l.useState(1200);l.useLayoutEffect(()=>{const e=()=>{if(i.current?.parentElement){const e=i.current.parentElement.clientWidth-32;x(Math.max(1e3,e))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const N=(e,n)=>{t({filter:{...m.current.filter,[e]:n}})},w=(e,n)=>{const s={filterEnvelope:{...m.current.filterEnvelope,[e]:n}};"decay"===e&&(s.devilFish={...La.devilFish,...m.current.devilFish||{},normalDecay:n}),t(s)},E=(e,n)=>{const s=m.current.devilFish||{enabled:!0,normalDecay:.5,accentDecay:.5,vegDecay:.5,vegSustain:0,softAttack:0,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"};t({devilFish:{...s,[e]:n}})},k=(e,n)=>{t({oscillator:{...m.current.oscillator,[e]:n}})},D=e=>{const n=m.current.lfo||{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0};t({lfo:{...n,...e}})},S=e=>{const n=m.current.chorus||{enabled:!1,mode:1,mix:.3};t({chorus:{...n,...e}})},M=(e,t,n,s)=>({left:`${e}px`,top:`${t}px`,width:`${n}px`,height:`${s}px`,position:"absolute"}),C=[{id:"osc",label:"OSC",color:"#06b6d4",bgClass:"bg-cyan-500",textClass:"text-cyan-400"},{id:"mojo",label:"MOJO",color:"#ff9900",bgClass:"bg-orange-500",textClass:"text-orange-400"},...s?[]:[{id:"lfo",label:"LFO",color:"#a855f7",bgClass:"bg-purple-500",textClass:"text-purple-400",ledOn:r.lfo?.enabled||!1}],{id:"devilfish",label:"DEVILFISH",color:"#ff3333",bgClass:"bg-red-500",textClass:"text-red-400"},...s?[]:[{id:"fx",label:"FX",color:"#22c55e",bgClass:"bg-green-500",textClass:"text-green-400",ledOn:!(!r.chorus?.mode&&!r.delay?.mix)}]],V={osc:"shadow-cyan-500/30",mojo:"shadow-orange-500/30",devilfish:"shadow-red-500/30",lfo:"shadow-purple-500/30",fx:"shadow-green-500/30"};return Yn.jsxDEV("div",{ref:i,className:"w-full overflow-visible flex justify-center py-4 select-none",style:{minHeight:"512px"},children:Yn.jsxDEV("div",{className:"relative bg-[#1a1a1a] rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] border-b-8 border-r-4 border-black/40 overflow-hidden",style:{width:`${y}px`,height:"480px",background:"linear-gradient(180deg, #252525 0%, #1a1a1a 100%)"},children:[Yn.jsxDEV("div",{className:"absolute inset-0 pointer-events-none",children:[Yn.jsxDEV("div",{className:"absolute top-0 left-0 right-0 h-1 bg-black/20"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:458,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"absolute top-[110px] left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.02)]"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:459,columnNumber:11},void 0),Yn.jsxDEV("div",{style:(P=40,_=115,O=600,{left:`${P}px`,top:`${_}px`,width:`${O}px`,position:"absolute",textAlign:"center",fontSize:"10px",fontWeight:"bold",color:"#888",textTransform:"uppercase",letterSpacing:"0.08em"}),className:"text-accent-primary opacity-80",children:"Classic"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:460,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.02)]",style:{top:"285px"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:461,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:457,columnNumber:9},void 0),Yn.jsxDEV("div",{style:M(40,145,65,80),children:Yn.jsxDEV(KX,{value:r.tuning??.5,min:0,max:1,defaultValue:.5,bipolar:!0,onChange:e=>{t({tuning:e})},label:"Tone",size:"md",color:"#ffcc00",formatValue:e=>(e-.5>0?"+":"")+Math.round(100*(e-.5))+"c"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:465,columnNumber:45},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:465,columnNumber:9},void 0),Yn.jsxDEV("div",{style:M(145,140,65,100),children:[Yn.jsxDEV(KX,{value:r.filter.cutoff,min:0,max:1,defaultValue:.5,onChange:e=>N("cutoff",e),label:"Cutoff",size:"md",color:"#ffcc00",formatValue:e=>Math.round(314*Math.pow(2394/314,e))+" Hz"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:467,columnNumber:11},void 0),Yn.jsxDEV("label",{className:"flex items-center gap-1 justify-center mt-1 cursor-pointer",children:[Yn.jsxDEV("input",{type:"checkbox",checked:r.devilFish?.extendedCutoff||!1,onChange:e=>E("extendedCutoff",e.target.checked),className:"w-3 h-3 accent-yellow-500 rounded"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:469,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-[8px] text-gray-400 uppercase",children:"Wide"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:470,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:468,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:466,columnNumber:9},void 0),Yn.jsxDEV("div",{style:M(250,145,65,80),children:Yn.jsxDEV(KX,{value:r.filter.resonance,min:0,max:1,defaultValue:0,onChange:e=>N("resonance",e),label:"Reso",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:473,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:473,columnNumber:9},void 0),Yn.jsxDEV("div",{style:M(355,140,65,100),children:[Yn.jsxDEV(KX,{value:r.filterEnvelope.envMod,min:0,max:1,defaultValue:.5,onChange:e=>w("envMod",e),label:"EnvMod",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:475,columnNumber:11},void 0),Yn.jsxDEV("label",{className:"flex items-center gap-1 justify-center mt-1 cursor-pointer",children:[Yn.jsxDEV("input",{type:"checkbox",checked:r.devilFish?.extendedEnvMod||!1,onChange:e=>E("extendedEnvMod",e.target.checked),className:"w-3 h-3 accent-yellow-500 rounded"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:477,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-[8px] text-gray-400 uppercase",children:"Wide"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:478,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:476,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:474,columnNumber:9},void 0),Yn.jsxDEV("div",{style:M(460,145,65,80),children:Yn.jsxDEV(KX,{value:r.filterEnvelope.decay,min:0,max:1,defaultValue:.5,onChange:e=>w("decay",e),label:"Decay",size:"md",color:"#ffcc00",formatValue:e=>Math.round($X*Math.pow(10,e))+" ms"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:481,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:481,columnNumber:9},void 0),Yn.jsxDEV("div",{style:M(565,145,65,80),children:Yn.jsxDEV(KX,{value:r.accent.amount,min:0,max:1,defaultValue:.5,onChange:e=>{return n="amount",s=e,void t({accent:{...m.current.accent,[n]:s}});var n,s},label:"Accent",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:482,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:482,columnNumber:9},void 0),Yn.jsxDEV("div",{style:M(670,145,65,80),children:Yn.jsxDEV(KX,{value:r.volume??.75,min:0,max:1,defaultValue:.75,onChange:e=>t({volume:e}),label:"Level",size:"md",color:"#00ffff",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:483,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:483,columnNumber:9},void 0),Yn.jsxDEV("div",{style:{position:"absolute",left:20,right:20,top:290,height:30},className:"flex items-center gap-1.5",children:[C.map(e=>Yn.jsxDEV("button",{onClick:()=>{return t=e.id,void((!s||"lfo"!==t&&"fx"!==t)&&u(t));var t},className:mn("relative px-3.5 py-1.5 text-[10px] font-bold uppercase tracking-wider rounded-full border transition-all duration-200",d===e.id?`${e.bgClass} text-white border-transparent shadow-lg ${V[e.id]||""}`:`bg-black/40 ${e.textClass} border-white/5 hover:border-white/10 hover:bg-black/60`),children:[e.label,void 0!==e.ledOn&&Yn.jsxDEV("span",{className:mn("absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full border border-black/50 transition-all duration-300",e.ledOn?e.bgClass:"bg-dark-bgActive"),style:e.ledOn?{boxShadow:`0 0 6px ${e.color}`}:void 0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:500,columnNumber:17},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:488,columnNumber:13},void 0)),Yn.jsxDEV("span",{className:"ml-auto text-[9px] text-gray-600 font-mono tracking-wider",children:[C.findIndex(e=>e.id===d)+1,"/",C.length]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:511,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:486,columnNumber:9},void 0),Yn.jsxDEV("div",{style:{position:"absolute",left:0,right:0,top:324,bottom:30},children:["osc"===d&&Yn.jsxDEV("div",{className:"flex items-center gap-3 h-full px-6",children:[Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.oscillator.waveformBlend??("square"===r.oscillator.type?1:0),min:0,max:1,defaultValue:0,onChange:e=>k("waveformBlend",e),label:"Waveform",size:"md",color:"#06b6d4",formatValue:e=>e<.05?"SAW":e>.95?"SQR":Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:522,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:522,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.oscillator.pulseWidth??0,min:0,max:1,defaultValue:0,onChange:e=>k("pulseWidth",e),label:"Pulse W",size:"md",color:"#06b6d4",formatValue:e=>Math.round(50+49*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:523,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:523,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.oscillator.subOscGain??0,min:0,max:1,defaultValue:0,onChange:e=>k("subOscGain",e),label:"Sub Osc",size:"md",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:524,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:524,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.oscillator.subOscBlend??1,min:0,max:1,defaultValue:1,onChange:e=>k("subOscBlend",e),label:"Sub Wave",size:"md",color:"#06b6d4",formatValue:e=>e<.5?"-2 Oct":"-1 Oct"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:525,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:525,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:521,columnNumber:13},void 0),"mojo"===d&&Yn.jsxDEV("div",{className:"flex items-center gap-3 h-full px-6",children:[Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.passbandCompensation??.9,min:0,max:1,defaultValue:.9,onChange:e=>E("passbandCompensation",e),label:"Bass",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:532,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:532,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.resTracking??.7,min:0,max:1,defaultValue:.7,onChange:e=>E("resTracking",e),label:"Rez",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:533,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:533,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.filterInputDrive??0,min:0,max:1,defaultValue:0,onChange:e=>E("filterInputDrive",e),label:"Satur",size:"md",color:"#ff9900",formatValue:e=>(10*e).toFixed(1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:534,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:534,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px h-14 bg-white/5 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:535,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.diodeCharacter??0,min:0,max:1,defaultValue:0,onChange:e=>E("diodeCharacter",e),label:"Bite",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:536,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:536,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.duffingAmount??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>E("duffingAmount",e),label:"Tension",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:537,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:537,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.lpBpMix??0,min:0,max:1,defaultValue:0,onChange:e=>E("lpBpMix",e),label:"LP/BP",size:"md",color:"#ff9900",formatValue:e=>e<.05?"LP":e>.95?"BP":"Mix"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:538,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:538,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px h-14 bg-white/5 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:539,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex flex-col gap-1",children:[Yn.jsxDEV("label",{className:"text-[8px] font-bold text-orange-500/70",children:"FILTER"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:541,columnNumber:17},void 0),Yn.jsxDEV("select",{value:r.devilFish?.filterSelect??1,onChange:e=>E("filterSelect",parseInt(e.target.value)),className:"bg-[#111] text-[10px] text-orange-400 border border-orange-900/30 rounded px-1 py-1 outline-none focus:border-orange-500",children:[Yn.jsxDEV("option",{value:0,children:"DiodeLadder"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:543,columnNumber:19},void 0),Yn.jsxDEV("option",{value:5,children:"MissThang-20"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:543,columnNumber:57},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:542,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:540,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:531,columnNumber:13},void 0),"lfo"===d&&!s&&Yn.jsxDEV("div",{className:"flex items-center gap-3 h-full px-6",children:[Yn.jsxDEV("div",{className:"flex flex-col items-center gap-1.5 flex-shrink-0",children:[Yn.jsxDEV("span",{className:"text-[9px] font-bold text-purple-400/60 tracking-wider",children:"WAVE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:554,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex gap-1.5 items-center",children:[0,1,2,3,4,5].map(e=>Yn.jsxDEV("button",{onClick:()=>D({enabled:!0,waveform:e}),className:mn("w-10 h-8 text-[10px] font-bold rounded-md border-2 transition-all",r.lfo?.waveform===e?"bg-purple-500 text-white border-purple-400 shadow-[0_0_8px_rgba(168,85,247,0.4)]":"bg-black/50 text-purple-400/50 border-purple-900/40 hover:border-purple-500/50 hover:text-purple-400"),children:["TRI","SAW","SAW","SQR","S&H","NSE"][e]},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:557,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:555,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:553,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px h-14 bg-white/5 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:563,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.lfo?.rate??0,min:0,max:1,defaultValue:0,onChange:e=>D({enabled:!0,rate:e}),label:"Rate",size:"md",color:"#a855f7",formatValue:e=>{const t=.05*Math.pow(400,e);return t>=10?t.toFixed(1)+"Hz":t.toFixed(2)+"Hz"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:564,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:564,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.lfo?.contour??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>D({enabled:!0,contour:e}),label:"Contour",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:565,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:565,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.lfo?.pwmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>D({enabled:!0,pwmDepth:e}),label:"PWM Mod",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:566,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:566,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.lfo?.pitchDepth??0,min:0,max:1,defaultValue:0,onChange:e=>D({enabled:!0,pitchDepth:e}),label:"Pitch",size:"md",color:"#a855f7",formatValue:e=>"+"+Math.round(12*e)+" semi"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:567,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:567,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.lfo?.filterDepth??0,min:0,max:1,defaultValue:0,onChange:e=>D({enabled:!0,filterDepth:e}),label:"Filter",size:"md",color:"#a855f7",formatValue:e=>"+"+(2*e).toFixed(1)+" oct"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:568,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:568,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.lfo?.stiffDepth??0,min:0,max:1,defaultValue:0,onChange:e=>D({enabled:!0,stiffDepth:e}),label:"Tension",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:569,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:569,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:551,columnNumber:13},void 0),"devilfish"===d&&Yn.jsxDEV("div",{className:"flex items-center gap-3 h-full px-6",children:[Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.filterFmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>E("filterFmDepth",e),label:"Filt FM",size:"md",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:576,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:576,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.filterTracking??0,min:0,max:1,defaultValue:0,onChange:e=>E("filterTracking",e),label:"Filt Trk",size:"md",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:577,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:577,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.slide?.time??.17,min:0,max:1,defaultValue:.17,onChange:e=>{t({slide:{...m.current.slide,time:e}})},label:"Slide",size:"md",color:"#ff3333",formatValue:e=>Math.round(2*Math.pow(180,e))+" ms"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:578,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:578,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px h-14 bg-white/5 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:579,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.softAttack??0,min:0,max:1,defaultValue:0,onChange:e=>E("softAttack",e),label:"S.Atk",size:"md",color:"#ff3333",formatValue:e=>(.3*Math.pow(100,e)).toFixed(1)+" ms"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:580,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:580,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.normalDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>E("normalDecay",e),label:"N.Dec",size:"md",color:"#ff3333",formatValue:e=>Math.round($X*Math.pow(10,e))+" ms"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:581,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:581,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.accentDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>E("accentDecay",e),label:"Acc Dec",size:"md",color:"#ff3333",formatValue:e=>Math.round($X*Math.pow(10,e))+" ms"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:582,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:582,columnNumber:15},void 0),Yn.jsxDEV("div",{style:{width:"65px"},children:Yn.jsxDEV(KX,{value:r.devilFish?.accentSoftAttack??.5,min:0,max:1,defaultValue:.5,onChange:e=>E("accentSoftAttack",e),label:"Acc Soft",size:"md",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:583,columnNumber:46},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:583,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:575,columnNumber:13},void 0),"fx"===d&&!s&&Yn.jsxDEV("div",{className:"flex items-start gap-5 h-full px-6 py-3",children:[Yn.jsxDEV("div",{className:"flex flex-col gap-2",children:[Yn.jsxDEV("span",{className:"text-[9px] font-bold text-green-400/60 tracking-wider",children:"DIMENSION"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:592,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-[9px] text-gray-400 flex-shrink-0",children:"Mode"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:594,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"flex gap-1",children:[0,1,2,3,4].map(e=>{const t=r.chorus?.enabled&&(r.chorus?.mode??0)>0?r.chorus?.mode??0:0;return Yn.jsxDEV("button",{onClick:()=>S({mode:e,enabled:e>0}),className:mn("px-2.5 py-1 text-[10px] font-bold rounded border transition-all",t===e?"bg-green-500 text-white border-green-400":"bg-black/50 text-green-400/50 border-green-900/40 hover:border-green-500/50"),children:0===e?"Off":e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:599,columnNumber:25},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:595,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:593,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-[9px] text-gray-400 flex-shrink-0 w-8",children:"Mix"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:610,columnNumber:19},void 0),Yn.jsxDEV("input",{type:"range",min:0,max:1,step:.01,value:r.chorus?.mix??.5,onChange:e=>S({mix:parseFloat(e.target.value)}),className:"flex-1 h-1.5 accent-green-500 cursor-pointer",style:{minWidth:"80px"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:611,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[10px] text-gray-300 w-8 text-right tabular-nums",children:[Math.round(100*(r.chorus?.mix??.5)),"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:614,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:609,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:591,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px self-stretch bg-white/5 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:617,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"flex flex-col gap-1.5 flex-1",children:[Yn.jsxDEV("span",{className:"text-[9px] font-bold text-green-400/60 tracking-wider",children:"DELAY"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:620,columnNumber:17},void 0),[{label:"Time",key:"time",min:0,max:16,step:1,value:r.delay?.time??3,fmt:e=>`${e} 16ths`},{label:"Feedback",key:"feedback",min:0,max:1,step:.01,value:r.delay?.feedback??.3,fmt:e=>`${Math.round(100*e)}%`},{label:"Tone",key:"tone",min:0,max:1,step:.01,value:r.delay?.tone??.5,fmt:e=>e<.4?"LP":e>.6?"HP":"Bypass"},{label:"Mix",key:"mix",min:0,max:1,step:.01,value:r.delay?.mix??0,fmt:e=>`${Math.round(100*e)}%`},{label:"Spread",key:"stereo",min:0,max:1,step:.01,value:r.delay?.stereo??.75,fmt:e=>`${Math.round(100*e)}%`}].map(e=>Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-[9px] text-gray-400 w-14 flex-shrink-0",children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:629,columnNumber:21},void 0),Yn.jsxDEV("input",{type:"range",min:e.min,max:e.max,step:e.step,value:e.value,onChange:n=>{const s=parseFloat(n.target.value);((e,n)=>{const s=m.current.delay||{enabled:!1,time:3,feedback:0,tone:.5,mix:0,stereo:.75};t({delay:{...s,enabled:!0,[e]:n}})})(e.key,"convert"in e?e.convert(s):s)},className:"flex-1 h-1.5 accent-green-500 cursor-pointer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:630,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-[10px] text-gray-300 w-14 text-right tabular-nums",children:e.fmt(e.value)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:636,columnNumber:21},void 0)]},e.key,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:628,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:619,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:589,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:517,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"absolute top-4 left-6 flex items-center gap-4",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("div",{className:"bg-accent-primary p-1 rounded",children:Yn.jsxDEV("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"black",strokeWidth:"3",children:Yn.jsxDEV("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:647,columnNumber:151},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:647,columnNumber:60},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:647,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex flex-col -space-y-1",children:[Yn.jsxDEV("span",{className:"text-white font-black italic text-xl tracking-tighter",children:"DB-303"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:649,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-[8px] text-gray-500 font-bold uppercase tracking-widest",children:"TB-303 WASM Engine"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:650,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:648,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:646,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"h-8 w-px bg-white/5"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:653,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex flex-col",children:[Yn.jsxDEV("label",{className:"text-[8px] font-bold text-gray-500 mb-1",children:"PRESET"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:655,columnNumber:13},void 0),Yn.jsxDEV("select",{value:"",onChange:e=>{const s=Hy.find(t=>t.name===e.target.value);s&&(n?n(s):s.tb303&&t(s.tb303))},className:"bg-[#111] text-[10px] text-accent-primary border border-white/5 rounded px-2 py-1 outline-none focus:border-accent-primary transition-colors max-w-[160px]",children:[Yn.jsxDEV("option",{value:"",disabled:!0,children:"Load Preset..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:657,columnNumber:15},void 0),Hy.map(e=>Yn.jsxDEV("option",{value:e.name,children:[e.name,e.effects?.length?` [${e.effects.length} FX]`:""]},e.name,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:657,columnNumber:91},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:656,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:654,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:645,columnNumber:9},void 0),void 0!==a&&Yn.jsxDEV("div",{className:"absolute pointer-events-none",style:{top:"10px",left:"480px",right:"20px",height:"80px"},children:Yn.jsxDEV("div",{className:"viz-frame w-full h-full",children:[Yn.jsxDEV("div",{className:"viz-frame__content",children:[Yn.jsxDEV(JX,{config:r,instrumentId:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:666,columnNumber:17},void 0),Yn.jsxDEV(QX,{instrumentId:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:667,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:665,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"viz-frame__glass"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:669,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"viz-frame__vignette"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:670,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:664,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:663,columnNumber:11},void 0),o&&Yn.jsxDEV("div",{className:"absolute top-2 right-5 z-10 flex items-center gap-1",children:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:676,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"absolute bottom-0 left-0 right-0 flex items-center gap-2 px-4 py-1.5 bg-black/50 border-t border-white/5",children:[Yn.jsxDEV(pn,{size:12,className:"text-yellow-500/70 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:683,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>v(-1),className:"text-gray-600 hover:text-gray-400 text-[10px] flex-shrink-0 px-0.5",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:684,columnNumber:11},void 0),Yn.jsxDEV("span",{className:mn("text-[10px] text-gray-400 flex-1 transition-opacity duration-200 min-w-0 truncate",g?"opacity-0":"opacity-100"),title:YX[h],children:YX[h]},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:685,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>v(1),className:"text-gray-600 hover:text-gray-400 text-[10px] flex-shrink-0 px-0.5",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:694,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-[7px] text-gray-600 font-mono flex-shrink-0 ml-2",children:["V",yV]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:695,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:682,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:449,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/controls/JC303StyledKnobPanel.tsx",lineNumber:444,columnNumber:5},void 0);var P,_,O});ZX.displayName="JC303StyledKnobPanel";const ez=({children:e,className:t=""})=>{const n=l.useRef(null),[s,a]=l.useState(!1);return l.useEffect(()=>{const e=n.current;if(!e)return;const t=e=>{const t=e.target;(t.closest("[data-prevent-scroll]")||t.closest(".knob-body")||t.closest('[role="slider"]')||t.closest('input[type="range"]'))&&a(!0)},s=()=>{a(!1)};return e.addEventListener("touchstart",t,{passive:!0}),e.addEventListener("touchend",s,{passive:!0}),e.addEventListener("touchcancel",s,{passive:!0}),()=>{e.removeEventListener("touchstart",t),e.removeEventListener("touchend",s),e.removeEventListener("touchcancel",s)}},[]),l.useEffect(()=>{if(s){const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[s]),Yn.jsxDEV("div",{ref:n,className:`scroll-lock-container ${t}`,style:{overflowY:s?"hidden":"auto",touchAction:s?"none":"auto"},children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ScrollLockContainer.tsx",lineNumber:68,columnNumber:5},void 0)},tz=l.memo(()=>{const{instruments:e,updateInstrument:t}=EN(us(e=>({instruments:e.instruments,updateInstrument:e.updateInstrument}))),{tb303Collapsed:n,toggleTB303Collapsed:s,tb303PoppedOut:a,setTB303PoppedOut:o}=LN(us(e=>({tb303Collapsed:e.tb303Collapsed,toggleTB303Collapsed:e.toggleTB303Collapsed,tb303PoppedOut:e.tb303PoppedOut,setTB303PoppedOut:e.setTB303PoppedOut}))),{controlledInstrumentId:r}=OM(),i=r?e.find(e=>e.id===r&&"TB303"===e.synthType):e.find(e=>"TB303"===e.synthType),c=l.useCallback(e=>{if(!i)return;const n=EN.getState().instruments.find(e=>e.id===i.id);n?.tb303&&t(i.id,{tb303:{...n.tb303,...e}})},[i,t]),u=l.useCallback(async e=>{if(i&&(e.tb303&&c(e.tb303),void 0!==e.effects)){const n=e.effects.map((e,t)=>({...e,id:e.id||`tb303-fx-${Date.now()}-${t}`}));t(i.id,{effects:n});const{getToneEngine:s}=await os(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>Iw);return{getToneEngine:e}},void 0),a=s();await a.rebuildInstrumentEffects(i.id,n)}},[i,c,t]);if(!i||!i.tb303)return a?Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>o(!1),title:"DEViLBOX  TB-303",width:1200,height:640,fitContent:!0,children:Yn.jsxDEV("div",{className:"flex items-center justify-center h-full text-gray-500 text-sm",children:"No TB-303 instrument found"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:89,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:81,columnNumber:9},void 0):null;if(a)return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>o(!1),title:"DEViLBOX  TB-303",width:1200,height:640,fitContent:!0,children:Yn.jsxDEV("div",{style:{background:"#1a1a1a"},children:Yn.jsxDEV(ez,{children:Yn.jsxDEV(ZX,{config:i.tb303,onChange:c,onPresetLoad:u,instrumentId:i.id},i.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:112,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:111,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:110,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:102,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",height:"40px",background:"#1a1a1a",borderTop:"1px solid #333"},children:[Yn.jsxDEV("div",{className:"absolute top-0 left-0 p-2 text-xs font-mono text-accent-primary flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"font-bold",children:"TB-303"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:135,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-gray-500",children:"Popped Out"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:136,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:134,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"absolute top-0 right-0 z-50",children:Yn.jsxDEV("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80 rounded-bl-lg flex items-center gap-1 text-xs",onClick:()=>o(!1),title:"Restore panel inline",children:[Yn.jsxDEV(nn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:144,columnNumber:15},void 0),"Restore"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:139,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:138,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:124,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:101,columnNumber:7},void 0);if(n)return Yn.jsxDEV("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",height:"40px",background:"#1a1a1a",borderTop:"1px solid #333"},children:[Yn.jsxDEV("div",{className:"absolute top-0 right-0 z-50",children:Yn.jsxDEV("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:s,title:"Expand synth panel",children:Yn.jsxDEV(De,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:172,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:167,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:166,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"absolute top-0 left-0 p-2 text-xs font-mono text-accent-primary flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"font-bold",children:"TB-303"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:176,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-gray-500",children:["CH",String(e.indexOf(i)+1).padStart(2,"0")]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:177,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-gray-400",children:i.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:178,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:175,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:156,columnNumber:7},void 0);const d=Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{className:"p-1.5 text-gray-500 hover:text-cyan-400 bg-black/40 hover:bg-black/70 rounded transition-colors",onClick:()=>{a?FU("DEViLBOX  TB-303"):o(!0)},title:"Pop out to separate window",children:Yn.jsxDEV(He,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:198,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:187,columnNumber:7},void 0),Yn.jsxDEV("button",{className:"p-1.5 text-gray-500 hover:text-white bg-black/40 hover:bg-black/70 rounded transition-colors",onClick:s,title:"Collapse synth panel",children:Yn.jsxDEV(jt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:205,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:200,columnNumber:7},void 0),Yn.jsxDEV("button",{className:"p-1.5 text-gray-500 hover:text-red-400 bg-black/40 hover:bg-black/70 rounded transition-colors",onClick:()=>LN.getState().setTB303Collapsed(!0),title:"Close synth panel",children:Yn.jsxDEV(Ce,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:212,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:207,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:186,columnNumber:5},void 0);return Yn.jsxDEV("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",maxHeight:"400px",background:"#1a1a1a",borderTop:"1px solid #333",overflow:"auto"},children:Yn.jsxDEV(ez,{children:Yn.jsxDEV(ZX,{config:i.tb303,onChange:c,onPresetLoad:u,instrumentId:i.id,headerActions:d},i.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:231,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:230,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TB303KnobPanel.tsx",lineNumber:219,columnNumber:5},void 0)});tz.displayName="TB303KnobPanel";const nz=a.memo(()=>{const{loadPatterns:e,setPatternOrder:t,furnaceSubsongs:n,furnaceActiveSubsong:s,setFurnaceActiveSubsong:a}=ID(us(e=>({loadPatterns:e.loadPatterns,setPatternOrder:e.setPatternOrder,furnaceSubsongs:e.furnaceSubsongs,furnaceActiveSubsong:e.furnaceActiveSubsong,setFurnaceActiveSubsong:e.setFurnaceActiveSubsong}))),{setBPM:o,setSpeed:r}=jN(us(e=>({setBPM:e.setBPM,setSpeed:e.setSpeed}))),i=l.useCallback(i=>{if(!n||i===s)return;const l=n[i];l&&(e(l.patterns),t(l.songPositions),o(l.initialBPM),r(l.initialSpeed),pD().setSpeed2(void 0!==l.speed2&&l.speed2!==l.initialSpeed?l.speed2:null),a(i),_k.success(`Switched to: ${l.name||`Subsong ${i+1}`}`))},[n,s,e,t,o,r,a]);return!n||n.length<=1?null:Yn.jsxDEV("div",{className:"flex items-center gap-1.5 ml-1 pl-2 border-l border-dark-border",children:[Yn.jsxDEV(Jt,{size:14,className:"shrink-0 text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/SubsongSelector.tsx",lineNumber:56,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"text-[10px] text-text-secondary font-medium",children:"SUBSONG:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/SubsongSelector.tsx",lineNumber:57,columnNumber:7},void 0),Yn.jsxDEV("select",{value:s,onChange:e=>i(Number(e.target.value)),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors cursor-pointer outline-none",title:"Select subsong (Furnace multi-song module)",children:n.map((e,t)=>Yn.jsxDEV("option",{value:t,children:[t+1,". ",e.name||`Subsong ${t+1}`]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/SubsongSelector.tsx",lineNumber:65,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/SubsongSelector.tsx",lineNumber:58,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"text-[10px] text-text-muted",children:["(",s+1,"/",n.length,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/SubsongSelector.tsx",lineNumber:70,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/SubsongSelector.tsx",lineNumber:55,columnNumber:5},void 0)});nz.displayName="SubsongSelector";const sz=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],az=[1,3,6,8,10],oz=({step:e,stepIndex:t,position:n,onChange:s,onClose:a,onNavigate:o,unitId:r=1})=>{const[i,c]=l.useState(!0),u=l.useRef(null);l.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&a()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[a]),l.useEffect(()=>{const e=e=>{"Escape"===e.key&&a()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]);const d=l.useCallback(t=>{if(s({note:t}),i)try{const n=Bw(),s=EN.getState().instruments.find(e=>e.id===r);if(s&&n){const a=`${t}${e.octave??2}`;n.triggerNote(r,a,.2,Y(),.8,s,e.accent,e.slide)}}catch(n){}},[s,i,r,e.octave,e.accent,e.slide]),m=l.useCallback(t=>{const n=e.octave===t?2:t;s({octave:n})},[e.octave,s]),p=l.useCallback(t=>{s({[t]:!e[t]})},[e,s]),h={position:"fixed",left:`${n.x}px`,top:`${n.y}px`,transform:"translate(-50%, -100%) translateY(-10px)",zIndex:1e4};return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"piano-popover-overlay"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:103,columnNumber:7},void 0),Yn.jsxDEV("div",{ref:u,className:"piano-popover",style:h,children:[Yn.jsxDEV("div",{className:"popover-header",children:[Yn.jsxDEV("div",{className:"step-navigation",children:[Yn.jsxDEV("button",{className:"nav-btn",onClick:()=>o("prev"),"aria-label":"Previous step",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:110,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"step-indicator",children:["Step ",(t+1).toString().padStart(2,"0")]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:117,columnNumber:13},void 0),Yn.jsxDEV("button",{className:"nav-btn",onClick:()=>o("next"),"aria-label":"Next step",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:120,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:109,columnNumber:11},void 0),Yn.jsxDEV("button",{className:"close-btn",onClick:a,"aria-label":"Close",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:128,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:108,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"popover-controls",children:[Yn.jsxDEV("div",{className:"control-group",children:[Yn.jsxDEV("div",{className:"control-label",children:"Octave"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:141,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"octave-selector",children:[Yn.jsxDEV("button",{className:"octave-select-btn "+(1===e.octave?"active":""),onClick:()=>m(1),children:"DN"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:143,columnNumber:15},void 0),Yn.jsxDEV("button",{className:"octave-select-btn "+(2===e.octave?"active":""),onClick:()=>m(2),children:"MID"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:149,columnNumber:15},void 0),Yn.jsxDEV("button",{className:"octave-select-btn "+(3===e.octave?"active":""),onClick:()=>m(3),children:"UP"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:155,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:142,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:140,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"control-group",children:[Yn.jsxDEV("div",{className:"control-label",children:"Modifiers"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:166,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"modifier-toggles",children:[Yn.jsxDEV("button",{className:"modifier-btn accent "+(e.accent?"active":""),onClick:()=>p("accent"),children:Yn.jsxDEV("span",{children:"AC"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:172,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:168,columnNumber:15},void 0),Yn.jsxDEV("button",{className:"modifier-btn slide "+(e.slide?"active":""),onClick:()=>p("slide"),children:Yn.jsxDEV("span",{children:"SL"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:178,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:174,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:167,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:165,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"control-group",children:[Yn.jsxDEV("div",{className:"control-label",children:"TT-303"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:185,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"modifier-toggles",children:[Yn.jsxDEV("button",{className:"modifier-btn mute "+(e.mute?"active":""),onClick:()=>p("mute"),title:"Mute - silent step, data preserved",children:Yn.jsxDEV("span",{children:"MT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:192,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:187,columnNumber:15},void 0),Yn.jsxDEV("button",{className:"modifier-btn hammer "+(e.hammer?"active":""),onClick:()=>p("hammer"),title:"Hammer - legato without pitch glide",children:Yn.jsxDEV("span",{children:"HM"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:199,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:194,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:186,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:184,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"preview-toggle",children:[Yn.jsxDEV("input",{type:"checkbox",id:`preview-${r}-${t}`,checked:i,onChange:e=>c(e.target.checked)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:206,columnNumber:13},void 0),Yn.jsxDEV("label",{htmlFor:`preview-${r}-${t}`,children:"Preview Sound"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:212,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:205,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:138,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"piano-keyboard-container",children:[Yn.jsxDEV("div",{className:"piano-keyboard-white-layer",children:sz.map((t,n)=>{if(az.includes(n))return null;const s=e.note===t;return Yn.jsxDEV("div",{className:"piano-key white "+(s?"selected":""),onClick:()=>d(t),children:Yn.jsxDEV("div",{className:"key-label",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:231,columnNumber:19},void 0)},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:226,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:221,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"piano-keyboard-black-layer",children:sz.map((t,n)=>{if(!az.includes(n))return null;const s=e.note===t,a=100/7,o=sz.slice(0,n).filter((e,t)=>!az.includes(t)).length*a-3.5714285714285716;return Yn.jsxDEV("div",{className:"piano-key black "+(s?"selected":""),style:{left:`${o}%`,width:"8.571428571428571%"},onClick:()=>d(t),children:Yn.jsxDEV("div",{className:"key-label",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:255,columnNumber:19},void 0)},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:249,columnNumber:17},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:238,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:219,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:106,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/PianoPopover.tsx",lineNumber:101,columnNumber:5},void 0)},rz=({steps:e,currentStep:t=-1,isPlaying:n=!1,onStepChange:s,onStepToggle:a,unitId:o=1})=>{const[r,i]=l.useState(null),c=l.useRef(null),u=l.useCallback(e=>{a&&a(e)},[a]),d=l.useCallback((e,t)=>{e.stopPropagation();const n=e.target.getBoundingClientRect();i({visible:!0,stepIndex:t,x:n.left+n.width/2,y:n.top})},[]),m=l.useCallback((t,n,a)=>{if(t.stopPropagation(),!s)return;const o=e[n],r=o.octave===a?2:a;s(n,{...o,octave:r})},[e,s]),p=l.useCallback((t,n,a)=>{if(t.stopPropagation(),!s)return;const o=e[n];s(n,{...o,[a]:!o[a]})},[e,s]),h=l.useCallback((t,n)=>{if(!s)return;const a=e[t];s(t,{...a,...n})},[e,s]),f=l.useCallback(()=>{i(null)},[]),g=l.useCallback(e=>{if(!r)return;const t="prev"===e?(r.stepIndex-1+16)%16:(r.stepIndex+1)%16;i({...r,stepIndex:t})},[r]);return Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{ref:c,className:"tb303-sequencer",children:e.map((e,s)=>Yn.jsxDEV("div",{className:`\n              tb303-step\n              ${e.active?"active":""}\n              ${n&&s===t?"current":""}\n            `,onClick:()=>u(s),children:[Yn.jsxDEV("div",{className:"step-led"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:114,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"step-note",onClick:e=>d(e,s),children:e.note},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:117,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"step-octave-btns",children:[Yn.jsxDEV("div",{className:"octave-btn "+(1===e.octave?"active":""),onClick:e=>m(e,s,1),children:"DN"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:126,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"octave-btn "+(3===e.octave?"active":""),onClick:e=>m(e,s,3),children:"UP"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:132,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:125,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"step-toggles",children:[Yn.jsxDEV("div",{className:"toggle-btn accent "+(e.accent?"active":""),onClick:e=>p(e,s,"accent"),children:"AC"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:142,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"toggle-btn slide "+(e.slide?"active":""),onClick:e=>p(e,s,"slide"),children:"SL"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:148,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:141,columnNumber:13},void 0)]},s,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:104,columnNumber:11},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:102,columnNumber:7},void 0),r?.visible&&Yn.jsxDEV(oz,{step:e[r.stepIndex],stepIndex:r.stepIndex,position:{x:r.x,y:r.y},onChange:e=>h(r.stepIndex,e),onClose:f,onNavigate:g,unitId:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:161,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/sequencer/TB303Sequencer.tsx",lineNumber:101,columnNumber:5},void 0)},iz=e=>{if("number"==typeof e){if(0===e||97===e)return{note:"C",octave:2};const t=Ga(e),n=t.substring(0,2),s=t.substring(2),a=parseInt(s,10);let o=2;a<=2?o=1:a>=4&&(o=3);return{note:n.replace("-",""),octave:o}}if("string"==typeof e){if(!e||"..."===e||"==="===e)return{note:"C",octave:2};const t=e.substring(0,2),n=e.substring(2),s=parseInt(n,10);let a=2;s<=2?a=1:s>=4&&(a=3);return{note:t.replace("-",""),octave:a}}return{note:"C",octave:2}},lz=(e,t)=>{const n=1===t?2:2===t?3:4;return Xa(`${1===e.length?`${e}-`:e}${n}`)},cz=({channelIndex:e=0})=>{const{patterns:t,currentPatternIndex:n,setCell:s}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,setCell:e.setCell}))),{instruments:a,updateInstrument:o,addInstrument:r}=EN(us(e=>({instruments:e.instruments,updateInstrument:e.updateInstrument,addInstrument:e.addInstrument}))),i=jN(e=>e.isPlaying),c=jN(e=>e.currentRow),u=jN(e=>e.bpm),d=t[n],m=d?.channels[e],p=l.useMemo(()=>a.filter(e=>"TB303"===e.synthType||"Buzz3o3"===e.synthType),[a]),h=m?.instrumentId??0;let f=a.find(e=>e.id===h);l.useEffect(()=>{if(!f||"TB303"!==f.synthType&&"Buzz3o3"!==f.synthType)if(0===p.length){const t=EN.getState().instruments.map(e=>e.id);let n=1;for(let e=1;e<=128;e++)if(!t.includes(e)){n=e;break}const s={id:n,name:"TB-303",type:"synth",synthType:"TB303",volume:.7,pan:0,monophonic:!0,effects:[],tb303:{...La}};r(s),ID.setState(t=>{const n=t.patterns[t.currentPatternIndex];n&&n.channels[e]&&(n.channels[e].instrumentId=s.id)})}else 1===p.length&&ID.setState(t=>{const n=t.patterns[t.currentPatternIndex];n&&n.channels[e]&&(n.channels[e].instrumentId=p[0].id)})},[f,p,e,r]),f=a.find(e=>e.id===(m?.instrumentId??0));const g=i?c%16:-1,[b,v]=l.useState(!1),y=l.useRef(f),x=l.useRef(f?.tb303);l.useEffect(()=>{y.current=f,x.current=f?.tb303},[f]);const N=l.useRef(null),w=l.useCallback(e=>{N.current&&clearTimeout(N.current),N.current=window.setTimeout(()=>{o(h,e),N.current=null},300)},[h,o]),E=f?.tb303,k="square"===E?.oscillator.type?1:0,D=E?.filter.cutoff??.5,S=E?.filter.resonance??.5,M=E?.filterEnvelope.envMod??.5,C=E?.devilFish?.enabled?E?.devilFish?.normalDecay??.164:E?.filterEnvelope.decay??.5,V=E?.accent.amount??.5,P=l.useMemo(()=>{if(!d||!d.channels[e])return Array.from({length:16},()=>({active:!1,note:"C",octave:2,accent:!1,slide:!1}));const t=d.channels[e],n=[];for(let e=0;e<16;e++){const s=t.rows[e],a=!(!s||!s.note||0===s.note||97===s.note),{note:o,octave:r}=a?iz(s.note):{note:"C",octave:2};n.push({active:a,note:o,octave:r,accent:!(1!==s?.flag1&&1!==s?.flag2),slide:!(2!==s?.flag1&&2!==s?.flag2)})}return n},[d,e]),_=l.useCallback(e=>{const t=x.current;if(!y.current||!t)return;const n={...t,oscillator:{...t.oscillator,type:e<.5?"sawtooth":"square"}};Bw().updateTB303Parameters(h,n),w({tb303:n})},[h,w]),O=l.useCallback(e=>{const t=x.current;if(!y.current||!t)return;const n={...t,filter:{...t.filter,cutoff:e}};Bw().updateTB303Parameters(h,n),w({tb303:n})},[h,w]),T=l.useCallback(e=>{const t=x.current;if(!y.current||!t)return;const n={...t,filter:{...t.filter,resonance:e}};Bw().updateTB303Parameters(h,n),w({tb303:n})},[h,w]),L=l.useCallback(e=>{const t=x.current;if(!y.current||!t)return;const n={...t,filterEnvelope:{...t.filterEnvelope,envMod:e}};Bw().updateTB303Parameters(h,n),w({tb303:n})},[h,w]),A=l.useCallback(e=>{const t=x.current;if(!y.current||!t)return;const n={...t,filterEnvelope:{...t.filterEnvelope,decay:e},devilFish:{...La.devilFish,...t.devilFish||{},normalDecay:e}};Bw().updateTB303Parameters(h,n),w({tb303:n})},[h,w]),B=l.useCallback(e=>{const t=x.current;if(!y.current||!t)return;const n={...t,accent:{...t.accent,amount:e}};Bw().updateTB303Parameters(h,n),w({tb303:n})},[h,w]),I=l.useCallback((t,n)=>{s(e,t,{note:n.active?lz(n.note,n.octave):0,flag1:n.accent?1:void 0,flag2:n.slide?2:void 0})},[e,s]),F=l.useCallback(t=>{const n=P[t],a=!n.active;s(e,t,{note:a?lz(n.note,n.octave):0,flag1:n.accent?1:void 0,flag2:n.slide?2:void 0})},[e,s,P]),U=l.useCallback(t=>{ID.setState(n=>{const s=n.patterns[n.currentPatternIndex];s&&s.channels[e]&&(s.channels[e].instrumentId=t)})},[e]);return f?E||"TB303"===f.synthType||"Buzz3o3"===f.synthType?Yn.jsxDEV("div",{className:"tb303-view",children:[Yn.jsxDEV(Yn.Fragment,{children:[p.length>1&&Yn.jsxDEV("div",{className:"tb303-instrument-selector",children:[Yn.jsxDEV("label",{htmlFor:"tb303-instrument-select",children:"TB-303 Instrument:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:410,columnNumber:15},void 0),Yn.jsxDEV("select",{id:"tb303-instrument-select",value:h,onChange:e=>U(Number(e.target.value)),className:"instrument-select",children:p.map(e=>Yn.jsxDEV("option",{value:e.id,children:[e.name," (ID: ",e.id,")"]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:418,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:411,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:409,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"tb303-transport",children:[i&&Yn.jsxDEV("div",{className:"transport-step",children:["Step ",(g+1).toString().padStart(2,"0"),"/16 @ ",u," BPM"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:429,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"transport-spacer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:434,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>v(!0),className:"pattern-btn acid",children:[Yn.jsxDEV(Nt,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:437,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Acid"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:438,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:436,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>{const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let n=0;n<16;n++){const a=Math.random()>.3,o=t[Math.floor(Math.random()*t.length)],r=Math.floor(3*Math.random())+1,i=Math.random()>.7,l=Math.random()>.8;s(e,n,{note:a?lz(o,r):0,flag1:i?1:0,flag2:l?2:0})}},className:"pattern-btn randomize",children:[Yn.jsxDEV(wt,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:442,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Random"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:443,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:441,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>{for(let t=0;t<16;t++)s(e,t,{note:0,flag1:0,flag2:0})},className:"pattern-btn clear",children:[Yn.jsxDEV(Ie,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:447,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Clear"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:448,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:446,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:427,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"tb303-sequencer-section",children:[Yn.jsxDEV("h3",{className:"section-title",children:"Pattern Sequencer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:454,columnNumber:13},void 0),Yn.jsxDEV(rz,{steps:P,currentStep:g,isPlaying:i,onStepChange:I,onStepToggle:F,unitId:1},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:455,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:453,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"tb303-params-section",children:[Yn.jsxDEV("h3",{className:"section-title",children:"TB-303 Parameters"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:467,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"params-grid",children:[Yn.jsxDEV("div",{className:"param-item",children:[Yn.jsxDEV(KX,{label:"Waveform",value:k,min:0,max:1,step:.01,onChange:_,bipolar:!1,size:"md"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:470,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"param-value",children:k<.5?"Saw":"Square"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:480,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:469,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"param-item",children:Yn.jsxDEV(KX,{label:"Cutoff",value:D,min:0,max:1,onChange:O,bipolar:!1,size:"md",formatValue:e=>Math.round(314*Math.pow(2394/314,e))+" Hz"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:486,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:485,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"param-item",children:Yn.jsxDEV(KX,{label:"Resonance",value:S,min:0,max:1,onChange:T,bipolar:!1,size:"md",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:499,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:498,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"param-item",children:Yn.jsxDEV(KX,{label:"Env Mod",value:M,min:0,max:1,onChange:L,bipolar:!1,size:"md",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:512,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:511,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"param-item",children:Yn.jsxDEV(KX,{label:"Decay",value:C,min:0,max:1,onChange:A,bipolar:!1,size:"md",formatValue:e=>Math.round(200*Math.pow(10,e))+" ms"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:525,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:524,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"param-item",children:Yn.jsxDEV(KX,{label:"Accent",value:V,min:0,max:1,onChange:B,bipolar:!1,size:"md",formatValue:e=>Math.round(100*e)+"%"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:538,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:537,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:468,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:466,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:406,columnNumber:7},void 0),b&&Yn.jsxDEV(ZO,{channelIndex:e,onClose:()=>v(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:556,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:404,columnNumber:5},void 0):Yn.jsxDEV("div",{className:"tb303-view",children:Yn.jsxDEV("div",{className:"tb303-error",children:["Channel ",e+1," is using ",f.synthType,", not TB-303"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:396,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:395,columnNumber:7},void 0):Yn.jsxDEV("div",{className:"tb303-view",children:Yn.jsxDEV("div",{className:"tb303-error",children:["No instrument assigned to channel ",e+1]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:386,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/demo/TB303View.tsx",lineNumber:385,columnNumber:7},void 0)},uz=[{id:"pattern",label:"Pattern",icon:Yn.jsxDEV(ut,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileTabBar.tsx",lineNumber:23,columnNumber:44},void 0)},{id:"instruments",label:"Instruments",icon:Yn.jsxDEV(Jt,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileTabBar.tsx",lineNumber:24,columnNumber:52},void 0)}],dz=({activeTab:e,onTabChange:t})=>Yn.jsxDEV("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-dark-bgSecondary border-t border-dark-border safe-area-bottom",children:Yn.jsxDEV("div",{className:"flex items-stretch",children:uz.filter(e=>e&&e.icon).map(n=>{const s=e===n.id;return Yn.jsxDEV("button",{onClick:()=>t(n.id),className:`\n                flex-1 flex flex-col items-center justify-center gap-1\n                py-2 min-h-[56px] transition-colors\n                ${s?"text-accent-primary bg-accent-primary/10":"text-text-muted hover:text-text-secondary active:bg-dark-bgTertiary"}\n              `,"aria-current":s?"page":void 0,children:[Yn.jsxDEV("span",{className:s?"scale-110 transition-transform":"",children:n.icon},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileTabBar.tsx",lineNumber:50,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-[10px] font-medium",children:n.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileTabBar.tsx",lineNumber:53,columnNumber:15},void 0)]},n.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileTabBar.tsx",lineNumber:37,columnNumber:13},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileTabBar.tsx",lineNumber:33,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/MobileTabBar.tsx",lineNumber:32,columnNumber:5},void 0),mz={TB303:{type:"TB303",name:"TB-303",shortName:"303",description:"Classic acid bass synthesizer with resonant filter and slide",bestFor:["Acid bass","Squelchy lines","Techno","House"],icon:"Zap",color:"text-accent-primary"},MonoSynth:{type:"MonoSynth",name:"Mono Synth",shortName:"Mono",description:"Single-voice synth with oscillator, filter, and envelope",bestFor:["Bass","Lead lines","Portamento"],icon:"AudioLines",color:"text-blue-400"},Synth:{type:"Synth",name:"Basic Synth",shortName:"Synth",description:"Simple polyphonic synthesizer with amplitude envelope",bestFor:["Pads","Chords","Simple sounds"],icon:"Music2",color:"text-purple-400"},DuoSynth:{type:"DuoSynth",name:"Duo Synth",shortName:"Duo",description:"Two-voice synth with harmonics and vibratoesque LFO",bestFor:["Rich leads","Detuned sounds","Fat bass"],icon:"Layers",color:"text-indigo-400"},FMSynth:{type:"FMSynth",name:"FM Synth",shortName:"FM",description:"Frequency modulation synth for complex harmonic tones",bestFor:["Bells","Electric piano","Metallic sounds"],icon:"Radio",color:"text-cyan-400"},AMSynth:{type:"AMSynth",name:"AM Synth",shortName:"AM",description:"Amplitude modulation synth with ring modulation character",bestFor:["Tremolo effects","Ring mod","Atmospheric"],icon:"Activity",color:"text-teal-400"},PluckSynth:{type:"PluckSynth",name:"Pluck Synth",shortName:"Pluck",description:"Karplus-Strong string synthesis for plucked strings",bestFor:["Guitar","Harp","Pizzicato","String plucks"],icon:"Guitar",color:"text-amber-400"},MembraneSynth:{type:"MembraneSynth",name:"Membrane Synth",shortName:"Membrane",description:"Drum membrane simulation for kicks and toms",bestFor:["Kick drums","Toms","Percussion"],icon:"Circle",color:"text-orange-400"},MetalSynth:{type:"MetalSynth",name:"Metal Synth",shortName:"Metal",description:"Metallic percussion synthesis with harmonics",bestFor:["Hi-hats","Cymbals","Bells","Metallic hits"],icon:"Hexagon",color:"text-yellow-400"},NoiseSynth:{type:"NoiseSynth",name:"Noise Synth",shortName:"Noise",description:"Filtered noise generator with envelope",bestFor:["Snares","Hi-hats","Risers","FX"],icon:"Hash",color:"text-gray-400"},Wavetable:{type:"Wavetable",name:"Wavetable",shortName:"Wave",description:"Wavetable synth with morphing and unison",bestFor:["Evolving pads","Modern bass","Complex timbres"],icon:"Waves",color:"text-pink-400"},HarmonicSynth:{type:"HarmonicSynth",name:"Harmonic Synth",shortName:"Harmonic",description:"Additive/spectral synth with 32-harmonic editor",bestFor:["Organ tones","Bells","Custom timbres","Spectral design"],icon:"BarChart3",color:"text-emerald-400"},Sampler:{type:"Sampler",name:"Sampler",shortName:"Sampler",description:"Multi-sample playback with velocity layers",bestFor:["Realistic instruments","Sample kits","One-shots"],icon:"FileAudio",color:"text-rose-400"},Player:{type:"Player",name:"Sample Player",shortName:"Player",description:"Simple one-shot sample playback",bestFor:["Loops","One-shots","Vocal samples"],icon:"Play",color:"text-lime-400"},GranularSynth:{type:"GranularSynth",name:"Granular Synth",shortName:"Granular",description:"Sample-based granular synthesis with grain manipulation",bestFor:["Textures","Pads","Ambient","Sound design","Glitch"],icon:"Sparkles",color:"text-violet-400"},SuperSaw:{type:"SuperSaw",name:"SuperSaw",shortName:"SSaw",description:"Massive detuned saw waves for trance and EDM",bestFor:["Trance leads","EDM drops","Big chords","Supersaw stabs"],icon:"Layers",color:"text-orange-500"},PolySynth:{type:"PolySynth",name:"Poly Synth",shortName:"Poly",description:"True polyphonic synth with voice management",bestFor:["Chords","Pads","Polyphonic parts","Layered sounds"],icon:"LayoutGrid",color:"text-blue-500"},Organ:{type:"Organ",name:"Drawbar Organ",shortName:"Organ",description:"Hammond-style tonewheel organ with drawbars",bestFor:["House","Gospel","Jazz","Rock organ"],icon:"Piano",color:"text-amber-600"},DrumMachine:{type:"DrumMachine",name:"Roland TR-808/909",shortName:"808/909",description:"Analog drum synthesis (808/909 style)",bestFor:["Kicks","Snares","Hi-hats","Electronic drums"],icon:"Disc",color:"text-red-500"},ChipSynth:{type:"ChipSynth",name:"Chip Synth",shortName:"Chip",description:"8-bit video game console sounds",bestFor:["Chiptune","Retro","Lo-fi","Arpeggios"],icon:"Gamepad2",color:"text-green-400"},PWMSynth:{type:"PWMSynth",name:"PWM Synth",shortName:"PWM",description:"Pulse width modulation for rich analog tones",bestFor:["Analog pads","Warm leads","Classic synth"],icon:"Waves",color:"text-emerald-400"},StringMachine:{type:"StringMachine",name:"String Machine",shortName:"Strings",description:"Vintage ensemble strings (Solina-style)",bestFor:["Lush pads","Disco strings","Ambient","Retro"],icon:"Music4",color:"text-rose-400"},FormantSynth:{type:"FormantSynth",name:"Formant Synth",shortName:"Vocal",description:"Vowel synthesis for vocal-like sounds",bestFor:["Vocal pads","Talk box","Choir","Robotic"],icon:"Mic",color:"text-fuchsia-400"},Furnace:{type:"Furnace",name:"Furnace FM",shortName:"FUI",description:"FM engine compatible with Furnace Tracker (.fui) instruments",bestFor:["Genesis bass","FM bells","Retro arcade","4-op FM"],icon:"Cpu",color:"text-amber-500"},FurnaceOPN:{type:"FurnaceOPN",name:"Sega Genesis (YM2612)",shortName:"Genesis",description:"Sega Genesis / Mega Drive YM2612 - 6 channels of 4-op FM",bestFor:["Genesis bass","FM leads","Slap bass","16-bit game music"],icon:"Gamepad2",color:"text-blue-500"},FurnaceOPM:{type:"FurnaceOPM",name:"Arcade / X68000 (YM2151)",shortName:"OPM",description:"Yamaha YM2151 - Sharp X68000, arcade machines",bestFor:["Arcade FM","Bright leads","Brass","Game music"],icon:"Cpu",color:"text-cyan-500"},FurnaceOPL:{type:"FurnaceOPL",name:"AdLib / Sound Blaster (OPL3)",shortName:"OPL3",description:"Yamaha YMF262 - AdLib, Sound Blaster, DOS games",bestFor:["DOS game music","MIDI synth","Organs","PC gaming"],icon:"Monitor",color:"text-yellow-500"},FurnaceOPLL:{type:"FurnaceOPLL",name:"MSX / Sega (OPLL)",shortName:"OPLL",description:"Yamaha YM2413 - MSX, SMS FM unit, budget FM",bestFor:["MSX music","SMS FM","Lo-fi FM","Simple FM"],icon:"Radio",color:"text-orange-400"},FurnaceESFM:{type:"FurnaceESFM",name:"ESFM",shortName:"ESFM",description:"Enhanced Sound FM - advanced OPL3 with operator detune",bestFor:["Modern retro","Enhanced FM","Detuned sounds"],icon:"Zap",color:"text-purple-500"},FurnaceOPZ:{type:"FurnaceOPZ",name:"Yamaha TX81Z (OPZ)",shortName:"OPZ",description:"Yamaha YM2414 - TX81Z, DX11, advanced FM",bestFor:["Lately bass","DX bells","Complex FM","E-piano"],icon:"Piano",color:"text-indigo-500"},FurnaceNES:{type:"FurnaceNES",name:"Nintendo NES (2A03)",shortName:"NES",description:"Nintendo Entertainment System - 2 pulse, triangle, noise, DPCM",bestFor:["NES chiptune","8-bit melodies","Retro drums","Famicom"],icon:"Gamepad2",color:"text-red-500"},FurnaceGB:{type:"FurnaceGB",name:"Nintendo Game Boy",shortName:"GB",description:"Nintendo Game Boy - 2 pulse, wave, noise channels",bestFor:["Game Boy music","Lo-fi chiptune","Portable gaming"],icon:"Smartphone",color:"text-green-500"},FurnaceC64:{type:"FurnaceC64",name:"Commodore 64 (SID)",shortName:"SID",description:"Commodore 64 SID chip - 3 voices with filters",bestFor:["SID leads","Arpeggios","Filter sweeps","Demoscene"],icon:"Save",color:"text-violet-500"},FurnaceAY:{type:"FurnaceAY",name:"ZX Spectrum / Amstrad (AY)",shortName:"AY",description:"General Instrument AY - ZX Spectrum, MSX, Atari ST",bestFor:["ZX Spectrum","MSX","Amstrad CPC","Envelope tricks"],icon:"Tv",color:"text-sky-500"},FurnaceTIA:{type:"FurnaceTIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 - primitive but distinctive sound",bestFor:["Atari 2600","Primitive bleeps","Retro FX"],icon:"Joystick",color:"text-amber-600"},FurnaceVERA:{type:"FurnaceVERA",name:"Commander X16 (VERA)",shortName:"VERA",description:"Commander X16 - modern retro 16 channels PSG + PCM",bestFor:["Modern retro","X16 music","Rich PSG"],icon:"Cpu",color:"text-teal-500"},FurnaceSAA:{type:"FurnaceSAA",name:"SAM Coup (SAA1099)",shortName:"SAA",description:"Philips SAA1099 - Sam Coup, some PC sound cards",bestFor:["Sam Coup","Stereo chips","European home computers"],icon:"Speaker",color:"text-pink-500"},FurnacePSG:{type:"FurnacePSG",name:"Sega Master System (PSG)",shortName:"PSG",description:"TI SN76489 - Master System, Game Gear, BBC Micro",bestFor:["Master System","Colecovision","Square wave PSG"],icon:"SquareStack",color:"text-emerald-500"},FurnaceVIC:{type:"FurnaceVIC",name:"Commodore VIC-20",shortName:"VIC",description:"Commodore VIC-20 - 3 square + noise",bestFor:["VIC-20 music","Early 80s","Simple tones"],icon:"Monitor",color:"text-lime-500"},FurnaceLynx:{type:"FurnaceLynx",name:"Atari Lynx",shortName:"Lynx",description:"Atari Lynx - 4 channel wavetable",bestFor:["Lynx music","Portable gaming","Wavetable"],icon:"Gamepad",color:"text-rose-500"},FurnaceSID6581:{type:"FurnaceSID6581",name:"SID 6581",shortName:"6581",description:"Classic C64 SID - warm, gritty original chip",bestFor:["Authentic C64","Warm bass","Classic demoscene"],icon:"Save",color:"text-violet-400"},FurnaceSID8580:{type:"FurnaceSID8580",name:"SID 8580",shortName:"8580",description:"Revised SID - cleaner filter, brighter sound",bestFor:["Clean SID","Later C64/C128","Clearer filters"],icon:"Save",color:"text-violet-600"},FurnaceOPNA:{type:"FurnaceOPNA",name:"NEC PC-98 (OPNA)",shortName:"OPNA",description:"YM2608 - NEC PC-98, arcade machines",bestFor:["PC-98 music","Touhou-style","Japanese arcade"],icon:"Cpu",color:"text-blue-400"},FurnaceOPNB:{type:"FurnaceOPNB",name:"SNK Neo Geo (OPNB)",shortName:"OPNB",description:"YM2610 - SNK Neo Geo",bestFor:["Neo Geo music","Fighting games","SNK"],icon:"Gamepad2",color:"text-red-400"},FurnaceOPL4:{type:"FurnaceOPL4",name:"Yamaha OPL4",shortName:"OPL4",description:"Yamaha YMF278 - FM + wavetable hybrid",bestFor:["Advanced OPL","FM + samples","Late DOS"],icon:"Layers",color:"text-yellow-400"},FurnaceY8950:{type:"FurnaceY8950",name:"MSX-Audio (Y8950)",shortName:"Y8950",description:"Yamaha Y8950 - MSX-Audio, OPL + ADPCM",bestFor:["MSX-Audio","OPL with drums","Japanese PC"],icon:"Radio",color:"text-orange-300"},FurnacePCE:{type:"FurnacePCE",name:"PC Engine / TurboGrafx",shortName:"PCE",description:"PC Engine / TurboGrafx-16 - 6 channel wavetable",bestFor:["PC Engine","TurboGrafx","HuCard games"],icon:"Tv",color:"text-orange-500"},FurnaceSNES:{type:"FurnaceSNES",name:"Super Nintendo (SPC700)",shortName:"SNES",description:"Super Nintendo - Sony SPC700 8-channel BRR",bestFor:["SNES music","16-bit classics","BRR samples"],icon:"Gamepad2",color:"text-purple-400"},FurnaceVB:{type:"FurnaceVB",name:"Nintendo Virtual Boy",shortName:"VB",description:"Nintendo Virtual Boy - 6 channel wavetable",bestFor:["Virtual Boy","Stereo 3D audio","Nintendo VB"],icon:"Glasses",color:"text-red-600"},FurnaceSWAN:{type:"FurnaceSWAN",name:"Bandai WonderSwan",shortName:"SWAN",description:"Bandai WonderSwan - 4 channel wavetable + PCM",bestFor:["WonderSwan","Portable gaming","Bandai"],icon:"Smartphone",color:"text-cyan-400"},FurnaceVRC6:{type:"FurnaceVRC6",name:"Famicom (VRC6)",shortName:"VRC6",description:"Konami VRC6 - 2 pulse + saw (Castlevania 3 JP)",bestFor:["Castlevania 3","Konami NES","Extra channels"],icon:"Zap",color:"text-amber-400"},FurnaceVRC7:{type:"FurnaceVRC7",name:"Famicom (VRC7)",shortName:"VRC7",description:"Konami VRC7 - OPLL clone (Lagrange Point)",bestFor:["Lagrange Point","FM on NES","Konami FM"],icon:"Radio",color:"text-amber-500"},FurnaceN163:{type:"FurnaceN163",name:"Namco Arcade (N163)",shortName:"N163",description:"Namco 163 - 8 channel wavetable",bestFor:["Namco NES","Wavetable","Complex tones"],icon:"Waves",color:"text-green-400"},FurnaceFDS:{type:"FurnaceFDS",name:"Famicom Disk System",shortName:"FDS",description:"Famicom Disk System - wavetable + modulation",bestFor:["FDS games","Wavy bass","Zelda FDS"],icon:"Disc",color:"text-yellow-500"},FurnaceMMC5:{type:"FurnaceMMC5",name:"Famicom (MMC5)",shortName:"MMC5",description:"MMC5 - 2 extra pulse channels",bestFor:["Castlevania 3 US","Extra NES pulse","CV3"],icon:"Plus",color:"text-blue-300"},FurnaceTED:{type:"FurnaceTED",name:"Commodore Plus/4 (TED)",shortName:"TED",description:"Commodore Plus/4 TED - 2 square + noise",bestFor:["Plus/4 music","Commodore 16","Budget C64"],icon:"Monitor",color:"text-violet-400"},FurnaceSEGAPCM:{type:"FurnaceSEGAPCM",name:"Sega Arcade (SegaPCM)",shortName:"SEGAPCM",description:"Sega System 16/18 - 16 channel PCM",bestFor:["OutRun","After Burner","Sega arcade"],icon:"Speaker",color:"text-blue-500"},FurnaceQSOUND:{type:"FurnaceQSOUND",name:"Capcom Arcade (QSound)",shortName:"QSound",description:"Capcom QSound - CPS1/CPS2 with 3D audio",bestFor:["Street Fighter","CPS games","3D positioning"],icon:"Headphones",color:"text-purple-500"},FurnaceES5506:{type:"FurnaceES5506",name:"ES5506",shortName:"ES5506",description:"Ensoniq ES5506 - 32 voice wavetable",bestFor:["Taito F3","Ensoniq synths","High quality"],icon:"AudioLines",color:"text-pink-400"},FurnaceRF5C68:{type:"FurnaceRF5C68",name:"RF5C68",shortName:"RF5C68",description:"Ricoh RF5C68 - Sega CD, 8 channel PCM",bestFor:["Sega CD","Mega CD","CD audio"],icon:"Disc",color:"text-cyan-500"},FurnaceC140:{type:"FurnaceC140",name:"C140",shortName:"C140",description:"Namco C140 - System 2, 24 channel PCM",bestFor:["Namco arcade","System 2","Assault"],icon:"Cpu",color:"text-yellow-400"},FurnaceK007232:{type:"FurnaceK007232",name:"K007232",shortName:"K007232",description:"Konami K007232 - 2 channel PCM",bestFor:["Contra arcade","Konami PCM","TMNT"],icon:"Speaker",color:"text-red-400"},FurnaceK053260:{type:"FurnaceK053260",name:"K053260",shortName:"K053260",description:"Konami K053260 - 4 channel PCM with ADPCM",bestFor:["Sunset Riders","Simpsons","Konami 90s"],icon:"Speaker",color:"text-orange-400"},FurnaceGA20:{type:"FurnaceGA20",name:"GA20",shortName:"GA20",description:"Irem GA20 - 4 channel PCM",bestFor:["R-Type Leo","Irem arcade","In the Hunt"],icon:"Cpu",color:"text-teal-400"},FurnaceOKI:{type:"FurnaceOKI",name:"OKI MSM6295",shortName:"OKI",description:"OKI MSM6295 - 4 channel ADPCM",bestFor:["Neo Geo","Data East","ADPCM drums"],icon:"Volume2",color:"text-gray-400"},FurnaceYMZ280B:{type:"FurnaceYMZ280B",name:"YMZ280B",shortName:"YMZ280B",description:"Yamaha YMZ280B - 8 channel ADPCM",bestFor:["Cave shmups","Late arcade","High quality"],icon:"AudioLines",color:"text-indigo-400"},FurnaceSCC:{type:"FurnaceSCC",name:"Konami SCC",shortName:"SCC",description:"Konami SCC - 5 channel wavetable (MSX)",bestFor:["Gradius","Snatcher","MSX Konami"],icon:"Waves",color:"text-green-500"},FurnaceX1_010:{type:"FurnaceX1_010",name:"X1-010",shortName:"X1-010",description:"Seta X1-010 - 16 channel wavetable",bestFor:["Seta arcade","Wavetable","Twin Eagle"],icon:"Waves",color:"text-lime-400"},FurnaceBUBBLE:{type:"FurnaceBUBBLE",name:"Bubble System",shortName:"BUBBLE",description:"Konami Bubble System - wavetable",bestFor:["Konami arcade","Bubble System","Wavetable"],icon:"Circle",color:"text-sky-400"},FurnaceSM8521:{type:"FurnaceSM8521",name:"SM8521",shortName:"SM8521",description:"Sharp SM8521 - Game.com",bestFor:["Game.com","Tiger electronics","Obscure"],icon:"Smartphone",color:"text-gray-500"},FurnaceT6W28:{type:"FurnaceT6W28",name:"T6W28",shortName:"T6W28",description:"NEC T6W28 - PC-6001, stereo PSG",bestFor:["NEC PC-6001","Japanese PC","Stereo PSG"],icon:"Monitor",color:"text-blue-300"},FurnaceSUPERVISION:{type:"FurnaceSUPERVISION",name:"Supervision",shortName:"SV",description:"Watara Supervision - 4 channel + noise/DMA",bestFor:["Supervision","Portable gaming","Watara"],icon:"Gamepad",color:"text-emerald-400"},FurnaceUPD1771:{type:"FurnaceUPD1771",name:"PD1771",shortName:"UPD1771",description:"NEC PD1771 - Epoch Super Cassette Vision",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-400"},FurnaceOPN2203:{type:"FurnaceOPN2203",name:"YM2203 / OPN",shortName:"OPN",description:"YM2203 - PC-88/98, simpler 3-channel FM + SSG",bestFor:["PC-88 music","Japanese PC games","Simpler FM"],icon:"Cpu",color:"text-blue-300"},FurnaceOPNBB:{type:"FurnaceOPNBB",name:"YM2610B",shortName:"OPNB-B",description:"YM2610B - Extended Neo Geo with more FM channels",bestFor:["Neo Geo CD","Extended OPNB","SNK"],icon:"Gamepad2",color:"text-red-300"},FurnaceAY8930:{type:"FurnaceAY8930",name:"AY-8930",shortName:"AY+",description:"Enhanced AY-3-8910 with expanded features",bestFor:["Enhanced chiptune","Extended AY","Microchip"],icon:"Tv",color:"text-sky-400"},FurnaceNDS:{type:"FurnaceNDS",name:"Nintendo DS",shortName:"NDS",description:"Nintendo DS - 16 channel PCM/PSG",bestFor:["NDS music","Portable gaming","Modern chiptune"],icon:"Smartphone",color:"text-slate-400"},FurnaceGBA:{type:"FurnaceGBA",name:"Game Boy Advance",shortName:"GBA",description:"GBA DMA Sound - 2 channel direct PCM",bestFor:["GBA music","Portable gaming","PCM"],icon:"Gamepad",color:"text-purple-300"},FurnacePOKEMINI:{type:"FurnacePOKEMINI",name:"Pokemon Mini",shortName:"PKMN",description:"Pokemon Mini - tiny handheld sound",bestFor:["Pokemon Mini","Tiny tunes","Lo-fi"],icon:"Star",color:"text-yellow-300"},FurnaceNAMCO:{type:"FurnaceNAMCO",name:"Namco WSG",shortName:"WSG",description:"Namco WSG - Pac-Man, Galaga wavetable",bestFor:["Pac-Man","Galaga","Classic arcade"],icon:"Circle",color:"text-yellow-400"},FurnacePET:{type:"FurnacePET",name:"Commodore PET",shortName:"PET",description:"Commodore PET - single voice shift register",bestFor:["PET music","Early 80s","Primitive"],icon:"Monitor",color:"text-green-300"},FurnacePOKEY:{type:"FurnacePOKEY",name:"Atari POKEY",shortName:"POKEY",description:"Atari POKEY - Atari 800/5200/arcade",bestFor:["Atari 8-bit","Atari arcade","Classic chiptune"],icon:"Joystick",color:"text-orange-400"},FurnaceMSM6258:{type:"FurnaceMSM6258",name:"MSM6258",shortName:"MSM6258",description:"OKI MSM6258 - 4-bit ADPCM voice",bestFor:["Voice samples","ADPCM","Japanese arcade"],icon:"Mic",color:"text-pink-300"},FurnaceMSM5232:{type:"FurnaceMSM5232",name:"MSM5232",shortName:"MSM5232",description:"OKI MSM5232 - 8-voice PSG synthesizer",bestFor:["Early arcade","Organ sounds","8-voice"],icon:"Music2",color:"text-amber-300"},FurnaceMULTIPCM:{type:"FurnaceMULTIPCM",name:"Sega MultiPCM",shortName:"MPCM",description:"Sega MultiPCM - System 32, Model 1/2",bestFor:["Virtua Racing","Sega arcade","High quality PCM"],icon:"Headphones",color:"text-blue-400"},FurnaceAMIGA:{type:"FurnaceAMIGA",name:"Amiga Paula",shortName:"PAULA",description:"Amiga Paula - 4 channel 8-bit PCM",bestFor:["Amiga MODs","Demoscene","Classic samples"],icon:"Disc",color:"text-slate-300"},FurnacePCSPKR:{type:"FurnacePCSPKR",name:"PC Speaker",shortName:"PCSPK",description:"PC Speaker - internal IBM PC beeper",bestFor:["DOS games","Beeper music","Lo-fi PC"],icon:"Volume2",color:"text-gray-400"},FurnacePONG:{type:"FurnacePONG",name:"AY-3-8500",shortName:"PONG",description:"AY-3-8500 - original Pong chip sound",bestFor:["Pong","Retro bleeps","Primitive"],icon:"Circle",color:"text-white"},FurnacePV1000:{type:"FurnacePV1000",name:"Casio PV-1000",shortName:"PV1K",description:"Casio PV-1000 - 3 channel PSG",bestFor:["PV-1000","Obscure","Japanese"],icon:"Tv",color:"text-green-400"},FurnaceDAVE:{type:"FurnaceDAVE",name:"Enterprise DAVE",shortName:"DAVE",description:"Enterprise DAVE - 3 channel + noise",bestFor:["Enterprise 64/128","Hungarian","European"],icon:"Monitor",color:"text-red-300"},FurnaceSU:{type:"FurnaceSU",name:"Sound Unit",shortName:"SU",description:"Commander X16 Sound Unit",bestFor:["X16 music","Modern retro","Sound Unit"],icon:"Speaker",color:"text-teal-300"},FurnacePOWERNOISE:{type:"FurnacePOWERNOISE",name:"Power Noise",shortName:"PNOISE",description:"Power Noise - noise generator chip",bestFor:["Noise music","Experimental","Harsh sounds"],icon:"Zap",color:"text-violet-400"},FurnaceZXBEEPER:{type:"FurnaceZXBEEPER",name:"ZX Beeper",shortName:"BEEP",description:"ZX Spectrum beeper - 1-bit audio",bestFor:["ZX Spectrum","Beeper music","1-bit audio"],icon:"Speaker",color:"text-cyan-300"},FurnaceSCVTONE:{type:"FurnaceSCVTONE",name:"SCV Tone",shortName:"SCV",description:"Epoch SCV tone generator",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-300"},FurnacePCMDAC:{type:"FurnacePCMDAC",name:"PCM DAC",shortName:"DAC",description:"Generic PCM DAC output",bestFor:["PCM output","Generic DAC","Simple samples"],icon:"AudioLines",color:"text-gray-300"},ChiptuneModule:{type:"ChiptuneModule",name:"Chiptune Module",shortName:"MOD",description:"Libopenmpt-powered playback for MOD/XM/IT/S3M files",bestFor:["Tracker modules","Retro game music","Sample-accurate playback"],icon:"Gamepad2",color:"text-lime-400"},HivelySynth:{type:"HivelySynth",name:"HivelyTracker",shortName:"HVL",description:"Amiga HivelyTracker/AHX chip synth with 4 waveforms, filter sweeps, and performance lists",bestFor:["Chiptune","Amiga","AHX","Chip arpeggios","Filter sweeps"],icon:"Cpu",color:"text-green-400"},WobbleBass:{type:"WobbleBass",name:"Wobble Bass",shortName:"Wobble",description:"Dubstep/DnB bass with tempo-synced LFO, Reese detuning, FM growl",bestFor:["Dubstep","DnB","Jungle","Neurofunk","Riddim"],icon:"Waves",color:"text-fuchsia-500"},DrumKit:{type:"DrumKit",name:"Drum Kit",shortName:"Kit",description:"Multi-sample instrument with keymap - assign different samples to different notes",bestFor:["Drum kits","Instrument layers","Velocity splits","Sample mapping"],icon:"Piano",color:"text-amber-500"},Buzzmachine:{type:"Buzzmachine",name:"Buzzmachine",shortName:"Buzz",description:"Jeskola Buzz machines - classic tracker effects and generators from the Buzz ecosystem",bestFor:["Effects","Generators","Classic tracker sounds","Buzz compatibility"],icon:"Cpu",color:"text-yellow-500"},BuzzDTMF:{type:"BuzzDTMF",name:"CyanPhase DTMF",shortName:"DTMF",description:"Phone dial tone generator - classic DTMF tones",bestFor:["Phone tones","Retro effects","Experimental"],icon:"Phone",color:"text-cyan-400"},BuzzFreqBomb:{type:"BuzzFreqBomb",name:"Frequency Bomb",shortName:"FreqBomb",description:"Elenzil Frequency Bomb - chaotic frequency modulation",bestFor:["Noise","Chaos","Experimental"],icon:"Bomb",color:"text-red-500"},BuzzKick:{type:"BuzzKick",name:"FSM Kick",shortName:"Kick",description:"FSM Kick drum synthesizer",bestFor:["Kick drums","Bass drums","Percussion"],icon:"Drum",color:"text-orange-500"},BuzzKickXP:{type:"BuzzKickXP",name:"FSM KickXP",shortName:"KickXP",description:"Extended FSM Kick with more parameters",bestFor:["Kick drums","Deep bass","EDM kicks"],icon:"Drum",color:"text-orange-600"},BuzzNoise:{type:"BuzzNoise",name:"Jeskola Noise",shortName:"Noise",description:"Jeskola Noise generator",bestFor:["Noise","Hi-hats","Textures"],icon:"Waves",color:"text-gray-400"},BuzzTrilok:{type:"BuzzTrilok",name:"Jeskola Trilok",shortName:"Trilok",description:"Jeskola Trilok bass drum synthesizer",bestFor:["Bass drums","Toms","Percussion"],icon:"Drum",color:"text-amber-500"},Buzz4FM2F:{type:"Buzz4FM2F",name:"MadBrain 4FM2F",shortName:"4FM2F",description:"4-operator FM synthesizer with 2 filters",bestFor:["FM sounds","Complex timbres","DX-style"],icon:"Radio",color:"text-purple-500"},BuzzDynamite6:{type:"BuzzDynamite6",name:"MadBrain Dynamite6",shortName:"Dyn6",description:"6-voice additive synthesizer",bestFor:["Additive synthesis","Organs","Complex sounds"],icon:"Zap",color:"text-yellow-500"},BuzzM3:{type:"BuzzM3",name:"Makk M3",shortName:"M3",description:"Dual-oscillator mono synth",bestFor:["Bass","Leads","Classic synth"],icon:"AudioLines",color:"text-green-500"},Buzz3o3:{type:"Buzz3o3",name:"Oomek Aggressor 3o3",shortName:"3o3",description:"TB-303 style acid synth clone",bestFor:["Acid bass","Squelchy lines","Techno"],icon:"Zap",color:"text-lime-500"},MAMEVFX:{type:"MAMEVFX",name:"Ensoniq VFX",shortName:"VFX",description:"Ensoniq ES5506 (OTTO) 32-voice wavetable synthesis",bestFor:["Evolving pads","90s digital","Cinematic","Layers"],icon:"AudioLines",color:"text-pink-400"},MAMEDOC:{type:"MAMEDOC",name:"Ensoniq ESQ-1",shortName:"DOC",description:"Ensoniq ES5503 (DOC) 8-bit wavetable synthesis",bestFor:["Lo-fi digital","ESQ-1 pads","Gritty bass","80s digital"],icon:"Waves",color:"text-amber-400"},MAMERSA:{type:"MAMERSA",name:"Roland SA",shortName:"MKS20",description:"Roland Structured Adaptive Synthesis (MKS-20/RD-1000)",bestFor:["Electric piano","Authentic piano","80s keys"],icon:"Piano",color:"text-sky-400"},MAMESWP30:{type:"MAMESWP30",name:"Yamaha SWP30",shortName:"AWM2",description:"Yamaha SWP30 (AWM2) 64-voice ROMpler/DSP engine",bestFor:["Realistic instruments","90s ROMpler","Advanced effects","AWM2 sounds"],icon:"Cpu",color:"text-emerald-400"},CZ101:{type:"CZ101",name:"Casio CZ-101",shortName:"CZ",description:"Casio Phase Distortion synthesis - 8 voices, dual oscillator with DCO/DCW/DCA envelopes",bestFor:["Digital bass","Metallic leads","Synth brass","80s digital","Phase distortion"],icon:"Activity",color:"text-violet-400"},CEM3394:{type:"CEM3394",name:"CEM3394 (Curtis)",shortName:"CEM",description:"Curtis Electromusic analog synth voice - used in Prophet VS, Matrix-6, ESQ-1, Six-Trak",bestFor:["Analog bass","Warm pads","Classic leads","80s analog","Prophet sounds"],icon:"Waves",color:"text-emerald-400"},SCSP:{type:"SCSP",name:"Sega Saturn SCSP",shortName:"SCSP",description:"Yamaha YMF292-F 32-voice sound processor - Sega Saturn, Model 2/3 arcade",bestFor:["Arcade sounds","90s gaming","Saturn pads","Virtua sounds","Sega classics"],icon:"Gamepad2",color:"text-blue-500"},DubSiren:{type:"DubSiren",name:"Dub Siren",shortName:"Siren",description:"Classic dub sound system siren with LFO and delay",bestFor:["Dub FX","Reggae","Sound system","Alerts"],icon:"Megaphone",color:"text-red-500"},SpaceLaser:{type:"SpaceLaser",name:"Space Laser",shortName:"Laser",description:"FM-based cosmic zap generator for classic reggae and anime effects",bestFor:["Laser shots","Anime FX","Reggae dubs","Sci-fi"],icon:"Zap",color:"text-green-500"},V2:{type:"V2",name:"Farbrausch V2 Synth",shortName:"V2",description:"Authentic 4k/64k demoscene synthesis with multi-voice subtractive engine.",bestFor:["Demoscene","Trance","Techno","Leads"],icon:"Radio",color:"amber"},V2Speech:{type:"V2Speech",name:"V2 Speech",shortName:"V2Sp",description:"Farbrausch V2 speech synthesis module for robotic and vocoder-style voices.",bestFor:["Speech","Robotic Voices","Demoscene","FX"],icon:"Radio",color:"amber"},Sam:{type:"Sam",name:"Commodore SAM",shortName:"SAM",description:"Software Automatic Mouth - classic 8-bit speech synthesizer from 1982.",bestFor:["Speech","Robotic Voices","Lo-Fi","FX"],icon:"MessageSquare",color:"amber"},Synare:{type:"Synare",name:"Synare 3",shortName:"Synare",description:'Classic electronic percussion synthesizer for "disco tom" and dub sounds',bestFor:["Dub percussion","Disco toms","Electronic drums","SFX"],icon:"Drum",color:"text-yellow-500"},WAM:{type:"WAM",name:"Web Audio Module",shortName:"WAM",description:"Load external audio plugins from URL (standard WAM 2.0 format)",bestFor:["External plugins","Community synths","Rich UI"],icon:"Globe",color:"text-cyan-400"},WAMOBXd:{type:"WAMOBXd",name:"OB-Xd (WAM)",shortName:"OBXd-W",description:"Oberheim OB-X virtual analog synth via WAM 2.0",bestFor:["Analog pads","Warm leads","Classic analog","Rich UI"],icon:"Waves",color:"text-amber-400"},WAMSynth101:{type:"WAMSynth101",name:"Synth-101 (WAM)",shortName:"SH101",description:"Roland SH-101 monophonic synthesizer via WAM 2.0",bestFor:["Mono bass","Acid lines","Classic mono","Rich UI"],icon:"AudioLines",color:"text-blue-400"},WAMTinySynth:{type:"WAMTinySynth",name:"TinySynth (WAM)",shortName:"Tiny",description:"GM-mapped multi-timbral synth via WAM 2.0",bestFor:["General MIDI","Multi-timbral","Quick patches","Rich UI"],icon:"Music2",color:"text-green-400"},WAMFaustFlute:{type:"WAMFaustFlute",name:"Faust Flute (WAM)",shortName:"Flute",description:"Physical modelling flute via Faust DSP and WAM 2.0",bestFor:["Physical model","Wind instruments","Expressive","Rich UI"],icon:"Wind",color:"text-sky-400"},Dexed:{type:"Dexed",name:"Dexed (DX7)",shortName:"DX7",description:"Yamaha DX7 FM synthesizer emulation - 6-operator FM with 32 algorithms",bestFor:["FM Bass","Electric Piano","Bells","Pads","Classic FM sounds"],icon:"Piano",color:"text-blue-400"},OBXd:{type:"OBXd",name:"OBXd (Oberheim)",shortName:"OBXd",description:"Oberheim OB-X analog polysynth emulation - classic warm analog sounds",bestFor:["Pads","Brass","Strings","Warm leads","Analog sounds"],icon:"Waves",color:"text-amber-400"},DexedBridge:{type:"DexedBridge",name:"Dexed DX7 (Bridge)",shortName:"DX7B",description:"Dexed DX7 via VSTBridge generic framework - test/validation of the bridge",bestFor:["FM Bass","Electric Piano","Bells","Bridge testing"],icon:"Plug",color:"text-purple-400"},Vital:{type:"Vital",name:"Vital (Wavetable)",shortName:"Vital",description:"Spectral warping wavetable synthesizer - 3 oscillators with spectral morphing, 13 morph types, phase distortion",bestFor:["Wavetable","Spectral","Modern bass","Pads","Leads","Sound design"],icon:"Waves",color:"text-violet-400"},Odin2:{type:"Odin2",name:"Odin2 (Hybrid)",shortName:"Odin2",description:"Semi-modular hybrid synth - 11 oscillator types (analog, wavetable, FM, vector, chiptune), 9 filter types, modulation matrix",bestFor:["Hybrid synthesis","Analog","Wavetable","FM","Vector","Chiptune"],icon:"Zap",color:"text-emerald-400"},Surge:{type:"Surge",name:"Surge XT (Hybrid)",shortName:"Surge",description:"Professional hybrid synth - dual scenes, 12 oscillator types, 32 effect types, 765 parameters, open source since 2018",bestFor:["Professional","Hybrid","Sound design","Bass","Pads","Leads","FX"],icon:"Activity",color:"text-cyan-400"},TonewheelOrgan:{type:"TonewheelOrgan",name:"Tonewheel Organ",shortName:"Organ",description:"Hammond-style tonewheel organ - 9 drawbars, key click, percussion, vibrato/chorus scanner, overdrive",bestFor:["Reggae organ","Gospel","Jazz","Blues","Rock organ","Ska"],icon:"Music",color:"text-amber-400"},Melodica:{type:"Melodica",name:"Melodica",shortName:"Melod",description:"Monophonic reed instrument physical model - breath dynamics, body resonance, vibrato, portamento",bestFor:["Reggae melodica","Dub","Ska","Augustus Pablo","Lead melodies"],icon:"Wind",color:"text-teal-400"},Monique:{type:"Monique",name:"Monique (Monosynth)",shortName:"Monique",description:"Morphing monosynth - 3 morphable oscillators, 3 cross-routed filters, 4 tempo-synced MFOs, arpeggiator",bestFor:["Mono bass","Acid","Leads","Sound design","Morphing"],icon:"Sparkles",color:"text-fuchsia-400"},Helm:{type:"Helm",name:"Helm (Polyphonic)",shortName:"Helm",description:"Polyphonic synth by Matt Tytel - 2 oscillators, sub, 2 filters, 2 LFOs, 2 step sequencers, effects",bestFor:["Modern leads","Bass","Pads","Keys","EDM"],icon:"Waves",color:"text-cyan-500"},Sorcer:{type:"Sorcer",name:"Sorcer (Wavetable)",shortName:"Sorcer",description:"FAUST-based wavetable synth by OpenAV - wavetable oscillator, Butterworth filter, compressor, LFO",bestFor:["Wavetable","EDM","Pads","Sound design"],icon:"Sparkles",color:"text-purple-500"},Amsynth:{type:"Amsynth",name:"amsynth (Analog)",shortName:"amsynth",description:"Classic analog modeling by Nick Dowell - 2 oscillators, filter, 2 envelopes, LFO, Freeverb, distortion",bestFor:["Analog bass","Vintage leads","Pads","Retro sounds"],icon:"Radio",color:"text-orange-400"},OBXf:{type:"OBXf",name:"OB-Xf (Analog)",shortName:"OB-Xf",description:"Oberheim OB-X/OB-Xa modeling by Surge Synth Team - 2 oscillators, multimode filter, 2 LFOs, voice variation",bestFor:["Oberheim brass","Vintage strings","Analog bass","Classic pads"],icon:"Speaker",color:"text-indigo-500"},Buzz3o3DF:{type:"Buzz3o3DF",name:"Aggressor Devil Fish",shortName:"3o3DF",description:"Enhanced TB-303 clone with Devil Fish mods - accent decay, VEG, filter tracking, muffler",bestFor:["Acid bass","Deep acid","Experimental","Devil Fish tones"],icon:"Zap",color:"text-lime-400"},BuzzM4:{type:"BuzzM4",name:"Makk M4",shortName:"M4",description:"Wavetable synth with 100+ waveforms, dual oscillators, sub osc, and dual LFOs",bestFor:["Wavetable","Leads","Pads","Bass"],icon:"Layers",color:"text-sky-400"},MAMEAICA:{type:"MAMEAICA",name:"Sega AICA",shortName:"AICA",description:"Sega Dreamcast/Naomi AICA - 64-voice ADPCM+FM sound processor",bestFor:["Dreamcast sounds","Arcade PCM","90s gaming","ADPCM samples"],icon:"Gamepad2",color:"text-blue-400"},MAMEASC:{type:"MAMEASC",name:"Apple Sound Chip",shortName:"ASC",description:"Apple ASC - 4-voice wavetable synthesis from Apple IIGS and Mac",bestFor:["Retro Mac","Wavetable","IIGS sounds","80s digital"],icon:"Cpu",color:"text-gray-400"},MAMEAstrocade:{type:"MAMEAstrocade",name:"Bally Astrocade",shortName:"Astro",description:"Bally Astrocade custom sound - 3 voices + noise, vibrato modulation",bestFor:["Retro arcade","Lo-fi","Noise FX","Vintage gaming"],icon:"Gamepad2",color:"text-purple-400"},MAMEC352:{type:"MAMEC352",name:"Namco C352",shortName:"C352",description:"Namco System 22/23 - 32-voice PCM with built-in effects (needs ROM)",bestFor:["Namco arcade","Ridge Racer","Tekken sounds","Arcade PCM"],icon:"Gamepad2",color:"text-red-400"},MAMEES5503:{type:"MAMEES5503",name:"Ensoniq ES5503",shortName:"ES5503",description:"Ensoniq DOC - 32-oscillator wavetable chip (Apple IIGS, ESQ-1, Mirage)",bestFor:["Wavetable","Lo-fi digital","80s synth","IIGS music"],icon:"Waves",color:"text-amber-400"},MAMEICS2115:{type:"MAMEICS2115",name:"ICS WaveFront",shortName:"ICS",description:"ICS 2115 WaveFront - 32-voice wavetable with interpolation (needs ROM)",bestFor:["Wavetable","90s soundcard","GUS compatible","Tracker music"],icon:"Cpu",color:"text-teal-400"},MAMEK054539:{type:"MAMEK054539",name:"Konami K054539",shortName:"K054",description:"Konami 054539 - 8-channel PCM for Konami arcade (needs ROM)",bestFor:["Konami arcade","TMNT","Gradius","Arcade samples"],icon:"Gamepad2",color:"text-yellow-400"},MAMEMEA8000:{type:"MAMEMEA8000",name:"Philips MEA8000",shortName:"MEA",description:"Philips MEA8000 - LPC speech synthesis with formant modeling",bestFor:["Speech","Robotic voice","Retro talking","Voice FX"],icon:"Mic",color:"text-green-400"},MAMEMSM5232:{type:"MAMEMSM5232",name:"OKI MSM5232",shortName:"MSM",description:"OKI MSM5232 - 8-voice PSG organ/synth chip (MAME native emulation)",bestFor:["Organ","Arcade melody","Retro synth","Simple tones"],icon:"Cpu",color:"text-orange-400"},MAMERF5C400:{type:"MAMERF5C400",name:"Ricoh RF5C400",shortName:"RF5C",description:"Ricoh RF5C400 - 32-voice PCM with digital filtering (needs ROM)",bestFor:["Seta arcade","PCM playback","Arcade samples"],icon:"Cpu",color:"text-indigo-400"},MAMESN76477:{type:"MAMESN76477",name:"TI SN76477",shortName:"SN77",description:"TI SN76477 Complex Sound Generator - VCO, noise, envelope, mixer",bestFor:["Sci-fi FX","Laser sounds","Space Invaders","Retro arcade FX"],icon:"Zap",color:"text-green-500"},MAMESNKWave:{type:"MAMESNKWave",name:"SNK Wave",shortName:"SNK",description:"SNK custom wavetable sound generator - Neo Geo era",bestFor:["Retro arcade","Wavetable","SNK sounds","Lo-fi"],icon:"Gamepad2",color:"text-red-500"},MAMESP0250:{type:"MAMESP0250",name:"GI SP0250",shortName:"SP02",description:"General Instrument SP0250 - LPC speech synthesis for arcade machines",bestFor:["Arcade speech","Robotic voice","Q*bert sounds","Retro talking"],icon:"Mic",color:"text-yellow-500"},MAMETIA:{type:"MAMETIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 TIA - MAME-accurate 2-voice with 16 distortion modes",bestFor:["Atari sounds","2600 bleeps","Lo-fi","Retro FX"],icon:"Gamepad2",color:"text-amber-500"},MAMETMS36XX:{type:"MAMETMS36XX",name:"TMS36XX Organ",shortName:"TMS3",description:"TI TMS3615/3617 - electronic organ chip with 13 chromatic notes",bestFor:["Electronic organ","Retro tones","Circus music","Simple melody"],icon:"Music2",color:"text-rose-400"},MAMETMS5220:{type:"MAMETMS5220",name:"Speak & Spell",shortName:"TMS5",description:"TI TMS5220 LPC speech - the Speak & Spell chip, phoneme-based voice",bestFor:["Speech","Speak & Spell","Robotic voice","LPC vocoder"],icon:"Mic",color:"text-orange-500"},MAMETR707:{type:"MAMETR707",name:"Roland TR-707",shortName:"707",description:"Roland TR-707 PCM drum machine - 10 voices with analog filtering (needs ROM)",bestFor:["House drums","Electro beats","80s rhythm","Classic drum machine"],icon:"Disc",color:"text-red-400"},MAMEUPD931:{type:"MAMEUPD931",name:"NEC uPD931",shortName:"931",description:"NEC uPD931 - speech synthesis processor with LPC coding",bestFor:["Japanese speech","Arcade voice","Retro talking","Speech FX"],icon:"Mic",color:"text-cyan-400"},MAMEUPD933:{type:"MAMEUPD933",name:"NEC uPD933",shortName:"933",description:"NEC uPD933 raw phase distortion chip - the core of the Casio CZ series",bestFor:["Phase distortion","CZ sounds","Digital bass","Metallic leads"],icon:"Activity",color:"text-violet-400"},MAMEVotrax:{type:"MAMEVotrax",name:"Votrax SC-01",shortName:"Vtrx",description:"Votrax SC-01 - classic 1980s phoneme speech synthesizer chip",bestFor:["Robotic speech","Arcade talking","Q*bert","Retro voice"],icon:"Mic",color:"text-emerald-400"},MAMEYMF271:{type:"MAMEYMF271",name:"Yamaha OPX",shortName:"OPX",description:"Yamaha YMF271 OPX - 12-voice FM+PCM synthesis for arcade hardware",bestFor:["Arcade FM","FM+PCM","Jaleco sounds","Complex FM"],icon:"Radio",color:"text-blue-500"},MAMEYMOPQ:{type:"MAMEYMOPQ",name:"Yamaha OPQ",shortName:"OPQ",description:"Yamaha YM3806 OPQ - 4-op FM synthesis for Yamaha keyboards",bestFor:["FM synthesis","Yamaha sounds","Vintage FM","Keyboard sounds"],icon:"Radio",color:"text-indigo-500"},MAMEVASynth:{type:"MAMEVASynth",name:"Virtual Analog",shortName:"VA",description:"Virtual Analog modeling synthesizer - subtractive with multi-waveform oscillators",bestFor:["Analog modeling","Bass","Leads","Pads","Classic analog"],icon:"Waves",color:"text-pink-500"},VFX:{type:"VFX",name:"Ensoniq VFX",shortName:"VFX",description:"Ensoniq VFX transwave synthesizer - alias for MAMEVFX",bestFor:["Transwave","Digital","Pads","Textures"],icon:"Cpu",color:"text-cyan-500"},D50:{type:"D50",name:"Roland D-50",shortName:"D-50",description:"Roland D-50 virtual analog synthesizer",bestFor:["Digital","Pads","Strings","Vintage digital"],icon:"Cpu",color:"text-rose-500"},ModularSynth:{type:"ModularSynth",name:"Modular Synth",shortName:"Modular",description:"Patch editor with modules (VCO, VCF, VCA, ADSR, LFO) and cable routing",bestFor:["Sound design","Experimental","Custom patches","Flexible routing"],icon:"Cable",color:"text-indigo-500"},UADESynth:{type:"UADESynth",name:"UADE",shortName:"UADE",description:"Playback-only engine for 130+ exotic Amiga tracker formats via UADE",bestFor:["Amiga modules","Exotic formats","Playback"],icon:"Disc",color:"text-gray-500"},SoundMonSynth:{type:"SoundMonSynth",name:"SoundMon",shortName:"SoundMon",description:"SoundMon II / Brian Postma wavetable synthesizer",bestFor:["Amiga chiptune","Wavetable"],icon:"Disc",color:"text-gray-500"},SidMonSynth:{type:"SidMonSynth",name:"SidMon",shortName:"SidMon",description:"SidMon II SID-like synthesis for Amiga",bestFor:["Amiga chiptune","SID-like"],icon:"Disc",color:"text-gray-500"},DigMugSynth:{type:"DigMugSynth",name:"Digital Mugician",shortName:"DigMug",description:"Digital Mugician 4-wave blending wavetable synthesizer",bestFor:["Amiga chiptune","Wavetable"],icon:"Disc",color:"text-gray-500"},FCSynth:{type:"FCSynth",name:"Future Composer",shortName:"FC",description:"Future Composer 1.3/1.4 with 47 waveforms and synth macro",bestFor:["Amiga chiptune","Wavetable"],icon:"Disc",color:"text-gray-500"},FredSynth:{type:"FredSynth",name:"Fred Editor",shortName:"Fred",description:"Fred Editor macro-driven wavetable synthesizer",bestFor:["Amiga chiptune","Wavetable"],icon:"Disc",color:"text-gray-500"},TFMXSynth:{type:"TFMXSynth",name:"TFMX",shortName:"TFMX",description:"TFMX / Jochen Hippel SndMod/VolMod sequence synthesizer",bestFor:["Amiga chiptune","Game music"],icon:"Disc",color:"text-gray-500"},HippelCoSoSynth:{type:"HippelCoSoSynth",name:"Hippel CoSo",shortName:"CoSo",description:"Jochen Hippel CoSo pure synthesis engine with frequency/volume sequences, vibrato and portamento",bestFor:["Amiga chiptune","Game music","Jochen Hippel"],icon:"Disc",color:"text-amber-400"},RobHubbardSynth:{type:"RobHubbardSynth",name:"Rob Hubbard",shortName:"Rob Hubbard",description:"Rob Hubbard Amiga PCM synthesis with period-based vibrato, wobble oscillator and portamento",bestFor:["Amiga chiptune","Game music","Rob Hubbard"],icon:"Disc",color:"text-amber-500"},SidMon1Synth:{type:"SidMon1Synth",name:"SidMon 1.0",shortName:"SidMon1",description:"SidMon 1.0 wavetable synthesizer with ADSR envelope, 16-step arpeggio and phase LFO",bestFor:["Amiga chiptune","Wavetable","SID-like"],icon:"Disc",color:"text-amber-300"},OctaMEDSynth:{type:"OctaMEDSynth",name:"OctaMED SynthInstr",shortName:"OctaMED",description:"OctaMED synthesizer instrument: vol/wf command-table oscillator with up to 10 waveforms",bestFor:["Amiga chiptune","Wavetable","Tracker synth"],icon:"Waveform",color:"text-cyan-300"},DavidWhittakerSynth:{type:"DavidWhittakerSynth",name:"David Whittaker",shortName:"DW",description:"David Whittaker Amiga synthesis engine with period-based frequency/volume sequences and vibrato",bestFor:["Amiga chiptune","Game music","David Whittaker"],icon:"Disc",color:"text-green-400"},SymphonieSynth:{type:"SymphonieSynth",name:"Symphonie Pro",shortName:"SYM",description:"Symphonie Pro Amiga tracker engine with DSP echo/delay ring buffer effects",bestFor:["Amiga tracker","DSP effects","Symphonie Pro"],icon:"Music",color:"text-purple-400"},MusicLineSynth:{type:"MusicLineSynth",name:"MusicLine",shortName:"MLN",description:"MusicLine Amiga tracker engine with wavetable synthesis",bestFor:["Amiga wavetable","Chiptune","MusicLine"],icon:"Waves",color:"text-teal-400"},SunVoxSynth:{type:"SunVoxSynth",name:"SunVox",shortName:"SVX",description:"SunVox WASM modular synth patch player (.sunsynth / .sunvox)",bestFor:["Modular synth","SunVox patches","Complex synthesis"],icon:"Sun",color:"text-yellow-400"},SuperCollider:{type:"SuperCollider",name:"SuperCollider",shortName:"SC",description:"SuperCollider SynthDef scripted synthesis via scsynth WASM",bestFor:["Algorithmic composition","Live coding","Experimental"],icon:"Code2",color:"text-lime-400"}},pz=[{id:"bass",name:"Bass",description:"Deep and punchy bass synths",synths:[mz.TB303,mz.MonoSynth,mz.WobbleBass]},{id:"lead",name:"Lead",description:"Melodic lead synthesizers",synths:[mz.Synth,mz.DuoSynth,mz.FMSynth,mz.AMSynth,mz.PluckSynth,mz.SuperSaw,mz.ChipSynth,mz.PWMSynth,mz.FormantSynth,mz.ModularSynth,mz.V2]},{id:"drums",name:"Drums",description:"Percussion and drum synthesis",synths:[mz.MembraneSynth,mz.MetalSynth,mz.NoiseSynth,mz.DrumMachine,mz.DrumKit,mz.Synare,mz.MAMETR707]},{id:"speech",name:"Speech & Voice",description:"Speech synthesis and voice generation",synths:[mz.Sam,mz.V2Speech,mz.MAMETMS5220,mz.MAMEVotrax,mz.MAMESP0250,mz.MAMEMEA8000,mz.MAMEUPD931]},{id:"pads",name:"Pads",description:"Evolving textures and pads",synths:[mz.Wavetable,mz.GranularSynth,mz.PolySynth,mz.StringMachine,mz.HarmonicSynth,mz.V2]},{id:"dub",name:"Dub & FX",description:"Classic sound system and special effects",synths:[mz.DubSiren,mz.SpaceLaser,mz.V2,mz.Synare]},{id:"vintage",name:"Keys",description:"Keyboard instruments",synths:[mz.Organ]},{id:"samples",name:"Samples",description:"Sample-based instruments",synths:[mz.Sampler,mz.Player,mz.ChiptuneModule,mz.MusicLineSynth]},{id:"plugins",name:"Plugins",description:"External Web Audio Modules (WAM 2.0)",synths:[mz.WAMOBXd,mz.WAMSynth101,mz.WAMTinySynth,mz.WAMFaustFlute,mz.WAM]},{id:"fx",name:"FX",description:"Sound effects and noise generators",synths:[mz.DubSiren]},{id:"furnace",name:" Furnace Chips",description:"All Furnace chip emulations - 70+ authentic retro sound chips",synths:[mz.FurnaceOPN,mz.FurnaceOPN2203,mz.FurnaceOPNA,mz.FurnaceOPNB,mz.FurnaceOPNBB,mz.FurnaceOPM,mz.FurnaceOPL,mz.FurnaceOPLL,mz.FurnaceOPL4,mz.FurnaceOPZ,mz.FurnaceY8950,mz.FurnaceESFM,mz.FurnaceVRC7,mz.FurnaceNES,mz.FurnaceGB,mz.FurnaceSNES,mz.FurnacePCE,mz.FurnacePSG,mz.FurnaceVB,mz.FurnaceLynx,mz.FurnaceSWAN,mz.FurnaceNDS,mz.FurnaceGBA,mz.FurnacePOKEMINI,mz.FurnaceVRC6,mz.FurnaceN163,mz.FurnaceFDS,mz.FurnaceMMC5,mz.FurnaceC64,mz.FurnaceSID6581,mz.FurnaceSID8580,mz.FurnaceAY,mz.FurnaceAY8930,mz.FurnaceVIC,mz.FurnacePET,mz.FurnaceSAA,mz.FurnaceTED,mz.FurnaceDAVE,mz.FurnaceVERA,mz.FurnaceSCC,mz.FurnaceTIA,mz.FurnacePOKEY,mz.FurnaceZXBEEPER,mz.FurnaceAMIGA,mz.FurnacePCSPKR,mz.FurnaceSEGAPCM,mz.FurnaceQSOUND,mz.FurnaceES5506,mz.FurnaceRF5C68,mz.FurnaceC140,mz.FurnaceK007232,mz.FurnaceK053260,mz.FurnaceGA20,mz.FurnaceOKI,mz.FurnaceYMZ280B,mz.FurnaceX1_010,mz.FurnaceBUBBLE,mz.FurnaceMULTIPCM,mz.FurnaceMSM6258,mz.FurnaceMSM5232,mz.FurnaceNAMCO,mz.FurnaceSM8521,mz.FurnaceT6W28,mz.FurnaceSUPERVISION,mz.FurnaceUPD1771,mz.FurnacePONG,mz.FurnacePV1000,mz.FurnaceSU,mz.FurnacePOWERNOISE,mz.FurnaceSCVTONE,mz.FurnacePCMDAC,mz.Furnace]},{id:"chiptune-fm",name:"FM Chips",description:"Yamaha FM synthesis chips (OPN, OPL, OPM families)",synths:[mz.FurnaceOPN,mz.FurnaceOPN2203,mz.FurnaceOPNA,mz.FurnaceOPNB,mz.FurnaceOPNBB,mz.FurnaceOPM,mz.FurnaceOPL,mz.FurnaceOPLL,mz.FurnaceOPL4,mz.FurnaceOPZ,mz.FurnaceY8950,mz.FurnaceESFM,mz.FurnaceVRC7]},{id:"chiptune-console",name:"Console Chips",description:"Game console sound chips (Nintendo, Sega, etc.)",synths:[mz.FurnaceNES,mz.FurnaceGB,mz.FurnaceSNES,mz.FurnacePCE,mz.FurnacePSG,mz.FurnaceVB,mz.FurnaceLynx,mz.FurnaceSWAN,mz.FurnaceNDS,mz.FurnaceGBA,mz.FurnacePOKEMINI,mz.FurnaceVRC6,mz.FurnaceN163,mz.FurnaceFDS,mz.FurnaceMMC5]},{id:"chiptune-computer",name:"Computer Chips",description:"Home computer sound chips (C64, Spectrum, etc.)",synths:[mz.FurnaceC64,mz.FurnaceSID6581,mz.FurnaceSID8580,mz.FurnaceAY,mz.FurnaceAY8930,mz.FurnaceVIC,mz.FurnacePET,mz.FurnaceSAA,mz.FurnaceTED,mz.FurnaceDAVE,mz.FurnaceVERA,mz.FurnaceSCC,mz.FurnaceTIA,mz.FurnacePOKEY,mz.FurnaceZXBEEPER,mz.FurnaceAMIGA,mz.FurnacePCSPKR,mz.HivelySynth,mz.HippelCoSoSynth,mz.RobHubbardSynth,mz.DavidWhittakerSynth,mz.UADESynth,mz.SoundMonSynth,mz.SidMonSynth,mz.SidMon1Synth,mz.DigMugSynth,mz.FCSynth,mz.FredSynth,mz.TFMXSynth,mz.OctaMEDSynth,mz.SymphonieSynth]},{id:"chiptune-arcade",name:"Arcade PCM",description:"Arcade game PCM/ADPCM chips (Sega, Namco, Konami, Capcom)",synths:[mz.FurnaceSEGAPCM,mz.FurnaceQSOUND,mz.FurnaceES5506,mz.FurnaceRF5C68,mz.FurnaceC140,mz.FurnaceK007232,mz.FurnaceK053260,mz.FurnaceGA20,mz.FurnaceOKI,mz.FurnaceYMZ280B,mz.FurnaceX1_010,mz.FurnaceBUBBLE,mz.FurnaceMULTIPCM,mz.FurnaceMSM6258,mz.FurnaceMSM5232,mz.FurnaceNAMCO]},{id:"chiptune-other",name:"Other Chips",description:"Obscure and miscellaneous sound chips",synths:[mz.FurnaceSM8521,mz.FurnaceT6W28,mz.FurnaceSUPERVISION,mz.FurnaceUPD1771,mz.FurnacePONG,mz.FurnacePV1000,mz.FurnaceSU,mz.FurnacePOWERNOISE,mz.FurnaceSCVTONE,mz.FurnacePCMDAC,mz.Furnace]},{id:"buzzmachines",name:"Buzzmachines",description:"Jeskola Buzz machines - classic tracker synths and drums",synths:[mz.Buzzmachine,mz.Buzz3o3,mz.Buzz3o3DF,mz.BuzzM3,mz.BuzzM4,mz.Buzz4FM2F,mz.BuzzDynamite6,mz.BuzzKick,mz.BuzzKickXP,mz.BuzzTrilok,mz.BuzzNoise,mz.BuzzFreqBomb,mz.BuzzDTMF]},{id:"mame-synths",name:"MAME Hardware Synths",description:"Hardware-accurate synth and keyboard chip emulations",synths:[mz.MAMEVFX,mz.VFX,mz.D50,mz.MAMEDOC,mz.MAMEES5503,mz.MAMERSA,mz.MAMESWP30,mz.CZ101,mz.MAMEUPD933,mz.CEM3394,mz.SCSP,mz.MAMEVASynth,mz.MAMEYMF271,mz.MAMEYMOPQ]},{id:"mame-arcade",name:"MAME Arcade & Retro",description:"Arcade game and retro computer sound chips (MAME-emulated)",synths:[mz.MAMEAICA,mz.MAMEASC,mz.MAMEAstrocade,mz.MAMEC352,mz.MAMEICS2115,mz.MAMEK054539,mz.MAMEMSM5232,mz.MAMERF5C400,mz.MAMESN76477,mz.MAMESNKWave,mz.MAMETIA,mz.MAMETMS36XX]},{id:"juce-synths",name:" JUCE Synths",description:"Professional quality WASM-based synth emulations",synths:[mz.Dexed,mz.OBXd,mz.SunVoxSynth]},{id:"scripted",name:" Scripted",description:"Live-coded and algorithmically scripted synthesis",synths:[mz.SuperCollider]},{id:"vstbridge",name:" VST Bridge",description:"Open-source synths ported via the generic VSTBridge framework",synths:[mz.Vital,mz.Surge,mz.Odin2,mz.DexedBridge,mz.Helm,mz.Sorcer,mz.Amsynth,mz.OBXf,mz.TonewheelOrgan,mz.Melodica,mz.Monique]}],hz=Object.keys(mz).sort((e,t)=>mz[e].shortName.localeCompare(mz[t].shortName));function fz(e){return mz[e]}const gz=({isOpen:e,currentName:t,onConfirm:n,onClose:s})=>{const[a,o]=l.useState(t),r=l.useRef(null);l.useEffect(()=>{e&&(requestAnimationFrame(()=>o(t)),setTimeout(()=>r.current?.select(),0))},[e,t]);return e?ZV.createPortal(Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:s,children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px]",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:[Yn.jsxDEV("h3",{className:"text-sm font-semibold text-text-primary",children:"Rename Instrument"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:72,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:s,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:Yn.jsxDEV(Ce,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:77,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:73,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:71,columnNumber:9},void 0),Yn.jsxDEV("form",{onSubmit:e=>{e.preventDefault(),a.trim()&&a!==t&&n(a.trim()),s()},children:[Yn.jsxDEV("input",{ref:r,type:"text",value:a,onChange:e=>o(e.target.value),onKeyDown:e=>{"Escape"===e.key&&s()},className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary\n                     focus:outline-none focus:border-accent-primary",placeholder:"Enter instrument name",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:81,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2 mt-4",children:[Yn.jsxDEV("button",{type:"button",onClick:s,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                       hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:93,columnNumber:13},void 0),Yn.jsxDEV("button",{type:"submit",disabled:!a.trim()||a===t,className:"px-3 py-1.5 text-sm bg-accent-primary text-text-inverse rounded\n                       hover:bg-accent-primary/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:101,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:92,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:80,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:67,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:63,columnNumber:5},void 0),document.body):null},bz=({isOpen:e,title:t,message:n,confirmLabel:s="Confirm",danger:a=!1,onConfirm:o,onClose:r})=>{const i=l.useCallback(e=>{"Escape"===e.key?r():"Enter"===e.key&&(o(),r())},[r,o]);return l.useEffect(()=>{if(e)return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[e,i]),e?ZV.createPortal(Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:r,children:Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px] max-w-[400px]",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[Yn.jsxDEV("h3",{className:"text-sm font-semibold text-text-primary",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:155,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:r,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:Yn.jsxDEV(Ce,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:160,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:156,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:154,columnNumber:9},void 0),Yn.jsxDEV("p",{className:"text-sm text-text-secondary mb-4",children:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:163,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex justify-end gap-2",children:[Yn.jsxDEV("button",{onClick:r,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                     hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:165,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>{o(),r()},className:"px-3 py-1.5 text-sm rounded transition-colors "+(a?"bg-accent-error text-white hover:bg-accent-error/80":"bg-accent-primary text-text-inverse hover:bg-accent-primary/80"),children:s},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:172,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:164,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:150,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:146,columnNumber:5},void 0),document.body):null},vz=({instrumentId:e,onEdit:t,onSavePreset:n,children:s})=>{const{position:a,open:o,close:r,isOpen:i}=sP(),{instruments:c,setCurrentInstrument:u,cloneInstrument:d,deleteInstrument:m,updateInstrument:p}=EN(),[h,f]=l.useState(!1),[g,b]=l.useState(!1),v=c.find(t=>t.id===e),y=c.length>1,x=l.useCallback(t=>{p(e,{name:t})},[e,p]),N=l.useCallback(()=>{p(e,{synthType:"Synth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0})},[e,p]),w=l.useMemo(()=>v?[{id:"edit",label:"Edit",icon:Yn.jsxDEV(hn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:239,columnNumber:15},void 0),onClick:()=>{u(e),t?.()}},{type:"divider"},{id:"duplicate",label:"Duplicate",icon:Yn.jsxDEV(Je,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:250,columnNumber:15},void 0),onClick:()=>d(e)},{id:"delete",label:"Delete",icon:Yn.jsxDEV(Ie,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:257,columnNumber:15},void 0),danger:!0,disabled:!y,onClick:()=>m(e)},{type:"divider"},{id:"rename",label:"Rename",icon:Yn.jsxDEV(fn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:267,columnNumber:15},void 0),onClick:()=>f(!0)},{type:"divider"},{id:"copy-settings",label:"Copy Settings",icon:Yn.jsxDEV(gn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:275,columnNumber:15},void 0),onClick:()=>{localStorage.setItem("devilbox-instrument-clipboard",JSON.stringify(v))}},{id:"paste-settings",label:"Paste Settings",icon:Yn.jsxDEV(kt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:285,columnNumber:15},void 0),onClick:()=>{const t=localStorage.getItem("devilbox-instrument-clipboard");if(t)try{const n=JSON.parse(t),{id:s,name:a,...o}=n;p(e,o)}catch(n){}}},{type:"divider"},{id:"save-preset",label:"Save as Preset",icon:Yn.jsxDEV(it,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:306,columnNumber:15},void 0),onClick:()=>{n?.()}},{id:"reset",label:"Reset to Default",icon:Yn.jsxDEV(Ft,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:315,columnNumber:15},void 0),danger:!0,onClick:()=>b(!0)}]:[],[v,e,y,u,d,m,p,t,n]);return Yn.jsxDEV("div",{onContextMenu:o,children:[s,i&&Yn.jsxDEV(tP,{items:w,position:a,onClose:r},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:336,columnNumber:9},void 0),Yn.jsxDEV(gz,{isOpen:h,currentName:v?.name||"",onConfirm:x,onClose:()=>f(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:344,columnNumber:7},void 0),Yn.jsxDEV(bz,{isOpen:g,title:"Reset Instrument",message:"Reset this instrument to default settings? This cannot be undone.",confirmLabel:"Reset",danger:!0,onConfirm:N,onClose:()=>b(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:352,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentContextMenu.tsx",lineNumber:333,columnNumber:5},void 0)},yz=({onClose:e})=>{const{currentInstrumentId:t,updateInstrument:n,setPreviewInstrument:s}=EN(),{userPresets:a,deletePreset:o,addToRecent:r,exportPresets:i,importPresets:c,importNKSFFiles:u,exportAllPresetsAsNKSF:d}=JC(),[m,p]=l.useState("factory"),[h,f]=l.useState("Bass"),[g,b]=l.useState("All"),[v,y]=l.useState(""),[x,N]=l.useState(null),[w,E]=l.useState(null),k=l.useRef(null),D=l.useRef(null),S=Object.keys(tN),M=e=>{p(e),N(null),E(null),y("")},C=l.useMemo(()=>{if("user"===m&&w){const e=a.find(e=>e.id===w);return e?e.config:null}return"factory"===m&&x&&tN[h].find(e=>e.name===x)||null},[m,x,h,w,a]);l.useEffect(()=>{const t=t=>{"Escape"===t.key&&(t.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),l.useEffect(()=>{if(C){const e={...C,id:999,isLive:!0};s(e);try{Bw().invalidateInstrument(999)}catch{}}else s(null);return()=>{s(null);try{Bw().invalidateInstrument(999)}catch{}}},[C,s]),l.useEffect(()=>{const e=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&C){const e=Bw(),n={...C,id:999,isLive:!0};e.triggerPolyNoteAttack(999,t,1,n)}},t=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&C){const e=Bw(),n={...C,id:999,isLive:!0};e.triggerPolyNoteRelease(999,t,n)}};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[C]);const V=e=>vn[e]||Jt,P=l.useMemo(()=>{const e=tN[h]||[];if(!v.trim())return e;const t=v.toLowerCase();return e.filter(e=>e.name?.toLowerCase().includes(t)||e.synthType?.toLowerCase().includes(t))},[h,v]),_=l.useMemo(()=>{let e=a;if("All"!==g&&(e=e.filter(e=>e.category===g)),!v.trim())return e;const t=v.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.synthType.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))},[a,g,v]),O=s=>{null!==t&&(n(t,s),e())},T=(s,a)=>{null!==t&&(r(s),n(t,a),e())},L=e=>({Bass:"text-blue-400",Leads:"text-yellow-400",Pads:"text-purple-400",Drums:"text-red-400","TR-808":"text-red-500","TR-909":"text-orange-400","TR-707":"text-rose-400","TR-505":"text-amber-400",Chip:"text-cyan-400",Furnace:"text-teal-400",FX:"text-green-400",Dub:"text-green-400",DubSiren:"text-red-500",SpaceLaser:"text-green-500",V2:"text-amber-500",Sam:"text-amber-500",Synare:"text-yellow-500",Drumnibus:"text-emerald-400",Keys:"text-amber-600",MAME:"text-pink-400",Module:"text-lime-400",Lead:"text-yellow-400",Pad:"text-purple-400",Drum:"text-red-400",User:"text-gray-400",All:"text-ft2-highlight"}[e]||"text-ft2-highlight"),B="factory"===m?P.length:_.length;return Yn.jsxDEV("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:[Yn.jsxDEV("div",{className:"w-full h-full bg-ft2-bg flex flex-col overflow-hidden",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("h2",{className:"text-ft2-highlight font-bold text-sm uppercase tracking-widest",children:"LOAD PRESET"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:348,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-ft2-textDim text-[10px]",children:"Browse, Jam and Load sounds"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:349,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:347,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("div",{className:"flex bg-ft2-bg rounded overflow-hidden border border-ft2-border",children:[Yn.jsxDEV("button",{onClick:()=>M("factory"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("factory"===m?"bg-ft2-cursor text-ft2-bg":"text-ft2-textDim hover:text-ft2-text"),children:"Factory"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:354,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>M("user"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("user"===m?"bg-amber-500 text-black":"text-ft2-textDim hover:text-ft2-text"),children:["User (",a.length,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:364,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:353,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:e,className:"p-2 text-ft2-textDim hover:text-ft2-text hover:bg-ft2-border rounded transition-colors",children:Yn.jsxDEV(Ce,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:379,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:375,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:351,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:346,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"px-4 py-3 bg-ft2-header border-b border-ft2-border",children:Yn.jsxDEV("div",{className:"relative",children:[Yn.jsxDEV(Gt,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-ft2-textDim"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:387,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"text",value:v,onChange:e=>y(e.target.value),placeholder:"factory"===m?"Search factory presets...":"Search user presets by name, synth type, or tag...",className:"w-full pl-10 pr-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text rounded focus:border-ft2-highlight focus:outline-none placeholder:text-ft2-textDim/50",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:388,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:386,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:385,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex flex-wrap gap-1 px-4 py-2 bg-ft2-header border-b border-ft2-border",children:"factory"===m?S.map(e=>{const t=h===e;return Yn.jsxDEV("button",{onClick:()=>(e=>{f(e),N(null),y("")})(e),className:`\n                    px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                    ${t?"bg-ft2-cursor text-ft2-bg shadow-[0_0_15px_rgba(255,255,255,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-ft2-highlight ${L(e)}`}\n                  `,children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:405,columnNumber:17},void 0)}):Yn.jsxDEV(Yn.Fragment,{children:[["All","Bass","Lead","Pad","Drum","FX","User"].map(e=>{const t=g===e;return Yn.jsxDEV("button",{onClick:()=>{b(e),E(null)},className:`\n                      px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                      ${t?"bg-amber-500 text-black shadow-[0_0_15px_rgba(245,158,11,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-amber-500/50 ${L(e)}`}\n                    `,children:e},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:425,columnNumber:19},void 0)}),Yn.jsxDEV("div",{className:"ml-auto flex items-center gap-1",children:[Yn.jsxDEV("button",{onClick:()=>k.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import presets from JSON file",children:[Yn.jsxDEV(Yt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:447,columnNumber:19},void 0)," Import"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:442,columnNumber:17},void 0),Yn.jsxDEV("button",{onClick:()=>D.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import .nksf preset files",children:[Yn.jsxDEV(Yt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:454,columnNumber:19},void 0)," NKSF"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:449,columnNumber:17},void 0),Yn.jsxDEV("button",{onClick:()=>{const e=i();if(0===e.length)return void _k.warning("No user presets to export");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download="devilbox-presets.json",s.click(),URL.revokeObjectURL(n),_k.success(`Exported ${e.length} presets`,2e3)},className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all user presets as JSON",children:[Yn.jsxDEV(Ge,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:461,columnNumber:19},void 0)," Export"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:456,columnNumber:17},void 0),Yn.jsxDEV("button",{onClick:()=>d("DEViLBOX User"),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all presets as .nksf files",children:[Yn.jsxDEV(Ge,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:468,columnNumber:19},void 0)," NKS"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:463,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:441,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:421,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:400,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-ft2",children:"factory"===m?0===P.length?Yn.jsxDEV("div",{className:"flex items-center justify-center h-full text-ft2-textDim font-mono text-sm uppercase",children:['No presets found matching "',v,'"']},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:480,columnNumber:15},void 0):Yn.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:P.map((e,t)=>{const n=fz(e.synthType||"Synth"),s=V(n.icon),a=x===e.name;return Yn.jsxDEV("button",{onClick:()=>(async e=>{N(e.name||null),E(null);try{await A();const t=Bw(),n={...e,id:999,isLive:!0};await t.ensureInstrumentReady(n),t.triggerPolyNoteAttack(999,"C4",1,n),setTimeout(()=>{t.triggerPolyNoteRelease(999,"C4",n)},300)}catch(t){}})(e),onDoubleClick:()=>O(e),className:`\n                        p-3 rounded border-2 text-left transition-all group\n                        ${a?"bg-ft2-cursor text-ft2-bg border-ft2-cursor shadow-[0_0_20px_rgba(255,255,255,0.1)]":"bg-ft2-header border-ft2-border hover:border-ft2-highlight hover:bg-ft2-bg"}\n                      `,children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 mb-1",children:[Yn.jsxDEV(s,{size:14,className:a?"text-ft2-bg":n.color},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:504,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"font-bold text-sm truncate "+(a?"text-ft2-bg":"text-ft2-text"),children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:505,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:503,columnNumber:23},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("span",{className:"text-[10px] font-mono uppercase "+(a?"text-ft2-bg/80":"text-ft2-textDim"),children:e.synthType},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:510,columnNumber:25},void 0),e.effects&&e.effects.length>0&&Yn.jsxDEV("span",{className:"text-[9px] px-1.5 font-bold rounded "+(a?"bg-ft2-bg/20 text-ft2-bg":"bg-green-600/20 text-green-400"),children:[e.effects.length," FX"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:514,columnNumber:27},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:509,columnNumber:23},void 0)]},`${h}-${e.name}-${t}`,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:491,columnNumber:21},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:484,columnNumber:15},void 0):0===_.length?Yn.jsxDEV("div",{className:"flex flex-col items-center justify-center h-full gap-3 text-ft2-textDim",children:[Yn.jsxDEV("span",{className:"font-mono text-sm uppercase",children:0===a.length?"No user presets yet":`No presets matching "${v}"`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:528,columnNumber:17},void 0),0===a.length&&Yn.jsxDEV("p",{className:"text-xs text-center max-w-md",children:"Save presets from the instrument editor to build your library. You can also import presets using the buttons above."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:532,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:527,columnNumber:15},void 0):Yn.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:_.map(e=>{const t=fz(e.synthType),n=V(t.icon),s=w===e.id;return Yn.jsxDEV("div",{onClick:()=>(async(e,t)=>{E(e),N(null);try{await A();const e=Bw(),n={...t,id:999,isLive:!0};await e.ensureInstrumentReady(n),e.triggerPolyNoteAttack(999,"C4",1,n),setTimeout(()=>{e.triggerPolyNoteRelease(999,"C4",n)},300)}catch(n){}})(e.id,e.config),onDoubleClick:()=>T(e.id,e.config),className:`\n                        p-3 rounded border-2 text-left transition-all group cursor-pointer relative\n                        ${s?"bg-amber-500 text-black border-amber-500 shadow-[0_0_20px_rgba(245,158,11,0.2)]":"bg-ft2-header border-ft2-border hover:border-amber-500/50 hover:bg-ft2-bg"}\n                      `,children:[Yn.jsxDEV("button",{onClick:t=>((e,t)=>{e.stopPropagation(),o(t),w===t&&E(null),_k.success("Preset deleted",2e3)})(t,e.id),className:"absolute top-1 right-1 p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity "+(s?"hover:bg-black/20 text-black/60":"hover:bg-red-500/20 text-red-400/60 hover:text-red-400"),title:"Delete preset",children:Yn.jsxDEV(Ie,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:566,columnNumber:25},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:559,columnNumber:23},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2 mb-1",children:[Yn.jsxDEV(n,{size:14,className:s?"text-black":t.color},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:570,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"font-bold text-sm truncate "+(s?"text-black":"text-ft2-text"),children:e.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:571,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:569,columnNumber:23},void 0),Yn.jsxDEV("div",{className:"flex items-center justify-between mb-1",children:[Yn.jsxDEV("span",{className:"text-[10px] font-mono uppercase "+(s?"text-black/70":"text-ft2-textDim"),children:e.synthType},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:576,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"text-[9px] px-1.5 font-bold rounded "+(s?"bg-black/10 text-black/70":"bg-amber-500/10 text-amber-400"),children:e.category},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:579,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:575,columnNumber:23},void 0),e.tags.length>0&&Yn.jsxDEV("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.slice(0,3).map(e=>Yn.jsxDEV("span",{className:"text-[8px] px-1 rounded flex items-center gap-0.5 "+(s?"bg-black/10 text-black/60":"bg-ft2-bg text-ft2-textDim"),children:[Yn.jsxDEV(bn,{size:7},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:593,columnNumber:31},void 0),e]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:587,columnNumber:29},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:585,columnNumber:25},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:546,columnNumber:21},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:539,columnNumber:15},void 0)},`${m}-${h}-${g}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:476,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3 px-4 py-3 pb-6 sm:pb-3 bg-ft2-header border-t-2 border-ft2-border safe-area-bottom",children:[Yn.jsxDEV("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 min-w-0",children:[Yn.jsxDEV("div",{className:"text-ft2-textDim text-xs font-mono truncate",children:[B," PRESET",1!==B?"S":"","  ","factory"===m?h.toUpperCase():"All"===g?"ALL USER":g.toUpperCase(),(x||w)&&Yn.jsxDEV("span",{className:"ml-2 text-ft2-text hidden sm:inline",children:" DOUBLE-CLICK TO APPLY"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:612,columnNumber:64},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:610,columnNumber:13},void 0),C&&Yn.jsxDEV("div",{className:"hidden sm:flex items-center gap-2 px-2 py-1 bg-amber-500/10 border border-amber-500/30 rounded animate-pulse-glow",children:[Yn.jsxDEV(Oe,{size:12,className:"text-amber-400 fill-amber-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:618,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[10px] font-black text-amber-400 uppercase tracking-widest",children:"JAM ACTIVE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:619,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:617,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:609,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-2 w-full sm:w-auto",children:[Yn.jsxDEV("button",{onClick:e,className:"flex-1 sm:flex-none px-4 py-3 sm:py-2 bg-ft2-bg border border-ft2-border text-ft2-text hover:border-ft2-highlight rounded transition-colors font-bold text-xs uppercase",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:625,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>{if("user"===m&&w){const e=a.find(e=>e.id===w);e&&T(e.id,e.config)}else C&&O(C)},disabled:!C,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-6 py-3 sm:py-2 bg-ft2-cursor text-ft2-bg font-black hover:bg-ft2-highlight rounded transition-all disabled:opacity-30 disabled:cursor-not-allowed uppercase text-xs",children:[Yn.jsxDEV(Be,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:643,columnNumber:15},void 0),"Load Preset"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:631,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:624,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:608,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:344,columnNumber:7},void 0),Yn.jsxDEV("input",{ref:k,type:"file",accept:".json",className:"hidden",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{const e=JSON.parse(n.result);Array.isArray(e)?(c(e),_k.success(`Imported ${e.length} presets`,2e3)):_k.error("Invalid preset file format")}catch{_k.error("Failed to parse preset file")}},n.readAsText(t),k.current&&(k.current.value="")}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:651,columnNumber:7},void 0),Yn.jsxDEV("input",{ref:D,type:"file",accept:".nksf",multiple:!0,className:"hidden",onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;const n=await u(Array.from(t));n.length>0?_k.success(`Imported ${n.length} NKSF presets`,2e3):_k.error("Failed to import NKSF files"),D.current&&(D.current.value="")}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:658,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/presets/LoadPresetModal.tsx",lineNumber:343,columnNumber:5},void 0)},xz=new TextEncoder;function Nz(e,t){const n=[];for(let s=0;s<t;s++){const t=e[s];!t||0===t.note&&0===t.instrument&&0===t.effTyp&&0===t.eff&&0===t.effTyp2&&0===t.eff2?n.push("0"):n.push(`${t.note}:${t.instrument}:${t.effTyp}:${t.eff}:${t.effTyp2}:${t.eff2}:${t.volume||0}:${t.flag1||0}:${t.flag2||0}`)}return n.join(",")}function wz(e,t,n,s){if(void 0!==n&&0!==n&&0===e&&0===t)return{fx:4,fxParam:n};if(void 0!==s&&0!==s&&0===e&&0===t)return{fx:9,fxParam:s};switch(e){case 1:return{fx:1,fxParam:t};case 2:return{fx:2,fxParam:t};case 3:return{fx:3,fxParam:t};case 5:return{fx:5,fxParam:t};case 8:return{fx:7,fxParam:t};case 10:return{fx:10,fxParam:t};case 11:return{fx:11,fxParam:t};case 13:return{fx:13,fxParam:t};case 14:return{fx:14,fxParam:t};case 15:return{fx:15,fxParam:t};default:return{fx:0,fxParam:0}}}function Ez(e,t={}){const n=[],s=t.format??"hvl",a="ahx"===s,o=t.moduleName??e.name??"Untitled",r=e.numChannels;a&&r>4&&n.push(`AHX format supports max 4 channels. Song has ${r} channels  truncating.`);const i=a?Math.min(r,4):r,l=e.patterns[0]?.length??64;l>64&&n.push(`Track length ${l} exceeds HVL max of 64. Truncating.`);const c=Math.min(l,64),u=new Map,d=[],m=Array.from({length:c},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),p=Nz(m,c);u.set(p,{steps:m,index:0});for(const _ of e.songPositions){const t=e.patterns[_];if(!t)continue;const n=[],s=[];for(let e=0;e<i;e++){const a=t.channels[e];if(!a){n.push(0),s.push(0);continue}const o=a.rows.slice(0,c);for(;o.length<c;)o.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0});const r=Nz(o,c);u.has(r)||u.set(r,{steps:o,index:u.size}),n.push(u.get(r).index),s.push(0)}d.push({trackIndices:n,transposes:s})}const h=Array.from({length:u.size});for(const{steps:_,index:O}of u.values())h[O]=_;const f=h.length-1,g=d.length,b=[];for(const _ of e.instruments)b.push({name:_.name,config:_.hively??null});const v=b.length,y=e.hivelyMeta,x=y?.speedMultiplier??1,N=y?.stereoMode??2,w=y?.mixGain??194.56,E=y?.version??1,k=[o];for(const _ of b)k.push(_.name);const D=k.map(e=>e+"\0").join(""),S=xz.encode(D);let M=0;if(a){M+=14,M+=0,M+=g*i*2;for(let e=0;e<=f;e++)0!==e&&(M+=3*c);for(const e of b){M+=22+4*(e.config?.performanceList?.entries?.length??0)}M+=S.length}else{M+=16,M+=0,M+=g*i*2;for(let e=0;e<=f;e++){if(0===e)continue;const t=h[e];for(let e=0;e<c;e++){const n=t[e];n&&(0!==n.note||0!==n.instrument||0!==n.volume||0!==n.effTyp||0!==n.eff||0!==n.effTyp2||0!==n.eff2||n.flag1||n.flag2)?M+=5:M+=1}}for(const e of b){M+=22+5*(e.config?.performanceList?.entries?.length??0)}M+=S.length}const C=new Uint8Array(M);let V=0;const P=M-S.length;if(a){C[0]=84,C[1]=72,C[2]=88,C[3]=2,C[4]=P>>8&255,C[5]=255&P;const t=(x-1&3)<<5,n=g>>8&15,s=128;C[6]=s|t|n,C[7]=255&g,C[8]=e.restartPosition>>8&255,C[9]=255&e.restartPosition,C[10]=c,C[11]=f,C[12]=v,C[13]=0,V=14;for(const e of d)for(let t=0;t<i;t++)C[V++]=e.trackIndices[t]??0,C[V++]=e.transposes[t]??0;for(let e=0;e<=f;e++){if(0===e)continue;const t=h[e];for(let e=0;e<c;e++){const n=t[e],s=n?.note??0,a=n?.instrument??0,o=wz(n?.effTyp??0,n?.eff??0,n?.flag1,n?.flag2);(n?.volume??0)>0&&0===o.fx&&0===o.fxParam&&(o.fx=12,o.fxParam=n.volume),C[V++]=(63&s)<<2|a>>4&3,C[V++]=(15&a)<<4|15&o.fx,C[V++]=255&o.fxParam}}}else{C[0]=72,C[1]=86,C[2]=76,C[3]=1&E,C[4]=P>>8&255,C[5]=255&P;const t=(x-1&3)<<5,n=g>>8&15,s=128;C[6]=s|t|n,C[7]=255&g;const a=(i-4&63)<<2,o=e.restartPosition>>8&3;C[8]=a|o,C[9]=255&e.restartPosition,C[10]=c,C[11]=f,C[12]=v,C[13]=0;const r=Math.round(100*w/256);C[14]=255&r,C[15]=15&N,V=16;for(const e of d)for(let t=0;t<i;t++)C[V++]=e.trackIndices[t]??0,C[V++]=e.transposes[t]??0;for(let e=0;e<=f;e++){if(0===e)continue;const t=h[e];for(let e=0;e<c;e++){const n=t[e],s=n?.note??0,a=n?.instrument??0,o=wz(n?.effTyp??0,n?.eff??0,n?.flag1,n?.flag2),r=wz(n?.effTyp2??0,n?.eff2??0);(n?.volume??0)>0&&0===o.fx&&0===o.fxParam&&(o.fx=12,o.fxParam=n.volume),0===s&&0===a&&0===o.fx&&0===o.fxParam&&0===r.fx&&0===r.fxParam?C[V++]=63:(C[V++]=255&s,C[V++]=255&a,C[V++]=(15&o.fx)<<4|15&r.fx,C[V++]=255&o.fxParam,C[V++]=255&r.fxParam)}}}for(const _ of b){const e=_.config,t=e?.volume??64,n=e?.waveLength??3,s=e?.filterSpeed??0,o=e?.filterLowerLimit??0,r=e?.filterUpperLimit??0,i=e?.squareLowerLimit??0,l=e?.squareUpperLimit??0,c=e?.squareSpeed??0,u=e?.vibratoDelay??0,d=e?.vibratoSpeed??0,m=e?.vibratoDepth??0,p=e?.hardCutRelease??!1,h=e?.hardCutReleaseFrames??0,f=e?.envelope??{aFrames:1,aVolume:64,dFrames:1,dVolume:64,sFrames:1,rFrames:1,rVolume:0},g=e?.performanceList??{speed:1,entries:[]};C[V++]=255&t,C[V++]=(31&s)<<3|7&n,C[V++]=255&f.aFrames,C[V++]=255&f.aVolume,C[V++]=255&f.dFrames,C[V++]=255&f.dVolume,C[V++]=255&f.sFrames,C[V++]=255&f.rFrames,C[V++]=255&f.rVolume,C[V++]=0,C[V++]=0,C[V++]=0,C[V++]=127&o|(s>>5&1)<<7,C[V++]=255&u,C[V++]=(p?128:0)|(7&h)<<4|15&m,C[V++]=255&d,C[V++]=255&i,C[V++]=255&l,C[V++]=255&c,C[V++]=63&r,C[V++]=255&g.speed,C[V++]=255&g.entries.length;for(const b of g.entries)if(a){let e=7&b.fx[1];12===b.fx[1]&&(e=6),15===b.fx[1]&&(e=7);let t=7&b.fx[0];12===b.fx[0]&&(t=6),15===b.fx[0]&&(t=7);const n=b.waveform>>1&3;C[V++]=e<<5|t<<2|n,C[V++]=(1&b.waveform)<<7|(b.fixed?1:0)<<6|63&b.note,C[V++]=255&b.fxParam[0],C[V++]=255&b.fxParam[1]}else C[V++]=15&b.fx[0],C[V++]=(15&b.fx[1])<<3|7&b.waveform,C[V++]=(b.fixed?1:0)<<6|63&b.note,C[V++]=255&b.fxParam[0],C[V++]=255&b.fxParam[1]}C.set(S,P);return{data:new Blob([C],{type:"application/octet-stream"}),warnings:n,filename:`${o.replace(/[^a-zA-Z0-9_-]/g,"_")}.${s}`}}const kz=new TextDecoder("iso-8859-1");function Dz(e,t,n){let s=t;for(;s<t+n&&s<e.length&&0!==e[s];)s++;return kz.decode(e.subarray(t,s))}function Sz(e){const t=new Uint8Array(e);if(t.length<16)throw new Error("File too small for HVL/AHX format");if(84===t[0]&&72===t[1]&&88===t[2]&&t[3]<3)return function(e){const t=e[3],n=(15&e[6])<<8|e[7],s=e[12],a=e[13],o=e[10],r=e[11],i=1+(e[6]>>5&3),l=Math.min(e[8]<<8|e[9],n>0?n-1:0);if(n>1e3||o>64||s>64)throw new Error(`Invalid AHX file: posn=${n}, trkl=${o}, insn=${s}`);const c=e[4]<<8|e[5],u=Dz(e,c,128);let d=c+u.length+1,m=14;const p=[];for(let v=0;v<a;v++){let t=e[m]<<8|e[m+1];t>=n&&(t=0),p.push(t),m+=2}const h=[];for(let v=0;v<n;v++){const t=[],n=[];for(let s=0;s<4;s++)t.push(e[m++]),n.push(e[m]>127?e[m]-256:e[m]),m++;h.push({track:t,transpose:n})}const f=!(128&~e[6]),g=[];for(let v=0;v<=r;v++){const t=[];if(f&&0===v){for(let e=0;e<o;e++)t.push({note:0,instrument:0,fx:0,fxParam:0,fxb:0,fxbParam:0});g.push(t)}else{for(let n=0;n<o;n++){const n=e[m]>>2&63,s=(3&e[m])<<4|e[m+1]>>4,a=15&e[m+1],o=e[m+2];t.push({note:n,instrument:s,fx:a,fxParam:o,fxb:0,fxbParam:0}),m+=3}g.push(t)}}const b=[];for(let v=1;v<=s;v++){const n=d<e.length?Dz(e,d,128):"";d+=n.length+1;const s=e[m],a=e[m+1]>>3&31|e[m+12]>>2&32,o=7&e[m+1],r={aFrames:e[m+2],aVolume:e[m+3],dFrames:e[m+4],dVolume:e[m+5],sFrames:e[m+6],rFrames:e[m+7],rVolume:e[m+8]},i=127&e[m+12],l=e[m+13],c=e[m+14]>>4&7,u=!!(128&e[m+14]),p=15&e[m+14],h=e[m+15],f=e[m+16],g=e[m+17],v=e[m+18],y=63&e[m+19],x=e[m+20],N=e[m+21];m+=22;const w=[];for(let d=0;d<N;d++){let n=e[m]>>5&7;6===n&&(n=12),7===n&&(n=15);let s=e[m]>>2&7;6===s&&(s=12),7===s&&(s=15);const a=e[m]<<1&6|e[m+1]>>7,o=!!(e[m+1]>>6&1),r=63&e[m+1],i=e[m+2],l=e[m+3];let c=i,u=l;0===t&&4===s&&240&i&&(c&=15),0===t&&4===n&&240&l&&(u&=15),w.push({note:r,waveform:a,fixed:o,fx:[s,n],fxParam:[c,u]}),m+=4}b.push({name:n,volume:s,waveLength:o,filterLowerLimit:i,filterUpperLimit:y,filterSpeed:a,squareLowerLimit:f,squareUpperLimit:g,squareSpeed:v,vibratoDelay:l,vibratoSpeed:h,vibratoDepth:p,hardCutRelease:u,hardCutReleaseFrames:c,envelope:r,performanceList:{speed:x,length:N,entries:w}})}return{name:u,format:"AHX",version:t,channels:4,trackLength:o,numTracks:r,numInstruments:s,numSubsongs:a,numPositions:n,restartPosition:l,speedMultiplier:i,defaultTempo:6,stereoMode:2,mixGain:194.56,positions:h,tracks:g,instruments:b,subsongs:p}}(t);if(72===t[0]&&86===t[1]&&76===t[2]&&t[3]<=1)return function(e){const t=e[3],n=(15&e[6])<<8|e[7],s=e[12],a=e[13],o=4+(e[8]>>2),r=e[10],i=e[11],l=1+(e[6]>>5&3),c=Math.min((3&e[8])<<8|e[9],n>0?n-1:0),u=(e[14]<<8)/100,d=e[15];if(n>1e3||r>64||s>64)throw new Error(`Invalid HVL file: posn=${n}, trkl=${r}, insn=${s}`);const m=e[4]<<8|e[5],p=Dz(e,m,128);let h=m+p.length+1,f=16;const g=[];for(let N=0;N<a;N++)g.push(e[f]<<8|e[f+1]),f+=2;const b=[];for(let N=0;N<n;N++){const t=[],n=[];for(let s=0;s<o;s++)t.push(e[f++]),n.push(e[f]>127?e[f]-256:e[f]),f++;b.push({track:t,transpose:n})}const v=!(128&~e[6]),y=[];for(let N=0;N<=i;N++){const t=[];if(v&&0===N){for(let e=0;e<r;e++)t.push({note:0,instrument:0,fx:0,fxParam:0,fxb:0,fxbParam:0});y.push(t)}else{for(let n=0;n<r;n++){if(63===e[f]){t.push({note:0,instrument:0,fx:0,fxParam:0,fxb:0,fxbParam:0}),f++;continue}const n=e[f],s=e[f+1],a=e[f+2]>>4,o=e[f+3],r=15&e[f+2],i=e[f+4];t.push({note:n,instrument:s,fx:a,fxParam:o,fxb:r,fxbParam:i}),f+=5}y.push(t)}}const x=[];for(let N=1;N<=s;N++){const t=h<e.length?Dz(e,h,128):"";h+=t.length+1;const n=e[f],s=e[f+1]>>3&31|e[f+12]>>2&32,a=7&e[f+1],o={aFrames:e[f+2],aVolume:e[f+3],dFrames:e[f+4],dVolume:e[f+5],sFrames:e[f+6],rFrames:e[f+7],rVolume:e[f+8]},r=127&e[f+12],i=e[f+13],l=e[f+14]>>4&7,c=!!(128&e[f+14]),u=15&e[f+14],d=e[f+15],m=e[f+16],p=e[f+17],g=e[f+18],b=63&e[f+19],v=e[f+20],y=e[f+21];f+=22;const N=[];for(let h=0;h<y;h++){const t=15&e[f],n=e[f+1]>>3&15,s=7&e[f+1],a=!!(e[f+2]>>6&1),o=63&e[f+2],r=e[f+3],i=e[f+4];N.push({note:o,waveform:s,fixed:a,fx:[t,n],fxParam:[r,i]}),f+=5}x.push({name:t,volume:n,waveLength:a,filterLowerLimit:r,filterUpperLimit:b,filterSpeed:s,squareLowerLimit:m,squareUpperLimit:p,squareSpeed:g,vibratoDelay:i,vibratoSpeed:d,vibratoDepth:u,hardCutRelease:c,hardCutReleaseFrames:l,envelope:o,performanceList:{speed:v,length:y,entries:N}})}return{name:p,format:"HVL",version:t,channels:o,trackLength:r,numTracks:i,numInstruments:s,numSubsongs:a,numPositions:n,restartPosition:c,speedMultiplier:l,defaultTempo:6,stereoMode:d,mixGain:u,positions:b,tracks:y,instruments:x,subsongs:g}}(t);throw new Error("Not a valid HVL or AHX file (bad magic bytes)")}function Mz(e,t){switch(e){case 0:case 6:case 8:default:return{effTyp:0,eff:0};case 1:return{effTyp:1,eff:t};case 2:return{effTyp:2,eff:t};case 3:return{effTyp:3,eff:t};case 4:return{effTyp:0,eff:0,flag1:t};case 5:return{effTyp:5,eff:t};case 7:return{effTyp:8,eff:t};case 9:return{effTyp:0,eff:0,flag2:t};case 10:return{effTyp:10,eff:t};case 11:return{effTyp:11,eff:t};case 12:return{effTyp:0,eff:0,volume:t};case 13:return{effTyp:13,eff:t};case 14:return{effTyp:14,eff:t};case 15:return{effTyp:15,eff:t}}}function Cz(e,t){const n=e.channels,s=e.trackLength,a=[];for(let c=0;c<e.numPositions;c++){const o=e.positions[c],r=Array.from({length:n},(t,n)=>{const a=o.track[n],r=o.transpose[n],i=e.tracks[a],l=[];for(let e=0;e<s;e++){const t=i?.[e]??{note:0,instrument:0,fx:0,fxParam:0,fxb:0,fxbParam:0};let n=0;t.note>0&&t.note<=60&&(n=t.note+r,n<1&&(n=1),n>96&&(n=96));const s=Mz(t.fx,t.fxParam),a=Mz(t.fxb,t.fxbParam),o={note:n,instrument:t.instrument,volume:s.volume??a.volume??0,effTyp:s.effTyp,eff:s.eff,effTyp2:a.effTyp,eff2:a.eff};void 0!==s.flag1&&(o.flag1=s.flag1),void 0!==s.flag2&&(o.flag2=s.flag2),void 0!==a.flag1&&void 0===o.flag1&&(o.flag1=a.flag1),void 0!==a.flag2&&void 0===o.flag2&&(o.flag2=a.flag2),l.push(o)}return{id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:l}});a.push({id:`pattern-${c}`,name:`Position ${c}`,length:s,channels:r,importMetadata:{sourceFormat:e.format,sourceFile:t,importedAt:(new Date).toISOString(),originalChannelCount:n,originalPatternCount:e.numPositions,originalInstrumentCount:e.numInstruments}})}const o=e.instruments.map((e,t)=>({id:t+1,name:e.name||`Instrument ${t+1}`,type:"synth",synthType:"HivelySynth",effects:[],volume:-6,pan:0,hively:{volume:e.volume,waveLength:e.waveLength,filterLowerLimit:e.filterLowerLimit,filterUpperLimit:e.filterUpperLimit,filterSpeed:e.filterSpeed,squareLowerLimit:e.squareLowerLimit,squareUpperLimit:e.squareUpperLimit,squareSpeed:e.squareSpeed,vibratoDelay:e.vibratoDelay,vibratoSpeed:e.vibratoSpeed,vibratoDepth:e.vibratoDepth,hardCutRelease:e.hardCutRelease,hardCutReleaseFrames:e.hardCutReleaseFrames,envelope:{...e.envelope},performanceList:{speed:e.performanceList.speed,entries:e.performanceList.entries.map(e=>({note:e.note,waveform:e.waveform,fixed:e.fixed,fx:[...e.fx],fxParam:[...e.fxParam]}))}}})),r=Array.from({length:e.numPositions},(e,t)=>t),i=e.format,l=function(e){const t=e.tracks.map((e,t)=>({id:t,steps:e.map(e=>({note:e.note,instrument:e.instrument,fx:e.fx,fxParam:e.fxParam,fxb:e.fxb,fxbParam:e.fxbParam}))})),n=e.positions.map(e=>({track:[...e.track],transpose:[...e.transpose]}));return{channels:e.channels,trackLength:e.trackLength,tracks:t,positions:n,tempo:e.defaultTempo,speedMultiplier:e.speedMultiplier}}(e);return{name:e.name||t.replace(/\.[^/.]+$/,""),format:i,patterns:a,instruments:o,songPositions:r,songLength:e.numPositions,restartPosition:e.restartPosition,numChannels:n,initialSpeed:e.defaultTempo,initialBPM:125*e.speedMultiplier,linearPeriods:!1,hivelyMeta:{stereoMode:e.stereoMode,mixGain:e.mixGain,speedMultiplier:e.speedMultiplier,version:e.version},hivelyNative:l}}function Vz(e){const t=new Uint8Array(e);if(t.length<26)throw new Error("Invalid .ahi file: too short");const n=String.fromCharCode(t[0],t[1],t[2],t[3]);if("THXI"!==n&&"HVLI"!==n)throw new Error(`Invalid .ahi magic: "${n}"`);const s="THXI"===n,a=t[4],o=t[5]>>3&31|t[16]>>2&32,r=7&t[5],i={aFrames:t[6],aVolume:t[7],dFrames:t[8],dVolume:t[9],sFrames:t[10],rFrames:t[11],rVolume:t[12]},l=127&t[16],c=t[17],u=!!(128&t[18]),d=t[18]>>4&7,m=15&t[18],p=t[19],h=t[20],f=t[21],g=t[22],b=63&t[23],v=t[24],y=t[25];let x=26;const N=s?4:5;if(t.length<x+y*N)throw new Error("Invalid .ahi file: truncated plist data");const w=[];for(let k=0;k<y;k++)if(s){let e=t[x]>>5&7;6===e&&(e=12),7===e&&(e=15);let n=t[x]>>2&7;6===n&&(n=12),7===n&&(n=15);const s=t[x]<<1&6|t[x+1]>>7,a=!!(t[x+1]>>6&1),o=63&t[x+1];w.push({note:o,waveform:s,fixed:a,fx:[n,e],fxParam:[t[x+2],t[x+3]]}),x+=4}else{const e=15&t[x],n=t[x+1]>>3&15,s=7&t[x+1],a=!!(t[x+2]>>6&1),o=63&t[x+2];w.push({note:o,waveform:s,fixed:a,fx:[e,n],fxParam:[t[x+3],t[x+4]]}),x+=5}let E=x;for(;E<t.length&&0!==t[E];)E++;return{name:kz.decode(t.slice(x,E)),config:{volume:a,waveLength:r,filterSpeed:o,filterLowerLimit:l,filterUpperLimit:b,squareLowerLimit:h,squareUpperLimit:f,squareSpeed:g,vibratoDelay:c,vibratoSpeed:p,vibratoDepth:m,hardCutRelease:u,hardCutReleaseFrames:d,envelope:i,performanceList:{speed:v,entries:w}}}}function Pz(e){return Sz(e).instruments.map(e=>({name:e.name,config:{volume:e.volume,waveLength:e.waveLength,filterLowerLimit:e.filterLowerLimit,filterUpperLimit:e.filterUpperLimit,filterSpeed:e.filterSpeed,squareLowerLimit:e.squareLowerLimit,squareUpperLimit:e.squareUpperLimit,squareSpeed:e.squareSpeed,vibratoDelay:e.vibratoDelay,vibratoSpeed:e.vibratoSpeed,vibratoDepth:e.vibratoDepth,hardCutRelease:e.hardCutRelease,hardCutReleaseFrames:e.hardCutReleaseFrames,envelope:{...e.envelope},performanceList:{speed:e.performanceList.speed,entries:e.performanceList.entries.map(e=>({note:e.note,waveform:e.waveform,fixed:e.fixed,fx:[...e.fx],fxParam:[...e.fxParam]}))}}}))}const _z=Object.freeze(Object.defineProperty({__proto__:null,convertHivelyToTrackerSong:Cz,extractInstrumentsFromHvl:Pz,parseAhiFile:Vz,parseHivelyBinary:Sz,parseHivelyFile:function(e,t){const n=Cz(Sz(e),t);return n.hivelyFileData=e.slice(0),n}},Symbol.toStringTag,{value:"Module"}));class Oz{buf=[];writeU8(e){this.buf.push(255&e)}writeU16BE(e){this.buf.push(e>>8&255,255&e)}writeU32BE(e){this.buf.push(e>>>24&255,e>>>16&255,e>>>8&255,255&e)}writeI16BE(e){const t=e<0?e+65536:e;this.buf.push(t>>8&255,255&t)}writeStr(e,t){for(let n=0;n<t;n++)this.buf.push(n<e.length?255&e.charCodeAt(n):0)}writeChunkId(e){for(let t=0;t<4;t++)this.buf.push(255&e.charCodeAt(t))}writeZeros(e){for(let t=0;t<e;t++)this.buf.push(0)}writeBytes(e){for(const t of e)this.buf.push(t)}get length(){return this.buf.length}build(){return new Uint8Array(this.buf)}}function Tz(e,t,n){const s=function(e){const t=e.metadata?.modPlayback?.defaultVolume;if("number"==typeof t&&t>=0)return Math.min(64,Math.round(t));const n=Math.round(64*Math.pow(10,e.volume/20));return Math.max(0,Math.min(64,n))}(e),a=Math.floor(n/2),o=e.sample?.loop??!1,r=e.sample?.loopStart??0,i=e.sample?.loopEnd??0,l=Math.floor(r/2),c=o&&i>r?Math.floor((i-r)/2):0,u=e.metadata?.mlSynthConfig?.waveformType??0,d=new Oz;return d.writeStr(e.name??"",32),d.writeU8(t),d.writeU8(u),d.writeU32BE(0),d.writeU16BE(a),d.writeU32BE(0),d.writeU16BE(c),d.writeI16BE(0),d.writeI16BE(0),d.writeU16BE(0),d.writeU16BE(a),d.writeU16BE(l),d.writeU16BE(c),d.writeU16BE(s),d.writeU8(0),d.writeU8(0),d.writeU8(0),d.writeU8(0),d.writeZeros(142),d.build()}function Lz(e){const t=new Oz,n=function(e){const t=e.sample;if(!t)return new Uint8Array(2);let n=null;if(t.audioBuffer instanceof ArrayBuffer&&t.audioBuffer.byteLength>44)n=t.audioBuffer;else if("string"==typeof t.url&&t.url.startsWith("data:")){const e=t.url.split(",")[1];if(e)try{const t=atob(e),s=new Uint8Array(t.length);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);n=s.buffer}catch{}}if(!n||n.byteLength<=44)return new Uint8Array(2);const s=new DataView(n),a=n.byteLength-44>>1,o=new Uint8Array(a);for(let r=0;r<a;r++){const e=s.getInt16(44+2*r,!0);o[r]=e>>8&255}return o}(e),s=n.length%2==0?n:n.subarray(0,n.length-1),a=s.length;t.writeChunkId("MLED"),t.writeChunkId("INST"),t.writeU32BE(0),t.writeBytes(function(){const e=new Oz;return e.writeChunkId("VERS"),e.writeU32BE(6),e.writeU16BE(1116),e.writeStr("116 ",4),e.build()}());const o=Tz(e,0,a);t.writeChunkId("INST"),t.writeU32BE(o.length),t.writeBytes(o);const r=function(e,t){const n=Math.floor(t/2),s=e.sample?.loop??!1,a=e.sample?.loopStart??0,o=e.sample?.loopEnd??0,r=s&&o>a?Math.floor((o-a)/2):0,i=e.metadata?.mlSynthConfig?.waveformType??0,l=new Oz;return l.writeU32BE(t),l.writeU8(0),l.writeU8(0),l.writeStr(e.name??"",32),l.writeU8(0),l.writeU8(i),l.writeU32BE(0),l.writeU16BE(n),l.writeU32BE(0),l.writeU16BE(r),l.writeI16BE(0),l.writeI16BE(0),l.build()}(e,a);return t.writeChunkId("SMPL"),t.writeU32BE(50+a),t.writeBytes(r),t.writeBytes(s),t.build()}const Az=1296844100,Bz=1414876741,Iz=1447383635,Fz=1346458196,Uz=1095913543,Rz=1229869908,jz=1397575756,Xz=1297040460,zz=1229866575,Gz=128,Hz=1536,Wz=8287,qz=new Set([Xz,Iz,Bz,Fz,Uz,Rz,jz,zz]);function Kz(e){return qz.has(e)}function $z(e){if(e.length<16)return!1;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.getUint32(0)===Az&&1297040460===t.getUint32(4)}function Yz(e){if(e.length<16)return!1;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.getUint32(0)===Az&&1229869908===t.getUint32(4)}function Jz(e){if(!Yz(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=e.byteLength;let s;if(n>=12&&new Set([Iz,Bz,Fz,Uz,Rz,jz]).has(t.getUint32(8)))s=8;else{if(!(n>=12))return null;s=12+t.getUint32(8)}let a=null,o=null;for(;s+8<=n;){const r=t.getUint32(s),i=t.getUint32(s+4),l=s+8;if(r===Iz)s=l+i;else if(r===Rz)i>=206&&l+206<=n&&(a=tG(t,e,l)),s=l+i;else if(r===jz){const a=l+6+i;i>=50&&a<=n+16&&(o=nG(t,e,l,i)),s=a}else{if(r!==Uz)break;s=l+i}}if(!a)return null;return rG([a],o?[o]:[])[0]??null}function Qz(e,t,n){const s=[],a=t+n;for(let o=t;o+1<a;o+=2){const t=e[o],n=e[o+1];if(32&n){const e=192&n;if(64===e)break;if(128===e)break}else{const e=(n>>6&3)<<8|t;s.push(e)}}return{patternSeq:s}}function Zz(e,t,n){const s=new Uint8Array(Hz);let a=t;const o=t+n;let r=0;for(;a<o&&r<Hz;){const t=e[a++];if(128&t)break;let n=t;for(let i=0;i<6;i++)1&n&&a+1<o&&r+1<Hz&&(s[r]=e[a++],s[r+1]=e[a++]),n>>=1,r+=2}return{out:s,consumed:a-t}}function eG(e,t){switch(e){case 1:case 5:return{effTyp:1,eff:t};case 2:case 6:return{effTyp:2,eff:t};case 3:return{effTyp:3,eff:t};case 4:default:return{effTyp:0,eff:0};case 16:return{effTyp:12,eff:t};case 17:return{effTyp:10,eff:(15&t)<<4};case 18:return{effTyp:10,eff:15&t};case 64:case 66:return{effTyp:15,eff:t}}}function tG(e,t,n){const s=n;return{title:lG(t,s,32),smplNumber:t[s+32],smplType:t[s+33],fineTune:e.getInt16(s+46),semiTone:e.getInt16(s+48),smplRepStart:e.getUint16(s+54),smplRepLen:e.getUint16(s+56),volume:e.getUint16(s+58)}}function nG(e,t,n,s){const a=e.getUint32(n),o=t[n+4],r=n+6,i=lG(t,r,32),l=e.getUint16(r+38),c=e.getUint16(r+44),u=e.getInt16(r+46),d=e.getInt16(r+48),m=n+6+50,p=s-50;if(p<=0)return null;const h=t.subarray(m,m+p);let f;return f=p===a||0===a?new Uint8Array(h):function(e,t,n){const s=new Uint8Array(t);let a=0,o=0,r=0;for(;a<e.length&&o<t;){const t=e[a++];if(t!==n)s[o++]=t,r=t;else{if(a+2>=e.length)break;const t=e[a++],n=e[a++]<<8|e[a++];if(s[o++]=t,r=t,0===n)continue;let i=n;for(;i>0&&a<e.length;){const t=e[a++],n=t>>4&15;if(r=r+(n>=8?n-16:n)&255,s[o++]=r,i--,0===i)break;const l=15&t;r=r+(l>=8?l-16:l)&255,s[o++]=r,i--}}}return s}(h,a,o),{title:i,pcm:f,smplLength:l,repLength:c,fineTune:u,semiTone:d}}function sG(e,t=128){const n=t>>Math.max(0,5-Math.min(e,5));return Math.max(2*n,2)}function aG(e,t){if(0===e.length)return new Uint8Array(t);const n=new Uint8Array(t),s=e.length/t;for(let a=0;a<t;a++)n[a]=e[Math.min(Math.floor(a*s),e.length-1)];return n}const oG={1:"ML Wave 16",2:"ML Wave 32",3:"ML Wave 64",4:"ML Wave 128",5:"ML Wave 256"};function rG(e,t){const n=[];for(let s=0;s<e.length;s++){const a=e[s];if(a.smplType>0){const e=t[a.smplNumber-1],o=e?.smplLength??128,r=sG(a.smplType,o);let i;i=e&&e.pcm.length>0?aG(e.pcm,r):new Uint8Array(r);const l=oG[a.smplType]??`ML Wave ${a.smplType}`,c=iF(s+1,a.title||l,i,a.volume>0?a.volume:64,Wz,0,r);n.push({...c,metadata:{...c.metadata,displayType:l,mlSynthConfig:{waveformType:a.smplType,volume:a.volume},isMusicLine:!0,mlInstIdx:s}});continue}const o=t[a.smplNumber-1];if(!o||0===o.pcm.length){const e=new Uint8Array(2),t=iF(s+1,a.title||`Instrument ${s+1}`,e,a.volume||64,Wz,0,0);n.push({...t,metadata:{...t.metadata,isMusicLine:!0,mlInstIdx:s}});continue}const r=2*a.smplRepStart,i=r+2*a.smplRepLen,l=iF(s+1,a.title||o.title||`Instrument ${s+1}`,o.pcm,a.volume>0?a.volume:64,Wz,r,i>r+2?i:0);n.push({...l,metadata:{...l.metadata,isMusicLine:!0,mlInstIdx:s}})}if(0===n.length){const e=new Uint8Array(2);n.push(iF(1,"Empty",e,64,Wz,0,0))}return n}function iG(e){return e<=0?125:Math.max(32,Math.min(255,e))}function lG(e,t,n){let s=t;const a=Math.min(t+n,e.length);for(;s<a&&0!==e[s];)s++;let o="";for(let r=t;r<s;r++)o+=String.fromCharCode(e[r]);return o.trim()}const cG=Object.freeze(Object.defineProperty({__proto__:null,isMusicLineFile:$z,isMusicLineInstrumentFile:Yz,mlSmplTypeToLoopLen:sG,parseMusicLineFile:function(e){if(!$z(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength),n=e.byteLength;if(n<8)return null;let s=8;if(s+4<=n){const e=t.getUint32(s);if(!Kz(e)){s+=4+e}}let a="",o=125,r=6,i=0,l=4;const c=[],u=[],d=[],m=new Map,p=[],h=[];for(;s+4<=n;){for(;s+4<=n&&!Kz(t.getUint32(s));)s++;if(s+8>n)break;const f=t.getUint32(s),g=t.getUint32(s+4),b=s+8;if(f!==Bz&&b+g>n+16)break;if(f===Iz)s=b+g;else{if(f===Bz){let m=b;if(m+40>n)break;if(a=lG(e,m,32),m+=32,o=t.getUint16(m),m+=2,r=e[m++],i=e[m++],t.getUint16(m),m+=2,e[m++],l=e[m++],(0===l||l>8)&&(l=4),m+4*l>n)break;const p=[];for(let e=0;e<l;e++)p.push(t.getUint32(m)),m+=4;for(let t=0;t<l;t++){const s=p[t];if(0===s||m+s>n){c.push([]),u.push(r),d.push(i),s>0&&m+s<=n&&(m+=s);continue}const a=Qz(e,m,s);c.push(a.patternSeq),u.push(r),d.push(i),m+=s}s=m;continue}if(f===Fz){if(g<2||b+g>n){s=b+g;continue}const a=t.getUint16(b),o=b+2,r=g-2,{out:i,consumed:l}=Zz(e,o,r);m.set(a,i),s=o+l}else if(f===Uz)s=b+g;else if(f===Rz){if(g<206||b+g>n){s=b+g;continue}p.push(tG(t,e,b)),s=b+g}else if(f===jz){const a=b+6+g;if(g<50||a>n+16){s=a;continue}const o=nG(t,e,b,g);o&&h.push(o),s=a}else if(f===zz)s=b+g;else if(f===Xz||f===Iz)s=b+g;else{if(!(b+g<=n))break;s=b+g}}}const f=new Set;for(const k of m.keys())f.add(k);for(const k of c)for(const e of k)m.has(e)&&f.add(e);const g=Array.from(f).sort((e,t)=>e-t),b=new Map;g.forEach((e,t)=>b.set(e,t));const v=g.map((e,t)=>function(e,t,n){const s=Array.from({length:Gz},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));let a=Gz;if(e)for(let r=0;r<Gz;r++){const t=12*r,n=e[t],o=e[t+1];if(61===n){a=r;break}const i=s[r];n>0&&(i.note=Math.max(1,n-12),o>0&&255!==o&&(i.instrument=o));const l=e[t+2],c=e[t+3],u=e[t+4],d=e[t+5];if(l){const{effTyp:e,eff:t}=eG(l,c);i.effTyp=e,i.eff=t}if(u){const{effTyp:e,eff:t}=eG(u,d);i.effTyp2=e,i.eff2=t}}if(a===Gz){let e=-1;for(let t=0;t<Gz;t++){const n=s[t];(n.note||n.instrument||n.effTyp||n.effTyp2)&&(e=t)}a=e>=0?e+1:Gz}a<1&&(a=1);const o={id:"channel-0",name:"Voice",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:s.slice(0,a)};return{id:`part-${n}`,name:`Part ${n}`,channels:[o],length:a}}(m.get(e),0,e)),y=c.map(e=>e.map(e=>b.get(e)??0)),x=y.length>0?y[0]:[0],N=rG(p,h),w=(new Date).toISOString();for(const k of v)k.importMetadata={sourceFormat:"ML",sourceFile:"",importedAt:w,originalChannelCount:l,originalPatternCount:v.length,originalInstrumentCount:N.length};const E={name:a||"MusicLine Song",format:"ML",patterns:v,instruments:N,songPositions:x,songLength:x.length,restartPosition:0,numChannels:l,initialSpeed:r,initialBPM:iG(o),linearPeriods:!1,channelTrackTables:y,channelSpeeds:u,channelGrooves:d};return E.musiclineFileData=e.slice(0),E},parseMusicLineInstrument:Jz},Symbol.toStringTag,{value:"Module"})),uG=({onClose:e,onImport:t})=>{const[n,s]=l.useState([]),[a,o]=l.useState(""),[r,i]=l.useState(null),c=e=>{s(t=>t.map(t=>({...t,selected:e})))},u=n.filter(e=>e.selected).length;return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:e,children:Yn.jsxDEV("div",{className:"bg-ft2-bg border border-ft2-border p-4 rounded min-w-[340px] max-w-[500px] shadow-xl",onClick:e=>e.stopPropagation(),children:[Yn.jsxDEV("h2",{className:"text-ft2-highlight font-mono font-bold text-sm mb-3",children:"Import Instruments from HVL / AHX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:59,columnNumber:9},void 0),Yn.jsxDEV("input",{type:"file",accept:".hvl,.ahx",onChange:async e=>{const t=e.target.files?.[0];if(t){o(t.name);try{const e=Pz(await t.arrayBuffer());s(e.map(e=>({...e,selected:!1}))),i(null)}catch(n){s([]),i(`Could not read file: ${n instanceof Error?n.message:String(n)}`)}}},className:"block w-full mb-3 text-ft2-text text-xs font-mono cursor-pointer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:63,columnNumber:9},void 0),a&&!r&&Yn.jsxDEV("p",{className:"text-ft2-textDim text-xs font-mono mb-2",children:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:71,columnNumber:11},void 0),r&&Yn.jsxDEV("p",{className:"text-red-400 text-xs font-mono mb-2",children:r},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:75,columnNumber:11},void 0),n.length>0&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"flex gap-2 mb-1",children:[Yn.jsxDEV("button",{onClick:()=>c(!0),className:"text-xs text-ft2-highlight underline",children:"all"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:81,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>c(!1),className:"text-xs text-ft2-highlight underline",children:"none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:85,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:80,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"max-h-52 overflow-y-auto border border-ft2-border divide-y divide-ft2-border mb-3",children:n.map((e,t)=>Yn.jsxDEV("label",{className:"flex items-center gap-2 px-2 py-1 cursor-pointer hover:bg-ft2-header select-none",children:[Yn.jsxDEV("input",{type:"checkbox",checked:e.selected,onChange:()=>s(e=>e.map((e,n)=>n===t?{...e,selected:!e.selected}:e)),className:"accent-ft2-highlight"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:96,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-xs font-mono text-ft2-textDim w-5 shrink-0",children:(t+1).toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:106,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-xs font-mono text-ft2-text truncate",children:e.name||"(unnamed)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:109,columnNumber:19},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:92,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:90,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:79,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-2 justify-end",children:[Yn.jsxDEV("button",{onClick:e,className:"px-3 py-1 text-xs font-mono text-ft2-text border border-ft2-border hover:border-ft2-highlight transition-colors",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:119,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>{const s=n.filter(e=>e.selected).map(({name:e,config:t})=>({name:e,config:t}));s.length>0&&t(s),e()},disabled:0===u,className:"px-3 py-1 text-xs font-mono bg-ft2-highlight text-ft2-bg disabled:opacity-40 disabled:cursor-default",children:["Import ",u>0?`(${u})`:""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:125,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:118,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:55,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/HivelyImportDialog.tsx",lineNumber:54,columnNumber:5},void 0)},dG=l.memo(({compact:e=!1,maxHeight:t="300px",showActions:n=!0,onInstrumentChange:s,showPreviewOnClick:a=!1,showSamplePackButton:o=!1,showPresetButton:r=!1,showEditButton:i=!1,onEditInstrument:c,variant:u="default",showHivelyImport:d=!1,showSunVoxImport:m=!1})=>{const{instruments:p,currentInstrumentId:h,setCurrentInstrument:f,createInstrument:g,deleteInstrument:b,cloneInstrument:v,updateInstrument:y}=EN(us(e=>({instruments:e.instruments,currentInstrumentId:e.currentInstrumentId,setCurrentInstrument:e.setCurrentInstrument,createInstrument:e.createInstrument,deleteInstrument:e.deleteInstrument,cloneInstrument:e.cloneInstrument,updateInstrument:e.updateInstrument}))),{useHexNumbers:x,setShowSamplePackModal:N,setInstrumentEditorPoppedOut:w,instrumentEditorPoppedOut:E}=LN(us(e=>({useHexNumbers:e.useHexNumbers,setShowSamplePackModal:e.setShowSamplePackModal,setInstrumentEditorPoppedOut:e.setInstrumentEditorPoppedOut,instrumentEditorPoppedOut:e.instrumentEditorPoppedOut}))),k=l.useRef(null),D=l.useRef(null),S=l.useRef(null),M=l.useRef(null),[C,V]=l.useState(!1),[P,_]=l.useState(!1),[O,T]=l.useState(!1),[L,B]=l.useState(null),[I,F]=l.useState(""),U="ft2"===u;l.useEffect(()=>{D.current&&k.current&&D.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[h]);const R=l.useCallback(async e=>{if(a)try{await A();let t=0;const n=10;for(;"running"!==ve.state&&t<n;)await new Promise(e=>setTimeout(e,50)),t++;if("running"!==ve.state)return;S.current&&window.clearTimeout(S.current);const s=Bw();await s.ensureInstrumentReady(e);const a=e.metadata?.modPlayback?.usePeriodPlayback,o="TB303"===e.synthType||e.name.toLowerCase().includes("bass"),r=a?e.sample?.baseNote||"C3":o?"C3":"C4",i=Y();s.triggerNoteAttack(e.id,r,i,.8,e);const l=["Sampler","Sam","Player","DrumKit"].includes(e.synthType??"")?300:800;S.current=window.setTimeout(()=>{s.triggerNoteRelease(e.id,r,Y(),e)},l)}catch(t){}},[a]),j=(e,t)=>{f(e),s?.(e),a&&R(t)},X=(e,t)=>{e.stopPropagation(),p.length>1&&b(t)},z=(e,t)=>{e.stopPropagation(),v(t)},G=(e,t,n)=>{e.stopPropagation(),B(t),F(n),setTimeout(()=>M.current?.focus(),0)},H=()=>{null!==L&&I.trim()&&y(L,{name:I.trim()}),B(null),F("")},W=e=>{"Enter"===e.key?H():"Escape"===e.key&&(B(null),F(""))},q=(e,t)=>{e.stopPropagation(),f(t),E?FU("DEViLBOX  Instrument Editor"):w(!0)},K=l.useCallback((e,t)=>{if(e.stopPropagation(),!t.hively)return;const n=function(e,t){const n=e.performanceList??{speed:1,entries:[]},s=n.entries.every(e=>e.fx.every(e=>e<=5||12===e||15===e)),a=s?4:5,o=xz.encode(t),r=26+n.entries.length*a+o.length+1,i=new Uint8Array(r);let l=0;const c=s?"THXI":"HVLI";for(let m=0;m<4;m++)i[l++]=c.charCodeAt(m);const u=e.filterSpeed??0,d=e.envelope??{aFrames:1,aVolume:64,dFrames:1,dVolume:64,sFrames:1,rFrames:1,rVolume:0};i[l++]=255&(e.volume??64),i[l++]=(31&u)<<3|7&(e.waveLength??3),i[l++]=255&d.aFrames,i[l++]=255&d.aVolume,i[l++]=255&d.dFrames,i[l++]=255&d.dVolume,i[l++]=255&d.sFrames,i[l++]=255&d.rFrames,i[l++]=255&d.rVolume,i[l++]=0,i[l++]=0,i[l++]=0,i[l++]=127&(e.filterLowerLimit??0)|(u>>5&1)<<7,i[l++]=255&(e.vibratoDelay??0),i[l++]=(e.hardCutRelease?1:0)<<7|(7&(e.hardCutReleaseFrames??0))<<4|15&(e.vibratoDepth??0),i[l++]=255&(e.vibratoSpeed??0),i[l++]=255&(e.squareLowerLimit??0),i[l++]=255&(e.squareUpperLimit??0),i[l++]=255&(e.squareSpeed??0),i[l++]=63&(e.filterUpperLimit??0),i[l++]=255&n.speed,i[l++]=255&n.entries.length;for(const m of n.entries)if(s){let e=7&m.fx[1];12===m.fx[1]&&(e=6),15===m.fx[1]&&(e=7);let t=7&m.fx[0];12===m.fx[0]&&(t=6),15===m.fx[0]&&(t=7);const n=m.waveform>>1&3;i[l++]=e<<5|t<<2|n,i[l++]=(1&m.waveform)<<7|(m.fixed?1:0)<<6|63&m.note,i[l++]=255&m.fxParam[0],i[l++]=255&m.fxParam[1]}else i[l++]=15&m.fx[0],i[l++]=(15&m.fx[1])<<3|7&m.waveform,i[l++]=(m.fixed?1:0)<<6|63&m.note,i[l++]=255&m.fxParam[0],i[l++]=255&m.fxParam[1];return i.set(o,l),i[l+o.length]=0,i}(t.hively,t.name),s=new Blob([n],{type:"application/octet-stream"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=`${t.name.replace(/[^a-zA-Z0-9_\-]/g,"_")||"instrument"}.ahi`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)},[]),$=l.useCallback((e,t)=>{e.stopPropagation();const n=document.createElement("input");n.type="file",n.accept=".ahi",n.onchange=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.arrayBuffer(),{config:s,name:a}=Vz(e);y(t,{hively:s,name:a})}catch(s){}},n.click()},[y]),J=l.useCallback(e=>{for(const{name:t,config:n}of e)g({name:t,synthType:"HivelySynth",hively:n})},[g]),Q=l.useCallback((e,t)=>{g({name:e,synthType:"SunVoxSynth",sunvox:t})},[g]),Z=l.useCallback((e,t)=>{e.stopPropagation();const n=Lz(t),s=new Blob([n],{type:"application/octet-stream"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=`${t.name.replace(/[^a-zA-Z0-9_\-]/g,"_")||"instrument"}.mli`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)},[]),ee=l.useCallback((e,t)=>{e.stopPropagation();const n=document.createElement("input");n.type="file",n.accept=".mli",n.onchange=async e=>{const n=e.target.files?.[0];if(n)try{const e=await n.arrayBuffer(),s=Jz(new Uint8Array(e));s&&y(t,{...s,id:t})}catch(s){}},n.click()},[y]),te=(e,t)=>{e.dataTransfer.setData("application/x-devilbox-instrument",JSON.stringify({id:t})),e.dataTransfer.effectAllowed="copy";const n=e.currentTarget;n.style.opacity="0.5",setTimeout(()=>{n.style.opacity="1"},0)},ne=[...p].sort((e,t)=>e.id-t.id),se=U&&(r||o||i||d||m);return Yn.jsxDEV("div",{className:"flex flex-col h-full "+(U?"bg-ft2-bg border-l border-ft2-border":""),children:[se&&Yn.jsxDEV("div",{className:"px-2 py-2 bg-ft2-header border-b border-ft2-border flex-shrink-0",children:Yn.jsxDEV("div",{className:"grid grid-cols-4 gap-1",children:[Yn.jsxDEV("button",{onClick:()=>{if(U){g(Ux[0])}else g()},className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Add new instrument (303 Classic)",children:[Yn.jsxDEV(nt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:374,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-[8px] font-bold",children:"ADD"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:375,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:369,columnNumber:13},void 0),r&&Yn.jsxDEV("button",{onClick:()=>V(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Load preset into current instrument",children:[Yn.jsxDEV(rt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:383,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[8px] font-bold",children:"PRESET"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:384,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:378,columnNumber:15},void 0),o&&Yn.jsxDEV("button",{onClick:()=>N(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-green-600 text-green-400 hover:bg-green-600 hover:text-ft2-bg transition-colors",title:"Browse sample packs",children:[Yn.jsxDEV(yn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:393,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[8px] font-bold",children:"SAMPLE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:394,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:388,columnNumber:15},void 0),i&&Yn.jsxDEV("button",{onClick:()=>c?.(h),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Edit current instrument",children:[Yn.jsxDEV(xn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:403,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[8px] font-bold",children:"EDIT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:404,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:398,columnNumber:15},void 0),d&&Yn.jsxDEV("button",{onClick:()=>_(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Import instruments from HVL/AHX file",children:[Yn.jsxDEV(Yt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:413,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[8px] font-bold",children:"HVL"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:414,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:408,columnNumber:15},void 0),m&&Yn.jsxDEV("button",{onClick:()=>T(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Import instrument from .sunsynth file",children:[Yn.jsxDEV(Yt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:423,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[8px] font-bold",children:"SVX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:424,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:418,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:368,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:367,columnNumber:9},void 0),Yn.jsxDEV("div",{ref:k,className:"flex-1 overflow-y-auto "+(U?"scrollbar-ft2 min-h-0":"scrollbar-modern"),style:U?void 0:{maxHeight:t},children:Yn.jsxDEV("div",{className:"flex flex-col divide-y divide-ft2-border/30",children:ne.map((t,s)=>{const a=s+1,o=fz(t.synthType),r=t.id===h,i=vn[o?.icon||"Music2"]||Jt;return U?Yn.jsxDEV("div",{ref:r?D:void 0,onClick:()=>j(t.id,t),draggable:"true",onDragStart:e=>te(e,t.id),className:`\n                  instrument-list-item\n                  flex items-center gap-2 px-2 py-1.5 cursor-pointer border-b border-ft2-border\n                  transition-colors group\n                  ${r?"bg-ft2-cursor text-ft2-bg":"hover:bg-ft2-header text-ft2-text"}\n                `,children:[Yn.jsxDEV("span",{className:"font-mono text-xs font-bold w-6 "+(r?"text-ft2-bg":"text-ft2-highlight"),children:x?a.toString(16).toUpperCase().padStart(2,"0"):a.toString(10).padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:464,columnNumber:17},void 0),Yn.jsxDEV(i,{size:12,className:`shrink-0 ${r?"text-ft2-bg":o?.color||"text-ft2-highlight"}`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:472,columnNumber:17},void 0),L===t.id?Yn.jsxDEV("input",{ref:M,type:"text",value:I,onChange:e=>F(e.target.value),onBlur:H,onKeyDown:W,onClick:e=>e.stopPropagation(),className:"text-xs font-mono bg-ft2-bg border border-ft2-cursor px-1 py-0.5 rounded text-ft2-text focus:outline-none w-24",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:476,columnNumber:19},void 0):Yn.jsxDEV("span",{className:"text-xs font-mono whitespace-nowrap cursor-text",onDoubleClick:e=>G(e,t.id,t.name),title:"Double-click to rename",children:t.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:488,columnNumber:19},void 0),Yn.jsxDEV("span",{className:"text-[9px] px-1 rounded "+(r?"bg-ft2-bg/20 text-ft2-bg":"bg-ft2-header text-ft2-textDim"),children:t.metadata?.displayType||o?.shortName||t.synthType},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:498,columnNumber:17},void 0),n&&Yn.jsxDEV("div",{className:`instrument-action-buttons flex gap-0.5 ${r?"opacity-100":"opacity-0 group-hover:opacity-100"} transition-opacity`,children:[Yn.jsxDEV("button",{onClick:e=>q(e,t.id),className:`p-0.5 rounded ${r?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-cyan-400`,title:"Pop out editor",children:Yn.jsxDEV(He,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:510,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:505,columnNumber:21},void 0),Yn.jsxDEV("button",{onClick:e=>z(e,t.id),className:"p-0.5 rounded "+(r?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"),title:"Duplicate",children:Yn.jsxDEV(Je,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:517,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:512,columnNumber:21},void 0),"HivelySynth"===t.synthType&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:e=>K(e,t),className:`p-0.5 rounded ${r?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-yellow-400`,title:"Save as .ahi instrument file",children:Yn.jsxDEV(Ge,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:526,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:521,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:e=>$(e,t.id),className:`p-0.5 rounded ${r?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-yellow-400`,title:"Load .ahi instrument file",children:Yn.jsxDEV(Yt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:533,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:528,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:520,columnNumber:23},void 0),"Sampler"===t.synthType&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:e=>Z(e,t),className:`p-0.5 rounded ${r?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-orange-400`,title:"Save as .mli instrument file",children:Yn.jsxDEV(Ge,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:544,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:539,columnNumber:25},void 0),Yn.jsxDEV("button",{onClick:e=>ee(e,t.id),className:`p-0.5 rounded ${r?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-orange-400`,title:"Load .mli instrument file",children:Yn.jsxDEV(Yt,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:551,columnNumber:27},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:546,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:538,columnNumber:23},void 0),p.length>1&&Yn.jsxDEV("button",{onClick:e=>X(e,t.id),className:`p-0.5 rounded ${r?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-red-400`,title:"Delete",children:Yn.jsxDEV(Ie,{size:10},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:561,columnNumber:25},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:556,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:504,columnNumber:19},void 0)]},t.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:447,columnNumber:15},void 0):Yn.jsxDEV(vz,{instrumentId:t.id,children:Yn.jsxDEV("div",{ref:r?D:void 0,onClick:()=>j(t.id,t),draggable:"true",onDragStart:e=>te(e,t.id),className:`\n                  group flex items-center gap-2 px-3 py-2 cursor-pointer transition-all\n                  ${r?"bg-accent-primary/20 border-l-2 border-accent-primary":"hover:bg-dark-bgHover border-l-2 border-transparent"}\n                `,children:[Yn.jsxDEV("span",{className:`\n                    font-mono text-xs w-6 text-center\n                    ${r?"text-accent-primary":"text-text-muted"}\n                  `,children:String(a).padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:587,columnNumber:17},void 0),Yn.jsxDEV(i,{size:e?12:14,className:`shrink-0 ${o?.color||"text-accent-primary"}`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:597,columnNumber:17},void 0),L===t.id?Yn.jsxDEV("input",{ref:M,type:"text",value:I,onChange:e=>F(e.target.value),onBlur:H,onKeyDown:W,onClick:e=>e.stopPropagation(),className:"text-sm bg-dark-bg border border-accent-primary px-1 py-0.5 rounded text-text-primary focus:outline-none w-28",autoFocus:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:604,columnNumber:19},void 0):Yn.jsxDEV("span",{className:`\n                      text-sm whitespace-nowrap cursor-text\n                      ${r?"text-text-primary":"text-text-secondary"}\n                    `,onDoubleClick:e=>G(e,t.id,t.name),title:"Double-click to rename",children:t.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:616,columnNumber:19},void 0),!e&&Yn.jsxDEV("span",{className:"text-[10px] text-text-muted font-mono",children:t.metadata?.displayType||o?.shortName||t.synthType},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:630,columnNumber:19},void 0),t.sample?.loop&&Yn.jsxDEV("span",{className:"flex items-center gap-0.5 ml-auto",title:"pingpong"===t.sample.loopType?"Ping-pong loop":"Forward loop",children:"pingpong"===t.sample.loopType?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(ht,{size:12,className:"shrink-0 text-blue-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:643,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-blue-400 font-bold leading-none",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:644,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:642,columnNumber:23},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(Nn,{size:12,className:"shrink-0 text-green-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:648,columnNumber:25},void 0),Yn.jsxDEV("span",{className:"text-[9px] text-green-400 font-bold leading-none",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:649,columnNumber:25},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:647,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:637,columnNumber:19},void 0),n&&Yn.jsxDEV("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity ml-auto",children:[Yn.jsxDEV("button",{onClick:e=>q(e,t.id),className:"p-1 text-text-muted hover:text-cyan-400",title:"Pop out editor",children:Yn.jsxDEV(He,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:663,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:658,columnNumber:21},void 0),Yn.jsxDEV("button",{onClick:e=>z(e,t.id),className:"p-1 text-text-muted hover:text-accent-primary",title:"Clone instrument",children:Yn.jsxDEV(Je,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:670,columnNumber:23},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:665,columnNumber:21},void 0),p.length>1&&Yn.jsxDEV("button",{onClick:e=>X(e,t.id),className:"p-1 text-text-muted hover:text-accent-error",title:"Delete instrument",children:Yn.jsxDEV(Ie,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:678,columnNumber:25},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:673,columnNumber:23},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:657,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:573,columnNumber:15},void 0)},t.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:572,columnNumber:13},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:437,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:432,columnNumber:7},void 0),Yn.jsxDEV("div",{className:U?"px-3 py-1.5 bg-ft2-header border-t border-ft2-border":"px-3 py-1 border-t border-dark-border bg-dark-bgSecondary",children:Yn.jsxDEV("span",{className:U?"text-ft2-textDim text-[10px] font-mono":"text-[10px] text-text-muted",children:[p.length," instrument",1!==p.length?"s":""]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:696,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:691,columnNumber:7},void 0),C&&Yn.jsxDEV(yz,{onClose:()=>V(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:703,columnNumber:9},void 0),P&&Yn.jsxDEV(uG,{onClose:()=>_(!1),onImport:J},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:706,columnNumber:9},void 0),O&&Yn.jsxDEV(HF,{onClose:()=>T(!1),onImport:Q},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:712,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/InstrumentList.tsx",lineNumber:364,columnNumber:5},void 0)});dG.displayName="InstrumentList";const mG=Object.freeze(Object.defineProperty({__proto__:null,InstrumentList:dG},Symbol.toStringTag,{value:"Module"})),pG=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],hG=[1,3,6,8,10],fG=({onNoteInput:e,onHexInput:t,onDelete:n,onCopy:s,onCut:a,onPaste:o,onCollapseChange:r})=>{const{cursor:i,currentOctave:c,setCurrentOctave:u}=ID(),[d,m]=l.useState(!1),[p,h]=l.useState(!1),f=l.useMemo(()=>"note"===i.columnType?"piano":"instrument"===i.columnType||"volume"===i.columnType||"effTyp"===i.columnType||"effParam"===i.columnType?"hex":"piano",[i.columnType]),g=l.useCallback(t=>{const n=12*c+t+1;gP.light(),e(n)},[c,e]),b=l.useCallback(()=>{gP.medium(),e(97)},[e]),v=l.useCallback(()=>{c>0&&(gP.light(),u(c-1))},[c,u]),y=l.useCallback(()=>{c<7&&(gP.light(),u(c+1))},[c,u]),x=l.useCallback(e=>{gP.light(),t(e)},[t]),N=l.useCallback(()=>{gP.medium(),n()},[n]),w=l.useCallback(()=>{gP.selection();const e=!p;h(e),r?.(e)},[p,r]),E=l.useCallback(()=>{gP.heavy(),m(!0)},[]),k=l.useCallback(e=>{gP.success(),e(),m(!1)},[]);return Yn.jsxDEV("div",{className:"mobile-pattern-input safe-area-bottom",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-3 py-2 bg-dark-bgTertiary border-t border-dark-border",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV(wn,{size:16,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:114,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-xs font-mono text-text-secondary",children:"piano"===f?"NOTE":i.columnType.toUpperCase()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:115,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:113,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV("button",{onClick:()=>{const e=new KeyboardEvent("keydown",{key:"?"});window.dispatchEvent(e)},className:"p-1.5 rounded bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors","aria-label":"Help",children:Yn.jsxDEV(mt,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:130,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:122,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:E,className:"p-1.5 rounded bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors","aria-label":"Show context menu",children:Yn.jsxDEV(Je,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:139,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:134,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:w,className:"p-1.5 rounded bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors","aria-label":p?"Expand input":"Collapse input",children:p?Yn.jsxDEV(jt,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:149,columnNumber:15},void 0):Yn.jsxDEV(De,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:151,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:143,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:120,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:112,columnNumber:7},void 0),!p&&Yn.jsxDEV("div",{className:"p-2 bg-dark-bgSecondary",children:Yn.jsxDEV(vG,{mode:f,currentOctave:c,onNotePress:g,onHexPress:x,onNoteOff:b,onOctaveDown:v,onOctaveUp:y,onDelete:N},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:160,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:159,columnNumber:9},void 0),d&&Yn.jsxDEV(yG,{onCopy:s?()=>k(s):void 0,onCut:a?()=>k(a):void 0,onPaste:o?()=>k(o):void 0,onClose:()=>m(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:175,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:110,columnNumber:5},void 0)},gG=["0","1","2","3","4","5","6","7","8","9","A","B"],bG=[{label:"C",value:12},{label:"D",value:13},{label:"E",value:14},{label:"F",value:15}],vG=({mode:e,currentOctave:t,onNotePress:n,onHexPress:s,onNoteOff:a,onOctaveDown:o,onOctaveUp:r,onDelete:i})=>{const c=l.useCallback((t,a)=>{"piano"===e?n(t):s(t)},[e,n,s]),u=l.useCallback(t=>{"piano"===e?n(t):s(t)},[e,n,s]),d=Array.from({length:12},(e,t)=>t);return Yn.jsxDEV("div",{className:"flex flex-col gap-2",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 h-[56px]",children:["piano"===e?Yn.jsxDEV("div",{className:"flex items-center gap-1 bg-dark-bgTertiary rounded-lg p-1 h-full",children:[Yn.jsxDEV("button",{onClick:o,disabled:0===t,className:"piano-octave-btn h-full","aria-label":"Octave down",children:Yn.jsxDEV(Ut,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:254,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:248,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"px-3 py-1 min-w-[48px] text-center flex flex-col justify-center",children:[Yn.jsxDEV("span",{className:"text-[10px] text-text-muted font-mono leading-none mb-1",children:"OCT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:257,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"text-lg font-bold text-accent-primary font-mono leading-none",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:258,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:256,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:r,disabled:7===t,className:"piano-octave-btn h-full","aria-label":"Octave up",children:Yn.jsxDEV(Ae,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:268,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:262,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:247,columnNumber:11},void 0):Yn.jsxDEV("div",{className:"flex items-center gap-1 bg-dark-bgTertiary rounded-lg p-1 h-full",children:bG.map(({label:e,value:t})=>Yn.jsxDEV("button",{onClick:()=>s(t),onTouchStart:()=>s(t),className:"flex-1 h-full min-w-[40px] rounded-md bg-accent-secondary/20 hover:bg-accent-secondary/40 active:bg-accent-secondary/60 transition-colors flex items-center justify-center","aria-label":`Hex ${e}`,children:Yn.jsxDEV("span",{className:"text-base font-bold font-mono text-accent-secondary",children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:282,columnNumber:17},void 0)},e,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:275,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:273,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:a,className:"flex-1 piano-utility-btn h-full",children:[Yn.jsxDEV("span",{className:"font-mono text-sm",children:"---"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:293,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-[10px] text-text-muted",children:"OFF"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:294,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:289,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:i,className:"flex-1 piano-utility-btn h-full",children:[Yn.jsxDEV(En,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:301,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-[10px] text-text-muted",children:"DEL"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:302,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:297,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:244,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"relative h-[120px] bg-dark-bg rounded-lg overflow-hidden",children:[Yn.jsxDEV("div",{className:"absolute inset-0 flex",children:d.map(n=>{if(hG.includes(n))return null;const s="hex"===e?gG[n]:pG[n],a="hex"===e?"":t;return Yn.jsxDEV("button",{onTouchStart:e=>c(n,e),onClick:()=>u(n),className:"piano-key piano-key-white","aria-label":"hex"===e?`Hex ${s}`:`${s}${a}`,children:Yn.jsxDEV("span",{className:"piano-key-label",children:[s,Yn.jsxDEV("span",{className:"text-[10px] opacity-60",children:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:327,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:325,columnNumber:17},void 0)},n,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:318,columnNumber:15},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:309,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"absolute inset-0 pointer-events-none",children:d.map(n=>{if(!hG.includes(n))return null;const s=100/7,a=pG.slice(0,n).filter((e,t)=>!hG.includes(t)).length*s-3.5714285714285716,o="hex"===e?gG[n]:pG[n],r="hex"===e?"":t;return Yn.jsxDEV("button",{onTouchStart:e=>c(n,e),onClick:()=>u(n),className:"piano-key-black pointer-events-auto",style:{left:`${a}%`,width:"8.571428571428571%"},"aria-label":"hex"===e?`Hex ${o}`:`${o}${r}`,children:Yn.jsxDEV("span",{className:"piano-key-label",children:[o,Yn.jsxDEV("span",{className:"text-[10px] opacity-60",children:r},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:359,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:357,columnNumber:17},void 0)},n,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:349,columnNumber:15},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:335,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:307,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:242,columnNumber:5},void 0)},yG=({onCopy:e,onCut:t,onPaste:n,onClose:s})=>Yn.jsxDEV("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:s,children:Yn.jsxDEV("div",{className:"w-full bg-dark-bgSecondary rounded-t-2xl p-4 safe-area-bottom",onClick:e=>e.stopPropagation(),children:Yn.jsxDEV("div",{className:"flex flex-col gap-2",children:[Yn.jsxDEV("div",{className:"text-xs font-mono text-text-muted text-center mb-2",children:"QUICK ACTIONS"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:396,columnNumber:11},void 0),e&&Yn.jsxDEV("button",{onClick:e,className:"context-menu-btn",children:[Yn.jsxDEV(Je,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:402,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Copy"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:403,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:401,columnNumber:13},void 0),t&&Yn.jsxDEV("button",{onClick:t,className:"context-menu-btn",children:[Yn.jsxDEV(Et,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:409,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Cut"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:410,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:408,columnNumber:13},void 0),n&&Yn.jsxDEV("button",{onClick:n,className:"context-menu-btn",children:[Yn.jsxDEV(Je,{size:18,className:"rotate-180"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:416,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Paste"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:417,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:415,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:s,className:"context-menu-btn context-menu-btn-cancel",children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:421,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:395,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:391,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/mobile/MobilePatternInput.tsx",lineNumber:387,columnNumber:5},void 0);function xG(e,t){return e>t?"landscape":"portrait"}function NG(){return void 0!==window.screen?.orientation?.angle?window.screen.orientation.angle:void 0!==window.orientation?window.orientation:0}function wG(){const[e,t]=l.useState(()=>{if("undefined"==typeof window)return{orientation:"portrait",isPortrait:!0,isLandscape:!1,angle:0};const e=xG(window.innerWidth,window.innerHeight);return{orientation:e,isPortrait:"portrait"===e,isLandscape:"landscape"===e,angle:NG()}});return l.useEffect(()=>{if("undefined"==typeof window)return;const e=()=>{const e=xG(window.innerWidth,window.innerHeight),n=NG();t({orientation:e,isPortrait:"portrait"===e,isLandscape:"landscape"===e,angle:n})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),window.screen?.orientation&&window.screen.orientation.addEventListener("change",e),e(),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e),window.screen?.orientation&&window.screen.orientation.removeEventListener("change",e)}},[]),e}const EG=({onShowPatterns:e,onShowExport:t,onShowHelp:n,onShowMasterFX:s,onShowInstruments:a,showPatterns:o,showMasterFX:r})=>{const[i,c]=l.useState("pattern"),[u,d]=l.useState(0),[m,p]=l.useState(!1),h=jN(e=>e.isPlaying),f=jN(e=>e.togglePlayPause),{patterns:g,currentPatternIndex:b,cursor:v,setCell:y,moveCursor:x,moveCursorToRow:N,recordMode:w,editStep:E,copySelection:k,cutSelection:D,paste:S,applySystemPreset:M}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,cursor:e.cursor,setCell:e.setCell,moveCursor:e.moveCursor,moveCursorToRow:e.moveCursorToRow,recordMode:e.recordMode,editStep:e.editStep,copySelection:e.copySelection,cutSelection:e.cutSelection,paste:e.paste,applySystemPreset:e.applySystemPreset}))),{instruments:C,currentInstrumentId:V,setCurrentInstrument:P}=EN(us(e=>({instruments:e.instruments,currentInstrumentId:e.currentInstrumentId,setCurrentInstrument:e.setCurrentInstrument}))),_=g[b],{isPortrait:O,isLandscape:T}=wG(),L=T?4:1,B=O?u:0,I=l.useCallback(()=>{u>0&&(gP.selection(),d(u-1))},[u]),F=l.useCallback(()=>{const e=_?.channels.length||8;u<e-1&&(gP.selection(),d(u+1))},[u,_]),U=l.useCallback(e=>{if(y(v.channelIndex,v.rowIndex,{note:e,instrument:V??1}),w&&E>0){const e=g[b]?.length??64;N((v.rowIndex+E)%e)}},[v,y,V,w,E,g,b,N]),R=l.useCallback(e=>{const{channelIndex:t,rowIndex:n,columnType:s}=v;switch(s){case"instrument":y(t,n,{instrument:e});break;case"volume":y(t,n,{volume:e});break;case"effTyp":y(t,n,{effTyp:e});break;case"effParam":y(t,n,{eff:e})}x("right")},[v,y,x]),j=l.useCallback(()=>{const{channelIndex:e,rowIndex:t}=v;y(e,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[v,y]),X=vP({onSwipeLeft:F,onSwipeRight:I,enabled:O}),z=l.useCallback(()=>{gP.success(),k()},[k]),G=l.useCallback(()=>{gP.success(),D()},[D]),H=l.useCallback(()=>{gP.success(),S()},[S]),W=l.useCallback(()=>{x("left")},[x]),q=l.useCallback(()=>{x("right")},[x]);return Yn.jsxDEV("div",{className:"flex flex-col flex-1 min-h-0 bg-dark-bg",children:[Yn.jsxDEV("div",{className:"flex-shrink-0 flex items-center justify-between px-3 py-2 bg-dark-bgSecondary border-b border-dark-border safe-area-top",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[Yn.jsxDEV("div",{className:"flex items-center gap-1 flex-shrink-0 mr-1",children:Yn.jsxDEV("button",{onClick:()=>{A(),f().catch(console.error)},className:`\n                p-2 rounded-lg transition-colors touch-target\n                ${h?"bg-accent-primary text-text-inverse":"bg-dark-bgTertiary text-text-primary hover:bg-dark-bgHover"}\n              `,children:h?Yn.jsxDEV(at,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:186,columnNumber:28},void 0):Yn.jsxDEV(qt,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:186,columnNumber:51},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:176,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:175,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[Yn.jsxDEV("span",{className:"text-xs text-text-muted font-mono",children:"PAT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:191,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-sm font-bold text-accent-primary font-mono",children:(b+1).toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:192,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:190,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-secondary truncate max-w-[40px] hidden sm:inline",children:_?.name||"Untitled"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:197,columnNumber:11},void 0),O&&Yn.jsxDEV("div",{className:"flex items-center gap-1 ml-1 pl-1 border-l border-dark-border touch-none",...X,children:[Yn.jsxDEV("button",{onClick:I,disabled:0===u,className:"p-1 rounded bg-dark-bgTertiary disabled:opacity-30 touch-target-sm","aria-label":"Previous channel",children:Yn.jsxDEV(Ut,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:213,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:207,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"text-xs font-mono text-accent-primary min-w-[28px] text-center",children:["CH ",(u+1).toString().padStart(2,"0")]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:215,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:F,disabled:u>=(_?.channels.length||8)-1,className:"p-1 rounded bg-dark-bgTertiary disabled:opacity-30 touch-target-sm","aria-label":"Next channel",children:Yn.jsxDEV(Ae,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:224,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:218,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:203,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"ml-1 pl-1 border-l border-dark-border flex items-center gap-1 min-w-0",children:[Yn.jsxDEV("select",{value:V??1,onChange:e=>P(parseInt(e.target.value,10)),className:"text-[10px] bg-dark-bgTertiary border border-dark-border rounded px-1.5 py-1 text-text-primary font-mono truncate",style:{maxWidth:"80px"},children:C.map(e=>Yn.jsxDEV("option",{value:e.id,children:e.name.substring(0,15)},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:238,columnNumber:17},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:231,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center ml-1 pl-1 border-l border-dark-border",children:[Yn.jsxDEV($t,{size:12,className:"text-accent-primary mr-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:245,columnNumber:15},void 0),Yn.jsxDEV("select",{className:"bg-dark-bgTertiary text-text-primary text-[10px] h-6 border border-dark-border rounded px-1 hover:border-accent-primary outline-none max-w-[70px]",onChange:e=>M(e.target.value),defaultValue:"none",children:[Yn.jsxDEV("option",{value:"none",disabled:!0,children:"HW..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:251,columnNumber:17},void 0),MD().map(e=>Yn.jsxDEV("optgroup",{label:e.label,children:e.presets.map(e=>Yn.jsxDEV("option",{value:e.id,children:e.name.split(" ")[0].toUpperCase()},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:255,columnNumber:23},void 0))},e.label,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:253,columnNumber:19},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:246,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:244,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:230,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:173,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-12 flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:265,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:172,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex-1 min-h-0 relative",children:["pattern"===i&&Yn.jsxDEV("div",{className:"h-full flex flex-col",style:{paddingBottom:`calc(${m?"56px":"180px"} + env(safe-area-inset-bottom, 0px))`},children:Yn.jsxDEV("div",{className:"flex-1 overflow-auto",children:Yn.jsxDEV(MO,{visibleChannels:L,startChannel:B,onSwipeLeft:W,onSwipeRight:q},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:279,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:278,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:271,columnNumber:11},void 0),"instruments"===i&&Yn.jsxDEV("div",{className:"h-full flex flex-col",children:[Yn.jsxDEV("div",{className:"flex-shrink-0 sticky top-0 z-10 bg-dark-bg/95 backdrop-blur-md border-b border-dark-border shadow-lg",children:Yn.jsxDEV("div",{className:"p-3",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[Yn.jsxDEV("h3",{className:"text-[10px] font-black text-text-muted uppercase tracking-widest flex items-center gap-1.5",children:[Yn.jsxDEV(kn,{size:12,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:296,columnNumber:21},void 0),"Live Ops"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:295,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"h-px flex-1 bg-dark-border mx-3 opacity-30"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:299,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:294,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"overflow-x-auto pb-1 no-scrollbar",children:Yn.jsxDEV(WX,{onShowPatterns:e,onShowExport:t,onShowHelp:n,onShowMasterFX:s,onShowInstruments:a,showPatterns:o,showMasterFX:r,compact:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:302,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:301,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:293,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:292,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto p-2",style:{paddingBottom:"calc(64px + env(safe-area-inset-bottom, 0px))"},children:[Yn.jsxDEV("div",{className:"mb-4",children:Yn.jsxDEV(tz,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:322,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:321,columnNumber:15},void 0),Yn.jsxDEV("h3",{className:"text-[10px] font-black text-text-muted uppercase tracking-widest mb-3 px-2 flex items-center gap-1.5",children:[Yn.jsxDEV(Jt,{size:12,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:326,columnNumber:17},void 0),"Instruments"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:325,columnNumber:15},void 0),Yn.jsxDEV(dG,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:329,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:317,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:290,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:269,columnNumber:7},void 0),"pattern"===i&&Yn.jsxDEV(fG,{onNoteInput:U,onHexInput:R,onDelete:j,onCopy:z,onCut:G,onPaste:H,onCollapseChange:p},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:344,columnNumber:9},void 0),Yn.jsxDEV(dz,{activeTab:i,onTabChange:c},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:356,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MobileTrackerView.tsx",lineNumber:170,columnNumber:5},void 0)};class kG{static isMac(){if("userAgentData"in navigator&&navigator.userAgentData){return navigator.userAgentData.platform.toUpperCase().indexOf("MAC")>=0}return navigator.platform.toUpperCase().indexOf("MAC")>=0}static normalize(e){const t=this.isMac();return{key:e.key,ctrl:e.ctrlKey||t&&e.metaKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey,code:e.code}}}const DG=new Set(["Space","F5","F6","F7","F8","Ctrl+Space","Shift+Space","Tab","Shift+Tab","Escape","1","2","3","4","5","6","7","8","9","Ctrl+S","Ctrl+Z","Ctrl+Y","Ctrl+Shift+Z","Meta+S","Meta+Z","Meta+Y","Meta+Shift+Z","F1","F2","F3","F4","F9","F10","F11","F12","Ctrl+Shift+D","Ctrl+Shift+V","Ctrl+Shift+T","Ctrl+Shift+A"]);function SG(e){const t=[];e.ctrl&&t.push("Ctrl"),e.meta&&t.push("Meta"),e.alt&&t.push("Alt"),e.shift&&t.push("Shift");let n=e.key;return" "===n&&(n="Space"),1===n.length&&(n=n.toUpperCase()),t.push(n),t.join("+")}function MG(e){const t=SG(e);if(DG.has(t))return!0;if(e.ctrl&&!e.meta){const e=t.replace("Ctrl+","Meta+");if(DG.has(e))return!0}if(e.meta&&!e.ctrl){const e=t.replace("Meta+","Ctrl+");if(DG.has(e))return!0}return!1}const CG={initialized:!1,globalHandler:null,viewHandlers:new Map,debug:!1};function VG(e){const t=e.target;if(!t)return!1;const n=t.tagName;return"INPUT"===n||"TEXTAREA"===n||"SELECT"===n?"Escape"!==e.key&&"Tab"!==e.key:!!t.isContentEditable&&"Escape"!==e.key}function PG(e){if(VG(e))return;const t=kG.normalize(e),n=(SG(t),LN.getState().activeView);if(CG.debug,document.querySelector(".fixed.inset-0.z-50")||document.querySelector('[role="dialog"]')||document.querySelector(".modal-overlay"))return void("Escape"===e.key&&CG.globalHandler?.(t,e)&&(e.preventDefault(),e.stopPropagation()));let s=!1;if(MG(t)&&CG.globalHandler&&(s=CG.globalHandler(t,e)),!s){const a=CG.viewHandlers.get(n);a&&(s=a(t,e))}s||MG(t)||!CG.globalHandler||(s=CG.globalHandler(t,e)),s&&(e.preventDefault(),e.stopPropagation())}function _G(e){if(VG(e))return;const t=LN.getState().activeView;CG.viewHandlers.get(t)}function OG(e,t){return CG.viewHandlers.set(e,t),()=>{CG.viewHandlers.delete(e)}}function TG(e){return new Worker("/assets/piano-keyboard.worker-Cg9tJ_oK.js",{name:e?.name})}function LG(e){const t=getComputedStyle(e),n=t.getPropertyValue("--color-accent").trim()||"#06b6d4";return{bg:t.getPropertyValue("--color-bg").trim()||"#111",whiteKey:"#e8e8ec",blackKey:t.getPropertyValue("--color-bg-secondary").trim()||"#22242a",whiteKeyDimmed:"#333338",blackKeyDimmed:"#1a1a1c",activeKey:n,divider:"#888",dividerLight:"#333",labelDark:"#333",labelLight:"#888"}}const AG=a.memo(({verticalZoom:e,scrollY:t,containerHeight:n,activeNotes:s=new Set,scaleNotes:a,dragTargetMidi:o=null,onNotePreview:r,onNoteRelease:i})=>{const c=l.useRef(null),u=l.useRef(null),d=l.useRef(!1),m=l.useRef(null);function p(){return{verticalZoom:e,scrollY:t,containerHeight:n,activeNotes:Array.from(s),scaleNotes:a?Array.from(a):null,dragTargetMidi:o}}l.useEffect(()=>{const e=c.current;if(!e||!("transferControlToOffscreen"in HTMLCanvasElement.prototype))return;const t=document.createElement("canvas");t.style.cssText=`display:block;width:72px;height:${n}px;`,e.appendChild(t);const s=window.devicePixelRatio||1,a=t.transferControlToOffscreen(),o=new EO(TG,{onReady:()=>{}});u.current=o,o.post({type:"init",canvas:a,dpr:s,state:p()},[a]),o.post({type:"colors",colors:LG(e)});const r=JD.subscribe(()=>{c.current&&u.current?.post({type:"colors",colors:LG(c.current)})});return()=>{r(),o.dispose(),u.current=null,t.remove()}},[]),l.useEffect(()=>{u.current?.post({type:"state",state:p()});const e=c.current?.querySelector("canvas");e&&(e.style.height=`${n}px`)},[e,t,n,s,a,o]);const h=l.useCallback(n=>{const s=c.current?.getBoundingClientRect();if(!s)return 60;const a=n.clientY-s.top,o=t+60-Math.floor(a/e);return Math.max(0,Math.min(127,o))},[t,e]),f=l.useCallback(e=>{d.current=!0,r?.(h(e))},[h,r]),g=l.useCallback(()=>{d.current=!1,i?.()},[i]),b=l.useCallback(e=>{const t=h(e);m.current!==t&&(m.current=t,u.current?.post({type:"hover",midi:t})),d.current&&r?.(t)},[h,r]),v=l.useCallback(()=>{null!==m.current&&(m.current=null,u.current?.post({type:"hover",midi:null})),d.current&&(d.current=!1,i?.())},[i]);return Yn.jsxDEV("div",{ref:c,className:"shrink-0",style:{width:72,height:n},onMouseDown:f,onMouseUp:g,onMouseMove:b,onMouseLeave:v,role:"group","aria-label":"Piano keyboard"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoKeyboardCanvas.tsx",lineNumber:167,columnNumber:5},void 0)});class BG{scrollX=0;scrollY=0;horizontalZoom=16;verticalZoom=12;width=800;height=400;update(e){void 0!==e.scrollX&&(this.scrollX=e.scrollX),void 0!==e.scrollY&&(this.scrollY=e.scrollY),void 0!==e.horizontalZoom&&(this.horizontalZoom=e.horizontalZoom),void 0!==e.verticalZoom&&(this.verticalZoom=e.verticalZoom),void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height)}rowToPixelX(e){return(e-this.scrollX)*this.horizontalZoom}pixelXToRow(e){return e/this.horizontalZoom+this.scrollX}noteToPixelY(e){return(this.scrollY+60-e)*this.verticalZoom}pixelYToNote(e){return this.scrollY+60-e/this.verticalZoom}snapRow(e,t){const n=this.gridStep(t);return Math.round(e/n)*n}gridStep(e){return 4/e}getVisibleRange(){const e=Math.floor(this.scrollX),t=Math.ceil(this.scrollX+this.width/this.horizontalZoom)+1,n=Math.ceil(this.scrollY+60),s=Math.floor(this.scrollY+60-this.height/this.verticalZoom)-1;return{startRow:Math.max(0,e),endRow:t,startNote:Math.max(0,s),endNote:Math.min(127,n)}}get visibleRows(){return this.width/this.horizontalZoom}get visibleNotes(){return this.height/this.verticalZoom}}const IG={background:"#0a0a0b",laneDark:"rgba(255,255,255,0.06)",laneLight:"rgba(255,255,255,0.02)",laneOutOfScale:"rgba(0,0,0,0.45)",gridLine:"rgba(255,255,255,0.06)",beatLine:"rgba(255,255,255,0.15)",measureLine:"rgba(255,255,255,0.28)",cNoteLine:"rgba(255,255,255,0.18)",patternEnd:"rgba(239,68,68,0.5)",beyondPattern:"rgba(100,100,100,0.1)"};class FG{canvas=null;ctx=null;lastKey="";colors={...IG};cacheKey(e,t,n,s,a){const o=s?Array.from(s).sort().join(","):"chr";return`${e.scrollX.toFixed(2)}_${e.scrollY.toFixed(2)}_${e.horizontalZoom}_${e.verticalZoom}_${e.width}_${e.height}_${t}_${n}_${o}_${a}`}render(e,t,n,s,a){const o=this.cacheKey(e,t,n,s,a);if(o===this.lastKey&&this.canvas)return this.canvas;const r=Math.ceil(e.width*a),i=Math.ceil(e.height*a);if(r<=0||i<=0)return null;this.canvas&&this.canvas.width===r&&this.canvas.height===i||(this.canvas=new OffscreenCanvas(r,i),this.ctx=this.canvas.getContext("2d"));const l=this.ctx;if(!l)return null;l.setTransform(a,0,0,a,0,0),l.fillStyle=this.colors.background,l.fillRect(0,0,e.width,e.height);const c=e.getVisibleRange();for(let d=c.endNote;d>=c.startNote;d--){const t=e.noteToPixelY(d),n=e.verticalZoom;if(t+n<0||t>e.height)continue;const a=d%12,o=qM(d);void 0!==s&&!s.has(a)?(l.fillStyle=this.colors.laneOutOfScale,l.fillRect(0,t,e.width,n)):o?(l.fillStyle=this.colors.laneDark,l.fillRect(0,t,e.width,n)):(l.fillStyle=this.colors.laneLight,l.fillRect(0,t,e.width,n)),0===a&&(l.fillStyle=this.colors.cNoteLine,l.fillRect(0,t,e.width,1))}const u=e.gridStep(t);for(let d=Math.floor(c.startRow/u)*u;d<=c.endRow;d+=u){const t=e.rowToPixelX(d);if(t<-1||t>e.width+1)continue;const s=d%n,a=s%4==0;s%16==0?(l.fillStyle=this.colors.measureLine,l.fillRect(t,0,1,e.height)):a?(l.fillStyle=this.colors.beatLine,l.fillRect(t,0,1,e.height)):(l.fillStyle=this.colors.gridLine,l.fillRect(t,0,1,e.height))}for(let d=Math.floor(c.startRow/n)*n;d<=c.endRow;d+=n){if(d<=0)continue;const t=e.rowToPixelX(d);t>=0&&t<=e.width&&(l.fillStyle=this.colors.patternEnd,l.fillRect(t,0,2,e.height))}return this.lastKey=o,this.canvas}invalidate(){this.lastKey=""}}const UG=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6","#f97316","#8b5cf6","#10b981","#eab308","#d946ef","#0ea5e9","#fb923c","#84cc16"],RG="#64748b",jG={selectionRing:"#ffffff",ghostBorder:"rgba(255,255,255,0.5)",slideIndicator:"rgba(250,204,21,0.7)",accentIndicator:"rgba(255,100,0,0.85)",hammerIndicator:"rgba(168,85,247,0.7)",muteIndicator:"rgba(107,114,128,0.7)",playhead:"#ef4444",playheadGlow:"rgba(239,68,68,0.12)",selectionBox:"#60a5fa",selectionBoxFill:"rgba(59,130,246,0.12)"};class XG{colors={...jG};render(e,t,n,s,a,o,r){const i=t.getVisibleRange(),l=[0];if(r&&r>0){const e=Math.floor(i.startRow/r),t=Math.ceil(i.endRow/r);l.length=0;for(let n=e;n<=t;n++)l.push(n*r)}for(const c of l)for(const n of o)this.drawGhostNoteWithOffset(e,t,n,c,i);for(const c of l)for(const o of n){const n={...o,startRow:o.startRow+c,endRow:o.endRow+c};if(n.endRow<i.startRow||n.startRow>i.endRow)continue;if(n.midiNote<i.startNote||n.midiNote>i.endNote)continue;const r=s.has(o.id);this.drawNote(e,t,n,r,a)}}drawGhostNoteWithOffset(e,t,n,s,a){const o={...n,startRow:n.startRow+s,endRow:n.endRow+s};o.endRow<a.startRow||o.startRow>a.endRow||o.midiNote<a.startNote||o.midiNote>a.endNote||this.drawGhostNote(e,t,o)}drawNote(e,t,n,s,a){const o=t.rowToPixelX(n.startRow),r=(n.endRow-n.startRow)*t.horizontalZoom,i=t.noteToPixelY(n.midiNote)+3,l=t.verticalZoom-6-1,c=Math.max(4,r-1),u=null!==n.instrument?UG[n.instrument%UG.length]:RG,d=n.velocity/127,m=.33+.67*d*d;if(e.globalAlpha=m,e.fillStyle=s?this.brighten(u):u,this.roundRect(e,o,i,c,l,5),e.fill(),s?(e.globalAlpha=1,e.strokeStyle=this.colors.selectionRing,e.lineWidth=2.5,this.roundRect(e,o,i,c,l,5),e.stroke()):(e.globalAlpha=.2,e.strokeStyle="#000",e.lineWidth=1,this.roundRect(e,o,i,c,l,5),e.stroke()),e.globalAlpha=1,a&&c>16){const t=l*(1-n.velocity/127);t>0&&(e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(o,i,c,t))}if(this.drawIndicators(e,o,i,c,l,n),c>16&&t.verticalZoom>=10){e.fillStyle="rgba(255,255,255,0.9)",e.font=`${Math.min(10,t.verticalZoom-3)}px Inter, system-ui, sans-serif`,e.textBaseline="middle";const s=this.getNoteName(n.midiNote);e.fillText(s,o+3,i+l/2)}c>14&&(e.fillStyle="rgba(255,245,157,0.85)",e.fillRect(o+c-2,i+3,1,l-6))}drawIndicators(e,t,n,s,a,o){if(o.slide&&(e.fillStyle=this.colors.slideIndicator,e.fillRect(t+s-4,n,3,a)),o.accent&&(e.fillStyle=this.colors.accentIndicator,e.beginPath(),e.moveTo(t,n),e.lineTo(t+7,n),e.lineTo(t,n+7),e.closePath(),e.fill()),o.hammer){const s=t+(o.accent?12:5),r=n+a/2,i=Math.min(4,a/3);e.fillStyle=this.colors.hammerIndicator,e.beginPath(),e.moveTo(s,r-i),e.lineTo(s+i,r),e.lineTo(s,r+i),e.lineTo(s-i,r),e.closePath(),e.fill()}if(o.mute){e.globalAlpha=.4,e.fillStyle=this.colors.muteIndicator,e.fillRect(t,n,s,a),e.strokeStyle="rgba(0,0,0,0.5)",e.lineWidth=1,e.beginPath();for(let o=t-a;o<t+s;o+=6)e.moveTo(o,n+a),e.lineTo(o+a,n);e.stroke(),e.globalAlpha=1}}drawGhostNote(e,t,n){const s=t.rowToPixelX(n.startRow),a=(n.endRow-n.startRow)*t.horizontalZoom,o=t.noteToPixelY(n.midiNote)+3,r=t.verticalZoom-6-1,i=Math.max(4,a-1),l=null!==n.instrument?UG[n.instrument%UG.length]:RG;e.globalAlpha=.35,e.fillStyle=l,this.roundRect(e,s,o,i,r,5),e.fill(),e.globalAlpha=.5,e.setLineDash([4,3]),e.strokeStyle=this.colors.ghostBorder,e.lineWidth=1,this.roundRect(e,s,o,i,r,5),e.stroke(),e.setLineDash([]),e.globalAlpha=1}drawPlayhead(e,t,n){const s=t.rowToPixelX(n);s<-3||s>t.width+3||(e.fillStyle=this.colors.playheadGlow,e.fillRect(s-2,0,7,t.height),e.fillStyle=this.colors.playhead,e.fillRect(s,0,3,t.height))}drawSelectionBox(e,t,n,s,a){const o=Math.min(t,s),r=Math.min(n,a),i=Math.abs(s-t),l=Math.abs(a-n);e.fillStyle=this.colors.selectionBoxFill,e.fillRect(o,r,i,l),e.strokeStyle=this.colors.selectionBox,e.lineWidth=1,e.strokeRect(o+.5,r+.5,i,l)}brighten(e){return`rgb(${Math.min(255,parseInt(e.slice(1,3),16)+40)},${Math.min(255,parseInt(e.slice(3,5),16)+40)},${Math.min(255,parseInt(e.slice(5,7),16)+40)})`}roundRect(e,t,n,s,a,o){o=Math.min(o,s/2,a/2),e.beginPath(),e.moveTo(t+o,n),e.lineTo(t+s-o,n),e.quadraticCurveTo(t+s,n,t+s,n+o),e.lineTo(t+s,n+a-o),e.quadraticCurveTo(t+s,n+a,t+s-o,n+a),e.lineTo(t+o,n+a),e.quadraticCurveTo(t,n+a,t,n+a-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath()}getNoteName(e){const t=Math.floor(e/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}${t}`}}class zG{rects=[];rebuild(e,t){this.rects=e.map(e=>({note:e,x:t.rowToPixelX(e.startRow),y:t.noteToPixelY(e.midiNote),w:(e.endRow-e.startRow)*t.horizontalZoom,h:t.verticalZoom-1}))}hitTest(e,t){let n=null;for(const s of this.rects){if(e<s.x||e>s.x+s.w)continue;if(t<s.y||t>s.y+s.h)continue;const a=e-s.x;let o="body";a<=8&&s.w>16?o="resize-start":a>=s.w-8&&(o="resize-end"),n={note:s.note,zone:o}}return n}findInRect(e,t,n,s){const a=Math.min(e,n),o=Math.max(e,n),r=Math.min(t,s),i=Math.max(t,s),l=[];for(const c of this.rects)c.x+c.w<a||c.x>o||c.y+c.h<r||c.y>i||l.push(c.note);return l}getCursor(e,t,n){if("draw"===n)return"crosshair";if("erase"===n)return"not-allowed";const s=this.hitTest(e,t);if(!s)return"default";switch(s.zone){case"resize-start":case"resize-end":return"ew-resize";case"body":return"move";default:return"default"}}}const GG=a.memo(({notes:e,patternLength:t,horizontalZoom:n,verticalZoom:s,scrollX:a,scrollY:o,gridDivision:r,showVelocity:i,selectedNotes:c,playheadRow:u,containerHeight:d,scaleNotes:m,tool:p,onNoteSelect:h,onNoteDragStart:f,onGridClick:g,onGridRightClick:b,onScroll:v,onSelectionBoxStart:y,onNoteErase:x,onGridDraw:N})=>{const w=l.useRef(null),E=l.useRef(null),k=l.useRef(null),D=l.useRef(800),S=l.useRef(new BG),M=l.useRef(new FG),C=l.useRef(new XG),V=l.useRef(new zG),P=l.useRef(null),_=l.useRef({notes:[],selectedNotes:new Set,showVelocity:!0,ghostNotes:[],playheadRow:null,gridDivision:4,patternLength:64,scaleNotes:void 0,containerHeight:400,drag:{isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]}}),O=l.useRef(!0),T=l.useRef(""),L=$M(e=>e.ghostNotes),A=$M(e=>e.drag);l.useEffect(()=>{_.current.notes=e,_.current.selectedNotes=c,_.current.showVelocity=i,_.current.ghostNotes=L,_.current.playheadRow=u,_.current.gridDivision=r,_.current.patternLength=t,_.current.scaleNotes=m,_.current.containerHeight=d,_.current.drag=A}),l.useEffect(()=>{S.current.update({scrollX:a,scrollY:o,horizontalZoom:n,verticalZoom:s,width:D.current,height:d}),O.current=!0},[a,o,n,s,d]),l.useEffect(()=>{V.current.rebuild(e,S.current),O.current=!0},[e,a,o,n,s]),l.useEffect(()=>{const l=`${a}_${o}_${n}_${s}_${r}_${t}_${e.length}_${c.size}_${i}_${L.length}_${A.isDragging}_${A.currentX}_${A.currentY}`;l!==T.current&&(T.current=l,O.current=!0)}),l.useEffect(()=>{const t=E.current;if(!t)return;const n=new ResizeObserver(t=>{const n=t[0];if(!n)return;const s=n.contentRect.width;D.current=s,S.current.update({width:s}),V.current.rebuild(e,S.current),O.current=!0});return n.observe(t),()=>n.disconnect()},[e]),l.useEffect(()=>{O.current=!0;const e=()=>{const t=w.current;if(!t)return void(k.current=requestAnimationFrame(e));const n=t.getContext("2d");if(!n)return void(k.current=requestAnimationFrame(e));const s=S.current,a=window.devicePixelRatio||1,o=_.current,r=D.current,i=o.containerHeight,l=Math.ceil(r*a),c=Math.ceil(i*a);if(t.width===l&&t.height===c||(t.width=l,t.height=c,t.style.width=`${r}px`,t.style.height=`${i}px`,O.current=!0),O.current){O.current=!1,n.setTransform(a,0,0,a,0,0);const e=M.current.render(s,o.gridDivision,o.patternLength,o.scaleNotes,a);if(e&&n.drawImage(e,0,0,r,i),C.current.render(n,s,o.notes,o.selectedNotes,o.showVelocity,o.ghostNotes,o.patternLength),o.drag.isDragging&&"select-box"===o.drag.mode){const e=E.current?.getBoundingClientRect();if(e){const t=o.drag.startX-e.left,s=o.drag.startY-e.top,a=o.drag.currentX-e.left,r=o.drag.currentY-e.top;C.current.drawSelectionBox(n,t,s,a,r)}}}k.current=requestAnimationFrame(e)};return k.current=requestAnimationFrame(e),()=>{null!==k.current&&cancelAnimationFrame(k.current)}},[]);const B=l.useCallback(e=>{const t=E.current?.getBoundingClientRect();if(!t)return{x:0,y:0,row:0,midiNote:60};const n=e.clientX-t.left,s=e.clientY-t.top,a=S.current,o=Math.floor(a.pixelXToRow(n)),r=Math.floor(a.pixelYToNote(s));return{x:n,y:s,row:Math.max(0,o),midiNote:Math.max(0,Math.min(127,r))}},[]),I=l.useCallback(e=>{if(2===e.button)return;if(0!==e.button)return;const{x:t,y:n,row:s,midiNote:a}=B(e),o=V.current.hitTest(t,n);if("erase"!==p)if("draw"!==p)if(o){h(o.note.id,e.shiftKey||e.ctrlKey||e.metaKey);const t="resize-end"===o.zone?"resize-end":"resize-start"===o.zone?"resize-start":"move";f(o.note.id,t,e)}else y(s,a,e);else o?h(o.note.id,e.shiftKey||e.ctrlKey||e.metaKey):(g(s,a),P.current=`${s}_${a}`);else o&&x(o.note.id)},[p,B,h,f,g,y,x]),F=l.useRef(null),U=l.useCallback(e=>{const{x:t,y:n}=B(e),s=w.current;s&&(s.style.cursor=V.current.getCursor(t,n,p));const a=F.current;if(a&&0===e.buttons){const e=V.current.hitTest(t,n);if(e){const s=e.note,o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=Math.floor(s.midiNote/12)-1,i=`${o[s.midiNote%12]}${r}`,l=s.endRow-s.startRow;a.textContent=`${i}  vel:${s.velocity}  len:${l}`,a.style.display="block",a.style.left=`${t+12}px`,a.style.top=n-24+"px"}else a&&(a.style.display="none")}else a&&(a.style.display="none");if("erase"===p&&1===e.buttons){const e=V.current.hitTest(t,n);e&&x(e.note.id)}if("draw"===p&&1===e.buttons&&N){const{row:s,midiNote:a}=B(e),o=`${s}_${a}`;if(o!==P.current){V.current.hitTest(t,n)||(N(s,a),P.current=o)}}},[p,B,x,N]),R=l.useCallback(()=>{P.current=null},[]),j=l.useCallback(()=>{const e=F.current;e&&(e.style.display="none"),P.current=null},[]),X=l.useCallback(e=>{e.preventDefault();const{row:t,midiNote:n}=B(e);b(t,n,e.clientX,e.clientY)},[B,b]),z=l.useRef(v);return l.useEffect(()=>{z.current=v},[v]),l.useEffect(()=>{const e=E.current;if(!e)return;const t=e=>{e.preventDefault();const t=S.current,n=e.shiftKey?e.deltaY:e.deltaX,s=e.shiftKey?0:e.deltaY,a=n/t.horizontalZoom,o=-s/t.verticalZoom;z.current(a,o)};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]),Yn.jsxDEV("div",{ref:E,className:"flex-1 w-full h-full relative overflow-hidden",style:{height:d},children:[Yn.jsxDEV("canvas",{ref:w,onMouseDown:I,onMouseMove:U,onMouseUp:R,onMouseLeave:j,onContextMenu:X,role:"grid","aria-label":"Piano roll note grid",style:{display:"block",width:"100%",height:"100%"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollCanvas.tsx",lineNumber:420,columnNumber:7},void 0),Yn.jsxDEV("div",{ref:F,style:{display:"none",position:"absolute",pointerEvents:"none",background:"rgba(0,0,0,0.85)",color:"#e8e8ec",padding:"2px 6px",borderRadius:4,fontSize:10,fontFamily:"Inter, system-ui, sans-serif",whiteSpace:"nowrap",zIndex:10}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollCanvas.tsx",lineNumber:435,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollCanvas.tsx",lineNumber:415,columnNumber:5},void 0)});function HG(e){return new Worker("/assets/velocity-lane.worker-0qJ8te_4.js",{name:e?.name})}const WG=a.memo(({notes:e,horizontalZoom:t,scrollX:n,selectedNotes:s,onBeginDrag:a,onDragVelocity:o,onDragMultiVelocity:r,onEndDrag:i,onAdjustVelocity:c})=>{const u=l.useRef(null),d=l.useRef(null),m=l.useRef(800),p=l.useRef(null),h=l.useRef(null),f=l.useRef(e),g=l.useRef(s),b=l.useRef(t),v=l.useRef(n);function y(a){return{notes:e.map(e=>({id:e.id,startRow:e.startRow,endRow:e.endRow,velocity:e.velocity,instrument:e.instrument})),horizontalZoom:t,scrollX:n,selectedNotes:Array.from(s),containerWidth:a}}l.useEffect(()=>{f.current=e},[e]),l.useEffect(()=>{g.current=s},[s]),l.useEffect(()=>{b.current=t},[t]),l.useEffect(()=>{v.current=n},[n]),l.useEffect(()=>{const e=u.current;if(!e||!("transferControlToOffscreen"in HTMLCanvasElement.prototype))return;const t=document.createElement("canvas");t.style.cssText="display:block;width:100%;height:80px;",e.appendChild(t);const n=Math.max(1,e.clientWidth),s=window.devicePixelRatio||1;m.current=n;const a=t.transferControlToOffscreen(),o=new EO(HG,{onReady:()=>{}});d.current=o,o.post({type:"init",canvas:a,dpr:s,state:y(n)},[a]);const r=new ResizeObserver(e=>{const t=e[0]?.contentRect.width;t&&t>0&&(m.current=t,d.current?.post({type:"resize",w:t,dpr:window.devicePixelRatio||1}),d.current?.post({type:"state",state:y(t)}))});return r.observe(e),()=>{r.disconnect(),o.dispose(),d.current=null,t.remove()}},[]),l.useEffect(()=>{d.current?.post({type:"state",state:y(m.current)})},[e,t,n,s]);const x=l.useCallback(e=>{const t=Math.round(127*(1-e/80));return Math.max(1,Math.min(127,t))},[]),N=l.useCallback(e=>{const t=u.current?.getBoundingClientRect();if(!t)return null;const n=e-t.left,s=n/b.current+v.current;let a=null,o=1/0;for(const r of f.current)if(s>=r.startRow&&s<r.endRow){const e=Math.abs(n-(r.startRow-v.current)*b.current);e<o&&(o=e,a=r)}return a},[]),w=l.useCallback(e=>{e.preventDefault();const t=u.current?.getBoundingClientRect();if(!t)return;const n=N(e.clientX);if(!n)return;p.current=n.id,u.current&&(u.current.style.cursor="ns-resize"),a();const s=e.clientY-t.top,i=x(s),l=g.current;l.has(n.id)&&l.size>1?r(Array.from(l),i):o(n.id,i),d.current?.post({type:"state",state:y(m.current)})},[N,a,o,r,x]),E=l.useCallback(e=>{const t=N(e.clientX),n=t?.id??null;n!==h.current&&(h.current=n,d.current?.post({type:"hover",noteId:n}),u.current&&!p.current&&(u.current.style.cursor=n?"ns-resize":"default"));const s=p.current;if(!s)return;const a=u.current?.getBoundingClientRect();if(!a)return;const i=e.clientY-a.top,l=x(i),c=g.current;c.has(s)&&c.size>1?r(Array.from(c),l):o(s,l),d.current?.post({type:"state",state:y(m.current)})},[N,o,r,x]),k=l.useCallback(()=>{p.current&&i(),p.current=null,u.current&&(u.current.style.cursor=h.current?"ns-resize":"default")},[i]),D=l.useRef(c);return l.useEffect(()=>{D.current=c},[c]),l.useEffect(()=>{const e=u.current;if(!e)return;const t=t=>{if(!D.current)return;t.preventDefault();const n=t.deltaY<0?5:-5,s=e.getBoundingClientRect(),a=(t.clientX-s.left)/b.current+v.current;let o=null;for(const e of f.current)if(a>=e.startRow&&a<e.endRow){o=e;break}if(!o)return;const r=g.current,i=r.has(o.id)?Array.from(r):[o.id];D.current(i,n)};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]),Yn.jsxDEV("div",{ref:u,className:"relative flex-1 shrink-0 border-t border-dark-border overflow-hidden",style:{height:80},title:"Velocity Editor: Click or drag velocity bars to adjust. Scroll wheel for fine adjustment.",onMouseDown:w,onMouseMove:E,onMouseUp:k,onMouseLeave:k},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/VelocityLaneCanvas.tsx",lineNumber:228,columnNumber:5},void 0)}),qG=({icon:e,label:t,shortcut:n,onClick:s,disabled:a,hideContextMenu:o})=>Yn.jsxDEV("button",{className:"flex items-center gap-2 w-full px-3 py-1.5 text-xs text-left rounded transition-colors\n      "+(a?"text-text-muted/50 cursor-not-allowed":"text-text-primary hover:bg-dark-bgTertiary"),onClick:()=>{a||(s(),o())},disabled:a,children:[e,Yn.jsxDEV("span",{className:"flex-1",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:38,columnNumber:5},void 0),n&&Yn.jsxDEV("span",{className:"text-text-muted text-[10px]",children:n},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:39,columnNumber:18},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:26,columnNumber:3},void 0),KG=()=>Yn.jsxDEV("div",{className:"h-px bg-dark-border mx-2 my-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:43,columnNumber:37},void 0),$G=({onCopy:e,onCut:t,onPaste:n,onDelete:s,onSelectAll:a,onQuantize:o,onToggleSlide:r,onToggleAccent:i,onSetVelocity:c,hasSelection:u,hasClipboard:d,selectionVelocity:m})=>{const{contextMenu:p,hideContextMenu:h}=$M(),f=l.useRef(null);if(l.useEffect(()=>{if(!p.visible)return;const e=e=>{f.current&&!f.current.contains(e.target)&&h()},t=e=>{"Escape"===e.key&&h()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[p.visible,h]),!p.visible)return null;const g=Math.min(p.x,window.innerWidth-200),b=Math.min(p.y,window.innerHeight-260),v={position:"fixed",left:Math.max(0,g),top:Math.max(0,b),zIndex:100};return Yn.jsxDEV("div",{ref:f,className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl py-1 min-w-[180px]",style:v,children:[Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(Je,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:119,columnNumber:57},void 0),label:"Copy",shortcut:"Ctrl+C",onClick:e,disabled:!u},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:119,columnNumber:7},void 0),Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(Et,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:120,columnNumber:57},void 0),label:"Cut",shortcut:"Ctrl+X",onClick:t,disabled:!u},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:120,columnNumber:7},void 0),Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(kt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:121,columnNumber:57},void 0),label:"Paste",shortcut:"Ctrl+V",onClick:n,disabled:!d},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:121,columnNumber:7},void 0),Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(Ie,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:122,columnNumber:57},void 0),label:"Delete",shortcut:"Del",onClick:s,disabled:!u},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:122,columnNumber:7},void 0),Yn.jsxDEV(KG,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:123,columnNumber:7},void 0),Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(Dn,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:124,columnNumber:57},void 0),label:"Select All",shortcut:"Ctrl+A",onClick:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:124,columnNumber:7},void 0),Yn.jsxDEV(KG,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:125,columnNumber:7},void 0),Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(ut,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:126,columnNumber:57},void 0),label:"Quantize",shortcut:"Q",onClick:o,disabled:!u},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:126,columnNumber:7},void 0),Yn.jsxDEV(KG,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:127,columnNumber:7},void 0),u&&c&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 px-3 py-1.5",children:[Yn.jsxDEV(Sn,{size:12,className:"text-text-muted shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:131,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted shrink-0",children:"Vel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:132,columnNumber:13},void 0),Yn.jsxDEV("input",{type:"range",min:1,max:127,value:m??100,onChange:e=>c(parseInt(e.target.value,10)),className:"flex-1 h-1 accent-accent-primary",style:{cursor:"pointer"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:133,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-primary w-6 text-right tabular-nums",children:m??100},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:142,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:130,columnNumber:11},void 0),Yn.jsxDEV(KG,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:144,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:129,columnNumber:9},void 0),Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(Mn,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:147,columnNumber:57},void 0),label:"Toggle Slide",shortcut:"S",onClick:r,disabled:!u},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:147,columnNumber:7},void 0),Yn.jsxDEV(qG,{hideContextMenu:h,icon:Yn.jsxDEV(Oe,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:148,columnNumber:57},void 0),label:"Toggle Accent",shortcut:"A",onClick:i,disabled:!u},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:148,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollContextMenu.tsx",lineNumber:114,columnNumber:5},void 0)};function YG(e,t){return`${e}-${t}`}function JG(e,t,n){for(let s=t+1;s<n;s++){const n=e[s];if(97===n.note)return s-t;if(n.note&&0!==n.note&&97!==n.note)return s-t}return n-t}function QG(e){return JSON.parse(JSON.stringify(e))}function ZG(e,t,n,s){(0,CD.getState().pushAction)("EDIT_CELL",s,n,e,JSON.parse(JSON.stringify(t)))}function eH(e){const t=ID(e=>e.currentPatternIndex),n=ID(e=>e.patterns[e.currentPatternIndex]),s=ID(e=>e.setCell),a=l.useMemo(()=>n?function(e,t){const n=[];return(void 0!==t?[e.channels[t]].filter(Boolean):e.channels).forEach((s,a)=>{const o=void 0!==t?t:a;for(let t=0;t<s.rows.length;t++){const a=s.rows[t];if(!a.note||0===a.note||97===a.note)continue;const r=Qa(a.note);if(null===r)continue;const i=JG(s.rows,t,e.length),l=a.volume>=16&&a.volume<=80?Math.round((a.volume-16)/64*127):100;n.push({id:YG(o,t),channelIndex:o,startRow:t,endRow:t+i,midiNote:r,velocity:l,instrument:a.instrument,slide:2===a.flag1||2===a.flag2,accent:1===a.flag1||1===a.flag2,hammer:4===a.flag1||4===a.flag2,mute:3===a.flag1||3===a.flag2})}}),n}(n,e):[],[n,e]),o=l.useCallback((a,o,r,i=100,l)=>{const c=l??e??0;if(!n)return;const u=QG(n),d=Za(a),m=Math.round(i/127*64);s(c,o,{note:d,volume:16+m}),o+r<(n?.length||64)&&s(c,o+r,{note:97});const p=ID.getState().patterns[t];p&&ZG(u,p,t,"Add note")},[e,n,t,s]),r=l.useCallback(e=>{const[o,r]=e.split("-"),i=parseInt(o,10),l=parseInt(r,10),c=a.find(t=>t.id===e);if(!c||!n)return;const u=QG(n);if(s(i,l,{note:0,volume:0}),c.endRow<(n?.length||64)){const e=n?.channels[i]?.rows[c.endRow];97===e?.note&&s(i,c.endRow,{note:0})}const d=ID.getState().patterns[t];d&&ZG(u,d,t,"Delete note")},[a,n,t,s]),i=l.useCallback(e=>{if(!n||0===e.length)return;const o=QG(n);e.forEach(e=>{const[o,r]=e.split("-"),i=parseInt(o,10),l=parseInt(r,10),c=a.find(t=>t.id===e);if(c&&(s(i,l,{note:0,volume:0}),c.endRow<(n?.length||64))){const e=ID.getState().patterns[t],n=e?.channels[i]?.rows[c.endRow];97===n?.note&&s(i,c.endRow,{note:0})}});const r=ID.getState().patterns[t];r&&ZG(o,r,t,`Delete ${e.length} notes`)},[a,n,t,s]),c=l.useCallback((e,o,r)=>{const i=a.find(t=>t.id===e);if(!i||!n)return;const l=QG(n),c=Math.max(0,i.startRow+o),u=Math.max(0,Math.min(127,i.midiNote+r)),d=i.endRow-i.startRow,[m,p]=e.split("-"),h=parseInt(m,10),f=parseInt(p,10);if(s(h,f,{note:0,volume:0}),i.endRow<(n?.length||64)){const e=n?.channels[h]?.rows[i.endRow];97===e?.note&&s(h,i.endRow,{note:0})}const g=Za(u),b=16+Math.round(i.velocity/127*64);s(i.channelIndex,c,{note:g,volume:b}),c+d<(n?.length||64)&&s(i.channelIndex,c+d,{note:97});const v=ID.getState().patterns[t];v&&ZG(l,v,t,"Move note")},[a,n,t,s]),u=l.useCallback((e,o)=>{const r=a.find(t=>t.id===e);if(!r||!n)return;const i=QG(n),l=Math.max(1,o-r.startRow),[c,u]=e.split("-"),d=parseInt(c,10),m=parseInt(u,10);if(s(d,m,{note:0,volume:0}),r.endRow<(n?.length||64)){const e=n?.channels[d]?.rows[r.endRow];97===e?.note&&s(d,r.endRow,{note:0})}const p=Za(r.midiNote),h=16+Math.round(r.velocity/127*64);s(r.channelIndex,r.startRow,{note:p,volume:h}),r.startRow+l<(n?.length||64)&&s(r.channelIndex,r.startRow+l,{note:97});const f=ID.getState().patterns[t];f&&ZG(i,f,t,"Resize note")},[a,n,t,s]),d=l.useCallback((e,o)=>{const r=a.find(t=>t.id===e);if(!r||!n)return;const i=Math.max(0,Math.min(o,r.endRow-1));if(i===r.startRow)return;const l=QG(n),[c]=e.split("-"),u=parseInt(c,10);if(s(u,r.startRow,{note:0,volume:0}),r.endRow<(n?.length||64)){const e=n?.channels[u]?.rows[r.endRow];97===e?.note&&s(u,r.endRow,{note:0})}const d=Za(r.midiNote),m=16+Math.round(r.velocity/127*64);s(r.channelIndex,i,{note:d,volume:m}),r.endRow<(n?.length||64)&&s(r.channelIndex,r.endRow,{note:97});const p=ID.getState().patterns[t];p&&ZG(l,p,t,"Resize note start")},[a,n,t,s]),m=l.useCallback((e,a)=>{const[o,r]=e.split("-"),i=parseInt(o,10),l=parseInt(r,10);if(!n)return;const c=QG(n),u=Math.round(a/127*64);s(i,l,{volume:16+u});const d=ID.getState().patterns[t];d&&ZG(c,d,t,"Set velocity")},[n,t,s]),p=l.useCallback((e,a)=>{if(!n||0===e.length)return;const o=QG(n),r=16+Math.round(a/127*64);e.forEach(e=>{const[t,n]=e.split("-"),a=parseInt(t,10),o=parseInt(n,10);s(a,o,{volume:r})});const i=ID.getState().patterns[t];i&&ZG(o,i,t,`Set velocity (${e.length} notes)`)},[n,t,s]),h=l.useRef(null),f=l.useCallback(()=>{n&&(h.current=QG(n))},[n]),g=l.useCallback((e,t)=>{const[n,a]=e.split("-"),o=parseInt(n,10),r=parseInt(a,10),i=Math.round(t/127*64);s(o,r,{volume:16+i})},[s]),b=l.useCallback((e,t)=>{const n=16+Math.round(t/127*64);e.forEach(e=>{const[t,a]=e.split("-"),o=parseInt(t,10),r=parseInt(a,10);s(o,r,{volume:n})})},[s]),v=l.useCallback(()=>{if(!h.current)return;const e=ID.getState().patterns[t];e&&ZG(h.current,e,t,"Adjust velocity"),h.current=null},[t]),y=l.useCallback((e,a)=>{if(!n||0===e.length)return;const o=QG(n);e.forEach(e=>{const[t,n]=e.split("-"),o=parseInt(t,10),r=parseInt(n,10);s(o,r,{flag2:a?2:0})});const r=ID.getState().patterns[t];r&&ZG(o,r,t,"Toggle slide")},[n,t,s]),x=l.useCallback((e,a)=>{if(!n||0===e.length)return;const o=QG(n);e.forEach(e=>{const[t,n]=e.split("-"),o=parseInt(t,10),r=parseInt(n,10);s(o,r,{flag1:a?1:0})});const r=ID.getState().patterns[t];r&&ZG(o,r,t,"Toggle accent")},[n,t,s]),N=l.useCallback((e,o)=>{if(!n||0===e.length)return;const r=QG(n),i=Math.max(1,Math.floor(4/o));e.forEach(e=>{const o=a.find(t=>t.id===e);if(!o)return;const r=Math.round(o.startRow/i)*i;if(r===o.startRow)return;const l=o.endRow-o.startRow,[c,u]=e.split("-"),d=parseInt(c,10),m=parseInt(u,10);if(s(d,m,{note:0,volume:0}),o.endRow<(n?.length||64)){const e=ID.getState().patterns[t],n=e?.channels[d]?.rows[o.endRow];97===n?.note&&s(d,o.endRow,{note:0})}const p=Za(o.midiNote),h=16+Math.round(o.velocity/127*64);s(o.channelIndex,r,{note:p,volume:h}),r+l<(n?.length||64)&&s(o.channelIndex,r+l,{note:97})});const l=ID.getState().patterns[t];l&&ZG(r,l,t,"Quantize notes")},[a,n,t,s]),w=l.useCallback((e,o)=>{if(!n||0===e.length)return;const r=QG(n);e.forEach(e=>{const r=a.find(t=>t.id===e);if(!r)return;const i=Math.max(0,Math.min(127,r.midiNote+o));if(i===r.midiNote)return;const[l]=e.split("-"),c=parseInt(l,10),u=r.endRow-r.startRow;if(s(c,r.startRow,{note:0,volume:0}),r.endRow<(n?.length||64)){const e=ID.getState().patterns[t],n=e?.channels[c]?.rows[r.endRow];97===n?.note&&s(c,r.endRow,{note:0})}const d=Za(i),m=16+Math.round(r.velocity/127*64);s(r.channelIndex,r.startRow,{note:d,volume:m}),r.startRow+u<(n?.length||64)&&s(r.channelIndex,r.startRow+u,{note:97})});const i=ID.getState().patterns[t];i&&ZG(r,i,t,`Transpose ${o>0?"+":""}${o}`)},[a,n,t,s]),E=l.useCallback((e,o)=>{if(!n||0===e.length)return;const r=QG(n);e.forEach(e=>{const r=a.find(t=>t.id===e);if(!r)return;const i=Math.max(1,r.endRow-r.startRow+o),l=r.startRow+i,[c]=e.split("-"),u=parseInt(c,10);if(s(u,r.startRow,{note:0,volume:0}),r.endRow<(n?.length||64)){const e=ID.getState().patterns[t],n=e?.channels[u]?.rows[r.endRow];97===n?.note&&s(u,r.endRow,{note:0})}const d=Za(r.midiNote),m=16+Math.round(r.velocity/127*64);s(r.channelIndex,r.startRow,{note:d,volume:m}),l<(n?.length||64)&&s(r.channelIndex,l,{note:97})});const i=ID.getState().patterns[t];i&&ZG(r,i,t,`Adjust length ${o>0?"+":""}${o}`)},[a,n,t,s]),k=l.useCallback(e=>{if(!n||0===e.length)return;const o=QG(n),r=e.map(e=>a.find(t=>t.id===e)).filter(Boolean);if(0===r.length)return;const i=Math.min(...r.map(e=>e.startRow)),l=Math.max(...r.map(e=>e.endRow))-i;r.forEach(e=>{const t=e.startRow+l;if(t>=(n?.length||64))return;const a=e.endRow-e.startRow,o=Za(e.midiNote),r=16+Math.round(e.velocity/127*64);s(e.channelIndex,t,{note:o,volume:r}),t+a<(n?.length||64)&&s(e.channelIndex,t+a,{note:97})});const c=ID.getState().patterns[t];c&&ZG(o,c,t,`Duplicate ${e.length} notes`)},[a,n,t,s]),D=l.useCallback((e,o)=>{if(!n||0===e.length)return;const r=QG(n);e.forEach(e=>{const t=a.find(t=>t.id===e);if(!t)return;const n=Math.max(1,Math.min(127,t.velocity+o)),r=16+Math.round(n/127*64),[i,l]=e.split("-"),c=parseInt(i,10),u=parseInt(l,10);s(c,u,{volume:r})});const i=ID.getState().patterns[t];i&&ZG(r,i,t,`Adjust velocity ${o>0?"+":""}${o}`)},[a,n,t,s]),S=l.useCallback((a,o,r,i)=>{if(!n||0===a.notes.length)return;const l=QG(n),c=o-a.minRow,u=r-a.minNote,d=i??e??0;a.notes.forEach(e=>{const t=e.startRow+c,a=Math.max(0,Math.min(127,e.midiNote+u)),o=e.endRow-e.startRow;if(t<0||t>=(n?.length||64))return;const r=Za(a),i=Math.round(e.velocity/127*64);s(d,t,{note:r,volume:16+i}),t+o<(n?.length||64)&&s(d,t+o,{note:97})});const m=ID.getState().patterns[t];m&&ZG(l,m,t,"Paste notes")},[e,n,t,s]);return{notes:a,pattern:n,addNote:o,deleteNote:r,deleteNotes:i,moveNote:c,resizeNote:u,resizeNoteStart:d,setNoteVelocity:m,setMultipleVelocities:p,beginVelocityDrag:f,setVelocityNoUndo:g,setMultipleVelocitiesNoUndo:b,endVelocityDrag:v,toggleSlide:y,toggleAccent:x,quantizeNotes:N,transposeNotes:w,adjustNoteLengths:E,duplicateNotes:k,adjustVelocities:D,pasteNotes:S}}const tH={z:0,s:1,x:2,d:3,c:4,v:5,g:6,b:7,h:8,n:9,j:10,m:11,q:12,2:13,w:14,3:15,e:16,r:17,5:18,t:19,6:20,y:21,7:22,u:23,i:24,9:25,o:26,0:27,p:28},nH=({channelIndex:e})=>{!function(){const e=l.useCallback((e,t)=>{const n=$M.getState(),s=t.ctrlKey||t.metaKey,a=t.key;if(s&&"a"===a.toLowerCase())return t.preventDefault(),LN.getState().setStatusMessage("SELECT ALL",!1,800),!0;if("Escape"===a)return n.clearSelection(),!0;if("q"===a.toLowerCase()&&!s){const e=!n.view.snapToGrid;return n.setSnapToGrid(e),LN.getState().setStatusMessage("Snap: "+(e?"ON":"OFF"),!1,800),!0}if(!s&&!t.altKey){const e={1:1,2:2,3:4,4:8,5:16,6:32}[a];if(void 0!==e)return n.setGridDivision(e),LN.getState().setStatusMessage(`Grid: 1/${e}`,!1,800),!0}return"s"!==a.toLowerCase()||s?"p"!==a.toLowerCase()&&"d"!==a.toLowerCase()||s?"e"!==a.toLowerCase()||s?("Delete"===a||"Backspace"===a)&&n.selection.notes.size>0&&(t.preventDefault(),LN.getState().setStatusMessage("DELETE SELECTED",!1,800),!0):(n.setTool("erase"),LN.getState().setStatusMessage("Tool: Erase",!1,800),!0):(n.setTool("draw"),LN.getState().setStatusMessage("Tool: Draw",!1,800),!0):(n.setTool("select"),LN.getState().setStatusMessage("Tool: Select",!1,800),!0)},[]);l.useEffect(()=>OG("pianoroll",e),[e])}();const{view:t,selection:n,tool:s,drag:a,clipboard:o,setHorizontalZoom:r,setVerticalZoom:i,setScroll:c,setSnapToGrid:u,setGridDivision:d,setShowVelocity:m,setShowVelocityLane:p,setChannelIndex:h,setMultiChannel:f,setScaleKey:g,setScaleRoot:b,setNoteLengthPreset:v,selectNote:y,selectNotes:x,selectAll:N,clearSelection:w,setTool:E,startDrag:k,updateDrag:D,endDrag:S,copyNotes:M,showContextMenu:C,hideContextMenu:V,setGhostNotes:P}=$M(),{notes:_,pattern:O,addNote:T,deleteNote:L,deleteNotes:A,moveNote:B,resizeNote:I,resizeNoteStart:F,beginVelocityDrag:U,setVelocityNoUndo:R,setMultipleVelocitiesNoUndo:j,endVelocityDrag:X,setMultipleVelocities:z,toggleSlide:G,toggleAccent:H,quantizeNotes:W,transposeNotes:q,adjustNoteLengths:K,duplicateNotes:$,adjustVelocities:J,pasteNotes:Q}=eH(t.multiChannel?void 0:e??t.channelIndex),Z=jN(e=>e.isPlaying),ee=jN(e=>e.currentRow),{instruments:te,currentInstrumentId:ne}=EN(),se=l.useRef(null),[ae,oe]=l.useState(400),[re,ie]=l.useState(!1),le=l.useRef(null);l.useEffect(()=>{void 0!==e&&h(e)},[e,h]);const ce=l.useRef(null);l.useEffect(()=>{if(0===_.length)return;const e=ID.getState().currentPatternIndex;if(ce.current===e)return;ce.current=e;const n=_.map(e=>e.midiNote),s=(Math.min(...n)+Math.max(...n))/2-60+(ae-(t.showVelocityLane?80:0))/(2*t.verticalZoom);c(0,Math.max(0,Math.min(127,s)))},[_,ae,t.showVelocityLane,t.verticalZoom,c]);const ue=O?.length||64,de=l.useRef(0),me=l.useRef(null),pe=l.useRef(null),he=l.useRef(0),fe=l.useRef(0),ge=l.useRef(0);l.useEffect(()=>{if(Z&&null!==ee){if(pe.current!==O)de.current=0,pe.current=O,me.current=ee;else{null!==me.current&&ee<me.current&&(de.current+=ue);const e=ee+de.current,n=72;if((e-fe.current)*t.horizontalZoom>n+t.horizontalZoom){const s=e-n/t.horizontalZoom;he.current=Math.max(0,s)}me.current=ee}}else me.current=null,pe.current=null,de.current=0},[Z,ee,O,t.horizontalZoom,ue]),l.useEffect(()=>{if(!Z)return void(ge.current&&(cancelAnimationFrame(ge.current),ge.current=0));const e=()=>{const t=he.current,n=fe.current,s=t-n;if(Math.abs(s)>.05){const e=Math.min(Math.abs(s)/100,1),t=1-Math.pow(1-e,3),a=n+s*Math.max(.3,t);fe.current=a,$M.setState({view:{...$M.getState().view,scrollX:a}})}else Math.abs(s)>.001&&(fe.current=t,$M.setState({view:{...$M.getState().view,scrollX:t}}));ge.current=requestAnimationFrame(e)};return fe.current=t.scrollX,ge.current=requestAnimationFrame(e),()=>{ge.current&&(cancelAnimationFrame(ge.current),ge.current=0)}},[Z]),l.useEffect(()=>{const e=()=>{if(se.current){const e=se.current.clientHeight-44;oe(Math.max(200,e))}};e();const t=new ResizeObserver(e);return se.current&&t.observe(se.current),()=>t.disconnect()},[]);const be=l.useMemo(()=>Math.ceil(ae/t.verticalZoom)+2,[ae,t.verticalZoom]),ve=l.useMemo(()=>Math.floor(be/12),[be]),ye=l.useMemo(()=>{if(!Z||null===ee)return new Set;const e=new Set,t=ee%ue;return _.forEach(n=>{t>=n.startRow&&t<n.endRow&&e.add(n.midiNote)}),e},[Z,ee,_,ue]),xe=l.useMemo(()=>{if("chromatic"===t.scaleKey)return;const e=TO[t.scaleKey];return e?new Set(function(e,t){return e<0||e>11?[]:t.intervals.map(t=>(e+t)%12)}(t.scaleRoot,e)):void 0},[t.scaleKey,t.scaleRoot]),Ne=l.useMemo(()=>{if(!a.isDragging||"move"!==a.mode||!a.noteId)return null;const e=_.find(e=>e.id===a.noteId);if(!e)return null;const n=-Math.round((a.currentY-a.startY)/t.verticalZoom);return Math.max(0,Math.min(127,e.midiNote+n))},[a.isDragging,a.mode,a.noteId,a.currentY,a.startY,t.verticalZoom,_]),we=l.useCallback(()=>t.noteLengthPreset>0?t.noteLengthPreset:t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1,[t.noteLengthPreset,t.snapToGrid,t.gridDivision]),Ee=l.useCallback(e=>{if(!xe)return e;if(xe.has(e%12))return e;for(let t=1;t<=6;t++){if(xe.has((e+t)%12))return e+t;if(xe.has((e-t+12)%12))return e-t}return e},[xe]),ke=l.useCallback(async e=>{if(null===ne)return;const t=Bw(),n=te.find(e=>e.id===ne);if(!n)return;await t.ensureInstrumentReady(n);const s=WM(e);le.current=s,t.triggerNoteAttack(ne,s,Y(),.8,n)},[ne,te]),De=l.useCallback(()=>{if(le.current&&null!==ne){Bw().releaseNote(ne,le.current),le.current=null}},[ne]),Se=l.useCallback((e,t)=>{"erase"===s?L(e):y(e,t)},[s,L,y]),Me=l.useCallback((e,t,n)=>{if(n.altKey&&"move"===t){const t=_.find(t=>t.id===e);t&&T(t.midiNote,t.startRow,t.endRow-t.startRow,t.velocity,t.channelIndex)}k(t,n.clientX,n.clientY,e)},[k,_,T]),Ce=l.useCallback((e,n)=>{if(V(),"draw"===s){const s=Ee(n),a=we();T(s,e,a,100,t.channelIndex)}else"select"===s&&(a.isDragging||w())},[s,t.channelIndex,T,w,V,a.isDragging,Ee,we]),Ve=l.useCallback((e,n)=>{if("draw"!==s)return;const a=Ee(n),o=we();T(a,e,o,100,t.channelIndex)},[s,t.channelIndex,T,Ee,we]),Pe=l.useCallback((e,t,s,a)=>{const o=_.find(n=>e>=n.startRow&&e<n.endRow&&t===n.midiNote);o&&!n.notes.has(o.id)&&y(o.id,!1),C(s,a,o?.id||null,e,t)},[_,n.notes,y,C]),Oe=l.useCallback(e=>{L(e)},[L]),Te=l.useCallback((e,t,n)=>{if("select"!==s)return;_.find(n=>e>=n.startRow&&e<n.endRow&&t===n.midiNote)||k("select-box",n.clientX,n.clientY)},[s,_,k]),Le=l.useRef(t.scrollX),Ae=l.useRef(t.scrollY),Be=l.useRef(null),Ie=l.useRef(t.scrollX),Fe=l.useRef(t.scrollY);l.useEffect(()=>{t.scrollX!==Ie.current&&(Le.current=t.scrollX),t.scrollY!==Fe.current&&(Ae.current=t.scrollY),Ie.current=t.scrollX,Fe.current=t.scrollY},[t.scrollX,t.scrollY]),l.useEffect(()=>()=>{null!==Be.current&&cancelAnimationFrame(Be.current)},[]);const Ue=l.useRef(()=>{});l.useEffect(()=>{Ue.current=()=>{const e=$M.getState().view.scrollX,t=$M.getState().view.scrollY,n=Le.current,s=Ae.current,a=n-e,o=s-t;if(Math.abs(a)<.1&&Math.abs(o)<.1)return c(n,s),Ie.current=n,Fe.current=s,void(Be.current=null);const r=e+.25*a,i=t+.25*o;c(r,i),Ie.current=r,Fe.current=i,Be.current=requestAnimationFrame(()=>Ue.current())}});const Re=l.useCallback(()=>{Ue.current()},[]),je=l.useCallback((e,t)=>{Le.current=Math.max(0,Le.current+e),Ae.current=Math.max(0,Math.min(127,Ae.current+t)),null===Be.current&&(Be.current=requestAnimationFrame(Re))},[Re]);l.useEffect(()=>{const e=e=>{const n=$M.getState().drag;if(!n.isDragging)return;D(e.clientX,e.clientY);const s=t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1;if("move"===n.mode&&n.noteId){const a=e.clientX-n.startX,o=e.clientY-n.startY,r=a/t.horizontalZoom,i=Math.round(r/s)*s,l=-Math.round(o/t.verticalZoom);if(0!==i||0!==l){const e=_.find(e=>e.id===n.noteId);if(e){const t=$M.getState().selection.notes,n=(t.has(e.id)?Array.from(t):[e.id]).map(e=>{const t=_.find(t=>t.id===e);return t?{...t,startRow:Math.max(0,t.startRow+i),endRow:Math.max(1,t.endRow+i),midiNote:Math.max(0,Math.min(127,t.midiNote+l))}:null}).filter(Boolean);P(n)}}}if(("resize-end"===n.mode||"resize-start"===n.mode)&&n.noteId){const a=(e.clientX-n.startX)/t.horizontalZoom,o=Math.round(a/s)*s,r=_.find(e=>e.id===n.noteId);if(r&&0!==o){const e={...r};"resize-end"===n.mode?e.endRow=Math.max(r.startRow+1,r.endRow+o):e.startRow=Math.min(r.endRow-1,Math.max(0,r.startRow+o)),P([e])}}if("select-box"===n.mode){const s=document.querySelector('[role="grid"]');if(!s)return;const a=s.getBoundingClientRect(),o=Math.min(n.startX,e.clientX)-a.left,r=Math.max(n.startX,e.clientX)-a.left,i=Math.min(n.startY,e.clientY)-a.top,l=Math.max(n.startY,e.clientY)-a.top,c=Math.floor(o/t.horizontalZoom)+t.scrollX,u=Math.ceil(r/t.horizontalZoom)+t.scrollX,d=t.scrollY+60-Math.floor(l/t.verticalZoom),m=t.scrollY+60-Math.floor(i/t.verticalZoom),p=_.filter(e=>e.startRow<u&&e.endRow>c&&e.midiNote>=d&&e.midiNote<=m).map(e=>e.id);x(p)}},n=()=>{const e=$M.getState().drag;if(!e.isDragging)return;if("select-box"===e.mode)return void S();if(!e.noteId)return void S();const n=e.currentX-e.startX,s=e.currentY-e.startY,a=t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1,o=Math.round(n/t.horizontalZoom/a)*a,r=-Math.round(s/t.verticalZoom);if("move"!==e.mode||0===o&&0===r){if("resize-end"===e.mode){const t=_.find(t=>t.id===e.noteId);t&&I(e.noteId,t.endRow+o)}else if("resize-start"===e.mode){const t=_.find(t=>t.id===e.noteId);t&&F(e.noteId,t.startRow+o)}}else B(e.noteId,o,r);S()};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",n)}},[t.horizontalZoom,t.verticalZoom,t.scrollX,t.scrollY,t.snapToGrid,t.gridDivision,_,B,I,F,D,S,x,P]);const Xe=l.useCallback(()=>{const e=_.filter(e=>n.notes.has(e.id));e.length>0&&M(e)},[_,n.notes,M]),ze=l.useCallback(()=>{Xe();const e=Array.from(n.notes);A(e),w()},[Xe,n.notes,A,w]),Ge=l.useCallback(()=>{const e=$M.getState().clipboard;e&&Q(e,Math.floor(t.scrollX),Math.round(t.scrollY+60),t.channelIndex)},[Q,t.scrollX,t.scrollY,t.channelIndex]),We=l.useCallback(()=>{const e=Array.from(n.notes);A(e),w()},[n.notes,A,w]),qe=l.useCallback(()=>{N(_.map(e=>e.id))},[_,N]),Ke=l.useCallback(()=>{const e=Array.from(n.notes);W(e,t.gridDivision)},[n.notes,W,t.gridDivision]),$e=l.useCallback(()=>{const e=Array.from(n.notes),t=_.filter(e=>n.notes.has(e.id)).some(e=>e.slide);G(e,!t)},[_,n.notes,G]),Ye=l.useCallback(()=>{const e=Array.from(n.notes),t=_.filter(e=>n.notes.has(e.id)).some(e=>e.accent);H(e,!t)},[_,n.notes,H]),Je=l.useCallback(()=>{const e=CD.getState().undo();e&&ID.getState().replacePattern(ID.getState().currentPatternIndex,e)},[]),Qe=l.useCallback(()=>{const e=CD.getState().redo();e&&ID.getState().replacePattern(ID.getState().currentPatternIndex,e)},[]);l.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if(e.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const a=e.key,o=a.toLowerCase();if((e.ctrlKey||e.metaKey)&&"z"===o&&!e.shiftKey)return e.preventDefault(),void Je();if((e.ctrlKey||e.metaKey)&&("y"===o||"z"===o&&e.shiftKey))return e.preventDefault(),void Qe();if((e.ctrlKey||e.metaKey)&&"c"===o)return e.preventDefault(),void Xe();if((e.ctrlKey||e.metaKey)&&"x"===o)return e.preventDefault(),void ze();if((e.ctrlKey||e.metaKey)&&"v"===o)return e.preventDefault(),void Ge();if((e.ctrlKey||e.metaKey)&&"a"===o)return e.preventDefault(),void qe();if("Delete"===a||"Backspace"===a)return e.preventDefault(),void We();if("Escape"===a)return e.preventDefault(),w(),void V();if((e.ctrlKey||e.metaKey)&&"d"===o&&n.notes.size>0)return e.preventDefault(),void $(Array.from(n.notes));if(n.notes.size>0&&("ArrowUp"===a||"ArrowDown"===a||"ArrowLeft"===a||"ArrowRight"===a)){e.preventDefault();const s=Array.from(n.notes);if("ArrowUp"===a)return void q(s,e.shiftKey?12:1);if("ArrowDown"===a)return void q(s,e.shiftKey?-12:-1);if("ArrowLeft"===a&&e.shiftKey){const e=Math.max(1,Math.floor(4/t.gridDivision));return void K(s,-e)}if("ArrowRight"===a&&e.shiftKey){const e=Math.max(1,Math.floor(4/t.gridDivision));return void K(s,e)}}if(("+"===a||"="===a||"-"===a||"_"===a)&&n.notes.size>0&&!e.ctrlKey&&!e.metaKey){e.preventDefault();const t="+"===a||"="===a?10:-10;return void J(Array.from(n.notes),t)}if(!e.ctrlKey&&!e.metaKey&&!e.altKey){if("q"===o&&n.notes.size>0&&"select"===s)return e.preventDefault(),void Ke();if("s"===o&&n.notes.size>0&&"select"===s&&!e.shiftKey&&"select"===s)return e.preventDefault(),void $e();if("a"===o&&n.notes.size>0&&"select"===s&&!e.shiftKey)return e.preventDefault(),void Ye();if("draw"!==s){if("1"===a)return E("select"),void e.preventDefault();if("2"===a)return E("draw"),void e.preventDefault();if("3"===a)return E("erase"),void e.preventDefault()}}if(!("draw"!==s||e.ctrlKey||e.metaKey||e.altKey||e.repeat)){const n=tH[o];if(void 0!==n){e.preventDefault();const s=ID.getState().currentOctave||4,a=Ee(12*s+n),o=Math.floor(t.scrollX),r=we();return T(a,o,r,100,t.channelIndex),void ke(a)}}},a=e=>{const t=e.key.toLowerCase();"draw"===s&&void 0!==tH[t]&&De()};return window.addEventListener("keydown",e),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",a)}},[s,n.notes,t.scrollX,t.channelIndex,t.gridDivision,_,T,Xe,ze,Ge,We,qe,Ke,$e,Ye,Je,Qe,w,V,E,Ee,we,ke,De,q,K,$,J]);const Ze=l.useMemo(()=>t.showVelocityLane?ae-80:ae,[ae,t.showVelocityLane]),et=l.useMemo(()=>Object.entries(TO).map(([e,t])=>({value:e,label:t.name})),[]);return Yn.jsxDEV("div",{ref:se,className:"flex flex-col h-full w-full bg-dark-bgSecondary",role:"application","aria-label":"Piano roll editor",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-dark-border bg-dark-bgTertiary shrink-0 flex-wrap",children:[Yn.jsxDEV("div",{className:"flex items-center bg-dark-bg rounded-md p-0.5",role:"toolbar","aria-label":"Editing tools",children:[Yn.jsxDEV("button",{onClick:()=>E("select"),className:"p-1.5 rounded transition-colors "+("select"===s?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Select tool (1) - Click notes to select, drag to move/resize, click empty space for selection box","aria-pressed":"select"===s,children:Yn.jsxDEV(Cn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:975,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:967,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>E("draw"),className:"p-1.5 rounded transition-colors "+("draw"===s?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Draw tool (2) - Click empty space to add notes, drag to paint multiple notes","aria-pressed":"draw"===s,children:Yn.jsxDEV(xn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:985,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:977,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>E("erase"),className:"p-1.5 rounded transition-colors "+("erase"===s?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Erase tool (3) - Click notes to delete them, drag to erase multiple","aria-pressed":"erase"===s,children:Yn.jsxDEV(Vn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:995,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:987,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:966,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-px h-4 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:999,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV("span",{className:"text-[10px] text-text-muted",children:"H"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1003,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>r(.8*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out horizontally",children:Yn.jsxDEV(Pn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1005,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1004,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted w-6 text-center",children:Math.round(t.horizontalZoom)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1007,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>r(1.25*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in horizontally",children:Yn.jsxDEV(_n,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1009,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1008,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1002,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV("span",{className:"text-[10px] text-text-muted",children:"V"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1015,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>i(t.verticalZoom-2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out vertically",children:Yn.jsxDEV(xt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1017,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1016,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted w-10 text-center",title:`${ve} octaves visible`,children:[ve,"oct"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1019,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>i(t.verticalZoom+2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in vertically",children:Yn.jsxDEV(yt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1023,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1022,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1014,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-px h-4 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1027,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("button",{onClick:()=>u(!t.snapToGrid),className:"p-1 rounded transition-colors "+(t.snapToGrid?"text-accent-primary":"text-text-muted"),title:"Snap to grid","aria-pressed":t.snapToGrid,children:Yn.jsxDEV(ut,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1037,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1031,columnNumber:11},void 0),Yn.jsxDEV("select",{value:t.gridDivision,onChange:e=>d(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Grid division","aria-label":"Grid division",children:[Yn.jsxDEV("option",{value:1,children:"1/1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1046,columnNumber:13},void 0),Yn.jsxDEV("option",{value:2,children:"1/2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1047,columnNumber:13},void 0),Yn.jsxDEV("option",{value:4,children:"1/4"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1048,columnNumber:13},void 0),Yn.jsxDEV("option",{value:8,children:"1/8"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1049,columnNumber:13},void 0),Yn.jsxDEV("option",{value:16,children:"1/16"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1050,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1039,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1030,columnNumber:9},void 0),Yn.jsxDEV("select",{value:t.noteLengthPreset,onChange:e=>v(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Note length","aria-label":"Note length preset",children:KM.map(e=>Yn.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1063,columnNumber:13},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1055,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-px h-4 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1067,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV(_e,{size:12,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1071,columnNumber:11},void 0),Yn.jsxDEV("select",{value:t.scaleRoot,onChange:e=>b(Number(e.target.value)),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary w-10",title:"Root note","aria-label":"Scale root note",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((e,t)=>Yn.jsxDEV("option",{value:t,children:e},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1080,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1072,columnNumber:11},void 0),Yn.jsxDEV("select",{value:t.scaleKey,onChange:e=>g(e.target.value),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Scale","aria-label":"Scale type",children:et.map(e=>Yn.jsxDEV("option",{value:e.value,children:e.label},e.value,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1091,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1083,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1070,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-px h-4 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1096,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>m(!t.showVelocity),className:"p-1 rounded transition-colors "+(t.showVelocity?"text-accent-primary":"text-text-muted"),title:"Show velocity bars on notes","aria-pressed":t.showVelocity,children:t.showVelocity?Yn.jsxDEV(Pt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1105,columnNumber:32},void 0):Yn.jsxDEV(Vt,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1105,columnNumber:52},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1099,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>p(!t.showVelocityLane),className:"p-1 rounded transition-colors "+(t.showVelocityLane?"text-accent-primary":"text-text-muted"),title:"Velocity editor lane - click/drag bars to edit velocity, scroll wheel to adjust","aria-pressed":t.showVelocityLane,children:Yn.jsxDEV(At,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1113,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1107,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>f(!t.multiChannel),className:"p-1 rounded transition-colors "+(t.multiChannel?"text-accent-primary":"text-text-muted"),title:"Show all channels simultaneously - notes colored by instrument","aria-pressed":t.multiChannel,children:Yn.jsxDEV(Dn,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1123,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1117,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-px h-4 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1126,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>ie(!0),className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-text-primary rounded transition-colors",title:"Generate 303 acid pattern",children:[Yn.jsxDEV(Nt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1134,columnNumber:11},void 0),"Acid"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1129,columnNumber:9},void 0),!t.multiChannel&&void 0===e&&O&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"w-px h-4 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1141,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1.5",children:[Yn.jsxDEV("span",{className:"text-xs text-text-muted",children:"CH"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1143,columnNumber:15},void 0),Yn.jsxDEV("select",{value:t.channelIndex,onChange:e=>h(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary","aria-label":"Channel",children:O.channels.map((e,t)=>Yn.jsxDEV("option",{value:t,children:[String(t+1).padStart(2,"0")," ",e.name?`- ${e.name}`:""]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1151,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1144,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1142,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1140,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1161,columnNumber:9},void 0),Yn.jsxDEV("span",{className:"text-xs text-text-muted",children:[_.length," notes",n.notes.size>0&&` (${n.notes.size} sel)`,o&&` | clip:${o.notes.length}`]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1162,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-px h-4 bg-dark-border"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1168,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{LN.getState().pianoRollPoppedOut?FU("DEViLBOX  Piano Roll"):LN.getState().setPianoRollPoppedOut(!0)},className:"p-1 rounded transition-colors text-text-muted hover:text-cyan-400",title:"Pop out to separate window",children:Yn.jsxDEV(He,{size:14},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1183,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1171,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:964,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:[Yn.jsxDEV("div",{className:"flex-1 flex w-full overflow-hidden min-h-0",children:[Yn.jsxDEV(AG,{verticalZoom:t.verticalZoom,scrollY:t.scrollY,visibleNotes:be,containerHeight:Ze,activeNotes:ye,scaleNotes:xe,dragTargetMidi:Ne,onNotePreview:ke,onNoteRelease:De},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1191,columnNumber:11},void 0),Yn.jsxDEV(GG,{notes:_,patternLength:ue,horizontalZoom:t.horizontalZoom,verticalZoom:t.verticalZoom,scrollX:t.scrollX,scrollY:t.scrollY,gridDivision:t.gridDivision,showVelocity:t.showVelocity,selectedNotes:n.notes,playheadRow:Z?ee:null,containerHeight:Ze,scaleNotes:xe,tool:s,onNoteSelect:Se,onNoteDragStart:Me,onGridClick:Ce,onGridRightClick:Pe,onScroll:je,onSelectionBoxStart:Te,onNoteErase:Oe,onGridDraw:Ve},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1204,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1189,columnNumber:9},void 0),t.showVelocityLane&&Yn.jsxDEV("div",{className:"flex w-full shrink-0",children:[Yn.jsxDEV("div",{className:"shrink-0",style:{width:72}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1232,columnNumber:13},void 0)," ",Yn.jsxDEV(WG,{notes:_,horizontalZoom:t.horizontalZoom,scrollX:t.scrollX,selectedNotes:n.notes,onBeginDrag:U,onDragVelocity:R,onDragMultiVelocity:j,onEndDrag:X,onAdjustVelocity:J},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1233,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1231,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1188,columnNumber:7},void 0),Yn.jsxDEV($G,{onCopy:Xe,onCut:ze,onPaste:Ge,onDelete:We,onSelectAll:qe,onQuantize:Ke,onToggleSlide:$e,onToggleAccent:Ye,onSetVelocity:e=>z(Array.from(n.notes),e),hasSelection:n.notes.size>0,hasClipboard:null!==o,selectionVelocity:n.notes.size>0?Math.round(_.filter(e=>n.notes.has(e.id)).reduce((e,t)=>e+t.velocity,0)/Math.max(1,_.filter(e=>n.notes.has(e.id)).length)):void 0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1249,columnNumber:7},void 0),re&&Yn.jsxDEV(ZO,{channelIndex:e??t.channelIndex,onClose:()=>ie(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:1275,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRoll.tsx",lineNumber:962,columnNumber:5},void 0)},sH=Object.freeze(Object.defineProperty({__proto__:null,PianoRoll:nH,default:nH},Symbol.toStringTag,{value:"Module"}));a.memo(({verticalZoom:e,scrollY:t,visibleNotes:n,containerHeight:s,activeNotes:a=new Set,scaleNotes:o,onNoteClick:r,onNotePreview:i,onNoteRelease:c})=>{const u=l.useCallback(e=>{i?.(e),r?.(e)},[r,i]),d=l.useCallback(()=>{c?.()},[c]),m=l.useMemo(()=>{const e=[],s=Math.min(127,t+n),a=Math.max(0,t);for(let t=s;t>=a;t--){const n=t%12,s=!o||o.has(n);e.push({midiNote:t,isBlack:qM(t),name:WM(t),inScale:s})}return e},[t,n,o]);return Yn.jsxDEV("div",{className:"flex flex-col bg-gray-900 border-r border-dark-border overflow-hidden shrink-0",style:{width:48,height:s||"auto"},role:"group","aria-label":"Piano keyboard",children:m.map(({midiNote:t,isBlack:n,name:s,inScale:o})=>{const r=t%12==0,i=a.has(t),l=!o,c=n?"66%":"100%";return Yn.jsxDEV("div",{className:`\n              flex items-center justify-end pr-1 text-[9px] font-mono cursor-pointer\n              select-none border-b transition-all duration-75 shrink-0\n              ${i?"bg-accent-primary text-text-inverse border-accent-primary brightness-110 shadow-lg":n?"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700 "+(l?"opacity-40":""):"bg-white text-gray-700 border-border hover:bg-gray-100 "+(l?"opacity-40":"")}\n              ${r?"font-bold":""}\n            `,style:{height:e,width:c,transform:i?"translateX(2px)":"translateX(0)"},onMouseDown:()=>u(t),onMouseUp:d,onMouseLeave:d,title:s,role:"button","aria-label":`Play ${s}`,"aria-pressed":i,children:r?s:""},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoKeyboard.tsx",lineNumber:82,columnNumber:11},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoKeyboard.tsx",lineNumber:66,columnNumber:5},void 0)});const aH=a.memo(({note:e,horizontalZoom:t,verticalZoom:n,scrollX:s,scrollY:a,isSelected:o,showVelocity:r,isGhost:i=!1,onSelect:c,onDragStart:u})=>{const d=(e.startRow-s)*t,m=(e.endRow-e.startRow)*t,p=(a+60-e.midiNote)*n,h=l.useCallback(t=>{if(i)return;t.stopPropagation();const n=t.currentTarget.getBoundingClientRect(),s=t.clientX-n.left>m-8;c?.(e.id,t.shiftKey||t.ctrlKey||t.metaKey),u&&u(e.id,s?"resize-end":"move",t)},[e.id,m,i,c,u]);if(d+m<-50||d>3e3||p<-50||p>2e3)return null;const f=e.velocity/127*100,g=["bg-cyan-500","bg-purple-500","bg-green-500","bg-amber-500","bg-pink-500","bg-blue-500","bg-red-500","bg-teal-500"],b=g[e.channelIndex%g.length],v=m>30&&n>=10,y=WM(e.midiNote);return i?Yn.jsxDEV("div",{className:`absolute rounded-sm pointer-events-none ${b}`,style:{left:d,top:p,width:Math.max(4,m-1),height:n-1,opacity:.3,border:"1px dashed rgba(255,255,255,0.5)"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/NoteBlock.tsx",lineNumber:90,columnNumber:7},void 0):Yn.jsxDEV("div",{className:`\n        absolute rounded-sm cursor-move select-none\n        ${b}\n        ${o?"ring-2 ring-accent-primary ring-opacity-100 brightness-125 z-10":"ring-1 ring-black/30"}\n        hover:brightness-125 hover:ring-accent-primary/50 hover:z-20\n        transition-all duration-75\n        shadow-md hover:shadow-lg\n      `,style:{left:d,top:p,width:Math.max(4,m-1),height:n-1,opacity:.8+e.velocity/127*.2},onMouseDown:h,title:`${y} vel:${e.velocity}${e.slide?" [SLIDE]":""}${e.accent?" [ACCENT]":""}`,role:"button","aria-label":`Note ${y}, velocity ${e.velocity}${e.slide?", slide":""}${e.accent?", accent":""}`,tabIndex:0,children:[v&&Yn.jsxDEV("span",{className:"absolute left-1 top-0 text-[8px] text-white/80 font-mono leading-none pointer-events-none",style:{lineHeight:n-1+"px"},children:y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/NoteBlock.tsx",lineNumber:129,columnNumber:9},void 0),r&&m>20&&Yn.jsxDEV("div",{className:"absolute bottom-0 left-0 right-0 bg-black/30 pointer-events-none",style:{height:100-f+"%"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/NoteBlock.tsx",lineNumber:138,columnNumber:9},void 0),e.slide&&Yn.jsxDEV("div",{className:"absolute top-0 right-3 w-1.5 h-full bg-yellow-400/60 pointer-events-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/NoteBlock.tsx",lineNumber:146,columnNumber:9},void 0),e.accent&&Yn.jsxDEV("div",{className:"absolute top-0 left-0 w-0 h-0 pointer-events-none",style:{borderLeft:"6px solid rgba(255,100,0,0.8)",borderBottom:"6px solid transparent"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/NoteBlock.tsx",lineNumber:151,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-white/30 transition-colors"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/NoteBlock.tsx",lineNumber:160,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/NoteBlock.tsx",lineNumber:105,columnNumber:5},void 0)});a.memo(({notes:e,patternLength:t,horizontalZoom:n,verticalZoom:s,scrollX:o,scrollY:r,gridDivision:i,showVelocity:c,selectedNotes:u,playheadRow:d,containerHeight:m,scaleNotes:p,onNoteSelect:h,onNoteDragStart:f,onGridClick:g,onGridRightClick:b,onScroll:v,onSelectionBoxStart:y})=>{const x=l.useRef(null),N=$M(e=>e.ghostNotes),w=$M(e=>e.drag),[E,k]=a.useState(800);a.useEffect(()=>{const e=()=>{x.current&&k(x.current.clientWidth)};e();const t=new ResizeObserver(e);return x.current&&t.observe(x.current),()=>t.disconnect()},[]);const D=l.useMemo(()=>Math.ceil(E/n)+2,[n,E]),S=l.useMemo(()=>{const e=m||400;return Math.ceil(e/s)+2},[s,m]),M=l.useCallback(e=>{e.preventDefault();const t=e.shiftKey?e.deltaY:e.deltaX,a=e.shiftKey?0:e.deltaY;v(t/n,-a/s)},[n,s,v]),C=l.useCallback(e=>{if(!x.current)return;if(2===e.button)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,i=e.clientY-t.top,l=Math.floor(a/n)+o,c=r+60-Math.floor(i/s);g(Math.max(0,l),Math.max(0,Math.min(127,c)))},[n,s,o,r,g]),V=l.useCallback(e=>{if(e.preventDefault(),!x.current)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,i=e.clientY-t.top,l=Math.floor(a/n)+o,c=r+60-Math.floor(i/s);b(Math.max(0,l),Math.max(0,Math.min(127,c)),e.clientX,e.clientY)},[n,s,o,r,b]),P=l.useCallback(e=>{if(!x.current||0!==e.button)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,i=e.clientY-t.top,l=Math.floor(a/n)+o,c=r+60-Math.floor(i/s);y(Math.max(0,l),Math.max(0,Math.min(127,c)),e)},[n,s,o,r,y]),_=l.useMemo(()=>{const e=[],a=t*n,l=Math.max(E,a),c=Math.floor(o),u=Math.ceil(o+D),d=4/i,m=Math.max(u,Math.ceil(E/n+o));for(let s=c;s<=m;s++){const a=(s-o)*n,r=s%4==0,i=s%16==0,l=s>t;(s%d===0||r||i)&&e.push(Yn.jsxDEV("div",{className:"absolute top-0 bottom-0 "+(l?"bg-gray-700/20":i?"bg-gray-500/50":r?"bg-gray-600/40":"bg-gray-700/30"),style:{left:a,width:1}},`v-${s}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:183,columnNumber:9},void 0))}for(let t=0;t<S;t++){const n=r+60-t;if(n<0||n>127)continue;const a=t*s,o=n%12==0,i=qM(n),c=n%12,u=p&&!p.has(c);e.push(Yn.jsxDEV("div",{className:`absolute left-0 ${u?"bg-gray-900/70":i?"bg-gray-800/50":"bg-gray-900/30"} ${o?"border-t border-gray-500/50":""}`,style:{top:a,height:s,width:l}},`h-${n}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:211,columnNumber:9},void 0))}return e},[o,r,n,s,t,D,S,i,E,p]),O=null!==d?(d-o)*n:null,T=$M(e=>e.tool),L="draw"===T?"cursor-crosshair":"erase"===T?"cursor-not-allowed":"cursor-default",[A,B]=l.useState(null);l.useEffect(()=>{"select-box"===w.mode&&w.isDragging&&x.current&&B(x.current.getBoundingClientRect())},[w.mode,w.isDragging]);const I=l.useMemo(()=>{if("select-box"!==w.mode||!w.isDragging)return null;if(!A)return null;return{left:Math.min(w.startX,w.currentX)-A.left,top:Math.min(w.startY,w.currentY)-A.top,width:Math.abs(w.currentX-w.startX),height:Math.abs(w.currentY-w.startY)}},[w,A]);return Yn.jsxDEV("div",{ref:x,className:`flex-1 w-full h-full relative overflow-hidden bg-gray-900 ${L}`,onWheel:M,onClick:C,onContextMenu:V,onMouseDown:P,role:"grid","aria-label":"Piano roll note grid",children:[Yn.jsxDEV("div",{className:"absolute inset-0 pointer-events-none",children:_},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:272,columnNumber:7},void 0),N.map(e=>Yn.jsxDEV(aH,{note:e,horizontalZoom:n,verticalZoom:s,scrollX:o,scrollY:r,isSelected:!1,showVelocity:!1,isGhost:!0},`ghost-${e.id}`,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:278,columnNumber:9},void 0)),e.map(e=>Yn.jsxDEV(aH,{note:e,horizontalZoom:n,verticalZoom:s,scrollX:o,scrollY:r,isSelected:u.has(e.id),showVelocity:c,onSelect:h,onDragStart:f},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:293,columnNumber:9},void 0)),I&&Yn.jsxDEV("div",{className:"absolute border-2 border-accent-primary/60 bg-accent-primary/10 pointer-events-none z-20",style:I},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:309,columnNumber:9},void 0),null!==O&&O>=0&&Yn.jsxDEV("div",{className:"absolute top-0 bottom-0 w-0.5 bg-accent-primary pointer-events-none z-10",style:{left:O}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:317,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"absolute top-0 bottom-0 w-1 bg-red-500/50 pointer-events-none",style:{left:(t-o)*n}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:324,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/PianoRollGrid.tsx",lineNumber:261,columnNumber:5},void 0)});a.memo(({notes:e,horizontalZoom:t,scrollX:n,selectedNotes:s,onBeginDrag:a,onDragVelocity:o,onDragMultiVelocity:r,onEndDrag:i})=>{const c=l.useRef(null),[u,d]=l.useState(null),[m,p]=l.useState(null),h=l.useCallback(e=>{const t=Math.round(127*(1-e/80));return Math.max(1,Math.min(127,t))},[]),f=l.useCallback((e,t)=>{if(t.preventDefault(),t.stopPropagation(),d(e),a(),!c.current)return;const n=c.current.getBoundingClientRect(),i=t.clientY-n.top,l=h(i);s.has(e)&&s.size>1?r(Array.from(s),l):o(e,l)},[s,a,o,r,h]),g=l.useCallback(e=>{if(!u||!c.current)return;const t=c.current.getBoundingClientRect(),n=e.clientY-t.top,a=h(n);s.has(u)&&s.size>1?r(Array.from(s),a):o(u,a)},[u,s,o,r,h]),b=l.useCallback(()=>{u&&i(),d(null)},[u,i]),v=l.useMemo(()=>e.map(e=>{const a=(e.startRow-n)*t,o=(e.endRow-e.startRow)*t;if(a+o<0||a>2e3)return null;const r=e.velocity/127*80,i=s.has(e.id),l=m===e.id,c=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6"],u=c[e.channelIndex%c.length];return Yn.jsxDEV("div",{className:"absolute bottom-0 cursor-ns-resize",style:{left:a,width:Math.max(3,o-1),height:r,backgroundColor:u,opacity:i?1:l?.9:.7,border:i?"1px solid #facc15":"none",borderRadius:"2px 2px 0 0",transition:"opacity 75ms"},onMouseDown:t=>f(e.id,t),onMouseEnter:()=>p(e.id),onMouseLeave:()=>p(null),title:`Velocity: ${e.velocity}`},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/VelocityLane.tsx",lineNumber:105,columnNumber:9},void 0)}).filter(Boolean),[e,t,n,s,m,f]),y=l.useMemo(()=>{const e=[];return[32,64,96,127].forEach(t=>{const n=80-t/127*80;e.push(Yn.jsxDEV("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:n},children:[Yn.jsxDEV("div",{className:"border-t border-gray-700/40 w-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/VelocityLane.tsx",lineNumber:134,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"absolute left-1 text-[8px] text-text-muted/40 -translate-y-full",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/VelocityLane.tsx",lineNumber:135,columnNumber:11},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/VelocityLane.tsx",lineNumber:133,columnNumber:9},void 0))}),e},[]);return Yn.jsxDEV("div",{ref:c,className:"relative bg-gray-900/80 border-t border-dark-border overflow-hidden shrink-0",style:{height:80},onMouseMove:g,onMouseUp:b,onMouseLeave:b,children:[y,Yn.jsxDEV("div",{className:"absolute top-1 left-1 text-[9px] text-text-muted/50 pointer-events-none z-10",children:"VEL"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/VelocityLane.tsx",lineNumber:155,columnNumber:7},void 0),v]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/pianoroll/VelocityLane.tsx",lineNumber:143,columnNumber:5},void 0)});const oH=({curve:e,parameter:t,patternLength:n,onChange:s})=>{const a=l.useRef(null),o=l.useRef(null),[r]=l.useState("pencil"),[i,c]=l.useState(!1),[u,d]=l.useState(null),[m,p]=l.useState(800),h=200,f=35,g=10,b="cyan-lineart"===JD(e=>e.currentThemeId),v=b?"#00ffff":"#00d4aa",y=b?"#00ffff":"#7c3aed",x=b?"rgba(0, 255, 255, 0.3)":"rgba(0, 212, 170, 0.3)",N=b?"#0a2020":"#1a1a1d",w=b?"#0f3030":"#252528",E=b?"#030808":"#0a0a0b",k=b?"#00a0a0":"#606068";l.useEffect(()=>{const e=a.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e)p(t.contentRect.width)});return t.observe(e),p(e.clientWidth),()=>t.disconnect()},[]);const D=m-f-10,S=165,M=l.useCallback(e=>f+e/n*D,[n,D]),C=l.useCallback(e=>g+(1-e)*S,[S]),V=l.useCallback(e=>{const t=(e-f)/D;return Math.round(t*n)},[n,D]),P=l.useCallback(e=>{const t=1-(e-g)/S;return Math.max(0,Math.min(1,t))},[S]),_=l.useCallback(()=>{const t=o.current;if(!t)return;const s=t.getContext("2d");if(s){s.fillStyle=E,s.fillRect(0,0,m,h);for(let e=0;e<=n;e++){const t=M(e),a=e%16==0,o=e%4==0;s.strokeStyle=a?w:N,s.lineWidth=a?1.5:.5,(n<=64||o)&&(s.beginPath(),s.moveTo(t,g),s.lineTo(t,175),s.stroke()),a&&e<n&&(s.fillStyle=k,s.font="9px JetBrains Mono, monospace",s.textAlign="center",s.fillText(e.toString(),t,192))}s.strokeStyle=N,s.lineWidth=.5;for(let e=0;e<=4;e++){const t=g+e/4*S,n=2===e;s.strokeStyle=n?w:N,s.lineWidth=n?1:.5,s.beginPath(),s.moveTo(f,t),s.lineTo(m-10,t),s.stroke()}if(s.fillStyle=k,s.font="9px JetBrains Mono, monospace",s.textAlign="right",s.fillText("1.0",30,14),s.fillText("0.5",30,95.5),s.fillText("0.0",30,178),e.points.length>0){const t=s.createLinearGradient(f,0,m-10,0);t.addColorStop(0,v),t.addColorStop(1,y),s.strokeStyle=t,s.lineWidth=2,s.beginPath();const n=[...e.points].sort((e,t)=>e.row-t.row);n.forEach((t,a)=>{const o=M(t.row),r=C(t.value);if(0===a)s.moveTo(o,r);else if("linear"===e.interpolation)s.lineTo(o,r);else if("exponential"===e.interpolation){const e=n[a-1],t=M(e.row),i=t+.5*(o-t),l=C(e.value);s.quadraticCurveTo(i,l,o,r)}}),s.stroke(),n.forEach((e,t)=>{const n=M(e.row),a=C(e.value);t===u&&(s.fillStyle=x,s.beginPath(),s.arc(n,a,10,0,2*Math.PI),s.fill()),s.fillStyle=t===u?v:y,s.beginPath(),s.arc(n,a,5,0,2*Math.PI),s.fill(),s.fillStyle="#ffffff",s.beginPath(),s.arc(n,a,2,0,2*Math.PI),s.fill()})}}},[e,n,u,M,C,v,y,x,m,E,N,w,k,D,S]);l.useEffect(()=>{_()},[_]);const[O,T]=l.useState(!1),L=()=>{c(!1),T(!1)},A=l.useCallback(t=>{if(("Delete"===t.key||"Backspace"===t.key)&&null!==u){const t=e.points.filter((e,t)=>t!==u);s({...e,points:t}),d(null)}},[u,e,s]);l.useEffect(()=>(window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)),[A]);const B=(t,a)=>{if(t<0||t>n)return;const o=[...e.points],r=o.findIndex(e=>e.row===t);r>=0?o[r].value=a:o.push({row:t,value:a}),s({...e,points:o.sort((e,t)=>e.row-t.row)})},I=t=>{const a=[];for(let e=0;e<=n;e+=4){let s=0;switch(t){case"rampUp":s=e/n;break;case"rampDown":s=1-e/n;break;case"triangle":s=e<n/2?e/n*2:2-e/n*2;break;case"sine":s=(Math.sin(e/n*Math.PI*2-Math.PI/2)+1)/2;break;case"saw":s=e%(n/4)/(n/4);break;case"square":s=e<n/2?1:0;break;case"random":s=Math.random()}a.push({row:e,value:s})}s({...e,points:a})};return Yn.jsxDEV("div",{className:"bg-dark-bg p-4",children:[Yn.jsxDEV("div",{className:"text-accent-primary text-sm font-semibold mb-3",children:t.toUpperCase()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:428,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex gap-2 mb-3 flex-wrap",children:[Yn.jsxDEV("div",{className:"flex gap-1 flex-wrap",children:[Yn.jsxDEV("button",{onClick:()=>I("rampUp"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Up"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:435,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>I("rampDown"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Down"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:441,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>I("triangle"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Triangle"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:447,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>I("sine"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Sine"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:453,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>I("random"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Random"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:459,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:434,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"w-px bg-dark-border mx-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:467,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>{s({...e,points:[]})},className:"px-3 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-accent-error border border-dark-border hover:border-accent-error transition-colors",children:"Clear"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:469,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:433,columnNumber:7},void 0),Yn.jsxDEV("div",{ref:a,className:"w-full",children:Yn.jsxDEV("canvas",{ref:o,width:m,height:h,onMouseDown:t=>{const n=o.current;if(!n)return;const s=n.getBoundingClientRect(),a=n.width/s.width,i=n.height/s.height,l=(t.clientX-s.left)*a,u=(t.clientY-s.top)*i,m=V(l),p=P(u),h=e.points.findIndex(e=>{const t=M(e.row),n=C(e.value);return Math.hypot(t-l,n-u)<15});if(h>=0)return d(h),void T(!0);"pencil"===r?(c(!0),B(m,p)):"select"===r&&d(null)},onMouseMove:t=>{const a=o.current;if(!a)return;const l=a.getBoundingClientRect(),c=a.width/l.width,m=a.height/l.height,p=(t.clientX-l.left)*c,h=(t.clientY-l.top)*m,f=V(p),g=P(h);if(O&&null!==u){const t=[...e.points],a=Math.max(0,Math.min(n,f));t[u]={row:a,value:g};const o=t.sort((e,t)=>e.row-t.row),r=o.findIndex(e=>e.row===a&&Math.abs(e.value-g)<.001);s({...e,points:o}),r>=0&&r!==u&&d(r)}else"pencil"===r&&i&&B(f,g)},onMouseUp:L,onMouseLeave:L,onContextMenu:t=>{t.preventDefault();const n=o.current;if(!n)return;const a=n.getBoundingClientRect(),r=n.width/a.width,i=n.height/a.height,l=(t.clientX-a.left)*r,c=(t.clientY-a.top)*i,u=e.points.findIndex(e=>{const t=M(e.row),n=C(e.value);return Math.hypot(t-l,n-c)<15});if(u>=0){const t=e.points.filter((e,t)=>t!==u);s({...e,points:t}),d(null)}},className:"w-full rounded-lg border border-dark-border "+(O?"cursor-grabbing":"cursor-crosshair"),style:{height:h},tabIndex:0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:479,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:478,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"mt-3 flex gap-2 items-center",children:[Yn.jsxDEV("span",{className:"text-text-muted text-xs",children:"Interpolation:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:498,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>s({...e,interpolation:"linear"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("linear"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Linear"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:499,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>s({...e,interpolation:"exponential"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("exponential"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Exponential"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:509,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:497,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationCurve.tsx",lineNumber:427,columnNumber:5},void 0)},rH=()=>{const{patterns:e,currentPatternIndex:t}=ID(),{getAutomation:n,setAutomation:s,setActiveParameter:a,setShowLane:o}=XD(),[r,i]=l.useState(null),[c,u]=l.useState(0),d="cyan-lineart"===JD(e=>e.currentThemeId),m=d?"bg-cyan-500/20":"bg-orange-500/20",p=d?"text-cyan-400":"text-orange-400",h=d?"border-cyan-500":"border-orange-500",f=d?"hover:bg-cyan-500/30":"hover:bg-orange-500/30",g=d?"bg-cyan-500":"bg-orange-500",b=e[t],v=b?.channels.length||4,y=Math.min(c,v-1),{groups:x,instrumentName:N}=qV(y);if(l.useEffect(()=>{if(0===x.length)return;const e=x.flatMap(e=>e.params.map(e=>e.key));r&&e.includes(r)||requestAnimationFrame(()=>i(e[0]))},[x,r]),!b)return Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:44,columnNumber:7},void 0);const w=r??x[0]?.params[0]?.key??"tb303.cutoff",E=n(b.id,y,w);return Yn.jsxDEV("div",{className:"flex-1 flex flex-col overflow-hidden bg-dark-bg",children:[Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-b border-dark-border px-4 py-3",children:Yn.jsxDEV("div",{className:"flex items-center justify-between",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3",children:[Yn.jsxDEV("span",{className:"text-text-secondary text-sm",children:"Automation"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:69,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-text-primary font-medium",children:["Pattern ",String(t).padStart(2,"0"),": ",b.name]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:70,columnNumber:13},void 0),N&&Yn.jsxDEV("span",{className:"text-text-muted text-xs",children:["(",N,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:74,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:68,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-text-muted text-xs",children:"Channel:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:80,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex gap-1",children:Array.from({length:v},(e,t)=>{const n=b.channels[t];return Yn.jsxDEV("button",{onClick:()=>u(t),className:`\n                      w-8 h-7 text-xs font-mono rounded border transition-all\n                      ${y===t?"text-text-inverse border-transparent":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"}\n                    `,style:y===t?{backgroundColor:n?.color||"#22c55e"}:void 0,title:n?.name||`Channel ${t+1}`,children:t+1},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:85,columnNumber:19},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:81,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:79,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:67,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:66,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"border-b border-dark-border bg-dark-bgSecondary p-3",children:x.length>0?Yn.jsxDEV("div",{className:"flex gap-6 flex-wrap",children:x.map(e=>Yn.jsxDEV("div",{className:"flex flex-col gap-1.5",children:[Yn.jsxDEV("div",{className:"text-text-muted text-[10px] font-medium uppercase tracking-wider",children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:113,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex gap-1.5 flex-wrap",children:e.params.map(e=>{const t=n(b.id,y,e.key).points.length>0,s=w===e.key;return Yn.jsxDEV("button",{onClick:()=>{i(e.key),a(y,e.key),o(y,!0)},className:`\n                          relative px-3 py-1.5 text-xs rounded-md border transition-all duration-150\n                          ${s?"bg-accent-primary text-text-inverse border-accent-primary shadow-glow-sm":t?`${m} ${p} ${h} ${f}`:"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight hover:text-text-primary"}\n                        `,title:e.name+(t?" (has automation)":""),children:[e.name,t&&!s&&Yn.jsxDEV("span",{className:`absolute -top-1 -right-1 w-2 h-2 ${g} rounded-full`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:144,columnNumber:27},void 0)]},e.key,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:123,columnNumber:23},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:116,columnNumber:17},void 0)]},e.label,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:112,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:110,columnNumber:11},void 0):Yn.jsxDEV("div",{className:"text-text-muted text-xs",children:"No instrument assigned to this channel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:154,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:108,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:Yn.jsxDEV(oH,{curve:E,parameter:w,patternLength:b.length,onChange:e=>{s(b.id,y,w,e),a(y,w),e.points.length>0&&o(y,!0)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:162,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:161,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/automation/AutomationPanel.tsx",lineNumber:64,columnNumber:5},void 0)},iH=Object.freeze(Object.defineProperty({__proto__:null,AutomationPanel:rH},Symbol.toStringTag,{value:"Module"})),lH=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function cH(e){if(!e)return"---";if(97===e)return"===";const t=e-1;return lH[t%12]+Math.floor(t/12)}const uH=()=>{const e=ID(e=>e.channelTrackTables),t=ID(e=>e.patterns),n=ID(e=>e.currentPositionIndex),s=jN(e=>e.currentRow),a=l.useRef(null);if(l.useEffect(()=>{if(!a.current)return;const e=a.current,t=18*s-e.clientHeight/2+9;e.scrollTop=Math.max(0,t)},[s]),!e||0===e.length)return Yn.jsxDEV("div",{className:"flex items-center justify-center h-full text-text-muted text-xs",children:"No channel data"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:46,columnNumber:7},void 0);const o=e.map(e=>{const s=e[n]??0;return t[s]??null}),r=o[0]?.length??128,i=Array.from({length:r},(e,t)=>t);return Yn.jsxDEV("div",{ref:a,style:{width:"100%",height:"100%",overflowY:"auto",overflowX:"auto",fontFamily:"monospace",fontSize:12,lineHeight:"18px",backgroundColor:"#0d0d0d",color:"#888"},children:[Yn.jsxDEV("div",{style:{position:"sticky",top:0,zIndex:10,display:"flex",backgroundColor:"#1a1a1a",borderBottom:"1px solid #333",height:20,alignItems:"center"},children:[Yn.jsxDEV("span",{style:{width:36,flexShrink:0,textAlign:"right",paddingRight:6,color:"#555"},children:"ROW"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:91,columnNumber:9},void 0),e.map((e,s)=>{const a=e[n]??0,o=t[a];return Yn.jsxDEV("span",{style:{width:80,flexShrink:0,textAlign:"center",color:"#aaa",fontSize:11,letterSpacing:.5},children:["CH",s+1," ",o?`P:${a.toString().padStart(2,"0")}`:"???"]},s,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:98,columnNumber:13},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:78,columnNumber:7},void 0),i.map(e=>{const t=e===s,n=Math.floor(e/4)%2==0;return Yn.jsxDEV("div",{style:{display:"flex",height:18,alignItems:"center",backgroundColor:t?"#1a3a1a":n?"transparent":"#0a0a0a",borderBottom:e%4==3?"1px solid #1e1e1e":void 0},children:[Yn.jsxDEV("span",{style:{width:36,flexShrink:0,textAlign:"right",paddingRight:6,color:e%4==0?"#555":"#333",fontSize:11},children:e.toString().padStart(3,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:135,columnNumber:13},void 0),o.map((n,s)=>{const a=n?.channels[0]?.rows[e],o=a&&a.note>0;return Yn.jsxDEV("span",{style:{width:80,flexShrink:0,display:"flex",gap:2,paddingLeft:4,paddingRight:4,borderLeft:"1px solid #1e1e1e",color:o?t?"#88ff88":"#cccccc":"#333"},children:[Yn.jsxDEV("span",{style:{width:28,letterSpacing:0},children:a?cH(a.note):"---"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:170,columnNumber:19},void 0),Yn.jsxDEV("span",{style:{width:20,color:o&&a.instrument?"#ffaa44":"#333"},children:a?(r=a.instrument,r?r.toString(16).toUpperCase().padStart(2,"0"):"--"):"--"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:173,columnNumber:19},void 0)]},s,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:153,columnNumber:17},void 0);var r})]},e,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:120,columnNumber:11},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/MusicLinePatternViewer.tsx",lineNumber:63,columnNumber:5},void 0)};function dH(e,t,n){let s="";for(let a=0;a<n;a++){const n=e[t+a];if(0===n)break;s+=String.fromCharCode(n)}return s.trim()}function mH(e,t){return e[t]|e[t+1]<<8}function pH(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}async function hH(e){const t=await e.arrayBuffer(),n=new Uint8Array(t),s=function(e){if(e.length>1084){const t=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);if(["M.K.","M!K!","4CHN","6CHN","8CHN","FLT4","FLT8"].includes(t))return"MOD";if(t.match(/^\d\dCH$/))return"MOD"}if(e.length>17&&"Extended Module: "===String.fromCharCode(...e.slice(0,17)))return"XM";if(e.length>48&&26===e[44]&&16===e[45]&&16===e[29])return"S3M";if(e.length>4&&"IMPM"===String.fromCharCode(e[0],e[1],e[2],e[3]))return"IT";return null}(n);if(!s)throw new Error("Unknown or unsupported module format");switch(s){case"MOD":return function(e){const t=dH(e,0,20),n=[],s=[];for(let u=0;u<31;u++){const t=20+30*u,n=dH(e,t,22),a=2*(e[t+22]<<8|e[t+23]),o=15&e[t+24],r=e[t+25],i=2*(e[t+26]<<8|e[t+27]),l=2*(e[t+28]<<8|e[t+29]);s.push({name:n,length:a,fineTune:o,volume:r,loopStart:i,loopLength:l})}const a=e[950],o=e.slice(952,1080);let r=0;for(let u=0;u<a;u++)o[u]>r&&(r=o[u]);const i=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);let l=4;"6CHN"===i?l=6:"8CHN"===i||"FLT8"===i?l=8:i.match(/^\d\dCH$/)&&(l=parseInt(i.substring(0,2),10));let c=1084+64*(r+1)*l*4;for(let u=0;u<31;u++){const t=s[u];if(0===t.length)continue;const a=new Float32Array(t.length);for(let n=0;n<t.length;n++){const t=e[c+n],s=t>127?t-256:t;a[n]=s/128}let o="none";t.loopLength>2&&(o="forward"),n.push({name:t.name||`Sample ${u+1}`,sampleRate:8363,channels:1,bitDepth:8,pcmData:a,loopStart:t.loopStart,loopEnd:t.loopStart+t.loopLength,loopType:o,baseNote:"C-4",fineTune:t.fineTune>7?t.fineTune-16:t.fineTune,volume:t.volume}),c+=t.length}return{samples:n,format:"MOD",title:t}}(n);case"XM":return function(e){const t=dH(e,17,20),n=[],s=pH(e,60),a=mH(e,72);let o=60+s;for(let r=0;r<a&&!(o>=e.length);r++){const t=pH(e,o),s=dH(e,o+4,22),a=mH(e,o+27);if(0===a){o+=t;continue}const r=pH(e,o+29);o+=t;const i=[];for(let n=0;n<a&&!(o+40>e.length);n++)i.push({length:pH(e,o),loopStart:pH(e,o+4),loopLength:pH(e,o+8),volume:e[o+12],fineTune:e[o+13]>127?e[o+13]-256:e[o+13],type:e[o+14],pan:e[o+15],relNote:e[o+16]>127?e[o+16]-256:e[o+16],name:dH(e,o+18,22)}),o+=r;for(let l=0;l<a;l++){const t=i[l];if(0===t.length)continue;const a=!!(16&t.type),r=a?t.length/2:t.length,c=new Float32Array(r);if(a){let n=0;for(let t=0;t<r;t++){const s=mH(e,o+2*t);n+=s>32767?s-65536:s,n>32767&&(n-=65536),n<-32768&&(n+=65536),c[t]=n/32768}o+=t.length}else{let n=0;for(let s=0;s<t.length;s++){const t=e[o+s];n+=t>127?t-256:t,n>127&&(n-=256),n<-128&&(n+=256),c[s]=n/128}o+=t.length}let u="none";1==(3&t.type)?u="forward":2==(3&t.type)&&(u="pingpong"),n.push({name:t.name||s||`Sample ${n.length+1}`,sampleRate:8363,channels:1,bitDepth:a?16:8,pcmData:c,loopStart:a?t.loopStart/2:t.loopStart,loopEnd:a?(t.loopStart+t.loopLength)/2:t.loopStart+t.loopLength,loopType:u,baseNote:"C-4",fineTune:t.fineTune,volume:t.volume})}}return{samples:n,format:"XM",title:t}}(n);case"S3M":return function(e){const t=dH(e,0,28),n=[],s=mH(e,34),a=[];for(let o=0;o<s;o++)a.push(16*mH(e,96+2*o));for(let o=0;o<s;o++){const t=a[o];if(0===t||t>=e.length)continue;if(1!==e[t])continue;const s=dH(e,t+48,28),r=mH(e,t+16)|e[t+18]<<16,i=mH(e,t+20)|e[t+22]<<16,l=mH(e,t+24)|e[t+26]<<16,c=e[t+28],u=e[t+31],d=pH(e,t+32),m=16*(e[t+13]<<16|mH(e,t+14));if(0===r||m>=e.length)continue;const p=!!(4&u),h=!!(1&u),f=r/((p?2:1)*(2&u?2:1)),g=new Float32Array(f);if(p)for(let n=0;n<f;n++){const t=mH(e,m+2*n);g[n]=(t-32768)/32768}else for(let n=0;n<f;n++){const t=e[m+n];g[n]=(t-128)/128}n.push({name:s||`Sample ${o+1}`,sampleRate:d||8363,channels:1,bitDepth:p?16:8,pcmData:g,loopStart:h?p?i/2:i:void 0,loopEnd:h?p?l/2:l:void 0,loopType:h?"forward":"none",baseNote:"C-4",volume:c})}return{samples:n,format:"S3M",title:t}}(n);case"IT":return function(e){const t=dH(e,4,26),n=[],s=mH(e,32),a=mH(e,34),o=mH(e,36),r=192+s+4*a;for(let i=0;i<o;i++){const t=pH(e,r+4*i);if(0===t||t+80>e.length)continue;if("IMPS"!==String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]))continue;const s=e[t+18],a=e[t+46],o=dH(e,t+20,26),l=e[t+19],c=pH(e,t+48),u=pH(e,t+52),d=pH(e,t+56),m=pH(e,t+60),p=pH(e,t+72),h=!!(2&s),f=!!(4&s),g=!!(8&s),b=!!(16&s),v=!!(32&s),y=!!(1&a),x=!!(4&a);if(!(1&s)||0===c||0===p)continue;if(g)continue;if(p+c*(h?2:1)*(f?2:1)>e.length)continue;const N=new Float32Array(c);if(h){let t=0;for(let n=0;n<c;n++){let s=mH(e,p+2*n);x&&(t=t+(s>32767?s-65536:s)&65535,s=t),N[n]=y?(s>32767?s-65536:s)/32768:(s-32768)/32768}}else{let t=0;for(let n=0;n<c;n++){let s=e[p+n];x&&(t=t+(s>127?s-256:s)&255,s=t),N[n]=y?(s>127?s-256:s)/128:(s-128)/128}}let w="none";b&&(w=v?"pingpong":"forward"),n.push({name:o||`Sample ${i+1}`,sampleRate:m||8363,channels:1,bitDepth:h?16:8,pcmData:N,loopStart:b?u:void 0,loopEnd:b?d:void 0,loopType:w,baseNote:"C-5",volume:l})}return{samples:n,format:"IT",title:t}}(n);default:throw new Error(`Unsupported format: ${s}`)}}function fH(e){const{pcmData:t,sampleRate:n,channels:s}=e,a=t.length,o=2*s,r=n*o,i=2*a,l=44+i,c=new ArrayBuffer(l),u=new DataView(c);gH(u,0,"RIFF"),u.setUint32(4,l-8,!0),gH(u,8,"WAVE"),gH(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,s,!0),u.setUint32(24,n,!0),u.setUint32(28,r,!0),u.setUint16(32,o,!0),u.setUint16(34,16,!0),gH(u,36,"data"),u.setUint32(40,i,!0);let d=44;for(let h=0;h<a;h++){const e=Math.max(-1,Math.min(1,t[h])),n=Math.round(32767*e);u.setInt16(d,n,!0),d+=2}const m=new Uint8Array(c);let p="";for(let h=0;h<m.length;h++)p+=String.fromCharCode(m[h]);return`data:audio/wav;base64,${btoa(p)}`}function gH(e,t,n){for(let s=0;s<n.length;s++)e.setUint8(t+s,n.charCodeAt(s))}function bH(e,t){const n=function(e){const t={version:1,name:e.name,rows:e.length,channels:e.channels.length,data:e.channels.map(e=>e.rows)},n=JSON.stringify(t,null,2);return new Blob([n],{type:"application/json"})}(e),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=`${e.name}.xp`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}function vH(e,t,n){const s=t.channels[e];if(!s)throw new Error(`Channel ${e} not found in pattern`);const a=function(e,t){const n=t.channels[e];if(!n)throw new Error(`Channel ${e} not found in pattern`);const s={version:1,name:n.name,rows:t.length,data:n.rows},a=JSON.stringify(s,null,2);return new Blob([a],{type:"application/json"})}(e,t),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download=`${s.name}.xt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}const yH=({className:e="",onPitchChange:t})=>{const n=jN(e=>e.globalPitch),s=jN(e=>e.setGlobalPitch),[a,o]=l.useState(n),[r,i]=l.useState(!1);l.useEffect(()=>{r||o(n)},[n,r]);const c=l.useRef(null),u=l.useRef({startY:0,startPitch:0}),d=l.useRef(0);l.useEffect(()=>{d.current=a},[a]);const m=l.useCallback(e=>{const n=Math.max(-16,Math.min(16,e));o(n),s(n);Ik().setGlobalPitchOffset(n),t?.(n)},[t,s]),p=l.useCallback(()=>{o(0),s(0);Ik().setGlobalPitchOffset(0),t?.(0)},[t,s]),h=l.useCallback(e=>{e.preventDefault(),u.current={startY:e.clientY,startPitch:d.current},i(!0)},[]);l.useEffect(()=>{if(!r)return;const e=e=>{const t=(c.current?.clientHeight??1)-24-8,n=e.clientY-u.current.startY;m(u.current.startPitch-n/t*32)},t=()=>i(!1);return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[r,m]);const f=`calc(4px + ${(16-a)/32} * (100% - 32px))`,g=a>0?`+${a.toFixed(1)}`:a.toFixed(1),b=Math.abs(a)<.05;return Yn.jsxDEV("div",{className:`flex flex-col items-center py-2 gap-1 select-none ${e}`,style:{width:52},children:[Yn.jsxDEV("span",{className:"text-[9px] font-mono text-text-muted uppercase tracking-wider flex-shrink-0",children:"Pitch"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:123,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"text-[10px] font-mono font-bold text-center cursor-pointer flex-shrink-0 transition-colors "+(b?"text-text-muted":"text-amber-400"),onDoubleClick:p,onContextMenu:e=>{e.preventDefault(),p()},title:"Double-click or right-click to reset",children:g},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:128,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"relative flex-1 min-h-0 w-full",children:[Yn.jsxDEV("div",{className:"absolute inset-y-0 z-10 pointer-events-none flex flex-col justify-between py-[4px]",style:{left:0,width:18},children:["+16","","+8","","+4","","0","","-4","","-8","","-16"].map((e,t)=>{const n=""!==e;return Yn.jsxDEV("div",{className:"flex items-center justify-end gap-0",style:{flex:1},children:[n&&Yn.jsxDEV("span",{className:"text-[6px] font-mono leading-none "+("0"===e?"text-amber-400/60":"text-text-muted/40"),children:e},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:149,columnNumber:17},void 0),Yn.jsxDEV("div",{className:`h-px flex-shrink-0 ${n?"w-1.5":"w-1"} ${"0"===e?"bg-amber-400/40":"bg-text-muted/30"}`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:153,columnNumber:15},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:147,columnNumber:13},void 0)})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:143,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"absolute inset-0",children:[Yn.jsxDEV("div",{className:"absolute top-2 bottom-2 left-1/2 w-[3px] -translate-x-px pointer-events-none",style:{background:"rgba(0,0,0,0.75)"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:165,columnNumber:9},void 0),Yn.jsxDEV("div",{ref:c,className:"absolute inset-0 cursor-ns-resize",onMouseDown:h,onContextMenu:e=>{e.preventDefault(),p()}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:171,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"absolute inset-x-1 pointer-events-none",style:{height:24,top:f},children:Yn.jsxDEV("div",{className:"absolute inset-0 rounded-[2px] transition-colors duration-75 border "+(r?"border-amber-400/50":"border-dark-border"),style:{background:r?"linear-gradient(to bottom, #2a2010 0%, #1a1408 50%, #221a0a 100%)":"linear-gradient(to bottom, #1e1b1b 0%, #0e0b0b 50%, #191616 100%)",boxShadow:r?"inset 0 1px 0 rgba(251,191,36,0.15)":"inset 0 1px 0 rgba(255,255,255,0.08)"},children:[Yn.jsxDEV("div",{className:"absolute inset-x-2 h-px",style:{top:5,background:r?"rgba(251,191,36,0.4)":"rgba(255,255,255,0.12)"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:198,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"absolute inset-x-2 h-px",style:{top:"50%",transform:"translateY(-50%)",background:r?"rgba(251,191,36,0.6)":"rgba(255,255,255,0.18)"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:203,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"absolute inset-x-2 h-px",style:{bottom:5,background:r?"rgba(251,191,36,0.4)":"rgba(255,255,255,0.12)"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:208,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:184,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:179,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:160,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:140,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/transport/DJPitchSlider.tsx",lineNumber:118,columnNumber:5},void 0)},xH=a.memo(({height:e})=>{const{patterns:t,currentPatternIndex:n,cursor:s,selection:a}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,cursor:e.cursor,selection:e.selection}))),{isPlaying:o,currentRow:r}=jN(us(e=>({isPlaying:e.isPlaying,currentRow:e.currentRow}))),i=l.useRef(null),c=t[n],u=c?.length??64,d=e/u,m=Math.min(o?r:s.rowIndex,u-1),p=l.useMemo(()=>{if(!c)return new Uint8Array(0);const e=new Uint8Array(u);for(let t=0;t<u;t++){let n=0;for(let e=0;e<c.channels.length;e++){const s=c.channels[e].rows[t];(s.note>0||s.effTyp>0||s.volume>=16)&&n++}e[t]=n}return e},[c,u]),h=l.useCallback(t=>{if(!i.current)return;const n=i.current.getBoundingClientRect(),s=t.clientY-n.top,a=Math.floor(s/e*u),o=Math.max(0,Math.min(u-1,a));ID.getState().moveCursorToRow(o)},[e,u]);if(!c)return null;let f=1;for(let l=0;l<p.length;l++)p[l]>f&&(f=p[l]);return Yn.jsxDEV("div",{ref:i,className:"w-4 bg-neutral-900 border-l border-neutral-700 cursor-pointer flex-shrink-0",style:{height:e},onClick:h,title:"Click to jump to row",children:Yn.jsxDEV("svg",{width:"16",height:e,className:"block","aria-label":"Pattern density minimap",role:"img",children:[Array.from({length:u},(e,t)=>{const n=p[t];if(0===n)return null;const s=t*d,a=n/f*14;return Yn.jsxDEV("rect",{x:1,y:s,width:a,height:Math.max(1,d-.5),fill:t%4==0?"#3b82f6":"#6366f1",opacity:.5},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMinimap.tsx",lineNumber:89,columnNumber:13},void 0)}),a&&(()=>{const e=Math.min(a.startRow,a.endRow),t=Math.max(a.startRow,a.endRow);return Yn.jsxDEV("rect",{x:0,y:e*d,width:16,height:(t-e+1)*d,fill:"#facc15",opacity:.2},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMinimap.tsx",lineNumber:106,columnNumber:13},void 0)})(),Yn.jsxDEV("rect",{x:0,y:m*d,width:16,height:Math.max(2,d),fill:o?"#22c55e":"#ef4444",opacity:.8},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMinimap.tsx",lineNumber:118,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMinimap.tsx",lineNumber:82,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/PatternMinimap.tsx",lineNumber:74,columnNumber:5},void 0)});xH.displayName="PatternMinimap";const NH=()=>{const e=a.useRef(null),[t,n]=a.useState(400);return a.useEffect(()=>{const t=e.current;if(!t)return;const s=new ResizeObserver(e=>{for(const t of e)n(t.contentRect.height)});return s.observe(t),n(t.clientHeight),()=>s.disconnect()},[]),Yn.jsxDEV("div",{ref:e,className:"flex-shrink-0 self-stretch border-l border-ft2-border",children:Yn.jsxDEV(xH,{height:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:312,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:311,columnNumber:5},void 0)},wH=({onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstrumentFX:s,onShowInstruments:a,onShowImportModule:o,onShowDrumpads:r,showMasterFX:i,showInstrumentFX:c,showImportModule:u})=>{const{isMobile:d,width:m}=zV(),{patterns:p,currentPatternIndex:h,showGhostPatterns:f,loadPatterns:g,setPatternOrder:b,setOriginalModuleData:v,setShowGhostPatterns:y,scaleVolume:x,fadeVolume:w,remapInstrument:E,applySystemPreset:k,editorMode:D}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,showGhostPatterns:e.showGhostPatterns,loadPatterns:e.loadPatterns,setPatternOrder:e.setPatternOrder,setOriginalModuleData:e.setOriginalModuleData,setShowGhostPatterns:e.setShowGhostPatterns,scaleVolume:e.scaleVolume,fadeVolume:e.fadeVolume,remapInstrument:e.remapInstrument,applySystemPreset:e.applySystemPreset,editorMode:e.editorMode}))),S=ID(e=>e.cursor.channelIndex),{loadInstruments:M}=EN(us(e=>({loadInstruments:e.loadInstruments}))),{setMetadata:C}=RD(us(e=>({setMetadata:e.setMetadata}))),{setBPM:V,setSpeed:P,smoothScrolling:_,setSmoothScrolling:O,grooveTemplateId:T,swing:L,jitter:A,useMpcScale:B,stop:I}=jN(us(e=>({setBPM:e.setBPM,setSpeed:e.setSpeed,smoothScrolling:e.smoothScrolling,setSmoothScrolling:e.setSmoothScrolling,grooveTemplateId:e.grooveTemplateId,swing:e.swing,jitter:e.jitter,useMpcScale:e.useMpcScale,stop:e.stop}))),{masterMuted:F,toggleMasterMute:U}=UD(us(e=>({masterMuted:e.masterMuted,toggleMasterMute:e.toggleMasterMute}))),R=LN(e=>e.statusMessage),j=LN(e=>e.pendingModuleFile),X=LN(e=>e.setPendingModuleFile),z=LN(e=>e.pendingAudioFile),G=LN(e=>e.setPendingAudioFile),H=LN(e=>e.pendingTD3File),W=LN(e=>e.setPendingTD3File),q=LN(e=>e.pendingSunVoxFile),K=LN(e=>e.setPendingSunVoxFile),$=LN(e=>e.setActiveView),Y=LN(e=>e.dialogOpen),J=LN(e=>e.closeDialogCommand),[Q,Z]=l.useState("tracker"),[ee,te]=l.useState(0),[ne,se]=l.useState(!1),[ae,oe]=l.useState(!1),[re,ie]=l.useState(!1),[le,ce]=l.useState(!1),[ue,de]=l.useState(!1),[me,pe]=l.useState(!1),[he,fe]=l.useState(!1),[ge,be]=l.useState(!1),[ve,ye]=l.useState(!1),[xe,Ne]=l.useState(!1),[we,Ee]=l.useState(!1),[ke,De]=l.useState(!1),[Se,Me]=l.useState(!1),[Ce,Pe]=l.useState("block"),[_e,Te]=l.useState("block"),[Le,Ae]=l.useState(!1),[Be,Ie]=l.useState(0),[Fe,Ue]=l.useState(!1),[Re,je]=l.useState(0),[Xe,ze]=l.useState(!1),Ge=ID(e=>e.channelTrackTables),He=l.useCallback(()=>{if(!d)return;ID.getState().moveCursor("left")},[d]),We=l.useCallback(()=>{if(!d)return;ID.getState().moveCursor("right")},[d]),qe=u??xe,Ke=o??Ne,[$e,Ye]=l.useState(!0),[Je,Qe]=l.useState(!1),[Ze,et]=l.useState(!1);l.useEffect(()=>{if(Y){switch(Y){case"interpolate-volume":case"interpolate-effect":se(!0);break;case"humanize":oe(!0);break;case"find-replace":ie(!0);break;case"groove-settings":ye(!0);break;case"scale-volume-block":Pe("block"),Ee(!0);break;case"scale-volume-track":Pe("track"),Ee(!0);break;case"scale-volume-pattern":Pe("pattern"),Ee(!0);break;case"keyboard-help":ce(!0)}J()}},[Y,J]);const{fps:tt,averageFps:nt,quality:st}=ET();l.useEffect(()=>{"grid"===Q&&requestAnimationFrame(()=>{te(S)})},[Q,S]);const at=l.useCallback(e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return!e.ctrlKey&&!e.metaKey||"i"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"h"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"f"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"o"!==e.key.toLowerCase()||e.shiftKey||e.altKey?"?"!==e.key||e.ctrlKey||e.metaKey||e.altKey?!e.ctrlKey&&!e.metaKey||"e"!==e.key.toLowerCase()||e.shiftKey||e.altKey?(e.ctrlKey||e.metaKey)&&"h"===e.key.toLowerCase()&&e.shiftKey&&!e.altKey?(e.preventDefault(),void fe(e=>!e)):!e.ctrlKey&&!e.metaKey||"m"!==e.key.toLowerCase()||e.shiftKey||e.altKey?void 0:(e.preventDefault(),void be(e=>!e)):(e.preventDefault(),void pe(e=>!e)):(e.preventDefault(),void ce(e=>!e)):(e.preventDefault(),void Ke(!0)):(e.preventDefault(),void ie(!0)):(e.preventDefault(),void oe(!0)):(e.preventDefault(),void se(!0))},[Ke,se,oe,ie]);l.useEffect(()=>(window.addEventListener("keydown",at),()=>window.removeEventListener("keydown",at)),[at]),l.useEffect(()=>{j&&Ke(!0)},[j,Ke]),uT();const ot=dT(),rt=l.useCallback(async(e,t)=>{const{loadFile:n}=await os(async()=>{const{loadFile:e}=await Promise.resolve().then(()=>MZ);return{loadFile:e}},void 0),s=await n(e,{requireConfirmation:!1,replacePatterns:t});!0===s.success?_k.success(s.message):!1===s.success&&_k.error(s.error)},[]),it=l.useCallback(async(e,t)=>{const n=q;K(null);try{if(t.isSong&&n){const{loadFile:e}=await os(async()=>{const{loadFile:e}=await Promise.resolve().then(()=>MZ);return{loadFile:e}},void 0),t=await e(n,{requireConfirmation:!1});!0===t.success?_k.success(t.message):!1===t.success&&_k.error(t.error)}else EN.getState().createInstrument({name:e,synthType:"SunVoxSynth",sunvox:t}),_k.success(`Imported SunVox patch: ${e}`)}catch(s){_k.error("Failed to import SunVox file")}},[q,K]),lt=l.useCallback(async(e,t)=>{const{useLibopenmpt:n}=t;let s=e.metadata.type;if(Bw().releaseAll(),e.nativeData){const{format:t,importMetadata:a,instruments:o,patterns:r}=e.nativeData;let l;if(s=t,"XM"===s)l=dX(r,a.originalChannelCount,a,o.map(e=>e.name),n?e.arrayBuffer:void 0);else if("MOD"===s)l=mX(r,a.originalChannelCount,a,o.map(e=>e.name),n?e.arrayBuffer:void 0);else if("FUR"===s||"DMF"===s){const e=a.modData?.patternOrderTable||[],t=r[0]?.length||64,n=a.originalChannelCount||r[0]?.[0]?.length||4,s=a.furnaceData,i=s?.systems&&s?.systemChans?function(e,t,n,s,a){const o=[],r=e=>{switch(e){case gD:return Is[7];case bD:return Is[1];case yD:return Is[3];case vD:return Is[10];case xD:return Is[4];case ND:return Is[6];default:return null}};let i=0;for(let l=0;l<e.length&&i<n;l++){const c=e[l],u=t[l]||0,d=SD.find(e=>e.fileID===c);for(let e=0;e<u&&i<n;e++){if(d&&e<d.channelDefs.length){const t=d.channelDefs[e];o.push({name:t.name,shortName:s?.[i]||t.shortName,color:r(t.type),channelMeta:{importedFromMOD:!1,furnaceType:t.type,hardwareName:d.name,shortName:s?.[i]||t.shortName,systemId:c,channelType:t.type===xD?"sample":"synth",effectCols:a?.[i]||1}})}else o.push({name:`Channel ${i+1}`,shortName:s?.[i]||`${i+1}`,color:null,channelMeta:{importedFromMOD:!1,furnaceType:bD,hardwareName:d?.name||"Unknown",shortName:s?.[i]||`${i+1}`,systemId:c,channelType:"synth",effectCols:a?.[i]||1}});i++}}for(;o.length<n;){const e=o.length;o.push({name:`Channel ${e+1}`,shortName:s?.[e]||`${e+1}`,color:null,channelMeta:{importedFromMOD:!1,furnaceType:bD,hardwareName:"Unknown",shortName:s?.[e]||`${e+1}`,systemId:0,channelType:"synth",effectCols:a?.[e]||1}})}return o}(s.systems,s.systemChans,n,s.channelShortNames,s.effectColumns):null;l={patterns:r.map((e,s)=>({id:`pattern-${s}`,name:`Pattern ${s}`,length:t,importMetadata:a,channels:Array.from({length:n},(t,n)=>{const s=i?.[n];return{id:`channel-${n}`,name:s?.name||`Channel ${n+1}`,shortName:s?.shortName,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:s?.color||null,channelMeta:s?.channelMeta,rows:e.map(e=>{const t=e[n]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0,effects:t.effects?.map(e=>({type:e.type,param:e.param}))}})}})})),order:e.length>0?e:[0],instrumentNames:o.map(e=>e.name)}}else l=mX(r,a.originalChannelCount,a,o.map(e=>e.name),n?e.arrayBuffer:void 0);if(0===l.patterns.length)return void _k.error(`Module "${e.metadata.title}" contains no patterns to import.`);const c=[];let u=1;for(let e=0;e<o.length;e++){const t=FT(o[e],u,s);c.push(...t),u+=t.length}I();try{const e=N(),t=e.rawContext||e._context;if(t&&"running"!==t.state){await e.resume();let n=0;for(;"running"!==t.state&&n<20;)await new Promise(e=>setTimeout(e,50)),n++}}catch(i){}M(c),g(l.patterns),l.order&&l.order.length>0&&b(l.order),l.originalModuleData?v(l.originalModuleData):v(null),C({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"} (${s})`}),V(a.modData?.initialBPM||125),P(a.modData?.initialSpeed||6);return c.filter(e=>"Sampler"===e.synthType).length>0&&await Bw().preloadInstruments(c),void _k.success(`Imported "${e.metadata.title}" - ${l.patterns.length} patterns, ${c.length} instruments`)}if(!e.metadata.song){if(!e.file)return void _k.error("File reference lost  cannot import");const{parseModuleToSong:n}=await os(async()=>{const{parseModuleToSong:e}=await import("./parseModuleToSong-BCo4MrbT.js").then(e=>e.b);return{parseModuleToSong:e}},[]);let s;try{s=await n(e.file,t.subsong??0,t.uadeMetadata,t.midiOptions)}catch(i){return void _k.error(`Import failed: ${i instanceof Error?i.message:"Unknown error"}`)}I(),M(s.instruments),g(s.patterns),s.songPositions.length>0&&b(s.songPositions),v(null),V(s.initialBPM),P(s.initialSpeed),C({name:s.name,author:"",description:`Imported from ${e.file?.name||"module"}`}),ID.getState().applyEditorMode(s);return s.instruments.filter(e=>"Sampler"===e.synthType).length>0&&await Bw().preloadInstruments(s.instruments),void _k.success(`Imported "${s.name}"  ${s.patterns.length} patterns, ${s.instruments.length} instruments`)}const a=uX(e.metadata.song);if(0===a.patterns.length)return void _k.error(`Module "${e.metadata.title}" contains no patterns to import.`);let o;if(e.file&&function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".s3m",".it"].includes(t)}(e.file.name))try{const t=await hH(e.file);o=new Map;for(let e=0;e<t.samples.length;e++){const n=t.samples[e];if(n.pcmData.length>0){const t=fH(n);o.set(e+1,t)}}}catch(i){}const r=function(e,t,n){const s=new Set;for(const r of e)for(const e of r.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&s.add(t.instrument);const a=[],o=["sawtooth","square","triangle","sine"];for(const r of Array.from(s).sort((e,t)=>e-t)){const e=t[r-1]||`Instrument ${r}`,s=n?.get(r);if(s)a.push({id:r,name:e.trim()||`Sample ${r}`,type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:s}});else{const t=o[(r-1)%o.length];a.push({id:r,name:e.trim()||`Instrument ${r}`,type:"synth",synthType:"Synth",oscillator:{..._a,type:t},envelope:{...Oa},filter:{...Ta},effects:[],volume:-6,pan:0})}}for(const r of[0,1])if(!s.has(r)){const e=n?.get(r);e?a.push({id:r,name:0===r?"Default":"Sample 01",type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:e}}):a.push({id:r,name:0===r?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{..._a,type:"sawtooth"},envelope:{...Oa},filter:{...Ta},effects:[],volume:-6,pan:0})}return a.sort((e,t)=>e.id-t.id),a}(a.patterns,a.instrumentNames,o);M(r),g(a.patterns),a.order&&a.order.length>0&&b(a.order),C({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"}`}),V(125);r.filter(e=>"Sampler"===e.synthType).length>0&&await Bw().preloadInstruments(r),_k.success(`Imported "${e.metadata.title}" - ${a.patterns.length} patterns, ${r.length} instruments`)},[M,g,C,V,P,b,v]),dt=l.useCallback(e=>{Ie(e),Ae(!0)},[]),mt=l.useCallback(e=>{je(e),Ue(!0)},[]),pt=p[h];return d?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(EG,{onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstruments:a,showMasterFX:i},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:959,columnNumber:9},void 0),Yn.jsxDEV(PT,{isOpen:ne,onClose:()=>se(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:967,columnNumber:9},void 0),Yn.jsxDEV(OT,{isOpen:ae,onClose:()=>oe(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:968,columnNumber:9},void 0),Yn.jsxDEV(LT,{isOpen:re,onClose:()=>ie(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:969,columnNumber:9},void 0),Yn.jsxDEV(pU,{isOpen:le,onClose:()=>ce(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:970,columnNumber:9},void 0),Yn.jsxDEV(iU,{isOpen:ue,onClose:()=>de(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:971,columnNumber:7},void 0),Yn.jsxDEV(MU,{isOpen:me,onSelect:(e,t)=>{const{cursor:n,setCell:s}=ID.getState();s(n.channelIndex,n.rowIndex,{effTyp:e,eff:t}),pe(!1)},onClose:()=>pe(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:n}=ID.getState(),s=t[n];if(!s)return;const a=s.channels[e.channelIndex]?.rows[e.rowIndex];if(!a?.instrument)return;const o=EN.getState().getInstrument(a.instrument);return o?.synthType})()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:972,columnNumber:7},void 0),Yn.jsxDEV(_U,{isOpen:he,onClose:()=>fe(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:991,columnNumber:7},void 0),Yn.jsxDEV(TU,{isOpen:ge,onClose:()=>be(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:992,columnNumber:7},void 0),/\.(fur|dmf)$/i.test(j?.name??"")?Yn.jsxDEV(VF,{isOpen:qe,onClose:()=>{Ke(!1),X(null)},onImport:lt,initialFile:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:994,columnNumber:11},void 0):/\.(mid|midi)$/i.test(j?.name??"")?Yn.jsxDEV(TF,{isOpen:qe,onClose:()=>{Ke(!1),X(null)},onImport:lt,initialFile:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1001,columnNumber:11},void 0):Yn.jsxDEV(SF,{isOpen:qe,onClose:()=>{Ke(!1),X(null)},onImport:lt,initialFile:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1008,columnNumber:11},void 0),Yn.jsxDEV(jF,{isOpen:!!z,onClose:()=>G(null),initialFile:z},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1016,columnNumber:9},void 0),Yn.jsxDEV(zF,{isOpen:!!H,onClose:()=>W(null),initialFile:H,onImport:rt},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1022,columnNumber:9},void 0),q&&Yn.jsxDEV(HF,{onClose:()=>K(null),onImport:it,initialFile:q},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1030,columnNumber:11},void 0),we&&Yn.jsxDEV(qF,{scope:Ce,onConfirm:e=>{x(Ce,e),Ee(!1)},onCancel:()=>Ee(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1038,columnNumber:11},void 0),ke&&Yn.jsxDEV($F,{scope:Ce,onConfirm:(e,t)=>{w(Ce,e,t),De(!1)},onCancel:()=>De(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1048,columnNumber:11},void 0),Se&&Yn.jsxDEV(JF,{scope:_e,onConfirm:(e,t)=>{E(e,t,_e),Me(!1)},onCancel:()=>Me(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1058,columnNumber:11},void 0),Le&&Yn.jsxDEV(ZO,{channelIndex:Be,onClose:()=>Ae(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1068,columnNumber:11},void 0),Fe&&Yn.jsxDEV(nU,{channelIndex:Re,onClose:()=>Ue(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1074,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:958,columnNumber:7},void 0):Yn.jsxDEV("div",{className:"flex-1 min-h-0 flex flex-col bg-dark-bg overflow-y-hidden",children:[Yn.jsxDEV("div",{className:"flex-shrink min-h-[80px]",children:Yn.jsxDEV(WX,{onShowExport:e,onShowHelp:t,onShowMasterFX:n,onShowInstrumentFX:s,onShowInstruments:a,onShowPatternOrder:()=>ze(!0),onShowDrumpads:r,showMasterFX:i,showInstrumentFX:c},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1088,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1087,columnNumber:7},void 0),"tb303"!==Q&&Yn.jsxDEV("div",{className:"flex-shrink-0",children:Yn.jsxDEV(tz,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1104,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1103,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-shrink flex items-center justify-between px-2 py-1 bg-dark-bgTertiary border-b border-dark-border min-h-[28px]",children:[Yn.jsxDEV("div",{className:"flex items-center gap-2",children:[Yn.jsxDEV("div",{className:"flex items-center gap-1",children:["tracker"===Q&&Yn.jsxDEV(ct,{size:14,className:"text-text-secondary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1113,columnNumber:40},void 0),"grid"===Q&&Yn.jsxDEV(ut,{size:14,className:"text-text-secondary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1114,columnNumber:37},void 0),"pianoroll"===Q&&Yn.jsxDEV(wn,{size:14,className:"text-text-secondary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1115,columnNumber:42},void 0),"tb303"===Q&&Yn.jsxDEV(Ve,{size:14,className:"text-text-secondary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1116,columnNumber:38},void 0),Yn.jsxDEV("select",{value:Q,onChange:e=>{const t=e.target.value;"arrangement"===t?$("arrangement"):"dj"===t?$("dj"):"drumpad"===t?$("drumpad"):"vj"===t?$("vj"):Z(t)},className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",title:"Select editor view",children:[Yn.jsxDEV("option",{value:"tracker",children:"Tracker"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1136,columnNumber:15},void 0),Yn.jsxDEV("option",{value:"grid",children:"Grid"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1137,columnNumber:15},void 0),Yn.jsxDEV("option",{value:"pianoroll",children:"Piano Roll"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1138,columnNumber:15},void 0),Yn.jsxDEV("option",{value:"tb303",children:"TB-303"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1139,columnNumber:15},void 0),Yn.jsxDEV("option",{value:"arrangement",children:"Arrangement"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1140,columnNumber:15},void 0),Yn.jsxDEV("option",{value:"dj",children:"DJ Mixer"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1141,columnNumber:15},void 0),Yn.jsxDEV("option",{value:"drumpad",children:"Drum Pads"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1142,columnNumber:15},void 0),Yn.jsxDEV("option",{value:"vj",children:"VJ View"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1143,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1117,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1112,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1.5 ml-1 pl-2 border-l border-dark-border",children:[Yn.jsxDEV($t,{size:14,className:"text-text-secondary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1149,columnNumber:13},void 0),Yn.jsxDEV("select",{className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors cursor-pointer outline-none",onChange:e=>{k(e.target.value),_k.success(`Hardware System: ${SD.find(t=>t.id===e.target.value)?.name.toUpperCase()}`)},defaultValue:"none",title:"Select Hardware System Preset (NES, SMS, Genesis, etc.)",children:[Yn.jsxDEV("option",{value:"none",disabled:!0,children:"SELECT HARDWARE..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1159,columnNumber:15},void 0),MD().map(e=>Yn.jsxDEV("optgroup",{label:e.label,children:e.presets.map(e=>Yn.jsxDEV("option",{value:e.id,className:"bg-dark-bgPrimary text-text-primary",children:e.name.toUpperCase()},e.id,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1163,columnNumber:21},void 0))},e.label,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1161,columnNumber:17},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1150,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1148,columnNumber:11},void 0),Yn.jsxDEV(nz,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1171,columnNumber:11},void 0),("grid"===Q||"pianoroll"===Q)&&pt&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("span",{className:"text-text-secondary text-[10px] font-medium",children:"CH:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1176,columnNumber:15},void 0),Yn.jsxDEV("select",{value:ee,onChange:e=>te(Number(e.target.value)),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",children:pt.channels.map((e,t)=>Yn.jsxDEV("option",{value:t,children:(t+1).toString().padStart(2,"0")},t,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1183,columnNumber:19},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1177,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1175,columnNumber:13},void 0),"tracker"===Q&&Yn.jsxDEV("button",{onClick:()=>y(!f),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${f?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:f?"Hide ghost patterns":"Show ghost patterns",children:[f?Yn.jsxDEV(Pt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1204,columnNumber:36},void 0):Yn.jsxDEV(Vt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1204,columnNumber:56},void 0),Yn.jsxDEV("span",{children:"Ghosts"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1205,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1193,columnNumber:13},void 0),"tracker"===Q&&Yn.jsxDEV("button",{onClick:()=>Qe(!Je),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${Je?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:"Toggle Advanced Edit Panel",children:[Yn.jsxDEV(Oe,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1222,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Edit"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1223,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1211,columnNumber:13},void 0),"tracker"===Q&&Yn.jsxDEV("button",{onClick:()=>et(!0),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Automation Editor",children:[Yn.jsxDEV(ft,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1234,columnNumber:15},void 0),Yn.jsxDEV("span",{children:"Auto"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1235,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1229,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:r,className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Drumpad Editor",children:[Yn.jsxDEV(It,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1245,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Pads"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1246,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1240,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV("button",{onClick:()=>ID.getState().toggleRecordMode(),className:`\n                px-2 py-1 text-xs rounded font-medium transition-colors flex items-center gap-1\n                ${ID.getState().recordMode?"bg-accent-error text-white animate-pulse":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:"Toggle Recording Mode (Space)",children:[Yn.jsxDEV("div",{className:"w-2 h-2 rounded-full "+(ID.getState().recordMode?"bg-white":"bg-accent-error")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1262,columnNumber:15},void 0),"REC"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1251,columnNumber:13},void 0),Yn.jsxDEV("button",{onClick:()=>LN.getState().openModal("settings"),className:"p-1 rounded bg-dark-bgSecondary text-text-secondary hover:text-text-primary transition-colors",title:"Recording Settings (Quantize, Edit Step...)",children:Yn.jsxDEV(kn,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1270,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1265,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1250,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"w-px h-4 bg-border opacity-50 mx-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1275,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:U,className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${F?"bg-accent-error/20 text-accent-error":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:F?"Unmute master output":"Mute master output",children:F?"Unmute":"Mute"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1278,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>O(!_),className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${_?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:_?"Switch to stepped scrolling":"Switch to smooth scrolling",children:_?"Smooth":"Stepped"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1293,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-1 ml-1 pl-2 border-l border-dark-border",children:[Yn.jsxDEV("button",{onClick:()=>ye(!0),className:"px-2 py-1 text-[10px] rounded font-mono font-bold transition-colors "+("straight"!==T||L!==(B?50:100)||A>0?"bg-accent-primary/20 text-accent-primary border border-accent-primary/50":"bg-dark-bgSecondary text-text-secondary border border-dark-border hover:text-text-primary"),title:`Groove Settings (Current: ${Ba.find(e=>e.id===T)?.name||"None"})`,children:"GROOVE"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1309,columnNumber:13},void 0),ve&&Yn.jsxDEV(gR,{onClose:()=>ye(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1320,columnNumber:36},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1308,columnNumber:11},void 0),R&&Yn.jsxDEV("div",{className:"flex items-center px-3 ml-2 pl-3 border-l border-dark-border",children:Yn.jsxDEV("span",{className:"text-accent-primary font-bold tracking-[0.3em] text-[11px] animate-pulse font-mono",children:R.toUpperCase()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1326,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1325,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1110,columnNumber:9},void 0),Yn.jsxDEV("div",{className:`\n            flex items-center gap-1 px-2 py-0.5 text-xs rounded font-mono\n            ${"low"===st?"bg-accent-error/20 text-accent-error":"medium"===st?"bg-orange-500/20 text-orange-400":"bg-green-500/20 text-green-400"}\n          `,title:`Performance: ${st.toUpperCase()} | Avg FPS: ${nt} | Current: ${tt}`,children:[Yn.jsxDEV("span",{className:"font-bold",children:nt},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1346,columnNumber:11},void 0),Yn.jsxDEV("span",{className:"text-[10px] opacity-70",children:"FPS"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1347,columnNumber:11},void 0),Yn.jsxDEV("div",{className:`w-1.5 h-1.5 rounded-full ${"low"===st?"bg-accent-error":"medium"===st?"bg-orange-400":"bg-green-400"} animate-pulse`},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1348,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1334,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1109,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"flex-1 min-h-0 min-w-0 relative z-10 flex overflow-hidden",children:[Yn.jsxDEV("div",{className:"flex-1 min-w-0 min-h-0 flex flex-col overflow-hidden",children:"tracker"===Q?"hively"===D||"furnace"===D?Yn.jsxDEV("div",{className:"flex-1 flex flex-col items-center justify-center bg-dark-bgPrimary p-8 text-center",children:Yn.jsxDEV("div",{className:"max-w-md space-y-4",children:[Yn.jsxDEV("div",{className:"text-4xl mb-4",children:"hively"===D?"":""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1364,columnNumber:19},void 0),Yn.jsxDEV("h2",{className:"text-xl font-bold text-text-primary mb-2",children:["hively"===D?"HivelyTracker/AHX":"Furnace"," Editor Mode"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1367,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-text-secondary mb-4",children:["This file uses a specialized ","hively"===D?"track-based":"multi-chip"," pattern editor that's only available in WebGL mode."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1370,columnNumber:19},void 0),Yn.jsxDEV("button",{onClick:()=>{Ck.getState().setRenderMode("webgl"),_k.success("Switched to WebGL mode")},className:"px-6 py-3 bg-accent-primary hover:bg-accent-primary/80 text-white font-semibold rounded-lg transition-colors",children:"Switch to WebGL Mode"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1373,columnNumber:19},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted mt-4",children:"You can change this anytime in Settings  Display  Render Mode"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1382,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1363,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1362,columnNumber:15},void 0):"musicline"===D?Yn.jsxDEV("div",{className:"flex-1 flex flex-col min-h-0 bg-dark-bgPrimary",children:[Yn.jsxDEV("div",{className:"flex-shrink-0 border-b border-dark-border",style:{maxHeight:220,overflowY:"auto"},children:[Yn.jsxDEV("div",{className:"px-3 pt-3 pb-1 flex items-center gap-2",children:[Yn.jsxDEV("span",{className:"text-sm font-bold text-ft2-text",children:"MusicLine Editor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1392,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-xs text-accent-primary bg-accent-primary/10 px-1.5 py-0.5 rounded border border-accent-primary/30",children:"per-channel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1393,columnNumber:21},void 0),Yn.jsxDEV("span",{className:"text-xs text-ft2-textDim ml-auto",children:[Ge?.length??0," channels  ",p.length," parts"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1396,columnNumber:21},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1391,columnNumber:19},void 0),Yn.jsxDEV("div",{className:"px-3 pb-3",children:Yn.jsxDEV(aU,{onSeek:e=>{ID.getState().setCurrentPosition(e),pD().jumpToPosition(e,0)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1401,columnNumber:21},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1400,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1390,columnNumber:17},void 0),Yn.jsxDEV("div",{className:"flex-1 min-h-0",children:Yn.jsxDEV(uH,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1411,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1410,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1388,columnNumber:15},void 0):Yn.jsxDEV(MO,{onAcidGenerator:dt,onRandomize:mt,onSwipeLeft:He,onSwipeRight:We},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1415,columnNumber:15},void 0):"grid"===Q?Yn.jsxDEV(sT,{channelIndex:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1423,columnNumber:13},void 0):"pianoroll"===Q?Yn.jsxDEV(nH,{channelIndex:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1425,columnNumber:13},void 0):Yn.jsxDEV("div",{className:"flex-1 w-full overflow-y-auto overflow-x-hidden bg-dark-bgPrimary",children:Yn.jsxDEV(cz,{channelIndex:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1428,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1427,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1359,columnNumber:9},void 0),"tracker"===Q&&Yn.jsxDEV(NH,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1435,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex-shrink-0 self-stretch border-l border-ft2-border bg-ft2-header",children:Yn.jsxDEV(yH,{className:"h-full"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1440,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1439,columnNumber:9},void 0),m>=900&&Yn.jsxDEV("button",{onClick:()=>Ye(!$e),className:`\n              flex-shrink-0 w-6 flex items-center justify-center\n              bg-ft2-header border-l border-ft2-border\n              hover:bg-ft2-border transition-colors\n              ${$e?"text-ft2-highlight":"text-ft2-textDim"}\n            `,title:$e?"Hide Instruments":"Show Instruments",children:Yn.jsxDEV(Jt,{size:14,className:$e?"":"rotate-180"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1455,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1445,columnNumber:11},void 0),m>=900&&$e&&Yn.jsxDEV("div",{className:"flex-shrink-0 w-fit min-w-48 max-w-80 border-l border-ft2-border flex flex-col overflow-hidden animate-fade-in",children:Yn.jsxDEV(dG,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:a,showHivelyImport:"hively"===D,showSunVoxImport:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1462,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1461,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1357,columnNumber:7},void 0),Yn.jsxDEV(PT,{isOpen:ne,onClose:()=>se(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1477,columnNumber:7},void 0),Yn.jsxDEV(OT,{isOpen:ae,onClose:()=>oe(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1478,columnNumber:7},void 0),Yn.jsxDEV(LT,{isOpen:re,onClose:()=>ie(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1479,columnNumber:7},void 0),Yn.jsxDEV(pU,{isOpen:le,onClose:()=>ce(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1480,columnNumber:7},void 0),Yn.jsxDEV(iU,{isOpen:ue,onClose:()=>de(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1481,columnNumber:7},void 0),Yn.jsxDEV(MU,{isOpen:me,onSelect:(e,t)=>{const{cursor:n,setCell:s}=ID.getState();s(n.channelIndex,n.rowIndex,{effTyp:e,eff:t}),pe(!1)},onClose:()=>pe(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:n}=ID.getState(),s=t[n];if(!s)return;const a=s.channels[e.channelIndex]?.rows[e.rowIndex];if(!a?.instrument)return;const o=EN.getState().getInstrument(a.instrument);return o?.synthType})()},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1482,columnNumber:7},void 0),Yn.jsxDEV(_U,{isOpen:he,onClose:()=>fe(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1501,columnNumber:7},void 0),Yn.jsxDEV(TU,{isOpen:ge,onClose:()=>be(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1502,columnNumber:7},void 0),/\.(fur|dmf)$/i.test(j?.name??"")?Yn.jsxDEV(VF,{isOpen:qe,onClose:()=>{Ke(!1),X(null)},onImport:lt,initialFile:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1504,columnNumber:9},void 0):/\.(mid|midi)$/i.test(j?.name??"")?Yn.jsxDEV(TF,{isOpen:qe,onClose:()=>{Ke(!1),X(null)},onImport:lt,initialFile:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1511,columnNumber:9},void 0):Yn.jsxDEV(SF,{isOpen:qe,onClose:()=>{Ke(!1),X(null)},onImport:lt,initialFile:j},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1518,columnNumber:9},void 0),Yn.jsxDEV(jF,{isOpen:!!z,onClose:()=>G(null),initialFile:z},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1527,columnNumber:7},void 0),Yn.jsxDEV(zF,{isOpen:!!H,onClose:()=>W(null),initialFile:H,onImport:rt},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1533,columnNumber:7},void 0),q&&Yn.jsxDEV(HF,{onClose:()=>K(null),onImport:it,initialFile:q},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1541,columnNumber:9},void 0),we&&Yn.jsxDEV(qF,{scope:Ce,onConfirm:e=>{x(Ce,e),Ee(!1)},onCancel:()=>Ee(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1550,columnNumber:9},void 0),ke&&Yn.jsxDEV($F,{scope:Ce,onConfirm:(e,t)=>{w(Ce,e,t),De(!1)},onCancel:()=>De(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1560,columnNumber:9},void 0),Se&&Yn.jsxDEV(JF,{scope:_e,onConfirm:(e,t)=>{E(e,t,_e),Me(!1)},onCancel:()=>Me(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1570,columnNumber:9},void 0),Xe&&Yn.jsxDEV(oU,{onClose:()=>ze(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1580,columnNumber:9},void 0),Je&&Yn.jsxDEV(uU,{onClose:()=>Qe(!1),onShowScaleVolume:e=>{Pe(e),Ee(!0)},onShowFadeVolume:e=>{Pe(e),De(!0)},onShowRemapInstrument:e=>{Te(e),Me(!0)},onExportPattern:()=>{bH(p[h])},onExportTrack:()=>{const e=p[h];vH(ID.getState().cursor.channelIndex,e)},onReverse:ot.reverseBlock,onExpand:ot.expandBlock,onShrink:ot.shrinkBlock,onDuplicate:ot.duplicateBlock,onMath:ot.mathBlock},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1583,columnNumber:9},void 0),Le&&Yn.jsxDEV(ZO,{channelIndex:Be,onClose:()=>Ae(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1613,columnNumber:9},void 0),Fe&&Yn.jsxDEV(nU,{channelIndex:Re,onClose:()=>Ue(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1619,columnNumber:9},void 0),Ze&&Yn.jsxDEV("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 animate-fade-in",children:Yn.jsxDEV("div",{className:"bg-dark-bgPrimary border border-dark-border rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border bg-dark-bgSecondary",children:[Yn.jsxDEV("h2",{className:"text-lg font-bold text-text-primary flex items-center gap-2",children:[Yn.jsxDEV(ft,{size:20,className:"text-accent-primary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1630,columnNumber:17},void 0),"Automation Editor"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1629,columnNumber:15},void 0),Yn.jsxDEV("button",{onClick:()=>et(!1),className:"p-2 rounded hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors",title:"Close",children:Yn.jsxDEV("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:Yn.jsxDEV("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1639,columnNumber:19},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1638,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1633,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1628,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:Yn.jsxDEV(rH,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1645,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1644,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1626,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1625,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/tracker/TrackerView.tsx",lineNumber:1085,columnNumber:5},void 0)},EH=()=>{const{deck1Playing:e,deck2Playing:t,deck1BPM:n,deck2BPM:s,deck1Name:a,deck2Name:o,deck1Pos:r,deck1Total:i,deck2Pos:l,deck2Total:c,crossfader:u,curve:d}=W_(us(e=>({deck1Playing:e.decks.A.isPlaying,deck2Playing:e.decks.B.isPlaying,deck1BPM:e.decks.A.effectiveBPM||0,deck2BPM:e.decks.B.effectiveBPM||0,deck1Name:e.decks.A.trackName,deck2Name:e.decks.B.trackName,deck1Pos:e.decks.A.songPos,deck1Total:e.decks.A.totalPositions,deck2Pos:e.decks.B.songPos,deck2Total:e.decks.B.totalPositions,crossfader:e.crossfaderPosition,curve:e.crossfaderCurve}))),m=Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:44,columnNumber:15},void 0);return Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[Yn.jsxDEV("span",{className:"text-text-primary",children:[Yn.jsxDEV("span",{className:"text-blue-400 font-semibold",children:"D1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:50,columnNumber:9},void 0)," ",e?Yn.jsxDEV("span",{className:"text-accent-success",children:"PLAY"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:52,columnNumber:11},void 0):Yn.jsxDEV("span",{className:"text-text-muted",children:"STOP"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:54,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:49,columnNumber:7},void 0),a&&Yn.jsxDEV("span",{className:"text-text-muted truncate max-w-[120px]",title:a,children:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:58,columnNumber:9},void 0),Yn.jsxDEV("span",{className:"text-text-primary tabular-nums",children:[Yn.jsxDEV("span",{className:"text-blue-400",children:n.toFixed(1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:63,columnNumber:9},void 0)," BPM"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:62,columnNumber:7},void 0),i>0&&Yn.jsxDEV("span",{className:"text-text-muted tabular-nums",children:["Pos ",r,"/",i]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:66,columnNumber:9},void 0),m,Yn.jsxDEV("span",{className:"text-text-primary",children:["X-Fade"," ",Yn.jsxDEV("span",{className:"text-accent-primary tabular-nums",children:[(100*u).toFixed(0),"%"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:76,columnNumber:9},void 0),Yn.jsxDEV("span",{className:"text-text-muted ml-1",children:["(",d,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:77,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:74,columnNumber:7},void 0),m,Yn.jsxDEV("span",{className:"text-text-primary",children:[Yn.jsxDEV("span",{className:"text-red-400 font-semibold",children:"D2"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:84,columnNumber:9},void 0)," ",t?Yn.jsxDEV("span",{className:"text-accent-success",children:"PLAY"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:86,columnNumber:11},void 0):Yn.jsxDEV("span",{className:"text-text-muted",children:"STOP"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:88,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:83,columnNumber:7},void 0),o&&Yn.jsxDEV("span",{className:"text-text-muted truncate max-w-[120px]",title:o,children:o},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:92,columnNumber:9},void 0),Yn.jsxDEV("span",{className:"text-text-primary tabular-nums",children:[Yn.jsxDEV("span",{className:"text-red-400",children:s.toFixed(1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:97,columnNumber:9},void 0)," BPM"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:96,columnNumber:7},void 0),c>0&&Yn.jsxDEV("span",{className:"text-text-muted tabular-nums",children:["Pos ",l,"/",c]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:100,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:47,columnNumber:5},void 0)},kH=()=>{const{cursor:e,currentOctave:t,insertMode:n,recordMode:s,patternLength:a}=ID(us(e=>({cursor:e.cursor,currentOctave:e.currentOctave,insertMode:e.insertMode,recordMode:e.recordMode,patternLength:e.patterns[e.currentPatternIndex]?.length||64}))),{isPlaying:o,currentRow:r}=jN(us(e=>({isPlaying:e.isPlaying,currentRow:e.currentRow}))),i=o?r:e.rowIndex,l=`${String(i).padStart(2,"0")}/${String(a-1).padStart(2,"0")}`,c=`Ch ${e.channelIndex+1}`;return Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[Yn.jsxDEV("span",{className:"text-text-primary",children:["Row ",Yn.jsxDEV("span",{className:"text-accent-primary font-semibold",children:l},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:131,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:130,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:133,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"text-text-primary",children:c},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:134,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:135,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"text-text-primary capitalize",children:e.columnType},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:136,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:137,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"text-text-primary",children:["Oct ",Yn.jsxDEV("span",{className:"text-accent-primary font-semibold",children:t},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:139,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:138,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:141,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"text-text-primary",title:n?"Insert mode: new data shifts rows down":"Overwrite mode: new data replaces existing",children:["Mode: ",Yn.jsxDEV("span",{className:n?"text-accent-warning":"text-accent-primary",children:n?"INS":"OVR"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:143,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:142,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:145,columnNumber:7},void 0),Yn.jsxDEV("span",{className:"px-2 py-0.5 rounded "+(s?"bg-accent-error/20 text-accent-error":"text-text-primary"),children:s?"REC":"EDIT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:146,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:129,columnNumber:5},void 0)},DH=a.memo(({onShowTips:e})=>{const t=LN(e=>e.activeView),{contextState:n}=UD(),s=dV(e=>e.status),a=dV(e=>e.roomCode),{knobBank:o,setKnobBank:r,isInitialized:i,inputDevices:l,selectedInputId:c,showKnobBar:u,setShowKnobBar:d}=OM(),m=i&&l.length>0,p=m?l.find(e=>e.id===c)||l[0]:null,h=p?.name||"MIDI Controller",f=[{id:"303",label:"303/Synth",icon:Te},{id:"Siren",label:"Dub Siren",icon:ft},{id:"FX",label:"Effects",icon:Ct},{id:"Mixer",label:"Mixer",icon:Pe}],g=m?ZS[o]:[];return Yn.jsxDEV("div",{className:"flex flex-col",children:["dj"!==t&&"vj"!==t&&m&&u&&Yn.jsxDEV("div",{className:"bg-dark-bgTertiary border-t border-dark-border px-4 py-2 flex flex-col gap-2",children:[Yn.jsxDEV("div",{className:"flex items-center gap-1",children:[Yn.jsxDEV("div",{className:"text-[10px] font-bold text-text-muted uppercase mr-2 tracking-widest",children:"Knob Bank:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:184,columnNumber:13},void 0),f.map(e=>{const t=e.icon,n=o===e.id;return Yn.jsxDEV("button",{onClick:()=>r(e.id),className:`\n                    flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase transition-all border\n                    ${n?"bg-accent-primary text-dark-bg border-accent-primary shadow-[0_0_10px_rgba(0,255,255,0.3)]":"bg-dark-bgSecondary text-text-muted border-dark-border hover:border-text-muted"}\n                  `,children:[Yn.jsxDEV(t,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:200,columnNumber:19},void 0),e.label]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:189,columnNumber:17},void 0)})]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:183,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-8 gap-2",children:g.map((e,t)=>Yn.jsxDEV("div",{className:"flex flex-col items-center p-1.5 rounded bg-dark-bgSecondary border border-dark-border relative group overflow-hidden",children:[Yn.jsxDEV("div",{className:"absolute top-0 left-0 w-full h-[2px] bg-accent-primary/20 group-hover:bg-accent-primary/50 transition-colors"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:214,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[8px] font-mono text-text-muted mb-1 flex items-center gap-1",children:[Yn.jsxDEV(On,{size:8},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:216,columnNumber:19},void 0)," K",t+1," (CC ",e.cc,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:215,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[10px] font-bold text-accent-primary uppercase truncate w-full text-center",children:e.label},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:218,columnNumber:17},void 0)]},t,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:210,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:208,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:181,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"bg-dark-bgSecondary border-t border-dark-border flex items-center justify-between px-4 py-1.5 text-xs font-mono",children:["dj"===t?Yn.jsxDEV(EH,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:230,columnNumber:32},void 0):"vj"===t?Yn.jsxDEV("div",{className:"flex items-center gap-3 text-text-muted",children:[Yn.jsxDEV("span",{className:"text-accent",children:"VJ"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:232,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"text-[10px]",children:"Esc: back  V: toggle  Milkdrop | ISF | 3D"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:233,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:231,columnNumber:11},void 0):Yn.jsxDEV(kH,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:235,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-4",children:[m&&"dj"!==t&&"vj"!==t&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:()=>d(!u),className:"flex items-center gap-1.5 text-[10px] text-text-muted hover:text-accent-primary transition-colors",title:u?"Hide MIDI controls":"Show MIDI controls",children:[Yn.jsxDEV("span",{className:"w-2 h-2 rounded-full bg-accent-success animate-pulse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:247,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"font-bold uppercase",children:h},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:248,columnNumber:17},void 0),u?Yn.jsxDEV(De,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:249,columnNumber:32},void 0):Yn.jsxDEV(jt,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:249,columnNumber:60},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:242,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:251,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:241,columnNumber:13},void 0),e&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("button",{onClick:e,className:"flex items-center gap-1.5 px-2 py-0.5 rounded bg-accent-warning/10 text-accent-warning hover:bg-accent-warning/20 transition-colors",title:"Tip of the Day",children:[Yn.jsxDEV(pn,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:262,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-[10px] font-bold uppercase tracking-tight",children:"Tips"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:263,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:257,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:265,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:256,columnNumber:13},void 0),"connected"===s&&a&&Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("span",{className:"flex items-center gap-1.5 text-accent-success",children:[Yn.jsxDEV("span",{className:"w-2 h-2 rounded-full bg-accent-success animate-pulse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:273,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"font-bold",children:"Collab"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:274,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"font-mono text-[10px] text-text-muted",children:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:275,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:272,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"w-px h-3 bg-border opacity-50"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:277,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:271,columnNumber:13},void 0),Yn.jsxDEV("span",{className:"flex items-center gap-1.5 "+("running"===n?"text-accent-success":"text-text-muted"),children:[Yn.jsxDEV("span",{className:"w-2 h-2 rounded-full "+("running"===n?"bg-accent-success":"bg-text-muted")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:286,columnNumber:13},void 0),"running"===n?"Audio Active":"Audio Off"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:281,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:238,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:228,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/layout/StatusBar.tsx",lineNumber:178,columnNumber:5},void 0)});class SH{currentScheme=null;validateScheme(e){if(!e||"object"!=typeof e)return!1;const t=e;if("string"!=typeof t.name)return!1;if("string"!=typeof t.version)return!1;if(!t.platform||"object"!=typeof t.platform)return!1;const{pc:n,mac:s}=t.platform;return!(!n||"object"!=typeof n||Array.isArray(n))&&!(!s||"object"!=typeof s||Array.isArray(s))}async loadScheme(e){const t=ms(`/keyboard-schemes/${e}.json`),n=await fetch(t);if(!n.ok)throw new Error(`Failed to load scheme '${e}': ${n.status} ${n.statusText} (at ${t})`);const s=await n.json();if(!this.validateScheme(s))throw new Error(`Invalid scheme format: ${e}`);return this.currentScheme=s,s}getCommand(e,t){if(this.currentScheme)return this.currentScheme.platform[t]?.[e]}}class MH{static format(e,t=!1){const n=[];e.ctrl&&n.push(t&&e.meta?"Cmd":"Ctrl"),e.alt&&n.push("Alt"),e.shift&&n.push("Shift");const s=1===e.key.length?e.key.toUpperCase():e.key;return n.push(s),n.join("+")}}async function CH(){VN(),A();const{cursor:e,patterns:t,currentPatternIndex:n}=ID.getState(),s=t[n];if(!s)return!0;const a=Bw(),{instruments:o}=EN.getState(),r=[];s.channels.forEach((t,n)=>{const s=t.rows[e.rowIndex];if(!s.note||0===s.note||s.note===Rs)return;const a=Ga(s.note),i=s.instrument||0;if(0===i)return;const l=o.find(e=>e.id===i);l&&r.push({instrumentId:i,noteStr:a,chIdx:n,instrument:l})}),await Promise.all(r.map(e=>a.ensureInstrumentReady(e.instrument)));for(const{instrumentId:i,noteStr:l,chIdx:c,instrument:u}of r)a.triggerNoteAttack(i,l,c,1,u);return!0}function VH(){VN(),A();const{cursor:e}=ID.getState(),{isPlaying:t,stop:n,play:s,setCurrentRow:a}=jN.getState();return t&&n(),a(e.rowIndex),Bw().init().then(()=>s()).catch(e=>{}),!0}function PH(){const{patterns:e,currentPatternIndex:t}=ID.getState(),n=e[t];if(!n)return!0;const s=JSON.parse(JSON.stringify(n));return s.name=function(e,t){const n=`${e} (Copy)`;if(!t.some(e=>e.name===n))return n;let s=1;const a=new RegExp(`^${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")} \\(Copy(?: (\\d+))?\\)$`);return t.forEach(e=>{const t=e.name.match(a);if(t){const e=parseInt(t[1],10);e>s&&(s=e)}}),`${e} (Copy ${s+1})`}(n.name,e),ID.setState(e=>{e.patterns.push(s)}),LN.getState().setStatusMessage(`PATTERN CLONED: ${s.name}`),!0}function _H(){const{isPlaying:e,stop:t,setCurrentRow:n}=jN.getState();return e?(pD().stop(),t(),Bw().stop()):(VN(),A(),n(0),Bw().init().then(()=>jN.getState().play()).catch(e=>{})),!0}function OH(){const{setCurrentRow:e,play:t,isPlaying:n,stop:s}=jN.getState();return n&&(pD().stop(),s()),VN(),A(),e(0),Bw().init().then(()=>t()).catch(e=>{}),!0}function TH(){const{setCurrentRow:e,setCurrentPattern:t,play:n,isPlaying:s,stop:a}=jN.getState();return s&&(pD().stop(),a()),VN(),A(),t(0),e(0),Bw().init().then(()=>n()).catch(e=>{}),!0}function LH(){pD().stop();const{stop:e}=jN.getState();return e(),Bw().stop(),!0}function AH(){return ID.getState().moveCursor("up"),!0}function BH(){return ID.getState().moveCursor("down"),!0}function IH(){return ID.getState().moveCursor("left"),!0}function FH(){return ID.getState().moveCursor("right"),!0}function UH(){const{cursor:e,moveCursorToRow:t}=ID.getState();return t(Math.max(0,e.rowIndex-16)),!0}function RH(){const{cursor:e,patterns:t,currentPatternIndex:n,moveCursorToRow:s}=ID.getState(),a=t[n];if(!a)return!1;const o=a.length-1;return s(Math.min(o,e.rowIndex+16)),!0}function jH(){return ID.getState().moveCursorToColumn("note"),!0}function XH(){return ID.getState().moveCursorToColumn("effParam2"),!0}function zH(){return ID.getState().moveCursorToRow(0),!0}function GH(){const{patterns:e,currentPatternIndex:t,moveCursorToRow:n}=ID.getState(),s=e[t];return!!s&&(n(s.length-1),!0)}function HH(){const{cursor:e,patterns:t,currentPatternIndex:n,moveCursorToChannel:s,moveCursorToColumn:a}=ID.getState(),o=t[n];if(!o)return!1;const r=o.channels.length;return s((e.channelIndex+1)%r),a("note"),!0}function WH(){const{cursor:e,patterns:t,currentPatternIndex:n,moveCursorToChannel:s,moveCursorToColumn:a}=ID.getState(),o=t[n];if(!o)return!1;const r=o.channels.length;return s((e.channelIndex-1+r)%r),a("note"),!0}function qH(){return ID.getState().moveCursor("right"),!0}function KH(){return ID.getState().moveCursor("left"),!0}function $H(){return ID.getState().moveCursorToRow(0),!0}function YH(){return ID.getState().moveCursorToRow(16),!0}function JH(){return ID.getState().moveCursorToRow(32),!0}function QH(){return ID.getState().moveCursorToRow(48),!0}function ZH(){return ID.getState().moveCursorToColumn("note"),!0}function eW(){return ID.getState().moveCursorToColumn("effParam2"),!0}function tW(){const{editStep:e,setEditStep:t}=ID.getState();return t(Math.min(16,e+1)),!0}function nW(){const{editStep:e,setEditStep:t}=ID.getState();return t(Math.max(0,e-1)),!0}function sW(){const{cursor:e,moveCursorToRow:t}=ID.getState();return t(Math.max(0,e.rowIndex-4)),!0}function aW(){const{cursor:e,patterns:t,currentPatternIndex:n,moveCursorToRow:s}=ID.getState(),a=t[n];if(!a)return!1;const o=a.length-1;return s(Math.min(o,e.rowIndex+4)),!0}function oW(){const{patterns:e,currentPatternIndex:t,moveCursorToRow:n}=ID.getState(),s=e[t];if(!s)return!1;return n(Math.floor(s.length/4)),!0}function rW(){const{patterns:e,currentPatternIndex:t,moveCursorToRow:n}=ID.getState(),s=e[t];if(!s)return!1;return n(Math.floor(s.length/2)),!0}function iW(){const{patterns:e,currentPatternIndex:t,moveCursorToRow:n}=ID.getState(),s=e[t];if(!s)return!1;return n(Math.floor(3*s.length/4)),!0}function lW(){const{cursor:e,clearCell:t}=ID.getState();return t(e.channelIndex,e.rowIndex),!0}function cW(){const{cursor:e,deleteRow:t}=ID.getState();return t(e.channelIndex,e.rowIndex),LN.getState().setStatusMessage("Row deleted",!1,1e3),!0}function uW(){const{cursor:e,insertRow:t}=ID.getState();return t(e.channelIndex,e.rowIndex),LN.getState().setStatusMessage("Row inserted",!1,1e3),!0}function dW(){ID.getState().toggleRecordMode();const e=ID.getState().recordMode;return LN.getState().setStatusMessage(e?"Edit mode ON":"Edit mode OFF",!1,1e3),!0}function mW(){return ID.getState().clearPattern(),LN.getState().setStatusMessage("Pattern cleared",!1,1e3),!0}function pW(){const{cursor:e,clearChannel:t}=ID.getState();return t(e.channelIndex),LN.getState().setStatusMessage(`Channel ${e.channelIndex+1} cleared`,!1,1e3),!0}function hW(e){return function(){return ID.getState().setCurrentOctave(e),LN.getState().setStatusMessage(`Octave ${e}`,!1,1e3),!0}}const fW=hW(0),gW=hW(1),bW=hW(2),vW=hW(3),yW=hW(4),xW=hW(5),NW=hW(6),wW=hW(7),EW=hW(8),kW=hW(9);function DW(e){return function(){return ID.getState().setEditStep(e),LN.getState().setStatusMessage(`Edit step ${e}`,!1,1e3),!0}}const SW=DW(0),MW=DW(1),CW=DW(2),VW=DW(3),PW=DW(4),_W=DW(5),OW=DW(6),TW=DW(7),LW=DW(8),AW=DW(9),BW=DW(10),IW=DW(11),FW=DW(12),UW=DW(13),RW=DW(14),jW=DW(15),XW=DW(16);function zW(){const{editStep:e,setEditStep:t}=ID.getState(),n=Math.min(16,e+1);return t(n),LN.getState().setStatusMessage(`Edit step ${n}`,!1,1e3),!0}function GW(){const{editStep:e,setEditStep:t}=ID.getState(),n=Math.max(0,e-1);return t(n),LN.getState().setStatusMessage(`Edit step ${n}`,!1,1e3),!0}function HW(){ID.getState().toggleInsertMode();const e=ID.getState().insertMode;return LN.getState().setStatusMessage(e?"INSERT mode":"OVERWRITE mode",!1,1e3),!0}function WW(){return ID.getState().moveCursor("down"),!0}function qW(){const{currentPatternIndex:e,patterns:t,setCurrentPattern:n}=ID.getState();return!(e<t.length-1)||(n(e+1),LN.getState().setStatusMessage(`Pattern ${e+2}/${t.length}`,!1,1e3),!0)}function KW(){const{currentPatternIndex:e,setCurrentPattern:t}=ID.getState();if(e>0){t(e-1);const{patterns:n}=ID.getState();return LN.getState().setStatusMessage(`Pattern ${e}/${n.length}`,!1,1e3),!0}return!0}function $W(){const{cursor:e,toggleChannelMute:t,patterns:n,currentPatternIndex:s}=ID.getState();if(!n[s])return!1;t(e.channelIndex);const a=ID.getState().patterns[s].channels[e.channelIndex].muted;return LN.getState().setStatusMessage(a?`Channel ${e.channelIndex+1} muted`:`Channel ${e.channelIndex+1} unmuted`,!1,1e3),!0}function YW(){const{cursor:e,toggleChannelSolo:t,patterns:n,currentPatternIndex:s}=ID.getState();if(!n[s])return!1;t(e.channelIndex);const a=ID.getState().patterns[s].channels[e.channelIndex].solo;return LN.getState().setStatusMessage(a?`Channel ${e.channelIndex+1} soloed`:`Channel ${e.channelIndex+1} unsolo`,!1,1e3),!0}function JW(){const{patterns:e,currentPatternIndex:t,toggleChannelMute:n,toggleChannelSolo:s}=ID.getState(),a=e[t];return!!a&&(a.channels.forEach((e,t)=>{e.muted&&n(t),e.solo&&s(t)}),LN.getState().setStatusMessage("All channels unmuted",!1,1e3),!0)}function QW(e){return function(){const{moveCursorToChannel:t}=ID.getState();return t(e-1),LN.getState().setStatusMessage(`Channel ${e}`,!1,1e3),!0}}const ZW=QW(1),eq=QW(2),tq=QW(3),nq=QW(4),sq=QW(5),aq=QW(6),oq=QW(7),rq=QW(8);function iq(){const{selection:e,copySelection:t}=ID.getState();return e?(t(),LN.getState().setStatusMessage("Selection copied",!1,1e3),!0):(LN.getState().setStatusMessage("No selection to copy",!1,1e3),!0)}function lq(){const{selection:e,cutSelection:t}=ID.getState();return e?(t(),LN.getState().setStatusMessage("Selection cut",!1,1e3),!0):(LN.getState().setStatusMessage("No selection to cut",!1,1e3),!0)}function cq(){const{clipboard:e,paste:t}=ID.getState();return e?(t(),LN.getState().setStatusMessage("Pasted",!1,1e3),!0):(LN.getState().setStatusMessage("Nothing to paste",!1,1e3),!0)}function uq(){return ID.getState().selectPattern(),LN.getState().setStatusMessage("Pattern selected",!1,1e3),!0}function dq(){const{cursor:e,selectChannel:t}=ID.getState();return t(e.channelIndex),LN.getState().setStatusMessage(`Channel ${e.channelIndex+1} selected`,!1,1e3),!0}function mq(){const{cursor:e,selectColumn:t}=ID.getState();return t(e.channelIndex,e.columnType),LN.getState().setStatusMessage("Column selected",!1,1e3),!0}function pq(){return ID.getState().startSelection(),LN.getState().setStatusMessage("Block start marked",!1,1e3),!0}function hq(){const{cursor:e,updateSelection:t,endSelection:n}=ID.getState();return t(e.channelIndex,e.rowIndex),n(),LN.getState().setStatusMessage("Block end marked",!1,1e3),!0}function fq(){return ID.getState().clearSelection(),!0}function gq(){const{cursor:e,copyTrack:t}=ID.getState();return t(e.channelIndex),LN.getState().setStatusMessage(`Track ${e.channelIndex+1} copied`,!1,1e3),!0}function bq(){const{cursor:e,cutTrack:t}=ID.getState();return t(e.channelIndex),LN.getState().setStatusMessage(`Track ${e.channelIndex+1} cut`,!1,1e3),!0}function vq(){const{cursor:e,trackClipboard:t,pasteTrack:n}=ID.getState();return t?(n(e.channelIndex),LN.getState().setStatusMessage(`Pasted to track ${e.channelIndex+1}`,!1,1e3),!0):(LN.getState().setStatusMessage("No track data to paste",!1,1e3),!0)}function yq(){const{selection:e,transposeSelection:t}=ID.getState();return e?(t(1),LN.getState().setStatusMessage("Transposed +1 semitone",!1,1e3),!0):(LN.getState().setStatusMessage("No selection to transpose",!1,1e3),!0)}function xq(){const{selection:e,transposeSelection:t}=ID.getState();return e?(t(-1),LN.getState().setStatusMessage("Transposed -1 semitone",!1,1e3),!0):(LN.getState().setStatusMessage("No selection to transpose",!1,1e3),!0)}function Nq(){const{selection:e,transposeSelection:t}=ID.getState();return e?(t(12),LN.getState().setStatusMessage("Transposed +1 octave",!1,1e3),!0):(LN.getState().setStatusMessage("No selection to transpose",!1,1e3),!0)}function wq(){const{selection:e,transposeSelection:t}=ID.getState();return e?(t(-12),LN.getState().setStatusMessage("Transposed -1 octave",!1,1e3),!0):(LN.getState().setStatusMessage("No selection to transpose",!1,1e3),!0)}function Eq(){return yq()}function kq(){return xq()}function Dq(){return Nq()}function Sq(){return wq()}function Mq(){const{cursor:e,selectChannel:t,transposeSelection:n}=ID.getState();return t(e.channelIndex),n(1),LN.getState().setStatusMessage(`Track ${e.channelIndex+1} transposed +1`,!1,1e3),!0}function Cq(){const{cursor:e,selectChannel:t,transposeSelection:n}=ID.getState();return t(e.channelIndex),n(-1),LN.getState().setStatusMessage(`Track ${e.channelIndex+1} transposed -1`,!1,1e3),!0}function Vq(){const{currentInstrumentId:e,instruments:t,setCurrentInstrument:n}=EN.getState();if(0===t.length)return!0;const s=t.findIndex(t=>t.id===e),a=t[s>0?s-1:t.length-1];return n(a.id),LN.getState().setStatusMessage(`Instrument: ${a.name||a.id}`,!1,1e3),!0}function Pq(){const{currentInstrumentId:e,instruments:t,setCurrentInstrument:n}=EN.getState();if(0===t.length)return!0;const s=t.findIndex(t=>t.id===e),a=t[s<t.length-1?s+1:0];return n(a.id),LN.getState().setStatusMessage(`Instrument: ${a.name||a.id}`,!1,1e3),!0}function _q(e){return function(){const{instruments:t,setCurrentInstrument:n}=EN.getState(),s=e-1;if(s>=0&&s<t.length){const a=t[s];n(a.id),LN.getState().setStatusMessage(`Instrument ${e}: ${a.name||a.id}`,!1,1e3)}else LN.getState().setStatusMessage(`Instrument ${e} not loaded`,!1,1e3);return!0}}const Oq=_q(1),Tq=_q(2),Lq=_q(3),Aq=_q(4),Bq=_q(5),Iq=_q(6),Fq=_q(7),Uq=_q(8),Rq=_q(9),jq=_q(10);function Xq(){const{currentOctave:e,setCurrentOctave:t}=ID.getState(),n=Math.max(0,e-1);return t(n),LN.getState().setStatusMessage(`Octave ${n}`,!1,1e3),!0}function zq(){const{currentOctave:e,setCurrentOctave:t}=ID.getState(),n=Math.min(9,e+1);return t(n),LN.getState().setStatusMessage(`Octave ${n}`,!1,1e3),!0}function Gq(){const{undo:e,canUndo:t}=CD.getState(),{currentPatternIndex:n,replacePattern:s}=ID.getState();if(!t())return LN.getState().setStatusMessage("Nothing to undo",!1,1e3),!0;const a=e();return a&&(s(n,a),LN.getState().setStatusMessage("Undo",!1,1e3)),!0}function Hq(){const{redo:e,canRedo:t}=CD.getState(),{currentPatternIndex:n,replacePattern:s}=ID.getState();if(!t())return LN.getState().setStatusMessage("Nothing to redo",!1,1e3),!0;const a=e();return a&&(s(n,a),LN.getState().setStatusMessage("Redo",!1,1e3)),!0}function Wq(){return LN.getState().openDialogCommand("keyboard-help"),!0}function qq(){return LN.getState().setActiveView("tracker"),LN.getState().setStatusMessage("Pattern Editor",!1,1e3),!0}function Kq(){return LN.getState().setStatusMessage("Sample editor: use instrument list",!1,1500),!0}function $q(){const{visiblePanels:e,togglePanel:t,setActivePanel:n}=LN.getState();return e.includes("instrument-editor")||t("instrument-editor"),n("instrument-editor"),LN.getState().setStatusMessage("Instrument Editor",!1,1e3),!0}function Yq(){return $q()}function Jq(){return LN.getState().setStatusMessage("Comments: use File menu",!1,1500),!0}function Qq(){const{visiblePanels:e,togglePanel:t,setActivePanel:n}=LN.getState();return e.includes("pattern-list")||t("pattern-list"),n("pattern-list"),LN.getState().setStatusMessage("Pattern List",!1,1e3),!0}function Zq(){return LN.getState().openModal("settings"),!0}function eK(){const{sidebarCollapsed:e,toggleSidebar:t}=LN.getState();return t(),LN.getState().setStatusMessage("Sidebar: "+(e?"shown":"hidden"),!1,1e3),!0}function tK(){return LN.getState().setActiveView("tracker"),LN.getState().setStatusMessage("General view",!1,1e3),!0}function nK(){return LN.getState().setActiveView("tracker"),LN.getState().setStatusMessage("Pattern View",!1,1e3),!0}function sK(){return Kq()}function aK(){return $q()}function oK(){return Jq()}function rK(){return LN.getState().openModal("settings"),LN.getState().setStatusMessage("MIDI: see Settings  MIDI",!1,1500),!0}function iK(){return Zq()}function lK(){return document.fullscreenElement?(document.exitFullscreen(),LN.getState().setStatusMessage("Fullscreen OFF",!1,1e3)):(document.documentElement.requestFullscreen().catch(()=>{LN.getState().setStatusMessage("Fullscreen not available",!1,1e3)}),LN.getState().setStatusMessage("Fullscreen ON",!1,1e3)),!0}function cK(){return Zq()}function uK(){return nK()}function dK(){return $q()}function mK(){return nK()}function pK(){return nK()}function hK(){return iK()}function fK(){return $q()}function gK(){return rK()}function bK(){return nK()}function vK(){return nK()}function yK(){return LN.getState().setShowFileBrowser(!0),!0}function xK(){return _X().then(e=>{LN.getState().setStatusMessage(e?"Project saved":"Save failed",!1,1500)}),!0}function NK(){return!confirm("Start a new project? Unsaved changes will be lost.")||(ID.getState().reset(),jN.getState().reset(),LN.getState().setStatusMessage("New project",!1,1500),!0)}function wK(){return NK()}function EK(){return yK()}function kK(){return LN.getState().setStatusMessage("Close: use browser refresh",!1,1500),!0}function DK(){return xK()}function SK(){return xK()}function MK(){return NK()}function CK(){return yK()}function VK(){return xK()}function PK(){return NK()}function _K(){return yK()}function OK(){return xK()}function TK(){return yK()}function LK(){return xK()}function AK(){return LN.getState().openDialogCommand("interpolate-volume"),!0}function BK(){return LN.getState().openDialogCommand("interpolate-effect"),!0}function IK(){const{selection:e}=ID.getState();return e?(ID.getState().amplifySelection(1.5),LN.getState().setStatusMessage("Amplified 1.5",!1,1e3),!0):(LN.getState().setStatusMessage("Select a range first",!1,1500),!0)}function FK(){const e=ID.getState(),{cursor:t,patterns:n,currentPatternIndex:s}=e,a=n[s].channels[t.channelIndex].rows[t.rowIndex].instrument;return!a||(e.applyInstrumentToSelection(a),LN.getState().setStatusMessage(`Instrument ${a} applied`,!1,1e3),!0)}function UK(){const{currentPatternIndex:e,expandPattern:t}=ID.getState();t(e);const n=ID.getState().patterns[e]?.length??0;return LN.getState().setStatusMessage(`Pattern: ${n} rows`,!1,1e3),!0}function RK(){const{currentPatternIndex:e,shrinkPattern:t}=ID.getState();t(e);const n=ID.getState().patterns[e]?.length??0;return LN.getState().setStatusMessage(`Pattern: ${n} rows`,!1,1e3),!0}function jK(){return ID.getState().growSelection(),!0}function XK(){return ID.getState().shrinkSelection(),!0}function zK(){const{currentPatternIndex:e,duplicatePattern:t}=ID.getState();return t(e),LN.getState().setStatusMessage("Pattern duplicated",!1,1e3),!0}function GK(){return UK()}function HK(){return RK()}function WK(){return UK()}function qK(){return RK()}function KK(){return LN.getState().openDialogCommand("scale-volume-track"),!0}function $K(){return LN.getState().openDialogCommand("scale-volume-pattern"),!0}function YK(){return LN.getState().openDialogCommand("scale-volume-block"),!0}function JK(){const{cursor:e,patterns:t,currentPatternIndex:n}=ID.getState(),s=t[n],a=(e.channelIndex+1)%s.channels.length;return ID.getState().swapChannels(e.channelIndex,a),LN.getState().setStatusMessage(`Channels ${e.channelIndex+1}${a+1} swapped`,!1,1e3),!0}function QK(){return ID.getState().splitPatternAtCursor(),LN.getState().setStatusMessage("Pattern split at cursor",!1,1e3),!0}function ZK(){return ID.getState().joinPatterns(),LN.getState().setStatusMessage("Patterns joined",!1,1e3),!0}function e$(){return LN.getState().setStatusMessage("Pattern length: resize in pattern list",!1,1500),!0}function t$(){const{bpm:e,setBPM:t}=jN.getState();return t(e+1),LN.getState().setStatusMessage(`BPM: ${e+1}`,!1,800),!0}function n$(){const{speed:e,setSpeed:t}=jN.getState();return t(e+1),LN.getState().setStatusMessage(`Speed: ${e+1}`,!1,800),!0}function s$(){return t$()}function a$(){return ID.getState().addPattern(),LN.getState().setStatusMessage("Pattern appended",!1,1e3),!0}function o$(){return ID.getState().addPattern(),LN.getState().setStatusMessage("Pattern inserted",!1,1e3),!0}function r$(){return QK()}function i$(){const{currentPatternIndex:e,patterns:t}=ID.getState();return LN.getState().setStatusMessage(`Pattern ${e+1}/${t.length}`,!1,1e3),!0}function l$(){return LN.getState().openDialogCommand("find-replace"),!0}function c$(){return LN.getState().openDialogCommand("find-replace"),!0}function u$(){return LN.getState().openDialogCommand("find-replace"),!0}function d$(){return LN.getState().setStatusMessage("Go to: use Ctrl+G / pattern list",!1,1500),!0}function m$(){return LN.getState().openDialogCommand("groove-settings"),!0}function p$(){return ID.getState().paste(),LN.getState().setStatusMessage("Pasted",!1,800),!0}function h$(){return ID.getState().pastePushForward(),LN.getState().setStatusMessage("Pasted (insert)",!1,800),!0}function f$(){return ID.getState().pasteMix(),LN.getState().setStatusMessage("Pasted (mix)",!1,800),!0}function g$(){return ID.getState().pasteFlood(),LN.getState().setStatusMessage("Pasted (flood)",!1,800),!0}function b$(){return ID.getState().pastePushForward(),LN.getState().setStatusMessage("Pasted (push)",!1,800),!0}function v$(){const e=ID.getState(),{cursor:t,patterns:n,currentPatternIndex:s}=e,a=n[s],o=a.channels.map(e=>[{...e.rows[t.rowIndex]}]);e.setClipboard({channels:a.channels.length,rows:1,data:o,columnTypes:[]});for(let r=0;r<a.channels.length;r++)e.clearCell(r,t.rowIndex);return!0}function y$(){const e=ID.getState(),{cursor:t,patterns:n,currentPatternIndex:s}=e,a=n[s],o=a.channels.map(e=>[{...e.rows[t.rowIndex]}]);return e.setClipboard({channels:a.channels.length,rows:1,data:o,columnTypes:[]}),!0}function x$(){const e=ID.getState(),{cursor:t,patterns:n,currentPatternIndex:s}=e,a=n[s].channels[t.channelIndex].rows[t.rowIndex];return e.setClipboard({channels:1,rows:1,data:[[{...a}]],columnTypes:["note","instrument"]}),e.setCell(t.channelIndex,t.rowIndex,{note:0,instrument:0}),!0}function N$(){const e=ID.getState(),{cursor:t}=e;return e.setCell(t.channelIndex,t.rowIndex,{note:0,instrument:0}),!0}function w$(){const e=ID.getState(),{cursor:t,patterns:n,currentPatternIndex:s}=e,a=n[s];for(let o=0;o<a.channels.length;o++)e.clearCell(o,t.rowIndex);return!0}function E$(){const e=ID.getState(),{cursor:t,patterns:n,currentPatternIndex:s}=e,a=n[s];for(let o=0;o<a.channels.length;o++)e.deleteRow(o,t.rowIndex);return!0}function k$(){const e=ID.getState(),{cursor:t,patterns:n,currentPatternIndex:s}=e,a=n[s];for(let o=0;o<a.channels.length;o++)e.insertRow(o,t.rowIndex);return!0}function D$(){const e=ID.getState();return e.selectPattern(),e.copySelection(),LN.getState().setStatusMessage("Pattern copied",!1,800),!0}function S$(){return ID.getState().paste(),LN.getState().setStatusMessage("Pattern pasted",!1,800),!0}function M$(){const e=ID.getState();return e.cutTrack(e.cursor.channelIndex),LN.getState().setStatusMessage("Channel cut",!1,800),!0}function C$(){const e=ID.getState();return e.copyTrack(e.cursor.channelIndex),LN.getState().setStatusMessage("Channel copied",!1,800),!0}function V$(){const e=ID.getState();return e.pasteTrack(e.cursor.channelIndex),LN.getState().setStatusMessage("Channel pasted",!1,800),!0}function P$(){const{followPlayback:e,setFollowPlayback:t}=ID.getState();return t(!e),LN.getState().setStatusMessage("Follow: "+(e?"OFF":"ON"),!1,1e3),!0}function _$(){const{isLooping:e,setIsLooping:t}=jN.getState();return t(!e),LN.getState().setStatusMessage("Loop: "+(e?"OFF":"ON"),!1,1e3),!0}function O$(){const{smoothScrolling:e,setSmoothScrolling:t}=jN.getState();return t(!e),LN.getState().setStatusMessage("Smooth scroll: "+(e?"OFF":"ON"),!1,1e3),!0}function T$(){const{metronomeEnabled:e,toggleMetronome:t}=jN.getState();return t(),LN.getState().setStatusMessage("Metronome: "+(e?"OFF":"ON"),!1,1e3),!0}function L$(){const{countInEnabled:e,toggleCountIn:t}=jN.getState();return t(),LN.getState().setStatusMessage("Count-in: "+(e?"OFF":"ON"),!1,1e3),!0}function A$(){return LN.getState().setStatusMessage("MIDI input: configure in MIDI settings",!1,2e3),!0}function B$(){const{recordQuantize:e,toggleRecordQuantize:t}=ID.getState();return t(),LN.getState().setStatusMessage("Record quantize: "+(e?"OFF":"ON"),!1,1e3),!0}function I$(){const{chordEntryMode:e,toggleChordEntryMode:t}=LN.getState();return t(),LN.getState().setStatusMessage("Chord mode: "+(e?"OFF":"ON"),!1,1e3),!0}function F$(){const{wrapMode:e,toggleWrapMode:t}=ID.getState();return t(),LN.getState().setStatusMessage("Wrap mode: "+(e?"OFF":"ON"),!1,1e3),!0}function U$(){const{autoRecord:e,toggleAutoRecord:t}=ID.getState();return t(),LN.getState().setStatusMessage("Auto-record: "+(e?"OFF":"ON"),!1,1e3),!0}function R$(){const{multiChannelRecord:e,toggleMultiChannelRecord:t}=ID.getState();return t(),LN.getState().setStatusMessage("Multi-ch record: "+(e?"OFF":"ON"),!1,1e3),!0}function j$(){return LN.getState().setStatusMessage("Pattern focus: click pattern editor",!1,1500),!0}function X$(){const{blankEmptyCells:e,setBlankEmptyCells:t}=LN.getState();return t(!e),LN.getState().setStatusMessage("Empty cells: "+(e?"visible":"hidden"),!1,1e3),!0}function z$(){return YW()}function G$(){return $W()}function H$(){return LN.getState().setStatusMessage("Sample preview: click in instrument list",!1,1500),!0}function W$(){return LN.getState().togglePanel("instrument-editor"),!0}function q$(e){const{cursor:t,setPtnJumpPos:n}=ID.getState();return n(e,t.rowIndex),LN.getState().setStatusMessage(`Position ${e} saved (row ${t.rowIndex})`,!1,1e3),!0}function K$(e){const{getPtnJumpPos:t,moveCursorToRow:n}=ID.getState(),s=t(e);return n(s),LN.getState().setStatusMessage(`Position ${e}: row ${s}`,!1,1e3),!0}function $$(){return q$(0)}function Y$(){return q$(1)}function J$(){return q$(2)}function Q$(){return q$(3)}function Z$(){return q$(4)}function eY(){return q$(5)}function tY(){return q$(6)}function nY(){return q$(7)}function sY(){return q$(8)}function aY(){return q$(9)}function oY(){return K$(0)}function rY(){return K$(1)}function iY(){return K$(2)}function lY(){return K$(3)}function cY(){return K$(4)}function uY(){return K$(5)}function dY(){return K$(6)}function mY(){return K$(7)}function pY(){return K$(8)}function hY(){return K$(9)}function fY(){return ID.getState().moveCursorToRow(0),!0}function gY(){const{patterns:e,currentPatternIndex:t,moveCursorToRow:n}=ID.getState(),s=e[t];return s&&n(s.length-1),!0}function bY(){return ID.getState().moveCursorToRow(0),LN.getState().setStatusMessage("Song start",!1,800),!0}function vY(){const{patterns:e,moveCursorToRow:t}=ID.getState(),n=e[e.length-1];return n&&t(n.length-1),LN.getState().setStatusMessage("Song end",!1,800),!0}function yY(){return ID.getState().moveCursorToChannel(0),!0}function xY(){const{patterns:e,currentPatternIndex:t,moveCursorToChannel:n}=ID.getState(),s=e[t];return s?.channels&&n(s.channels.length-1),!0}function NY(){return LN.getState().setStatusMessage("Go to row: type row number",!1,1500),!0}function wY(){return LN.getState().setStatusMessage("Go to pattern: use pattern list",!1,1500),!0}function EY(){return LN.getState().setStatusMessage("Go to order: use pattern list",!1,1500),!0}function kY(){return LN.getState().setStatusMessage("Go to time: not yet available",!1,1500),!0}function DY(){ID.getState().nextBookmark();const{cursor:e}=ID.getState();return LN.getState().setStatusMessage(`Bookmark: row ${e.rowIndex}`,!1,800),!0}function SY(){ID.getState().prevBookmark();const{cursor:e}=ID.getState();return LN.getState().setStatusMessage(`Bookmark: row ${e.rowIndex}`,!1,800),!0}function MY(){const{cursor:e,toggleBookmark:t}=ID.getState();t(e.rowIndex);const n=ID.getState().bookmarks.includes(e.rowIndex);return LN.getState().setStatusMessage(`Bookmark row ${e.rowIndex}: ${n?"set":"cleared"}`,!1,1e3),!0}function CY(){return ID.getState().clearBookmarks(),LN.getState().setStatusMessage("Bookmarks cleared",!1,1e3),!0}const VY={1:{panels:["tracker","pattern-list"],view:"tracker",label:"Pattern Editor"},2:{panels:["tracker","pattern-list","oscilloscope"],view:"tracker",label:"Pattern + Scopes"},3:{panels:["tracker","pattern-list","instrument-editor"],view:"tracker",label:"Pattern + Instruments"},4:{panels:["instrument-editor"],view:"tracker",label:"Instrument Editor"},5:{panels:["tracker","automation"],view:"tracker",label:"Pattern + Automation"},6:{panels:["tracker","pattern-list","oscilloscope","instrument-editor"],view:"tracker",label:"Full View"},7:{panels:["arrangement"],view:"arrangement",label:"Arrangement"},8:{panels:["tracker","oscilloscope","instrument-editor","automation","pattern-list"],view:"tracker",label:"All Panels"}};function PY(e){const t=VY[e];return t?(LN.setState({visiblePanels:t.panels,activeView:t.view,activePanel:t.panels[0]}),LN.getState().setStatusMessage(`Layout: ${t.label}`,!1,1e3),!0):(LN.getState().setStatusMessage(`Layout ${e} not defined`,!1,1e3),!0)}function _Y(){return PY(1)}function OY(){return PY(2)}function TY(){return PY(3)}function LY(){return PY(4)}function AY(){return PY(5)}function BY(){return PY(6)}function IY(){return PY(7)}function FY(){return PY(8)}function UY(e){const{visiblePanels:t,activeView:n}=LN.getState();return LN.getState().setStatusMessage(`Layout ${e} saved`,!1,1e3),!0}function RY(){return UY(1)}function jY(){return UY(2)}function XY(){return UY(3)}function zY(){return UY(4)}function GY(){return UY(5)}function HY(){return UY(6)}function WY(){return UY(7)}function qY(){return UY(8)}function KY(){return LN.getState().setShowFileBrowser(!0),!0}function $Y(){LN.getState().togglePanel("instrument-editor");const e=LN.getState().visiblePanels.includes("instrument-editor");return LN.getState().setStatusMessage("Instrument panel: "+(e?"shown":"hidden"),!1,1e3),!0}function YY(){return LN.getState().togglePanel("instrument-editor"),LN.getState().setStatusMessage("Sample panel (instrument editor)",!1,1e3),!0}function JY(){return LN.getState().setStatusMessage("Mixer: not available",!1,1e3),!0}function QY(){LN.getState().togglePanel("automation");const e=LN.getState().visiblePanels.includes("automation");return LN.getState().setStatusMessage("Automation: "+(e?"shown":"hidden"),!1,1e3),!0}function ZY(){LN.getState().toggleOscilloscopeVisible();const e=LN.getState().oscilloscopeVisible;return LN.getState().setStatusMessage("Track scopes: "+(e?"ON":"OFF"),!1,1e3),!0}function eJ(){return ZY()}function tJ(){const{activePanel:e}=LN.getState();return LN.setState({visiblePanels:[e]}),LN.getState().setStatusMessage("Panel maximized",!1,1e3),!0}function nJ(){return LN.setState({visiblePanels:["tracker","oscilloscope","pattern-list"]}),LN.getState().setStatusMessage("Panels restored",!1,1e3),!0}const sJ={tracker:"Pattern Editor","pattern-list":"Pattern List","instrument-editor":"Instrument Editor",oscilloscope:"Oscilloscope",automation:"Automation",arrangement:"Arrangement"};function aJ(){const{visiblePanels:e,activePanel:t,setActivePanel:n,setStatusMessage:s}=LN.getState(),a=e.indexOf(t),o=e[(a+1)%e.length];return o&&(n(o),s(`Panel: ${sJ[o]??o}`,!1,1e3)),!0}function oJ(){const{visiblePanels:e,activePanel:t,setActivePanel:n,setStatusMessage:s}=LN.getState(),a=e.indexOf(t),o=e[(a-1+e.length)%e.length];return o&&(n(o),s(`Panel: ${sJ[o]??o}`,!1,1e3)),!0}function rJ(){LN.getState().toggleTB303Collapsed();const e=LN.getState().tb303Collapsed;return LN.getState().setStatusMessage("TB-303: "+(e?"hidden":"shown"),!1,1e3),!0}function iJ(){LN.getState().toggleOscilloscopeVisible();const e=LN.getState().oscilloscopeVisible;return LN.getState().setStatusMessage("Oscilloscope: "+(e?"shown":"hidden"),!1,1e3),!0}function lJ(){LN.getState().toggleActiveView();const e=LN.getState().activeView;return LN.getState().setStatusMessage(`View: ${e}`,!1,1e3),!0}function cJ(){const{isPlaying:e,stop:t}=jN.getState();return e&&(pD().stop(),t()),Bw().releaseAll(),LN.getState().setStatusMessage("PANIC - All notes off",!1,1e3),!0}function uJ(){return Bw().releaseAll(),LN.getState().setStatusMessage("",!1,1),!0}function dJ(){ID.getState().toggleRecordMode();const e=ID.getState().recordMode;return LN.getState().setStatusMessage("Recording "+(e?"ON":"OFF"),!1,1e3),!0}function mJ(){const{useHexNumbers:e,setUseHexNumbers:t}=LN.getState();return t(!e),LN.getState().setStatusMessage("Hex mode: "+(e?"OFF":"ON"),!1,1e3),!0}function pJ(){const{trackerZoom:e,setTrackerZoom:t}=LN.getState();return t(e+10),LN.getState().setStatusMessage(`Zoom ${LN.getState().trackerZoom}%`,!1,800),!0}function hJ(){const{trackerZoom:e,setTrackerZoom:t}=LN.getState();return t(e-10),LN.getState().setStatusMessage(`Zoom ${LN.getState().trackerZoom}%`,!1,800),!0}function fJ(){return LN.getState().setTrackerZoom(100),LN.getState().setStatusMessage("Zoom 100%",!1,800),!0}function gJ(){return LN.getState().setTrackerZoom(100),LN.getState().setStatusMessage("Fit to window",!1,800),!0}function bJ(){LN.getState().toggleCompactToolbar();const e=LN.getState().compactToolbar;return LN.getState().setStatusMessage("Compact mode: "+(e?"ON":"OFF"),!1,1e3),!0}function vJ(){const{rowHighlightInterval:e,setRowHighlightInterval:t}=LN.getState(),n=[4,8,16,32],s=n[(n.indexOf(e)+1)%n.length];return t(s),LN.getState().setStatusMessage(`Row highlight: every ${s}`,!1,1e3),!0}function yJ(){LN.getState().toggleChannelNames();const e=LN.getState().showChannelNames;return LN.getState().setStatusMessage("Channel names: "+(e?"ON":"OFF"),!1,1e3),!0}function xJ(){const{cursor:e,setCell:t,moveCursor:n}=ID.getState();return t(e.channelIndex,e.rowIndex,{note:97,instrument:0}),n("down"),LN.getState().setStatusMessage("Key off",!1,600),!0}function NJ(){const{cursor:e,setCell:t,moveCursor:n}=ID.getState();return t(e.channelIndex,e.rowIndex,{effTyp:14,eff:192}),n("down"),LN.getState().setStatusMessage("Note cut",!1,600),!0}function wJ(){return xJ()}function EJ(){return ID.getState().addPattern(),LN.getState().setStatusMessage("Pattern created",!1,1e3),!0}function kJ(){const{currentPatternIndex:e,deletePattern:t,patterns:n}=ID.getState();return n.length<=1?(LN.getState().setStatusMessage("Cannot delete last pattern",!1,1500),!0):(t(e),LN.getState().setStatusMessage("Pattern deleted",!1,1e3),!0)}function DJ(){const{currentPatternIndex:e,duplicatePattern:t}=ID.getState();return t(e),LN.getState().setStatusMessage("Pattern cloned",!1,1e3),!0}function SJ(){const{currentPatternIndex:e,expandPattern:t}=ID.getState();t(e);const n=ID.getState().patterns[e]?.length??0;return LN.getState().setStatusMessage(`Pattern: ${n} rows`,!1,1e3),!0}function MJ(){const{currentPatternIndex:e,shrinkPattern:t}=ID.getState();t(e);const n=ID.getState().patterns[e]?.length??0;return LN.getState().setStatusMessage(`Pattern: ${n} rows`,!1,1e3),!0}function CJ(){return LN.getState().openDialogCommand("groove-settings"),!0}function VJ(){return LN.getState().openDialogCommand("humanize"),!0}function PJ(){return LN.getState().openDialogCommand("keyboard-help"),!0}function _J(){return LN.getState().openDialogCommand("groove-settings"),!0}function OJ(){return LN.getState().closeDialogCommand(),LN.getState().closeModal(),!0}const TJ=[];function LJ(){const e=performance.now();for(TJ.push(e);TJ.length>1&&e-TJ[0]>3e3;)TJ.shift();if(TJ.length>=2){const e=TJ.slice(1).map((e,t)=>e-TJ[t]),t=e.reduce((e,t)=>e+t,0)/e.length,n=Math.round(6e4/t);jN.getState().setBPM(n),LN.getState().setStatusMessage(`Tap BPM: ${n}`,!1,1500)}else LN.getState().setStatusMessage("Tap again...",!1,1500);return!0}function AJ(){return _X().then(e=>{LN.getState().setStatusMessage(e?"Saved":"Save failed",!1,1500)}),!0}function BJ(){return os(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>Iw);return{getToneEngine:e}},void 0).then(({getToneEngine:e})=>{os(async()=>{const{useInstrumentStore:e}=await Promise.resolve().then(()=>kN);return{useInstrumentStore:e}},void 0).then(({useInstrumentStore:t})=>{const n=e(),{currentInstrument:s}=t.getState();s&&n.ensureInstrumentReady(s).then(()=>{n.triggerNoteAttack(s.id,"A4",0,.8,s)})})}),LN.getState().setStatusMessage("Preview",!1,600),!0}function IJ(){return BJ()}function FJ(){return Bw().releaseAll(),!0}function UJ(){return LN.getState().setStatusMessage("Render: not yet available",!1,1500),!0}function RJ(){return UJ()}function jJ(){return UJ()}function XJ(){return UJ()}function zJ(){return LN.getState().setStatusMessage("MIDI import: use File menu",!1,1500),!0}function GJ(){return zJ()}function HJ(){return zJ()}function WJ(){return zJ()}function qJ(){return LN.getState().setStatusMessage("Pattern length: resize in pattern list",!1,1500),!0}function KJ(){return LN.getState().openModal("settings"),!0}function $J(){return LN.getState().setStatusMessage("Cleanup: remove unused in instrument list",!1,1500),!0}function YJ(){return LN.getState().openDialogCommand("groove-settings"),!0}function JJ(){return LN.getState().setStatusMessage("Scripts: not available",!1,1500),!0}function QJ(){return JJ()}function ZJ(){return LN.getState().setStatusMessage("DEViLBOX  tracker + synth environment",!1,3e3),!0}function eQ(){return LN.getState().setStatusMessage("Manual: see Help menu",!1,2e3),!0}function tQ(){return LN.getState().setStatusMessage("Cursor centered",!1,800),!0}function nQ(){return LN.getState().setStatusMessage("Revert: refresh page to reload saved",!1,2e3),!0}function sQ(){return LN.setState({visiblePanels:["tracker","oscilloscope","pattern-list"]}),LN.getState().setStatusMessage("View reset",!1,1e3),!0}function aQ(){return LN.getState().setStatusMessage("Right-click for context menu",!1,1500),!0}function oQ(){return LN.getState().setStatusMessage("Command palette: not yet available",!1,1500),!0}function rQ(){const{decks:e}=W_.getState();return e.B.isPlaying&&!e.A.isPlaying?"B":!e.C.isPlaying||e.A.isPlaying||e.B.isPlaying?"A":"C"}function iQ(e){const t=rQ(),n=W_.getState(),s=n.decks[t].activePatternName;try{const a=pO().getDeck(t);if(s===e)return a.stopPattern(),n.setDeckPattern(t,null),LN.getState().setStatusMessage("Scratch: stopped",!1,800),!0;if(null!==s)return!0;let o=0;a.playPattern(e,s=>{o=s,setTimeout(()=>n.setDeckPattern(t,e),s),LN.getState().setStatusMessage(`Scratch: ${e} (waiting)`,!1,s+200)}),0===o&&(n.setDeckPattern(t,e),LN.getState().setStatusMessage(`Scratch: ${e}`,!1,1200))}catch{LN.getState().setStatusMessage("DJ engine not active",!1,1e3)}return!0}function lQ(e){const t=rQ(),n=W_.getState();try{const s=pO().getDeck(t),{faderLFOActive:a,faderLFODivision:o}=n.decks[t];null===e||a&&o===e?(s.stopFaderLFO(),n.setDeckFaderLFO(t,!1),LN.getState().setStatusMessage("Fader LFO: OFF",!1,800)):(s.startFaderLFO(e),n.setDeckFaderLFO(t,!0,e),LN.getState().setStatusMessage(`Fader LFO: ${e}`,!1,1e3))}catch{LN.getState().setStatusMessage("DJ engine not active",!1,1e3)}return!0}function cQ(){return iQ(VP[0].name)}function uQ(){return iQ(VP[1].name)}function dQ(){return iQ(VP[2].name)}function mQ(){return iQ(VP[3].name)}function pQ(){return iQ(VP[4].name)}function hQ(){return iQ(VP[5].name)}function fQ(){return iQ(VP[6].name)}function gQ(){return iQ(VP[7].name)}function bQ(){return iQ(VP[8].name)}function vQ(){return iQ(VP[9].name)}function yQ(){return iQ(VP[10].name)}function xQ(){return iQ(VP[11].name)}function NQ(){return iQ(VP[12].name)}function wQ(){return iQ(VP[13].name)}function EQ(){return iQ(VP[14].name)}function kQ(){return iQ(VP[15].name)}function DQ(){return iQ(VP[16].name)}function SQ(){return iQ(VP[17].name)}function MQ(){return iQ(VP[18].name)}function CQ(){const e=rQ(),t=W_.getState();try{pO().getDeck(e).stopPattern(),t.setDeckPattern(e,null),LN.getState().setStatusMessage("Scratch: stopped",!1,800)}catch{}return!0}function VQ(){return lQ(null)}function PQ(){return lQ("1/4")}function _Q(){return lQ("1/8")}function OQ(){return lQ("1/16")}function TQ(){return lQ("1/32")}function LQ(){return UP().setFaderCut(!0),LN.getState().setStatusMessage("Fader: CUT",!1,300),!0}function AQ(){return UP().setFaderCut(!1),!0}function BQ(){return UP().startFaderPattern("Crab"),LN.getState().setStatusMessage("CRAB scratch",!1,300),!0}function IQ(){return UP().stopFaderPattern(),!0}function FQ(){return UP().startFaderPattern("Transformer"),LN.getState().setStatusMessage("TRANSFORMER scratch",!1,300),!0}function UQ(){return UP().stopFaderPattern(),!0}function RQ(){return UP().startFaderPattern("Flare"),LN.getState().setStatusMessage("FLARE scratch",!1,300),!0}function jQ(){return UP().stopFaderPattern(),!0}function XQ(e){const t=UP();t.toggleFaderPattern(e);const n=t.activePatternName?`Scratch: ${t.activePatternName}`:"Scratch: stopped";return LN.getState().setStatusMessage(n,!1,1e3),!0}function zQ(){return XQ(VP[1].name)}function GQ(){return XQ(VP[4].name)}function HQ(){return XQ(VP[2].name)}function WQ(){return XQ(VP[6].name)}function qQ(){return XQ(VP[7].name)}function KQ(){return XQ(VP[12].name)}function $Q(){return XQ(VP[11].name)}function YQ(){return UP().stopFaderPattern(),LN.getState().setStatusMessage("Scratch: stopped",!1,800),!0}function JQ(){return UP().triggerSpinback(),LN.getState().setStatusMessage("SPINBACK",!1,1e3),!0}function QQ(){return UP().triggerPowerCut(),LN.getState().setStatusMessage("POWER OFF",!1,2e3),!0}const ZQ=new class{commands=new Map;register(e){this.commands.set(e.name,e)}execute(e,t){const n=this.commands.get(e);return!!n&&(!!n.contexts.includes(t)&&n.handler())}release(e,t){const n=this.commands.get(e);return!!n?.releaseHandler&&(!!n.contexts.includes(t)&&n.releaseHandler())}hasReleaseHandler(e){return!!this.commands.get(e)?.releaseHandler}getCommand(e){return this.commands.get(e)}getAllCommands(){return Array.from(this.commands.values())}getCommandsForContext(e){return this.getAllCommands().filter(t=>t.contexts.includes(e))}};let eZ=!1;function tZ(e){const{cursor:t,setCell:n}=ID.getState();return n(t.channelIndex,t.rowIndex,{volume:e}),!0}function nZ(e){return()=>{const{cursor:t,patterns:n,currentPatternIndex:s,setCell:a}=ID.getState(),o=n[s]?.channels[t.channelIndex]?.rows[t.rowIndex];if(!o)return!0;const r=Math.max(0,Math.min(64,(o.volume||0)+e));return a(t.channelIndex,t.rowIndex,{volume:r}),!0}}function sZ(){const e=document.activeElement;return e?.closest('[role="dialog"]')||e?.closest(".modal")?"dialog":e?.closest('[data-context="sample"]')||e?.closest(".sample-editor")?"sample":e?.closest('[data-context="pattern"]')||e?.closest(".pattern-editor")?"pattern":"global"}function aZ(e={}){const{disabled:t=!1}=e,{activeScheme:n,platformOverride:s}=dR(),a=l.useRef(new SH),o=l.useRef(null),r=l.useRef(new Map);l.useEffect(()=>{!function(){if(eZ)return;[{name:"play_row",contexts:["pattern"],handler:()=>(CH(),!0),description:"Play the current row (audition)"},{name:"play_from_cursor",contexts:["pattern","global"],handler:VH,description:"Start playback from cursor position"},{name:"play_stop_toggle",contexts:["pattern","global"],handler:_H,description:"Toggle play/stop"},{name:"play_pattern",contexts:["pattern","global"],handler:OH,description:"Play current pattern from start"},{name:"play_song",contexts:["pattern","global"],handler:TH,description:"Play song from beginning"},{name:"stop",contexts:["pattern","global"],handler:LH,description:"Stop playback"},{name:"stop_and_reset",contexts:["pattern","global"],handler:LH,description:"Stop and reset position"},{name:"cursor_up",contexts:["pattern"],handler:AH,description:"Move cursor up"},{name:"cursor_down",contexts:["pattern"],handler:BH,description:"Move cursor down"},{name:"cursor_left",contexts:["pattern"],handler:IH,description:"Move cursor left"},{name:"cursor_right",contexts:["pattern"],handler:FH,description:"Move cursor right"},{name:"cursor_page_up",contexts:["pattern"],handler:UH,description:"Move cursor up one page"},{name:"cursor_page_down",contexts:["pattern"],handler:RH,description:"Move cursor down one page"},{name:"cursor_home",contexts:["pattern"],handler:jH,description:"Move to start of row"},{name:"cursor_end",contexts:["pattern"],handler:XH,description:"Move to end of row"},{name:"cursor_row_start",contexts:["pattern"],handler:ZH,description:"Move to start of row"},{name:"cursor_row_end",contexts:["pattern"],handler:eW,description:"Move to end of row"},{name:"cursor_pattern_start",contexts:["pattern"],handler:zH,description:"Move to start of pattern"},{name:"cursor_pattern_end",contexts:["pattern"],handler:GH,description:"Move to end of pattern"},{name:"next_channel",contexts:["pattern"],handler:HH,description:"Move to next channel"},{name:"prev_channel",contexts:["pattern"],handler:WH,description:"Move to previous channel"},{name:"next_column",contexts:["pattern"],handler:qH,description:"Move to next column"},{name:"prev_column",contexts:["pattern"],handler:KH,description:"Move to previous column"},{name:"next_track",contexts:["pattern"],handler:HH,description:"Move to next track"},{name:"prev_track",contexts:["pattern"],handler:WH,description:"Move to previous track"},{name:"jump_to_row_0",contexts:["pattern"],handler:$H,description:"Jump to row 0"},{name:"jump_to_row_16",contexts:["pattern"],handler:YH,description:"Jump to row 16"},{name:"jump_to_row_32",contexts:["pattern"],handler:JH,description:"Jump to row 32"},{name:"jump_to_row_48",contexts:["pattern"],handler:QH,description:"Jump to row 48"},{name:"block_start",contexts:["pattern"],handler:zH,description:"Go to block/pattern start"},{name:"block_end",contexts:["pattern"],handler:GH,description:"Go to block/pattern end"},{name:"song_start",contexts:["pattern","global"],handler:zH,description:"Go to song start"},{name:"song_end",contexts:["pattern","global"],handler:GH,description:"Go to song end"},{name:"page_up",contexts:["pattern"],handler:UH,description:"Page up"},{name:"page_down",contexts:["pattern"],handler:RH,description:"Page down"},{name:"delete_note",contexts:["pattern"],handler:lW,description:"Delete note at cursor"},{name:"delete_and_pull",contexts:["pattern"],handler:cW,description:"Delete and pull up rows"},{name:"delete_and_pull_up",contexts:["pattern"],handler:cW,description:"Delete and pull up rows"},{name:"delete_line",contexts:["pattern"],handler:cW,description:"Delete line"},{name:"insert_row",contexts:["pattern"],handler:uW,description:"Insert empty row"},{name:"insert_line",contexts:["pattern"],handler:uW,description:"Insert empty line"},{name:"toggle_edit_mode",contexts:["pattern","global"],handler:dW,description:"Toggle edit/record mode"},{name:"toggle_insert_mode",contexts:["pattern"],handler:HW,description:"Toggle insert/overwrite mode"},{name:"clear_pattern",contexts:["pattern"],handler:mW,description:"Clear entire pattern"},{name:"clear_channel",contexts:["pattern"],handler:pW,description:"Clear current channel"},{name:"advance_to_next_row",contexts:["pattern"],handler:WW,description:"Advance to next row"},{name:"next_pattern",contexts:["pattern","global"],handler:qW,description:"Go to next pattern"},{name:"prev_pattern",contexts:["pattern","global"],handler:KW,description:"Go to previous pattern"},{name:"next_block",contexts:["pattern","global"],handler:qW,description:"Go to next block"},{name:"prev_block",contexts:["pattern","global"],handler:KW,description:"Go to previous block"},{name:"clone_pattern",contexts:["pattern","global"],handler:PH,description:"Clone the current pattern"},{name:"mute_channel",contexts:["pattern"],handler:$W,description:"Mute current channel"},{name:"mute_track",contexts:["pattern"],handler:$W,description:"Mute current track"},{name:"solo_channel",contexts:["pattern"],handler:YW,description:"Solo current channel"},{name:"solo_track",contexts:["pattern"],handler:YW,description:"Solo current track"},{name:"unmute_all",contexts:["pattern","global"],handler:JW,description:"Unmute all channels"},{name:"set_track_1",contexts:["pattern"],handler:ZW,description:"Select track 1"},{name:"set_track_2",contexts:["pattern"],handler:eq,description:"Select track 2"},{name:"set_track_3",contexts:["pattern"],handler:tq,description:"Select track 3"},{name:"set_track_4",contexts:["pattern"],handler:nq,description:"Select track 4"},{name:"set_track_5",contexts:["pattern"],handler:sq,description:"Select track 5"},{name:"set_track_6",contexts:["pattern"],handler:aq,description:"Select track 6"},{name:"set_track_7",contexts:["pattern"],handler:oq,description:"Select track 7"},{name:"set_track_8",contexts:["pattern"],handler:rq,description:"Select track 8"},{name:"copy_selection",contexts:["pattern"],handler:iq,description:"Copy selection"},{name:"cut_selection",contexts:["pattern"],handler:lq,description:"Cut selection"},{name:"paste_selection",contexts:["pattern"],handler:cq,description:"Paste"},{name:"select_all",contexts:["pattern"],handler:uq,description:"Select all"},{name:"select_pattern",contexts:["pattern"],handler:uq,description:"Select pattern"},{name:"select_channel",contexts:["pattern"],handler:dq,description:"Select channel"},{name:"select_column",contexts:["pattern"],handler:mq,description:"Select column"},{name:"mark_block_start",contexts:["pattern"],handler:pq,description:"Mark block start"},{name:"mark_block_end",contexts:["pattern"],handler:hq,description:"Mark block end"},{name:"mark_block",contexts:["pattern"],handler:pq,description:"Start marking block"},{name:"unmark_block",contexts:["pattern"],handler:fq,description:"Clear block selection"},{name:"copy_track",contexts:["pattern"],handler:gq,description:"Copy track"},{name:"cut_track",contexts:["pattern"],handler:bq,description:"Cut track"},{name:"paste_track",contexts:["pattern"],handler:vq,description:"Paste track"},{name:"copy_channel",contexts:["pattern"],handler:gq,description:"Copy channel"},{name:"paste_channel",contexts:["pattern"],handler:vq,description:"Paste channel"},{name:"copy_pattern",contexts:["pattern"],handler:iq,description:"Copy pattern"},{name:"paste_pattern",contexts:["pattern"],handler:cq,description:"Paste pattern"},{name:"copy_block",contexts:["pattern"],handler:iq,description:"Copy block"},{name:"cut_block",contexts:["pattern"],handler:lq,description:"Cut block"},{name:"paste_block",contexts:["pattern"],handler:cq,description:"Paste block"},{name:"transpose_up",contexts:["pattern"],handler:yq,description:"Transpose up 1 semitone"},{name:"transpose_down",contexts:["pattern"],handler:xq,description:"Transpose down 1 semitone"},{name:"transpose_octave_up",contexts:["pattern"],handler:Nq,description:"Transpose up 1 octave"},{name:"transpose_octave_down",contexts:["pattern"],handler:wq,description:"Transpose down 1 octave"},{name:"transpose_block_up",contexts:["pattern"],handler:Eq,description:"Transpose block up"},{name:"transpose_block_down",contexts:["pattern"],handler:kq,description:"Transpose block down"},{name:"transpose_block_octave_up",contexts:["pattern"],handler:Dq,description:"Transpose block up octave"},{name:"transpose_block_octave_down",contexts:["pattern"],handler:Sq,description:"Transpose block down octave"},{name:"transpose_track_up",contexts:["pattern"],handler:Mq,description:"Transpose track up"},{name:"transpose_track_down",contexts:["pattern"],handler:Cq,description:"Transpose track down"},{name:"prev_instrument",contexts:["pattern","global"],handler:Vq,description:"Previous instrument"},{name:"next_instrument",contexts:["pattern","global"],handler:Pq,description:"Next instrument"},{name:"prev_sample",contexts:["pattern","global"],handler:Vq,description:"Previous sample"},{name:"next_sample",contexts:["pattern","global"],handler:Pq,description:"Next sample"},{name:"set_instrument_1",contexts:["pattern"],handler:Oq,description:"Select instrument 1"},{name:"set_instrument_2",contexts:["pattern"],handler:Tq,description:"Select instrument 2"},{name:"set_instrument_3",contexts:["pattern"],handler:Lq,description:"Select instrument 3"},{name:"set_instrument_4",contexts:["pattern"],handler:Aq,description:"Select instrument 4"},{name:"set_instrument_5",contexts:["pattern"],handler:Bq,description:"Select instrument 5"},{name:"set_instrument_6",contexts:["pattern"],handler:Iq,description:"Select instrument 6"},{name:"set_instrument_7",contexts:["pattern"],handler:Fq,description:"Select instrument 7"},{name:"set_instrument_8",contexts:["pattern"],handler:Uq,description:"Select instrument 8"},{name:"set_instrument_9",contexts:["pattern"],handler:Rq,description:"Select instrument 9"},{name:"set_instrument_10",contexts:["pattern"],handler:jq,description:"Select instrument 10"},{name:"prev_octave",contexts:["pattern","global"],handler:Xq,description:"Previous octave"},{name:"next_octave",contexts:["pattern","global"],handler:zq,description:"Next octave"},{name:"set_octave_0",contexts:["pattern"],handler:fW,description:"Set octave 0"},{name:"set_octave_1",contexts:["pattern"],handler:gW,description:"Set octave 1"},{name:"set_octave_2",contexts:["pattern"],handler:bW,description:"Set octave 2"},{name:"set_octave_3",contexts:["pattern"],handler:vW,description:"Set octave 3"},{name:"set_octave_4",contexts:["pattern"],handler:yW,description:"Set octave 4"},{name:"set_octave_5",contexts:["pattern"],handler:xW,description:"Set octave 5"},{name:"set_octave_6",contexts:["pattern"],handler:NW,description:"Set octave 6"},{name:"set_octave_7",contexts:["pattern"],handler:wW,description:"Set octave 7"},{name:"select_octave_1",contexts:["pattern"],handler:gW,description:"Select octave 1"},{name:"select_octave_2",contexts:["pattern"],handler:bW,description:"Select octave 2"},{name:"select_octave_3",contexts:["pattern"],handler:vW,description:"Select octave 3"},{name:"select_octave_1_low",contexts:["pattern"],handler:fW,description:"Select low octave 1"},{name:"select_octave_2_low",contexts:["pattern"],handler:gW,description:"Select low octave 2"},{name:"select_octave_3_low",contexts:["pattern"],handler:bW,description:"Select low octave 3"},{name:"set_step_0",contexts:["pattern"],handler:SW,description:"Set edit step 0"},{name:"set_step_1",contexts:["pattern"],handler:MW,description:"Set edit step 1"},{name:"set_step_2",contexts:["pattern"],handler:CW,description:"Set edit step 2"},{name:"set_step_3",contexts:["pattern"],handler:VW,description:"Set edit step 3"},{name:"set_step_4",contexts:["pattern"],handler:PW,description:"Set edit step 4"},{name:"set_step_5",contexts:["pattern"],handler:_W,description:"Set edit step 5"},{name:"set_step_6",contexts:["pattern"],handler:OW,description:"Set edit step 6"},{name:"set_step_7",contexts:["pattern"],handler:TW,description:"Set edit step 7"},{name:"set_step_8",contexts:["pattern"],handler:LW,description:"Set edit step 8"},{name:"set_step_9",contexts:["pattern"],handler:AW,description:"Set edit step 9"},{name:"undo",contexts:["pattern","global"],handler:Gq,description:"Undo"},{name:"redo",contexts:["pattern","global"],handler:Hq,description:"Redo"},{name:"set_octave_8",contexts:["pattern"],handler:EW,description:"Set octave 8"},{name:"set_octave_9",contexts:["pattern"],handler:kW,description:"Set octave 9"},{name:"set_step_10",contexts:["pattern"],handler:BW,description:"Set edit step 10"},{name:"set_step_11",contexts:["pattern"],handler:IW,description:"Set edit step 11"},{name:"set_step_12",contexts:["pattern"],handler:FW,description:"Set edit step 12"},{name:"set_step_13",contexts:["pattern"],handler:UW,description:"Set edit step 13"},{name:"set_step_14",contexts:["pattern"],handler:RW,description:"Set edit step 14"},{name:"set_step_15",contexts:["pattern"],handler:jW,description:"Set edit step 15"},{name:"set_step_16",contexts:["pattern"],handler:XW,description:"Set edit step 16"},{name:"increase_step",contexts:["pattern"],handler:zW,description:"Increase edit step"},{name:"decrease_step",contexts:["pattern"],handler:GW,description:"Decrease edit step"},{name:"increase_spacing",contexts:["pattern"],handler:tW,description:"Increase row spacing"},{name:"decrease_spacing",contexts:["pattern"],handler:nW,description:"Decrease row spacing"},{name:"cursor_up_by_highlight",contexts:["pattern"],handler:sW,description:"Move up by highlight"},{name:"cursor_down_by_highlight",contexts:["pattern"],handler:aW,description:"Move down by highlight"},{name:"jump_to_quarter_1",contexts:["pattern"],handler:oW,description:"Jump to 1/4 mark"},{name:"jump_to_quarter_2",contexts:["pattern"],handler:rW,description:"Jump to 2/4 mark"},{name:"jump_to_quarter_3",contexts:["pattern"],handler:iW,description:"Jump to 3/4 mark"},{name:"toggle_fullscreen",contexts:["global"],handler:lK,description:"Toggle fullscreen"},{name:"show_help",contexts:["global"],handler:Wq,description:"Show help"},{name:"view_general",contexts:["global"],handler:tK,description:"View general"},{name:"view_pattern",contexts:["global"],handler:nK,description:"View pattern"},{name:"view_samples",contexts:["global"],handler:sK,description:"View samples"},{name:"view_instruments",contexts:["global"],handler:aK,description:"View instruments"},{name:"view_comments",contexts:["global"],handler:oK,description:"View comments"},{name:"open_pattern_editor",contexts:["global"],handler:qq,description:"Open pattern editor"},{name:"open_sample_editor",contexts:["global"],handler:Kq,description:"Open sample editor"},{name:"open_instrument_editor",contexts:["global"],handler:$q,description:"Open instrument editor"},{name:"show_sample_editor",contexts:["global"],handler:Kq,description:"Show sample editor"},{name:"show_instrument_editor",contexts:["global"],handler:$q,description:"Show instrument editor"},{name:"show_synth_editor",contexts:["global"],handler:Yq,description:"Show synth editor"},{name:"open_message_editor",contexts:["global"],handler:Jq,description:"Open message editor"},{name:"order_list",contexts:["global"],handler:Qq,description:"Show order list"},{name:"show_order_list",contexts:["global"],handler:Qq,description:"Show order list"},{name:"configure",contexts:["global"],handler:Zq,description:"Open settings"},{name:"open_settings",contexts:["global"],handler:Zq,description:"Open settings"},{name:"toggle_tree_view",contexts:["global"],handler:eK,description:"Toggle tree view"},{name:"view_midi_mapping",contexts:["global"],handler:rK,description:"View MIDI mapping"},{name:"view_options",contexts:["global"],handler:iK,description:"View options"},{name:"show_files_panel",contexts:["global"],handler:cK,description:"Show files panel"},{name:"show_play_panel",contexts:["global"],handler:uK,description:"Show play panel"},{name:"show_instruments_panel",contexts:["global"],handler:dK,description:"Show instruments panel"},{name:"show_block_panel",contexts:["global"],handler:mK,description:"Show block panel"},{name:"show_edit_panel",contexts:["global"],handler:pK,description:"Show edit panel"},{name:"show_misc_panel",contexts:["global"],handler:hK,description:"Show misc panel"},{name:"show_volume_panel",contexts:["global"],handler:fK,description:"Show volume panel"},{name:"show_midi_panel",contexts:["global"],handler:gK,description:"Show MIDI panel"},{name:"show_transpose_panel",contexts:["global"],handler:bK,description:"Show transpose panel"},{name:"show_range_panel",contexts:["global"],handler:vK,description:"Show range panel"},{name:"new_file",contexts:["global"],handler:wK,description:"New file"},{name:"open_file",contexts:["global"],handler:EK,description:"Open file"},{name:"close_file",contexts:["global"],handler:kK,description:"Close file"},{name:"save_file",contexts:["global"],handler:DK,description:"Save file"},{name:"save_as",contexts:["global"],handler:SK,description:"Save as"},{name:"new_project",contexts:["global"],handler:MK,description:"New project"},{name:"open_project",contexts:["global"],handler:CK,description:"Open project"},{name:"save_project",contexts:["global"],handler:VK,description:"Save project"},{name:"new_song",contexts:["global"],handler:PK,description:"New song"},{name:"load_song",contexts:["global"],handler:_K,description:"Load song"},{name:"save_song",contexts:["global"],handler:OK,description:"Save song"},{name:"load_module",contexts:["global"],handler:TK,description:"Load module"},{name:"save_module",contexts:["global"],handler:LK,description:"Save module"},{name:"interpolate_volume",contexts:["pattern"],handler:AK,description:"Interpolate volume"},{name:"interpolate_effect",contexts:["pattern"],handler:BK,description:"Interpolate effect"},{name:"amplify_selection",contexts:["pattern"],handler:IK,description:"Amplify selection"},{name:"apply_current_instrument",contexts:["pattern"],handler:FK,description:"Apply instrument to selection"},{name:"expand_pattern",contexts:["pattern"],handler:UK,description:"Expand pattern"},{name:"shrink_pattern",contexts:["pattern"],handler:RK,description:"Shrink pattern"},{name:"grow_selection",contexts:["pattern"],handler:jK,description:"Grow selection"},{name:"shrink_selection",contexts:["pattern"],handler:XK,description:"Shrink selection"},{name:"duplicate_pattern",contexts:["pattern"],handler:zK,description:"Duplicate pattern"},{name:"double_block_length",contexts:["pattern"],handler:GK,description:"Double block length"},{name:"halve_block_length",contexts:["pattern"],handler:HK,description:"Halve block length"},{name:"double_block",contexts:["pattern"],handler:WK,description:"Double block"},{name:"halve_block",contexts:["pattern"],handler:qK,description:"Halve block"},{name:"scale_volume_track",contexts:["pattern"],handler:KK,description:"Scale volume (track)"},{name:"scale_volume_pattern",contexts:["pattern"],handler:$K,description:"Scale volume (pattern)"},{name:"scale_volume_block",contexts:["pattern"],handler:YK,description:"Scale volume (block)"},{name:"swap_channels",contexts:["pattern"],handler:JK,description:"Swap channels"},{name:"split_pattern",contexts:["pattern"],handler:QK,description:"Split pattern"},{name:"join_blocks",contexts:["pattern"],handler:ZK,description:"Join blocks"},{name:"set_pattern_length",contexts:["pattern"],handler:e$,description:"Set pattern length"},{name:"set_bpm",contexts:["global"],handler:t$,description:"Set BPM"},{name:"set_speed",contexts:["global"],handler:n$,description:"Set speed"},{name:"set_tempo",contexts:["global"],handler:s$,description:"Set tempo"},{name:"append_block",contexts:["pattern"],handler:a$,description:"Append block"},{name:"insert_block",contexts:["pattern"],handler:o$,description:"Insert block"},{name:"split_block",contexts:["pattern"],handler:r$,description:"Split block"},{name:"goto_block",contexts:["pattern"],handler:i$,description:"Go to block"},{name:"find_sample",contexts:["global"],handler:l$,description:"Find sample"},{name:"find_replace",contexts:["pattern"],handler:c$,description:"Find and replace"},{name:"find_next",contexts:["pattern"],handler:u$,description:"Find next"},{name:"goto_dialog",contexts:["global"],handler:d$,description:"Go to..."},{name:"quantize_settings",contexts:["global"],handler:m$,description:"Quantize settings"},{name:"paste_overwrite",contexts:["pattern"],handler:p$,description:"Paste (overwrite)"},{name:"paste_insert",contexts:["pattern"],handler:h$,description:"Paste (insert)"},{name:"paste_mix",contexts:["pattern"],handler:f$,description:"Paste (mix)"},{name:"paste_flood",contexts:["pattern"],handler:g$,description:"Paste (flood)"},{name:"push_forward_paste",contexts:["pattern"],handler:b$,description:"Push forward paste"},{name:"cut_row",contexts:["pattern"],handler:v$,description:"Cut row"},{name:"copy_row",contexts:["pattern"],handler:y$,description:"Copy row"},{name:"cut_note",contexts:["pattern"],handler:x$,description:"Cut note"},{name:"clear_note",contexts:["pattern"],handler:N$,description:"Clear note"},{name:"clear_row",contexts:["pattern"],handler:w$,description:"Clear row"},{name:"delete_row_pull_up",contexts:["pattern"],handler:E$,description:"Delete row pull up"},{name:"insert_row_push_down",contexts:["pattern"],handler:k$,description:"Insert row push down"},{name:"copy_pattern_full",contexts:["pattern"],handler:D$,description:"Copy pattern"},{name:"paste_pattern_full",contexts:["pattern"],handler:S$,description:"Paste pattern"},{name:"cut_channel",contexts:["pattern"],handler:M$,description:"Cut channel"},{name:"copy_channel_full",contexts:["pattern"],handler:C$,description:"Copy channel"},{name:"paste_channel_full",contexts:["pattern"],handler:V$,description:"Paste channel"},{name:"toggle_follow_song",contexts:["global"],handler:P$,description:"Toggle follow song"},{name:"toggle_loop_pattern",contexts:["global"],handler:_$,description:"Toggle loop pattern"},{name:"toggle_continuous_scroll",contexts:["global"],handler:O$,description:"Toggle continuous scroll"},{name:"toggle_metronome",contexts:["global"],handler:T$,description:"Toggle metronome"},{name:"toggle_count_in",contexts:["global"],handler:L$,description:"Toggle count-in"},{name:"toggle_midi_input",contexts:["global"],handler:A$,description:"Toggle MIDI input"},{name:"toggle_record_quantize",contexts:["global"],handler:B$,description:"Toggle record quantize"},{name:"toggle_chord_mode",contexts:["global"],handler:I$,description:"Toggle chord mode"},{name:"toggle_wrap_mode",contexts:["pattern"],handler:F$,description:"Toggle wrap mode"},{name:"toggle_auto_record",contexts:["global"],handler:U$,description:"Toggle auto-record"},{name:"toggle_multichannel_record",contexts:["global"],handler:R$,description:"Toggle multi-channel record"},{name:"toggle_pattern_focus",contexts:["global"],handler:j$,description:"Toggle pattern focus"},{name:"toggle_column_visibility",contexts:["pattern"],handler:X$,description:"Toggle column visibility"},{name:"toggle_solo_channel",contexts:["pattern"],handler:z$,description:"Toggle solo channel"},{name:"toggle_mute_channel",contexts:["pattern"],handler:G$,description:"Toggle mute channel"},{name:"toggle_sample_preview",contexts:["global"],handler:H$,description:"Toggle sample preview"},{name:"toggle_plugin_editor",contexts:["global"],handler:W$,description:"Toggle plugin editor"},{name:"save_position_0",contexts:["pattern"],handler:$$,description:"Save position 0"},{name:"save_position_1",contexts:["pattern"],handler:Y$,description:"Save position 1"},{name:"save_position_2",contexts:["pattern"],handler:J$,description:"Save position 2"},{name:"save_position_3",contexts:["pattern"],handler:Q$,description:"Save position 3"},{name:"save_position_4",contexts:["pattern"],handler:Z$,description:"Save position 4"},{name:"save_position_5",contexts:["pattern"],handler:eY,description:"Save position 5"},{name:"save_position_6",contexts:["pattern"],handler:tY,description:"Save position 6"},{name:"save_position_7",contexts:["pattern"],handler:nY,description:"Save position 7"},{name:"save_position_8",contexts:["pattern"],handler:sY,description:"Save position 8"},{name:"save_position_9",contexts:["pattern"],handler:aY,description:"Save position 9"},{name:"goto_position_0",contexts:["pattern"],handler:oY,description:"Go to position 0"},{name:"goto_position_1",contexts:["pattern"],handler:rY,description:"Go to position 1"},{name:"goto_position_2",contexts:["pattern"],handler:iY,description:"Go to position 2"},{name:"goto_position_3",contexts:["pattern"],handler:lY,description:"Go to position 3"},{name:"goto_position_4",contexts:["pattern"],handler:cY,description:"Go to position 4"},{name:"goto_position_5",contexts:["pattern"],handler:uY,description:"Go to position 5"},{name:"goto_position_6",contexts:["pattern"],handler:dY,description:"Go to position 6"},{name:"goto_position_7",contexts:["pattern"],handler:mY,description:"Go to position 7"},{name:"goto_position_8",contexts:["pattern"],handler:pY,description:"Go to position 8"},{name:"goto_position_9",contexts:["pattern"],handler:hY,description:"Go to position 9"},{name:"goto_pattern_start",contexts:["pattern"],handler:fY,description:"Go to pattern start"},{name:"goto_pattern_end",contexts:["pattern"],handler:gY,description:"Go to pattern end"},{name:"goto_song_start",contexts:["global"],handler:bY,description:"Go to song start"},{name:"goto_song_end",contexts:["global"],handler:vY,description:"Go to song end"},{name:"goto_first_channel",contexts:["pattern"],handler:yY,description:"Go to first channel"},{name:"goto_last_channel",contexts:["pattern"],handler:xY,description:"Go to last channel"},{name:"goto_row",contexts:["pattern"],handler:NY,description:"Go to row"},{name:"goto_pattern",contexts:["global"],handler:wY,description:"Go to pattern"},{name:"goto_order_position",contexts:["global"],handler:EY,description:"Go to order position"},{name:"goto_time",contexts:["global"],handler:kY,description:"Go to time"},{name:"jump_to_next_bookmark",contexts:["pattern"],handler:DY,description:"Jump to next bookmark"},{name:"jump_to_prev_bookmark",contexts:["pattern"],handler:SY,description:"Jump to prev bookmark"},{name:"toggle_bookmark",contexts:["pattern"],handler:MY,description:"Toggle bookmark"},{name:"clear_all_bookmarks",contexts:["pattern"],handler:CY,description:"Clear all bookmarks"},{name:"jump_to_position_0",contexts:["pattern"],handler:oY,description:"Jump to position 0"},{name:"jump_to_position_16",contexts:["pattern"],handler:YH,description:"Jump to position 16"},{name:"jump_to_position_32",contexts:["pattern"],handler:JH,description:"Jump to position 32"},{name:"jump_to_position_48",contexts:["pattern"],handler:QH,description:"Jump to position 48"},{name:"jump_to_position_63",contexts:["pattern"],handler:GH,description:"Jump to position 63"},{name:"load_layout_1",contexts:["global"],handler:_Y,description:"Load layout 1"},{name:"load_layout_2",contexts:["global"],handler:OY,description:"Load layout 2"},{name:"load_layout_3",contexts:["global"],handler:TY,description:"Load layout 3"},{name:"load_layout_4",contexts:["global"],handler:LY,description:"Load layout 4"},{name:"load_layout_5",contexts:["global"],handler:AY,description:"Load layout 5"},{name:"load_layout_6",contexts:["global"],handler:BY,description:"Load layout 6"},{name:"load_layout_7",contexts:["global"],handler:IY,description:"Load layout 7"},{name:"load_layout_8",contexts:["global"],handler:FY,description:"Load layout 8"},{name:"save_layout_1",contexts:["global"],handler:RY,description:"Save layout 1"},{name:"save_layout_2",contexts:["global"],handler:jY,description:"Save layout 2"},{name:"save_layout_3",contexts:["global"],handler:XY,description:"Save layout 3"},{name:"save_layout_4",contexts:["global"],handler:zY,description:"Save layout 4"},{name:"save_layout_5",contexts:["global"],handler:GY,description:"Save layout 5"},{name:"save_layout_6",contexts:["global"],handler:HY,description:"Save layout 6"},{name:"save_layout_7",contexts:["global"],handler:WY,description:"Save layout 7"},{name:"save_layout_8",contexts:["global"],handler:qY,description:"Save layout 8"},{name:"toggle_disk_browser",contexts:["global"],handler:KY,description:"Toggle disk browser"},{name:"toggle_instrument_panel",contexts:["global"],handler:$Y,description:"Toggle instrument panel"},{name:"toggle_sample_panel",contexts:["global"],handler:YY,description:"Toggle sample panel"},{name:"toggle_mixer_panel",contexts:["global"],handler:JY,description:"Toggle mixer panel"},{name:"toggle_automation_panel",contexts:["global"],handler:QY,description:"Toggle automation panel"},{name:"toggle_track_scopes",contexts:["global"],handler:ZY,description:"Toggle track scopes"},{name:"toggle_master_spectrum",contexts:["global"],handler:eJ,description:"Toggle master spectrum"},{name:"maximize_panel",contexts:["global"],handler:tJ,description:"Maximize panel"},{name:"restore_panel_sizes",contexts:["global"],handler:nJ,description:"Restore panel sizes"},{name:"focus_next_panel",contexts:["global"],handler:aJ,description:"Focus next panel"},{name:"focus_prev_panel",contexts:["global"],handler:oJ,description:"Focus prev panel"},{name:"toggle_bottom_frame",contexts:["global"],handler:rJ,description:"Toggle bottom frame"},{name:"toggle_upper_frame",contexts:["global"],handler:iJ,description:"Toggle upper frame"},{name:"cycle_global_view",contexts:["global"],handler:lJ,description:"Cycle global view"},{name:"show_about",contexts:["global"],handler:ZJ,description:"Show about"},{name:"show_keyboard_help",contexts:["global"],handler:PJ,description:"Show keyboard help"},{name:"open_manual",contexts:["global"],handler:eQ,description:"Open manual"},{name:"panic",contexts:["global"],handler:cJ,description:"Panic - all notes off"},{name:"center_cursor",contexts:["pattern"],handler:tQ,description:"Center cursor"},{name:"insert_keyoff",contexts:["pattern"],handler:xJ,description:"Insert keyoff"},{name:"insert_note_cut",contexts:["pattern"],handler:NJ,description:"Insert note cut"},{name:"insert_fade_out",contexts:["pattern"],handler:wJ,description:"Insert fade out"},{name:"render_to_sample",contexts:["global"],handler:UJ,description:"Render to sample"},{name:"render_to_instrument",contexts:["global"],handler:RJ,description:"Render to instrument"},{name:"render_song",contexts:["global"],handler:jJ,description:"Render song"},{name:"export_mp3",contexts:["global"],handler:XJ,description:"Export MP3"},{name:"quick_save",contexts:["global"],handler:AJ,description:"Quick save"},{name:"revert_to_saved",contexts:["global"],handler:nQ,description:"Revert to saved"},{name:"toggle_compact_mode",contexts:["global"],handler:bJ,description:"Toggle compact mode"},{name:"reset_view",contexts:["global"],handler:sQ,description:"Reset view"},{name:"increase_pattern_size",contexts:["pattern"],handler:SJ,description:"Increase pattern size"},{name:"decrease_pattern_size",contexts:["pattern"],handler:MJ,description:"Decrease pattern size"},{name:"toggle_hex_mode",contexts:["global"],handler:mJ,description:"Toggle hex mode"},{name:"toggle_row_highlight",contexts:["pattern"],handler:vJ,description:"Toggle row highlight"},{name:"toggle_channel_names",contexts:["pattern"],handler:yJ,description:"Toggle channel names"},{name:"zoom_in",contexts:["global"],handler:pJ,description:"Zoom in"},{name:"zoom_out",contexts:["global"],handler:hJ,description:"Zoom out"},{name:"reset_zoom",contexts:["global"],handler:fJ,description:"Reset zoom"},{name:"fit_to_window",contexts:["global"],handler:gJ,description:"Fit to window"},{name:"clone_pattern_new",contexts:["pattern"],handler:DJ,description:"Clone pattern"},{name:"create_pattern",contexts:["pattern"],handler:EJ,description:"Create pattern"},{name:"delete_pattern",contexts:["pattern"],handler:kJ,description:"Delete pattern"},{name:"import_midi",contexts:["global"],handler:zJ,description:"Import MIDI"},{name:"export_midi",contexts:["global"],handler:GJ,description:"Export MIDI"},{name:"import_sample",contexts:["global"],handler:HJ,description:"Import sample"},{name:"export_sample",contexts:["global"],handler:WJ,description:"Export sample"},{name:"pattern_properties",contexts:["pattern"],handler:qJ,description:"Pattern properties"},{name:"song_properties",contexts:["global"],handler:KJ,description:"Song properties"},{name:"cleanup_unused",contexts:["global"],handler:$J,description:"Cleanup unused"},{name:"toggle_recording",contexts:["global"],handler:dJ,description:"Toggle recording"},{name:"preview_instrument",contexts:["global"],handler:BJ,description:"Preview instrument"},{name:"preview_sample",contexts:["global"],handler:IJ,description:"Preview sample"},{name:"stop_preview",contexts:["global"],handler:FJ,description:"Stop preview"},{name:"tempo_tap",contexts:["global"],handler:LJ,description:"Tempo tap"},{name:"show_quantize_dialog",contexts:["global"],handler:_J,description:"Show quantize dialog"},{name:"show_humanize_dialog",contexts:["global"],handler:VJ,description:"Show humanize dialog"},{name:"show_groove_settings",contexts:["global"],handler:CJ,description:"Show groove settings"},{name:"apply_swing",contexts:["global"],handler:YJ,description:"Apply swing"},{name:"run_script",contexts:["global"],handler:JJ,description:"Run script"},{name:"record_macro",contexts:["global"],handler:QJ,description:"Record macro"},{name:"escape",contexts:["global","pattern","dialog"],handler:uJ,description:"Escape/Cancel"},{name:"confirm",contexts:["global","pattern","dialog"],handler:OJ,description:"Confirm"},{name:"show_context_menu",contexts:["global","pattern"],handler:aQ,description:"Show context menu"},{name:"show_command_palette",contexts:["global"],handler:oQ,description:"Show command palette"},{name:"play_song_from_order",contexts:["pattern","global"],handler:OH,description:"Play from current pattern"},{name:"play_block",contexts:["pattern","global"],handler:OH,description:"Play current block/pattern"},{name:"continue_song",contexts:["pattern","global"],handler:()=>(VH(),!0),description:"Continue from cursor"},{name:"play_line",contexts:["pattern"],handler:()=>(CH(),!0),description:"Play current line"},{name:"play_row_and_advance",contexts:["pattern"],handler:()=>(CH(),BH(),!0),description:"Play row and advance"},{name:"set_volume_10",contexts:["pattern"],handler:()=>tZ(7),description:"Set volume 10%"},{name:"set_volume_20",contexts:["pattern"],handler:()=>tZ(13),description:"Set volume 20%"},{name:"set_volume_30",contexts:["pattern"],handler:()=>tZ(19),description:"Set volume 30%"},{name:"set_volume_40",contexts:["pattern"],handler:()=>tZ(26),description:"Set volume 40%"},{name:"set_volume_50",contexts:["pattern"],handler:()=>tZ(32),description:"Set volume 50%"},{name:"set_volume_60",contexts:["pattern"],handler:()=>tZ(38),description:"Set volume 60%"},{name:"set_volume_70",contexts:["pattern"],handler:()=>tZ(45),description:"Set volume 70%"},{name:"set_volume_80",contexts:["pattern"],handler:()=>tZ(51),description:"Set volume 80%"},{name:"set_volume_90",contexts:["pattern"],handler:()=>tZ(58),description:"Set volume 90%"},{name:"set_volume_100",contexts:["pattern"],handler:()=>tZ(64),description:"Set volume 100%"},{name:"decrease_volume",contexts:["pattern"],handler:nZ(-4),description:"Decrease volume"},{name:"increase_volume",contexts:["pattern"],handler:nZ(4),description:"Increase volume"},{name:"toggle_filter",contexts:["global"],handler:()=>(LN.getState().setStatusMessage("Amiga filter: in Settings",!1,1500),!0),description:"Toggle filter"},{name:"kill_sample",contexts:["pattern"],handler:()=>(Bw().releaseAll(),LN.getState().setStatusMessage("All notes off",!1,800),!0),description:"Kill sample"},{name:"kill_to_end",contexts:["pattern"],handler:()=>{const{cursor:e,patterns:t,currentPatternIndex:n,setCell:s}=ID.getState(),a=t[n];for(let o=e.rowIndex;o<a.length;o++)s(e.channelIndex,o,{note:97,instrument:0});return LN.getState().setStatusMessage("Killed to end",!1,800),!0},description:"Kill notes to end of pattern"},{name:"kill_to_start",contexts:["pattern"],handler:()=>{const{cursor:e,setCell:t}=ID.getState();for(let n=0;n<=e.rowIndex;n++)t(e.channelIndex,n,{note:97,instrument:0});return LN.getState().setStatusMessage("Killed to start",!1,800),!0},description:"Kill notes to start of pattern"},{name:"toggle_multichannel_mode",contexts:["global"],handler:()=>{const{multiChannelRecord:e,toggleMultiChannelRecord:t}=ID.getState();return t(),LN.getState().setStatusMessage("Multi-channel: "+(e?"OFF":"ON"),!1,1e3),!0},description:"Toggle multi-channel record mode"},{name:"set_block_length",contexts:["pattern"],handler:()=>(LN.getState().setStatusMessage("Block length: resize in pattern list",!1,1500),!0),description:"Set block length"},{name:"set_hold_0",contexts:["pattern"],handler:()=>(LN.getState().setStatusMessage("Hold: OctaMED only",!1,1e3),!0),description:"Set hold 0"},{name:"set_hold_1",contexts:["pattern"],handler:()=>(LN.getState().setStatusMessage("Hold: OctaMED only",!1,1e3),!0),description:"Set hold 1"},{name:"set_hold_2",contexts:["pattern"],handler:()=>(LN.getState().setStatusMessage("Hold: OctaMED only",!1,1e3),!0),description:"Set hold 2"},{name:"set_hold_3",contexts:["pattern"],handler:()=>(LN.getState().setStatusMessage("Hold: OctaMED only",!1,1e3),!0),description:"Set hold 3"},{name:"dj_scratch_baby",contexts:["global"],handler:cQ,description:"DJ Scratch: Baby Scratch"},{name:"dj_scratch_trans",contexts:["global"],handler:uQ,description:"DJ Scratch: Transformer"},{name:"dj_scratch_flare",contexts:["global"],handler:dQ,description:"DJ Scratch: Flare"},{name:"dj_scratch_hydro",contexts:["global"],handler:mQ,description:"DJ Scratch: Hydroplane"},{name:"dj_scratch_crab",contexts:["global"],handler:pQ,description:"DJ Scratch: Crab"},{name:"dj_scratch_orbit",contexts:["global"],handler:hQ,description:"DJ Scratch: Orbit"},{name:"dj_scratch_chirp",contexts:["global"],handler:fQ,description:"DJ Scratch: Chirp"},{name:"dj_scratch_stab",contexts:["global"],handler:gQ,description:"DJ Scratch: Stab"},{name:"dj_scratch_scrbl",contexts:["global"],handler:bQ,description:"DJ Scratch: Scribble"},{name:"dj_scratch_tear",contexts:["global"],handler:vQ,description:"DJ Scratch: Tear"},{name:"dj_scratch_stop",contexts:["global"],handler:CQ,description:"DJ Scratch: Stop pattern"},{name:"dj_fader_lfo_off",contexts:["global"],handler:VQ,description:"DJ Fader LFO: Off"},{name:"dj_fader_lfo_14",contexts:["global"],handler:PQ,description:"DJ Fader LFO: 1/4 note"},{name:"dj_fader_lfo_18",contexts:["global"],handler:_Q,description:"DJ Fader LFO: 1/8 note"},{name:"dj_fader_lfo_116",contexts:["global"],handler:OQ,description:"DJ Fader LFO: 1/16 note"},{name:"dj_fader_lfo_132",contexts:["global"],handler:TQ,description:"DJ Fader LFO: 1/32 note"},{name:"tracker_fader_cut",contexts:["global"],handler:LQ,releaseHandler:AQ,description:"Tracker: Fader cut (hold to mute)"},{name:"tracker_crab",contexts:["global"],handler:BQ,releaseHandler:IQ,description:"Tracker: Crab scratch (hold)"},{name:"tracker_transformer",contexts:["global"],handler:FQ,releaseHandler:UQ,description:"Tracker: Transformer (hold)"},{name:"tracker_flare",contexts:["global"],handler:RQ,releaseHandler:jQ,description:"Tracker: Flare scratch (hold)"},{name:"tracker_scratch_trans",contexts:["global"],handler:zQ,description:"Tracker Scratch: Transformer"},{name:"tracker_scratch_crab",contexts:["global"],handler:GQ,description:"Tracker Scratch: Crab"},{name:"tracker_scratch_flare",contexts:["global"],handler:HQ,description:"Tracker Scratch: Flare"},{name:"tracker_scratch_chirp",contexts:["global"],handler:WQ,description:"Tracker Scratch: Chirp"},{name:"tracker_scratch_stab",contexts:["global"],handler:qQ,description:"Tracker Scratch: Stab"},{name:"tracker_scratch_8crab",contexts:["global"],handler:KQ,description:"Tracker Scratch: 8-Finger Crab"},{name:"tracker_scratch_twdl",contexts:["global"],handler:$Q,description:"Tracker Scratch: Twiddle"},{name:"tracker_scratch_stop",contexts:["global"],handler:YQ,description:"Tracker Scratch: Stop pattern"},{name:"tracker_spinback",contexts:["global"],handler:JQ,description:"Tracker: Spinback (platter brake + spinup)"},{name:"power_cut_stop",contexts:["pattern","global"],handler:QQ,description:"Stop playback with turntable power-off spindown"}].forEach(e=>ZQ.register(e)),eZ=!0}()},[]),l.useEffect(()=>{if(t)return;if(o.current===n)return;(async()=>{try{await a.current.loadScheme(n),o.current=n}catch(e){if("fasttracker2"!==n)try{await a.current.loadScheme("fasttracker2"),o.current="fasttracker2"}catch{}}})()},[n,t]);const i=l.useCallback(()=>"auto"!==s?s:kG.isMac()?"mac":"pc",[s]);l.useEffect(()=>{if(t)return;const e=e=>{const t=e.target;if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t?.isContentEditable||t?.closest?.(".cm-editor"))return;const n=kG.normalize(e),s=i(),o=MH.format(n,"mac"===s),l=a.current.getCommand(o,s);if(!l)return;const c=sZ();ZQ.execute(l,c)&&(ZQ.hasReleaseHandler(l)&&r.current.set(o,l),e.preventDefault(),e.stopPropagation())};window.addEventListener("keydown",e,{capture:!0});const n=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target?.isContentEditable)return;const t=kG.normalize(e),n=i(),s=MH.format(t,"mac"===n),a=r.current.get(s);if(a){const t=sZ();ZQ.release(a,t),r.current.delete(s),e.preventDefault()}};return window.addEventListener("keyup",n,{capture:!0}),()=>{window.removeEventListener("keydown",e,{capture:!0}),window.removeEventListener("keyup",n,{capture:!0});for(const[,e]of r.current)ZQ.release(e,"global");r.current.clear()}},[t,i])}function oZ(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}let rZ={};function iZ(e,t,n=3e3){rZ[e]&&clearTimeout(rZ[e]),rZ[e]=setTimeout(()=>{RC(e,t).catch(()=>{})},n)}let lZ=!1;const cZ={success:Yn.jsxDEV(Tn,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:10,columnNumber:12},void 0),error:Yn.jsxDEV(Le,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:11,columnNumber:10},void 0),warning:Yn.jsxDEV(Xt,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:12,columnNumber:12},void 0),info:Yn.jsxDEV(Kt,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:13,columnNumber:9},void 0)},uZ={success:"text-accent-success border-accent-success/30 bg-accent-success/10",error:"text-accent-error border-accent-error/30 bg-accent-error/10",warning:"text-accent-warning border-accent-warning/30 bg-accent-warning/10",info:"text-accent-primary border-accent-primary/30 bg-accent-primary/10"},dZ=()=>{const{notifications:e,removeNotification:t}=Pk();return 0===e.length?null:Yn.jsxDEV("div",{className:"fixed bottom-4 right-4 z-[10050] flex flex-col gap-2 max-w-sm",children:e.map(e=>Yn.jsxDEV("div",{className:`\n            flex items-start gap-3 px-4 py-3 rounded-lg border shadow-lg\n            animate-slide-in-right\n            ${uZ[e.type]}\n          `,role:"alert",children:[Yn.jsxDEV("span",{className:"flex-shrink-0 mt-0.5",children:cZ[e.type]},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:40,columnNumber:11},void 0),Yn.jsxDEV("p",{className:"flex-1 text-sm font-medium text-text-primary",children:e.message},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:43,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:()=>t(e.id),className:"flex-shrink-0 p-0.5 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss notification",children:Yn.jsxDEV(Ce,{size:14,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:51,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:46,columnNumber:11},void 0)]},e.id,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:31,columnNumber:9},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/ToastNotification.tsx",lineNumber:29,columnNumber:5},void 0)},mZ=({onRefresh:e,onDismiss:t,currentVersion:n,latestVersion:s})=>Yn.jsxDEV("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-[60] max-w-md w-full px-4",children:Yn.jsxDEV("div",{className:"\n          flex items-center gap-3 px-4 py-3 rounded-lg border shadow-2xl\n          bg-accent-primary/20 border-accent-primary/40 backdrop-blur-sm\n          animate-slide-in-top\n        ",role:"alert",children:[Yn.jsxDEV(zt,{size:20,className:"text-accent-primary flex-shrink-0 animate-pulse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:32,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex-1 min-w-0",children:[Yn.jsxDEV("p",{className:"text-sm font-semibold text-text-primary mb-1",children:"Update Available"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:34,columnNumber:11},void 0),Yn.jsxDEV("p",{className:"text-xs text-text-muted",children:["Version ",s," is now available (current: ",n,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:37,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:33,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex items-center gap-2 flex-shrink-0",children:[Yn.jsxDEV(TV,{onClick:e,className:"px-3 py-1.5 text-xs bg-accent-primary hover:bg-accent-primary/80 text-white font-medium rounded",children:"Refresh"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:42,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:t,className:"p-1 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss update notification",children:Yn.jsxDEV(Ce,{size:16,className:"text-text-muted"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:53,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:48,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:41,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:24,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/UpdateNotification.tsx",lineNumber:23,columnNumber:5},void 0),pZ=()=>{const{activeError:e,dismissError:t,copyToClipboard:n,getDebugString:s}=dc(),[a,o]=l.useState(!1),[r,i]=l.useState(!1);if(!e)return null;const c=()=>{t(e.id),o(!1),i(!1)};return Yn.jsxDEV(kT,{isOpen:!0,onClose:c,size:"lg",closeOnBackdropClick:!1,closeOnEscape:!0,children:[Yn.jsxDEV(DT,{title:"Synth Error",subtitle:{init:"Initialization Error",wasm:"WASM Engine Error",runtime:"Runtime Error",audio:"Audio Context Error"}[e.errorType],icon:Yn.jsxDEV(Xt,{className:"w-6 h-6 text-red-500"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:52,columnNumber:15},void 0),className:"select-none"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:49,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh] select-text",children:[Yn.jsxDEV("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-4",children:Yn.jsxDEV("div",{className:"flex items-start gap-3",children:Yn.jsxDEV("div",{className:"flex-1",children:[Yn.jsxDEV("p",{className:"font-mono text-sm text-red-300",children:[Yn.jsxDEV("span",{className:"text-red-400 font-bold",children:e.synthType},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:62,columnNumber:17},void 0),e.synthName&&Yn.jsxDEV("span",{className:"text-red-300/70",children:[" (",e.synthName,")"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:64,columnNumber:19},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:61,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"mt-2 text-white",children:e.message},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:67,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:60,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:59,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:58,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>i(!r),className:"flex items-center gap-2 text-sm text-dark-text-secondary hover:text-white transition-colors",children:[r?Yn.jsxDEV(jt,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:77,columnNumber:26},void 0):Yn.jsxDEV(De,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:77,columnNumber:52},void 0),r?"Hide":"Show"," Debug Details"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:73,columnNumber:9},void 0),r&&Yn.jsxDEV("div",{className:"bg-dark-surface rounded-lg p-4 space-y-3",children:[Yn.jsxDEV("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-dark-text-secondary",children:"Timestamp:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:86,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"font-mono text-xs",children:e.debugData.timestamp},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:87,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:85,columnNumber:15},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-dark-text-secondary",children:"AudioContext:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:90,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"font-mono text-xs",children:e.debugData.audioContextState},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:91,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:89,columnNumber:15},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-dark-text-secondary",children:"WASM Supported:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:94,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"font-mono text-xs",children:e.debugData.wasmSupported?"Yes":"No"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:95,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:93,columnNumber:15},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-dark-text-secondary",children:"Error Type:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:100,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"font-mono text-xs",children:e.errorType},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:101,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:99,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:84,columnNumber:13},void 0),e.stack&&Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-dark-text-secondary text-sm",children:"Stack Trace:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:108,columnNumber:17},void 0),Yn.jsxDEV("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-red-300 overflow-x-auto max-h-32 overflow-y-auto",children:e.stack},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:109,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:107,columnNumber:15},void 0),Yn.jsxDEV("div",{children:[Yn.jsxDEV("span",{className:"text-dark-text-secondary text-sm",children:"Full Debug Report:"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:117,columnNumber:15},void 0),Yn.jsxDEV("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-dark-text-secondary overflow-x-auto max-h-40 overflow-y-auto whitespace-pre-wrap",children:s(e)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:118,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:116,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:83,columnNumber:11},void 0),Yn.jsxDEV("p",{className:"text-sm text-dark-text-secondary",children:"This synth failed to initialize properly. Please copy the debug information and report this issue. The synth will not be available until the error is resolved."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:126,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:56,columnNumber:7},void 0),Yn.jsxDEV(ST,{children:Yn.jsxDEV("div",{className:"flex justify-between w-full",children:[Yn.jsxDEV("button",{onClick:async()=>{await n(e)&&(o(!0),setTimeout(()=>o(!1),2e3))},className:"flex items-center gap-2 px-4 py-2 bg-dark-surface hover:bg-dark-hover rounded transition-colors",children:a?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(Be,{size:16,className:"text-green-500"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:140,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-green-500",children:"Copied!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:141,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:139,columnNumber:15},void 0):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(Je,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:145,columnNumber:17},void 0),Yn.jsxDEV("span",{children:"Copy Debug Info"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:146,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:144,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:134,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded transition-colors",children:[Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:155,columnNumber:13},void 0),Yn.jsxDEV("span",{children:"Dismiss"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:156,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:151,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:133,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:132,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/SynthErrorDialog.tsx",lineNumber:42,columnNumber:5},void 0)},hZ=Object.freeze(Object.defineProperty({__proto__:null,SynthErrorDialog:pZ},Symbol.toStringTag,{value:"Module"})),fZ=()=>{const{pendingRomRequest:e,dismissRomDialog:t}=Pw(),n=EN(e=>e.updateInstrument),s=EN(e=>e.instruments),[a,o]=l.useState(!1),[r,i]=l.useState(!1),[c,u]=l.useState(null),d=l.useRef(null),m=l.useCallback(async a=>{const r=a.target.files?.[0];if(r&&e){o(!0),u(null);try{const a=Bw(),{instrumentId:l,synthType:c}=e;if(r.name.toLowerCase().endsWith(".zip")){const e=new Ds,t=await e.loadAsync(r),n=[];t.forEach((e,t)=>{const s=e.toLowerCase().match(/\.(txt|md|pdf|url|inf)$/);t.dir||s||n.push({name:e,entry:t})}),n.sort((e,t)=>e.name.localeCompare(t.name,void 0,{numeric:!0,sensitivity:"base"}));for(let s=0;s<n.length;s++){const e=await n[s].entry.async("uint8array");a.loadSynthROM(l,c,s,e)}}else{const e=await r.arrayBuffer(),t=new Uint8Array(e);a.loadSynthROM(l,c,0,t)}const u=s.find(e=>e.id===l);u&&n(l,{parameters:{...u.parameters,_romsLoaded:1}}),i(!0),setTimeout(()=>{t(),i(!1),o(!1)},1200)}catch(l){u(l instanceof Error?l.message:"Failed to load ROM file"),o(!1)}d.current&&(d.current.value="")}},[e,s,n,t]),p=l.useCallback(()=>{t(),i(!1),u(null),o(!1)},[t]);if(!e)return null;const{chipName:h,requiredZip:f}=e;return Yn.jsxDEV(kT,{isOpen:!0,onClose:p,size:"md",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Yn.jsxDEV(DT,{title:"ROM Required",subtitle:`${h} needs ROM data to produce sound`,icon:Yn.jsxDEV(on,{className:"w-6 h-6 text-amber-400"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:112,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:109,columnNumber:7},void 0),Yn.jsxDEV("div",{className:"p-4 space-y-4",children:[Yn.jsxDEV("div",{className:"bg-amber-900/20 border border-amber-500/30 rounded-lg p-4",children:Yn.jsxDEV("div",{className:"flex items-start gap-3",children:[Yn.jsxDEV(Xt,{size:18,className:"text-amber-400 mt-0.5 shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:119,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"text-sm",children:[Yn.jsxDEV("p",{className:"text-white",children:"This synth requires ROM files that couldn't be loaded automatically."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:121,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"mt-2 text-dark-text-secondary",children:["Without ROMs, the synth will be silent. You can upload the ROM file below, or place it in ",Yn.jsxDEV("code",{className:"text-amber-300 bg-black/30 px-1 rounded",children:"/public/roms/"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:126,columnNumber:39},void 0)," for auto-loading."]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:124,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:120,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:118,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:117,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"bg-dark-surface rounded-lg p-3",children:[Yn.jsxDEV("div",{className:"text-xs text-dark-text-secondary uppercase tracking-wider mb-1",children:"Expected ROM file"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:134,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"font-mono text-sm text-amber-300",children:f},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:137,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:133,columnNumber:9},void 0),Yn.jsxDEV("div",{className:"flex flex-col items-center gap-3",children:[r?Yn.jsxDEV("div",{className:"flex items-center gap-2 text-green-400 py-4",children:[Yn.jsxDEV(Be,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:146,columnNumber:15},void 0),Yn.jsxDEV("span",{className:"font-medium",children:"ROMs loaded successfully!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:147,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:145,columnNumber:13},void 0):Yn.jsxDEV("label",{className:"w-full cursor-pointer",children:[Yn.jsxDEV("div",{className:`\n                border-2 border-dashed rounded-lg p-6\n                flex flex-col items-center gap-2 transition-colors\n                ${a?"border-amber-500/50 bg-amber-900/10":"border-dark-border hover:border-amber-400/50 hover:bg-amber-900/5"}\n              `,children:[Yn.jsxDEV(Yt,{size:24,className:a?"text-amber-400 animate-pulse":"text-dark-text-secondary"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:158,columnNumber:17},void 0),Yn.jsxDEV("span",{className:"text-sm text-dark-text-secondary",children:a?"Loading ROM...":"Click to upload ROM file (.zip or raw ROM)"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:159,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:151,columnNumber:15},void 0),Yn.jsxDEV("input",{ref:d,type:"file",accept:".zip,.bin,.rom,.vsm",className:"hidden",onChange:m,disabled:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:163,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:150,columnNumber:13},void 0),c&&Yn.jsxDEV("div",{className:"text-sm text-red-400 bg-red-900/20 border border-red-500/30 rounded px-3 py-2 w-full",children:c},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:175,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:143,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:115,columnNumber:7},void 0),Yn.jsxDEV(ST,{children:Yn.jsxDEV("div",{className:"flex justify-end w-full",children:Yn.jsxDEV("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 bg-dark-surface hover:bg-dark-hover rounded transition-colors",children:[Yn.jsxDEV(Ce,{size:16},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:188,columnNumber:13},void 0),Yn.jsxDEV("span",{children:r?"Close":"Skip"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:189,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:184,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:183,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:182,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/RomUploadDialog.tsx",lineNumber:102,columnNumber:5},void 0)},gZ=Object.freeze(Object.defineProperty({__proto__:null,RomUploadDialog:fZ},Symbol.toStringTag,{value:"Module"})),bZ=({isOpen:e,file:t,onConfirm:n,onCancel:s})=>{const[a,o]=l.useState(null),[r,i]=l.useState(null);return l.useEffect(()=>{if(!t)return o(null),void i(null);o(null),i(null),t.text().then(e=>{try{const n=JSON.parse(e);o({name:n.metadata?.name||t.name.replace(/\.dbx$/i,""),author:n.metadata?.author||"",description:n.metadata?.description||"",bpm:"number"==typeof n.bpm?n.bpm:120,patternCount:Array.isArray(n.patterns)?n.patterns.length:0,instrumentCount:Array.isArray(n.instruments)?n.instruments.length:0})}catch{i("Could not parse project file.")}}).catch(()=>i("Could not read file."))},[t]),e&&t?Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:Yn.jsxDEV("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary rounded-xl p-6 max-w-md w-full mx-4 animate-slide-in-up shadow-2xl",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 mb-5",children:[Yn.jsxDEV(rt,{className:"w-5 h-5 text-accent-primary flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:68,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"min-w-0",children:[Yn.jsxDEV("h2",{className:"text-lg font-bold text-white leading-tight",children:"Load Project?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:70,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs font-mono truncate",children:t.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:71,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:69,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:67,columnNumber:9},void 0),r?Yn.jsxDEV("p",{className:"text-red-400 text-sm mb-5",children:r},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:76,columnNumber:11},void 0):a?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV("div",{className:"mb-4",children:[Yn.jsxDEV("p",{className:"text-accent-primary text-xl font-bold truncate",children:a.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:81,columnNumber:15},void 0),a.author&&Yn.jsxDEV("p",{className:"text-text-secondary text-sm flex items-center gap-1 mt-0.5",children:[Yn.jsxDEV(Ke,{className:"w-3 h-3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:84,columnNumber:19},void 0),a.author]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:83,columnNumber:17},void 0),a.description&&Yn.jsxDEV("p",{className:"text-text-muted text-xs mt-1 line-clamp-2",children:a.description},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:88,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:80,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"grid grid-cols-3 gap-2 mb-5",children:[Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg p-2.5 text-center",children:[Yn.jsxDEV(dt,{className:"w-4 h-4 text-accent-primary mx-auto mb-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:95,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-white text-sm font-bold",children:a.bpm},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:96,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs",children:"BPM"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:97,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:94,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg p-2.5 text-center",children:[Yn.jsxDEV(Dn,{className:"w-4 h-4 text-accent-primary mx-auto mb-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:100,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-white text-sm font-bold",children:a.patternCount},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:101,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs",children:"Patterns"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:102,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:99,columnNumber:15},void 0),Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg p-2.5 text-center",children:[Yn.jsxDEV($t,{className:"w-4 h-4 text-accent-primary mx-auto mb-1"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:105,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-white text-sm font-bold",children:a.instrumentCount},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:106,columnNumber:17},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs",children:"Instruments"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:107,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:104,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:93,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs mb-5",children:"Loading this project will replace your current work. Save first if needed."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:111,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:78,columnNumber:11},void 0):Yn.jsxDEV("div",{className:"flex items-center gap-2 text-text-muted text-sm mb-5",children:[Yn.jsxDEV(_e,{className:"w-4 h-4 animate-pulse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:117,columnNumber:13},void 0),"Reading project"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:116,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-3 justify-end",children:[Yn.jsxDEV(TV,{variant:"ghost",onClick:s,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:124,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",onClick:n,disabled:!a&&!r,children:"Load Project"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:125,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:123,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:64,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportDBXDialog.tsx",lineNumber:63,columnNumber:5},void 0):null},vZ={Synth:"Subtractive Synth",MonoSynth:"Mono Synth",DuoSynth:"Duo Synth",FMSynth:"FM Synth",AMSynth:"AM Synth",PluckSynth:"Pluck Synth",MetalSynth:"Metal Synth",MembraneSynth:"Membrane Synth",NoiseSynth:"Noise Synth",TB303:"TB-303 Bass Synth",Sampler:"Sampler",Player:"Audio Player",Wavetable:"Wavetable Synth",GranularSynth:"Granular Synth",SuperSaw:"Super Saw",PolySynth:"Poly Synth",Organ:"Organ",DrumMachine:"Drum Machine",ChipSynth:"Chip Synth",PWMSynth:"PWM Synth",StringMachine:"String Machine",FormantSynth:"Formant Synth",Furnace:"Furnace Chip"},yZ=({isOpen:e,file:t,onConfirm:n,onCancel:s})=>{const[a,o]=l.useState(null),[r,i]=l.useState(null);if(l.useEffect(()=>{if(!t)return o(null),void i(null);o(null),i(null),t.text().then(e=>{try{const t=JSON.parse(e);if("devilbox-instrument"!==t.format)return void i("Not a valid DEViLBOX instrument file.");const n=t.instrument??{};o({name:n.name||"Unnamed Instrument",synthType:n.synthType||"Unknown"})}catch{i("Could not parse instrument file.")}}).catch(()=>i("Could not read file."))},[t]),!e||!t)return null;const c=a?vZ[a.synthType]??a.synthType:"";return Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:Yn.jsxDEV("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary rounded-xl p-6 max-w-sm w-full mx-4 animate-slide-in-up shadow-2xl",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 mb-5",children:[Yn.jsxDEV($t,{className:"w-5 h-5 text-accent-primary flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:93,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"min-w-0",children:[Yn.jsxDEV("h2",{className:"text-lg font-bold text-white leading-tight",children:"Add Instrument?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:95,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-xs font-mono truncate",children:t.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:96,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:94,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:92,columnNumber:9},void 0),r?Yn.jsxDEV("p",{className:"text-red-400 text-sm mb-5",children:r},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:101,columnNumber:11},void 0):a?Yn.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg p-4 mb-5",children:[Yn.jsxDEV("p",{className:"text-white font-bold text-base truncate",children:a.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:104,columnNumber:13},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-sm mt-0.5",children:c},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:105,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:103,columnNumber:11},void 0):Yn.jsxDEV("div",{className:"text-text-muted text-sm mb-5 flex items-center gap-2",children:[Yn.jsxDEV($t,{className:"w-4 h-4 animate-pulse"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:109,columnNumber:13},void 0),"Reading instrument"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:108,columnNumber:11},void 0),Yn.jsxDEV("div",{className:"flex gap-3 justify-end",children:[Yn.jsxDEV(TV,{variant:"ghost",onClick:s,children:"Cancel"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:115,columnNumber:11},void 0),Yn.jsxDEV(TV,{variant:"primary",onClick:n,disabled:!a&&!r,children:"Add to Project"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:116,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:114,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:89,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/dialogs/ImportInstrumentDialog.tsx",lineNumber:88,columnNumber:5},void 0)};const xZ=()=>Yn.jsxDEV("div",{className:"fixed top-0 left-0 right-0 z-[200] bg-red-700/95 border-b border-red-500 backdrop-blur-sm",children:Yn.jsxDEV("div",{className:"flex items-center justify-center gap-2 px-4 py-2",children:[Yn.jsxDEV(Ln,{size:16,className:"text-white flex-shrink-0"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/DevServerDownBanner.tsx",lineNumber:10,columnNumber:7},void 0),Yn.jsxDEV("p",{className:"text-sm font-semibold text-white",children:["Dev server is down "," ",Yn.jsxDEV("code",{className:"font-mono bg-red-900/60 px-1 rounded text-xs",children:"npm run dev"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/DevServerDownBanner.tsx",lineNumber:13,columnNumber:9},void 0)," ","to restart"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/DevServerDownBanner.tsx",lineNumber:11,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/DevServerDownBanner.tsx",lineNumber:9,columnNumber:5},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/DevServerDownBanner.tsx",lineNumber:8,columnNumber:3},void 0),NZ={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};function wZ(e,t,n,s){let a=null;for(const o of e){if(o.trackId!==t)continue;if(n<o.startRow)continue;const e=s.get(o.patternId),r=o.clipLengthRows??(e?e.length-o.offsetRows:64);n>=o.startRow+r||(!a||o.startRow>a.startRow)&&(a=o)}return a}const EZ=()=>{const{patterns:e,currentPatternIndex:t,setCurrentPattern:n,patternOrder:s,currentPositionIndex:a,setCurrentPosition:o,channelTrackTables:r,channelSpeeds:i,channelGrooves:c,linearPeriods:u,hivelyNative:d,hivelyFileData:m,hivelyMeta:p,musiclineFileData:h}=ID(us(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,setCurrentPattern:e.setCurrentPattern,patternOrder:e.patternOrder,currentPositionIndex:e.currentPositionIndex,setCurrentPosition:e.setCurrentPosition,channelTrackTables:e.channelTrackTables,channelSpeeds:e.channelSpeeds,channelGrooves:e.channelGrooves,linearPeriods:e.linearPeriods,hivelyNative:e.hivelyNative,hivelyFileData:e.hivelyFileData,hivelyMeta:e.hivelyMeta,musiclineFileData:e.musiclineFileData}))),{isPlaying:f,isLooping:g,bpm:b,setCurrentRow:v,setCurrentRowThrottled:y}=jN(us(e=>({isPlaying:e.isPlaying,isLooping:e.isLooping,bpm:e.bpm,setCurrentRow:e.setCurrentRow,setCurrentRowThrottled:e.setCurrentRowThrottled}))),{instruments:x}=EN(),{masterEffects:N}=UD(),w=bX(e=>e.isArrangementMode),E=l.useRef(a);l.useEffect(()=>{E.current=a},[a]);const k=l.useRef(t);l.useEffect(()=>{k.current=t},[t]);const D=s[a]??t,S=e[D],M=l.useRef(Bw()),C=l.useRef(pD());l.useEffect(()=>{M.current=Bw(),C.current=pD()});const V=l.useRef(S),P=l.useRef(e),_=l.useRef(b);l.useEffect(()=>{V.current=S,P.current=e,_.current=b});const O=l.useRef(x);l.useEffect(()=>{O.current=x},[x]);const T=l.useMemo(()=>S?`${e.length}:${S.channels.length}:${S.length}:${S.importMetadata?.sourceFormat??""}`:"",[e.length,S?.channels.length,S?.length,S?.importMetadata?.sourceFormat]),L=l.useRef(!1),A=l.useRef(null),B=l.useRef(0),I=l.useRef(!1);l.useEffect(()=>{M.current.setBPM(b)},[b]);const F=l.useMemo(()=>N.map(e=>`${e.id}:${e.enabled}:${e.type}`).join("|"),[N]);l.useEffect(()=>{M.current.rebuildMasterEffects(N)},[F]),l.useEffect(()=>{if(S){const e=M.current;S.channels.forEach((t,n)=>{const s=t.volume>0?t.volume/100*60-60:-1/0;e.setChannelVolume(n,s),e.setChannelPan(n,t.pan)}),e.updateMuteStates(S.channels.map(e=>({muted:e.muted,solo:e.solo})))}},[S]),l.useEffect(()=>{const t=C.current;t.isPlaying()&&t.updatePatterns(e)},[e]);const U=g?t:-1;return l.useEffect(()=>{const e=C.current,a=V.current,l=P.current;if(f&&a){const f=bX.getState(),b=I.current;I.current=!1;const v=L.current&&e.isPlaying()&&b,x=L.current&&!v,N=a.importMetadata?.sourceFormat||(r&&r.length>0?"MOD":"XM");if("UADE"===N){if(!L.current){L.current=!0,B.current=0;const e=Bw(),t=O.current.find(e=>"UADESynth"===e.synthType);if(t){const s=e.getInstrumentKey(t.id,-1);let a=e.instruments.get(s);if(a||(a=e.getInstrument(t.id,t)??void 0),a&&"getEngine"in a){const e=a.getEngine();e.ready().then(()=>{e.play(),A.current?.();const t=Math.round(5292);A.current=e.onChannelData((e,s)=>{const a=Math.floor(s/t),r=ID.getState(),i=r.patterns[0]?.length??64,l=Math.floor(a/i),c=a%i;l!==r.currentPositionIndex&&l<r.patternOrder.length&&(o(l,!0),n(r.patternOrder[l]??l,!0)),y(c,i)})}).catch(e=>{})}}}return}if(!L.current||x){L.current=!0;const b=a.importMetadata?.modData;let v,w,k=l,D=r&&r.length>0?r.length:a.channels.length;if(f.isArrangementMode&&f.clips.length>0){const e=function(e,t,n){if(0===e.length||0===t.length)return{songPositions:[0],virtualPatterns:n.length>0?[n[0]]:[],totalRows:0,rowToGlobalRow:new Map};const s=new Map;for(const m of n)s.set(m.id,m);const a=t.some(e=>e.solo),o=[...t].filter(e=>a?e.solo:!e.muted).sort((e,t)=>e.index-t.index),r=e.filter(e=>!e.muted);let i=0;for(const m of r){const e=s.get(m.patternId),t=m.clipLengthRows??(e?e.length-m.offsetRows:64),n=m.startRow+t;n>i&&(i=n)}if(0===i)return{songPositions:[0],virtualPatterns:n.length>0?[n[0]]:[],totalRows:0,rowToGlobalRow:new Map};const l=Math.ceil(i/64),c=[],u=[],d=new Map;for(let m=0;m<l;m++){const e=64*m,t=Math.min(e+64,i)-e,n=o.map((n,a)=>{const o=[];for(let i=0;i<t;i++){const t=e+i,a=wZ(r,n.id,t,s);if(a){const e=s.get(a.patternId);if(e){const n=a.offsetRows+(t-a.startRow),s=e.channels[a.sourceChannelIndex];s&&n>=0&&n<s.rows.length?o.push({...s.rows[n]}):o.push({...NZ})}else o.push({...NZ})}else o.push({...NZ})}return{id:`vch-${m}-${a}`,name:n.name,rows:o,muted:!1,solo:!1,collapsed:!1,volume:n.volume,pan:n.pan,instrumentId:n.instrumentId,color:n.color}}),a={id:`vp-${m}`,name:`Chunk ${m}`,length:t,channels:n},l=c.length;c.push(a),u.push(l);for(let s=0;s<t;s++)d.set(64*m+s,e+s)}return{songPositions:u,virtualPatterns:c,totalRows:i,rowToGlobalRow:d}}(f.clips,f.tracks,l,b?.initialSpeed??6);k=e.virtualPatterns,v=e.songPositions,w=e.songPositions.length,D=e.virtualPatterns[0]?.channels?.length??a.channels.length}else{v=g?[t]:s,w=g?1:b?.songLength??s.length}const S=e.getCurrentPosition(),M=e.getCurrentRow(),C=a.importMetadata?.furnaceData;if(e.loadSong({name:a.importMetadata?.sourceFile??a.name??"Untitled",format:N,patterns:k,instruments:O.current,songPositions:v,songLength:w,restartPosition:0,numChannels:D,initialSpeed:b?.initialSpeed??6,initialBPM:b?.initialBPM??_.current,linearPeriods:u,channelTrackTables:r??void 0,channelSpeeds:i??void 0,channelGrooves:c??void 0,hivelyNative:d??void 0,hivelyFileData:m??void 0,hivelyMeta:p??void 0,musiclineFileData:h??void 0,speed2:C?.speed2,hz:C?.hz,virtualTempoN:C?.virtualTempoN,virtualTempoD:C?.virtualTempoD,compatFlags:C?.compatFlags,grooves:C?.grooves}),C?.compatFlags&&Object.keys(C.compatFlags).length>0&&os(async()=>{const{FurnaceDispatchEngine:e}=await Promise.resolve().then(()=>Ec);return{FurnaceDispatchEngine:e}},void 0).then(({FurnaceDispatchEngine:e})=>{e.getInstance().setCompatFlags(C.compatFlags)}),e.setStereoSeparation(Ck.getState().stereoSeparation),x)g?e.seekTo(0,0):e.seekTo(S,M);else{const t=E.current,n=jN.getState().currentRow;(t>0||n>0)&&e.seekTo(t,n)}let V=-1,T=-1;e.onRowChange=(e,t,s)=>{const a=0===e||s!==T,r=P.current;if(y(e,r[t]?.length??64,a),f.isArrangementMode){const t=64*s+e;bX.getState().setPlaybackRow(t),jN.getState().setCurrentGlobalRow(t)}0!==e||t===V&&s===T||(V=t,T=s,I.current=!0,queueMicrotask(()=>{n(t,!0),o(s,!0)}))},e.onSongEnd=()=>{},e.play().catch(e=>{})}}else if(!f&&L.current){L.current=!1,A.current?.(),A.current=null;const t=O.current.find(e=>"UADESynth"===e.synthType);if(t){const e=Bw(),n=e.getInstrumentKey(t.id,-1),s=e.instruments.get(n);s&&"triggerRelease"in s&&s.triggerRelease()}e.stop(),e.onRowChange=null,e.onSongEnd=null}return()=>{!f&&L.current&&(C.current.stop(),C.current.onRowChange=null,C.current.onSongEnd=null)}},[f,g,U,T,s,n,o,v,y,w]),{isPlaying:f}},kZ=new Set([".dbx",".dbi",".sunsynth",".sunvox",".xml",".sqs",".seq",".mid",".midi",".wav",".mp3",".ogg",".flac",".aiff",".aif",".m4a",".iff",".8svx",".mid",".midi",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".j2b",".m15",".mdl",".mt2",".mtm",".psm",".pt36",".ptm",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".hvl",".ahx",".okt",".med",".mmd0",".mmd1",".mmd2",".mmd3",".digi",".fc",".fc13",".fc14",".sfc",".fc2",".fc3",".fc4",".smod",".hip",".hip7",".sog",".s7g",".hipc",".hst",".soc",".coso",".tfmx",".mdat",".tfmxpro",".tfmx1.5",".tfmx7v",".tfhd1.5",".tfhd7v",".tfhdpro",".fred",".gray",".sm",".sm1",".sm2",".sm3",".smpro",".bd",".bds",".dw",".dwold",".mc",".mcr",".mco",".jp",".jpn",".jpnd",".rj",".rjp",".dm",".dm1",".dm2",".dlm1",".dlm2",".sa",".sa-p",".sa_old",".sonic",".lion",".abk",".aam",".aon",".aon4",".aon8",".adpcm",".adsc",".mod_adsc4",".bss",".bfc",".bsi",".core",".cin",".dl",".dl_deli",".dln",".ea",".mg",".fp",".fw",".gmc",".gm",".glue",".hd",".ims",".jam",".jc",".kris",".kh",".lme",".ma",".max",".mdst",".mkii",".mk2",".mkiio",".ntp",".osp",".ps",".psf",".pt",".ptm",".puma",".rh",".rhp",".rho",".riff",".sas",".sb",".scr",".sdr",".sg",".snk",".ss",".st26",".sun",".syn",".dh",".uds",".octamed",".tpu",".tcb",".ufo",".mus",".wn",".wb",".ym",".ymst",".sid",".sid1",".sid2",".smn",".bp",".bp3",".sndmon",".sfx",".sfx13",".sfx20",".mms",".smus",".snx",".agi",".vss",".ml",".sng",".qpa",".qts",".sqt",".ash",".aps",".ast",".alp",".amc",".dsc",".dsr",".dss",".dns",".dmu",".dmu2",".ems",".emsv6",".emod",".jmf",".jo",".js",".jb",".jcb",".jcbo",".jd",".jt",".kim",".mon",".mon_old",".mfp",".mosh",".mmdc",".mug",".mug2",".mm4",".mm8",".psa",".prt",".pn",".pap",".pvp",".pat",".sc",".sct",".scn",".scumm",".sjs",".spl",".syn",".synmod",".tf",".thm",".tmk",".tme",".dp",".trc",".tro",".tronic",".dat",".dum",".doda",".dz",".ex",".cm",".cus",".cust",".custom",".hot",".bye",".one",".two",".avp",".mw",".md",".mok",".tiny",".sdata",".npp",".is",".is20",".jpo",".jpold",".powt",".hn",".mtp2",".thn",".arp",".tits",".mcmd",".mcmd_org",".ac1",".ac1d",".aval",".chan",".cp",".cplx",".crb",".di",".eu",".fc-m",".fcm",".ft",".fuz",".fuzz",".gv",".hmc",".hrt",".ice",".it1",".kef",".kef7",".krs",".ksm",".lax",".mexxmp",".mpro",".np",".np1",".np2",".np3",".nr",".nru",".ntpk",".p10",".p21",".p30",".p40a",".p40b",".p41a",".p4x",".p50a",".p5a",".p5x",".p60",".p60a",".p61",".p61a",".p6x",".pha",".pin",".pm",".pm0",".pm01",".pm1",".pm10c",".pm18a",".pm2",".pm20",".pm4",".pm40",".pmz",".polk",".pp10",".pp20",".pp21",".pp30",".ppk",".pr1",".pr2",".prom",".pru",".pru1",".pru2",".prun",".prun1",".prun2",".pwr",".pyg",".pygm",".pygmy",".skt",".skyt",".snt",".st",".st2",".st30",".star",".stpk",".tp",".tp1",".tp2",".tp3",".un2",".unic",".unic2",".wn",".xan",".xann",".zen",".mod_doc",".mod15",".mod15_mst",".mod_ntk",".mod_ntk1",".mod_ntk2",".mod_ntkamp",".mod_flt4",".mod_comp",".mod15_ust",".mod15_st-iv",".mod3",".gt2",".gtk",".dsym",".cba",".act",".c67",".667",".fmt",".dtm",".etx",".is10",".plm",".qc",".rk",".rkb",".rtm",".tfx",".uax",".xmf",".mxtx",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".vgm",".vgz",".nsf",".nsfe",".sap",".ay"]);const DZ=({onFileLoaded:e,children:t})=>{const[n,s]=l.useState(!1),a=l.useRef(e);return l.useEffect(()=>{a.current=e},[e]),l.useEffect(()=>{const e=e=>{if(e.preventDefault(),!e.dataTransfer||0===e.dataTransfer.items.length)return;Array.from(e.dataTransfer.items).some(e=>"file"===e.kind)&&s(!0)},t=e=>{null===e.relatedTarget&&s(!1)},n=e=>{e.preventDefault()},o=async e=>{e.preventDefault(),s(!1);const t=e.target;if(t.closest("[data-sample-drop-zone]")||t.closest("[data-dj-deck-drop]"))return;const n=e.dataTransfer?Array.from(e.dataTransfer.files):[];if(0===n.length)return;const o=n.find(e=>function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return kZ.has(t)}(e.name));if(o)try{await a.current(o)}catch(r){}};return window.addEventListener("dragenter",e),window.addEventListener("dragleave",t),window.addEventListener("dragover",n),window.addEventListener("drop",o),()=>{window.removeEventListener("dragenter",e),window.removeEventListener("dragleave",t),window.removeEventListener("dragover",n),window.removeEventListener("drop",o)}},[]),Yn.jsxDEV("div",{className:"relative w-full h-full",children:[t,n&&Yn.jsxDEV("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center pointer-events-none animate-fade-in",children:Yn.jsxDEV("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary border-dashed rounded-xl p-12 flex flex-col items-center gap-4 shadow-2xl",children:[Yn.jsxDEV(Yt,{size:64,className:"text-accent-primary animate-bounce"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/GlobalDragDropHandler.tsx",lineNumber:121,columnNumber:13},void 0),Yn.jsxDEV("div",{className:"text-center",children:[Yn.jsxDEV("p",{className:"text-2xl font-bold text-white mb-2",children:"Drop your file here"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/GlobalDragDropHandler.tsx",lineNumber:123,columnNumber:15},void 0),Yn.jsxDEV("p",{className:"text-text-muted text-sm",children:"Supports .dbx, .dbi, .xml, .mod, .xm, .it, .s3m, .fur, .mid, and more"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/GlobalDragDropHandler.tsx",lineNumber:126,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/GlobalDragDropHandler.tsx",lineNumber:122,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/GlobalDragDropHandler.tsx",lineNumber:120,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/GlobalDragDropHandler.tsx",lineNumber:119,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ui/GlobalDragDropHandler.tsx",lineNumber:114,columnNumber:5},void 0)};async function SZ(e,t={}){const n=e.name.toLowerCase();try{if(function(e){return e.endsWith(".dbx")||e.endsWith(".mid")||e.endsWith(".midi")||e.endsWith(".sqs")||e.endsWith(".seq")||e.endsWith(".sunvox")||ZI(e)}(n))return t.requireConfirmation?{success:"pending-confirmation",file:e}:await async function(e,t){const{loadPatterns:n,setPatternOrder:s,setCurrentPattern:a,applyEditorMode:o}=ID.getState(),{loadInstruments:r,addInstrument:i,reset:l}=EN.getState(),{setBPM:c,setSpeed:u,setGrooveTemplate:d,reset:m,isPlaying:p,stop:h}=jN.getState(),{setMetadata:f}=RD.getState(),{reset:g}=XD.getState(),b=Bw(),v=e.name.toLowerCase();let y=null,x=null;if(v.endsWith(".sunvox")){y=await e.arrayBuffer();try{const{SunVoxEngine:e}=await os(async()=>{const{SunVoxEngine:e}=await Promise.resolve().then(()=>Ei);return{SunVoxEngine:e}},void 0),{getDevilboxAudioContext:t}=await os(async()=>{const{getDevilboxAudioContext:e}=await Promise.resolve().then(()=>bo);return{getDevilboxAudioContext:e}},void 0),n=e.getInstance();await Promise.race([n.ready(),new Promise((e,t)=>setTimeout(()=>t(new Error("SunVox WASM init timed out")),2e4))]);const s=async()=>{const e=t().sampleRate,s=await n.createHandle(e);try{await n.loadSong(s,y);const e=(await n.getModules(s)).filter(e=>e.id>0);e.length>0&&(x=await Promise.all(e.map(async e=>{const t=await n.saveSynth(s,e.id);return{name:e.name,id:e.id,synthData:t}})))}finally{n.destroyHandle(s)}};await Promise.race([s(),new Promise((e,t)=>setTimeout(()=>t(new Error("module extraction timed out")),1e4))])}catch(N){x=null}}p&&h();b.releaseAll(),t.preserveInstruments||(g(),m(),l(),b.disposeAllInstruments());if(v.endsWith(".dbx")){const t=await e.text(),a=JSON.parse(t),{needsMigration:i,migrateProject:l}=await os(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>bN);return{needsMigration:e,migrateProject:t}},void 0);let u=a.patterns,m=a.instruments;if(i(u,m)){const e=l(u,m);u=e.patterns,m=e.instruments}if(n(u),a.sequence&&Array.isArray(a.sequence)){const e=new Map(u.map((e,t)=>[e.id,t])),t=a.sequence.map(t=>e.get(t)).filter(e=>void 0!==e);t.length>0&&s(t)}return m&&r(m),a.masterEffects&&UD.getState().setMasterEffects(a.masterEffects),c(a.bpm),f(a.metadata),d(a.grooveTemplateId||"straight"),o({}),{success:!0,message:`Loaded: ${a.metadata?.name||e.name}`}}if(v.endsWith(".mid")||v.endsWith(".midi")){const{importMIDIFile:o}=await os(async()=>{const{importMIDIFile:e}=await Promise.resolve().then(()=>Fj);return{importMIDIFile:e}},void 0),i=await o(e,{quantize:t.midiOptions?.quantize??1,mergeChannels:t.midiOptions?.mergeChannels??!1,velocityToVolume:t.midiOptions?.velocityToVolume??!0,defaultPatternLength:t.midiOptions?.defaultPatternLength??64});return 0===i.patterns.length?{success:!1,error:"No patterns found in MIDI file"}:(n(i.patterns),i.instruments.length>0&&r(i.instruments),s(i.patterns.map((e,t)=>t)),a(0),c(i.bpm),f({name:i.metadata.name,author:"",description:`Imported from ${e.name} (${i.metadata.tracks} tracks)`}),{success:!0,message:`Imported: ${i.metadata.name}  ${i.instruments.length} instrument(s), BPM: ${i.bpm}`})}if(v.endsWith(".sqs")||v.endsWith(".seq")){const{parseTD3File:o}=await os(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:r}=await os(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-RYXvH-yI.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([18,1,2,3,4])),{createDefaultTB303Instrument:l}=await os(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-CRsYYbpw.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([17,1,2,3,4])),c=await o(await e.arrayBuffer());if(0===c.patterns.length)return{success:!1,error:"No patterns found in TD-3 file"};let u;if(t.preserveInstruments){const e=EN.getState().instruments.find(e=>"TB303"===e.synthType);e?u=e:(u=l(),i(u))}else u=l(),i(u);const d=EN.getState().instruments.findIndex(e=>e.id===u.id)+1,m=c.patterns.map((e,t)=>{const n=r(e.steps,2),s=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:s,channels:[{id:`ch-${u.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:u.id,color:"#ec4899",rows:n.slice(0,s).map(e=>({...e,instrument:e.note?d:0}))}]}}),p=t.replacePatterns?[]:ID.getState().patterns,h=[...p,...m];return n(h),a(p.length),s(h.map((e,t)=>t)),{success:!0,message:`Imported ${m.length} TD-3 pattern(s)`}}if(v.endsWith(".sunvox")){const t=e.name.replace(/\.sunvox$/i,""),r=256,i={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0},l=x;if(l&&l.length>0){const c=Date.now(),u=l.map((e,t)=>{EN.getState().createInstrument({name:e.name,synthType:"SunVoxSynth",sunvox:{patchData:e.synthData,patchName:e.name,isSong:!1,controlValues:{}}});const n=EN.getState().instruments,s=n.length,a=n[n.length-1],o=Array.from({length:r},(e,t)=>0===t?{note:49,instrument:s,volume:64,effTyp:0,eff:0,effTyp2:0,eff2:0}:{...i});return{id:`ch-svox-${c}-${t}`,name:e.name,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:a.id,color:"#facc15",rows:o}});return n([{id:`svox-${Date.now()}`,name:t,length:r,channels:u}]),a(0),s([0]),f({name:t,author:"",description:`Imported from ${e.name} (${l.length} modules)`}),o({}),{success:!0,message:`Loaded SunVox project: ${t}  ${l.length} module(s)`}}const c=y;EN.getState().createInstrument({name:t,synthType:"SunVoxSynth",sunvox:{patchData:c,patchName:t,isSong:!0,controlValues:{}}});const u=EN.getState().instruments,d=u[u.length-1],m=u.length,p=Array.from({length:r},(e,t)=>0===t?{note:49,instrument:m,volume:64,effTyp:0,eff:0,effTyp2:0,eff2:0}:{...i});return n([{id:`svox-${Date.now()}`,name:t,length:r,channels:[{id:`ch-svox-${Date.now()}`,name:"SunVox",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:d.id,color:"#facc15",rows:p}]}]),a(0),s([0]),f({name:t,author:"",description:`Imported from ${e.name}`}),o({}),{success:!0,message:`Loaded SunVox project: ${t}`}}if(ZI(v)){const{parseModuleToSong:i}=await os(async()=>{const{parseModuleToSong:e}=await import("./parseModuleToSong-BCo4MrbT.js").then(e=>e.b);return{parseModuleToSong:e}},[]),l=await i(e,t.subsong??0,t.uadeMetadata);return r(l.instruments),n(l.patterns),a(0),l.songPositions.length>0&&s(l.songPositions),c(l.initialBPM),6!==l.initialSpeed&&u(l.initialSpeed),f({name:l.name,author:"",description:`Imported from ${e.name}`}),o(l),{success:!0,message:`Imported ${e.name}: ${l.patterns.length} patterns, ${l.instruments.length} instruments`}}return{success:!1,error:`Unsupported song format: ${e.name}`}}(e,t);if(n.endsWith(".dbi"))return await async function(e){try{const{importInstrument:t}=await os(async()=>{const{importInstrument:e}=await Promise.resolve().then(()=>tX);return{importInstrument:e}},void 0),n=await t(e),s=n?.instrument;return s?(EN.getState().addInstrument(s),{success:!0,message:`Imported instrument: ${s.name}`}):{success:!1,error:"Invalid instrument file"}}catch(t){return{success:!1,error:`Failed to load instrument: ${t}`}}}(e);if(n.endsWith(".sunsynth")){const{useUIStore:t}=await os(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>AN);return{useUIStore:e}},void 0);return t.getState().setPendingSunVoxFile(e),{success:!0,message:""}}return n.endsWith(".xml")?await async function(e){try{const t=await e.text(),n=(new DOMParser).parseFromString(t,"text/xml");return n.querySelector("open303preset")?await async function(e){const{parseDb303Preset:t}=await os(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-Dp8mjs8G.js");return{parseDb303Preset:e}},[]),{createDefaultTB303Instrument:n}=await os(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-CRsYYbpw.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([17,1,2,3,4])),s=t(e.documentElement.outerHTML);let a=EN.getState().instruments.find(e=>"TB303"===e.synthType);a||(a=n(),EN.getState().addInstrument(a));const o={...a,tb303:{...a.tb303,...s}};return EN.getState().updateInstrument(a.id,o),{success:!0,message:`Applied DB303 preset to ${a.name}`}}(n):n.querySelector("db303pattern")?await async function(e,t){const{parseDb303Pattern:n}=await os(async()=>{const{parseDb303Pattern:e}=await Promise.resolve().then(()=>GX);return{parseDb303Pattern:e}},void 0),{createDefaultTB303Instrument:s}=await os(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-CRsYYbpw.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([17,1,2,3,4])),a=n(e.documentElement.outerHTML,t,1),o=a.pattern,r=a.tempo;let i=EN.getState().instruments.find(e=>"TB303"===e.synthType);i||(i=s(),EN.getState().addInstrument(i));o.channels[0].instrumentId=i.id;const{loadPatterns:l,setPatternOrder:c,setCurrentPattern:u}=ID.getState(),d=ID.getState().patterns;l([...d,o]),u(d.length),c([d.length]),void 0!==r&&jN.getState().setBPM(r);return{success:!0,message:`Imported DB303 pattern: ${o.name}`}}(n,e.name):{success:!1,error:"Unrecognized XML format"}}catch(t){return{success:!1,error:`Failed to parse XML: ${t}`}}}(e):function(e){return/\.(wav|mp3|ogg|flac|aiff?|m4a|iff|8svx)$/i.test(e)}(n)?await async function(e){return _k.info(`Audio sample: ${e.name}  Auto-import coming soon. Open instrument editor to add manually.`),{success:!0,message:`Recognized audio sample: ${e.name} (manual import required)`}}(e):{success:!1,error:`Unsupported file format: ${e.name}`}}catch(s){return{success:!1,error:`Failed to load ${e.name}: ${s}`}}}const MZ=Object.freeze(Object.defineProperty({__proto__:null,loadFile:SZ},Symbol.toStringTag,{value:"Module"})),CZ="sample-packs-v1",VZ="samplePacksCached",PZ="v1";async function _Z(e){if(localStorage.getItem(VZ)===PZ)return;if(!("caches"in window))return;const t=function(){const e=new Set;for(const t of ks)for(const n of Object.values(t.samples))for(const t of n)t.url&&e.add(t.url);return Array.from(e)}(),n=t.length,s=await caches.open(CZ),a=await Promise.all(t.map(e=>s.match(e).then(e=>!!e))),o=t.filter((e,t)=>!a[t]);let r=n-o.length;if(0===o.length)return localStorage.setItem(VZ,PZ),void e(n,n);e(r,n);let i=0;for(let l=0;l<o.length;l+=4){const t=o.slice(l,l+4);await Promise.all(t.map(async t=>{try{const e=await fetch(t);e.ok&&200===e.status&&await s.put(t,e)}catch(a){i++}r++,e(r,n)}))}0===i&&localStorage.setItem(VZ,PZ)}function OZ(){const e=l.useRef(null),t=l.useRef({nx:0,ny:0,active:!1}),n=l.useRef(0),s=l.useRef(0);return l.useEffect(()=>{const e=e=>{const t=performance.now();if(t-n.current<33)return;if("connected"!==dV.getState().status)return;n.current=t;const s=e.clientX/window.innerWidth,a=e.clientY/window.innerHeight;uV()?.send({type:"peer_mouse",nx:Math.max(0,Math.min(1,s)),ny:Math.max(0,Math.min(1,a))})};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[]),l.useEffect(()=>dV.subscribe(e=>{t.current={nx:e.peerMouseNX,ny:e.peerMouseNY,active:e.peerMouseActive&&"connected"===e.status&&"shared"===e.listenMode}}),[]),l.useEffect(()=>{const n=()=>{if(e.current){const{nx:n,ny:s,active:a}=t.current;a?(e.current.style.display="block",e.current.style.transform=`translate(${n*window.innerWidth}px, ${s*window.innerHeight}px)`):e.current.style.display="none"}s.current=requestAnimationFrame(n)};return s.current=requestAnimationFrame(n),()=>cancelAnimationFrame(s.current)},[]),Yn.jsxDEV("div",{ref:e,style:{position:"fixed",top:0,left:0,display:"none",pointerEvents:"none",zIndex:99999},children:[Yn.jsxDEV("svg",{width:"18",height:"22",viewBox:"0 0 18 22",style:{display:"block",filter:"drop-shadow(0 1px 3px rgba(0,0,0,0.6))"},children:Yn.jsxDEV("path",{d:"M1 1 L1 18 L5.5 13.5 L9.5 21.5 L12.5 20 L8.5 12 L15 12 Z",fill:"#a855f7",stroke:"white",strokeWidth:"1.5",strokeLinejoin:"round"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerMouseCursor.tsx",lineNumber:90,columnNumber:9},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerMouseCursor.tsx",lineNumber:84,columnNumber:7},this),Yn.jsxDEV("span",{style:{position:"absolute",top:20,left:14,fontSize:9,color:"#a855f7",fontFamily:"JetBrains Mono, monospace",fontWeight:700,whiteSpace:"nowrap",textShadow:"0 0 4px rgba(168,85,247,0.6), 0 1px 2px rgba(0,0,0,0.9)",userSelect:"none",letterSpacing:"0.05em"},children:"Friend"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerMouseCursor.tsx",lineNumber:99,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerMouseCursor.tsx",lineNumber:72,columnNumber:5},this)}const TZ=()=>{const e=dV(e=>e.status),t=dV(e=>e.remoteVideoStream),n=dV(e=>e.localVideoStream),s=dV(e=>e.micMuted),a=dV(e=>e.cameraMuted),o=dV(e=>e.toggleMic),r=dV(e=>e.toggleCamera),[i,c]=l.useState(!1),[u,d]=l.useState(!1),[m,p]=l.useState(!1),[h,f]=l.useState({x:window.innerWidth-320-16,y:48}),[g]=l.useState({w:320,h:240}),b=l.useRef(null),v=l.useRef(null),y=l.useRef(null),x=l.useRef(null);l.useEffect(()=>{v.current&&t&&(v.current.srcObject=t)},[t]),l.useEffect(()=>{y.current&&n&&(y.current.srcObject=n)},[n]);const N=l.useCallback(e=>{e.preventDefault(),x.current={startX:e.clientX,startY:e.clientY,startPosX:h.x,startPosY:h.y},e.target.setPointerCapture(e.pointerId)},[h]),w=l.useCallback(e=>{if(!x.current)return;const t=e.clientX-x.current.startX,n=e.clientY-x.current.startY;f({x:Math.max(0,Math.min(window.innerWidth-100,x.current.startPosX+t)),y:Math.max(0,Math.min(window.innerHeight-40,x.current.startPosY+n))})},[]),E=l.useCallback(()=>{x.current=null},[]);if("connected"!==e)return null;if(u)return Yn.jsxDEV("button",{onClick:()=>d(!1),style:{position:"fixed",bottom:36,right:16,zIndex:5e4,padding:"6px 10px",borderRadius:6,background:"#1e1e2e",border:"1px solid #444",color:"#a855f7",fontSize:11,fontFamily:"JetBrains Mono, monospace",cursor:"pointer",display:"flex",alignItems:"center",gap:4},children:[Yn.jsxDEV(An,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:97,columnNumber:9},void 0)," Video"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:77,columnNumber:7},void 0);const k=!!t,D=!!n;return Yn.jsxDEV("div",{ref:b,style:{position:"fixed",left:h.x,top:h.y,width:i?160:g.w,zIndex:5e4,borderRadius:8,overflow:"hidden",boxShadow:"0 4px 24px rgba(0,0,0,0.6), 0 0 0 1px rgba(168,85,247,0.3)",background:"#0d0d14",userSelect:"none"},children:[Yn.jsxDEV("div",{onPointerDown:N,onPointerMove:w,onPointerUp:E,style:{height:28,background:"linear-gradient(180deg, #1e1e2e 0%, #16161e 100%)",borderBottom:"1px solid #333",display:"flex",alignItems:"center",padding:"0 6px",gap:4,cursor:"grab"},children:[Yn.jsxDEV("span",{style:{fontSize:10,color:"#a855f7",fontFamily:"JetBrains Mono, monospace",fontWeight:700,flex:1},children:"VIDEO CHAT"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:137,columnNumber:9},void 0),D&&Yn.jsxDEV("button",{onClick:()=>p(!m),style:LZ,title:m?"Hide self-view":"Show self-view",children:Yn.jsxDEV(Bn,{size:11,color:m?"#a855f7":"#a3a3a3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:144,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:143,columnNumber:11},void 0),Yn.jsxDEV("button",{onClick:o,style:LZ,title:s?"Unmute mic":"Mute mic",children:s?Yn.jsxDEV(In,{size:11,color:"#f87171"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:150,columnNumber:23},void 0):Yn.jsxDEV(Fn,{size:11,color:"#a3a3a3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:150,columnNumber:62},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:149,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:r,style:LZ,title:a?"Enable camera":"Disable camera",children:a?Yn.jsxDEV(Un,{size:11,color:"#f87171"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:155,columnNumber:26},void 0):Yn.jsxDEV(An,{size:11,color:"#a3a3a3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:155,columnNumber:67},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:154,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>c(!i),style:LZ,title:i?"Expand":"Minimize",children:i?Yn.jsxDEV(yt,{size:11,color:"#a3a3a3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:160,columnNumber:24},void 0):Yn.jsxDEV(xt,{size:11,color:"#a3a3a3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:160,columnNumber:66},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:159,columnNumber:9},void 0),Yn.jsxDEV("button",{onClick:()=>d(!0),style:LZ,title:"Hide video window",children:Yn.jsxDEV(Ce,{size:11,color:"#a3a3a3"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:165,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:164,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:122,columnNumber:7},void 0),!i&&Yn.jsxDEV("div",{style:{position:"relative",width:"100%",height:g.h,background:"#0a0a12"},children:[k?Yn.jsxDEV("video",{ref:v,autoPlay:!0,playsInline:!0,muted:!1,style:{width:"100%",height:"100%",objectFit:"cover"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:174,columnNumber:13},void 0):Yn.jsxDEV("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:4},children:[Yn.jsxDEV(Un,{size:24,color:"#555"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:187,columnNumber:15},void 0),Yn.jsxDEV("span",{style:{fontSize:10,color:"#555",fontFamily:"JetBrains Mono, monospace"},children:"Waiting for peer video..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:188,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:182,columnNumber:13},void 0),m&&D&&Yn.jsxDEV("video",{ref:y,autoPlay:!0,playsInline:!0,muted:!0,style:{position:"absolute",bottom:6,right:6,width:96,height:72,objectFit:"cover",borderRadius:4,border:"1px solid rgba(168,85,247,0.4)",boxShadow:"0 2px 8px rgba(0,0,0,0.5)"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:196,columnNumber:13},void 0),s&&Yn.jsxDEV("div",{style:{position:"absolute",bottom:6,left:6,padding:"2px 6px",borderRadius:4,background:"rgba(248,113,113,0.2)",border:"1px solid rgba(248,113,113,0.4)",display:"flex",alignItems:"center",gap:3},children:[Yn.jsxDEV(In,{size:10,color:"#f87171"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:219,columnNumber:15},void 0),Yn.jsxDEV("span",{style:{fontSize:9,color:"#f87171",fontFamily:"JetBrains Mono, monospace"},children:"MUTED"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:220,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:213,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:171,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/collaboration/PeerVideoWindow.tsx",lineNumber:106,columnNumber:5},void 0)},LZ={background:"transparent",border:"none",cursor:"pointer",padding:3,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center"},AZ=l.lazy(()=>os(()=>import("./HelpModal-G-WAjT1N.js"),__vite__mapDeps([19,2,1,4,3])).then(e=>({default:e.HelpModal}))),BZ=l.lazy(()=>os(()=>import("./ExportDialog-Bl7IxzWy.js"),__vite__mapDeps([20,2,1,3,4])).then(e=>({default:e.ExportDialog}))),IZ=l.lazy(()=>os(()=>import("./EditInstrumentModal-DO-M7Dyz.js"),__vite__mapDeps([21,2,1,22,4,23,3,24])).then(e=>({default:e.EditInstrumentModal}))),FZ=l.lazy(()=>os(()=>import("./index-5JaimClt.js"),__vite__mapDeps([25,2,1,24,26,27,23,4,3])).then(e=>({default:e.MasterEffectsModal}))),UZ=l.lazy(()=>os(()=>import("./index-5JaimClt.js"),__vite__mapDeps([25,2,1,24,26,27,23,4,3])).then(e=>({default:e.InstrumentEffectsModal}))),RZ=l.lazy(()=>os(()=>import("./index-5JaimClt.js"),__vite__mapDeps([25,2,1,24,26,27,23,4,3])).then(e=>({default:e.EffectParameterEditor}))),jZ=l.lazy(()=>os(()=>import("./TD3PatternDialog-C6ylbC_9.js"),__vite__mapDeps([28,2,1,17,3,4,18,29])).then(e=>({default:e.TD3PatternDialog}))),XZ=l.lazy(()=>os(()=>import("./DrumpadEditorModal-oMQCn_Qr.js"),__vite__mapDeps([30,2,1,4,3])).then(e=>({default:e.DrumpadEditorModal}))),zZ=l.lazy(()=>os(()=>import("./DrumPadManager-mLJZGJqo.js"),__vite__mapDeps([31,2,1,32,33,34,35,3,4])).then(e=>({default:e.DrumPadManager}))),GZ=l.lazy(()=>os(()=>import("./TipOfTheDay-B57bBGw-.js"),__vite__mapDeps([36,2,1,4,3])).then(e=>({default:e.TipOfTheDay}))),HZ=l.lazy(()=>os(()=>import("./PatternManagement-Ns0SZgVJ.js"),__vite__mapDeps([37,2,1,24,4,3])).then(e=>({default:e.PatternManagement}))),WZ=l.lazy(()=>os(()=>import("./SamplePackBrowser-DCTJS2h_.js"),__vite__mapDeps([35,2,1,3,34,4])).then(e=>({default:e.SamplePackBrowser}))),qZ=l.lazy(()=>os(()=>import("./InstrumentEditorPopout-DGOI8LI2.js"),__vite__mapDeps([38,2,1,22,4,23,3,24])).then(e=>({default:e.InstrumentEditorPopout}))),KZ=l.lazy(()=>os(()=>Promise.resolve().then(()=>sH),void 0).then(e=>({default:e.PianoRoll}))),$Z=l.lazy(()=>os(()=>import("./OscilloscopePopout-BZlVD_YC.js"),__vite__mapDeps([39,2,1,3,4])).then(e=>({default:e.OscilloscopePopout}))),YZ=l.lazy(()=>os(()=>import("./index-DE3MEJ6A.js"),__vite__mapDeps([40,2,1,3,4,41])).then(e=>({default:e.ArrangementView}))),JZ=l.lazy(()=>os(()=>import("./DJView-B1pcUmTm.js").then(e=>e.D),__vite__mapDeps([42,2,1,43,44,45,4,46,24,26,27,23,3,32,33,34])).then(e=>({default:e.DJView}))),QZ=l.lazy(()=>os(()=>import("./VJView-BexYXGXr.js").then(e=>e.a),__vite__mapDeps([47,2,1,3,4,43])).then(e=>({default:e.VJView}))),ZZ=l.lazy(()=>os(()=>Promise.resolve().then(()=>Hj),void 0).then(e=>({default:e.FileBrowser}))),e0=l.lazy(()=>os(()=>Promise.resolve().then(()=>IV),void 0).then(e=>({default:e.AuthModal}))),t0=l.lazy(()=>os(()=>Promise.resolve().then(()=>fR),void 0).then(e=>({default:e.SettingsModal}))),n0=l.lazy(()=>os(()=>Promise.resolve().then(()=>UX),void 0).then(e=>({default:e.RevisionBrowserDialog}))),s0=l.lazy(()=>os(()=>import("./PixiApp-DUEXYeX_.js").then(e=>e.ax),__vite__mapDeps([48,2,1,43,3,4,44,45,41,47])).then(e=>({default:e.PixiApp}))),a0=l.lazy(()=>os(()=>import("./WebGLModalBridge-B6kbYQta.js"),__vite__mapDeps([49,2,1,3,4])).then(e=>({default:e.WebGLModalBridge}))),o0=l.lazy(()=>os(()=>import("./CollaborationSplitView-DPanIWgj.js"),__vite__mapDeps([50,2,1,46,4,3])).then(e=>({default:e.CollaborationSplitView})));function r0(){const{updateAvailable:e,latestVersion:t,currentVersion:n,refresh:s}=function(e=3e5){const[t,n]=l.useState(!1),[s,a]=l.useState(null),o=async()=>{};return l.useEffect(()=>{o();const t=setInterval(o,e);return()=>clearInterval(t)},[e]),{updateAvailable:t,latestVersion:s,currentVersion:{buildNumber:fV,buildHash:gV},refresh:()=>{window.location.reload()}}}(),[a,o]=l.useState(!1),r=function(e=5e3){const[t,n]=l.useState(!1);return l.useEffect(()=>{let t=!1;const s=async()=>{const e=new AbortController,s=setTimeout(()=>e.abort(),3e3);try{await fetch("/",{cache:"no-cache",signal:e.signal}),clearTimeout(s),t||n(!1)}catch{clearTimeout(s),t||n(!0)}};s();const a=setInterval(s,e);return()=>{t=!0,clearInterval(a)}},[e]),t}(),{initialized:i,contextState:c,setInitialized:u,setContextState:d,setToneEngineInstance:m,setAnalyserNode:p,setFFTNode:h}=UD(us(e=>({initialized:e.initialized,contextState:e.contextState,setInitialized:e.setInitialized,setContextState:e.setContextState,setToneEngineInstance:e.setToneEngineInstance,setAnalyserNode:e.setAnalyserNode,setFFTNode:e.setFFTNode}))),{showSamplePackModal:f,setShowSamplePackModal:g,applyAutoCompact:b,activeView:v,toggleActiveView:y,instrumentEditorPoppedOut:x,setInstrumentEditorPoppedOut:N,masterEffectsPoppedOut:w,setMasterEffectsPoppedOut:E,instrumentEffectsPoppedOut:k,setInstrumentEffectsPoppedOut:D,pianoRollPoppedOut:S,setPianoRollPoppedOut:M,oscilloscopePoppedOut:C,setOscilloscopePoppedOut:V,arrangementPoppedOut:P,setArrangementPoppedOut:_,vjPoppedOut:O,setVJPoppedOut:T,showFileBrowser:L,setShowFileBrowser:A}=LN(),B=dV(e=>e.status),I=dV(e=>e.viewMode),F="connected"===B&&"split"===I,[U,R]=l.useState(null),[j,X]=l.useState(!1),[z,G]=l.useState(null),[H,W]=l.useState(null),[q,K]=l.useState(null),$=W_(e=>e.djModeActive),Y=LN(e=>e.modalOpen),J=LN(e=>e.modalData),Q=LN(e=>e.showPatterns),{openModal:Z,closeModal:ee,togglePatterns:te}=LN(),{showPatternDialog:ne,closePatternDialog:se,showKnobBar:ae,setShowKnobBar:oe}=OM();l.useEffect(()=>{const e=localStorage.getItem("devilbox-seen-version"),t="false"!==localStorage.getItem("show-tips-at-startup");e!==n.buildNumber?Z("tips",{initialTab:"changelog"}):t&&Z("tips",{initialTab:"tips"})},[n.buildNumber,Z]),$C(),l.useEffect(()=>{!function(){if(lZ)return;lZ=!0;const e=()=>{iZ(WC.SETTINGS,{settings:oZ("devilbox-settings"),keyboard:oZ("keyboard-preferences"),theme:oZ("devilbox-theme"),ui:oZ("devilbox-ui-settings")})};Ck.subscribe(e),dR.subscribe(e),JD.subscribe(e),OM.subscribe(()=>{iZ(WC.MIDI_CONFIG,{midiSettings:oZ("midi-settings"),ccMappings:oZ("cc-mappings-v1"),padMappings:oZ("pad-mappings-v1"),buttonMappings:oZ("button-mappings-v1")})}),"undefined"!=typeof window&&window.addEventListener("storage",e=>{if("master-fx-user-presets"===e.key&&e.newValue)try{const t=JSON.parse(e.newValue);iZ(WC.MASTER_FX_PRESETS,t)}catch{}}),"undefined"!=typeof window&&window.addEventListener("storage",e=>{if("devilbox_drumpad"===e.key&&e.newValue)try{const t=JSON.parse(e.newValue);iZ(WC.DRUM_PADS,t)}catch{}}),"undefined"!=typeof window&&window.addEventListener("storage",e=>{if("devilbox-mpc-presets"===e.key&&e.newValue)try{const t=JSON.parse(e.newValue);iZ(WC.MPC_PRESETS,t)}catch{}})}()},[]),l.useEffect(()=>{_Z((e,t)=>{e===t?LN.getState().setStatusMessage("SAMPLES READY",!1,2e3):LN.getState().setStatusMessage(`SAMPLES ${e}/${t}`,!1,0)})},[]),function(){const{isPlaying:e,togglePlayPause:t,stop:n}=jN(),{currentPatternIndex:s,patterns:a,setCurrentPattern:o,currentOctave:r,setCurrentOctave:i,cursor:c,moveCursorToChannel:u}=ID();l.useEffect(()=>{const e=rS();e.init();const l=[];return l.push(e.registerAction("transport.play",()=>{t()})),l.push(e.registerAction("transport.stop",()=>{n()})),l.push(e.registerAction("transport.playFromStart",()=>{n(),setTimeout(()=>t(),50)})),l.push(e.registerAction("pattern.next",()=>{s<a.length-1&&o(s+1)})),l.push(e.registerAction("pattern.previous",()=>{s>0&&o(s-1)})),l.push(e.registerAction("pattern.first",()=>{o(0)})),l.push(e.registerAction("pattern.last",()=>{o(a.length-1)})),l.push(e.registerAction("octave.up",()=>{r<8&&i(r+1)})),l.push(e.registerAction("octave.down",()=>{r>0&&i(r-1)})),l.push(e.registerAction("channel.next",()=>{const e=a[s];e&&c.channelIndex<e.channels.length-1&&u(c.channelIndex+1)})),l.push(e.registerAction("channel.previous",()=>{c.channelIndex>0&&u(c.channelIndex-1)})),l.push(e.registerAction("dj.knobPage.next",()=>{OM.getState().nextDJKnobPage()})),l.push(e.registerAction("dj.knobPage.prev",()=>{OM.getState().prevDJKnobPage()})),(()=>{try{const{getDJEngine:t}=require("../../engine/dj/DJEngine"),n=t();l.push(e.registerAction("dj.deckA.play",()=>{n.deckA.play()})),l.push(e.registerAction("dj.deckA.pause",()=>{n.deckA.pause()})),l.push(e.registerAction("dj.deckA.stop",()=>{n.deckA.stop()})),l.push(e.registerAction("dj.deckA.cue",()=>{n.deckA.cue(0)})),l.push(e.registerAction("dj.deckB.play",()=>{n.deckB.play()})),l.push(e.registerAction("dj.deckB.pause",()=>{n.deckB.pause()})),l.push(e.registerAction("dj.deckB.stop",()=>{n.deckB.stop()})),l.push(e.registerAction("dj.deckB.cue",()=>{n.deckB.cue(0)})),l.push(e.registerAction("dj.killAll",()=>{n.killAll()})),l.push(e.registerAction("dj.deckA.eqKillLow",()=>{n.deckA.setEQKill("low",!n.deckA.getEQKill("low"))})),l.push(e.registerAction("dj.deckA.eqKillMid",()=>{n.deckA.setEQKill("mid",!n.deckA.getEQKill("mid"))})),l.push(e.registerAction("dj.deckA.eqKillHi",()=>{n.deckA.setEQKill("high",!n.deckA.getEQKill("high"))})),l.push(e.registerAction("dj.deckB.eqKillLow",()=>{n.deckB.setEQKill("low",!n.deckB.getEQKill("low"))})),l.push(e.registerAction("dj.deckB.eqKillMid",()=>{n.deckB.setEQKill("mid",!n.deckB.getEQKill("mid"))})),l.push(e.registerAction("dj.deckB.eqKillHi",()=>{n.deckB.setEQKill("high",!n.deckB.getEQKill("high"))}))}catch{}})(),()=>{l.forEach(e=>e())}},[e,t,n,s,a,o,r,i,c,u])}(),function(){const e=l.useCallback(e=>{const{patterns:t,currentPatternIndex:n,setCurrentPattern:s,currentOctave:a,setCurrentOctave:o}=ID.getState(),{isPlaying:r,isLooping:i,play:l,stop:c,pause:u,setIsLooping:d,currentRow:m,setCurrentRow:p}=jN.getState(),{currentInstrumentId:h,setCurrentInstrument:f,instruments:g}=EN.getState(),{undo:b,redo:v}=CD.getState();switch(e){case"transport.play":r||l();break;case"transport.stop":c();break;case"transport.pause":u();break;case"transport.loop":d(!i);break;case"nav.patternUp":n<t.length-1&&s(n+1);break;case"nav.patternDown":n>0&&s(n-1);break;case"nav.rowUp":m>0&&p(m-1);break;case"nav.rowDown":{const e=t[n];e&&m<e.length-1&&p(m+1);break}case"nav.toStart":p(0);break;case"nav.toEnd":{const e=t[n];e&&p(e.length-1);break}case"edit.octaveUp":a<8&&o(a+1);break;case"edit.octaveDown":a>0&&o(a-1);break;case"edit.instrumentUp":if(null!==h){const e=h+1;g.some(t=>t.id===e)&&f(e)}break;case"edit.instrumentDown":if(null!==h&&h>1){const e=h-1;g.some(t=>t.id===e)&&f(e)}break;case"edit.undo":b();break;case"edit.redo":v()}},[]),t=l.useCallback((e,t)=>{const{instruments:n}=EN.getState(),s=Bw(),a=aS().getControlledInstrument();let o=n.filter(e=>("TB303"===e.synthType||"Buzz3o3"===e.synthType)&&e.tb303);if(null!==a){const e=n.find(e=>e.id===a);if(e&&e.tb303)o=[e];else if(e)return}0!==o.length&&o.forEach(n=>{if(!n.tb303)return;const a=JSON.parse(JSON.stringify(n.tb303));switch(e){case"cutoff":a.filter&&(a.filter.cutoff=t);break;case"resonance":a.filter&&(a.filter.resonance=t);break;case"envMod":a.filterEnvelope&&(a.filterEnvelope.envMod=t);break;case"decay":a.filterEnvelope&&(a.filterEnvelope.decay=t);break;case"accent":a.accent&&(a.accent.amount=t);break;case"slideTime":a.slide&&(a.slide.time=t);break;case"overdrive":a.overdrive&&(a.overdrive.amount=t);break;case"normalDecay":a.devilFish&&(a.devilFish.normalDecay=t);break;case"accentDecay":a.devilFish&&(a.devilFish.accentDecay=t);break;case"softAttack":a.devilFish&&(a.devilFish.softAttack=t);break;case"vegSustain":a.devilFish&&(a.devilFish.vegSustain=t);break;case"filterFM":a.devilFish&&(a.devilFish.filterFM=t);break;case"filterTracking":a.devilFish&&(a.devilFish.filterTracking=t)}s.updateTB303Parameters(n.id,a)})},[]),n=l.useCallback((n,s,a)=>{if(s.startsWith("transport.")||s.startsWith("nav.")||s.startsWith("edit.")||s.startsWith("channel.")||s.startsWith("pattern.")||s.startsWith("view."))a>64&&e(s);else if(s.startsWith("tb303.")){const e=s.replace("tb303.","");return void t(e,a)}},[e,t]);l.useEffect(()=>aS().onParameterChange(n),[n])}(),l.useEffect(()=>{const e=lS(),t=Aw.getInstance();e.init();const n=(e,n)=>{const s=EN.getState().instruments.find(t=>t.id===e.targetInstrumentId);if(!s)return;const a=e.targetNote??60,o=le(a,"midi").toNote(),r=2===o.length?o.charAt(0)+"-"+o.charAt(1):o,i=n/127;if(n>0){t.triggerPolyNoteAttack(s.id,o,i,{...s,isLive:!0});const e=ID.getState(),n=jN.getState();if(e.recordMode){const t=n.isPlaying?n.currentRow:e.cursor.rowIndex;let a=e.cursor.channelIndex;e.multiRecEnabled&&n.isPlaying&&(a=e.findBestChannel());const o=Xa(r);if(e.setCell(a,t,{note:o,instrument:s.id}),!n.isPlaying&&e.editStep>0){const n=e.patterns[e.currentPatternIndex];if(n){const s=(t+e.editStep)%n.length;e.moveCursorToRow(s)}}}}else{t.triggerPolyNoteRelease(s.id,o,{...s,isLive:!0});const e=ID.getState(),n=jN.getState();e.recordMode&&n.isPlaying&&e.recReleaseEnabled}},s=e.onTrigger(n),a=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const s=OM.getState();if("NumpadEnter"===t.code||"Enter"===t.key&&3===t.location)return t.preventDefault(),void s.togglePadBank();let a={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==a){"B"===s.padBank&&(a+=8);const t=36+a,o=e.getMapping(9,t);o&&n(o,127)}},o=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const s=OM.getState();let a={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==a){"B"===s.padBank&&(a+=8);const t=36+a,o=e.getMapping(9,t);o&&n(o,0)}};return window.addEventListener("keydown",a),window.addEventListener("keyup",o),()=>{s(),window.removeEventListener("keydown",a),window.removeEventListener("keyup",o)}},[]),EZ(),aZ();const{updateMasterEffect:re}=UD();l.useEffect(()=>{b()},[b]);const{save:ie}=function(){const{isDirty:e,markAsModified:t}=RD(),n=l.useRef(null),s=l.useRef(!1),a=l.useRef(!0);l.useEffect(()=>{s.current||(s.current=!0,TX().then(e=>{e&&OX()}))},[]),l.useEffect(()=>ID.subscribe((e,n)=>{a.current?a.current=!1:e.patterns!==n.patterns&&t()}),[t]),l.useEffect(()=>EN.subscribe((e,n)=>{e.instruments!==n.instruments&&t()}),[t]),l.useEffect(()=>jN.subscribe((e,n)=>{e.bpm===n.bpm&&e.grooveTemplateId===n.grooveTemplateId||t()}),[t]),l.useEffect(()=>bX.subscribe((e,n)=>{e.clips===n.clips&&e.tracks===n.tracks&&e.markers===n.markers||t()}),[t]);const o=l.useRef(null),r=l.useCallback(()=>{n.current&&clearTimeout(n.current),o.current&&MX(o.current),n.current=setTimeout(()=>{e&&(o.current=SX(t=>{t.timeRemaining()>50?_X():n.current=setTimeout(()=>{e&&_X()},5e3)},{timeout:6e4}))},3e4)},[e]);return l.useEffect(()=>(e&&r(),()=>{n.current&&clearTimeout(n.current),o.current&&MX(o.current)}),[e,r]),l.useEffect(()=>{const t=t=>{e&&(_X(),t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e]),{save:l.useCallback(()=>_X(),[]),load:l.useCallback(()=>OX(),[]),clear:LX,isDirty:e}}();l.useEffect(()=>(CG.initialized||(window.addEventListener("keydown",PG,{capture:!0}),window.addEventListener("keyup",_G,{capture:!0}),CG.initialized=!0,CG.debug),()=>{CG.initialized&&(window.removeEventListener("keydown",PG,{capture:!0}),window.removeEventListener("keyup",_G,{capture:!0}),CG.initialized=!1,CG.globalHandler=null,CG.viewHandlers.clear())}),[]),l.useEffect(()=>{(async()=>{try{const e=Bw();m(e),p(e.analyser),h(e.fft),d(e.getContextState()),u(!0),LN.getState().setStatusMessage("HARDWARE PRESETS READY",!1,5e3)}catch(e){R(e instanceof Error?e.message:"Unknown error")}})()},[]);const ce=Ck(e=>e.useBLEP);l.useEffect(()=>{if(!i)return;Bw().setBlepEnabled(ce)},[ce,i]);const{undo:ue,redo:de,canUndo:me,canRedo:pe}=CD(),{replacePattern:he,currentPatternIndex:fe}=ID(),ge=l.useCallback(()=>{if(!me())return;const e=ue();e&&he(fe,e)},[ue,me,he,fe]),be=l.useCallback(()=>{if(!pe())return;const e=de();e&&he(fe,e)},[de,pe,he,fe]);l.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if((e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey)return e.preventDefault(),void ge();if((e.ctrlKey||e.metaKey)&&"z"===e.key&&e.shiftKey||(e.ctrlKey||e.metaKey)&&"y"===e.key)return e.preventDefault(),void be();if((e.ctrlKey||e.metaKey)&&"s"===e.key)return e.preventDefault(),void ie();if("Escape"===e.key){e.preventDefault();const t=LN.getState();return void(t.modalOpen?t.closeModal():t.showPatterns?t.togglePatterns():"vj"!==t.activeView&&"drumpad"!==t.activeView||t.setActiveView("tracker"))}if(e.shiftKey&&"?"===e.key)return e.preventDefault(),void LN.getState().openModal("help");if(e.ctrlKey&&e.shiftKey&&"E"===e.key)return e.preventDefault(),void LN.getState().openModal("export");if(e.ctrlKey&&e.shiftKey&&"P"===e.key)return e.preventDefault(),void LN.getState().togglePatterns();if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"A"===e.key)return e.preventDefault(),void y();if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"D"===e.key){e.preventDefault();const t=LN.getState();return void t.setActiveView("dj"===t.activeView?"tracker":"dj")}if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"V"===e.key){e.preventDefault();const t=LN.getState();return void t.setActiveView("vj"===t.activeView?"tracker":"vj")}if((e.ctrlKey||e.metaKey)&&"k"===e.key)return e.preventDefault(),void oe(!ae);if((e.ctrlKey||e.metaKey)&&"i"===e.key&&!e.shiftKey){e.preventDefault();const t=LN.getState();return void("instruments"===t.modalOpen?t.closeModal():t.openModal("instruments"))}if((e.ctrlKey||e.metaKey)&&"m"===e.key&&!e.shiftKey){e.preventDefault();const t=LN.getState();return void("masterFx"===t.modalOpen?t.closeModal():t.openModal("masterFx"))}if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key){e.preventDefault();const t=LN.getState();return void("instrumentFx"===t.modalOpen?t.closeModal():t.openModal("instrumentFx"))}if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"M"===e.key)return e.preventDefault(),void UD.getState().toggleMasterMute();if(!("l"!==e.key&&"L"!==e.key||e.ctrlKey||e.metaKey||e.altKey))return e.preventDefault(),void XM.getState().toggleLiveMode();const t=parseInt(e.key);if(!isNaN(t)&&t>=1&&t<=9){const n=XM.getState();if(n.isLiveMode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();const s=t-1;return void(s<ID.getState().patterns.length&&n.queuePattern(s))}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ge,be,ie,y]);const ve=(e,t)=>{if(!z)return;const n=UD.getState().masterEffects.find(e=>e.id===z.effect.id),s={...n?.parameters??z.effect.parameters,[e]:t};re(z.effect.id,{parameters:s}),G(e=>e?{...e,effect:{...e.effect,parameters:s}}:null)},ye=e=>{z&&(re(z.effect.id,{wet:e}),G(t=>t?{...t,effect:{...t.effect,wet:e}}:null))};l.useEffect(()=>{const e=async()=>{if("running"!==c)try{const e=Bw();await e.init(),d(e.getContextState())}catch(t){}window.removeEventListener("click",e),window.removeEventListener("keydown",e),window.removeEventListener("touchstart",e)};return window.addEventListener("click",e),window.addEventListener("keydown",e),window.addEventListener("touchstart",e),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",e),window.removeEventListener("touchstart",e)}},[c,d]);const xe=l.useCallback(async e=>{const t=await SZ(e,{requireConfirmation:!1});!0===t.success?_k.success(t.message):!1===t.success&&_k.error(t.error)},[]),Ne=l.useCallback(async e=>{if("dj"===LN.getState().activeView)return;if(/\.(wav|mp3|ogg|flac|aiff?|m4a|iff|8svx)$/i.test(e.name))return void LN.getState().setPendingAudioFile(e);if(/\.(sqs|seq)$/i.test(e.name))return void LN.getState().setPendingTD3File(e);if(/\.dbi$/i.test(e.name))return void K(e);if(/\.sunvox$/i.test(e.name))return void LN.getState().setPendingSunVoxFile(e);if(/\.dbx$/i.test(e.name))return void W(e);const t=await SZ(e,{requireConfirmation:!0});"pending-confirmation"===t.success?LN.getState().setPendingModuleFile(t.file):!0===t.success?_k.success(t.message):!1===t.success&&_k.error(t.error)},[]),we=async()=>{try{const e=Bw();await e.init(),d(e.getContextState()),X(!1)}catch(e){R(e instanceof Error?e.message:"Unknown error")}};return"webgl"===Ck(e=>e.renderMode)?Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"h-screen w-screen flex items-center justify-center bg-dark-bg",children:Yn.jsxDEV("span",{className:"text-text-muted font-mono text-sm",children:"Loading WebGL UI..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:530,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:529,columnNumber:9},this),children:Yn.jsxDEV(DZ,{onFileLoaded:Ne,children:[Yn.jsxDEV(s0,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:534,columnNumber:11},this),Yn.jsxDEV(dZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:536,columnNumber:11},this),Yn.jsxDEV(pZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:537,columnNumber:11},this),Yn.jsxDEV(fZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:538,columnNumber:11},this),r&&Yn.jsxDEV(xZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:539,columnNumber:31},this),e&&!a&&Yn.jsxDEV(mZ,{onRefresh:s,onDismiss:()=>o(!0),currentVersion:n.buildNumber,latestVersion:t?.buildNumber||"unknown"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:541,columnNumber:13},this),Yn.jsxDEV(a0,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:548,columnNumber:11},this),Yn.jsxDEV(OZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:549,columnNumber:11},this),Yn.jsxDEV(TZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:550,columnNumber:11},this),Yn.jsxDEV(l.Suspense,{fallback:null,children:z&&Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in",children:Yn.jsxDEV("div",{className:"max-w-md w-full mx-4 animate-slide-in-up",children:Yn.jsxDEV(RZ,{effect:z.effect,onUpdateParameter:ve,onUpdateWet:ye,onClose:()=>G(null)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:557,columnNumber:19},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:556,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:555,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:553,columnNumber:11},this),Yn.jsxDEV(bZ,{isOpen:null!==H,file:H,onCancel:()=>W(null),onConfirm:async()=>{H&&await xe(H),W(null)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:569,columnNumber:11},this),Yn.jsxDEV(yZ,{isOpen:null!==q,file:q,onCancel:()=>K(null),onConfirm:async()=>{q&&await SZ(q),K(null)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:580,columnNumber:11},this),x&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>N(!1),title:"DEViLBOX  Instrument Editor",width:1e3,height:800,children:Yn.jsxDEV(qZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:600,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:593,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:592,columnNumber:13},this),w&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>E(!1),title:"DEViLBOX  Master Effects",width:1e3,height:800,children:Yn.jsxDEV(FZ,{isOpen:!0,onClose:()=>E(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:613,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:606,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:605,columnNumber:13},this),k&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>D(!1),title:"DEViLBOX  Instrument Effects",width:1e3,height:800,children:Yn.jsxDEV(UZ,{isOpen:!0,onClose:()=>D(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:626,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:619,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:618,columnNumber:13},this),S&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>M(!1),title:"DEViLBOX  Piano Roll",width:1200,height:600,children:Yn.jsxDEV("div",{className:"h-screen w-screen bg-dark-bgSecondary",children:Yn.jsxDEV(KZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:640,columnNumber:19},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:639,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:632,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:631,columnNumber:13},this),P&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>_(!1),title:"DEViLBOX  Arrangement",width:1400,height:700,children:Yn.jsxDEV("div",{className:"h-screen w-screen bg-dark-bg",children:Yn.jsxDEV(YZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:655,columnNumber:19},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:654,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:647,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:646,columnNumber:13},this),C&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>V(!1),title:"DEViLBOX  Visualizer",width:800,height:500,children:Yn.jsxDEV($Z,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:669,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:662,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:661,columnNumber:13},this),O&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>T(!1),title:"DEViLBOX  VJ",width:1280,height:720,children:Yn.jsxDEV("div",{className:"h-screen w-screen bg-black",children:Yn.jsxDEV(QZ,{isPopout:!0},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:683,columnNumber:19},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:682,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:675,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:674,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:533,columnNumber:9},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:528,columnNumber:7},this):U?Yn.jsxDEV("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:Yn.jsxDEV("div",{className:"panel p-8 max-w-md",children:[Yn.jsxDEV("h2",{className:"text-xl font-bold text-accent-error mb-4",children:"Audio Initialization Error"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:697,columnNumber:11},this),Yn.jsxDEV("p",{className:"text-text-secondary mb-4",children:U},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:698,columnNumber:11},this),Yn.jsxDEV(TV,{variant:"primary",onClick:()=>window.location.reload(),children:"Reload Application"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:699,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:696,columnNumber:9},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:695,columnNumber:7},this):i?j&&"running"!==c?Yn.jsxDEV(GV,{onShowExport:()=>Z("export"),onShowHelp:()=>Z("help"),onShowMasterFX:()=>{const e=LN.getState();"masterFx"===e.modalOpen?e.closeModal():e.openModal("masterFx")},onShowPatterns:()=>te(),onShowInstruments:()=>Z("instruments"),onLoad:()=>A(!0),onShowDrumpads:()=>Z("drumpads"),children:Yn.jsxDEV("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:Yn.jsxDEV("div",{className:"text-center max-w-2xl",children:[Yn.jsxDEV("div",{className:"mb-8",children:[Yn.jsxDEV("h1",{className:"text-5xl font-bold text-text-primary mb-2 tracking-tight",children:"DEViLBOX"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:736,columnNumber:15},this),Yn.jsxDEV("p",{className:"text-lg text-text-secondary",children:"TB-303 Acid Tracker with Devil Fish Mod"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:739,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:735,columnNumber:13},this),Yn.jsxDEV(TV,{variant:"primary",size:"lg",onClick:we,icon:Yn.jsxDEV(Oe,{size:20},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:749,columnNumber:21},this),className:"shadow-glow animate-pulse-glow",children:"Start Audio Engine"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:745,columnNumber:13},this),Yn.jsxDEV("div",{className:"mt-12 grid grid-cols-2 gap-4 text-left",children:[Yn.jsxDEV("div",{className:"card p-4",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 mb-2",children:[Yn.jsxDEV("div",{className:"p-2 rounded-md bg-accent-primary/20 text-accent-primary",children:Yn.jsxDEV(_e,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:760,columnNumber:21},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:759,columnNumber:19},this),Yn.jsxDEV("h3",{className:"font-semibold text-text-primary",children:"22 Synth Engines"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:762,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:758,columnNumber:17},this),Yn.jsxDEV("p",{className:"text-sm text-text-secondary",children:"Including authentic TB-303 with accent and slide"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:764,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:757,columnNumber:15},this),Yn.jsxDEV("div",{className:"card p-4",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 mb-2",children:[Yn.jsxDEV("div",{className:"p-2 rounded-md bg-accent-secondary/20 text-accent-secondary",children:Yn.jsxDEV(ct,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:772,columnNumber:21},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:771,columnNumber:19},this),Yn.jsxDEV("h3",{className:"font-semibold text-text-primary",children:"Pattern Editor"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:774,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:770,columnNumber:17},this),Yn.jsxDEV("p",{className:"text-sm text-text-secondary",children:"4-16 channels with FT2-style keyboard layout"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:776,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:769,columnNumber:15},this),Yn.jsxDEV("div",{className:"card p-4",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 mb-2",children:[Yn.jsxDEV("div",{className:"p-2 rounded-md bg-accent-warning/20 text-accent-warning",children:Yn.jsxDEV(Pe,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:784,columnNumber:21},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:783,columnNumber:19},this),Yn.jsxDEV("h3",{className:"font-semibold text-text-primary",children:"Automation"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:786,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:782,columnNumber:17},this),Yn.jsxDEV("p",{className:"text-sm text-text-secondary",children:"Real-time parameter curves for filter sweeps"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:788,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:781,columnNumber:15},this),Yn.jsxDEV("div",{className:"card p-4",children:[Yn.jsxDEV("div",{className:"flex items-center gap-3 mb-2",children:[Yn.jsxDEV("div",{className:"p-2 rounded-md bg-accent-success/20 text-accent-success",children:Yn.jsxDEV(Ge,{size:18},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:796,columnNumber:21},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:795,columnNumber:19},this),Yn.jsxDEV("h3",{className:"font-semibold text-text-primary",children:"36+ Presets"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:798,columnNumber:19},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:794,columnNumber:17},this),Yn.jsxDEV("p",{className:"text-sm text-text-secondary",children:"Factory sounds for instant acid basslines"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:800,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:793,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:756,columnNumber:13},this),Yn.jsxDEV("p",{className:"mt-8 text-sm text-text-muted",children:["Press ",Yn.jsxDEV("kbd",{className:"px-2 py-0.5 rounded bg-dark-bgTertiary border border-dark-border text-text-secondary",children:"?"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:808,columnNumber:21},this)," anytime for help"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:807,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:733,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:732,columnNumber:9},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:723,columnNumber:7},this):Yn.jsxDEV(DZ,{onFileLoaded:Ne,children:Yn.jsxDEV(GV,{onShowExport:()=>Z("export"),onShowHelp:()=>Z("help"),onShowMasterFX:()=>{const e=LN.getState();"masterFx"===e.modalOpen?e.closeModal():e.openModal("masterFx")},onShowPatterns:()=>te(),onShowInstruments:()=>Z("instruments"),onLoad:()=>A(!0),onShowDrumpads:()=>Z("drumpads"),onShowAuth:()=>Z("auth"),children:[Yn.jsxDEV("div",{className:"flex flex-col flex-1 min-h-0 min-w-0 overflow-y-hidden",children:[Yn.jsxDEV("div",{className:"flex flex-1 min-h-0 min-w-0 overflow-y-hidden",children:Yn.jsxDEV("div",{className:"flex flex-col min-h-0 min-w-0 flex-1",children:[F&&"tracker"===v&&Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"Loading collab..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:836,columnNumber:35},this),children:Yn.jsxDEV(o0,{onShowPatterns:()=>te(),onShowExport:()=>Z("export"),onShowHelp:e=>Z("help",{initialTab:e||"shortcuts"}),onShowMasterFX:()=>{const e=LN.getState();"masterFx"===e.modalOpen?e.closeModal():e.openModal("masterFx")},onShowInstrumentFX:()=>{const e=LN.getState();"instrumentFx"===e.modalOpen?e.closeModal():e.openModal("instrumentFx")},onShowInstruments:()=>Z("instruments"),onShowDrumpads:()=>Z("drumpads"),showPatterns:Q,showMasterFX:"masterFx"===Y,showInstrumentFX:"instrumentFx"===Y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:837,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:836,columnNumber:15},this),"tracker"===v&&!F&&Yn.jsxDEV(Yn.Fragment,{children:[Q&&Yn.jsxDEV("div",{className:"h-48 border-b border-dark-border animate-fade-in",children:Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"h-full flex items-center justify-center text-text-muted",children:"Loading patterns..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:857,columnNumber:41},this),children:Yn.jsxDEV(HZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:858,columnNumber:23},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:857,columnNumber:21},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:856,columnNumber:19},this),Yn.jsxDEV("div",{className:"flex-1 min-h-0 min-w-0 flex flex-col",children:Yn.jsxDEV(wH,{onShowPatterns:()=>te(),onShowExport:()=>Z("export"),onShowHelp:e=>Z("help",{initialTab:e||"shortcuts"}),onShowMasterFX:()=>{const e=LN.getState();"masterFx"===e.modalOpen?e.closeModal():e.openModal("masterFx")},onShowInstrumentFX:()=>{const e=LN.getState();"instrumentFx"===e.modalOpen?e.closeModal():e.openModal("instrumentFx")},onShowInstruments:()=>Z("instruments"),onShowDrumpads:()=>Z("drumpads"),showPatterns:Q,showMasterFX:"masterFx"===Y,showInstrumentFX:"instrumentFx"===Y},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:864,columnNumber:19},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:863,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:853,columnNumber:15},this),"arrangement"===v&&Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"Loading arrangement..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:881,columnNumber:35},this),children:Yn.jsxDEV(YZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:882,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:881,columnNumber:15},this),("dj"===v||"vj"===v&&$)&&Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"Loading DJ mode..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:887,columnNumber:35},this),children:Yn.jsxDEV("div",{style:{display:"dj"===v?"contents":"none"},children:Yn.jsxDEV(JZ,{onShowDrumpads:()=>Z("drumpads")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:889,columnNumber:19},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:888,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:887,columnNumber:15},this),"drumpad"===v&&Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"Loading drum pads..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:895,columnNumber:35},this),children:Yn.jsxDEV(zZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:896,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:895,columnNumber:15},this),"pianoroll"===v&&Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"Loading piano roll..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:901,columnNumber:35},this),children:Yn.jsxDEV(KZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:902,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:901,columnNumber:15},this),"vj"===v&&Yn.jsxDEV(l.Suspense,{fallback:Yn.jsxDEV("div",{className:"flex-1 flex items-center justify-center text-text-muted bg-black",children:"Loading VJ..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:907,columnNumber:35},this),children:Yn.jsxDEV(QZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:908,columnNumber:17},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:907,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:833,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:831,columnNumber:9},this),Yn.jsxDEV(DH,{onShowTips:()=>Z("tips",{initialTab:"tips"})},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:916,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:829,columnNumber:9},this),Yn.jsxDEV(l.Suspense,{fallback:null,children:["settings"===Y&&Yn.jsxDEV(t0,{onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:921,columnNumber:38},this),"help"===Y&&Yn.jsxDEV(AZ,{isOpen:!0,onClose:ee,initialTab:J?.initialTab||"shortcuts"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:922,columnNumber:34},this),"export"===Y&&Yn.jsxDEV(BZ,{isOpen:!0,onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:923,columnNumber:36},this),"instruments"===Y&&Yn.jsxDEV(IZ,{isOpen:!0,onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:924,columnNumber:41},this),"masterFx"===Y&&Yn.jsxDEV(FZ,{isOpen:!0,onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:925,columnNumber:38},this),"instrumentFx"===Y&&Yn.jsxDEV(UZ,{isOpen:!0,onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:926,columnNumber:42},this),ne&&Yn.jsxDEV(jZ,{isOpen:ne,onClose:se},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:927,columnNumber:28},this),"drumpads"===Y&&Yn.jsxDEV(zZ,{onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:928,columnNumber:38},this),"midi-pads"===Y&&Yn.jsxDEV(XZ,{isOpen:!0,onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:929,columnNumber:39},this),"revisions"===Y&&Yn.jsxDEV(n0,{isOpen:!0,onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:930,columnNumber:39},this),L&&Yn.jsxDEV(ZZ,{isOpen:L,onClose:()=>A(!1),mode:"load",onLoad:async(e,t)=>{A(!1);try{const n=new File([JSON.stringify(e)],t,{type:"application/json"}),s=await SZ(n,{requireConfirmation:!1});!0===s.success?_k.success(s.message):!1===s.success&&_k.error(s.error)}catch(n){_k.error("Failed to load project")}},onLoadTrackerModule:async(e,t)=>{A(!1);try{const n=new File([e],t),s=await SZ(n,{requireConfirmation:!1});!0===s.success?_k.success(s.message):!1===s.success&&_k.error(s.error)}catch(n){_k.error("Failed to load file")}}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:932,columnNumber:11},this),f&&Yn.jsxDEV(WZ,{onClose:()=>g(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:970,columnNumber:33},this),"tips"===Y&&Yn.jsxDEV(GZ,{isOpen:!0,onClose:ee,initialTab:J?.initialTab||"tips"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:972,columnNumber:11},this),z&&Yn.jsxDEV("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in",children:Yn.jsxDEV("div",{className:"max-w-md w-full mx-4 animate-slide-in-up",children:Yn.jsxDEV(RZ,{effect:z.effect,onUpdateParameter:ve,onUpdateWet:ye,onClose:()=>G(null)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:983,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:982,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:981,columnNumber:11},this),Yn.jsxDEV(bZ,{isOpen:null!==H,file:H,onCancel:()=>W(null),onConfirm:async()=>{H&&await xe(H),W(null)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:994,columnNumber:9},this),Yn.jsxDEV(yZ,{isOpen:null!==q,file:q,onCancel:()=>K(null),onConfirm:async()=>{q&&await SZ(q),K(null)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1005,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:920,columnNumber:7},this),x&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>N(!1),title:"DEViLBOX  Instrument Editor",width:1e3,height:800,children:Yn.jsxDEV(qZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1026,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1019,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1018,columnNumber:9},this),w&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>E(!1),title:"DEViLBOX  Master Effects",width:1e3,height:800,children:Yn.jsxDEV(FZ,{isOpen:!0,onClose:()=>E(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1041,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1034,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1033,columnNumber:9},this),k&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>D(!1),title:"DEViLBOX  Instrument Effects",width:1e3,height:800,children:Yn.jsxDEV(UZ,{isOpen:!0,onClose:()=>D(!1)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1056,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1049,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1048,columnNumber:9},this),S&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>M(!1),title:"DEViLBOX  Piano Roll",width:1200,height:600,children:Yn.jsxDEV("div",{className:"h-screen w-screen bg-dark-bgSecondary",children:Yn.jsxDEV(KZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1072,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1071,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1064,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1063,columnNumber:9},this),P&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>_(!1),title:"DEViLBOX  Arrangement",width:1400,height:700,children:Yn.jsxDEV("div",{className:"h-screen w-screen bg-dark-bg",children:Yn.jsxDEV(YZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1089,columnNumber:15},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1088,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1081,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1080,columnNumber:9},this),C&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(UU,{isOpen:!0,onClose:()=>V(!1),title:"DEViLBOX  Visualizer",width:800,height:500,children:Yn.jsxDEV($Z,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1105,columnNumber:13},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1098,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1097,columnNumber:9},this),Yn.jsxDEV(OZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1111,columnNumber:7},this),Yn.jsxDEV(TZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1114,columnNumber:7},this),Yn.jsxDEV(dZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1117,columnNumber:7},this),Yn.jsxDEV(pZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1120,columnNumber:7},this),Yn.jsxDEV(fZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1123,columnNumber:7},this),r&&Yn.jsxDEV(xZ,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1126,columnNumber:27},this),e&&!a&&Yn.jsxDEV(mZ,{onRefresh:s,onDismiss:()=>o(!0),currentVersion:n.buildNumber,latestVersion:t?.buildNumber||"unknown"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1130,columnNumber:9},this),"auth"===Y&&Yn.jsxDEV(l.Suspense,{fallback:null,children:Yn.jsxDEV(e0,{isOpen:!0,onClose:ee},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1141,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:1140,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:819,columnNumber:7},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:818,columnNumber:5},this):Yn.jsxDEV("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:Yn.jsxDEV("div",{className:"panel p-8",children:Yn.jsxDEV("div",{className:"flex items-center gap-3 text-accent-primary",children:[Yn.jsxDEV("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:712,columnNumber:13},this),Yn.jsxDEV("span",{children:"Initializing audio engine..."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:713,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:711,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:710,columnNumber:9},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/App.tsx",lineNumber:709,columnNumber:7},this)}class i0 extends l.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null,copied:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}handleReload=()=>{window.location.reload()};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null,copied:!1})};handleCopy=async()=>{const{error:e,errorInfo:t}=this.state;if(!e)return;const n=`\n=== DEViLBOX Critical Error ===\nMessage: ${e.toString()}\nComponent Stack: ${t?.componentStack}\nUser Agent: ${navigator.userAgent}\nTime: ${(new Date).toISOString()}\n    `.trim();try{await navigator.clipboard.writeText(n),this.setState({copied:!0}),setTimeout(()=>this.setState({copied:!1}),2e3)}catch(s){}};render(){return this.state.hasError?this.props.fallback?this.props.fallback:Yn.jsxDEV("div",{className:"min-h-screen bg-bg flex items-center justify-center p-4 select-text",children:Yn.jsxDEV("div",{className:"max-w-lg w-full bg-bg-secondary rounded-lg border border-border p-6 text-center select-text",children:[Yn.jsxDEV("div",{className:"text-6xl mb-4 select-none",children:""},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:86,columnNumber:13},this),Yn.jsxDEV("h1",{className:"text-2xl font-bold text-text mb-2",children:"Something went wrong"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:87,columnNumber:13},this),Yn.jsxDEV("p",{className:"text-text-secondary mb-4",children:"DEViLBOX encountered an unexpected error. Your work may have been auto-saved."},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:90,columnNumber:13},this),Yn.jsxDEV("div",{className:"mb-6 text-left",children:[Yn.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[Yn.jsxDEV("span",{className:"text-xs font-bold text-text-muted uppercase tracking-wider select-none",children:"Error Details"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:96,columnNumber:17},this),Yn.jsxDEV("button",{onClick:this.handleCopy,className:"flex items-center gap-1.5 px-2 py-1 text-[10px] bg-bg-tertiary hover:bg-border rounded transition-colors text-text-secondary select-none",children:this.state.copied?Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(Be,{size:12,className:"text-green-500"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:103,columnNumber:23},this),Yn.jsxDEV("span",{className:"text-green-500",children:"Copied!"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:104,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:102,columnNumber:21},this):Yn.jsxDEV(Yn.Fragment,{children:[Yn.jsxDEV(Je,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:108,columnNumber:23},this),Yn.jsxDEV("span",{children:"Copy Info"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:109,columnNumber:23},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:107,columnNumber:21},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:97,columnNumber:17},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:95,columnNumber:15},this),Yn.jsxDEV("pre",{className:"p-3 bg-bg rounded text-xs text-red-400 overflow-auto max-h-60 font-mono border border-red-900/30",children:[this.state.error?.toString(),this.state.errorInfo?.componentStack]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:114,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:94,columnNumber:13},this),Yn.jsxDEV("div",{className:"flex gap-3 justify-center select-none",children:[Yn.jsxDEV("button",{onClick:this.handleReset,className:"px-4 py-2 bg-bg-tertiary hover:bg-border rounded text-text transition-colors",children:"Try Again"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:121,columnNumber:15},this),Yn.jsxDEV("button",{onClick:this.handleReload,className:"px-4 py-2 bg-accent hover:bg-accent-hover rounded text-white transition-colors",children:"Reload App"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:127,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:120,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:85,columnNumber:11},this)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/ErrorBoundary.tsx",lineNumber:84,columnNumber:9},this):this.props.children}}const l0={Synth:11,MonoSynth:14,DuoSynth:5,FMSynth:16,AMSynth:22,PluckSynth:32,MetalSynth:23,MembraneSynth:10,NoiseSynth:7};function c0(e,t){return(t??-12)+(l0[e]??0)}function u0(e){return{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}}const d0=1.35,m0=[{id:"Synth",name:"Synth",category:"tone",loadMode:"eager",volumeOffsetDb:11,create:e=>{const t=new K($,{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:u0(e),volume:c0("Synth",e.volume)});return e.oscillator?.detune&&t.set({detune:e.oscillator.detune}),t}},{id:"MonoSynth",name:"Mono Synth",category:"tone",loadMode:"eager",volumeOffsetDb:14,create:e=>{const t={oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:u0(e),volume:c0("MonoSynth",e.volume)};return e.filter&&e.filter.type&&e.filter.frequency&&(t.filter={type:e.filter.type,frequency:e.filter.frequency,Q:e.filter.Q??1,rolloff:e.filter.rolloff??-12}),e.filterEnvelope&&void 0!==e.filterEnvelope.baseFrequency&&void 0!==e.filterEnvelope.attack&&(t.filterEnvelope={baseFrequency:e.filterEnvelope.baseFrequency,octaves:e.filterEnvelope.octaves??3,attack:e.filterEnvelope.attack/1e3,decay:(e.filterEnvelope.decay??200)/1e3,sustain:(e.filterEnvelope.sustain??50)/100,release:(e.filterEnvelope.release??1e3)/1e3}),new J(t)},onTriggerRelease:(e,t,n)=>(e.triggerRelease(n),!0)},{id:"DuoSynth",name:"Duo Synth",category:"tone",loadMode:"eager",volumeOffsetDb:5,create:e=>{const t=e.oscillator?.type||"sawtooth",n=u0(e);return new Q({voice0:{oscillator:{type:t},envelope:n},voice1:{oscillator:{type:t},envelope:n},vibratoAmount:e.oscillator?.detune?e.oscillator.detune/100:.5,vibratoRate:5,volume:c0("DuoSynth",e.volume)})},onTriggerRelease:(e,t,n)=>(e.triggerRelease(n),!0)},{id:"FMSynth",name:"FM Synth",category:"tone",loadMode:"eager",volumeOffsetDb:16,create:e=>new K(_,{oscillator:{type:e.oscillator?.type||"sine"},envelope:u0(e),modulationIndex:10,volume:c0("FMSynth",e.volume)})},{id:"AMSynth",name:"AM Synth",category:"tone",loadMode:"eager",volumeOffsetDb:22,create:e=>new K(Z,{oscillator:{type:e.oscillator?.type||"sine"},envelope:u0(e),volume:c0("AMSynth",e.volume)})},{id:"PluckSynth",name:"Pluck Synth",category:"tone",loadMode:"eager",volumeOffsetDb:32,create:e=>{const t=new K(ee);return t.set({attackNoise:1,dampening:4e3,resonance:.7}),t.volume.value=c0("PluckSynth",e.volume),t}},{id:"MetalSynth",name:"Metal Synth",category:"tone",loadMode:"eager",volumeOffsetDb:23,create:e=>new te({envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??100)/1e3,release:(e.envelope?.release??100)/1e3},volume:c0("MetalSynth",e.volume)}),onTriggerAttack:(e,t,n,s,a)=>{const o=a.accent?Math.min(1,s*d0):s;return e.triggerAttack(n,o),!0},onTriggerRelease:(e,t,n)=>(e.triggerRelease(n),!0)},{id:"MembraneSynth",name:"Membrane Synth",category:"tone",loadMode:"eager",volumeOffsetDb:10,create:e=>new ne({pitchDecay:.05,octaves:10,oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??400)/1e3,sustain:.01,release:(e.envelope?.release??100)/1e3},volume:c0("MembraneSynth",e.volume)}),onTriggerAttack:(e,t,n,s,a)=>{const o=a.accent?Math.min(1,s*d0):s;return e.triggerAttack(t,n,o),!0},onTriggerRelease:(e,t,n)=>(e.triggerRelease(n),!0)},{id:"NoiseSynth",name:"Noise Synth",category:"tone",loadMode:"eager",volumeOffsetDb:7,create:e=>new se({noise:{type:"white"},envelope:u0(e),volume:c0("NoiseSynth",e.volume)}),onTriggerAttack:(e,t,n,s,a)=>{const o=a.accent?Math.min(1,s*d0):s;return e.triggerAttack(n,o),!0},onTriggerRelease:(e,t,n)=>(e.triggerRelease(n),!0)}];function p0(e,t){return(t??-12)+({Sampler:10,Player:10,GranularSynth:-47}[e]??0)}function h0(e,t,n,s,a,o){if(!e.buffer||!e.buffer.loaded)return;const r=s>0?Ne(s):-1/0;if(e.volume.value=r,a.metadata?.modPlayback?.usePeriodPlayback&&o){const t=a.metadata.modPlayback;let n=o;if(0!==t.finetune){const e=rw(o,0);e>=0&&(n=ow(e,t.finetune))}const s=t.periodMultiplier/n/(a.sample?.sampleRate||8363);e.playbackRate=s}else{const n=a.sample?.baseNote||"C4",s=le(n).toFrequency(),o=le(t).toFrequency();e.playbackRate=o/s}e.start(n)}qN.register(m0);const f0=[{id:"Sampler",name:"Sampler",category:"tone",loadMode:"eager",volumeOffsetDb:10,controlsComponent:"SampleControls",create:e=>{const t=e.metadata?.modPlayback?.usePeriodPlayback;if(t){const t=e.parameters,n=t?.sampleUrl;return new re(n?{url:n,volume:p0("Player",e.volume)}:{volume:p0("Player",e.volume)})}if(e.sample?.multiMap&&Object.keys(e.sample.multiMap).length>0)return new oe({urls:e.sample.multiMap,volume:p0("Sampler",e.volume)});const n=e.parameters,s=e.sample?.url||n?.sampleUrl,a=e.sample?.baseNote||"C4";if(s){const t={};return t[a]=s,new oe({urls:t,volume:p0("Sampler",e.volume)})}return new oe({volume:p0("Sampler",e.volume)})},onTriggerAttack:(e,t,n,s,a)=>{if(a.config.metadata?.modPlayback?.usePeriodPlayback)return h0(e,t,n,s,a.config,a.period),!0;const o=e;if(!o.loaded)return!0;try{o.triggerAttack(t,n,s)}catch{}return!0},onTriggerRelease:(e,t,n,s)=>{if(s.config.metadata?.modPlayback?.usePeriodPlayback){const t=e;return"started"===t.state&&t.stop(n),!0}const a=e;return!a.loaded||(a.triggerRelease(t||"C4",n),!0)}},{id:"Player",name:"Player",category:"tone",loadMode:"eager",volumeOffsetDb:10,create:e=>{const t=e.parameters,n=t?.sampleUrl,s=t?.reverseMode||"forward";return new re(n?{url:n,volume:p0("Player",e.volume),reverse:"reverse"===s}:{volume:p0("Player",e.volume)})},onTriggerAttack:(e,t,n,s,a)=>(h0(e,t,n,s,a.config,a.period),!0),onTriggerRelease:(e,t,n)=>{const s=e;return"started"===s.state&&s.stop(n),!0}},{id:"GranularSynth",name:"Granular Synth",category:"tone",loadMode:"eager",volumeOffsetDb:-47,create:e=>{const t=e.granular?.sampleUrl||e.parameters?.sampleUrl,n=e.granular;return new ie(t?{url:t,grainSize:(n?.grainSize||100)/1e3,overlap:(n?.grainOverlap||50)/100,playbackRate:n?.playbackRate||1,detune:n?.detune||0,reverse:n?.reverse||!1,loop:!0,loopStart:0,loopEnd:0,volume:p0("GranularSynth",e.volume)}:{grainSize:.1,overlap:.5,playbackRate:1,loop:!0,volume:p0("GranularSynth",e.volume)})},onTriggerAttack:(e,t,n,s,a)=>(h0(e,t,n,s,a.config,a.period),!0),onTriggerRelease:(e,t,n)=>{const s=e;return"started"===s.state&&s.stop(n),!0}}];qN.register(f0);const g0={id:"TB303",name:"TB-303 Bass Line",category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:15,controlsComponent:"TB303Controls",hardwareComponent:"TB303Hardware",create:e=>{const t=e.tb303||{...La},n=(e.volume??-12)+15;const s=new Er;return s.applyConfig(t),void 0!==n&&(s.output.gain.value=ae(n)),s},onTriggerAttack:(e,t,n,s,a)=>("undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,e.triggerAttack(t,n,s,a.accent,a.slide,a.hammer),!0),onTriggerRelease:(e,t,n)=>(e.triggerRelease(n),!0)};qN.register(g0);const b0={Furnace:0,FurnaceOPN:7,FurnaceOPM:-6,FurnaceOPL:2,FurnaceOPLL:1,FurnaceESFM:5,FurnaceOPZ:-14,FurnaceOPNA:-11,FurnaceOPNB:-10,FurnaceOPL4:-8,FurnaceY8950:-5,FurnaceVRC7:-6,FurnaceOPN2203:-23,FurnaceOPNBB:-21,FurnaceNES:7,FurnaceGB:4,FurnaceSNES:-10,FurnacePCE:5,FurnacePSG:3,FurnaceVB:16,FurnaceLynx:3,FurnaceSWAN:4,FurnaceVRC6:3,FurnaceN163:7,FurnaceFDS:3,FurnaceMMC5:37,FurnaceGBA:-10,FurnaceNDS:3,FurnacePOKEMINI:-10,FurnaceC64:16,FurnaceSID6581:16,FurnaceSID8580:17,FurnaceAY:3,FurnaceAY8930:25,FurnaceVIC:-1,FurnaceSAA:6,FurnaceTED:-4,FurnaceVERA:14,FurnaceSCC:9,FurnaceTIA:-7,FurnaceAMIGA:-4,FurnacePET:-10,FurnacePCSPKR:-10,FurnaceZXBEEPER:-4,FurnacePOKEY:7,FurnacePONG:-10,FurnacePV1000:3,FurnaceDAVE:2,FurnaceSU:8,FurnacePOWERNOISE:-4,FurnaceSEGAPCM:-5,FurnaceQSOUND:4,FurnaceES5506:38,FurnaceRF5C68:0,FurnaceC140:8,FurnaceK007232:-4,FurnaceK053260:-1,FurnaceGA20:3,FurnaceOKI:2,FurnaceYMZ280B:14,FurnaceX1_010:15,FurnaceMSM6258:-10,FurnaceMSM5232:10,FurnaceMULTIPCM:14,FurnaceNAMCO:0,FurnacePCMDAC:-5,FurnaceBUBBLE:3,FurnaceSM8521:9,FurnaceT6W28:3,FurnaceSUPERVISION:-1,FurnaceUPD1771:9,FurnaceSCVTONE:3},v0={0:{algorithm:4,feedback:5,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:8,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:12,d2r:0,sl:4,rr:6,dt:3,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:10,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!0,mult:4,tl:35,ar:28,dr:15,d2r:0,sl:5,rr:10,dt:-1,am:!1}]},1:{algorithm:5,feedback:6,operators:[{enabled:!0,mult:1,tl:15,ar:31,dr:5,d2r:0,sl:1,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:40,ar:31,dr:8,d2r:0,sl:3,rr:8,dt:2,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:4,rr:8,dt:-2,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:12,d2r:0,sl:5,rr:10,dt:0,am:!0}]}},y0=[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:15,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:0,sl:4,rr:10,dt:0,am:!1}];function x0(e,t,n){return e instanceof Lc?e.triggerRelease(t,n):e.triggerRelease(n),!0}const N0={FurnaceNES:vc.NES,FurnaceGB:vc.GB,FurnaceSNES:vc.SNES,FurnacePCE:vc.PCE,FurnacePSG:vc.SMS,FurnaceVB:vc.VBOY,FurnaceLynx:vc.LYNX,FurnaceSWAN:vc.SWAN,FurnaceVRC6:vc.VRC6,FurnaceN163:vc.N163,FurnaceFDS:vc.FDS,FurnaceMMC5:vc.MMC5,FurnaceGBA:vc.GBA_DMA,FurnaceNDS:vc.NDS,FurnacePOKEMINI:vc.POKEMINI,FurnaceC64:vc.C64_6581,FurnaceSID6581:vc.C64_6581,FurnaceSID8580:vc.C64_8580,FurnaceAY:vc.AY8910,FurnaceAY8930:vc.AY8930,FurnaceVIC:vc.VIC20,FurnaceSAA:vc.SAA1099,FurnaceTED:vc.TED,FurnaceVERA:vc.VERA,FurnaceSCC:vc.SCC,FurnaceTIA:vc.TIA,FurnaceAMIGA:vc.AMIGA,FurnacePET:vc.PET,FurnacePCSPKR:vc.PCSPKR,FurnaceZXBEEPER:vc.SFX_BEEPER,FurnacePOKEY:vc.POKEY,FurnacePONG:vc.PONG,FurnacePV1000:vc.PV1000,FurnaceDAVE:vc.DAVE,FurnaceSU:vc.SOUND_UNIT,FurnacePOWERNOISE:vc.POWERNOISE,FurnaceSEGAPCM:vc.SEGAPCM,FurnaceQSOUND:vc.QSOUND,FurnaceES5506:vc.ES5506,FurnaceRF5C68:vc.RF5C68,FurnaceC140:vc.C140,FurnaceK007232:vc.K007232,FurnaceK053260:vc.K053260,FurnaceGA20:vc.GA20,FurnaceOKI:vc.MSM6295,FurnaceYMZ280B:vc.YMZ280B,FurnaceX1_010:vc.X1_010,FurnaceMSM6258:vc.MSM6258,FurnaceMSM5232:vc.MSM5232,FurnaceMULTIPCM:vc.MULTIPCM,FurnaceNAMCO:vc.NAMCO,FurnacePCMDAC:vc.PCM_DAC,FurnaceBUBBLE:vc.BUBSYS_WSG,FurnaceSM8521:vc.SM8521,FurnaceT6W28:vc.T6W28,FurnaceSUPERVISION:vc.SUPERVISION,FurnaceUPD1771:vc.UPD1771C,FurnaceSCVTONE:vc.UPD1771C},w0=[{id:"FurnaceOPN",name:"Sega Genesis (YM2612)",chipType:nc.OPN2},{id:"FurnaceOPM",name:"Yamaha OPM (X68000)",chipType:nc.OPM},{id:"FurnaceOPL",name:"OPL3 (AdLib)",chipType:nc.OPL3},{id:"FurnaceOPLL",name:"Yamaha OPLL (MSX)",chipType:nc.OPLL},{id:"FurnaceESFM",name:"Enhanced OPL3 FM",chipType:nc.ESFM},{id:"FurnaceOPZ",name:"Yamaha OPZ (TX81Z)",chipType:nc.OPZ},{id:"FurnaceOPNA",name:"YM2608 (PC-98)",chipType:nc.OPNA},{id:"FurnaceOPNB",name:"YM2610 (Neo Geo)",chipType:nc.OPNB},{id:"FurnaceOPL4",name:"YMF278B (OPL4)",chipType:nc.OPL4},{id:"FurnaceY8950",name:"Y8950 (MSX-Audio)",chipType:nc.Y8950},{id:"FurnaceVRC7",name:"Konami VRC7",chipType:nc.OPLL},{id:"FurnaceOPN2203",name:"YM2203 (PC-88)",chipType:nc.OPN},{id:"FurnaceOPNBB",name:"YM2610B (Neo Geo ext.)",chipType:nc.OPNB_B}].map(e=>({id:e.id,name:e.name,category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:b0[e.id]??0,controlsComponent:"FurnaceControls",create:t=>function(e,t){const n=v0[t]||{algorithm:0,feedback:0,operators:y0},s=e.furnace||{algorithm:n.algorithm??0,feedback:n.feedback??0,operators:n.operators||[],macros:[],opMacros:[],wavetables:n.wavetables||[]};return new pc({...s,chipType:t})}(t,e.chipType),onTriggerRelease:x0})),E0={id:"Furnace",name:"Furnace",category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:0,controlsComponent:"FurnaceControls",create:e=>{if(!e.furnace)throw new Error("Furnace config required for Furnace synth type");return new pc(e.furnace)},onTriggerRelease:x0},k0=Object.keys(N0).map(e=>({id:e,name:e.replace("Furnace",""),category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:b0[e]??0,controlsComponent:"FurnaceControls",create:t=>{const n=new Lc(N0[e]),s=t.furnace?.furnaceIndex??0;if(n.setFurnaceInstrumentIndex(s),t.furnace){const e=n.uploadInstrumentFromConfig(t.furnace,t.name).catch(e=>{});n.setInstrumentUploadPromise(e)}return n},onTriggerRelease:x0}));qN.register(E0),qN.register(w0),qN.register(k0),qN.register({id:"SuperCollider",name:"SuperCollider",category:"wasm",loadMode:"eager",useSynthBus:!0,volumeOffsetDb:0,controlsComponent:"SuperColliderEditor",create:e=>{const t=e.superCollider??Aa,n=N().rawContext;return new Fi(t,n)}}),qN.registerLazy(["MAMEAICA","MAMEASC","MAMEAstrocade","MAMEC352","MAMEES5503","MAMEICS2115","MAMEK054539","MAMEMEA8000","MAMERF5C400","MAMESN76477","MAMESNKWave","MAMESP0250","MAMETMS36XX","MAMETMS5220","MAMETR707","MAMEUPD931","MAMEUPD933","MAMEVotrax","MAMEYMF271","MAMEYMOPQ","MAMEVASynth"],()=>os(()=>import("./mame-DBY166sQ.js"),__vite__mapDeps([51,3,1,2,4])).then(()=>{})),qN.registerLazy(["BuzzDTMF","BuzzFreqBomb","BuzzKick","BuzzKickXP","BuzzNoise","BuzzTrilok","Buzz4FM2F","BuzzDynamite6","BuzzM3","BuzzM4","Buzz3o3","Buzz3o3DF","Buzzmachine"],()=>os(()=>import("./buzzmachines-CJU8WvZr.js"),__vite__mapDeps([52,3,1,2,4])).then(()=>{})),qN.registerLazy(["DexedBridge","Vital","Odin2","Surge","TonewheelOrgan","Melodica","Monique","Helm","Sorcer","Amsynth","OBXf","Open303"],()=>os(()=>import("./vstbridge-DYZP6QEW.js"),__vite__mapDeps([53,1,2,3,4])).then(()=>{})),qN.registerLazy(["WAM","WAMOBXd","WAMSynth101","WAMTinySynth","WAMFaustFlute"],()=>os(()=>import("./wam-DELNkYAq.js"),__vite__mapDeps([54,3,1,2,4])).then(()=>{})),qN.registerLazy(["HarmonicSynth"],()=>os(()=>import("./harmonicsynth-Bgwe5x15.js"),__vite__mapDeps([55,1,2,3,4])).then(()=>{})),qN.registerLazy(["DubSiren","SpaceLaser","V2","V2Speech","Sam","Synare","Dexed","OBXd","CZ101","CEM3394","SCSP","MAMEVFX","VFX","D50","MAMEDOC","MAMERSA","MAMESWP30","DrumKit","Wavetable","ChiptuneModule"],()=>os(()=>import("./misc-hGmsZdPj.js"),__vite__mapDeps([56,3,1,2,4])).then(()=>{})),qN.registerLazy(["ModularSynth"],()=>os(()=>import("./modularsynth-COgZrdOd.js"),__vite__mapDeps([57,58,1,2,3,4])).then(()=>{}));const D0=[{id:"Distortion",name:"Distortion",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const t=e.parameters,n=e.wet/100;return new v({distortion:Number(t.drive)||.4,oversample:t.oversample||"none",wet:n})},getDefaultParameters:()=>({drive:.4,oversample:"none"})},{id:"TapeSaturation",name:"Tape Saturation",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const{TapeSaturation:t}=await os(async()=>{const{TapeSaturation:e}=await Promise.resolve().then(()=>qr);return{TapeSaturation:e}},void 0),n=e.parameters;return new t({drive:(Number(n.drive)||50)/100,tone:Number(n.tone)||12e3,wet:e.wet/100})},getDefaultParameters:()=>({drive:50,tone:12e3})},{id:"BitCrusher",name:"BitCrusher",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const t=e.parameters,n=Number(t.bits)||4,s=e.wet/100,a=new v({distortion:0,wet:s,oversample:"none"}),o=Math.pow(.5,n-1);return a._shaper.setMap(e=>o*Math.floor(e/o+.5),4096),a._isBitCrusher=!0,a._bitsValue=n,a},getDefaultParameters:()=>({bits:4})},{id:"Chebyshev",name:"Chebyshev",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const t=e.parameters;return new j({order:Number(t.order)||2,oversample:t.oversample||"none",wet:e.wet/100})},getDefaultParameters:()=>({order:2,oversample:"none"})},{id:"Filter",name:"Filter",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const t=e.parameters;return new h({type:t.type||"lowpass",frequency:Number(t.frequency)||5e3,rolloff:Number(t.rolloff)||-12,Q:Number(t.Q)||1,gain:Number(t.gain)||0})},getDefaultParameters:()=>({type:"lowpass",frequency:5e3,rolloff:-12,Q:1,gain:0})},{id:"AutoFilter",name:"Auto Filter",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const t=e.parameters,n=new G({frequency:Number(t.frequency)||1,baseFrequency:Number(t.baseFrequency)||200,octaves:Number(t.octaves)||2.6,filter:{type:t.filterType||"lowpass",rolloff:-12,Q:1},wet:e.wet/100});return n.start(),n},getDefaultParameters:()=>({frequency:1,baseFrequency:200,octaves:2.6,filterType:"lowpass"})},{id:"AutoWah",name:"Auto Wah",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const t=e.parameters;return new X({baseFrequency:Number(t.baseFrequency)||100,octaves:Number(t.octaves)||6,sensitivity:Number(t.sensitivity)||0,Q:Number(t.Q)||2,gain:Number(t.gain)||2,follower:Number(t.follower)||.1,wet:e.wet/100})},getDefaultParameters:()=>({baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.1})},{id:"DubFilter",name:"Dub Filter",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const{DubFilterEffect:t}=await os(async()=>{const{DubFilterEffect:e}=await Promise.resolve().then(()=>fl);return{DubFilterEffect:e}},void 0),n=e.parameters;return new t({cutoff:Number(n.cutoff)||20,resonance:Number(n.resonance)||30,gain:Number(n.gain)||1,wet:e.wet/100})},getDefaultParameters:()=>({cutoff:20,resonance:30,gain:1})},{id:"Reverb",name:"Reverb",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const t=e.parameters,n=new b({decay:Number(t.decay)||8.6,preDelay:Number(t.preDelay)||.4,wet:e.wet/100});return await n.ready,n},getDefaultParameters:()=>({decay:8.6,preDelay:.4})},{id:"JCReverb",name:"JC Reverb",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const t=e.parameters,n=new I({roomSize:Math.min(.9,Number(t.roomSize)||.7),wet:e.wet/100}),s=n._feedbackCombFilters;if(s?.length)for(let a=0;a<50&&!s.every(e=>e._worklet);a++)await new Promise(e=>setTimeout(e,20));return n},getDefaultParameters:()=>({roomSize:.5})},{id:"Delay",name:"Delay",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["time"],create:async e=>{const t=e.parameters;return new C({delayTime:Number(t.time)||.25,feedback:Number(t.feedback)||.5,wet:e.wet/100})},getDefaultParameters:()=>({time:.25,feedback:.5})},{id:"FeedbackDelay",name:"Feedback Delay",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["time"],create:async e=>{const t=e.parameters;return new C({delayTime:Number(t.time)||.25,feedback:Number(t.feedback)||.5,wet:e.wet/100})},getDefaultParameters:()=>({time:.25,feedback:.5})},{id:"PingPongDelay",name:"Ping Pong Delay",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["time"],create:async e=>{const t=e.parameters;return new U({delayTime:Number(t.time)||.25,feedback:Number(t.feedback)||.5,wet:e.wet/100})},getDefaultParameters:()=>({time:.25,feedback:.5})},{id:"SpaceEcho",name:"Space Echo",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["rate"],create:async e=>{const{SpaceEchoEffect:t}=await os(async()=>{const{SpaceEchoEffect:e}=await Promise.resolve().then(()=>Ji);return{SpaceEchoEffect:e}},void 0),n=e.parameters;return new t({mode:Number(n.mode)||8,rate:Number(n.rate)||300,intensity:Number(n.intensity)||.74,echoVolume:Number(n.echoVolume)||.8,reverbVolume:Number(n.reverbVolume)||.4,bass:Number(n.bass)||4,treble:Number(n.treble)||4,wet:e.wet/100})},getDefaultParameters:()=>({mode:8,rate:300,intensity:.74,echoVolume:.8,reverbVolume:.4,bass:4,treble:4,bpmSync:1,syncDivision:"1/8"})},{id:"SpaceyDelayer",name:"Spacey Delayer",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["firstTap"],create:async e=>{const{SpaceyDelayerEffect:t}=await os(async()=>{const{SpaceyDelayerEffect:e}=await Promise.resolve().then(()=>al);return{SpaceyDelayerEffect:e}},void 0),n=e.parameters;return new t({firstTap:Number(n.firstTap)||250,tapSize:Number(n.tapSize)||150,feedback:Number(n.feedback)||40,multiTap:null!=n.multiTap?Number(n.multiTap):1,tapeFilter:Number(n.tapeFilter)||0,wet:e.wet/100})},getDefaultParameters:()=>({firstTap:250,tapSize:150,feedback:40,multiTap:1,tapeFilter:0})},{id:"RETapeEcho",name:"RE Tape Echo",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["repeatRate"],create:async e=>{const{RETapeEchoEffect:t}=await os(async()=>{const{RETapeEchoEffect:e}=await Promise.resolve().then(()=>dl);return{RETapeEchoEffect:e}},void 0),n=e.parameters;return new t({mode:null!=n.mode?Number(n.mode):3,repeatRate:Number(n.repeatRate)||.5,intensity:Number(n.intensity)||.5,echoVolume:Number(n.echoVolume)||.8,wow:Number(n.wow)||0,flutter:Number(n.flutter)||0,dirt:Number(n.dirt)||0,inputBleed:null!=n.inputBleed?Number(n.inputBleed):0,loopAmount:Number(n.loopAmount)||0,playheadFilter:null!=n.playheadFilter?Number(n.playheadFilter):1,wet:e.wet/100})},getDefaultParameters:()=>({mode:3,repeatRate:.5,intensity:.5,echoVolume:.8,wow:0,flutter:0,dirt:0,inputBleed:0,loopAmount:0,playheadFilter:1})},{id:"Chorus",name:"Chorus",category:"tonejs",group:"Modulation",loadMode:"eager",bpmSyncParams:["frequency"],create:async e=>{const t=e.parameters,n=new q({frequency:Number(t.frequency)||1.5,delayTime:Number(t.delayTime)||3.5,depth:Number(t.depth)||.7,wet:e.wet/100});return n.start(),n},getDefaultParameters:()=>({frequency:1.5,delayTime:3.5,depth:.7})},{id:"Phaser",name:"Phaser",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters;return new x({frequency:Number(t.frequency)||.5,octaves:Number(t.octaves)||3,baseFrequency:Number(t.baseFrequency)||1e3,Q:Number(t.Q)||10,wet:e.wet/100})},getDefaultParameters:()=>({frequency:.5,octaves:3,baseFrequency:1e3,Q:10})},{id:"Tremolo",name:"Tremolo",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters,n=new W({frequency:Number(t.frequency)||10,depth:Number(t.depth)||.5,wet:e.wet/100});return n.start(),n},getDefaultParameters:()=>({frequency:10,depth:.5})},{id:"Vibrato",name:"Vibrato",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters;return new H({frequency:Number(t.frequency)||5,depth:Number(t.depth)||.1,wet:e.wet/100})},getDefaultParameters:()=>({frequency:5,depth:.1})},{id:"AutoPanner",name:"Auto Panner",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters,n=new z({frequency:Number(t.frequency)||1,depth:Number(t.depth)||1,wet:e.wet/100});return n.start(),n},getDefaultParameters:()=>({frequency:1,depth:1})},{id:"BiPhase",name:"Bi-Phase",category:"tonejs",group:"Modulation",loadMode:"eager",bpmSyncParams:["rateA"],create:async e=>{const{BiPhaseEffect:t}=await os(async()=>{const{BiPhaseEffect:e}=await Promise.resolve().then(()=>pl);return{BiPhaseEffect:e}},void 0),n=e.parameters;return new t({rateA:Number(n.rateA)||.5,depthA:Number(n.depthA)||.6,rateB:Number(n.rateB)||4,depthB:Number(n.depthB)||.4,feedback:Number(n.feedback)||.3,routing:1===Number(n.routing)?"series":"parallel",wet:e.wet/100})},getDefaultParameters:()=>({rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0})},{id:"Compressor",name:"Compressor",category:"tonejs",group:"Dynamics",loadMode:"eager",create:async e=>{const t=e.parameters;return new w({threshold:Number(t.threshold)||-24,ratio:Number(t.ratio)||12,attack:Number(t.attack)||.003,release:Number(t.release)||.25})},getDefaultParameters:()=>({threshold:-24,ratio:12,attack:.003,release:.25})},{id:"SidechainCompressor",name:"Sidechain Compressor",category:"tonejs",group:"Dynamics",loadMode:"eager",create:async e=>{const{SidechainCompressor:t}=await os(async()=>{const{SidechainCompressor:e}=await Promise.resolve().then(()=>ec);return{SidechainCompressor:e}},void 0),n=e.parameters;return new t({threshold:Number(n.threshold)??-24,ratio:Number(n.ratio)??4,attack:Number(n.attack)??.003,release:Number(n.release)??.25,knee:Number(n.knee)??6,sidechainGain:(Number(n.sidechainGain)??100)/100,wet:e.wet/100})},getDefaultParameters:()=>({threshold:-24,ratio:4,attack:.003,release:.25,knee:6,sidechainGain:100})},{id:"EQ3",name:"3-Band EQ",category:"tonejs",group:"EQ & Stereo",loadMode:"eager",create:async e=>{const t=e.parameters;return new f({low:Number(t.low)||0,mid:Number(t.mid)||0,high:Number(t.high)||0,lowFrequency:Number(t.lowFrequency)||400,highFrequency:Number(t.highFrequency)||2500})},getDefaultParameters:()=>({low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500})},{id:"StereoWidener",name:"Stereo Widener",category:"tonejs",group:"EQ & Stereo",loadMode:"eager",create:async e=>{const t=e.parameters;return new B({width:Math.min(.85,Number(t.width)||.5),wet:e.wet/100})},getDefaultParameters:()=>({width:.5})},{id:"FrequencyShifter",name:"Frequency Shifter",category:"tonejs",group:"Pitch",loadMode:"eager",create:async e=>{const t=e.parameters;return new R({frequency:Number(t.frequency)||0,wet:e.wet/100})},getDefaultParameters:()=>({frequency:0})},{id:"PitchShift",name:"Pitch Shift",category:"tonejs",group:"Pitch",loadMode:"eager",create:async e=>{const t=e.parameters;return new F({pitch:Number(t.pitch)||0,windowSize:Number(t.windowSize)||.1,delayTime:Number(t.delayTime)||0,feedback:Number(t.feedback)||0,wet:e.wet/100})},getDefaultParameters:()=>({pitch:0,windowSize:.1,delayTime:0,feedback:0})}];KN.register(D0);const S0=[{id:"MoogFilter",name:"Moog Filter",category:"wasm",group:"Filter",loadMode:"eager",create:async e=>{const{MoogFilterEffect:t,MoogFilterModel:n,MoogFilterMode:s}=await os(async()=>{const{MoogFilterEffect:e,MoogFilterModel:t,MoogFilterMode:n}=await Promise.resolve().then(()=>wl);return{MoogFilterEffect:e,MoogFilterModel:t,MoogFilterMode:n}},void 0),a=e.parameters;return new t({cutoff:Number(a.cutoff)||1e3,resonance:(Number(a.resonance)||10)/100,drive:Number(a.drive)||1,model:Number(a.model)||n.Hyperion,filterMode:Number(a.filterMode)||s.LP4,wet:e.wet/100})},getDefaultParameters:()=>({cutoff:1e3,resonance:10,drive:1,model:0,filterMode:0})},{id:"MVerb",name:"MVerb Plate Reverb",category:"wasm",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const{MVerbEffect:t}=await os(async()=>{const{MVerbEffect:e}=await Promise.resolve().then(()=>Vl);return{MVerbEffect:e}},void 0),n=e.parameters;return new t({damping:Number(n.damping),density:Number(n.density),bandwidth:Number(n.bandwidth),decay:Number(n.decay),predelay:Number(n.predelay),size:Number(n.size),gain:Number(n.gain),mix:Number(n.mix),earlyMix:Number(n.earlyMix),wet:e.wet/100})},getDefaultParameters:()=>({damping:.5,density:.5,bandwidth:.5,decay:.7,predelay:0,size:.8,gain:1,mix:.4,earlyMix:.5})},{id:"Leslie",name:"Leslie Rotary Speaker",category:"wasm",group:"Modulation",loadMode:"eager",create:async e=>{const{LeslieEffect:t}=await os(async()=>{const{LeslieEffect:e}=await Promise.resolve().then(()=>Ll);return{LeslieEffect:e}},void 0),n=e.parameters;return new t({speed:Number(n.speed),hornRate:Number(n.hornRate),drumRate:Number(n.drumRate),hornDepth:Number(n.hornDepth),drumDepth:Number(n.drumDepth),doppler:Number(n.doppler),width:Number(n.width),acceleration:Number(n.acceleration),wet:e.wet/100})},getDefaultParameters:()=>({speed:0,hornRate:6.8,drumRate:5.9,hornDepth:.7,drumDepth:.5,doppler:.5,width:.8,acceleration:.5})},{id:"SpringReverb",name:"Spring Reverb",category:"wasm",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const{SpringReverbEffect:t}=await os(async()=>{const{SpringReverbEffect:e}=await Promise.resolve().then(()=>Ul);return{SpringReverbEffect:e}},void 0),n=e.parameters;return new t({decay:Number(n.decay),damping:Number(n.damping),tension:Number(n.tension),mix:Number(n.mix),drip:Number(n.drip),diffusion:Number(n.diffusion),wet:e.wet/100})},getDefaultParameters:()=>({decay:.6,damping:.4,tension:.5,mix:.35,drip:.5,diffusion:.7})}];KN.register(S0),KN.register({id:"Tumult",name:"Tumult",category:"wasm",group:"Texture",loadMode:"eager",create:async e=>{const{TumultEffect:t}=await os(async()=>{const{TumultEffect:e}=await Promise.resolve().then(()=>xw);return{TumultEffect:e}},void 0),n=e.parameters;return new t({noiseGain:Number(n.noiseGain??-10),mix:Number(n.mix??.5),noiseMode:Number(n.noiseMode??0),sourceMode:Number(n.sourceMode??0),switchBranch:Number(n.switchBranch??0),duckThreshold:Number(n.duckThreshold??-20),duckAttack:Number(n.duckAttack??0),duckRelease:Number(n.duckRelease??15),followThreshold:Number(n.followThreshold??-20),followAttack:Number(n.followAttack??0),followRelease:Number(n.followRelease??15),followAmount:Number(n.followAmount??.7),clipAmount:Number(n.clipAmount??.497),hpEnable:Number(n.hpEnable??0),hpFreq:Number(n.hpFreq??888.5),hpQ:Number(n.hpQ??.7),peak1Enable:Number(n.peak1Enable??0),peak1Type:Number(n.peak1Type??0),peak1Freq:Number(n.peak1Freq??20),peak1Gain:Number(n.peak1Gain??-.19),peak1Q:Number(n.peak1Q??.7),peak2Enable:Number(n.peak2Enable??0),peak2Freq:Number(n.peak2Freq??600),peak2Gain:Number(n.peak2Gain??1),peak2Q:Number(n.peak2Q??1),peak3Enable:Number(n.peak3Enable??0),peak3Type:Number(n.peak3Type??1),peak3Freq:Number(n.peak3Freq??2500),peak3Gain:Number(n.peak3Gain??1),peak3Q:Number(n.peak3Q??1),lpEnable:Number(n.lpEnable??0),lpFreq:Number(n.lpFreq??8500),lpQ:Number(n.lpQ??.7),sampleIndex:Number(n.sampleIndex??0),playerStart:Number(n.playerStart??0),playerEnd:Number(n.playerEnd??1),playerFade:Number(n.playerFade??.01),playerGain:Number(n.playerGain??0),wet:e.wet/100})},getDefaultParameters:()=>({noiseGain:-10,mix:.5,noiseMode:0,sourceMode:0,switchBranch:0,duckThreshold:-20,duckAttack:0,duckRelease:15,followThreshold:-20,followAttack:0,followRelease:15,followAmount:.7,clipAmount:.497,hpEnable:0,hpFreq:888.5,hpQ:.7,peak1Enable:0,peak1Type:0,peak1Freq:20,peak1Gain:-.19,peak1Q:.7,peak2Enable:0,peak2Freq:600,peak2Gain:1,peak2Q:1,peak3Enable:0,peak3Type:1,peak3Freq:2500,peak3Gain:1,peak3Q:1,lpEnable:0,lpFreq:8500,lpQ:.7,sampleIndex:0,playerStart:0,playerEnd:1,playerFade:.01,playerGain:0})}),KN.register({id:"TapeSimulator",name:"Tape Simulator",category:"wasm",group:"Texture",loadMode:"eager",create:async e=>{const{TapeSimulatorEffect:t}=await os(async()=>{const{TapeSimulatorEffect:e}=await Promise.resolve().then(()=>Sw);return{TapeSimulatorEffect:e}},void 0),n=e.parameters;return new t({drive:Number(n.drive??30)/100,character:Number(n.character??40)/100,bias:Number(n.bias??40)/100,shame:Number(n.shame??20)/100,hiss:Number(n.hiss??20)/100,speed:Number(n.speed??0),wet:e.wet/100})},getDefaultParameters:()=>({drive:30,character:40,bias:40,shame:20,hiss:20,speed:0})}),KN.registerLazy(["BuzzDistortion","BuzzSVF","BuzzDelay","BuzzChorus","BuzzCompressor","BuzzOverdrive","BuzzDistortion2","BuzzCrossDelay","BuzzPhilta","BuzzDist2","BuzzFreeverb","BuzzFreqShift","BuzzNotch","BuzzStereoGain","BuzzSoftSat","BuzzLimiter","BuzzExciter","BuzzMasterizer","BuzzStereoDist","BuzzWhiteChorus","BuzzZfilter","BuzzChorus2","BuzzPanzerDelay"],()=>os(()=>import("./buzzmachine-DD8thLIo.js"),__vite__mapDeps([59,1,2,3,4])).then(()=>{})),KN.registerLazy(["WAMBigMuff","WAMTS9","WAMDistoMachine","WAMQuadraFuzz","WAMVoxAmp","WAMStonePhaser","WAMPingPongDelay","WAMFaustDelay","WAMPitchShifter","WAMGraphicEQ","WAMPedalboard"],()=>os(()=>import("./wam-DTKGnm2P.js"),__vite__mapDeps([60,1,2,3,4])).then(()=>{})),KN.registerLazy(["Neural"],()=>os(()=>import("./neural-D-Q2m66m.js"),__vite__mapDeps([61,1,2,3,4])).then(()=>{}));const M0=["ChiptuneModule","Player","Sampler","DrumKit"];async function C0(e){const t=mz[e],n={synthType:e,name:t?.name||e,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,loadTimeMs:0};if(M0.includes(e))return n.error="Skipped (requires external resources)",n;const s=performance.now();try{const t={id:999,name:`Test ${e}`,type:"synth",synthType:e,effects:[],volume:-12,pan:0},o=JN.createInstrument(t);if(n.loadTimeMs=performance.now()-s,!o)return n.error="createInstrument returned null",n;n.loaded=!0;const r=new pe("waveform",256);if(eo(o)){const e=co(r);e&&o.output.connect(e)}else o.connect(r);r.toDestination();try{"triggerAttack"in o&&"function"==typeof o.triggerAttack?(o.triggerAttack("C4",Y(),.8),n.noteOnWorked=!0):"triggerAttackRelease"in o&&"function"==typeof o.triggerAttackRelease&&(o.triggerAttackRelease("C4","8n",Y(),.8),n.noteOnWorked=!0)}catch(a){n.error=`Note trigger error: ${a}`}await new Promise(e=>setTimeout(e,100));try{const e=r.getValue().some(e=>Math.abs(e)>.001);n.producedSound=e}catch{}try{"triggerRelease"in o&&"function"==typeof o.triggerRelease&&(o.triggerRelease("C4",Y()),n.noteOffWorked=!0)}catch{}await new Promise(e=>setTimeout(e,50));try{if(eo(o))try{o.output.disconnect()}catch{}else o.disconnect();r.disconnect(),"dispose"in o&&"function"==typeof o.dispose&&o.dispose(),r.dispose()}catch{}}catch(a){n.error=`${a}`,n.loadTimeMs=performance.now()-s}return n}async function V0(e={}){const{verbose:t=!0,filter:n,timeout:s=5e3}=e;await A();const a=n?hz.filter(n):hz,o=[];for(const u of a){const e=await Promise.race([C0(u),new Promise(e=>setTimeout(()=>e({synthType:u,name:mz[u]?.name||u,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,error:"Timeout",loadTimeMs:s}),s))]);if(o.push(e),t){e.loaded&&e.producedSound}}const r=o.filter(e=>e.loaded&&e.noteOnWorked),i=o.filter(e=>!e.loaded&&!M0.includes(e.synthType)),l=o.filter(e=>M0.includes(e.synthType)),c={total:o.length,passed:r.length,failed:i.length,skipped:l.length,results:o,failedSynths:i.map(e=>e.synthType),passedSynths:r.map(e=>e.synthType),timestamp:(new Date).toISOString()};if(t){c.failedSynths.length>0&&c.failedSynths.forEach(e=>{o.find(t=>t.synthType===e)});const e=o.filter(e=>e.loaded&&!e.producedSound&&!M0.includes(e.synthType));e.length>0&&e.forEach(e=>{})}return c}if("undefined"!=typeof window){const e=window;e.testAllSynths=V0,e.testToneSynths=async function(){const e=["Synth","MonoSynth","DuoSynth","FMSynth","AMSynth","PluckSynth","MetalSynth","MembraneSynth","NoiseSynth","PolySynth"];return V0({filter:t=>e.includes(t)})},e.testCustomSynths=async function(){const e=["TB303","DubSiren","SpaceLaser","Synare","V2","Sam","Dexed","OBXd","SuperSaw","Organ","DrumMachine","ChipSynth","PWMSynth","WobbleBass","StringMachine","FormantSynth","GranularSynth","Wavetable"];return V0({filter:t=>e.includes(t)})},e.testFurnaceSynths=async function(){return V0({filter:e=>e.startsWith("Furnace"),timeout:1e4})},e.testBuzzmachineSynths=async function(){return V0({filter:e=>e.startsWith("Buzz")})},e.quickTestSynths=async function(){return V0({timeout:2e3})}}u(),MN||(MN=!0,/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?(document.addEventListener("touchend",CN,!0),document.addEventListener("click",CN,!0)):SN=!0),window.addEventListener("error",e=>{e.error?.message?.includes("already disposed")&&e.preventDefault()}),window.addEventListener("unhandledrejection",e=>{"InvalidStateError"!==e.reason?.name||e.preventDefault()}),ss.createRoot(document.getElementById("root")).render(Yn.jsxDEV(l.StrictMode,{children:Yn.jsxDEV(i0,{children:Yn.jsxDEV(EP,{children:Yn.jsxDEV(r0,{},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/main.tsx",lineNumber:58,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/main.tsx",lineNumber:57,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/main.tsx",lineNumber:56,columnNumber:5},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/main.tsx",lineNumber:55,columnNumber:3},void 0)),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(e=>{});export{Up as $,Bv as A,yv as B,XU as C,Rg as D,_g as E,HU as F,gg as G,Mf as H,xf as I,df as J,of as K,xh as L,Xh as M,bh as N,jU as O,WU as P,hh as Q,Hh as R,qN as S,Pg as T,Qg as U,RU as V,oh as W,sh as X,ty as Y,Kp as Z,os as _,wV as a,ha as a$,Fu as a0,ju as a1,Dy as a2,ky as a3,hy as a4,xy as a5,jc as a6,ka as a7,Xc as a8,Va as a9,mc as aA,iF as aB,aF as aC,sF as aD,ZX as aE,us as aF,JD as aG,KX as aH,ez as aI,Lu as aJ,Vw as aK,Ds as aL,NP as aM,vy as aN,js as aO,Lr as aP,W_ as aQ,pO as aR,AP as aS,BP as aT,va as aU,oa as aV,FT as aW,na as aX,nc as aY,pz as aZ,Aw as a_,Bu as aa,Iu as ab,Au as ac,Da as ad,zc as ae,Pa as af,Vd as ag,km as ah,Tm as ai,Hm as aj,qm as ak,fp as al,vp as am,Vr as an,_p as ao,Ip as ap,wa as aq,Ac as ar,Hi as as,HN as at,KN as au,La as av,Xa as aw,Ga as ax,Ru as ay,Uu as az,OM as b,NQ as b$,ga as b0,ma as b1,la as b2,ia as b3,ra as b4,zs as b5,Xs as b6,da as b7,ua as b8,ca as b9,Ck as bA,UD as bB,lP as bC,$N as bD,dV as bE,wH as bF,ba as bG,Vx as bH,Cx as bI,cS as bJ,nS as bK,Wj as bL,Cr as bM,OG as bN,wG as bO,TQ as bP,OQ as bQ,_Q as bR,PQ as bS,VQ as bT,CQ as bU,MQ as bV,SQ as bW,DQ as bX,kQ as bY,EQ as bZ,wQ as b_,qs as ba,hz as bb,mz as bc,dG as bd,fa as be,nN as bf,Ta as bg,Oa as bh,_a as bi,FU as bj,Ca as bk,fV as bl,yV as bm,vV as bn,sP as bo,XM as bp,tP as bq,As as br,Bs as bs,ms as bt,VZ as bu,CZ as bv,EO as bw,fo as bx,ho as by,po as bz,Bw as c,ST as c$,xQ as c0,yQ as c1,vQ as c2,bQ as c3,gQ as c4,fQ as c5,hQ as c6,pQ as c7,mQ as c8,dQ as c9,OR as cA,VR as cB,CR as cC,PR as cD,_R as cE,SC as cF,DC as cG,CC as cH,RC as cI,WC as cJ,mM as cK,EM as cL,$P as cM,HP as cN,KP as cO,JP as cP,QP as cQ,vO as cR,qP as cS,WP as cT,t_ as cU,cO as cV,uF as cW,fO as cX,JC as cY,kT as cZ,DT as c_,uQ as ca,cQ as cb,ql as cc,Kl as cd,Jl as ce,fy as cf,Ql as cg,My as ch,GN as ci,Di as cj,Qa as ck,ac as cl,RD as cm,Zj as cn,Qj as co,Jj as cp,Yj as cq,$j as cr,Kj as cs,qj as ct,UP as cu,ts as cv,hO as cw,VP as cx,zC as cy,q_ as cz,VV as d,dT as d$,TV as d0,kC as d1,eN as d2,FM as d3,jM as d4,kc as d5,Ea as d6,pa as d7,Ks as d8,$s as d9,ss as dA,Ua as dB,ET as dC,MD as dD,SD as dE,$O as dF,Za as dG,YO as dH,pD as dI,Ez as dJ,Ik as dK,dP as dL,GP as dM,iP as dN,gP as dO,wO as dP,uP as dQ,pP as dR,cP as dS,eP as dT,OO as dU,LO as dV,TO as dW,$M as dX,eH as dY,CD as dZ,uT as d_,Ys as da,Js as db,Qs as dc,Zs as dd,aa as de,sa as df,ta as dg,Hs as dh,Gs as di,ya as dj,xa as dk,iN as dl,ea as dm,Aa as dn,Ma as dp,Ir as dq,Cw as dr,TN as ds,ds as dt,qD as du,$D as dv,ZS as dw,uV as dx,Ba as dy,BU as dz,fz as e,mR as e0,vN as e1,bo as e2,Si as e3,$i as e4,Ec as e5,Dh as e6,gy as e7,Ny as e8,XC as e9,OU as eA,LU as eB,fR as eC,bR as eD,TR as eE,Fj as eF,Hj as eG,pX as eH,UX as eI,_z as eJ,cG as eK,mG as eL,iH as eM,hZ as eN,gZ as eO,MZ as eP,YC as ea,AV as eb,IV as ec,UV as ed,_T as ee,TT as ef,AT as eg,zT as eh,JT as ei,iL as ej,qI as ek,tF as el,gF as em,MF as en,PF as eo,LF as ep,XF as eq,GF as er,WF as es,KF as et,YF as eu,rU as ev,lU as ew,dU as ex,hU as ey,CU as ez,GU as f,lS as g,qU as h,KU as i,Yn as j,$U as k,YU as l,JU as m,QU as n,ZU as o,eR as p,oo as q,bX as r,ID as s,LN as t,EN as u,_k as v,jN as w,XD as x,ZV as y,uy as z};
