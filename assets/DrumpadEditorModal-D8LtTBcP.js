import{aD as e,b as t,aE as a,aA as n,aF as s,g as r,j as i,aG as d}from"./index-4yDwHK16.js";import{r as o}from"./vendor-utils-Cm-70yv0.js";import{J as l,aQ as c,X as p,Z as m,T as x,R as u,a4 as g,aB as b,aC as h}from"./vendor-ui-C64XGON6.js";import"./vendor-react-LeNVipsj.js";import"./vendor-tone-MhHxAwwC.js";const y=({isOpen:y,onClose:N})=>{const f=e(),{instruments:j}=t(),{devices:v,isEnabled:k}=a(),{padBank:C,setPadBank:I}=n(),[w,M]=o.useState([]),[T,S]=o.useState(null),[A,D]=o.useState(!1),H=o.useMemo(()=>j.filter(e=>"MAMETR707"===e.synthType||e.synthType?.toLowerCase().includes("drum")||e.name.toLowerCase().includes("drum machine")),[j]),E=e=>{const t=j.find(t=>t.id===e);if(!t)return;const a=Array.from({length:16},(e,t)=>36+t);if(a.forEach(e=>{const t=f.getMapping(9,e);t&&f.removeMapping(t.id)}),"MAMETR707"===t.synthType){[{note:d.BASS_1,padNote:36,label:"Bass 1"},{note:d.RIMSHOT,padNote:37,label:"Rimshot"},{note:d.SNARE_1,padNote:38,label:"Snare 1"},{note:d.HANDCLAP,padNote:39,label:"Handclap"},{note:d.SNARE_2,padNote:40,label:"Snare 2"},{note:d.LOW_TOM,padNote:41,label:"Low Tom"},{note:d.CLOSED_HIHAT,padNote:42,label:"Closed HH"},{note:d.MID_TOM,padNote:43,label:"Mid Tom"},{note:d.OPEN_HIHAT,padNote:46,label:"Open HH"},{note:d.CRASH,padNote:49,label:"Crash"},{note:d.HI_TOM,padNote:50,label:"Hi Tom"},{note:d.RIDE,padNote:51,label:"Ride"},{note:d.TAMBOURINE,padNote:54,label:"Tambourine"},{note:d.COWBELL,padNote:56,label:"Cowbell"}].forEach(({note:e,padNote:a})=>{f.setMapping({id:`9-${a}`,inputChannel:9,inputNote:a,type:"instrument",targetInstrumentId:t.id,targetNote:e})})}else a.slice(0,8).forEach((e,a)=>{f.setMapping({id:`9-${e}`,inputChannel:9,inputNote:e,type:"instrument",targetInstrumentId:t.id,targetNote:36+a})});B()},L=e=>{Array.from({length:16},(e,t)=>36+t).forEach(e=>{const t=f.getMapping(9,e);t&&f.removeMapping(t.id)});[{keywords:["Kick","BD","Bass Drum"],synthType:"DrumMachine",note:36},{keywords:["Snare","SD"],synthType:"DrumMachine",note:38},{keywords:["Clap","CP"],synthType:"DrumMachine",note:39},{keywords:["Closed Hat","CH","HH"],synthType:"DrumMachine",note:42},{keywords:["Open Hat","OH"],synthType:"DrumMachine",note:46},{keywords:["Rim","RS"],synthType:"DrumMachine",note:37},{keywords:["Tom","Low"],synthType:"DrumMachine",note:41},{keywords:["Tom","Hi"],synthType:"DrumMachine",note:43},{keywords:["Synare","Disco"],synthType:"Synare",note:40},{keywords:["Siren","Dub"],synthType:"DubSiren",note:48},{keywords:["Laser","Zap"],synthType:"SpaceLaser",note:49}].forEach(e=>{const t=((e,t)=>{let a=j.find(t=>e.some(e=>t.name.toLowerCase().includes(e.toLowerCase())));return!a&&t&&(a=j.find(e=>e.synthType===t)),a||(a=j.find(t=>e.some(e=>t.synthType.toLowerCase().includes(e.toLowerCase())))),a})(e.keywords);t&&f.setMapping({id:`9-${e.note}`,inputChannel:9,inputNote:e.note,type:"instrument",targetInstrumentId:t.id,targetNote:60})}),B()};o.useEffect(()=>{y&&k&&(f.init(),B())},[y,k]);const B=o.useCallback(()=>{M(f.getAllMappings())},[f]);o.useEffect(()=>{if(y&&0===w.length&&v.length>0){const e=s(v[0].name||"");e&&e.pads.length}},[y,v,w.length]);const R=Array.from({length:16},(e,t)=>({index:t,label:`Pad ${t+1}`,defaultNote:36+t,bank:t<8?"A":"B"})),$=e=>{const t=36+e;return w.find(e=>e.inputNote===t)},O=o.useCallback(e=>{const t=j.find(t=>t.id===e);if(t){const e=r();e.triggerPolyNoteAttack(t.id,"C4",1,t),setTimeout(()=>{e.triggerPolyNoteRelease(t.id,"C4",t)},500)}},[j]);if(!y)return null;const z=null!==T?$(T):null,P=R.filter(e=>e.bank===C);return i.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg w-[800px] h-[600px] flex flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border",children:[i.jsxs("div",{className:"flex items-center gap-6",children:[i.jsxs("h2",{className:"text-xl font-semibold text-text-primary flex items-center gap-3",children:[i.jsx(l,{size:24}),"Drumpad Editor"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[H.length>0&&i.jsxs("div",{className:"flex items-center gap-2 bg-dark-bgSecondary p-1 rounded-lg",children:[i.jsx(c,{size:14,className:"text-accent-primary ml-2"}),i.jsx("span",{className:"text-[10px] font-bold text-text-muted uppercase",children:"Drum Kit:"}),1===H.length?i.jsx("button",{onClick:()=>E(H[0].id),className:"px-3 py-1 text-[10px] font-bold bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors uppercase",title:`Auto-map ${H[0].name} to pads`,children:H[0].name}):i.jsxs("select",{onChange:e=>e.target.value&&E(parseInt(e.target.value)),className:"px-2 py-1 text-[10px] font-bold bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors uppercase cursor-pointer",defaultValue:"",children:[i.jsx("option",{value:"",disabled:!0,children:"Select Kit..."}),H.map(e=>i.jsx("option",{value:e.id,children:e.name},e.id))]})]}),i.jsxs("div",{className:"flex items-center gap-2 bg-dark-bgSecondary p-1 rounded-lg",children:[i.jsx("span",{className:"text-[10px] font-bold text-text-muted uppercase px-2",children:"Auto-Map:"}),i.jsx("button",{onClick:()=>L(),className:"px-3 py-1 text-[10px] font-bold bg-dark-bgActive hover:bg-accent-primary text-white rounded transition-colors uppercase",children:"Match Names"})]})]})]}),i.jsx("button",{onClick:N,className:"text-text-muted hover:text-text-primary",children:i.jsx(p,{size:24})})]}),i.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[i.jsxs("div",{className:"w-2/3 p-6 border-r border-dark-border flex flex-col",children:[i.jsxs("div",{className:"flex justify-center mb-6 gap-4",children:[i.jsx("button",{onClick:()=>I("A"),className:"px-6 py-2 rounded-full font-medium transition-all "+("A"===C?"bg-accent-primary text-white":"bg-dark-bgSecondary text-text-muted"),children:"Bank A"}),i.jsx("button",{onClick:()=>I("B"),className:"px-6 py-2 rounded-full font-medium transition-all "+("B"===C?"bg-accent-primary text-white":"bg-dark-bgSecondary text-text-muted"),children:"Bank B"})]}),i.jsx("div",{className:"grid grid-cols-4 gap-4 flex-1",children:P.map(e=>{const t=$(e.index),a=T===e.index;return i.jsxs("button",{onClick:()=>{return t=e.index,void S(t);var t},className:`\n                      relative rounded-lg p-4 flex flex-col items-center justify-center border-2 transition-all\n                      ${a?"border-accent-primary bg-accent-primary/10":t?"border-accent-success/50 bg-dark-bgSecondary":"border-dark-border bg-dark-bgSecondary/50 hover:bg-dark-bgSecondary"}\n                    `,children:[i.jsx("span",{className:"text-xs font-bold text-text-muted absolute top-2 left-2",children:e.label}),t?i.jsxs(i.Fragment,{children:[i.jsx(m,{size:24,className:"text-accent-success mb-2"}),i.jsx("div",{className:"text-sm font-medium text-text-primary text-center truncate w-full",children:(n=t.targetInstrumentId,j.find(e=>e.id===n)?.name||`Inst ${n}`)}),i.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["Note: ",t.targetNote]})]}):i.jsx("span",{className:"text-text-muted/50 text-sm",children:"Unmapped"})]},e.index);var n})})]}),i.jsx("div",{className:"w-1/3 p-6 bg-dark-bgSecondary/30",children:null!==T?i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h3",{className:"text-lg font-medium text-text-primary",children:["Pad ",T+1]}),z&&i.jsx("button",{onClick:()=>{if(null===T)return;const e=$(T);e&&(f.removeMapping(e.id),B())},className:"text-accent-error hover:bg-accent-error/10 p-2 rounded",title:"Remove Mapping",children:i.jsx(x,{size:18})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-text-secondary",children:"Input Trigger"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("div",{className:"flex-1 bg-dark-bg border border-dark-border rounded px-3 py-2 text-text-muted text-sm flex items-center",children:z?`CH ${z.inputChannel+1} | Note ${z.inputNote}`:`Default: Note ${36+T}`}),i.jsxs("button",{onClick:()=>{null!==T&&(D(!0),f.startLearn((e,t)=>{const a=$(T),n={id:`${t}-${e}`,inputChannel:t,inputNote:e,type:"instrument",targetInstrumentId:a?.targetInstrumentId??(j[0]?.id||1),targetNote:a?.targetNote||60};a&&a.id!==n.id&&f.removeMapping(a.id),f.setMapping(n),B(),D(!1)}))},className:`\n                        px-3 py-2 rounded text-white transition-colors flex items-center gap-2\n                        ${A?"bg-accent-warning animate-pulse":"bg-dark-bgActive hover:bg-accent-primary"}\n                      `,children:[A?i.jsx(u,{size:16}):i.jsx(m,{size:16}),A?"Learning...":"Learn"]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-text-secondary",children:"Target Instrument"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("select",{value:z?.targetInstrumentId||"",onChange:e=>(e=>{if(null===T)return;const t=$(T),a=36+T,n={id:t?.id||`10-${a}`,inputChannel:t?.inputChannel||9,inputNote:t?.inputNote||a,type:"instrument",targetInstrumentId:e,targetNote:t?.targetNote||60};f.setMapping(n),B(),O(e)})(parseInt(e.target.value)),className:"flex-1 bg-dark-bg border border-dark-border rounded px-3 py-2 text-text-primary",children:[i.jsx("option",{value:"",disabled:!0,children:"Select Instrument..."}),j.map(e=>i.jsxs("option",{value:e.id,children:[e.id.toString(16).toUpperCase().padStart(2,"0")," - ",e.name]},e.id))]}),i.jsx("button",{onClick:()=>z?.targetInstrumentId&&O(z.targetInstrumentId),disabled:!z?.targetInstrumentId,className:"p-2 bg-dark-bg border border-dark-border rounded text-text-secondary hover:text-accent-success hover:border-accent-success/50 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Preview Instrument",children:i.jsx(g,{size:18})})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium text-text-secondary",children:"Target Note"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(b,{size:16,className:"text-text-muted"}),i.jsx("input",{type:"number",min:"0",max:"127",value:z?.targetNote||60,onChange:e=>(e=>{if(null===T)return;const t=$(T);t&&(f.setMapping({...t,targetNote:e}),B())})(parseInt(e.target.value)),className:"flex-1 bg-dark-bg border border-dark-border rounded px-3 py-2 text-text-primary"}),i.jsx("span",{className:"text-xs text-text-muted w-8"})]}),i.jsx("p",{className:"text-xs text-text-muted",children:"MIDI Note to trigger (60 = C-4)"})]})]}):i.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-text-muted",children:[i.jsx(h,{size:48,className:"mb-4 opacity-50"}),i.jsx("p",{children:"Select a pad to edit"})]})})]})]})})};export{y as DrumpadEditorModal};
