function n(n,r){return(n[r]<<8|n[r+1])>>>0}function r(n,r){return(n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3])>>>0}function t(t){const e=t instanceof Uint8Array?t:new Uint8Array(t);if(e.length<4)return null;if(1179603533===r(e,0))return function(n){const t=n.length;if(t<28)return!1;if(1397577043!==r(n,8))return!1;if(0===n[23])return!1;let e=24;if(e+8>t)return!1;if(1312902469!==r(n,e))return!1;e+=4;let i=r(n,e);if(e+=4,2147483648&i)return!1;if(i=i+1&-2,e+=i,e+8>t)return!1;if(1397643313!==r(n,e))return!1;if(e+=4,i=r(n,e),e+=4,2147483648&i)return!1;for(i=i+1&-2,e+=i;;){if(e+4>t)return!1;const u=r(n,e);if(1414676811===u)break;if(1229869873!==u)return!1;if(e+=4,e+4>t)return!1;if(i=r(n,e),e+=4,2147483648&i)return!1;if(e>=t)return!1;if(n[e]>63)return!1;if(e+1>=t)return!1;if(0!==n[e+1])return!1;i=i+1&-2,e+=i}return!0}(e)?"smus":null;return 240&n(e,0)?function(t){const e=t.length;if(e<=332)return!1;if(e<56)return!1;if(320!==r(t,48))return!1;let i=52;for(let u=0;u<3;u++){if(i+4>e)return!1;const u=r(t,i);if(i+=4,0===u)return!1;if(2147483648&u)return!1;if(1&u)return!1;if(u>=e)return!1;const f=u;if(f+2>e)return!1;if(65535===n(t,f))continue;if(f+7>e)return!1;if(0!==r(t,f))return!1;if(0!==n(t,f+4))return!1;const o=t[f+6];if(!(128&o))return!1;if(o>130)return!1}return!0}(e)?"tiny":null:function(t){const e=t.length;if(e<21)return!1;if(e<20)return!1;let i=0,u=0,f=20;const o=[];for(let n=0;n<4;n++){if(i+4>e)return!1;const n=r(t,i);if(i+=4,0===n)return!1;if(2147483648&n)return!1;if(1&n)return!1;f+=n,o.push(n)}if(f>=e)return!1;i+=4;for(let r=0;r<4;r++){if(i>=e)return!1;const r=t[i];if(!(128&r))return!1;if(i+2<=e){if(65535!==n(t,i)&&r>132)return!1}else if(r>132)return!1;if(u+4>e)return!1;i+=o[u/4],u+=4}return!(i>=e)&&0!==t[i]}(e)?"snx":null}function e(n){return null!==t(n)}function i(n,r){const e=t(new Uint8Array(n));if(null===e)throw new Error("Not a Sonix Music Driver module");const i=r.split("/").pop()??r;let u;switch(e){case"smus":u=i.replace(/^smus\./i,"")||i;break;case"tiny":u=i.replace(/^tiny\./i,"")||i;break;default:u=i.replace(/^snx\./i,"")||i}const f=Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return{name:`${u} [Sonix Music Driver]`,format:"MOD",patterns:[{id:"pattern-0",name:"Pattern 0",length:64,channels:Array.from({length:4},(n,r)=>({id:`channel-${r}`,name:`Channel ${r+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===r||3===r?-50:50,instrumentId:null,color:null,rows:f})),importMetadata:{sourceFormat:"MOD",sourceFile:r,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:1,originalInstrumentCount:0}}],instruments:[{id:1,name:"Sample 1",type:"synth",synthType:"Synth",effects:[],volume:0,pan:0}],songPositions:[0],songLength:1,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125,linearPeriods:!1}}export{t as detectSonixFormat,e as isSonixFormat,i as parseSonixFile};
