import{aw as t,ax as n}from"./index-zx6LJBPK.js";import"./vendor-react-DkDaD07v.js";import"./vendor-utils-XMmR-oGw.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";const e={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11},o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function r(t){if(!t||"==="===t||"---"===t)return null;const n=t.match(/^([A-G])(#?)(-?\d)$/);if(!n)return null;const[,o,r,s]=n,i=parseInt(s,10),l=e[o+(r||"")];return void 0===l?null:{semitone:l,octave:i}}function s(t,n=2){if(!t)return null;const e=r(t);if(!e)return null;const{semitone:o,octave:s}=e;let i=s-n,l=!1;return 0===o&&3===i&&(l=!0,i=2),i<0||i>2?null:{value:o,octave:i,upperC:l}}function i(t,n=2){let e=n+t.octave;t.upperC&&0===t.value&&(e+=1);const r=o[t.value];return r.includes("#")?`${r}${e}`:`${r}-${e}`}function l(t,e=2){const o=0===t.note||97===t.note,r=o?"":n(t.note);return{note:o?null:s(r,e),accent:1===t.flag1||1===t.flag2,slide:2===t.flag1||2===t.flag2,tie:!1}}function u(n,e=2){const o=n.note?i(n.note,e):"";return{note:o?t(o):0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:n.accent?1:void 0,flag2:n.slide?2:void 0}}function a(t,e=2){const o=[],r=[];t.length>16&&o.push(`Pattern has ${t.length} rows, only first 16 will be exported`);for(let s=0;s<Math.min(t.length,16);s++){const i=t[s],u=l(i,e);if(i.note&&0!==i.note&&97!==i.note&&!u.note){const t=n(i.note);o.push(`Row ${s+1}: Note ${t} is out of TD-3 range (C2-C5)`)}if(s>0&&u.note&&t[s-1]){const n=t[s-1];n.note&&0!==n.note&&97!==n.note&&n.note===i.note&&(u.tie=!0)}r.push(u)}for(;r.length<16;)r.push({note:null,accent:!1,slide:!1,tie:!1});return{steps:r,warnings:o}}function f(t,n=2){return t.map(t=>u(t,n))}function c(t){const e=new Map;for(const i of t)if(i.note&&0!==i.note&&97!==i.note){const t=r(n(i.note));if(t){const n=e.get(t.octave)||0;e.set(t.octave,n+1)}}if(0===e.size)return 2;let o=0,s=2;return e.forEach((t,n)=>{t>o&&(o=t,s=n)}),Math.max(1,Math.min(4,s))}function p(t,e=2){const o=[],r=[];if(0===t.length)return o.push("Pattern is empty"),{valid:!1,errors:o,warnings:r};t.length>16&&r.push(`Pattern has ${t.length} rows, only first 16 will be exported`);let i=0;for(let l=0;l<Math.min(t.length,16);l++){const o=t[l];if(o.note&&0!==o.note&&97!==o.note){s(n(o.note),e)||i++}}return i>0&&r.push(`${i} note(s) are out of TD-3 range and will be skipped`),{valid:0===o.length,errors:o,warnings:r}}export{r as parseTrackerNote,c as suggestBaseOctave,i as td3NoteToTracker,u as td3StepToTrackerCell,f as td3StepsToTrackerCells,l as trackerCellToTD3Step,s as trackerNoteToTD3,a as trackerPatternToTD3Steps,p as validatePatternForTD3Export};
