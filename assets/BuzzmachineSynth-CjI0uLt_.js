import{T as e,G as t}from"./vendor-tone-C_GMrdAr.js";import{aM as i,a1 as s,aN as n}from"./index-DWtmwK1e.js";import"./vendor-utils-Cm-70yv0.js";import"./vendor-react-LeNVipsj.js";import"./vendor-ui-CuKercQz.js";class r extends e{name="BuzzmachineSynth";input;output;engine=i.getInstance();machineType;workletNode=null;initInProgress=!1;useWasmEngine=!1;initError=null;errorReported=!1;constructor(e){super(),this.machineType=e,this.input=new t(1),this.output=new t(1),this.input.connect(this.output),this.initEngine()}async ensureInitialized(){if(!this.useWasmEngine)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=this.context;await this.engine.init(e),this.workletNode=await this.engine.createMachineNode(e,this.machineType),this.input.disconnect(this.output),this.input.connect(this.workletNode),this.workletNode.connect(this.output),this.useWasmEngine=!0}catch(e){this.initError=e instanceof Error?e:new Error(String(e)),this.useWasmEngine=!1,this.reportInitError()}finally{this.initInProgress=!1}}}reportInitError(){if(this.errorReported||!this.initError)return;this.errorReported=!0;const e=s[this.machineType];n("BuzzmachineSynth",this.initError.message,{synthName:e?.name??this.machineType,errorType:"wasm",error:this.initError,debugData:{machineType:this.machineType,machineKind:e?.type,wasmSupported:"undefined"!=typeof WebAssembly}})}setParameter(e,t){this.useWasmEngine&&this.workletNode&&this.engine.setParameter(this.workletNode,e,t)}getParameters(){return this.engine.getMachineInfo(this.machineType).parameters}stop(){this.useWasmEngine&&this.workletNode&&this.engine.stop(this.workletNode)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this}}export{r as BuzzmachineSynth};
