function n(n,t){return(n[t]<<8|n[t+1])>>>0}function t(n,t){return(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}function r(r){if(function(r){return!(r.length<3262)&&0===n(r,0)&&0===t(r,128)&&3262===t(r,132)&&198846===t(r,3254)&&199102===t(r,3258)}(r))return 3;if(function(r){return!(r.length<46)&&11132===n(r,0)&&11132===n(r,8)&&11132===n(r,16)&&11132===n(r,24)&&809238783===t(r,32)&&838880953===t(r,36)&&20085===n(r,44)}(r))return 4;const e=function(t){if(t.length<50)return null;if(2!==n(t,0))return null;if(1&t[3])return null;const r=n(t,4);if(0===r)return null;if(1&r)return null;if(r+1>=t.length)return null;if(0!==n(t,r))return null;if(49>=t.length)return null;const e=n(t,48);for(let o=0;o<23;o++){const r=2+2*o;if(r+1>=t.length)return null;const l=n(t,r);if(0===l)return null;if(1&t[r+1])return null;if(e<=l)return null}if(47>=t.length)return null;const l=n(t,46);return l+1>=t.length?null:3840&~n(t,l)?2:1}(r);return null!==e?e:null}function e(n){return n.split(/[/\\]/).pop()??n}function l(n,t){const l=new Uint8Array(n);return!(void 0!==t&&!function(n){const t=n.toLowerCase();return t.startsWith("jpn.")||t.startsWith("jpnd.")||t.startsWith("jp.")||t.startsWith("jpo.")||t.startsWith("jpold.")||t.endsWith(".jpo")||t.endsWith(".jpold")}(e(t)))&&null!==r(l)}async function o(n,t){const l=r(new Uint8Array(n));if(null===l)throw new Error("Not a Jason Page module");const o=e(t),u=(i=o).replace(/^jpnd\./i,"").replace(/^jpn\./i,"").replace(/^jp\./i,"")||i||o;var i;const a=1===l?"Old (Format 1)":2===l?"New (Format 2)":3===l?"Raw (Format 3)":"Steve Turner (JPO)",s=[];for(let r=0;r<32;r++)s.push({id:r+1,name:`Sample ${r+1}`,type:"synth",synthType:"Synth",effects:[],volume:0,pan:0});const f=Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return{name:`${u} [Jason Page ${a}]`,format:"MOD",patterns:[{id:"pattern-0",name:"Pattern 0",length:64,channels:Array.from({length:4},(n,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0===t||3===t?-50:50,instrumentId:null,color:null,rows:f})),importMetadata:{sourceFormat:"MOD",sourceFile:t,importedAt:(new Date).toISOString(),originalChannelCount:4,originalPatternCount:1,originalInstrumentCount:32}}],instruments:s,songPositions:[0],songLength:1,restartPosition:0,numChannels:4,initialSpeed:6,initialBPM:125,linearPeriods:!1}}export{l as isJasonPageFormat,o as parseJasonPageFile};
