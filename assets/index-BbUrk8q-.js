const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BuzzmachineSynth-DBSGqOi6.js","assets/vendor-utils-Cm-70yv0.js","assets/vendor-react-LeNVipsj.js","assets/vendor-tone-CADp_hfL.js","assets/vendor-ui-BuYJq6ba.js","assets/instrumentFactory-u4Vykyyz.js","assets/TD3PatternTranslator-CBKh8Tva.js","assets/HelpModal-D89D4CH6.js","assets/ExportDialog-BwxW_bCa.js","assets/EditInstrumentModal-BNv_KW_M.js","assets/EffectChain-B9dsibMV.js","assets/ModuleRegistry-C9hJgnNO.js","assets/sortable.esm-DQCHPjjc.js","assets/index-I5waO5pI.js","assets/TD3PatternDialog-dbve9bcY.js","assets/TD3PatternLoader-C1bZAG-1.js","assets/DrumpadEditorModal-BWtpwvMF.js","assets/TipOfTheDay-Cb99Ks1p.js","assets/PatternManagement-DHCob9Cg.js","assets/SamplePackBrowser-DsIyjL-K.js","assets/InstrumentEditorPopout-cDNpDyvi.js","assets/OscilloscopePopout-D9ASEl9Y.js","assets/index-dOzbBcp0.js","assets/mame-B4bH5H6S.js","assets/buzzmachines-B6hBq1Tu.js","assets/vstbridge-DHs7iRfr.js","assets/wam-L6e-L2hU.js","assets/harmonicsynth-B3Om9RRt.js","assets/misc-C-Bhc0_j.js","assets/modularsynth-CzNSrFUn.js","assets/buzzmachine-ByKrzhi3.js","assets/wam-D-6AizHF.js","assets/neural-C3FmZqAj.js"])))=>i.map(i=>d[i]);
import{R as e,p as t,a,c as n,r as s,b as r,e as i}from"./vendor-utils-Cm-70yv0.js";import{r as o,a as l,g as c,b as u}from"./vendor-react-LeNVipsj.js";import{ToneAudioNode as d,Gain as p,WaveShaper as m,Filter as h,EQ3 as f,Delay as y,Reverb as g,Distortion as b,LFO as v,connect as x,Phaser as w,getContext as k,Compressor as S,Meter as M,getTransport as N,Time as C,Loop as P,Volume as E,FeedbackDelay as _,Oscillator as T,Signal as A,FMSynth as O,Noise as I,AmplitudeEnvelope as F,Envelope as D,StereoWidener as R,JCReverb as j,PitchShift as B,PingPongDelay as L,FrequencyShifter as V,Chebyshev as z,BitCrusher as U,AutoWah as G,AutoPanner as W,AutoFilter as H,Vibrato as K,Tremolo as q,Chorus as $,PolySynth as X,Synth as Y,now as Z,MonoSynth as Q,DuoSynth as J,AMSynth as ee,PluckSynth as te,MetalSynth as ae,MembraneSynth as ne,NoiseSynth as se,dbToGain as re,Sampler as ie,Player as oe,GrainPlayer as le,Frequency as ce,Panner as ue,FrequencyEnvelope as de,Analyser as pe,FFT as me,setContext as he,Channel as fe,start as ye,loaded as ge,context as be,immediate as ve,ToneAudioBuffer as xe,gainToDb as we,Offline as ke,Draw as Se}from"./vendor-tone-CADp_hfL.js";import{C as Me,U as Ne,a as Ce,X as Pe,R as Ee,S as _e,M as Te,Z as Ae,b as Oe,c as Ie,d as Fe,e as De,T as Re,f as je,L as Be,g as Le,h as Ve,A as ze,i as Ue,D as Ge,E as We,j as He,k as Ke,P as qe,l as $e,m as Xe,F as Ye,n as Ze,o as Qe,p as Je,G as et,q as tt,r as at,s as nt,t as st,u as rt,V as it,v as ot,H as lt,W as ct,w as ut,x as dt,y as pt,z as mt,B as ht,I as ft,J as yt,K as gt,N as bt,O as vt,Q as xt,Y as wt,_ as kt,$ as St,a0 as Mt,a1 as Nt,a2 as Ct,a3 as Pt,a4 as Et,a5 as _t,a6 as Tt,a7 as At,a8 as Ot,a9 as It,aa as Ft,ab as Dt,ac as Rt,ad as jt,ae as Bt,af as Lt,ag as Vt,ah as zt,ai as Ut,aj as Gt,ak as Wt,al as Ht,am as Kt,an as qt,ao as $t,ap as Xt,aq as Yt,ar as Zt,as as Qt,at as Jt,au as ea,av as ta,aw as aa,ax as na,ay as sa,az as ra,aA as ia,aB as oa,aC as la,aD as ca,aE as ua,aF as da,aG as pa,aH as ma,aI as ha,aJ as fa,aK as ya,aL as ga,aM as ba,aN as va}from"./vendor-ui-BuYJq6ba.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var xa,wa,ka={exports:{}},Sa={};var Ma,Na,Ca,Pa,Ea=(wa||(wa=1,ka.exports=function(){if(xa)return Sa;xa=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function a(t,a,n){var s=null;if(void 0!==n&&(s=""+n),void 0!==a.key&&(s=""+a.key),"key"in a)for(var r in n={},a)"key"!==r&&(n[r]=a[r]);else n=a;return a=n.ref,{$$typeof:e,type:t,key:s,ref:void 0!==a?a:null,props:n}}return Sa.Fragment=t,Sa.jsx=a,Sa.jsxs=a,Sa}()),ka.exports),_a={exports:{}},Ta={},Aa={exports:{}},Oa={};function Ia(){return Na||(Na=1,Aa.exports=(Ma||(Ma=1,function(e){function t(e,t){var a=e.length;e.push(t);e:for(;0<a;){var n=a-1>>>1,r=e[n];if(!(0<s(r,t)))break e;e[n]=t,e[a]=r,a=n}}function a(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],a=e.pop();if(a!==t){e[0]=a;e:for(var n=0,r=e.length,i=r>>>1;n<i;){var o=2*(n+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,a))c<r&&0>s(u,l)?(e[n]=u,e[c]=a,n=c):(e[n]=l,e[o]=a,n=o);else{if(!(c<r&&0>s(u,a)))break e;e[n]=u,e[c]=a,n=c}}}return t}function s(e,t){var a=e.sortIndex-t.sortIndex;return 0!==a?a:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var r=performance;e.unstable_now=function(){return r.now()}}else{var i=Date,o=i.now();e.unstable_now=function(){return i.now()-o}}var l=[],c=[],u=1,d=null,p=3,m=!1,h=!1,f=!1,y=!1,g="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var s=a(c);null!==s;){if(null===s.callback)n(c);else{if(!(s.startTime<=e))break;n(c),s.sortIndex=s.expirationTime,t(l,s)}s=a(c)}}function w(e){if(f=!1,x(e),!h)if(null!==a(l))h=!0,S||(S=!0,k());else{var t=a(c);null!==t&&A(w,t.startTime-e)}}var k,S=!1,M=-1,N=5,C=-1;function P(){return!(!y&&e.unstable_now()-C<N)}function E(){if(y=!1,S){var t=e.unstable_now();C=t;var s=!0;try{e:{h=!1,f&&(f=!1,b(M),M=-1),m=!0;var r=p;try{t:{for(x(t),d=a(l);null!==d&&!(d.expirationTime>t&&P());){var i=d.callback;if("function"==typeof i){d.callback=null,p=d.priorityLevel;var o=i(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof o){d.callback=o,x(t),s=!0;break t}d===a(l)&&n(l),x(t)}else n(l);d=a(l)}if(null!==d)s=!0;else{var u=a(c);null!==u&&A(w,u.startTime-t),s=!1}}break e}finally{d=null,p=r,m=!1}s=void 0}}finally{s?k():S=!1}}}if("function"==typeof v)k=function(){v(E)};else if("undefined"!=typeof MessageChannel){var _=new MessageChannel,T=_.port2;_.port1.onmessage=E,k=function(){T.postMessage(null)}}else k=function(){g(E,0)};function A(t,a){M=g(function(){t(e.unstable_now())},a)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e||(N=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var a=p;p=t;try{return e()}finally{p=a}},e.unstable_requestPaint=function(){y=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var a=p;p=e;try{return t()}finally{p=a}},e.unstable_scheduleCallback=function(n,s,r){var i=e.unstable_now();switch(r="object"==typeof r&&null!==r&&"number"==typeof(r=r.delay)&&0<r?i+r:i,n){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return n={id:u++,callback:s,priorityLevel:n,startTime:r,expirationTime:o=r+o,sortIndex:-1},r>i?(n.sortIndex=r,t(c,n),null===a(l)&&n===a(c)&&(f?(b(M),M=-1):f=!0,A(w,r-i))):(n.sortIndex=o,t(l,n),h||m||(h=!0,S||(S=!0,k()))),n},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(e){var t=p;return function(){var a=p;p=t;try{return e.apply(this,arguments)}finally{p=a}}}}(Oa)),Oa)),Aa.exports}function Fa(){if(Ca)return Ta;Ca=1;var e=Ia(),t=o(),a=l();function n(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function r(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(a=t.return),e=t.return}while(e)}return 3===t.tag?a:null}function i(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function c(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(r(e)!==e)throw Error(n(188))}function d(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=d(e)))return t;e=e.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),h=Symbol.for("react.transitional.element"),f=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),g=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),v=Symbol.for("react.consumer"),x=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),E=Symbol.iterator;function _(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=E&&e[E]||e["@@iterator"])?e:null}var T=Symbol.for("react.client.reference");function A(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===T?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case y:return"Fragment";case b:return"Profiler";case g:return"StrictMode";case k:return"Suspense";case S:return"SuspenseList";case C:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case f:return"Portal";case x:return e.displayName||"Context";case v:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case M:return null!==(t=e.displayName||null)?t:A(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return A(e(t))}catch(a){}}return null}var O=Array.isArray,I=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D={pending:!1,data:null,method:null,action:null},R=[],j=-1;function B(e){return{current:e}}function L(e){0>j||(e.current=R[j],R[j]=null,j--)}function V(e,t){j++,R[j]=e.current,e.current=t}var z,U,G=B(null),W=B(null),H=B(null),K=B(null);function q(e,t){switch(V(H,t),V(W,e),V(G,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?vd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=xd(t=vd(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}L(G),V(G,e)}function $(){L(G),L(W),L(H)}function X(e){null!==e.memoizedState&&V(K,e);var t=G.current,a=xd(t,e.type);t!==a&&(V(W,e),V(G,a))}function Y(e){W.current===e&&(L(G),L(W)),K.current===e&&(L(K),pp._currentValue=D)}function Z(e){if(void 0===z)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);z=t&&t[1]||"",U=-1<a.stack.indexOf("\n    at")?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+z+e+U}var Q=!1;function J(e,t){if(!e||Q)return"";Q=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(s){var n=s}Reflect.construct(e,[],a)}else{try{a.call()}catch(r){n=r}e.call(a.prototype)}}else{try{throw Error()}catch(i){n=i}(a=e())&&"function"==typeof a.catch&&a.catch(function(){})}}catch(o){if(o&&n&&"string"==typeof o.stack)return[o.stack,n.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=n.DetermineComponentFrameRoot(),i=r[0],o=r[1];if(i&&o){var l=i.split("\n"),c=o.split("\n");for(s=n=0;n<l.length&&!l[n].includes("DetermineComponentFrameRoot");)n++;for(;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;if(n===l.length||s===c.length)for(n=l.length-1,s=c.length-1;1<=n&&0<=s&&l[n]!==c[s];)s--;for(;1<=n&&0<=s;n--,s--)if(l[n]!==c[s]){if(1!==n||1!==s)do{if(n--,0>--s||l[n]!==c[s]){var u="\n"+l[n].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=n&&0<=s);break}}}finally{Q=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Z(a):""}function ee(e,t){switch(e.tag){case 26:case 27:case 5:return Z(e.type);case 16:return Z("Lazy");case 13:return e.child!==t&&null!==t?Z("Suspense Fallback"):Z("Suspense");case 19:return Z("SuspenseList");case 0:case 15:return J(e.type,!1);case 11:return J(e.type.render,!1);case 1:return J(e.type,!0);case 31:return Z("Activity");default:return""}}function te(e){try{var t="",a=null;do{t+=ee(e,a),a=e,e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}var ae=Object.prototype.hasOwnProperty,ne=e.unstable_scheduleCallback,se=e.unstable_cancelCallback,re=e.unstable_shouldYield,ie=e.unstable_requestPaint,oe=e.unstable_now,le=e.unstable_getCurrentPriorityLevel,ce=e.unstable_ImmediatePriority,ue=e.unstable_UserBlockingPriority,de=e.unstable_NormalPriority,pe=e.unstable_LowPriority,me=e.unstable_IdlePriority,he=e.log,fe=e.unstable_setDisableYieldValue,ye=null,ge=null;function be(e){if("function"==typeof he&&fe(e),ge&&"function"==typeof ge.setStrictMode)try{ge.setStrictMode(ye,e)}catch(t){}}var ve=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(xe(e)/we|0)|0},xe=Math.log,we=Math.LN2;var ke=256,Se=262144,Me=4194304;function Ne(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ce(e,t,a){var n=e.pendingLanes;if(0===n)return 0;var s=0,r=e.suspendedLanes,i=e.pingedLanes;e=e.warmLanes;var o=134217727&n;return 0!==o?0!==(n=o&~r)?s=Ne(n):0!==(i&=o)?s=Ne(i):a||0!==(a=o&~e)&&(s=Ne(a)):0!==(o=n&~r)?s=Ne(o):0!==i?s=Ne(i):a||0!==(a=n&~e)&&(s=Ne(a)),0===s?0:0!==t&&t!==s&&0===(t&r)&&((r=s&-s)>=(a=t&-t)||32===r&&4194048&a)?t:s}function Pe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ee(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function _e(){var e=Me;return!(62914560&(Me<<=1))&&(Me=4194304),e}function Te(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function Ae(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-ve(t);e.entangledLanes|=t,e.entanglements[n]=1073741824|e.entanglements[n]|261930&a}function Ie(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-ve(a),s=1<<n;s&t|e[n]&t&&(e[n]|=t),a&=~s}}function Fe(e,t){var a=t&-t;return 0!==((a=42&a?1:De(a))&(e.suspendedLanes|t))?0:a}function De(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Re(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function je(){var e=F.p;return 0!==e?e:void 0===(e=window.event)?32:Ep(e.type)}function Be(e,t){var a=F.p;try{return F.p=e,t()}finally{F.p=a}}var Le=Math.random().toString(36).slice(2),Ve="__reactFiber$"+Le,ze="__reactProps$"+Le,Ue="__reactContainer$"+Le,Ge="__reactEvents$"+Le,We="__reactListeners$"+Le,He="__reactHandles$"+Le,Ke="__reactResources$"+Le,qe="__reactMarker$"+Le;function $e(e){delete e[Ve],delete e[ze],delete e[Ge],delete e[We],delete e[He]}function Xe(e){var t=e[Ve];if(t)return t;for(var a=e.parentNode;a;){if(t=a[Ue]||a[Ve]){if(a=t.alternate,null!==t.child||null!==a&&null!==a.child)for(e=Bd(e);null!==e;){if(a=e[Ve])return a;e=Bd(e)}return t}a=(e=a).parentNode}return null}function Ye(e){if(e=e[Ve]||e[Ue]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Ze(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(n(33))}function Qe(e){var t=e[Ke];return t||(t=e[Ke]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Je(e){e[qe]=!0}var et=new Set,tt={};function at(e,t){nt(e,t),nt(e+"Capture",t)}function nt(e,t){for(tt[e]=t,e=0;e<t.length;e++)et.add(t[e])}var st=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),rt={},it={};function ot(e,t,a){if(s=t,ae.call(it,s)||!ae.call(rt,s)&&(st.test(s)?it[s]=!0:(rt[s]=!0,0)))if(null===a)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var n=t.toLowerCase().slice(0,5);if("data-"!==n&&"aria-"!==n)return void e.removeAttribute(t)}e.setAttribute(t,""+a)}var s}function lt(e,t,a){if(null===a)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+a)}}function ct(e,t,a,n){if(null===n)e.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(a)}e.setAttributeNS(t,a,""+n)}}function ut(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=dt(e)?"checked":"value";e._valueTracker=function(e,t,a){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var s=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){a=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(e){a=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function mt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=dt(e)?e.checked?"true":"false":e.value),(e=n)!==a&&(t.setValue(e),!0)}function ht(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var ft=/[\n"\\]/g;function yt(e){return e.replace(ft,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function gt(e,t,a,n,s,r,i,o){e.name="",null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i?e.type=i:e.removeAttribute("type"),null!=t?"number"===i?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ut(t)):e.value!==""+ut(t)&&(e.value=""+ut(t)):"submit"!==i&&"reset"!==i||e.removeAttribute("value"),null!=t?vt(e,i,ut(t)):null!=a?vt(e,i,ut(a)):null!=n&&e.removeAttribute("value"),null==s&&null!=r&&(e.defaultChecked=!!r),null!=s&&(e.checked=s&&"function"!=typeof s&&"symbol"!=typeof s),null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.name=""+ut(o):e.removeAttribute("name")}function bt(e,t,a,n,s,r,i,o){if(null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&"boolean"!=typeof r&&(e.type=r),null!=t||null!=a){if(("submit"===r||"reset"===r)&&null==t)return void pt(e);a=null!=a?""+ut(a):"",t=null!=t?""+ut(t):a,o||t===e.value||(e.value=t),e.defaultValue=t}n="function"!=typeof(n=null!=n?n:s)&&"symbol"!=typeof n&&!!n,e.checked=o?e.checked:!!n,e.defaultChecked=!!n,null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i&&(e.name=i),pt(e)}function vt(e,t,a){"number"===t&&ht(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function xt(e,t,a,n){if(e=e.options,t){t={};for(var s=0;s<a.length;s++)t["$"+a[s]]=!0;for(a=0;a<e.length;a++)s=t.hasOwnProperty("$"+e[a].value),e[a].selected!==s&&(e[a].selected=s),s&&n&&(e[a].defaultSelected=!0)}else{for(a=""+ut(a),t=null,s=0;s<e.length;s++){if(e[s].value===a)return e[s].selected=!0,void(n&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function wt(e,t,a){null==t||((t=""+ut(t))!==e.value&&(e.value=t),null!=a)?e.defaultValue=null!=a?""+ut(a):"":e.defaultValue!==t&&(e.defaultValue=t)}function kt(e,t,a,s){if(null==t){if(null!=s){if(null!=a)throw Error(n(92));if(O(s)){if(1<s.length)throw Error(n(93));s=s[0]}a=s}null==a&&(a=""),t=a}a=ut(t),e.defaultValue=a,(s=e.textContent)===a&&""!==s&&null!==s&&(e.value=s),pt(e)}function St(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&3===a.nodeType)return void(a.nodeValue=t)}e.textContent=t}var Mt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Nt(e,t,a){var n=0===t.indexOf("--");null==a||"boolean"==typeof a||""===a?n?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":n?e.setProperty(t,a):"number"!=typeof a||0===a||Mt.has(t)?"float"===t?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function Ct(e,t,a){if(null!=t&&"object"!=typeof t)throw Error(n(62));if(e=e.style,null!=a){for(var s in a)!a.hasOwnProperty(s)||null!=t&&t.hasOwnProperty(s)||(0===s.indexOf("--")?e.setProperty(s,""):"float"===s?e.cssFloat="":e[s]="");for(var r in t)s=t[r],t.hasOwnProperty(r)&&a[r]!==s&&Nt(e,r,s)}else for(var i in t)t.hasOwnProperty(i)&&Nt(e,i,t[i])}function Pt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Et=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_t=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Tt(e){return _t.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function At(){}var Ot=null;function It(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ft=null,Dt=null;function Rt(e){var t=Ye(e);if(t&&(e=t.stateNode)){var a=e[ze]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,"radio"===a.type&&null!=t){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+yt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var s=a[t];if(s!==e&&s.form===e.form){var r=s[ze]||null;if(!r)throw Error(n(90));gt(s,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(t=0;t<a.length;t++)(s=a[t]).form===e.form&&mt(s)}break e;case"textarea":wt(e,a.value,a.defaultValue);break e;case"select":null!=(t=a.value)&&xt(e,!!a.multiple,t,!1)}}}var jt=!1;function Bt(e,t,a){if(jt)return e(t,a);jt=!0;try{return e(t)}finally{if(jt=!1,(null!==Ft||null!==Dt)&&(tu(),Ft&&(t=Ft,e=Dt,Dt=Ft=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function Lt(e,t){var a=e.stateNode;if(null===a)return null;var s=a[ze]||null;if(null===s)return null;a=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(a&&"function"!=typeof a)throw Error(n(231,t,typeof a));return a}var Vt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),zt=!1;if(Vt)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){zt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(Jp){zt=!1}var Gt=null,Wt=null,Ht=null;function Kt(){if(Ht)return Ht;var e,t,a=Wt,n=a.length,s="value"in Gt?Gt.value:Gt.textContent,r=s.length;for(e=0;e<n&&a[e]===s[e];e++);var i=n-e;for(t=1;t<=i&&a[n-t]===s[r-t];t++);return Ht=s.slice(e,1<t?1-t:void 0)}function qt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function $t(){return!0}function Xt(){return!1}function Yt(e){function t(t,a,n,s,r){for(var i in this._reactName=t,this._targetInst=n,this.type=a,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(i)&&(t=e[i],this[i]=t?t(s):s[i]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?$t:Xt,this.isPropagationStopped=Xt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=$t)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=$t)},persist:function(){},isPersistent:$t}),t}var Zt,Qt,Jt,ea={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ta=Yt(ea),aa=p({},ea,{view:0,detail:0}),na=Yt(aa),sa=p({},aa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fa,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Zt=e.screenX-Jt.screenX,Qt=e.screenY-Jt.screenY):Qt=Zt=0,Jt=e),Zt)},movementY:function(e){return"movementY"in e?e.movementY:Qt}}),ra=Yt(sa),ia=Yt(p({},sa,{dataTransfer:0})),oa=Yt(p({},aa,{relatedTarget:0})),la=Yt(p({},ea,{animationName:0,elapsedTime:0,pseudoElement:0})),ca=Yt(p({},ea,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ua=Yt(p({},ea,{data:0})),da={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ma={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ha(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=ma[e])&&!!t[e]}function fa(){return ha}var ya=Yt(p({},aa,{key:function(e){if(e.key){var t=da[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=qt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?pa[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fa,charCode:function(e){return"keypress"===e.type?qt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?qt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),ga=Yt(p({},sa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),ba=Yt(p({},aa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fa})),va=Yt(p({},ea,{propertyName:0,elapsedTime:0,pseudoElement:0})),xa=Yt(p({},sa,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),wa=Yt(p({},ea,{newState:0,oldState:0})),ka=[9,13,27,32],Sa=Vt&&"CompositionEvent"in window,Ma=null;Vt&&"documentMode"in document&&(Ma=document.documentMode);var Na=Vt&&"TextEvent"in window&&!Ma,Pa=Vt&&(!Sa||Ma&&8<Ma&&11>=Ma),Ea=String.fromCharCode(32),_a=!1;function Aa(e,t){switch(e){case"keyup":return-1!==ka.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Oa(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Fa=!1;var Da={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ra(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Da[e.type]:"textarea"===t}function ja(e,t,a,n){Ft?Dt?Dt.push(n):Dt=[n]:Ft=n,0<(t=rd(t,"onChange")).length&&(a=new ta("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var Ba=null,La=null;function Va(e){Zu(e,0)}function za(e){if(mt(Ze(e)))return e}function Ua(e,t){if("change"===e)return t}var Ga=!1;if(Vt){var Wa;if(Vt){var Ha="oninput"in document;if(!Ha){var Ka=document.createElement("div");Ka.setAttribute("oninput","return;"),Ha="function"==typeof Ka.oninput}Wa=Ha}else Wa=!1;Ga=Wa&&(!document.documentMode||9<document.documentMode)}function qa(){Ba&&(Ba.detachEvent("onpropertychange",$a),La=Ba=null)}function $a(e){if("value"===e.propertyName&&za(La)){var t=[];ja(t,La,e,It(e)),Bt(Va,t)}}function Xa(e,t,a){"focusin"===e?(qa(),La=a,(Ba=t).attachEvent("onpropertychange",$a)):"focusout"===e&&qa()}function Ya(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return za(La)}function Za(e,t){if("click"===e)return za(t)}function Qa(e,t){if("input"===e||"change"===e)return za(t)}var Ja="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function en(e,t){if(Ja(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var s=a[n];if(!ae.call(t,s)||!Ja(e[s],t[s]))return!1}return!0}function tn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function an(e,t){var a,n=tn(e);for(e=0;n;){if(3===n.nodeType){if(a=e+n.textContent.length,e<=t&&a>=t)return{node:n,offset:t-e};e=a}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=tn(n)}}function nn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?nn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function sn(e){for(var t=ht((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var a="string"==typeof t.contentWindow.location.href}catch(n){a=!1}if(!a)break;t=ht((e=t.contentWindow).document)}return t}function rn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var on=Vt&&"documentMode"in document&&11>=document.documentMode,ln=null,cn=null,un=null,dn=!1;function pn(e,t,a){var n=a.window===a?a.document:9===a.nodeType?a:a.ownerDocument;dn||null==ln||ln!==ht(n)||("selectionStart"in(n=ln)&&rn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},un&&en(un,n)||(un=n,0<(n=rd(cn,"onSelect")).length&&(t=new ta("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=ln)))}function mn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var hn={animationend:mn("Animation","AnimationEnd"),animationiteration:mn("Animation","AnimationIteration"),animationstart:mn("Animation","AnimationStart"),transitionrun:mn("Transition","TransitionRun"),transitionstart:mn("Transition","TransitionStart"),transitioncancel:mn("Transition","TransitionCancel"),transitionend:mn("Transition","TransitionEnd")},fn={},yn={};function gn(e){if(fn[e])return fn[e];if(!hn[e])return e;var t,a=hn[e];for(t in a)if(a.hasOwnProperty(t)&&t in yn)return fn[e]=a[t];return e}Vt&&(yn=document.createElement("div").style,"AnimationEvent"in window||(delete hn.animationend.animation,delete hn.animationiteration.animation,delete hn.animationstart.animation),"TransitionEvent"in window||delete hn.transitionend.transition);var bn=gn("animationend"),vn=gn("animationiteration"),xn=gn("animationstart"),wn=gn("transitionrun"),kn=gn("transitionstart"),Sn=gn("transitioncancel"),Mn=gn("transitionend"),Nn=new Map,Cn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pn(e,t){Nn.set(e,t),at(t,[e])}Cn.push("scrollEnd");var En="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},_n=[],Tn=0,An=0;function On(){for(var e=Tn,t=An=Tn=0;t<e;){var a=_n[t];_n[t++]=null;var n=_n[t];_n[t++]=null;var s=_n[t];_n[t++]=null;var r=_n[t];if(_n[t++]=null,null!==n&&null!==s){var i=n.pending;null===i?s.next=s:(s.next=i.next,i.next=s),n.pending=s}0!==r&&Rn(a,s,r)}}function In(e,t,a,n){_n[Tn++]=e,_n[Tn++]=t,_n[Tn++]=a,_n[Tn++]=n,An|=n,e.lanes|=n,null!==(e=e.alternate)&&(e.lanes|=n)}function Fn(e,t,a,n){return In(e,t,a,n),jn(e)}function Dn(e,t){return In(e,null,null,t),jn(e)}function Rn(e,t,a){e.lanes|=a;var n=e.alternate;null!==n&&(n.lanes|=a);for(var s=!1,r=e.return;null!==r;)r.childLanes|=a,null!==(n=r.alternate)&&(n.childLanes|=a),22===r.tag&&(null===(e=r.stateNode)||1&e._visibility||(s=!0)),e=r,r=r.return;return 3===e.tag?(r=e.stateNode,s&&null!==t&&(s=31-ve(a),null===(n=(e=r.hiddenUpdates)[s])?e[s]=[t]:n.push(t),t.lane=536870912|a),r):null}function jn(e){if(50<Kc)throw Kc=0,qc=null,Error(n(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Bn={};function Ln(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vn(e,t,a,n){return new Ln(e,t,a,n)}function zn(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Un(e,t){var a=e.alternate;return null===a?((a=Vn(e.tag,t,e.key,e.mode)).elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=65011712&e.flags,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Gn(e,t){e.flags&=65011714;var a=e.alternate;return null===a?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Wn(e,t,a,s,r,i){var o=0;if(s=e,"function"==typeof e)zn(e)&&(o=1);else if("string"==typeof e)o=function(e,t,a){if(1===a||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,a,G.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=Vn(31,a,t,r)).elementType=C,e.lanes=i,e;case y:return Hn(a.children,r,i,t);case g:o=8,r|=24;break;case b:return(e=Vn(12,a,t,2|r)).elementType=b,e.lanes=i,e;case k:return(e=Vn(13,a,t,r)).elementType=k,e.lanes=i,e;case S:return(e=Vn(19,a,t,r)).elementType=S,e.lanes=i,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case x:o=10;break e;case v:o=9;break e;case w:o=11;break e;case M:o=14;break e;case N:o=16,s=null;break e}o=29,a=Error(n(130,null===e?"null":typeof e,"")),s=null}return(t=Vn(o,a,t,r)).elementType=e,t.type=s,t.lanes=i,t}function Hn(e,t,a,n){return(e=Vn(7,e,n,t)).lanes=a,e}function Kn(e,t,a){return(e=Vn(6,e,null,t)).lanes=a,e}function qn(e){var t=Vn(18,null,null,0);return t.stateNode=e,t}function $n(e,t,a){return(t=Vn(4,null!==e.children?e.children:[],e.key,t)).lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Xn=new WeakMap;function Yn(e,t){if("object"==typeof e&&null!==e){var a=Xn.get(e);return void 0!==a?a:(t={value:e,source:t,stack:te(t)},Xn.set(e,t),t)}return{value:e,source:t,stack:te(t)}}var Zn=[],Qn=0,Jn=null,es=0,ts=[],as=0,ns=null,ss=1,rs="";function is(e,t){Zn[Qn++]=es,Zn[Qn++]=Jn,Jn=e,es=t}function os(e,t,a){ts[as++]=ss,ts[as++]=rs,ts[as++]=ns,ns=e;var n=ss;e=rs;var s=32-ve(n)-1;n&=~(1<<s),a+=1;var r=32-ve(t)+s;if(30<r){var i=s-s%5;r=(n&(1<<i)-1).toString(32),n>>=i,s-=i,ss=1<<32-ve(t)+s|a<<s|n,rs=r+e}else ss=1<<r|a<<s|n,rs=e}function ls(e){null!==e.return&&(is(e,1),os(e,1,0))}function cs(e){for(;e===Jn;)Jn=Zn[--Qn],Zn[Qn]=null,es=Zn[--Qn],Zn[Qn]=null;for(;e===ns;)ns=ts[--as],ts[as]=null,rs=ts[--as],ts[as]=null,ss=ts[--as],ts[as]=null}function us(e,t){ts[as++]=ss,ts[as++]=rs,ts[as++]=ns,ss=t.id,rs=t.overflow,ns=e}var ds=null,ps=null,ms=!1,hs=null,fs=!1,ys=Error(n(519));function gs(e){throw Ss(Yn(Error(n(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),ys}function bs(e){var t=e.stateNode,a=e.type,n=e.memoizedProps;switch(t[Ve]=e,t[ze]=n,a){case"dialog":Qu("cancel",t),Qu("close",t);break;case"iframe":case"object":case"embed":Qu("load",t);break;case"video":case"audio":for(a=0;a<Xu.length;a++)Qu(Xu[a],t);break;case"source":Qu("error",t);break;case"img":case"image":case"link":Qu("error",t),Qu("load",t);break;case"details":Qu("toggle",t);break;case"input":Qu("invalid",t),bt(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":Qu("invalid",t);break;case"textarea":Qu("invalid",t),kt(t,n.value,n.defaultValue,n.children)}"string"!=typeof(a=n.children)&&"number"!=typeof a&&"bigint"!=typeof a||t.textContent===""+a||!0===n.suppressHydrationWarning||dd(t.textContent,a)?(null!=n.popover&&(Qu("beforetoggle",t),Qu("toggle",t)),null!=n.onScroll&&Qu("scroll",t),null!=n.onScrollEnd&&Qu("scrollend",t),null!=n.onClick&&(t.onclick=At),t=!0):t=!1,t||gs(e,!0)}function vs(e){for(ds=e.return;ds;)switch(ds.tag){case 5:case 31:case 13:return void(fs=!1);case 27:case 3:return void(fs=!0);default:ds=ds.return}}function xs(e){if(e!==ds)return!1;if(!ms)return vs(e),ms=!0,!1;var t,a=e.tag;if((t=3!==a&&27!==a)&&((t=5===a)&&(t=!("form"!==(t=e.type)&&"button"!==t)||wd(e.type,e.memoizedProps)),t=!t),t&&ps&&gs(e),vs(e),13===a){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));ps=jd(e)}else if(31===a){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(n(317));ps=jd(e)}else 27===a?(a=ps,Ed(e.type)?(e=Rd,Rd=null,ps=e):ps=a):ps=ds?Dd(e.stateNode.nextSibling):null;return!0}function ws(){ps=ds=null,ms=!1}function ks(){var e=hs;return null!==e&&(null===Oc?Oc=e:Oc.push.apply(Oc,e),hs=null),e}function Ss(e){null===hs?hs=[e]:hs.push(e)}var Ms=B(null),Ns=null,Cs=null;function Ps(e,t,a){V(Ms,t._currentValue),t._currentValue=a}function Es(e){e._currentValue=Ms.current,L(Ms)}function _s(e,t,a){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function Ts(e,t,a,s){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var i=r.dependencies;if(null!==i){var o=r.child;i=i.firstContext;e:for(;null!==i;){var l=i;i=r;for(var c=0;c<t.length;c++)if(l.context===t[c]){i.lanes|=a,null!==(l=i.alternate)&&(l.lanes|=a),_s(i.return,a,e),s||(o=null);break e}i=l.next}}else if(18===r.tag){if(null===(o=r.return))throw Error(n(341));o.lanes|=a,null!==(i=o.alternate)&&(i.lanes|=a),_s(o,a,e),o=null}else o=r.child;if(null!==o)o.return=r;else for(o=r;null!==o;){if(o===e){o=null;break}if(null!==(r=o.sibling)){r.return=o.return,o=r;break}o=o.return}r=o}}function As(e,t,a,s){e=null;for(var r=t,i=!1;null!==r;){if(!i)if(524288&r.flags)i=!0;else if(262144&r.flags)break;if(10===r.tag){var o=r.alternate;if(null===o)throw Error(n(387));if(null!==(o=o.memoizedProps)){var l=r.type;Ja(r.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(r===K.current){if(null===(o=r.alternate))throw Error(n(387));o.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(null!==e?e.push(pp):e=[pp])}r=r.return}null!==e&&Ts(t,e,a,s),t.flags|=262144}function Os(e){for(e=e.firstContext;null!==e;){if(!Ja(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Is(e){Ns=e,Cs=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Fs(e){return Rs(Ns,e)}function Ds(e,t){return null===Ns&&Is(e),Rs(e,t)}function Rs(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},null===Cs){if(null===e)throw Error(n(308));Cs=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Cs=Cs.next=t;return a}var js="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,a){e.push(a)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Bs=e.unstable_scheduleCallback,Ls=e.unstable_NormalPriority,Vs={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zs(){return{controller:new js,data:new Map,refCount:0}}function Us(e){e.refCount--,0===e.refCount&&Bs(Ls,function(){e.controller.abort()})}var Gs=null,Ws=0,Hs=0,Ks=null;function qs(){if(0===--Ws&&null!==Gs){null!==Ks&&(Ks.status="fulfilled");var e=Gs;Gs=null,Hs=0,Ks=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var $s=I.S;I.S=function(e,t){Dc=oe(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Gs){var a=Gs=[];Ws=0,Hs=Wu(),Ks={status:"pending",value:void 0,then:function(e){a.push(e)}}}Ws++,t.then(qs,qs)}(0,t),null!==$s&&$s(e,t)};var Xs=B(null);function Ys(){var e=Xs.current;return null!==e?e:yc.pooledCache}function Zs(e,t){V(Xs,null===t?Xs.current:t.pool)}function Qs(){var e=Ys();return null===e?null:{parent:Vs._currentValue,pool:e}}var Js=Error(n(460)),er=Error(n(474)),tr=Error(n(542)),ar={then:function(){}};function nr(e){return"fulfilled"===(e=e.status)||"rejected"===e}function sr(e,t,a){switch(void 0===(a=e[a])?e.push(t):a!==t&&(t.then(At,At),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e;default:if("string"==typeof t.status)t.then(At,At);else{if(null!==(e=yc)&&100<e.shellSuspendCounter)throw Error(n(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var a=t;a.status="fulfilled",a.value=e}},function(e){if("pending"===t.status){var a=t;a.status="rejected",a.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw lr(e=t.reason),e}throw ir=t,Js}}function rr(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw ir=t,Js;throw t}}var ir=null;function or(){if(null===ir)throw Error(n(459));var e=ir;return ir=null,e}function lr(e){if(e===Js||e===tr)throw Error(n(483))}var cr=null,ur=0;function dr(e){var t=ur;return ur+=1,null===cr&&(cr=[]),sr(cr,e,t)}function pr(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function mr(e,t){if(t.$$typeof===m)throw Error(n(525));throw e=Object.prototype.toString.call(t),Error(n(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function hr(e){function t(t,a){if(e){var n=t.deletions;null===n?(t.deletions=[a],t.flags|=16):n.push(a)}}function a(a,n){if(!e)return null;for(;null!==n;)t(a,n),n=n.sibling;return null}function s(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(e,t){return(e=Un(e,t)).index=0,e.sibling=null,e}function i(t,a,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<a?(t.flags|=67108866,a):n:(t.flags|=67108866,a):(t.flags|=1048576,a)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,a,n){return null===t||6!==t.tag?((t=Kn(a,e.mode,n)).return=e,t):((t=r(t,a)).return=e,t)}function c(e,t,a,n){var s=a.type;return s===y?d(e,t,a.props.children,n,a.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===N&&rr(s)===t.type)?(pr(t=r(t,a.props),a),t.return=e,t):(pr(t=Wn(a.type,a.key,a.props,null,e.mode,n),a),t.return=e,t)}function u(e,t,a,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==a.containerInfo||t.stateNode.implementation!==a.implementation?((t=$n(a,e.mode,n)).return=e,t):((t=r(t,a.children||[])).return=e,t)}function d(e,t,a,n,s){return null===t||7!==t.tag?((t=Hn(a,e.mode,n,s)).return=e,t):((t=r(t,a)).return=e,t)}function p(e,t,a){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Kn(""+t,e.mode,a)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case h:return pr(a=Wn(t.type,t.key,t.props,null,e.mode,a),t),a.return=e,a;case f:return(t=$n(t,e.mode,a)).return=e,t;case N:return p(e,t=rr(t),a)}if(O(t)||_(t))return(t=Hn(t,e.mode,a,null)).return=e,t;if("function"==typeof t.then)return p(e,dr(t),a);if(t.$$typeof===x)return p(e,Ds(e,t),a);mr(e,t)}return null}function m(e,t,a,n){var s=null!==t?t.key:null;if("string"==typeof a&&""!==a||"number"==typeof a||"bigint"==typeof a)return null!==s?null:l(e,t,""+a,n);if("object"==typeof a&&null!==a){switch(a.$$typeof){case h:return a.key===s?c(e,t,a,n):null;case f:return a.key===s?u(e,t,a,n):null;case N:return m(e,t,a=rr(a),n)}if(O(a)||_(a))return null!==s?null:d(e,t,a,n,null);if("function"==typeof a.then)return m(e,t,dr(a),n);if(a.$$typeof===x)return m(e,t,Ds(e,a),n);mr(e,a)}return null}function g(e,t,a,n,s){if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return l(t,e=e.get(a)||null,""+n,s);if("object"==typeof n&&null!==n){switch(n.$$typeof){case h:return c(t,e=e.get(null===n.key?a:n.key)||null,n,s);case f:return u(t,e=e.get(null===n.key?a:n.key)||null,n,s);case N:return g(e,t,a,n=rr(n),s)}if(O(n)||_(n))return d(t,e=e.get(a)||null,n,s,null);if("function"==typeof n.then)return g(e,t,a,dr(n),s);if(n.$$typeof===x)return g(e,t,a,Ds(t,n),s);mr(t,n)}return null}function b(l,c,u,d){if("object"==typeof u&&null!==u&&u.type===y&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case h:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===y){if(7===c.tag){a(l,c.sibling),(d=r(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===v||"object"==typeof v&&null!==v&&v.$$typeof===N&&rr(v)===c.type){a(l,c.sibling),pr(d=r(c,u.props),u),d.return=l,l=d;break e}a(l,c);break}t(l,c),c=c.sibling}u.type===y?((d=Hn(u.props.children,l.mode,d,u.key)).return=l,l=d):(pr(d=Wn(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return o(l);case f:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){a(l,c.sibling),(d=r(c,u.children||[])).return=l,l=d;break e}a(l,c);break}t(l,c),c=c.sibling}(d=$n(u,l.mode,d)).return=l,l=d}return o(l);case N:return b(l,c,u=rr(u),d)}if(O(u))return function(n,r,o,l){for(var c=null,u=null,d=r,h=r=0,f=null;null!==d&&h<o.length;h++){d.index>h?(f=d,d=null):f=d.sibling;var y=m(n,d,o[h],l);if(null===y){null===d&&(d=f);break}e&&d&&null===y.alternate&&t(n,d),r=i(y,r,h),null===u?c=y:u.sibling=y,u=y,d=f}if(h===o.length)return a(n,d),ms&&is(n,h),c;if(null===d){for(;h<o.length;h++)null!==(d=p(n,o[h],l))&&(r=i(d,r,h),null===u?c=d:u.sibling=d,u=d);return ms&&is(n,h),c}for(d=s(d);h<o.length;h++)null!==(f=g(d,n,h,o[h],l))&&(e&&null!==f.alternate&&d.delete(null===f.key?h:f.key),r=i(f,r,h),null===u?c=f:u.sibling=f,u=f);return e&&d.forEach(function(e){return t(n,e)}),ms&&is(n,h),c}(l,c,u,d);if(_(u)){if("function"!=typeof(v=_(u)))throw Error(n(150));return function(r,o,l,c){if(null==l)throw Error(n(151));for(var u=null,d=null,h=o,f=o=0,y=null,b=l.next();null!==h&&!b.done;f++,b=l.next()){h.index>f?(y=h,h=null):y=h.sibling;var v=m(r,h,b.value,c);if(null===v){null===h&&(h=y);break}e&&h&&null===v.alternate&&t(r,h),o=i(v,o,f),null===d?u=v:d.sibling=v,d=v,h=y}if(b.done)return a(r,h),ms&&is(r,f),u;if(null===h){for(;!b.done;f++,b=l.next())null!==(b=p(r,b.value,c))&&(o=i(b,o,f),null===d?u=b:d.sibling=b,d=b);return ms&&is(r,f),u}for(h=s(h);!b.done;f++,b=l.next())null!==(b=g(h,r,f,b.value,c))&&(e&&null!==b.alternate&&h.delete(null===b.key?f:b.key),o=i(b,o,f),null===d?u=b:d.sibling=b,d=b);return e&&h.forEach(function(e){return t(r,e)}),ms&&is(r,f),u}(l,c,u=v.call(u),d)}if("function"==typeof u.then)return b(l,c,dr(u),d);if(u.$$typeof===x)return b(l,c,Ds(l,u),d);mr(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u||"bigint"==typeof u?(u=""+u,null!==c&&6===c.tag?(a(l,c.sibling),(d=r(c,u)).return=l,l=d):(a(l,c),(d=Kn(u,l.mode,d)).return=l,l=d),o(l)):a(l,c)}return function(e,t,a,n){try{ur=0;var s=b(e,t,a,n);return cr=null,s}catch(i){if(i===Js||i===tr)throw i;var r=Vn(29,i,null,e.mode);return r.lanes=n,r.return=e,r}}}var fr=hr(!0),yr=hr(!1),gr=!1;function br(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function xr(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wr(e,t,a){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,2&fc){var s=n.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),n.pending=t,t=jn(e),Rn(e,null,a),t}return In(e,n,t,a),jn(e)}function kr(e,t,a){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&a)){var n=t.lanes;a|=n&=e.pendingLanes,t.lanes=a,Ie(e,a)}}function Sr(e,t){var a=e.updateQueue,n=e.alternate;if(null!==n&&a===(n=n.updateQueue)){var s=null,r=null;if(null!==(a=a.firstBaseUpdate)){do{var i={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};null===r?s=r=i:r=r.next=i,a=a.next}while(null!==a);null===r?s=r=t:r=r.next=t}else s=r=t;return a={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:n.shared,callbacks:n.callbacks},void(e.updateQueue=a)}null===(e=a.lastBaseUpdate)?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var Mr=!1;function Nr(){if(Mr){if(null!==Ks)throw Ks}}function Cr(e,t,a,n){Mr=!1;var s=e.updateQueue;gr=!1;var r=s.firstBaseUpdate,i=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===i?r=c:i.next=c,i=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==i&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==r){var d=s.baseState;for(i=0,u=c=l=null,o=r;;){var m=-536870913&o.lane,h=m!==o.lane;if(h?(bc&m)===m:(n&m)===m){0!==m&&m===Hs&&(Mr=!0),null!==u&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var f=e,y=o;m=t;var g=a;switch(y.tag){case 1:if("function"==typeof(f=y.payload)){d=f.call(g,d,m);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(m="function"==typeof(f=y.payload)?f.call(g,d,m):f))break e;d=p({},d,m);break e;case 2:gr=!0}}null!==(m=o.callback)&&(e.flags|=64,h&&(e.flags|=8192),null===(h=s.callbacks)?s.callbacks=[m]:h.push(m))}else h={lane:m,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=h,l=d):u=u.next=h,i|=m;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(h=o).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}null===u&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,null===r&&(s.shared.lanes=0),Cc|=i,e.lanes=i,e.memoizedState=d}}function Pr(e,t){if("function"!=typeof e)throw Error(n(191,e));e.call(t)}function Er(e,t){var a=e.callbacks;if(null!==a)for(e.callbacks=null,e=0;e<a.length;e++)Pr(a[e],t)}var _r=B(null),Tr=B(0);function Ar(e,t){V(Tr,e=Mc),V(_r,t),Mc=e|t.baseLanes}function Or(){V(Tr,Mc),V(_r,_r.current)}function Ir(){Mc=Tr.current,L(_r),L(Tr)}var Fr=B(null),Dr=null;function Rr(e){var t=e.alternate;V(zr,1&zr.current),V(Fr,e),null===Dr&&(null===t||null!==_r.current||null!==t.memoizedState)&&(Dr=e)}function jr(e){V(zr,zr.current),V(Fr,e),null===Dr&&(Dr=e)}function Br(e){22===e.tag?(V(zr,zr.current),V(Fr,e),null===Dr&&(Dr=e)):Lr()}function Lr(){V(zr,zr.current),V(Fr,Fr.current)}function Vr(e){L(Fr),Dr===e&&(Dr=null),L(zr)}var zr=B(0);function Ur(e){for(var t=e;null!==t;){if(13===t.tag){var a=t.memoizedState;if(null!==a&&(null===(a=a.dehydrated)||Id(a)||Fd(a)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gr=0,Wr=null,Hr=null,Kr=null,qr=!1,$r=!1,Xr=!1,Yr=0,Zr=0,Qr=null,Jr=0;function ei(){throw Error(n(321))}function ti(e,t){if(null===t)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Ja(e[a],t[a]))return!1;return!0}function ai(e,t,a,n,s,r){return Gr=r,Wr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,I.H=null===e||null===e.memoizedState?bo:vo,Xr=!1,r=a(n,s),Xr=!1,$r&&(r=si(t,a,n,s)),ni(e),r}function ni(e){I.H=go;var t=null!==Hr&&null!==Hr.next;if(Gr=0,Kr=Hr=Wr=null,qr=!1,Zr=0,Qr=null,t)throw Error(n(300));null===e||Do||null!==(e=e.dependencies)&&Os(e)&&(Do=!0)}function si(e,t,a,s){Wr=e;var r=0;do{if($r&&(Qr=null),Zr=0,$r=!1,25<=r)throw Error(n(301));if(r+=1,Kr=Hr=null,null!=e.updateQueue){var i=e.updateQueue;i.lastEffect=null,i.events=null,i.stores=null,null!=i.memoCache&&(i.memoCache.index=0)}I.H=xo,i=t(a,s)}while($r);return i}function ri(){var e=I.H,t=e.useState()[0];return t="function"==typeof t.then?di(t):t,e=e.useState()[0],(null!==Hr?Hr.memoizedState:null)!==e&&(Wr.flags|=1024),t}function ii(){var e=0!==Yr;return Yr=0,e}function oi(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function li(e){if(qr){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}qr=!1}Gr=0,Kr=Hr=Wr=null,$r=!1,Zr=Yr=0,Qr=null}function ci(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Kr?Wr.memoizedState=Kr=e:Kr=Kr.next=e,Kr}function ui(){if(null===Hr){var e=Wr.alternate;e=null!==e?e.memoizedState:null}else e=Hr.next;var t=null===Kr?Wr.memoizedState:Kr.next;if(null!==t)Kr=t,Hr=e;else{if(null===e){if(null===Wr.alternate)throw Error(n(467));throw Error(n(310))}e={memoizedState:(Hr=e).memoizedState,baseState:Hr.baseState,baseQueue:Hr.baseQueue,queue:Hr.queue,next:null},null===Kr?Wr.memoizedState=Kr=e:Kr=Kr.next=e}return Kr}function di(e){var t=Zr;return Zr+=1,null===Qr&&(Qr=[]),e=sr(Qr,e,t),t=Wr,null===(null===Kr?t.memoizedState:Kr.next)&&(t=t.alternate,I.H=null===t||null===t.memoizedState?bo:vo),e}function pi(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return di(e);if(e.$$typeof===x)return Fs(e)}throw Error(n(438,String(e)))}function mi(e){var t=null,a=Wr.updateQueue;if(null!==a&&(t=a.memoCache),null==t){var n=Wr.alternate;null!==n&&(null!==(n=n.updateQueue)&&(null!=(n=n.memoCache)&&(t={data:n.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===a&&(a={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=a),a.memoCache=t,void 0===(a=t.data[t.index]))for(a=t.data[t.index]=Array(e),n=0;n<e;n++)a[n]=P;return t.index++,a}function hi(e,t){return"function"==typeof t?t(e):t}function fi(e){return yi(ui(),Hr,e)}function yi(e,t,a){var s=e.queue;if(null===s)throw Error(n(311));s.lastRenderedReducer=a;var r=e.baseQueue,i=s.pending;if(null!==i){if(null!==r){var o=r.next;r.next=i.next,i.next=o}t.baseQueue=r=i,s.pending=null}if(i=e.baseState,null===r)e.memoizedState=i;else{var l=o=null,c=null,u=t=r.next,d=!1;do{var p=-536870913&u.lane;if(p!==u.lane?(bc&p)===p:(Gr&p)===p){var m=u.revertLane;if(0===m)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),p===Hs&&(d=!0);else{if((Gr&m)===m){u=u.next,m===Hs&&(d=!0);continue}p={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,o=i):c=c.next=p,Wr.lanes|=m,Cc|=m}p=u.action,Xr&&a(i,p),i=u.hasEagerState?u.eagerState:a(i,p)}else m={lane:p,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=m,o=i):c=c.next=m,Wr.lanes|=p,Cc|=p;u=u.next}while(null!==u&&u!==t);if(null===c?o=i:c.next=l,!Ja(i,e.memoizedState)&&(Do=!0,d&&null!==(a=Ks)))throw a;e.memoizedState=i,e.baseState=o,e.baseQueue=c,s.lastRenderedState=i}return null===r&&(s.lanes=0),[e.memoizedState,s.dispatch]}function gi(e){var t=ui(),a=t.queue;if(null===a)throw Error(n(311));a.lastRenderedReducer=e;var s=a.dispatch,r=a.pending,i=t.memoizedState;if(null!==r){a.pending=null;var o=r=r.next;do{i=e(i,o.action),o=o.next}while(o!==r);Ja(i,t.memoizedState)||(Do=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),a.lastRenderedState=i}return[i,s]}function bi(e,t,a){var s=Wr,r=ui(),i=ms;if(i){if(void 0===a)throw Error(n(407));a=a()}else a=t();var o=!Ja((Hr||r).memoizedState,a);if(o&&(r.memoizedState=a,Do=!0),r=r.queue,Gi(wi.bind(null,s,r,e),[e]),r.getSnapshot!==t||o||null!==Kr&&1&Kr.memoizedState.tag){if(s.flags|=2048,Bi(9,{destroy:void 0},xi.bind(null,s,r,a,t),null),null===yc)throw Error(n(349));i||127&Gr||vi(s,t,a)}return a}function vi(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},null===(t=Wr.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t,t.stores=[e]):null===(a=t.stores)?t.stores=[e]:a.push(e)}function xi(e,t,a,n){t.value=a,t.getSnapshot=n,ki(t)&&Si(e)}function wi(e,t,a){return a(function(){ki(t)&&Si(e)})}function ki(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Ja(e,a)}catch(n){return!0}}function Si(e){var t=Dn(e,2);null!==t&&Yc(t,e,2)}function Mi(e){var t=ci();if("function"==typeof e){var a=e;if(e=a(),Xr){be(!0);try{a()}finally{be(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hi,lastRenderedState:e},t}function Ni(e,t,a,n){return e.baseState=a,yi(e,Hr,"function"==typeof n?n:hi)}function Ci(e,t,a,s,r){if(ho(e))throw Error(n(485));if(null!==(e=t.action)){var i={payload:r,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){i.listeners.push(e)}};null!==I.T?a(!0):i.isTransition=!1,s(i),null===(a=t.pending)?(i.next=t.pending=i,Pi(t,i)):(i.next=a.next,t.pending=a.next=i)}}function Pi(e,t){var a=t.action,n=t.payload,s=e.state;if(t.isTransition){var r=I.T,i={};I.T=i;try{var o=a(s,n),l=I.S;null!==l&&l(i,o),Ei(e,t,o)}catch(c){Ti(e,t,c)}finally{null!==r&&null!==i.types&&(r.types=i.types),I.T=r}}else try{Ei(e,t,r=a(s,n))}catch(u){Ti(e,t,u)}}function Ei(e,t,a){null!==a&&"object"==typeof a&&"function"==typeof a.then?a.then(function(a){_i(e,t,a)},function(a){return Ti(e,t,a)}):_i(e,t,a)}function _i(e,t,a){t.status="fulfilled",t.value=a,Ai(t),e.state=a,null!==(t=e.pending)&&((a=t.next)===t?e.pending=null:(a=a.next,t.next=a,Pi(e,a)))}function Ti(e,t,a){var n=e.pending;if(e.pending=null,null!==n){n=n.next;do{t.status="rejected",t.reason=a,Ai(t),t=t.next}while(t!==n)}e.action=null}function Ai(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Oi(e,t){return t}function Ii(e,t){if(ms){var a=yc.formState;if(null!==a){e:{var n=Wr;if(ms){if(ps){t:{for(var s=ps,r=fs;8!==s.nodeType;){if(!r){s=null;break t}if(null===(s=Dd(s.nextSibling))){s=null;break t}}s="F!"===(r=s.data)||"F"===r?s:null}if(s){ps=Dd(s.nextSibling),n="F!"===s.data;break e}}gs(n)}n=!1}n&&(t=a[0])}}return(a=ci()).memoizedState=a.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oi,lastRenderedState:t},a.queue=n,a=uo.bind(null,Wr,n),n.dispatch=a,n=Mi(!1),r=mo.bind(null,Wr,!1,n.queue),s={state:t,dispatch:null,action:e,pending:null},(n=ci()).queue=s,a=Ci.bind(null,Wr,s,r,a),s.dispatch=a,n.memoizedState=e,[t,a,!1]}function Fi(e){return Di(ui(),Hr,e)}function Di(e,t,a){if(t=yi(e,t,Oi)[0],e=fi(hi)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var n=di(t)}catch(i){if(i===Js)throw tr;throw i}else n=t;var s=(t=ui()).queue,r=s.dispatch;return a!==t.memoizedState&&(Wr.flags|=2048,Bi(9,{destroy:void 0},Ri.bind(null,s,a),null)),[n,r,e]}function Ri(e,t){e.action=t}function ji(e){var t=ui(),a=Hr;if(null!==a)return Di(t,a,e);ui(),t=t.memoizedState;var n=(a=ui()).queue.dispatch;return a.memoizedState=e,[t,n,!1]}function Bi(e,t,a,n){return e={tag:e,create:a,deps:n,inst:t,next:null},null===(t=Wr.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t),null===(a=t.lastEffect)?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function Li(){return ui().memoizedState}function Vi(e,t,a,n){var s=ci();Wr.flags|=e,s.memoizedState=Bi(1|t,{destroy:void 0},a,void 0===n?null:n)}function zi(e,t,a,n){var s=ui();n=void 0===n?null:n;var r=s.memoizedState.inst;null!==Hr&&null!==n&&ti(n,Hr.memoizedState.deps)?s.memoizedState=Bi(t,r,a,n):(Wr.flags|=e,s.memoizedState=Bi(1|t,r,a,n))}function Ui(e,t){Vi(8390656,8,e,t)}function Gi(e,t){zi(2048,8,e,t)}function Wi(e){var t=ui().memoizedState;return function(e){Wr.flags|=4;var t=Wr.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Wr.updateQueue=t,t.events=[e];else{var a=t.events;null===a?t.events=[e]:a.push(e)}}({ref:t,nextImpl:e}),function(){if(2&fc)throw Error(n(440));return t.impl.apply(void 0,arguments)}}function Hi(e,t){return zi(4,2,e,t)}function Ki(e,t){return zi(4,4,e,t)}function qi(e,t){if("function"==typeof t){e=e();var a=t(e);return function(){"function"==typeof a?a():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function $i(e,t,a){a=null!=a?a.concat([e]):null,zi(4,4,qi.bind(null,t,e),a)}function Xi(){}function Yi(e,t){var a=ui();t=void 0===t?null:t;var n=a.memoizedState;return null!==t&&ti(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function Zi(e,t){var a=ui();t=void 0===t?null:t;var n=a.memoizedState;if(null!==t&&ti(t,n[1]))return n[0];if(n=e(),Xr){be(!0);try{e()}finally{be(!1)}}return a.memoizedState=[n,t],n}function Qi(e,t,a){return void 0===a||1073741824&Gr&&!(261930&bc)?e.memoizedState=t:(e.memoizedState=a,e=Xc(),Wr.lanes|=e,Cc|=e,a)}function Ji(e,t,a,n){return Ja(a,t)?a:null!==_r.current?(e=Qi(e,a,n),Ja(e,t)||(Do=!0),e):42&Gr&&(!(1073741824&Gr)||261930&bc)?(e=Xc(),Wr.lanes|=e,Cc|=e,t):(Do=!0,e.memoizedState=a)}function eo(e,t,a,n,s){var r=F.p;F.p=0!==r&&8>r?r:8;var i,o,l,c=I.T,u={};I.T=u,mo(e,!1,t,a);try{var d=s(),p=I.S;if(null!==p&&p(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then)po(e,t,(i=n,o=[],l={status:"pending",value:null,reason:null,then:function(e){o.push(e)}},d.then(function(){l.status="fulfilled",l.value=i;for(var e=0;e<o.length;e++)(0,o[e])(i)},function(e){for(l.status="rejected",l.reason=e,e=0;e<o.length;e++)(0,o[e])(void 0)}),l),$c());else po(e,t,n,$c())}catch(m){po(e,t,{then:function(){},status:"rejected",reason:m},$c())}finally{F.p=r,null!==c&&null!==u.types&&(c.types=u.types),I.T=c}}function to(){}function ao(e,t,a,s){if(5!==e.tag)throw Error(n(476));var r=no(e).queue;eo(e,r,t,D,null===a?to:function(){return so(e),a(s)})}function no(e){var t=e.memoizedState;if(null!==t)return t;var a={};return(t={memoizedState:D,baseState:D,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hi,lastRenderedState:D},next:null}).next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hi,lastRenderedState:a},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function so(e){var t=no(e);null===t.next&&(t=e.alternate.memoizedState),po(e,t.next.queue,{},$c())}function ro(){return Fs(pp)}function io(){return ui().memoizedState}function oo(){return ui().memoizedState}function lo(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var a=$c(),n=wr(t,e=xr(a),a);return null!==n&&(Yc(n,t,a),kr(n,t,a)),t={cache:zs()},void(e.payload=t)}t=t.return}}function co(e,t,a){var n=$c();a={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},ho(e)?fo(t,a):null!==(a=Fn(e,t,a,n))&&(Yc(a,e,n),yo(a,t,n))}function uo(e,t,a){po(e,t,a,$c())}function po(e,t,a,n){var s={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(ho(e))fo(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var i=t.lastRenderedState,o=r(i,a);if(s.hasEagerState=!0,s.eagerState=o,Ja(o,i))return In(e,t,s,0),null===yc&&On(),!1}catch(l){}if(null!==(a=Fn(e,t,s,n)))return Yc(a,e,n),yo(a,t,n),!0}return!1}function mo(e,t,a,s){if(s={lane:2,revertLane:Wu(),gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},ho(e)){if(t)throw Error(n(479))}else null!==(t=Fn(e,a,s,2))&&Yc(t,e,2)}function ho(e){var t=e.alternate;return e===Wr||null!==t&&t===Wr}function fo(e,t){$r=qr=!0;var a=e.pending;null===a?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function yo(e,t,a){if(4194048&a){var n=t.lanes;a|=n&=e.pendingLanes,t.lanes=a,Ie(e,a)}}var go={readContext:Fs,use:pi,useCallback:ei,useContext:ei,useEffect:ei,useImperativeHandle:ei,useLayoutEffect:ei,useInsertionEffect:ei,useMemo:ei,useReducer:ei,useRef:ei,useState:ei,useDebugValue:ei,useDeferredValue:ei,useTransition:ei,useSyncExternalStore:ei,useId:ei,useHostTransitionStatus:ei,useFormState:ei,useActionState:ei,useOptimistic:ei,useMemoCache:ei,useCacheRefresh:ei};go.useEffectEvent=ei;var bo={readContext:Fs,use:pi,useCallback:function(e,t){return ci().memoizedState=[e,void 0===t?null:t],e},useContext:Fs,useEffect:Ui,useImperativeHandle:function(e,t,a){a=null!=a?a.concat([e]):null,Vi(4194308,4,qi.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Vi(4194308,4,e,t)},useInsertionEffect:function(e,t){Vi(4,2,e,t)},useMemo:function(e,t){var a=ci();t=void 0===t?null:t;var n=e();if(Xr){be(!0);try{e()}finally{be(!1)}}return a.memoizedState=[n,t],n},useReducer:function(e,t,a){var n=ci();if(void 0!==a){var s=a(t);if(Xr){be(!0);try{a(t)}finally{be(!1)}}}else s=t;return n.memoizedState=n.baseState=s,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},n.queue=e,e=e.dispatch=co.bind(null,Wr,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},ci().memoizedState=e},useState:function(e){var t=(e=Mi(e)).queue,a=uo.bind(null,Wr,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:Xi,useDeferredValue:function(e,t){return Qi(ci(),e,t)},useTransition:function(){var e=Mi(!1);return e=eo.bind(null,Wr,e.queue,!0,!1),ci().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var s=Wr,r=ci();if(ms){if(void 0===a)throw Error(n(407));a=a()}else{if(a=t(),null===yc)throw Error(n(349));127&bc||vi(s,t,a)}r.memoizedState=a;var i={value:a,getSnapshot:t};return r.queue=i,Ui(wi.bind(null,s,i,e),[e]),s.flags|=2048,Bi(9,{destroy:void 0},xi.bind(null,s,i,a,t),null),a},useId:function(){var e=ci(),t=yc.identifierPrefix;if(ms){var a=rs;t="_"+t+"R_"+(a=(ss&~(1<<32-ve(ss)-1)).toString(32)+a),0<(a=Yr++)&&(t+="H"+a.toString(32)),t+="_"}else t="_"+t+"r_"+(a=Jr++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:ro,useFormState:Ii,useActionState:Ii,useOptimistic:function(e){var t=ci();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=mo.bind(null,Wr,!0,a),a.dispatch=t,[e,t]},useMemoCache:mi,useCacheRefresh:function(){return ci().memoizedState=lo.bind(null,Wr)},useEffectEvent:function(e){var t=ci(),a={impl:e};return t.memoizedState=a,function(){if(2&fc)throw Error(n(440));return a.impl.apply(void 0,arguments)}}},vo={readContext:Fs,use:pi,useCallback:Yi,useContext:Fs,useEffect:Gi,useImperativeHandle:$i,useInsertionEffect:Hi,useLayoutEffect:Ki,useMemo:Zi,useReducer:fi,useRef:Li,useState:function(){return fi(hi)},useDebugValue:Xi,useDeferredValue:function(e,t){return Ji(ui(),Hr.memoizedState,e,t)},useTransition:function(){var e=fi(hi)[0],t=ui().memoizedState;return["boolean"==typeof e?e:di(e),t]},useSyncExternalStore:bi,useId:io,useHostTransitionStatus:ro,useFormState:Fi,useActionState:Fi,useOptimistic:function(e,t){return Ni(ui(),0,e,t)},useMemoCache:mi,useCacheRefresh:oo};vo.useEffectEvent=Wi;var xo={readContext:Fs,use:pi,useCallback:Yi,useContext:Fs,useEffect:Gi,useImperativeHandle:$i,useInsertionEffect:Hi,useLayoutEffect:Ki,useMemo:Zi,useReducer:gi,useRef:Li,useState:function(){return gi(hi)},useDebugValue:Xi,useDeferredValue:function(e,t){var a=ui();return null===Hr?Qi(a,e,t):Ji(a,Hr.memoizedState,e,t)},useTransition:function(){var e=gi(hi)[0],t=ui().memoizedState;return["boolean"==typeof e?e:di(e),t]},useSyncExternalStore:bi,useId:io,useHostTransitionStatus:ro,useFormState:ji,useActionState:ji,useOptimistic:function(e,t){var a=ui();return null!==Hr?Ni(a,0,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:mi,useCacheRefresh:oo};function wo(e,t,a,n){a=null==(a=a(n,t=e.memoizedState))?t:p({},t,a),e.memoizedState=a,0===e.lanes&&(e.updateQueue.baseState=a)}xo.useEffectEvent=Wi;var ko={enqueueSetState:function(e,t,a){e=e._reactInternals;var n=$c(),s=xr(n);s.payload=t,null!=a&&(s.callback=a),null!==(t=wr(e,s,n))&&(Yc(t,e,n),kr(t,e,n))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=$c(),s=xr(n);s.tag=1,s.payload=t,null!=a&&(s.callback=a),null!==(t=wr(e,s,n))&&(Yc(t,e,n),kr(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=$c(),n=xr(a);n.tag=2,null!=t&&(n.callback=t),null!==(t=wr(e,n,a))&&(Yc(t,e,a),kr(t,e,a))}};function So(e,t,a,n,s,r,i){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,r,i):!t.prototype||!t.prototype.isPureReactComponent||(!en(a,n)||!en(s,r))}function Mo(e,t,a,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(a,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&ko.enqueueReplaceState(t,t.state,null)}function No(e,t){var a=t;if("ref"in t)for(var n in a={},t)"ref"!==n&&(a[n]=t[n]);if(e=e.defaultProps)for(var s in a===t&&(a=p({},a)),e)void 0===a[s]&&(a[s]=e[s]);return a}function Co(e){En(e)}function Po(e){}function Eo(e){En(e)}function _o(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(a){setTimeout(function(){throw a})}}function To(e,t,a){try{(0,e.onCaughtError)(a.value,{componentStack:a.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(n){setTimeout(function(){throw n})}}function Ao(e,t,a){return(a=xr(a)).tag=3,a.payload={element:null},a.callback=function(){_o(e,t)},a}function Oo(e){return(e=xr(e)).tag=3,e}function Io(e,t,a,n){var s=a.type.getDerivedStateFromError;if("function"==typeof s){var r=n.value;e.payload=function(){return s(r)},e.callback=function(){To(t,a,n)}}var i=a.stateNode;null!==i&&"function"==typeof i.componentDidCatch&&(e.callback=function(){To(t,a,n),"function"!=typeof s&&(null===Bc?Bc=new Set([this]):Bc.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})})}var Fo=Error(n(461)),Do=!1;function Ro(e,t,a,n){t.child=null===e?yr(t,null,a,n):fr(t,e.child,a,n)}function jo(e,t,a,n,s){a=a.render;var r=t.ref;if("ref"in n){var i={};for(var o in n)"ref"!==o&&(i[o]=n[o])}else i=n;return Is(t),n=ai(e,t,a,i,r,s),o=ii(),null===e||Do?(ms&&o&&ls(t),t.flags|=1,Ro(e,t,n,s),t.child):(oi(e,t,s),il(e,t,s))}function Bo(e,t,a,n,s){if(null===e){var r=a.type;return"function"!=typeof r||zn(r)||void 0!==r.defaultProps||null!==a.compare?((e=Wn(a.type,null,n,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Lo(e,t,r,n,s))}if(r=e.child,!ol(e,s)){var i=r.memoizedProps;if((a=null!==(a=a.compare)?a:en)(i,n)&&e.ref===t.ref)return il(e,t,s)}return t.flags|=1,(e=Un(r,n)).ref=t.ref,e.return=t,t.child=e}function Lo(e,t,a,n,s){if(null!==e){var r=e.memoizedProps;if(en(r,n)&&e.ref===t.ref){if(Do=!1,t.pendingProps=n=r,!ol(e,s))return t.lanes=e.lanes,il(e,t,s);131072&e.flags&&(Do=!0)}}return Ko(e,t,a,n,s)}function Vo(e,t,a,n){var s=n.children,r=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===n.mode){if(128&t.flags){if(r=null!==r?r.baseLanes|a:a,null!==e){for(n=t.child=e.child,s=0;null!==n;)s=s|n.lanes|n.childLanes,n=n.sibling;n=s&~r}else n=0,t.child=null;return Uo(e,t,r,a,n)}if(!(536870912&a))return n=t.lanes=536870912,Uo(e,t,null!==r?r.baseLanes|a:a,a,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Zs(0,null!==r?r.cachePool:null),null!==r?Ar(t,r):Or(),Br(t)}else null!==r?(Zs(0,r.cachePool),Ar(t,r),Lr(),t.memoizedState=null):(null!==e&&Zs(0,null),Or(),Lr());return Ro(e,t,s,a),t.child}function zo(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Uo(e,t,a,n,s){var r=Ys();return r=null===r?null:{parent:Vs._currentValue,pool:r},t.memoizedState={baseLanes:a,cachePool:r},null!==e&&Zs(0,null),Or(),Br(t),null!==e&&As(e,t,n,!0),t.childLanes=s,null}function Go(e,t){return(t=tl({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Wo(e,t,a){return fr(t,e.child,null,a),(e=Go(t,t.pendingProps)).flags|=2,Vr(t),t.memoizedState=null,e}function Ho(e,t){var a=t.ref;if(null===a)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof a&&"object"!=typeof a)throw Error(n(284));null!==e&&e.ref===a||(t.flags|=4194816)}}function Ko(e,t,a,n,s){return Is(t),a=ai(e,t,a,n,void 0,s),n=ii(),null===e||Do?(ms&&n&&ls(t),t.flags|=1,Ro(e,t,a,s),t.child):(oi(e,t,s),il(e,t,s))}function qo(e,t,a,n,s,r){return Is(t),t.updateQueue=null,a=si(t,n,a,s),ni(e),n=ii(),null===e||Do?(ms&&n&&ls(t),t.flags|=1,Ro(e,t,a,r),t.child):(oi(e,t,r),il(e,t,r))}function $o(e,t,a,n,s){if(Is(t),null===t.stateNode){var r=Bn,i=a.contextType;"object"==typeof i&&null!==i&&(r=Fs(i)),r=new a(n,r),t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,r.updater=ko,t.stateNode=r,r._reactInternals=t,(r=t.stateNode).props=n,r.state=t.memoizedState,r.refs={},br(t),i=a.contextType,r.context="object"==typeof i&&null!==i?Fs(i):Bn,r.state=t.memoizedState,"function"==typeof(i=a.getDerivedStateFromProps)&&(wo(t,a,i,n),r.state=t.memoizedState),"function"==typeof a.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(i=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),i!==r.state&&ko.enqueueReplaceState(r,r.state,null),Cr(t,n,r,s),Nr(),r.state=t.memoizedState),"function"==typeof r.componentDidMount&&(t.flags|=4194308),n=!0}else if(null===e){r=t.stateNode;var o=t.memoizedProps,l=No(a,o);r.props=l;var c=r.context,u=a.contextType;i=Bn,"object"==typeof u&&null!==u&&(i=Fs(u));var d=a.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof r.getSnapshotBeforeUpdate,o=t.pendingProps!==o,u||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(o||c!==i)&&Mo(t,r,n,i),gr=!1;var p=t.memoizedState;r.state=p,Cr(t,n,r,s),Nr(),c=t.memoizedState,o||p!==c||gr?("function"==typeof d&&(wo(t,a,d,n),c=t.memoizedState),(l=gr||So(t,a,l,n,p,c,i))?(u||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.flags|=4194308)):("function"==typeof r.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),r.props=n,r.state=c,r.context=i,n=l):("function"==typeof r.componentDidMount&&(t.flags|=4194308),n=!1)}else{r=t.stateNode,vr(e,t),u=No(a,i=t.memoizedProps),r.props=u,d=t.pendingProps,p=r.context,c=a.contextType,l=Bn,"object"==typeof c&&null!==c&&(l=Fs(c)),(c="function"==typeof(o=a.getDerivedStateFromProps)||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(i!==d||p!==l)&&Mo(t,r,n,l),gr=!1,p=t.memoizedState,r.state=p,Cr(t,n,r,s),Nr();var m=t.memoizedState;i!==d||p!==m||gr||null!==e&&null!==e.dependencies&&Os(e.dependencies)?("function"==typeof o&&(wo(t,a,o,n),m=t.memoizedState),(u=gr||So(t,a,u,n,p,m,l)||null!==e&&null!==e.dependencies&&Os(e.dependencies))?(c||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(n,m,l),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(n,m,l)),"function"==typeof r.componentDidUpdate&&(t.flags|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof r.componentDidUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=m),r.props=n,r.state=m,r.context=l,n=u):("function"!=typeof r.componentDidUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof r.getSnapshotBeforeUpdate||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),n=!1)}return r=n,Ho(e,t),n=!!(128&t.flags),r||n?(r=t.stateNode,a=n&&"function"!=typeof a.getDerivedStateFromError?null:r.render(),t.flags|=1,null!==e&&n?(t.child=fr(t,e.child,null,s),t.child=fr(t,null,a,s)):Ro(e,t,a,s),t.memoizedState=r.state,e=t.child):e=il(e,t,s),e}function Xo(e,t,a,n){return ws(),t.flags|=256,Ro(e,t,a,n),t.child}var Yo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zo(e){return{baseLanes:e,cachePool:Qs()}}function Qo(e,t,a){return e=null!==e?e.childLanes&~a:0,t&&(e|=_c),e}function Jo(e,t,a){var s,r=t.pendingProps,i=!1,o=!!(128&t.flags);if((s=o)||(s=(null===e||null!==e.memoizedState)&&!!(2&zr.current)),s&&(i=!0,t.flags&=-129),s=!!(32&t.flags),t.flags&=-33,null===e){if(ms){if(i?Rr(t):Lr(),(e=ps)?null!==(e=null!==(e=Od(e,fs))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ns?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(a=qn(e)).return=t,t.child=a,ds=t,ps=null):e=null,null===e)throw gs(t);return Fd(e)?t.lanes=32:t.lanes=536870912,null}var l=r.children;return r=r.fallback,i?(Lr(),l=tl({mode:"hidden",children:l},i=t.mode),r=Hn(r,i,a,null),l.return=t,r.return=t,l.sibling=r,t.child=l,(r=t.child).memoizedState=Zo(a),r.childLanes=Qo(e,s,a),t.memoizedState=Yo,zo(null,r)):(Rr(t),el(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(o)256&t.flags?(Rr(t),t.flags&=-257,t=al(e,t,a)):null!==t.memoizedState?(Lr(),t.child=e.child,t.flags|=128,t=null):(Lr(),l=r.fallback,i=t.mode,r=tl({mode:"visible",children:r.children},i),(l=Hn(l,i,a,null)).flags|=2,r.return=t,l.return=t,r.sibling=l,t.child=r,fr(t,e.child,null,a),(r=t.child).memoizedState=Zo(a),r.childLanes=Qo(e,s,a),t.memoizedState=Yo,t=zo(null,r));else if(Rr(t),Fd(l)){if(s=l.nextSibling&&l.nextSibling.dataset)var u=s.dgst;s=u,(r=Error(n(419))).stack="",r.digest=s,Ss({value:r,source:null,stack:null}),t=al(e,t,a)}else if(Do||As(e,t,a,!1),s=0!==(a&e.childLanes),Do||s){if(null!==(s=yc)&&(0!==(r=Fe(s,a))&&r!==c.retryLane))throw c.retryLane=r,Dn(e,r),Yc(s,e,r),Fo;Id(l)||lu(),t=al(e,t,a)}else Id(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ps=Dd(l.nextSibling),ds=t,ms=!0,hs=null,fs=!1,null!==e&&us(t,e),(t=el(t,r.children)).flags|=4096);return t}return i?(Lr(),l=r.fallback,i=t.mode,u=(c=e.child).sibling,(r=Un(c,{mode:"hidden",children:r.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=Un(u,l):(l=Hn(l,i,a,null)).flags|=2,l.return=t,r.return=t,r.sibling=l,t.child=r,zo(null,r),r=t.child,null===(l=e.child.memoizedState)?l=Zo(a):(null!==(i=l.cachePool)?(c=Vs._currentValue,i=i.parent!==c?{parent:c,pool:c}:i):i=Qs(),l={baseLanes:l.baseLanes|a,cachePool:i}),r.memoizedState=l,r.childLanes=Qo(e,s,a),t.memoizedState=Yo,zo(e.child,r)):(Rr(t),e=(a=e.child).sibling,(a=Un(a,{mode:"visible",children:r.children})).return=t,a.sibling=null,null!==e&&(null===(s=t.deletions)?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=a,t.memoizedState=null,a)}function el(e,t){return(t=tl({mode:"visible",children:t},e.mode)).return=e,e.child=t}function tl(e,t){return(e=Vn(22,e,null,t)).lanes=0,e}function al(e,t,a){return fr(t,e.child,null,a),(e=el(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function nl(e,t,a){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),_s(e.return,t,a)}function sl(e,t,a,n,s,r){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:s,treeForkCount:r}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=a,i.tailMode=s,i.treeForkCount=r)}function rl(e,t,a){var n=t.pendingProps,s=n.revealOrder,r=n.tail;n=n.children;var i=zr.current,o=!!(2&i);if(o?(i=1&i|2,t.flags|=128):i&=1,V(zr,i),Ro(e,t,n,a),n=ms?es:0,!o&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&nl(e,a,t);else if(19===e.tag)nl(e,a,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(s){case"forwards":for(a=t.child,s=null;null!==a;)null!==(e=a.alternate)&&null===Ur(e)&&(s=a),a=a.sibling;null===(a=s)?(s=t.child,t.child=null):(s=a.sibling,a.sibling=null),sl(t,!1,s,a,r,n);break;case"backwards":case"unstable_legacy-backwards":for(a=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===Ur(e)){t.child=s;break}e=s.sibling,s.sibling=a,a=s,s=e}sl(t,!0,a,null,r,n);break;case"together":sl(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function il(e,t,a){if(null!==e&&(t.dependencies=e.dependencies),Cc|=t.lanes,0===(a&t.childLanes)){if(null===e)return null;if(As(e,t,a,!1),0===(a&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(n(153));if(null!==t.child){for(a=Un(e=t.child,e.pendingProps),t.child=a,a.return=t;null!==e.sibling;)e=e.sibling,(a=a.sibling=Un(e,e.pendingProps)).return=t;a.sibling=null}return t.child}function ol(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Os(e))}function ll(e,t,a){if(null!==e)if(e.memoizedProps!==t.pendingProps)Do=!0;else{if(!(ol(e,a)||128&t.flags))return Do=!1,function(e,t,a){switch(t.tag){case 3:q(t,t.stateNode.containerInfo),Ps(0,Vs,e.memoizedState.cache),ws();break;case 27:case 5:X(t);break;case 4:q(t,t.stateNode.containerInfo);break;case 10:Ps(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,jr(t),null;break;case 13:var n=t.memoizedState;if(null!==n)return null!==n.dehydrated?(Rr(t),t.flags|=128,null):0!==(a&t.child.childLanes)?Jo(e,t,a):(Rr(t),null!==(e=il(e,t,a))?e.sibling:null);Rr(t);break;case 19:var s=!!(128&e.flags);if((n=0!==(a&t.childLanes))||(As(e,t,a,!1),n=0!==(a&t.childLanes)),s){if(n)return rl(e,t,a);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),V(zr,zr.current),n)break;return null;case 22:return t.lanes=0,Vo(e,t,a,t.pendingProps);case 24:Ps(0,Vs,e.memoizedState.cache)}return il(e,t,a)}(e,t,a);Do=!!(131072&e.flags)}else Do=!1,ms&&1048576&t.flags&&os(t,es,t.index);switch(t.lanes=0,t.tag){case 16:e:{var s=t.pendingProps;if(e=rr(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var r=e.$$typeof;if(r===w){t.tag=11,t=jo(null,t,e,s,a);break e}if(r===M){t.tag=14,t=Bo(null,t,e,s,a);break e}}throw t=A(e)||e,Error(n(306,t,""))}zn(e)?(s=No(e,s),t.tag=1,t=$o(null,t,e,s,a)):(t.tag=0,t=Ko(null,t,e,s,a))}return t;case 0:return Ko(e,t,t.type,t.pendingProps,a);case 1:return $o(e,t,s=t.type,r=No(s,t.pendingProps),a);case 3:e:{if(q(t,t.stateNode.containerInfo),null===e)throw Error(n(387));s=t.pendingProps;var i=t.memoizedState;r=i.element,vr(e,t),Cr(t,s,null,a);var o=t.memoizedState;if(s=o.cache,Ps(0,Vs,s),s!==i.cache&&Ts(t,[Vs],a,!0),Nr(),s=o.element,i.isDehydrated){if(i={element:s,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Xo(e,t,s,a);break e}if(s!==r){Ss(r=Yn(Error(n(424)),t)),t=Xo(e,t,s,a);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ps=Dd(e.firstChild),ds=t,ms=!0,hs=null,fs=!0,a=yr(t,null,s,a),t.child=a;a;)a.flags=-3&a.flags|4096,a=a.sibling}else{if(ws(),s===r){t=il(e,t,a);break e}Ro(e,t,s,a)}t=t.child}return t;case 26:return Ho(e,t),null===e?(a=qd(t.type,null,t.pendingProps,null))?t.memoizedState=a:ms||(a=t.type,e=t.pendingProps,(s=bd(H.current).createElement(a))[Ve]=t,s[ze]=e,hd(s,a,e),Je(s),t.stateNode=s):t.memoizedState=qd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&ms&&(s=t.stateNode=Ld(t.type,t.pendingProps,H.current),ds=t,fs=!0,r=ps,Ed(t.type)?(Rd=r,ps=Dd(s.firstChild)):ps=r),Ro(e,t,t.pendingProps.children,a),Ho(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&ms&&((r=s=ps)&&(null!==(s=function(e,t,a,n){for(;1===e.nodeType;){var s=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(n){if(!e[qe])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(r=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(r!==s.rel||e.getAttribute("href")!==(null==s.href||""===s.href?null:s.href)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin)||e.getAttribute("title")!==(null==s.title?null:s.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((r=e.getAttribute("src"))!==(null==s.src?null:s.src)||e.getAttribute("type")!==(null==s.type?null:s.type)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin))&&r&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var r=null==s.name?null:""+s.name;if("hidden"===s.type&&e.getAttribute("name")===r)return e}if(null===(e=Dd(e.nextSibling)))break}return null}(s,t.type,t.pendingProps,fs))?(t.stateNode=s,ds=t,ps=Dd(s.firstChild),fs=!1,r=!0):r=!1),r||gs(t)),X(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,wd(r,i)?s=null:null!==o&&wd(r,o)&&(t.flags|=32),null!==t.memoizedState&&(r=ai(e,t,ri,null,null,a),pp._currentValue=r),Ho(e,t),Ro(e,t,s,a),t.child;case 6:return null===e&&ms&&((e=a=ps)&&(null!==(a=function(e,t,a){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!a)return null;if(null===(e=Dd(e.nextSibling)))return null}return e}(a,t.pendingProps,fs))?(t.stateNode=a,ds=t,ps=null,e=!0):e=!1),e||gs(t)),null;case 13:return Jo(e,t,a);case 4:return q(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=fr(t,null,s,a):Ro(e,t,s,a),t.child;case 11:return jo(e,t,t.type,t.pendingProps,a);case 7:return Ro(e,t,t.pendingProps,a),t.child;case 8:case 12:return Ro(e,t,t.pendingProps.children,a),t.child;case 10:return s=t.pendingProps,Ps(0,t.type,s.value),Ro(e,t,s.children,a),t.child;case 9:return r=t.type._context,s=t.pendingProps.children,Is(t),s=s(r=Fs(r)),t.flags|=1,Ro(e,t,s,a),t.child;case 14:return Bo(e,t,t.type,t.pendingProps,a);case 15:return Lo(e,t,t.type,t.pendingProps,a);case 19:return rl(e,t,a);case 31:return function(e,t,a){var s=t.pendingProps,r=!!(128&t.flags);if(t.flags&=-129,null===e){if(ms){if("hidden"===s.mode)return e=Go(t,s),t.lanes=536870912,zo(null,e);if(jr(t),(e=ps)?null!==(e=null!==(e=Od(e,fs))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ns?{id:ss,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},(a=qn(e)).return=t,t.child=a,ds=t,ps=null):e=null,null===e)throw gs(t);return t.lanes=536870912,null}return Go(t,s)}var i=e.memoizedState;if(null!==i){var o=i.dehydrated;if(jr(t),r)if(256&t.flags)t.flags&=-257,t=Wo(e,t,a);else{if(null===t.memoizedState)throw Error(n(558));t.child=e.child,t.flags|=128,t=null}else if(Do||As(e,t,a,!1),r=0!==(a&e.childLanes),Do||r){if(null!==(s=yc)&&0!==(o=Fe(s,a))&&o!==i.retryLane)throw i.retryLane=o,Dn(e,o),Yc(s,e,o),Fo;lu(),t=Wo(e,t,a)}else e=i.treeContext,ps=Dd(o.nextSibling),ds=t,ms=!0,hs=null,fs=!1,null!==e&&us(t,e),(t=Go(t,s)).flags|=4096;return t}return(e=Un(e.child,{mode:s.mode,children:s.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,a);case 22:return Vo(e,t,a,t.pendingProps);case 24:return Is(t),s=Fs(Vs),null===e?(null===(r=Ys())&&(r=yc,i=zs(),r.pooledCache=i,i.refCount++,null!==i&&(r.pooledCacheLanes|=a),r=i),t.memoizedState={parent:s,cache:r},br(t),Ps(0,Vs,r)):(0!==(e.lanes&a)&&(vr(e,t),Cr(t,null,null,a),Nr()),r=e.memoizedState,i=t.memoizedState,r.parent!==s?(r={parent:s,cache:s},t.memoizedState=r,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=r),Ps(0,Vs,s)):(s=i.cache,Ps(0,Vs,s),s!==r.cache&&Ts(t,[Vs],a,!0))),Ro(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(n(156,t.tag))}function cl(e){e.flags|=4}function ul(e,t,a,n,s){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&s)===s)if(e.stateNode.complete)e.flags|=8192;else{if(!ru())throw ir=ar,er;e.flags|=8192}}else e.flags&=-16777217}function dl(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!ip(t)){if(!ru())throw ir=ar,er;e.flags|=8192}}function pl(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?_e():536870912,e.lanes|=t,Tc|=t)}function ml(e,t){if(!ms)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;null!==t;)null!==t.alternate&&(a=t),t=t.sibling;null===a?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;null!==a;)null!==a.alternate&&(n=a),a=a.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function hl(e){var t=null!==e.alternate&&e.alternate.child===e.child,a=0,n=0;if(t)for(var s=e.child;null!==s;)a|=s.lanes|s.childLanes,n|=65011712&s.subtreeFlags,n|=65011712&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)a|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function fl(e,t,a){var s=t.pendingProps;switch(cs(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return hl(t),null;case 3:return a=t.stateNode,s=null,null!==e&&(s=e.memoizedState.cache),t.memoizedState.cache!==s&&(t.flags|=2048),Es(Vs),$(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),null!==e&&null!==e.child||(xs(t)?cl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,ks())),hl(t),null;case 26:var r=t.type,i=t.memoizedState;return null===e?(cl(t),null!==i?(hl(t),dl(t,i)):(hl(t),ul(t,r,0,0,a))):i?i!==e.memoizedState?(cl(t),hl(t),dl(t,i)):(hl(t),t.flags&=-16777217):((e=e.memoizedProps)!==s&&cl(t),hl(t),ul(t,r,0,0,a)),null;case 27:if(Y(t),a=H.current,r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(n(166));return hl(t),null}e=G.current,xs(t)?bs(t):(e=Ld(r,s,a),t.stateNode=e,cl(t))}return hl(t),null;case 5:if(Y(t),r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if(!s){if(null===t.stateNode)throw Error(n(166));return hl(t),null}if(i=G.current,xs(t))bs(t);else{var o=bd(H.current);switch(i){case 1:i=o.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:i=o.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":i=o.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":i=o.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":(i=o.createElement("div")).innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i="string"==typeof s.is?o.createElement("select",{is:s.is}):o.createElement("select"),s.multiple?i.multiple=!0:s.size&&(i.size=s.size);break;default:i="string"==typeof s.is?o.createElement(r,{is:s.is}):o.createElement(r)}}i[Ve]=t,i[ze]=s;e:for(o=t.child;null!==o;){if(5===o.tag||6===o.tag)i.appendChild(o.stateNode);else if(4!==o.tag&&27!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;null===o.sibling;){if(null===o.return||o.return===t)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.stateNode=i;e:switch(hd(i,r,s),r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&cl(t)}}return hl(t),ul(t,t.type,null===e||e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==s&&cl(t);else{if("string"!=typeof s&&null===t.stateNode)throw Error(n(166));if(e=H.current,xs(t)){if(e=t.stateNode,a=t.memoizedProps,s=null,null!==(r=ds))switch(r.tag){case 27:case 5:s=r.memoizedProps}e[Ve]=t,(e=!!(e.nodeValue===a||null!==s&&!0===s.suppressHydrationWarning||dd(e.nodeValue,a)))||gs(t,!0)}else(e=bd(e).createTextNode(s))[Ve]=t,t.stateNode=e}return hl(t),null;case 31:if(a=t.memoizedState,null===e||null!==e.memoizedState){if(s=xs(t),null!==a){if(null===e){if(!s)throw Error(n(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(n(557));e[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;hl(t),e=!1}else a=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return 256&t.flags?(Vr(t),t):(Vr(t),null);if(128&t.flags)throw Error(n(558))}return hl(t),null;case 13:if(s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(r=xs(t),null!==s&&null!==s.dehydrated){if(null===e){if(!r)throw Error(n(318));if(!(r=null!==(r=t.memoizedState)?r.dehydrated:null))throw Error(n(317));r[Ve]=t}else ws(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;hl(t),r=!1}else r=ks(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),r=!0;if(!r)return 256&t.flags?(Vr(t),t):(Vr(t),null)}return Vr(t),128&t.flags?(t.lanes=a,t):(a=null!==s,e=null!==e&&null!==e.memoizedState,a&&(r=null,null!==(s=t.child).alternate&&null!==s.alternate.memoizedState&&null!==s.alternate.memoizedState.cachePool&&(r=s.alternate.memoizedState.cachePool.pool),i=null,null!==s.memoizedState&&null!==s.memoizedState.cachePool&&(i=s.memoizedState.cachePool.pool),i!==r&&(s.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),pl(t,t.updateQueue),hl(t),null);case 4:return $(),null===e&&td(t.stateNode.containerInfo),hl(t),null;case 10:return Es(t.type),hl(t),null;case 19:if(L(zr),null===(s=t.memoizedState))return hl(t),null;if(r=!!(128&t.flags),null===(i=s.rendering))if(r)ml(s,!1);else{if(0!==Nc||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(i=Ur(e))){for(t.flags|=128,ml(s,!1),e=i.updateQueue,t.updateQueue=e,pl(t,e),t.subtreeFlags=0,e=a,a=t.child;null!==a;)Gn(a,e),a=a.sibling;return V(zr,1&zr.current|2),ms&&is(t,s.treeForkCount),t.child}e=e.sibling}null!==s.tail&&oe()>Rc&&(t.flags|=128,r=!0,ml(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Ur(i))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,pl(t,e),ml(s,!0),null===s.tail&&"hidden"===s.tailMode&&!i.alternate&&!ms)return hl(t),null}else 2*oe()-s.renderingStartTime>Rc&&536870912!==a&&(t.flags|=128,r=!0,ml(s,!1),t.lanes=4194304);s.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=s.last)?e.sibling=i:t.child=i,s.last=i)}return null!==s.tail?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=oe(),e.sibling=null,a=zr.current,V(zr,r?1&a|2:1&a),ms&&is(t,s.treeForkCount),e):(hl(t),null);case 22:case 23:return Vr(t),Ir(),s=null!==t.memoizedState,null!==e?null!==e.memoizedState!==s&&(t.flags|=8192):s&&(t.flags|=8192),s?!!(536870912&a)&&!(128&t.flags)&&(hl(t),6&t.subtreeFlags&&(t.flags|=8192)):hl(t),null!==(a=t.updateQueue)&&pl(t,a.retryQueue),a=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(a=e.memoizedState.cachePool.pool),s=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(s=t.memoizedState.cachePool.pool),s!==a&&(t.flags|=2048),null!==e&&L(Xs),null;case 24:return a=null,null!==e&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),Es(Vs),hl(t),null;case 25:case 30:return null}throw Error(n(156,t.tag))}function yl(e,t){switch(cs(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Es(Vs),$(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Y(t),null;case 31:if(null!==t.memoizedState){if(Vr(t),null===t.alternate)throw Error(n(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Vr(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(n(340));ws()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return L(zr),null;case 4:return $(),null;case 10:return Es(t.type),null;case 22:case 23:return Vr(t),Ir(),null!==e&&L(Xs),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Es(Vs),null;default:return null}}function gl(e,t){switch(cs(t),t.tag){case 3:Es(Vs),$();break;case 26:case 27:case 5:Y(t);break;case 4:$();break;case 31:null!==t.memoizedState&&Vr(t);break;case 13:Vr(t);break;case 19:L(zr);break;case 10:Es(t.type);break;case 22:case 23:Vr(t),Ir(),null!==e&&L(Xs);break;case 24:Es(Vs)}}function bl(e,t){try{var a=t.updateQueue,n=null!==a?a.lastEffect:null;if(null!==n){var s=n.next;a=s;do{if((a.tag&e)===e){n=void 0;var r=a.create,i=a.inst;n=r(),i.destroy=n}a=a.next}while(a!==s)}}catch(o){Nu(t,t.return,o)}}function vl(e,t,a){try{var n=t.updateQueue,s=null!==n?n.lastEffect:null;if(null!==s){var r=s.next;n=r;do{if((n.tag&e)===e){var i=n.inst,o=i.destroy;if(void 0!==o){i.destroy=void 0,s=t;var l=a,c=o;try{c()}catch(u){Nu(s,l,u)}}}n=n.next}while(n!==r)}}catch(u){Nu(t,t.return,u)}}function xl(e){var t=e.updateQueue;if(null!==t){var a=e.stateNode;try{Er(t,a)}catch(n){Nu(e,e.return,n)}}}function wl(e,t,a){a.props=No(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(n){Nu(e,t,n)}}function kl(e,t){try{var a=e.ref;if(null!==a){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;default:n=e.stateNode}"function"==typeof a?e.refCleanup=a(n):a.current=n}}catch(s){Nu(e,t,s)}}function Sl(e,t){var a=e.ref,n=e.refCleanup;if(null!==a)if("function"==typeof n)try{n()}catch(s){Nu(e,t,s)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof a)try{a(null)}catch(r){Nu(e,t,r)}else a.current=null}function Ml(e){var t=e.type,a=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(s){Nu(e,e.return,s)}}function Nl(e,t,a){try{var s=e.stateNode;!function(e,t,a,s){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,i=null,o=null,l=null,c=null,u=null,d=null;for(h in a){var p=a[h];if(a.hasOwnProperty(h)&&null!=p)switch(h){case"checked":case"value":break;case"defaultValue":c=p;default:s.hasOwnProperty(h)||pd(e,t,h,null,s,p)}}for(var m in s){var h=s[m];if(p=a[m],s.hasOwnProperty(m)&&(null!=h||null!=p))switch(m){case"type":i=h;break;case"name":r=h;break;case"checked":u=h;break;case"defaultChecked":d=h;break;case"value":o=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(n(137,t));break;default:h!==p&&pd(e,t,m,h,s,p)}}return void gt(e,o,l,c,u,d,i,r);case"select":for(i in h=o=l=m=null,a)if(c=a[i],a.hasOwnProperty(i)&&null!=c)switch(i){case"value":break;case"multiple":h=c;default:s.hasOwnProperty(i)||pd(e,t,i,null,s,c)}for(r in s)if(i=s[r],c=a[r],s.hasOwnProperty(r)&&(null!=i||null!=c))switch(r){case"value":m=i;break;case"defaultValue":l=i;break;case"multiple":o=i;default:i!==c&&pd(e,t,r,i,s,c)}return t=l,a=o,s=h,void(null!=m?xt(e,!!a,m,!1):!!s!=!!a&&(null!=t?xt(e,!!a,t,!0):xt(e,!!a,a?[]:"",!1)));case"textarea":for(l in h=m=null,a)if(r=a[l],a.hasOwnProperty(l)&&null!=r&&!s.hasOwnProperty(l))switch(l){case"value":case"children":break;default:pd(e,t,l,null,s,r)}for(o in s)if(r=s[o],i=a[o],s.hasOwnProperty(o)&&(null!=r||null!=i))switch(o){case"value":m=r;break;case"defaultValue":h=r;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=r)throw Error(n(91));break;default:r!==i&&pd(e,t,o,r,s,i)}return void wt(e,m,h);case"option":for(var f in a)if(m=a[f],a.hasOwnProperty(f)&&null!=m&&!s.hasOwnProperty(f))if("selected"===f)e.selected=!1;else pd(e,t,f,null,s,m);for(c in s)if(m=s[c],h=a[c],s.hasOwnProperty(c)&&m!==h&&(null!=m||null!=h))if("selected"===c)e.selected=m&&"function"!=typeof m&&"symbol"!=typeof m;else pd(e,t,c,m,s,h);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var y in a)m=a[y],a.hasOwnProperty(y)&&null!=m&&!s.hasOwnProperty(y)&&pd(e,t,y,null,s,m);for(u in s)if(m=s[u],h=a[u],s.hasOwnProperty(u)&&m!==h&&(null!=m||null!=h))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(n(137,t));break;default:pd(e,t,u,m,s,h)}return;default:if(Pt(t)){for(var g in a)m=a[g],a.hasOwnProperty(g)&&void 0!==m&&!s.hasOwnProperty(g)&&md(e,t,g,void 0,s,m);for(d in s)m=s[d],h=a[d],!s.hasOwnProperty(d)||m===h||void 0===m&&void 0===h||md(e,t,d,m,s,h);return}}for(var b in a)m=a[b],a.hasOwnProperty(b)&&null!=m&&!s.hasOwnProperty(b)&&pd(e,t,b,null,s,m);for(p in s)m=s[p],h=a[p],!s.hasOwnProperty(p)||m===h||null==m&&null==h||pd(e,t,p,m,s,h)}(s,e.type,a,t),s[ze]=t}catch(r){Nu(e,e.return,r)}}function Cl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Ed(e.type)||4===e.tag}function Pl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Ed(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function El(e,t,a){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?(9===a.nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).insertBefore(e,t):((t=9===a.nodeType?a.body:"HTML"===a.nodeName?a.ownerDocument.body:a).appendChild(e),null!=(a=a._reactRootContainer)||null!==t.onclick||(t.onclick=At));else if(4!==n&&(27===n&&Ed(e.type)&&(a=e.stateNode,t=null),null!==(e=e.child)))for(El(e,t,a),e=e.sibling;null!==e;)El(e,t,a),e=e.sibling}function _l(e,t,a){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(4!==n&&(27===n&&Ed(e.type)&&(a=e.stateNode),null!==(e=e.child)))for(_l(e,t,a),e=e.sibling;null!==e;)_l(e,t,a),e=e.sibling}function Tl(e){var t=e.stateNode,a=e.memoizedProps;try{for(var n=e.type,s=t.attributes;s.length;)t.removeAttributeNode(s[0]);hd(t,n,a),t[Ve]=e,t[ze]=a}catch(r){Nu(e,e.return,r)}}var Al=!1,Ol=!1,Il=!1,Fl="function"==typeof WeakSet?WeakSet:Set,Dl=null;function Rl(e,t,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:Yl(e,a),4&n&&bl(5,a);break;case 1:if(Yl(e,a),4&n)if(e=a.stateNode,null===t)try{e.componentDidMount()}catch(i){Nu(a,a.return,i)}else{var s=No(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(s,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){Nu(a,a.return,o)}}64&n&&xl(a),512&n&&kl(a,a.return);break;case 3:if(Yl(e,a),64&n&&null!==(e=a.updateQueue)){if(t=null,null!==a.child)switch(a.child.tag){case 27:case 5:case 1:t=a.child.stateNode}try{Er(e,t)}catch(i){Nu(a,a.return,i)}}break;case 27:null===t&&4&n&&Tl(a);case 26:case 5:Yl(e,a),null===t&&4&n&&Ml(a),512&n&&kl(a,a.return);break;case 12:Yl(e,a);break;case 31:Yl(e,a),4&n&&Ul(e,a);break;case 13:Yl(e,a),4&n&&Gl(e,a),64&n&&(null!==(e=a.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var a=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==a.readyState)t();else{var n=function(){t(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}(e,a=_u.bind(null,a))));break;case 22:if(!(n=null!==a.memoizedState||Al)){t=null!==t&&null!==t.memoizedState||Ol,s=Al;var r=Ol;Al=n,(Ol=t)&&!r?Ql(e,a,!!(8772&a.subtreeFlags)):Yl(e,a),Al=s,Ol=r}break;case 30:break;default:Yl(e,a)}}function jl(e){var t=e.alternate;null!==t&&(e.alternate=null,jl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&$e(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Bl=null,Ll=!1;function Vl(e,t,a){for(a=a.child;null!==a;)zl(e,t,a),a=a.sibling}function zl(e,t,a){if(ge&&"function"==typeof ge.onCommitFiberUnmount)try{ge.onCommitFiberUnmount(ye,a)}catch(r){}switch(a.tag){case 26:Ol||Sl(a,t),Vl(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode).parentNode.removeChild(a);break;case 27:Ol||Sl(a,t);var n=Bl,s=Ll;Ed(a.type)&&(Bl=a.stateNode,Ll=!1),Vl(e,t,a),Vd(a.stateNode),Bl=n,Ll=s;break;case 5:Ol||Sl(a,t);case 6:if(n=Bl,s=Ll,Bl=null,Vl(e,t,a),Ll=s,null!==(Bl=n))if(Ll)try{(9===Bl.nodeType?Bl.body:"HTML"===Bl.nodeName?Bl.ownerDocument.body:Bl).removeChild(a.stateNode)}catch(i){Nu(a,t,i)}else try{Bl.removeChild(a.stateNode)}catch(i){Nu(a,t,i)}break;case 18:null!==Bl&&(Ll?(_d(9===(e=Bl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,a.stateNode),Kp(e)):_d(Bl,a.stateNode));break;case 4:n=Bl,s=Ll,Bl=a.stateNode.containerInfo,Ll=!0,Vl(e,t,a),Bl=n,Ll=s;break;case 0:case 11:case 14:case 15:vl(2,a,t),Ol||vl(4,a,t),Vl(e,t,a);break;case 1:Ol||(Sl(a,t),"function"==typeof(n=a.stateNode).componentWillUnmount&&wl(a,t,n)),Vl(e,t,a);break;case 21:Vl(e,t,a);break;case 22:Ol=(n=Ol)||null!==a.memoizedState,Vl(e,t,a),Ol=n;break;default:Vl(e,t,a)}}function Ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Kp(e)}catch(a){Nu(t,t.return,a)}}}function Gl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Kp(e)}catch(a){Nu(t,t.return,a)}}function Wl(e,t){var a=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Fl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Fl),t;default:throw Error(n(435,e.tag))}}(e);t.forEach(function(t){if(!a.has(t)){a.add(t);var n=Tu.bind(null,e,t);t.then(n,n)}})}function Hl(e,t){var a=t.deletions;if(null!==a)for(var s=0;s<a.length;s++){var r=a[s],i=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:if(Ed(l.type)){Bl=l.stateNode,Ll=!1;break e}break;case 5:Bl=l.stateNode,Ll=!1;break e;case 3:case 4:Bl=l.stateNode.containerInfo,Ll=!0;break e}l=l.return}if(null===Bl)throw Error(n(160));zl(i,o,r),Bl=null,Ll=!1,null!==(i=r.alternate)&&(i.return=null),r.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)ql(t,e),t=t.sibling}var Kl=null;function ql(e,t){var a=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Hl(t,e),$l(e),4&s&&(vl(3,e,e.return),bl(3,e),vl(5,e,e.return));break;case 1:Hl(t,e),$l(e),512&s&&(Ol||null===a||Sl(a,a.return)),64&s&&Al&&(null!==(e=e.updateQueue)&&(null!==(s=e.callbacks)&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===a?s:a.concat(s))));break;case 26:var r=Kl;if(Hl(t,e),$l(e),512&s&&(Ol||null===a||Sl(a,a.return)),4&s){var i=null!==a?a.memoizedState:null;if(s=e.memoizedState,null===a)if(null===s)if(null===e.stateNode){e:{s=e.type,a=e.memoizedProps,r=r.ownerDocument||r;t:switch(s){case"title":(!(i=r.getElementsByTagName("title")[0])||i[qe]||i[Ve]||"http://www.w3.org/2000/svg"===i.namespaceURI||i.hasAttribute("itemprop"))&&(i=r.createElement(s),r.head.insertBefore(i,r.querySelector("head > title"))),hd(i,s,a),i[Ve]=e,Je(i),s=i;break e;case"link":var o=sp("link","href",r).get(s+(a.href||""));if(o)for(var l=0;l<o.length;l++)if((i=o[l]).getAttribute("href")===(null==a.href||""===a.href?null:a.href)&&i.getAttribute("rel")===(null==a.rel?null:a.rel)&&i.getAttribute("title")===(null==a.title?null:a.title)&&i.getAttribute("crossorigin")===(null==a.crossOrigin?null:a.crossOrigin)){o.splice(l,1);break t}hd(i=r.createElement(s),s,a),r.head.appendChild(i);break;case"meta":if(o=sp("meta","content",r).get(s+(a.content||"")))for(l=0;l<o.length;l++)if((i=o[l]).getAttribute("content")===(null==a.content?null:""+a.content)&&i.getAttribute("name")===(null==a.name?null:a.name)&&i.getAttribute("property")===(null==a.property?null:a.property)&&i.getAttribute("http-equiv")===(null==a.httpEquiv?null:a.httpEquiv)&&i.getAttribute("charset")===(null==a.charSet?null:a.charSet)){o.splice(l,1);break t}hd(i=r.createElement(s),s,a),r.head.appendChild(i);break;default:throw Error(n(468,s))}i[Ve]=e,Je(i),s=i}e.stateNode=s}else rp(r,e.type,e.stateNode);else e.stateNode=Jd(r,s,e.memoizedProps);else i!==s?(null===i?null!==a.stateNode&&(a=a.stateNode).parentNode.removeChild(a):i.count--,null===s?rp(r,e.type,e.stateNode):Jd(r,s,e.memoizedProps)):null===s&&null!==e.stateNode&&Nl(e,e.memoizedProps,a.memoizedProps)}break;case 27:Hl(t,e),$l(e),512&s&&(Ol||null===a||Sl(a,a.return)),null!==a&&4&s&&Nl(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Hl(t,e),$l(e),512&s&&(Ol||null===a||Sl(a,a.return)),32&e.flags){r=e.stateNode;try{St(r,"")}catch(f){Nu(e,e.return,f)}}4&s&&null!=e.stateNode&&Nl(e,r=e.memoizedProps,null!==a?a.memoizedProps:r),1024&s&&(Il=!0);break;case 6:if(Hl(t,e),$l(e),4&s){if(null===e.stateNode)throw Error(n(162));s=e.memoizedProps,a=e.stateNode;try{a.nodeValue=s}catch(f){Nu(e,e.return,f)}}break;case 3:if(np=null,r=Kl,Kl=Gd(t.containerInfo),Hl(t,e),Kl=r,$l(e),4&s&&null!==a&&a.memoizedState.isDehydrated)try{Kp(t.containerInfo)}catch(f){Nu(e,e.return,f)}Il&&(Il=!1,Xl(e));break;case 4:s=Kl,Kl=Gd(e.stateNode.containerInfo),Hl(t,e),$l(e),Kl=s;break;case 12:default:Hl(t,e),$l(e);break;case 31:case 19:Hl(t,e),$l(e),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Wl(e,s)));break;case 13:Hl(t,e),$l(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==a&&null!==a.memoizedState)&&(Fc=oe()),4&s&&(null!==(s=e.updateQueue)&&(e.updateQueue=null,Wl(e,s)));break;case 22:r=null!==e.memoizedState;var c=null!==a&&null!==a.memoizedState,u=Al,d=Ol;if(Al=u||r,Ol=d||c,Hl(t,e),Ol=d,Al=u,$l(e),8192&s)e:for(t=e.stateNode,t._visibility=r?-2&t._visibility:1|t._visibility,r&&(null===a||c||Al||Ol||Zl(e)),a=null,t=e;;){if(5===t.tag||26===t.tag){if(null===a){c=a=t;try{if(i=c.stateNode,r)"function"==typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{l=c.stateNode;var p=c.memoizedProps.style,m=null!=p&&p.hasOwnProperty("display")?p.display:null;l.style.display=null==m||"boolean"==typeof m?"":(""+m).trim()}}catch(f){Nu(c,c.return,f)}}}else if(6===t.tag){if(null===a){c=t;try{c.stateNode.nodeValue=r?"":c.memoizedProps}catch(f){Nu(c,c.return,f)}}}else if(18===t.tag){if(null===a){c=t;try{var h=c.stateNode;r?Td(h,!0):Td(c.stateNode,!1)}catch(f){Nu(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}4&s&&(null!==(s=e.updateQueue)&&(null!==(a=s.retryQueue)&&(s.retryQueue=null,Wl(e,a))));case 30:case 21:}}function $l(e){var t=e.flags;if(2&t){try{for(var a,s=e.return;null!==s;){if(Cl(s)){a=s;break}s=s.return}if(null==a)throw Error(n(160));switch(a.tag){case 27:var r=a.stateNode;_l(e,Pl(e),r);break;case 5:var i=a.stateNode;32&a.flags&&(St(i,""),a.flags&=-33),_l(e,Pl(e),i);break;case 3:case 4:var o=a.stateNode.containerInfo;El(e,Pl(e),o);break;default:throw Error(n(161))}}catch(l){Nu(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Xl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Xl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Yl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Rl(e,t.alternate,t),t=t.sibling}function Zl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:vl(4,t,t.return),Zl(t);break;case 1:Sl(t,t.return);var a=t.stateNode;"function"==typeof a.componentWillUnmount&&wl(t,t.return,a),Zl(t);break;case 27:Vd(t.stateNode);case 26:case 5:Sl(t,t.return),Zl(t);break;case 22:null===t.memoizedState&&Zl(t);break;default:Zl(t)}e=e.sibling}}function Ql(e,t,a){for(a=a&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var n=t.alternate,s=e,r=t,i=r.flags;switch(r.tag){case 0:case 11:case 15:Ql(s,r,a),bl(4,r);break;case 1:if(Ql(s,r,a),"function"==typeof(s=(n=r).stateNode).componentDidMount)try{s.componentDidMount()}catch(c){Nu(n,n.return,c)}if(null!==(s=(n=r).updateQueue)){var o=n.stateNode;try{var l=s.shared.hiddenCallbacks;if(null!==l)for(s.shared.hiddenCallbacks=null,s=0;s<l.length;s++)Pr(l[s],o)}catch(c){Nu(n,n.return,c)}}a&&64&i&&xl(r),kl(r,r.return);break;case 27:Tl(r);case 26:case 5:Ql(s,r,a),a&&null===n&&4&i&&Ml(r),kl(r,r.return);break;case 12:Ql(s,r,a);break;case 31:Ql(s,r,a),a&&4&i&&Ul(s,r);break;case 13:Ql(s,r,a),a&&4&i&&Gl(s,r);break;case 22:null===r.memoizedState&&Ql(s,r,a),kl(r,r.return);break;case 30:break;default:Ql(s,r,a)}t=t.sibling}}function Jl(e,t){var a=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(a=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==a&&(null!=e&&e.refCount++,null!=a&&Us(a))}function ec(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e))}function tc(e,t,a,n){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ac(e,t,a,n),t=t.sibling}function ac(e,t,a,n){var s=t.flags;switch(t.tag){case 0:case 11:case 15:tc(e,t,a,n),2048&s&&bl(9,t);break;case 1:case 31:case 13:default:tc(e,t,a,n);break;case 3:tc(e,t,a,n),2048&s&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Us(e)));break;case 12:if(2048&s){tc(e,t,a,n),e=t.stateNode;try{var r=t.memoizedProps,i=r.id,o=r.onPostCommit;"function"==typeof o&&o(i,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){Nu(t,t.return,l)}}else tc(e,t,a,n);break;case 23:break;case 22:r=t.stateNode,i=t.alternate,null!==t.memoizedState?2&r._visibility?tc(e,t,a,n):sc(e,t):2&r._visibility?tc(e,t,a,n):(r._visibility|=2,nc(e,t,a,n,!!(10256&t.subtreeFlags)||!1)),2048&s&&Jl(i,t);break;case 24:tc(e,t,a,n),2048&s&&ec(t.alternate,t)}}function nc(e,t,a,n,s){for(s=s&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var r=e,i=t,o=a,l=n,c=i.flags;switch(i.tag){case 0:case 11:case 15:nc(r,i,o,l,s),bl(8,i);break;case 23:break;case 22:var u=i.stateNode;null!==i.memoizedState?2&u._visibility?nc(r,i,o,l,s):sc(r,i):(u._visibility|=2,nc(r,i,o,l,s)),s&&2048&c&&Jl(i.alternate,i);break;case 24:nc(r,i,o,l,s),s&&2048&c&&ec(i.alternate,i);break;default:nc(r,i,o,l,s)}t=t.sibling}}function sc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var a=e,n=t,s=n.flags;switch(n.tag){case 22:sc(a,n),2048&s&&Jl(n.alternate,n);break;case 24:sc(a,n),2048&s&&ec(n.alternate,n);break;default:sc(a,n)}t=t.sibling}}var rc=8192;function ic(e,t,a){if(e.subtreeFlags&rc)for(e=e.child;null!==e;)oc(e,t,a),e=e.sibling}function oc(e,t,a){switch(e.tag){case 26:ic(e,t,a),e.flags&rc&&null!==e.memoizedState&&function(e,t,a,n){if(!("stylesheet"!==a.type||"string"==typeof n.media&&!1===matchMedia(n.media).matches||4&a.state.loading)){if(null===a.instance){var s=$d(n.href),r=t.querySelector(Xd(s));if(r)return null!==(t=r._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=lp.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=r,void Je(r);r=t.ownerDocument||t,n=Yd(n),(s=zd.get(s))&&tp(n,s),Je(r=r.createElement("link"));var i=r;i._p=new Promise(function(e,t){i.onload=e,i.onerror=t}),hd(r,"link",n),a.instance=r}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&!(3&a.state.loading)&&(e.count++,a=lp.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}(a,Kl,e.memoizedState,e.memoizedProps);break;case 5:default:ic(e,t,a);break;case 3:case 4:var n=Kl;Kl=Gd(e.stateNode.containerInfo),ic(e,t,a),Kl=n;break;case 22:null===e.memoizedState&&(null!==(n=e.alternate)&&null!==n.memoizedState?(n=rc,rc=16777216,ic(e,t,a),rc=n):ic(e,t,a))}}function lc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function cc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var a=0;a<t.length;a++){var n=t[a];Dl=n,pc(n,e)}lc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)uc(e),e=e.sibling}function uc(e){switch(e.tag){case 0:case 11:case 15:cc(e),2048&e.flags&&vl(9,e,e.return);break;case 3:case 12:default:cc(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,dc(e)):cc(e)}}function dc(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var a=0;a<t.length;a++){var n=t[a];Dl=n,pc(n,e)}lc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:vl(8,t,t.return),dc(t);break;case 22:2&(a=t.stateNode)._visibility&&(a._visibility&=-3,dc(t));break;default:dc(t)}e=e.sibling}}function pc(e,t){for(;null!==Dl;){var a=Dl;switch(a.tag){case 0:case 11:case 15:vl(8,a,t);break;case 23:case 22:if(null!==a.memoizedState&&null!==a.memoizedState.cachePool){var n=a.memoizedState.cachePool.pool;null!=n&&n.refCount++}break;case 24:Us(a.memoizedState.cache)}if(null!==(n=a.child))n.return=a,Dl=n;else e:for(a=e;null!==Dl;){var s=(n=Dl).sibling,r=n.return;if(jl(n),n===a){Dl=null;break e}if(null!==s){s.return=r,Dl=s;break e}Dl=r}}}var mc={getCacheForType:function(e){var t=Fs(Vs),a=t.data.get(e);return void 0===a&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return Fs(Vs).controller.signal}},hc="function"==typeof WeakMap?WeakMap:Map,fc=0,yc=null,gc=null,bc=0,vc=0,xc=null,wc=!1,kc=!1,Sc=!1,Mc=0,Nc=0,Cc=0,Pc=0,Ec=0,_c=0,Tc=0,Ac=null,Oc=null,Ic=!1,Fc=0,Dc=0,Rc=1/0,jc=null,Bc=null,Lc=0,Vc=null,zc=null,Uc=0,Gc=0,Wc=null,Hc=null,Kc=0,qc=null;function $c(){return 2&fc&&0!==bc?bc&-bc:null!==I.T?Wu():je()}function Xc(){if(0===_c)if(536870912&bc&&!ms)_c=536870912;else{var e=Se;!(3932160&(Se<<=1))&&(Se=262144),_c=e}return null!==(e=Fr.current)&&(e.flags|=32),_c}function Yc(e,t,a){(e!==yc||2!==vc&&9!==vc)&&null===e.cancelPendingCommit||(nu(e,0),eu(e,bc,_c,!1)),Ae(e,a),2&fc&&e===yc||(e===yc&&(!(2&fc)&&(Pc|=a),4===Nc&&eu(e,bc,_c,!1)),ju(e))}function Zc(e,t,a){if(6&fc)throw Error(n(327));for(var s=!a&&!(127&t)&&0===(t&e.expiredLanes)||Pe(e,t),r=s?function(e,t){var a=fc;fc|=2;var s=iu(),r=ou();yc!==e||bc!==t?(jc=null,Rc=oe()+500,nu(e,t)):kc=Pe(e,t);e:for(;;)try{if(0!==vc&&null!==gc){t=gc;var i=xc;t:switch(vc){case 1:vc=0,xc=null,hu(e,t,i,1);break;case 2:case 9:if(nr(i)){vc=0,xc=null,mu(t);break}t=function(){2!==vc&&9!==vc||yc!==e||(vc=7),ju(e)},i.then(t,t);break e;case 3:vc=7;break e;case 4:vc=5;break e;case 7:nr(i)?(vc=0,xc=null,mu(t)):(vc=0,xc=null,hu(e,t,i,7));break;case 5:var o=null;switch(gc.tag){case 26:o=gc.memoizedState;case 5:case 27:var l=gc;if(o?ip(o):l.stateNode.complete){vc=0,xc=null;var c=l.sibling;if(null!==c)gc=c;else{var u=l.return;null!==u?(gc=u,fu(u)):gc=null}break t}}vc=0,xc=null,hu(e,t,i,5);break;case 6:vc=0,xc=null,hu(e,t,i,6);break;case 8:au(),Nc=6;break e;default:throw Error(n(462))}}du();break}catch(d){su(e,d)}return Cs=Ns=null,I.H=s,I.A=r,fc=a,null!==gc?0:(yc=null,bc=0,On(),Nc)}(e,t):cu(e,t,!0),i=s;;){if(0===r){kc&&!s&&eu(e,t,0,!1);break}if(a=e.current.alternate,!i||Jc(a)){if(2===r){if(i=t,e.errorRecoveryDisabledLanes&i)var o=0;else o=0!==(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;r=Ac;var c=l.current.memoizedState.isDehydrated;if(c&&(nu(l,o).flags|=256),2!==(o=cu(l,o,!1))){if(Sc&&!c){l.errorRecoveryDisabledLanes|=i,Pc|=i,r=4;break e}i=Oc,Oc=r,null!==i&&(null===Oc?Oc=i:Oc.push.apply(Oc,i))}r=o}if(i=!1,2!==r)continue}}if(1===r){nu(e,0),eu(e,t,0,!0);break}e:{switch(s=e,i=r){case 0:case 1:throw Error(n(345));case 4:if((4194048&t)!==t)break;case 6:eu(s,t,_c,!wc);break e;case 2:Oc=null;break;case 3:case 5:break;default:throw Error(n(329))}if((62914560&t)===t&&10<(r=Fc+300-oe())){if(eu(s,t,_c,!wc),0!==Ce(s,0,!0))break e;Uc=t,s.timeoutHandle=Sd(Qc.bind(null,s,a,Oc,jc,Ic,t,_c,Pc,Tc,wc,i,"Throttled",-0,0),r)}else Qc(s,a,Oc,jc,Ic,t,_c,Pc,Tc,wc,i,null,-0,0)}break}r=cu(e,t,!1),i=!1}ju(e)}function Qc(e,t,a,n,s,r,i,o,l,c,u,d,p,m){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||!(16785408&~d)){oc(t,r,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:At});var h=(62914560&r)===r?Fc-oe():(4194048&r)===r?Dc-oe():0;if(null!==(h=function(e,t){return e.stylesheets&&0===e.count&&up(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var n=setTimeout(function(){if(e.stylesheets&&up(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===op&&(op=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,a=performance.getEntriesByType("resource"),n=0;n<a.length;n++){var s=a[n],r=s.transferSize,i=s.initiatorType,o=s.duration;if(r&&o&&fd(i)){for(i=0,o=s.responseEnd,n+=1;n<a.length;n++){var l=a[n],c=l.startTime;if(c>o)break;var u=l.transferSize,d=l.initiatorType;u&&fd(d)&&(i+=u*((l=l.responseEnd)<o?1:(o-c)/(l-c)))}if(--n,t+=8*(r+i)/(s.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var s=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&up(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>op?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(s)}}:null}(d,h)))return Uc=r,e.cancelPendingCommit=h(gu.bind(null,e,t,r,a,n,s,i,o,l,u,d,null,p,m)),void eu(e,r,i,!c)}gu(e,t,r,a,n,s,i,o,l)}function Jc(e){for(var t=e;;){var a=t.tag;if((0===a||11===a||15===a)&&16384&t.flags&&(null!==(a=t.updateQueue)&&null!==(a=a.stores)))for(var n=0;n<a.length;n++){var s=a[n],r=s.getSnapshot;s=s.value;try{if(!Ja(r(),s))return!1}catch(i){return!1}}if(a=t.child,16384&t.subtreeFlags&&null!==a)a.return=t,t=a;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function eu(e,t,a,n){t&=~Ec,t&=~Pc,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var s=t;0<s;){var r=31-ve(s),i=1<<r;n[r]=-1,s&=~i}0!==a&&Oe(e,a,t)}function tu(){return!!(6&fc)||(Bu(0),!1)}function au(){if(null!==gc){if(0===vc)var e=gc.return;else Cs=Ns=null,li(e=gc),cr=null,ur=0,e=gc;for(;null!==e;)gl(e.alternate,e),e=e.return;gc=null}}function nu(e,t){var a=e.timeoutHandle;-1!==a&&(e.timeoutHandle=-1,Md(a)),null!==(a=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,a()),Uc=0,au(),yc=e,gc=a=Un(e.current,null),bc=t,vc=0,xc=null,wc=!1,kc=Pe(e,t),Sc=!1,Tc=_c=Ec=Pc=Cc=Nc=0,Oc=Ac=null,Ic=!1,8&t&&(t|=32&t);var n=e.entangledLanes;if(0!==n)for(e=e.entanglements,n&=t;0<n;){var s=31-ve(n),r=1<<s;t|=e[s],n&=~r}return Mc=t,On(),a}function su(e,t){Wr=null,I.H=go,t===Js||t===tr?(t=or(),vc=3):t===er?(t=or(),vc=4):vc=t===Fo?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,xc=t,null===gc&&(Nc=1,_o(e,Yn(t,e.current)))}function ru(){var e=Fr.current;return null===e||((4194048&bc)===bc?null===Dr:!!((62914560&bc)===bc||536870912&bc)&&e===Dr)}function iu(){var e=I.H;return I.H=go,null===e?go:e}function ou(){var e=I.A;return I.A=mc,e}function lu(){Nc=4,wc||(4194048&bc)!==bc&&null!==Fr.current||(kc=!0),!(134217727&Cc)&&!(134217727&Pc)||null===yc||eu(yc,bc,_c,!1)}function cu(e,t,a){var n=fc;fc|=2;var s=iu(),r=ou();yc===e&&bc===t||(jc=null,nu(e,t)),t=!1;var i=Nc;e:for(;;)try{if(0!==vc&&null!==gc){var o=gc,l=xc;switch(vc){case 8:au(),i=6;break e;case 3:case 2:case 9:case 6:null===Fr.current&&(t=!0);var c=vc;if(vc=0,xc=null,hu(e,o,l,c),a&&kc){i=0;break e}break;default:c=vc,vc=0,xc=null,hu(e,o,l,c)}}uu(),i=Nc;break}catch(u){su(e,u)}return t&&e.shellSuspendCounter++,Cs=Ns=null,fc=n,I.H=s,I.A=r,null===gc&&(yc=null,bc=0,On()),i}function uu(){for(;null!==gc;)pu(gc)}function du(){for(;null!==gc&&!re();)pu(gc)}function pu(e){var t=ll(e.alternate,e,Mc);e.memoizedProps=e.pendingProps,null===t?fu(e):gc=t}function mu(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=qo(a,t,t.pendingProps,t.type,void 0,bc);break;case 11:t=qo(a,t,t.pendingProps,t.type.render,t.ref,bc);break;case 5:li(t);default:gl(a,t),t=ll(a,t=gc=Gn(t,Mc),Mc)}e.memoizedProps=e.pendingProps,null===t?fu(e):gc=t}function hu(e,t,a,s){Cs=Ns=null,li(t),cr=null,ur=0;var r=t.return;try{if(function(e,t,a,s,r){if(a.flags|=32768,null!==s&&"object"==typeof s&&"function"==typeof s.then){if(null!==(t=a.alternate)&&As(t,a,r,!0),null!==(a=Fr.current)){switch(a.tag){case 31:case 13:return null===Dr?lu():null===a.alternate&&0===Nc&&(Nc=3),a.flags&=-257,a.flags|=65536,a.lanes=r,s===ar?a.flags|=16384:(null===(t=a.updateQueue)?a.updateQueue=new Set([s]):t.add(s),Cu(e,s,r)),!1;case 22:return a.flags|=65536,s===ar?a.flags|=16384:(null===(t=a.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([s])},a.updateQueue=t):null===(a=t.retryQueue)?t.retryQueue=new Set([s]):a.add(s),Cu(e,s,r)),!1}throw Error(n(435,a.tag))}return Cu(e,s,r),lu(),!1}if(ms)return null!==(t=Fr.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=r,s!==ys&&Ss(Yn(e=Error(n(422),{cause:s}),a))):(s!==ys&&Ss(Yn(t=Error(n(423),{cause:s}),a)),(e=e.current.alternate).flags|=65536,r&=-r,e.lanes|=r,s=Yn(s,a),Sr(e,r=Ao(e.stateNode,s,r)),4!==Nc&&(Nc=2)),!1;var i=Error(n(520),{cause:s});if(i=Yn(i,a),null===Ac?Ac=[i]:Ac.push(i),4!==Nc&&(Nc=2),null===t)return!0;s=Yn(s,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=r&-r,a.lanes|=e,Sr(a,e=Ao(a.stateNode,s,e)),!1;case 1:if(t=a.type,i=a.stateNode,!(128&a.flags||"function"!=typeof t.getDerivedStateFromError&&(null===i||"function"!=typeof i.componentDidCatch||null!==Bc&&Bc.has(i))))return a.flags|=65536,r&=-r,a.lanes|=r,Io(r=Oo(r),e,a,s),Sr(a,r),!1}a=a.return}while(null!==a);return!1}(e,r,t,a,bc))return Nc=1,_o(e,Yn(a,e.current)),void(gc=null)}catch(i){if(null!==r)throw gc=r,i;return Nc=1,_o(e,Yn(a,e.current)),void(gc=null)}32768&t.flags?(ms||1===s?e=!0:kc||536870912&bc?e=!1:(wc=e=!0,(2===s||9===s||3===s||6===s)&&(null!==(s=Fr.current)&&13===s.tag&&(s.flags|=16384))),yu(t,e)):fu(t)}function fu(e){var t=e;do{if(32768&t.flags)return void yu(t,wc);e=t.return;var a=fl(t.alternate,t,Mc);if(null!==a)return void(gc=a);if(null!==(t=t.sibling))return void(gc=t);gc=t=e}while(null!==t);0===Nc&&(Nc=5)}function yu(e,t){do{var a=yl(e.alternate,e);if(null!==a)return a.flags&=32767,void(gc=a);if(null!==(a=e.return)&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&null!==(e=e.sibling))return void(gc=e);gc=e=a}while(null!==e);Nc=6,gc=null}function gu(e,t,a,s,r,i,o,l,c){e.cancelPendingCommit=null;do{ku()}while(0!==Lc);if(6&fc)throw Error(n(327));if(null!==t){if(t===e.current)throw Error(n(177));if(i=t.lanes|t.childLanes,function(e,t,a,n,s,r){var i=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(a=i&~a;0<a;){var u=31-ve(a),d=1<<u;o[u]=0,l[u]=-1;var p=c[u];if(null!==p)for(c[u]=null,u=0;u<p.length;u++){var m=p[u];null!==m&&(m.lane&=-536870913)}a&=~d}0!==n&&Oe(e,n,0),0!==r&&0===s&&0!==e.tag&&(e.suspendedLanes|=r&~(i&~t))}(e,a,i|=An,o,l,c),e===yc&&(gc=yc=null,bc=0),zc=t,Vc=e,Uc=a,Gc=i,Wc=r,Hc=s,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,ne(de,function(){return Su(),null})):(e.callbackNode=null,e.callbackPriority=0),s=!!(13878&t.flags),13878&t.subtreeFlags||s){s=I.T,I.T=null,r=F.p,F.p=2,o=fc,fc|=4;try{!function(e,t){if(e=e.containerInfo,yd=wp,rn(e=sn(e))){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(a=(a=e.ownerDocument)&&a.defaultView||window).getSelection&&a.getSelection();if(s&&0!==s.rangeCount){a=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{a.nodeType,i.nodeType}catch(y){a=null;break e}var o=0,l=-1,c=-1,u=0,d=0,p=e,m=null;t:for(;;){for(var h;p!==a||0!==r&&3!==p.nodeType||(l=o+r),p!==i||0!==s&&3!==p.nodeType||(c=o+s),3===p.nodeType&&(o+=p.nodeValue.length),null!==(h=p.firstChild);)m=p,p=h;for(;;){if(p===e)break t;if(m===a&&++u===r&&(l=o),m===i&&++d===s&&(c=o),null!==(h=p.nextSibling))break;m=(p=m).parentNode}p=h}a=-1===l||-1===c?null:{start:l,end:c}}else a=null}a=a||{start:0,end:0}}else a=null;for(gd={focusedElem:e,selectionRange:a},wp=!1,Dl=t;null!==Dl;)if(e=(t=Dl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Dl=e;else for(;null!==Dl;){switch(i=(t=Dl).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(a=0;a<e.length;a++)(r=e[a]).ref.impl=r.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==i){e=void 0,a=t,r=i.memoizedProps,i=i.memoizedState,s=a.stateNode;try{var f=No(a.type,r);e=s.getSnapshotBeforeUpdate(f,i),s.__reactInternalSnapshotBeforeUpdate=e}catch(g){Nu(a,a.return,g)}}break;case 3:if(1024&e)if(9===(a=(e=t.stateNode.containerInfo).nodeType))Ad(e);else if(1===a)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ad(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(n(163))}if(null!==(e=t.sibling)){e.return=t.return,Dl=e;break}Dl=t.return}}(e,t)}finally{fc=o,F.p=r,I.T=s}}Lc=1,bu(),vu(),xu()}}function bu(){if(1===Lc){Lc=0;var e=Vc,t=zc,a=!!(13878&t.flags);if(13878&t.subtreeFlags||a){a=I.T,I.T=null;var n=F.p;F.p=2;var s=fc;fc|=4;try{ql(t,e);var r=gd,i=sn(e.containerInfo),o=r.focusedElem,l=r.selectionRange;if(i!==o&&o&&o.ownerDocument&&nn(o.ownerDocument.documentElement,o)){if(null!==l&&rn(o)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(u,o.value.length);else{var d=o.ownerDocument||document,p=d&&d.defaultView||window;if(p.getSelection){var m=p.getSelection(),h=o.textContent.length,f=Math.min(l.start,h),y=void 0===l.end?f:Math.min(l.end,h);!m.extend&&f>y&&(i=y,y=f,f=i);var g=an(o,f),b=an(o,y);if(g&&b&&(1!==m.rangeCount||m.anchorNode!==g.node||m.anchorOffset!==g.offset||m.focusNode!==b.node||m.focusOffset!==b.offset)){var v=d.createRange();v.setStart(g.node,g.offset),m.removeAllRanges(),f>y?(m.addRange(v),m.extend(b.node,b.offset)):(v.setEnd(b.node,b.offset),m.addRange(v))}}}}for(d=[],m=o;m=m.parentNode;)1===m.nodeType&&d.push({element:m,left:m.scrollLeft,top:m.scrollTop});for("function"==typeof o.focus&&o.focus(),o=0;o<d.length;o++){var x=d[o];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}wp=!!yd,gd=yd=null}finally{fc=s,F.p=n,I.T=a}}e.current=t,Lc=2}}function vu(){if(2===Lc){Lc=0;var e=Vc,t=zc,a=!!(8772&t.flags);if(8772&t.subtreeFlags||a){a=I.T,I.T=null;var n=F.p;F.p=2;var s=fc;fc|=4;try{Rl(e,t.alternate,t)}finally{fc=s,F.p=n,I.T=a}}Lc=3}}function xu(){if(4===Lc||3===Lc){Lc=0,ie();var e=Vc,t=zc,a=Uc,n=Hc;10256&t.subtreeFlags||10256&t.flags?Lc=5:(Lc=0,zc=Vc=null,wu(e,e.pendingLanes));var s=e.pendingLanes;if(0===s&&(Bc=null),Re(a),t=t.stateNode,ge&&"function"==typeof ge.onCommitFiberRoot)try{ge.onCommitFiberRoot(ye,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==n){t=I.T,s=F.p,F.p=2,I.T=null;try{for(var r=e.onRecoverableError,i=0;i<n.length;i++){var o=n[i];r(o.value,{componentStack:o.stack})}}finally{I.T=t,F.p=s}}3&Uc&&ku(),ju(e),s=e.pendingLanes,261930&a&&42&s?e===qc?Kc++:(Kc=0,qc=e):Kc=0,Bu(0)}}function wu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Us(t)))}function ku(){return bu(),vu(),xu(),Su()}function Su(){if(5!==Lc)return!1;var e=Vc,t=Gc;Gc=0;var a=Re(Uc),s=I.T,r=F.p;try{F.p=32>a?32:a,I.T=null,a=Wc,Wc=null;var i=Vc,o=Uc;if(Lc=0,zc=Vc=null,Uc=0,6&fc)throw Error(n(331));var l=fc;if(fc|=4,uc(i.current),ac(i,i.current,o,a),fc=l,Bu(0,!1),ge&&"function"==typeof ge.onPostCommitFiberRoot)try{ge.onPostCommitFiberRoot(ye,i)}catch(c){}return!0}finally{F.p=r,I.T=s,wu(e,t)}}function Mu(e,t,a){t=Yn(a,t),null!==(e=wr(e,t=Ao(e.stateNode,t,2),2))&&(Ae(e,2),ju(e))}function Nu(e,t,a){if(3===e.tag)Mu(e,e,a);else for(;null!==t;){if(3===t.tag){Mu(t,e,a);break}if(1===t.tag){var n=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===Bc||!Bc.has(n))){e=Yn(a,e),null!==(n=wr(t,a=Oo(2),2))&&(Io(a,n,t,e),Ae(n,2),ju(n));break}}t=t.return}}function Cu(e,t,a){var n=e.pingCache;if(null===n){n=e.pingCache=new hc;var s=new Set;n.set(t,s)}else void 0===(s=n.get(t))&&(s=new Set,n.set(t,s));s.has(a)||(Sc=!0,s.add(a),e=Pu.bind(null,e,t,a),t.then(e,e))}function Pu(e,t,a){var n=e.pingCache;null!==n&&n.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,yc===e&&(bc&a)===a&&(4===Nc||3===Nc&&(62914560&bc)===bc&&300>oe()-Fc?!(2&fc)&&nu(e,0):Ec|=a,Tc===bc&&(Tc=0)),ju(e)}function Eu(e,t){0===t&&(t=_e()),null!==(e=Dn(e,t))&&(Ae(e,t),ju(e))}function _u(e){var t=e.memoizedState,a=0;null!==t&&(a=t.retryLane),Eu(e,a)}function Tu(e,t){var a=0;switch(e.tag){case 31:case 13:var s=e.stateNode,r=e.memoizedState;null!==r&&(a=r.retryLane);break;case 19:s=e.stateNode;break;case 22:s=e.stateNode._retryCache;break;default:throw Error(n(314))}null!==s&&s.delete(t),Eu(e,a)}var Au=null,Ou=null,Iu=!1,Fu=!1,Du=!1,Ru=0;function ju(e){e!==Ou&&null===e.next&&(null===Ou?Au=Ou=e:Ou=Ou.next=e),Fu=!0,Iu||(Iu=!0,Cd(function(){6&fc?ne(ce,Lu):Vu()}))}function Bu(e,t){if(!Du&&Fu){Du=!0;do{for(var a=!1,n=Au;null!==n;){if(0!==e){var s=n.pendingLanes;if(0===s)var r=0;else{var i=n.suspendedLanes,o=n.pingedLanes;r=(1<<31-ve(42|e)+1)-1,r=201326741&(r&=s&~(i&~o))?201326741&r|1:r?2|r:0}0!==r&&(a=!0,Gu(n,r))}else r=bc,!(3&(r=Ce(n,n===yc?r:0,null!==n.cancelPendingCommit||-1!==n.timeoutHandle)))||Pe(n,r)||(a=!0,Gu(n,r));n=n.next}}while(a);Du=!1}}function Lu(){Vu()}function Vu(){Fu=Iu=!1;var e=0;0!==Ru&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==kd&&(kd=e,!0);return kd=null,!1}()&&(e=Ru);for(var t=oe(),a=null,n=Au;null!==n;){var s=n.next,r=zu(n,t);0===r?(n.next=null,null===a?Au=s:a.next=s,null===s&&(Ou=a)):(a=n,(0!==e||3&r)&&(Fu=!0)),n=s}0!==Lc&&5!==Lc||Bu(e),0!==Ru&&(Ru=0)}function zu(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,s=e.expirationTimes,r=-62914561&e.pendingLanes;0<r;){var i=31-ve(r),o=1<<i,l=s[i];-1===l?0!==(o&a)&&0===(o&n)||(s[i]=Ee(o,t)):l<=t&&(e.expiredLanes|=o),r&=~o}if(a=bc,a=Ce(e,e===(t=yc)?a:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),n=e.callbackNode,0===a||e===t&&(2===vc||9===vc)||null!==e.cancelPendingCommit)return null!==n&&null!==n&&se(n),e.callbackNode=null,e.callbackPriority=0;if(!(3&a)||Pe(e,a)){if((t=a&-a)===e.callbackPriority)return t;switch(null!==n&&se(n),Re(a)){case 2:case 8:a=ue;break;case 32:default:a=de;break;case 268435456:a=me}return n=Uu.bind(null,e),a=ne(a,n),e.callbackPriority=t,e.callbackNode=a,t}return null!==n&&null!==n&&se(n),e.callbackPriority=2,e.callbackNode=null,2}function Uu(e,t){if(0!==Lc&&5!==Lc)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(ku()&&e.callbackNode!==a)return null;var n=bc;return 0===(n=Ce(e,e===yc?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Zc(e,n,t),zu(e,oe()),null!=e.callbackNode&&e.callbackNode===a?Uu.bind(null,e):null)}function Gu(e,t){if(ku())return null;Zc(e,t,!0)}function Wu(){if(0===Ru){var e=Hs;0===e&&(e=ke,!(261888&(ke<<=1))&&(ke=256)),Ru=e}return Ru}function Hu(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Tt(""+e)}function Ku(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}for(var qu=0;qu<Cn.length;qu++){var $u=Cn[qu];Pn($u.toLowerCase(),"on"+($u[0].toUpperCase()+$u.slice(1)))}Pn(bn,"onAnimationEnd"),Pn(vn,"onAnimationIteration"),Pn(xn,"onAnimationStart"),Pn("dblclick","onDoubleClick"),Pn("focusin","onFocus"),Pn("focusout","onBlur"),Pn(wn,"onTransitionRun"),Pn(kn,"onTransitionStart"),Pn(Sn,"onTransitionCancel"),Pn(Mn,"onTransitionEnd"),nt("onMouseEnter",["mouseout","mouseover"]),nt("onMouseLeave",["mouseout","mouseover"]),nt("onPointerEnter",["pointerout","pointerover"]),nt("onPointerLeave",["pointerout","pointerover"]),at("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),at("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),at("onBeforeInput",["compositionend","keypress","textInput","paste"]),at("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xu));function Zu(e,t){t=!!(4&t);for(var a=0;a<e.length;a++){var n=e[a],s=n.event;n=n.listeners;e:{var r=void 0;if(t)for(var i=n.length-1;0<=i;i--){var o=n[i],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&s.isPropagationStopped())break e;r=o,s.currentTarget=c;try{r(s)}catch(u){En(u)}s.currentTarget=null,r=l}else for(i=0;i<n.length;i++){if(l=(o=n[i]).instance,c=o.currentTarget,o=o.listener,l!==r&&s.isPropagationStopped())break e;r=o,s.currentTarget=c;try{r(s)}catch(u){En(u)}s.currentTarget=null,r=l}}}}function Qu(e,t){var a=t[Ge];void 0===a&&(a=t[Ge]=new Set);var n=e+"__bubble";a.has(n)||(ad(t,e,2,!1),a.add(n))}function Ju(e,t,a){var n=0;t&&(n|=4),ad(a,e,n,t)}var ed="_reactListening"+Math.random().toString(36).slice(2);function td(e){if(!e[ed]){e[ed]=!0,et.forEach(function(t){"selectionchange"!==t&&(Yu.has(t)||Ju(t,!1,e),Ju(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[ed]||(t[ed]=!0,Ju("selectionchange",!1,t))}}function ad(e,t,a,n){switch(Ep(t)){case 2:var s=kp;break;case 8:s=Sp;break;default:s=Mp}a=s.bind(null,t,a,e),s=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),n?void 0!==s?e.addEventListener(t,a,{capture:!0,passive:s}):e.addEventListener(t,a,!0):void 0!==s?e.addEventListener(t,a,{passive:s}):e.addEventListener(t,a,!1)}function nd(e,t,a,n,s){var i=n;if(!(1&t||2&t||null===n))e:for(;;){if(null===n)return;var o=n.tag;if(3===o||4===o){var l=n.stateNode.containerInfo;if(l===s)break;if(4===o)for(o=n.return;null!==o;){var c=o.tag;if((3===c||4===c)&&o.stateNode.containerInfo===s)return;o=o.return}for(;null!==l;){if(null===(o=Xe(l)))return;if(5===(c=o.tag)||6===c||26===c||27===c){n=i=o;continue e}l=l.parentNode}}n=n.return}Bt(function(){var n=i,s=It(a),o=[];e:{var l=Nn.get(e);if(void 0!==l){var c=ta,u=e;switch(e){case"keypress":if(0===qt(a))break e;case"keydown":case"keyup":c=ya;break;case"focusin":u="focus",c=oa;break;case"focusout":u="blur",c=oa;break;case"beforeblur":case"afterblur":c=oa;break;case"click":if(2===a.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=ra;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ia;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=ba;break;case bn:case vn:case xn:c=la;break;case Mn:c=va;break;case"scroll":case"scrollend":c=na;break;case"wheel":c=xa;break;case"copy":case"cut":case"paste":c=ca;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=ga;break;case"toggle":case"beforetoggle":c=wa}var d=!!(4&t),p=!d&&("scroll"===e||"scrollend"===e),m=d?null!==l?l+"Capture":null:l;d=[];for(var h,f=n;null!==f;){var y=f;if(h=y.stateNode,5!==(y=y.tag)&&26!==y&&27!==y||null===h||null===m||null!=(y=Lt(f,m))&&d.push(sd(f,y,h)),p)break;f=f.return}0<d.length&&(l=new c(l,u,null,a,s),o.push({event:l,listeners:d}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||a===Ot||!(u=a.relatedTarget||a.fromElement)||!Xe(u)&&!u[Ue])&&(c||l)&&(l=s.window===s?s:(l=s.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=n,null!==(u=(u=a.relatedTarget||a.toElement)?Xe(u):null)&&(p=r(u),d=u.tag,u!==p||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=n),c!==u)){if(d=ra,y="onMouseLeave",m="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=ga,y="onPointerLeave",m="onPointerEnter",f="pointer"),p=null==c?l:Ze(c),h=null==u?l:Ze(u),(l=new d(y,f+"leave",c,a,s)).target=p,l.relatedTarget=h,y=null,Xe(s)===n&&((d=new d(m,f+"enter",u,a,s)).target=h,d.relatedTarget=p,y=d),p=y,c&&u)e:{for(d=id,f=u,h=0,y=m=c;y;y=d(y))h++;y=0;for(var g=f;g;g=d(g))y++;for(;0<h-y;)m=d(m),h--;for(;0<y-h;)f=d(f),y--;for(;h--;){if(m===f||null!==f&&m===f.alternate){d=m;break e}m=d(m),f=d(f)}d=null}else d=null;null!==c&&od(o,l,c,d,!1),null!==u&&null!==p&&od(o,p,u,d,!0)}if("select"===(c=(l=n?Ze(n):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var b=Ua;else if(Ra(l))if(Ga)b=Qa;else{b=Ya;var v=Xa}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?n&&Pt(n.elementType)&&(b=Ua):b=Za;switch(b&&(b=b(e,n))?ja(o,b,a,s):(v&&v(e,l,n),"focusout"===e&&n&&"number"===l.type&&null!=n.memoizedProps.value&&vt(l,"number",l.value)),v=n?Ze(n):window,e){case"focusin":(Ra(v)||"true"===v.contentEditable)&&(ln=v,cn=n,un=null);break;case"focusout":un=cn=ln=null;break;case"mousedown":dn=!0;break;case"contextmenu":case"mouseup":case"dragend":dn=!1,pn(o,a,s);break;case"selectionchange":if(on)break;case"keydown":case"keyup":pn(o,a,s)}var x;if(Sa)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Fa?Aa(e,a)&&(w="onCompositionEnd"):"keydown"===e&&229===a.keyCode&&(w="onCompositionStart");w&&(Pa&&"ko"!==a.locale&&(Fa||"onCompositionStart"!==w?"onCompositionEnd"===w&&Fa&&(x=Kt()):(Wt="value"in(Gt=s)?Gt.value:Gt.textContent,Fa=!0)),0<(v=rd(n,w)).length&&(w=new ua(w,e,null,a,s),o.push({event:w,listeners:v}),x?w.data=x:null!==(x=Oa(a))&&(w.data=x))),(x=Na?function(e,t){switch(e){case"compositionend":return Oa(t);case"keypress":return 32!==t.which?null:(_a=!0,Ea);case"textInput":return(e=t.data)===Ea&&_a?null:e;default:return null}}(e,a):function(e,t){if(Fa)return"compositionend"===e||!Sa&&Aa(e,t)?(e=Kt(),Ht=Wt=Gt=null,Fa=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Pa&&"ko"!==t.locale?null:t.data}}(e,a))&&(0<(w=rd(n,"onBeforeInput")).length&&(v=new ua("onBeforeInput","beforeinput",null,a,s),o.push({event:v,listeners:w}),v.data=x)),function(e,t,a,n,s){if("submit"===t&&a&&a.stateNode===s){var r=Hu((s[ze]||null).action),i=n.submitter;i&&null!==(t=(t=i[ze]||null)?Hu(t.formAction):i.getAttribute("formAction"))&&(r=t,i=null);var o=new ta("action","action",null,n,s);e.push({event:o,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(0!==Ru){var e=i?Ku(s,i):new FormData(s);ao(a,{pending:!0,data:e,method:s.method,action:r},null,e)}}else"function"==typeof r&&(o.preventDefault(),e=i?Ku(s,i):new FormData(s),ao(a,{pending:!0,data:e,method:s.method,action:r},r,e))},currentTarget:s}]})}}(o,e,n,a,s)}Zu(o,t)})}function sd(e,t,a){return{instance:e,listener:t,currentTarget:a}}function rd(e,t){for(var a=t+"Capture",n=[];null!==e;){var s=e,r=s.stateNode;if(5!==(s=s.tag)&&26!==s&&27!==s||null===r||(null!=(s=Lt(e,a))&&n.unshift(sd(e,s,r)),null!=(s=Lt(e,t))&&n.push(sd(e,s,r))),3===e.tag)return n;e=e.return}return[]}function id(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function od(e,t,a,n,s){for(var r=t._reactName,i=[];null!==a&&a!==n;){var o=a,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===n)break;5!==o&&26!==o&&27!==o||null===c||(l=c,s?null!=(c=Lt(a,r))&&i.unshift(sd(a,c,l)):s||null!=(c=Lt(a,r))&&i.push(sd(a,c,l))),a=a.return}0!==i.length&&e.push({event:t,listeners:i})}var ld=/\r\n?/g,cd=/\u0000|\uFFFD/g;function ud(e){return("string"==typeof e?e:""+e).replace(ld,"\n").replace(cd,"")}function dd(e,t){return t=ud(t),ud(e)===t}function pd(e,t,a,s,r,i){switch(a){case"children":"string"==typeof s?"body"===t||"textarea"===t&&""===s||St(e,s):("number"==typeof s||"bigint"==typeof s)&&"body"!==t&&St(e,""+s);break;case"className":lt(e,"class",s);break;case"tabIndex":lt(e,"tabindex",s);break;case"dir":case"role":case"viewBox":case"width":case"height":lt(e,a,s);break;case"style":Ct(e,s,i);break;case"data":if("object"!==t){lt(e,"data",s);break}case"src":case"href":if(""===s&&("a"!==t||"href"!==a)){e.removeAttribute(a);break}if(null==s||"function"==typeof s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(a);break}s=Tt(""+s),e.setAttribute(a,s);break;case"action":case"formAction":if("function"==typeof s){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof i&&("formAction"===a?("input"!==t&&pd(e,t,"name",r.name,r,null),pd(e,t,"formEncType",r.formEncType,r,null),pd(e,t,"formMethod",r.formMethod,r,null),pd(e,t,"formTarget",r.formTarget,r,null)):(pd(e,t,"encType",r.encType,r,null),pd(e,t,"method",r.method,r,null),pd(e,t,"target",r.target,r,null))),null==s||"symbol"==typeof s||"boolean"==typeof s){e.removeAttribute(a);break}s=Tt(""+s),e.setAttribute(a,s);break;case"onClick":null!=s&&(e.onclick=At);break;case"onScroll":null!=s&&Qu("scroll",e);break;case"onScrollEnd":null!=s&&Qu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(n(61));if(null!=(a=s.__html)){if(null!=r.children)throw Error(n(60));e.innerHTML=a}}break;case"multiple":e.multiple=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"muted":e.muted=s&&"function"!=typeof s&&"symbol"!=typeof s;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==s||"function"==typeof s||"boolean"==typeof s||"symbol"==typeof s){e.removeAttribute("xlink:href");break}a=Tt(""+s),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(a,""+s):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":!0===s?e.setAttribute(a,""):!1!==s&&null!=s&&"function"!=typeof s&&"symbol"!=typeof s?e.setAttribute(a,s):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&!isNaN(s)&&1<=s?e.setAttribute(a,s):e.removeAttribute(a);break;case"rowSpan":case"start":null==s||"function"==typeof s||"symbol"==typeof s||isNaN(s)?e.removeAttribute(a):e.setAttribute(a,s);break;case"popover":Qu("beforetoggle",e),Qu("toggle",e),ot(e,"popover",s);break;case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",s);break;case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",s);break;case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",s);break;case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",s);break;case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",s);break;case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",s);break;case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",s);break;case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",s);break;case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",s);break;case"is":ot(e,"is",s);break;case"innerText":case"textContent":break;default:(!(2<a.length)||"o"!==a[0]&&"O"!==a[0]||"n"!==a[1]&&"N"!==a[1])&&ot(e,a=Et.get(a)||a,s)}}function md(e,t,a,s,r,i){switch(a){case"style":Ct(e,s,i);break;case"dangerouslySetInnerHTML":if(null!=s){if("object"!=typeof s||!("__html"in s))throw Error(n(61));if(null!=(a=s.__html)){if(null!=r.children)throw Error(n(60));e.innerHTML=a}}break;case"children":"string"==typeof s?St(e,s):("number"==typeof s||"bigint"==typeof s)&&St(e,""+s);break;case"onScroll":null!=s&&Qu("scroll",e);break;case"onScrollEnd":null!=s&&Qu("scrollend",e);break;case"onClick":null!=s&&(e.onclick=At);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:tt.hasOwnProperty(a)||("o"!==a[0]||"n"!==a[1]||(r=a.endsWith("Capture"),t=a.slice(2,r?a.length-7:void 0),"function"==typeof(i=null!=(i=e[ze]||null)?i[a]:null)&&e.removeEventListener(t,i,r),"function"!=typeof s)?a in e?e[a]=s:!0===s?e.setAttribute(a,""):ot(e,a,s):("function"!=typeof i&&null!==i&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,s,r)))}}function hd(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qu("error",e),Qu("load",e);var s,r=!1,i=!1;for(s in a)if(a.hasOwnProperty(s)){var o=a[s];if(null!=o)switch(s){case"src":r=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,t));default:pd(e,t,s,o,a,null)}}return i&&pd(e,t,"srcSet",a.srcSet,a,null),void(r&&pd(e,t,"src",a.src,a,null));case"input":Qu("invalid",e);var l=s=o=i=null,c=null,u=null;for(r in a)if(a.hasOwnProperty(r)){var d=a[r];if(null!=d)switch(r){case"name":i=d;break;case"type":o=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":s=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(n(137,t));break;default:pd(e,t,r,d,a,null)}}return void bt(e,s,l,c,u,o,i,!1);case"select":for(i in Qu("invalid",e),r=o=s=null,a)if(a.hasOwnProperty(i)&&null!=(l=a[i]))switch(i){case"value":s=l;break;case"defaultValue":o=l;break;case"multiple":r=l;default:pd(e,t,i,l,a,null)}return t=s,a=o,e.multiple=!!r,void(null!=t?xt(e,!!r,t,!1):null!=a&&xt(e,!!r,a,!0));case"textarea":for(o in Qu("invalid",e),s=i=r=null,a)if(a.hasOwnProperty(o)&&null!=(l=a[o]))switch(o){case"value":r=l;break;case"defaultValue":i=l;break;case"children":s=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(n(91));break;default:pd(e,t,o,l,a,null)}return void kt(e,r,i,s);case"option":for(c in a)if(a.hasOwnProperty(c)&&null!=(r=a[c]))if("selected"===c)e.selected=r&&"function"!=typeof r&&"symbol"!=typeof r;else pd(e,t,c,r,a,null);return;case"dialog":Qu("beforetoggle",e),Qu("toggle",e),Qu("cancel",e),Qu("close",e);break;case"iframe":case"object":Qu("load",e);break;case"video":case"audio":for(r=0;r<Xu.length;r++)Qu(Xu[r],e);break;case"image":Qu("error",e),Qu("load",e);break;case"details":Qu("toggle",e);break;case"embed":case"source":case"link":Qu("error",e),Qu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in a)if(a.hasOwnProperty(u)&&null!=(r=a[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,t));default:pd(e,t,u,r,a,null)}return;default:if(Pt(t)){for(d in a)a.hasOwnProperty(d)&&(void 0!==(r=a[d])&&md(e,t,d,r,a,void 0));return}}for(l in a)a.hasOwnProperty(l)&&(null!=(r=a[l])&&pd(e,t,l,r,a,null))}function fd(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var yd=null,gd=null;function bd(e){return 9===e.nodeType?e:e.ownerDocument}function vd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xd(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function wd(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var kd=null;var Sd="function"==typeof setTimeout?setTimeout:void 0,Md="function"==typeof clearTimeout?clearTimeout:void 0,Nd="function"==typeof Promise?Promise:void 0,Cd="function"==typeof queueMicrotask?queueMicrotask:void 0!==Nd?function(e){return Nd.resolve(null).then(e).catch(Pd)}:Sd;function Pd(e){setTimeout(function(){throw e})}function Ed(e){return"head"===e}function _d(e,t){var a=t,n=0;do{var s=a.nextSibling;if(e.removeChild(a),s&&8===s.nodeType)if("/$"===(a=s.data)||"/&"===a){if(0===n)return e.removeChild(s),void Kp(t);n--}else if("$"===a||"$?"===a||"$~"===a||"$!"===a||"&"===a)n++;else if("html"===a)Vd(e.ownerDocument.documentElement);else if("head"===a){Vd(a=e.ownerDocument.head);for(var r=a.firstChild;r;){var i=r.nextSibling,o=r.nodeName;r[qe]||"SCRIPT"===o||"STYLE"===o||"LINK"===o&&"stylesheet"===r.rel.toLowerCase()||a.removeChild(r),r=i}}else"body"===a&&Vd(e.ownerDocument.body);a=s}while(a);Kp(t)}function Td(e,t){var a=e;e=0;do{var n=a.nextSibling;if(1===a.nodeType?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",""===a.getAttribute("style")&&a.removeAttribute("style")):3===a.nodeType&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),n&&8===n.nodeType)if("/$"===(a=n.data)){if(0===e)break;e--}else"$"!==a&&"$?"!==a&&"$~"!==a&&"$!"!==a||e++;a=n}while(a)}function Ad(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Ad(a),$e(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===a.rel.toLowerCase())continue}e.removeChild(a)}}function Od(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Dd(e.nextSibling)))return null}return e}function Id(e){return"$?"===e.data||"$~"===e.data}function Fd(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Dd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Rd=null;function jd(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var a=e.data;if("/$"===a||"/&"===a){if(0===t)return Dd(e.nextSibling);t--}else"$"!==a&&"$!"!==a&&"$?"!==a&&"$~"!==a&&"&"!==a||t++}e=e.nextSibling}return null}function Bd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var a=e.data;if("$"===a||"$!"===a||"$?"===a||"$~"===a||"&"===a){if(0===t)return e;t--}else"/$"!==a&&"/&"!==a||t++}e=e.previousSibling}return null}function Ld(e,t,a){switch(t=bd(a),e){case"html":if(!(e=t.documentElement))throw Error(n(452));return e;case"head":if(!(e=t.head))throw Error(n(453));return e;case"body":if(!(e=t.body))throw Error(n(454));return e;default:throw Error(n(451))}}function Vd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);$e(e)}var zd=new Map,Ud=new Set;function Gd(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Wd=F.d;F.d={f:function(){var e=Wd.f(),t=tu();return e||t},r:function(e){var t=Ye(e);null!==t&&5===t.tag&&"form"===t.type?so(t):Wd.r(e)},D:function(e){Wd.D(e),Kd("dns-prefetch",e,null)},C:function(e,t){Wd.C(e,t),Kd("preconnect",e,t)},L:function(e,t,a){Wd.L(e,t,a);var n=Hd;if(n&&e&&t){var s='link[rel="preload"][as="'+yt(t)+'"]';"image"===t&&a&&a.imageSrcSet?(s+='[imagesrcset="'+yt(a.imageSrcSet)+'"]',"string"==typeof a.imageSizes&&(s+='[imagesizes="'+yt(a.imageSizes)+'"]')):s+='[href="'+yt(e)+'"]';var r=s;switch(t){case"style":r=$d(e);break;case"script":r=Zd(e)}zd.has(r)||(e=p({rel:"preload",href:"image"===t&&a&&a.imageSrcSet?void 0:e,as:t},a),zd.set(r,e),null!==n.querySelector(s)||"style"===t&&n.querySelector(Xd(r))||"script"===t&&n.querySelector(Qd(r))||(hd(t=n.createElement("link"),"link",e),Je(t),n.head.appendChild(t)))}},m:function(e,t){Wd.m(e,t);var a=Hd;if(a&&e){var n=t&&"string"==typeof t.as?t.as:"script",s='link[rel="modulepreload"][as="'+yt(n)+'"][href="'+yt(e)+'"]',r=s;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=Zd(e)}if(!zd.has(r)&&(e=p({rel:"modulepreload",href:e},t),zd.set(r,e),null===a.querySelector(s))){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Qd(r)))return}hd(n=a.createElement("link"),"link",e),Je(n),a.head.appendChild(n)}}},X:function(e,t){Wd.X(e,t);var a=Hd;if(a&&e){var n=Qe(a).hoistableScripts,s=Zd(e),r=n.get(s);r||((r=a.querySelector(Qd(s)))||(e=p({src:e,async:!0},t),(t=zd.get(s))&&ap(e,t),Je(r=a.createElement("script")),hd(r,"link",e),a.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(s,r))}},S:function(e,t,a){Wd.S(e,t,a);var n=Hd;if(n&&e){var s=Qe(n).hoistableStyles,r=$d(e);t=t||"default";var i=s.get(r);if(!i){var o={loading:0,preload:null};if(i=n.querySelector(Xd(r)))o.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},a),(a=zd.get(r))&&tp(e,a);var l=i=n.createElement("link");Je(l),hd(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,ep(i,t,n)}i={type:"stylesheet",instance:i,count:1,state:o},s.set(r,i)}}},M:function(e,t){Wd.M(e,t);var a=Hd;if(a&&e){var n=Qe(a).hoistableScripts,s=Zd(e),r=n.get(s);r||((r=a.querySelector(Qd(s)))||(e=p({src:e,async:!0,type:"module"},t),(t=zd.get(s))&&ap(e,t),Je(r=a.createElement("script")),hd(r,"link",e),a.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(s,r))}}};var Hd="undefined"==typeof document?null:document;function Kd(e,t,a){var n=Hd;if(n&&"string"==typeof t&&t){var s=yt(t);s='link[rel="'+e+'"][href="'+s+'"]',"string"==typeof a&&(s+='[crossorigin="'+a+'"]'),Ud.has(s)||(Ud.add(s),e={rel:e,crossOrigin:a,href:t},null===n.querySelector(s)&&(hd(t=n.createElement("link"),"link",e),Je(t),n.head.appendChild(t)))}}function qd(e,t,a,s){var r,i,o,l,c=(c=H.current)?Gd(c):null;if(!c)throw Error(n(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof a.precedence&&"string"==typeof a.href?(t=$d(a.href),(s=(a=Qe(c).hoistableStyles).get(t))||(s={type:"style",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===a.rel&&"string"==typeof a.href&&"string"==typeof a.precedence){e=$d(a.href);var u=Qe(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Xd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),zd.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},zd.set(e,a),u||(r=c,i=e,o=a,l=d.state,r.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=r.createElement("link"),l.preload=i,i.addEventListener("load",function(){return l.loading|=1}),i.addEventListener("error",function(){return l.loading|=2}),hd(i,"link",o),Je(i),r.head.appendChild(i))))),t&&null===s)throw Error(n(528,""));return d}if(t&&null!==s)throw Error(n(529,""));return null;case"script":return t=a.async,"string"==typeof(a=a.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Zd(a),(s=(a=Qe(c).hoistableScripts).get(t))||(s={type:"script",instance:null,count:0,state:null},a.set(t,s)),s):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,e))}}function $d(e){return'href="'+yt(e)+'"'}function Xd(e){return'link[rel="stylesheet"]['+e+"]"}function Yd(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Zd(e){return'[src="'+yt(e)+'"]'}function Qd(e){return"script[async]"+e}function Jd(e,t,a){if(t.count++,null===t.instance)switch(t.type){case"style":var s=e.querySelector('style[data-href~="'+yt(a.href)+'"]');if(s)return t.instance=s,Je(s),s;var r=p({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return Je(s=(e.ownerDocument||e).createElement("style")),hd(s,"style",r),ep(s,a.precedence,e),t.instance=s;case"stylesheet":r=$d(a.href);var i=e.querySelector(Xd(r));if(i)return t.state.loading|=4,t.instance=i,Je(i),i;s=Yd(a),(r=zd.get(r))&&tp(s,r),Je(i=(e.ownerDocument||e).createElement("link"));var o=i;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),hd(i,"link",s),t.state.loading|=4,ep(i,a.precedence,e),t.instance=i;case"script":return i=Zd(a.src),(r=e.querySelector(Qd(i)))?(t.instance=r,Je(r),r):(s=a,(r=zd.get(i))&&ap(s=p({},a),r),Je(r=(e=e.ownerDocument||e).createElement("script")),hd(r,"link",s),e.head.appendChild(r),t.instance=r);case"void":return null;default:throw Error(n(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(s=t.instance,t.state.loading|=4,ep(s,a.precedence,e));return t.instance}function ep(e,t,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=n.length?n[n.length-1]:null,r=s,i=0;i<n.length;i++){var o=n[i];if(o.dataset.precedence===t)r=o;else if(r!==s)break}r?r.parentNode.insertBefore(e,r.nextSibling):(t=9===a.nodeType?a.head:a).insertBefore(e,t.firstChild)}function tp(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function ap(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var np=null;function sp(e,t,a){if(null===np){var n=new Map,s=np=new Map;s.set(a,n)}else(n=(s=np).get(a))||(n=new Map,s.set(a,n));if(n.has(e))return n;for(n.set(e,null),a=a.getElementsByTagName(e),s=0;s<a.length;s++){var r=a[s];if(!(r[qe]||r[Ve]||"link"===e&&"stylesheet"===r.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==r.namespaceURI){var i=r.getAttribute(t)||"";i=e+i;var o=n.get(i);o?o.push(r):n.set(i,[r])}}return n}function rp(e,t,a){(e=e.ownerDocument||e).head.insertBefore(a,"title"===t?e.querySelector("head > title"):null)}function ip(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var op=0;function lp(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)up(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var cp=null;function up(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,cp=new Map,t.forEach(dp,e),cp=null,lp.call(e))}function dp(e,t){if(!(4&t.state.loading)){var a=cp.get(e);if(a)var n=a.get(null);else{a=new Map,cp.set(e,a);for(var s=e.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<s.length;r++){var i=s[r];"LINK"!==i.nodeName&&"not all"===i.getAttribute("media")||(a.set(i.dataset.precedence,i),n=i)}n&&a.set(null,n)}i=(s=t.instance).getAttribute("data-precedence"),(r=a.get(i)||n)===n&&a.set(null,s),a.set(i,s),this.count++,n=lp.bind(this),s.addEventListener("load",n),s.addEventListener("error",n),r?r.parentNode.insertBefore(s,r.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(s,e.firstChild),t.state.loading|=4}}var pp={$$typeof:x,Provider:null,Consumer:null,_currentValue:D,_currentValue2:D,_threadCount:0};function mp(e,t,a,n,s,r,i,o,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Te(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Te(0),this.hiddenUpdates=Te(null),this.identifierPrefix=n,this.onUncaughtError=s,this.onCaughtError=r,this.onRecoverableError=i,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function hp(e,t,a,n,s,r,i,o,l,c,u,d){return e=new mp(e,t,a,i,l,c,u,d,o),t=1,!0===r&&(t|=24),r=Vn(3,null,null,t),e.current=r,r.stateNode=e,(t=zs()).refCount++,e.pooledCache=t,t.refCount++,r.memoizedState={element:n,isDehydrated:a,cache:t},br(r),e}function fp(e){return e?e=Bn:Bn}function yp(e,t,a,n,s,r){s=fp(s),null===n.context?n.context=s:n.pendingContext=s,(n=xr(t)).payload={element:a},null!==(r=void 0===r?null:r)&&(n.callback=r),null!==(a=wr(e,n,t))&&(Yc(a,0,t),kr(a,e,t))}function gp(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var a=e.retryLane;e.retryLane=0!==a&&a<t?a:t}}function bp(e,t){gp(e,t),(e=e.alternate)&&gp(e,t)}function vp(e){if(13===e.tag||31===e.tag){var t=Dn(e,67108864);null!==t&&Yc(t,0,67108864),bp(e,67108864)}}function xp(e){if(13===e.tag||31===e.tag){var t=$c(),a=Dn(e,t=De(t));null!==a&&Yc(a,0,t),bp(e,t)}}var wp=!0;function kp(e,t,a,n){var s=I.T;I.T=null;var r=F.p;try{F.p=2,Mp(e,t,a,n)}finally{F.p=r,I.T=s}}function Sp(e,t,a,n){var s=I.T;I.T=null;var r=F.p;try{F.p=8,Mp(e,t,a,n)}finally{F.p=r,I.T=s}}function Mp(e,t,a,n){if(wp){var s=Np(n);if(null===s)nd(e,t,n,Cp,a),jp(e,n);else if(function(e,t,a,n,s){switch(t){case"focusin":return Tp=Bp(Tp,e,t,a,n,s),!0;case"dragenter":return Ap=Bp(Ap,e,t,a,n,s),!0;case"mouseover":return Op=Bp(Op,e,t,a,n,s),!0;case"pointerover":var r=s.pointerId;return Ip.set(r,Bp(Ip.get(r)||null,e,t,a,n,s)),!0;case"gotpointercapture":return r=s.pointerId,Fp.set(r,Bp(Fp.get(r)||null,e,t,a,n,s)),!0}return!1}(s,e,t,a,n))n.stopPropagation();else if(jp(e,n),4&t&&-1<Rp.indexOf(e)){for(;null!==s;){var r=Ye(s);if(null!==r)switch(r.tag){case 3:if((r=r.stateNode).current.memoizedState.isDehydrated){var i=Ne(r.pendingLanes);if(0!==i){var o=r;for(o.pendingLanes|=2,o.entangledLanes|=2;i;){var l=1<<31-ve(i);o.entanglements[1]|=l,i&=~l}ju(r),!(6&fc)&&(Rc=oe()+500,Bu(0))}}break;case 31:case 13:null!==(o=Dn(r,2))&&Yc(o,0,2),tu(),bp(r,2)}if(null===(r=Np(n))&&nd(e,t,n,Cp,a),r===s)break;s=r}null!==s&&n.stopPropagation()}else nd(e,t,n,null,a)}}function Np(e){return Pp(e=It(e))}var Cp=null;function Pp(e){if(Cp=null,null!==(e=Xe(e))){var t=r(e);if(null===t)e=null;else{var a=t.tag;if(13===a){if(null!==(e=i(t)))return e;e=null}else if(31===a){if(null!==(e=c(t)))return e;e=null}else if(3===a){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Cp=e,null}function Ep(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(le()){case ce:return 2;case ue:return 8;case de:case pe:return 32;case me:return 268435456;default:return 32}default:return 32}}var _p=!1,Tp=null,Ap=null,Op=null,Ip=new Map,Fp=new Map,Dp=[],Rp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function jp(e,t){switch(e){case"focusin":case"focusout":Tp=null;break;case"dragenter":case"dragleave":Ap=null;break;case"mouseover":case"mouseout":Op=null;break;case"pointerover":case"pointerout":Ip.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fp.delete(t.pointerId)}}function Bp(e,t,a,n,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=Ye(t))&&vp(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Lp(e){var t=Xe(e.target);if(null!==t){var a=r(t);if(null!==a)if(13===(t=a.tag)){if(null!==(t=i(a)))return e.blockedOn=t,void Be(e.priority,function(){xp(a)})}else if(31===t){if(null!==(t=c(a)))return e.blockedOn=t,void Be(e.priority,function(){xp(a)})}else if(3===t&&a.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===a.tag?a.stateNode.containerInfo:null)}e.blockedOn=null}function Vp(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var a=Np(e.nativeEvent);if(null!==a)return null!==(t=Ye(a))&&vp(t),e.blockedOn=a,!1;var n=new(a=e.nativeEvent).constructor(a.type,a);Ot=n,a.target.dispatchEvent(n),Ot=null,t.shift()}return!0}function zp(e,t,a){Vp(e)&&a.delete(t)}function Up(){_p=!1,null!==Tp&&Vp(Tp)&&(Tp=null),null!==Ap&&Vp(Ap)&&(Ap=null),null!==Op&&Vp(Op)&&(Op=null),Ip.forEach(zp),Fp.forEach(zp)}function Gp(t,a){t.blockedOn===a&&(t.blockedOn=null,_p||(_p=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Up)))}var Wp=null;function Hp(t){Wp!==t&&(Wp=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Wp===t&&(Wp=null);for(var e=0;e<t.length;e+=3){var a=t[e],n=t[e+1],s=t[e+2];if("function"!=typeof n){if(null===Pp(n||a))continue;break}var r=Ye(a);null!==r&&(t.splice(e,3),e-=3,ao(r,{pending:!0,data:s,method:a.method,action:n},n,s))}}))}function Kp(e){function t(t){return Gp(t,e)}null!==Tp&&Gp(Tp,e),null!==Ap&&Gp(Ap,e),null!==Op&&Gp(Op,e),Ip.forEach(t),Fp.forEach(t);for(var a=0;a<Dp.length;a++){var n=Dp[a];n.blockedOn===e&&(n.blockedOn=null)}for(;0<Dp.length&&null===(a=Dp[0]).blockedOn;)Lp(a),null===a.blockedOn&&Dp.shift();if(null!=(a=(e.ownerDocument||e).$$reactFormReplay))for(n=0;n<a.length;n+=3){var s=a[n],r=a[n+1],i=s[ze]||null;if("function"==typeof r)i||Hp(a);else if(i){var o=null;if(r&&r.hasAttribute("formAction")){if(s=r,i=r[ze]||null)o=i.formAction;else if(null!==Pp(s))continue}else o=i.action;"function"==typeof o?a[n+1]=o:(a.splice(n,3),n-=3),Hp(a)}}}function qp(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return s=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==s&&(s(),s=null),n||setTimeout(a,20)}function a(){if(!n&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var n=!1,s=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==s&&(s(),s=null)}}}function $p(e){this._internalRoot=e}function Xp(e){this._internalRoot=e}Xp.prototype.render=$p.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(n(409));yp(t.current,$c(),e,t,null,null)},Xp.prototype.unmount=$p.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;yp(e.current,2,null,e,null,null),tu(),t[Ue]=null}},Xp.prototype.unstable_scheduleHydration=function(e){if(e){var t=je();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Dp.length&&0!==t&&t<Dp[a].priority;a++);Dp.splice(a,0,e),0===a&&Lp(e)}};var Yp=t.version;if("19.2.3"!==Yp)throw Error(n(527,Yp,"19.2.3"));F.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(n(188));throw e=Object.keys(e).join(","),Error(n(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=r(e)))throw Error(n(188));return t!==e?null:e}for(var a=e,s=t;;){var i=a.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(s=i.return)){a=s;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===a)return u(i),e;if(o===s)return u(i),t;o=o.sibling}throw Error(n(188))}if(a.return!==s.return)a=i,s=o;else{for(var l=!1,c=i.child;c;){if(c===a){l=!0,a=i,s=o;break}if(c===s){l=!0,s=i,a=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===a){l=!0,a=o,s=i;break}if(c===s){l=!0,s=o,a=i;break}c=c.sibling}if(!l)throw Error(n(189))}}if(a.alternate!==s)throw Error(n(190))}if(3!==a.tag)throw Error(n(188));return a.stateNode.current===a?e:t}(t),e=null===(e=null!==e?d(e):null)?null:e.stateNode};var Zp={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.2.3"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Qp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qp.isDisabled&&Qp.supportsFiber)try{ye=Qp.inject(Zp),ge=Qp}catch(em){}}return Ta.createRoot=function(e,t){if(!s(e))throw Error(n(299));var a=!1,r="",i=Co,o=Po,l=Eo;return null!=t&&(!0===t.unstable_strictMode&&(a=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=hp(e,1,!1,null,0,a,r,null,i,o,l,qp),e[Ue]=t.current,td(e),new $p(t)},Ta.hydrateRoot=function(e,t,a){if(!s(e))throw Error(n(299));var r=!1,i="",o=Co,l=Po,c=Eo,u=null;return null!=a&&(!0===a.unstable_strictMode&&(r=!0),void 0!==a.identifierPrefix&&(i=a.identifierPrefix),void 0!==a.onUncaughtError&&(o=a.onUncaughtError),void 0!==a.onCaughtError&&(l=a.onCaughtError),void 0!==a.onRecoverableError&&(c=a.onRecoverableError),void 0!==a.formState&&(u=a.formState)),(t=hp(e,1,!0,t,0,r,i,u,o,l,c,qp)).context=fp(null),a=t.current,(i=xr(r=De(r=$c()))).callback=null,wr(a,i,r),a=r,t.current.lanes=a,Ae(t,a),ju(t),e[Ue]=t.current,td(e),new Xp(t)},Ta.version="19.2.3",Ta}var Da=(Pa||(Pa=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),_a.exports=Fa()),_a.exports);const Ra={},ja=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");n=e(t.map(e=>{if((e=function(e){return"/DEViLBOX/"+e}(e))in Ra)return;Ra[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},Ba=e=>Symbol.iterator in e,La=e=>"entries"in e,Va=(e,t)=>{const a=e instanceof Map?e:new Map(e.entries()),n=t instanceof Map?t:new Map(t.entries());if(a.size!==n.size)return!1;for(const[s,r]of a)if(!n.has(s)||!Object.is(r,n.get(s)))return!1;return!0};function za(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Object.getPrototypeOf(e)===Object.getPrototypeOf(t)&&(Ba(e)&&Ba(t)?La(e)&&La(t)?Va(e,t):((e,t)=>{const a=e[Symbol.iterator](),n=t[Symbol.iterator]();let s=a.next(),r=n.next();for(;!s.done&&!r.done;){if(!Object.is(s.value,r.value))return!1;s=a.next(),r=n.next()}return!!s.done&&!!r.done})(e,t):Va({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})))}function Ua(t){const a=e.useRef(void 0);return e=>{const n=t(e);return za(a.current,n)?a.current:a.current=n}}const Ga=e=>(a,n,s)=>(s.setState=(e,n,...s)=>{const r="function"==typeof e?t(e):e;return a(r,n,...s)},e(s.setState,n,s));function Wa(e){if(!e)return"";if(e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:"))return e;const t="/DEViLBOX/",a=t.endsWith("/")?t.slice(0,-1):t;if(""===a||"/"===a)return e;const n=e.startsWith("/")?e:"/"+e;if(n.startsWith(a))return n;return a+n}function Ha(e,t,a){const n=e.replace(/\.wav$/i,"");return{filename:e,name:n.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/\s+/g," ").trim()||n,category:t,url:Wa(`${a}/${t}/${encodeURIComponent(e)}`)}}const Ka="data/samples/packs/drumnibus",qa={id:"drumnibus",name:"Drumnibus Electro Drums",author:"Legowelt",description:"A collection of 229 electro drum machine samples. Classic analog-style kicks, snares, hi-hats, percussion and FX sounds perfect for electro, techno, and electronic music production.",coverImage:Wa("data/samples/packs/drumnibus/cover.png"),basePath:Ka,categories:["kicks","snares","hihats","percussion","fx"],samples:{kicks:["BB_Electro1short.wav","BD_Drumaxia.wav","BD_Pufsub.wav","BD_808A1200.wav","BD_DiggerLong.wav","BD_Digidap.wav","BD_Digimozzy.wav","BD_Dikkie.wav","BD_Dome_Long.wav","BD_EchoRam1.wav","BD_EchoRam2.wav","BD_Electro1shorter.wav","BD_Juxtapos.wav","BD_Lite2021.wav","BD_LofiHuman.wav","BD_Losamplix.wav","BD_Magnotron..wav","BD_Matrixtape1.wav","BD_Matrixtape2.wav","BD_Plastiklog.wav","BD_Punchtron.wav","BD_Punchysplur.wav","BD_Pziforze.wav","BD_Ritmo.wav","BD_Romkick1.wav","BD_Rubydub.wav","BD_Ruflex.wav","BD_Simpletron.wav","BD_Springworth.wav","BD_Spriverbion.wav","BD_Stuf.wav","BD_SubThud.wav","BD_Zistort.wav"].map(e=>Ha(e,"kicks",Ka)),snares:["SD_808A1200.wav","SD_Analog_Noise_2.wav","SD_Analog_Noise_4.wav","SD_Analog_Noise_5.wav","SD_Analog_Noise1.wav","SD_CompuCrunchy.wav","SD_Digidap.wav","SD_Draconis1.wav","SD_Draconis2.wav","SD_Drumaxia.wav","SD_Echoram1.wav","SD_Echoram2.wav","SD_Echoram3.wav","SD_electro7000.wav","SD_Hark.wav","SD_Juxtapos.wav","SD_Kitcatlitter.wav","SD_LoDigital_1.wav","SD_LoDigital_2.wav","SD_LofiHuman.wav","SD_Magnotron.wav","SD_Mamba.wav","SD_Mambalazesnare.wav","SD_Mambalazesnare2.wav","SD_NomiSnare.wav","SD_NomiSnareLazer.wav","SD_NomiSnareWhip.wav","SD_Punchtron..wav","SD_Reverz1.wav","SD_Reverz2.wav","SD_Reverz3.wav","SD_Ritmo.wav","SD_Rubydubwav.wav","SD_Ruflex.wav","SD_Strakker.wav","SD_Turbosound.wav","SD_Wolf_3.wav","SD_Wolf_5.wav","SD_Wolf_6.wav","SD_Wolf_7.wav","SD_Wolf_8.wav","SD_Wolf_9.wav","SD_Wolf1.wav","SD_Wolf2.wav","SD_Wolfsweep1.wav"].map(e=>Ha(e,"snares",Ka)),hihats:["CH_Digidap.wav","CH_DistortedRitmo.wav","CH_DraconisD921.wav","CH_DraconisD922.wav","CH_Fantio_Closed_Hat.wav","CH_Filtix_Closed_Hat.wav","CH_Juxtapos.wav","CH_LofiHuman.wav","CH_Magnotron.wav","CH_Punchtron.wav","CH_Rezmatix_Closed_Hat.wav","CH_Rubydub.wav","CH_Ruflex.wav","CH_Sizzel_Closed_Hat.wav","CYM_Juxtapos.wav","CYM_Magnotron.wav","CYM_Punchtron.wav","CYM_Ruflex.wav","CYM_Synthique.wav","OH_AnalogHihat1.wav","OH_AnalogOpenhatwav.wav","OH_AnalogVeryLongHat.wav","OH_Digidap.wav","OH_DistortedRitmo.wav","OH_DraconisD921.wav","OH_DraconisD922.wav","OH_Drumaxia.wav","OH_Fantio_Open_Hat.wav","OH_Filtix_Open_Hat.wav","OH_Juxtapos.wav","OH_LofiHuman.wav","OH_Magnotron.wav","OH_Punchtron.wav","OH_Rezmatix_Open_Hat_Long.wav","OH_Rezmatix_Open_Hat.wav","OH_Rubydub.wav","OH_Ruflex.wav","OH_Sizzel_Open_Hat.wav"].map(e=>Ha(e,"hihats",Ka)),claps:[],percussion:["BELL_Darkgong.wav","BELL_Filterbell.wav","BELL_Hypnoschaal.wav","BELL_Hypnoschaal2.wav","BELL_Hypnoschaal3.wav","BONGO_Ryhtmbox.wav","BONGO_Ryhtmbox2.wav","BONGO_Simple.wav","CLAP_Juxtapos.wav","CLAP_LofiHuman.wav","CLAP_Magnotron.wav","CLAP_Punchtron.wav","CLAP_Rubydub.wav","CLAP_Ruflex.wav","CLAVE_Punchtron.wav","CLAVE_Simple.wav","CLAVE_Singalique.wav","CLAVE_Syntheticblox.wav","CONGA_Lowpark.wav","CONGA_Syntique.wav","COW_Syntique.wav","LAZ_Drumaxia.wav","LAZ_Blip1.wav","LAZ_Blip2.wav","LAZ_Blip3.wav","LAZ_Chewy1.wav","LAZ_Digidap.wav","LAZ_Lectrophy.wav","LAZ_Lectrophy2.wav","LAZ_lowvix1.wav","LAZ_lowvix2.wav","LAZ_lowvix3.wav","LAZ_Mambalazesnare.wav","LAZ_R900.wav","LAZ_Softrond.wav","LAZ_Softrond2.wav","LAZ_Softrond3.wav","RIM_Losimple.wav","RIM_Magnotron.wav","RIM_Rubydub.wav","SHAKE_AnalogShaker1.wav","SHAKE_AnalogShaker2.wav","SHAKE_AnalogShaker3.wav","SHAKE_Ritmo.wav","SNAP_Juxtapos.wav","TABLA_Mamba.wav","TAMB_Tamb&Shaker.wav","TAMB_TapeShake1.wav","TAMB_TapeShake2.wav","TAMB_TapeShake3.wav","TOM_digger.wav","TOM_DistortedRitmo.wav","TOM_DistortedRitmoHi.wav","TOM_DraconisDS92.wav","TOM_DraconisDS92high.wav","TOM_Druimaxia.wav","TOM_Juxtapos.wav","TOM_LofiHuman.wav","TOM_Magnotron.wav","TOM_Osciaz.wav","TOM_Punchtron.wav","TOM_Rubydub.wav","TOM_Ruflex.wav","TOM_Stofelectro1.wav","TOM_TamborineTom.wav","TOM_TamborineTom2.wav","TOM_TamborineTom3.wav","TOM_Warped.wav"].map(e=>Ha(e,"percussion",Ka)),fx:["FX_AnalogFX1.wav","FX_AnalogFX2.wav","FX_Blarper.wav","FX_Briesherfst.wav","FX_Briesherfst2.wav","FX_Briesherfst3.wav","FX_Burst1.wav","FX_Burst2.wav","FX_Chainmalz.wav","FX_Digidap2.wav","FX_Digidap3.wav","FX_Drumaxia.wav","FX_Drumaxia2.wav","FX_ElectroIsland.wav","FX_ElectroIsland2.wav","FX_Emerx1.wav","FX_Emerx2.wav","FX_Emerx3.wav","FX_LofiHuman.wav","FX_LofiHuman2.wav","FX_Magstorm1.wav","FX_Magstorm2.wav","FX_NomiElastiek.wav","FX_NomiLaser1.wav","FX_NomiLectric.wav","FX_NomiLectric2.wav","FX_NomiSnip.wav","FX_NomiSpring.wav","FX_Poni1.wav","FX_Poni2.wav","FX_Poni3.wav","FX_Quarkulator.wav","FX_Quarkulator2.wav","FX_Sloiz.wav","FX_Snakamon1.wav","FX_Snakamon2.wav","FX_Snakamon3.wav","FX_Snakamon3B.wav","FX_Snakamon5.wav","FX_Sonar.wav","FX_Sonar2.wav","FX_Sydrum1.wav","FX_Sydrum2.wav","FX_Sydrum3.wav","FX_Timpio.wav"].map(e=>Ha(e,"fx",Ka)),bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},sampleCount:229},$a="data/samples/packs/casio-mt40",Xa=[qa,{id:"casio-mt40",name:"Casio MT-40",author:"Casio",description:"Classic 8-bit instrument sounds from the legendary Casio MT-40 keyboard. Home of the Sleng Teng riddim.",coverImage:Wa("data/samples/packs/casio-mt40/cover.jpg"),basePath:$a,categories:["leads"],samples:{kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:["accordion.wav","banjo.wav","bass.wav","brass.wav","celesta.wav","cello.wav","clarinet.wav","elec piano.wav","flute.wav","folk flute.wav","funny fuzz.wav","glocken.wav","guitar.wav","harpsichord.wav","organ.wav","oriental.wav","pipe-organ.wav","recorder.wav","st ensemble.wav","synth fuzz.wav","trumpet.wav","violin.wav","xylophone.wav"].map(e=>Ha(e,"leads",$a)),pads:[],loops:[],vocals:[],other:[]},sampleCount:23}];const Ya=c(a()),Za={kicks:"kicks",kick:"kicks",bd:"kicks",bassdrum:"kicks","bass drum":"kicks",snares:"snares",snare:"snares",sd:"snares",hihats:"hihats",hihat:"hihats","hi-hats":"hihats","hi-hat":"hihats",hh:"hihats",claps:"claps",clap:"claps",cp:"claps",percussion:"percussion",perc:"percussion",fx:"fx",effects:"fx",sfx:"fx",bass:"bass",leads:"leads",lead:"leads",pads:"pads",pad:"pads",loops:"loops",loop:"loops",vocals:"vocals",vocal:"vocals",vox:"vocals",toms:"percussion",tom:"percussion",cymbals:"hihats",cymbal:"hihats",rides:"hihats",ride:"hihats",crash:"hihats",open:"hihats",closed:"hihats",oh:"hihats",ch:"hihats"},Qa=[".wav",".mp3",".ogg",".flac",".aiff",".aif"],Ja=[".png",".jpg",".jpeg",".webp"];function en(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Qa.includes(t)}function tn(e){const t=e.toLowerCase().substring(e.lastIndexOf("."));return Ja.includes(t)}function an(e){const t=e.toLowerCase();return t.includes("cover")||t.includes("folder")||t.includes("front")||t.includes("artwork")}function nn(e,t){const a=e.toLowerCase();return".ds_store"===a||"thumbs.db"===a||a.startsWith("._")||t.includes("__MACOSX")||e.startsWith(".")}function sn(e){const t=e.toLowerCase().trim();return Za[t]||"other"}function rn(e){const t=e.replace(/\.(wav|mp3|ogg|flac|aiff|aif)$/i,"");return t.replace(/^(BD|SD|CH|OH|CYM|BB|FX|TOM|CLAP|CLAVE|CONGA|COW|BELL|BONGO|RIM|SHAKE|SNAP|TABLA|TAMB|LAZ)_?/i,"").replace(/_/g," ").replace(/-/g," ").replace(/\s+/g," ").trim()||t}const on=n()(Ga(e=>({userPacks:[],uploadZip:async t=>{try{const a=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]},a=e.name.replace(/\.zip$/i,"");let n;const s=[],r=new Set;try{const l=await Ya.loadAsync(e),c=Object.entries(l.files);let u=0;for(const[e,a]of c){if(a.dir)continue;const n=e.split("/").filter(e=>e.length>0);if(0===n.length)continue;const o=n[n.length-1];if(nn(o,e))continue;if(tn(o)){const t=an(o)?2:n.length<=2?1:0;s.push({path:e,filename:o,priority:t});continue}if(!en(o))continue;let l="other";n.length>=2&&(l=sn(n[n.length-2]));try{const e=await a.async("blob"),n=URL.createObjectURL(e),s={filename:o,name:rn(o),category:l,url:n};t[l].push(s),r.add(l),u++}catch(i){}}if(s.length>0){s.sort((e,t)=>t.priority-e.priority);const e=s[0],t=l.files[e.path];if(t)try{const e=await t.async("blob");n=URL.createObjectURL(e)}catch(o){}}const d=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===d)throw new Error("No audio files found in the ZIP.");return{id:`user-${Date.now()}`,name:a,author:"User Upload",description:`User-uploaded sample pack with ${d} samples`,coverImage:n,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:d,isUserUploaded:!0}}catch(l){throw l}}(t);return e(e=>{e.userPacks.push(a)}),a}catch(a){throw a}},uploadDirectory:async t=>{try{const a=await async function(e){const t={kicks:[],snares:[],hihats:[],claps:[],percussion:[],fx:[],bass:[],leads:[],pads:[],loops:[],vocals:[],other:[]};let a,n="";const s=[],r=new Set;for(let l=0;l<e.length;l++){const a=e[l],i=a.webkitRelativePath||a.name;if(nn(a.name,i))continue;const c=i.split("/").filter(e=>e.length>0),u=c[c.length-1];if(c.length>1&&!n&&(n=c[0]),tn(u)){const e=an(u)?2:c.length<=2?1:0;s.push({file:a,priority:e});continue}if(!en(u))continue;let d="other";c.length>=2&&(d=sn(c.length>=3?c[c.length-2]:c[1]));try{const e=URL.createObjectURL(a),n={filename:u,name:rn(u),category:d,url:e};t[d].push(n),r.add(d)}catch(o){}}if(n||(n="Uploaded Pack"),s.length>0){s.sort((e,t)=>t.priority-e.priority);try{a=URL.createObjectURL(s[0].file)}catch(o){}}const i=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===i)throw new Error("No audio files found in the directory.");return{id:`user-${Date.now()}`,name:n,author:"User Upload",description:`User-uploaded sample pack with ${i} samples`,coverImage:a,basePath:"",categories:Array.from(r).filter(e=>t[e].length>0),samples:t,sampleCount:i,isUserUploaded:!0}}(t);return e(e=>{e.userPacks.push(a)}),a}catch(a){throw a}},removeUserPack:t=>{e(e=>{e.userPacks=e.userPacks.filter(e=>e.id!==t)})},clearUserPacks:()=>{e(e=>{e.userPacks=[]})}}))),ln=()=>{const e=on(e=>e.userPacks);return[...Xa,...e]},cn=[null,"#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6b7280"],un={note:!0,instrument:!0,volume:!0,effect:!0,effect2:!0,flag1:!1,flag2:!1,cutoff:!1,resonance:!1,envMod:!1,pan:!1,probability:!1},dn={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0},pn={harmonics:Array.from({length:32},(e,t)=>1/(t+1)),spectralTilt:0,evenOddBalance:0,filter:{type:"lowpass",cutoff:8e3,resonance:1},envelope:{attack:10,decay:300,sustain:70,release:200},lfo:{rate:2,depth:0,target:"pitch"},maxVoices:6},mn={wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},hn={sampleUrl:"",grainSize:100,grainOverlap:50,playbackRate:1,detune:0,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:4,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}},fn={type:"vfx",clock:16e6,romsLoaded:!1,registers:{}},yn={type:"doc",clock:1e6,romsLoaded:!1,registers:{}},gn={type:"swp30",clock:33868800,romsLoaded:!1,registers:{}},bn={moduleData:"",format:"UNKNOWN",useLibopenmpt:!0,repeatCount:0,stereoSeparation:100,interpolationFilter:0},vn={voices:7,detune:30,mix:50,stereoSpread:80,envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},xn={voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100},portamento:0},wn={drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:50,decay:"fast",harmonic:"third"},keyClick:30,vibrato:{type:"C3",depth:50},rotary:{enabled:!0,speed:"slow"}},kn={drumType:"kick",machineType:"909",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},snare:{pitch:220,pitchHigh:476,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},hihat:{tone:50,decay:100,metallic:50},clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},conga:{pitch:310,decay:180,tuning:50},cowbell:{decay:400,filterFreq:2640},rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450},maracas:{decay:30,filterFreq:5e3},cymbal:{tone:50,decay:2e3}},Sn={channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop",swing:0}},Mn={pulseWidth:50,pwmDepth:30,pwmRate:2,pwmWaveform:"sine",oscillators:2,detune:10,envelope:{attack:50,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:4e3,resonance:20,envelopeAmount:30,keyTracking:50},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}},Nn={sections:{violin:100,viola:70,cello:50,bass:30},ensemble:{depth:60,rate:3,voices:4},attack:200,release:1e3,brightness:60},Cn={A:{f1:800,f2:1200,f3:2500},E:{f1:400,f2:2e3,f3:2600},I:{f1:300,f2:2300,f3:3e3},O:{f1:500,f2:800,f3:2500},U:{f1:350,f2:600,f3:2400}},Pn={mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},En={machineType:"ArguruDistortion",parameters:{}},_n={vowel:"A",vowelMorph:{target:"O",amount:0,rate:1,mode:"manual"},oscillator:{type:"sawtooth"},formants:{...Cn.A,bandwidth:100},envelope:{attack:50,decay:500,sustain:0,release:100},brightness:70},Tn={VOL:0,ARP:1,DUTY:2,WAVE:3,PITCH:4,EX1:5,EX2:6,EX3:7,ALG:8,FB:9,FMS:10,AMS:11,PAN_L:12,PAN_R:13,PHASE_RESET:14,EX4:15,EX5:16,EX6:17,EX7:18,EX8:19},An={chipType:1,algorithm:4,feedback:4,fms:0,ams:0,fms2:0,ams2:0,ops:4,opllPreset:0,fixedDrums:!1,operators:[{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:50,ar:28,dr:6,d2r:2,sl:4,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:10,d2r:4,sl:2,rr:6,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0},{enabled:!0,mult:1,tl:0,ar:31,dr:8,d2r:3,sl:3,rr:5,dt:0,dt2:0,rs:0,am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0,dam:0,dvb:0,egt:!1,kvs:0}],macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]},On={algorithm:0,feedback:0,oscSync:!0,operators:Array.from({length:6},()=>({level:99,coarse:1,fine:0,detune:7,mode:"ratio",egRates:[99,99,99,99],egLevels:[99,99,99,0],breakPoint:0,leftDepth:0,rightDepth:0,leftCurve:0,rightCurve:0,rateScaling:0,ampModSens:0,velocitySens:0})),pitchEgRates:[99,99,99,99],pitchEgLevels:[50,50,50,50],lfoSpeed:35,lfoDelay:0,lfoPitchModDepth:0,lfoAmpModDepth:0,lfoSync:!1,lfoWave:"triangle",lfoPitchModSens:0,transpose:0,name:"INIT VOICE"},In={osc1Waveform:"saw",osc1Octave:0,osc1Detune:0,osc1PulseWidth:.5,osc1Level:1,osc2Waveform:"saw",osc2Octave:0,osc2Detune:.1,osc2PulseWidth:.5,osc2Level:.7,oscSync:!1,oscXor:!1,filterCutoff:.7,filterResonance:.3,filterType:"lp24",filterEnvAmount:.5,filterKeyTrack:0,filterVelocity:.3,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:"sine",lfoDelay:0,lfoOscAmount:0,lfoFilterAmount:0,lfoAmpAmount:0,lfoPwAmount:0,masterVolume:.7,voices:8,unison:!1,unisonDetune:.1,portamento:0,panSpread:.3,velocitySensitivity:.5,noiseLevel:0,subOscLevel:0,subOscOctave:-1,drift:.02},Fn={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1},Dn={keymap:[],polyphony:"poly",maxVoices:8,noteCut:!1},Rn={enabled:!1,waveform:"sine",rate:5,sync:!1,syncDivision:"1/4",filterAmount:0,filterTarget:"cutoff",pitchAmount:0,volumeAmount:0,phase:0,retrigger:!0},jn={oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"square",rate:2,depth:100},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:1.5,wet:.1}},Bn={text:"COMMODORE SIXTY FOUR",pitch:64,speed:72,mouth:128,throat:128,singmode:!0,phonetic:!1,vowelSequence:[],vowelLoopSingle:!0},Ln={moduleUrl:"",pluginState:null,pluginStateVersion:1,pluginStateTimestamp:0},Vn={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0,vowelSequence:[],vowelLoopSingle:!0},zn={osc1:{mode:1,transpose:0,detune:0,color:64,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:10,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:-10,color:64,level:0},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:127,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:32},envelope2:{attack:0,decay:64,sustain:127,release:32},lfo1:{rate:64,depth:0}},Un={laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:40,ratio:2.5},noise:{amount:10,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:40},delay:{enabled:!0,time:.3,feedback:.5,wet:.4},reverb:{enabled:!0,decay:2,wet:.2}},Gn={oscillator:{type:"square",tune:200,fine:0},oscillator2:{enabled:!1,detune:0,mix:.5},noise:{enabled:!0,type:"white",mix:.2,color:100},filter:{cutoff:800,resonance:60,envMod:70,decay:200},lfo:{enabled:!1,rate:5,depth:0,target:"pitch"},envelope:{decay:300,sustain:0},sweep:{enabled:!0,amount:24,time:150}},Wn={type:"sawtooth",detune:0,octave:0},Hn={attack:10,decay:500,sustain:0,release:100},Kn={type:"lowpass",frequency:2e3,Q:1,rolloff:-24},qn={engineType:"db303",volume:1,oscillator:{type:"sawtooth",pulseWidth:0,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.5},accent:{amount:.5},slide:{time:.17,mode:"exponential"},overdrive:{amount:0},devilFish:{enabled:!0,normalDecay:.164,accentDecay:.006,softAttack:0,accentSoftAttack:.1,passbandCompensation:.09,resTracking:.257,filterInputDrive:.169,filterSelect:0,diodeCharacter:1,duffingAmount:.03,filterFmDepth:0,lpBpMix:0,filterTracking:0,stageNLAmount:0,ensembleAmount:0,korgEnabled:!1,oversamplingOrder:2,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},lfo:{enabled:!1,waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:3,feedback:.3,tone:.5,mix:0,stereo:.5}},$n=[{id:"straight",name:"Straight",category:"straight",description:"No groove, all rows on the grid",values:[0,0]},{id:"light-shuffle",name:"Light Shuffle",category:"shuffle",description:"Subtle rhythmic bounce (16th)",values:[0,8],velocityOffsets:[0,-.05]},{id:"medium-shuffle",name:"Medium Shuffle",category:"shuffle",description:"Classic bouncy shuffle feel",values:[0,16],velocityOffsets:[0,-.1]},{id:"heavy-shuffle",name:"Heavy Shuffle",category:"shuffle",description:"Strong triplet-style bounce",values:[0,25],velocityOffsets:[0,-.15]},{id:"triplet",name:"Full Triplet",category:"shuffle",description:"True 2:1 triplet timing (66%)",values:[0,33],velocityOffsets:[0,-.2]},{id:"mpc-50",name:"MPC 50%",category:"swing",description:"MPC straight (no swing)",values:[0,0]},{id:"mpc-54",name:"MPC 54%",category:"swing",description:"MPC light swing",values:[0,8],velocityOffsets:[0,-.08]},{id:"mpc-58",name:"MPC 58%",category:"swing",description:"MPC medium swing",values:[0,16],velocityOffsets:[0,-.12]},{id:"mpc-62",name:"MPC 62%",category:"swing",description:"MPC heavy swing",values:[0,25],velocityOffsets:[0,-.18]},{id:"mpc-66",name:"MPC 66%",category:"swing",description:"MPC maximum swing",values:[0,33],velocityOffsets:[0,-.25]},{id:"funk-16th",name:"Funk 16th",category:"funk",description:"16th note funk groove",values:[0,5,-3,10],velocityOffsets:[.1,-.2,.05,-.3],suggestedBpmRange:[90,130]},{id:"funk-lazy",name:"Lazy Funk",category:"funk",description:"Relaxed funk feel, everything slightly late",values:[3,8,5,12],velocityOffsets:[.05,-.1,.05,-.15],suggestedBpmRange:[80,110]},{id:"funk-tight",name:"Tight Funk",category:"funk",description:"Rushed funk feel, snappy timing",values:[-2,5,-5,8],velocityOffsets:[.15,-.15,.1,-.2],suggestedBpmRange:[100,140]},{id:"boom-bap",name:"Boom Bap",category:"hip-hop",description:"Classic 90s hip-hop swing",values:[0,12,0,8],velocityOffsets:[.1,-.15,.05,-.1],suggestedBpmRange:[85,100]},{id:"lo-fi",name:"Lo-Fi",category:"hip-hop",description:"Drunk/loose timing for lo-fi beats",values:[5,15,-3,18],velocityOffsets:[-.05,-.2,-.1,-.25],suggestedBpmRange:[70,95]},{id:"trap-triplet",name:"Trap Triplet",category:"hip-hop",description:"Triplet hi-hat groove for trap",values:[0,22,11,33,0,22],velocityOffsets:[.1,-.2,-.1,-.3,.05,-.25],suggestedBpmRange:[130,160]},{id:"drunken",name:"Drunken Master",category:"custom",description:"Irregular timing for experimental feel",values:[0,8,-5,15,3,20,-8,12],velocityOffsets:[0,-.1,.05,-.2,.1,-.15,.05,-.3]},{id:"push-pull",name:"Push-Pull",category:"custom",description:"Alternating early/late for tension",values:[-10,10,-10,10],velocityOffsets:[.1,-.1,.1,-.1]}];function Xn(e,t,a="linear",n="curve"){if(0===e.length)return null;let s=null,r=null;for(let i=0;i<e.length;i++)if(e[i].row<=t&&(s=e[i]),e[i].row>=t){r=e[i];break}if(s&&s.row===t)return s.value;if(r&&r.row===t)return r.value;if(!s&&r)return r.value;if(s&&!r)return s.value;if("steps"===n)return s?s.value:null;if(s&&r){const e=(t-s.row)/(r.row-s.row),n=r.value-s.value;switch(a){case"linear":default:return s.value+n*e;case"exponential":return s.value+n*(e*e);case"easeIn":return s.value+n*(e*e*e);case"easeOut":{const t=1-e;return s.value+n*(1-t*t*t)}case"easeBoth":if(e<.5)return s.value+n*(4*e*e*e);{const t=2*e-2;return s.value+n*(1+t*t*t/2)}}}return null}const Yn=[{id:"ramp-up",name:"Ramp Up",shape:"rampUp",points:[{row:0,value:0},{row:63,value:1}]},{id:"ramp-down",name:"Ramp Down",shape:"rampDown",points:[{row:0,value:1},{row:63,value:0}]},{id:"triangle",name:"Triangle",shape:"triangle",points:[{row:0,value:0},{row:31,value:1},{row:63,value:0}]},{id:"sine",name:"Sine Wave",shape:"sine",points:Array.from({length:64},(e,t)=>({row:t,value:(Math.sin(t/64*Math.PI*2)+1)/2}))}];(new Date).toISOString(),(new Date).toISOString();const Zn=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function Qn(e){if(null===e||""===e||"..."===e)return 0;if("==="===e||"OFF"===e)return 97;const t=e.match(/^([A-G])([#-])(\d)$/);if(!t)return 0;const[,a,n,s]=t,r=parseInt(s,10),i=a+n,o=Zn.indexOf(i);if(-1===o)return 0;const l=12*r+o+1;return l<1||l>96?0:l}function Jn(e){if(0===e)return"...";if(97===e)return"===";if(e<1||e>96)return"...";const t=e-1,a=Math.floor(t/12);return`${Zn[t%12]}${a}`}const es={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,K:20,L:21,P:25,R:27,T:29,X:33},ts=Object.fromEntries(Object.entries(es).map(([e,t])=>[t,e]));function as(e){if(!e||"..."===e||"000"===e)return[0,0];const t=e.match(/^([0-9A-Z])([0-9A-F]{2})$/i);if(!t)return[0,0];const[,a,n]=t;return[es[a.toUpperCase()]??0,parseInt(n,16)]}function ns(e,t){if(0===e&&0===t)return"...";return`${ts[e]??"0"}${t.toString(16).toUpperCase().padStart(2,"0")}`}function ss(e){return 0===e||97===e||e<1||e>96?null:e+11}function rs(e){const t=e-11;return Math.min(96,Math.max(1,t))}function is(e){if(!e||"object"!=typeof e)return!1;const t=e;if(!t.output||"object"!=typeof t.output)return!1;const a=t.output,n="function"==typeof a.connect&&"function"==typeof a.disconnect&&"number"==typeof a.numberOfOutputs&&"function"!=typeof a.toDestination,s="function"==typeof t.toDestination;return n&&!s}const os=globalThis,ls=os.BaseAudioContext||os.AudioContext||os.webkitAudioContext;let cs=null;function us(){if(!cs)throw new Error("[audio-context] AudioContext not initialized  ToneEngine must be created first");return cs}function ds(e){if(!e)throw new Error("[audio-context] getNativeContext called with null/undefined context");if(ls&&e instanceof ls)return e;const t=[e],a=new Set;let n=0;for(;t.length>0&&n<50;){const e=t.shift();if(e&&!a.has(e)){if(a.add(e),n++,ls&&e instanceof ls)return e;e.rawContext&&t.push(e.rawContext),e._nativeAudioContext&&t.push(e._nativeAudioContext),e.nativeContext&&t.push(e.nativeContext),e.baseAudioContext&&t.push(e.baseAudioContext),e.context&&t.push(e.context),e._context&&t.push(e._context)}}return e}function ps(e){if(!e||"object"!=typeof e)return!1;const t=os.AudioNode;if(t&&e instanceof t){const t=e;return!("function"==typeof t.toDestination||"function"==typeof t.toMaster)}return!1}function ms(e){return e&&"object"==typeof e?ps(e)?e:e._nativeAudioNode&&ps(e._nativeAudioNode)?e._nativeAudioNode:null:null}function hs(e){if(!e)return null;if(ps(e))return e;const t=[e.input,e.output,e._gainNode,e._node,e._input,e._output,e._nativeNode,e._nativeAudioNode];for(const a of t){const e=ms(a);if(e)return e}if(e.input&&"object"==typeof e.input){const t=e.input,a=[t._gainNode,t._node,t.input,t._nativeAudioNode];for(const e of a){const t=ms(e);if(t)return t}}return null}const fs=/^([A-Ga-g])([#b]?)(-?\d+)$/,ys={C:0,D:2,E:4,F:5,G:7,A:9,B:11};function gs(e){if("number"==typeof e)return Math.max(0,Math.min(127,Math.round(12*Math.log2(e/440)+69)));const t=e.match(fs);if(!t)return 60;const[,a,n,s]=t,r=ys[a.toUpperCase()]??0,i="#"===n?1:"b"===n?-1:0,o=parseInt(s);return Math.max(0,Math.min(127,12*(o+1)+r+i))}function bs(e){if("number"==typeof e)return e>=0&&e<=127&&Number.isInteger(e)?440*Math.pow(2,(e-69)/12):e;const t=gs(e);return 440*Math.pow(2,(t-69)/12)}function vs(){return cs?cs.currentTime:0}function xs(e,t=120){if("number"==typeof e)return e;const a=e.match(/^(\d+)n$/);if(a){return 4/parseInt(a[1])*(60/t)}const n=parseFloat(e);return isNaN(n)?0:n}const ws="cutoff",ks="cutoffHz",Ss="resonance",Ms="envMod",Ns="envModPercent",Cs="decay",Ps="accent",Es="waveform",_s="pulseWidth",Ts="pitchToPw",As="subOscGain",Os="subOscBlend",Is="normalDecay",Fs="accentDecay",Ds="softAttack",Rs="accentSoftAttack",js="passbandCompensation",Bs="resTracking",Ls="filterInputDrive",Vs="filterSelect",zs="diodeCharacter",Us="duffingAmount",Gs="filterFmDepth",Ws="korgIbiasScale",Hs="korgBite",Ks="korgClip",qs="korgCrossmod",$s="korgQSag",Xs="korgSharpness",Ys="korgWarmth",Zs="korgStiffness",Qs="korgFilterFm",Js="lpBpMix",er="filterTracking",tr="stageNLAmount",ar="ensembleAmount",nr="slideTime",sr="lfoRate",rr="lfoContour",ir="lfoPitchDepth",or="lfoPwmDepth",lr="lfoFilterDepth",cr="lfoStiffDepth",ur="chorusMix",dr="phaserLfoRate",pr="phaserLfoWidth",mr="phaserFeedback",hr="phaserMix",fr="delayTime",yr="delayFeedback",gr="delayTone",br="delayMix",vr="delaySpread",xr="tuning",wr="volume",kr="lfoWaveform",Sr="chorusMode",Mr="oversamplingOrder";function Nr(){return"undefined"!=typeof window&&!!window.DB303_TRACE}class Cr{name="DB303Synth";output;workletNode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;overdrive=null;overdriveGain=null;overdriveAmount=0;config={};audioContext;_disposed=!1;_initPromise;_resolveInit=null;_pendingParams=[];_releaseTimeout=null;constructor(){this.audioContext=us(),this.output=this.audioContext.createGain(),this._initPromise=new Promise(e=>{this._resolveInit=e}),this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{if(await Cr.ensureInitialized(this.audioContext),this._disposed)return;this.createNode()}catch(e){}}static wasmBinary=null;static jsCode=null;static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}db303/DB303.worklet.js`)}catch{}if(!this.wasmBinary||!this.jsCode){const[e,a]=await Promise.all([fetch(`${t}db303/DB303.wasm`),fetch(`${t}db303/DB303.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar DB303 = createDB303Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}createNode(){if(this._disposed)return;const e=this.audioContext;if(this.workletNode=new AudioWorkletNode(e,"db303-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?this._resolveInit&&(this._resolveInit(),this._resolveInit=null):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:Cr.wasmBinary,jsCode:Cr.jsCode}),this._pendingParams.length>0){for(const{paramId:e,value:t}of this._pendingParams)this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t});this._pendingParams=[]}this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch{}}_savedSlideTime=.5;_currentSlideTime=.5;triggerAttack(e,t,a=1,n=!1,s=!1,r=!1){if(!this.workletNode||this._disposed)return;null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null);const i="string"==typeof e?gs(e):Math.round(12*Math.log2(e/440)+69);let o=Math.floor(127*a);if(n&&o<100&&(o=127),!n&&o>=100&&(o=99),"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=Math.floor(i/12)-1;e[i%12]}r&&(this._savedSlideTime=this._currentSlideTime,this.setSlideTime(0));const l=t??vs();this.workletNode.port.postMessage({type:"noteOn",time:l,note:i,velocity:o,slide:s}),r&&setTimeout(()=>{this._disposed||this.setSlideTime(this._savedSlideTime)},50)}triggerRelease(e){if(!this.workletNode||this._disposed)return;const t=e??vs();this.workletNode.port.postMessage({type:"gateOff",time:t})}releaseAll(){this.workletNode&&!this._disposed&&(null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode.port.postMessage({type:"allNotesOff"}))}noteOn(e,t,a,n){const s=bs(e);this.triggerAttack(s,void 0,t/127,a,n,!1)}noteOff(){this.triggerRelease()}triggerAttackRelease(e,t,a,n,s=!1,r=!1,i=!1){if(this._disposed)return;const o=a??vs();this.triggerAttack(e,o,n||1,s,r,i);const l=1e3*(o+xs(t)-vs());null!==this._releaseTimeout&&clearTimeout(this._releaseTimeout),this._releaseTimeout=setTimeout(()=>{this._releaseTimeout=null,this._disposed||this.triggerRelease()},Math.max(0,l))}setParameterByName(e,t){if(!this._disposed){if(!this.workletNode){const a=this._pendingParams.findIndex(t=>t.paramId===e);return void(a>=0?this._pendingParams[a].value=t:this._pendingParams.push({paramId:e,value:t}))}Nr(),this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}}set(e,t){switch(Nr(),e){case"cutoff":this.setCutoff(t);break;case"resonance":this.setResonance(t);break;case"envMod":this.setEnvMod(t);break;case"decay":this.setDecay(t);break;case"accent":this.setAccent(t);break;case"tuning":this.setTuning(t);break;case"volume":this.setVolume(t);break;case"waveform":this.setWaveform(t);break;case"slideTime":this.setSlideTime(t);break;case"overdrive":this.setOverdrive(t);break;case"pulseWidth":this.setPulseWidth(t);break;case"subOscGain":this.setSubOscGain(t);break;case"subOscBlend":this.setSubOscBlend(t);break;case"pitchToPw":this.setPitchToPw(t);break;case"normalDecay":this.setNormalDecay(t);break;case"accentDecay":this.setAccentDecay(t);break;case"softAttack":this.setSoftAttack(t);break;case"accentSoftAttack":this.setAccentSoftAttack(t);break;case"filterTracking":this.setFilterTracking(t);break;case"filterFmDepth":this.setFilterFmDepth(t),this.setKorgFilterFm(t);break;case"filterInputDrive":this.setFilterInputDrive(t);break;case"passbandCompensation":this.setPassbandCompensation(1-t);break;case"resTracking":this.setResTracking(1-t),this.setKorgIbiasScale(.1+3.9*t);break;case"diodeCharacter":this.setDiodeCharacter(t),this.setKorgWarmth(t);break;case"duffingAmount":{this.setDuffingAmount(t);const e=Math.abs(t)<.16?0:(t>0?1:-1)*(Math.abs(t)-.16)/.84;this.setKorgStiffness(e);break}case"lpBpMix":this.setLpBpMix(t);break;case"korgBite":this.setKorgBite(t);break;case"korgClip":this.setKorgClip(t);break;case"korgCrossmod":this.setKorgCrossmod(t);break;case"korgQSag":this.setKorgQSag(t);break;case"korgSharpness":this.setKorgSharpness(t);break;case"stageNLAmount":this.setStageNLAmount(t);break;case"ensembleAmount":this.setEnsembleAmount(t);break;case"lfoRate":this.setLfoRate(t);break;case"lfoContour":this.setLfoContour(t);break;case"lfoPitchDepth":this.setLfoPitchDepth(t);break;case"lfoPwmDepth":this.setLfoPwmDepth(t);break;case"lfoFilterDepth":this.setLfoFilterDepth(t);break;case"lfoStiffDepth":this.setLfoStiffDepth(t);break;case"phaserRate":this.setPhaserRate(t);break;case"phaserWidth":this.setPhaserWidth(t);break;case"phaserFeedback":this.setPhaserFeedback(t);break;case"phaserMix":this.setPhaserMix(t);break;case"delayTime":this.setDelayTime(t);break;case"delayFeedback":this.setDelayFeedback(t);break;case"delayTone":this.setDelayTone(t);break;case"delayMix":this.setDelayMix(t);break;case"delaySpread":this.setDelaySpread(t);break;case"filterSelect":this.setFilterSelect(t);break;case"chorusMode":this.setChorusMode(t);break;case"chorusMix":this.setChorusMix(t);break;case"lfoWaveform":this.setLfoWaveform(t);break;case"oversamplingOrder":this.setOversamplingOrder(t);break;case"vegDecay":this.setVegDecay(t);break;case"vegSustain":this.setVegSustain(t);break;case"filterFM":this.setFilterFmDepth(t)}}setCutoff(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ws,t)}setResonance(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ss,t)}setEnvMod(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ms,t)}setDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Cs,t),this.setParameterByName("normalDecay",t)}setAccent(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ps,t)}setAccentAmount(e){this.setAccent(e)}setSlideTime(e){const t=Math.max(0,Math.min(1,e));this._currentSlideTime=e,this.setParameterByName(nr,t)}setVolume(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(wr,t)}setWaveform(e){this.setParameterByName(Es,e)}setTuning(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(xr,t)}setLfoWaveform(e){this.setParameterByName(kr,e)}setLfoRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(sr,t)}setLfoContour(e){this.setParameterByName(rr,e)}setLfoPitchDepth(e){this.setParameterByName(ir,e)}setLfoPwmDepth(e){this.setParameterByName(or,e)}setLfoFilterDepth(e){this.setParameterByName(lr,e)}setLfoStiffDepth(e){this.setParameterByName(cr,e)}setNormalDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Is,t)}setAccentDecay(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Fs,t)}setSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Ds,t)}setAccentSoftAttack(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(Rs,t)}setPassbandCompensation(e){this.setParameterByName(js,e)}setFeedbackHighpass(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName("feedbackHighpass",t)}setResTracking(e){this.setParameterByName(Bs,e)}setFilterInputDrive(e){this.setParameterByName(Ls,e)}setFilterSelect(e){this.setParameterByName(Vs,e)}setDiodeCharacter(e){this.setParameterByName(zs,e)}setDuffingAmount(e){let t;if(Math.abs(e)<.16)t=0;else{t=(e>0?1:-1)*(Math.abs(e)-.16)/.84}this.setParameterByName(Us,t)}setFilterFmDepth(e){this.setParameterByName(Gs,e)}setLpBpMix(e){this.setParameterByName(Js,e)}setFilterTracking(e){this.setParameterByName(er,e)}setKorgWarmth(e){this.setParameterByName(Ys,e)}setKorgStiffness(e){this.setParameterByName(Zs,e)}setKorgFilterFm(e){this.setParameterByName(Qs,e)}setKorgIbiasScale(e){this.setParameterByName(Ws,e)}setKorgBite(e){this.setParameterByName(Hs,e)}setKorgClip(e){this.setParameterByName(Ks,e)}setKorgCrossmod(e){this.setParameterByName(qs,e)}setKorgQSag(e){this.setParameterByName($s,e)}setKorgSharpness(e){this.setParameterByName(Xs,e)}setPitchToPw(e){this.setParameterByName(Ts,e)}setCutoffHz(e){this.setParameterByName(ks,Math.max(10,Math.min(5e3,e)))}setEnvModPercent(e){this.setParameterByName(Ns,Math.max(0,Math.min(300,e)))}setStageNLAmount(e){this.setParameterByName(tr,e)}setEnsembleAmount(e){this.setParameterByName(ar,e)}setChorusMode(e){this.setParameterByName(Sr,e)}setOversamplingOrder(e){this.setParameterByName(Mr,e)}setPulseWidth(e){this.setParameterByName(_s,e)}setSubOscGain(e){this.setParameterByName(As,e)}setSubOscBlend(e){this.setParameterByName(Os,e)}setChorusMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(ur,t)}setPhaserRate(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(dr,t)}setPhaserWidth(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(pr,t)}setPhaserFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(mr,t)}setPhaserMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(hr,t)}setDelayTime(e){const t=Math.max(0,Math.min(16,e));this.setParameterByName(fr,t)}setDelayFeedback(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(yr,t)}setDelayTone(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(gr,t)}setDelayMix(e){const t=Math.max(0,Math.min(1,e));this.setParameterByName(br,t)}setDelaySpread(e){this.setParameterByName(vr,e)}setOverdrive(e){if(this._disposed||!this.workletNode)return;this.overdriveAmount=Math.max(0,Math.min(1,e));const t=this.audioContext.currentTime;if(this.overdriveAmount>0){this.overdrive&&this.overdriveGain||(this.overdriveGain=this.audioContext.createGain(),this.overdrive=this.audioContext.createWaveShaper());const e=new Float32Array(4096),a=1+8*this.overdriveAmount;for(let t=0;t<4096;t++){const n=t/4096*2-1;e[t]=Math.tanh(n*a)/Math.tanh(a)}this.overdrive.curve=e,this.overdriveGain.gain.linearRampToValueAtTime(1+2*this.overdriveAmount,t+.03);try{this.workletNode.disconnect(this.output)}catch{}try{this.workletNode.connect(this.overdriveGain),this.overdriveGain.connect(this.overdrive),this.overdrive.connect(this.output)}catch{}}else{if(this.overdrive&&this.overdriveGain){try{this.workletNode.disconnect(this.overdriveGain),this.overdriveGain.disconnect(this.overdrive),this.overdrive.disconnect(this.output)}catch{}this.overdriveGain.gain.linearRampToValueAtTime(1,t+.03)}try{this.workletNode.connect(this.output)}catch{}}}setVegDecay(e){}setVegSustain(e){}setFilterFM(e){this.setFilterFmDepth(e/100)}setMuffler(e){switch(e){case"soft":this.setOverdrive(.15);break;case"hard":this.setOverdrive(.45);break;case"dark":this.setOverdrive(.3);break;case"mid":this.setOverdrive(.25);break;case"bright":this.setOverdrive(.35);break;default:this.setOverdrive(0)}}setSweepSpeed(e){}setHighResonanceEnabled(e){}setAccentSweepEnabled(e){}setChorusEnabled(e){e||this.setParameterByName(ur,0)}setPhaserEnabled(e){e||this.setParameterByName(hr,0)}setPhaserDepth(e){this.setParameterByName(pr,e)}setDelayEnabled(e){e||this.setParameterByName(br,0)}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}enableDevilFish(e){}setHighResonance(e){}applyConfig(e){const t=e.devilFish;if(Nr()){Object.keys(e).filter(t=>void 0!==e[t])}if(void 0!==e.tuning&&this.setTuning(e.tuning),void 0!==e.volume&&this.setVolume(e.volume),e.filter){if(e.devilFish?.extendedCutoff){const t=10*Math.pow(500,e.filter.cutoff);this.setCutoffHz(t)}else this.setCutoff(e.filter.cutoff);this.setResonance(e.filter.resonance)}if(e.filterEnvelope&&(e.devilFish?.extendedEnvMod?this.setEnvModPercent(300*e.filterEnvelope.envMod):this.setEnvMod(e.filterEnvelope.envMod),this.setDecay(e.filterEnvelope.decay)),e.accent&&this.setAccent(e.accent.amount),e.slide&&this.setSlideTime(e.slide.time),e.overdrive&&this.setOverdrive(e.overdrive.amount),e.oscillator){const t=void 0!==e.oscillator.waveformBlend?e.oscillator.waveformBlend:"square"===e.oscillator.type?1:0;this.setWaveform(t),void 0!==e.oscillator.pulseWidth&&this.setPulseWidth(e.oscillator.pulseWidth),void 0!==e.oscillator.subOscGain&&this.setSubOscGain(e.oscillator.subOscGain),void 0!==e.oscillator.subOscBlend&&this.setSubOscBlend(e.oscillator.subOscBlend),void 0!==e.oscillator.pitchToPw&&this.setPitchToPw(e.oscillator.pitchToPw)}if(t){if(this.enableDevilFish(!0),void 0!==t.oversamplingOrder&&this.setOversamplingOrder(t.oversamplingOrder),void 0!==t.filterSelect&&this.setFilterSelect(t.filterSelect),void 0!==t.filterTracking&&this.setFilterTracking(t.filterTracking),void 0!==t.filterFmDepth&&(this.setFilterFmDepth(t.filterFmDepth),this.setKorgFilterFm(t.filterFmDepth)),void 0!==t.filterInputDrive&&this.setFilterInputDrive(t.filterInputDrive),void 0!==t.passbandCompensation&&this.setPassbandCompensation(1-t.passbandCompensation),void 0!==t.resTracking&&(this.setResTracking(1-t.resTracking),this.setKorgIbiasScale(.1+3.9*t.resTracking)),void 0!==t.duffingAmount){this.setDuffingAmount(t.duffingAmount);const e=t.duffingAmount,a=Math.abs(e)<.16?0:(e>0?1:-1)*(Math.abs(e)-.16)/.84;this.setKorgStiffness(a)}void 0!==t.lpBpMix&&this.setLpBpMix(t.lpBpMix),void 0!==t.diodeCharacter&&(this.setDiodeCharacter(t.diodeCharacter),this.setKorgWarmth(t.diodeCharacter)),void 0!==t.stageNLAmount&&this.setStageNLAmount(t.stageNLAmount),void 0!==t.ensembleAmount&&this.setEnsembleAmount(t.ensembleAmount)}t&&(void 0!==t.normalDecay&&this.setNormalDecay(t.normalDecay),void 0!==t.accentDecay&&this.setAccentDecay(t.accentDecay),void 0!==t.softAttack&&this.setSoftAttack(t.softAttack),void 0!==t.accentSoftAttack&&this.setAccentSoftAttack(t.accentSoftAttack),void 0!==t.muffler&&this.setMuffler(t.muffler),void 0!==t.sweepSpeed&&this.setSweepSpeed(t.sweepSpeed),void 0!==t.highResonance&&this.setHighResonanceEnabled(t.highResonance)),t?.korgEnabled?(void 0!==t.korgBite&&this.setKorgBite(t.korgBite),void 0!==t.korgClip&&this.setKorgClip(t.korgClip),void 0!==t.korgCrossmod&&this.setKorgCrossmod(t.korgCrossmod),void 0!==t.korgQSag&&this.setKorgQSag(t.korgQSag),void 0!==t.korgSharpness&&this.setKorgSharpness(t.korgSharpness)):t&&(this.setKorgBite(0),this.setKorgClip(0),this.setKorgCrossmod(0),this.setKorgQSag(0),this.setKorgSharpness(.5));const a=e.lfo;a?.enabled?(void 0!==a.waveform&&this.setLfoWaveform(a.waveform),void 0!==a.rate&&this.setLfoRate(a.rate),void 0!==a.contour&&this.setLfoContour(a.contour),void 0!==a.pitchDepth&&this.setLfoPitchDepth(a.pitchDepth),void 0!==a.pwmDepth&&this.setLfoPwmDepth(a.pwmDepth),void 0!==a.filterDepth&&this.setLfoFilterDepth(a.filterDepth),void 0!==a.stiffDepth&&this.setLfoStiffDepth(a.stiffDepth)):(this.setLfoRate(0),this.setLfoPitchDepth(0),this.setLfoPwmDepth(0),this.setLfoFilterDepth(0),this.setLfoStiffDepth(0)),e.chorus&&(void 0!==e.chorus.mode&&this.setChorusMode(e.chorus.mode),this.setChorusMix(e.chorus.enabled?e.chorus.mix??0:0)),e.phaser&&(void 0!==e.phaser.rate&&this.setPhaserRate(e.phaser.rate),void 0!==e.phaser.depth&&this.setPhaserWidth(e.phaser.depth),void 0!==e.phaser.feedback&&this.setPhaserFeedback(e.phaser.feedback),this.setPhaserMix(e.phaser.enabled?e.phaser.mix??0:0)),e.delay&&(void 0!==e.delay.time&&this.setDelayTime(e.delay.time),void 0!==e.delay.feedback&&this.setDelayFeedback(e.delay.feedback),void 0!==e.delay.tone&&this.setDelayTone(e.delay.tone),this.setDelayMix(e.delay.enabled?e.delay.mix??0:0),void 0!==e.delay.stereo&&this.setDelaySpread(e.delay.stereo))}getDiagnostics(){return new Promise(e=>{if(!this.workletNode)return void e({});const t=a=>{"diagnostics"===a.data.type&&(this.workletNode?.port.removeEventListener("message",t),e(a.data))};this.workletNode.port.addEventListener("message",t),this.workletNode.port.postMessage({type:"getDiagnostics"}),setTimeout(()=>e({}),500)})}dispose(){this._disposed=!0,null!==this._releaseTimeout&&(clearTimeout(this._releaseTimeout),this._releaseTimeout=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveGain&&(this.overdriveGain.disconnect(),this.overdriveGain=null),this.output.disconnect()}}const Pr="vfx",Er="rsa",_r="swp30",Tr={vfx:0,doc:1,rsa:2,swp30:3,segapcm:4,ga20:5,upd933:6};class Ar{static instance;module=null;isInitialized=!1;heapU8=null;constructor(){}static getInstance(){return Ar.instance||(Ar.instance=new Ar),Ar.instance}async init(){if(this.isInitialized)return;const e="/DEViLBOX/";try{const t=await fetch(`${e}mame/MAMEChips.js`),a=await t.text(),n=new Function(`${a}; return MAMEChips;`)(),s=await fetch(`${e}mame/MAMEChips.wasm`),r=await s.arrayBuffer();this.module=await n({wasmBinary:r}),this.module&&this.module.wasmMemory&&(this.heapU8=new Uint8Array(this.module.wasmMemory.buffer)),this.isInitialized=!0}catch(t){throw new Error(`MAMEChips WASM failed to load: ${t}`)}}createInstance(e,t){if(!this.isInitialized||!this.module)return 0;const a=Tr[e];return this.module._mame_create_instance(a,t)}deleteInstance(e){this.isInitialized&&0!==e&&this.module&&this.module._mame_delete_instance(e)}write(e,t,a){this.isInitialized&&0!==e&&this.module&&this.module._mame_write(e,t,a)}write16(e,t,a){this.isInitialized&&0!==e&&this.module&&this.module._mame_write16(e,t,a)}read(e,t){return this.isInitialized&&0!==e&&this.module?this.module._mame_read(e,t):0}setRom(e,t){if(!this.isInitialized||!this.heapU8||!this.module)return;const a=this.module._malloc(t.length);this.heapU8.set(t,a),this.module._mame_set_rom(e,a,t.length)}addMidiEvent(e,t){if(!this.isInitialized||0===e||!this.heapU8||!this.module)return;const a=this.module._malloc(t.length);this.heapU8.set(t,a),this.module._mame_add_midi_event(e,a,t.length),this.module._free(a)}rsaLoadRoms(e,t,a,n){if(!this.isInitialized||0===e||!this.heapU8||!this.module)return;const s=this.module._malloc(t.length),r=this.module._malloc(a.length),i=this.module._malloc(n.length);this.heapU8.set(t,s),this.heapU8.set(a,r),this.heapU8.set(n,i),this.module._rsa_load_roms(e,s,r,i)}render(e,t=128){if(!this.isInitialized||0===e||!this.module||!this.module.wasmMemory)return{left:new Float32Array(t),right:new Float32Array(t)};const a=this.module._malloc(4*t),n=this.module._malloc(4*t);this.module._mame_render(e,a,n,t);const s=this.module.wasmMemory.buffer,r=new Float32Array(s,a,t).slice(),i=new Float32Array(s,n,t).slice();return this.module._free(a),this.module._free(n),{left:r,right:i}}}class Or{name="MAMESynth";output;engine=Ar.getInstance();config;isInitialized=!1;initInProgress=!1;handle=0;voices=[];numHardwareVoices=32;constructor(e){this.output=us().createGain(),this.config=e,"rsa"===e.type?this.numHardwareVoices=16:"swp30"===e.type&&(this.numHardwareVoices=64);for(let t=0;t<this.numHardwareVoices;t++)this.voices.push({note:"",active:!1,voiceIndex:t,startTime:0});this.initEngine()}async ensureInitialized(){if(!this.isInitialized)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.isInitialized&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.isInitialized){this.initInProgress=!0;try{await this.engine.init();let e=16e6;"rsa"===this.config.type?e=2e7:"swp30"===this.config.type&&(e=33868800);const t=this.config.clock||e;if(this.handle=this.engine.createInstance(this.config.type,t),this.config.roms)for(const a of this.config.roms)this.engine.setRom(a.bank,a.data);this.isInitialized=!0,"vfx"===this.config.type&&(this.engine.write(this.handle,88,31),this.engine.write(this.handle,96,1)),this.startRendering()}catch(e){}finally{this.initInProgress=!1}}}startRendering(){const e=us();if(!e||!e.createScriptProcessor)return;const t=e.createScriptProcessor(512,0,2);t.onaudioprocess=e=>{if(!this.isInitialized||0===this.handle)return;const t=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),{left:n,right:s}=this.engine.render(this.handle,512);t.set(n),a.set(s)},t.connect(this.output)}getHandle(){return this.handle}write(e,t){this.isInitialized&&0!==this.handle&&this.engine.write(this.handle,e,t)}write16(e,t){this.isInitialized&&0!==this.handle&&this.engine.write16(this.handle,e,t)}read(e){return this.isInitialized&&0!==this.handle?this.engine.read(this.handle,e):0}findFreeVoice(){const e=this.voices.find(e=>!e.active);return e||this.voices.sort((e,t)=>e.startTime-t.startTime)[0]}triggerAttack(e,t,a=1){if(!this.isInitialized||0===this.handle)return this;const n=bs(e),s=this.findFreeVoice();s.note=e,s.active=!0,s.startTime=Date.now();const r=s.voiceIndex;if("vfx"===this.config.type){this.engine.write(this.handle,120,r),this.engine.write16(this.handle,0,1);const e=44100,t=Math.floor(2048*n*32/e);this.engine.write16(this.handle,8,65535&t),this.engine.write(this.handle,10,t>>16&255),this.engine.write16(this.handle,136,0),this.engine.write16(this.handle,144,8192);const s=Math.floor(65535*a);this.engine.write16(this.handle,16,s),this.engine.write16(this.handle,0,0)}else if("doc"===this.config.type){this.engine.write(this.handle,224,0),this.engine.write(this.handle,0+r,0);const e=Math.floor(65536*n/1e3);this.engine.write(this.handle,0+r,255&e),this.engine.write(this.handle,32+r,e>>8&255),this.engine.write(this.handle,64+r,Math.floor(255*a)),this.engine.write(this.handle,128+r,0)}else if("rsa"===this.config.type){const e=Math.floor(16384*n/32e3);for(let t=0;t<10;t++){const a=256*r+16*t;this.engine.write(this.handle,a+0,255&e),this.engine.write(this.handle,a+1,e>>8&255),this.engine.write(this.handle,a+5,127)}}else if("swp30"===this.config.type){const e=r<<6,t=Math.floor(1024*n/44100);this.engine.write16(this.handle,10|e,t)}return this}triggerRelease(e,t){if(!this.isInitialized||0===this.handle)return this;const a=this.voices.find(t=>t.active&&t.note===e);if(!a)return this;a.active=!1;const n=a.voiceIndex;if("vfx"===this.config.type)this.engine.write(this.handle,120,n),this.engine.write16(this.handle,0,1);else if("doc"===this.config.type)this.engine.write(this.handle,128+n,1);else if("rsa"===this.config.type)for(let s=0;s<10;s++){const e=256*n+16*s;this.engine.write(this.handle,e+5,255)}return this}dispose(){0!==this.handle&&(this.engine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const Ir=new Map,Fr=new WeakMap,Dr=`?t=${Date.now()}`;function Rr(e,t){return e.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory').replace(/new\s+URL\(([^,]+),\s*([^)]+)\)\.href/g,"($2 + $1)")}const jr={VOLUME:0,ARPEGGIO:1,DUTY:2,WAVETABLE:3,PITCH:4,PANNING:5,PHASE_RESET:6,ALG:7,FB:8,FMS:9,AMS:10};const Br={numVoices:1,numOperators:0,hasFM:!1,hasAlgorithm:!1,hasFeedback:!1,hasVibrato:!1,hasTremolo:!1,hasPitchLFO:!1,hasAmpLFO:!1,hasWavetable:!1,hasPCM:!1,hasNoise:!1,hasADSR:!0,hasSSG:!1,hasPanning:!1,hasStereo:!1,hasDSP:!1,hasReverb:!1,sampleRAMSize:0},Lr={AICA:{numVoices:64,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:2097152},SCSP:{numVoices:32,numOperators:4,hasFM:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasDSP:!0,sampleRAMSize:524288},C352:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},ES5503:{numVoices:32,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:65536},YMF271:{numVoices:12,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasPCM:!0,hasADSR:!0,hasPitchLFO:!0,hasAmpLFO:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:4194304},YMOPQ:{numVoices:8,numOperators:4,hasFM:!0,hasAlgorithm:!0,hasFeedback:!0,hasADSR:!0,hasPanning:!1,hasStereo:!1},K054539:{numVoices:8,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,hasReverb:!0,sampleRAMSize:8388608},ICS2115:{numVoices:32,hasWavetable:!0,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},RF5C400:{numVoices:32,hasPCM:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0,sampleRAMSize:16777216},SN76477:{numVoices:1,hasNoise:!0,hasVibrato:!0},TMS36XX:{numVoices:6,hasADSR:!1},TMS5220:{numVoices:1},MEA8000:{numVoices:1},Votrax:{numVoices:1},Astrocade:{numVoices:3,hasNoise:!0,hasVibrato:!0},SNKWave:{numVoices:3,hasWavetable:!0},SP0250:{numVoices:1},UPD931:{numVoices:1},UPD933:{numVoices:8,hasWavetable:!0,hasADSR:!0},TR707:{numVoices:15,hasPCM:!0,sampleRAMSize:32768},VASynth:{numVoices:16,hasWavetable:!0,hasADSR:!0,hasPanning:!0,hasStereo:!0},CEM3394:{numVoices:1,hasADSR:!0,hasVibrato:!0},ASC:{numVoices:4,hasWavetable:!0,hasStereo:!0}};function Vr(e){return{...Br,...Lr[e]||{}}}const zr=0,Ur=1,Gr=2,Wr=3;class Hr{channelMemory=new Map;speed=6;bpm=125;constructor(){}getChannelMemory(e){return this.channelMemory.has(e)||this.channelMemory.set(e,{arpeggioX:0,arpeggioY:0,arpeggioTick:0,pitchSlideUp:0,pitchSlideDown:0,tonePortamento:0,tonePortamentoTarget:null,vibratoSpeed:0,vibratoDepth:0,vibratoPhase:0,vibratoWaveform:0,tremoloSpeed:0,tremoloDepth:0,tremoloPhase:0,tremoloWaveform:0,volumeSlide:0,currentVolume:64,currentPanning:128,currentPitch:440,currentPitchOffset:0,noteCutTick:-1,noteDelayTick:-1,retriggerTick:0,retriggerVolume:0,sampleOffset:0,loopStart:0,loopCount:0,loopRow:0}),this.channelMemory.get(e)}setSpeed(e){this.speed=Math.max(1,Math.min(31,e))}setBPM(e){this.bpm=Math.max(32,Math.min(255,e))}getSpeed(){return this.speed}getBPM(){return this.bpm}processTickZero(e,t,a,n,s){const r=this.getChannelMemory(t),i={positionJump:null,patternBreak:null,patternDelay:0};if(!e||e.length<3)return i;const o=e.charAt(0).toUpperCase(),l=parseInt(e.substring(1),16),c=l>>4&15,u=15&l;switch(a>0&&(r.currentPitch=a),o){case"0":l>0&&(r.arpeggioX=c,r.arpeggioY=u,r.arpeggioTick=0);break;case"1":l>0&&(r.pitchSlideUp=l);break;case"2":l>0&&(r.pitchSlideDown=l);break;case"3":l>0&&(r.tonePortamento=l),a>0&&(r.tonePortamentoTarget=a);break;case"4":c>0&&(r.vibratoSpeed=c),u>0&&(r.vibratoDepth=u);break;case"5":case"6":case"A":l>0&&(r.volumeSlide=l);break;case"7":c>0&&(r.tremoloSpeed=c),u>0&&(r.tremoloDepth=u);break;case"8":r.currentPanning=l,s.setPanning(l);break;case"9":l>0&&(r.sampleOffset=l),s.setSampleOffset(256*r.sampleOffset);break;case"B":i.positionJump=l;break;case"C":r.currentVolume=Math.min(l,64),s.setVolume(r.currentVolume);break;case"D":i.patternBreak=10*c+u;break;case"E":this.processExtendedTick0(l,t,n,s,i);break;case"F":0===l||(l<32?this.speed=l:this.bpm=l)}return i}processExtendedTick0(e,t,a,n,s){const r=this.getChannelMemory(t),i=15&e;switch(e>>4&15){case 1:r.currentPitchOffset+=4*i,n.setPitchOffset(r.currentPitchOffset);break;case 2:r.currentPitchOffset-=4*i,n.setPitchOffset(r.currentPitchOffset);break;case 3:case 5:break;case 4:r.vibratoWaveform=3&i;break;case 6:0===i?r.loopStart=a:0===r.loopCount?(r.loopCount=i,r.loopRow=r.loopStart):(r.loopCount--,r.loopCount>0&&(r.loopRow=r.loopStart));break;case 7:r.tremoloWaveform=3&i;break;case 8:r.currentPanning=17*i,n.setPanning(r.currentPanning);break;case 9:i>0&&(r.retriggerTick=i);break;case 10:r.currentVolume=Math.min(r.currentVolume+i,64),n.setVolume(r.currentVolume);break;case 11:r.currentVolume=Math.max(r.currentVolume-i,0),n.setVolume(r.currentVolume);break;case 12:r.noteCutTick=i,0===i&&n.cutNote();break;case 13:r.noteDelayTick=i;break;case 14:s.patternDelay=i}}processTickN(e,t,a,n){const s=this.getChannelMemory(t);if(!e)return;switch(e.charAt(0).toUpperCase()){case"0":this.processArpeggio(s,a,n);break;case"1":this.processPitchSlideUp(s,n);break;case"2":this.processPitchSlideDown(s,n);break;case"3":this.processTonePortamento(s,n);break;case"4":this.processVibrato(s,n);break;case"5":this.processTonePortamento(s,n),this.processVolumeSlide(s,n);break;case"6":this.processVibrato(s,n),this.processVolumeSlide(s,n);break;case"7":this.processTremolo(s,n);break;case"A":this.processVolumeSlide(s,n);break;case"E":this.processExtendedTickN(e,s,a,n)}}processExtendedTickN(e,t,a,n){switch(parseInt(e.substring(1),16)>>4&15){case 9:t.retriggerTick>0&&a%t.retriggerTick===0&&n.retriggerNote(t.currentVolume/64);break;case 12:a===t.noteCutTick&&n.cutNote()}}processArpeggio(e,t,a){if(0===e.arpeggioX&&0===e.arpeggioY)return;let n=0;switch(t%3){case 0:n=0;break;case 1:n=e.arpeggioX;break;case 2:n=e.arpeggioY}const s=e.currentPitch*Math.pow(2,n/12);a.setFrequency(s)}processPitchSlideUp(e,t){e.pitchSlideUp>0&&(e.currentPitchOffset+=4*e.pitchSlideUp,t.setPitchOffset(e.currentPitchOffset))}processPitchSlideDown(e,t){e.pitchSlideDown>0&&(e.currentPitchOffset-=4*e.pitchSlideDown,t.setPitchOffset(e.currentPitchOffset))}processTonePortamento(e,t){if(0===e.tonePortamento||null===e.tonePortamentoTarget)return;const a=e.tonePortamentoTarget-e.currentPitch,n=4*e.tonePortamento;Math.abs(a)<n?e.currentPitch=e.tonePortamentoTarget:e.currentPitch+=a>0?n:-n,t.setFrequency(e.currentPitch)}processVibrato(e,t){if(0===e.vibratoDepth)return;const a=4*this.calculateWaveformValue(e.vibratoWaveform,e.vibratoPhase,e.vibratoDepth);t.setPitchOffset(e.currentPitchOffset+a),e.vibratoPhase=e.vibratoPhase+e.vibratoSpeed&63}processTremolo(e,t){if(0===e.tremoloDepth)return;const a=this.calculateWaveformValue(e.tremoloWaveform,e.tremoloPhase,e.tremoloDepth),n=Math.round(a),s=Math.max(0,Math.min(64,e.currentVolume+n));t.setVolume(s),e.tremoloPhase=e.tremoloPhase+e.tremoloSpeed&63}processVolumeSlide(e,t){if(0===e.volumeSlide)return;const a=e.volumeSlide>>4&15,n=15&e.volumeSlide;a>0?e.currentVolume=Math.min(e.currentVolume+a,64):n>0&&(e.currentVolume=Math.max(e.currentVolume-n,0)),t.setVolume(e.currentVolume)}calculateWaveformValue(e,t,a){const n=t/64*Math.PI*2;switch(e){case zr:return Math.sin(n)*a;case Ur:return((64-t)/32-1)*a;case Gr:return(t<32?1:-1)*a;case Wr:return(2*Math.random()-1)*a;default:return 0}}hasNoteDelay(e){return!!e&&(e.toUpperCase().startsWith("ED")&&"ED0"!==e)}getNoteDelayTick(e){return e&&e.toUpperCase().startsWith("ED")&&parseInt(e.substring(2),16)||0}reset(){this.channelMemory.clear(),this.speed=6,this.bpm=125}resetChannel(e){const t=this.getChannelMemory(e);t.currentPitchOffset=0,t.arpeggioX=0,t.arpeggioY=0,t.arpeggioTick=0,t.pitchSlideUp=0,t.pitchSlideDown=0,t.tonePortamentoTarget=null,t.vibratoPhase=0,t.tremoloPhase=0,t.noteCutTick=-1,t.noteDelayTick=-1}}function Kr(e,t){const a=t/64;return e*Math.pow(2,a/12)}function qr(e){const t=function(e){return 69+12*Math.log2(e/440)}(e),a=Math.floor(t),n=t-a,s=Math.max(0,Math.min(127,a)),r=Math.round(64*n);return{kc:s,kf:Math.max(0,Math.min(63,r))}}class $r{output;workletNode=null;_initPromise;_pendingCalls=[];_isReady=!1;_disposed=!1;capabilities;config={};romLoaded=!1;currentNote=60;currentFreq=261.63;currentVelocity=1;isNoteOn=!1;noteOnTime=0;static MIN_GATE_TIME=50;macros=new Map;opMacros=[];effectRouter;channelIndex=0;basePitchOffset=0;effectPitchOffset=0;oscBuffer=null;oscCallbacks=new Set;constructor(){this.output=us().createGain(),this.effectRouter=new Hr,this.capabilities=Vr("default")}initSynth(){this.capabilities=Vr(this.chipName),this._initPromise=this.initialize(),this.capabilities.numOperators>0&&(this.opMacros=Array.from({length:this.capabilities.numOperators},()=>({})))}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=us(),{wasmBinary:t,jsCode:a}=await async function(e,t,a){const n="/DEViLBOX/";let s=Fr.get(e);if(s||(s=new Set,Fr.set(e,s)),!s.has("__mame_init_helper__")){try{await e.audioWorklet.addModule(`${n}mame/mame-worklet-init.js${Dr}`)}catch{}s.add("__mame_init_helper__")}if(!s.has(t)){try{await e.audioWorklet.addModule(`${n}mame/${a}${Dr}`)}catch{}s.add(t)}if(!Ir.has(t)){const e=(async()=>{const[e,a]=await Promise.all([fetch(`${n}mame/${t}.wasm`),fetch(`${n}mame/${t}.js`)]);if(!e.ok)throw new Error(`Failed to load ${t}.wasm: ${e.status}`);if(!a.ok)throw new Error(`Failed to load ${t}.js: ${a.status}`);const[s,r]=await Promise.all([e.arrayBuffer(),a.text()]);return{wasmBinary:s,jsCode:Rr(r,`${n}mame/`)}})();Ir.set(t,e)}return Ir.get(t)}(e,this.chipName,this.workletFile);if(this._disposed)return;const n=this.output,{workletNode:s,readyPromise:r}=function(e,t,a,n,s){const r=new AudioWorkletNode(e,t,{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate}}),i=new Promise((e,a)=>{const n=setTimeout(()=>a(new Error(`${t} init timeout`)),1e4),s=r.port.onmessage;r.port.onmessage=i=>{"ready"===i.data.type?(clearTimeout(n),e()):"error"===i.data.type&&(clearTimeout(n),a(new Error(i.data.message||`${t} init error`))),s&&s.call(r.port,i)}});r.port.postMessage({type:"init",wasmBinary:a,jsCode:n,sampleRate:e.sampleRate}),r.connect(s);try{const t=e.createGain();t.gain.value=0,r.connect(t),t.connect(e.destination)}catch{}return{workletNode:r,readyPromise:i}}(e,this.processorName,t,a,n);this.workletNode=s;const i=this.workletNode.port.onmessage;this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data),i&&i.call(this.workletNode.port,e)},await r}catch(e){}}handleWorkletMessage(e){switch(e.type){case"ready":this._isReady=!0;for(const e of this._pendingCalls)this.processPendingCall(e);this._pendingCalls=[];break;case"oscData":e.buffer&&(this.oscBuffer=new Float32Array(e.buffer),this.oscCallbacks.forEach(e=>e(this.oscBuffer)))}}processPendingCall(e){"setParam"===e.method?this.setParam(e.args[0],e.args[1]):"triggerAttack"===e.method&&this.triggerAttack(e.args[0],e.args[1],e.args[2])}triggerAttack(e,t,a=1){this._disposed||(this._isReady&&this.workletNode?(this.currentNote="string"==typeof e?function(e){const t=e.match(/^([A-Ga-g][#b]?)[-]?(\d)$/);if(!t)return 60;const a=t[1].toUpperCase(),n=parseInt(t[2]),s={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[a];return void 0===s?60:12*(n+1)+s}(e):e>127?Math.round(12*Math.log2(e/440)+69):e,this.currentFreq=function(e){return 440*Math.pow(2,(e-69)/12)}(this.currentNote),this.currentVelocity=a,this.isNoteOn=!0,this.noteOnTime=Date.now(),this.resetMacros(),this.effectRouter.resetChannel(this.channelIndex),this.writeKeyOn(this.currentNote,a)):this._pendingCalls.push({method:"triggerAttack",args:[e,t,a]}))}triggerRelease(e){if(this._disposed)return;const t=Date.now()-this.noteOnTime;t<$r.MIN_GATE_TIME?setTimeout(()=>this.triggerRelease(e),$r.MIN_GATE_TIME-t):(this.isNoteOn=!1,this.releaseMacros(),this.writeKeyOff())}triggerAttackRelease(e,t,a,n){if(this._disposed)return;this.triggerAttack(e,a,n||1);const s=xs(t);setTimeout(()=>{this._disposed||this.triggerRelease()},1e3*s)}releaseAll(){this.workletNode&&!this._disposed&&(this.workletNode.port.postMessage({type:"allNotesOff"}),this.isNoteOn=!1)}setFrequency(e){this.currentFreq=e,this.writeFrequency(e)}setPitchOffset(e){this.effectPitchOffset=e;const t=Kr(this.currentFreq,this.basePitchOffset+e);this.writeFrequency(t)}setVolume(e){const t=e/64;this.writeVolume(t*this.currentVelocity)}setPanning(e){this.writePanning(e)}setSampleOffset(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setSampleOffset",offset:e})}retriggerNote(e){this.writeKeyOn(this.currentNote,e)}cutNote(){this.writeVolume(0),this.isNoteOn=!1}writeDuty(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:100,value:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"selectWavetable",index:e})}writePhaseReset(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"phaseReset"})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dr",value:t})}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"sl",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",op:e,param:"dt",value:t})}setMacro(e){const t={type:e.type,data:e.data,loop:e.loop??-1,release:e.release??-1,position:0,active:e.data.length>0,released:!1};this.macros.set(e.type,t)}setMacros(e){for(const t of e)this.setMacro(t)}clearMacros(){this.macros.clear()}resetMacros(){this.macros.forEach(e=>{e.position=0,e.released=!1});for(const e of this.opMacros)for(const t of Object.keys(e)){const a=e[t];a&&(a.position=0,a.released=!1)}}releaseMacros(){this.macros.forEach(e=>{e.released=!0,e.release>=0&&e.release<e.data.length&&(e.position=e.release)});for(const e of this.opMacros)for(const t of Object.keys(e)){const a=e[t];a&&(a.released=!0,a.release>=0&&a.release<a.data.length&&(a.position=a.release))}}processTick(){this.isNoteOn&&(this.macros.forEach((e,t)=>{if(!e.active||0===e.data.length)return;let a=e.position;a>=e.data.length&&(a=e.data.length-1);const n=e.data[a];this.applyMacroValue(t,n),a++,a>=e.data.length&&(a=e.loop>=0?e.loop:e.data.length-1),e.position=a}),this.processOperatorMacros())}applyMacroValue(e,t){switch(e){case jr.VOLUME:{const e=t/127*this.currentVelocity;this.writeVolume(e);break}case jr.ARPEGGIO:{const e=t>127?t-256:t,a=this.currentFreq*Math.pow(2,e/12);this.writeFrequency(a);break}case jr.DUTY:this.writeDuty(t);break;case jr.WAVETABLE:this.writeWavetableSelect(t);break;case jr.PITCH:{const e=t>127?t-256:t;this.basePitchOffset=e;const a=Kr(this.currentFreq,this.basePitchOffset+this.effectPitchOffset);this.writeFrequency(a);break}case jr.PANNING:{const e=t>127?t-256:t;this.writePanning(128+e);break}case jr.PHASE_RESET:0!==t&&this.writePhaseReset();break;case jr.ALG:this.setFMAlgorithm(t);break;case jr.FB:this.setFMFeedback(t);break;case jr.FMS:this.setFMSensitivity(t);break;case jr.AMS:this.setAMSensitivity(t)}}processOperatorMacros(){for(let e=0;e<this.opMacros.length;e++){const t=this.opMacros[e];if(t){if(t.tl?.active){const a=this.advanceOpMacro(t.tl);this.setOperatorTL(e,a)}if(t.ar?.active){const a=this.advanceOpMacro(t.ar);this.setOperatorAR(e,a)}if(t.dr?.active){const a=this.advanceOpMacro(t.dr);this.setOperatorDR(e,a)}if(t.sl?.active){const a=this.advanceOpMacro(t.sl);this.setOperatorSL(e,a)}if(t.rr?.active){const a=this.advanceOpMacro(t.rr);this.setOperatorRR(e,a)}if(t.mult?.active){const a=this.advanceOpMacro(t.mult);this.setOperatorMult(e,a)}if(t.dt?.active){const a=this.advanceOpMacro(t.dt);this.setOperatorDetune(e,a)}}}}advanceOpMacro(e){if(!e.active||0===e.data.length)return 0;let t=e.position;t>=e.data.length&&(t=e.data.length-1);const a=e.data[t];return t++,t>=e.data.length&&(t=e.loop>=0?e.loop:e.data.length-1),e.position=t,a}setFMAlgorithm(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:200,value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:201,value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:202,value:e})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:203,value:e})}processEffectTick0(e,t,a){return this.effectRouter.processTickZero(e,this.channelIndex,t,a,this)}processEffectTickN(e,t){this.effectRouter.processTickN(e,this.channelIndex,t,this)}hasNoteDelay(e){return this.effectRouter.hasNoteDelay(e)}getNoteDelayTick(e){return this.effectRouter.getNoteDelayTick(e)}setChannelIndex(e){this.channelIndex=e}getOscData(){return this.oscBuffer}onOscData(e){return this.oscCallbacks.add(e),this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!0}),()=>{this.oscCallbacks.delete(e),0===this.oscCallbacks.size&&this.workletNode&&this._isReady&&this.workletNode.port.postMessage({type:"enableOsc",enabled:!1})}}setParam(e,t){this._isReady||this._pendingCalls.push({method:"setParam",args:[e,t]})}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:a,loopEnd:n,loop:s,format:r??0})}debugTestAudio(){const e=us();if(!this.workletNode)return;const t=e.createGain();t.gain.value=.3,this.workletNode.connect(t),t.connect(e.destination);const a=e.createAnalyser();a.fftSize=256,this.workletNode.connect(a),this.workletNode.port.postMessage({type:"noteOn",note:60,velocity:100}),setTimeout(()=>{const e=new Float32Array(a.fftSize);a.getFloatTimeDomainData(e);e.reduce((e,t)=>Math.max(e,Math.abs(t)),0)},200),setTimeout(()=>{this.workletNode?.port.postMessage({type:"noteOff",note:60});try{this.workletNode?.disconnect(t),this.workletNode?.disconnect(a),t.disconnect(),a.disconnect()}catch{}},3e3)}debugDumpRouting(){us();this.workletNode}dispose(){this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.oscCallbacks.clear(),this.output.disconnect()}}class Xr extends d{name="TapeSaturation";inputGain;saturation;toneFilter;outputGain;dryGain;wetGain;_drive;_tone;_wet;input;output;constructor(e={}){super(),this._drive=e.drive??.5,this._tone=e.tone??12e3,this._wet=e.wet??1,this.input=new p(1),this.output=new p(1),this.inputGain=new p(this.calculateInputGain(this._drive)),this.saturation=new m(this.createSaturationCurve(this._drive),4096),this.toneFilter=new h({type:"lowpass",frequency:this._tone,rolloff:-12,Q:.7}),this.outputGain=new p(this.calculateMakeupGain(this._drive)),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.input.connect(this.inputGain),this.inputGain.connect(this.saturation),this.saturation.connect(this.toneFilter),this.toneFilter.connect(this.outputGain),this.outputGain.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output)}createSaturationCurve(e){const t=new Float32Array(4096),a=1+8*e;for(let n=0;n<4096;n++){const e=n/4096*2-1;t[n]=e>=0?.95*Math.tanh(e*a)+.02*e:Math.tanh(e*a*.85)}return t}calculateInputGain(e){return 1+2*e}calculateMakeupGain(e){return 1/(1+.5*e)}get drive(){return this._drive}set drive(e){this._drive=Math.max(0,Math.min(1,e)),this.inputGain.gain.value=this.calculateInputGain(this._drive),this.saturation.curve=this.createSaturationCurve(this._drive),this.outputGain.gain.value=this.calculateMakeupGain(this._drive)}get tone(){return this._tone}set tone(e){this._tone=Math.max(2e3,Math.min(2e4,e)),this.toneFilter.frequency.value=this._tone}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.inputGain.dispose(),this.saturation.dispose(),this.toneFilter.dispose(),this.outputGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this}}const Yr=Object.freeze(Object.defineProperty({__proto__:null,TapeSaturation:Xr},Symbol.toStringTag,{value:"Module"})),Zr=2048;function Qr(e){const t=new Float32Array(Zr),a=new Float32Array(Zr);switch(e){case"sine":a[1]=1;break;case"saw":for(let e=1;e<1024;e++)a[e]=2/(e*Math.PI)*(e%2==0?1:-1);break;case"square":for(let e=1;e<1024;e+=2)a[e]=4/(e*Math.PI);break;case"triangle":for(let e=1;e<1024;e+=2)a[e]=8/(Math.PI*Math.PI*e*e)*((e-1)/2%2==0?1:-1)}return{real:t,imag:a}}function Jr(e){const t=new Float32Array(Zr),a=new Float32Array(Zr);for(let n=1;n<1024;n++)a[n]=2/(n*Math.PI)*Math.sin(n*Math.PI*e);return{real:t,imag:a}}function ei(e,t,a){const n=new Float32Array(Zr),s=new Float32Array(Zr),r=[e,t,a],i=[100,150,200];for(let o=1;o<1024;o++){const e=100*o;let t=0;for(let a=0;a<r.length;a++){const n=Math.abs(e-r[a]);t+=Math.exp(-n*n/(2*i[a]*i[a]))}s[o]=t/(.5*o+1)}return{real:n,imag:s}}const ti=[{id:"basic-saw",name:"Saw",category:"Basic",frames:[Qr("saw")]},{id:"basic-square",name:"Square",category:"Basic",frames:[Qr("square")]},{id:"basic-triangle",name:"Triangle",category:"Basic",frames:[Qr("triangle")]},{id:"basic-sine",name:"Sine",category:"Basic",frames:[Qr("sine")]},{id:"analog-sweep",name:"Analog Sweep",category:"Analog",frames:[Qr("sine"),Qr("triangle"),Qr("saw"),Qr("square")]},{id:"pwm",name:"PWM",category:"Analog",frames:[Jr(.1),Jr(.25),Jr(.5),Jr(.75),Jr(.9)]},{id:"saw-stack",name:"Saw Stack",category:"Analog",frames:[Qr("saw"),(()=>{const e=Qr("saw");for(let t=1;t<1024;t++){const a=.1*Math.PI*t,n=Math.cos(a),s=Math.sin(a),r=e.real[t],i=e.imag[t];e.real[t]=r*n-i*s,e.imag[t]=r*s+i*n}return e})()]},{id:"digital-harmonics",name:"Digital",category:"Digital",frames:[(()=>{const e=new Float32Array(Zr),t=new Float32Array(Zr);for(let a=1;a<32;a+=2)t[a]=1/a;return{real:e,imag:t}})(),(()=>{const e=new Float32Array(Zr),t=new Float32Array(Zr);for(let a=2;a<32;a+=2)t[a]=1/a;return{real:e,imag:t}})()]},{id:"vocal-a",name:"Vocal A",category:"Vocal",frames:[ei(800,1200,2800)]},{id:"vocal-morph",name:"Vocal Morph",category:"Vocal",frames:[ei(300,2300,3e3),ei(500,1800,2500),ei(800,1200,2800),ei(450,800,2500),ei(300,600,2300)]},{id:"metallic",name:"Metallic",category:"FX",frames:[(()=>{const e=new Float32Array(Zr),t=new Float32Array(Zr);return[1,2.756,5.404,8.933,13.344].forEach((e,a)=>{const n=Math.round(e);n<1024&&(t[n]=1/(a+1))}),{real:e,imag:t}})()]}];function ai(e,t){if(1===e.frames.length)return e.frames[0];const a=t*(e.frames.length-1),n=Math.floor(a),s=a-n;return n>=e.frames.length-1?e.frames[e.frames.length-1]:function(e,t,a){const n=new Float32Array(Zr),s=new Float32Array(Zr);for(let r=0;r<Zr;r++)n[r]=e.real[r]*(1-a)+t.real[r]*a,s[r]=e.imag[r]*(1-a)+t.imag[r]*a;return{real:n,imag:s}}(e.frames[n],e.frames[n+1],s)}class ni{name="WavetableSynth";output;voices=new Map;voicePool=[];config;audioContext;filter;outputGain;baseMorphPosition=0;constructor(e){this.config=e,this.audioContext=us(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.filter=this.audioContext.createBiquadFilter(),this.filter.type=e.filter.type,this.filter.frequency.value=e.filter.cutoff,this.filter.Q.value=e.filter.resonance/10,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=2,this.filter.connect(this.outputGain),this.outputGain.connect(this.output);for(let t=0;t<8;t++)this.voicePool.push(this.createVoice());this.baseMorphPosition=e.morphPosition/100}createVoice(){return new si(this.config,this.filter,this.audioContext)}getCurrentMorphPosition(){return Math.max(0,Math.min(1,this.baseMorphPosition))}triggerAttack(e,t,a=1){const n=t??vs(),s="string"==typeof e?bs(e):e,r="string"==typeof e?gs(e):Math.round(69+12*Math.log2(e/440));let i=this.voicePool.pop();if(!i){const e=this.voices.keys().next().value;void 0!==e&&(i=this.voices.get(e),this.voices.delete(e))}if(i){const e=this.getCurrentMorphPosition();if(i.setMorphPosition(e),i.triggerAttack(s,n,a),this.voices.set(r,i),0!==this.config.filter.envelopeAmount){const e=this.config.filter.cutoff,t=this.config.filter.envelopeAmount/100,a=Math.min(2e4,e+t*(2e4-e)),s=this.config.filterEnvelope.attack/1e3,r=this.config.filterEnvelope.decay/1e3,i=e+(a-e)*(this.config.filterEnvelope.sustain/100);this.filter.frequency.cancelScheduledValues(n),this.filter.frequency.setValueAtTime(e,n),this.filter.frequency.linearRampToValueAtTime(a,n+s),this.filter.frequency.linearRampToValueAtTime(i,n+s+r)}}}triggerRelease(e,t){const a=t??vs(),n="string"==typeof e?gs(e):Math.round(69+12*Math.log2(e/440)),s=this.voices.get(n);s&&(s.triggerRelease(a),this.voices.delete(n),setTimeout(()=>{this.voicePool.push(s)},this.config.envelope.release+100))}triggerAttackRelease(e,t,a,n=1){const s=a??vs(),r="string"==typeof t?xs(t):t;this.triggerAttack(e,s,n),this.triggerRelease(e,s+r)}setMorphPosition(e){this.baseMorphPosition=Math.max(0,Math.min(1,e));const t=this.getCurrentMorphPosition();this.voices.forEach(e=>{e.setMorphPosition(t)})}setMorphLFORate(e){this.config.morphLFORate=e}setFilterCutoff(e){this.config.filter.cutoff=e,this.filter.frequency.value=e}setFilterResonance(e){this.config.filter.resonance=e,this.filter.Q.value=e/10}updateConfig(e){this.config={...this.config,...e},e.filter&&(e.filter.type&&(this.filter.type=e.filter.type),void 0!==e.filter.cutoff&&(this.filter.frequency.value=e.filter.cutoff),void 0!==e.filter.resonance&&(this.filter.Q.value=e.filter.resonance/10))}dispose(){this.voices.forEach(e=>e.dispose()),this.voicePool.forEach(e=>e.dispose()),this.filter.disconnect(),this.outputGain.disconnect(),this.output.disconnect()}}class si{oscillators=[];gains=[];panners=[];config;audioContext;attackTime;decayTime;sustainLevel;releaseTime;constructor(e,t,a){this.config=e,this.audioContext=a,this.attackTime=e.envelope.attack/1e3,this.decayTime=e.envelope.decay/1e3,this.sustainLevel=e.envelope.sustain/100,this.releaseTime=e.envelope.release/1e3;const n=e.unison.voices,s=e.unison.detune,r=e.unison.stereoSpread/100;for(let i=0;i<n;i++){let e=0;n>1&&(e=(i/(n-1)*2-1)*s);let o=0;n>1&&(o=(i/(n-1)*2-1)*r);const l=a.createOscillator();l.detune.value=e;const c=a.createGain();c.gain.value=0;const u=a.createStereoPanner();u.pan.value=o,l.connect(c),c.connect(u),u.connect(t),this.oscillators.push(l),this.gains.push(c),this.panners.push(u)}this.setMorphPosition(e.morphPosition/100)}setMorphPosition(e){const t=(a=this.config.wavetableId,ti.find(e=>e.id===a));var a;if(!t)return;const n=ai(t,e),s=Math.min(32,n.imag.length),r=new Float32Array(s+1),i=new Float32Array(s+1);for(let l=1;l<s;l++)i[l+1-1]=n.imag[l];const o=this.audioContext.createPeriodicWave(r,i,{disableNormalization:!1});this.oscillators.forEach(e=>{e.setPeriodicWave(o)})}triggerAttack(e,t,a){this.oscillators.forEach(a=>{a.frequency.setValueAtTime(e,t),a.start(t)}),this.gains.forEach(e=>{const a=e.gain;a.cancelScheduledValues(t),a.setValueAtTime(0,t),a.linearRampToValueAtTime(1,t+this.attackTime),a.linearRampToValueAtTime(this.sustainLevel,t+this.attackTime+this.decayTime)})}triggerRelease(e){this.gains.forEach(t=>{const a=t.gain;a.cancelScheduledValues(e),a.setValueAtTime(a.value,e),a.linearRampToValueAtTime(0,e+this.releaseTime)});const t=e+this.releaseTime+.1;this.oscillators.forEach(e=>{e.stop(t)})}dispose(){this.oscillators.forEach(e=>{try{e.stop()}catch{}e.disconnect()}),this.gains.forEach(e=>e.disconnect()),this.panners.forEach(e=>e.disconnect())}}class ri{audioContext;workletNode=null;isInitialized=!1;currentModel=null;outputGain;static BUILT_IN_MODELS=[{name:"Ibanez TS9",fileName:"TS9_DriveKnob.json",type:"pedal"},{name:"Ibanez Mostortion Clone",fileName:"Ibanez_Mostortion_Clone_GainKnob.json",type:"pedal"},{name:"Mooer CaliMkIV",fileName:"Mooer_CaliMkIV_GainKnob.json",type:"pedal"},{name:"Boss MT2",fileName:"BossMT2_PedalHighGain.json",type:"pedal"},{name:"Pro Co RAT Distortion",fileName:"ProcoRatPedal_HighGain.json",type:"pedal"},{name:"MXR 78",fileName:"MXR78_pedal_DistKnob.json",type:"pedal"},{name:"Ibanez TS808",fileName:"Ibanez808TubeScreamer.json",type:"pedal"},{name:"RevvG3 Pedal",fileName:"RevvG3_Pedal_GainKnob.json",type:"pedal"},{name:"Jeckyl and Hyde Distortion",fileName:"Jeckyl_and_Hyde_Distortion_DriveKnob.json",type:"pedal"},{name:"Friedman BEOD Pedal",fileName:"Friedman_BEOD_Pedal_GainKnob.json",type:"pedal"},{name:"Blackstar HT40 Clean",fileName:"BlackstarHT40_AmpClean.json",type:"amp"},{name:"Mesa Mini Rec High Gain",fileName:"MesaMiniRec_HighGain_DirectOut.json",type:"amp"},{name:"Splawn OD High Gain",fileName:"Splawn_OD_FractalFM3_HighGain.json",type:"amp"},{name:"Ethos Lead Channel",fileName:"EthosLeadChan_GainKnob.json",type:"amp"},{name:"Princeton Amp Clean",fileName:"PrincetonAmp_Clean.json",type:"amp"},{name:"Dumble Kit High Gain",fileName:"DumbleKit_HighG_DirectOut.json",type:"amp"},{name:"Blackstar HT40 Gain",fileName:"BlackstarHT40_GainKnob_SM57mic.json",type:"amp"},{name:"T-Rex Mudhoney + Pork Loin",fileName:"TRexMudhoney_plus_PorkLoin_HighGain.json",type:"pedal"},{name:"Prince Of Tone OD",fileName:"PrinceOfToneClone_OD_Knob.json",type:"pedal"},{name:"Pork Loin Pedal",fileName:"PorkLoinPedal_LowGain.json",type:"pedal"},{name:"Prince Of Tone Dist",fileName:"PrinceOfToneClone_Dist_Knob.json",type:"pedal"},{name:"Aguilar Agro Bright Bass",fileName:"AguilarAgro_Bright_Bass.json",type:"bass"},{name:"Aguilar Agro Dark Bass",fileName:"AguilarAgro_Dark_Bass.json",type:"bass"},{name:"BadCat50 Med Gain",fileName:"BadCat50_MedGain_PREAMP.json",type:"amp"},{name:"ShiftTwin Clean2",fileName:"ShiftTwin_Clean2_PREAMP.json",type:"amp"},{name:"Sovtek50 Med Gain",fileName:"Sovtek50_MedGain_DIRECT.json",type:"amp"},{name:"ShiftTwin StampedeDT",fileName:"ShiftTwin_StampedeDT_PREAMP.json",type:"amp"},{name:"Sovtek50 Dod FX56B",fileName:"Sovtek50_DodFX56B_DIRECT.json",type:"amp"},{name:"ENGL E645 Clean",fileName:"ENGL_E645_Clean_EdoardoNapoli.json",type:"amp"},{name:"Filmosound with Cab",fileName:"Filmosound_with_cab.json",type:"amp"},{name:"ENGL E430 Clean",fileName:"ENGL_E430_Clean_EdoardoNapoli.json",type:"amp"},{name:"El Coyote Trainwreck",fileName:"ElCoyote_Trainwreck_Crunch.json",type:"amp"},{name:"Supro Bold Drive",fileName:"Supro_Bold_DriveKnob.json",type:"amp"},{name:"Goat Pedal High Gain",fileName:"GoatPedal_HighGain.json",type:"pedal"},{name:"Protein Blue Pedal",fileName:"ProteinBlue_pedal_DriveKnob.json",type:"pedal"},{name:"Little Big Muff",fileName:"LittleBigMuff_HighGainPedal.json",type:"pedal"},{name:"Big Muff V6",fileName:"BigMuff_V6_T3_S5.json",type:"pedal"}];constructor(e){this.audioContext=e,this.outputGain=e.createGain(),this.outputGain.gain.value=1}async initialize(){if(!this.isInitialized)try{const e="/DEViLBOX/";await this.audioContext.audioWorklet.addModule(`${e}GuitarML.worklet.js`),this.workletNode=new AudioWorkletNode(this.audioContext,"guitarml-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[1]}),this.workletNode.connect(this.outputGain),this.workletNode.port.onmessage=e=>this.handleWorkletMessage(e.data),this.isInitialized=!0}catch(e){throw e}}handleWorkletMessage(e){if("modelLoaded"===e.type)e.success}async loadModel(e){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");if(e<0||e>=ri.BUILT_IN_MODELS.length)throw new Error(`Invalid model index: ${e}`);const t=ri.BUILT_IN_MODELS[e];try{const e="/DEViLBOX/",a=await fetch(`${e}models/guitarml/${t.fileName}`);if(!a.ok)throw new Error(`Failed to fetch model: ${a.statusText}`);const n=await a.json();this.workletNode.port.postMessage({type:"loadModel",modelData:n}),this.currentModel=t}catch(a){throw a}}async loadModelFromURL(e,t){if(!this.isInitialized||!this.workletNode)throw new Error("GuitarMLEngine not initialized");try{const a=await fetch(e);if(!a.ok)throw new Error(`Failed to fetch model: ${a.statusText}`);const n=await a.json();this.workletNode.port.postMessage({type:"loadModel",modelData:n}),this.currentModel={name:t,fileName:e,type:"pedal"}}catch(a){throw a}}setParameter(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setGain(e){this.setParameter("gain",e)}setCondition(e){this.setParameter("condition",e)}setDryWet(e){this.setParameter("dryWet",e)}setEnabled(e){this.setParameter("enabled",e?1:0)}setUseSRCFilter(e){this.setParameter("useSRCFilter",e?1:0)}reset(){this.workletNode&&this.workletNode.port.postMessage({type:"reset"})}connect(e){this.outputGain.connect(e)}disconnect(){this.outputGain.disconnect()}getInput(){if(!this.workletNode)throw new Error("GuitarML not initialized - call initialize() first");return this.workletNode}getOutput(){return this.outputGain}isReady(){return this.isInitialized}getCurrentModel(){return this.currentModel}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.outputGain.disconnect(),this.isInitialized=!1}}class ii extends d{name="NeuralEffectWrapper";input;output;guitarML;_wet;dryGain;wetGain;modelIndex;neuralOutputGain;eq3;presenceFilter;constructor(e){super(),this.modelIndex=e.modelIndex,this._wet=e.wet??1;const t=ds(this.context);this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.guitarML=new ri(t),this.neuralOutputGain=new p(1),this.eq3=new f({low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500}),this.presenceFilter=new h({type:"highshelf",frequency:4e3,gain:0,Q:.7}),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.neuralOutputGain.connect(this.eq3),this.eq3.connect(this.presenceFilter),this.presenceFilter.connect(this.wetGain),this.wetGain.connect(this.output)}async loadModel(){await this.guitarML.initialize();const e=hs(this.input),t=e?._nativeAudioNode||e;t&&t.connect(this.guitarML.getInput());const a=hs(this.neuralOutputGain),n=a?._nativeAudioNode||a;n&&this.guitarML.getOutput().connect(n),await this.guitarML.loadModel(this.modelIndex)}setParameter(e,t){const a=Math.max(0,Math.min(100,t))/100;switch(e){case"drive":case"gain":case"condition":this.guitarML.setCondition(a);break;case"dryWet":this.guitarML.setDryWet(a);break;case"level":case"output":this.wetGain.gain.value=a*this._wet;break;case"tone":case"presence":this.presenceFilter.gain.value=20*(a-.5);break;case"bass":this.eq3.low.value=30*(a-.5);break;case"mid":this.eq3.mid.value=30*(a-.5);break;case"treble":this.eq3.high.value=30*(a-.5)}}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}dispose(){return super.dispose(),this.guitarML.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.neuralOutputGain.dispose(),this.eq3.dispose(),this.presenceFilter.dispose(),this}}const oi=Object.freeze(Object.defineProperty({__proto__:null,NeuralEffectWrapper:ii},Symbol.toStringTag,{value:"Module"}));class li extends d{name="SpaceEcho";input;output;head1;head2;head3;head1Gain;head2Gain;head3Gain;feedbackGain;saturation;eq;reverb;reverbGain;echoGain;wowLFO;wowGain;dryGain;wetGain;_options;constructor(e={}){super(),this._options={mode:e.mode??4,rate:e.rate??300,intensity:e.intensity??.5,echoVolume:e.echoVolume??.8,reverbVolume:e.reverbVolume??.3,bass:e.bass??0,treble:e.treble??0,wow:e.wow??.15,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.head1=new y(this._options.rate/1e3),this.head2=new y(2*this._options.rate/1e3),this.head3=new y(3*this._options.rate/1e3),this.head1Gain=new p(0),this.head2Gain=new p(0),this.head3Gain=new p(0),this.reverb=new g({decay:2.5,preDelay:.01}),this.reverb.generate(),this.reverbGain=new p(this._options.reverbVolume),this.echoGain=new p(this._options.echoVolume),this.feedbackGain=new p(this._options.intensity),this.saturation=new b(.1),this.eq=new f({low:this._options.bass,mid:0,high:this._options.treble,lowFrequency:200,highFrequency:2500}),this.wowLFO=new v(.5+.2*Math.random(),-.002,.002),this.wowLFO.type="sine",this.wowGain=new p(this._options.wow),this.wowLFO.connect(this.wowGain),this.wowLFO.start(),this.wowGain.connect(this.head1.delayTime),this.wowGain.connect(this.head2.delayTime),this.wowGain.connect(this.head3.delayTime),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.head1),this.input.connect(this.head2),this.input.connect(this.head3),this.input.connect(this.reverb),this.head1.connect(this.head1Gain),this.head2.connect(this.head2Gain),this.head3.connect(this.head3Gain);const t=new p(1);this.head1Gain.connect(t),this.head2Gain.connect(t),this.head3Gain.connect(t),t.connect(this.echoGain),this.echoGain.connect(this.eq),this.eq.connect(this.saturation),this.saturation.connect(this.feedbackGain),this.feedbackGain.connect(this.head1),this.feedbackGain.connect(this.head2),this.feedbackGain.connect(this.head3),this.reverb.connect(this.reverbGain),this.eq.connect(this.wetGain),this.reverbGain.connect(this.wetGain),this.wetGain.connect(this.output),this.setMode(this._options.mode)}setMode(e){this._options.mode=e;const t=[1,5,8,10,11].includes(e),a=[2,4,6,8,9,11].includes(e),n=[3,4,7,9,10,11].includes(e);this.head1Gain.gain.rampTo(t?1:0,.1),this.head2Gain.gain.rampTo(a?1:0,.1),this.head3Gain.gain.rampTo(n?1:0,.1);const s=e>=5;this.reverbGain.gain.rampTo(s?this._options.reverbVolume:0,.1)}setRate(e){this._options.rate=e,this.head1.delayTime.rampTo(e/1e3,.1),this.head2.delayTime.rampTo(2*e/1e3,.1),this.head3.delayTime.rampTo(3*e/1e3,.1)}setIntensity(e){this._options.intensity=e,this.feedbackGain.gain.rampTo(e,.1)}setEchoVolume(e){this._options.echoVolume=e,this.echoGain.gain.rampTo(e,.1)}setReverbVolume(e){this._options.reverbVolume=e,this._options.mode>=5&&this.reverbGain.gain.rampTo(e,.1)}setBass(e){this._options.bass=e,this.eq.low.value=e}setTreble(e){this._options.treble=e,this.eq.high.value=e}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.head1.dispose(),this.head2.dispose(),this.head3.dispose(),this.head1Gain.dispose(),this.head2Gain.dispose(),this.head3Gain.dispose(),this.feedbackGain.dispose(),this.reverb.dispose(),this.reverbGain.dispose(),this.echoGain.dispose(),this.eq.dispose(),this.saturation.dispose(),this.wowLFO.dispose(),this.wowGain.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const ci=Object.freeze(Object.defineProperty({__proto__:null,SpaceEchoEffect:li},Symbol.toStringTag,{value:"Module"}));let ui=null,di=null,pi=!1,mi=null;class hi extends d{name="SpaceyDelayer";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={firstTap:e.firstTap??250,tapSize:e.tapSize??150,feedback:Math.min(e.feedback??40,95),multiTap:e.multiTap??1,tapeFilter:e.tapeFilter??0,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initialize()}async initialize(){try{const e=ds(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await hi.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"spacey-delayer-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("firstTap",this._options.firstTap),this.sendParam("tapSize",this._options.tapSize),this.sendParam("feedback",this._options.feedback),this.sendParam("multiTap",this._options.multiTap),this.sendParam("tapeFilter",this._options.tapeFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:ui,jsCode:di}),x(this.input,this.workletNode),x(this.workletNode,this.wetGain)}catch(e){}}static async ensureModuleLoaded(e){if(!pi){if(mi)return mi;mi=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}spacey-delayer/SpaceyDelayer.worklet.js`)}catch(a){const e=a instanceof Error?a.message:String(a);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load SpaceyDelayer worklet: ${e}`)}if(!ui||!di){const[e,a]=await Promise.all([fetch(`${t}spacey-delayer/SpaceyDelayer.wasm`),fetch(`${t}spacey-delayer/SpaceyDelayer.js`)]);if(!e.ok||!a.ok)throw mi=null,new Error(`Failed to fetch SpaceyDelayer WASM/JS: wasm=${e.status} js=${a.status}`);ui=await e.arrayBuffer();let n=await a.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),n+="\nvar createSpaceyDelayer = createSpaceyDelayer || Module;",di=n}pi=!0})();try{await mi}catch(t){throw mi=null,pi=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setFirstTap(e){this._options.firstTap=Math.max(10,Math.min(e,2e3)),this.sendParam("firstTap",this._options.firstTap)}setTapSize(e){this._options.tapSize=Math.max(10,Math.min(e,1e3)),this.sendParam("tapSize",this._options.tapSize)}setFeedback(e){this._options.feedback=Math.max(0,Math.min(e,95)),this.sendParam("feedback",this._options.feedback)}setMultiTap(e){this._options.multiTap=e?1:0,this.sendParam("multiTap",e?1:0)}setTapeFilter(e){this._options.tapeFilter=e?1:0,this.sendParam("tapeFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const fi=Object.freeze(Object.defineProperty({__proto__:null,SpaceyDelayerEffect:hi},Symbol.toStringTag,{value:"Module"}));let yi=null,gi=null,bi=!1,vi=null;class xi extends d{name="RETapeEcho";input;output;dryGain;wetGain;workletNode=null;_disposed=!1;_options;constructor(e={}){super(),this._options={mode:Math.max(0,Math.min(e.mode??3,5)),repeatRate:Math.max(0,Math.min(e.repeatRate??.5,1)),intensity:Math.max(0,Math.min(e.intensity??.5,1)),echoVolume:Math.max(0,Math.min(e.echoVolume??.8,1)),wow:Math.max(0,Math.min(e.wow??0,1)),flutter:Math.max(0,Math.min(e.flutter??0,1)),dirt:Math.max(0,Math.min(e.dirt??0,1)),inputBleed:e.inputBleed??0,loopAmount:Math.max(0,Math.min(e.loopAmount??0,1)),playheadFilter:e.playheadFilter??1,wet:Math.max(0,Math.min(e.wet??.5,1))},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initialize()}async initialize(){try{const e=ds(this.context);if(!e)throw new Error("Could not get native AudioContext");if(await xi.ensureModuleLoaded(e),this._disposed)return;this.workletNode=new AudioWorkletNode(e,"re-tape-echo-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2],channelCount:2,channelCountMode:"explicit"}),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.sendParam("mode",this._options.mode),this.sendParam("repeatRate",this._options.repeatRate),this.sendParam("intensity",this._options.intensity),this.sendParam("echoVolume",this._options.echoVolume),this.sendParam("wow",this._options.wow),this.sendParam("flutter",this._options.flutter),this.sendParam("dirt",this._options.dirt),this.sendParam("inputBleed",this._options.inputBleed),this.sendParam("loopAmount",this._options.loopAmount),this.sendParam("playheadFilter",this._options.playheadFilter)):e.data.type},this.workletNode.port.postMessage({type:"init",sampleRate:e.sampleRate,wasmBinary:yi,jsCode:gi}),x(this.input,this.workletNode),x(this.workletNode,this.wetGain)}catch(e){}}static async ensureModuleLoaded(e){if(!bi){if(vi)return vi;vi=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}re-tape-echo/RETapeEcho.worklet.js`)}catch(a){const e=a instanceof Error?a.message:String(a);if(!e.includes("already")&&!e.includes("duplicate"))throw new Error(`Failed to load RETapeEcho worklet: ${e}`)}if(!yi||!gi){const[e,a]=await Promise.all([fetch(`${t}re-tape-echo/RETapeEcho.wasm`),fetch(`${t}re-tape-echo/RETapeEcho.js`)]);if(!e.ok||!a.ok)throw vi=null,new Error(`Failed to fetch RETapeEcho WASM/JS: wasm=${e.status} js=${a.status}`);yi=await e.arrayBuffer();let n=await a.text();n=n.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,""),n+="\nvar createRETapeEcho = createRETapeEcho || Module;",gi=n}bi=!0})();try{await vi}catch(t){throw vi=null,bi=!1,t}}}sendParam(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setParameter",param:e,value:t})}setMode(e){this._options.mode=Math.max(0,Math.min(Math.round(e),5)),this.sendParam("mode",this._options.mode)}setRepeatRate(e){this._options.repeatRate=Math.max(0,Math.min(e,1)),this.sendParam("repeatRate",this._options.repeatRate)}setIntensity(e){this._options.intensity=Math.max(0,Math.min(e,1)),this.sendParam("intensity",this._options.intensity)}setEchoVolume(e){this._options.echoVolume=Math.max(0,Math.min(e,1)),this.sendParam("echoVolume",this._options.echoVolume)}setWow(e){this._options.wow=Math.max(0,Math.min(e,1)),this.sendParam("wow",this._options.wow)}setFlutter(e){this._options.flutter=Math.max(0,Math.min(e,1)),this.sendParam("flutter",this._options.flutter)}setDirt(e){this._options.dirt=Math.max(0,Math.min(e,1)),this.sendParam("dirt",this._options.dirt)}setInputBleed(e){this._options.inputBleed=e?1:0,this.sendParam("inputBleed",e?1:0)}setLoopAmount(e){this._options.loopAmount=Math.max(0,Math.min(e,1)),this.sendParam("loopAmount",this._options.loopAmount)}setPlayheadFilter(e){this._options.playheadFilter=e?1:0,this.sendParam("playheadFilter",e?1:0)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.dryGain.gain.value=1-this._options.wet,this.wetGain.gain.value=this._options.wet}dispose(){return this._disposed=!0,this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}const wi=Object.freeze(Object.defineProperty({__proto__:null,RETapeEchoEffect:xi},Symbol.toStringTag,{value:"Module"}));class ki extends d{name="BiPhase";input;output;phaserA;phaserB;parallelInB;seriesInB;outputA;outputB;dryGain;wetGain;_options;constructor(e={}){super(),this._options={rateA:e.rateA??.5,depthA:e.depthA??.6,rateB:e.rateB??4,depthB:e.depthB??.4,feedback:e.feedback??.3,routing:e.routing??"parallel",wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.phaserA=new w({frequency:this._options.rateA,octaves:5*this._options.depthA,baseFrequency:350,stages:6,Q:20*this._options.feedback}),this.phaserB=new w({frequency:this._options.rateB,octaves:5*this._options.depthB,baseFrequency:450,stages:6,Q:20*this._options.feedback}),this.parallelInB=new p(0),this.seriesInB=new p(0),this.outputA=new p(1),this.outputB=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.phaserA),this.input.connect(this.parallelInB),this.parallelInB.connect(this.phaserB),this.phaserA.connect(this.seriesInB),this.seriesInB.connect(this.phaserB),this.phaserA.connect(this.outputA),this.outputA.connect(this.wetGain),this.phaserB.connect(this.outputB),this.outputB.connect(this.wetGain),this.wetGain.connect(this.output),this.setRouting(this._options.routing)}setRouting(e){this._options.routing=e,"parallel"===e?(this.parallelInB.gain.rampTo(1,.1),this.seriesInB.gain.rampTo(0,.1),this.outputA.gain.rampTo(1,.1),this.outputB.gain.rampTo(1,.1)):(this.parallelInB.gain.rampTo(0,.1),this.seriesInB.gain.rampTo(1,.1),this.outputA.gain.rampTo(0,.1),this.outputB.gain.rampTo(1,.1))}setRateA(e){this._options.rateA=e,this.phaserA.frequency.rampTo(e,.1)}setDepthA(e){this._options.depthA=e,this.phaserA.octaves=5*e}setRateB(e){this._options.rateB=e,this.phaserB.frequency.rampTo(e,.1)}setDepthB(e){this._options.depthB=e,this.phaserB.octaves=5*e}setFeedback(e){this._options.feedback=e;const t=20*e;this.phaserA.Q.value=t,this.phaserB.Q.value=t}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.phaserA.dispose(),this.phaserB.dispose(),this.parallelInB.dispose(),this.seriesInB.dispose(),this.outputA.dispose(),this.outputB.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const Si=Object.freeze(Object.defineProperty({__proto__:null,BiPhaseEffect:ki},Symbol.toStringTag,{value:"Module"}));class Mi extends d{name="DubFilter";input;output;filter;drive;gainNode;dryGain;wetGain;_options;constructor(e={}){super(),this._options={cutoff:e.cutoff??20,resonance:e.resonance??1,gain:e.gain??1,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.filter=new h({frequency:this._options.cutoff,type:"highpass",rolloff:-24,Q:this._options.resonance/100*20}),this.drive=new b({distortion:.1,wet:.5}),this.gainNode=new p(this._options.gain),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.input.connect(this.filter),this.filter.connect(this.drive),this.drive.connect(this.gainNode),this.gainNode.connect(this.wetGain),this.wetGain.connect(this.output)}setCutoff(e){this._options.cutoff=e,this.filter.frequency.rampTo(e,.05)}setResonance(e){this._options.resonance=e;const t=e/100*20;this.filter.Q.rampTo(t,.1)}setGain(e){this._options.gain=e,this.gainNode.gain.rampTo(e,.1)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}dispose(){return super.dispose(),this.filter.dispose(),this.drive.dispose(),this.gainNode.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),this}}const Ni=Object.freeze(Object.defineProperty({__proto__:null,DubFilterEffect:Mi},Symbol.toStringTag,{value:"Module"})),Ci={Hyperion:0,Krajeski:1,Stilson:2,Microtracker:3,Improved:4,Oberheim:5},Pi={LP2:0,LP4:1,BP2:2,BP4:3,HP2:4,HP4:5,NOTCH:6};function Ei(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class _i extends d{name="MoogFilter";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackFilter=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={cutoff:e.cutoff??1e3,resonance:e.resonance??.1,drive:e.drive??1,model:e.model??Ci.Hyperion,filterMode:e.filterMode??Pi.LP4,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setCutoff(e){this._options.cutoff=Math.max(20,Math.min(2e4,e)),this.sendParam(1,this._options.cutoff),this.fallbackFilter&&this.fallbackFilter.setCutoff(this._options.cutoff)}setResonance(e){this._options.resonance=Math.max(0,Math.min(1,e)),this.sendParam(2,this._options.resonance),this.fallbackFilter&&this.fallbackFilter.setResonance(this._options.resonance)}setDrive(e){this._options.drive=Math.max(.1,Math.min(4,e)),this.sendParam(3,this._options.drive)}setModel(e){this._options.model=e,this.sendParam(0,e)}setFilterMode(e){this._options.filterMode=e,this.sendParam(4,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await _i.ensureInitialized(e),!_i.wasmBinary||!_i.jsCode)return;this.workletNode=new AudioWorkletNode(e,"moogfilters-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.model),this.sendParam(1,this._options.cutoff),this.sendParam(2,this._options.resonance),this.sendParam(3,this._options.drive),this.sendParam(4,this._options.filterMode),this.sendParam(5,1),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:_i.wasmBinary,jsCode:_i.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}moogfilters/MoogFilters.worklet.js`)}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}moogfilters/MoogFilters.wasm`),fetch(`${t}moogfilters/MoogFilters.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackFilter=new Ti(e.sampleRate),this.fallbackFilter.setCutoff(this._options.cutoff),this.fallbackFilter.setResonance(this._options.resonance);let t=0;this.fallbackNode.onaudioprocess=e=>{const a=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),s=e.outputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(1);this.fallbackFilter.process(a,n,s,r),t++};const a=Ei(this.input),n=Ei(this.wetGain);a.connect(this.fallbackNode),this.fallbackNode.connect(n);const s=e.createGain();s.gain.value=0,this.fallbackNode.connect(s),s.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=k().rawContext,t=Ei(this.input),a=Ei(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(a),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=e.createGain();n.gain.value=0,this.workletNode.connect(n),n.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}class Ti{sampleRate;stateL=new Float64Array(5);delayL=new Float64Array(5);stateR=new Float64Array(5);delayR=new Float64Array(5);wc=0;g=0;gRes=0;gComp=1;drive=1;constructor(e){this.sampleRate=e,this.setCutoff(1e3),this.setResonance(.1)}setCutoff(e){this.wc=2*Math.PI*e/this.sampleRate,this.g=.9892*this.wc-.4342*this.wc**2+.1381*this.wc**3-.0202*this.wc**4,this.updateResonance()}setResonance(e){this._resonance=e,this.updateResonance()}_resonance=.1;updateResonance(){this.gRes=this._resonance*(1.0029+.0526*this.wc-.926*this.wc**2+.0218*this.wc**3)}process(e,t,a,n){const s=e.length,{stateL:r,delayL:i,stateR:o,delayR:l,g:c,gRes:u,gComp:d,drive:p}=this;for(let m=0;m<s;m++){r[0]=Math.tanh(p*(e[m]-4*u*(r[4]-d*e[m])));for(let e=0;e<4;e++)r[e+1]=Ai(c*(.3/1.3*r[e]+1/1.3*i[e]-r[e+1])+r[e+1]),i[e]=r[e];a[m]=r[4],o[0]=Math.tanh(p*(t[m]-4*u*(o[4]-d*t[m])));for(let e=0;e<4;e++)o[e+1]=Ai(c*(.3/1.3*o[e]+1/1.3*l[e]-o[e+1])+o[e+1]),l[e]=o[e];n[m]=o[4]}}}function Ai(e){return Math.min(Math.max(e,-1e30),1e30)}const Oi=Object.freeze(Object.defineProperty({__proto__:null,MoogFilterEffect:_i,MoogFilterMode:Pi,MoogFilterModel:Ci},Symbol.toStringTag,{value:"Module"}));function Ii(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class Fi extends d{name="MVerb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={damping:e.damping??.5,density:e.density??.5,bandwidth:e.bandwidth??.5,decay:e.decay??.7,predelay:e.predelay??0,size:e.size??.8,gain:e.gain??1,mix:e.mix??.4,earlyMix:e.earlyMix??.5,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setDamping(e){this._options.damping=Di(e),this.sendParam(0,e)}setDensity(e){this._options.density=Di(e),this.sendParam(1,e)}setBandwidth(e){this._options.bandwidth=Di(e),this.sendParam(2,e)}setDecay(e){this._options.decay=Di(e),this.sendParam(3,e)}setPredelay(e){this._options.predelay=Di(e),this.sendParam(4,e)}setSize(e){this._options.size=Di(e),this.sendParam(5,e)}setGain(e){this._options.gain=Di(e),this.sendParam(6,e)}setMix(e){this._options.mix=Di(e),this.sendParam(7,e)}setEarlyMix(e){this._options.earlyMix=Di(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Di(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await Fi.ensureInitialized(e),!Fi.wasmBinary||!Fi.jsCode)return;this.workletNode=new AudioWorkletNode(e,"mverb-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.damping),this.sendParam(1,this._options.density),this.sendParam(2,this._options.bandwidth),this.sendParam(3,this._options.decay),this.sendParam(4,this._options.predelay),this.sendParam(5,this._options.size),this.sendParam(6,this._options.gain),this.sendParam(7,1),this.sendParam(8,this._options.earlyMix),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:Fi.wasmBinary,jsCode:Fi.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}mverb/MVerb.worklet.js`)}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}mverb/MVerb.wasm`),fetch(`${t}mverb/MVerb.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new Ri(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,a,n,s)};const t=Ii(this.input),a=Ii(this.wetGain);t.connect(this.fallbackNode),this.fallbackNode.connect(a);const n=e.createGain();n.gain.value=0,this.fallbackNode.connect(n),n.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=k().rawContext,t=Ii(this.input),a=Ii(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(a),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=e.createGain();n.gain.value=0,this.workletNode.connect(n),n.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function Di(e){return Math.max(0,Math.min(1,e))}class Ri{combs;allpasses;constructor(e){const t=e/44100;this.combs=[new ji(Math.round(1116*t),.84),new ji(Math.round(1188*t),.84),new ji(Math.round(1277*t),.84),new ji(Math.round(1356*t),.84)],this.allpasses=[new Bi(Math.round(556*t),.5),new Bi(Math.round(441*t),.5)]}process(e,t,a,n){const s=e.length;for(let r=0;r<s;r++){const s=.5*(e[r]+t[r]);let i=0;for(const e of this.combs)i+=e.process(s);i*=.25;for(const e of this.allpasses)i=e.process(i);a[r]=i,n[r]=i}}}class ji{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index];return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,t}}class Bi{buffer;index=0;feedback;constructor(e,t){this.buffer=new Float32Array(e),this.feedback=t}process(e){const t=this.buffer[this.index],a=-e+t;return this.buffer[this.index]=e+t*this.feedback,this.index=(this.index+1)%this.buffer.length,a}}const Li=Object.freeze(Object.defineProperty({__proto__:null,MVerbEffect:Fi},Symbol.toStringTag,{value:"Module"}));function Vi(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class zi extends d{name="Leslie";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackLeslie=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={speed:e.speed??0,hornRate:e.hornRate??6.8,drumRate:e.drumRate??5.9,hornDepth:e.hornDepth??.7,drumDepth:e.drumDepth??.5,doppler:e.doppler??.5,mix:e.mix??1,width:e.width??.8,acceleration:e.acceleration??.5,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setSpeed(e){this._options.speed=Ui(e),this.sendParam(0,e)}setHornRate(e){this._options.hornRate=Math.max(.1,Math.min(10,e)),this.sendParam(1,e)}setDrumRate(e){this._options.drumRate=Math.max(.1,Math.min(8,e)),this.sendParam(2,e)}setHornDepth(e){this._options.hornDepth=Ui(e),this.sendParam(3,e)}setDrumDepth(e){this._options.drumDepth=Ui(e),this.sendParam(4,e)}setDoppler(e){this._options.doppler=Ui(e),this.sendParam(5,e)}setMix(e){this._options.mix=Ui(e),this.sendParam(6,e)}setWidth(e){this._options.width=Ui(e),this.sendParam(7,e)}setAcceleration(e){this._options.acceleration=Ui(e),this.sendParam(8,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=Ui(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await zi.ensureInitialized(e),!zi.wasmBinary||!zi.jsCode)return;this.workletNode=new AudioWorkletNode(e,"leslie-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.speed),this.sendParam(1,this._options.hornRate),this.sendParam(2,this._options.drumRate),this.sendParam(3,this._options.hornDepth),this.sendParam(4,this._options.drumDepth),this.sendParam(5,this._options.doppler),this.sendParam(6,1),this.sendParam(7,this._options.width),this.sendParam(8,this._options.acceleration),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:zi.wasmBinary,jsCode:zi.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}leslie/Leslie.worklet.js`)}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}leslie/Leslie.wasm`),fetch(`${t}leslie/Leslie.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackLeslie=new Gi(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackLeslie.process(t,a,n,s)};const t=Vi(this.input),a=Vi(this.wetGain);t.connect(this.fallbackNode),this.fallbackNode.connect(a);const n=e.createGain();n.gain.value=0,this.fallbackNode.connect(n),n.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=k().rawContext,t=Vi(this.input),a=Vi(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(a),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=e.createGain();n.gain.value=0,this.workletNode.connect(n),n.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t})}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function Ui(e){return Math.max(0,Math.min(1,e))}class Gi{phase=0;rate=6.8;sampleRate;constructor(e){this.sampleRate=e}process(e,t,a,n){const s=e.length;for(let r=0;r<s;r++){const s=Math.sin(2*this.phase*Math.PI),i=.7+.3*s;a[r]=e[r]*i,n[r]=t[r]*(.7-.3*s),this.phase+=this.rate/this.sampleRate,this.phase>=1&&(this.phase-=1)}}}const Wi=Object.freeze(Object.defineProperty({__proto__:null,LeslieEffect:zi},Symbol.toStringTag,{value:"Module"}));function Hi(e){const t=e;return t._gainNode??t._nativeAudioNode??t._node??e}class Ki extends d{name="SpringReverb";input;output;dryGain;wetGain;workletNode=null;isWasmReady=!1;fallbackNode=null;fallbackReverb=null;usingFallback=!1;_options;static wasmBinary=null;static jsCode=null;static loadedContexts=new Set;static initPromises=new Map;constructor(e={}){super(),this._options={decay:e.decay??.6,damping:e.damping??.4,tension:e.tension??.5,mix:e.mix??.35,drip:e.drip??.5,diffusion:e.diffusion??.7,wet:e.wet??1},this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-this._options.wet),this.wetGain=new p(this._options.wet),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.wetGain.connect(this.output),this.initFallback(),this.initWasm()}setDecay(e){this._options.decay=qi(e),this.sendParam(0,e)}setDamping(e){this._options.damping=qi(e),this.sendParam(1,e)}setTension(e){this._options.tension=qi(e),this.sendParam(2,e)}setSpringMix(e){this._options.mix=qi(e),this.sendParam(3,e)}setDrip(e){this._options.drip=qi(e),this.sendParam(4,e)}setDiffusion(e){this._options.diffusion=qi(e),this.sendParam(5,e)}get wet(){return this._options.wet}set wet(e){this._options.wet=qi(e),this.wetGain.gain.value=this._options.wet,this.dryGain.gain.value=1-this._options.wet}async initWasm(){try{const e=k().rawContext;if(await Ki.ensureInitialized(e),!Ki.wasmBinary||!Ki.jsCode)return;this.workletNode=new AudioWorkletNode(e,"springreverb-processor"),this.workletNode.port.onmessage=e=>{"ready"===e.data.type?(this.isWasmReady=!0,this.sendParam(0,this._options.decay),this.sendParam(1,this._options.damping),this.sendParam(2,this._options.tension),this.sendParam(3,1),this.sendParam(4,this._options.drip),this.sendParam(5,this._options.diffusion),this.swapToWasm()):e.data.type},this.workletNode.port.postMessage({type:"init",wasmBinary:Ki.wasmBinary,jsCode:Ki.jsCode})}catch(e){}}static async ensureInitialized(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/";try{await e.audioWorklet.addModule(`${t}springreverb/SpringReverb.worklet.js`)}catch{}if(!this.wasmBinary||!this.jsCode)try{const[e,a]=await Promise.all([fetch(`${t}springreverb/SpringReverb.wasm`),fetch(`${t}springreverb/SpringReverb.js`)]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),a.ok){let e=await a.text();e=e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?\s*$/m,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/var\s+wasmBinary;/,'var wasmBinary = Module["wasmBinary"];').replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e="var self = globalThis;\n"+e,this.jsCode=e}}catch(a){}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}initFallback(){try{const e=k().rawContext;this.fallbackNode=e.createScriptProcessor(256,2,2),this.fallbackReverb=new $i(e.sampleRate),this.fallbackNode.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1);this.fallbackReverb.process(t,a,n,s)};const t=Hi(this.input),a=Hi(this.wetGain);t.connect(this.fallbackNode),this.fallbackNode.connect(a);const n=e.createGain();n.gain.value=0,this.fallbackNode.connect(n),n.connect(e.destination),this.usingFallback=!0}catch(e){this.input.connect(this.wetGain)}}swapToWasm(){if(this.workletNode)try{const e=k().rawContext,t=Hi(this.input),a=Hi(this.wetGain);if(t.connect(this.workletNode),this.workletNode.connect(a),this.fallbackNode&&this.usingFallback){try{this.fallbackNode.disconnect()}catch{}this.fallbackNode.onaudioprocess=null,this.usingFallback=!1}const n=e.createGain();n.gain.value=0,this.workletNode.connect(n),n.connect(e.destination)}catch(e){}}sendParam(e,t){this.workletNode&&this.isWasmReady&&this.workletNode.port.postMessage({type:"parameter",paramId:e,value:t}),this.usingFallback&&this.fallbackReverb&&(0===e&&this.fallbackReverb.setFeedback(t),1===e&&this.fallbackReverb.setDamping(t))}dispose(){if(this.workletNode){this.workletNode.port.postMessage({type:"dispose"});try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.fallbackNode){this.fallbackNode.onaudioprocess=null;try{this.fallbackNode.disconnect()}catch{}this.fallbackNode=null}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose(),this}}function qi(e){return Math.max(0,Math.min(1,e))}class $i{combs;dampingCoeff=.4;constructor(e){const t=e/44100;this.combs=[{buffer:new Float32Array(Math.round(1116*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1188*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1277*t)),index:0,feedback:.8,lp:0},{buffer:new Float32Array(Math.round(1356*t)),index:0,feedback:.8,lp:0}]}setFeedback(e){const t=.5+.45*qi(e);for(const a of this.combs)a.feedback=t}setDamping(e){this.dampingCoeff=.1+.8*qi(e)}process(e,t,a,n){const s=e.length,r=this.dampingCoeff;for(let i=0;i<s;i++){const s=.5*(e[i]+t[i]);let o=0;for(const e of this.combs){const t=e.buffer[e.index];e.lp=t+r*(e.lp-t),e.buffer[e.index]=s+e.lp*e.feedback,e.index=(e.index+1)%e.buffer.length,o+=t}o*=.25,a[i]=o,n[i]=o}}}const Xi=Object.freeze(Object.defineProperty({__proto__:null,SpringReverbEffect:Ki},Symbol.toStringTag,{value:"Module"})),Yi={"1/1":4,"1/2":2,"1/4":1,"1/8":.5,"1/16":.25,"1/32":.125,"1/2d":3,"1/4d":1.5,"1/8d":.75,"1/16d":.375,"1/2t":4/3,"1/4t":2/3,"1/8t":1/3};function Zi(e,t){return 6e4/e*Yi[t]}const Qi=[{value:"1/1",label:"1/1",category:"Straight"},{value:"1/2",label:"1/2",category:"Straight"},{value:"1/4",label:"1/4",category:"Straight"},{value:"1/8",label:"1/8",category:"Straight"},{value:"1/16",label:"1/16",category:"Straight"},{value:"1/32",label:"1/32",category:"Straight"},{value:"1/2d",label:"1/2.",category:"Dotted"},{value:"1/4d",label:"1/4.",category:"Dotted"},{value:"1/8d",label:"1/8.",category:"Dotted"},{value:"1/16d",label:"1/16.",category:"Dotted"},{value:"1/2t",label:"1/2T",category:"Triplet"},{value:"1/4t",label:"1/4T",category:"Triplet"},{value:"1/8t",label:"1/8T",category:"Triplet"}],Ji={Delay:[{param:"time",unit:"seconds"}],FeedbackDelay:[{param:"time",unit:"seconds"}],PingPongDelay:[{param:"time",unit:"seconds"}],SpaceEcho:[{param:"rate",unit:"ms"}],SpaceyDelayer:[{param:"firstTap",unit:"ms"}],RETapeEcho:[{param:"repeatRate",unit:"normalized"}],Chorus:[{param:"frequency",unit:"hz"}],BiPhase:[{param:"rateA",unit:"hz"}]};function eo(e,t,a){switch(a){case"seconds":return function(e,t){return Zi(e,t)/1e3}(e,t);case"ms":default:return Zi(e,t);case"hz":return function(e,t){return 1e3/Zi(e,t)}(e,t);case"normalized":return Math.min(1,Math.max(0,Zi(e,t)/1e3))}}function to(e){return 1===e.bpmSync}function ao(e){const t=e.syncDivision;return t&&t in Yi?t:"1/8"}class no extends d{name="SidechainCompressor";compressor;dryGain;wetGain;sidechainInput;sidechainGainNode;sidechainAnalyser;_threshold;_ratio;_attack;_release;_knee;_sidechainGain;_wet;animationFrame=null;baseThreshold;input;output;constructor(e={}){super(),this._threshold=e.threshold??-24,this._ratio=e.ratio??4,this._attack=e.attack??.003,this._release=e.release??.25,this._knee=e.knee??6,this._sidechainGain=e.sidechainGain??1,this._wet=e.wet??1,this.baseThreshold=this._threshold,this.input=new p(1),this.output=new p(1),this.compressor=new S({threshold:this._threshold,ratio:this._ratio,attack:this._attack,release:this._release,knee:this._knee}),this.dryGain=new p(1-this._wet),this.wetGain=new p(this._wet),this.sidechainInput=new p(1),this.sidechainGainNode=new p(this._sidechainGain),this.sidechainAnalyser=new M({smoothing:.8,normalRange:!1}),this.input.connect(this.compressor),this.compressor.connect(this.wetGain),this.wetGain.connect(this.output),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this.sidechainInput.connect(this.sidechainGainNode),this.sidechainGainNode.connect(this.sidechainAnalyser),this.startSidechainPolling()}getSidechainInput(){return this.sidechainInput}startSidechainPolling=()=>{this.updateSidechain()};updateSidechain=()=>{const e=this.sidechainAnalyser.getValue(),t="number"==typeof e?e:e[0];if(t>-60){const e=24*Math.min(1,Math.max(0,(t+60)/60))*this._sidechainGain;this.compressor.threshold.value=this.baseThreshold-e}else this.compressor.threshold.value=this.baseThreshold;this.animationFrame=requestAnimationFrame(this.updateSidechain)};get threshold(){return this._threshold}set threshold(e){this._threshold=Math.max(-60,Math.min(0,e)),this.baseThreshold=this._threshold,this.compressor.threshold.value=this._threshold}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.max(1,Math.min(20,e)),this.compressor.ratio.value=this._ratio}get attack(){return this._attack}set attack(e){this._attack=Math.max(.001,Math.min(.5,e)),this.compressor.attack.value=this._attack}get release(){return this._release}set release(e){this._release=Math.max(.01,Math.min(1,e)),this.compressor.release.value=this._release}get knee(){return this._knee}set knee(e){this._knee=Math.max(0,Math.min(40,e)),this.compressor.knee.value=this._knee}get sidechainGain(){return this._sidechainGain}set sidechainGain(e){this._sidechainGain=Math.max(0,Math.min(2,e)),this.sidechainGainNode.gain.value=this._sidechainGain}get wet(){return this._wet}set wet(e){this._wet=Math.max(0,Math.min(1,e)),this.wetGain.gain.value=this._wet,this.dryGain.gain.value=1-this._wet}getReduction(){return this.compressor.reduction}dispose(){return null!==this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),super.dispose(),this.compressor.dispose(),this.dryGain.dispose(),this.wetGain.dispose(),this.sidechainInput.dispose(),this.sidechainGainNode.dispose(),this.sidechainAnalyser.dispose(),this}}const so=Object.freeze(Object.defineProperty({__proto__:null,SidechainCompressor:no},Symbol.toStringTag,{value:"Module"}));class ro{config;loop=null;currentStepIndex=0;pingPongDirection=1;baseNote="C4";baseVelocity=1;isPlaying=!1;heldNotes=new Set;onStep;onNoteOn;onNoteOff;currentPlayingNote=null;constructor(e){this.config={...e.config},this.onStep=e.onStep,this.onNoteOn=e.onNoteOn,this.onNoteOff=e.onNoteOff}getSteps(){return this.config.steps&&this.config.steps.length>0?this.config.steps:this.config.pattern&&this.config.pattern.length>0?this.config.pattern.map(e=>({noteOffset:e})):[{noteOffset:0}]}getInterval(){const{speed:e,speedUnit:t}=this.config,a=N().bpm.value;switch(t){case"hz":return 1/Math.max(1,Math.min(60,e));case"ticks":return 60/a*(e/48);case"division":return{1:"1n",2:"2n",4:"4n",8:"8n",16:"16n",32:"32n",64:"64n"}[e]||`${e}n`;default:return 1/15}}getSwingAdjustedTime(e,t){const a=(this.config.swing??0)/100;if(0===a)return e;if(t%2==0){return e+("number"==typeof this.getInterval()?this.getInterval():.066)*a*.5}return e}getNextStepIndex(){const e=this.getSteps().length;switch(this.config.mode){case"loop":default:return(this.currentStepIndex+1)%e;case"pingpong":{let t=this.currentStepIndex+this.pingPongDirection;return t>=e?(this.pingPongDirection=-1,t=e-2):t<0&&(this.pingPongDirection=1,t=1),e<=2?(this.currentStepIndex+1)%e:Math.max(0,Math.min(e-1,t))}case"oneshot":{const t=this.currentStepIndex+1;return t>=e?(this.isPlaying=!1,e-1):t}case"random":return Math.floor(Math.random()*e)}}midiToNoteName(e){const t=Math.floor(e/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}${t}`}noteNameToMidi(e){const t=e.match(/^([A-Ga-g][#b]?)(-?\d+)$/);if(!t)return 60;const a=t[1].charAt(0).toUpperCase()+t[1].slice(1);return 12*(parseInt(t[2],10)+1)+({C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[a]??0)}processStep(){if(!this.isPlaying)return;const e=this.getSteps()[this.currentStepIndex];if(!e)return;if("skip"===e.effect)return void(this.currentStepIndex=this.getNextStepIndex());const t=this.noteNameToMidi(this.baseNote)+e.noteOffset,a=this.midiToNoteName(t),n=(e.volume??100)/100,s="accent"===e.effect?1.2:1,r=Math.min(1,this.baseVelocity*n*s),i=(e.gate??100)/100,o=("number"==typeof this.getInterval()?this.getInterval():C(this.getInterval()).toSeconds())*i*.95;this.currentPlayingNote&&this.onNoteOff&&this.onNoteOff(this.currentPlayingNote),this.onNoteOn&&this.onNoteOn(a,r,o),this.currentPlayingNote=a,this.onStep&&this.onStep(this.currentStepIndex,e,e.noteOffset),this.currentStepIndex=this.getNextStepIndex()}start(e,t=1){if(this.isPlaying)return this.baseNote=e,this.baseVelocity=t,void this.heldNotes.add(e);this.baseNote=e,this.baseVelocity=t,this.currentStepIndex=0,this.pingPongDirection=1,this.isPlaying=!0,this.heldNotes.add(e);const a=this.getInterval();this.loop=new P(()=>{this.processStep()},a),this.loop.start(0)}stop(e){if(e){if(this.heldNotes.delete(e),this.heldNotes.size>0){const e=Array.from(this.heldNotes)[this.heldNotes.size-1];return void(this.baseNote=e)}}else this.heldNotes.clear();this.currentPlayingNote&&this.onNoteOff&&(this.onNoteOff(this.currentPlayingNote),this.currentPlayingNote=null),this.loop&&(this.loop.stop(),this.loop.dispose(),this.loop=null),this.isPlaying=!1,this.currentStepIndex=0,this.pingPongDirection=1}stopAll(){this.heldNotes.clear(),this.stop()}updateConfig(e){if(this.config={...this.config,...e},this.loop&&this.isPlaying){const e=this.getInterval();this.loop.interval=e}"oneshot"===e.mode&&(this.currentStepIndex=0)}getCurrentStep(){return this.currentStepIndex}getIsPlaying(){return this.isPlaying}getConfig(){return{...this.config}}dispose(){this.stopAll(),this.loop&&(this.loop.dispose(),this.loop=null)}}const io={OPN2:0,OPM:1,OPL3:2,OPLL:11,OPNA:13,OPNB:14,OPZ:22,Y8950:23,OPL4:26,OPN:47,OPNB_B:48,ESFM:49,PSG:3,AY:12,SAA:18,T6W28:43,AY8930:50,NES:4,GB:5,SNES:24,FDS:16,MMC5:17,VRC6:9,N163:8,VB:44,NDS:51,GBA_DMA:52,GBA_MINMOD:53,POKEMINI:54,PCE:6,SCC:7,SWAN:19,SM8521:37,BUBBLE:38,X1_010:41,NAMCO:55,SID:10,SID_6581:45,SID_8580:46,VIC:33,TED:34,PET:56,TIA:15,POKEY:57,LYNX:25,OKI:20,ES5506:21,SEGAPCM:27,YMZ280B:28,RF5C68:29,GA20:30,C140:31,QSOUND:32,K007232:39,K053260:40,MSM6258:58,MSM5232:59,MULTIPCM:60,AMIGA:61,VERA:36,SUPERVISION:35,UPD1771:42,PCSPKR:62,PONG:63,PV1000:64,DAVE:65,SU:66,BIFURCATOR:67,POWERNOISE:68,ZXBEEPER:69,ZXBEEPER_QT:70,SCVTONE:71,PCMDAC:72},oo="__FurnaceChipEngineInstance__";class lo{static instance=null;static instanceId=0;myInstanceId;isLoaded=!1;initPromise=null;initFailedPermanently=!1;workletNode=null;lastInitAttempt=0;writeCount=0;nativeContext=null;rawContext=null;outputGain=null;constructor(){this.myInstanceId=++lo.instanceId}static getInstance(){const e=globalThis[oo];return e?(lo.instance!==e&&(lo.instance=e),e):(lo.instance||(lo.instance=new lo,globalThis[oo]=lo.instance),lo.instance)}async init(e){if(this.isLoaded)return;if(this.initFailedPermanently)return;if(this.initPromise)return this.initPromise;const t=Date.now();return t-this.lastInitAttempt<500?void 0:(this.lastInitAttempt=t,this.initPromise=this.doInit(e),this.initPromise)}async doInit(e){try{const s=e,r=s.rawContext||s._context||e,i=ds(e);if(!r||!r.audioWorklet)return void(this.initPromise=null);if("running"!==r.state){try{await r.resume()}catch{}if("running"!==r.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===r.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const o="/DEViLBOX/",l=`?v=${Date.now()}`,c=i instanceof AudioContext?i:r,u=`${o}FurnaceChips.worklet.js${l}`;try{await c.audioWorklet.addModule(u)}catch(t){const e=t instanceof Error?t:null;if(!e?.message?.includes("already")&&"InvalidStateError"!==e?.name)return void(this.initPromise=null)}const d=`${o}FurnaceChips.wasm${l}`,p=`${o}FurnaceChips.js${l}`,[m,h]=await Promise.all([fetch(d,{cache:"no-store"}),fetch(p,{cache:"no-store"})]);if(!m.ok)return void(this.initPromise=null);if(!h.ok)return void(this.initPromise=null);const f=await m.arrayBuffer();let y=await h.text();y='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+y.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');try{this.nativeContext=i,this.workletNode=new AudioWorkletNode(c,"furnace-chips-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode}catch(t){return void(this.initPromise=null)}const g=new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e4),a=n=>{"initialized"===n.data.type&&(clearTimeout(t),this.workletNode?.port.removeEventListener("message",a),e(!0))};this.workletNode.port.addEventListener("message",a),this.workletNode.port.start()});this.workletNode&&this.workletNode.port.postMessage({type:"init",wasmBinary:f,jsCode:y});if(await g){this.isLoaded=!0,this.rawContext=c;try{const e=c.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(c.destination),this.outputGain=e}catch(a){try{if(i&&i.destination){const e=i.createGain();e.gain.value=1,this.workletNode.connect(e),e.connect(i.destination),this.outputGain=e}}catch(n){}}this.workletNode.port.addEventListener("message",e=>{"debug"===e.data.type?e.data.msgType:e.data.type}),setTimeout(()=>{this.requestWorkletStatus()},500)}else this.initPromise=null}catch(t){this.initPromise=null}}write(e,t,a){if(this.writeCount,!this.workletNode)return this.writeCount,void this.writeCount++;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(()=>{});const n={type:"write",chipType:e,register:t,value:a,writeId:this.writeCount};this.workletNode.port.postMessage(n);const s=8===t||40===t||t>=160&&t<=167;if(this.writeCount<10||s){this.nativeContext}this.writeCount++}getDiagnostics(){return{loaded:this.isLoaded,hasWorklet:null!==this.workletNode,contextState:this.nativeContext?.state||null}}requestWorkletStatus(){this.workletNode&&this.workletNode.port.postMessage({type:"getStatus"})}testPing(){this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now()})}testWrite(){this.workletNode&&this.workletNode.port.postMessage({type:"write",chipType:0,register:255,value:170,writeId:-1})}getNativeOutput(){return this.outputGain}getWorkletDiagnostics(){const e=null!==this.workletNode,t=null!==this.workletNode?.port;return{hasNode:e,hasPort:t,portId:t?`port-inst-${this.myInstanceId}`:"none"}}resetWriteCount(){this.writeCount=0;this.rawContext;this.rawContext&&"running"!==this.rawContext.state&&this.rawContext.resume().catch(e=>{}),this.workletNode&&this.workletNode.port.postMessage({type:"ping",timestamp:Date.now(),label:"post-reset"})}setWavetable(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",chipType:e,index:t,data:a})}setLogging(e){this.workletNode&&this.workletNode.port.postMessage({type:"setLogging",enabled:e})}async getLog(){return this.workletNode?new Promise(e=>{const t=a=>{"logData"===a.data.type&&(this.workletNode?.port.removeEventListener("message",t),e(a.data.data))};this.workletNode?.port.addEventListener("message",t),this.workletNode?.port.postMessage({type:"getLog"})}):new Uint8Array(0)}getOutput(){if(!this.workletNode)throw new Error("Engine not initialized");return this.workletNode}setOutputGain(e){this.outputGain&&this.outputGain.gain.setValueAtTime(e,this.rawContext?.currentTime||0)}getOutputGainValue(){return this.outputGain?.gain.value??1}isInitialized(){return this.isLoaded&&null!==this.workletNode}deactivate(e){this.workletNode&&this.workletNode.port.postMessage({type:"deactivate",chipType:e})}}const co=[{id:"32x16FunkyLead",name:"Funky Lead",category:"32x16",len:32,max:15,data:[8,15,14,11,9,6,4,4,6,7,6,4,3,3,4,6,8,9,11,12,12,11,9,8,9,11,11,9,6,4,1,0]},{id:"32x16NamcoBass",name:"Namco Bass",category:"32x16",len:32,max:15,data:[7,10,12,13,14,13,12,10,7,4,2,1,0,1,2,4,7,11,13,14,13,11,7,3,1,0,1,3,7,14,7,0]},{id:"32x16ataribass",name:"Atari Bass",category:"32x16",len:32,max:15,data:[15,15,0,0,15,15,0,0,0,0,15,15,15,15,0,0,15,15,15,15,15,15,0,0,0,0,0,0,0,0,0,0]},{id:"32x16brass",name:"Brass",category:"32x16",len:32,max:15,data:[15,14,13,12,11,8,6,2,4,3,7,9,9,7,5,0,15,15,13,13,13,11,11,8,8,0,0,0,0,0,0,0]},{id:"32x16clarinet",name:"Clarinet",category:"32x16",len:32,max:15,data:[12,14,15,15,15,15,15,15,15,15,15,15,15,15,14,12,3,1,0,0,0,0,0,0,0,0,0,0,0,0,1,3]},{id:"32x16distortedsquare",name:"Distorted Square",category:"32x16",len:32,max:15,data:[14,12,10,11,14,9,10,13,9,14,10,15,13,7,14,6,5,1,6,0,3,2,4,5,0,3,2,4,2,3,6,1]},{id:"32x16eguitar",name:"E-Guitar",category:"32x16",len:32,max:15,data:[0,12,9,6,13,2,9,12,4,3,4,12,10,8,8,1,2,0,9,10,10,12,0,0,5,3,0,15,0,0,10,10]},{id:"32x16flute",name:"Flute",category:"32x16",len:32,max:15,data:[12,14,15,15,14,14,14,15,13,14,15,15,14,13,11,9,6,4,2,0,0,2,2,2,1,1,1,1,0,1,2,4]},{id:"32x16guitar",name:"Guitar",category:"32x16",len:32,max:15,data:[9,15,15,14,15,15,15,15,15,15,15,13,5,1,1,3,7,7,5,4,2,1,0,4,8,7,4,1,2,3,5,6]},{id:"32x16opllpiano",name:"OPLL Piano",category:"32x16",len:32,max:15,data:[7,13,15,15,15,15,14,11,10,12,15,14,8,3,2,4,7,11,13,13,10,4,0,2,5,5,3,1,0,0,0,1]},{id:"32x16opllvibra",name:"OPLL Vibraphone",category:"32x16",len:32,max:15,data:[5,14,12,9,8,15,15,15,14,15,12,13,15,15,11,4,7,11,9,1,0,2,4,1,1,0,0,0,4,7,4,1]},{id:"32x16reedorgan",name:"Reed Organ",category:"32x16",len:32,max:15,data:[8,12,10,11,10,12,12,13,12,15,14,13,12,13,13,9,6,2,2,3,2,1,0,3,2,3,3,5,4,5,3,7]},{id:"32x16saw",name:"Saw",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15]},{id:"32x16saw2",name:"Saw 2",category:"32x16",len:32,max:15,data:[15,14,13,12,11,10,9,8,15,14,13,12,11,10,9,8,12,14,12,10,8,6,5,4,3,3,2,2,1,1,0,0]},{id:"32x16sax",name:"Sax",category:"32x16",len:32,max:15,data:[0,1,2,3,4,5,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,0,15,10,11,12,13,14,15,15]},{id:"32x16slapbass",name:"Slap Bass",category:"32x16",len:32,max:15,data:[8,13,15,15,13,11,8,7,6,8,10,14,15,12,4,0,8,15,12,3,0,2,5,8,9,9,7,5,2,0,0,3]},{id:"32x16synthbass",name:"Synth Bass",category:"32x16",len:32,max:15,data:[10,9,9,8,5,7,7,5,4,4,5,7,8,9,10,10,10,9,7,6,8,10,12,12,12,11,8,4,3,2,3,1]},{id:"32x16synthbrass",name:"Synth Brass",category:"32x16",len:32,max:15,data:[2,15,5,0,0,9,15,13,11,9,12,14,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x16trumpet",name:"Trumpet",category:"32x16",len:32,max:15,data:[7,15,13,12,10,10,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,6,5,5,3,2,0,0]},{id:"32x16voice",name:"Voice",category:"32x16",len:32,max:15,data:[7,8,9,10,10,11,11,12,12,12,12,12,12,12,12,12,11,11,10,10,9,8,7,2,1,0,0,0,0,0,1,2]},{id:"32x32KeygenBass",name:"Keygen Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,23,25,27,29,30,31,31,31,31,31,31,31,31,31]},{id:"32x32accordion",name:"Accordion",category:"32x32",len:32,max:31,data:[0,8,1,13,20,23,20,17,23,17,9,9,18,17,16,26,31,26,27,24,20,14,5,12,10,18,11,15,21,12,5,11]},{id:"32x32accordion2",name:"Accordion 2",category:"32x32",len:32,max:31,data:[16,17,21,22,22,22,20,19,13,12,11,10,10,13,15,17,27,27,31,31,31,29,25,23,9,7,3,1,0,2,4,6]},{id:"32x32acousticguitar",name:"Acoustic Guitar",category:"32x32",len:32,max:31,data:[2,18,26,28,29,28,28,28,29,31,31,27,14,2,1,0,1,2,2,0,1,1,1,1,1,1,1,0,0,0,0,0]},{id:"32x32agogo",name:"Agogo",category:"32x32",len:32,max:31,data:[16,8,6,31,13,16,16,14,25,21,8,12,28,18,18,12,16,16,23,0,13,16,20,16,6,12,18,17,8,15,15,26]},{id:"32x32ataribass",name:"Atari Bass",category:"32x32",len:32,max:31,data:[31,31,31,31,31,31,31,31,0,0,0,0,0,0,0,0,31,31,31,0,0,0,31,31,31,31,31,0,0,0,0,0]},{id:"32x32bass2",name:"Bass 2",category:"32x32",len:32,max:31,data:[15,25,31,31,26,18,12,7,4,3,3,3,4,6,8,12,15,19,23,26,28,29,29,29,28,26,22,16,8,2,0,5]},{id:"32x32bass3",name:"Bass 3",category:"32x32",len:32,max:31,data:[15,15,12,7,2,0,2,7,15,24,29,31,29,24,19,16,15,16,17,18,17,17,16,15,15,15,15,14,14,13,14,15]},{id:"32x32bell",name:"Bell",category:"32x32",len:32,max:31,data:[16,31,30,16,26,25,13,28,31,15,0,0,8,4,10,26,13,4,20,30,29,30,30,19,1,9,23,9,5,11,0,0]},{id:"32x32brass",name:"Brass",category:"32x32",len:32,max:31,data:[31,31,29,27,25,23,21,19,16,14,12,10,8,6,4,2,28,26,23,21,19,17,14,12,22,20,17,15,13,11,9,6]},{id:"32x32brass2",name:"Brass 2",category:"32x32",len:32,max:31,data:[16,18,21,24,27,29,30,31,31,31,30,29,27,24,21,18,0,2,4,6,8,10,12,14,16,17,19,21,23,25,27,29]},{id:"32x32chime",name:"Chime",category:"32x32",len:32,max:31,data:[15,27,23,17,23,27,21,15,23,30,26,17,21,23,15,6,15,24,15,7,9,13,4,0,7,15,9,3,7,13,7,3]},{id:"32x32choir",name:"Choir",category:"32x32",len:32,max:31,data:[0,3,8,13,22,26,30,31,31,30,28,24,20,18,17,16,15,15,15,15,16,16,16,16,15,14,12,10,8,5,2,0]},{id:"32x32clarinet",name:"Clarinet",category:"32x32",len:32,max:31,data:[20,31,29,26,26,28,30,31,31,30,28,26,25,27,30,31,15,0,4,6,6,4,2,0,0,1,3,5,6,6,2,2]},{id:"32x32clarinet2",name:"Clarinet 2",category:"32x32",len:32,max:31,data:[21,27,30,28,24,22,24,26,24,22,19,18,19,26,23,19,12,6,0,1,4,8,7,5,7,10,13,11,9,7,5,10]},{id:"32x32distortedpulse",name:"Distorted Pulse",category:"32x32",len:32,max:31,data:[31,31,31,31,0,0,0,0,16,16,16,16,0,0,0,0,8,8,8,8,0,0,0,0,3,3,3,3,0,0,0,0]},{id:"32x32distortedpulse2",name:"Distorted Pulse 2",category:"32x32",len:32,max:31,data:[3,25,13,15,18,16,17,15,15,15,17,15,12,11,6,15,27,0,13,15,18,3,8,15,15,20,17,15,12,31,29,15]},{id:"32x32distortedsaw",name:"Distorted Saw",category:"32x32",len:32,max:31,data:[0,7,10,10,14,14,17,17,21,21,25,25,27,27,29,29,29,29,31,31,31,31,31,5,8,11,14,16,18,20,22,0]},{id:"32x32ebass",name:"E-Bass",category:"32x32",len:32,max:31,data:[17,21,31,28,23,27,30,13,0,8,11,10,7,8,14,21,27,27,26,25,31,19,0,2,0,0,0,8,15,18,18,16]},{id:"32x32eguitar",name:"E-Guitar",category:"32x32",len:32,max:31,data:[3,9,16,23,28,31,31,29,26,23,25,27,28,29,28,22,8,0,12,28,0,14,2,0,1,31,30,4,3,1,0,0]},{id:"32x32eguitar2",name:"E-Guitar 2",category:"32x32",len:32,max:31,data:[16,27,31,28,31,25,16,0,3,0,11,7,5,16,18,17,23,23,30,31,29,30,0,12,3,4,4,8,11,10,20,21]},{id:"32x32englishhorn",name:"English Horn",category:"32x32",len:32,max:31,data:[16,22,31,22,15,9,15,9,15,13,11,8,6,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,6,8,11]},{id:"32x32fantasia",name:"Fantasia",category:"32x32",len:32,max:31,data:[0,6,14,15,14,8,5,7,15,15,21,26,27,26,21,15,17,23,29,31,31,28,22,12,11,15,19,20,19,17,6,1]},{id:"32x32filteredsaw",name:"Filtered Saw",category:"32x32",len:32,max:31,data:[16,18,20,21,23,25,26,28,29,30,31,31,31,31,30,26,19,9,3,1,0,0,1,2,3,4,6,7,9,11,12,14]},{id:"32x32filteredsquare",name:"Filtered Square",category:"32x32",len:32,max:31,data:[20,24,27,28,29,30,31,31,31,31,30,29,28,27,24,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32flute",name:"Flute",category:"32x32",len:32,max:31,data:[16,19,23,27,30,31,31,31,29,25,21,17,12,8,6,4,3,3,3,3,3,3,3,3,4,5,6,7,8,9,11,13]},{id:"32x32frenchhorn",name:"French Horn",category:"32x32",len:32,max:31,data:[16,22,27,29,30,31,31,26,22,16,14,9,4,5,8,15,19,20,18,16,14,10,8,8,8,8,9,13,14,13,13,13]},{id:"32x32frenchhorn2",name:"French Horn 2",category:"32x32",len:32,max:31,data:[29,31,29,27,24,22,18,11,2,0,2,4,8,13,16,17,18,17,16,13,8,4,2,0,2,11,18,22,24,27,29,31]},{id:"32x32glockenspiel",name:"Glockenspiel",category:"32x32",len:33,max:31,data:[16,29,24,17,24,29,20,16,24,31,26,16,20,22,15,5,16,26,15,11,15,15,5,0,7,15,11,2,7,15,7,2,16]},{id:"32x32hardslap",name:"Hard Slap",category:"32x32",len:32,max:31,data:[18,30,21,16,15,17,22,31,2,11,29,0,20,10,15,31,6,21,30,0,7,11,12,8,1,11,30,16,1,31,18,4]},{id:"32x32jazzguitar",name:"Jazz Guitar",category:"32x32",len:32,max:31,data:[0,2,3,2,1,0,0,2,11,19,24,29,30,30,29,28,27,28,30,31,30,25,17,13,13,15,16,17,16,13,7,0]},{id:"32x32lead",name:"Lead",category:"32x32",len:32,max:31,data:[31,23,18,14,11,9,7,5,4,3,2,1,1,0,0,0,0,0,0,1,1,2,3,4,5,7,9,11,14,18,23,31]},{id:"32x32lead2",name:"Lead 2",category:"32x32",len:32,max:31,data:[11,20,26,30,31,31,30,22,12,0,1,1,1,17,16,16,16,16,30,31,30,0,5,8,18,20,21,22,20,19,15,11]},{id:"32x32mutetrumpet",name:"Mute Trumpet",category:"32x32",len:32,max:31,data:[31,29,20,15,12,11,12,12,13,13,13,14,14,15,16,15,15,15,14,14,15,15,16,16,16,16,16,16,17,17,17,24]},{id:"32x32oboe",name:"Oboe",category:"32x32",len:32,max:31,data:[21,31,14,0,1,8,14,18,20,22,22,22,21,20,18,17,15,13,12,11,10,9,9,10,12,15,20,27,31,30,13,1]},{id:"32x32octavelead",name:"Octave Lead",category:"32x32",len:32,max:31,data:[6,11,15,19,23,27,29,31,13,14,15,16,17,18,18,0,3,6,9,12,14,16,17,18,0,0,0,0,0,0,0,0]},{id:"32x32octavesaw",name:"Octave Saw",category:"32x32",len:32,max:31,data:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]},{id:"32x32organ",name:"Organ",category:"32x32",len:32,max:31,data:[23,31,31,28,27,26,19,15,19,23,17,10,9,11,8,10,20,29,28,22,19,17,9,5,8,13,8,3,2,6,5,9]},{id:"32x32organ2",name:"Organ 2",category:"32x32",len:32,max:31,data:[16,19,26,30,31,27,23,14,10,6,8,9,9,8,13,14,18,17,20,22,26,24,24,19,18,13,12,9,5,2,5,8]},{id:"32x32organ3",name:"Organ 3",category:"32x32",len:32,max:31,data:[16,31,31,24,22,24,20,15,16,18,17,17,22,22,11,6,16,25,21,11,10,15,16,14,16,17,12,8,10,9,0,0]},{id:"32x32piano",name:"Piano",category:"32x32",len:32,max:31,data:[18,30,31,29,31,30,30,31,31,31,31,26,10,2,2,6,14,14,10,8,5,3,1,9,17,15,8,2,4,7,10,13]},{id:"32x32piano2",name:"Piano 2",category:"32x32",len:32,max:31,data:[14,27,31,31,31,31,28,22,21,24,31,29,16,7,5,8,15,22,26,26,21,8,0,4,10,11,6,2,0,1,0,2]},{id:"32x32reedorgan",name:"Reed Organ",category:"32x32",len:32,max:31,data:[16,22,31,22,15,8,0,8,16,22,31,22,15,8,16,22,15,13,16,18,16,16,16,16,16,16,31,31,31,31,31,31]},{id:"32x32sam",name:"SAM",category:"32x32",len:32,max:31,data:[5,10,15,10,10,15,15,26,31,31,31,26,21,15,10,10,10,10,15,21,26,26,26,26,21,26,21,21,10,5,0,0]},{id:"32x32saw2",name:"Saw 2",category:"32x32",len:32,max:31,data:[15,31,30,25,23,20,19,17,17,16,15,15,15,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13]},{id:"32x32sax",name:"Sax",category:"32x32",len:32,max:31,data:[0,16,22,27,29,31,29,27,22,16,9,5,2,0,2,5,9,16,24,29,31,29,24,16,7,2,0,2,7,16,31,16]},{id:"32x32strings",name:"Strings",category:"32x32",len:32,max:31,data:[5,31,10,0,0,18,31,26,23,19,25,28,31,14,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"32x32strings2",name:"Strings 2",category:"32x32",len:32,max:31,data:[21,26,26,21,16,16,16,24,29,31,29,21,15,12,12,16,19,19,15,7,2,0,2,7,16,16,10,5,5,10,16,16]},{id:"32x32synthbass",name:"Synth Bass",category:"32x32",len:32,max:31,data:[0,0,0,0,0,15,15,0,0,15,15,31,31,31,31,31,31,0,7,7,7,7,7,7,0,23,23,23,23,23,23,0]},{id:"32x32synthbell",name:"Synth Bell",category:"32x32",len:32,max:31,data:[16,31,26,31,19,12,16,19,11,0,6,0,29,18,4,28,19,0,7,0,15,19,16,12,23,31,27,31,4,14,28,5]},{id:"32x32synthlead",name:"Synth Lead",category:"32x32",len:32,max:31,data:[0,0,0,0,3,26,1,0,1,28,0,29,0,18,5,4,0,0,3,0,31,0,20,31,5,2,0,20,27,31,0,16]},{id:"32x32synthlead2",name:"Synth Lead 2",category:"32x32",len:32,max:31,data:[16,16,15,0,16,31,31,31,16,16,15,0,15,15,15,0,0,0,0,15,0,0,15,15,15,15,0,0,0,15,0,0]},{id:"32x32synthpiano",name:"Synth Piano",category:"32x32",len:32,max:31,data:[14,7,8,8,7,3,2,5,3,4,13,25,31,31,31,30,25,14,14,18,22,17,9,9,8,9,15,25,30,29,23,5]},{id:"32x32synthstrings",name:"Synth Strings",category:"32x32",len:32,max:31,data:[17,26,31,31,27,22,17,14,13,16,21,28,31,25,8,1,16,31,24,7,0,5,11,17,19,18,15,10,4,1,1,7]},{id:"32x32trumpet",name:"Trumpet",category:"32x32",len:32,max:31,data:[15,31,26,24,21,20,19,19,18,17,17,17,17,16,17,16,16,16,16,16,16,16,15,14,14,12,11,10,7,4,1,0]},{id:"32x32tuba",name:"Tuba",category:"32x32",len:32,max:31,data:[19,28,31,30,26,22,19,17,16,15,14,14,15,15,15,16,17,17,18,18,18,18,18,17,16,14,11,8,4,1,0,7]},{id:"32x32vibraphone",name:"Vibraphone",category:"32x32",len:32,max:31,data:[10,28,25,18,17,30,31,31,29,31,25,26,30,31,22,9,15,22,19,2,1,5,9,2,3,1,0,0,8,15,8,3]},{id:"32x32voice",name:"Voice",category:"32x32",len:32,max:31,data:[16,25,28,31,28,25,12,8,8,13,19,29,31,29,24,19,9,8,3,2,1,1,0,1,0,0,2,1,5,5,8,14]},{id:"32x32voice2",name:"Voice 2",category:"32x32",len:32,max:31,data:[0,6,8,17,19,21,21,19,16,12,10,12,20,26,29,30,29,21,13,0,1,1,2,2,16,31,30,30,28,16,8,2]},{id:"128x256bass",name:"Bass",category:"128x256",len:128,max:255,data:[0,1,5,17,41,76,120,164,201,227,242,249,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,254,253,252,251,250,248,244,240,236,232,228,224,222,220,218,217,216,215,214,213,212,210,207,204,199,194,189,184,178,172,166,160,154,148,144,140,136,133,131,129,127,125,123,122,121,120,119,118,117,114,111,107,102,97,90,83,76,70,64,58,52,46,42,39,37,35,34,33,32,31,30,29,28,25,22,17,13,9,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{id:"128x256chime",name:"Chime",category:"128x256",len:128,max:255,data:[128,154,184,203,201,192,190,187,181,176,172,167,164,161,160,161,165,174,188,210,235,252,255,254,253,253,252,250,249,248,246,245,244,244,246,248,252,255,251,233,210,212,223,224,225,230,233,235,237,239,240,240,239,236,230,217,192,151,110,101,118,122,123,130,136,140,144,148,151,151,150,145,136,118,91,55,23,13,20,25,24,28,33,35,38,41,44,44,44,41,35,26,13,2,2,12,9,5,5,4,2,1,1,0,0,0,0,0,1,3,9,25,57,92,95,80,77,76,69,64,61,57,54,52,52,53,58,67]},{id:"128x256lead",name:"Lead",category:"128x256",len:128,max:255,data:[96,159,151,135,187,216,196,170,210,251,206,157,149,151,191,242,206,206,248,206,168,164,166,208,247,200,156,186,218,207,179,212,255,241,241,255,255,255,255,255,248,241,248,255,255,255,232,195,217,212,179,221,250,242,223,163,105,134,164,126,94,110,150,123,102,153,132,104,144,161,128,90,120,149,91,31,13,4,34,76,42,37,60,22,0,0,0,7,13,6,0,0,0,0,0,14,14,0,43,75,48,37,68,98,54,8,47,88,91,87,49,6,49,49,13,64,103,105,98,49,4,44,84,58,38,67,119,104]}];function uo(e,t){if(e.max===t)return e.data;const a=t/e.max;return e.data.map(e=>Math.round(Math.max(0,Math.min(t,e*a))))}function po(e,t){const a=(n=e,co.find(e=>e.id===n));var n;if(!a)return null;switch(t){case"gb":case"n163":case"swan":return uo(a,15);case"pce":case"vb":return 31===a.max?a.data:uo(a,31);case"scc":return uo(a,255).map(e=>e-128);case"lynx":return uo(a,255);default:return a.data}}class mo{static mapOPN2(e,t,a){const n=io.OPN2,s=t%3,r=0===(t<3?0:1)?0:256;if(e.write(n,34,8),a.fms||a.ams){const t=a.fms??0;e.write(n,34,8|7&t)}const i=(7&a.feedback)<<3|7&a.algorithm;e.write(n,r|176+s,i);const o=192|(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,r|180+s,o);const l=[0,8,4,12];a.operators.forEach((t,a)=>{const i=l[a]+s,o=this.furnaceDtToOPN2(t.dt);e.write(n,r|48+i,(7&o)<<4|15&t.mult),e.write(n,r|64+i,127&t.tl),e.write(n,r|80+i,(3&(t.rs??0))<<6|31&t.ar),e.write(n,r|96+i,(t.am?128:0)|31&t.dr),e.write(n,r|112+i,31&t.d2r),e.write(n,r|128+i,(15&t.sl)<<4|15&t.rr),e.write(n,r|144+i,15&(t.ssg??0))})}static mapOPM(e,t,a){const n=io.OPM,s=7&t;if(e.write(n,1,2),e.write(n,24,0),e.write(n,25,127),e.write(n,25,255),a.fms||a.ams){const t=a.fms??0;e.write(n,24,16*t&255);const s=a.fms??127,r=a.ams??127;e.write(n,25,128|127&s),e.write(n,25,127&r)}const r=192|(7&a.feedback)<<3|7&a.algorithm;e.write(n,32+s,r);const i=a.fms??0,o=a.ams??0;e.write(n,56+s,(7&i)<<4|3&o);const l=[0,8,16,24];a.operators.forEach((t,a)=>{const r=l[a]+s,i=this.furnaceDtToOPN2(t.dt??0);e.write(n,64+r,(7&i)<<4|15&(t.mult??1)),e.write(n,96+r,127&(t.tl??0)),e.write(n,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(n,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(n,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(n,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapOPL3(e,t,a,n){const s=n??io.OPL3;e.write(s,261,1),e.write(s,1,32);const r=t<9?0:256,i=t%9,o=48|(7&a.feedback)<<1|1&a.algorithm;e.write(s,r|192+i,o);const l=this.getOPL3Slots(i);a.operators.slice(0,2).forEach((t,a)=>{const n=r|l[a],i=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(s,32+n,i),e.write(s,64+n,(3&(t.ksl??0))<<6|63&t.tl),e.write(s,96+n,t.ar>>1<<4|t.dr>>1),e.write(s,128+n,(15&t.sl)<<4|15&t.rr),e.write(s,224+n,7&(t.ws??0))})}static mapPSG(e,t,a){const n=io.PSG;e.write(n,0,231),e.write(n,1,255);const s=159|(3&t)<<5;e.write(n,0,s)}static mapGB(e,t,a){const n=io.GB;e.write(n,16,0),e.write(n,38,128),e.write(n,37,0),e.write(n,36,0)}static mapC64(e,t,a){const n=a.c64,s=a.chipType===io.SID_6581||a.chipType===io.SID_8580,r=s?a.chipType:io.SID;if(s){const a=7*t,s=n?.a??0,i=n?.d??8;e.write(r,a+5,(15&s)<<4|15&i);const o=n?.s??15,l=n?.r??4;e.write(r,a+6,(15&o)<<4|15&l);const c=n?.duty??2048;e.write(r,a+2,255&c),e.write(r,a+3,c>>8&15),n&&(n.noiseOn,n.pulseOn,n.sawOn,n.triOn,n.ringMod,n.oscSync),e.write(r,a+4,0),e.write(r,24,15);const u=n?.filterResonance??n?.filterRes??0;let d=0;n?.filterOn&&!0!==n?.filterCh3Off&&(d|=1<<t),e.write(r,23,(15&u)<<4|d)}else{const a=0,s=1,i=2,o=3,l=5,c=6,u=7,d=8,p=13,m=50,h=51,f=t*64,y=17*(n?.a??0),g=17*(n?.d??8),b=17*(n?.s??15),v=17*(n?.r??4);e.write(r,f+s,255&y),e.write(r,f+i,255&g),e.write(r,f+o,255&b),e.write(r,f+l,255&v);let x=0;n?(n.triOn&&(x|=1),n.sawOn&&(x|=2),n.pulseOn&&(x|=4),n.noiseOn&&(x|=8)):x=4,e.write(r,f+c,x);const w=n?.duty??2048;e.write(r,f+u,w>>8&255),e.write(r,f+d,255&w),e.write(r,f+p,255),e.write(r,f+m,255),e.write(r,f+h,255),e.write(r,f+a,0)}}static mapNES(e,t,a){const n=io.NES;if(e.write(n,16405,31),e.write(n,16385,8),e.write(n,16389,8),e.write(n,16384,48),e.write(n,16386,0),e.write(n,16387,8),e.write(n,16388,48),e.write(n,16390,0),e.write(n,16391,8),e.write(n,16392,0),e.write(n,16394,0),e.write(n,16395,8),e.write(n,16396,48),e.write(n,16398,8),e.write(n,16399,8),t<2){const s=4*t,r=3&Math.floor((a.operators[0]?.mult??2)/4);e.write(n,16384+s,48|r<<6)}else 2===t?e.write(n,16392,255):3===t&&e.write(n,16396,48)}static mapAY(e,t,a){const n=io.AY;e.write(n,7,56)}static mapPCE(e,t,a){const n=io.PCE;e.write(n,0,0),e.write(n,1,0)}static mapSNES(e,t,a){const n=io.SNES;e.write(n,93,2),e.write(n,12,0),e.write(n,28,0),e.write(n,108,0),e.write(n,76,0),e.write(n,92,0);for(let s=0;s<8;s++)e.write(n,16*s+4,s)}static mapOPLL(e,t,a){const n=io.OPLL,s=a.opllPreset??3;if(0===s&&a.operators.length>=2){const t=a.operators[0],s=a.operators[1],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&t.mult;e.write(n,0,r);const i=(s.am?128:0)|(s.vib?64:0)|(s.sus?32:0)|(s.ksr?16:0)|15&s.mult;e.write(n,1,i);const o=Math.min(63,t.tl>>1);e.write(n,2,(3&(t.ksl??0))<<6|63&o);const l=1&(s.ws??0),c=1&(t.ws??0);e.write(n,3,l<<4|c<<3|7&a.feedback),e.write(n,4,(15&t.ar)<<4|15&t.dr),e.write(n,5,(15&s.ar)<<4|15&s.dr),e.write(n,6,(15&t.sl)<<4|15&t.rr),e.write(n,7,(15&s.sl)<<4|15&s.rr)}e.write(n,48+t,(15&s)<<4),e.write(n,14,0)}static mapOPNA(e,t,a){const n=io.OPNA,s=t%3,r=0===(t<3?0:1)?0:256;e.write(n,34,8),e.write(n,41,159),e.write(n,257,63);const i=(7&a.feedback)<<3|7&a.algorithm;e.write(n,r|176+s,i);const o=192|(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,r|180+s,o);const l=[0,8,4,12];a.operators.forEach((t,a)=>{const i=l[a]+s,o=this.furnaceDtToOPN2(t.dt);e.write(n,r|48+i,(7&o)<<4|15&t.mult),e.write(n,r|64+i,127&t.tl),e.write(n,r|80+i,(3&(t.rs??0))<<6|31&t.ar),e.write(n,r|96+i,(t.am?128:0)|31&t.dr),e.write(n,r|112+i,31&t.d2r),e.write(n,r|128+i,(15&t.sl)<<4|15&t.rr),e.write(n,r|144+i,15&(t.ssg??0))})}static mapOPN(e,t,a){const n=io.OPN,s=t%3;e.write(n,34,8);const r=(7&a.feedback)<<3|7&a.algorithm;e.write(n,176+s,r);const i=(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,180+s,i);const o=[0,8,4,12];a.operators.forEach((t,a)=>{const r=o[a]+s,i=this.furnaceDtToOPN2(t.dt);e.write(n,48+r,(7&i)<<4|15&t.mult),e.write(n,64+r,127&t.tl),e.write(n,80+r,(3&(t.rs??0))<<6|31&t.ar),e.write(n,96+r,(t.am?128:0)|31&t.dr),e.write(n,112+r,31&t.d2r),e.write(n,128+r,(15&t.sl)<<4|15&t.rr),e.write(n,144+r,15&(t.ssg??0))})}static mapOPNB(e,t,a){const n=io.OPNB,s=t%3,r=0===(t<3?0:1)?0:256;e.write(n,34,0);const i=(7&a.feedback)<<3|7&a.algorithm;e.write(n,r|176+s,i);const o=192|(3&(a.ams??0))<<4|7&(a.fms??0);e.write(n,r|180+s,o);const l=[0,8,4,12];a.operators.forEach((t,a)=>{const i=l[a]+s,o=this.furnaceDtToOPN2(t.dt);e.write(n,r|48+i,(7&o)<<4|15&t.mult),e.write(n,r|64+i,127&t.tl),e.write(n,r|80+i,(3&(t.rs??0))<<6|31&t.ar),e.write(n,r|96+i,(t.am?128:0)|31&t.dr),e.write(n,r|112+i,31&t.d2r),e.write(n,r|128+i,(15&t.sl)<<4|15&t.rr),e.write(n,r|144+i,15&(t.ssg??0))})}static mapVRC6(e,t,a){const n=io.VRC6;e.write(n,36867,0)}static mapN163(e,t,a){const n=io.N163;e.write(n,127,0)}static mapSCC(e,t,a){const n=io.SCC;for(let s=0;s<5;s++)e.write(n,138+s,0);e.write(n,143,0)}static mapFDS(e,t,a){const n=io.FDS;e.write(n,16419,0),e.write(n,16419,131),e.write(n,16521,0)}static mapMMC5(e,t,a){const n=io.MMC5;e.write(n,20501,3),e.write(n,20496,0)}static mapTIA(e,t,a){const n=io.TIA;e.write(n,21,0),e.write(n,22,0),e.write(n,23,0),e.write(n,24,0),e.write(n,25,0),e.write(n,26,0)}static mapSAA(e,t,a){const n=io.SAA;e.write(n,28,2),e.write(n,28,1)}static mapSWAN(e,t,a){const n=io.SWAN;for(let s=0;s<4;s++)e.write(n,8+s,0);e.write(n,15,0),e.write(n,16,0),e.write(n,17,0)}static mapOKI(e,t,a){const n=io.OKI;e.write(n,12,0)}static mapES5506(e,t,a){}static mapOPZ(e,t,a){const n=io.OPZ,s=7&t;e.write(n,1,2),e.write(n,24,0),e.write(n,25,127),e.write(n,25,255);const r=192|(7&a.feedback)<<3|7&a.algorithm;e.write(n,32+s,r);const i=a.fms??0,o=a.ams??0;e.write(n,56+s,(7&i)<<4|3&o);const l=[0,8,16,24];a.operators.forEach((t,a)=>{const r=l[a]+s,i=this.furnaceDtToOPN2(t.dt??0);e.write(n,64+r,(7&i)<<4|15&(t.mult??1)),e.write(n,96+r,127&(t.tl??0)),e.write(n,128+r,(3&(t.rs??0))<<6|31&(t.ar??31)),e.write(n,160+r,(t.am?128:0)|31&(t.dr??0)),e.write(n,192+r,(3&(t.dt2??0))<<6|31&(t.d2r??0)),e.write(n,224+r,(15&(t.sl??0))<<4|15&(t.rr??0))})}static mapY8950(e,t,a){const n=io.Y8950;e.write(n,1,32),e.write(n,4,0),e.write(n,8,0);const s=t%9,r=(7&a.feedback)<<1|1&a.algorithm;e.write(n,192+s,r);const i=this.getOPL3Slots(s);a.operators.slice(0,2).forEach((t,a)=>{const s=i[a],r=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(n,32+s,r),e.write(n,64+s,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(n,96+s,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(n,128+s,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(n,224+s,3&(t.ws??0))})}static mapOPL4(e,t,a){const n=io.OPL4;e.write(n,261,3),e.write(n,514,16),e.write(n,1,32);const s=t<9?0:256,r=t%9,i=48|(7&a.feedback)<<1|1&a.algorithm;e.write(n,s|192+r,i);const o=this.getOPL3Slots(r);a.operators.slice(0,2).forEach((t,a)=>{const r=s|o[a],i=(t.am?128:0)|(t.vib?64:0)|(t.sus?32:0)|(t.ksr?16:0)|15&(t.mult??1);e.write(n,32+r,i),e.write(n,64+r,(3&(t.ksl??0))<<6|63&(t.tl??0)),e.write(n,96+r,(t.ar??15)>>1<<4|(t.dr??0)>>1),e.write(n,128+r,(15&(t.sl??0))<<4|15&(t.rr??0)),e.write(n,224+r,7&(t.ws??0))})}static mapSEGAPCM(e,t,a){const n=io.SEGAPCM;for(let s=0;s<16;s++){const t=s<<3;e.write(n,134+t,0),e.write(n,2+t,0),e.write(n,3+t,0)}}static mapYMZ280B(e,t,a){const n=io.YMZ280B;e.write(n,255,128);for(let s=0;s<8;s++)e.write(n,2+4*s,255),e.write(n,3+4*s,8)}static mapRF5C68(e,t,a){const n=io.RF5C68;e.write(n,8,255);for(let s=0;s<8;s++)e.write(n,0+s,0),e.write(n,1+s,0);e.write(n,8,0)}static mapGA20(e,t,a){const n=io.GA20;for(let s=0;s<4;s++)e.write(n,5+8*s,0),e.write(n,6+8*s,0)}static mapC140(e,t,a){const n=io.C140;for(let s=0;s<24;s++)e.write(n,5+(s<<4),0)}static mapQSOUND(e,t,a){const n=io.QSOUND;e.write(n,0,0)}static mapVIC(e,t,a){const n=io.VIC;e.write(n,14,0)}static mapTED(e,t,a){const n=io.TED;e.write(n,17,15)}static mapSUPERVISION(e,t,a){}static mapVERA(e,t,a){const n=io.VERA;for(let s=0;s<16;s++)e.write(n,129472+4*s+2,3)}static mapSM8521(e,t,a){const n=io.SM8521;e.write(n,64,128)}static mapBUBBLE(e,t,a){}static mapK007232(e,t,a){const n=io.K007232;e.write(n,12,255),e.write(n,13,0)}static mapK053260(e,t,a){const n=io.K053260;e.write(n,40,0),e.write(n,47,2)}static mapX1_010(e,t,a){const n=io.X1_010;for(let s=0;s<16;s++)e.write(n,8*s,0)}static mapUPD1771(e,t,a){}static mapT6W28(e,t,a){const n=io.T6W28;e.write(n,1,231)}static mapVB(e,t,a){const n=io.VB;for(let s=0;s<6;s++){const t=1024+64*s;e.write(n,t+4,255),e.write(n,t+16,240)}}static mapLYNX(e,t,a){const n=io.LYNX;e.write(n,80,0)}static mapNAMCO(e,t,a){}static mapPET(e,t,a){}static mapPOKEY(e,t,a){}static mapAMIGA(e,t,a){}static mapPCSPKR(e,t,a){}static getOPL3Slots(e){return[[0,1,2,8,9,10,16,17,18][e],[3,4,5,11,12,13,19,20,21][e]]}static furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}static uploadWavetable(e,t,a){switch(t){case io.GB:for(let t=0;t<16;t++){const n=15&(a[2*t]||0),s=15&(a[2*t+1]||0);e.write(io.GB,48+t,n<<4|s)}break;case io.SCC:for(let t=0;t<32;t++)e.write(io.SCC,t,255&a[t]);break;case io.N163:e.write(io.N163,57344,128);for(let t=0;t<Math.min(128,a.length);t++)e.write(io.N163,63488,255&a[t]);break;case io.PCE:for(let t=0;t<32;t++)e.write(io.PCE,6,31&a[t]);break;case io.SWAN:for(let t=0;t<16;t++){const n=15&(a[2*t]||0),s=15&(a[2*t+1]||0);e.write(io.SWAN,64+t,n<<4|s)}break;case io.BUBBLE:{const t=new Uint8Array(a.slice(0,32));e.setWavetable(io.BUBBLE,0,t),e.setWavetable(io.BUBBLE,1,t);break}case io.X1_010:{const t=a.some(e=>e<0);for(let n=0;n<16;n++){const s=4096|n<<7;for(let n=0;n<128;n++){const r=n*a.length/128,i=Math.floor(r),o=r-i,l=a[i]||0,c=l+((a[(i+1)%a.length]||0)-l)*o;let u;u=t?255&Math.round(4*c):17*c-128&255,e.write(io.X1_010,s+n,u)}}break}}}static loadWavetablePreset(e,t,a){let n;switch(t){case io.GB:n="gb";break;case io.PCE:n="pce";break;case io.N163:n="n163";break;case io.SCC:n="scc";break;case io.SWAN:n="swan";break;case io.VB:n="vb";break;case io.LYNX:n="lynx";break;default:return!1}const s=po(a,n);return!!s&&(this.uploadWavetable(e,t,s),!0)}static getRecommendedWavetables(e){switch(e){case io.GB:case io.N163:case io.SWAN:return["32x16saw","32x16FunkyLead","32x16NamcoBass","32x16brass","32x16clarinet","32x16flute","32x16guitar","32x16opllpiano","32x16synthbass","32x16trumpet","32x16voice"];case io.PCE:case io.VB:return["32x32piano","32x32brass","32x32flute","32x32lead","32x32organ","32x32strings","32x32synthbass","32x32trumpet","32x32voice","32x32bell","32x32choir","32x32vibraphone"];case io.SCC:return["32x32piano","32x32brass","32x32lead","32x32organ","32x32synthbass","32x32trumpet","32x32strings","32x32flute"];case io.LYNX:return["128x256bass","128x256chime","128x256lead","32x32piano","32x32brass","32x32lead","32x32synthbass"];default:return[]}}}class ho{static CLOCK_OPN2=7670454;static CLOCK_OPN2_PAL=7600489;static CLOCK_OPN=4e6;static CLOCK_OPM=3579545;static FREQ_BASE_OPN2=9440540;static FREQ_BASE_OPN=4720270;static FREQ_BASE_OPM=3579545;static freqToOPN2(e){if(e<=0)return{block:0,fnum:0};const t=this.CLOCK_OPN2;let a=7,n=0;for(a=7;a>=0;a--){const s=Math.pow(2,a);if(n=Math.round(144*e*2097152/(t*s)),n<=2047&&n>=600)break;if(!(n<=2047&&n<600&&a>0)&&(0===a&&n<=2047))break}return n>2047&&(a=7,n=2047),a=Math.max(0,Math.min(7,a)),n=Math.max(0,Math.min(2047,n)),{block:a,fnum:n}}static freqToOPM(e){if(e<=0)return{kc:0,kf:0};const t=12*Math.log2(e/440)+69,a=Math.floor(t),n=t-a,s=Math.floor(a/12)-1,r=a%12;return{kc:Math.max(0,Math.min(7,s))<<4|[0,1,2,4,5,6,8,9,10,12,13,14][r],kf:63&Math.floor(64*n)}}static freqToGB(e){if(e<=0)return 0;const t=2048-131072/e;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNES(e){if(e<=0)return 0;const t=1789773/(16*e)-1;return Math.max(0,Math.min(2047,Math.floor(t)))}static freqToNESNoise(e){const t=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068];if(e<=0)return 15;const a=1789773/e;let n=0,s=Math.abs(t[0]-a);for(let r=1;r<16;r++){const e=Math.abs(t[r]-a);e<s&&(s=e,n=r)}return n}static freqToAY(e,t=1789773){if(e<=0)return 0;const a=Math.floor(t/(16*e));return Math.max(0,Math.min(4095,a))}static freqToPCE(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(4095,t))}static freqToSCC(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToSID(e,t=!0){if(e<=0)return 0;const a=t?985248:1022727,n=Math.floor(16777216*e/a);return Math.max(0,Math.min(65535,n))}static freqToPSG(e){if(e<=0)return 0;const t=Math.floor(3579545/(32*e));return Math.max(0,Math.min(1023,t))}static freqToSNES(e){if(e<=0)return 0;const t=Math.floor(4096*e/32e3);return Math.max(0,Math.min(16383,t))}static freqToFDS(e){if(e<=0)return 0;const t=Math.floor(65536*e/1789773);return Math.max(0,Math.min(4095,t))}static freqToVRC6(e){if(e<=0)return 0;const t=Math.floor(3579545/(16*e))-1;return Math.max(0,Math.min(4095,t))}static freqToPOKEY(e){if(e<=0)return 0;const t=Math.floor(1789773/(2*e))-1;return Math.max(0,Math.min(255,t))}static freqToTIA(e){if(e<=0)return 0;const t=Math.floor(31440/(32*e))-1;return Math.max(0,Math.min(31,t))}static freqToVIC(e){if(e<=0)return 0;const t=Math.floor(256-1022727/(32*e));return Math.max(0,Math.min(127,t))}static freqToTED(e){if(e<=0)return 0;const t=Math.floor(1024-1773447/(8*e));return Math.max(0,Math.min(1023,t))}static freqToAmiga(e,t=!0){if(e<=0)return 65535;const a=t?3546895:3579545,n=Math.floor(a/(2*e));return Math.max(124,Math.min(65535,n))}}let fo=0;const yo=n((e,t)=>({errors:[],activeError:null,reportError:t=>{const a="synth-error-"+ ++fo,n={timestamp:(new Date).toISOString(),userAgent:"undefined"!=typeof navigator?navigator.userAgent:"unknown",audioContextState:"undefined"!=typeof AudioContext?(new AudioContext).state:"AudioContext not available",wasmSupported:"undefined"!=typeof WebAssembly,...t.debugData},s={id:a,synthType:t.synthType,synthName:t.synthName,errorType:t.errorType,message:t.message,stack:t.stack,debugData:n,dismissed:!1};return e(e=>({errors:[...e.errors,s],activeError:s})),a},dismissError:t=>{e(e=>({errors:e.errors.map(e=>e.id===t?{...e,dismissed:!0}:e),activeError:e.activeError?.id===t?null:e.activeError}))},dismissAll:()=>{e(e=>({errors:e.errors.map(e=>({...e,dismissed:!0})),activeError:null}))},clearDismissed:()=>{e(e=>({errors:e.errors.filter(e=>!e.dismissed)}))},getDebugString:e=>{const t=["=== DEViLBOX Synth Error Report ===","",`Synth Type: ${e.synthType}`,e.synthName?`Synth Name: ${e.synthName}`:null,`Error Type: ${e.errorType}`,`Message: ${e.message}`,"","--- Debug Data ---",`Timestamp: ${e.debugData.timestamp}`,`User Agent: ${e.debugData.userAgent}`,`AudioContext State: ${e.debugData.audioContextState}`,`WASM Supported: ${e.debugData.wasmSupported}`,""].filter(Boolean),a=Object.keys(e.debugData).filter(e=>!["timestamp","userAgent","audioContextState","wasmSupported","synthConfig"].includes(e));if(a.length>0){t.push("--- Additional Info ---");for(const n of a)t.push(`${n}: ${JSON.stringify(e.debugData[n])}`);t.push("")}return e.debugData.synthConfig&&(t.push("--- Synth Config ---"),t.push(JSON.stringify(e.debugData.synthConfig,null,2)),t.push("")),e.stack&&(t.push("--- Stack Trace ---"),t.push(e.stack)),t.join("\n")},copyToClipboard:async e=>{const a=t().getDebugString(e);try{return await navigator.clipboard.writeText(a),!0}catch(n){return!1}}})),go=(e,t,a)=>yo.getState().reportError({synthType:e,message:t,synthName:a?.synthName,errorType:a?.errorType??"init",stack:a?.error?.stack,debugData:a?.debugData});class bo{name="FurnaceSynth";output;chipEngine=lo.getInstance();config;channelIndex=0;macroPositions=new Map;opMacroPositions=Array.from({length:4},()=>({}));activeNoteFreq=440;isNoteOn=!1;currentDuty=2;currentPan=0;velocity=1;baseTLValues=[];_oplBlock=0;_oplFnum=0;useWasmEngine=!1;errorReported=!1;gbFreqHigh=0;gbFreqVal=0;nesNoiseIndex=0;initInProgress=!1;wasmNoteTriggered=!1;noteOnTime=0;static MIN_GATE_TIME=.05;_volumeOffsetDb=0;constructor(e=An,t=0){this.config={...e,operators:e.operators?.map(e=>({...e}))||[]},this.channelIndex=t,this.output=us().createGain(),this.chipEngine=lo.getInstance(),this.initEngine()}getChipType(){return this.config.chipType}setChannelIndex(e){this.channelIndex=e}static getMaxChannels(e){switch(e){case io.OPN2:return 6;case io.OPM:case io.OPZ:return 8;case io.OPL3:return 18;case io.OPLL:return 9;case io.OPNA:return 6;case io.OPNB:return 4;case io.OPN:return 3;case io.OPNB_B:return 6;case io.ESFM:return 18;case io.Y8950:return 9;case io.OPL4:return 18;case io.PSG:return 4;case io.AY:return 3;case io.NES:return 5;case io.GB:return 4;case io.SID:case io.SID_6581:case io.SID_8580:return 3;case io.PCE:return 6;case io.SNES:return 8;default:return 6}}setVolumeOffset(e){this._volumeOffsetDb=e,this.useWasmEngine&&this.chipEngine.setOutputGain(Math.pow(10,e/20))}async ensureInitialized(){if(!this.useWasmEngine){if(this.initInProgress){for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);if(this.useWasmEngine)return}await this.initEngine(),!this.useWasmEngine&&this.chipEngine.isInitialized()&&(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters())}}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=us();if("running"!==e.state){if(!(await Promise.race([new Promise(t=>{const a=()=>{"running"===e.state?t(!0):setTimeout(a,100)};a()}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return this.reportInitError("audio","AudioContext failed to start. Click anywhere to enable audio, then try again."),void(this.initInProgress=!1)}await this.chipEngine.init(e),this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters(),this.isNoteOn&&this.activeNoteFreq>0&&(this.updateFrequency(this.activeNoteFreq),this.writeKeyOn(this.velocity),this.wasmNoteTriggered=!0)):this.reportInitError("wasm","WASM chip engine failed to initialize. This synth requires WebAssembly support.")}catch(e){const t=e instanceof Error?e:new Error(String(e));this.reportInitError("wasm",t.message,t)}finally{this.initInProgress=!1}}}reportInitError(e,t,a){this.errorReported||(this.errorReported=!0,go(`Furnace/${this.config.chipType||"Unknown"}`,t,{errorType:e,error:a,debugData:{chipType:this.config.chipType,channelIndex:this.channelIndex,synthConfig:this.config}}))}processTick(e=vs()){this.isNoteOn&&(this.config.macros.forEach(t=>{if(!t.data||0===t.data.length)return;let a=this.macroPositions.get(t.type)||0;a>=t.data.length&&(a=t.data.length-1);const n=t.data[a];switch(t.type){case 0:{const t=Math.max(0,n/127*this.velocity);this.output.gain.setValueAtTime(t,e);break}case 1:this.updateFrequency(this.activeNoteFreq*Math.pow(2,n/12));break;case 2:this.currentDuty=n,this.writeDutyRegister(n);break;case 3:this.writeWavetableSelect(n);break;case 4:{const e=n>127?n-256:n;this.updateFrequency(this.activeNoteFreq*Math.pow(2,e/1200));break}case 5:this.currentPan=n>127?n-256:n,this.writePanRegister(this.currentPan);break;case 6:0!==n&&this.writePhaseReset()}a++,a>=t.data.length&&(a=t.loop>=0?t.loop:t.data.length-1),this.macroPositions.set(t.type,a)}),this.config.opMacros.forEach((e,t)=>{if(!e)return;const a=this.config.operators[t];if(a){if(e.tl&&e.tl.data.length>0){const n=this.advanceOpMacro(e.tl,t,"tl");a.tl=n,this.writeOperatorTL(t,n)}if(e.mult&&e.mult.data.length>0){const n=this.advanceOpMacro(e.mult,t,"mult");a.mult=n,this.writeOperatorMult(t,n)}if(e.ar&&e.ar.data.length>0){const n=this.advanceOpMacro(e.ar,t,"ar");a.ar=n,this.writeOperatorAR(t,n)}if(e.dr&&e.dr.data.length>0){const n=this.advanceOpMacro(e.dr,t,"dr");a.dr=n,this.writeOperatorDR(t,n)}if(e.sl&&e.sl.data.length>0){const n=this.advanceOpMacro(e.sl,t,"sl");a.sl=n,this.writeOperatorSL(t,n)}if(e.rr&&e.rr.data.length>0){const n=this.advanceOpMacro(e.rr,t,"rr");a.rr=n,this.writeOperatorRR(t,n)}}}))}advanceOpMacro(e,t,a){let n=this.opMacroPositions[t][a]||0;n>=e.data.length&&(n=e.data.length-1);const s=e.data[n];return n++,n>=e.data.length&&(n=e.loop>=0?e.loop:e.data.length-1),this.opMacroPositions[t][a]=n,s}writeDutyRegister(e){const t=this.channelIndex;if(this.config.chipType===io.NES){if(t<2){const a=16384+4*t,n=48|15&(this.config.operators[0]?.tl||15);this.chipEngine.write(io.NES,a,(3&e)<<6|n)}}else if(this.config.chipType===io.GB){if(t<2){const a=0===t?17:22;this.chipEngine.write(io.GB,a,(3&e)<<6)}}else this.config.chipType,io.PSG}writeWavetableSelect(e){if(this.config.wavetables&&this.config.wavetables[e]){const t=this.config.wavetables[e].data;mo.uploadWavetable(this.chipEngine,this.config.chipType,t)}}writePanRegister(e){const t=this.channelIndex;if(this.config.chipType===io.OPN2){const a=t%3,n=0===(t<3?0:1)?0:256;let s=192;e<-32?s=128:e>32&&(s=64),this.chipEngine.write(io.OPN2,n|180+a,s)}else if(this.config.chipType===io.OPM){let a=192;e<-32?a=128:e>32&&(a=64);const n=(7&this.config.feedback)<<3|7&this.config.algorithm;this.chipEngine.write(io.OPM,32+(7&t),a|n)}else this.config.chipType===io.GB&&this.chipEngine.write(io.GB,37,255)}writePhaseReset(){if(this.config.chipType===io.OPN2){const e=this.channelIndex%3,t=this.channelIndex<3?0:1;this.chipEngine.write(io.OPN2,40,t<<2|e),this.chipEngine.write(io.OPN2,40,240|t<<2|e)}}writeOperatorTL(e,t){const a=this.channelIndex;if(this.config.chipType===io.OPN2){const n=0===(a<3?0:1)?0:256,s=[0,8,4,12][e]+a%3;this.chipEngine.write(io.OPN2,n|64+s,127&t)}else if(this.config.chipType===io.OPM||this.config.chipType===io.OPZ){const n=[0,16,8,24][e]+(7&a),s=this.config.chipType;this.chipEngine.write(s,96+n,127&t)}}writeOperatorMult(e,t){const a=this.channelIndex,n=this.config.operators[e];if(!n)return;const s=this.furnaceDtToOPN2(n.dt);if(this.config.chipType===io.OPN2){const n=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(io.OPN2,n|48+r,(7&s)<<4|15&t)}else if(this.config.chipType===io.OPM||this.config.chipType===io.OPZ){const n=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,64+n,(7&s)<<4|15&t)}}writeOperatorAR(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===io.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(io.OPN2,s|80+r,(3&(n.rs??0))<<6|31&t)}else if(this.config.chipType===io.OPM||this.config.chipType===io.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,128+s,(3&(n.rs??0))<<6|31&t)}}writeOperatorDR(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===io.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(io.OPN2,s|96+r,(n.am?128:0)|31&t)}else if(this.config.chipType===io.OPM||this.config.chipType===io.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,160+s,(n.am?128:0)|31&t)}}writeOperatorSL(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===io.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(io.OPN2,s|128+r,(15&t)<<4|15&n.rr)}else if(this.config.chipType===io.OPM||this.config.chipType===io.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&t)<<4|15&n.rr)}}writeOperatorRR(e,t){const a=this.channelIndex,n=this.config.operators[e];if(n)if(this.config.chipType===io.OPN2){const s=0===(a<3?0:1)?0:256,r=[0,8,4,12][e]+a%3;this.chipEngine.write(io.OPN2,s|128+r,(15&n.sl)<<4|15&t)}else if(this.config.chipType===io.OPM||this.config.chipType===io.OPZ){const s=[0,16,8,24][e]+(7&a),r=this.config.chipType;this.chipEngine.write(r,224+s,(15&n.sl)<<4|15&t)}}furnaceDtToOPN2(e){return e>=0?3&e:4+Math.abs(e)&7}updateFrequency(e){const t=this.channelIndex%3,a=0===(this.channelIndex<3?0:1)?0:256;if(this.config.chipType===io.OPN2){const{block:n,fnum:s}=ho.freqToOPN2(e);this.chipEngine.write(io.OPN2,a|160+t,255&s),this.chipEngine.write(io.OPN2,a|164+t,(7&n)<<3|s>>8&7)}else if(this.config.chipType===io.OPN){const{block:t,fnum:a}=ho.freqToOPN2(e),n=this.channelIndex%3;this.chipEngine.write(io.OPN,160+n,255&a),this.chipEngine.write(io.OPN,164+n,(7&t)<<3|a>>8&7)}else if(this.config.chipType===io.OPM){const{kc:t,kf:a}=ho.freqToOPM(e);this.chipEngine.write(io.OPM,40+(7&this.channelIndex),t),this.chipEngine.write(io.OPM,48+(7&this.channelIndex),a<<2)}else if(this.config.chipType===io.OPZ){const t=[0,1,2,4,5,6,8,9,10,12,13,14],a=Math.round(12*Math.log2(e/440)+69),n=Math.max(0,Math.min(127,a)),s=(7&Math.floor(n/12))<<4|t[n%12],r=12*Math.log2(e/440)+69-n,i=63&Math.floor(64*r);this.chipEngine.write(io.OPZ,40+(7&this.channelIndex),s),this.chipEngine.write(io.OPZ,48+(7&this.channelIndex),i<<2)}else if(this.config.chipType===io.OPL3||this.config.chipType===io.Y8950||this.config.chipType===io.OPL4||this.config.chipType===io.ESFM){const t=this.channelIndex%9,a=this.channelIndex<9?0:256;let n=4,s=Math.floor(e*(1<<19)/2e5);for(;s>1023&&n<7;)s>>=1,n++;for(;s<256&&n>0;)s<<=1,n--;s&=1023,this._oplBlock=n,this._oplFnum=s,this.chipEngine.write(this.config.chipType,a|160+t,255&s),this.chipEngine.write(this.config.chipType,a|176+t,(7&n)<<2|s>>8&3)}else if(this.config.chipType===io.OPLL){const t=this.channelIndex%9;let a=4,n=Math.floor(e*(1<<18)/2e5);for(;n>511&&a<7;)n>>=1,a++;for(;n<128&&a>0;)n<<=1,a--;n&=511,this._oplBlock=a,this._oplFnum=n,this.chipEngine.write(io.OPLL,16+t,255&n)}else if(this.config.chipType===io.OPNA||this.config.chipType===io.OPNB||this.config.chipType===io.OPNB_B){const{block:t,fnum:a}=ho.freqToOPN2(e),n=this.channelIndex%3,s=0===(this.channelIndex<3?0:1)?0:256;this.chipEngine.write(this.config.chipType,s|160+n,255&a),this.chipEngine.write(this.config.chipType,s|164+n,(7&t)<<3|a>>8&7)}else if(this.config.chipType===io.AY||this.config.chipType===io.AY8930){const t=1789773,a=4095&Math.floor(t/(16*e)),n=this.channelIndex%3;this.chipEngine.write(this.config.chipType,2*n,255&a),this.chipEngine.write(this.config.chipType,2*n+1,a>>8&15)}else if(this.config.chipType===io.SID||this.config.chipType===io.SID_6581||this.config.chipType===io.SID_8580){const t=985248,a=65535&Math.floor(16777216*e/t),n=this.channelIndex%3*7;this.chipEngine.write(this.config.chipType,n+0,255&a),this.chipEngine.write(this.config.chipType,n+1,a>>8&255)}else if(this.config.chipType===io.PSG){const t=1023&Math.floor(3579545/(32*e)),a=3&this.channelIndex;this.chipEngine.write(io.PSG,0,128|a<<5|15&t),this.chipEngine.write(io.PSG,0,t>>4&63)}else if(this.config.chipType===io.NES){const t=this.channelIndex;if(t<2){const a=ho.freqToNES(e),n=16384+4*t;this.chipEngine.write(io.NES,n+2,255&a),this.chipEngine.write(io.NES,n+3,a>>8&7)}else if(2===t){const t=ho.freqToNES(e);this.chipEngine.write(io.NES,16394,255&t),this.chipEngine.write(io.NES,16395,t>>8&7)}else if(3===t){const t=ho.freqToNESNoise(e);this.nesNoiseIndex=t,this.chipEngine.write(io.NES,16398,15&t)}}else if(this.config.chipType===io.GB){const t=ho.freqToGB(e);this.gbFreqVal=t}else if(this.config.chipType===io.PCE){const t=this.channelIndex,a=4095&Math.floor(3579545/(32*e));this.chipEngine.write(io.PCE,0,7&t),this.chipEngine.write(io.PCE,2,255&a),this.chipEngine.write(io.PCE,3,a>>8&15)}else if(this.config.chipType===io.SNES){const t=16*(7&this.channelIndex),a=16383&Math.floor(4096*e/32e3);this.chipEngine.write(io.SNES,t+2,255&a),this.chipEngine.write(io.SNES,t+3,a>>8&63)}}updateParameters(){switch(this.config.chipType){case 0:mo.mapOPN2(this.chipEngine,this.channelIndex,this.config);break;case 1:mo.mapOPM(this.chipEngine,this.channelIndex,this.config);break;case 2:mo.mapOPL3(this.chipEngine,this.channelIndex,this.config);break;case 11:mo.mapOPLL(this.chipEngine,this.channelIndex,this.config);break;case 13:mo.mapOPNA(this.chipEngine,this.channelIndex,this.config);break;case 14:case 48:mo.mapOPNB(this.chipEngine,this.channelIndex,this.config);break;case 22:mo.mapOPZ(this.chipEngine,this.channelIndex,this.config);break;case 23:mo.mapY8950(this.chipEngine,this.channelIndex,this.config);break;case 26:mo.mapOPL4(this.chipEngine,this.channelIndex,this.config);break;case 47:mo.mapOPN(this.chipEngine,this.channelIndex,this.config);break;case 49:mo.mapOPL3(this.chipEngine,this.channelIndex,this.config,io.ESFM);break;case 3:mo.mapPSG(this.chipEngine,this.channelIndex,this.config);break;case 12:mo.mapAY(this.chipEngine,this.channelIndex,this.config);break;case 18:mo.mapSAA(this.chipEngine,this.channelIndex,this.config);break;case 43:mo.mapT6W28(this.chipEngine,this.channelIndex,this.config);break;case 4:mo.mapNES(this.chipEngine,this.channelIndex,this.config);break;case 5:mo.mapGB(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&mo.uploadWavetable(this.chipEngine,io.GB,this.config.wavetables[0].data);break;case 6:mo.mapPCE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&mo.uploadWavetable(this.chipEngine,io.PCE,this.config.wavetables[0].data);break;case 24:mo.mapSNES(this.chipEngine,this.channelIndex,this.config);break;case 44:mo.mapVB(this.chipEngine,this.channelIndex,this.config);break;case 16:mo.mapFDS(this.chipEngine,this.channelIndex,this.config);break;case 17:mo.mapMMC5(this.chipEngine,this.channelIndex,this.config);break;case 8:mo.mapN163(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&mo.uploadWavetable(this.chipEngine,io.N163,this.config.wavetables[0].data);break;case 9:mo.mapVRC6(this.chipEngine,this.channelIndex,this.config);break;case 7:mo.mapSCC(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&mo.uploadWavetable(this.chipEngine,io.SCC,this.config.wavetables[0].data);break;case 19:mo.mapSWAN(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&mo.uploadWavetable(this.chipEngine,io.SWAN,this.config.wavetables[0].data);break;case 36:mo.mapVERA(this.chipEngine,this.channelIndex,this.config);break;case 37:mo.mapSM8521(this.chipEngine,this.channelIndex,this.config);break;case 38:mo.mapBUBBLE(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&mo.uploadWavetable(this.chipEngine,io.BUBBLE,this.config.wavetables[0].data);break;case 10:case 45:case 46:mo.mapC64(this.chipEngine,this.channelIndex,this.config);break;case 20:mo.mapOKI(this.chipEngine,this.channelIndex,this.config);break;case 21:mo.mapES5506(this.chipEngine,this.channelIndex,this.config);break;case 27:mo.mapSEGAPCM(this.chipEngine,this.channelIndex,this.config);break;case 28:mo.mapYMZ280B(this.chipEngine,this.channelIndex,this.config);break;case 29:mo.mapRF5C68(this.chipEngine,this.channelIndex,this.config);break;case 30:mo.mapGA20(this.chipEngine,this.channelIndex,this.config);break;case 31:mo.mapC140(this.chipEngine,this.channelIndex,this.config);break;case 32:mo.mapQSOUND(this.chipEngine,this.channelIndex,this.config);break;case 39:mo.mapK007232(this.chipEngine,this.channelIndex,this.config);break;case 40:mo.mapK053260(this.chipEngine,this.channelIndex,this.config);break;case 41:mo.mapX1_010(this.chipEngine,this.channelIndex,this.config),this.config.wavetables.length>0&&mo.uploadWavetable(this.chipEngine,io.X1_010,this.config.wavetables[0].data);break;case 15:mo.mapTIA(this.chipEngine,this.channelIndex,this.config);break;case 33:mo.mapVIC(this.chipEngine,this.channelIndex,this.config);break;case 34:mo.mapTED(this.chipEngine,this.channelIndex,this.config);break;case 35:mo.mapSUPERVISION(this.chipEngine,this.channelIndex,this.config);break;case 42:mo.mapUPD1771(this.chipEngine,this.channelIndex,this.config);break;case 25:mo.mapLYNX(this.chipEngine,this.channelIndex,this.config);break;case 55:mo.mapNAMCO(this.chipEngine,this.channelIndex,this.config);break;case 56:mo.mapPET(this.chipEngine,this.channelIndex,this.config);break;case 57:mo.mapPOKEY(this.chipEngine,this.channelIndex,this.config);break;case 61:mo.mapAMIGA(this.chipEngine,this.channelIndex,this.config);break;case 62:mo.mapPCSPKR(this.chipEngine,this.channelIndex,this.config)}}triggerAttack(e,t,a){const n=bs(e);this.activeNoteFreq=n,this.isNoteOn=!0,this.velocity=void 0!==a?a:1;const s=t||vs();return this.noteOnTime=vs(),this.useWasmEngine||(this.chipEngine.isInitialized()?(this.useWasmEngine=!0,0!==this._volumeOffsetDb&&this.chipEngine.setOutputGain(Math.pow(10,this._volumeOffsetDb/20)),this.updateParameters()):this.initInProgress||this.initEngine()),this.useWasmEngine?(this.macroPositions.clear(),this.opMacroPositions=Array.from({length:4},()=>({})),this.currentDuty=2,this.currentPan=0,this.baseTLValues=this.config.operators.map(e=>e.tl),this.applyVelocityToCarriers(),this.updateParameters(),this.updateFrequency(n),this.writeKeyOn(a),this.wasmNoteTriggered=!0,this.processTick(s),this):this}applyVelocityToCarriers(){if(this.config.chipType!==io.OPN2&&this.config.chipType!==io.OPM)return;const e=[[3],[3],[3],[3],[2,3],[2,3],[1,2,3],[0,1,2,3]][7&this.config.algorithm]||[3],t=Math.floor(32*(1-this.velocity));for(const a of e)if(this.config.operators[a]){const e=this.baseTLValues[a];this.config.operators[a].tl=Math.min(127,e+t)}}writeKeyOn(e){const t=this.channelIndex,a=void 0!==e?Math.floor(15*e):15;switch(this.config.chipType){case io.OPN2:{const e=(t<3?0:1)<<2|t%3,a=240|e;this.chipEngine.write(io.OPN2,40,e),this.chipEngine.write(io.OPN2,40,a);break}case io.OPM:this.chipEngine.write(io.OPM,8,7&t),this.chipEngine.write(io.OPM,8,120|7&t);break;case io.NES:if(this.chipEngine.write(io.NES,16405,31),t<2){const e=16384+4*t,n=ho.freqToNES(this.activeNoteFreq);this.chipEngine.write(io.NES,e,(3&this.currentDuty)<<6|48|a),this.chipEngine.write(io.NES,e+1,8),this.chipEngine.write(io.NES,e+2,255&n),this.chipEngine.write(io.NES,e+3,8|n>>8&7)}else if(2===t){const e=ho.freqToNES(this.activeNoteFreq);this.chipEngine.write(io.NES,16392,255),this.chipEngine.write(io.NES,16394,255&e),this.chipEngine.write(io.NES,16395,8|e>>8&7)}else 3===t&&(this.chipEngine.write(io.NES,16396,48|a),this.chipEngine.write(io.NES,16398,15&this.nesNoiseIndex),this.chipEngine.write(io.NES,16399,8));break;case io.GB:{const e=this.gbFreqVal||0;if(t<2){const n=0===t?16:21;this.chipEngine.write(io.GB,n+1,(3&this.currentDuty)<<6|63),this.chipEngine.write(io.GB,n+2,a<<4|8),this.chipEngine.write(io.GB,n+3,2048-e&255),this.chipEngine.write(io.GB,n+4,2048-e>>8&7|128)}else 2===t?(this.chipEngine.write(io.GB,26,128),this.chipEngine.write(io.GB,27,255),this.chipEngine.write(io.GB,28,32),this.chipEngine.write(io.GB,29,2048-e&255),this.chipEngine.write(io.GB,30,2048-e>>8&7|128)):3===t&&(this.chipEngine.write(io.GB,32,63),this.chipEngine.write(io.GB,33,a<<4|8),this.chipEngine.write(io.GB,34,0),this.chipEngine.write(io.GB,35,128));this.chipEngine.write(io.GB,38,128);break}case io.PSG:{const e=15-Math.min(15,a);this.chipEngine.write(io.PSG,0,144|(3&t)<<5|e);break}case io.PCE:{const e=4095&Math.floor(3579545/(32*this.activeNoteFreq));this.chipEngine.write(io.PCE,0,7&t),this.chipEngine.write(io.PCE,4,95),this.chipEngine.write(io.PCE,4,31);for(let t=0;t<32;t++){const e=t<16?31:0;this.chipEngine.write(io.PCE,6,e)}this.chipEngine.write(io.PCE,2,255&e),this.chipEngine.write(io.PCE,3,e>>8&15),this.chipEngine.write(io.PCE,5,255),this.chipEngine.write(io.PCE,4,128|31&a);break}case io.SNES:{const e=16*(7&t),n=1<<(7&t);this.chipEngine.write(io.SNES,92,n);const s=16383&Math.floor(4096*this.activeNoteFreq/32e3);this.chipEngine.write(io.SNES,e+2,255&s),this.chipEngine.write(io.SNES,e+3,s>>8&63),this.chipEngine.write(io.SNES,e+5,255),this.chipEngine.write(io.SNES,e+6,224),this.chipEngine.write(io.SNES,e+0,8*a),this.chipEngine.write(io.SNES,e+1,8*a),this.chipEngine.write(io.SNES,92,0),this.chipEngine.write(io.SNES,76,n);break}case io.OPL3:{const e=t%9,a=t<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|n;this.chipEngine.write(io.OPL3,a|176+e,n),this.chipEngine.write(io.OPL3,a|176+e,s);break}case io.OPLL:{const e=t%9,a=(7&this._oplBlock)<<1|this._oplFnum>>8&1,n=16|a;this.chipEngine.write(io.OPLL,32+e,a),this.chipEngine.write(io.OPLL,32+e,n);break}case io.OPNA:{const e=(t<3?0:1)<<2|t%3,a=240|e;this.chipEngine.write(io.OPNA,40,e),this.chipEngine.write(io.OPNA,40,a);break}case io.OPNB:{const e=[1,2,5,6][3&t];this.chipEngine.write(io.OPNB,40,e),this.chipEngine.write(io.OPNB,40,240|e);break}case io.OPN:{const e=t%3;this.chipEngine.write(io.OPN,40,e),this.chipEngine.write(io.OPN,40,240|e);break}case io.OPZ:{const e=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7,a=64|e;this.chipEngine.write(io.OPZ,32+(7&t),e),this.chipEngine.write(io.OPZ,32+(7&t),a);break}case io.Y8950:case io.OPL4:{const e=this.config.chipType,a=t%9,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|n;this.chipEngine.write(e,176+a,n),this.chipEngine.write(e,176+a,s);break}case io.AY:{const e=4095&Math.floor(1789773/(16*this.activeNoteFreq));this.chipEngine.write(io.AY,2*t,255&e),this.chipEngine.write(io.AY,2*t+1,e>>8&15),this.chipEngine.write(io.AY,8+t,15&a);const n=63&~(1<<t);this.chipEngine.write(io.AY,7,n);break}case io.SAA:{const e=8e6;let n=4,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-n)));for(;s<0&&n<7;)n++,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-n)));for(;s>255&&n>0;)n--,s=Math.floor(256-e/(512*this.activeNoteFreq*Math.pow(2,7-n)));s=Math.max(0,Math.min(255,s)),this.chipEngine.write(io.SAA,0+t,a<<4|a),this.chipEngine.write(io.SAA,8+t,s);const r=16+Math.floor(t/2),i=t%2*4;this.chipEngine.write(io.SAA,r,n<<i|n<<4*(1-t%2)),this.chipEngine.write(io.SAA,20,1<<t);break}case io.T6W28:{const e=3072e3,n=3===t?15:16,s=Math.floor(e/(n*this.activeNoteFreq))-1,r=Math.max(0,Math.min(1023,s)),i=15-Math.min(15,a);this.chipEngine.write(io.T6W28,0,128|(3&t)<<5|15&r),this.chipEngine.write(io.T6W28,0,r>>4&63),this.chipEngine.write(io.T6W28,1,128|(3&t)<<5|15&r),this.chipEngine.write(io.T6W28,1,r>>4&63),this.chipEngine.write(io.T6W28,0,144|(3&t)<<5|i),this.chipEngine.write(io.T6W28,1,144|(3&t)<<5|i);break}case io.VRC6:if(t<2){const e=0===t?36864:40960,n=Math.floor(3579545/(16*this.activeNoteFreq))-1;this.chipEngine.write(io.VRC6,e,(7&this.currentDuty)<<4|a),this.chipEngine.write(io.VRC6,e+1,255&n),this.chipEngine.write(io.VRC6,e+2,128|n>>8&15)}else{const e=Math.floor(3579545/(14*this.activeNoteFreq))-1;this.chipEngine.write(io.VRC6,45056,63&a),this.chipEngine.write(io.VRC6,45057,255&e),this.chipEngine.write(io.VRC6,45058,128|e>>8&15)}break;case io.N163:{const e=Math.floor(7864320*this.activeNoteFreq/3579545);this.chipEngine.write(io.N163,120,255&e),this.chipEngine.write(io.N163,122,e>>8&255),this.chipEngine.write(io.N163,124,224|e>>16&3),this.chipEngine.write(io.N163,127,240|a);break}case io.FDS:{const e=4095&Math.floor(65536*this.activeNoteFreq/1789773);this.chipEngine.write(io.FDS,16512,128|2*a),this.chipEngine.write(io.FDS,16514,255&e),this.chipEngine.write(io.FDS,16515,e>>8&15);break}case io.MMC5:{const e=0===t?20480:20484,n=ho.freqToNES(this.activeNoteFreq);this.chipEngine.write(io.MMC5,e,(3&this.currentDuty)<<6|48|a),this.chipEngine.write(io.MMC5,e+2,255&n),this.chipEngine.write(io.MMC5,e+3,8|n>>8&7);break}case io.SCC:{const e=Math.floor(3579545/(16*this.activeNoteFreq))-1,n=128;this.chipEngine.write(io.SCC,n+2*t,255&e),this.chipEngine.write(io.SCC,n+2*t+1,e>>8&15),this.chipEngine.write(io.SCC,n+10+t,15&a),this.chipEngine.write(io.SCC,n+15,1<<t);break}case io.SWAN:{const e=3072e3,n=2047&Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(io.SWAN,2*t,255&n),this.chipEngine.write(io.SWAN,2*t+1,n>>8&7),this.chipEngine.write(io.SWAN,8+t,a<<4|a),this.chipEngine.write(io.SWAN,16,1<<t),this.chipEngine.write(io.SWAN,17,15);break}case io.VERA:{const e=25e6,n=65535&Math.floor(2097152*this.activeNoteFreq/e),s=4*t;this.chipEngine.write(io.VERA,s+0,255&n),this.chipEngine.write(io.VERA,s+1,n>>8&255),this.chipEngine.write(io.VERA,s+2,(63&a)<<2|3),this.chipEngine.write(io.VERA,s+3,63);break}case io.SM8521:{const e=756e3,n=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,n)),r=[[71,70],[73,72],[77,76]],i=[66,68,74];this.chipEngine.write(io.SM8521,i[t]||66,31&a),r[t]&&(this.chipEngine.write(io.SM8521,r[t][0],s>>8&15),this.chipEngine.write(io.SM8521,r[t][1],255&s)),this.chipEngine.write(io.SM8521,64,128|1<<t);break}case io.BUBBLE:{const e=3579545,n=Math.floor(4096-e/(32*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,n));this.chipEngine.write(io.BUBBLE,1&t,255&s),this.chipEngine.write(io.BUBBLE,2+(1&t),15&a);break}case io.X1_010:{const e=4194304,n=65535&Math.floor(this.activeNoteFreq*e/1e6),s=t<<3;this.chipEngine.write(io.X1_010,s+2,255&n),this.chipEngine.write(io.X1_010,s+3,n>>8&255),this.chipEngine.write(io.X1_010,s+1,a<<4),this.chipEngine.write(io.X1_010,s,3);break}case io.VB:{const e=5e6,n=Math.floor(2048-e/(16*this.activeNoteFreq)),s=Math.max(0,Math.min(2047,n)),r=1024+64*t;this.chipEngine.write(io.VB,r+8,2047-s&255),this.chipEngine.write(io.VB,r+12,2047-s>>8&7),this.chipEngine.write(io.VB,r+4,255),this.chipEngine.write(io.VB,r+16,(15&a)<<4),this.chipEngine.write(io.VB,r+20,0),this.chipEngine.write(io.VB,r+0,128);break}case io.LYNX:{const e=16e6,n=Math.floor(e/(256*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,n)),r=32+8*t;this.chipEngine.write(io.LYNX,r+0,a<<4|a),this.chipEngine.write(io.LYNX,r+1,1),this.chipEngine.write(io.LYNX,r+4,s),this.chipEngine.write(io.LYNX,r+5,128),this.chipEngine.write(io.LYNX,80,255);break}case io.SID:{const e=t*64;this.chipEngine.write(io.SID,e+0,1);break}case io.SID_6581:case io.SID_8580:{const e=7*t,a=45===this.config.chipType?io.SID_6581:io.SID_8580,n=0,s=8,r=15,i=8,o=64,l=1,c=2048;this.chipEngine.write(a,e+2,255&c),this.chipEngine.write(a,e+3,c>>8&15),this.chipEngine.write(a,e+5,n<<4|s),this.chipEngine.write(a,e+6,r<<4|i),this.chipEngine.write(a,e+4,o|l);break}case io.TIA:{const e=31440,n=Math.floor(e/(32*this.activeNoteFreq))-1,s=Math.max(0,Math.min(31,n)),r=0===t?21:22;this.chipEngine.write(io.TIA,r,4),this.chipEngine.write(io.TIA,r+2,31&s),this.chipEngine.write(io.TIA,r+4,15&a);break}case io.VIC:{const e=1022727;let n=Math.floor(256-e/(32*this.activeNoteFreq));n>>=t<3?2-t:1;const s=Math.max(0,Math.min(127,n));this.chipEngine.write(io.VIC,10+t,255-s),this.chipEngine.write(io.VIC,14,15&a);break}case io.TED:{const e=1773447,n=Math.floor(1024-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(1023,n));0===t?(this.chipEngine.write(io.TED,14,1022-s&255),this.chipEngine.write(io.TED,18,1022-s>>8&3)):(this.chipEngine.write(io.TED,15,1022-s&255),this.chipEngine.write(io.TED,16,1022-s>>8&3));const r=15&a|(0===t?16:32);this.chipEngine.write(io.TED,17,r);break}case io.SUPERVISION:{const e=4e6;if(t<2){const a=Math.floor(2*e/(32*this.activeNoteFreq)),n=Math.max(1,Math.min(2047,a)),s=16+4*t;this.chipEngine.write(io.SUPERVISION,s,255&n),this.chipEngine.write(io.SUPERVISION,s+1,n>>8&7);const r=30|(3&this.currentDuty)<<4;this.chipEngine.write(io.SUPERVISION,s+2,r),this.chipEngine.write(io.SUPERVISION,s+3,255)}else if(3===t){const e=15-(15&Math.floor(12*Math.log2(this.activeNoteFreq/440)+69))<<4|15&a;this.chipEngine.write(io.SUPERVISION,40,e),this.chipEngine.write(io.SUPERVISION,41,200),this.chipEngine.write(io.SUPERVISION,42,30)}break}case io.UPD1771:this.chipEngine.write(io.UPD1771,0,2);break;case io.OKI:this.chipEngine.write(io.OKI,t,128|a<<3);break;case io.SEGAPCM:{const e=8*t;this.chipEngine.write(io.SEGAPCM,e+134,255),this.chipEngine.write(io.SEGAPCM,e+2,a<<3),this.chipEngine.write(io.SEGAPCM,e+3,a<<3);break}case io.YMZ280B:{const e=4*t;this.chipEngine.write(io.YMZ280B,1+e,192|a<<1);break}case io.RF5C68:this.chipEngine.write(io.RF5C68,7,t),this.chipEngine.write(io.RF5C68,8,255&~(1<<t));break;case io.GA20:this.chipEngine.write(io.GA20,0+8*t+5,0);break;case io.C140:{const e=16*t;this.chipEngine.write(io.C140,e+5,96);break}case io.QSOUND:this.chipEngine.write(io.QSOUND,8*t+6,a<<4);break;case io.K007232:this.chipEngine.write(io.K007232,6*t+0,128);break;case io.K053260:this.chipEngine.write(io.K053260,40,1<<t);break;case io.ES5506:break;case io.OPNB_B:{const e=[1,2,5,6,0,4][t%6];this.chipEngine.write(io.OPNB_B,40,e),this.chipEngine.write(io.OPNB_B,40,240|e);break}case io.ESFM:{const e=t%18,a=e<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3,s=32|n;this.chipEngine.write(io.ESFM,a|176+e%9,n),this.chipEngine.write(io.ESFM,a|176+e%9,s);break}case io.AY8930:{const e=1789773,n=65535&Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(io.AY8930,2*t,255&n),this.chipEngine.write(io.AY8930,2*t+1,n>>8&255),this.chipEngine.write(io.AY8930,8+t,31&a),this.chipEngine.write(io.AY8930,7,63&~(1<<t)),this.chipEngine.write(io.AY8930,22+t,8);break}case io.NDS:{const e=16*t,n=65535&Math.floor(65536*this.activeNoteFreq/32768);this.chipEngine.write(io.NDS,e+8,255&n),this.chipEngine.write(io.NDS,e+9,n>>8&255),this.chipEngine.write(io.NDS,e+3,128|a<<1);break}case io.GBA_DMA:this.chipEngine.write(io.GBA_DMA,130,11);break;case io.GBA_MINMOD:this.chipEngine.write(io.GBA_MINMOD,0,128|a);break;case io.POKEMINI:{const e=4e6,t=Math.floor(e/(16*this.activeNoteFreq)),n=Math.max(1,Math.min(65535,t));this.chipEngine.write(io.POKEMINI,74,255&n),this.chipEngine.write(io.POKEMINI,75,n>>8&255),this.chipEngine.write(io.POKEMINI,76,n>>1&255),this.chipEngine.write(io.POKEMINI,77,n>>1>>8&255),this.chipEngine.write(io.POKEMINI,72,4),this.chipEngine.write(io.POKEMINI,113,a>8?3:a>4?2:1);break}case io.NAMCO:{const e=4194304,n=1048575&Math.floor(this.activeNoteFreq*e/192e3);if(0===t)this.chipEngine.write(io.NAMCO,16,n>>4&15),this.chipEngine.write(io.NAMCO,17,15&n),this.chipEngine.write(io.NAMCO,18,n>>8&15),this.chipEngine.write(io.NAMCO,19,n>>12&15),this.chipEngine.write(io.NAMCO,20,n>>16&15);else{const e=21+5*(t-1);this.chipEngine.write(io.NAMCO,e+1,15&n),this.chipEngine.write(io.NAMCO,e+2,n>>8&15),this.chipEngine.write(io.NAMCO,e+3,n>>12&15),this.chipEngine.write(io.NAMCO,e+4,n>>16&15)}this.chipEngine.write(io.NAMCO,21+5*t,15&a),this.chipEngine.write(io.NAMCO,5+5*t,0);break}case io.PET:{const e=1e6,t=Math.floor(e/(16*this.activeNoteFreq))-1,a=Math.max(0,Math.min(65535,t));this.chipEngine.write(io.PET,8,255&a),this.chipEngine.write(io.PET,9,a>>8&255),this.chipEngine.write(io.PET,11,16);break}case io.POKEY:{const e=1789773,n=Math.floor(e/(2*this.activeNoteFreq))-1,s=Math.max(0,Math.min(255,n));this.chipEngine.write(io.POKEY,2*t,s),this.chipEngine.write(io.POKEY,2*t+1,160|15&a),this.chipEngine.write(io.POKEY,8,0),this.chipEngine.write(io.POKEY,15,3);break}case io.MSM6258:this.chipEngine.write(io.MSM6258,0,2);break;case io.MSM5232:this.chipEngine.write(io.MSM5232,t,128|a);break;case io.MULTIPCM:{const e=t<<3;this.chipEngine.write(io.MULTIPCM,e+4,128),this.chipEngine.write(io.MULTIPCM,e+5,15-a<<3);break}case io.AMIGA:{const e=3546895,n=Math.floor(e/(2*this.activeNoteFreq)),s=Math.max(124,Math.min(65535,n)),r=160+16*t;this.chipEngine.write(io.AMIGA,r+6,s>>8&255),this.chipEngine.write(io.AMIGA,r+7,255&s),this.chipEngine.write(io.AMIGA,r+8,4*a&127),this.chipEngine.write(io.AMIGA,150,32768|1<<t);break}case io.PCSPKR:{const e=1193182,t=Math.floor(e/this.activeNoteFreq),a=Math.max(1,Math.min(65535,t));this.chipEngine.write(io.PCSPKR,0,255&a),this.chipEngine.write(io.PCSPKR,1,a>>8&255);break}case io.PONG:this.chipEngine.write(io.PONG,0,1);break;case io.PV1000:{const e=3579545,a=Math.floor(63-e/(1024*this.activeNoteFreq)),n=Math.max(0,Math.min(62,a));this.chipEngine.write(io.PV1000,t,n);break}case io.DAVE:{const e=8e6,n=Math.floor(4096-e/(8*this.activeNoteFreq)),s=Math.max(0,Math.min(4095,n));this.chipEngine.write(io.DAVE,2*t,255&s),this.chipEngine.write(io.DAVE,2*t+1,s>>8&15),this.chipEngine.write(io.DAVE,8+t,a<<2&63),this.chipEngine.write(io.DAVE,12+t,a<<2&63),this.chipEngine.write(io.DAVE,7,15);break}case io.SU:{const e=t<<3;this.chipEngine.write(io.SU,e+4,128|a);break}case io.BIFURCATOR:this.chipEngine.write(io.BIFURCATOR,t,a);break;case io.POWERNOISE:{const e=t<<2;this.chipEngine.write(io.POWERNOISE,e+0,128|a);break}case io.ZXBEEPER:{const e=35e5,t=Math.floor(e/(2*this.activeNoteFreq));this.chipEngine.write(io.ZXBEEPER,0,255&t),this.chipEngine.write(io.ZXBEEPER,1,t>>8&255);break}case io.ZXBEEPER_QT:{const e=35e5,a=Math.floor(e/(8*this.activeNoteFreq));this.chipEngine.write(io.ZXBEEPER_QT,2*t,255&a),this.chipEngine.write(io.ZXBEEPER_QT,2*t+1,a>>8&255);break}case io.SCVTONE:{const e=3579545,n=Math.floor(e/(32*this.activeNoteFreq));this.chipEngine.write(io.SCVTONE,2*t,255&n),this.chipEngine.write(io.SCVTONE,2*t+1,n>>8&15|a<<4);break}case io.PCMDAC:this.chipEngine.write(io.PCMDAC,0,128|a)}}triggerRelease(){if(this.isNoteOn=!1,!this.useWasmEngine)return this;const e=vs()-this.noteOnTime;if(e<bo.MIN_GATE_TIME){const t=1e3*(bo.MIN_GATE_TIME-e);setTimeout(()=>this.writeKeyOff(),t)}else this.writeKeyOff();return this}writeKeyOff(){if(!this.wasmNoteTriggered)return;this.wasmNoteTriggered=!1;const e=this.channelIndex;switch(this.config.chipType){case io.OPN2:{const t=e%3,a=e<3?0:1,n=0===a?0:256,s=a<<2|t;this.chipEngine.write(io.OPN2,40,s);const r=[0,8,4,12];for(let e=0;e<4;e++){const a=r[e]+t;this.chipEngine.write(io.OPN2,n|64+a,127)}break}case io.OPM:{const t=7&e;this.chipEngine.write(io.OPM,8,t);const a=[0,16,8,24];for(let n=0;n<4;n++){const t=a[n]+(7&e);this.chipEngine.write(io.OPM,96+t,127)}break}case io.OPL3:{const t=e%9,a=e<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(io.OPL3,a|176+t,n);break}case io.OPLL:{const t=e%9,a=3579545;let n=0,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-n)/a);for(;s>511&&n<7;)n++,s=Math.round(72*this.activeNoteFreq*Math.pow(2,19-n)/a);s=Math.min(511,Math.max(0,s));const r=(7&n)<<1|s>>8&1;this.chipEngine.write(io.OPLL,32+t,r);break}case io.OPNA:{const t=(e<3?0:1)<<2|e%3;this.chipEngine.write(io.OPNA,40,t);break}case io.OPNB:{const t=[1,2,5,6][3&e];this.chipEngine.write(io.OPNB,40,t);break}case io.OPN:{const t=e%3;this.chipEngine.write(io.OPN,40,t);break}case io.OPZ:{const t=7&(this.config.algorithm??0)|(7&(this.config.feedback??0))<<3|1<<7;this.chipEngine.write(io.OPZ,32+(7&e),t);break}case io.Y8950:case io.OPL4:{const t=this.config.chipType,a=e%9,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(t,176+a,n);break}case io.PSG:this.chipEngine.write(io.PSG,0,159|(3&e)<<5);break;case io.AY:this.chipEngine.write(io.AY,8+e,0);break;case io.SAA:this.chipEngine.write(io.SAA,0+e,0),this.chipEngine.write(io.SAA,20,0);break;case io.T6W28:this.chipEngine.write(io.T6W28,0,159|(3&e)<<5),this.chipEngine.write(io.T6W28,1,159|(3&e)<<5);break;case io.NES:if(e<2){const t=16384+4*e;this.chipEngine.write(io.NES,t,48)}else 2===e?this.chipEngine.write(io.NES,16392,0):3===e&&this.chipEngine.write(io.NES,16396,48);break;case io.GB:{const t=16+5*e;e<2?this.chipEngine.write(io.GB,t+2,8):2===e?this.chipEngine.write(io.GB,28,0):3===e&&this.chipEngine.write(io.GB,33,8);break}case io.PCE:this.chipEngine.write(io.PCE,0,7&e),this.chipEngine.write(io.PCE,5,0);break;case io.SNES:this.chipEngine.write(io.SNES,92,1<<(7&e));break;case io.VB:{const t=1024+64*e;this.chipEngine.write(io.VB,t+16,0);break}case io.LYNX:{const t=32+8*e;this.chipEngine.write(io.LYNX,t+0,0);break}case io.VRC6:if(e<2){const t=0===e?36864:40960;this.chipEngine.write(io.VRC6,t,0)}else this.chipEngine.write(io.VRC6,45056,0);break;case io.N163:this.chipEngine.write(io.N163,127,0);break;case io.FDS:this.chipEngine.write(io.FDS,16512,128);break;case io.MMC5:{const t=0===e?20480:20484;this.chipEngine.write(io.MMC5,t,48);break}case io.SCC:this.chipEngine.write(io.SCC,170+e,0);break;case io.SWAN:this.chipEngine.write(io.SWAN,8+e,0);break;case io.VERA:{const t=4*e;this.chipEngine.write(io.VERA,t+2,0);break}case io.SM8521:{const t=[66,68,74][e]||66;this.chipEngine.write(io.SM8521,t,0);break}case io.BUBBLE:this.chipEngine.write(io.BUBBLE,2+e,0);break;case io.X1_010:{const t=e<<3;this.chipEngine.write(io.X1_010,t,0);break}case io.SID:{const t=0,a=e*64;this.chipEngine.write(io.SID,a+t,0);break}case io.SID_6581:case io.SID_8580:{const t=7*e,a=45===this.config.chipType?io.SID_6581:io.SID_8580;this.chipEngine.write(a,t+4,0);break}case io.TIA:this.chipEngine.write(io.TIA,25+e,0);break;case io.VIC:this.chipEngine.write(io.VIC,10+e,0);break;case io.TED:this.chipEngine.write(io.TED,17,0);break;case io.SUPERVISION:{const t=16+4*e;this.chipEngine.write(io.SUPERVISION,t+2,0);break}case io.UPD1771:this.chipEngine.write(io.UPD1771,0,0);break;case io.YMZ280B:{const t=4*e;this.chipEngine.write(io.YMZ280B,1+t,64);break}case io.RF5C68:this.chipEngine.write(io.RF5C68,8,255);break;case io.GA20:{const t=8*e;this.chipEngine.write(io.GA20,t+5,0),this.chipEngine.write(io.GA20,t+6,0);break}case io.SEGAPCM:{const t=8*(15&e);this.chipEngine.write(io.SEGAPCM,134+t,0);break}case io.K007232:this.chipEngine.write(io.K007232,12,0);break;case io.K053260:this.chipEngine.write(io.K053260,40,0);break;case io.QSOUND:{const t=e%16,a=t<8?6+8*t:70+8*(t-8);this.chipEngine.write(io.QSOUND,0,0),this.chipEngine.write(io.QSOUND,1,0),this.chipEngine.write(io.QSOUND,2,a);break}case io.C140:{const t=16*(e%24);this.chipEngine.write(io.C140,t+5,0);break}case io.ES5506:case io.OKI:break;case io.OPNB_B:{const t=[1,2,5,6][3&e];this.chipEngine.write(io.OPNB_B,40,t);break}case io.ESFM:{const t=e%9,a=e<9?0:256,n=(7&this._oplBlock)<<2|this._oplFnum>>8&3;this.chipEngine.write(io.ESFM,a|176+t,n);break}case io.AY8930:this.chipEngine.write(io.AY8930,8+e,0);break;case io.NDS:{const t=16*e;this.chipEngine.write(io.NDS,t+3,0);break}case io.GBA_DMA:this.chipEngine.write(io.GBA_DMA,132,0);break;case io.GBA_MINMOD:this.chipEngine.write(io.GBA_MINMOD,132,0);break;case io.POKEMINI:this.chipEngine.write(io.POKEMINI,113,0);break;case io.NAMCO:{const t=8*e;this.chipEngine.write(io.NAMCO,21+t,0);break}case io.PET:this.chipEngine.write(io.PET,0,0);break;case io.POKEY:this.chipEngine.write(io.POKEY,2*e+1,0);break;case io.MSM6258:this.chipEngine.write(io.MSM6258,0,1);break;case io.MSM5232:{const t=10+e;this.chipEngine.write(io.MSM5232,t,0);break}case io.MULTIPCM:{const t=8*e;this.chipEngine.write(io.MULTIPCM,t+5,0);break}case io.AMIGA:this.chipEngine.write(io.AMIGA,150,1<<e);break;case io.PCSPKR:this.chipEngine.write(io.PCSPKR,97,0);break;case io.PONG:break;case io.PV1000:this.chipEngine.write(io.PV1000,252+e,0);break;case io.DAVE:{const t=8+3*e+2;this.chipEngine.write(io.DAVE,t,0);break}case io.SU:{const t=e<<5;this.chipEngine.write(io.SU,t+2,0);break}case io.BIFURCATOR:break;case io.POWERNOISE:{const t=4*e;this.chipEngine.write(io.POWERNOISE,t,0);break}case io.ZXBEEPER:case io.ZXBEEPER_QT:break;case io.SCVTONE:this.chipEngine.write(io.SCVTONE,e,0);break;case io.PCMDAC:this.chipEngine.write(io.PCMDAC,0,128)}}dispose(){this.output.disconnect()}}function vo(e){switch(e){case So.GENESIS:case So.GENESIS_EXT:case So.YM2151:case So.YM2612:case So.YM2203:case So.YM2203_EXT:case So.YM2608:case So.YM2608_EXT:case So.YM2610:case So.YM2610_EXT:case So.YM2610B:case So.YM2610B_EXT:case So.ARCADE:case So.TX81Z:case So.OPL:case So.OPL2:case So.OPL3:case So.OPL4:case So.OPLL:case So.VRC7:case So.ESFM:return"fm";case So.AY8910:case So.AY8930:case So.SMS:case So.SAA1099:case So.T6W28:return"psg";case So.C64_6581:case So.C64_8580:case So.SID2:case So.SID3:return"c64";case So.SNES:return"snes";case So.GB:return"gb";case So.NES:case So.NES_VRC7:case So.NES_FDS:case So.VRC6:case So.MMC5:case So.FDS:return"nes";case So.PCE:return"pce";case So.NAMCO:case So.NAMCO_15XX:case So.NAMCO_CUS30:case So.N163:return"namco";case So.AMIGA:case So.SEGAPCM:case So.QSOUND:case So.MULTIPCM:case So.RF5C68:case So.MSM6295:case So.MSM6258:case So.YMZ280B:case So.K007232:case So.K053260:case So.GA20:case So.C140:case So.ES5506:return"sample";default:return"other"}}class xo{platformType;family;effectMemory=new Map;constructor(e=So.GB){this.platformType=e,this.family=vo(e)}setPlatform(e){this.platformType=e,this.family=vo(e)}getMemory(e,t){const a=this.effectMemory.get(e);return a?a.get(t)??0:0}setMemory(e,t,a){this.effectMemory.has(e)||this.effectMemory.set(e,new Map),this.effectMemory.get(e).set(t,a)}resetMemory(){this.effectMemory.clear()}routeEffect(e,t,a,n){e!==this.platformType&&this.setPlatform(e);const s=[];0===n?n=this.getMemory(t,a):this.setMemory(t,a,n);const r=n>>4&15,i=15&n;switch(a){case 0:0!==n&&s.push({cmd:No.NOTE_PORTA,chan:t,val1:r,val2:i});break;case 1:s.push({cmd:No.PITCH,chan:t,val1:n,val2:0});break;case 2:s.push({cmd:No.PITCH,chan:t,val1:-n,val2:0});break;case 3:s.push({cmd:No.NOTE_PORTA,chan:t,val1:n,val2:1});break;case 4:s.push({cmd:No.HINT_VIBRATO,chan:t,val1:r,val2:i});break;case 7:s.push({cmd:No.HINT_TREMOLO,chan:t,val1:r,val2:i});break;case 8:s.push({cmd:No.PANNING,chan:t,val1:n,val2:n});break;case 10:s.push({cmd:No.HINT_VOL_SLIDE,chan:t,val1:r,val2:i});break;case 12:s.push({cmd:No.VOLUME,chan:t,val1:n,val2:0});break;case 14:s.push(...this.routeExtendedEffect(this.platformType,t,r,i));break;default:s.push(...this.routePlatformEffect(this.platformType,t,a,n))}return s}routeExtendedEffect(e,t,a,n){e!==this.platformType&&this.setPlatform(e);const s=[];switch(a){case 1:s.push({cmd:No.PITCH,chan:t,val1:n,val2:0});break;case 2:s.push({cmd:No.PITCH,chan:t,val1:-n,val2:0});break;case 3:s.push({cmd:No.LEGATO,chan:t,val1:n,val2:0});break;case 4:s.push({cmd:No.HINT_VIBRATO_SHAPE,chan:t,val1:n,val2:0});break;case 5:s.push({cmd:No.PITCH,chan:t,val1:n-8,val2:1});break;case 9:s.push({cmd:No.NOTE_ON,chan:t,val1:-1,val2:n});break;case 10:s.push({cmd:No.HINT_VOL_SLIDE,chan:t,val1:n,val2:0});break;case 11:s.push({cmd:No.HINT_VOL_SLIDE,chan:t,val1:0,val2:n});break;case 12:s.push({cmd:No.NOTE_OFF,chan:t,val1:n,val2:0});break;case 13:s.push({cmd:No.PRE_NOTE,chan:t,val1:n,val2:0});break;case 15:s.push({cmd:No.MACRO_ON,chan:t,val1:n,val2:0})}return s.push(...this.routePlatformExtendedEffect(this.platformType,t,a,n)),s}routePlatformEffect(e,t,a,n){e!==this.platformType&&this.setPlatform(e);const s=[];switch(this.family){case"fm":s.push(...this.routeFMEffect(t,a,n));break;case"c64":s.push(...this.routeC64Effect(t,a,n));break;case"snes":s.push(...this.routeSNESEffect(t,a,n));break;case"gb":s.push(...this.routeGBEffect(t,a,n));break;case"nes":s.push(...this.routeNESEffect(t,a,n));break;case"pce":s.push(...this.routePCEEffect(t,a,n));break;case"psg":s.push(...this.routePSGEffect(t,a,n));break;case"namco":s.push(...this.routeNamcoEffect(t,a,n));break;case"sample":s.push(...this.routeSampleEffect(t,a,n))}return s}routePlatformExtendedEffect(e,t,a,n){const s=[];switch(e!==this.platformType&&this.setPlatform(e),this.family){case"gb":6===a&&s.push({cmd:No.GB_SWEEP_TIME,chan:t,val1:n,val2:0});break;case"nes":6===a&&s.push({cmd:No.NES_SWEEP,chan:t,val1:n,val2:0});break;case"c64":6===a&&s.push({cmd:No.C64_FILTER_MODE,chan:t,val1:n,val2:0})}return s}routeFMEffect(e,t,a){const n=[],s=a>>4&15,r=15&a;switch(t){case 16:n.push({cmd:No.FM_LFO,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:No.FM_TL,chan:e,val1:s,val2:8*r});break;case 18:n.push({cmd:No.FM_AR,chan:e,val1:s,val2:2*r});break;case 19:n.push({cmd:No.FM_DR,chan:e,val1:s,val2:2*r});break;case 20:n.push({cmd:No.FM_MULT,chan:e,val1:s,val2:r});break;case 21:n.push({cmd:No.FM_RR,chan:e,val1:s,val2:r});break;case 22:n.push({cmd:No.FM_SL,chan:e,val1:s,val2:r});break;case 23:n.push({cmd:No.FM_DT,chan:e,val1:s,val2:r});break;case 24:n.push({cmd:No.FM_FB,chan:e,val1:a>>4,val2:0});break;case 25:n.push({cmd:No.FM_FB,chan:e,val1:0,val2:7&a});break;case 26:n.push({cmd:No.FM_SSG,chan:e,val1:s,val2:r});break;case 27:n.push({cmd:No.FM_AM_DEPTH,chan:e,val1:s,val2:0}),n.push({cmd:No.FM_PM_DEPTH,chan:e,val1:r,val2:0});break;case 31:n.push({cmd:No.FM_HARD_RESET,chan:e,val1:a,val2:0})}return n}routeC64Effect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:No.C64_CUTOFF,chan:e,val1:8*a,val2:0});break;case 17:n.push({cmd:No.C64_FINE_CUTOFF,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:No.C64_RESONANCE,chan:e,val1:15&a,val2:0});break;case 19:n.push({cmd:No.C64_FILTER_MODE,chan:e,val1:7&a,val2:0});break;case 20:n.push({cmd:No.C64_EXTENDED,chan:e,val1:0,val2:a});break;case 21:n.push({cmd:No.C64_EXTENDED,chan:e,val1:1,val2:a});break;case 22:n.push({cmd:No.C64_DUTY_RESET,chan:e,val1:16*a,val2:0});break;case 23:n.push({cmd:No.C64_FINE_DUTY,chan:e,val1:a,val2:0})}return n}routeSNESEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:No.SNES_ECHO,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:No.SNES_ECHO_DELAY,chan:e,val1:15&a,val2:0});break;case 18:n.push({cmd:No.SNES_ECHO_FEEDBACK,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:No.SNES_ECHO_VOL_LEFT,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:No.SNES_ECHO_VOL_RIGHT,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:No.SNES_ECHO_FIR,chan:e,val1:a,val2:0});break;case 22:n.push({cmd:No.SNES_PITCH_MOD,chan:e,val1:a,val2:0});break;case 23:n.push({cmd:No.SNES_GAIN_MODE,chan:e,val1:a,val2:0});break;case 24:n.push({cmd:No.SNES_GAIN,chan:e,val1:a,val2:0});break;case 25:n.push({cmd:No.SNES_INVERT,chan:e,val1:a,val2:0})}return n}routeGBEffect(e,t,a){const n=[],s=a>>4&15,r=15&a;switch(t){case 16:n.push({cmd:No.GB_SWEEP_TIME,chan:e,val1:s,val2:0}),n.push({cmd:No.GB_SWEEP_DIR,chan:e,val1:r>>3,val2:0});break;case 17:n.push({cmd:No.WAVE,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:No.STD_NOISE_MODE,chan:e,val1:a,val2:0})}return n}routeNESEffect(e,t,a){const n=[],s=a>>4&15,r=15&a;switch(t){case 16:n.push({cmd:No.NES_SWEEP,chan:e,val1:s,val2:r});break;case 17:n.push({cmd:No.NES_DMC,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:No.NES_ENV_MODE,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:No.NES_LENGTH,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:No.FDS_MOD_DEPTH,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:No.FDS_MOD_HIGH,chan:e,val1:a,val2:0});break;case 22:n.push({cmd:No.FDS_MOD_LOW,chan:e,val1:a,val2:0})}return n}routePCEEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:No.PCE_LFO_MODE,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:No.PCE_LFO_SPEED,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:No.WAVE,chan:e,val1:a,val2:0})}return n}routePSGEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:No.AY_ENVELOPE_SET,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:No.AY_ENVELOPE_LOW,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:No.AY_ENVELOPE_HIGH,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:No.AY_AUTO_ENVELOPE,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:No.STD_NOISE_FREQ,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:No.STD_NOISE_MODE,chan:e,val1:a,val2:0})}return n}routeNamcoEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:No.WAVE,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:No.N163_WAVE_POSITION,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:No.N163_WAVE_LENGTH,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:No.N163_WAVE_LOADPOS,chan:e,val1:a,val2:0});break;case 20:n.push({cmd:No.N163_CHANNEL_LIMIT,chan:e,val1:a,val2:0})}return n}routeSampleEffect(e,t,a){const n=[];switch(t){case 16:n.push({cmd:No.SAMPLE_MODE,chan:e,val1:a,val2:0});break;case 17:n.push({cmd:No.SAMPLE_BANK,chan:e,val1:a,val2:0});break;case 18:n.push({cmd:No.SAMPLE_DIR,chan:e,val1:a,val2:0});break;case 19:n.push({cmd:No.SAMPLE_POS,chan:e,val1:a<<8,val2:0});break;case 20:n.push({cmd:No.ES5506_FILTER_MODE,chan:e,val1:a,val2:0});break;case 21:n.push({cmd:No.ES5506_FILTER_K1,chan:e,val1:a<<8,val2:65280});break;case 22:n.push({cmd:No.ES5506_FILTER_K2,chan:e,val1:a<<8,val2:65280});break;case 23:n.push({cmd:No.QSOUND_ECHO_FEEDBACK,chan:e,val1:a,val2:0});break;case 24:n.push({cmd:No.QSOUND_ECHO_LEVEL,chan:e,val1:a,val2:0});break;case 25:n.push({cmd:No.QSOUND_SURROUND,chan:e,val1:a,val2:0})}return n}clearMemory(){this.effectMemory.clear()}clearChannelMemory(e){this.effectMemory.delete(e)}}let wo=null;function ko(){return wo||(wo=new xo),wo}new Proxy({},{get:(e,t)=>ko()[t],set:(e,t,a)=>(ko()[t]=a,!0)});const So={GENESIS:2,GENESIS_EXT:3,ARCADE:13,NES_VRC7:9,NES_FDS:10,SMS:4,GB:6,PCE:7,NES:8,SNES:26,SWAN:43,LYNX:60,VBOY:47,NDS:103,POKEMINI:45,TIA:21,POKEY:41,C64_6581:11,C64_8580:12,PET:25,VIC20:24,TED:97,FDS:29,MMC5:30,N163:31,VRC6:27,VRC7:48,AY:17,AY8910:17,AY8930:23,SAA1099:22,T6W28:83,YM2612:20,YM2151:19,TX81Z:44,YM2203:32,YM2203_EXT:33,YM2608:34,YM2608_EXT:35,YM2610:57,YM2610_EXT:58,YM2610B:49,YM2610B_EXT:63,OPL:36,OPL2:37,OPL3:38,OPL4:67,OPLL:28,ESFM:100,AMIGA:18,SEGAPCM:46,SEGAPCM_COMPAT:64,MULTIPCM:39,QSOUND:61,RF5C68:42,PCM_DAC:86,ES5506:69,K007232:84,K053260:96,GA20:85,C140:98,C219:99,YMZ280B:76,MSM6258:75,MSM6295:74,SCC:53,SCC_PLUS:72,NAMCO:77,NAMCO_15XX:78,NAMCO_CUS30:79,BUBSYS_WSG:66,X1_010:65,VERA:62,SOUND_UNIT:73,PCSPKR:40,PONG:87,PV1000:95,MSM5232:82,SM8521:94,DAVE:102,POWERNOISE:101,SFX_BEEPER:50,GBA_DMA:104,GBA_MINMOD:105,SID2:108,SID3:111,SUPERVISION:109,UPD1771C:110},Mo=10,No={NOTE_ON:0,NOTE_OFF:1,INSTRUMENT:4,VOLUME:5,NOTE_PORTA:8,PITCH:9,PANNING:10,LEGATO:11,PRE_NOTE:13,HINT_VIBRATO:14,HINT_VIBRATO_SHAPE:16,HINT_VOL_SLIDE:20,HINT_TREMOLO:24,SAMPLE_MODE:28,SAMPLE_BANK:30,SAMPLE_POS:31,SAMPLE_DIR:32,FM_HARD_RESET:33,FM_LFO:34,FM_TL:36,FM_AR:38,FM_DR:39,FM_SL:40,FM_RR:42,FM_DT:43,FM_SSG:50,FM_FB:53,FM_MULT:54,FM_AM_DEPTH:58,FM_PM_DEPTH:59,STD_NOISE_FREQ:62,STD_NOISE_MODE:63,WAVE:64,GB_SWEEP_TIME:65,GB_SWEEP_DIR:66,PCE_LFO_MODE:67,PCE_LFO_SPEED:68,NES_SWEEP:69,NES_DMC:70,C64_CUTOFF:71,C64_RESONANCE:72,C64_FILTER_MODE:73,C64_DUTY_RESET:77,C64_EXTENDED:78,C64_FINE_DUTY:79,C64_FINE_CUTOFF:80,AY_ENVELOPE_SET:81,AY_ENVELOPE_LOW:82,AY_ENVELOPE_HIGH:83,AY_AUTO_ENVELOPE:87,FDS_MOD_DEPTH:90,FDS_MOD_HIGH:91,FDS_MOD_LOW:92,QSOUND_ECHO_FEEDBACK:100,QSOUND_ECHO_LEVEL:102,QSOUND_SURROUND:103,N163_WAVE_POSITION:113,N163_WAVE_LENGTH:114,N163_WAVE_LOADPOS:117,N163_CHANNEL_LIMIT:120,SNES_ECHO:132,SNES_PITCH_MOD:133,SNES_INVERT:134,SNES_GAIN_MODE:135,SNES_GAIN:136,SNES_ECHO_DELAY:138,SNES_ECHO_VOL_LEFT:139,SNES_ECHO_VOL_RIGHT:140,SNES_ECHO_FEEDBACK:141,SNES_ECHO_FIR:142,NES_ENV_MODE:143,NES_LENGTH:144,MACRO_ON:147,ES5506_FILTER_MODE:151,ES5506_FILTER_K1:152,ES5506_FILTER_K2:153},Co=1;class Po{static instance=null;workletNode=null;_nativeCtx=null;initialized=!1;initializing=!1;chips=new Map;_audioRouted=!1;_sharedGain=null;_wasmReadyResolve=null;_wasmReadyReject=null;_wasmReadyPromise=null;_chipCreatedResolve=null;_chipCreatedPromise=null;oscCallbacks=new Set;latestOscData=[];static wasmBinary=null;static jsCode=null;static loadedContexts=new WeakSet;static initPromises=new WeakMap;effectRouter=new xo;constructor(){}static getInstance(){return Po.instance||(Po.instance=new Po),Po.instance}get isInitialized(){return this.initialized}getChannelCount(e){return void 0!==e?this.chips.get(e)?.numChannels??0:this.chips.values().next().value?.numChannels??0}get channelCount(){return this.getChannelCount()}get platform(){return this.chips.keys().next().value??0}get handle(){return this.chips.values().next().value?.handle??0}hasChip(e){return this.chips.has(e)}get audioRouted(){return this._audioRouted}getOrCreateSharedGain(){if(this._sharedGain)return this._sharedGain;const e=this.getWorkletNode(),t=this.getNativeCtx();return e&&t?(this._sharedGain=t.createGain(),e.connect(this._sharedGain),this._sharedGain.connect(t.destination),this._audioRouted=!0,this._sharedGain):null}async init(e){if(!this.initialized&&!this.initializing){this.initializing=!0;try{const n=ds(e);if(!n)throw new Error("Could not get native AudioContext");if(this._nativeCtx=n,"running"!==n.state)try{await n.resume()}catch(t){throw new Error(`AudioContext not running (state: ${n.state})`)}if("running"!==n.state)throw new Error(`AudioContext still not running after resume (state: ${n.state})`);await Po.ensureModuleLoaded(n);try{this.workletNode=new AudioWorkletNode(n,"furnace-dispatch-processor",{outputChannelCount:[2],processorOptions:{sampleRate:n.sampleRate}})}catch(a){throw a}this.workletNode.port.onmessage=e=>{this.handleWorkletMessage(e.data)},this._wasmReadyPromise=new Promise((e,t)=>{this._wasmReadyResolve=e,this._wasmReadyReject=t,setTimeout(()=>t(new Error("FurnaceDispatch WASM ready timeout after 10s")),1e4)}),this.workletNode.port.postMessage({type:"init",sampleRate:n.sampleRate,wasmBinary:Po.wasmBinary,jsCode:Po.jsCode}),await this._wasmReadyPromise;try{const e=n.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(n.destination)}catch(t){}this.initialized=!0}catch(n){throw n}finally{this.initializing=!1}}}static async ensureModuleLoaded(e){if(this.loadedContexts.has(e))return;const t=this.initPromises.get(e);if(t)return t;const a=(async()=>{const t="/DEViLBOX/",a=`?v=${Date.now()}`;if("running"!==e.state)try{await e.resume()}catch(n){}try{await e.audioWorklet.addModule(`${t}furnace-dispatch/FurnaceDispatch.worklet.js${a}`)}catch(n){const e=n instanceof Error?n.message:String(n),t=n instanceof Error?n.name:"";if(!e.includes("already")&&!e.includes("duplicate")&&"InvalidStateError"!==t)throw new Error(`Failed to load FurnaceDispatch worklet: ${e}`)}if(!this.wasmBinary||!this.jsCode){const[e,n]=await Promise.all([fetch(`${t}furnace-dispatch/FurnaceDispatch.wasm${a}`,{cache:"no-store"}),fetch(`${t}furnace-dispatch/FurnaceDispatch.js${a}`,{cache:"no-store"})]);if(e.ok&&(this.wasmBinary=await e.arrayBuffer()),n.ok){let e=await n.text();e='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+e.replace(/import\.meta\.url/g,"'.'").replace(/export\s+default\s+\w+;?/g,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),e+="\nvar createFurnaceDispatch = createFurnaceDispatch || Module;",this.jsCode=e}}this.loadedContexts.add(e)})();return this.initPromises.set(e,a),a}handleWorkletMessage(e){switch(e.type){case"ready":this._wasmReadyResolve&&(this._wasmReadyResolve(),this._wasmReadyResolve=null);break;case"chipCreated":{this.chips.set(e.platformType,{handle:e.handle,numChannels:e.numChannels});let t=0;for(const e of this.chips.values())t+=e.numChannels;this.latestOscData=new Array(t).fill(null),this._chipCreatedResolve&&(this._chipCreatedResolve(),this._chipCreatedResolve=null);break}case"oscData":this.latestOscData=e.channels;for(const t of this.oscCallbacks)t(e.channels);break;case"error":this._wasmReadyReject&&(this._wasmReadyReject(new Error(e.message)),this._wasmReadyReject=null,this._wasmReadyResolve=null)}}async createChip(e,t){this._nativeCtx&&await Po.ensureModuleLoaded(this._nativeCtx),this.workletNode&&(this._chipCreatedPromise=new Promise(e=>{this._chipCreatedResolve=e}),this.workletNode.port.postMessage({type:"createChip",platformType:e,sampleRate:t}))}async waitForChipCreated(){this._chipCreatedPromise&&await this._chipCreatedPromise}dispatch(e,t,a=0,n=0,s){this.workletNode&&this.workletNode.port.postMessage({type:"dispatch",cmd:e,chan:t,val1:a,val2:n,platformType:s})}noteOn(e,t,a){this.dispatch(No.NOTE_ON,e,t,0,a)}noteOff(e,t){this.dispatch(No.NOTE_OFF,e,0,0,t)}setInstrument(e,t,a,n=!1){this.dispatch(No.INSTRUMENT,e,t,n?1:0,a)}setVolume(e,t,a){this.dispatch(No.VOLUME,e,t,0,a)}setGBInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setGBInstrument",insIndex:e,insData:t,platformType:a})}setWavetable(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setWavetable",waveIndex:e,waveData:t,platformType:a})}setFMInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setFMInstrument",insIndex:e,insData:t,platformType:a})}setC64Instrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setC64Instrument",insIndex:e,insData:t,platformType:a})}setNESInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setNESInstrument",insIndex:e,insData:t,platformType:a})}setSNESInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setSNESInstrument",insIndex:e,insData:t,platformType:a})}setN163Instrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setN163Instrument",insIndex:e,insData:t,platformType:a})}setFDSInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setFDSInstrument",insIndex:e,insData:t,platformType:a})}uploadFurnaceInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:a})}setAmigaInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setAmigaInstrument",insIndex:e,insData:t,platformType:a})}setMultiPCMInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setMultiPCMInstrument",insIndex:e,insData:t,platformType:a})}setES5506Instrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setES5506Instrument",insIndex:e,insData:t,platformType:a})}setESFMInstrument(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setESFMInstrument",insIndex:e,insData:t,platformType:a})}setWaveSynth(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setWaveSynth",insIndex:e,insData:t,platformType:a})}setMacro(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setMacro",insIndex:e,macroData:t,platformType:a})}setInstrumentFull(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setInstrumentFull",insIndex:e,insData:t,platformType:a})}setSample(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setSample",sampleIndex:e,sampleData:t,platformType:a})}renderSamples(e){this.workletNode&&this.workletNode.port.postMessage({type:"renderSamples",platformType:e})}setMacrosEnabled(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"setMacrosEnabled",enabled:e,platformType:t})}clearMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"clearMacros",insIndex:e,platformType:t})}releaseMacros(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"releaseMacros",chan:e,platformType:t})}setCompatFlags(e,t){if(!this.workletNode)return;const a=new Uint8Array(57);a[0]=e.limitSlides?1:0,a[1]=e.linearPitch??2,a[2]=e.pitchSlideSpeed??0,a[3]=e.loopModality??0,a[4]=e.delayBehavior??0,a[5]=e.jumpTreatment??0,a[6]=e.properNoiseLayout?1:0,a[7]=e.waveDutyIsVol?1:0,a[8]=e.resetMacroOnPorta?1:0,a[9]=e.legacyVolumeSlides?1:0,a[10]=e.compatibleArpeggio?1:0,a[11]=e.noteOffResetsSlides?1:0,a[12]=e.targetResetsSlides?1:0,a[13]=e.arpNonPorta?1:0,a[14]=e.algMacroBehavior?1:0,a[15]=e.brokenShortcutSlides?1:0,a[16]=e.ignoreDuplicateSlides?1:0,a[17]=e.stopPortaOnNoteOff?1:0,a[18]=e.continuousVibrato?1:0,a[19]=e.brokenDACMode?1:0,a[20]=e.oneTickCut?1:0,a[21]=e.newInsTriggersInPorta?1:0,a[22]=e.arp0Reset?1:0,a[23]=e.brokenSpeedSel?1:0,a[24]=e.noSlidesOnFirstTick?1:0,a[25]=e.rowResetsArpPos?1:0,a[26]=e.ignoreJumpAtEnd?1:0,a[27]=e.buggyPortaAfterSlide?1:0,a[28]=e.gbInsAffectsEnvelope?1:0,a[29]=e.sharedExtStat?1:0,a[30]=e.ignoreDACModeOutsideChannel?1:0,a[31]=e.e1e2AlsoTakePriority?1:0,a[32]=e.newSegaPCM?1:0,a[33]=e.fbPortaPause?1:0,a[34]=e.snDutyReset?1:0,a[35]=e.pitchMacroIsLinear?1:0,a[36]=e.oldOctaveBoundary?1:0,a[37]=e.noOPN2Vol?1:0,a[38]=e.newVolumeScaling?1:0,a[39]=e.volMacroLinger?1:0,a[40]=e.brokenOutVol?1:0,a[41]=e.brokenOutVol2?1:0,a[42]=e.e1e2StopOnSameNote?1:0,a[43]=e.brokenPortaArp?1:0,a[44]=e.snNoLowPeriods?1:0,a[45]=e.disableSampleMacro?1:0,a[46]=e.oldArpStrategy?1:0,a[47]=e.brokenPortaLegato?1:0,a[48]=e.brokenFMOff?1:0,a[49]=e.preNoteNoEffect?1:0,a[50]=e.oldDPCM?1:0,a[51]=e.resetArpPhaseOnNewNote?1:0,a[52]=e.ceilVolumeScaling?1:0,a[53]=e.oldAlwaysSetVolume?1:0,a[54]=e.oldSampleOffset?1:0,a[55]=e.oldCenterRate?1:0,a[56]=e.noVolSlideReset?1:0,this.workletNode.port.postMessage({type:"setCompatFlags",flags:a,platformType:t})}setCompatFlag(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"setCompatFlag",flagIndex:e,value:t,platformType:a})}resetCompatFlags(e){this.workletNode&&this.workletNode.port.postMessage({type:"resetCompatFlags",platformType:e})}setLinearPitch(e,t){this.setCompatFlag(Co,e,t)}setTickRate(e){this.workletNode&&this.workletNode.port.postMessage({type:"setTickRate",hz:e})}reset(e){this.workletNode&&this.workletNode.port.postMessage({type:"reset",platformType:e})}forceIns(e){this.workletNode&&this.workletNode.port.postMessage({type:"forceIns",platformType:e})}mute(e,t,a){this.workletNode&&this.workletNode.port.postMessage({type:"mute",chan:e,mute:t,platformType:a})}onOscData(e){return this.oscCallbacks.add(e),()=>{this.oscCallbacks.delete(e)}}getOscData(){return this.latestOscData}getWorkletNode(){return this.workletNode}getNativeCtx(){return this._nativeCtx}dispatchFM(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchC64(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchSNES(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchGB(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchNES(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchAY(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchES5506(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchN163(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchSample(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}dispatchMacro(e,t,a){this.dispatch(t.cmd,e,t.val1,t.val2,a)}applyEffect(e,t,a,n){const s=n??this.platform,r=this.effectRouter.routeEffect(s,e,t,a);for(const i of r)this.dispatch(i.cmd,i.chan,i.val1,i.val2,n)}applyExtendedEffect(e,t,a,n){const s=n??this.platform,r=this.effectRouter.routeExtendedEffect(s,e,t,a);for(const i of r)this.dispatch(i.cmd,i.chan,i.val1,i.val2,n)}applyPlatformEffect(e,t,a,n){const s=n??this.platform,r=this.effectRouter.routePlatformEffect(s,e,t,a);for(const i of r)this.dispatch(i.cmd,i.chan,i.val1,i.val2,n)}resetEffectMemory(){this.effectRouter.resetMemory()}getEffectRouter(){return this.effectRouter}dispose(){if(this.workletNode&&(this.workletNode.port.postMessage({type:"dispose"}),this.workletNode.disconnect(),this.workletNode=null),this.initialized=!1,this.chips.clear(),this._audioRouted=!1,this._sharedGain){try{this._sharedGain.disconnect()}catch{}this._sharedGain=null}this.oscCallbacks.clear(),this.latestOscData=[],Po.instance=null}}const Eo=n(e=>({channelData:[],numChannels:0,platformType:0,isActive:!1,updateChannelData:t=>e({channelData:t,isActive:!0}),setChipInfo:(t,a)=>e({numChannels:t,platformType:a,channelData:new Array(t).fill(null)}),clear:()=>e({channelData:[],numChannels:0,platformType:0,isActive:!1})})),_o=new Set([0,1,13,14,19,32,33,55]);class To{buffer=[];writeUint8(e){this.buffer.push(255&e)}writeUint16(e){this.buffer.push(255&e),this.buffer.push(e>>8&255)}writeUint32(e){this.buffer.push(255&e),this.buffer.push(e>>8&255),this.buffer.push(e>>16&255),this.buffer.push(e>>24&255)}writeInt32(e){this.writeUint32(e)}writeInt8(e){this.writeUint8(e<0?e+256:e)}getPosition(){return this.buffer.length}patchUint32(e,t){this.buffer[e]=255&t,this.buffer[e+1]=t>>8&255,this.buffer[e+2]=t>>16&255,this.buffer[e+3]=t>>24&255}toUint8Array(){return new Uint8Array(this.buffer)}}function Ao(e){return void 0===e?0:"number"==typeof e?255&e:e?1:0}function Oo(e,t="Instrument"){const a=new To;a.writeUint8(240),a.writeUint8(177),a.writeUint8(1);const n=function(e){return e.c64?3:e.gb?2:e.n163?17:e.fds?15:e.snes?29:e.esfm?55:e.chipType}(e);a.writeUint8(n);const s=a.getPosition();a.writeUint32(0),a.writeUint32(0),a.writeUint32(0),a.writeUint32(0),a.writeUint32(0),a.writeUint32(0);const r=(new TextEncoder).encode(t);a.writeUint32(r.length);for(const d of r)a.writeUint8(d);let i=0;if(_o.has(e.chipType)&&e.operators&&e.operators.length>0){i=a.getPosition(),a.writeUint8(e.algorithm||0),a.writeUint8(e.feedback||0),a.writeUint8(e.fms||0),a.writeUint8(e.ams||0),a.writeUint8(e.fms2||0),a.writeUint8(e.ams2||0),a.writeUint8(e.ops||4),a.writeUint8(e.opllPreset||0);for(let t=0;t<4;t++)if(t<e.operators.length){const n=e.operators[t];a.writeUint8(n.enabled?1:0),a.writeUint8(Ao(n.am)),a.writeUint8(n.ar||0),a.writeUint8(n.dr||0),a.writeUint8(n.mult||0),a.writeUint8(n.rr||0),a.writeUint8(n.sl||0),a.writeUint8(n.tl||0),a.writeUint8(n.dt2||0),a.writeUint8(n.rs||0),a.writeInt8(n.dt||0),a.writeUint8(n.d2r||0),a.writeUint8(n.ssg||0),a.writeUint8(Ao(n.dam)),a.writeUint8(Ao(n.dvb)),a.writeUint8(Ao(n.egt)),a.writeUint8(n.ksl||0),a.writeUint8(Ao(n.sus)),a.writeUint8(Ao(n.vib)),a.writeUint8(n.ws||0),a.writeUint8(Ao(n.ksr)),a.writeUint8(n.kvs||0),a.writeUint8(0),a.writeUint8(0)}else for(let e=0;e<24;e++)a.writeUint8(0)}let o=0;if(e.macros&&e.macros.length>0){o=a.getPosition();const t=new Array(15).fill(null);for(const a of e.macros){const e=a.code??a.type;void 0!==e&&e>=0&&e<15&&(t[e]=a)}for(let e=0;e<15;e++){const n=t[e];if(n&&n.data&&n.data.length>0){a.writeUint8(n.data.length),a.writeUint8(n.delay??0),a.writeUint8(n.speed??1),a.writeUint8(void 0!==n.loop?n.loop:255),a.writeUint8(void 0!==n.release?n.release:255),a.writeUint8(n.mode??0),a.writeUint8(n.open?1:0);for(const e of n.data)a.writeInt32(e)}else for(let e=0;e<7;e++)a.writeUint8(0)}}let l=0;if(2===n&&e.gb){l=a.getPosition();const t=e.gb;a.writeUint8(t.envVol||0),a.writeUint8(t.envDir||0),a.writeUint8(t.envLen||0),a.writeUint8(t.soundLen||0),a.writeUint8(t.softEnv?1:0),a.writeUint8(t.alwaysInit?1:0),a.writeUint8(0);const n=t.hwSeq?.length??0;if(a.writeUint8(n),t.hwSeq)for(const e of t.hwSeq)a.writeUint8(e.cmd),a.writeUint16(e.data)}if(3===n&&e.c64){l=a.getPosition();const t=e.c64;let n=0;t.triOn&&(n|=1),t.sawOn&&(n|=2),t.pulseOn&&(n|=4),t.noiseOn&&(n|=8),a.writeUint8(n),a.writeUint8(t.a||0),a.writeUint8(t.d||0),a.writeUint8(t.s||0),a.writeUint8(t.r||0),a.writeUint16(t.duty||0),a.writeUint8(t.ringMod?1:0),a.writeUint8(t.oscSync?1:0);let s=0;t.toFilter&&(s|=1),t.initFilter&&(s|=2);"dutyIsAbs"in t&&t.dutyIsAbs&&(s|=4);(t.filterIsAbs??!1)&&(s|=8);(t.noTest??!1)&&(s|=16);(t.resetDuty??!1)&&(s|=32),a.writeUint8(s),a.writeUint8(t.filterResonance??t.filterRes??0),a.writeUint16(t.filterCutoff??0);let r=0;t.filterHP&&(r|=1),t.filterLP&&(r|=2),t.filterBP&&(r|=4),t.filterCh3Off&&(r|=8),a.writeUint8(r)}if(17===n&&e.n163){l=a.getPosition();const t=e.n163;a.writeUint32(t.wave||0),a.writeUint32(t.wavePos||0),a.writeUint32(t.waveLen||0),a.writeUint8(t.waveMode||0),a.writeUint8(t.perChPos?1:0)}if(15===n&&e.fds){l=a.getPosition();const t=e.fds;a.writeUint32(t.modSpeed||0),a.writeUint32(t.modDepth||0),a.writeUint8(t.initModTableWithFirstWave?1:0);const n=t.modTable||[];for(let e=0;e<32;e++)a.writeInt8(e<n.length?n[e]:0)}if(29===n&&e.snes){l=a.getPosition();const t=e.snes;a.writeUint8(t.useEnv?1:0),a.writeUint8(t.sus??0),a.writeUint8("number"==typeof t.gainMode?t.gainMode:0),a.writeUint8(t.gain||0),a.writeUint8(t.a||0),a.writeUint8(t.d||0),a.writeUint8(t.s||0),a.writeUint8(t.r||0),a.writeUint8(t.d2??0)}let c=0;if(e.amiga){c=a.getPosition();const t=e.amiga;a.writeUint16(t.initSample??-1);let n=0;if(t.useNoteMap&&(n|=1),t.useSample&&(n|=2),t.useWave&&(n|=4),a.writeUint8(n),a.writeUint8(t.waveLen||0),t.useNoteMap&&t.noteMap)for(let e=0;e<120;e++)if(e<t.noteMap.length){const n=t.noteMap[e];a.writeUint32(n.frequency||0),a.writeUint16(n.sample??-1),a.writeInt8(0),a.writeInt8(0)}else for(let t=0;t<8;t++)a.writeUint8(0)}const u=a.getPosition();return a.patchUint32(s,u),a.patchUint32(s+4,i),a.patchUint32(s+8,o),a.patchUint32(s+12,l),a.patchUint32(s+16,c),a.toUint8Array()}const Io=Object.freeze(Object.defineProperty({__proto__:null,encodeFurnaceInstrument:Oo,updateFurnaceInstrument:function(e,t,a){return Oo(e,t)}},Symbol.toStringTag,{value:"Module"})),Fo={[So.GB]:["PU1","PU2","WAV","NOI"],[So.NES]:["PU1","PU2","TRI","NOI","DPCM"],[So.SMS]:["SQ1","SQ2","SQ3","NOI"],[So.AY]:["A","B","C"],[So.AY8930]:["A","B","C"],[So.PCE]:["CH1","CH2","CH3","CH4","CH5","CH6"],[So.SNES]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[So.VRC6]:["PU1","PU2","SAW"],[So.FDS]:["FDS"],[So.MMC5]:["PU1","PU2","PCM"],[So.N163]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[So.C64_6581]:["V1","V2","V3"],[So.C64_8580]:["V1","V2","V3"],[So.VIC20]:["BASS","ALT","SOP","NOI"],[So.SAA1099]:["CH1","CH2","CH3","CH4","CH5","CH6"],[So.TIA]:["AUD0","AUD1"],[So.POKEY]:["CH1","CH2","CH3","CH4"],[So.LYNX]:["CH1","CH2","CH3","CH4"],[So.SWAN]:["CH1","CH2","CH3","CH4"],[So.VERA]:["PU1","PU2","PU3","PU4","PU5","PU6","PU7","PU8","PU9","PU10","PU11","PU12","PU13","PU14","PU15","PU16","PCM"],[So.SCC]:["CH1","CH2","CH3","CH4","CH5"],[So.VBOY]:["CH1","CH2","CH3","CH4","CH5","CH6"],[So.AMIGA]:["CH1","CH2","CH3","CH4"],[So.PET]:["CH"],[So.PCSPKR]:["SPK"],[So.SFX_BEEPER]:["CH1","CH2","CH3","CH4","CH5","CH6"],[So.PONG]:["CH"],[So.TED]:["SQ1","SQ2"],[So.POKEMINI]:["CH"],[So.PV1000]:["CH1","CH2","CH3"],[So.SOUND_UNIT]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[So.NAMCO]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8"],[So.QSOUND]:["CH1","CH2","CH3","CH4","CH5","CH6","CH7","CH8","CH9","CH10","CH11","CH12","CH13","CH14","CH15","CH16"],[So.DAVE]:["CH1","CH2","CH3","NOI"]},Do={[So.GB]:15,[So.SMS]:15,[So.NES]:15,[So.C64_6581]:15,[So.C64_8580]:15,[So.AY]:15,[So.AY8930]:15,[So.SAA1099]:15,[So.SCC]:15,[So.SCC_PLUS]:15,[So.PCE]:31,[So.VIC20]:15,[So.TIA]:15,[So.POKEY]:15,[So.PV1000]:15,[So.POKEMINI]:3,[So.PONG]:1,[So.PCSPKR]:1,[So.SFX_BEEPER]:15,[So.TED]:8,[So.VRC6]:15,[So.MMC5]:15,[So.SWAN]:15,[So.LYNX]:127};function Ro(e){return Do[e]??127}class jo{name="FurnaceDispatchSynth";output;engine;_disposed=!1;_isReady=!1;_isReadyPromise;_resolveReady;currentChannel=0;platformType;activeNotes=new Map;_releaseTimeouts=new Map;_volumeOffsetDb=0;furnaceInstrumentIndex=0;_nativeGain=null;constructor(e=So.GB){this.output=us().createGain(),this.platformType=e,this.engine=Po.getInstance(),this._isReadyPromise=new Promise(e=>{this._resolveReady=e}),this.initialize()}get ready(){return this._isReadyPromise}async ensureInitialized(){return this._isReadyPromise}setFurnaceInstrumentIndex(e){this.furnaceInstrumentIndex=e}async uploadInstrumentFromConfig(e,t){await this.ensureInitialized();const{updateFurnaceInstrument:a}=await ja(async()=>{const{updateFurnaceInstrument:e}=await Promise.resolve().then(()=>Io);return{updateFurnaceInstrument:e}},void 0),n=a(e,t,this.furnaceInstrumentIndex);this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,n,this.platformType);const s=this.engine.getChannelCount(this.platformType)||3;for(let r=0;r<s;r++)this.engine.setInstrument(r,this.furnaceInstrumentIndex,this.platformType,!0)}async uploadInstrumentData(e){e&&0!==e.length&&(await this.ensureInitialized(),this.engine.uploadFurnaceInstrument(this.furnaceInstrumentIndex,e,this.platformType))}setVolumeOffset(e){if(this._volumeOffsetDb=e,this._nativeGain){this._nativeGain.gain.value=Math.pow(10,e/20)}}async initialize(){try{const e=us();if(await this.engine.init(e),this._disposed)return;const t=this.engine.getNativeCtx()?.sampleRate??e.sampleRate;await this.engine.createChip(this.platformType,t),await this.engine.waitForChipCreated();const a=this.engine.getOrCreateSharedGain();a&&(this._nativeGain=a,0!==this._volumeOffsetDb&&(a.gain.value=Math.pow(10,this._volumeOffsetDb/20))),this.setupDefaultInstrument(),this._isReady=!0,this._resolveReady();const n=Eo.getState(),s=this.getChannelNames();n.setChipInfo(s.length,this.platformType),this.engine.onOscData(e=>{Eo.getState().updateChannelData(e)})}catch(e){this._resolveReady()}}setupDefaultInstrument(){const e=So,t=this.platformType,a=this.engine.getChannelCount(t)||4,n=Ro(t),s=(e,a,n=0,s=0)=>this.engine.dispatch(e,a,n,s,t),r=(e,a)=>this.engine.setInstrument(e,a,t),i=(e,a)=>this.engine.setVolume(e,a,t);switch(t){case e.GB:this.setupDefaultGBInstrument();break;case e.C64_6581:case e.C64_8580:this.setupDefaultC64Instrument();break;case e.AY:case e.AY8930:for(let e=0;e<a;e++)s(No.STD_NOISE_MODE,e,0,0);break;case e.SAA1099:for(let e=0;e<a;e++)s(No.STD_NOISE_MODE,e,1,0);break;case e.PCE:this.setupDefaultWavetable(32,31);for(let e=0;e<a;e++)s(No.WAVE,e,0,0);break;case e.SCC:case e.SCC_PLUS:this.setupDefaultWavetable(32,255);for(let e=0;e<a;e++)s(No.WAVE,e,0,0);break;case e.VBOY:this.setupDefaultWavetable(32,63);for(let e=0;e<a;e++)s(No.WAVE,e,0,0);break;case e.NAMCO:case e.NAMCO_15XX:case e.NAMCO_CUS30:case e.BUBSYS_WSG:this.setupDefaultWavetable(32,15);for(let e=0;e<a;e++)s(No.WAVE,e,0,0);break;case e.SWAN:this.setupDefaultWavetable(32,15);for(let e=0;e<a;e++)s(No.WAVE,e,0,0);break;case e.FDS:this.setupDefaultWavetable(64,63),s(No.WAVE,0,0,0);break;case e.N163:this.setupDefaultWavetable(32,15);for(let e=0;e<a;e++)s(No.WAVE,e,0,0);break;case e.X1_010:case e.SOUND_UNIT:this.setupDefaultWavetable(32,255);for(let e=0;e<a;e++)s(No.WAVE,e,0,0);break;case e.AMIGA:case e.SEGAPCM:case e.SEGAPCM_COMPAT:case e.K007232:case e.K053260:case e.GBA_DMA:case e.GBA_MINMOD:case e.NDS:case e.YMZ280B:case e.QSOUND:case e.MULTIPCM:this.loadTestSample8bit(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n);break;case e.RF5C68:case e.GA20:this.loadTestSample8bit(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n);break;case e.MSM6258:case e.MSM6295:this.loadTestSampleVOX(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n);break;case e.ES5506:case e.C140:case e.C219:case e.PCM_DAC:this.loadTestSample16bit(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n);break;case e.SNES:this.loadTestSampleBRR(),this.engine.renderSamples(t);for(let e=0;e<a;e++)r(e,0),i(e,n)}if(![e.AMIGA,e.SEGAPCM,e.SEGAPCM_COMPAT,e.RF5C68,e.K007232,e.K053260,e.GA20,e.GBA_DMA,e.GBA_MINMOD,e.NDS,e.MSM6295,e.YMZ280B,e.QSOUND,e.MULTIPCM,e.MSM6258,e.ES5506,e.C140,e.C219,e.PCM_DAC,e.SNES].includes(t))for(let o=0;o<a;o++)r(o,0),i(o,n)}setupDefaultGBInstrument(){const e=this.platformType,t=new Uint8Array([15,0,2,0,0,1,0,0]);this.engine.setGBInstrument(0,t,e);for(let r=0;r<4;r++)this.engine.setInstrument(r,0,e),this.engine.setVolume(r,15,e);const a=32,n=new Uint8Array(136),s=new DataView(n.buffer);s.setInt32(0,a,!0),s.setInt32(4,15,!0);for(let r=0;r<a;r++){const e=r<16?Math.round(r/16*15):Math.round((a-r)/16*15);s.setInt32(8+4*r,e,!0)}this.engine.setWavetable(0,n,e)}setupDefaultC64Instrument(){const e=this.platformType,t=this.engine.getChannelCount(e)||3,a=Oo({chipType:3,algorithm:0,feedback:0,fms:0,ams:0,fms2:0,ams2:0,ops:0,opllPreset:0,operators:[],macros:[{code:0,type:0,data:[15],loop:-1,release:-1,mode:0}],c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:0,s:15,r:1,duty:2048,ringMod:!1,oscSync:!1}},"Default C64");this.engine.uploadFurnaceInstrument(0,a,e);for(let n=0;n<t;n++)this.engine.setInstrument(n,0,e),this.engine.setVolume(n,15,e)}setupDefaultWavetable(e,t){const a=new Uint8Array(8+4*e),n=new DataView(a.buffer);n.setInt32(0,e,!0),n.setInt32(4,t,!0);for(let s=0;s<e;s++){const a=Math.round(s/(e-1)*t);n.setInt32(8+4*s,a,!0)}this.engine.setWavetable(0,a,this.platformType)}buildSampleHeader(e,t,a=8363,n=0,s,r=!0){const i=new DataView(new ArrayBuffer(32));return i.setUint32(0,e,!0),i.setInt32(4,n,!0),i.setInt32(8,s??e,!0),i.setUint8(12,t),i.setUint8(13,0),i.setUint8(14,0),i.setUint8(15,0),i.setUint32(16,a,!0),i.setUint8(22,r?1:0),i}loadTestSample8bit(){const e=new Uint8Array(64),t=this.buildSampleHeader(32,8,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let a=0;a<32;a++)e[32+a]=a<16?127:128;this.engine.setSample(0,e,this.platformType)}loadTestSample16bit(){const e=new Uint8Array(96),t=this.buildSampleHeader(32,16,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));const a=new DataView(e.buffer);for(let n=0;n<32;n++){const e=n<16?32767:-32768;a.setInt16(32+2*n,e,!0)}this.engine.setSample(0,e,this.platformType)}loadTestSampleBRR(){const e=Math.ceil(2),t=new Uint8Array(32+9*e),a=this.buildSampleHeader(32,9,8363);new Uint8Array(t.buffer,0,32).set(new Uint8Array(a.buffer));for(let n=0;n<e;n++){const a=32+9*n,s=n===e-1;t[a]=194|(s?1:0);for(let e=0;e<8;e++){const s=16*n+2*e,r=s<16?7:8,i=s+1<16?7:8;t[a+1+e]=(15&r)<<4|15&i}}this.engine.setSample(0,t,this.platformType)}loadTestSampleVOX(){const e=new Uint8Array(48.5),t=this.buildSampleHeader(32,Mo,8363);new Uint8Array(e.buffer,0,32).set(new Uint8Array(t.buffer));for(let a=0;a<16.5;a++){const t=2*a,n=t<16?15:0,s=t+1<16?15:0;e[32+a]=n<<4|s}this.engine.setSample(0,e,this.platformType)}getChannelNames(){const e=Fo[this.platformType];if(e)return e;const t=this.engine.getChannelCount(this.platformType)||1;return Array.from({length:t},(e,t)=>`CH${t+1}`)}getNumChannels(){return this.engine.getChannelCount(this.platformType)}onOscData(e){return this.engine.onOscData(e)}getOscData(){return this.engine.getOscData()}triggerAttack(e,t,a=1){if(!this._isReady||this._disposed)return;const n="string"==typeof e?gs(e):e>127?Math.round(12*Math.log2(e/440)+69):e,s=this.currentChannel,r=this._releaseTimeouts.get(s);r&&(clearTimeout(r),this._releaseTimeouts.delete(s));const i=this.platformType;this.engine.setInstrument(s,this.furnaceInstrumentIndex,i,!0);const o=Ro(i),l=Math.round(a*o);this.engine.setVolume(s,l,i),this.engine.noteOn(s,n,i),this.activeNotes.set(n,s)}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n);const s=this.engine.getNativeCtx();if(s){const n=this.currentChannel,r=(a??s.currentTime)+t,i=setTimeout(()=>{this._releaseTimeouts.delete(n),this.triggerRelease(e)},Math.max(0,1e3*(r-s.currentTime)));this._releaseTimeouts.set(n,i)}}triggerRelease(e,t){if(this._isReady&&!this._disposed)if(void 0!==e){const t="string"==typeof e?gs(e):e>127?Math.round(12*Math.log2(e/440)+69):e,a=this.activeNotes.get(t);void 0!==a&&(this.engine.noteOff(a,this.platformType),this.activeNotes.delete(t))}else{for(const[,e]of this.activeNotes)this.engine.noteOff(e,this.platformType);this.activeNotes.clear()}}releaseAll(){this.triggerRelease()}setChannel(e){this.currentChannel=e}sendCommand(e,t,a=0,n=0){this._isReady&&!this._disposed&&this.engine.dispatch(e,t,a,n,this.platformType)}applyEffect(e,t,a){this._isReady&&!this._disposed&&this.engine.applyEffect(a??this.currentChannel,e,t,this.platformType)}applyExtendedEffect(e,t,a){this._isReady&&!this._disposed&&this.engine.applyExtendedEffect(a??this.currentChannel,e,t,this.platformType)}applyPlatformEffect(e,t,a){this._isReady&&!this._disposed&&this.engine.applyPlatformEffect(a??this.currentChannel,e,t,this.platformType)}resetEffectMemory(){this.engine.resetEffectMemory()}setGBInstrument(e,t){this.engine.setGBInstrument(e,t,this.platformType)}setWavetable(e,t){this.engine.setWavetable(e,t,this.platformType)}renderSamples(){this.engine.renderSamples(this.platformType)}setParam(e,t){switch(e){case"volume":this.engine.setVolume(this.currentChannel,t,this.platformType);break;case"channel":this.currentChannel=t}}dispose(){this._disposed=!0,this.activeNotes.clear();for(const e of this._releaseTimeouts.values())clearTimeout(e);this._releaseTimeouts.clear(),this._nativeGain=null,this.output.disconnect()}}class Bo{name="DrumKitSynth";config;sampleBuffers=new Map;activeVoices=[];audioContext;outputGain;output;onSampleNeeded;constructor(e){this.config=e,this.audioContext=us(),this.output=this.audioContext.createGain(),this.output.gain.value=1,this.outputGain=this.audioContext.createGain(),this.outputGain.gain.value=.8,this.outputGain.connect(this.output)}setSampleLoader(e){this.onSampleNeeded=e}async preloadSamples(){if(!this.onSampleNeeded)return;const e=this.config.keymap.map(async e=>{if(!this.sampleBuffers.has(e.id)){const t=await this.onSampleNeeded(e.sampleId,e.sampleUrl);t&&this.sampleBuffers.set(e.id,t)}});await Promise.all(e)}loadSample(e,t){this.sampleBuffers.set(e,t)}findMapping(e){for(const t of this.config.keymap)if(e>=t.noteStart&&e<=t.noteEnd)return t;return null}noteToMidiNumber(e){return"number"==typeof e?e+11:function(e){if("number"==typeof e)return e+11;if(null==e||""===e||"..."===e||"==="===e)return 60;const t=e.match(/^([A-G])([#b])?-?(\d)$/i);if(!t)return 60;const[,a,n,s]=t,r=parseInt(s,10),i=a.toUpperCase(),o=n?i+n:i+"-",l=Zn.indexOf(o);return-1===l?60:12*(r+1)+l}(e)}triggerAttack(e,t,a=.8){const n=this.noteToMidiNumber(e),s=this.findMapping(n);if(!s)return;const r=this.sampleBuffers.get(s.id);if(!r)return;if(this.activeVoices.length>=this.config.maxVoices){const e=this.activeVoices.shift();e&&this.disposeVoice(e)}if("mono"===this.config.polyphony||this.config.noteCut){this.activeVoices.filter(e=>e.mappingId===s.id).forEach(e=>{this.disposeVoice(e);const t=this.activeVoices.indexOf(e);-1!==t&&this.activeVoices.splice(t,1)})}const i=this.calculatePlaybackRate(s,n),o=this.audioContext.createBufferSource();o.buffer=r,o.playbackRate.value=i;const l=(s.panOffset||0)/100,c=this.audioContext.createStereoPanner();c.pan.value=l;const u=Math.pow(10,(s.volumeOffset||0)/20),d=this.audioContext.createGain();d.gain.value=a*u,o.connect(c),c.connect(d),d.connect(this.outputGain);const p=t??vs();o.start(p);const m={source:o,panner:c,gain:d,midiNote:n,mappingId:s.id,startTime:p};this.activeVoices.push(m);const h=r.duration/i;setTimeout(()=>{const e=this.activeVoices.indexOf(m);-1!==e&&(this.activeVoices.splice(e,1),this.disposeVoice(m))},1e3*(h+.1))}calculatePlaybackRate(e,t){let a=1;if(e.pitchOffset&&(a*=Math.pow(2,e.pitchOffset/12)),e.fineTune&&(a*=Math.pow(2,e.fineTune/1200)),e.baseNote){const n=t-this.noteToMidiNumber(e.baseNote);a*=Math.pow(2,n/12)}return Math.max(.1,Math.min(4,a))}triggerRelease(e,t){const a=this.noteToMidiNumber(e);this.activeVoices.filter(e=>e.midiNote===a).forEach(e=>{const a=t??vs();e.gain.gain.setValueAtTime(e.gain.gain.value,a),e.gain.gain.linearRampToValueAtTime(0,a+.05),setTimeout(()=>{const t=this.activeVoices.indexOf(e);-1!==t&&(this.activeVoices.splice(t,1),this.disposeVoice(e))},100)})}disposeVoice(e){try{e.source.stop()}catch{}try{e.source.disconnect(),e.panner.disconnect(),e.gain.disconnect()}catch{}}releaseAll(){this.activeVoices.forEach(e=>this.disposeVoice(e)),this.activeVoices=[]}updateConfig(e){this.config={...this.config,...e}}getKeymap(){return[...this.config.keymap]}addMapping(e){this.config.keymap.push(e)}removeMapping(e){const t=this.config.keymap.findIndex(t=>t.id===e);-1!==t&&(this.config.keymap.splice(t,1),this.sampleBuffers.delete(e))}clearKeymap(){this.config.keymap=[],this.sampleBuffers.clear(),this.releaseAll()}dispose(){this.releaseAll(),this.sampleBuffers.clear(),this.outputGain.disconnect(),this.output.disconnect()}}const Lo={type:"sine",frequency:440},Vo={enabled:!0,type:"square",rate:2,depth:100},zo={enabled:!0,time:.3,feedback:.4,wet:.3},Uo={enabled:!0,type:"lowpass",frequency:2e3,rolloff:-24},Go={enabled:!0,decay:1.5,wet:.1};class Wo{name="DubSirenSynth";output;osc;filter;reverb;delay;distortion;gate;_toneOutput;signal;lfo;constructor(e){const t={oscillator:{...Lo,...e?.oscillator},lfo:{...Vo,...e?.lfo},delay:{...zo,...e?.delay},filter:{...Uo,...e?.filter},reverb:{...Go,...e?.reverb}};this.output=us().createGain(),this._toneOutput=new E(0);const a=hs(this._toneOutput);a&&a.connect(this.output),this.reverb=new g({decay:t.reverb.decay,wet:t.reverb.enabled?t.reverb.wet:0}),this.delay=new _({delayTime:t.delay.time,feedback:t.delay.feedback,wet:t.delay.enabled?t.delay.wet:0}),this.filter=new h({frequency:t.filter.frequency,type:t.filter.type,rolloff:t.filter.rolloff,Q:1}),this.distortion=new b(.1),this.gate=new p(0),this.osc=new T({type:t.oscillator.type}),this.signal=new A({units:"frequency",value:t.oscillator.frequency}),this.lfo=new v({type:t.lfo.type,frequency:t.lfo.rate,amplitude:1,min:-t.lfo.depth,max:t.lfo.depth}),this.osc.frequency.value=0,this.signal.connect(this.osc.frequency),t.lfo.enabled&&(this.lfo.connect(this.osc.frequency),this.lfo.start()),this.osc.connect(this.gate),this.gate.connect(this.filter),this.filter.connect(this.distortion),this.distortion.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.osc.start()}applyConfig(e){this.osc.type=e.oscillator.type,this.setFrequency(e.oscillator.frequency),this.lfo.type=e.lfo.type,this.setLFORate(e.lfo.rate),this.setLFODepth(e.lfo.depth),e.lfo.enabled?"started"!==this.lfo.state&&(this.lfo.start(),this.lfo.connect(this.osc.frequency)):(this.lfo.stop(),this.lfo.disconnect()),this.setDelayTime(e.delay.time),this.setDelayFeedback(e.delay.feedback),this.setDelayMix(e.delay.enabled?e.delay.wet:0),this.setFilterFreq(e.filter.frequency),this.filter.type=e.filter.type,this.filter.rolloff=e.filter.rolloff,this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,a){const n=t||vs();if(e){const t=bs(e);this.signal.setValueAtTime(t,n)}this.gate.gain.cancelScheduledValues(n),this.gate.gain.setValueAtTime(1,n)}triggerRelease(e){const t=e||vs();this.gate.gain.cancelScheduledValues(t),this.gate.gain.setValueAtTime(0,t)}setOscType(e){this.osc.type=e}setFrequency(e){this.signal.rampTo(e,.1)}setLFOType(e){this.lfo.type=e}setLFORate(e){this.lfo.frequency.rampTo(e,.1)}setLFODepth(e){this.lfo.min=-e,this.lfo.max=e}setDelayTime(e){const t=Math.max(0,Math.min(1,e));this.delay.delayTime.rampTo(t,.1)}setDelayFeedback(e){this.delay.feedback.rampTo(e,.1)}setDelayMix(e){this.delay.wet.rampTo(e,.1)}setFilterFreq(e){this.filter.frequency.rampTo(e,.1)}dispose(){this.osc.dispose(),this.gate.dispose(),this.filter.dispose(),this.distortion.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect(),this.signal.dispose(),this.lfo.dispose()}get volume(){return this._toneOutput.volume}}class Ho{name="SpaceLaserSynth";output;synth;filter;noise;noiseGain;reverb;delay;_toneOutput;config;constructor(e){this.config=e,this.output=us().createGain(),this._toneOutput=new E(0);const t=hs(this._toneOutput);t&&t.connect(this.output),this.reverb=new g({decay:e.reverb.decay,wet:e.reverb.enabled?e.reverb.wet:0}),this.delay=new _({delayTime:e.delay.time,feedback:e.delay.feedback,wet:e.delay.enabled?e.delay.wet:0}),this.filter=new h({frequency:e.filter.cutoff,type:e.filter.type,Q:e.filter.resonance/10}),this.synth=new O({harmonicity:e.fm.ratio,modulationIndex:e.fm.amount,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1},modulationEnvelope:{attack:.001,decay:e.laser.sweepTime/1e3,sustain:0,release:.1}}),this.noise=new I({type:e.noise.type,volume:-1/0}),this.noiseGain=new p(e.noise.amount/100),this.noise.connect(this.noiseGain),this.synth.connect(this.filter),this.noiseGain.connect(this.filter),this.filter.connect(this.delay),this.delay.connect(this.reverb),this.reverb.connect(this._toneOutput),this.noise.start()}applyConfig(e){this.config=e,this.synth.harmonicity.value=e.fm.ratio,this.synth.modulationIndex.value=e.fm.amount,this.synth.envelope.decay=e.laser.sweepTime/1e3,this.synth.modulationEnvelope.decay=e.laser.sweepTime/1e3,this.noise.type=e.noise.type,this.noiseGain.gain.rampTo(e.noise.amount/100,.1),this.filter.type=e.filter.type,this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.delay.delayTime.rampTo(e.delay.time,.1),this.delay.feedback.rampTo(e.delay.feedback,.1),this.delay.wet.rampTo(e.delay.enabled?e.delay.wet:0,.1),this.reverb.decay=e.reverb.decay,this.reverb.wet.rampTo(e.reverb.enabled?e.reverb.wet:0,.1)}triggerAttack(e,t,a=1){const n=t||vs(),s=this.config.laser.sweepTime/1e3,r=e?bs(e):this.config.laser.startFreq,i=this.config.laser.endFreq;this.synth.triggerAttack(r,n,a),this.synth.frequency.cancelScheduledValues(n+.001),"exponential"===this.config.laser.sweepCurve?this.synth.frequency.exponentialRampToValueAtTime(i,n+s):this.synth.frequency.linearRampToValueAtTime(i,n+s),this.synth.triggerRelease(n+s)}triggerRelease(e){const t=null==e?vs():e;this.synth.triggerRelease(t)}dispose(){this.noise.stop(),this.synth.dispose(),this.filter.dispose(),this.noise.dispose(),this.noiseGain.dispose(),this.reverb.dispose(),this.delay.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}class Ko{name="SynareSynth";output;osc1;osc2;noise;osc1Gain;osc2Gain;noiseGain;filter;ampEnv;_toneOutput;filterFreqEnv;pitchEnv;lfo;lfoGain;config;constructor(e){this.config=e,this.osc1=new T({type:"square",frequency:e.oscillator.tune}),this.osc2=new T({type:"square",frequency:e.oscillator.tune}),this.noise=new I({type:e.noise.type}),this.osc1Gain=new p(1),this.osc2Gain=new p(e.oscillator2.enabled?e.oscillator2.mix:0),this.noiseGain=new p(e.noise.enabled?e.noise.mix:0),this.filter=new h({frequency:e.filter.cutoff,type:"lowpass",rolloff:-24,Q:e.filter.resonance/10}),this.ampEnv=new F({attack:.005,decay:e.envelope.decay/1e3,sustain:e.envelope.sustain,release:.1}),this.output=us().createGain(),this._toneOutput=new E(0);const t=hs(this._toneOutput);t&&t.connect(this.output),this.filterFreqEnv=new D({attack:.005,decay:e.filter.decay/1e3,sustain:0,release:.1}),this.pitchEnv=new D({attack:.005,decay:e.sweep.time/1e3,sustain:0,release:.1}),this.lfo=new v({frequency:e.lfo.rate,amplitude:e.lfo.depth/100}),this.lfoGain=new p(0),this.lfo.connect(this.lfoGain),this.lfo.start(),this.osc1.connect(this.osc1Gain),this.osc2.connect(this.osc2Gain),this.noise.connect(this.noiseGain);const a=new p(1);this.osc1Gain.connect(a),this.osc2Gain.connect(a),this.noiseGain.connect(a),a.connect(this.filter),this.filter.connect(this.ampEnv),this.ampEnv.connect(this._toneOutput),this.applyConfig(e),this.osc1.start(),this.osc2.start(),this.noise.start()}applyConfig(e){this.config=e,this.osc1.frequency.rampTo(e.oscillator.tune,.1),this.osc2.frequency.rampTo(e.oscillator.tune*Math.pow(2,e.oscillator2.detune/12),.1),this.osc1Gain.gain.rampTo(1,.1),this.osc2Gain.gain.rampTo(e.oscillator2.enabled?e.oscillator2.mix:0,.1),this.noiseGain.gain.rampTo(e.noise.enabled?e.noise.mix:0,.1),this.filter.frequency.rampTo(e.filter.cutoff,.1),this.filter.Q.rampTo(e.filter.resonance/10,.1),this.ampEnv.decay=e.envelope.decay/1e3,this.ampEnv.sustain=e.envelope.sustain,this.filterFreqEnv.decay=e.filter.decay/1e3,this.pitchEnv.decay=e.sweep.time/1e3,this.lfo.frequency.rampTo(e.lfo.rate,.1),this.lfoGain.gain.rampTo(e.lfo.enabled?e.lfo.depth/100:0,.1)}triggerAttack(e,t,a){const n=t||vs();if(e){const t=bs(e);this.osc1.frequency.setValueAtTime(t,n),this.osc2.frequency.setValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),n)}if(this.ampEnv.triggerAttack(n,a),this.config.filter.envMod>0){const e=Math.min(2e4,this.config.filter.cutoff+100*this.config.filter.envMod);this.filter.frequency.cancelScheduledValues(n),this.filter.frequency.setValueAtTime(this.config.filter.cutoff,n),this.filter.frequency.exponentialRampToValueAtTime(e,n+.005),this.filter.frequency.exponentialRampToValueAtTime(this.config.filter.cutoff,n+this.config.filter.decay/1e3)}if(this.config.sweep.enabled){const t=e?bs(e):this.config.oscillator.tune,a=t*Math.pow(2,this.config.sweep.amount/12);this.osc1.frequency.cancelScheduledValues(n),this.osc2.frequency.cancelScheduledValues(n),this.osc1.frequency.setValueAtTime(a,n),this.osc1.frequency.exponentialRampToValueAtTime(t,n+this.config.sweep.time/1e3),this.osc2.frequency.setValueAtTime(a*Math.pow(2,this.config.oscillator2.detune/12),n),this.osc2.frequency.exponentialRampToValueAtTime(t*Math.pow(2,this.config.oscillator2.detune/12),n+this.config.sweep.time/1e3)}}triggerRelease(e){const t=e||vs();this.ampEnv.triggerRelease(t)}updateParameter(e,t){this.applyConfig(this.config)}dispose(){this.osc1.dispose(),this.osc2.dispose(),this.noise.dispose(),this.osc1Gain.dispose(),this.osc2Gain.dispose(),this.noiseGain.dispose(),this.filter.dispose(),this.ampEnv.dispose(),this.filterFreqEnv.dispose(),this.pitchEnv.dispose(),this.lfo.dispose(),this.lfoGain.dispose(),this._toneOutput.dispose(),this.output.disconnect()}get volume(){return this._toneOutput.volume}}const qo=(e,t)=>0!==(e&t),$o=e=>{const t=new Uint8Array(e.length);return e.split("").forEach((e,a)=>{t[a]=e.charCodeAt(0)}),t},Xo=e=>{const t=new Uint8Array(4);return t[0]=e,t[1]=e>>8,t[2]=e>>16,t[3]=e>>24,t},Yo=e=>{const t=new Uint8Array(2);return t[0]=e,t[1]=e>>8,t};let Zo=null;const Qo=e=>{if(null===Zo&&(Zo=new AudioContext),!Zo)throw new Error("No player available!");return((e,t)=>{let a;const n=new Promise((n,s)=>{const r=e.createBufferSource(),i=e.createBuffer(1,t.length,22050),o=i.getChannelData(0);for(let e=0;e<t.length;e++)o[e]=t[e];r.buffer=i,r.connect(e.destination),r.onended=()=>{n(!0)},a=e=>{r.disconnect(),s(e)},r.start(0)});return n.abort=a,n})(Zo,e)},Jo=e=>{const t=new Uint8Array(44+e.length);let a=0;const n=e=>{t.set(e,a),a+=e.length};return n($o("RIFF")),n(Xo(e.length+12+16+8-8)),n($o("WAVE")),n($o("fmt ")),n(Xo(16)),n(Yo(1)),n(Yo(1)),n(Xo(22050)),n(Xo(22050)),n(Yo(1)),n(Yo(8)),n($o("data")),n(Xo(e.length)),n(e),t},el={" ":0,"!":2,'"':2,"#":2,$:2,"%":2,"&":2,"'":130,"(":0,")":0,"*":2,"+":2,",":2,"-":2,".":2,"/":2,0:3,1:3,2:3,3:3,4:3,5:3,6:3,7:3,8:3,9:3,":":2,";":2,"<":2,"=":2,">":2,"?":2,"@":2,A:192,B:168,C:176,D:172,E:192,F:160,G:184,H:160,I:192,J:188,K:160,L:172,M:168,N:172,O:192,P:160,Q:160,R:172,S:180,T:164,U:192,V:168,W:168,X:176,Y:192,Z:188,"[":0,"\\":0,"]":0,"^":2,_:0,"`":32},tl='(A)=|(!)=.|(") =-AH5NKWOWT-|(")=KWOW4T-|(#)= NAH4MBER|($)= DAA4LER|(%)= PERSEH4NT|(&)= AEND|(\')=|(*)= AE4STERIHSK|(+)= PLAH4S|(,)=,| (-) =-|(-)=|(.)= POYNT|(/)= SLAE4SH|(0)= ZIY4ROW| (1ST)=FER4ST| (10TH)=TEH4NTH|(1)= WAH4N| (2ND)=SEH4KUND|(2)= TUW4| (3RD)=THER4D|(3)= THRIY4|(4)= FOH4R| (5TH)=FIH4FTH|(5)= FAY4V| (64) =SIH4KSTIY FOHR|(6)= SIH4KS|(7)= SEH4VUN| (8TH)=EY4TH|(8)= EY4T|(9)= NAY4N|(:)=.|(;)=.|(<)= LEH4S DHAEN|(=)= IY4KWULZ|(>)= GREY4TER DHAEN|(?)=?|(@)= AE6T|(^)= KAE4RIXT',al=128,nl=(e,t)=>0!==(el[e]&t),sl=(e,t,a)=>nl(e[t],a),rl=(e,t)=>-1!==t.indexOf(e),il=e=>{const t=e.split("="),a=t.pop(),n=t.join("=").split("("),s=n.pop().split(")"),r=n[0],i=s[0],o=s[1],l=["T","C","S"],c=["E","I","Y"],u=(e,t)=>!!e.startsWith(i,t)&&(!!((e,t)=>{for(let a=r.length-1;a>-1;a--){const n=r[a];if(nl(n,al)){if(e[--t]!==n)return!1}else if(!{" ":()=>!sl(e,--t,al),"#":()=>sl(e,--t,64),".":()=>sl(e,--t,8),"&":()=>sl(e,--t,16)||rl(e.substr(--t,2),["CH","SH"]),"@":()=>{if(sl(e,--t,4))return!0;const a=e[t];if("H"!==a)return!1;if(!rl(a,l))return!1;throw new Error("Is always false but happened? "+a)},"^":()=>sl(e,--t,32),"+":()=>rl(e[--t],c),":":()=>{for(;t>=0&&sl(e,t-1,32);)t--;return!0}}[n]())return!1}return!0})(e,t)&&((e,t)=>{for(let a=0;a<o.length;a++){const n=o[a];if(nl(n,al)){if(e[++t]!==n)return!1}else if(!{" ":()=>!sl(e,++t,al),"#":()=>sl(e,++t,64),".":()=>sl(e,++t,8),"&":()=>sl(e,++t,16)||rl(e.substr(++t-2,2),["HC","HS"]),"@":()=>{if(sl(e,++t,4))return!0;const a=e[t];if("H"!==a)return!1;if(!rl(a,l))return!1;throw new Error("This should not be possible ",a)},"^":()=>sl(e,++t,32),"+":()=>rl(e[++t],c),":":()=>{for(;sl(e,t+1,32);)t++;return!0},"%":()=>"E"!==e[t+1]?"ING"===e.substr(t+1,3)&&(t+=3,!0):sl(e,t+2,al)?rl(e[t+2],["R","S","D"])?(t+=2,!0):"L"!==e[t+2]?"FUL"===e.substr(t+2,3)&&(t+=4,!0):"Y"===e[t+3]&&(t+=3,!0):(t++,!0)}[n]())return!1}return!0})(e,t+(i.length-1))),d=(e,t,n)=>{if(u(e,t))return n(a,i.length),!0};return d.c=i[0],d},ol={};" (A.)=EH4Y. |(A) =AH| (ARE) =AAR| (AR)O=AXR|(AR)#=EH4R| ^(AS)#=EY4S|(A)WA=AX|(AW)=AO5| :(ANY)=EH4NIY|(A)^+#=EY5|#:(ALLY)=ULIY| (AL)#=UL|(AGAIN)=AXGEH4N|#:(AG)E=IHJ|(A)^%=EY|(A)^+:#=AE| :(A)^+ =EY4| (ARR)=AXR|(ARR)=AE4R| ^(AR) =AA5R|(AR)=AA5R|(AIR)=EH4R|(AI)=EY4|(AY)=EY5|(AU)=AO4|#:(AL) =UL|#:(ALS) =ULZ|(ALK)=AO4K|(AL)^=AOL| :(ABLE)=EY4BUL|(ABLE)=AXBUL|(A)VO=EY4|(ANG)+=EY4NJ|(ATARI)=AHTAA4RIY|(A)TOM=AE|(A)TTI=AE| (AT) =AET| (A)T=AH|(A)=AE| (B) =BIY4| (BE)^#=BIH|(BEING)=BIY4IHNX| (BOTH) =BOW4TH| (BUS)#=BIH4Z|(BREAK)=BREY5K|(BUIL)=BIH4L|(B)=B| (C) =SIY4| (CH)^=K|^E(CH)=K|(CHA)R#=KEH5|(CH)=CH| S(CI)#=SAY4|(CI)A=SH|(CI)O=SH|(CI)EN=SH|(CITY)=SIHTIY|(C)+=S|(CK)=K|(COMMODORE)=KAA4MAHDOHR|(COM)=KAHM|(CUIT)=KIHT|(CREA)=KRIYEY|(C)=K| (D) =DIY4| (DR.) =DAA4KTER|#:(DED) =DIHD|.E(D) =D|#:^E(D) =T| (DE)^#=DIH| (DO) =DUW| (DOES)=DAHZ|(DONE) =DAH5N|(DOING)=DUW4IHNX| (DOW)=DAW|#(DU)A=JUW|#(DU)^#=JAX|(D)=D| (E) =IYIY4|#:(E) =|':^(E) =| :(E) =IY|#(ED) =D|#:(E)D =|(EV)ER=EH4V|(E)^%=IY4|(ERI)#=IY4RIY|(ERI)=EH4RIH|#:(ER)#=ER|(ERROR)=EH4ROHR|(ERASE)=IHREY5S|(ER)#=EHR|(ER)=ER| (EVEN)=IYVEHN|#:(E)W=|@(EW)=UW|(EW)=YUW|(E)O=IY|#:&(ES) =IHZ|#:(E)S =|#:(ELY) =LIY|#:(EMENT)=MEHNT|(EFUL)=FUHL|(EE)=IY4|(EARN)=ER5N| (EAR)^=ER5|(EAD)=EHD|#:(EA) =IYAX|(EA)SU=EH5|(EA)=IY5|(EIGH)=EY4|(EI)=IY4| (EYE)=AY4|(EY)=IY|(EU)=YUW5|(EQUAL)=IY4KWUL|(E)=EH| (F) =EH4F|(FUL)=FUHL|(FRIEND)=FREH5ND|(FATHER)=FAA4DHER|(F)F=|(F)=F| (G) =JIY4|(GIV)=GIH5V| (G)I^=G|(GE)T=GEH5|SU(GGES)=GJEH4S|(GG)=G| B#(G)=G|(G)+=J|(GREAT)=GREY4T|(GON)E=GAO5N|#(GH)=| (GN)=N|(G)=G| (H) =EY4CH| (HAV)=/HAE6V| (HERE)=/HIYR| (HOUR)=AW5ER|(HOW)=/HAW|(H)#=/H|(H)=| (IN)=IHN| (I) =AY4|(I) =AY|(IN)D=AY5N|SEM(I)=IY| ANT(I)=AY|(IER)=IYER|#:R(IED) =IYD|(IED) =AY5D|(IEN)=IYEHN|(IE)T=AY4EH|(I')=AY5| :(I)^%=AY5| :(IE) =AY4|(I)%=IY|(IE)=IY4| (IDEA)=AYDIY5AH|(I)^+:#=IH|(IR)#=AYR|(IZ)%=AYZ|(IS)%=AYZ|I^(I)^#=IH|+^(I)^+=AY|#:^(I)^+=IH|(I)^+=AY|(IR)=ER|(IGH)=AY4|(ILD)=AY5LD| (IGN)=IHGN|(IGN) =AY4N|(IGN)^=AY4N|(IGN)%=AY4N|(ICRO)=AY4KROH|(IQUE)=IY4K|(I)=IH| (J) =JEY4|(J)=J| (K) =KEY4| (K)N=|(K)=K| (L) =EH4L|(LO)C#=LOW|L(L)=|#:^(L)%=UL|(LEAD)=LIYD| (LAUGH)=LAE4F|(L)=L| (M) =EH4M| (MR.) =MIH4STER| (MS.)=MIH5Z| (MRS.) =MIH4SIXZ|(MOV)=MUW4V|(MACHIN)=MAHSHIY5N|M(M)=|(M)=M| (N) =EH4N|E(NG)+=NJ|(NG)R=NXG|(NG)#=NXG|(NGL)%=NXGUL|(NG)=NX|(NK)=NXK| (NOW) =NAW4|N(N)=|(NON)E=NAH4N|(N)=N| (O) =OH4W|(OF) =AHV| (OH) =OW5|(OROUGH)=ER4OW|#:(OR) =ER|#:(ORS) =ERZ|(OR)=AOR| (ONE)=WAHN|#(ONE) =WAHN|(OW)=OW| (OVER)=OW5VER|PR(O)V=UW4|(OV)=AH4V|(O)^%=OW5|(O)^EN=OW|(O)^I#=OW5|(OL)D=OW4L|(OUGHT)=AO5T|(OUGH)=AH5F| (OU)=AW|H(OU)S#=AW4|(OUS)=AXS|(OUR)=OHR|(OULD)=UH5D|(OU)^L=AH5|(OUP)=UW5P|(OU)=AW|(OY)=OY|(OING)=OW4IHNX|(OI)=OY5|(OOR)=OH5R|(OOK)=UH5K|F(OOD)=UW5D|L(OOD)=AH5D|M(OOD)=UW5D|(OOD)=UH5D|F(OOT)=UH5T|(OO)=UW5|(O')=OH|(O)E=OW|(O) =OW|(OA)=OW4| (ONLY)=OW4NLIY| (ONCE)=WAH4NS|(ON'T)=OW4NT|C(O)N=AA|(O)NG=AO| :^(O)N=AH|I(ON)=UN|#:(ON)=UN|#^(ON)=UN|(O)ST=OW|(OF)^=AO4F|(OTHER)=AH5DHER|R(O)B=RAA|^R(O):#=OW5|(OSS) =AO5S|#:^(OM)=AHM|(O)=AA| (P) =PIY4|(PH)=F|(PEOPL)=PIY5PUL|(POW)=PAW4|(PUT) =PUHT|(P)P=|(P)S=|(P)N=|(PROF.)=PROHFEH4SER|(P)=P| (Q) =KYUW4|(QUAR)=KWOH5R|(QU)=KW|(Q)=K| (R) =AA5R| (RE)^#=RIY|(R)R=|(R)=R| (S) =EH4S|(SH)=SH|#(SION)=ZHUN|(SOME)=SAHM|#(SUR)#=ZHER|(SUR)#=SHER|#(SU)#=ZHUW|#(SSU)#=SHUW|#(SED)=ZD|#(S)#=Z|(SAID)=SEHD|^(SION)=SHUN|(S)S=|.(S) =Z|#:.E(S) =Z|#:^#(S) =S|U(S) =S| :#(S) =Z|##(S) =Z| (SCH)=SK|(S)C+=|#(SM)=ZUM|#(SN)'=ZUM|(STLE)=SUL|(S)=S| (T) =TIY4| (THE) #=DHIY| (THE) =DHAX|(TO) =TUX| (THAT)=DHAET| (THIS) =DHIHS| (THEY)=DHEY| (THERE)=DHEHR|(THER)=DHER|(THEIR)=DHEHR| (THAN) =DHAEN| (THEM) =DHAEN|(THESE) =DHIYZ| (THEN)=DHEHN|(THROUGH)=THRUW4|(THOSE)=DHOHZ|(THOUGH) =DHOW|(TODAY)=TUXDEY|(TOMO)RROW=TUMAA5|(TO)TAL=TOW5| (THUS)=DHAH4S|(TH)=TH|#:(TED)=TIXD|S(TI)#N=CH|(TI)O=SH|(TI)A=SH|(TIEN)=SHUN|(TUR)#=CHER|(TU)A=CHUW| (TWO)=TUW|&(T)EN =|(T)=T| (U) =YUW4| (UN)I=YUWN| (UN)=AHN| (UPON)=AXPAON|@(UR)#=UH4R|(UR)#=YUH4R|(UR)=ER|(U)^ =AH|(U)^^=AH5|(UY)=AY5| G(U)#=|G(U)%=|G(U)#=W|#N(U)=YUW|@(U)=UW|(U)=YUW| (V) =VIY4|(VIEW)=VYUW5|(V)=V| (W) =DAH4BULYUW| (WERE)=WER|(WA)SH=WAA|(WA)ST=WEY|(WA)S=WAH|(WA)T=WAA|(WHERE)=WHEHR|(WHAT)=WHAHT|(WHOL)=/HOWL|(WHO)=/HUW|(WH)=WH|(WAR)#=WEHR|(WAR)=WAOR|(WOR)^=WER|(WR)=R|(WOM)A=WUHM|(WOM)E=WIHM|(WEA)R=WEH|(WANT)=WAA5NT|ANS(WER)=ER|(W)=W| (X) =EH4KR| (X)=Z|(X)=KS| (Y) =WAY4|(YOUNG)=YAHNX| (YOUR)=YOHR| (YOU)=YUW| (YES)=YEHS| (Y)=Y|F(Y)=AY|PS(YCH)=AYK|#:^(Y)=IY|#:^(Y)I=IY| :(Y) =AY| :(Y)#=AY| :(Y)^+:#=IH| :(Y)^#=AY|(Y)=IH| (Z) =ZIY4|(Z)=Z".split("|").map(e=>{const t=il(e),a=t.c;ol[a]=ol[a]||[],ol[a].push(t)});const ll=tl.split("|").map(il),cl="*12345678".split(""),ul=" *.*?*,*-*IYIHEHAEAAAHAOUHAXIXERUXOHRXLXWXYXWHR*L*W*Y*M*N*NXDXQ*S*SHF*TH/H/XZ*ZHV*DHCH**J*******EYAYOYAWOWUWB*****D*****G*****GX****P*****T*****K*****KX****ULUMUN".match(/.{1,2}/g),dl=[32768,49408,49408,49408,49408,164,164,164,164,164,164,132,132,164,164,132,132,132,132,132,132,132,68,4164,4164,4164,4164,2124,3148,2124,1096,16460,9280,8256,8256,9280,64,64,9284,8260,8260,9284,8264,8256,76,8260,0,0,180,180,180,148,148,148,78,78,78,1102,1102,1102,78,78,78,78,78,78,75,75,75,1099,1099,1099,75,75,75,75,75,75,128,193,193],pl=[0,4626,4626,4626,2056,2824,2312,2824,3592,3851,2822,4108,3082,1541,1541,3595,3082,3594,3082,2825,2056,2055,2825,2567,2310,2056,2054,2055,2055,2055,770,1285,514,514,514,514,514,514,1542,1542,2055,1542,1542,514,2312,1027,513,286,3597,3852,3852,3852,3598,3593,2054,513,514,1797,513,257,1798,513,514,1798,513,514,2056,514,514,1540,514,514,1798,513,1028,1798,257,1028,1479,1535],ml=(e,t)=>{const a=ul.findIndex(a=>a===e+t&&"*"!==a[1]);return-1!==a&&a},hl=e=>{const t=ul.findIndex(t=>t===e+"*");return-1!==t&&t},fl=(e,t)=>qo(dl[e],t),yl=128,gl=e=>{if(!e)return!1;const t=e=>{if(e<0||e>l.length)throw new Error("Out of bounds: "+e);return e===l.length?null:l[e]},a=(e,t,a,r)=>{for(let c=l.length-1;c>=e;c--)l[c+1]=l[c],o[c+1]=s(c),i[c+1]=n(c);l[e]=t,o[e]=0|r,i[e]=a},n=e=>0|i[e],s=e=>0|o[e],r=(e,t)=>{if(128&t)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");if(e<0||e>l.length)throw new Error("Out of bounds: "+e);o[e]=t},i=[],o=[],l=[];let c=0;return((e,t,a)=>{for(let n=0;n<e.length;n++){e.toLowerCase();const s=e[n],r=e[n+1]||"";let i;if(!1===(i=ml(s,r)))if(!1===(i=hl(s))){for(i=cl.length;s!==cl[i]&&i>0;)--i;if(0===i)throw Error(`Could not parse char ${s}`);a(i)}else t(i);else n++,t(i)}})(e,e=>{i[c]=0,o[c]=0,l[c++]=e},e=>{if(128&e)throw new Error("Got the flag 0x80, see CopyStress() and SetPhonemeLength() comments!");i[c-1]=e}),bl(l,o,i),((e,t,a,n)=>{const s=(s,r)=>{switch(s){case 53:fl(a(r-1),1024)&&t(r,16);break;case 42:e(r+1,43,n(r));break;case 44:e(r+1,45,n(r))}},r=(a,s)=>{t(a,13),e(a+1,s,n(a))};let i,o=-1;for(;null!==(i=a(++o));){if(0===i)continue;if(fl(i,16)){e(o+1,fl(i,32)?21:20,n(o)),s(i,o);continue}if(78===i){r(o,24);continue}if(79===i){r(o,27);continue}if(80===i){r(o,28);continue}if(fl(i,yl)&&n(o)){0===a(o+1)&&(i=a(o+2),null!==i&&fl(i,yl)&&n(o+2)&&e(o+2,31,0));continue}const l=0===o?null:a(o-1);if(23!==i)if(24===i&&fl(l,yl))t(o,19);else if(60!==l||32!==i){if(60===i){const e=a(o+1);fl(e,32)||null===e||t(o,63);continue}if(72===i){const e=a(o+1);fl(e,32)&&null!==e||(t(o,75),i=75)}fl(i,1)&&32===l?t(o,i-12):fl(i,1)||s(i,o),69!==i&&57!==i||o>0&&fl(a(o-1),yl)&&(i=a(o+1),0===i&&(i=a(o+2)),fl(i,yl)&&!n(o+1)&&t(o,30))}else t(o,38);else switch(l){case 69:t(o-1,42);break;case 57:t(o-1,44);break;default:fl(l,yl)&&t(o,18)}}})(a,(e,t)=>{l[e]=t},t,n),((e,t,a)=>{let n,s=0;for(;null!==(n=e(s));){if(fl(n,64)&&(n=e(s+1),null!==n&&fl(n,yl))){const e=t(s+1);0!==e&&e<128&&a(s,e+1)}++s}})(t,n,(e,t)=>{i[e]=t}),((e,t,a)=>{let n,s=0;for(;null!==(n=e(s));){const e=t(s);a(s,0===e||e>127?255&pl[n]:pl[n]>>8),s++}})(t,n,r),((e,t,a)=>{for(let r=0;null!==e(r);r++){if(!fl(e(r),256))continue;const n=r;for(;--r>1&&!fl(e(r),yl););if(0===r)break;for(;r<n;r++)if(!fl(e(r),8192)||fl(e(r),4)){const e=a(r);t(r,(e>>1)+e+1)}}let n,s=-1;for(;null!==(n=e(++s));){let r=s;if(fl(n,yl)){if(n=e(++r),!fl(n,64)){18!==n&&19!==n||!fl(e(++r),64)||t(s,a(s)-1);continue}const i=null===n?65:dl[n];if(!qo(i,4)){if(qo(i,1)){const e=a(s);t(s,e-(e>>3))}continue}const o=a(s);t(s,(o>>2)+o+1);continue}if(fl(n,2048))n=e(++r),null!==n&&fl(n,2)&&(t(r,6),t(r-1,5));else if(fl(n,2)){for(;0===(n=e(++r)););null!==n&&fl(n,2)&&(t(r,1+(a(r)>>1)),t(s,1+(a(s)>>1)))}else r>0&&fl(n,4096)&&fl(e(r-1),2)&&t(r,a(r)-2)}})(t,r,s),((e,t,a)=>{let n,s=-1;for(;null!==(n=e(++s));)if(fl(n,2)){if(fl(n,1)){let t,a=s;do{t=e(++a)}while(0===t);if(null!==t&&(fl(t,8)||36===t||37===t))continue}t(s+1,n+1,a(s),255&pl[n+1]),t(s+2,n+2,a(s),255&pl[n+2]),s+=2}})(t,a,n),bl(l,o,i),l.map((e,t)=>e?[e,0|o[t],0|i[t]]:null).filter(e=>e)},bl=(e,t,a)=>{for(let n=0;n<e.length;n++){}},vl=[24,26,23,23,23],xl=[0,224,230,236,243,249,0,6,12,6],wl=[0,31,31,31,31,2,2,2,2,2,2,2,2,2,5,5,2,10,2,8,5,5,11,10,9,8,8,160,8,8,23,31,18,18,18,18,30,30,20,20,20,20,23,23,26,26,29,29,2,2,2,2,2,2,26,29,27,26,29,27,26,29,27,26,29,27,23,29,23,23,29,23,23,29,23,23,29,23,23,23],kl=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,4,4,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1,0,1,0,1,0,5,5,5,5,5,4,4,2,0,1,2,0,1,2,0,1,2,0,1,2,0,2,2,0,1,3,0,2,3,0,2,160,160],Sl=[0,2,2,2,2,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,4,4,3,3,3,3,3,1,2,3,2,1,3,3,3,3,1,1,3,3,3,2,2,3,2,3,0,0,5,5,5,5,4,4,2,0,2,2,0,3,2,0,4,2,0,3,2,0,2,2,0,2,3,0,3,3,0,3,176,160],Ml=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,241,226,211,187,124,149,1,2,3,3,0,114,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,0,0,25,0,0,0,0,0,0,0,0,0],Nl=[0,5980947,5980947,5980947,5980947,7230474,6113550,5980947,5783320,5842971,5712919,5775125,5383440,5844244,6113550,4075794,5383182,5774866,4076306,7218448,5250317,6112527,5904395,3944978,7216654,5904395,7230217,5320198,7943686,6641158,7943686,5980945,6506758,6967046,5315078,7946758,6113550,5383440,6107913,6767114,4990984,6106890,6639366,6639366,7946758,6639365,7958022,0,5916691,5777179,5775125,5778203,5774866,5382669,5315078,5315078,5315078,7946758,7946758,7946758,7368198,7237126,7237126,6181894,6181894,6181894,5315078,5315078,5315078,7946758,7946758,7946758,6647046,6641162,7367946,6181894,6181894,6181894,556844,98067],Cl=[0,0,0,0,0,526861,461581,527630,527887,68879,68623,3087,68367,2316,461581,330508,68623,3087,396301,67597,2061,461838,2061,330252,67597,2061,526861,780,2313,198153,0,0,0,0,0,0,0,0,779,66827,779,1035,0,0,1,66827,920064,66050,593422,68879,3087,68879,3087,2061,2,260,0,2,260,0,1,260,0,1,260,0,0,0,0,0,0,0,0,461324,0,0,330240,0,1245199,1048591],Pl=[56,132,107,25,198,99,24,134,115,152,198,177,28,202,49,140,199,49,136,194,48,152,70,49,24,198,53,12,202,49,12,198,33,16,36,105,18,194,49,20,196,113,8,74,34,73,171,106,168,172,73,81,50,213,82,136,147,108,148,34,21,84,210,37,150,212,80,165,70,33,8,133,107,24,196,99,16,206,107,24,140,113,25,140,99,53,12,198,51,153,204,108,181,78,162,153,70,33,40,130,149,46,227,48,156,197,48,156,162,177,156,103,49,136,102,89,44,83,24,132,103,80,202,227,10,172,171,48,172,98,48,140,99,16,148,98,177,140,130,40,150,51,152,214,181,76,98,41,165,74,181,156,198,49,20,214,56,156,75,180,134,101,24,174,103,28,166,99,25,150,35,25,132,19,8,166,82,172,202,34,137,110,171,25,140,98,52,196,98,25,134,99,24,196,35,88,214,163,80,66,84,74,173,74,37,17,107,100,137,74,99,57,138,35,49,42,234,162,169,68,197,18,205,66,52,140,98,24,140,99,17,72,102,49,157,68,51,29,70,49,156,198,177,12,205,50,136,196,115,24,134,115,8,214,99,88,7,129,224,240,60,7,135,144,60,124,15,199,192,192,240,124,30,7,128,128,0,28,120,112,241,199,31,192,12,254,28,31,31,14,10,122,192,113,242,131,143,3,15,15,12,0,121,248,97,224,67,15,131,231,24,249,193,19,218,233,99,143,15,131,131,135,195,31,60,112,240,225,225,227,135,184,113,14,32,227,141,72,120,28,147,135,48,225,193,193,228,120,33,131,131,195,135,6,57,229,195,135,7,14,28,28,112,244,113,156,96,54,50,195,30,60,243,143,14,60,112,227,199,143,15,15,14,60,120,240,227,135,6,240,227,7,193,153,135,15,24,120,112,112,252,243,16,177,140,140,49,124,112,225,134,60,100,108,176,225,227,15,35,143,15,30,62,56,60,56,123,143,7,14,60,244,23,30,60,120,242,158,114,73,227,37,54,56,88,57,226,222,60,120,120,225,199,97,225,225,176,240,240,195,199,14,56,192,240,206,115,115,24,52,176,225,199,142,28,60,248,56,240,225,193,139,134,143,28,120,112,240,120,172,177,143,57,49,219,56,97,195,14,14,56,120,115,23,30,57,30,56,100,225,241,193,78,15,64,162,2,197,143,129,161,252,18,8,100,224,60,34,224,69,7,142,12,50,144,240,31,32,73,224,248,12,96,240,23,26,65,170,164,208,141,18,130,30,30,3,248,62,3,12,115,128,112,68,38,3,36,225,62,4,78,4,28,193,9,204,158,144,33,7,144,67,100,192,15,198,144,156,193,91,3,226,29,129,224,94,29,3,132,184,44,15,128,177,131,224,48,65,30,67,137,131,80,252,36,46,19,131,241,124,76,44,201,13,131,176,181,130,228,232,6,156,7,160,153,29,7,62,130,143,112,48,116,64,202,16,228,232,15,146,20,63,6,248,132,136,67,129,10,52,57,65,198,227,28,71,3,176,184,19,10,194,100,248,24,249,96,179,192,101,32,96,166,140,195,129,32,48,38,30,28,56,211,1,176,38,64,244,11,195,66,31,133,50,38,96,64,201,203,1,236,17,40,64,250,4,52,224,112,76,140,29,7,105,3,22,200,4,35,232,198,154,11,26,3,224,118,6,5,207,30,188,88,49,113,102,0,248,63,4,252,12,116,39,138,128,113,194,58,38,6,192,31,5,15,152,64,174,1,127,192,7,255,0,14,254,0,3,223,128,3,239,128,27,241,194,0,231,224,24,252,224,33,252,128,60,252,64,14,126,0,63,62,0,15,254,0,31,255,0,62,240,7,252,0,126,16,63,255,0,63,56,14,124,1,135,12,252,199,0,62,4,15,62,31,15,15,31,15,2,131,135,207,3,135,15,63,192,7,158,96,63,192,3,254,0,63,224,119,225,192,254,224,195,224,1,223,248,3,7,0,126,112,0,124,56,24,254,12,30,120,28,124,62,14,31,30,30,62,0,127,131,7,219,135,131,7,199,7,16,113,255,0,63,226,1,224,193,195,225,0,127,192,5,240,32,248,240,112,254,120,121,248,2,63,12,143,3,15,159,224,193,199,135,3,195,195,176,225,225,193,227,224,113,240,0,252,112,124,12,62,56,14,28,112,195,199,3,129,193,199,231,0,15,199,135,25,9,239,196,51,224,193,252,248,112,240,120,248,240,97,199,0,31,248,1,124,248,240,120,112,60,124,206,14,33,131,207,8,7,143,8,193,135,143,128,199,227,0,7,248,224,239,0,57,247,128,14,248,225,227,248,33,159,192,255,3,248,7,192,31,248,196,4,252,196,193,188,135,240,15,192,127,5,224,37,236,192,62,132,71,240,142,3,248,3,251,192,25,248,7,156,12,23,248,7,224,31,161,252,15,252,1,240,63,0,254,3,240,31,0,253,0,255,136,13,249,1,255,0,112,7,192,62,66,243,13,196,127,128,252,7,240,94,192,63,0,120,63,129,255,1,248,1,195,232,12,228,100,143,228,15,240,7,240,194,31,0,127,192,111,128,126,3,248,7,240,63,192,120,15,130,7,254,34,119,112,2,118,3,254,0,254,103,0,124,199,241,142,198,59,224,63,132,243,25,216,3,153,252,9,184,15,248,0,157,36,97,249,13,0,253,3,240,31,144,63,1,248,31,208,15,248,55,1,248,7,240,15,192,63,0,254,3,248,15,192,63,0,250,3,240,15,128,255,1,184,7,240,1,252,1,188,128,19,30,0,127,225,64,127,160,127,176,0,63,192,31,192,56,15,240,31,128,255,1,252,3,241,126,1,254,1,240,255,0,127,192,29,7,240,15,192,126,6,224,7,224,15,248,6,193,254,1,252,3,224,15,0,252],El=(e,t,a,n,s)=>{const r=((e,t)=>{const a=(e,t)=>(e*t>>8&255)<<1,n=[[],[],[]];Nl.map((e,t)=>{n[0][t]=255&e,n[1][t]=e>>8&255,n[2][t]=e>>16&255});for(let s=5;s<30;s++)n[0][s]=a(e,n[0][s]),n[1][s]=a(t,n[1][s]);for(let s=48;s<54;s++)n[0][s]=a(e,n[0][s]),n[1][s]=a(t,n[1][s]);return n})(a,n),[i,o,l,c]=((e,t,a)=>{const n=(e,t,a)=>{const n=t;let s;for(t<30?t=0:t-=30;127===(s=a[t]);)++t;for(;t!==n;)for(s+=e,a[t]=255&s;++t!==n&&255===a[t];);},s=[],r=[[],[],[]],i=[[],[],[]],o=[];let l=0;for(let c=0;c<t.length;c++){const u=t[c][0];1===u?n(1,l,s):2===u&&n(255,l,s);const d=xl[t[c][2]];for(let n=t[c][1];n>0;n--)r[0][l]=a[0][u],r[1][l]=a[1][u],r[2][l]=a[2][u],i[0][l]=255&Cl[u],i[1][l]=Cl[u]>>8&255,i[2][l]=Cl[u]>>16&255,o[l]=Ml[u],s[l]=e+d&255,l++}return[s,r,i,o]})(t,e,r),u=((e,t,a,n)=>{const s=[e,t[0],t[1],t[2],a[0],a[1],a[2]],r=(e,t)=>{if(e<0||e>s.length-1)throw new Error(`Error invalid table in Read: ${e}`);return s[e][t]},i=(e,t,a,n)=>{const i=n<0,o=Math.abs(n)%e,l=n/e|0;let c=0,u=e;for(;--u>0;){let n=r(t,a)+l;if(c+=o,c>=e&&(c-=e,i?n--:n&&n++),t<0||t>s.length-1)throw new Error(`Error invalid table in Read: ${t}`);s[t][++a]=n,n+=l}};let o,l,c=0;for(let u=0;u<n.length-1;u++){const t=n[u][0],a=n[u+1][0],s=wl[a],d=wl[t];d===s?(o=kl[t],l=kl[a]):d<s?(o=Sl[a],l=kl[a]):(o=kl[t],l=Sl[t]),c+=n[u][1];const p=c+l,m=c-o,h=o+l;if(!(h-2&128)){const t=n[u][1]>>1,a=n[u+1][1]>>1;i(t+a,0,m,e[c+a]-e[c-t]);for(let e=1;e<7;e++)i(h,e,m,r(e,p)-r(e,m))}}return c+n[n.length-1][1]})(i,o,l,e);if(!s)for(let p=0;p<i.length;p++)i[p]-=o[0][p]>>1;const d=[0,1,2,2,2,3,3,4,4,5,6,8,9,11,13,15];for(let p=l[0].length-1;p>=0;p--)l[0][p]=d[l[0][p]],l[1][p]=d[l[1][p]],l[2][p]=d[l[2][p]];return[u,o,i,l,c]},_l=(e,t,a,n)=>{const s=(7&a)-1,r=256*s&65535;let i=248&a;const o=(t,a,n,s)=>{let o=8,l=Pl[r+i];do{128&l?e(t,a):e(n,s),l<<=1}while(--o)};if(0===i){let e=n>>4^255;i=255&t;do{o(3,26,4,6),i++,i&=255}while(255&++e);return i}i^=255;const l=255&vl[s];do{o(2,5,1,l)}while(255&++i);return t},Tl=e=>127*Math.sin(2*Math.PI*(e/256))|0,Al=(e,t,a,n,s,r)=>{s=255&(s||72);const i=El(e,t=void 0===t?64:255&t,a=void 0===a?128:255&a,n=void 0===n?128:255&n,r=r||!1),o=(e=>{const t=new Uint8Array(e);let a=0,n=0;const s=(e,t)=>{const a=16*(15&t);s.ary(e,[a,a,a,a,a])};return s.ary=(e,s)=>{if(a+=[[162,167,167,127,128],[226,60,60,0,0],[225,60,59,0,0],[200,0,0,54,55],[199,0,0,54,54]][n][e],(a/50|0)>t.length)throw new Error(`Buffer overflow, want ${a/50|0} but buffersize is only ${t.length}!`);n=e;for(let n=0;n<5;n++)t[(a/50|0)+n]=s[n]},s.get=()=>t.slice(0,a/50|0),s})(176.4*e.reduce((e,t)=>e+t[1],0)*s|0),[l,c,u,d,p]=i;return Ol(u,c,d,p),((e,t,a,n,s,r,i)=>{let o=a,l=0,c=0,u=0,d=0,p=0,m=s[0],h=.75*m|0;for(;t;){const f=i[p];if(248&f)d=_l(e,d,f,s[255&p]),p+=2,t-=2,o=a;else{{const t=[];let a=256*l,s=256*c,i=256*u;for(let e=0;e<5;e++){const o=Tl(255&a>>8),l=Tl(255&s>>8),c=(255&i>>8)<129?-112:112;let u=o*(15&r[0][p])+l*(15&r[1][p])+c*(15&r[2][p]);u/=32,u+=128,t[e]=0|u,a+=256*n[0][p]/4,s+=256*n[1][p]/4,i+=256*n[2][p]/4}e.ary(0,t)}if(o--,0===o){if(p++,0===--t)return;o=a}if(m--,0!==m){if(h--,0!==h||0===f){l+=n[0][p],c+=n[1][p],u+=n[2][p];continue}d=_l(e,d,f,s[255&p])}}m=s[p],h=.75*m|0,l=0,c=0,u=0}})(o,l,s,c,u,d,p),o.get()},Ol=(e,t,a,n)=>{for(let s=0;s<n.length;s++)s++},Il=function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=gl(e);return!1!==a&&Al(a,t.pitch,t.mouth,t.throat,t.speed,t.singmode)},Fl=e=>{const t=" "+e.toUpperCase();let a=0,n="";const s=(e,t)=>{a+=t,n+=e};let r=0;for(;a<t.length&&r++<1e4;){t.toLowerCase();const e=t[a];if("."!==e||sl(t,a+1,1)){if(nl(e,2)){ll.some(e=>e(t,a,s));continue}if(0!==el[e]){if(!nl(e,al))return!1;ol[e].some(e=>e(t,a,s));continue}n+=" ",a++}else n+=".",a++}return n},Dl=Il,Rl=(e,t)=>{const a=Il(e,t);return!1!==a&&(e=>{const t=new Float32Array(e.length);for(let a=0;a<e.length;a++)t[a]=(e[a]-128)/256;return t})(a)};function jl(e){const t=e||{},a=(e,a)=>a||t.phonetic?e.toUpperCase():Fl(e);this.buf8=(e,n)=>Dl(a(e,n),t),this.buf32=(e,n)=>Rl(a(e,n),t),this.speak=(e,t)=>Qo(this.buf32(e,t)),this.download=(e,t)=>{(e=>{const t=new Blob([Jo(e)],{type:"audio/vnd.wave"}),a=window.URL||window.webkitURL,n=a.createObjectURL(t),s=document.createElement("a");s.href=n,s.target="_blank",s.download="sam.wav",document.body.appendChild(s),s.click(),document.body.removeChild(s),a.revokeObjectURL(n)})(this.buf8(e,t))},this.wav=(e,t)=>Jo(this.buf8(e,t))}jl.buf8=Dl,jl.buf32=Rl,jl.convert=Fl;class Bl{name="SAMSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(e){this.audioContext=us(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={...e},this._readyPromise=new Promise(e=>{this._readyResolve=e}),this._sam=new jl({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()}async ready(){return this._readyPromise}async ensureInitialized(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch{}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const a=this.audioContext.createBufferSource();a.buffer=this._buffer,a.loop=this._config.singmode,a.connect(this._playerGain),a.onended=()=>{this._sourceNode===a&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=a,a.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,this._config.phonetic);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const a=this._isPlaying;this._buffer=t,a&&this._config.singmode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,a=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.mouth&&e.mouth!==this._config.mouth||void 0!==e.throat&&e.throat!==this._config.throat||void 0!==e.singmode&&e.singmode!==this._config.singmode||void 0!==e.phonetic&&e.phonetic!==this._config.phonetic,n=void 0!==e.vowelSequence&&JSON.stringify(e.vowelSequence)!==JSON.stringify(this._config.vowelSequence);this._config={...this._config,...e},void 0!==e.vowelLoopSingle&&(this._vowelLoopSingle=e.vowelLoopSingle),n&&(this._vowelSequence=e.vowelSequence??[],this._vowelIndex=0),void 0!==e.singmode&&this._sourceNode&&(this._sourceNode.loop=e.singmode),(a||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{this._sam=new jl({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:this._config.singmode,phonetic:this._config.phonetic}),this._render()},50))}_renderVowel(e){const t=new jl({pitch:this._config.pitch,speed:this._config.speed,mouth:this._config.mouth,throat:this._config.throat,singmode:!0,phonetic:!0}).buf32(e,!0);if(!t)return null;const a=this.audioContext.createBuffer(1,t.length,22050);return a.getChannelData(0).set(t),a}triggerAttack(e,t,a=1){if(this._config.singmode&&this._vowelSequence.length>0){const n=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const s=this._renderVowel(n);if(!s)return;this._buffer=s;const r="string"==typeof e?gs(e):e,i=Math.pow(2,(r-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=a,this._stopSource();const o=this.audioContext.createBufferSource();return o.buffer=s,o.loop=this._vowelLoopSingle,o.connect(this._playerGain),o.onended=()=>{this._sourceNode===o&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=o,o.playbackRate.value=i,o.start(t,0),void(this._isPlaying=!0)}if(this._buffer)if(this._config.singmode){const n="string"==typeof e?gs(e):e,s=Math.pow(2,(n-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=a,this._isPlaying&&this._sourceNode?(this._sourceNode.playbackRate.cancelScheduledValues(this.audioContext.currentTime),this._sourceNode.playbackRate.setTargetAtTime(s,this.audioContext.currentTime,.06)):(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=s))}else this._startSource(t),this._playerGain.gain.value=a}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n)}triggerRelease(e){if(this._config.singmode&&this._isPlaying){const t=e??this.audioContext.currentTime;this._playerGain.gain.cancelScheduledValues(t),this._playerGain.gain.setValueAtTime(this._playerGain.gain.value,t),this._playerGain.gain.linearRampToValueAtTime(0,t+.05),setTimeout(()=>this._stopSource(),80)}}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}class Ll{name="V2Synth";output;_worklet=null;_initialized=!1;_initPromise;_pendingNotes=[];_releaseTimers=new Set;_initialConfig;constructor(e){this.output=us().createGain(),this._initialConfig=e,this._initPromise=this._initialize()}async _initialize(){const e=us();if("running"!==e.state){try{await e.resume()}catch{}"running"!==e.state&&await Promise.race([new Promise(t=>{const a=()=>{"running"===e.state?t():setTimeout(a,100)};setTimeout(a,100)}),new Promise((e,t)=>setTimeout(()=>t(new Error("AudioContext not running after 5s")),5e3))])}const t="/DEViLBOX/",a=`?v=${Date.now()}`;try{await e.audioWorklet.addModule(`${t}V2Synth.worklet.js${a}`)}catch{}const[n,s]=await Promise.all([fetch(`${t}V2Synth.wasm${a}`,{cache:"no-store"}),fetch(`${t}V2Synth.js${a}`,{cache:"no-store"})]);if(!n.ok)throw new Error(`Failed to load V2Synth.wasm: ${n.status}`);if(!s.ok)throw new Error(`Failed to load V2Synth.js: ${s.status}`);const[r,i]=await Promise.all([n.arrayBuffer(),s.text()]),o='if(typeof URL==="undefined"){globalThis.URL=class{constructor(p,b){this.href=(b||"")+p;this.pathname=p;}};}\n'+i.replace(/import\.meta\.url/g,`"${t}"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory').replace(/(_malloc=wasmExports\["\w+"\])/,'$1;Module["_malloc"]=_malloc').replace(/(_free=wasmExports\["\w+"\])/,'$1;Module["_free"]=_free');this._worklet=new AudioWorkletNode(e,"v2-synth-processor",{outputChannelCount:[2]}),await new Promise((e,t)=>{const a=setTimeout(()=>{t(new Error("V2Synth initialization timeout after 10s"))},1e4);this._worklet.port.onmessage=t=>{"ready"===t.data.type?(clearTimeout(a),this._initialized=!0,this._initialConfig&&this._applyV2Config(this._initialConfig),this._pendingNotes.forEach(e=>this._sendMIDI([144,e.note,e.vel])),this._pendingNotes=[],e()):t.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:r,jsCode:o})}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch(l){}}async ready(){return this._initPromise}async ensureInitialized(){return this._initPromise}triggerAttack(e,t,a=1){const n="string"==typeof e?gs(e):e,s=Math.floor(127*a);this._initialized?this._sendMIDI([144,n,s]):this._pendingNotes.push({note:n,vel:s})}triggerRelease(){this._initialized}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,void 0,n);const s="string"==typeof e?gs(e):e,r="number"==typeof t?t:parseFloat(String(t)),i=setTimeout(()=>{this._releaseTimers.delete(i),this._initialized&&this._worklet&&this._sendMIDI([128,s,0])},1e3*r);this._releaseTimers.add(i)}setParameter(e,t){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"param",index:e,value:t})}applyConfig(e){this._initialized?this._applyV2Config(e):this._initialConfig=e}_applyV2Config(e){e.osc1&&(this.setParameter(2,e.osc1.mode),this.setParameter(4,e.osc1.transpose+64),this.setParameter(5,e.osc1.detune+64),this.setParameter(6,e.osc1.color),this.setParameter(7,e.osc1.level)),e.osc2&&(this.setParameter(8,e.osc2.mode),this.setParameter(9,e.osc2.ringMod?1:0),this.setParameter(10,e.osc2.transpose+64),this.setParameter(11,e.osc2.detune+64),this.setParameter(12,e.osc2.color),this.setParameter(13,e.osc2.level)),e.osc3&&(this.setParameter(14,e.osc3.mode),this.setParameter(15,e.osc3.ringMod?1:0),this.setParameter(16,e.osc3.transpose+64),this.setParameter(17,e.osc3.detune+64),this.setParameter(18,e.osc3.color),this.setParameter(19,e.osc3.level)),e.filter1&&(this.setParameter(20,e.filter1.mode),this.setParameter(21,e.filter1.cutoff),this.setParameter(22,e.filter1.resonance)),e.filter2&&(this.setParameter(23,e.filter2.mode),this.setParameter(24,e.filter2.cutoff),this.setParameter(25,e.filter2.resonance)),e.routing&&(this.setParameter(26,e.routing.mode),this.setParameter(27,e.routing.balance)),e.envelope&&(this.setParameter(32,e.envelope.attack),this.setParameter(33,e.envelope.decay),this.setParameter(34,e.envelope.sustain),this.setParameter(36,e.envelope.release)),e.envelope2&&(this.setParameter(38,e.envelope2.attack),this.setParameter(39,e.envelope2.decay),this.setParameter(40,e.envelope2.sustain),this.setParameter(42,e.envelope2.release)),e.lfo1&&(this.setParameter(47,e.lfo1.rate),this.setParameter(50,e.lfo1.depth))}_sendMIDI(e){this._worklet&&this._initialized&&this._worklet.port.postMessage({type:"midi",msg:e})}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._initialized=!1,this._worklet&&this._worklet.disconnect(),this.output.disconnect()}}class Vl{name="V2SpeechSynth";output;audioContext;_sourceNode=null;_playerGain;_sam;_config;_buffer=null;_isRendering=!1;_isPlaying=!1;_ready=!1;_readyPromise;_readyResolve;_renderTimer=null;_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(e){this.audioContext=us(),this.output=this.audioContext.createGain(),this._playerGain=this.audioContext.createGain(),this._playerGain.connect(this.output),this._config={text:"!kwIH_k !fAA_ks",speed:64,pitch:64,formantShift:64,singMode:!0,...e},this._readyPromise=new Promise(e=>{this._readyResolve=e});const t=Math.round(this._config.pitch/127*255),a=Math.round(this._config.speed/127*255),n=(this._config.formantShift-64)/64*50,s=Math.max(0,Math.min(255,128+n)),r=Math.max(0,Math.min(255,128-n));this._sam=new jl({pitch:t,speed:a,mouth:Math.round(s),throat:Math.round(r),singmode:this._config.singMode,phonetic:!1}),this._render()}async ready(){return this._readyPromise}_stopSource(){if(this._sourceNode){try{this._sourceNode.stop()}catch{}this._sourceNode.disconnect(),this._sourceNode=null}this._isPlaying=!1}_startSource(e,t){if(!this._buffer)return;this._stopSource();const a=this.audioContext.createBufferSource();a.buffer=this._buffer,a.loop=this._config.singMode,a.connect(this._playerGain),a.onended=()=>{this._sourceNode===a&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=a,a.start(e,t??0),this._isPlaying=!0}async _render(){if(!this._isRendering){this._isRendering=!0;try{const e=this._sam.buf32(this._config.text,!1);if(e){const t=this.audioContext.createBuffer(1,e.length,22050);t.getChannelData(0).set(e);const a=this._isPlaying;this._buffer=t,a&&this._config.singMode&&this._startSource(),this._ready||(this._ready=!0,this._readyResolve())}}catch(e){}finally{this._isRendering=!1}}}applyConfig(e){const t=void 0!==e.text&&e.text!==this._config.text,a=void 0!==e.pitch&&e.pitch!==this._config.pitch||void 0!==e.speed&&e.speed!==this._config.speed||void 0!==e.formantShift&&e.formantShift!==this._config.formantShift||void 0!==e.singMode&&e.singMode!==this._config.singMode,n=void 0!==e.vowelSequence&&JSON.stringify(e.vowelSequence)!==JSON.stringify(this._config.vowelSequence);this._config={...this._config,...e},void 0!==e.vowelLoopSingle&&(this._vowelLoopSingle=e.vowelLoopSingle),n&&(this._vowelSequence=e.vowelSequence??[],this._vowelIndex=0),void 0!==e.singMode&&this._sourceNode&&(this._sourceNode.loop=e.singMode),(a||t)&&(this._renderTimer&&clearTimeout(this._renderTimer),this._renderTimer=setTimeout(()=>{const e=Math.round(this._config.pitch/127*255),t=Math.round(this._config.speed/127*255),a=(this._config.formantShift-64)/64*50,n=Math.max(0,Math.min(255,128+a)),s=Math.max(0,Math.min(255,128-a));this._sam=new jl({pitch:e,speed:t,mouth:Math.round(n),throat:Math.round(s),singmode:this._config.singMode,phonetic:!1}),this._render()},50))}_renderVowel(e){const t=Math.round(this._config.pitch/127*255),a=Math.round(this._config.speed/127*255),n=(this._config.formantShift-64)/64*50,s=Math.max(0,Math.min(255,128+n)),r=Math.max(0,Math.min(255,128-n)),i=new jl({pitch:t,speed:a,mouth:Math.round(s),throat:Math.round(r),singmode:!0,phonetic:!0}).buf32(e,!0);if(!i)return null;const o=this.audioContext.createBuffer(1,i.length,22050);return o.getChannelData(0).set(i),o}triggerAttack(e,t,a=1){if(this._config.singMode&&this._vowelSequence.length>0){const n=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const s=this._renderVowel(n);if(!s)return;this._buffer=s;const r="string"==typeof e?gs(e):e,i=Math.pow(2,(r-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=a,this._stopSource();const o=this.audioContext.createBufferSource();return o.buffer=s,o.loop=this._vowelLoopSingle,o.connect(this._playerGain),o.onended=()=>{this._sourceNode===o&&(this._isPlaying=!1,this._sourceNode=null)},this._sourceNode=o,o.playbackRate.value=i,o.start(t,0),void(this._isPlaying=!0)}if(this._buffer)if(this._config.singMode){const n="string"==typeof e?gs(e):e,s=Math.pow(2,(n-48)/12);this._playerGain.gain.cancelScheduledValues(this.audioContext.currentTime),this._playerGain.gain.value=a,this._isPlaying&&this._sourceNode?(this._sourceNode.playbackRate.cancelScheduledValues(this.audioContext.currentTime),this._sourceNode.playbackRate.setTargetAtTime(s,this.audioContext.currentTime,.06)):(this._startSource(t),this._sourceNode&&(this._sourceNode.playbackRate.value=s))}else this._startSource(t),this._playerGain.gain.value=a}triggerRelease(e){if(this._config.singMode&&this._isPlaying){const t=e??this.audioContext.currentTime;this._playerGain.gain.setValueAtTime(this._playerGain.gain.value,t),this._playerGain.gain.linearRampToValueAtTime(0,t+.05),setTimeout(()=>this._stopSource(),80)}}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n)}dispose(){this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._stopSource(),this._playerGain.disconnect(),this.output.disconnect()}}const zl={ARGURU_DISTORTION:"ArguruDistortion",ELAK_DIST2:"ElakDist2",JESKOLA_DISTORTION:"JeskolaDistortion",GEONIK_OVERDRIVE:"GeonikOverdrive",GRAUE_SOFTSAT:"GraueSoftSat",WHITENOISE_STEREODIST:"WhiteNoiseStereoDist",ELAK_SVF:"ElakSVF",CYANPHASE_NOTCH:"CyanPhaseNotch",Q_ZFILTER:"QZfilter",FSM_PHILTA:"FSMPhilta",JESKOLA_DELAY:"JeskolaDelay",JESKOLA_CROSSDELAY:"JeskolaCrossDelay",JESKOLA_FREEVERB:"JeskolaFreeverb",FSM_PANZERDELAY:"FSMPanzerDelay",FSM_CHORUS:"FSMChorus",FSM_CHORUS2:"FSMChorus2",WHITENOISE_WHITECHORUS:"WhiteNoiseWhiteChorus",BIGYO_FREQUENCYSHIFTER:"BigyoFrequencyShifter",GEONIK_COMPRESSOR:"GeonikCompressor",LD_SLIMIT:"LdSLimit",OOMEK_EXCITER:"OomekExciter",OOMEK_MASTERIZER:"OomekMasterizer",DEDACODE_STEREOGAIN:"DedaCodeStereoGain",FSM_KICK:"FSMKick",FSM_KICKXP:"FSMKickXP",JESKOLA_TRILOK:"JeskolaTrilok",JESKOLA_NOISE:"JeskolaNoise",OOMEK_AGGRESSOR:"OomekAggressor",OOMEK_AGGRESSOR_DF:"OomekAggressorDF",MADBRAIN_4FM2F:"MadBrain4FM2F",MADBRAIN_DYNAMITE6:"MadBrainDynamite6",MAKK_M3:"MakkM3",MAKK_M4:"MakkM4",CYANPHASE_DTMF:"CyanPhaseDTMF",ELENZIL_FREQUENCYBOMB:"ElenzilFrequencyBomb"},Ul={[zl.ARGURU_DISTORTION]:{name:"Arguru Distortion",shortName:"Distortion",author:"Arguru",type:"effect",parameters:[{index:0,name:"Input Gain",description:"Input Gain",minValue:1,maxValue:2048,defaultValue:256,type:"word"},{index:1,name:"Threshold (-)",description:"Threshold level (negative)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:2,name:"Threshold (+)",description:"Threshold level (positive)",minValue:1,maxValue:32768,defaultValue:512,type:"word"},{index:3,name:"Output Gain",description:"Output Gain",minValue:1,maxValue:2048,defaultValue:1024,type:"word"},{index:4,name:"Phase Inversor",description:"Stereo phase inversor",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:5,name:"Mode",description:"Operational mode (0=Clip, 1=Saturate)",minValue:0,maxValue:1,defaultValue:0,type:"byte"}]},[zl.ELAK_SVF]:{name:"Elak SVF Filter",shortName:"SVF",author:"Elak",type:"effect",parameters:[{index:0,name:"Cutoff",description:"Cut-off frequency",minValue:0,maxValue:1e3,defaultValue:512,type:"word"},{index:1,name:"Resonance",description:"Resonance",minValue:0,maxValue:65534,defaultValue:512,type:"word"}]},[zl.FSM_KICK]:{name:"FSM Kick",shortName:"Kick",author:"FSM",type:"generator",parameters:[]},[zl.FSM_KICKXP]:{name:"FSM KickXP",shortName:"KickXP",author:"FSM",type:"generator",parameters:[]},[zl.JESKOLA_TRILOK]:{name:"Jeskola Trilok",shortName:"Trilok",author:"Jeskola",type:"generator",parameters:[]},[zl.JESKOLA_NOISE]:{name:"Jeskola Noise",shortName:"Noise",author:"Jeskola",type:"generator",parameters:[]},[zl.OOMEK_AGGRESSOR]:{name:"Oomek Aggressor",shortName:"Aggressor",author:"Oomek",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"}]},[zl.OOMEK_AGGRESSOR_DF]:{name:"Oomek Aggressor Devil Fish",shortName:"AggressorDF",author:"Oomek + Devil Fish Mods",type:"generator",parameters:[{index:0,name:"Osc Type",description:"Oscillator type (0 = Saw, 1 = Square)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:1,name:"Cutoff",description:"Filter cutoff frequency",minValue:0,maxValue:240,defaultValue:120,type:"byte"},{index:2,name:"Resonance",description:"Filter resonance",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:3,name:"Env Mod",description:"Envelope modulation depth",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:4,name:"Decay",description:"Normal envelope decay time",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:5,name:"Accent Level",description:"Accent level boost",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:6,name:"Finetune",description:"Fine tuning in cents (-100 to +100)",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:7,name:"Volume",description:"Output volume",minValue:0,maxValue:200,defaultValue:100,type:"byte"},{index:8,name:"Accent Decay",description:"Accent envelope decay time (Devil Fish)",minValue:0,maxValue:128,defaultValue:64,type:"byte"},{index:9,name:"VEG Decay",description:"Volume envelope decay (Devil Fish)",minValue:0,maxValue:128,defaultValue:96,type:"byte"},{index:10,name:"VEG Sustain",description:"Volume envelope sustain 0-100% (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:11,name:"Soft Attack",description:"Soft attack time 0.3-30ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:0,type:"byte"},{index:12,name:"Filter Tracking",description:"Filter tracking 0-200% (Devil Fish)",minValue:0,maxValue:200,defaultValue:0,type:"byte"},{index:13,name:"High Resonance",description:"High resonance mode - self oscillation (Devil Fish)",minValue:0,maxValue:1,defaultValue:0,type:"byte"},{index:14,name:"Slide Time",description:"Slide/glide time 10-500ms (Devil Fish)",minValue:0,maxValue:100,defaultValue:30,type:"byte"},{index:15,name:"Muffler",description:"Output soft clipping 0=off, 1=soft, 2=hard (Devil Fish)",minValue:0,maxValue:2,defaultValue:0,type:"byte"},{index:16,name:"Sweep Speed",description:"Accent sweep speed 0=fast, 1=normal, 2=slow (Devil Fish)",minValue:0,maxValue:2,defaultValue:1,type:"byte"}]},[zl.MADBRAIN_4FM2F]:{name:"MadBrain 4FM2F",shortName:"4FM2F",author:"MadBrain",type:"generator",parameters:[]},[zl.MADBRAIN_DYNAMITE6]:{name:"MadBrain Dynamite6",shortName:"Dynamite6",author:"MadBrain",type:"generator",parameters:[]},[zl.MAKK_M3]:{name:"Makk M3",shortName:"M3",author:"Makk",type:"generator",parameters:[]},[zl.MAKK_M4]:{name:"Makk M4",shortName:"M4",author:"Makk",type:"generator",parameters:[]},[zl.ELAK_DIST2]:{name:"Elak Dist2",shortName:"Dist2",author:"Elak",type:"effect",parameters:[]},[zl.JESKOLA_DISTORTION]:{name:"Jeskola Distortion",shortName:"JDist",author:"Jeskola",type:"effect",parameters:[]},[zl.GEONIK_OVERDRIVE]:{name:"Geonik Overdrive",shortName:"Overdrive",author:"Geonik",type:"effect",parameters:[]},[zl.GRAUE_SOFTSAT]:{name:"Graue SoftSat",shortName:"SoftSat",author:"Graue",type:"effect",parameters:[]},[zl.WHITENOISE_STEREODIST]:{name:"WhiteNoise StereoDist",shortName:"StereoDist",author:"WhiteNoise",type:"effect",parameters:[]},[zl.CYANPHASE_NOTCH]:{name:"CyanPhase Notch",shortName:"Notch",author:"CyanPhase",type:"effect",parameters:[]},[zl.Q_ZFILTER]:{name:"Q Zfilter",shortName:"Zfilter",author:"Q",type:"effect",parameters:[]},[zl.FSM_PHILTA]:{name:"FSM Philta",shortName:"Philta",author:"FSM",type:"effect",parameters:[]},[zl.JESKOLA_DELAY]:{name:"Jeskola Delay",shortName:"JDelay",author:"Jeskola",type:"effect",parameters:[]},[zl.JESKOLA_CROSSDELAY]:{name:"Jeskola CrossDelay",shortName:"CrossDelay",author:"Jeskola",type:"effect",parameters:[]},[zl.JESKOLA_FREEVERB]:{name:"Jeskola Freeverb",shortName:"Freeverb",author:"Jeskola",type:"effect",parameters:[]},[zl.FSM_PANZERDELAY]:{name:"FSM PanzerDelay",shortName:"PanzerDelay",author:"FSM",type:"effect",parameters:[]},[zl.FSM_CHORUS]:{name:"FSM Chorus",shortName:"Chorus",author:"FSM",type:"effect",parameters:[]},[zl.FSM_CHORUS2]:{name:"FSM Chorus2",shortName:"Chorus2",author:"FSM",type:"effect",parameters:[]},[zl.WHITENOISE_WHITECHORUS]:{name:"WhiteNoise WhiteChorus",shortName:"WhiteChorus",author:"WhiteNoise",type:"effect",parameters:[]},[zl.BIGYO_FREQUENCYSHIFTER]:{name:"Bigyo FrequencyShifter",shortName:"FreqShift",author:"Bigyo",type:"effect",parameters:[]},[zl.GEONIK_COMPRESSOR]:{name:"Geonik Compressor",shortName:"Compressor",author:"Geonik",type:"effect",parameters:[]},[zl.LD_SLIMIT]:{name:"Ld SLimit",shortName:"SLimit",author:"Ld",type:"effect",parameters:[]},[zl.OOMEK_EXCITER]:{name:"Oomek Exciter",shortName:"Exciter",author:"Oomek",type:"effect",parameters:[]},[zl.OOMEK_MASTERIZER]:{name:"Oomek Masterizer",shortName:"Masterizer",author:"Oomek",type:"master",parameters:[]},[zl.DEDACODE_STEREOGAIN]:{name:"DedaCode StereoGain",shortName:"StereoGain",author:"DedaCode",type:"effect",parameters:[]},[zl.CYANPHASE_DTMF]:{name:"CyanPhase DTMF",shortName:"DTMF",author:"CyanPhase",type:"generator",parameters:[]},[zl.ELENZIL_FREQUENCYBOMB]:{name:"Elenzil FrequencyBomb",shortName:"FreqBomb",author:"Elenzil",type:"generator",parameters:[]}};class Gl{static instance=null;isLoaded=!1;initPromise=null;workletNode=null;nativeContext=null;constructor(){}static getInstance(){return Gl.instance||(Gl.instance=new Gl),Gl.instance}async init(e){if(!this.isLoaded)return this.initPromise||(this.initPromise=this.doInit(e)),this.initPromise}async doInit(e){try{const t=e,a=t.rawContext||t._context||ds(e);if(this.nativeContext=a,!a||!a.audioWorklet)return void(this.initPromise=null);if("running"!==a.state){try{await a.resume()}catch{}if("running"!==a.state){if(!(await Promise.race([new Promise(e=>{const t=()=>{"running"===a.state?e(!0):setTimeout(t,100)};setTimeout(t,100)}),new Promise(e=>setTimeout(()=>e(!1),5e3))])))return void(this.initPromise=null)}}const n="/DEViLBOX/",s=`?v=${Date.now()}`;await a.audioWorklet.addModule(`${n}Buzzmachine.worklet.js${s}`),this.isLoaded=!0}catch(t){throw this.initPromise=null,t}}isInitialized(){return this.isLoaded}async createMachineNode(e,t){this.isLoaded||await this.init(e);const a=e,n=a.rawContext||a._context||ds(e),s=new AudioWorkletNode(n,"buzzmachine-processor",{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[2]});return await this.loadMachineWasm(s,t),s}async loadMachineWasm(e,t){const a=this.getMachineFilename(t),n="/DEViLBOX/",[s,r]=await Promise.all([fetch(`${n}buzzmachines/${a}.js`),fetch(`${n}buzzmachines/${a}.wasm`)]);if(!s.ok||!r.ok)throw new Error(`Failed to load buzzmachine: ${t}`);const i=await s.text(),o=await r.arrayBuffer();return new Promise((a,n)=>{const s=setTimeout(()=>{n(new Error("Buzzmachine init timeout"))},5e3);e.port.onmessage=e=>{"initialized"===e.data.type?(clearTimeout(s),a()):"error"===e.data.type&&(clearTimeout(s),n(new Error(e.data.error)))},e.port.postMessage({type:"init",wasmBinary:o,jsCode:i,machineType:t})})}getMachineFilename(e){const t={[zl.ARGURU_DISTORTION]:"Arguru_Distortion",[zl.ELAK_DIST2]:"Elak_Dist2",[zl.JESKOLA_DISTORTION]:"Jeskola_Distortion",[zl.GEONIK_OVERDRIVE]:"Geonik_Overdrive",[zl.GRAUE_SOFTSAT]:"Graue_SoftSat",[zl.WHITENOISE_STEREODIST]:"WhiteNoise_StereoDist",[zl.ELAK_SVF]:"Elak_SVF",[zl.CYANPHASE_NOTCH]:"CyanPhase_Notch",[zl.Q_ZFILTER]:"Q_Zfilter",[zl.FSM_PHILTA]:"FSM_Philta",[zl.JESKOLA_DELAY]:"Jeskola_Delay",[zl.JESKOLA_CROSSDELAY]:"Jeskola_CrossDelay",[zl.JESKOLA_FREEVERB]:"Jeskola_Freeverb",[zl.FSM_PANZERDELAY]:"FSM_PanzerDelay",[zl.FSM_CHORUS]:"FSM_Chorus",[zl.FSM_CHORUS2]:"FSM_Chorus2",[zl.WHITENOISE_WHITECHORUS]:"WhiteNoise_WhiteChorus",[zl.BIGYO_FREQUENCYSHIFTER]:"Bigyo_FrequencyShifter",[zl.GEONIK_COMPRESSOR]:"Geonik_Compressor",[zl.LD_SLIMIT]:"Ld_SLimit",[zl.OOMEK_EXCITER]:"Oomek_Exciter",[zl.OOMEK_MASTERIZER]:"Oomek_Masterizer",[zl.DEDACODE_STEREOGAIN]:"DedaCode_StereoGain",[zl.FSM_KICK]:"FSM_Kick",[zl.FSM_KICKXP]:"FSM_KickXP",[zl.JESKOLA_TRILOK]:"Jeskola_Trilok",[zl.JESKOLA_NOISE]:"Jeskola_Noise",[zl.OOMEK_AGGRESSOR]:"Oomek_Aggressor",[zl.OOMEK_AGGRESSOR_DF]:"Oomek_Aggressor_DF",[zl.MADBRAIN_4FM2F]:"MadBrain_4FM2F",[zl.MADBRAIN_DYNAMITE6]:"MadBrain_Dynamite6",[zl.MAKK_M3]:"Makk_M3",[zl.MAKK_M4]:"Makk_M4",[zl.CYANPHASE_DTMF]:"CyanPhase_DTMF",[zl.ELENZIL_FREQUENCYBOMB]:"Elenzil_FrequencyBomb"}[e];if(!t)throw new Error(`Unknown machine type: ${e}`);return t}setParameter(e,t,a){e.port.postMessage({type:"setParameter",paramIndex:t,paramValue:a})}stop(e){e.port.postMessage({type:"stop"})}getMachineInfo(e){return Ul[e]}}class Wl{name="BuzzmachineGenerator";output;audioContext;engine=Gl.getInstance();machineType;workletNode=null;initInProgress=!1;useWasmEngine=!1;initError=null;errorReported=!1;preGain=null;overdrive=null;overdriveDry=null;overdriveWet=null;mufflerFilter=null;postFilter=null;postGain=null;overdriveAmount=0;mufflerMode="off";filterTrackingAmount=0;currentCutoff=1e3;constructor(e){this.audioContext=us(),this.machineType=e,this.output=this.audioContext.createGain(),this.is303Style()&&this.createEffectsChain(),this.initEngine()}createEffectsChain(){const e=this.audioContext;this.preGain=e.createGain(),this.overdrive=e.createWaveShaper(),this.overdrive.oversample="2x",this.updateOverdriveCurve(.4),this.overdriveDry=e.createGain(),this.overdriveDry.gain.value=1,this.overdriveWet=e.createGain(),this.overdriveWet.gain.value=0,this.mufflerFilter=e.createBiquadFilter(),this.mufflerFilter.type="lowpass",this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7,this.postFilter=e.createBiquadFilter(),this.postFilter.type="lowpass",this.postFilter.frequency.value=2e4,this.postFilter.Q.value=1,this.postGain=e.createGain();const t=e.createGain();this.preGain.connect(this.overdriveDry),this.preGain.connect(this.overdrive),this.overdrive.connect(this.overdriveWet),this.overdriveDry.connect(t),this.overdriveWet.connect(t),t.connect(this.mufflerFilter),this.mufflerFilter.connect(this.postFilter),this.postFilter.connect(this.postGain),this.postGain.connect(this.output)}updateOverdriveCurve(e){if(!this.overdrive)return;const t=4096,a=new Float32Array(t),n=100*e;for(let s=0;s<t;s++){const e=s/t*2-1;a[s]=(1+n)*e/(1+n*Math.abs(e))}this.overdrive.curve=a}async ensureInitialized(){if(!this.useWasmEngine)if(this.initInProgress)for(let e=0;e<200&&(await new Promise(e=>setTimeout(e,50)),!this.useWasmEngine&&this.initInProgress);e++);else await this.initEngine()}async initEngine(){if(!this.initInProgress&&!this.useWasmEngine){this.initInProgress=!0;try{const e=this.audioContext;if(await this.engine.init(e),this.workletNode=await this.engine.createMachineNode(e,this.machineType),!this.workletNode)throw new Error("Worklet node creation failed");const t=this.is303Style()&&this.preGain?this.preGain:this.output;this.workletNode.connect(t);try{const e=this.audioContext.createGain();e.gain.value=0,this.workletNode.connect(e),e.connect(this.audioContext.destination)}catch{}this.useWasmEngine=!0}catch(e){this.initError=e instanceof Error?e:new Error(String(e)),this.useWasmEngine=!1,this.reportInitError()}finally{this.initInProgress=!1}}}reportInitError(){if(this.errorReported||!this.initError)return;this.errorReported=!0;const e=Ul[this.machineType];go("BuzzmachineGenerator",this.initError.message,{synthName:e?.name??this.machineType,errorType:"wasm",error:this.initError,debugData:{machineType:this.machineType,machineKind:e?.type,wasmSupported:"undefined"!=typeof WebAssembly}})}triggerAttack(e,t,a=1,n,s){if(!this.useWasmEngine||!this.workletNode)return;const r=bs(e);this.is303Style()&&this.filterTrackingAmount>0&&this.applyFilterTracking(r),this.workletNode.port.postMessage({type:"noteOn",frequency:r,velocity:Math.round(127*a),time:t,accent:n,slide:s})}triggerRelease(e){this.useWasmEngine&&this.workletNode&&this.workletNode.port.postMessage({type:"noteOff",time:e})}triggerAttackRelease(e,t,a,n=1,s,r){const i=void 0!==a?xs(a):vs(),o=xs(t);this.triggerAttack(e,i,n,s,r),this.triggerRelease(i+o)}setParameter(e,t){this.useWasmEngine&&this.workletNode&&this.engine.setParameter(this.workletNode,e,t)}getParameters(){return this.engine.getMachineInfo(this.machineType).parameters}stop(){this.useWasmEngine&&this.workletNode&&this.engine.stop(this.workletNode)}releaseAll(){this.stop()}is303Style(){return this.machineType===zl.OOMEK_AGGRESSOR||this.machineType===zl.OOMEK_AGGRESSOR_DF}isDevilFishWasm(){return this.machineType===zl.OOMEK_AGGRESSOR_DF}setCutoff(e){if(!this.is303Style())return;const t=200*Math.pow(100,e);this.currentCutoff=Math.max(200,Math.min(5e3,t)),this.postFilter&&0===this.filterTrackingAmount&&(this.postFilter.frequency.value=Math.min(18e3,1.5*this.currentCutoff));const a=Math.round(240*e);this.setParameter(1,Math.min(240,Math.max(0,a)))}setResonance(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(2,Math.min(128,Math.max(0,t)))}setEnvMod(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(3,Math.min(128,Math.max(0,t)))}setDecay(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(4,Math.min(128,Math.max(0,t)))}setAccentAmount(e){if(!this.is303Style())return;const t=Math.round(128*e);this.setParameter(5,Math.min(128,Math.max(0,t)))}setAccent(e){this.setAccentAmount(e)}setTuning(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(6,Math.min(200,Math.max(0,t)))}setVolume(e){if(!this.is303Style())return;const t=Math.round(200*e);this.setParameter(7,Math.min(200,Math.max(0,t)))}setWaveform(e){if(!this.is303Style())return;let t;t="number"==typeof e?e>=.5?1:0:"square"===e?1:0,this.setParameter(0,t)}setSlideTime(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(14,t)}}enableDevilFish(e,t){this.is303Style()&&(e?(this.setOverdrive(t?.overdrive??.3),this.setMuffler(t?.muffler??"mid"),this.setHighResonanceEnabled(!0),this.isDevilFishWasm()&&(this.setFilterTracking(.5),this.setSlideTime(.17),this.setSweepSpeed("normal"))):(this.setOverdrive(0),this.setMuffler("off"),this.setHighResonanceEnabled(!1),this.setFilterTracking(0)))}setOverdrive(e){if(this.is303Style()&&this.overdrive)if(this.overdriveAmount=Math.min(Math.max(e,0),1),0===this.overdriveAmount)this.overdriveDry&&(this.overdriveDry.gain.value=1),this.overdriveWet&&(this.overdriveWet.gain.value=0);else{const e=.8*this.overdriveAmount;this.overdriveDry&&(this.overdriveDry.gain.value=1-e),this.overdriveWet&&(this.overdriveWet.gain.value=e),this.updateOverdriveCurve(.2+.6*this.overdriveAmount)}}setMuffler(e){if(this.is303Style()){if(this.mufflerMode=e,this.isDevilFishWasm()){let e;switch(this.mufflerMode){case"dark":case"mid":e=1;break;case"bright":e=2;break;default:e=0}this.setParameter(15,e)}if(this.mufflerFilter)switch(this.mufflerMode){case"dark":this.mufflerFilter.frequency.value=2e3,this.mufflerFilter.Q.value=.5;break;case"mid":this.mufflerFilter.frequency.value=6e3,this.mufflerFilter.Q.value=.7;break;case"bright":this.mufflerFilter.frequency.value=12e3,this.mufflerFilter.Q.value=.7;break;default:this.mufflerFilter.frequency.value=2e4,this.mufflerFilter.Q.value=.7}}}applyFilterTracking(e){if(!this.postFilter||0===this.filterTrackingAmount)return;const t=Math.log2(e/440)*this.filterTrackingAmount*2e3,a=Math.max(200,Math.min(18e3,this.currentCutoff+t));this.postFilter.frequency.value=a}setFilterTracking(e){if(this.is303Style()&&(this.filterTrackingAmount=Math.min(Math.max(e,0),1),this.isDevilFishWasm())){const t=Math.round(200*e);this.setParameter(12,Math.min(200,t))}}setHighResonanceEnabled(e){this.is303Style()&&(this.isDevilFishWasm()&&this.setParameter(13,e?1:0),this.postFilter&&(this.postFilter.Q.value=e?4:1))}setHighResonance(e){this.setHighResonanceEnabled(e)}set(e,t){switch(e){case"cutoff":this.setCutoff(t);break;case"resonance":this.setResonance(t);break;case"envMod":this.setEnvMod(t);break;case"decay":this.setDecay(t);break;case"accent":this.setAccent(t);break;case"tuning":this.setTuning(t);break;case"volume":this.setVolume(t);break;case"waveform":this.setWaveform(t);break;case"slideTime":this.setSlideTime(t);break;case"overdrive":this.setOverdrive(t);break;case"normalDecay":this.setNormalDecay(t);break;case"accentDecay":this.setAccentDecay(t);break;case"softAttack":this.setSoftAttack(t);break;case"filterTracking":this.setFilterTracking(t);break;case"filterFmDepth":case"filterFM":this.setFilterFM(t);break;case"vegDecay":this.setVegDecay(t);break;case"vegSustain":this.setVegSustain(t)}}setNormalDecay(e){this.is303Style()&&this.setDecay(e)}setAccentDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(8,Math.min(128,Math.max(0,t)))}}setVegDecay(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(128*e);this.setParameter(9,Math.min(128,Math.max(0,t)))}}setVegSustain(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(10,t)}}setSoftAttack(e){if(this.is303Style()&&this.isDevilFishWasm()){const t=Math.round(100*e);this.setParameter(11,Math.min(100,Math.max(0,t)))}}setFilterFM(e){this.is303Style()&&this.isDevilFishWasm()&&this.setParameter(19,Math.round(100*e))}setSweepSpeed(e){if(this.is303Style()&&this.isDevilFishWasm()){let t;if("number"==typeof e)t=Math.round(2*e);else switch(e.toLowerCase()){case"fast":t=0;break;case"slow":t=2;break;default:t=1}this.setParameter(16,t)}}async loadGuitarMLModel(e){}async setGuitarMLEnabled(e){}setGuitarMLMix(e){}setQuality(e){}dispose(){this.output.disconnect(),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.preGain&&(this.preGain.disconnect(),this.preGain=null),this.overdrive&&(this.overdrive.disconnect(),this.overdrive=null),this.overdriveDry&&(this.overdriveDry.disconnect(),this.overdriveDry=null),this.overdriveWet&&(this.overdriveWet.disconnect(),this.overdriveWet=null),this.mufflerFilter&&(this.mufflerFilter.disconnect(),this.mufflerFilter=null),this.postFilter&&(this.postFilter.disconnect(),this.postFilter=null),this.postGain&&(this.postGain.disconnect(),this.postGain=null)}}const Hl=0,Kl=1,ql=2,$l=3,Xl=4,Yl=5,Zl=6,Ql=7,Jl=8,ec=9,tc=10,ac=11,nc=12,sc=13,rc=14,ic=15,oc=16,lc=17,cc=18,uc=19,dc=20,pc=126,mc=127,hc=128,fc=129,yc=130,gc=131,bc=132,vc=133,xc=134,wc=135,kc=136,Sc=137,Mc=138,Nc=139,Cc=140,Pc=141,Ec=142,_c=143,Tc=144,Ac={"E.PIANO 1":{algorithm:5,feedback:6,operators:[{level:99,coarse:1,fine:0,detune:7},{level:70,coarse:14,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:60,coarse:1,fine:0,detune:7},{level:99,coarse:1,fine:0,detune:7},{level:80,coarse:1,fine:0,detune:7}]},"BRASS 1":{algorithm:22,feedback:7},"STRINGS 1":{algorithm:2,feedback:4},"INIT VOICE":{algorithm:0,feedback:0}};class Oc{name="DexedSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=us().createGain(),this.config={algorithm:0,feedback:0,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=us(),t="/DEViLBOX/";Oc.isWorkletLoaded||(Oc.workletLoadPromise||(Oc.workletLoadPromise=e.audioWorklet.addModule(`${t}dexed/Dexed.worklet.js`)),await Oc.workletLoadPromise,Oc.isWorkletLoaded=!0);const[a,n]=await Promise.all([fetch(`${t}dexed/Dexed.wasm`),fetch(`${t}dexed/Dexed.js`)]);if(!a.ok)throw new Error(`Failed to load Dexed.wasm: ${a.status}`);if(!n.ok)throw new Error(`Failed to load Dexed.js: ${n.status}`);const[s,r]=await Promise.all([a.arrayBuffer(),n.text()]),i=r.replace(/import\.meta\.url/g,`"${t}dexed/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(e,"dexed-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:s,jsCode:i}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch{}}catch(e){throw e}}applyConfig(e){this._worklet&&this.isInitialized&&(void 0!==e.algorithm&&this.setParameter(xc,e.algorithm),void 0!==e.feedback&&this.setParameter(wc,e.feedback),void 0!==e.oscSync&&this.setParameter(kc,e.oscSync?1:0),void 0!==e.transpose&&this.setParameter(Tc,e.transpose),void 0!==e.lfoSpeed&&this.setParameter(Sc,e.lfoSpeed),void 0!==e.lfoDelay&&this.setParameter(Mc,e.lfoDelay),void 0!==e.lfoPmd&&this.setParameter(Nc,e.lfoPmd),void 0!==e.lfoAmd&&this.setParameter(Cc,e.lfoAmd),void 0!==e.lfoSync&&this.setParameter(Pc,e.lfoSync?1:0),void 0!==e.lfoWave&&this.setParameter(Ec,e.lfoWave),void 0!==e.lfoPms&&this.setParameter(_c,e.lfoPms),e.pitchEgRates&&(this.setParameter(pc,e.pitchEgRates[0]),this.setParameter(mc,e.pitchEgRates[1]),this.setParameter(hc,e.pitchEgRates[2]),this.setParameter(fc,e.pitchEgRates[3])),e.pitchEgLevels&&(this.setParameter(yc,e.pitchEgLevels[0]),this.setParameter(gc,e.pitchEgLevels[1]),this.setParameter(bc,e.pitchEgLevels[2]),this.setParameter(vc,e.pitchEgLevels[3])),e.operators&&e.operators.forEach((e,t)=>{if(t>=6)return;const a=21*t;void 0!==e.level&&this.setParameter(a+oc,e.level),void 0!==e.coarse&&this.setParameter(a+cc,e.coarse),void 0!==e.fine&&this.setParameter(a+uc,e.fine),void 0!==e.detune&&this.setParameter(a+dc,e.detune),void 0!==e.mode&&this.setParameter(a+lc,e.mode),e.egRates&&(this.setParameter(a+Hl,e.egRates[0]),this.setParameter(a+Kl,e.egRates[1]),this.setParameter(a+ql,e.egRates[2]),this.setParameter(a+$l,e.egRates[3])),e.egLevels&&(this.setParameter(a+Xl,e.egLevels[0]),this.setParameter(a+Yl,e.egLevels[1]),this.setParameter(a+Zl,e.egLevels[2]),this.setParameter(a+Ql,e.egLevels[3])),void 0!==e.breakPoint&&this.setParameter(a+Jl,e.breakPoint),void 0!==e.leftDepth&&this.setParameter(a+ec,e.leftDepth),void 0!==e.rightDepth&&this.setParameter(a+tc,e.rightDepth),void 0!==e.leftCurve&&this.setParameter(a+ac,e.leftCurve),void 0!==e.rightCurve&&this.setParameter(a+nc,e.rightCurve),void 0!==e.rateScaling&&this.setParameter(a+sc,e.rateScaling),void 0!==e.ampModSens&&this.setParameter(a+rc,e.ampModSens),void 0!==e.velocitySens&&this.setParameter(a+ic,e.velocitySens)}))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadSysEx(e){this._worklet?.port.postMessage({type:"loadSysEx",sysexData:Array.from(e)})}loadPreset(e){const t=Ac[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setAlgorithm(e){this.config.algorithm=Math.max(0,Math.min(31,e)),this.setParameter(xc,this.config.algorithm)}setFeedback(e){this.config.feedback=Math.max(0,Math.min(7,e)),this.setParameter(wc,this.config.feedback)}setOperatorLevel(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+oc,Math.max(0,Math.min(99,t)))}setOperatorCoarse(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+cc,Math.max(0,Math.min(31,t)))}setOperatorFine(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+uc,Math.max(0,Math.min(99,t)))}setOperatorDetune(e,t){if(e<0||e>=6)return;const a=21*e;this.setParameter(a+dc,Math.max(0,Math.min(14,t)))}setLfoSpeed(e){this.config.lfoSpeed=Math.max(0,Math.min(99,e)),this.setParameter(Sc,this.config.lfoSpeed)}setLfoPitchModDepth(e){this.config.lfoPmd=Math.max(0,Math.min(99,e)),this.setParameter(Nc,this.config.lfoPmd)}setLfoAmpModDepth(e){this.config.lfoAmd=Math.max(0,Math.min(99,e)),this.setParameter(Cc,this.config.lfoAmd)}setLfoWaveform(e){this.config.lfoWave=Math.max(0,Math.min(5,e)),this.setParameter(Ec,this.config.lfoWave)}setTranspose(e){this.config.transpose=Math.max(0,Math.min(48,e)),this.setParameter(Tc,this.config.transpose)}triggerAttack(e,t,a=1){const n=gs(e),s=Math.round(127*a);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:n,velocity:s}),this):(this.pendingNotes.push({note:n,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=gs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Ic=0,Fc=1,Dc=2,Rc=3,jc=4,Bc=5,Lc=6,Vc=7,zc=8,Uc=9,Gc=11,Wc=12,Hc=13,Kc=14,qc=15,$c=16,Xc=17,Yc=18,Zc=19,Qc=20,Jc=21,eu=22,tu=23,au=24,nu=25,su=26,ru=27,iu=28,ou=29,lu=30,cu=31,uu=32,du=33,pu=34,mu=35,hu=36,fu=37,yu=38,gu=39,bu=40,vu=41,xu=42,wu=43,ku=44,Su=0,Mu=1,Nu=0,Cu={"Classic Brass":{osc1Waveform:Su,osc2Waveform:Su,osc2Detune:.05,osc1Level:1,osc2Level:.8,filterCutoff:.4,filterResonance:.2,filterEnvAmount:.6,filterAttack:.1,filterDecay:.3,filterSustain:.4,filterRelease:.2,ampAttack:.05,ampDecay:.1,ampSustain:.8,ampRelease:.3},"Fat Lead":{osc1Waveform:Su,osc2Waveform:Su,osc2Octave:-1,osc2Detune:.1,osc1Level:1,osc2Level:1,filterCutoff:.6,filterResonance:.4,filterEnvAmount:.3,lfoRate:.3,lfoOscAmount:.1},"Pulse Pad":{osc1Waveform:Mu,osc2Waveform:Mu,osc1PulseWidth:.3,osc2PulseWidth:.7,osc2Detune:.02,filterCutoff:.3,filterResonance:.1,filterEnvAmount:.2,ampAttack:.5,ampDecay:.5,ampSustain:.7,ampRelease:1,lfoRate:.15,lfoPwAmount:.3},"Sync Lead":{osc1Waveform:Su,osc2Waveform:Su,osc2Octave:1,oscSync:!0,filterCutoff:.5,filterResonance:.3,filterEnvAmount:.5},Init:{osc1Waveform:Su,osc1Level:1,osc2Level:0,filterCutoff:.7,filterResonance:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3}};class Pu{name="OBXdSynth";output;_worklet=null;config;isInitialized=!1;pendingNotes=[];static isWorkletLoaded=!1;static workletLoadPromise=null;_initPromise;constructor(e={}){this.output=us().createGain(),this.config={osc1Waveform:Su,osc1Octave:0,osc1Level:1,osc1PulseWidth:.5,osc2Waveform:Su,osc2Octave:0,osc2Detune:.1,osc2Level:.7,osc2PulseWidth:.5,filterCutoff:.7,filterResonance:.3,filterEnvAmount:.5,filterAttack:.01,filterDecay:.3,filterSustain:.3,filterRelease:.3,ampAttack:.01,ampDecay:.2,ampSustain:.7,ampRelease:.3,lfoRate:.2,lfoWaveform:Nu,masterVolume:.7,velocitySensitivity:.5,panSpread:.3,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=us(),t="/DEViLBOX/";Pu.isWorkletLoaded||(Pu.workletLoadPromise||(Pu.workletLoadPromise=e.audioWorklet.addModule(`${t}obxd/OBXd.worklet.js`)),await Pu.workletLoadPromise,Pu.isWorkletLoaded=!0);const[a,n]=await Promise.all([fetch(`${t}obxd/OBXd.wasm`),fetch(`${t}obxd/OBXd.js`)]);if(!a.ok)throw new Error(`Failed to load OBXd.wasm: ${a.status}`);if(!n.ok)throw new Error(`Failed to load OBXd.js: ${n.status}`);const[s,r]=await Promise.all([a.arrayBuffer(),n.text()]),i=r.replace(/import\.meta\.url/g,`"${t}obxd/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory');this._worklet=new AudioWorkletNode(e,"obxd-processor"),this._worklet.port.onmessage=e=>{if("ready"===e.data.type){this.isInitialized=!0,this.applyConfig(this.config);for(const{note:e,velocity:t}of this.pendingNotes)this.triggerAttack(e,void 0,t/127);this.pendingNotes=[]}else e.data.type},this._worklet.port.postMessage({type:"init",wasmBinary:s,jsCode:i}),this._worklet.connect(this.output);try{const t=e.createGain();t.gain.value=0,this._worklet.connect(t),t.connect(e.destination)}catch{}}catch(e){throw e}}applyConfig(e){if(!this._worklet||!this.isInitialized)return;const t=[["osc1Waveform",Ic],["osc1Octave",Fc],["osc1Detune",Dc],["osc1PulseWidth",Rc],["osc1Level",jc],["osc2Waveform",Bc],["osc2Octave",Lc],["osc2Detune",Vc],["osc2PulseWidth",zc],["osc2Level",Uc],["filterCutoff",Hc],["filterResonance",Kc],["filterType",qc],["filterEnvAmount",$c],["filterKeyTrack",Xc],["filterVelocity",Yc],["filterAttack",Zc],["filterDecay",Qc],["filterSustain",Jc],["filterRelease",eu],["ampAttack",tu],["ampDecay",au],["ampSustain",nu],["ampRelease",su],["lfoRate",ru],["lfoWaveform",iu],["lfoDelay",ou],["lfoOscAmount",lu],["lfoFilterAmount",cu],["lfoAmpAmount",uu],["lfoPwAmount",du],["masterVolume",pu],["voices",mu],["unisonDetune",fu],["portamento",yu],["velocitySensitivity",bu],["panSpread",gu],["noiseLevel",vu],["subOscLevel",xu],["subOscOctave",wu],["drift",ku]];for(const[a,n]of t){const t=e[a];void 0!==t&&this.setParameter(n,t)}void 0!==e.oscSync&&this.setParameter(Gc,e.oscSync?1:0),void 0!==e.oscXor&&this.setParameter(Wc,e.oscXor?1:0),void 0!==e.unison&&this.setParameter(hu,e.unison?1:0)}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}loadPreset(e){const t=Cu[e];t&&(this.config={...this.config,...t},this.applyConfig(this.config))}setCutoff(e){this.config.filterCutoff=Math.max(0,Math.min(1,e)),this.setParameter(Hc,this.config.filterCutoff)}setResonance(e){this.config.filterResonance=Math.max(0,Math.min(1,e)),this.setParameter(Kc,this.config.filterResonance)}setFilterEnvAmount(e){this.config.filterEnvAmount=Math.max(0,Math.min(1,e)),this.setParameter($c,this.config.filterEnvAmount)}setOsc1Waveform(e){this.config.osc1Waveform=e,this.setParameter(Ic,e)}setOsc2Waveform(e){this.config.osc2Waveform=e,this.setParameter(Bc,e)}setOsc2Detune(e){this.config.osc2Detune=Math.max(-1,Math.min(1,e)),this.setParameter(Vc,this.config.osc2Detune)}setLfoRate(e){this.config.lfoRate=Math.max(0,Math.min(1,e)),this.setParameter(ru,this.config.lfoRate)}setLfoOscAmount(e){this.config.lfoOscAmount=Math.max(0,Math.min(1,e)),this.setParameter(lu,this.config.lfoOscAmount)}setLfoFilterAmount(e){this.config.lfoFilterAmount=Math.max(0,Math.min(1,e)),this.setParameter(cu,this.config.lfoFilterAmount)}setPortamento(e){this.config.portamento=Math.max(0,Math.min(1,e)),this.setParameter(yu,this.config.portamento)}setUnison(e){this.config.unison=e,this.setParameter(hu,e?1:0)}setUnisonDetune(e){this.config.unisonDetune=Math.max(0,Math.min(1,e)),this.setParameter(fu,this.config.unisonDetune)}setVolume(e){this.config.masterVolume=Math.max(0,Math.min(1,e)),this.setParameter(pu,this.config.masterVolume)}triggerAttack(e,t,a=1){const n=gs(e),s=Math.round(127*a);return this.isInitialized?(this._worklet?.port.postMessage({type:"noteOn",note:n,velocity:s}),this):(this.pendingNotes.push({note:n,velocity:s}),this)}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=gs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Eu=0,_u=0,Tu=0,Au=16,Ou=32,Iu=96,Fu=104,Du=152;class Ru{name="CZ101Synth";output;audioContext;workletNode=null;voices=[];currentPatch=null;isInitialized=!1;initPromise=null;static DEFAULT_PATCH={name:"Init",line1:{waveform1:Eu,dcaEnvelope:[{rate:99,level:99},{rate:60,level:80},{rate:40,level:60},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:0,level:0}],dcwEnvelope:[{rate:99,level:99},{rate:50,level:70},{rate:30,level:40},{rate:20,level:20},{rate:10,level:10},{rate:5,level:5},{rate:2,level:2},{rate:0,level:0}]}};constructor(){this.audioContext=us(),this.output=this.audioContext.createGain();for(let e=0;e<8;e++)this.voices.push({note:0,velocity:0,active:!1,envStage:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){const e=this.audioContext;if(!e.audioWorklet)throw new Error("AudioWorklet not supported");try{await e.audioWorklet.addModule("/DEViLBOX/cz101/CZ101.worklet.js")}catch(t){if(!(t instanceof Error&&t.message?.includes("already")))throw t}this.workletNode=new AudioWorkletNode(e,"cz101-processor",{numberOfOutputs:1,outputChannelCount:[2]}),this.workletNode.connect(this.output);try{const t=e.createGain();t.gain.value=0,this.workletNode.connect(t),t.connect(e.destination)}catch{}await new Promise((e,t)=>{const a=setTimeout(()=>t(new Error("CZ101 init timeout")),5e3),n=t=>{"initialized"===t.data.type&&(clearTimeout(a),this.workletNode?.port.removeEventListener("message",n),e())};this.workletNode.port.addEventListener("message",n),this.workletNode.port.start(),this.workletNode.port.postMessage({type:"init"})}),this.isInitialized=!0,this.loadPatch(Ru.DEFAULT_PATCH)}writeReg(e,t){this.workletNode&&this.workletNode.port.postMessage({type:"writeReg",register:e,value:t})}midiNoteToPitch(e,t=0){return(e-7<<9)+4*t}encodeDCAStep(e,t,a,n){return(1&e)<<15|(127&t)<<8|(1&a)<<7|127&n}_encodeDCOStep(e,t,a,n,s){return(1&e)<<15|(127&t)<<8|(1&a)<<7|(1&n)<<6|63&s}encodeWaveform(e,t,a,n,s,r){return(7&e)<<13|(7&(t??e))<<10|(void 0!==t?1:0)<<9|(7&a)<<6|(n?1:0)<<5|(3&s)<<3|(r?1:0)<<2}loadPatch(e){if(this.currentPatch=e,this.workletNode)for(let t=0;t<8;t++){const a=this.encodeWaveform(e.line1.waveform1,e.line1.waveform2,_u,e.ringMod??!1,e.noiseMode?2:0,!1);this.writeReg(Fu+t,a)}}triggerAttack(e,t,a=.8){const n="string"==typeof e?gs(e):e;let s=this.voices.findIndex(e=>!e.active);-1===s&&(s=0);const r=this.voices[s];if(r.note=n,r.velocity=Math.floor(127*a),r.active=!0,r.envStage=0,!this.workletNode||!this.currentPatch)return;const i=this.midiNoteToPitch(n,this.currentPatch.detune??0);this.writeReg(Iu+s,i),this.writeReg(Du+s,0);const o=this.currentPatch.line1.dcaEnvelope[0],l=this.encodeDCAStep(0,o.rate,0,Math.floor(o.level*r.velocity/127));this.writeReg(Tu+s,l);const c=this.currentPatch.line1.dcwEnvelope[0],u=this.encodeDCAStep(0,c.rate,0,c.level);if(this.writeReg(Ou+s,u),this.currentPatch.line1.dcoEnvelope&&this.currentPatch.line1.dcoEnvelope.length>0){const e=this.currentPatch.line1.dcoEnvelope[0],t=this._encodeDCOStep(0,e.rate,0,0,e.level);this.writeReg(Au+s,t)}}triggerRelease(e,t){const a="string"==typeof e?gs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;if(this.voices[n].active=!1,!this.workletNode||!this.currentPatch)return;const s=this.encodeDCAStep(1,40,0,0);this.writeReg(Tu+n,s)}setParameter(e,t){}getParameters(){return{}}dispose(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.output.disconnect()}}const ju=0,Bu=1,Lu=2,Vu=3,zu=4,Uu=5,Gu=6,Wu=7,Hu=1,Ku=2,qu=4;class $u extends $r{name="CEM3394Synth";chipName="CEM3394";workletFile="CEM3394.worklet.js";processorName="cem3394-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setCutoff(e){this.setParameterById(Gu,e)}setResonance(e){this.setParameterById(Uu,e)}setFilterModulation(e){this.setParameterById(Bu,e)}setPulseWidth(e){this.setParameterById(Vu,e)}setWaveform(e){let t=Ku|qu;if("string"==typeof e)switch(e.toLowerCase()){case"triangle":t=Hu;break;case"sawtooth":case"saw":t=Ku;break;case"pulse":case"square":t=qu;break;case"all":t=Hu|Ku|qu}else t=e;this.setParameterById(Lu,t)}setVolume(e){this.setParameterById(Wu,e)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={vco_frequency:ju,modulation:Bu,wave_select:Lu,pulse_width:Vu,mixer_balance:zu,resonance:Uu,cutoff:Gu,volume:Wu}[e];void 0!==a&&this.setParameterById(a,t)}}const Xu=0;class Yu extends $r{name="SCSPSynth";chipName="SCSP";workletFile="SCSP.worklet.js";processorName="scsp-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const a=t/2,n=Math.log2(e/a),s=Math.floor(n)+1,r=Math.round(1024*(e/(a*Math.pow(2,s-1))-1));return{oct:Math.max(-8,Math.min(7,s)),fns:Math.max(0,Math.min(1023,r))}}(e);this.workletNode.port.postMessage({type:"setFrequency",oct:t.oct,fns:t.fns,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",tl:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*31),a=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",sdl:t,sdr:a,slot:this.currentSlot})}setFMLevel(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMLevel",slot:e,level:t})}setFMInputSlot(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFMInputSlot",slot:e,inputSlot:t})}setSlot(e){this.currentSlot=Math.max(0,Math.min(31,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:a,loopEnd:n,loop:s,format:r??0})}setEnvelope(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,ar:t,d1r:a,d2r:n,rr:s,dl:r})}setLFO(e,t,a,n,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,plfos:t,alfos:a,freq:n,wave:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:Xu,volume:Xu}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(Xu,e)}}const Zu={chipName:"TR707",basePath:"/roms/tr707",zipFile:"tr707.zip",combinedFile:"tr707_combined.bin",combinedSize:131072,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768}]},Qu={chipName:"TR707-Expansion",basePath:"/roms/tr707",zipFile:"tr707_expansion.zip",combinedFile:"tr707_expansion.bin",combinedSize:262144,files:[{name:"tr707_voices.bin",offset:0,size:65536,required:!0},{name:"tr707_crash.bin",offset:65536,size:32768},{name:"tr707_ride.bin",offset:98304,size:32768},{name:"tr707_expansion.bin",offset:131072,size:131072}]},Ju={chipName:"TMS5220",basePath:"/roms/snspell",files:[{name:"tmc0351n2l.vsm",offset:0,size:16384,required:!0},{name:"tmc0352n2l.vsm",offset:16384,size:16384,required:!0}]},ed={chipName:"C352",basePath:"/roms/c352",zipFile:"c352.zip",combinedFile:"c352_samples.bin",combinedSize:8388608,files:[{name:"c352_samples_0.bin",offset:0,size:4194304,required:!0},{name:"c352_samples_1.bin",offset:4194304,size:4194304,required:!0}]},td={chipName:"K054539",basePath:"/roms/k054539",zipFile:"k054539.zip",combinedFile:"k054539_samples.bin",combinedSize:6291456,files:[{name:"k054539_samples_0.bin",offset:0,size:2097152,required:!0},{name:"k054539_samples_1.bin",offset:2097152,size:1048576,required:!0},{name:"k054539_samples_2.bin",offset:3145728,size:1048576,required:!0},{name:"k054539_samples_3.bin",offset:4194304,size:2097152,required:!0}]},ad={chipName:"ICS2115",basePath:"/roms/ics2115",zipFile:"ics2115.zip",combinedFile:"ics2115_wavetable.bin",combinedSize:262144,files:[{name:"ics2115_wavetable_0.bin",offset:0,size:262144,required:!0}]},nd={chipName:"RF5C400",basePath:"/roms/rf5c400",zipFile:"rf5c400.zip",combinedFile:"rf5c400_samples.bin",files:[{name:"rf5c400_samples.bin",offset:0,required:!0}]},sd={chipName:"ES5503",basePath:"/roms/es5503",zipFile:"es5503.zip",combinedFile:"es5503_wavetable.bin",files:[{name:"es5503_wavetable.bin",offset:0,required:!0}]},rd={chipName:"D50",basePath:"/roms/d50",zipFile:"d50.zip",files:[{name:"d50_firmware.bin",offset:0,size:65536,required:!0},{name:"d50_ic30.bin",offset:65536,size:524288,required:!0},{name:"d50_ic29.bin",offset:589824,size:524288,required:!0}]},id={chipName:"VFX",basePath:"/roms/vfx",zipFile:"vfx.zip",files:[{name:"u14.bin",offset:0,size:524288,required:!0},{name:"u15.bin",offset:524288,size:524288,required:!0},{name:"u16.bin",offset:1048576,size:524288,required:!0},{name:"vfx210b-low.bin",offset:1572864,size:65536},{name:"vfx210b-high.bin",offset:1638400,size:65536}]};async function od(e){try{if(e.zipFile){const t=`${e.basePath}/${e.zipFile}`,a=await async function(e,t){try{const a=await fetch(Wa(e));if(!a.ok)return null;if((a.headers.get("content-type")||"").includes("text/html"))return null;const n=await a.arrayBuffer();if(n.byteLength<4)return null;const s=new Uint8Array(n,0,4);if(80!==s[0]||75!==s[1])return null;const r=await Ya.loadAsync(n),i=t.files.filter(e=>e.size).map(e=>e.offset+e.size),o=i.length>0?Math.max(...i):t.combinedSize||4194304;let l=new Uint8Array(o),c=0;for(const e of t.files){let t=r.file(e.name);if(!t){const a=Object.keys(r.files).find(t=>t.endsWith("/"+e.name)||t===e.name);a&&(t=r.file(a))}if(!t){if(e.required)return null;continue}const a=await t.async("uint8array");e.size&&(a.length,e.size);const n=e.offset+a.length;if(n>l.length){const e=new Uint8Array(n);e.set(l),l=e}l.set(a,e.offset),c++}return 0===c?null:l}catch(a){return null}}(t,e);if(a)return a}if(e.combinedFile)try{const t=await fetch(Wa(`${e.basePath}/${e.combinedFile}`)),a=t.headers.get("content-type")||"";if(t.ok&&!a.includes("text/html")){const a=await t.arrayBuffer(),n=new Uint8Array(a);return e.combinedSize&&(n.length,e.combinedSize),n}}catch{}const t=Math.max(...e.files.map(e=>e.offset+(e.size||0))),a=new Uint8Array(t||1048576);let n=0;const s=await Promise.allSettled(e.files.map(async t=>{try{const s=await fetch(Wa(`${e.basePath}/${t.name}`)),r=s.headers.get("content-type")||"";if(!s.ok||r.includes("text/html")){if(t.required)throw new Error(`${t.name} not found (HTTP ${s.status}, type: ${r})`);return}const i=await s.arrayBuffer(),o=new Uint8Array(i);t.size&&(o.length,t.size),a.set(o,t.offset),n++}catch(s){if(t.required)throw s}}));if(0===n)throw new Error(`No ROM files loaded for ${e.chipName}`);if(s.find((t,a)=>"rejected"===t.status&&e.files[a].required))throw new Error(`Required ROM file failed to load for ${e.chipName}`);return a}catch(t){throw new Error(`${e.chipName} ROM files not found or invalid.\nPlease place ROM files in ${e.basePath}/\nRequired files: ${e.files.filter(e=>e.required).map(e=>e.name).join(", ")}`)}}const ld=1,cd=0,ud=1,dd=3,pd=5,md=6,hd=7,fd=8,yd=10,gd=12;class bd{name="VFXSynth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=16e6;static NUM_VOICES=32;constructor(){this.audioContext=us(),this.output=this.audioContext.createGain(),this.mameEngine=Ar.getInstance();for(let e=0;e<bd.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,looping:!1})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(Pr,bd.CLOCK),0===this.handle)throw new Error("Failed to create ES5506 instance");this.isInitialized=!0;try{const e=await async function(){const e=await od(id);return[e.slice(0,524288),e.slice(524288,1048576),e.slice(1048576,1572864)]}();for(let t=0;t<e.length;t++)await this.loadSampleROM(t,e[t].buffer)}catch(e){}}async loadSampleROM(e,t){this.isInitialized||await this.init(),this.mameEngine.setRom(e,new Uint8Array(t)),this.romLoaded=!0}writeVoiceReg(e,t,a){if(0===this.handle)return;const n=16*e+t;this.mameEngine.write16(this.handle,n,a)}midiNoteToFreqCount(e,t=44100){const a=440*Math.pow(2,(e-69)/12);return 4294967295&Math.floor(a*Math.pow(2,32)/t)}velocityToVolume(e){const t=e/127,a=Math.pow(t,2);return Math.floor(65535*a)}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,a=.8){if(!this.isInitialized||!this.romLoaded)return;const n="string"==typeof e?gs(e):e,s=this.allocateVoice(),r=this.voices[s];r.note=n,r.velocity=Math.floor(127*a),r.active=!0;const i=this.midiNoteToFreqCount(n);this.writeVoiceReg(s,ud,i>>>16),this.writeVoiceReg(s,ud+1,65535&i);const o=this.velocityToVolume(r.velocity);this.writeVoiceReg(s,dd,o),this.writeVoiceReg(s,hd,o),this.writeVoiceReg(s,md,0);const l=ld;this.writeVoiceReg(s,cd,l)}triggerAttackRelease(e,t=.5,a,n=.8){this.triggerAttack(e,a,n);const s="string"==typeof t?xs(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*s)}triggerRelease(e,t){if(!this.isInitialized)return;const a="string"==typeof e?gs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;this.voices[n].active=!1,this.writeVoiceReg(n,pd,128),this.writeVoiceReg(n,fd,128)}setFilter(e,t,a){this.writeVoiceReg(e,gd,Math.floor(65535*t)),this.writeVoiceReg(e,yd,Math.floor(65535*a))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const vd=0,xd=6144;class wd{name="D50Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;_currentPatch=null;static CLOCK=2e7;static NUM_VOICES=16;constructor(){this.audioContext=us(),this.output=this.audioContext.createGain(),this.mameEngine=Ar.getInstance();for(let e=0;e<wd.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,active:!1,partialMask:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(Er,wd.CLOCK),0===this.handle)throw new Error("Failed to create Roland SA instance");this.isInitialized=!0;try{const{firmware:e,ic30:t,ic29:a}=await async function(){const e=await od(rd);return{firmware:e.slice(0,65536),ic30:e.slice(65536,589824),ic29:e.slice(589824,1114112)}}();await this.loadROMs(t.buffer,a.buffer,e.buffer)}catch(e){}}async loadROMs(e,t,a){this.isInitialized||await this.init(),this.mameEngine.rsaLoadRoms(this.handle,new Uint8Array(e),new Uint8Array(t),new Uint8Array(a)),this.romLoaded=!0}writeControl(e,t){0!==this.handle&&this.mameEngine.write(this.handle,e,t)}_midiNoteToPitch(e,t=0){return e}allocateVoice(){let e=this.voices.findIndex(e=>!e.active);return-1===e&&(e=0),e}loadPatch(e){this._currentPatch=e,this.isInitialized}get patchName(){return this._currentPatch?.name||"Init"}triggerAttack(e,t,a=.8){if(!this.isInitialized||!this.romLoaded)return;const n="string"==typeof e?gs(e):e,s=this.allocateVoice(),r=this.voices[s],i=this._currentPatch?.effects?.chorusRate??0,o=this._midiNoteToPitch(n,i);r.note=n,r.velocity=Math.floor(127*a),r.active=!0,r.partialMask=15;const l=vd+128*s;this.writeControl(l+0,o),this.writeControl(l+1,r.velocity),this.writeControl(l+2,1)}triggerAttackRelease(e,t=.5,a,n=.8){this.triggerAttack(e,a,n);const s="string"==typeof t?xs(t):t;setTimeout(()=>{this.triggerRelease(e)},1e3*s)}triggerRelease(e,t){if(!this.isInitialized)return;const a="string"==typeof e?gs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;this.voices[n].active=!1;const s=vd+128*n;this.writeControl(s+2,0)}setChorus(e,t){this.writeControl(xd+0,Math.floor(127*e)),this.writeControl(xd+1,Math.floor(127*t))}setReverb(e){this.writeControl(xd+16,Math.floor(127*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const kd=0,Sd=1,Md=2,Nd=3,Cd=4,Pd=5,Ed=6,_d=7,Td=8,Ad=9,Od=[{ic5:"mks20_15179738.BIN",ic6:"mks20_15179737.BIN",ic7:"mks20_15179736.BIN",ic18:"mks20_15179757.BIN"},{ic5:"mks20_15179741.BIN",ic6:"mks20_15179740.BIN",ic7:"mks20_15179739.BIN",ic18:"mks20_15179757.BIN"},{ic5:"MK80_IC5.bin",ic6:"MK80_IC6.bin",ic7:"MK80_IC7.bin",ic18:"MK80_IC18.bin"}],Id=[{name:"MKS-20: Piano 1",romSet:0},{name:"MKS-20: Piano 2",romSet:0},{name:"MKS-20: Piano 3",romSet:0},{name:"MKS-20: Harpsichord",romSet:1},{name:"MKS-20: Clavi",romSet:1},{name:"MKS-20: Vibraphone",romSet:1},{name:"MKS-20: E-Piano 1",romSet:1},{name:"MKS-20: E-Piano 2",romSet:1},{name:"MK-80: Classic",romSet:2},{name:"MK-80: Special",romSet:2},{name:"MK-80: Blend",romSet:2},{name:"MK-80: Contemporary",romSet:2},{name:"MK-80: A. Piano 1",romSet:2},{name:"MK-80: A. Piano 2",romSet:2},{name:"MK-80: Clavi",romSet:2},{name:"MK-80: Vibraphone",romSet:2}];class Fd{name="RdPianoSynth";output;audioContext;_worklet=null;config;isInitialized=!1;pendingNotes=[];loadedRomSets=new Set;currentPatch=0;romLoadError=!1;_initPromise;static romCache=new Map;static isWorkletLoaded=!1;static workletLoadPromise=null;static wasmBinary=null;static jsCode=null;constructor(e={}){this.audioContext=us(),this.output=this.audioContext.createGain(),this.config={patch:0,chorusEnabled:!0,chorusRate:5,chorusDepth:14,efxEnabled:!1,phaserRate:.4,phaserDepth:.8,tremoloEnabled:!1,tremoloRate:6,tremoloDepth:6,volume:1,...e},this._initPromise=this.initialize()}async ensureInitialized(){return this._initPromise}async initialize(){try{const e=this.audioContext,t="/DEViLBOX/";if(!Fd.isWorkletLoaded){if(!Fd.workletLoadPromise){const a=`?v=${Date.now()}`;Fd.workletLoadPromise=e.audioWorklet.addModule(`${t}rdpiano/RdPiano.worklet.js${a}`)}await Fd.workletLoadPromise,Fd.isWorkletLoaded=!0}if(!Fd.wasmBinary||!Fd.jsCode){const[e,a]=await Promise.all([fetch(`${t}rdpiano/RdPiano.wasm`),fetch(`${t}rdpiano/RdPiano.js`)]);if(!e.ok||!a.ok)throw new Error("Failed to fetch RdPiano WASM files");const[n,s]=await Promise.all([e.arrayBuffer(),a.text()]);Fd.jsCode=s.replace(/import\.meta\.url/g,`"${t}rdpiano/"`).replace(/export\s+default\s+\w+;?\s*$/,"").replace(/if\s*\(ENVIRONMENT_IS_NODE\)\s*\{[^}]*await\s+import\([^)]*\)[^}]*\}/g,"").replace(/(wasmMemory=wasmExports\["\w+"\])/,'$1;Module["wasmMemory"]=wasmMemory'),Fd.wasmBinary=n}this._worklet=new AudioWorkletNode(this.audioContext,"rdpiano-processor"),this._worklet.port.onmessage=e=>{const{type:t}=e.data;if("wasmReady"===t)this.loadROMs();else if("ready"===t){this.isInitialized=!0,this.applyConfig(),null!=this.config.patch&&0!==this.config.patch&&this.selectPatch(this.config.patch);for(const{note:e,velocity:t}of this.pendingNotes)this._worklet?.port.postMessage({type:"noteOn",note:e,velocity:t});this.pendingNotes=[]}},this._worklet.port.postMessage({type:"init",wasmBinary:Fd.wasmBinary,jsCode:Fd.jsCode}),this._worklet.connect(this.output)}catch(e){}}async loadROMs(){try{const e=`${"/DEViLBOX/"}rdpiano/roms/`,t=await this.fetchROM(e+"RD200_B.bin");if(!t)return void(this.romLoadError=!0);this._worklet?.port.postMessage({type:"loadProgramROM",romData:t}),await new Promise(e=>setTimeout(e,50));const a=this.config.patch||0,n=Id[a].romSet;await this.loadROMSet(n),await new Promise(e=>setTimeout(e,100)),this._worklet?.port.postMessage({type:"initMCU"})}catch(e){this.romLoadError=!0}}async loadROMSet(e){if(this.loadedRomSets.has(e))return!0;if(e<0||e>2)return!1;const t="/DEViLBOX/rdpiano/roms/",a=Od[e],[n,s,r,i]=await Promise.all([this.fetchROM(t+a.ic5),this.fetchROM(t+a.ic6),this.fetchROM(t+a.ic7),this.fetchROM(t+a.ic18)]);return!!(n&&s&&r&&i)&&(this._worklet?.port.postMessage({type:"loadROMSet",setIndex:e,ic5:n,ic6:s,ic7:r,ic18:i}),this.loadedRomSets.add(e),!0)}async fetchROM(e){const t=Fd.romCache.get(e);if(t)return t.slice(0);try{const t=await fetch(e);if(!t.ok)return null;const a=await t.arrayBuffer();return Fd.romCache.set(e,a),a.slice(0)}catch(a){return null}}applyConfig(){this._worklet&&this.isInitialized&&(null!=this.config.chorusEnabled&&this.setParameter(kd,this.config.chorusEnabled?1:0),null!=this.config.chorusRate&&this.setParameter(Sd,this.config.chorusRate),null!=this.config.chorusDepth&&this.setParameter(Md,this.config.chorusDepth),null!=this.config.efxEnabled&&this.setParameter(Nd,this.config.efxEnabled?1:0),null!=this.config.phaserRate&&this.setParameter(Cd,this.config.phaserRate),null!=this.config.phaserDepth&&this.setParameter(Pd,this.config.phaserDepth),null!=this.config.tremoloEnabled&&this.setParameter(Ed,this.config.tremoloEnabled?1:0),null!=this.config.tremoloRate&&this.setParameter(_d,this.config.tremoloRate),null!=this.config.tremoloDepth&&this.setParameter(Td,this.config.tremoloDepth),null!=this.config.volume&&this.setParameter(Ad,this.config.volume))}setParameter(e,t){this._worklet?.port.postMessage({type:"parameter",paramId:e,value:t})}async selectPatch(e){if(e<0||e>=16)return;const t=Id[e];if(!this.loadedRomSets.has(t.romSet)){if(!(await this.loadROMSet(t.romSet)))return}this._worklet?.port.postMessage({type:"selectPatch",patchIndex:e}),this.currentPatch=e}setChorusEnabled(e){this.config.chorusEnabled=e,this.setParameter(kd,e?1:0)}setChorusRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusRate=e,this.setParameter(Sd,e)}setChorusDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.chorusDepth=e,this.setParameter(Md,e)}setEfxEnabled(e){this.config.efxEnabled=e,this.setParameter(Nd,e?1:0)}setPhaserRate(e){e=Math.max(0,Math.min(1,e)),this.config.phaserRate=e,this.setParameter(Cd,e)}setPhaserDepth(e){e=Math.max(0,Math.min(1,e)),this.config.phaserDepth=e,this.setParameter(Pd,e)}setTremoloEnabled(e){this.config.tremoloEnabled=e,this.setParameter(Ed,e?1:0)}setTremoloRate(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloRate=e,this.setParameter(_d,e)}setTremoloDepth(e){e=Math.max(0,Math.min(14,Math.round(e))),this.config.tremoloDepth=e,this.setParameter(Td,e)}setVolume(e){e=Math.max(0,Math.min(1,e)),this.config.volume=e,this.setParameter(Ad,e)}triggerAttack(e,t,a=1){const n=gs(e),s=Math.round(127*Math.max(0,Math.min(1,a)));this.romLoadError||(this.isInitialized?this._worklet?.port.postMessage({type:"noteOn",note:n,velocity:s}):this.pendingNotes.push({note:n,velocity:s}))}triggerRelease(e,t){if(this._worklet)if(void 0!==e){const t=gs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"})}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}getCurrentPatch(){return this.currentPatch}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Dd=8,Rd=10,jd=12,Bd=50,Ld=4096;class Vd{name="MU2000Synth";output;audioContext;mameEngine;handle=0;voices=[];isInitialized=!1;initPromise=null;romLoaded=!1;static CLOCK=33868800;static NUM_VOICES=64;constructor(){this.audioContext=us(),this.output=this.audioContext.createGain(),this.mameEngine=Ar.getInstance();for(let e=0;e<Vd.NUM_VOICES;e++)this.voices.push({note:0,velocity:0,channel:0,active:!1,startTime:0})}async init(){if(!this.isInitialized)return this.initPromise||(this.initPromise=this.doInit()),this.initPromise}async ensureInitialized(){return this.init()}async doInit(){if(await this.mameEngine.init(),this.handle=this.mameEngine.createInstance(_r,Vd.CLOCK),0===this.handle)throw new Error("Failed to create SWP30 instance");this.isInitialized=!0}async loadWaveROM(e){this.isInitialized||await this.init();const t=new Uint8Array(e);this.mameEngine.setRom(0,t),this.romLoaded=!0}midiNoteToPitch(e,t=0){const a=e-60+t/8192,n=Math.pow(2,a/12);return 65535&Math.floor(8192*n)}velocityToVolume(e){return Math.floor(2*e)}allocateVoice(e){let t=this.voices.findIndex(e=>!e.active);if(-1===t){let a=1/0,n=0;for(let t=0;t<this.voices.length;t++)this.voices[t].channel===e&&this.voices[t].startTime<a&&(a=this.voices[t].startTime,n=t);if(a===1/0)for(let e=0;e<this.voices.length;e++)this.voices[e].startTime<a&&(a=this.voices[e].startTime,n=e);t=n}return t}writeReg(e,t){0!==this.handle&&this.mameEngine.write16(this.handle,e,t)}triggerAttack(e,t,a=.8,n=0){if(!this.isInitialized||!this.romLoaded)return;const s="string"==typeof e?gs(e):e,r=this.allocateVoice(n),i=this.voices[r];i.note=s,i.velocity=Math.floor(127*a),i.channel=n,i.active=!0,i.startTime=performance.now();const o=64*r,l=this.midiNoteToPitch(s);this.writeReg(o+jd,l);const c=this.velocityToVolume(i.velocity);this.writeReg(o+Bd,c),this.writeReg(o+Dd,0),this.writeReg(o+Rd,0)}triggerRelease(e,t){if(!this.isInitialized)return;const a="string"==typeof e?gs(e):e,n=this.voices.findIndex(e=>e.active&&e.note===a);if(-1===n)return;this.voices[n].active=!1;const s=64*n;this.writeReg(s+Bd,0)}sendMidi(e){0!==this.handle&&this.mameEngine.addMidiEvent(this.handle,e)}setMasterVolume(e){this.writeReg(Ld,Math.floor(255*e))}getStatus(){return{initialized:this.isInitialized,romLoaded:this.romLoaded,activeVoices:this.voices.filter(e=>e.active).length}}dispose(){0!==this.handle&&(this.mameEngine.deleteInstance(this.handle),this.handle=0),this.output.disconnect()}}const zd=0;class Ud extends $r{name="AICASynth";chipName="AICA";workletFile="AICA.worklet.js";processorName="aica-processor";currentSlot=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),slot:this.currentSlot})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,slot:this.currentSlot})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,slot:this.currentSlot})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*(1-e));this.workletNode.port.postMessage({type:"setVolume",volume:t,slot:this.currentSlot})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*31);this.workletNode.port.postMessage({type:"setPanning",pan:t,slot:this.currentSlot})}setSlot(e){this.currentSlot=Math.max(0,Math.min(63,e))}loadSample(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadSample",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureSlot(e,t,a,n,s,r=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureSlot",slot:e,sampleAddr:t,loopStart:a,loopEnd:n,loop:s,format:r})}setEnvelope(e,t,a,n,s,r){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setEnvelope",slot:e,attack:t,decay1:a,decay2:n,release:s,sustainLevel:r})}setLFO(e,t,a,n,s){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setLFO",slot:e,pitchDepth:t,ampDepth:a,rate:n,waveform:s})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:zd,volume:zd}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(zd,e)}}const Gd=0,Wd=1,Hd=2,Kd=3,qd=4,$d=5,Xd=6,Yd=7;class Zd extends $r{name="ASCSynth";chipName="ASC";workletFile="ASC.worklet.js";processorName="asc-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=(e-128)/128*.5;this.workletNode.port.postMessage({type:"setPanning",width:t})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveform(e){this.writeWavetableSelect(e)}setAttack(e){this.setParameterById(Hd,e)}setDecay(e){this.setParameterById(Kd,e)}setSustain(e){this.setParameterById(qd,e)}setRelease(e){this.setParameterById($d,e)}setStereoWidth(e){this.setParameterById(Xd,e)}setDetune(e){this.setParameterById(Yd,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Gd,waveform:Wd,attack:Hd,decay:Kd,sustain:qd,release:$d,stereo_width:Xd,detune:Yd}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Qd=0,Jd=1,ep=2,tp=3,ap=4,np=5,sp=6,rp=7;class ip extends $r{name="AstrocadeSynth";chipName="Astrocade";workletFile="Astrocade.worklet.js";processorName="astrocade-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setVibratoSpeed(e){this.sendMessage("setVibratoSpeed",e)}setVibratoDepth(e){this.sendMessage("setVibratoDepth",e)}setNoiseVolume(e){this.sendMessage("setNoiseVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Qd,vibrato_speed:Jd,vibrato_depth:ep,noise_am:tp,noise_mod:ap,noise_vol:np,master_freq:sp,stereo_width:rp}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const op=0;class lp extends $r{name="C352Synth";chipName="C352";workletFile="C352.worklet.js";processorName="c352-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return od(ed)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=44100){const a=t,n=Math.round(e/a*65536);return Math.max(0,Math.min(65535,n))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,voice:this.currentVoice})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,voice:this.currentVoice})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round((255-e)/255*255),a=Math.round(e/255*255);this.workletNode.port.postMessage({type:"setPanning",vol_f:t<<8|a,vol_r:t<<8|a,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureVoice(e,t,a,n,s,r,i){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureVoice",voice:e,bank:t,start:a,end:n,loop:s,freq:r,flags:i})}setVoiceVolume(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVoiceVolume",voice:e,vol_f:t,vol_r:a})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",voice:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",voice:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:op,volume:op}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(op,e)}}const cp=0,up=1,dp=2,pp=3,mp=4,hp=5,fp=6,yp=7;class gp extends $r{name="ES5503Synth";chipName="ES5503";workletFile="ES5503.worklet.js";processorName="es5503-processor";currentOsc=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return od(sd)}();await super.initialize(),this.loadWaveData(e,2048),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),osc:this.currentOsc})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,osc:this.currentOsc})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=894886){const a=Math.round(e*Math.pow(2,17)/t);return Math.max(0,Math.min(131071,a))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t,osc:this.currentOsc})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(255*e);this.workletNode.port.postMessage({type:"setVolume",volume:t,osc:this.currentOsc})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*7);this.workletNode.port.postMessage({type:"setPanning",channel:t,osc:this.currentOsc})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e,osc:this.currentOsc})}setOscillator(e){this.currentOsc=Math.max(0,Math.min(31,e))}setWaveform(e){this.writeWavetableSelect(e)}setWaveSize(e){this.sendMessage("setWaveSize",e)}setResolution(e){this.sendMessage("setResolution",e)}setOscMode(e){this.sendMessage("setOscMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setReleaseTime(e){this.sendMessage("setReleaseTime",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setNumOscillators(e){this.sendMessage("setNumOscillators",e)}loadWaveData(e,t=0){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadWaveData",waveData:e.buffer,offset:t})}loadWavePage(e,t){this.loadWaveData(e.slice(0,256),256*t)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={waveform:cp,wave_size:up,resolution:dp,osc_mode:pp,volume:mp,num_oscillators:hp,attack_time:fp,release_time:yp}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const bp=0,vp=1;class xp extends $r{name="ICS2115Synth";chipName="ICS2115";workletFile="ICS2115.worklet.js";processorName="ics2115-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return od(ad)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",voice:e,reg:t,data:a})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:bp,volume:bp,active_osc:vp,voices:vp}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(bp,e)}setActiveOscillators(e){this.setParameterById(vp,e)}}const wp=0,kp=1;class Sp extends $r{name="K054539Synth";chipName="K054539";workletFile="K054539.worklet.js";processorName="k054539-processor";currentChannel=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return od(td)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=261.63){const a=e/t,n=Math.round(4096*a);return Math.max(0,Math.min(65535,n))}(e);this.workletNode.port.postMessage({type:"setChannelPitch",channel:this.currentChannel,delta:t})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=Math.round(64*(1-e));this.workletNode.port.postMessage({type:"setChannelVolume",channel:this.currentChannel,volume:t})}writePanning(e){if(!this.workletNode||this._disposed)return;const t=Math.round(e/255*14);this.workletNode.port.postMessage({type:"setChannelPan",channel:this.currentChannel,pan:t})}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}configureChannel(e,t,a,n=0,s=!1,r=!1){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"configureChannel",channel:e,startAddr:t,loopAddr:a,sampleType:n,loopEnable:s,reverse:r})}setChannelPitch(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPitch",channel:e,delta:t})}setChannelVolume(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelVolume",channel:e,volume:t})}setChannelPan(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelPan",channel:e,pan:t})}setChannelGain(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChannelGain",channel:e,gain:t})}keyOn(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOn",channel:e})}keyOff(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"keyOff",channel:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:wp,volume:wp,reverb_enable:kp,reverb:kp}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(wp,e)}setReverbEnable(e){this.setParameterById(kp,e?1:0)}}function Mp(e){try{return jl.convert(e)}catch{return!1}}function Np(e){if(!e)return[];const t=[];let a=0;for(;a<e.length;){if(" "===e[a]){t.push({code:" ",stress:0}),a++;continue}if(e[a]>="0"&&e[a]<="8"){t.length>0&&(t[t.length-1].stress=parseInt(e[a])),a++;continue}if(a+1<e.length){const n=e[a]+e[a+1];if(Pp(n)){t.push({code:n,stress:0}),a+=2;continue}}const n=e[a]+"*";Pp(n)?(t.push({code:n,stress:0}),a++):a++}return t}const Cp=new Set(["IY","IH","EH","AE","AA","AH","AO","UH","AX","IX","ER","UX","OH","RX","LX","WX","YX","WH","R*","L*","W*","Y*","M*","N*","NX","DX","Q*","S*","SH","F*","TH","/H","/X","Z*","ZH","V*","DH","CH","J*","EY","AY","OY","AW","OW","UW","B*","D*","G*","GX","P*","T*","K*","KX"]);function Pp(e){return Cp.has(e)}const Ep=Object.freeze(Object.defineProperty({__proto__:null,parsePhonemeString:Np,textToPhonemes:Mp},Symbol.toStringTag,{value:"Module"}));class _p{_queue=[];_currentIndex=0;_timer=null;_speaking=!1;_loop=!1;_onFrame=null;_onDone=null;constructor(e,t){this._onFrame=e,this._onDone=t??null}speak(e,t=!1){this.stop(),this._queue=e,this._currentIndex=0,this._loop=t,this._speaking=!0,this._playNext()}stop(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null),this._speaking=!1,this._queue=[],this._currentIndex=0}get isSpeaking(){return this._speaking}_playNext(){if(this._currentIndex>=this._queue.length){if(!(this._loop&&this._queue.length>0))return this._speaking=!1,void this._onDone?.();this._currentIndex=0}const e=this._queue[this._currentIndex];this._onFrame?.(e.data),this._currentIndex++,this._timer=setTimeout(()=>{this._timer=null,this._playNext()},e.durationMs)}dispose(){this.stop(),this._onFrame=null,this._onDone=null}}const Tp=[150,162,174,188,202,217,233,250,267,286,305,325,346,368,391,415,440,466,494,523,554,587,622,659,698,740,784,830,880,932,988,1047],Ap=[440,466,494,523,554,587,622,659,698,740,784,830,880,932,988,1047,1100,1179,1254,1337,1428,1528,1639,1761,1897,2047,2214,2400,2609,2842,3105,3400],Op=[1179,1337,1528,1761,2047,2400,2842,3400];function Ip(e,t){let a=0,n=Math.abs(e-t[0]);for(let s=1;s<t.length;s++){const r=Math.abs(e-t[s]);r<n&&(n=r,a=s)}return a}function Fp(e,t,a,n,s,r){return{f1:Ip(e,Tp),f2:Ip(t,Ap),f3:Ip(a,Op),noise:n,bw:s,durationMs:r}}function Dp(e){return{IY:Fp(270,2290,3010,!1,2,100),IH:Fp(390,1990,2550,!1,2,80),EH:Fp(530,1840,2480,!1,2,80),AE:Fp(660,1720,2410,!1,2,90),AA:Fp(710,1100,2540,!1,2,100),AH:Fp(730,1090,2440,!1,2,80),AO:Fp(570,840,2410,!1,2,100),UH:Fp(440,1020,2240,!1,2,80),AX:Fp(500,1500,2500,!1,1,60),IX:Fp(390,1990,2550,!1,1,60),ER:Fp(490,1350,1690,!1,2,100),UX:Fp(300,870,2240,!1,2,80),OH:Fp(570,840,2410,!1,2,100),EY:Fp(530,1840,2480,!1,2,130),AY:Fp(710,1100,2540,!1,2,140),OY:Fp(570,840,2410,!1,2,140),AW:Fp(710,1100,2540,!1,2,130),OW:Fp(570,840,2410,!1,2,130),UW:Fp(300,870,2240,!1,2,100),"R*":Fp(490,1350,1690,!1,1,70),RX:Fp(490,1350,1690,!1,1,70),"L*":Fp(360,1700,2800,!1,1,70),LX:Fp(360,1700,2800,!1,1,70),"W*":Fp(300,870,2240,!1,1,60),WX:Fp(300,870,2240,!1,1,60),WH:Fp(300,870,2240,!0,0,60),"Y*":Fp(270,2290,3010,!1,1,60),YX:Fp(270,2290,3010,!1,1,60),"M*":Fp(300,1100,2500,!1,0,80),"N*":Fp(350,1700,2500,!1,0,70),NX:Fp(300,1100,2500,!1,0,80),"S*":Fp(400,2200,3400,!0,0,90),SH:Fp(350,1800,2800,!0,0,90),"F*":Fp(350,1500,2500,!0,0,80),TH:Fp(400,2e3,3e3,!0,0,80),"/H":Fp(500,1500,2500,!0,0,60),"/X":Fp(500,1500,2500,!0,0,60),"Z*":Fp(400,2200,3400,!1,0,90),ZH:Fp(350,1800,2800,!1,0,80),"V*":Fp(350,1500,2500,!1,0,70),DH:Fp(400,2e3,3e3,!1,0,60),CH:Fp(400,2e3,3e3,!0,0,80),"J*":Fp(400,2e3,3e3,!1,0,80),"B*":Fp(350,1100,2500,!1,0,40),"D*":Fp(400,1800,2600,!1,0,40),"G*":Fp(350,1500,2500,!1,0,40),GX:Fp(350,1500,2500,!1,0,40),"P*":Fp(350,1100,2500,!0,0,40),"T*":Fp(400,1800,2600,!0,0,40),"K*":Fp(350,1500,2500,!0,0,40),KX:Fp(350,1500,2500,!0,0,40),DX:Fp(400,1800,2600,!1,0,30),"Q*":Fp(150,440,1179,!1,0,10)," ":Fp(150,440,1179,!1,0,80)}[e]??null}const Rp=0,jp=1,Bp=2,Lp=3,Vp=4,zp=5,Up=6,Gp=7,Wp=8;class Hp extends $r{name="MEA8000Synth";chipName="MEA8000";workletFile="MEA8000.worklet.js";processorName="mea8000-processor";_speechSequencer=null;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0)this._speakSingleVowel(e,t);else if(this._singMode)if(this._speechSequencer){const t=440*Math.pow(2,(e-69)/12);this.writeFrequency(t)}else this._startSpeechAtNote(this._speechText,e,t);else this._startSpeechAtNote(this._speechText,60,t);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFormants",f1:e,f2:t,f3:a})}setNoiseMode(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setNoiseMode",value:e})}setBandwidth(e){this.setParameterById(zp,e)}setInterpTime(e){this.setParameterById(Wp,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}speakText(e){this._isReady&&this.workletNode?this._startSpeechAtNote(e,60,.8):this._pendingCalls.push({method:"speakText",args:[e]})}_startSpeechAtNote(e,t,a){if(!this._isReady||!this.workletNode||this._disposed)return;this.stopSpeaking();const n=Mp(e);if(!n)return;const s=function(e){const t=[];for(const a of e){const e=Dp(a.code);e&&t.push(e)}return t}(Np(n));if(0===s.length)return;const r=s.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:t,velocity:Math.floor(127*a)}),this._speechSequencer=new _p(e=>{this.setFormants(e.f1,e.f2,e.f3),this.setNoiseMode(e.noise),this.setBandwidth(e.bw)},()=>{this._speechSequencer=null,this.triggerRelease()}),this._speechSequencer.speak(r)}stopSpeaking(){const e=null!==this._speechSequencer;this._speechSequencer&&(this._speechSequencer.stop(),this._speechSequencer=null),e&&this.triggerRelease()}get isSpeaking(){return this._speechSequencer?.isSpeaking??!1}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Rp,noise_mode:jp,f1_index:Bp,f2_index:Lp,f3_index:Vp,bw_index:zp,amplitude:Up,stereo_width:Gp,interp_time:Wp}[e];void 0!==a&&this.setParameterById(a,t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(e,t){if(!this._isReady||!this.workletNode||this._disposed)return;const a=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const n=Dp(a);if(!n)return;this.stopSpeaking();const s=[{data:n,durationMs:n.durationMs}];this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)}),this._speechSequencer=new _p(e=>{this.setFormants(e.f1,e.f2,e.f3),this.setNoiseMode(e.noise),this.setBandwidth(e.bw)},()=>{this._vowelLoopSingle||(this._speechSequencer=null,this.triggerRelease())}),this._speechSequencer.speak(s,this._vowelLoopSingle)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Kp=0,qp=1;class $p extends $r{name="RF5C400Synth";chipName="RF5C400";workletFile="RF5C400.worklet.js";processorName="rf5c400-processor";currentVoice=0;constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(){return od(nd)}();await super.initialize(),this.loadROM(0,e),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),voice:this.currentVoice})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,voice:this.currentVoice})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e,voice:this.currentVoice})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e,voice:this.currentVoice})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,voice:this.currentVoice})}setVoice(e){this.currentVoice=Math.max(0,Math.min(31,e))}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,data:t})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:Kp,volume:Kp,clock:qp}[e];void 0!==a&&this.setParameterById(a,t)}setMasterVolume(e){this.setParameterById(Kp,e)}setClock(e){this.setParameterById(qp,e)}}const Xp=0,Yp=1,Zp=2,Qp=3,Jp=4,em=5,tm=6,am=7,nm=8,sm=9,rm=10,im=11,om=12;class lm extends $r{name="SN76477Synth";chipName="SN76477";workletFile="SN76477.worklet.js";processorName="sn76477-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVCOFreq(e){this.sendMessage("setVCOFreq",e)}setSLFFreq(e){this.sendMessage("setSLFFreq",e)}setNoiseFreq(e){this.sendMessage("setNoiseFreq",e)}setVCODutyCycle(e){this.sendMessage("setVCODutyCycle",e)}setMixerMode(e){this.sendMessage("setMixerMode",e)}setEnvelopeMode(e){this.sendMessage("setEnvelopeMode",e)}setAttackTime(e){this.sendMessage("setAttackTime",e)}setDecayTime(e){this.sendMessage("setDecayTime",e)}setOneShotTime(e){this.sendMessage("setOneShotTime",e)}setNoiseFilterFreq(e){this.sendMessage("setNoiseFilterFreq",e)}setAmplitude(e){this.sendMessage("setAmplitude",e)}setVCOMode(e){this.sendMessage("setVCOMode",e)}setChipEnable(e){this.sendMessage("setEnable",e?0:1)}setVCORes(e){this.sendMessage("setVCORes",e)}setVCOCap(e){this.sendMessage("setVCOCap",e)}setVCOVoltage(e){this.sendMessage("setVCOVoltage",e)}setPitchVoltage(e){this.sendMessage("setPitchVoltage",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}static RES_K(e){return 1e3*e}static RES_M(e){return 1e6*e}static CAP_U(e){return 1e-6*e}static CAP_N(e){return 1e-9*e}static CAP_P(e){return 1e-12*e}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={vco_freq:Xp,slf_freq:Yp,noise_freq:Zp,vco_duty_cycle:Qp,mixer_mode:Jp,envelope_mode:em,attack_time:tm,decay_time:am,one_shot_time:nm,noise_filter_freq:sm,amplitude:rm,vco_mode:im,enable:om}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const cm=0,um=1,dm=2,pm=3;class mm extends $r{name="SNKWaveSynth";chipName="SNKWave";workletFile="SNKWave.worklet.js";processorName="snkwave-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}writeWavetableSelect(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",value:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e){this.writeWavetableSelect(e)}setCustomWaveform(e,t,a,n){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setCustomWaveform",b0:e,b1:t,b2:a,b3:n})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:cm,waveform:um,stereo_width:dm,detune:pm}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}function hm(e){return{IY:{preset:wm.EE,voiced:!0,brightness:.7,durationMs:100},IH:{preset:wm.IH,voiced:!0,brightness:.6,durationMs:80},EH:{preset:wm.IH,voiced:!0,brightness:.5,durationMs:80},AE:{preset:wm.AH,voiced:!0,brightness:.6,durationMs:90},AA:{preset:wm.AH,voiced:!0,brightness:.5,durationMs:100},AH:{preset:wm.AH,voiced:!0,brightness:.4,durationMs:80},AO:{preset:wm.OH,voiced:!0,brightness:.3,durationMs:100},UH:{preset:wm.OO,voiced:!0,brightness:.4,durationMs:80},AX:{preset:wm.AH,voiced:!0,brightness:.3,durationMs:60},IX:{preset:wm.IH,voiced:!0,brightness:.4,durationMs:60},ER:{preset:wm.AH,voiced:!0,brightness:.5,durationMs:100},UX:{preset:wm.OO,voiced:!0,brightness:.3,durationMs:80},OH:{preset:wm.OH,voiced:!0,brightness:.4,durationMs:100},EY:{preset:wm.EE,voiced:!0,brightness:.6,durationMs:130},AY:{preset:wm.AH,voiced:!0,brightness:.5,durationMs:140},OY:{preset:wm.OH,voiced:!0,brightness:.4,durationMs:140},AW:{preset:wm.AH,voiced:!0,brightness:.4,durationMs:130},OW:{preset:wm.OH,voiced:!0,brightness:.4,durationMs:130},UW:{preset:wm.OO,voiced:!0,brightness:.3,durationMs:100},"R*":{preset:wm.AH,voiced:!0,brightness:.4,durationMs:70},RX:{preset:wm.AH,voiced:!0,brightness:.4,durationMs:70},"L*":{preset:wm.EE,voiced:!0,brightness:.3,durationMs:70},LX:{preset:wm.EE,voiced:!0,brightness:.3,durationMs:70},"W*":{preset:wm.OO,voiced:!0,brightness:.3,durationMs:60},WX:{preset:wm.OO,voiced:!0,brightness:.3,durationMs:60},WH:{preset:wm.HH,voiced:!1,brightness:.3,durationMs:60},"Y*":{preset:wm.EE,voiced:!0,brightness:.5,durationMs:60},YX:{preset:wm.EE,voiced:!0,brightness:.5,durationMs:60},"M*":{preset:wm.NN,voiced:!0,brightness:.3,durationMs:80},"N*":{preset:wm.NN,voiced:!0,brightness:.4,durationMs:70},NX:{preset:wm.NN,voiced:!0,brightness:.3,durationMs:80},"S*":{preset:wm.ZZ,voiced:!1,brightness:.9,durationMs:90},SH:{preset:wm.ZZ,voiced:!1,brightness:.7,durationMs:90},"F*":{preset:wm.HH,voiced:!1,brightness:.6,durationMs:80},TH:{preset:wm.HH,voiced:!1,brightness:.5,durationMs:80},"/H":{preset:wm.HH,voiced:!1,brightness:.4,durationMs:60},"/X":{preset:wm.HH,voiced:!1,brightness:.4,durationMs:60},"Z*":{preset:wm.ZZ,voiced:!0,brightness:.8,durationMs:90},ZH:{preset:wm.ZZ,voiced:!0,brightness:.6,durationMs:80},"V*":{preset:wm.ZZ,voiced:!0,brightness:.5,durationMs:70},DH:{preset:wm.ZZ,voiced:!0,brightness:.4,durationMs:60},CH:{preset:wm.ZZ,voiced:!1,brightness:.8,durationMs:80},"J*":{preset:wm.ZZ,voiced:!0,brightness:.7,durationMs:80},"B*":{preset:wm.ZZ,voiced:!0,brightness:.3,durationMs:40},"D*":{preset:wm.ZZ,voiced:!0,brightness:.5,durationMs:40},"G*":{preset:wm.ZZ,voiced:!0,brightness:.4,durationMs:40},GX:{preset:wm.ZZ,voiced:!0,brightness:.4,durationMs:40},"P*":{preset:wm.HH,voiced:!1,brightness:.3,durationMs:40},"T*":{preset:wm.HH,voiced:!1,brightness:.5,durationMs:40},"K*":{preset:wm.HH,voiced:!1,brightness:.4,durationMs:40},KX:{preset:wm.HH,voiced:!1,brightness:.4,durationMs:40},DX:{preset:wm.ZZ,voiced:!0,brightness:.4,durationMs:30},"Q*":{preset:wm.AH,voiced:!1,brightness:0,durationMs:10}," ":{preset:wm.AH,voiced:!1,brightness:0,durationMs:80}}[e]??null}const fm=0,ym=1,gm=2,bm=3,vm=4,xm=5,wm={AH:0,EE:1,IH:2,OH:3,OO:4,NN:5,ZZ:6,HH:7};class km extends $r{name="SP0250Synth";chipName="SP0250";workletFile="SP0250.worklet.js";processorName="sp0250-processor";_speechSequencer=null;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0)this._speakSingleVowel(e,t);else if(this._singMode)if(this._speechSequencer){const t=440*Math.pow(2,(e-69)/12);this.writeFrequency(t)}else this._startSpeechAtNote(this._speechText,e,t);else this._startSpeechAtNote(this._speechText,60,t);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.setParameterById(fm,e)}setVowel(e){this.setParameterById(ym,e)}setVoiced(e){this.setParameterById(gm,e?1:0)}setBrightness(e){this.setParameterById(bm,e)}writeFIFO(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeFIFO",index:e,data:t})}setFilterCoeff(e,t,a){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFilterCoeff",filterIdx:e,isB:t,value:a})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}speakText(e){this._isReady&&this.workletNode?this._startSpeechAtNote(e,60,.8):this._pendingCalls.push({method:"speakText",args:[e]})}_startSpeechAtNote(e,t,a){if(!this._isReady||!this.workletNode||this._disposed)return;this.stopSpeaking();const n=Mp(e);if(!n)return;const s=function(e){const t=[];for(const a of e){const e=hm(a.code);e&&t.push(e)}return t}(Np(n));if(0===s.length)return;const r=s.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:t,velocity:Math.floor(127*a)}),this._speechSequencer=new _p(e=>{this.setVowel(e.preset),this.setVoiced(e.voiced),this.setBrightness(e.brightness)},()=>{this._speechSequencer=null,this.triggerRelease()}),this._speechSequencer.speak(r)}stopSpeaking(){const e=null!==this._speechSequencer;this._speechSequencer&&(this._speechSequencer.stop(),this._speechSequencer=null),e&&this.triggerRelease()}get isSpeaking(){return this._speechSequencer?.isSpeaking??!1}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:fm,vowel:ym,voiced:gm,brightness:bm,stereo_width:vm,filter_mix:xm}[e];void 0!==a&&this.setParameterById(a,t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(e,t){if(!this._isReady||!this.workletNode||this._disposed)return;const a=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const n=hm(a);if(!n)return;this.stopSpeaking();const s=[{data:n,durationMs:n.durationMs}];this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)}),this._speechSequencer=new _p(e=>{this.setVowel(e.preset),this.setVoiced(e.voiced),this.setBrightness(e.brightness)},()=>{this._vowelLoopSingle||(this._speechSequencer=null,this.triggerRelease())}),this._speechSequencer.speak(s,this._vowelLoopSingle)}}const Sm=0,Mm=1,Nm=2,Cm=3,Pm=4,Em=5;class _m extends $r{name="TMS36XXSynth";chipName="TMS36XX";workletFile="TMS36XX.worklet.js";processorName="tms36xx-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setStopEnable(e){this.sendMessage("setStopEnable",e)}setOctave(e){this.sendMessage("setOctave",e)}setDecayRate(e){this.setParameterById(Nm,e)}setDetune(e){this.setParameterById(Em,e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Sm,stop_enable:Mm,decay_rate:Nm,octave:Cm,stereo_width:Pm,detune:Em}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}function Tm(e){return{IY:{k:[12,28,11,6,10,7,9,3,5,3],energy:12,pitch:31,unvoiced:!1,durationMs:150},IH:{k:[15,25,10,7,9,7,8,3,4,3],energy:12,pitch:30,unvoiced:!1,durationMs:120},EH:{k:[20,22,10,7,8,7,8,4,4,3],energy:12,pitch:30,unvoiced:!1,durationMs:140},AE:{k:[24,19,10,8,8,7,8,4,4,4],energy:12,pitch:30,unvoiced:!1,durationMs:150},AA:{k:[23,12,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:160},AH:{k:[21,11,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:130},AO:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:150},UH:{k:[17,13,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:120},AX:{k:[18,14,8,8,8,8,8,4,4,4],energy:10,pitch:28,unvoiced:!1,durationMs:90},IX:{k:[14,23,9,7,9,7,8,3,4,3],energy:10,pitch:30,unvoiced:!1,durationMs:90},ER:{k:[18,16,9,9,6,10,7,5,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:160},UX:{k:[14,6,6,10,7,8,8,5,4,4],energy:12,pitch:24,unvoiced:!1,durationMs:130},OH:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:150},EY:{k:[20,22,10,7,8,7,8,4,4,3],energy:12,pitch:30,unvoiced:!1,durationMs:200},AY:{k:[23,12,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:200},OY:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:200},AW:{k:[23,12,8,8,7,8,8,4,4,4],energy:12,pitch:28,unvoiced:!1,durationMs:200},OW:{k:[19,8,7,9,7,8,8,4,4,4],energy:12,pitch:26,unvoiced:!1,durationMs:200},UW:{k:[14,6,6,10,7,8,8,5,4,4],energy:12,pitch:24,unvoiced:!1,durationMs:160},"R*":{k:[17,15,9,9,6,10,7,5,4,4],energy:10,pitch:28,unvoiced:!1,durationMs:100},RX:{k:[17,15,9,9,6,10,7,5,4,4],energy:10,pitch:28,unvoiced:!1,durationMs:100},"L*":{k:[16,20,7,10,5,10,6,5,3,4],energy:10,pitch:28,unvoiced:!1,durationMs:110},LX:{k:[16,20,7,10,5,10,6,5,3,4],energy:10,pitch:28,unvoiced:!1,durationMs:110},"W*":{k:[14,5,5,11,7,8,9,5,5,4],energy:9,pitch:26,unvoiced:!1,durationMs:80},WX:{k:[14,5,5,11,7,8,9,5,5,4],energy:9,pitch:26,unvoiced:!1,durationMs:80},WH:{k:[14,5,5,11,7,8,9,5,5,4],energy:6,pitch:0,unvoiced:!0,durationMs:80},"Y*":{k:[12,28,11,6,10,7,9,3,5,3],energy:9,pitch:30,unvoiced:!1,durationMs:80},YX:{k:[12,28,11,6,10,7,9,3,5,3],energy:9,pitch:30,unvoiced:!1,durationMs:80},"M*":{k:[20,10,4,14,5,10,6,5,3,5],energy:9,pitch:28,unvoiced:!1,durationMs:120},"N*":{k:[18,19,4,14,5,10,6,5,3,5],energy:9,pitch:28,unvoiced:!1,durationMs:100},NX:{k:[16,12,4,14,5,10,6,5,3,5],energy:9,pitch:28,unvoiced:!1,durationMs:120},"S*":{k:[10,28,14,12,11,5,10,2,6,2],energy:8,pitch:0,unvoiced:!0,durationMs:140},SH:{k:[12,22,13,13,10,6,9,3,5,3],energy:10,pitch:0,unvoiced:!0,durationMs:140},"F*":{k:[8,20,12,9,10,5,8,2,5,2],energy:6,pitch:0,unvoiced:!0,durationMs:120},TH:{k:[8,24,12,8,10,5,8,2,6,2],energy:5,pitch:0,unvoiced:!0,durationMs:120},"/H":{k:[18,14,8,8,8,8,8,4,4,4],energy:6,pitch:0,unvoiced:!0,durationMs:80},"/X":{k:[18,14,8,8,8,8,8,4,4,4],energy:6,pitch:0,unvoiced:!0,durationMs:80},"Z*":{k:[10,28,14,12,11,5,10,2,6,2],energy:9,pitch:28,unvoiced:!1,durationMs:130},ZH:{k:[12,22,13,13,10,6,9,3,5,3],energy:9,pitch:28,unvoiced:!1,durationMs:120},"V*":{k:[8,20,12,9,10,5,8,2,5,2],energy:8,pitch:28,unvoiced:!1,durationMs:100},DH:{k:[8,24,12,8,10,5,8,2,6,2],energy:8,pitch:28,unvoiced:!1,durationMs:80},CH:{k:[12,24,13,12,10,6,9,3,5,3],energy:8,pitch:0,unvoiced:!0,durationMs:120},"J*":{k:[12,24,13,12,10,6,9,3,5,3],energy:9,pitch:28,unvoiced:!1,durationMs:120},"B*":{k:[22,10,6,10,5,9,7,4,3,4],energy:7,pitch:28,unvoiced:!1,durationMs:60},"D*":{k:[18,22,6,10,6,8,7,3,4,3],energy:7,pitch:28,unvoiced:!1,durationMs:60},"G*":{k:[16,14,6,10,7,8,8,4,4,4],energy:7,pitch:28,unvoiced:!1,durationMs:60},GX:{k:[16,14,6,10,7,8,8,4,4,4],energy:7,pitch:28,unvoiced:!1,durationMs:60},"P*":{k:[22,10,6,10,5,9,7,4,3,4],energy:5,pitch:0,unvoiced:!0,durationMs:60},"T*":{k:[18,22,6,10,6,8,7,3,4,3],energy:6,pitch:0,unvoiced:!0,durationMs:60},"K*":{k:[16,14,6,10,7,8,8,4,4,4],energy:5,pitch:0,unvoiced:!0,durationMs:60},KX:{k:[16,14,6,10,7,8,8,4,4,4],energy:5,pitch:0,unvoiced:!0,durationMs:60},DX:{k:[18,22,6,10,6,8,7,3,4,3],energy:6,pitch:28,unvoiced:!1,durationMs:40},"Q*":{k:[8,8,8,8,8,8,8,4,4,4],energy:1,pitch:0,unvoiced:!1,durationMs:20}," ":{k:[8,8,8,8,8,8,8,4,4,4],energy:1,pitch:0,unvoiced:!1,durationMs:120}}[e]??null}class Am{data;bitPos;constructor(e,t=0){this.data=e,this.bitPos=t}readBits(e){let t=0;for(let a=0;a<e;a++){const e=Math.floor(this.bitPos/8),a=this.bitPos%8;if(e<this.data.length){t=t<<1|this.data[e]>>a&1}this.bitPos++}return t}get position(){return this.bitPos}set position(e){this.bitPos=e}get bytesRemaining(){return Math.floor((8*this.data.length-this.bitPos)/8)}}function Om(e){const t=e.readBits(4);if(0===t)return{energy:0,repeat:!1,pitch:0,k:[],unvoiced:!1};if(15===t)return null;const a=1===e.readBits(1),n=e.readBits(5),s=0===n;if(a)return{energy:t,repeat:!0,pitch:n,k:[],unvoiced:s};const r=e.readBits(5),i=e.readBits(5),o=e.readBits(4),l=e.readBits(4);if(s)return{energy:t,repeat:!1,pitch:n,unvoiced:!0,k:[r,i,o,l,8,8,8,4,4,4]};return{energy:t,repeat:!1,pitch:n,unvoiced:!1,k:[r,i,o,l,e.readBits(4),e.readBits(4),e.readBits(4),e.readBits(3),e.readBits(3),e.readBits(3)]}}function Im(e,t){const a=new Am(e,t),n=[],s=8*e.length;for(;a.position<s-10&&n.length<300;){const e=Om(a);if(null===e)break;n.push(e)}return n}const Fm=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","ABOUT","AFTER","AGAIN","ANSWER","BEAUTY","BETWEEN","BOY","BUILT","BUSY","BUY","CEILING","CIRCLE","CLOWN","COME","COULD","COUNTRY","COUSIN","DOES","DOUBLE","ENOUGH","EVER","EYE","FRIEND","FROM","GHOST","GIRL","GOES","GONE","GOOD","GREAT","GUARD","GUESS","GYM","HALF","HAVE","HEART","HERE","HIDDEN","HOUR","IDEA","ISLE","JOIN","KEY","KNOW","LAUGH","LEARN","LISTEN","LOVE","MACHINE","MANY","MEANT","MOVE","NONE","OCEAN","OF","ONE","ONLY","OTHER","OVEN","OUTSIDE","PEOPLE","PERIOD","PHONE","PIECE","PRETTY","PROMISE","PSYCHOLOGY","QUIET","READY","RIGHT","ROUGH","SAID","SAYS","SCHOOL","SCIENCE","SCISSORS","SECRET","SHOULD","SIGN","SOME","SPECIAL","SQUARE","STRAIGHT","SUGAR","SURE","THEIR","THERE","THEY","THOUGH","THOUGHT","THROUGH","TOGETHER","TROUBLE","TWO","UPON","USUAL","VERY","WAS","WATCH","WATER","WEAR","WEIRD","WHAT","WHERE","WHO","WOMEN","WON","WORD","WORK","WOULD","WRITE","WRONG","YOU","YOUR","ZERO"];const Dm={IY:"vowel",IH:"vowel",EH:"vowel",AE:"vowel",AA:"vowel",AH:"vowel",AO:"vowel",UH:"vowel",AX:"vowel",IX:"vowel",ER:"vowel",UX:"vowel",OH:"vowel",EY:"diphthong",AY:"diphthong",OY:"diphthong",AW:"diphthong",OW:"diphthong",UW:"diphthong","R*":"liquid",RX:"liquid","L*":"liquid",LX:"liquid","W*":"glide",WX:"glide",WH:"glide","Y*":"glide",YX:"glide","M*":"nasal","N*":"nasal",NX:"nasal","S*":"fricative",SH:"fricative","F*":"fricative",TH:"fricative","/H":"fricative","/X":"fricative","Z*":"fricative",ZH:"fricative","V*":"fricative",DH:"fricative",CH:"affricate","J*":"affricate","P*":"stop","T*":"stop","K*":"stop",KX:"stop","B*":"stop","D*":"stop","G*":"stop",GX:"stop",DX:"stop","Q*":"stop"," ":"pause"};function Rm(e){return Dm[e]??"other"}const jm={A:{segments:["EY"],type:"V"},B:{segments:["B*","IY"],type:"CV"},C:{segments:["S*","IY"],type:"CV"},D:{segments:["D*","IY"],type:"CV"},E:{segments:["IY"],type:"V"},F:{segments:["EH","F*"],type:"VC"},G:{segments:["J*","IY"],type:"CV"},H:{segments:["EY","CH"],type:"VC"},I:{segments:["AY"],type:"V"},J:{segments:["J*","EY"],type:"CV"},K:{segments:["K*","EY"],type:"CV"},L:{segments:["EH","L*"],type:"VC"},M:{segments:["EH","M*"],type:"VC"},N:{segments:["EH","N*"],type:"VC"},O:{segments:["OW"],type:"V"},P:{segments:["P*","IY"],type:"CV"},Q:{segments:["K*","UW"],type:"CVC"},R:{segments:["AA","R*"],type:"VC"},S:{segments:["EH","S*"],type:"VC"},T:{segments:["T*","IY"],type:"CV"},U:{segments:["Y*","UW"],type:"GV"},V:{segments:["V*","IY"],type:"CV"},W:{segments:[],type:"SKIP"},X:{segments:[],type:"SKIP"},Y:{segments:["W*","AY"],type:"GV"},Z:{segments:["Z*","IY"],type:"CV"}};function Bm(e){for(let t=0;t<e.length;t++)if(!e[t].unvoiced&&e[t].energy>=6&&e[t].pitch>0)return t;return Math.floor(.3*e.length)}function Lm(e){if(e.length<=2)return e;const t=Math.max(1,Math.floor(.2*e.length));return e.slice(t,e.length-t)}const Vm=[31,31,15,15,15,15,15,7,7,7];function zm(e,t){return Math.min(Math.max(Math.round(e[t]??0),0),Vm[t])}function Um(e,t,a){const n=[];for(let s=0;s<10;s++){const r=(e.k[s]??0)*(1-a)+(t.k[s]??0)*a;n.push(Math.min(Math.max(Math.round(r),0),Vm[s]))}return{k:n,energy:Math.min(Math.max(Math.round(e.energy*(1-a)+t.energy*a),0),14),pitch:Math.min(Math.max(Math.round(e.pitch*(1-a)+t.pitch*a),0),31),unvoiced:a<.5?e.unvoiced:t.unvoiced,durationMs:25}}function Gm(e,t){let a;switch(t){case"vowel":case"diphthong":a=6;break;case"nasal":case"liquid":a=5;break;case"fricative":case"glide":a=4;break;default:a=3}const n=[];for(let s=0;s<a;s++){const t=s/a*Math.PI*2,r=[...e.k];r[0]=zm(r,0)+Math.round(Math.sin(t)),r[0]=Math.min(Math.max(r[0],0),Vm[0]),r[1]=zm(r,1)+Math.round(Math.cos(t)),r[1]=Math.min(Math.max(r[1],0),Vm[1]),n.push({k:r,energy:e.energy,pitch:e.pitch,unvoiced:e.unvoiced,durationMs:25})}return n}function Wm(e,t){const a=Math.max(1,Math.round(t));if(0===e.length)return[];if(1===e.length||1===a)return[{...e[0],k:[...e[0].k],durationMs:25}];if(a===e.length)return e.map(e=>({...e,k:[...e.k],durationMs:25}));const n=[];for(let s=0;s<a;s++){const t=s/(a-1)*(e.length-1),r=Math.floor(t),i=t-r;if(r>=e.length-1){const t=e[e.length-1];n.push({...t,k:[...t.k],durationMs:25})}else n.push(Um(e[r],e[r+1],i))}return n}function Hm(e,t=.65){return e.length<=2?e.map(e=>({...e,k:[...e.k]})):Wm(e,e.length*t)}function Km(e,t){return e.length<=1||1===t?e.map(e=>({...e,k:[...e.k]})):Wm(e,e.length*t)}function qm(e){return e<=0?.8:e<=2?.9:e<=4?1:e<=6?1.15:1.3}function $m(e,t){return e.length<=1?e:e.map((a,n)=>{const s=n/(e.length-1);let r=1;switch(t){case"vowel":case"diphthong":s<.2?r=.6+s/.2*.4:s>.75&&(r=.6+(1-s)/.25*.4);break;case"stop":r=s<.1?.8+s/.1*.2:1-.3*(s-.1);break;case"fricative":s<.3?r=.5+s/.3*.5:s>.75&&(r=.5+(1-s)/.25*.5);break;case"affricate":r=s<.15?.7+s/.15*.3:1-.25*(s-.15);break;case"nasal":case"liquid":case"glide":s<.25?r=.7+s/.25*.3:s>.8&&(r=.7+(1-s)/.2*.3)}const i=Math.max(1,Math.min(14,Math.round(a.energy*r)));return{...a,k:[...a.k],energy:i}})}function Xm(e,t){return e.length<=2?e.map(e=>({...e,k:[...e.k]})):e.map((a,n)=>{if(a.unvoiced||0===a.pitch)return{...a,k:[...a.k]};const s=n/(e.length-1);let r=0;switch(t){case"vowel":case"diphthong":r=Math.round(1-2*s);break;case"nasal":case"liquid":s>.7&&(r=-1)}const i=Math.min(31,Math.max(1,a.pitch+r));return{...a,k:[...a.k],pitch:i}})}function Ym(e,t){const a=e.pClass,n=t.pClass;if("pause"===a||"pause"===n)return 0;if("stop"===a)return 0;if("stop"===n)return 1;if((e.frames.length>0&&!e.frames[e.frames.length-1].unvoiced)!==(t.frames.length>0&&!t.frames[0].unvoiced))return 1;const s=["vowel","diphthong","nasal","liquid","glide"];return s.includes(a)&&s.includes(n)?2:1}function Zm(e,t){const a=new Map,n=jm[e.toUpperCase()];if(!n||"SKIP"===n.type||0===n.segments.length)return a;const s=function(e){const t=[];let a=[8,8,8,8,8,8,8,4,4,4],n=!1;for(const s of e)0!==s.energy?s.repeat?t.push({energy:s.energy,repeat:!1,pitch:s.pitch,k:[...a],unvoiced:n}):(a=[...s.k],n=s.unvoiced,t.push({...s,k:[...s.k]})):t.push({...s});return t}(t),r=function(e){let t=0;for(;t<e.length&&0===e[t].energy;)t++;let a=e.length-1;for(;a>=t&&0===e[a].energy;)a--;return e.slice(t,a+1)}(s);if(r.length<2)return a;switch(n.type){case"V":{const e=Lm(r);e.length>0&&a.set(n.segments[0],e);break}case"CV":{const e=Bm(r),t=r.slice(0,e),s=r.slice(e);if(t.length>0&&a.set(n.segments[0],t),s.length>0){const e=Lm(s);e.length>0&&a.set(n.segments[1],e)}break}case"VC":{const e=function(e){for(let t=e.length-1;t>=0;t--)if(!e[t].unvoiced&&e[t].energy>=6&&e[t].pitch>0)return t+1;return Math.floor(.7*e.length)}(r),t=r.slice(0,e),s=r.slice(e);if(t.length>0){const e=Lm(t);e.length>0&&a.set(n.segments[0],e)}s.length>0&&a.set(n.segments[1],s);break}case"CVC":{const e=Bm(r),t=r.slice(0,e),s=r.slice(e),i=Math.floor(s.length/2),o=s.slice(i);if(t.length>0&&a.set(n.segments[0],t),o.length>0){const e=Lm(o);e.length>0&&a.set(n.segments[1],e)}break}case"GV":{const e=Math.max(1,Math.floor(.3*r.length)),t=r.slice(0,e),s=r.slice(e);if(t.length>0&&a.set(n.segments[0],t),s.length>0){const e=Lm(s);e.length>0&&a.set(n.segments[1],e)}break}}return a}function Qm(e){return e.filter(e=>e.energy>0).map(e=>({k:e.k.length>=10?[...e.k]:[...e.k,...Array(10-e.k.length).fill(0)],energy:e.energy,pitch:e.pitch,unvoiced:e.unvoiced,durationMs:25}))}function Jm(e,t,a){const n=[];for(const s of e){const e=Rm(s.code),r=t.get(s.code);let i;if(r&&r.length>0)i=r.map(e=>({...e,k:[...e.k]})),i=Hm(i);else{const t=a(s.code);if(!t)continue;i=Gm(t,e)}const o=qm(s.stress);1!==o&&(i=Km(i,o)),s.stress>=4&&(i=i.map(e=>({...e,k:[...e.k],energy:Math.min(14,e.energy+2)}))),i=$m(i,e),i=Xm(i,e),n.push({code:s.code,pClass:e,frames:i})}return function(e){if(0===e.length)return[];const t=[];for(let a=0;a<e.length;a++){const n=e[a];if(0!==n.frames.length){for(const e of n.frames)t.push({...e,k:[...e.k]});if(a<e.length-1){const s=e[a+1];if(0===s.frames.length)continue;const r=Ym(n,s);if(0===r)continue;const i=n.frames[n.frames.length-1],o=s.frames[0];for(let e=0;e<r;e++){const a=Um(i,o,(e+1)/(r+1));i.unvoiced!==o.unvoiced&&(a.energy=Math.max(1,Math.round(.6*a.energy))),t.push(a)}}}}return t}(n)}const eh=0,th=1,ah=2,nh=3,sh=4,rh=5,ih=6,oh=7,lh=8,ch=9,uh=10,dh=11,ph=12,mh=13,hh=14,fh=15,yh=16,gh=17;class bh extends $r{name="TMS5220Synth";chipName="TMS5220";workletFile="TMS5220.worklet.js";processorName="tms5220-processor";_romData=null;_romWords=[];_romLoaded=!1;_romSentToWasm=!1;_romPhonemes=null;_speakingChain=null;_phonemeSpeechActive=!1;_phonemeSpeechTimer=null;_speechPitchIndex=32;_speechEnergyIndex=10;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth(),this._loadROMs()}async _loadROMs(){try{this._romData=await async function(){return od(Ju)}();try{const e=await fetch(Wa("/roms/snspell/tmc0271h-n2l"));if(!e.ok)throw new Error(`MCU ROM not found (${e.status})`);const t=await e.arrayBuffer();this._romWords=function(e,t){const a=t.length,n=[],s=Math.min(1024,a),r=[];let i=0;for(let l=0;l<s;l+=2){const e=t[l]|t[l+1]<<8,n=16384*(e>>14&3)+(16383&e);if(n>=a){if(i++,i>5)break;continue}const s=Im(t,8*n),o=s.length>0&&15===s[s.length-1].energy;if(s.length>=3||s.length>=1&&o)r.push({byteOffset:n,tableOffset:l}),i=0;else if(i++,r.length>20&&i>5)break}let o=0;if(r.length>15){const e=10;for(let i=0;i<=Math.min(10,r.length-e);i++){let t=!0;for(let a=i;a<i+e-1;a++)if(r[a+1].byteOffset<=r[a].byteOffset){t=!1;break}if(t){o=i;break}}const t=Math.min(o+15,r.length-1);let a=0,n=o;const s=[];for(let i=o;i<t;i++){const e=r[i+1].byteOffset-r[i].byteOffset;s.push(e),e>a&&(a=e,n=i+1)}if(s.length>3){const e=[...s].sort((e,t)=>e-t);a>3*e[Math.floor(e.length/2)]&&n>o&&(o=n)}}for(let l=o;l<r.length;l++){const e=l-o,a=e<Fm.length?Fm[e]:`Word ${e}`,s=8*r[l].byteOffset,i=Im(t,s);n.push({name:a,startBit:s,frames:i})}return n}(new Uint8Array(t),this._romData)}catch{this._romWords=function(e,t=256){const a=[],n=new Am(e),s=8*e.length;let r=0;for(let i=0;i<e.length-4&&r<t;i++){const e=8*i;n.position=e;const t=[];let o=!0,l=0,c=0;for(;o&&l<200;){if(n.position>=s-10){o=!1;break}const e=Om(n);if(null===e){if(l>=3)break;o=!1;break}if(t.push(e),l++,0===e.energy){if(c++,c>5){o=!1;break}}else c=0}o&&t.length>=3&&(a.some(t=>{const a=t.startBit+50*t.frames.length;return e>=t.startBit&&e<a})||(a.push({name:`Word ${r}`,startBit:e,frames:t}),r++,i=Math.floor(n.position/8)))}return a}(this._romData)}this._romWords.length>=26&&(this._romPhonemes=function(e){const t=new Map;for(let a=0;a<Math.min(26,e.length);a++){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[a],s=e[a];if(s.name.toUpperCase()!==n)continue;const r=Zm(n,s.frames);for(const[e,a]of r){if(0===a.length)continue;const n=Qm(a);if(0===n.length)continue;const s=t.get(e);(!s||n.length>s.length)&&t.set(e,n)}}return t}(this._romWords.slice(0,26))),this._romLoaded=!0,this.romLoaded=!0;this._romWords.slice(0,10).map(e=>e.name);this._isReady&&this._sendROMToWasm()}catch{}}_sendROMToWasm(){if(!this._romData||!this.workletNode||this._romSentToWasm)return;const e=this._romData.buffer.slice(this._romData.byteOffset,this._romData.byteOffset+this._romData.byteLength);this.workletNode.port.postMessage({type:"loadROM",romData:e},[e]),this._romData=null,this._romSentToWasm=!0}handleWorkletMessage(e){super.handleWorkletMessage(e),"ready"===e.type&&this._romLoaded&&!this._romSentToWasm&&this._sendROMToWasm()}get romWords(){return this._romWords}get hasROM(){return this._romLoaded}speakWord(e){this.stopSpeaking(),this._playROMWordDirect(e)}_playROMWordDirect(e){if(!this._romLoaded||e<0||e>=this._romWords.length)return;if(!this._romSentToWasm||!this.workletNode||this._disposed)return;const t=this._romWords[e],a=Math.floor(t.startBit/8);this.workletNode.port.postMessage({type:"setVolume",value:1}),this.workletNode.port.postMessage({type:"speakAtByte",byteAddr:a})}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0){const t=Math.round(.5*(e-60));this.setParameterById(gh,t),this._speakSingleVowel()}else if(this._singMode){const t=Math.round(.5*(e-60));this.setParameterById(gh,t),this.isSpeaking||this.speakText(this._speechText)}else this.stopSpeaking(),this.speakText(this._speechText);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setFormants(e){this.workletNode&&!this._disposed&&(e.length<10||(this.setParameterById(ah,e[0]),this.setParameterById(nh,e[1]),this.setParameterById(sh,e[2]),this.setParameterById(uh,e[3]),this.setParameterById(dh,e[4]),this.setParameterById(ph,e[5]),this.setParameterById(mh,e[6]),this.setParameterById(hh,e[7]),this.setParameterById(fh,e[8]),this.setParameterById(yh,e[9])))}setNoiseMode(e){this.workletNode&&!this._disposed&&this.setParameterById(oh,e?1:0)}setChirpType(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setChirpType",value:e})}setEnergy(e){this.setParameterById(rh,e)}setBrightness(e){this.setParameterById(ch,e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}speakText(e){this._isReady&&this.workletNode?this._romSentToWasm&&this._romWords.length>0?this.speakTextHybrid(e):this._speakPhonemeText(e):this._pendingCalls.push({method:"speakText",args:[e]})}stopSpeaking(){this._speakingChain=null,this._phonemeSpeechActive=!1,null!==this._phonemeSpeechTimer&&(clearTimeout(this._phonemeSpeechTimer),this._phonemeSpeechTimer=null),this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"stopSpeaking"})}get isSpeaking(){return this._phonemeSpeechActive||null!==this._speakingChain}speakLetter(e){const t=this._romWords.findIndex(t=>t.name===e.toUpperCase());t>=0&&this.speakWord(t)}spellText(e){this.stopSpeaking();const t=e.toUpperCase().split("").filter(e=>/[A-Z]/.test(e));if(0===t.length)return;let a=0;const n=()=>{if(a>=t.length||!this._speakingChain)return;const e=this._romWords.findIndex(e=>e.name===t[a]);if(a++,e>=0){this._playROMWordDirect(e);const t=25*this._romWords[e].frames.length+100;setTimeout(n,t)}else setTimeout(n,300)};this._speakingChain=n,n()}speakTextHybrid(e){this.stopSpeaking();const t=e.trim().split(/\s+/).filter(Boolean);if(0===t.length)return;let a=0;const n=()=>{if(a>=t.length||!this._speakingChain)return void(this._speakingChain=null);const e=t[a++];let s=-1;if(1===e.length&&/^[A-Za-z]$/.test(e)&&(s=this._romWords.findIndex((t,a)=>a<26&&t.name.toLowerCase()===e.toLowerCase())),s>=0){this._playROMWordDirect(s);const e=25*this._romWords[s].frames.length+200;setTimeout(n,e)}else this._speakPhonemeWord(e,()=>{setTimeout(n,200)})};this._speakingChain=n,n()}_packFrameBuffer(e){let t=0;for(const r of e){t+=Math.max(1,Math.round(r.durationMs/25))}t+=1;const a=new Uint8Array(12*t);let n=0;const s=[31,31,15,15,15,15,15,7,7,7];for(const r of e){const e=Math.max(1,Math.round(r.durationMs/25)),t=Math.min(Math.max(r.energy,1),14),i=r.unvoiced?0:Math.min(Math.max(r.pitch,0),31),o=r.k;for(let r=0;r<e;r++){a[n]=t,a[n+1]=i;for(let e=0;e<10;e++)a[n+2+e]=Math.min(Math.max(o[e]??0,0),s[e]);n+=12}}return a[n]=0,{data:a,numFrames:t}}_applySpeechParamsToFrames(e){const t=this._speechPitchIndex-32,a=this._speechEnergyIndex/10;return 0===t&&Math.abs(a-1)<.01?e:e.map(e=>{let n=e.pitch,s=e.energy;return 0!==t&&e.pitch>0&&(n=Math.max(1,Math.min(31,e.pitch+t))),Math.abs(a-1)>=.01&&e.energy>0&&e.energy<15&&(s=Math.max(1,Math.min(14,Math.round(e.energy*a)))),n===e.pitch&&s===e.energy?e:{...e,pitch:n,energy:s}})}_sendFrameBufferAndSpeak(e,t){if(!this.workletNode||this._disposed)return void t?.();const a=this._applySpeechParamsToFrames(e),{data:n,numFrames:s}=this._packFrameBuffer(a),r=n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(this.workletNode.port.postMessage({type:"loadFrameBuffer",frameData:r,numFrames:s},[r]),this.workletNode.port.postMessage({type:"speakFrameBuffer"}),this._phonemeSpeechActive=!0,t){const e=25*s+100;this._phonemeSpeechTimer=setTimeout(()=>{this._phonemeSpeechTimer=null,this._phonemeSpeechActive=!1,t()},e)}}_buildPhonemeFrames(e){return this._romPhonemes&&this._romPhonemes.size>0?Jm(e,this._romPhonemes,Tm):function(e){const t=[];for(const a of e){const e=Tm(a.code);if(e){const n=a.stress>=4?2:0;t.push({...e,energy:Math.min(14,e.energy+n)})}}return t}(e)}_speakPhonemeText(e){this.stopSpeaking();const t=Mp(e);if(!t)return;const a=Np(t),n=this._buildPhonemeFrames(a);0!==n.length&&this._sendFrameBufferAndSpeak(n,()=>{this._phonemeSpeechActive=!1})}_speakPhonemeWord(e,t){const a=Mp(e);if(!a)return void t();const n=Np(a),s=this._buildPhonemeFrames(n);0!==s.length?(this.workletNode&&this.workletNode.port.postMessage({type:"stopSpeaking"}),this._sendFrameBufferAndSpeak(s,t)):t()}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:eh,chirp_type:th,k1_index:ah,k2_index:nh,k3_index:sh,energy_index:rh,pitch_index:ih,noise_mode:oh,stereo_width:lh,brightness:ch}[e];void 0!==a&&this.setParameterById(a,t),"pitch_index"===e&&(this._speechPitchIndex=t),"energy_index"===e&&(this._speechEnergyIndex=t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(){if(!this._isReady||!this.workletNode||this._disposed)return;const e=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const t=Tm(e);if(!t)return;this.stopSpeaking();const a=this._vowelLoopSingle?Array(40).fill(t):[t];this._sendFrameBufferAndSpeak(a,()=>{this._phonemeSpeechActive=!1})}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const vh=0,xh=1,wh=2,kh=3,Sh=4,Mh=5,Nh=6,Ch=7,Ph=8,Eh=9,_h=10,Th=11,Ah=12,Oh={BASS_1:36,SNARE_1:38,SNARE_2:40,LOW_TOM:41,MID_TOM:47,HI_TOM:50,RIMSHOT:37,COWBELL:56,HANDCLAP:39,TAMBOURINE:54,CLOSED_HIHAT:42,OPEN_HIHAT:46,CRASH:49,RIDE:51};class Ih extends $r{name="TR707Synth";chipName="TR707";workletFile="TR707.worklet.js";processorName="tr707-processor";constructor(){super(),this.initSynth()}async initialize(){try{const e=await async function(e=!1){if(e)try{return await od(Qu)}catch{}return od(Zu)}(!1);await super.initialize(),this.loadCombinedROM(e);for(let t=0;t<10;t++)this.setParameterById(xh+t,.8);this.setParameterById(vh,.8),this.setParameterById(Th,.5),this.setParameterById(Ah,.5),this.romLoaded=!0}catch(e){}}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"allNotesOff"})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}loadROM(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"loadROM",offset:e,data:t.buffer,size:t.length},[t.buffer.slice(0)])}loadCombinedROM(e){this.loadROM(0,e)}loadROMs(e,t,a){this.loadROM(0,e),this.loadROM(65536,t),this.loadROM(98304,a)}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setVoiceLevel(e,t){this.setParameterById(xh+e,t)}setAccent(e){this.setParameterById(Th,e)}setDecay(e){this.setParameterById(Ah,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:vh,bass:xh,snare:wh,low_tom:kh,mid_tom:Sh,hi_tom:Mh,rimshot:Nh,handclap:Ch,hihat:Ph,crash:Eh,ride:_h,accent:Th,decay:Ah}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Fh=0,Dh=1,Rh=2,jh=3,Bh=4,Lh=5,Vh=6,zh=7;class Uh extends $r{name="UPD931Synth";chipName="UPD931";workletFile="UPD931.worklet.js";processorName="upd931-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setWaveA(e){this.setParameterById(Dh,e)}setWaveB(e){this.setParameterById(Rh,e)}setMirror(e){this.setParameterById(jh,e?1:0)}setInvert(e){this.setParameterById(Bh,e?1:0)}setModeA(e){this.setParameterById(Lh,e)}setModeB(e){this.setParameterById(Vh,e)}setKeyScaling(e){this.setParameterById(zh,e?1:0)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Fh,wave_a:Dh,wave_b:Rh,mirror:jh,invert:Bh,mode_a:Lh,mode_b:Vh,key_scaling:zh}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Gh=0,Wh=1,Hh=2,Kh=3,qh=4,$h=5,Xh=6,Yh=7,Zh=8,Qh=9,Jh=10;class ef extends $r{name="UPD933Synth";chipName="UPD933";workletFile="UPD933.worklet.js";processorName="upd933-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote})}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWaveform",wave1:e,wave2:t})}setWindow(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setWindow",value:e})}setDCWDepth(e){this.setParameterById(qh,e)}setDCARate(e){this.setParameterById($h,e)}setDCWRate(e){this.setParameterById(Xh,e)}setDCODepth(e){this.setParameterById(Zh,e)}setRingMod(e){this.setParameterById(Qh,e?1:0)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:Gh,waveform1:Wh,waveform2:Hh,window:Kh,dcw_depth:qh,dca_rate:$h,dcw_rate:Xh,dco_rate:Yh,dco_depth:Zh,ring_mod:Qh,stereo_width:Jh}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const tf=0,af=1,nf=2,sf=3,rf=4,of=5,lf=6,cf=7,uf=8,df=9,pf=10,mf=11,hf=12,ff=13,yf=14,gf=15,bf=16,vf=17,xf=18,wf=19,kf=20,Sf=21,Mf=22,Nf=23,Cf=24,Pf=25,Ef=26,_f=27,Tf=28,Af=29,Of=30,If=31,Ff=32,Df=33,Rf=34,jf=35,Bf=36,Lf=37,Vf=38,zf=39,Uf=40,Gf=41,Wf=42,Hf=43,Kf=44,qf=45,$f=46,Xf=47,Yf=48,Zf=49,Qf=50,Jf=51,ey=52,ty=53,ay=54,ny=55,sy=56,ry=57,iy=58,oy=59,ly=60,cy=61,uy=62,dy=63,py={[tf]:59,[af]:49,[nf]:39,[sf]:5,[rf]:21,[of]:47,[lf]:39,[cf]:47,[uf]:49,[df]:59,[pf]:49,[mf]:39,[hf]:49,[ff]:49,[yf]:21,[gf]:41,[bf]:33,[vf]:47,[xf]:47,[wf]:53,[kf]:49,[Sf]:39,[Mf]:47,[Nf]:59,[Cf]:41,[Pf]:23,[Ef]:33,[_f]:33,[Tf]:23,[Af]:41,[Of]:21,[If]:47,[Ff]:53,[Df]:59,[Rf]:33,[jf]:59,[Bf]:53,[Lf]:21,[Vf]:53,[zf]:49,[Uf]:53,[Gf]:41,[Wf]:21,[Hf]:43,[Kf]:53,[qf]:33,[$f]:53,[Xf]:39,[Yf]:47,[Zf]:49,[Qf]:39,[Jf]:53,[ey]:47,[ty]:39,[ay]:53,[ny]:39,[sy]:41,[ry]:57,[iy]:53,[oy]:53,[ly]:39,[cy]:59,[uy]:15,[dy]:5};function my(e){return 2*(py[e]??30)}function hy(e){return{IY:[{phone:Kf,durationMs:my(Kf)}],IH:[{phone:zf,durationMs:my(zf)}],EH:[{phone:oy,durationMs:my(oy)}],AE:[{phone:$f,durationMs:my($f)}],AA:[{phone:Ff,durationMs:my(Ff)}],AH:[{phone:Bf,durationMs:my(Bf)}],AO:[{phone:Vf,durationMs:my(Vf)}],UH:[{phone:Jf,durationMs:my(Jf)}],AX:[{phone:Sf,durationMs:my(Sf)}],IX:[{phone:mf,durationMs:my(mf)}],ER:[{phone:iy,durationMs:my(iy)}],UX:[{phone:Uf,durationMs:my(Uf)}],OH:[{phone:Vf,durationMs:my(Vf)}],EY:[{phone:oy,durationMs:my(oy)},{phone:mf,durationMs:my(mf)}],AY:[{phone:Df,durationMs:my(Df)},{phone:mf,durationMs:my(mf)}],OY:[{phone:Vf,durationMs:my(Vf)},{phone:mf,durationMs:my(mf)}],AW:[{phone:cy,durationMs:my(cy)},{phone:ny,durationMs:my(ny)}],OW:[{phone:Vf,durationMs:my(Vf)},{phone:ny,durationMs:my(ny)}],UW:[{phone:Nf,durationMs:my(Nf)}],"R*":[{phone:Hf,durationMs:my(Hf)}],RX:[{phone:Hf,durationMs:my(Hf)}],"L*":[{phone:Cf,durationMs:my(Cf)}],LX:[{phone:Cf,durationMs:my(Cf)}],"W*":[{phone:qf,durationMs:my(qf)}],WX:[{phone:qf,durationMs:my(qf)}],WH:[{phone:qf,durationMs:my(qf)}],"Y*":[{phone:Gf,durationMs:my(Gf)}],YX:[{phone:Gf,durationMs:my(Gf)}],"M*":[{phone:hf,durationMs:my(hf)}],"N*":[{phone:ff,durationMs:my(ff)}],NX:[{phone:kf,durationMs:my(kf)}],"S*":[{phone:If,durationMs:my(If)}],SH:[{phone:vf,durationMs:my(vf)}],"F*":[{phone:Af,durationMs:my(Af)}],TH:[{phone:ry,durationMs:my(ry)}],"/H":[{phone:_f,durationMs:my(_f)}],"/X":[{phone:_f,durationMs:my(_f)}],"Z*":[{phone:xf,durationMs:my(xf)}],ZH:[{phone:cf,durationMs:my(cf)}],"V*":[{phone:gf,durationMs:my(gf)}],DH:[{phone:sy,durationMs:my(sy)}],CH:[{phone:bf,durationMs:my(bf)}],"J*":[{phone:Ef,durationMs:my(Ef)}],"B*":[{phone:yf,durationMs:my(yf)}],"D*":[{phone:Of,durationMs:my(Of)}],"G*":[{phone:Tf,durationMs:my(Tf)}],GX:[{phone:Tf,durationMs:my(Tf)}],"P*":[{phone:Lf,durationMs:my(Lf)}],"T*":[{phone:Wf,durationMs:my(Wf)}],"K*":[{phone:Pf,durationMs:my(Pf)}],KX:[{phone:Pf,durationMs:my(Pf)}],DX:[{phone:rf,durationMs:my(rf)}],"Q*":[{phone:sf,durationMs:my(sf)}]," ":[{phone:uy,durationMs:my(uy)}]}[e]??null}const fy=0,yy=1,gy=2,by=3,vy=4,xy=5,wy=6;class ky extends $r{name="VotraxSynth";chipName="Votrax";workletFile="Votrax.worklet.js";processorName="votrax-processor";_speechSequencer=null;_mode=1;_singMode=!0;_speechText="HELLO WORLD";_vowelSequence=[];_vowelLoopSingle=!0;_vowelIndex=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){if(this.workletNode&&!this._disposed)if(1===this._mode)if(this._singMode&&this._vowelSequence.length>0)this._speakSingleVowel(e,t);else if(this._singMode)if(this._speechSequencer){const t=440*Math.pow(2,(e-69)/12);this.writeFrequency(t)}else this._startSpeechAtNote(this._speechText,e,t);else this._startSpeechAtNote(this._speechText,60,t);else this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&(1===this._mode||this.workletNode.port.postMessage({type:"noteOff",note:this.currentNote}))}writeFrequency(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFrequency",freq:e})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}setPhoneme(e){this.sendMessage("setPhoneme",e)}setInflection(e){this.setParameterById(gy,e)}setF1Override(e){this.setParameterById(by,e)}setF2Override(e){this.setParameterById(vy,e)}setF3Override(e){this.setParameterById(xy,e)}writePhone(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writePhone",value:e})}writeInflection(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeInflection",value:e})}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}speakText(e){this._isReady&&this.workletNode?this._startSpeechAtNote(e,60,.8):this._pendingCalls.push({method:"speakText",args:[e]})}_startSpeechAtNote(e,t,a){if(!this._isReady||!this.workletNode||this._disposed)return;this.stopSpeaking();const n=Mp(e);if(!n)return;const s=function(e){const t=[];for(const a of e){const e=hy(a.code);e&&t.push(...e)}return t}(Np(n));if(0===s.length)return;const r=s.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:t,velocity:Math.floor(127*a)}),this._speechSequencer=new _p(e=>this.writePhone(e.phone),()=>{this._speechSequencer=null,this.triggerRelease()}),this._speechSequencer.speak(r)}stopSpeaking(){const e=null!==this._speechSequencer;this._speechSequencer&&(this._speechSequencer.stop(),this._speechSequencer=null),e&&this.triggerRelease()}get isSpeaking(){return this._speechSequencer?.isSpeaking??!1}processPendingCall(e){"speakText"===e.method?this.speakText(e.args[0]):"loadPreset"===e.method?this.loadPreset(e.args[0]):super.processPendingCall(e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:fy,phoneme:yy,inflection:gy,f1_override:by,f2_override:vy,f3_override:xy,stereo_width:wy}[e];void 0!==a&&this.setParameterById(a,t),"mode"===e&&(this._mode=t>=1?1:0),"sing_mode"===e&&(this._singMode=t>=1),"vowelLoopSingle"===e&&(this._vowelLoopSingle=t>=1)}setTextParam(e,t){"speechText"===e&&(this._speechText=t),"vowelSequence"===e&&(this._vowelSequence=t?t.split(",").filter(Boolean):[],this._vowelIndex=0)}_speakSingleVowel(e,t){if(!this._isReady||!this.workletNode||this._disposed)return;const a=this._vowelSequence[this._vowelIndex%this._vowelSequence.length];this._vowelIndex++;const n=hy(a);if(!n||0===n.length)return;this.stopSpeaking();const s=n.map(e=>({data:e,durationMs:e.durationMs}));this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)}),this._speechSequencer=new _p(e=>this.writePhone(e.phone),()=>{this._vowelLoopSingle||(this._speechSequencer=null,this.triggerRelease())}),this._speechSequencer.speak(s,this._vowelLoopSingle)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const Sy=0,My=1,Ny=2,Cy=3,Py=4,Ey=5,_y=6,Ty=7,Ay=8,Oy=9,Iy=10,Fy=11,Dy=12,Ry=13,jy=14,By=15;class Ly extends $r{name="YMF271Synth";chipName="YMF271";workletFile="YMF271.worklet.js";processorName="ymf271-processor";currentGroup=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),group:this.currentGroup})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,group:this.currentGroup})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e,t=16384e3){let a=0,n=0;for(a=0;a<8&&(n=Math.round(1024*e*Math.pow(2,20-a)/t),!(n<1024));a++);return{block:Math.min(7,a),fnum:Math.max(0,Math.min(1023,n))}}(e);this.workletNode.port.postMessage({type:"setFrequency",block:t.block,fnum:t.fnum,group:this.currentGroup})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),a=Math.round(127*(1-e));for(const n of t)this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:n,param:"tl",value:a})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,group:this.currentGroup})}getCarrierOperators(){return{0:[3],1:[2,3],2:[2,3],3:[1,3],4:[1,3],5:[0,2,3],6:[0,2,3],7:[0,1,2,3]}[this.currentAlgorithm%8]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:My,value:e/15})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:Ny,value:e/7})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:jy,value:e/7})}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:By,value:e/3})}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"tl",value:t})}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"ar",value:t})}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d1r",value:t})}setOperatorD2R(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"d2r",value:t})}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"rr",value:t})}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"mult",value:t})}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"dt",value:t})}setOperatorWaveform(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setOperatorParam",group:this.currentGroup,op:e,param:"waveform",value:t})}setGroup(e){this.currentGroup=Math.max(0,Math.min(11,e))}setLFOFrequency(e){this.setParameterById(Dy,e/255)}setLFOWaveform(e){this.setParameterById(Ry,e/3)}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={master_volume:Sy,volume:Sy,algorithm:My,feedback:Ny,waveform:Cy,tl:Py,total_level:Py,ar:Ey,attack:Ey,d1r:_y,decay1:_y,d2r:Ty,decay2:Ty,rr:Ay,release:Ay,d1l:Oy,decay1_level:Oy,multiple:Iy,detune:Fy,lfo_freq:Dy,lfo_wave:Ry,pms:jy,ams:By}[e];void 0!==a&&this.setParameterById(a,t)}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setWaveform(e){this.setParameterById(Cy,e/6)}setAttackRate(e){this.setParameterById(Ey,e/31)}setDecay1Rate(e){this.setParameterById(_y,e/31)}setDecay2Rate(e){this.setParameterById(Ty,e/31)}setReleaseRate(e){this.setParameterById(Ay,e/15)}setTotalLevel(e){this.setParameterById(Py,e/127)}setMultiple(e){this.setParameterById(Iy,e/15)}setMasterVolume(e){this.setParameterById(Sy,e)}}const Vy=0,zy=1,Uy=2,Gy=3,Wy=4,Hy=5,Ky=6,qy=10,$y=11,Xy=12,Yy=13,Zy=14,Qy=15,Jy=16,eg=17,tg=18,ag=19,ng=20;class sg extends $r{name="YMOPQSynth";chipName="YMOPQ";workletFile="YMOPQ.worklet.js";processorName="ymopq-processor";currentChannel=0;currentAlgorithm=0;constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t),channel:this.currentChannel})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0,channel:this.currentChannel})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=qr(e);this.workletNode.port.postMessage({type:"setFrequency",kc:t.kc,kf:t.kf,channel:this.currentChannel})}writeVolume(e){if(!this.workletNode||this._disposed)return;const t=this.getCarrierOperators(),a=Math.round(127*(1-e));for(const n of t)this.workletNode.port.postMessage({type:"setOperatorParam",channel:this.currentChannel,op:n,param:"tl",value:a})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e,channel:this.currentChannel})}getCarrierOperators(){return{0:[3],1:[3],2:[3],3:[3],4:[1,3],5:[1,2,3],6:[1,2,3],7:[0,1,2,3]}[this.currentAlgorithm]||[3]}setFMAlgorithm(e){this.currentAlgorithm=e,this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setAlgorithm",value:e})}setFMFeedback(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setFeedback",value:e})}setFMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(Gy,e/7)}setAMSensitivity(e){this.workletNode&&!this._disposed&&this.setParameterById(Wy,e/3)}setOperatorTL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+qy,t/127)}setOperatorAR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+$y,t/31)}setOperatorDR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Xy,t/31)}setOperatorSL(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Zy,t/15)}setOperatorRR(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Qy,t/15)}setOperatorMult(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+Jy,t/15)}setOperatorDetune(e,t){this.workletNode&&!this._disposed&&this.setParameterById(100*(e+1)+eg,t/7)}setChannel(e){this.currentChannel=Math.max(0,Math.min(7,e))}setAlgorithm(e){this.setFMAlgorithm(e)}setFeedback(e){this.setFMFeedback(e)}setLFORate(e){this.sendMessage("setLFORate",e)}setVolume(e){this.sendMessage("setVolume",e)}writeRegister(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"writeRegister",offset:e,value:t})}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a=e.match(/^op(\d+)_(.+)$/);if(a)return void this.setOperatorParamByName(parseInt(a[1]),a[2],t);const n={algorithm:Vy,feedback:zy,lfo_rate:Uy,lfo_pm_sens:Gy,lfo_am_sens:Wy,reverb:Hy,volume:Ky}[e];void 0!==n&&this.setParameterById(n,t)}setOperatorParamByName(e,t,a){const n={total_level:qy,attack_rate:$y,decay_rate:Xy,sustain_rate:Yy,sustain_level:Zy,release_rate:Qy,multiple:Jy,detune:eg,waveform:tg,ksr:ag,am_enable:ng}[t];void 0!==n&&e>=1&&e<=4&&this.setParameterById(100*e+n,a)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const rg=0,ig=1,og=2,lg=3,cg=4,ug=5,dg=6,pg=7;class mg extends $r{name="VASynthSynth";chipName="VASynth";workletFile="VASynth.worklet.js";processorName="vasynth-processor";constructor(){super(),this.initSynth()}writeKeyOn(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOn",note:e,velocity:Math.floor(127*t)})}writeKeyOff(){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"noteOff",note:0})}writeFrequency(e){if(!this.workletNode||this._disposed)return;const t=function(e){return Math.max(20,Math.min(2e4,e))}(e);this.workletNode.port.postMessage({type:"setFrequency",freq:t})}writeVolume(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setVolume",value:e})}writePanning(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setPanning",pan:e})}setVolume(e){this.sendMessage("setVolume",e)}loadPreset(e){this._isReady?this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"programChange",program:e}):this._pendingCalls.push({method:"loadPreset",args:[e]})}setOsc1Wave(e){this.setParameterById(ig,e)}setOsc2Wave(e){this.setParameterById(og,e)}setOscMix(e){this.setParameterById(lg,e)}setOsc2Detune(e){this.setParameterById(cg,e)}setFilterCutoff(e){this.setParameterById(ug,e)}setFilterResonance(e){this.setParameterById(dg,e)}setFilterEnvDepth(e){this.setParameterById(pg,e)}controlChange(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"pitchBend",value:e})}setParameterById(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:"setParameter",paramId:e,value:t})}setParam(e,t){if(!this._isReady)return void this._pendingCalls.push({method:"setParam",args:[e,t]});const a={volume:rg,osc1_wave:ig,osc2_wave:og,osc_mix:lg,osc2_detune:cg,filter_cutoff:ug,filter_res:dg,filter_env_depth:pg}[e];void 0!==a&&this.setParameterById(a,t)}sendMessage(e,t){this.workletNode&&!this._disposed&&this.workletNode.port.postMessage({type:e,value:t})}}const hg=(e,t,...a)=>{const n=`(${t.toString()})(${a.map(e=>JSON.stringify(e)).join(", ")});`,s=URL.createObjectURL(new Blob([n],{type:"text/javascript"}));return e.addModule(s)},fg=e=>{const t=globalThis;if(t.AudioWorkletProcessor&&t.webAudioModules)return;const a=new Map,n=new Map;class s{get apiVersion(){return e}getModuleScope(e){return a.has(e)||a.set(e,{}),a.get(e)}getGroup(e,t){const a=n.get(e);if(a.validate(t))return a;throw new Error("Invalid key")}addGroup(e){n.has(e.groupId)||n.set(e.groupId,e)}removeGroup(e){n.delete(e.groupId)}addWam(e){n.get(e.groupId)?.addWam(e)}removeWam(e){n.get(e.groupId)?.removeWam(e)}connectEvents(e,t,a,s=0){n.get(e)?.connectEvents(t,a,s)}disconnectEvents(e,t,a,s){n.get(e)?.disconnectEvents(t,a,s)}emitEvents(e,...t){n.get(e.groupId)?.emitEvents(e,...t)}}t.AudioWorkletProcessor&&(t.webAudioModules||(t.webAudioModules=new s))},yg=(e,t)=>{const a=globalThis;class n{_groupId;_validate;_processors=new Map;_eventGraph=new Map;constructor(e,t){this._groupId=e,this._validate=e=>e===t}get groupId(){return this._groupId}get processors(){return this._processors}get eventGraph(){return this._eventGraph}validate(e){return this._validate(e)}addWam(e){this._processors.set(e.instanceId,e)}removeWam(e){this._eventGraph.has(e)&&this._eventGraph.delete(e),this._eventGraph.forEach(t=>{t.forEach(t=>{t&&t.delete(e)})}),this._processors.delete(e.instanceId)}connectEvents(e,t,a=0){const n=this._processors.get(e),s=this._processors.get(t);let r;if(this._eventGraph.has(n)?r=this._eventGraph.get(n):(r=[],this._eventGraph.set(n,r)),r[a])r[a].add(s);else{const e=new Set;e.add(s),r[a]=e}}disconnectEvents(e,t,a){const n=this._processors.get(e);if(!this._eventGraph.has(n))return;const s=this._eventGraph.get(n);if(void 0===t)return void s.forEach(e=>{e&&e.clear()});const r=this._processors.get(t);void 0!==a?s[a]&&r&&s[a].delete(r):s.forEach(e=>{e&&r&&e.delete(r)})}emitEvents(e,...t){this._eventGraph.has(e)&&this._eventGraph.get(e).forEach(e=>{e&&e.forEach(e=>e.scheduleEvents(...t))})}}a.AudioWorkletProcessor&&a.webAudioModules.addGroup(new n(e,t))};class gg{name="WAMSynth";output;_wamInstance=null;_wamNode=null;_config;_isInitialized=!1;_initPromise;_releaseTimers=new Set;_activeNotes=new Set;_audioContext;_pluginType="unknown";_inputGain=null;_activeOscillators=new Map;static _hostInitPromise=null;static initializeHost(e){if(gg._hostInitPromise)return gg._hostInitPromise;const t=`devilbox-host-${performance.now()}`,a=performance.now().toString();return gg._hostInitPromise=(async()=>(await hg(e.audioWorklet,fg,"2.0.0-alpha.6"),await hg(e.audioWorklet,yg,t,a),[t,a]))(),gg._hostInitPromise}constructor(e){this._audioContext=us(),this.output=this._audioContext.createGain(),this.output.gain.value=1,this._config=e,this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}get pluginType(){return this._pluginType}get descriptor(){return this._wamInstance?.descriptor||null}async _initialize(){if(this._config.moduleUrl)try{const t=this._audioContext,[a]=await gg.initializeHost(t),{default:n}=await import(this._config.moduleUrl);if(!n||"function"!=typeof n)throw new Error("Invalid WAM: Default export is not a constructor or factory function");const s=/^class\s/.test(n.toString());if(s&&"function"==typeof n.createInstance)this._wamInstance=await n.createInstance(a,t);else if(s){const e=new n(a,t);"function"==typeof e.initialize&&await e.initialize(),this._wamInstance=e}else this._wamInstance=await n(t,a);if(this._wamInstance.audioNode?this._wamNode=this._wamInstance.audioNode:"function"==typeof this._wamInstance.createAudioNode&&(this._wamNode=await this._wamInstance.createAudioNode()),!this._wamNode)throw new Error("Failed to create WAM audio node");const r=this._wamInstance.descriptor;if(r)if(!0===r.isInstrument)this._pluginType="instrument";else if(!1===r.isInstrument)this._pluginType="effect";else{const e=r.keywords||[],t=e.includes("instrument")||e.includes("synth")||e.includes("synthesizer"),a=e.includes("effect")||e.includes("fx")||e.includes("audio-effect");if(t)this._pluginType="instrument";else if(a)this._pluginType="effect";else{const e=`${r.name||""} ${r.description||""}`.toLowerCase();/synth|instrument|piano|organ|drum/i.test(e)&&(this._pluginType="instrument")}}if("unknown"===this._pluginType&&this._config.moduleUrl){const{WAM_SYNTH_PLUGINS:e}=await ja(async()=>{const{WAM_SYNTH_PLUGINS:e}=await Promise.resolve().then(()=>Mg);return{WAM_SYNTH_PLUGINS:e}},[]),t=e.find(e=>this._config.moduleUrl.includes(e.url)||e.url.includes(this._config.moduleUrl));t&&(this._pluginType="instrument"===t.type?"instrument":"effect"===t.type?"effect":"unknown")}if("unknown"===this._pluginType&&this._wamNode.numberOfInputs>0&&(this._pluginType="effect"),"effect"===this._pluginType?(this._inputGain=t.createGain(),this._inputGain.gain.value=1,this._inputGain.connect(this._wamNode),this._wamNode.connect(this.output)):this._wamNode.connect(this.output),this._config.pluginState&&this._wamInstance&&"function"==typeof this._wamInstance.setState)try{await this._wamInstance.setState(this._config.pluginState)}catch(e){this._config.pluginState=null}this._isInitialized=!0}catch(t){const e=t instanceof Error?t.message:String(t);let a;throw a=e.includes("Failed to fetch")||e.includes("NetworkError")||e.includes("net::ERR_")?`Network error loading WAM module. Check that the URL is correct and accessible: ${this._config.moduleUrl}`:e.includes("CORS")||e.includes("cross-origin")||e.includes("has been blocked")?`CORS policy blocked loading this WAM module. The server hosting the plugin must allow cross-origin requests. URL: ${this._config.moduleUrl}`:e.includes("not a valid JavaScript MIME type")||e.includes("SyntaxError")||e.includes("Unexpected token")?"Invalid module format. The URL does not point to a valid WAM 2.0 JavaScript module. Ensure the URL points to the plugin's index.js entry point.":`WAM initialization failed: ${e}`,new Error(a)}}_sendMidi(e,t){const a=new Uint8Array(e),n=this._wamNode;n&&"function"==typeof n.scheduleEvents?n.scheduleEvents({type:"wam-midi",data:{bytes:a},time:t}):this._wamInstance&&"function"==typeof this._wamInstance.onMidi?this._wamInstance.onMidi(e,t):n&&n.port&&n.port.postMessage({type:"wam-midi",data:{bytes:a},time:t})}_midiToFreq(e){return 440*Math.pow(2,(e-69)/12)}triggerAttack(e,t,a=1){if(!this._isInitialized||!this._wamInstance)return this;const n=gs(e),s=Math.round(127*a),r=t??this._audioContext.currentTime;if(this._activeNotes.add(n),"effect"===this._pluginType&&this._inputGain){const e=this._activeOscillators.get(n);if(e){try{e.osc.stop()}catch{}e.gain.disconnect()}const t=this._audioContext.createOscillator(),s=this._audioContext.createGain();t.type="sawtooth",t.frequency.setValueAtTime(this._midiToFreq(n),r),s.gain.setValueAtTime(.3*a,r),t.connect(s),s.connect(this._inputGain),t.start(r),this._activeOscillators.set(n,{osc:t,gain:s})}else this._sendMidi([144,n,s],r);return this}_stopOscillator(e,t){const a=this._activeOscillators.get(e);if(a){a.gain.gain.setValueAtTime(a.gain.gain.value,t),a.gain.gain.linearRampToValueAtTime(0,t+.02);try{a.osc.stop(t+.03)}catch{}this._activeOscillators.delete(e)}}triggerRelease(e,t){if(!this._isInitialized||!this._wamInstance)return this;const a=t??this._audioContext.currentTime;if(void 0!==e){const t=gs(e);this._activeNotes.delete(t),"effect"===this._pluginType?this._stopOscillator(t,a):this._sendMidi([128,t,0],a)}else{if("effect"===this._pluginType)for(const e of this._activeOscillators.keys())this._stopOscillator(e,a);else{for(const e of this._activeNotes)this._sendMidi([128,e,0],a);this._sendMidi([176,123,0],a)}this._activeNotes.clear()}return this}triggerAttackRelease(e,t,a,n=1){this.triggerAttack(e,a,n);const s=(a??this._audioContext.currentTime)+t,r=setTimeout(()=>{this._releaseTimers.delete(r),this._isInitialized&&this._wamInstance&&this.triggerRelease(e,s)},1e3*t);return this._releaseTimers.add(r),this}releaseAll(e){return this.triggerRelease(void 0,e)}async setPluginState(e){if(this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.setState)try{await this._wamInstance.setState(e),this._config.pluginState=e,this._config.pluginStateTimestamp=Date.now()}catch(t){}else this._config.pluginState=e}async getPluginState(){if(this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.getState){return{state:await this._wamInstance.getState(),timestamp:Date.now(),version:1}}return this._config.pluginState}async setParameter(e,t){if(this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.setParameterValues){const a="number"==typeof e?e.toString():e;await this._wamInstance.setParameterValues({[a]:{id:a,value:t}})}}async getParameters(){return this._isInitialized&&this._wamInstance&&"function"==typeof this._wamInstance.getParameterInfo?await this._wamInstance.getParameterInfo():{}}async createGui(){if(!this._isInitialized||!this._wamInstance)return null;const e=this._wamInstance,t=e.descriptor;t?.name||e.constructor;if("function"==typeof e.createGui)try{const t=await e.createGui();if(t)return t}catch(a){}if(this._config.moduleUrl){const t=this._config.moduleUrl.replace(/\/[^/]*$/,"/"),a=["gui.js","Gui/index.js","gui/index.js"];for(const n of a){const a=t+n;try{const t=await import(a);if("function"==typeof t.createElement){const a=await t.createElement(e);if(a)return a}}catch{}}}return null}dispose(){this._releaseTimers.forEach(e=>clearTimeout(e)),this._releaseTimers.clear(),this._activeNotes.clear();for(const[,e]of this._activeOscillators){try{e.osc.stop()}catch{}e.gain.disconnect()}this._activeOscillators.clear(),this._inputGain&&this._inputGain.disconnect(),this._wamNode&&this._wamNode.disconnect(),this._wamInstance&&"function"==typeof this._wamInstance.destroy&&this._wamInstance.destroy(),this.output.disconnect()}}class bg extends d{name="WAMEffect";input;output;dryGain;wetGain;_wamInstance=null;_wamNode=null;_moduleUrl;_audioContext;_initPromise;_isInitialized=!1;constructor(e){super(),this._moduleUrl=e.moduleUrl,this._audioContext=us();const t=e.wet??1;this.input=new p(1),this.output=new p(1),this.dryGain=new p(1-t),this.wetGain=new p(t),this.input.connect(this.dryGain),this.dryGain.connect(this.output),this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}get isInitialized(){return this._isInitialized}async _initialize(){if(this._moduleUrl)try{const e=this._audioContext,[t]=await gg.initializeHost(e),{default:a}=await import(this._moduleUrl);if(!a||"function"!=typeof a)throw new Error("Invalid WAM: Default export is not a constructor or factory function");const n=/^class\s/.test(a.toString());if(n&&"function"==typeof a.createInstance)this._wamInstance=await a.createInstance(t,e);else if(n){const n=new a(t,e);"function"==typeof n.initialize&&await n.initialize(),this._wamInstance=n}else this._wamInstance=await a(e,t);if(this._wamInstance.audioNode?this._wamNode=this._wamInstance.audioNode:"function"==typeof this._wamInstance.createAudioNode&&(this._wamNode=await this._wamInstance.createAudioNode()),!this._wamNode)throw new Error("Failed to create WAM audio node");const s=this.input._gainNode,r=this.wetGain._gainNode,i=this.output._gainNode;s.connect(this._wamNode),this._wamNode.connect(r),r.connect(i),this._isInitialized=!0;this._wamInstance}catch(e){}}async createGui(){if(!this._wamInstance)return null;if("function"==typeof this._wamInstance.createGui)try{const e=await this._wamInstance.createGui();if(e)return e}catch{}if(this._moduleUrl){const e=this._moduleUrl.replace(/\/[^/]*$/,"/"),t=["gui.js","Gui/index.js","gui/index.js"];for(const a of t){const t=e+a;try{const e=await import(t);if("function"==typeof e.createElement){const t=await e.createElement(this._wamInstance);if(t)return t}}catch{}}}return null}async getParameters(){if(!this._wamInstance)return null;try{return"function"==typeof this._wamInstance.getParameterInfo?await this._wamInstance.getParameterInfo():null}catch{return null}}async setParameter(e,t){if(this._wamInstance&&this._wamNode)try{this._wamNode.setParameterValues&&await this._wamNode.setParameterValues({[e]:{value:t}})}catch{}}setWet(e){const t=Math.max(0,Math.min(1,e));this.wetGain.gain.value=t,this.dryGain.gain.value=1-t}get descriptor(){return this._wamInstance?.descriptor||null}dispose(){try{this._wamNode&&(this._wamNode.disconnect(),this._wamInstance&&"function"==typeof this._wamInstance.destroy&&this._wamInstance.destroy())}catch{}return this.dryGain.dispose(),this.wetGain.dispose(),this.input.dispose(),this.output.dispose(),super.dispose()}}const vg=Object.freeze(Object.defineProperty({__proto__:null,WAMEffectNode:bg},Symbol.toStringTag,{value:"Module"})),xg="https://mainline.i3s.unice.fr/wam2/packages",wg=[{name:"OB-Xd",url:`${xg}/obxd/index.js`,type:"instrument",category:"Synthesizer",description:"Oberheim OB-X virtual analog synth (WASM)"},{name:"Synth-101",url:`${xg}/synth101/dist/index.js`,type:"instrument",category:"Synthesizer",description:"Roland SH-101 monophonic synthesizer"},{name:"TinySynth",url:`${xg}/tinySynth/src/index.js`,type:"instrument",category:"Synthesizer",description:"GM-mapped multi-timbral synth"},{name:"Faust Flute",url:`${xg}/faustFlute/index.js`,type:"instrument",category:"Synthesizer",description:"Physical modelling flute (Faust DSP)"},{name:"Big Muff",url:`${xg}/BigMuff/index.js`,type:"effect",category:"Distortion",description:"Electro-Harmonix Big Muff Pi fuzz"},{name:"TS-9 Overdrive",url:`${xg}/TS9_OverdriveFaustGenerated/index.js`,type:"effect",category:"Distortion",description:"Ibanez Tube Screamer overdrive (Faust)"},{name:"Disto Machine",url:`${xg}/disto_machine/src/index.js`,type:"effect",category:"Amp Simulator",description:"Multi-mode distortion with cabinet sim"},{name:"QuadraFuzz",url:`${xg}/quadrafuzz/dist/index.js`,type:"effect",category:"Distortion",description:"4-band multiband distortion/fuzz"},{name:"Vox Amp 30",url:`${xg}/GuitarAmpSim60s/index.js`,type:"effect",category:"Amp Simulator",description:"1960s guitar amp simulator with cabinet"},{name:"Stone Phaser",url:`${xg}/StonePhaserStereo/index.js`,type:"effect",category:"Modulation",description:"Stereo phaser effect (Faust DSP)"},{name:"Ping Pong Delay",url:`${xg}/pingpongdelay/dist/index.js`,type:"effect",category:"Delay",description:"Stereo ping-pong delay"},{name:"Faust Delay",url:`${xg}/faustPingPongDelay/plugin/index.js`,type:"effect",category:"Delay",description:"Ping-pong delay (Faust DSP)"},{name:"Csound Pitch Shifter",url:`${xg}/csoundPitchShifter/dist/index.js`,type:"effect",category:"Pitch",description:"Pitch shifter powered by Csound"},{name:"Graphic Equalizer",url:`${xg}/graphicEqualizer/src/index.js`,type:"effect",category:"EQ & Filter",description:"Multi-band graphic equalizer"},{name:"Pedalboard",url:`${xg}/pedalboard/dist/index.js`,type:"effect",category:"Multi-FX",description:"Drag-and-drop guitar pedalboard"}],kg={WAMBigMuff:`${xg}/BigMuff/index.js`,WAMTS9:`${xg}/TS9_OverdriveFaustGenerated/index.js`,WAMDistoMachine:`${xg}/disto_machine/src/index.js`,WAMQuadraFuzz:`${xg}/quadrafuzz/dist/index.js`,WAMVoxAmp:`${xg}/GuitarAmpSim60s/index.js`,WAMStonePhaser:`${xg}/StonePhaserStereo/index.js`,WAMPingPongDelay:`${xg}/pingpongdelay/dist/index.js`,WAMFaustDelay:`${xg}/faustPingPongDelay/plugin/index.js`,WAMPitchShifter:`${xg}/csoundPitchShifter/dist/index.js`,WAMGraphicEQ:`${xg}/graphicEqualizer/src/index.js`,WAMPedalboard:`${xg}/pedalboard/dist/index.js`},Sg={WAMOBXd:`${xg}/obxd/index.js`,WAMSynth101:`${xg}/synth101/dist/index.js`,WAMTinySynth:`${xg}/tinySynth/src/index.js`,WAMFaustFlute:`${xg}/faustFlute/index.js`},Mg=Object.freeze(Object.defineProperty({__proto__:null,WAM_EFFECT_URLS:kg,WAM_SYNTH_PLUGINS:wg,WAM_SYNTH_URLS:Sg},Symbol.toStringTag,{value:"Module"})),Ng=new Map,Cg=new WeakMap;class Pg{name;output;_worklet=null;_descriptor;_isReady=!1;_initPromise;_params=[];_paramValues=new Map;_pendingNotes=[];constructor(e,t){this._descriptor=e,this.name=`VSTBridge:${e.id}`;const a=us();if(this.output=a.createGain(),e.volumeOffsetDb){const t=Math.pow(10,e.volumeOffsetDb/20);this.output.gain.value=t}this._initPromise=this._initialize()}async ensureInitialized(){return this._initPromise}getParams(){return this._params}getDescriptor(){return this._descriptor}async _initialize(){try{const e=us(),{wasmBinary:t,jsCode:a}=await async function(e,t){const a="/DEViLBOX/";if(!Cg.get(e)){try{await e.audioWorklet.addModule(`${a}vstbridge/VSTBridge.worklet.js`)}catch{}Cg.set(e,!0)}const n=t.id;if(!Ng.has(n)){const e=(async()=>{const e=`${a}${t.wasmDir}/${t.wasmFile}.wasm`,n=`${a}${t.wasmDir}/${t.wasmFile}.js`,[s,r]=await Promise.all([fetch(e),fetch(n)]);if(!s.ok)throw new Error(`Failed to load ${e}: ${s.status}`);if(!r.ok)throw new Error(`Failed to load ${n}: ${r.status}`);const[i,o]=await Promise.all([s.arrayBuffer(),r.text()]);return{wasmBinary:i,jsCode:Rr(o,`${a}${t.wasmDir}/`)}})();Ng.set(n,e)}return Ng.get(n)}(e,this._descriptor),{workletNode:n,readyPromise:s}=function(e,t,a,n,s){const r=new AudioWorkletNode(e,"vstbridge-processor",{outputChannelCount:[2],processorOptions:{sampleRate:e.sampleRate,synthClassName:t.synthClassName,moduleFactoryName:t.moduleFactoryName}}),i=new Promise((e,a)=>{const n=setTimeout(()=>a(new Error(`VSTBridge ${t.id} init timeout`)),1e4),s=r.port.onmessage;r.port.onmessage=i=>{"ready"===i.data.type?(clearTimeout(n),e()):"error"===i.data.type&&(clearTimeout(n),a(new Error(i.data.error||`VSTBridge ${t.id} init error`))),s&&s.call(r.port,i)}});r.port.postMessage({type:"init",wasmBinary:a,jsCode:n,sampleRate:e.sampleRate}),r.connect(s);try{const t=e.createGain();t.gain.value=0,r.connect(t),t.connect(e.destination)}catch{}return{workletNode:r,readyPromise:i}}(e,this._descriptor,t,a,this.output);this._worklet=n;const r=n.port.onmessage;n.port.onmessage=e=>{if("params"===e.data.type){this._params=e.data.params;for(const e of this._params)this._paramValues.has(e.id)||this._paramValues.set(e.id,e.defaultValue)}r&&r.call(n.port,e)},await s,this._isReady=!0,this._worklet.port.postMessage({type:"getParams"});for(const{note:i,velocity:o}of this._pendingNotes)this._worklet.port.postMessage({type:"noteOn",note:i,velocity:o});this._pendingNotes=[]}catch(e){}}triggerAttack(e,t,a=1){const n=gs(e),s=Math.round(127*a);return this._worklet&&this._isReady?this._worklet.port.postMessage({type:"noteOn",note:n,velocity:s}):this._pendingNotes.push({note:n,velocity:s}),this}triggerRelease(e,t){if(!this._worklet)return this;if(void 0!==e){const t=gs(e);this._worklet.port.postMessage({type:"noteOff",note:t})}else this._worklet.port.postMessage({type:"allNotesOff"});return this}triggerAttackRelease(e,t,a,n=1){return this.triggerAttack(e,a,n),setTimeout(()=>this.triggerRelease(e),1e3*t),this}set(e,t){if(!this._worklet)return;let a;if(/^\d+$/.test(e))a=parseInt(e,10);else{const t=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!t)return;a=t.id}this._paramValues.set(a,t),this._worklet.port.postMessage({type:"parameter",paramId:a,value:t})}get(e){let t;if(/^\d+$/.test(e))t=parseInt(e,10);else{const a=this._params.find(t=>t.name===e||t.name.toLowerCase()===e.toLowerCase());if(!a)return;t=a.id}return this._paramValues.get(t)}setParameter(e,t){this._worklet&&(this._paramValues.set(e,t),this._worklet.port.postMessage({type:"parameter",paramId:e,value:t}))}getParameter(e){return this._paramValues.get(e)}controlChange(e,t){this._worklet?.port.postMessage({type:"controlChange",cc:e,value:t})}pitchBend(e){this._worklet?.port.postMessage({type:"pitchBend",value:e})}programChange(e){this._worklet?.port.postMessage({type:"programChange",program:e})}async sendCommand(e,t){return!(!this._worklet||!this._isReady)&&new Promise(a=>{const n=setTimeout(()=>a(!1),2e3),s=t=>{"commandResult"===t.data.type&&t.data.commandType===e&&(clearTimeout(n),this._worklet?.port.removeEventListener("message",s),a(t.data.handled))};this._worklet.port.addEventListener("message",s),this._worklet.port.postMessage({type:"command",commandType:e,data:t?Array.from(t):[]})})}setVolumeOffset(e){const t=Math.pow(10,e/20);this.output.gain.value=t}dispose(){this._worklet?.port.postMessage({type:"allNotesOff"}),this._worklet?.port.postMessage({type:"dispose"}),this._worklet?.disconnect(),this._worklet=null,this.output.disconnect()}}const Eg=new Map;function _g(e){Eg.set(e.id,e)}_g({id:"DexedBridge",name:"Dexed DX7 (Bridge)",wasmDir:"dexed",wasmFile:"Dexed",synthClassName:"DexedSynth",moduleFactoryName:"createDexedModule",volumeOffsetDb:41,commands:["loadSysEx","loadPatch"]}),_g({id:"Vital",name:"Vital (Wavetable)",wasmDir:"vital",wasmFile:"Vital",synthClassName:"VitalSynth",moduleFactoryName:"createVitalModule",volumeOffsetDb:0,panelComponent:"VitalControls",commands:["loadWavetable","loadPreset"]}),_g({id:"Odin2",name:"Odin2 (Hybrid)",wasmDir:"odin2",wasmFile:"Odin2",synthClassName:"Odin2Synth",moduleFactoryName:"createOdin2Module",volumeOffsetDb:0,panelComponent:"Odin2Controls",commands:["loadPatch"]}),_g({id:"Surge",name:"Surge XT (Hybrid)",wasmDir:"surge",wasmFile:"Surge",synthClassName:"SurgeSynth",moduleFactoryName:"createSurgeModule",volumeOffsetDb:0,panelComponent:"SurgeControls",commands:["loadPatch","loadWavetable"]}),_g({id:"TonewheelOrgan",name:"Tonewheel Organ",wasmDir:"tonewheel",wasmFile:"Tonewheel",synthClassName:"TonewheelOrganSynth",moduleFactoryName:"createTonewheelModule",volumeOffsetDb:0}),_g({id:"Melodica",name:"Melodica",wasmDir:"melodica",wasmFile:"Melodica",synthClassName:"MelodicaWASMSynth",moduleFactoryName:"createMelodicaModule",volumeOffsetDb:0}),_g({id:"Monique",name:"Monique (Monosynth)",wasmDir:"monique",wasmFile:"Monique",synthClassName:"MoniqueSynth",moduleFactoryName:"createMoniqueModule",volumeOffsetDb:0}),_g({id:"Helm",name:"Helm (Poly)",wasmDir:"helm",wasmFile:"Helm",synthClassName:"HelmSynth",moduleFactoryName:"createHelmModule",volumeOffsetDb:0}),_g({id:"Sorcer",name:"Sorcer (Wavetable)",wasmDir:"sorcer",wasmFile:"Sorcer",synthClassName:"SorcerSynth",moduleFactoryName:"createSorcerModule",volumeOffsetDb:0}),_g({id:"Amsynth",name:"amsynth (Analog)",wasmDir:"amsynth",wasmFile:"Amsynth",synthClassName:"AmsynthSynth",moduleFactoryName:"createAmsynthModule",volumeOffsetDb:0}),_g({id:"OBXf",name:"OB-Xf (Analog)",wasmDir:"obxf",wasmFile:"OBXf",synthClassName:"OBXfSynth",moduleFactoryName:"createOBXfModule",volumeOffsetDb:0}),_g({id:"Open303",name:"Open303 (TB-303)",wasmDir:"open303",wasmFile:"Open303",synthClassName:"Open303Synth",moduleFactoryName:"createOpen303Module",volumeOffsetDb:0}),_g({id:"OBXd",name:"OB-Xd (Analog)",wasmDir:"obxd",wasmFile:"OBXd",synthClassName:"OBXdSynth",moduleFactoryName:"createOBXdModule",volumeOffsetDb:0});class Tg{static descriptors=new Map;static lazyLoaders=new Map;static loadingPromises=new Map;static register(e){const t=Array.isArray(e)?e:[e];for(const a of t)this.descriptors.set(a.id,a)}static registerLazy(e,t){for(const a of e)this.lazyLoaders.set(a,t)}static get(e){return this.descriptors.get(e)}static async ensure(e){const t=this.descriptors.get(e);if(t)return t;const a=this.lazyLoaders.get(e);if(!a)return;let n=this.loadingPromises.get(e);if(!n){n=a().then(()=>{for(const[e,t]of this.lazyLoaders.entries())t===a&&(this.lazyLoaders.delete(e),this.loadingPromises.delete(e))});for(const[e,t]of this.lazyLoaders.entries())t===a&&this.loadingPromises.set(e,n)}return await n,this.descriptors.get(e)}static getAll(){return Array.from(this.descriptors.values())}static has(e){return this.descriptors.has(e)}static knows(e){return this.descriptors.has(e)||this.lazyLoaders.has(e)}static getAllIds(){const e=new Set;for(const t of this.descriptors.keys())e.add(t);for(const t of this.lazyLoaders.keys())e.add(t);return Array.from(e)}}class Ag{static descriptors=new Map;static lazyLoaders=new Map;static loadingPromises=new Map;static register(e){const t=Array.isArray(e)?e:[e];for(const a of t)this.descriptors.set(a.id,a)}static registerLazy(e,t){for(const a of e)this.lazyLoaders.set(a,t)}static get(e){return this.descriptors.get(e)}static async ensure(e){const t=this.descriptors.get(e);if(t)return t;const a=this.lazyLoaders.get(e);if(!a)return;let n=this.loadingPromises.get(e);if(!n){n=a().then(()=>{for(const[e,t]of this.lazyLoaders.entries())t===a&&(this.lazyLoaders.delete(e),this.loadingPromises.delete(e))});for(const[e,t]of this.lazyLoaders.entries())t===a&&this.loadingPromises.set(e,n)}return await n,this.descriptors.get(e)}static getAll(){return Array.from(this.descriptors.values())}static has(e){return this.descriptors.has(e)}static knows(e){return this.descriptors.has(e)||this.lazyLoaders.has(e)}static getAllIds(){const e=new Set;for(const t of this.descriptors.keys())e.add(t);for(const t of this.lazyLoaders.keys())e.add(t);return Array.from(e)}static getByGroup(e){return this.getAll().filter(t=>t.group===e)}static getByCategory(e){return this.getAll().filter(t=>t.category===e)}}function Og(e){const t=Ag.get(e);if(t)return t.getDefaultParameters();switch(e){case"Distortion":return{drive:.4,oversample:"none"};case"Reverb":return{decay:1.5,preDelay:.01};case"Delay":case"FeedbackDelay":case"PingPongDelay":return{time:.25,feedback:.5};case"Chorus":return{frequency:1.5,delayTime:3.5,depth:.7};case"Phaser":return{frequency:.5,octaves:3,baseFrequency:350};case"Tremolo":return{frequency:10,depth:.5};case"Vibrato":return{frequency:5,depth:.1};case"AutoFilter":return{frequency:1,baseFrequency:200,octaves:2.6,filterType:"lowpass"};case"AutoPanner":return{frequency:1,depth:1};case"AutoWah":return{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.1};case"BitCrusher":return{bits:4};case"Chebyshev":return{order:50,oversample:"none"};case"FrequencyShifter":return{frequency:0};case"PitchShift":return{pitch:0,windowSize:.1,delayTime:0,feedback:0};case"Compressor":return{threshold:-24,ratio:12,attack:.003,release:.25};case"EQ3":return{low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500};case"Filter":return{type:"lowpass",frequency:5e3,rolloff:-12,Q:1,gain:0};case"JCReverb":return{roomSize:.5};case"StereoWidener":return{width:.5};case"TapeSaturation":return{drive:50,tone:12e3};case"SidechainCompressor":return{threshold:-24,ratio:4,attack:.003,release:.25,knee:6,sidechainGain:100};case"SpaceEcho":return{mode:4,rate:300,intensity:.5,echoVolume:.8,reverbVolume:.3,bass:0,treble:0};case"SpaceyDelayer":return{firstTap:250,tapSize:150,feedback:40,multiTap:1,tapeFilter:0};case"RETapeEcho":return{mode:3,repeatRate:.5,intensity:.5,echoVolume:.8,wow:0,flutter:0,dirt:0,inputBleed:0,loopAmount:0,playheadFilter:1};case"BiPhase":return{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0};case"DubFilter":return{cutoff:20,resonance:30,gain:1};case"MoogFilter":return{cutoff:1e3,resonance:10,drive:1,model:0,filterMode:0};case"MVerb":return{damping:.5,density:.5,bandwidth:.5,decay:.7,predelay:0,size:.8,gain:1,mix:.4,earlyMix:.5};case"Leslie":return{speed:0,hornRate:6.8,drumRate:5.9,hornDepth:.7,drumDepth:.5,doppler:.5,width:.8,acceleration:.5};case"SpringReverb":return{decay:.6,damping:.4,tension:.5,mix:.35,drip:.5,diffusion:.7};default:return{}}}const Ig={FurnaceNES:So.NES,FurnaceGB:So.GB,FurnaceSNES:So.SNES,FurnacePCE:So.PCE,FurnacePSG:So.SMS,FurnaceVB:So.VBOY,FurnaceLynx:So.LYNX,FurnaceSWAN:So.SWAN,FurnaceVRC6:So.VRC6,FurnaceN163:So.N163,FurnaceFDS:So.FDS,FurnaceMMC5:So.MMC5,FurnaceGBA:So.GBA_DMA,FurnaceNDS:So.NDS,FurnacePOKEMINI:So.POKEMINI,FurnaceC64:So.C64_6581,FurnaceSID6581:So.C64_6581,FurnaceSID8580:So.C64_8580,FurnaceAY:So.AY8910,FurnaceAY8930:So.AY8930,FurnaceVIC:So.VIC20,FurnaceSAA:So.SAA1099,FurnaceTED:So.TED,FurnaceVERA:So.VERA,FurnaceSCC:So.SCC,FurnaceTIA:So.TIA,FurnaceAMIGA:So.AMIGA,FurnacePET:So.PET,FurnacePCSPKR:So.PCSPKR,FurnaceZXBEEPER:So.SFX_BEEPER,FurnacePOKEY:So.POKEY,FurnacePONG:So.PONG,FurnacePV1000:So.PV1000,FurnaceDAVE:So.DAVE,FurnaceSU:So.SOUND_UNIT,FurnacePOWERNOISE:So.POWERNOISE,FurnaceSEGAPCM:So.SEGAPCM,FurnaceQSOUND:So.QSOUND,FurnaceES5506:So.ES5506,FurnaceRF5C68:So.RF5C68,FurnaceC140:So.C140,FurnaceK007232:So.K007232,FurnaceK053260:So.K053260,FurnaceGA20:So.GA20,FurnaceOKI:So.MSM6295,FurnaceYMZ280B:So.YMZ280B,FurnaceX1_010:So.X1_010,FurnaceMSM6258:So.MSM6258,FurnaceMSM5232:So.MSM5232,FurnaceMULTIPCM:So.MULTIPCM,FurnaceNAMCO:So.NAMCO,FurnacePCMDAC:So.PCM_DAC,FurnaceBUBBLE:So.BUBSYS_WSG,FurnaceSM8521:So.SM8521,FurnaceT6W28:So.T6W28,FurnaceSUPERVISION:So.SUPERVISION,FurnaceUPD1771:So.UPD1771C,FurnaceSCVTONE:So.UPD1771C};class Fg{static VOLUME_NORMALIZATION_OFFSETS={Synth:11,MonoSynth:14,DuoSynth:5,FMSynth:16,AMSynth:22,PluckSynth:32,MetalSynth:23,MembraneSynth:10,NoiseSynth:7,PolySynth:8,TB303:15,JC303:15,Buzz3o3:5,Furnace:0,FurnaceOPN:7,FurnaceOPM:2,FurnaceOPL:10,FurnaceOPLL:12,FurnaceESFM:19,FurnaceOPZ:-14,FurnaceOPNA:6,FurnaceOPNB:7,FurnaceOPL4:9,FurnaceY8950:9,FurnaceVRC7:8,FurnaceOPN2203:-3,FurnaceOPNBB:2,FurnaceNES:7,FurnaceGB:4,FurnaceSNES:-10,FurnacePCE:5,FurnacePSG:3,FurnaceVB:16,FurnaceLynx:3,FurnaceSWAN:4,FurnaceVRC6:3,FurnaceN163:7,FurnaceFDS:3,FurnaceMMC5:37,FurnaceGBA:-10,FurnaceNDS:3,FurnacePOKEMINI:-10,FurnaceC64:6,FurnaceSID6581:6,FurnaceSID8580:6,FurnaceAY:3,FurnaceAY8930:25,FurnaceVIC:-1,FurnaceSAA:6,FurnaceTED:-4,FurnaceVERA:14,FurnaceSCC:9,FurnaceTIA:-7,FurnaceAMIGA:15,FurnacePET:-10,FurnacePCSPKR:-10,FurnaceZXBEEPER:-4,FurnacePOKEY:7,FurnacePONG:-10,FurnacePV1000:3,FurnaceDAVE:15,FurnaceSU:27,FurnacePOWERNOISE:-4,FurnaceSEGAPCM:-5,FurnaceQSOUND:18,FurnaceES5506:80,FurnaceRF5C68:0,FurnaceC140:33,FurnaceK007232:-4,FurnaceK053260:17,FurnaceGA20:3,FurnaceOKI:44,FurnaceYMZ280B:39,FurnaceX1_010:15,FurnaceMSM6258:-10,FurnaceMSM5232:10,FurnaceMULTIPCM:56,FurnaceNAMCO:-5,FurnacePCMDAC:8,FurnaceBUBBLE:3,FurnaceSM8521:9,FurnaceT6W28:3,FurnaceSUPERVISION:-1,FurnaceUPD1771:9,FurnaceSCVTONE:3,BuzzKick:3,BuzzKickXP:5,BuzzNoise:7,BuzzTrilok:5,Buzz4FM2F:7,BuzzFreqBomb:4,Buzz3o3DF:8,Synare:7,DubSiren:13,SpaceLaser:24,V2:0,Sam:16,SuperSaw:9,WobbleBass:13,FormantSynth:9,StringMachine:11,PWMSynth:9,ChipSynth:5,Wavetable:5,Organ:3,Sampler:10,Player:10,GranularSynth:-47,DrumMachine:18,ChiptuneModule:-6,DrumKit:0,MAMEVFX:0,MAMEDOC:0,MAMERSA:0,MAMESWP30:0,CZ101:0,Dexed:41,OBXd:9,CEM3394:19,SCSP:15,MAMEAstrocade:18,MAMESN76477:5,MAMEASC:11,MAMEES5503:62,MAMEMEA8000:12,MAMESNKWave:8,MAMESP0250:26,MAMETMS36XX:6,MAMEVotrax:20,MAMEYMOPQ:19,MAMEUPD931:23,MAMEUPD933:28,MAMETMS5220:37,MAMEYMF271:15,MAMETR707:22,MAMEVASynth:20,MAMEAICA:0,MAMEICS2115:35,MAMEK054539:22,MAMEC352:17,MAMERF5C400:0};static getNormalizedVolume(e,t){return(t??-12)+(this.VOLUME_NORMALIZATION_OFFSETS[e]??0)}static createInstrument(e){const t=Tg.get(e.synthType);if(t){const a=t.create(e);return e.synthType.startsWith("Furnace")&&t.volumeOffsetDb&&"setVolumeOffset"in a&&a.setVolumeOffset(t.volumeOffsetDb),a}let a;switch(e.synthType){case"Synth":case"ChiptuneModule":a=this.createSynth(e);break;case"MonoSynth":a=this.createMonoSynth(e);break;case"DuoSynth":a=this.createDuoSynth(e);break;case"FMSynth":a=this.createFMSynth(e);break;case"AMSynth":a=this.createAMSynth(e);break;case"PluckSynth":a=this.createPluckSynth(e);break;case"MetalSynth":a=this.createMetalSynth(e);break;case"MembraneSynth":a=this.createMembraneSynth(e);break;case"NoiseSynth":a=this.createNoiseSynth(e);break;case"TB303":a=this.createTB303(e);break;case"Furnace":a=this.createFurnace(e);break;case"Buzzmachine":a=this.createBuzzmachine(e);break;case"FurnaceOPN":a=this.createFurnaceWithChip(e,io.OPN2);break;case"FurnaceOPM":a=this.createFurnaceWithChip(e,io.OPM);break;case"FurnaceOPL":a=this.createFurnaceWithChip(e,io.OPL3);break;case"FurnaceOPLL":case"FurnaceVRC7":a=this.createFurnaceWithChip(e,io.OPLL);break;case"FurnaceESFM":a=this.createFurnaceWithChip(e,io.ESFM);break;case"FurnaceOPZ":a=this.createFurnaceWithChip(e,io.OPZ);break;case"FurnaceOPNA":a=this.createFurnaceWithChip(e,io.OPNA);break;case"FurnaceOPNB":a=this.createFurnaceWithChip(e,io.OPNB);break;case"FurnaceOPL4":a=this.createFurnaceWithChip(e,io.OPL4);break;case"FurnaceY8950":a=this.createFurnaceWithChip(e,io.Y8950);break;case"FurnaceNES":case"FurnaceGB":case"FurnaceSNES":case"FurnacePCE":case"FurnacePSG":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceGBA":case"FurnaceNDS":case"FurnacePOKEMINI":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceAY8930":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSCC":case"FurnaceTIA":case"FurnaceAMIGA":case"FurnacePET":case"FurnacePCSPKR":case"FurnaceZXBEEPER":case"FurnacePOKEY":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceX1_010":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceNAMCO":case"FurnacePCMDAC":case"FurnaceBUBBLE":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":{const t=Ig[e.synthType];if(void 0!==t){a=new jo(t);const n=e.furnace?.furnaceIndex??0;a.setFurnaceInstrumentIndex(n),e.furnace&&a.uploadInstrumentFromConfig(e.furnace,e.name).catch(e=>{})}else a=this.createFurnaceWithChip(e,io.OPN2);break}case"FurnaceOPN2203":a=this.createFurnaceWithChip(e,io.OPN);break;case"FurnaceOPNBB":a=this.createFurnaceWithChip(e,io.OPNB_B);break;case"Sampler":{const t=e.metadata?.modPlayback?.usePeriodPlayback;a=t?this.createPlayer(e):this.createSampler(e);break}case"Player":a=this.createPlayer(e);break;case"Wavetable":a=this.createWavetable(e);break;case"GranularSynth":a=this.createGranularSynth(e);break;case"SuperSaw":a=this.createSuperSaw(e);break;case"PolySynth":a=this.createPolySynth(e);break;case"Organ":a=this.createOrgan(e);break;case"DrumMachine":a=this.createDrumMachine(e);break;case"ChipSynth":a=this.createChipSynth(e);break;case"PWMSynth":a=this.createPWMSynth(e);break;case"StringMachine":a=this.createStringMachine(e);break;case"FormantSynth":a=this.createFormantSynth(e);break;case"WobbleBass":a=this.createWobbleBass(e);break;case"DrumKit":a=this.createDrumKit(e);break;case"DubSiren":a=this.createDubSiren(e);break;case"SpaceLaser":a=this.createSpaceLaser(e);break;case"V2":case"V2Speech":a=this.createV2(e);break;case"Sam":a=this.createSam(e);break;case"Synare":a=this.createSynare(e);break;case"WAMOBXd":case"WAMSynth101":case"WAMTinySynth":case"WAMFaustFlute":a=this.createNamedWAM(e);break;case"WAM":a=this.createWAM(e);break;case"Dexed":a=this.createDexed(e);break;case"OBXd":a=this.createOBXd(e);break;case"MAMEVFX":case"VFX":a=this.createVFX(e);break;case"D50":a=this.createD50(e);break;case"MAMEDOC":a=new Or({type:"doc"});break;case"MAMERSA":a=this.createRdPiano(e);break;case"MAMESWP30":a=this.createMU2000(e);break;case"CZ101":a=this.createCZ101(e);break;case"CEM3394":a=this.createCEM3394(e);break;case"SCSP":a=this.createSCSP(e);break;case"BuzzDTMF":a=this.createBuzzGenerator(zl.CYANPHASE_DTMF,"BuzzDTMF",e);break;case"BuzzFreqBomb":a=this.createBuzzGenerator(zl.ELENZIL_FREQUENCYBOMB,"BuzzFreqBomb",e);break;case"BuzzKick":a=this.createBuzzGenerator(zl.FSM_KICK,"BuzzKick",e);break;case"BuzzKickXP":a=this.createBuzzGenerator(zl.FSM_KICKXP,"BuzzKickXP",e);break;case"BuzzNoise":a=this.createBuzzGenerator(zl.JESKOLA_NOISE,"BuzzNoise",e);break;case"BuzzTrilok":a=this.createBuzzGenerator(zl.JESKOLA_TRILOK,"BuzzTrilok",e);break;case"Buzz4FM2F":a=this.createBuzzGenerator(zl.MADBRAIN_4FM2F,"Buzz4FM2F",e);break;case"BuzzDynamite6":a=this.createBuzzGenerator(zl.MADBRAIN_DYNAMITE6,"BuzzDynamite6",e);break;case"BuzzM3":a=this.createBuzzGenerator(zl.MAKK_M3,"BuzzM3",e);break;case"Buzz3o3":a=this.createBuzz3o3(e);break;case"Buzz3o3DF":a=this.createBuzz3o3DF(e);break;case"BuzzM4":a=this.createBuzzGenerator(zl.MAKK_M4,"BuzzM4",e);break;case"MAMEAICA":a=this.createMAMEAICA(e);break;case"MAMEASC":a=this.createMAMEASC(e);break;case"MAMEAstrocade":a=this.createMAMEAstrocade(e);break;case"MAMEC352":a=this.createMAMEC352(e);break;case"MAMEES5503":a=this.createMAMEES5503(e);break;case"MAMEICS2115":a=this.createMAMEICS2115(e);break;case"MAMEK054539":a=this.createMAMEK054539(e);break;case"MAMEMEA8000":a=this.createMAMEMEA8000(e);break;case"MAMERF5C400":a=this.createMAMERF5C400(e);break;case"MAMESN76477":a=this.createMAMESN76477(e);break;case"MAMESNKWave":a=this.createMAMESNKWave(e);break;case"MAMESP0250":a=this.createMAMESP0250(e);break;case"MAMETMS36XX":a=this.createMAMETMS36XX(e);break;case"MAMETMS5220":a=this.createMAMETMS5220(e);break;case"MAMETR707":a=this.createMAMETR707(e);break;case"MAMEUPD931":a=this.createMAMEUPD931(e);break;case"MAMEUPD933":a=this.createMAMEUPD933(e);break;case"MAMEVotrax":a=this.createMAMEVotrax(e);break;case"MAMEYMF271":a=this.createMAMEYMF271(e);break;case"MAMEYMOPQ":a=this.createMAMEYMOPQ(e);break;case"MAMEVASynth":a=this.createMAMEVASynth(e);break;default:{const t=Eg.get(e.synthType);a=t?new Pg(t,e):this.createSynth(e)}}if(e.synthType.startsWith("Furnace")&&a){const t=this.VOLUME_NORMALIZATION_OFFSETS[e.synthType]??0;0!==t&&"setVolumeOffset"in a&&a.setVolumeOffset(t)}return a}static async createEffectChain(e){const t=e.filter(e=>e.enabled);return Promise.all(t.map(e=>this.createEffect(e)))}static async createEffect(e){const t=e.wet/100,a=e.parameters,n=await Ag.ensure(e.type);if(n){const t=await n.create(e);return t._fxType=e.type,t}if("neural"===e.category){if(void 0===e.neuralModelIndex)throw new Error("Neural effect requires neuralModelIndex");const a=new ii({modelIndex:e.neuralModelIndex,wet:t});return await a.loadModel(),Object.entries(e.parameters).forEach(([e,t])=>{a.setParameter(e,t)}),a}let s;switch(e.type){case"Distortion":s=new b({distortion:a.drive||.4,oversample:a.oversample||"none",wet:t});break;case"Reverb":{const e=new g({decay:a.decay||1.5,preDelay:a.preDelay||.01,wet:t});await e.ready,s=e;break}case"Delay":case"FeedbackDelay":s=new _({delayTime:a.time||.25,feedback:a.feedback||.5,wet:t});break;case"Chorus":{const e=new $({frequency:a.frequency||1.5,delayTime:a.delayTime||3.5,depth:a.depth||.7,wet:t});e.start(),s=e;break}case"Phaser":s=new w({frequency:a.frequency||.5,octaves:a.octaves||3,baseFrequency:a.baseFrequency||350,wet:t});break;case"Tremolo":{const e=new q({frequency:a.frequency||10,depth:a.depth||.5,wet:t});e.start(),s=e;break}case"Vibrato":s=new K({frequency:a.frequency||5,depth:a.depth||.1,wet:t});break;case"AutoFilter":{const e=new H({frequency:a.frequency||1,baseFrequency:a.baseFrequency||200,octaves:a.octaves||2.6,filter:{type:a.filterType||"lowpass",rolloff:-12,Q:1},wet:t});e.start(),s=e;break}case"AutoPanner":{const e=new W({frequency:a.frequency||1,depth:a.depth||1,wet:t});e.start(),s=e;break}case"AutoWah":s=new G({baseFrequency:a.baseFrequency||100,octaves:a.octaves||6,sensitivity:a.sensitivity||0,Q:a.Q||2,gain:a.gain||2,follower:a.follower||.1,wet:t});break;case"BitCrusher":{const e=new U(Number(a.bits)||4);e.wet.value=t;const n=e._bitCrusherWorklet;if(n)for(let t=0;t<50&&!n._worklet;t++)await new Promise(e=>setTimeout(e,20));s=e;break}case"Chebyshev":s=new z({order:a.order||50,oversample:a.oversample||"none",wet:t});break;case"FrequencyShifter":s=new V({frequency:a.frequency||0,wet:t});break;case"PingPongDelay":s=new L({delayTime:a.time||.25,feedback:a.feedback||.5,wet:t});break;case"PitchShift":s=new B({pitch:a.pitch||0,windowSize:a.windowSize||.1,delayTime:a.delayTime||0,feedback:a.feedback||0,wet:t});break;case"Compressor":s=new S({threshold:a.threshold||-24,ratio:a.ratio||12,attack:a.attack||.003,release:a.release||.25});break;case"EQ3":s=new f({low:a.low||0,mid:a.mid||0,high:a.high||0,lowFrequency:a.lowFrequency||400,highFrequency:a.highFrequency||2500});break;case"Filter":s=new h({type:a.type||"lowpass",frequency:a.frequency||5e3,rolloff:a.rolloff||-12,Q:a.Q||1,gain:a.gain||0});break;case"JCReverb":{const e=new j({roomSize:a.roomSize||.5,wet:t}),n=e._feedbackCombFilters;if(n?.length)for(let t=0;t<50&&!n.every(e=>e._worklet);t++)await new Promise(e=>setTimeout(e,20));s=e;break}case"StereoWidener":s=new R({width:a.width||.5});break;case"TapeSaturation":s=new Xr({drive:(a.drive||50)/100,tone:a.tone||12e3,wet:t});break;case"SidechainCompressor":s=new no({threshold:a.threshold??-24,ratio:a.ratio??4,attack:a.attack??.003,release:a.release??.25,knee:a.knee??6,sidechainGain:(a.sidechainGain??100)/100,wet:t});break;case"SpaceEcho":s=new li({mode:Number(a.mode)||4,rate:Number(a.rate)||300,intensity:Number(a.intensity)||.5,echoVolume:Number(a.echoVolume)||.8,reverbVolume:Number(a.reverbVolume)||.3,bass:Number(a.bass)||0,treble:Number(a.treble)||0,wet:t});break;case"SpaceyDelayer":s=new hi({firstTap:Number(a.firstTap)||250,tapSize:Number(a.tapSize)||150,feedback:Number(a.feedback)||40,multiTap:null!=a.multiTap?Number(a.multiTap):1,tapeFilter:Number(a.tapeFilter)||0,wet:t});break;case"RETapeEcho":s=new xi({mode:null!=a.mode?Number(a.mode):3,repeatRate:Number(a.repeatRate)||.5,intensity:Number(a.intensity)||.5,echoVolume:Number(a.echoVolume)||.8,wow:Number(a.wow)||0,flutter:Number(a.flutter)||0,dirt:Number(a.dirt)||0,inputBleed:null!=a.inputBleed?Number(a.inputBleed):0,loopAmount:Number(a.loopAmount)||0,playheadFilter:null!=a.playheadFilter?Number(a.playheadFilter):1,wet:t});break;case"BiPhase":s=new ki({rateA:Number(a.rateA)||.5,depthA:Number(a.depthA)||.6,rateB:Number(a.rateB)||4,depthB:Number(a.depthB)||.4,feedback:Number(a.feedback)||.3,routing:1===Number(a.routing)?"series":"parallel",wet:t});break;case"DubFilter":s=new Mi({cutoff:Number(a.cutoff)||20,resonance:Number(a.resonance)||30,gain:Number(a.gain)||1,wet:t});break;case"BuzzDistortion":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("ArguruDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzSVF":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("ElakSVF");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzDelay":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaDelay");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzChorus":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMChorus");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzCompressor":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("GeonikCompressor");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzOverdrive":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("GeonikOverdrive");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzDistortion2":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaDistortion");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzCrossDelay":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaCrossDelay");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzPhilta":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMPhilta");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzDist2":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("ElakDist2");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzFreeverb":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("JeskolaFreeverb");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzFreqShift":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("BigyoFrequencyShifter");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzNotch":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("CyanPhaseNotch");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzStereoGain":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("DedaCodeStereoGain");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzSoftSat":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("GraueSoftSat");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzLimiter":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("LdSLimit");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzExciter":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("OomekExciter");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzMasterizer":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("OomekMasterizer");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzStereoDist":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("WhiteNoiseStereoDist");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzWhiteChorus":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("WhiteNoiseWhiteChorus");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzZfilter":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("QZfilter");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzChorus2":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMChorus2");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"BuzzPanzerDelay":{const{BuzzmachineSynth:t}=await ja(async()=>{const{BuzzmachineSynth:e}=await import("./BuzzmachineSynth-DBSGqOi6.js");return{BuzzmachineSynth:e}},__vite__mapDeps([0,1,2,3,4])),a=new t("FSMPanzerDelay");Object.entries(e.parameters).forEach(([e,t])=>{const n=parseInt(e,10);isNaN(n)||a.setParameter(n,t)}),s=a;break}case"MoogFilter":s=new _i({cutoff:Number(a.cutoff)||1e3,resonance:(Number(a.resonance)||10)/100,drive:Number(a.drive)||1,model:Number(a.model)||Ci.Hyperion,filterMode:Number(a.filterMode)||Pi.LP4,wet:t});break;case"MVerb":s=new Fi({damping:Number(a.damping),density:Number(a.density),bandwidth:Number(a.bandwidth),decay:Number(a.decay),predelay:Number(a.predelay),size:Number(a.size),gain:Number(a.gain),mix:Number(a.mix),earlyMix:Number(a.earlyMix),wet:t});break;case"Leslie":s=new zi({speed:Number(a.speed),hornRate:Number(a.hornRate),drumRate:Number(a.drumRate),hornDepth:Number(a.hornDepth),drumDepth:Number(a.drumDepth),doppler:Number(a.doppler),width:Number(a.width),acceleration:Number(a.acceleration),wet:t});break;case"SpringReverb":s=new Ki({decay:Number(a.decay),damping:Number(a.damping),tension:Number(a.tension),mix:Number(a.mix),drip:Number(a.drip),diffusion:Number(a.diffusion),wet:t});break;case"WAMBigMuff":case"WAMTS9":case"WAMDistoMachine":case"WAMQuadraFuzz":case"WAMVoxAmp":case"WAMStonePhaser":case"WAMPingPongDelay":case"WAMFaustDelay":case"WAMPitchShifter":case"WAMGraphicEQ":case"WAMPedalboard":{const a=kg[e.type];if(!a){s=new p(1);break}const n=new bg({moduleUrl:a,wet:t});await n.ensureInitialized(),s=n;break}default:s=new p(1)}if(s._fxType=e.type,to(e.parameters)){const t=Ji[e.type];if(t){const a=N().bpm.value,n=ao(e.parameters);for(const r of t){const t=eo(a,n,r.unit);switch(e.type){case"Delay":case"FeedbackDelay":"time"===r.param&&s instanceof _&&(s.delayTime.value=t);break;case"PingPongDelay":"time"===r.param&&s instanceof L&&(s.delayTime.value=t);break;case"SpaceEcho":"rate"===r.param&&s instanceof li&&s.setRate(t);break;case"SpaceyDelayer":"firstTap"===r.param&&s instanceof hi&&s.setFirstTap(t);break;case"RETapeEcho":"repeatRate"===r.param&&s instanceof xi&&s.setRepeatRate(t);break;case"Chorus":"frequency"===r.param&&s instanceof $&&(s.frequency.value=t);break;case"BiPhase":"rateA"===r.param&&s instanceof ki&&(s.rateA=t)}}}}return s}static connectWithEffects(e,t,a){if(0!==t.length){e.connect(t[0]);for(let e=0;e<t.length-1;e++)t[e].connect(t[e+1]);t[t.length-1].connect(a)}else e.connect(a)}static disposeInstrument(e,t){t.forEach(e=>e.dispose()),e.dispose()}static createSynth(e){const t=new X(Y,{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("Synth",e.volume)});e.oscillator?.detune&&t.set({detune:e.oscillator.detune});const a=e.pitchEnvelope;return a?.enabled&&0!==a.amount?{triggerAttackRelease:(e,n,s,r)=>{const i=s??Z();this.applyPitchEnvelope(t,a,i,n),t.triggerAttackRelease(e,n,i,r)},triggerAttack:(e,n,s)=>{const r=n??Z();this.triggerPitchEnvelopeAttack(t,a,r),t.triggerAttack(e,r,s)},triggerRelease:(e,n)=>{const s=n??Z();this.triggerPitchEnvelopeRelease(t,a,s),t.triggerRelease(e,s)},releaseAll:()=>{t.set({detune:0}),t.releaseAll()},connect:e=>t.connect(e),disconnect:()=>t.disconnect(),dispose:()=>t.dispose(),volume:t.volume}:t}static createMonoSynth(e){const t={oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("MonoSynth",e.volume)};return e.filter&&e.filter.type&&e.filter.frequency&&(t.filter={type:e.filter.type,frequency:e.filter.frequency,Q:e.filter.Q??1,rolloff:e.filter.rolloff??-12}),e.filterEnvelope&&void 0!==e.filterEnvelope.baseFrequency&&void 0!==e.filterEnvelope.attack&&(t.filterEnvelope={baseFrequency:e.filterEnvelope.baseFrequency,octaves:e.filterEnvelope.octaves??3,attack:e.filterEnvelope.attack/1e3,decay:(e.filterEnvelope.decay??200)/1e3,sustain:(e.filterEnvelope.sustain??50)/100,release:(e.filterEnvelope.release??1e3)/1e3}),new Q(t)}static createDuoSynth(e){const t=e.oscillator?.type||"sawtooth";return new J({voice0:{oscillator:{type:t},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:t},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}},vibratoAmount:e.oscillator?.detune?e.oscillator.detune/100:.5,vibratoRate:5,volume:this.getNormalizedVolume("DuoSynth",e.volume)})}static createFMSynth(e){return new X(O,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},modulationIndex:10,volume:this.getNormalizedVolume("FMSynth",e.volume)})}static createAMSynth(e){return new X(ee,{oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("AMSynth",e.volume)})}static createPluckSynth(e){const t=new X(te);return t.set({attackNoise:1,dampening:4e3,resonance:.7}),t.volume.value=this.getNormalizedVolume("PluckSynth",e.volume),t}static createMetalSynth(e){return new ae({envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??100)/1e3,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MetalSynth",e.volume)})}static createMembraneSynth(e){return new ne({pitchDecay:.05,octaves:10,oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??400)/1e3,sustain:.01,release:(e.envelope?.release??100)/1e3},volume:this.getNormalizedVolume("MembraneSynth",e.volume)})}static createNoiseSynth(e){return new se({noise:{type:"white"},envelope:{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3},volume:this.getNormalizedVolume("NoiseSynth",e.volume)})}static createTB303(e){const t=e.tb303||{...qn},a=this.getNormalizedVolume("TB303",e.volume);return this.createDB303(t,a)}static createWAM(e){const t=e.wam||{moduleUrl:"",pluginState:null},a=new gg(t);return a.output.gain.value=re(e.volume??-12),a}static createNamedWAM(e){const t=Sg[e.synthType];if(!t)return this.createWAM(e);const a={...e.wam,moduleUrl:t,pluginState:e.wam?.pluginState??null},n=new gg(a);return n.output.gain.value=re(e.volume??-12),n}static createDB303(e,t){const a=new Cr;return a.applyConfig(e),void 0!==t&&(a.output.gain.value=re(t)),a}static createBuzzGenerator(e,t,a){const n=new Wl(e),s=this.getNormalizedVolume(t,a.volume);return n.output.gain.value=re(s),n}static createBuzz3o3(e){const t=new Wl(zl.OOMEK_AGGRESSOR_DF);if(e.tb303){const a=e.tb303;if(t.setCutoff(a.filter.cutoff),t.setResonance(a.filter.resonance),t.setEnvMod(a.filterEnvelope.envMod),t.setDecay(a.filterEnvelope.decay),t.setAccentAmount(a.accent.amount),t.setWaveform(a.oscillator.type),void 0!==a.tuning&&t.setTuning(a.tuning),a.overdrive&&t.setOverdrive(a.overdrive.amount),a.devilFish){const e=a.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:a.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.filterFmDepth&&t.setFilterFM(e.filterFmDepth)}const n=this.getNormalizedVolume("Buzz3o3",e.volume);t.setVolume(n)}return t}static createWavetable(e){const t=e.wavetable||mn,a=new ni(t);return a.output.gain.value=re(this.getNormalizedVolume("Wavetable",e.volume)),a}static createSampler(e){if(e.sample?.multiMap&&Object.keys(e.sample.multiMap).length>0)return new ie({urls:e.sample.multiMap,volume:this.getNormalizedVolume("Sampler",e.volume)});const t=e.parameters,a=t?.sampleUrl||e.sample?.url,n=e.sample?.baseNote||"C4";if(!a&&e.metadata,a){const t={};return t[n]=a,new ie({urls:t,volume:this.getNormalizedVolume("Sampler",e.volume)})}return new ie({volume:this.getNormalizedVolume("Sampler",e.volume)})}static createPlayer(e){const t=e.parameters,a=t?.sampleUrl,n=t?.reverseMode||"forward";if(a){return new oe({url:a,volume:this.getNormalizedVolume("Player",e.volume),reverse:"reverse"===n})}return new oe({volume:this.getNormalizedVolume("Player",e.volume)})}static createGranularSynth(e){const t=e.granular?.sampleUrl||e.parameters?.sampleUrl,a=e.granular;if(t){return new le({url:t,grainSize:(a?.grainSize||100)/1e3,overlap:(a?.grainOverlap||50)/100,playbackRate:a?.playbackRate||1,detune:a?.detune||0,reverse:a?.reverse||!1,loop:!0,loopStart:0,loopEnd:0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}return new le({grainSize:.1,overlap:.5,playbackRate:1,loop:!0,volume:this.getNormalizedVolume("GranularSynth",e.volume)})}static createSuperSaw(e){const t=e.superSaw||vn,a=t.detune,n=new X(Y,{oscillator:{type:"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??80)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("SuperSaw",e.volume)}),s=new h({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),r=new $({frequency:4,delayTime:2.5,depth:Math.min(1,a/50),wet:.8});r.start(),n.connect(s),s.connect(r);const i=e.pitchEnvelope,o=i?.enabled&&0!==i.amount;return{triggerAttackRelease:(e,t,a,s)=>{const r=a??Z();o&&this.applyPitchEnvelope(n,i,r,t),n.triggerAttackRelease(e,t,r,s)},triggerAttack:(e,t,a)=>{const s=t??Z();o&&this.triggerPitchEnvelopeAttack(n,i,s),n.triggerAttack(e,s,a)},triggerRelease:(e,t)=>{const a=t??Z();o&&this.triggerPitchEnvelopeRelease(n,i,a),n.triggerRelease(e,a)},releaseAll:()=>{n.set({detune:0}),n.releaseAll()},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{n.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||vn,a=t.envelope,i=t.filter;n.set({envelope:{attack:(a.attack||10)/1e3,decay:(a.decay||100)/1e3,sustain:(a.sustain||80)/100,release:(a.release||300)/1e3}}),s.set({type:i.type,frequency:i.cutoff,Q:i.resonance/10}),r.set({depth:Math.min(1,t.detune/50)})},volume:n.volume}}static createPolySynth(e){const t=e.polySynth||xn;let a=Y;"FMSynth"===t.voiceType?a=O:"AMSynth"===t.voiceType&&(a=ee);const n=new X(a,{oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||50)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||500)/1e3},volume:this.getNormalizedVolume("PolySynth",e.volume)});n.maxPolyphony=t.voiceCount;const s=e.pitchEnvelope;return s?.enabled&&0!==s.amount?{triggerAttackRelease:(e,t,a,r)=>{const i=a??Z();this.applyPitchEnvelope(n,s,i,t),n.triggerAttackRelease(e,t,i,r)},triggerAttack:(e,t,a)=>{const r=t??Z();this.triggerPitchEnvelopeAttack(n,s,r),n.triggerAttack(e,r,a)},triggerRelease:(e,t)=>{const a=t??Z();this.triggerPitchEnvelopeRelease(n,s,a),n.triggerRelease(e,a)},releaseAll:()=>{n.set({detune:0}),n.releaseAll()},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>n.dispose(),volume:n.volume}:n}static createOrgan(e){const t=e.organ||wn,a=t.drawbars||wn.drawbars,n=new p(1),s=new X(Y,{oscillator:{type:"custom",partials:[a[0]/8,a[1]/8,a[2]/8,a[3]/8,a[4]/8,a[5]/8,a[6]/8,a[7]/8,a[8]/8]},envelope:{attack:.005,decay:.1,sustain:1,release:.1},volume:this.getNormalizedVolume("Organ",e.volume)});s.maxPolyphony=32;let r=null;return t.rotary?.enabled?(r=new q({frequency:"fast"===t.rotary.speed?6:1,depth:.3,wet:.5}),r.start(),s.connect(r),r.connect(n)):s.connect(n),{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(e,t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{s.triggerRelease(e,t)},releaseAll:()=>s.releaseAll(),connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{s.dispose(),r?.dispose(),n.dispose()},applyConfig:e=>{const t=e||wn,a=t.drawbars;s.set({oscillator:{partials:[(a[0]||0)/8,(a[1]||0)/8,(a[2]||0)/8,(a[3]||0)/8,(a[4]||0)/8,(a[5]||0)/8,(a[6]||0)/8,(a[7]||0)/8,(a[8]||0)/8]}}),r&&r.frequency.rampTo("fast"===t.rotary?.speed?6:1,.1)},volume:s.volume}}static createDrumMachine(e){const t=e.drumMachine||kn,a="808"===t.machineType;switch(t.drumType){case"kick":{const n={...a?{pitch:48,pitchDecay:50,tone:40,toneDecay:30,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3},...t.kick},s=new ne({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)});let r=s,i=null,o=null;n.drive>0&&(i=new b({distortion:n.drive/100*.5,oversample:"2x",wet:1})),o=new h({type:"lowpass",frequency:n.filterFreq,Q:1,rolloff:-24}),i?(s.connect(i),i.connect(o)):s.connect(o),r=o;const l=ce(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(l,t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(l,t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{s.dispose(),i?.dispose(),o?.dispose()},applyConfig:e=>{const t=(e||kn).kick;t&&(s.set({pitchDecay:t.envDuration/1e3,octaves:2*Math.log2(t.envAmount),envelope:{decay:t.decay/1e3}}),i&&(i.distortion=t.drive/100*.5),o&&o.frequency.rampTo(t.filterFreq,.1))},volume:s.volume}}case"snare":{const n={...a?{pitch:238,tone:35,toneDecay:200,snappy:55,decay:150,envAmount:2.5,envDuration:25,filterType:"lowpass",filterFreq:2500}:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3},...t.snare},s=new ne({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.toneDecay/1e3,sustain:0,release:.05},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(n.snappy/15-3)}),i=new h({type:n.filterType,frequency:n.filterFreq,Q:2}),o=new p(1);s.connect(o),r.connect(i),i.connect(o);const l=ce(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(l,t,a,n),r.triggerAttackRelease(t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(l,t,a),r.triggerAttack(t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i.dispose(),o.dispose()},applyConfig:t=>{const a=(t||kn).snare;a&&(s.set({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),envelope:{decay:a.decay/1e3}}),r.set({envelope:{decay:a.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)+(a.snappy/15-3)}),i.set({type:a.filterType,frequency:a.filterFreq}))},volume:s.volume}}case"hihat":{const n={...a?{tone:40,decay:80,metallic:70}:{tone:50,decay:100,metallic:50},...t.hihat},s=new ae({envelope:{attack:.001,decay:n.decay/1e3,release:a?.02:.01},harmonicity:5.1,modulationIndex:32+n.metallic/3,resonance:4e3+40*n.tone,octaves:1.5,volume:e.volume||-12});return s.frequency.value=a?180+1.5*n.tone:200+2*n.tone,s}case"clap":{const n={...a?{tone:45,decay:120,toneDecay:350,spread:15,filterFreqs:[700,1e3],modulatorFreq:30}:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40},...t.clap},s=new p(1),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.05},volume:e.volume??-10}),i=new h({type:"highpass",frequency:n.filterFreqs[0],Q:1.2}),o=new h({type:"bandpass",frequency:n.filterFreqs[1],Q:.7}),l=new h({type:"bandpass",frequency:1e3+24*n.tone,Q:2});r.connect(l),l.connect(i),i.connect(o),o.connect(s);const c=[],u=4;for(let t=0;t<u;t++){const a=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.toneDecay/1e3/(t+1),sustain:0,release:.02},volume:(e.volume??-10)-3*t});a.connect(l),c.push(a)}return{triggerAttackRelease:(e,t,a,s)=>{const i=a??Z(),o=n.spread/1e3;c.forEach((e,a)=>{const n=i+a*o,r=(s??1)*(1-.15*a);e.triggerAttackRelease(t/(a+1),n,r)}),r.triggerAttackRelease(t,i+u*o,s)},triggerAttack:(e,t,a)=>{const s=t??Z(),i=n.spread/1e3;c.forEach((e,t)=>{e.triggerAttack(s+t*i,(a??1)*(1-.15*t))}),r.triggerAttack(s+u*i,a)},triggerRelease:(e,t)=>{r.triggerRelease(t),c.forEach(e=>e.triggerRelease(t))},releaseAll:()=>{try{r.triggerRelease()}catch{}c.forEach(e=>{try{e.triggerRelease()}catch{}})},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{r.dispose(),c.forEach(e=>e.dispose()),i.dispose(),o.dispose(),l.dispose(),s.dispose()},applyConfig:e=>{const t=(e||kn).clap;t&&(r.set({envelope:{decay:t.decay/1e3}}),i.frequency.rampTo(t.filterFreqs[0],.1),o.frequency.rampTo(t.filterFreqs[1],.1),l.frequency.rampTo(1e3+24*t.tone,.1),c.forEach((e,a)=>{e.set({envelope:{decay:t.toneDecay/1e3/(a+1)}})}))},volume:r.volume}}case"tom":{const n={...a?{pitch:160,decay:300,tone:2,toneDecay:50,envAmount:1.5,envDuration:150}:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100},...t.tom},s=new ne({pitchDecay:n.envDuration/1e3,octaves:2*Math.log2(n.envAmount),oscillator:{type:"sine"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.1},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),r=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.toneDecay/1e3,sustain:0,release:.02},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+n.tone/5}),i=new p(1);s.connect(i),r.connect(i);const o=ce(n.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(o,t,a,n),r.triggerAttackRelease(.3*t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(o,t,a),r.triggerAttack(t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t),r.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}try{r.triggerRelease()}catch{}},connect:e=>i.connect(e),disconnect:()=>i.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i.dispose()},applyConfig:t=>{const a=(t||kn).tom;a&&(s.set({pitchDecay:a.envDuration/1e3,octaves:2*Math.log2(a.envAmount),envelope:{decay:a.decay/1e3}}),r.set({envelope:{decay:a.toneDecay/1e3},volume:this.getNormalizedVolume("DrumMachine",e.volume)-20+a.tone/5}))},volume:s.volume}}case"rimshot":{const n={...a?{decay:45,filterFreqs:[280,450,850],filterQ:8,saturation:2}:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3},...t.rimshot},s=new se({noise:{type:"white"},envelope:{attack:.001,decay:n.decay/1e3,sustain:0,release:.01},volume:e.volume??-10}),r=new h({type:"bandpass",frequency:n.filterFreqs[0],Q:n.filterQ}),i=new h({type:"bandpass",frequency:n.filterFreqs[1],Q:n.filterQ}),o=new h({type:"bandpass",frequency:n.filterFreqs[2],Q:n.filterQ}),l=new p(1);s.connect(r),s.connect(i),s.connect(o),r.connect(l),i.connect(l),o.connect(l);const c=new b({distortion:n.saturation/5*.8,oversample:"2x",wet:1}),u=new h({type:"highpass",frequency:100,Q:.5});return l.connect(c),c.connect(u),{triggerAttackRelease:(e,t,a,n)=>{s.triggerAttackRelease(t,a,n)},triggerAttack:(e,t,a)=>{s.triggerAttack(t,a)},triggerRelease:(e,t)=>{s.triggerRelease(t)},releaseAll:()=>{try{s.triggerRelease()}catch{}},connect:e=>u.connect(e),disconnect:()=>u.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i.dispose(),o.dispose(),l.dispose(),c.dispose(),u.dispose()},applyConfig:e=>{const t=(e||kn).rimshot;t&&(s.set({envelope:{decay:t.decay/1e3}}),r.frequency.rampTo(t.filterFreqs[0],.1),i.frequency.rampTo(t.filterFreqs[1],.1),o.frequency.rampTo(t.filterFreqs[2],.1),r.Q.value=t.filterQ,i.Q.value=t.filterQ,o.Q.value=t.filterQ,c.distortion=t.saturation/5*.8)},volume:s.volume}}case"conga":{const a={pitch:310,decay:180,...t.conga},n=new Y({oscillator:{type:"sine"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.1},volume:e.volume??-8}),s=new h({type:"lowpass",frequency:1e4,Q:1});n.connect(s);const r=ce(a.pitch,"hz").toNote();return{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(r,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(r,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(t)},releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),s.dispose()},applyConfig:e=>{const t=(e||kn).conga;t&&n.set({envelope:{decay:t.decay/1e3}})},volume:n.volume}}case"cowbell":{const e={decay:400,filterFreq:2640,...t.cowbell},a=new T({type:"square",frequency:540,volume:-6}),n=new T({type:"square",frequency:800,volume:-6}),s=new p(0),r=new p(0),i=new h({type:"bandpass",frequency:e.filterFreq,Q:1}),o=new p(.3);a.connect(o),n.connect(o),o.connect(s),o.connect(r);const l=new p(1);return s.connect(i),r.connect(i),i.connect(l),a.start(),n.start(),{triggerAttackRelease:(t,a,n,i)=>{const o=n??Z(),l=i??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(0,o),s.gain.linearRampToValueAtTime(.375*l,o+.002),s.gain.linearRampToValueAtTime(0,o+.017),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.001,o+.015),r.gain.exponentialRampToValueAtTime(.125*l,o+.017),r.gain.exponentialRampToValueAtTime(.001,o+.017+e.decay/1e3)},triggerAttack:(t,a,n)=>{const i=a??Z(),o=n??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(0,i),s.gain.linearRampToValueAtTime(.375*o,i+.002),s.gain.linearRampToValueAtTime(0,i+.017),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.001,i+.015),r.gain.exponentialRampToValueAtTime(.125*o,i+.017),r.gain.exponentialRampToValueAtTime(.001,i+.017+e.decay/1e3)},triggerRelease:()=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{a.stop(),n.stop(),a.dispose(),n.dispose(),s.dispose(),r.dispose(),o.dispose(),i.dispose(),l.dispose()},applyConfig:e=>{const t=(e||kn).cowbell;t&&i.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"clave":{const e={decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450,...t.clave},a=new T({type:"triangle",frequency:e.pitch,volume:-6}),n=new T({type:"sine",frequency:e.pitchSecondary,volume:-8}),s=new p(0),r=new p(0),i=new h({type:"bandpass",frequency:e.filterFreq,Q:5}),o=new b({distortion:.5,oversample:"2x",wet:1}),l=new p(1);return a.connect(s),n.connect(r),s.connect(i),r.connect(i),i.connect(o),o.connect(l),a.start(),n.start(),{triggerAttackRelease:(t,a,n,i)=>{const o=n??Z(),l=i??1;s.gain.cancelScheduledValues(o),s.gain.setValueAtTime(.7*l,o),s.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3),r.gain.cancelScheduledValues(o),r.gain.setValueAtTime(.5*l,o),r.gain.exponentialRampToValueAtTime(.001,o+e.decay/1e3)},triggerAttack:(t,a,n)=>{const i=a??Z(),o=n??1;s.gain.cancelScheduledValues(i),s.gain.setValueAtTime(.7*o,i),s.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3),r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(.5*o,i),r.gain.exponentialRampToValueAtTime(.001,i+e.decay/1e3)},triggerRelease:()=>{},releaseAll:()=>{},connect:e=>l.connect(e),disconnect:()=>l.disconnect(),dispose:()=>{a.stop(),n.stop(),a.dispose(),n.dispose(),s.dispose(),r.dispose(),i.dispose(),o.dispose(),l.dispose()},applyConfig:e=>{const t=(e||kn).clave;t&&i.frequency.rampTo(t.filterFreq,.1)},volume:l.gain}}case"maracas":{const a={decay:30,filterFreq:5e3,...t.maracas},n=new se({noise:{type:"white"},envelope:{attack:.001,decay:a.decay/1e3,sustain:0,release:.01},volume:this.getNormalizedVolume("DrumMachine",e.volume)}),s=new h({type:"highpass",frequency:a.filterFreq,Q:1});return n.connect(s),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(t,a)},triggerRelease:(e,t)=>{n.triggerRelease(t)},releaseAll:()=>{try{n.triggerRelease()}catch{}},connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{n.dispose(),s.dispose()},applyConfig:e=>{const t=(e||kn).maracas;t&&(n.set({envelope:{decay:t.decay/1e3}}),s.frequency.rampTo(t.filterFreq,.1))},volume:n.volume}}case"cymbal":{const e={tone:50,decay:2e3,...t.cymbal},a=[263,400,421,474,587,845],n=[],s=new p(.3);for(const t of a){const e=new T({type:"square",frequency:t,volume:-10});e.connect(s),e.start(),n.push(e)}const r=new h({type:"bandpass",frequency:5e3,Q:1}),i=new p(0),o=new h({type:"bandpass",frequency:1e4,Q:1}),l=new p(0),c=new h({type:"highpass",frequency:8e3,Q:1}),u=new p(0);s.connect(r),s.connect(o),s.connect(c),r.connect(i),o.connect(l),c.connect(u);const d=new p(1);i.connect(d),l.connect(d),u.connect(d);const m=.666-e.tone/100*.666,f=.333,y=.666-.666*(1-e.tone/100);return{triggerAttackRelease:(t,a,n,s)=>{const r=n??Z(),o=s??1;i.gain.cancelScheduledValues(r),i.gain.setValueAtTime(.001,r),i.gain.exponentialRampToValueAtTime(m*o,r+.01),i.gain.exponentialRampToValueAtTime(.001,r+e.decay/1e3),l.gain.cancelScheduledValues(r),l.gain.setValueAtTime(.001,r),l.gain.exponentialRampToValueAtTime(f*o,r+.01),l.gain.exponentialRampToValueAtTime(.001,r+.4),u.gain.cancelScheduledValues(r),u.gain.setValueAtTime(.001,r),u.gain.exponentialRampToValueAtTime(y*o,r+.01),u.gain.exponentialRampToValueAtTime(.001,r+.15)},triggerAttack:(t,a,n)=>{const s=a??Z(),r=n??1;i.gain.cancelScheduledValues(s),i.gain.setValueAtTime(.001,s),i.gain.exponentialRampToValueAtTime(m*r,s+.01),i.gain.exponentialRampToValueAtTime(.001,s+e.decay/1e3),l.gain.cancelScheduledValues(s),l.gain.setValueAtTime(.001,s),l.gain.exponentialRampToValueAtTime(f*r,s+.01),l.gain.exponentialRampToValueAtTime(.001,s+.4),u.gain.cancelScheduledValues(s),u.gain.setValueAtTime(.001,s),u.gain.exponentialRampToValueAtTime(y*r,s+.01),u.gain.exponentialRampToValueAtTime(.001,s+.15)},triggerRelease:()=>{},releaseAll:()=>{},connect:e=>d.connect(e),disconnect:()=>d.disconnect(),dispose:()=>{n.forEach(e=>{e.stop(),e.dispose()}),s.dispose(),r.dispose(),o.dispose(),c.dispose(),i.dispose(),l.dispose(),u.dispose(),d.dispose()},applyConfig:()=>{},volume:d.gain}}default:return new ne({pitchDecay:.05,octaves:3,envelope:{attack:.001,decay:.3,sustain:0,release:.1},volume:e.volume||-12})}}static createChipSynth(e){const t=e.chipSynth||Sn,a=t.arpeggio;let n="square";if("triangle"===t.channel&&(n="triangle"),"noise"===t.channel){const a=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack||5)/1e3,decay:(t.envelope?.decay||100)/1e3,sustain:(t.envelope?.sustain??0)/100,release:(t.envelope?.release||50)/1e3},volume:e.volume||-12}),n=new U(t.bitDepth);return n.wet.value=1,a.connect(n),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(t,n)},triggerRelease:(e,t)=>{a.triggerRelease(t)},releaseAll:()=>{try{a.triggerRelease()}catch{}},connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{a.dispose(),n.dispose()},applyConfig:e=>{const t=e||Sn,s=t.envelope;a.set({envelope:{attack:s.attack/1e3,decay:s.decay/1e3,sustain:s.sustain/100,release:s.release/1e3}}),n.bits=t.bitDepth},volume:a.volume}}const s=new X(Y,{oscillator:{type:n},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:this.getNormalizedVolume("ChipSynth",e.volume)}),r=new U(t.bitDepth);r.wet.value=1,s.connect(r);let i=null,o=null;a?.enabled&&(i=new ro({config:a,onNoteOn:(e,t,a)=>{o&&s.triggerRelease(o),s.triggerAttackRelease(e,a,void 0,t),o=e},onNoteOff:e=>{s.triggerRelease(e),o===e&&(o=null)}}));return{triggerAttackRelease:(e,t,n,r)=>{if(i&&a?.enabled){if(i.start(e,r??1),t&&"number"==typeof t){const a=(n??Z())+t;N().scheduleOnce(()=>{i.stop(e)},a)}}else s.triggerAttackRelease(e,t,n,r)},triggerAttack:(e,t,n)=>{i&&a?.enabled?i.start(e,n??1):s.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{i&&a?.enabled?i.stop(e):s.triggerRelease(e,t)},releaseAll:()=>{i&&i.stopAll(),s.releaseAll(),o=null},connect:e=>r.connect(e),disconnect:()=>r.disconnect(),dispose:()=>{i&&i.dispose(),s.dispose(),r.dispose()},applyConfig:e=>{const t=e||Sn,a=t.envelope;s.set({envelope:{attack:a.attack/1e3,decay:a.decay/1e3,sustain:a.sustain/100,release:a.release/1e3}}),r.bits=t.bitDepth},volume:s.volume,updateArpeggio:e=>{i&&e&&i.updateConfig(e)},getArpeggioEngine:()=>i,getCurrentArpeggioStep:()=>i?.getCurrentStep()??0,isArpeggioPlaying:()=>i?.getIsPlaying()??!1}}static createFurnace(e){if(!e.furnace)throw new Error("Furnace config required for Furnace synth type");return new bo(e.furnace)}static createBuzzmachine(e){const t=e.buzzmachine?.machineType||"ArguruDistortion",a=new Wl({ArguruDistortion:zl.ARGURU_DISTORTION,ElakDist2:zl.ELAK_DIST2,JeskolaDistortion:zl.JESKOLA_DISTORTION,GeonikOverdrive:zl.GEONIK_OVERDRIVE,GraueSoftSat:zl.GRAUE_SOFTSAT,WhiteNoiseStereoDist:zl.WHITENOISE_STEREODIST,ElakSVF:zl.ELAK_SVF,CyanPhaseNotch:zl.CYANPHASE_NOTCH,QZfilter:zl.Q_ZFILTER,FSMPhilta:zl.FSM_PHILTA,JeskolaDelay:zl.JESKOLA_DELAY,JeskolaCrossDelay:zl.JESKOLA_CROSSDELAY,JeskolaFreeverb:zl.JESKOLA_FREEVERB,FSMPanzerDelay:zl.FSM_PANZERDELAY,FSMChorus:zl.FSM_CHORUS,FSMChorus2:zl.FSM_CHORUS2,WhiteNoiseWhiteChorus:zl.WHITENOISE_WHITECHORUS,BigyoFrequencyShifter:zl.BIGYO_FREQUENCYSHIFTER,GeonikCompressor:zl.GEONIK_COMPRESSOR,LdSLimit:zl.LD_SLIMIT,OomekExciter:zl.OOMEK_EXCITER,OomekMasterizer:zl.OOMEK_MASTERIZER,DedaCodeStereoGain:zl.DEDACODE_STEREOGAIN,FSMKick:zl.FSM_KICK,FSMKickXP:zl.FSM_KICKXP,JeskolaTrilok:zl.JESKOLA_TRILOK,JeskolaNoise:zl.JESKOLA_NOISE,OomekAggressor:zl.OOMEK_AGGRESSOR,MadBrain4FM2F:zl.MADBRAIN_4FM2F,MadBrainDynamite6:zl.MADBRAIN_DYNAMITE6,MakkM3:zl.MAKK_M3,CyanPhaseDTMF:zl.CYANPHASE_DTMF,ElenzilFrequencyBomb:zl.ELENZIL_FREQUENCYBOMB}[t]??zl.ARGURU_DISTORTION),n=this.getNormalizedVolume("Buzzmachine",e.volume);return a.output.gain.value=re(n),a}static CHIP_DEFAULTS={0:{algorithm:4,feedback:5,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:8,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:12,d2r:0,sl:4,rr:6,dt:3,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:10,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!0,mult:4,tl:35,ar:28,dr:15,d2r:0,sl:5,rr:10,dt:-1,am:!1}]},1:{algorithm:5,feedback:6,operators:[{enabled:!0,mult:1,tl:15,ar:31,dr:5,d2r:0,sl:1,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:40,ar:31,dr:8,d2r:0,sl:3,rr:8,dt:2,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:4,rr:8,dt:-2,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:12,d2r:0,sl:5,rr:10,dt:0,am:!0}]},2:{algorithm:0,feedback:3,operators:[{enabled:!0,mult:2,tl:30,ar:15,dr:4,d2r:0,sl:8,rr:5,dt:0,ws:1,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:2,d2r:0,sl:4,rr:8,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,ws:0,am:!1}]},11:{algorithm:0,feedback:2,operators:[{enabled:!0,mult:4,tl:35,ar:15,dr:5,d2r:0,sl:6,rr:7,dt:0,am:!1},{enabled:!0,mult:1,tl:0,ar:15,dr:3,d2r:0,sl:3,rr:6,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:63,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},4:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},5:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:28,dr:2,d2r:0,sl:2,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},3:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},12:{algorithm:7,feedback:1,operators:[{enabled:!0,mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:50,ar:31,dr:8,d2r:0,sl:8,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},10:{algorithm:4,feedback:4,operators:[{enabled:!0,mult:1,tl:15,ar:25,dr:8,d2r:3,sl:5,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:6,rr:10,dt:1,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},6:{algorithm:6,feedback:2,operators:[{enabled:!0,mult:1,tl:12,ar:31,dr:5,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:8,d2r:0,sl:4,rr:10,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},9:{algorithm:5,feedback:0,operators:[{enabled:!0,mult:1,tl:5,ar:31,dr:3,d2r:0,sl:1,rr:10,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:6,d2r:0,sl:3,rr:12,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]},8:{algorithm:7,feedback:0,operators:[{enabled:!0,mult:1,tl:8,ar:31,dr:4,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]},15:{algorithm:7,feedback:7,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4,dt:0,am:!1},{enabled:!0,mult:5,tl:45,ar:31,dr:20,d2r:0,sl:10,rr:6,dt:2,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1},{enabled:!1,mult:1,tl:127,ar:0,dr:0,d2r:0,sl:0,rr:0,dt:0,am:!1}]}};static createFurnaceWithChip(e,t){const a=this.CHIP_DEFAULTS[t]||{algorithm:0,feedback:0,operators:[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:15,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:0,sl:4,rr:10,dt:0,am:!1}]},n={...e.furnace||{algorithm:a.algorithm??0,feedback:a.feedback??0,operators:a.operators||[],macros:[],opMacros:[],wavetables:a.wavetables||[]},chipType:t};return new bo(n)}static createPWMSynth(e){const t=e.pwmSynth||Mn,a=new X(Y,{oscillator:{type:"square"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("PWMSynth",e.volume)});a.maxPolyphony=32;const n=new h({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:-24}),s=new $({frequency:t.pwmRate,delayTime:2,depth:t.pwmDepth/100,wet:.6});return s.start(),a.connect(n),n.connect(s),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(e,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(e,t)},releaseAll:()=>a.releaseAll(),connect:e=>s.connect(e),disconnect:()=>s.disconnect(),dispose:()=>{a.dispose(),n.dispose(),s.dispose()},applyConfig:e=>{const t=e||Mn,r=t.envelope,i=t.filter;a.set({envelope:{attack:r.attack/1e3,decay:r.decay/1e3,sustain:r.sustain/100,release:r.release/1e3}}),n.set({type:i.type,frequency:i.cutoff,Q:i.resonance/10}),s.set({frequency:t.pwmRate,depth:t.pwmDepth/100})},volume:a.volume}}static createStringMachine(e){const t=e.stringMachine||Nn,a=new X(Y,{oscillator:{type:"sawtooth"},envelope:{attack:(t.attack||100)/1e3,decay:.2,sustain:.9,release:(t.release||500)/1e3},volume:this.getNormalizedVolume("StringMachine",e.volume)});a.maxPolyphony=32;const n=new $({frequency:t.ensemble.rate,delayTime:3.5,depth:t.ensemble.depth/100,wet:.8});n.start();const s=new h({type:"lowpass",frequency:2e3+80*t.brightness,Q:.5,rolloff:-12});return a.connect(s),s.connect(n),{triggerAttackRelease:(e,t,n,s)=>{a.triggerAttackRelease(e,t,n,s)},triggerAttack:(e,t,n)=>{a.triggerAttack(e,t,n)},triggerRelease:(e,t)=>{a.triggerRelease(e,t)},releaseAll:()=>a.releaseAll(),connect:e=>n.connect(e),disconnect:()=>n.disconnect(),dispose:()=>{a.dispose(),n.dispose(),s.dispose()},applyConfig:e=>{const t=e||Nn,r=t.ensemble;a.set({envelope:{attack:t.attack/1e3,release:t.release/1e3}}),n.set({frequency:r.rate,depth:r.depth/100}),s.frequency.rampTo(2e3+80*t.brightness,.1)},volume:a.volume}}static createFormantSynth(e){const t=e.formantSynth||_n,a=Cn[t.vowel]||Cn.A,n=new X(Y,{oscillator:{type:t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack||10)/1e3,decay:(t.envelope?.decay||200)/1e3,sustain:(t.envelope?.sustain??70)/100,release:(t.envelope?.release||300)/1e3},volume:this.getNormalizedVolume("FormantSynth",e.volume)});n.maxPolyphony=32;const s=new h({type:"bandpass",frequency:a.f1,Q:3}),r=new h({type:"bandpass",frequency:a.f2,Q:3}),i=new h({type:"bandpass",frequency:a.f3,Q:3}),o=new p(2);return n.connect(s),n.connect(r),n.connect(i),s.connect(o),r.connect(o),i.connect(o),{triggerAttackRelease:(e,t,a,s)=>{n.triggerAttackRelease(e,t,a,s)},triggerAttack:(e,t,a)=>{n.triggerAttack(e,t,a)},triggerRelease:(e,t)=>{n.triggerRelease(e,t)},releaseAll:()=>n.releaseAll(),connect:e=>o.connect(e),disconnect:()=>o.disconnect(),dispose:()=>{n.dispose(),s.dispose(),r.dispose(),i.dispose(),o.dispose()},applyConfig:e=>{const t=e||_n,a=t.envelope,o=Cn[t.vowel];n.set({envelope:{attack:a.attack/1e3,decay:a.decay/1e3,sustain:a.sustain/100,release:a.release/1e3}}),s.frequency.rampTo(o.f1,.1),r.frequency.rampTo(o.f2,.1),i.frequency.rampTo(o.f3,.1)},volume:n.volume}}static createWobbleBass(e){const t=e.wobbleBass||Pn,a=Math.max(1,t.unison.voices),n=t.unison.detune,s=new X(Y,{oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc1.level/100*6-6-6});s.maxPolyphony=32;const r=new X(Y,{oscillator:{type:t.osc2.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.osc2.level/100*6-6-6});r.maxPolyphony=32,s.set({detune:1200*t.osc1.octave+t.osc1.detune}),r.set({detune:1200*t.osc2.octave+t.osc2.detune});let i=null;t.sub.enabled&&(i=new X(Y,{oscillator:{type:"sine"},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:t.sub.level/100*12-12-6}),i.maxPolyphony=32,i.set({detune:1200*t.sub.octave}));const o=[],l=[];if(a>1)for(let p=1;p<Math.min(a,8);p++){const e=(p/a-.5)*n*2,s=(p/a-.5)*(t.unison.stereoSpread/50),r=new X(Y,{oscillator:{type:t.osc1.type},envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-12-1.5*a});r.maxPolyphony=32,r.set({detune:1200*t.osc1.octave+e});const i=new ue(s);r.connect(i),o.push(r),l.push(i)}let c=null;t.fm.enabled&&t.fm.amount>0&&(c=new X(O,{modulationIndex:t.fm.amount/10,harmonicity:t.fm.ratio,envelope:{attack:t.envelope.attack/1e3,decay:t.envelope.decay/1e3,sustain:t.envelope.sustain/100,release:t.envelope.release/1e3},volume:-6}),c.maxPolyphony=32,c.set({detune:1200*t.osc1.octave}));const u=new p(1),d=new h({type:t.filter.type,frequency:t.filter.cutoff,Q:t.filter.resonance/10,rolloff:t.filter.rolloff});let m=null;t.filter.drive>0&&(m=new b({distortion:t.filter.drive/100,oversample:"2x"}));const f=t.filterEnvelope.amount/100,y=t.filter.cutoff,g=4*Math.abs(f),x=new de({baseFrequency:y,octaves:g,attack:t.filterEnvelope.attack/1e3,decay:t.filterEnvelope.decay/1e3,sustain:t.filterEnvelope.sustain/100,release:t.filterEnvelope.release/1e3});(!t.wobbleLFO.enabled||t.filterEnvelope.amount>0)&&x.connect(d.frequency);let w=null;if(t.wobbleLFO.enabled){let e=t.wobbleLFO.rate;if("free"!==t.wobbleLFO.sync){e=(N().bpm.value||120)/60*(({"1/1":1,"1/2":2,"1/2T":3,"1/2D":1.5,"1/4":4,"1/4T":6,"1/4D":3,"1/8":8,"1/8T":12,"1/8D":6,"1/16":16,"1/16T":24,"1/16D":12,"1/32":32,"1/32T":48}[t.wobbleLFO.sync]||4)/4)}const a={sine:"sine",triangle:"triangle",saw:"sawtooth",square:"square",sample_hold:"square"},n=4*y,s=Math.max(20,.1*y),r=Math.min(2e4,y+n*(t.wobbleLFO.amount/100));w=new v({frequency:e,type:a[t.wobbleLFO.shape]||"sine",min:s,max:r,phase:t.wobbleLFO.phase}),w.connect(d.frequency),w.start()}let k=null;if(t.distortion.enabled)switch(t.distortion.type){case"soft":k=new b({distortion:t.distortion.drive/100,oversample:"2x"});break;case"hard":k=new z({order:Math.floor(1+t.distortion.drive/100*50)});break;case"fuzz":k=new b({distortion:.5+t.distortion.drive/200,oversample:"4x"});break;case"bitcrush":k=new U({bits:Math.max(2,12-Math.floor(t.distortion.drive/10))})}const S=new h({type:"lowpass",frequency:500+t.distortion.tone/100*15e3,Q:.5});let M=[],C=null;if(t.formant.enabled){const e=Cn[t.formant.vowel];M=[new h({type:"bandpass",frequency:e.f1,Q:5}),new h({type:"bandpass",frequency:e.f2,Q:5}),new h({type:"bandpass",frequency:e.f3,Q:5})],C=new p(.5)}const P=new p(1);P.gain.value=Math.pow(10,this.getNormalizedVolume("WobbleBass",e.volume)/20),s.connect(u),r.connect(u),i&&i.connect(u),c&&c.connect(u),l.forEach(e=>e.connect(u)),m?(u.connect(m),m.connect(d)):u.connect(d);let E=d;k&&(E.connect(k),E=k),E.connect(S),E=S,C&&M.length>0?(M.forEach(e=>{E.connect(e),e.connect(C)}),C.connect(P),E.connect(P)):E.connect(P);const _=new Set;return{triggerAttackRelease:(e,a,n,l)=>{const u=n??Z(),d=l??.8;t.wobbleLFO.retrigger&&w&&(w.phase=t.wobbleLFO.phase),x.triggerAttack(u),s.triggerAttackRelease(e,a,u,d),r.triggerAttackRelease(e,a,u,d),i&&i.triggerAttackRelease(e,a,u,d),c&&c.triggerAttackRelease(e,a,u,d),o.forEach(t=>t.triggerAttackRelease(e,a,u,.6*d))},triggerAttack:(e,a,n)=>{const l=a??Z(),u=n??.8;_.add(e),t.wobbleLFO.retrigger&&w&&(w.phase=t.wobbleLFO.phase),x.triggerAttack(l),s.triggerAttack(e,l,u),r.triggerAttack(e,l,u),i&&i.triggerAttack(e,l,u),c&&c.triggerAttack(e,l,u),o.forEach(t=>t.triggerAttack(e,l,.6*u))},triggerRelease:(e,t)=>{const a=t??Z();_.delete(e),x.triggerRelease(a),s.triggerRelease(e,a),r.triggerRelease(e,a),i&&i.triggerRelease(e,a),c&&c.triggerRelease(e,a),o.forEach(t=>t.triggerRelease(e,a))},releaseAll:()=>{s.releaseAll(),r.releaseAll(),i&&i.releaseAll(),c&&c.releaseAll(),o.forEach(e=>e.releaseAll()),_.clear()},connect:e=>P.connect(e),disconnect:()=>P.disconnect(),dispose:()=>{s.dispose(),r.dispose(),i&&i.dispose(),c&&c.dispose(),o.forEach(e=>e.dispose()),l.forEach(e=>e.dispose()),u.dispose(),d.dispose(),m&&m.dispose(),x.dispose(),w&&w.dispose(),k&&k.dispose(),S.dispose(),M.forEach(e=>e.dispose()),C&&C.dispose(),P.dispose()},applyConfig:e=>{const t=e||Pn,a=t.envelope||{},n=t.osc1||{},l=t.osc2||{},u=t.sub||{},p=t.filter||{},m=t.wobbleLFO||{},h={attack:(a.attack||10)/1e3,decay:(a.decay||200)/1e3,sustain:(a.sustain??70)/100,release:(a.release||300)/1e3};s.set({envelope:h}),r.set({envelope:h}),i&&i.set({envelope:h}),c&&c.set({envelope:h}),o.forEach(e=>e.set({envelope:h})),s.volume.rampTo(n.level/100*6-6-6,.1),r.volume.rampTo(l.level/100*6-6-6,.1),s.set({detune:1200*n.octave+n.detune}),r.set({detune:1200*l.octave+l.detune}),i&&(i.volume.rampTo(u.level/100*12-12-6,.1),i.set({detune:1200*u.octave})),d.set({type:p.type,frequency:Number(p.cutoff)||500,Q:Number(p.resonance)/10}),w&&w.frequency.rampTo(m.rate||1,.1)},volume:s.volume,wobbleLFO:w,filter:d}}static _reverseAudioBuffer(e){const t=k().rawContext.createBuffer(e.numberOfChannels,e.length,e.sampleRate);for(let a=0;a<e.numberOfChannels;a++){const n=e.getChannelData(a),s=t.getChannelData(a);for(let e=0;e<n.length;e++)s[e]=n[n.length-1-e]}return t}static createDrumKit(e){const t=e.drumKit||Dn;return new Bo(t)}static applyPitchEnvelope(e,t,a,n){const s=100*t.amount,r=t.sustain/100*s,i=t.attack/1e3,o=t.release/1e3,l=e;if(!l.set)return;l.set({detune:s});setTimeout(()=>{l.set&&l.set({detune:r})},1e3*(a+i-Z()));setTimeout(()=>{l.set&&l.set({detune:0})},1e3*(a+n-Z())+1e3*o)}static triggerPitchEnvelopeAttack(e,t,a){const n=100*t.amount,s=t.sustain/100*n,r=t.attack/1e3,i=t.decay/1e3,o=e;if(!o.set)return;o.set({detune:n});const l=Math.max(0,1e3*(a-Z()+r+i));setTimeout(()=>{o.set&&o.set({detune:s})},l)}static createDubSiren(e){const t=e.dubSiren||jn,a=new Wo(t);return a.volume.value=this.getNormalizedVolume("DubSiren",e.volume),a}static createSpaceLaser(e){const t=e.spaceLaser||Un,a=new Ho(t);return a.volume.value=this.getNormalizedVolume("SpaceLaser",e.volume),a}static createV2(e){if(e.v2Speech||"V2Speech"===e.synthType){const t=new Vl(e.v2Speech||void 0);return t.output.gain.value=re(this.getNormalizedVolume("V2",e.volume)),t}const t=new Ll(e.v2||void 0);return t.output.gain.value=re(this.getNormalizedVolume("V2",e.volume)),t}static createSam(e){const t=e.sam||Bn,a=new Bl(t);return a.output.gain.value=re(this.getNormalizedVolume("Sam",e.volume)),a}static createSynare(e){const t=e.synare||Gn,a=new Ko(t);return a.volume.value=this.getNormalizedVolume("Synare",e.volume),a}static createDexed(e){const t=e.dexed||{},a=new Oc(t);return a.output.gain.value=re(this.getNormalizedVolume("Dexed",e.volume)),a}static createOBXd(e){const t=e.obxd||{},a=new Pu(t);return a.output.gain.value=re(this.getNormalizedVolume("OBXd",e.volume)),a}static createCZ101(e){const t=new Ru;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("CZ101",e.volume)),t}static createCEM3394(e){const t=new $u;return t.output.gain.value=re(this.getNormalizedVolume("CEM3394",e.volume)),t}static createSCSP(e){const t=new Yu;return t.output.gain.value=re(this.getNormalizedVolume("SCSP",e.volume)),t}static createVFX(e){const t=new bd;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMEVFX",e.volume)),t}static createD50(e){const t=new wd;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMERSA",e.volume)),t}static createRdPiano(e){const t=e.rdpiano||{},a=new Fd(t);return a.output.gain.value=re(this.getNormalizedVolume("MAMERSA",e.volume)),a}static createMU2000(e){const t=new Vd;return t.init(),t.output.gain.value=re(this.getNormalizedVolume("MAMESWP30",e.volume)),t}static createBuzz3o3DF(e){const t=new Wl(zl.OOMEK_AGGRESSOR_DF);if(e.tb303){const a=e.tb303;if(t.setCutoff(a.filter.cutoff),t.setResonance(a.filter.resonance),t.setEnvMod(a.filterEnvelope.envMod),t.setDecay(a.filterEnvelope.decay),t.setAccentAmount(a.accent.amount),t.setWaveform(a.oscillator.type),void 0!==a.tuning&&t.setTuning(a.tuning),a.overdrive&&t.setOverdrive(a.overdrive.amount),a.devilFish){const e=a.devilFish;e.enabled&&t.enableDevilFish(!0,{overdrive:a.overdrive?.amount,muffler:e.muffler}),e.muffler&&t.setMuffler(e.muffler),e.highResonance&&t.setHighResonanceEnabled(e.highResonance),void 0!==e.filterTracking&&t.setFilterTracking(e.filterTracking),void 0!==e.normalDecay&&t.setNormalDecay(e.normalDecay),void 0!==e.accentDecay&&t.setAccentDecay(e.accentDecay),void 0!==e.vegDecay&&t.setVegDecay(e.vegDecay),void 0!==e.vegSustain&&t.setVegSustain(e.vegSustain),void 0!==e.softAttack&&t.setSoftAttack(e.softAttack),void 0!==e.sweepSpeed&&t.setSweepSpeed(e.sweepSpeed),void 0!==e.filterFmDepth&&t.setFilterFM(e.filterFmDepth)}const n=this.getNormalizedVolume("Buzz3o3DF",e.volume);t.setVolume(n)}return t}static applyChipParameters(e,t){const a=t.parameters;if(a){"number"==typeof a._program&&"function"==typeof e.loadPreset&&e.loadPreset(a._program);for(const[t,n]of Object.entries(a))"_program"!==t&&"number"==typeof n&&e.setParam(t,n)}}static createMAMEAICA(e){const t=new Ud;return t.output.gain.value=re(this.getNormalizedVolume("MAMEAICA",e.volume)),this.applyChipParameters(t,e),t}static createMAMEASC(e){const t=new Zd;return t.output.gain.value=re(this.getNormalizedVolume("MAMEASC",e.volume)),this.applyChipParameters(t,e),t}static createMAMEAstrocade(e){const t=new ip;return t.output.gain.value=re(this.getNormalizedVolume("MAMEAstrocade",e.volume)),this.applyChipParameters(t,e),t}static createMAMEC352(e){const t=new lp;return t.output.gain.value=re(this.getNormalizedVolume("MAMEC352",e.volume)),this.applyChipParameters(t,e),t}static createMAMEES5503(e){const t=new gp;return t.output.gain.value=re(this.getNormalizedVolume("MAMEES5503",e.volume)),this.applyChipParameters(t,e),t}static createMAMEICS2115(e){const t=new xp;return t.output.gain.value=re(this.getNormalizedVolume("MAMEICS2115",e.volume)),this.applyChipParameters(t,e),t}static createMAMEK054539(e){const t=new Sp;return t.output.gain.value=re(this.getNormalizedVolume("MAMEK054539",e.volume)),this.applyChipParameters(t,e),t}static createMAMEMEA8000(e){const t=new Hp;return t.output.gain.value=re(this.getNormalizedVolume("MAMEMEA8000",e.volume)),this.applyChipParameters(t,e),t}static createMAMERF5C400(e){const t=new $p;return t.output.gain.value=re(this.getNormalizedVolume("MAMERF5C400",e.volume)),this.applyChipParameters(t,e),t}static createMAMESN76477(e){const t=new lm;return t.output.gain.value=re(this.getNormalizedVolume("MAMESN76477",e.volume)),this.applyChipParameters(t,e),t}static createMAMESNKWave(e){const t=new mm;return t.output.gain.value=re(this.getNormalizedVolume("MAMESNKWave",e.volume)),this.applyChipParameters(t,e),t}static createMAMESP0250(e){const t=new km;return t.output.gain.value=re(this.getNormalizedVolume("MAMESP0250",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS36XX(e){const t=new _m;return t.output.gain.value=re(this.getNormalizedVolume("MAMETMS36XX",e.volume)),this.applyChipParameters(t,e),t}static createMAMETMS5220(e){const t=new bh;return t.output.gain.value=re(this.getNormalizedVolume("MAMETMS5220",e.volume)),this.applyChipParameters(t,e),t}static createMAMETR707(e){const t=new Ih;return t.output.gain.value=re(this.getNormalizedVolume("MAMETR707",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD931(e){const t=new Uh;return t.output.gain.value=re(this.getNormalizedVolume("MAMEUPD931",e.volume)),this.applyChipParameters(t,e),t}static createMAMEUPD933(e){const t=new ef;return t.output.gain.value=re(this.getNormalizedVolume("MAMEUPD933",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVotrax(e){const t=new ky;return t.output.gain.value=re(this.getNormalizedVolume("MAMEVotrax",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMF271(e){const t=new Ly;return t.output.gain.value=re(this.getNormalizedVolume("MAMEYMF271",e.volume)),this.applyChipParameters(t,e),t}static createMAMEYMOPQ(e){const t=new sg;return t.output.gain.value=re(this.getNormalizedVolume("MAMEYMOPQ",e.volume)),this.applyChipParameters(t,e),t}static createMAMEVASynth(e){const t=new mg;return t.output.gain.value=re(this.getNormalizedVolume("MAMEVASynth",e.volume)),this.applyChipParameters(t,e),t}static triggerPitchEnvelopeRelease(e,t,a){const n=t.release/1e3,s=e;if(!s.set)return;const r=Math.max(0,1e3*(a-Z()+n));setTimeout(()=>{s.set&&s.set({detune:0})},r)}}function Dg(e){const t={FurnaceOPN:0,FurnaceOPM:1,FurnaceOPL:2,FurnacePSG:3,FurnaceNES:4,FurnaceGB:5,FurnacePCE:6,FurnaceSCC:7,FurnaceN163:8,FurnaceVRC6:9,FurnaceC64:10,FurnaceOPLL:11,FurnaceAY:12,FurnaceOPNA:13,FurnaceOPNB:14,FurnaceTIA:15,FurnaceFDS:16,FurnaceMMC5:17,FurnaceSAA:18,FurnaceSWAN:19,FurnaceOKI:20,FurnaceES5506:21,FurnaceOPZ:22,FurnaceY8950:23,FurnaceSNES:24,FurnaceLYNX:25,FurnaceOPL4:26,FurnaceSEGAPCM:27,FurnaceYMZ280B:28,FurnaceRF5C68:29,FurnaceGA20:30,FurnaceC140:31,FurnaceQSOUND:32,FurnaceVIC:33,FurnaceTED:34,FurnaceSUPERVISION:35,FurnaceVERA:36,FurnaceSM8521:37,FurnaceBUBBLE:38,FurnaceK007232:39,FurnaceK053260:40,FurnaceX1_010:41,FurnaceUPD1771:42,FurnaceT6W28:43,FurnaceVB:44,FurnaceSID6581:45,FurnaceSID8580:46,FurnaceOPN2203:47,FurnaceOPNBB:48,FurnaceESFM:49,FurnaceAY8930:50,FurnaceNDS:51,FurnaceGBA:52,FurnacePOKEMINI:54,FurnaceNAMCO:55,FurnacePET:56,FurnacePOKEY:57,FurnaceMSM6258:58,FurnaceMSM5232:59,FurnaceMULTIPCM:60,FurnaceAMIGA:61,FurnacePCSPKR:62,FurnacePONG:63,FurnacePV1000:64,FurnaceDAVE:65,FurnaceSU:66,FurnacePOWERNOISE:68,FurnaceZXBEEPER:69,FurnaceSCVTONE:71,FurnacePCMDAC:72,Furnace:0}[e];if(void 0===t)return;const a={...An,chipType:t,operators:An.operators.map(e=>({...e}))};return"FurnaceC64"!==e&&"FurnaceSID6581"!==e&&"FurnaceSID8580"!==e||(a.c64={triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:12,r:6,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}),a}const Rg=[[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113],[850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113],[844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112],[838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111],[832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110],[826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109],[820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109],[814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108],[907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120],[900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119],[894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118],[887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118],[881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117],[875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116],[868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115],[862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114]];function jg(e,t=0){if(e>=36&&e<72&&Math.abs(t)<=8){const a=function(e){const t=Math.max(-8,Math.min(7,Math.round(e)));return t<0?t+16:t}(t);return Rg[a][e-36]}const a=e-48+t/128;return Math.round(428/Math.pow(2,a/12))}function Bg(e,t=0){if(e<=0)return-1;const a=3546895/e,n=48+12*Math.log2(a/8287.13);return Math.round(n)}class Lg extends d{name="AmigaFilter";hp_a1=0;hp_a2=0;lp1_a1=0;lp1_a2=0;lp2_a1=0;lp2_a2=0;lp2_b1=0;lp2_b2=0;_ledFilterEnabled=!0;_sampleRate;input;output;_worklet=null;_initialized=!1;_initializing=!1;_retryCount=0;static MAX_RETRIES=3;static _loadPromises=new WeakMap;constructor(){super(),this.input=new p,this.output=new p,this._sampleRate=k().sampleRate,this.setupCoefficients(),this.input.connect(this.output),this.tryInitWorklet()}async tryInitWorklet(){if(this._initialized||this._initializing)return;const e=k();if("running"!==e.state){const t=()=>{"running"===e.state&&this.initWorklet()};return e.on("statechange",t),void setTimeout(()=>{"running"!==e.state||this._initialized||this.initWorklet()},100)}await this.initWorklet()}async initWorklet(){if(!(this._initialized||this._initializing||this._retryCount>=Lg.MAX_RETRIES)){this._initializing=!0;try{const t=this.context,a=t.rawContext||t._context;if(!a||!a.audioWorklet)return void(this._initializing=!1);if("running"!==a.state)return void(this._initializing=!1);const n="/DEViLBOX/",s=`?v=${Date.now()}`;let r=Lg._loadPromises.get(a);r||(r=(async()=>{try{await a.audioWorklet.addModule(`${n}AmigaFilter.worklet.js${s}`)}catch(e){const t=e instanceof Error?e:null;if(!(t?.message?.includes("already")||t?.message?.includes("duplicate")))throw Lg._loadPromises.delete(a),e}})(),Lg._loadPromises.set(a,r)),await r;try{this._worklet=new AudioWorkletNode(a,"amiga-filter-processor")}catch(e){const t=e instanceof Error?e:null;if("InvalidStateError"===t?.name)return this._retryCount++,Lg._loadPromises.delete(a),this._initializing=!1,void(this._retryCount<Lg.MAX_RETRIES&&setTimeout(()=>this.initWorklet(),500));throw e}if(this._worklet&&this._worklet.port.postMessage({type:"INIT",coeffs:{hp:{a1:this.hp_a1,a2:this.hp_a2},lp1:{a1:this.lp1_a1,a2:this.lp1_a2},lp2:{a1:this.lp2_a1,a2:this.lp2_a2,b1:this.lp2_b1,b2:this.lp2_b2}}}),this._worklet){try{this.input.disconnect(this.output)}catch{}x(this.input,this._worklet),x(this._worklet,this.output),this._initialized=!0}else this._initializing=!1}catch(e){this._initializing=!1,this._retryCount++}}}setupCoefficients(){const e=this._sampleRate,t=Math.PI,a=2-Math.cos(2*t*5.128/e),n=a-Math.sqrt(a*a-1);this.hp_a1=1-n,this.hp_a2=n;const s=2-Math.cos(2*t*4420.971/e),r=s-Math.sqrt(s*s-1);this.lp1_a1=1-r,this.lp1_a2=r;const i=1/Math.tan(3090.533*t/e),o=1/.660225;this.lp2_a1=1/(1+o*i+i*i),this.lp2_a2=2*this.lp2_a1,this.lp2_b1=2*(1-i*i)*this.lp2_a1,this.lp2_b2=(1-o*i+i*i)*this.lp2_a1}get ledFilterEnabled(){return this._ledFilterEnabled}set ledFilterEnabled(e){this._ledFilterEnabled=e,this._worklet&&this._worklet.port.postMessage({type:"SET_LED",enabled:e})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this}}class Vg{points=[];enabled=!1;sustainPoint=null;loopStart=null;loopEnd=null;tick=0;isKeyOff=!1;currentValue=64;finished=!1;constructor(e){e&&this.init(e)}init(e){this.enabled=e.enabled,this.points=e.points,this.sustainPoint=e.sustainPoint,this.loopStart=e.loopStartPoint,this.loopEnd=e.loopEndPoint,this.reset()}reset(){this.tick=0,this.isKeyOff=!1,this.currentValue=this.points.length>0?this.points[0].value:64,this.finished=!1}keyOff(){this.isKeyOff=!0}tickNext(){if(!this.enabled||0===this.points.length)return 64;if(this.finished)return this.points[this.points.length-1].value;if(!this.isKeyOff&&null!==this.sustainPoint){const e=this.points[this.sustainPoint];if(this.tick>=e.tick)return this.tick=e.tick,this.currentValue=e.value,this.currentValue}if(null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd],t=this.points[this.loopStart];this.tick>=e.tick&&(this.tick=t.tick)}if(this.currentValue=this.interpolate(this.tick),this.tick++,null!==this.loopEnd&&null!==this.loopStart){const e=this.points[this.loopEnd];this.tick>=e.tick&&(this.tick=this.points[this.loopStart].tick)}return this.tick>this.points[this.points.length-1].tick&&(this.finished=!0,this.tick=this.points[this.points.length-1].tick),this.currentValue}interpolate(e){if(0===this.points.length)return 64;if(e<=this.points[0].tick)return this.points[0].value;if(e>=this.points[this.points.length-1].tick)return this.points[this.points.length-1].value;for(let t=0;t<this.points.length-1;t++){const a=this.points[t],n=this.points[t+1];if(e>=a.tick&&e<=n.tick){const t=n.tick-a.tick;if(0===t)return n.value;const s=(n.value-a.value<<16)/t,r=(e-a.tick)*s;return a.value+(r>>16)}}return 64}isEnabled(){return this.enabled}isFinished(){return this.finished}getCurrentValue(){return this.currentValue}}class zg{input;output;analyser;fft;disposed=!1;cachedWaveform=null;cachedFFT=null;constructor(){this.input=new p(1),this.output=new p(1),this.analyser=new pe("waveform",256),this.fft=new me(1024),this.input.connect(this.analyser),this.input.connect(this.fft),this.input.connect(this.output)}getWaveform(){if(this.disposed)return this.cachedWaveform||new Float32Array(256);const e=this.analyser.getValue();return this.cachedWaveform&&this.cachedWaveform.length===e.length||(this.cachedWaveform=new Float32Array(e.length)),this.cachedWaveform.set(e),this.cachedWaveform}getFFT(){if(this.disposed)return this.cachedFFT||new Float32Array(1024);const e=this.fft.getValue();return this.cachedFFT&&this.cachedFFT.length===e.length||(this.cachedFFT=new Float32Array(e.length)),this.cachedFFT.set(e),this.cachedFFT}getLevel(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let a=0;a<e.length;a++)t+=e[a]*e[a];return Math.sqrt(t/e.length)}getPeak(){if(this.disposed)return 0;const e=this.getWaveform();let t=0;for(let a=0;a<e.length;a++){const n=Math.abs(e[a]);n>t&&(t=n)}return t}hasActivity(){return this.getPeak()>.001}connectInstrument(e){if(!this.disposed)if(is(e)){const t=hs(this.input);t&&e.output.connect(t)}else e.connect(this.input)}disconnectInstrument(e){if(!this.disposed)try{is(e)?e.output.disconnect():e.disconnect(this.input)}catch{}}dispose(){if(!this.disposed){this.disposed=!0;try{this.input.disconnect(),this.analyser.disconnect(),this.fft.disconnect(),this.output.disconnect(),this.input.dispose(),this.output.dispose(),this.analyser.dispose(),this.fft.dispose()}catch{}this.cachedWaveform=null,this.cachedFFT=null}}}function Ug(e,t){let a;try{a=e()}catch(n){return}return{getItem:e=>{var t;const n=e=>null===e?null:JSON.parse(e,void 0),s=null!=(t=a.getItem(e))?t:null;return s instanceof Promise?s.then(n):n(s)},setItem:(e,t)=>a.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>a.removeItem(e)}}const Gg=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>Gg(e)(a),catch(e){return this}}}catch(a){return{then(e){return this},catch:e=>Gg(e)(a)}}},Wg=(e,t)=>(a,n,s)=>{let r={storage:Ug(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1,o=0;const l=new Set,c=new Set;let u=r.storage;if(!u)return e((...e)=>{a(...e)},n,s);const d=()=>{const e=r.partialize({...n()});return u.setItem(r.name,{state:e,version:r.version})},p=s.setState;s.setState=(e,t)=>(p(e,t),d());const m=e((...e)=>(a(...e),d()),n,s);let h;s.getInitialState=()=>m;const f=()=>{var e,t;if(!u)return;const s=++o;i=!1,l.forEach(e=>{var t;return e(null!=(t=n())?t:m)});const p=(null==(t=r.onRehydrateStorage)?void 0:t.call(r,null!=(e=n())?e:m))||void 0;return Gg(u.getItem.bind(u))(r.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===r.version)return[!1,e.state];if(r.migrate){const t=r.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}}return[!1,void 0]}).then(e=>{var t;if(s!==o)return;const[i,l]=e;return h=r.merge(l,null!=(t=n())?t:m),a(h,!0),i?d():void 0}).then(()=>{s===o&&(null==p||p(h,void 0),h=n(),i=!0,c.forEach(e=>e(h)))}).catch(e=>{s===o&&(null==p||p(void 0,e))})};return s.persist={setOptions:e=>{r={...r,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>f(),hasHydrated:()=>i,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},r.skipHydration||f(),h||m},Hg=n()(Wg(Ga(e=>({amigaLimits:!1,linearInterpolation:!0,masterTuning:440,performanceQuality:"high",audioLatency:"balanced",midiPolyphonic:!0,setAmigaLimits:t=>e(e=>{e.amigaLimits=t}),setLinearInterpolation:t=>e(e=>{e.linearInterpolation=t}),setMasterTuning:t=>e(e=>{e.masterTuning=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setAudioLatency:t=>e(e=>{e.audioLatency=t}),setMidiPolyphonic:t=>e(e=>{e.midiPolyphonic=t})})),{name:"devilbox-settings",partialize:e=>({amigaLimits:e.amigaLimits,linearInterpolation:e.linearInterpolation,masterTuning:e.masterTuning,performanceQuality:e.performanceQuality,audioLatency:e.audioLatency,midiPolyphonic:e.midiPolyphonic})})),Kg={MAMEAstrocade:{synthType:"MAMEAstrocade",name:"Astrocade",subtitle:"Bally Astrocade Custom I/O (1977)",color:"#a855f7",presetCount:8,presetNames:["Clean Square","Vibrato Square","Wide Vibrato","Fast Vibrato","Noise+Tone","Noise Modulated","Arcade Siren","Pure Noise"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vibrato_speed",label:"Vibrato Speed",group:"Vibrato",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Fastest"},{value:1,label:"Fast"},{value:2,label:"Slow"},{value:3,label:"Slowest"}]},{key:"vibrato_depth",label:"Vibrato Depth",group:"Vibrato",type:"knob",min:0,max:63,step:1,default:0,formatValue:"int"},{key:"noise_am",label:"Noise AM",group:"Noise",type:"toggle",min:0,max:1,default:0},{key:"noise_mod",label:"Noise Mod",group:"Noise",type:"toggle",min:0,max:1,default:0},{key:"noise_vol",label:"Noise Volume",group:"Noise",type:"knob",min:0,max:255,step:1,default:0,formatValue:"int"},{key:"master_freq",label:"Master Freq",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMESN76477:{synthType:"MAMESN76477",name:"SN76477",subtitle:"TI Complex Sound Generator (1978)",color:"#ef4444",presetCount:5,presetNames:["UFO","Laser","Explosion","Siren","Engine"],parameters:[{key:"vco_freq",label:"VCO Freq",group:"VCO",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"slf_freq",label:"SLF Freq",group:"SLF",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"noise_freq",label:"Noise Freq",group:"Noise",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"vco_duty_cycle",label:"VCO Duty",group:"VCO",type:"knob",min:.18,max:1,step:.01,default:.5,formatValue:"percent"},{key:"mixer_mode",label:"Mixer Mode",group:"Mixer",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"VCO"},{value:1,label:"SLF"},{value:2,label:"Noise"},{value:3,label:"VCO+Noise"},{value:4,label:"SLF+Noise"},{value:5,label:"SLF+VCO+Noise"},{value:6,label:"SLF+VCO"},{value:7,label:"Inhibit"}]},{key:"envelope_mode",label:"Envelope Mode",group:"Envelope",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"VCO"},{value:1,label:"One-Shot"},{value:2,label:"Mixer Only"},{value:3,label:"VCO Alt"}]},{key:"attack_time",label:"Attack",group:"Envelope",type:"knob",min:.001,max:10,step:.001,default:.1,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"decay_time",label:"Decay",group:"Envelope",type:"knob",min:.001,max:10,step:.001,default:.5,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"one_shot_time",label:"One-Shot",group:"Envelope",type:"knob",min:.001,max:10,step:.001,default:.2,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"noise_filter_freq",label:"Noise Filter",group:"Noise",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"amplitude",label:"Amplitude",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vco_mode",label:"VCO Mode",group:"VCO",type:"select",min:0,max:1,default:0,formatValue:"int",options:[{value:0,label:"External"},{value:1,label:"SLF Modulates"}]},{key:"enable",label:"Enable",group:"Output",type:"toggle",min:0,max:1,default:0}]},MAMEASC:{synthType:"MAMEASC",name:"ASC",subtitle:"Apple Sound Chip (1987)",color:"#10b981",presetCount:8,presetNames:["Sine Pad","Triangle Lead","Saw Bass","Square Retro","Pulse Nasal","Organ","Piano","Strings"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"waveform",label:"Waveform",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Noise"},{value:5,label:"Pulse 25%"},{value:6,label:"Organ"},{value:7,label:"Random"}]},{key:"attack",label:"Attack",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.01,formatValue:"percent"},{key:"decay",label:"Decay",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.3,formatValue:"percent"},{key:"sustain",label:"Sustain",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.7,formatValue:"percent"},{key:"release",label:"Release",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.3,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMEES5503:{synthType:"MAMEES5503",name:"ES5503",subtitle:"Ensoniq DOC 32-Voice Wavetable (1986)",color:"#3b82f6",presetCount:0,romConfig:{requiredZip:"es5503.zip (Ensoniq Mirage wavetable ROM)",bankCount:1,romType:"es5503"},parameters:[{key:"waveform",label:"Waveform",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Noise"},{value:5,label:"Pulse 25%"},{value:6,label:"Pulse 12%"},{value:7,label:"Organ"}]},{key:"wave_size",label:"Wave Size",group:"Oscillator",type:"select",min:0,max:7,default:2,formatValue:"int",options:[{value:0,label:"256"},{value:1,label:"512"},{value:2,label:"1024"},{value:3,label:"2048"},{value:4,label:"4096"},{value:5,label:"8192"},{value:6,label:"16384"},{value:7,label:"32768"}]},{key:"resolution",label:"Resolution",group:"Oscillator",type:"select",min:0,max:7,default:7,formatValue:"int",options:[{value:0,label:"Coarse"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"6"},{value:7,label:"Fine"}]},{key:"osc_mode",label:"Osc Mode",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Free Run"},{value:1,label:"One Shot"},{value:2,label:"Sync/AM"},{value:3,label:"Swap"}]},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"num_oscillators",label:"Oscillators",group:"Oscillator",type:"knob",min:1,max:32,step:1,default:8,formatValue:"int"},{key:"attack_time",label:"Attack",group:"Envelope",type:"knob",min:.001,max:5,step:.001,default:.01,unit:"s",formatValue:"seconds",logarithmic:!0},{key:"release_time",label:"Release",group:"Envelope",type:"knob",min:.001,max:5,step:.001,default:.3,unit:"s",formatValue:"seconds",logarithmic:!0}]},MAMEMEA8000:{synthType:"MAMEMEA8000",name:"MEA8000",subtitle:"Philips MEA8000 LPC Speech Synthesizer",color:"#f59e0b",presetCount:8,presetNames:["AH","EE","IH","OH","OO","AE","UH","ER"],parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"noise_mode",label:"Noise Mode",group:"Excitation",type:"toggle",min:0,max:1,default:0},{key:"f1_index",label:"F1 Index",group:"Formants",type:"knob",min:0,max:7,step:1,default:3,formatValue:"int"},{key:"f2_index",label:"F2 Index",group:"Formants",type:"knob",min:0,max:7,step:1,default:4,formatValue:"int"},{key:"f3_index",label:"F3 Index",group:"Formants",type:"knob",min:0,max:7,step:1,default:5,formatValue:"int"},{key:"bw_index",label:"Bandwidth",group:"Formants",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Wide (726Hz)"},{value:1,label:"Medium (309Hz)"},{value:2,label:"Narrow (125Hz)"},{value:3,label:"V.Narrow (50Hz)"}]},{key:"amplitude",label:"Amplitude",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"interp_time",label:"Interp Time",group:"Formants",type:"knob",min:.1,max:10,step:.1,default:1,unit:"s",formatValue:"seconds",logarithmic:!0}]},MAMEMSM5232:{synthType:"MAMEMSM5232",name:"MSM5232",subtitle:"OKI MSM5232 8-Voice Organ",color:"#8b5cf6",presetCount:8,presetNames:["Full Organ","Flute 8'","Principal 16'","Piccolo","Percussive","Strings","Noise Perc","Bass 16'"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"feet_mix",label:"Feet Mix",group:"Voicing",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"All Feet"},{value:1,label:"8'+16'"},{value:2,label:"8' Only"},{value:3,label:"16' Only"}]},{key:"attack_rate",label:"Attack Rate",group:"Envelope",type:"knob",min:0,max:7,step:1,default:4,formatValue:"int"},{key:"decay_rate",label:"Decay Rate",group:"Envelope",type:"knob",min:0,max:15,step:1,default:8,formatValue:"int"},{key:"noise_enable",label:"Noise",group:"Voicing",type:"toggle",min:0,max:1,default:0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"reverb",label:"Reverb",group:"Output",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"arm_mode",label:"ARM Mode",group:"Voicing",type:"toggle",min:0,max:1,default:0}]},MAMESNKWave:{synthType:"MAMESNKWave",name:"SNK Wave",subtitle:"SNK Programmable Waveform Generator",color:"#06b6d4",presetCount:8,presetNames:["Sine","Sawtooth","Square","Triangle","Pulse 25%","Organ","Buzz","Soft Bell"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"waveform",label:"Waveform",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Pulse 25%"},{value:5,label:"Organ"},{value:6,label:"Buzz"},{value:7,label:"Soft Bell"}]},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMESP0250:{synthType:"MAMESP0250",name:"SP0250",subtitle:"GI SP0250 Digital LPC Speech Synthesizer",color:"#f97316",presetCount:8,presetNames:["AH","EE","IH","OH","OO","NN","ZZ","HH"],parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vowel",label:"Vowel",group:"Formants",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"AH"},{value:1,label:"EE"},{value:2,label:"IH"},{value:3,label:"OH"},{value:4,label:"OO"},{value:5,label:"NN"},{value:6,label:"ZZ"},{value:7,label:"HH"}]},{key:"voiced",label:"Voiced",group:"Excitation",type:"toggle",min:0,max:1,default:1},{key:"brightness",label:"Brightness",group:"Formants",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"filter_mix",label:"Filter Mix",group:"Formants",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMETMS36XX:{synthType:"MAMETMS36XX",name:"TMS36XX",subtitle:"TI TMS36XX Tone Matrix Organ",color:"#84cc16",presetCount:8,presetNames:["Full Organ","Flute 8'","Principal","Mixture","Foundation","Bright","Diapason","Percussive"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"stop_enable",label:"Stop Enable",group:"Voicing",type:"knob",min:0,max:63,step:1,default:63,formatValue:"int"},{key:"decay_rate",label:"Decay Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"octave",label:"Octave",group:"Oscillator",type:"knob",min:-2,max:2,step:1,default:0,formatValue:"int",bipolar:!0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMEVotrax:{synthType:"MAMEVotrax",name:"Votrax SC-01",subtitle:"Votrax SC-01 Formant Speech (64 Phonemes)",color:"#ec4899",presetCount:8,presetNames:["AH","EE","OH","OO","SH","ZH","NG","PA"],parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"phoneme",label:"Phoneme",group:"Speech",type:"knob",min:0,max:63,step:1,default:0,formatValue:"int"},{key:"inflection",label:"Inflection",group:"Speech",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Normal"},{value:1,label:"Rising"},{value:2,label:"Falling"},{value:3,label:"Emphasis"}]},{key:"f1_override",label:"F1 Override",group:"Formants",type:"knob",min:-1,max:15,step:1,default:-1,formatValue:"int"},{key:"f2_override",label:"F2 Override",group:"Formants",type:"knob",min:-1,max:15,step:1,default:-1,formatValue:"int"},{key:"f3_override",label:"F3 Override",group:"Formants",type:"knob",min:-1,max:15,step:1,default:-1,formatValue:"int"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMEYMOPQ:{synthType:"MAMEYMOPQ",name:"YM3806 OPQ",subtitle:"Yamaha YM3806 4-Operator FM Synthesizer",color:"#3b82f6",presetCount:8,presetNames:["E.Piano","Brass","Strings","Bass","Organ","Lead","Pad","Bell"],operatorCount:4,parameters:[{key:"algorithm",label:"Algorithm",group:"FM",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Serial"},{value:1,label:"(1+2)->3->4"},{value:2,label:"(1+(2->3))->4"},{value:3,label:"((1->2)+3)->4"},{value:4,label:"Dual Serial"},{value:5,label:"Branching"},{value:6,label:"(1->2)+3+4"},{value:7,label:"All Carriers"}]},{key:"feedback",label:"Feedback",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_rate",label:"LFO Rate",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_pm_sens",label:"LFO PM Sens",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_am_sens",label:"LFO AM Sens",group:"LFO",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"},{key:"reverb",label:"Reverb",group:"Output",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}],operatorParams:[{key:"total_level",label:"Total Level",group:"Operator",type:"knob",min:0,max:127,step:1,default:0,formatValue:"int"},{key:"attack_rate",label:"Attack Rate",group:"Operator",type:"knob",min:0,max:31,step:1,default:31,formatValue:"int"},{key:"decay_rate",label:"Decay Rate",group:"Operator",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"sustain_rate",label:"Sustain Rate",group:"Operator",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"sustain_level",label:"Sustain Level",group:"Operator",type:"knob",min:0,max:15,step:1,default:0,formatValue:"int"},{key:"release_rate",label:"Release Rate",group:"Operator",type:"knob",min:0,max:15,step:1,default:7,formatValue:"int"},{key:"multiple",label:"Multiple",group:"Operator",type:"knob",min:0,max:15,step:1,default:1,formatValue:"int"},{key:"detune",label:"Detune",group:"Operator",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"waveform",label:"Waveform",group:"Operator",type:"select",min:0,max:1,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Half Sine"}]},{key:"ksr",label:"Key Scale Rate",group:"Operator",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"},{key:"am_enable",label:"AM Enable",group:"Operator",type:"toggle",min:0,max:1,default:0}]},MAMETIA:{synthType:"MAMETIA",name:"TIA",subtitle:"Atari 2600 Television Interface Adaptor",color:"#f59e0b",presetCount:8,presetNames:["Constant","Poly4 Buzz","Div31 Rumble","Poly5+4 Noise","Pure Square","Pure Alt","Div31 Bass","Engine Rumble"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"audc_mode",label:"AUDC Mode",group:"Oscillator",type:"knob",min:0,max:15,step:1,default:4,formatValue:"int"},{key:"audf_fine",label:"Freq Fine",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"detune",label:"Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"poly_reset",label:"Poly Reset",group:"Oscillator",type:"toggle",min:0,max:1,default:0}]},MAMEUPD931:{synthType:"MAMEUPD931",name:"uPD931",subtitle:"NEC uPD931 Casio Keyboard Voice (1981)",color:"#14b8a6",presetCount:8,presetNames:["Organ","Piano","Strings","Brass","Reed","Bell","Bass","Synth Lead"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"wave_a",label:"Wave A",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Pulse 25%"},{value:5,label:"Pulse 12%"},{value:6,label:"Organ"},{value:7,label:"Noise"}]},{key:"wave_b",label:"Wave B",group:"Oscillator",type:"select",min:0,max:7,default:1,formatValue:"int",options:[{value:0,label:"Sine"},{value:1,label:"Saw"},{value:2,label:"Square"},{value:3,label:"Triangle"},{value:4,label:"Pulse 25%"},{value:5,label:"Pulse 12%"},{value:6,label:"Organ"},{value:7,label:"Noise"}]},{key:"mirror",label:"Mirror",group:"Oscillator",type:"toggle",min:0,max:1,default:0},{key:"invert",label:"Invert",group:"Oscillator",type:"toggle",min:0,max:1,default:0},{key:"mode_a",label:"Mode A",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Always"},{value:1,label:"Alternating"},{value:2,label:"Attack Only"},{value:3,label:"Sustain Only"}]},{key:"mode_b",label:"Mode B",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Always"},{value:1,label:"Alternating"},{value:2,label:"Attack Only"},{value:3,label:"Sustain Only"}]},{key:"key_scaling",label:"Key Scaling",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},MAMEUPD933:{synthType:"MAMEUPD933",name:"uPD933",subtitle:"NEC uPD933 CZ Phase Distortion Synthesis",color:"#6366f1",presetCount:8,presetNames:["Brass","Strings","E.Piano","Bass","Organ","Pad","Lead","Bell"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"waveform1",label:"Waveform 1",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sawtooth"},{value:1,label:"Square"},{value:2,label:"Pulse"},{value:3,label:"Silent"},{value:4,label:"Double Sine"},{value:5,label:"Saw+Pulse"},{value:6,label:"Resonance"},{value:7,label:"Double Pulse"}]},{key:"waveform2",label:"Waveform 2",group:"Oscillator",type:"select",min:0,max:7,default:0,formatValue:"int",options:[{value:0,label:"Sawtooth"},{value:1,label:"Square"},{value:2,label:"Pulse"},{value:3,label:"Silent"},{value:4,label:"Double Sine"},{value:5,label:"Saw+Pulse"},{value:6,label:"Resonance"},{value:7,label:"Double Pulse"}]},{key:"window",label:"Window",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"None"},{value:1,label:"Half"},{value:2,label:"Rise"},{value:3,label:"Fall"}]},{key:"dcw_depth",label:"DCW Depth",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"dca_rate",label:"DCA Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"dcw_rate",label:"DCW Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"dco_rate",label:"DCO Rate",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"dco_depth",label:"DCO Depth",group:"Envelope",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"ring_mod",label:"Ring Mod",group:"Oscillator",type:"toggle",min:0,max:1,default:0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMETMS5220:{synthType:"MAMETMS5220",name:"TMS5220",subtitle:"TI TMS5220 LPC Speech (Speak & Spell)",color:"#d946ef",presetCount:8,presetNames:["AH","EE","IH","OH","OO","AE","UH","SH"],romConfig:{requiredZip:".vsm files (TI Speak & Spell speech ROM)",bankCount:2,romType:"tms5220"},parameters:[{key:"mode",label:"Mode",group:"Speech",type:"select",min:0,max:1,default:1,formatValue:"int",options:[{value:0,label:"Tone"},{value:1,label:"Speech"}]},{key:"sing_mode",label:"Sing Mode",group:"Speech",type:"toggle",min:0,max:1,default:1},{key:"speechText",label:"Speech Text",group:"Speech",type:"text",default:0,defaultText:"HELLO WORLD",placeholder:"Type text and press Speak"},{key:"vowelSequence",label:"Vowel Editor",group:"Speech",type:"vowelEditor",default:0},{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"chirp_type",label:"Chirp Type",group:"Excitation",type:"select",min:0,max:2,default:0,formatValue:"int",options:[{value:0,label:"TMS5220"},{value:1,label:"TMS5200"},{value:2,label:"TI99"}]},{key:"k1_index",label:"K1 Index",group:"Formants",type:"knob",min:0,max:31,step:1,default:15,formatValue:"int"},{key:"k2_index",label:"K2 Index",group:"Formants",type:"knob",min:0,max:31,step:1,default:15,formatValue:"int"},{key:"k3_index",label:"K3 Index",group:"Formants",type:"knob",min:0,max:31,step:1,default:15,formatValue:"int"},{key:"energy_index",label:"Energy",group:"Excitation",type:"knob",min:0,max:15,step:1,default:10,formatValue:"int"},{key:"pitch_index",label:"Pitch",group:"Excitation",type:"knob",min:0,max:63,step:1,default:32,formatValue:"int"},{key:"noise_mode",label:"Noise Mode",group:"Excitation",type:"toggle",min:0,max:1,default:0},{key:"stereo_width",label:"Stereo Width",group:"Output",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"brightness",label:"Brightness",group:"Formants",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMEYMF271:{synthType:"MAMEYMF271",name:"YMF271 OPX",subtitle:"Yamaha OPX 4-Operator FM+PCM Synthesizer",color:"#2563eb",presetCount:8,presetNames:["E.Piano","Brass","Strings","Bass","Organ","Lead","Pad","Bell"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"algorithm",label:"Algorithm",group:"FM",type:"knob",min:0,max:15,step:1,default:0,formatValue:"int"},{key:"feedback",label:"Feedback",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"waveform",label:"Waveform",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"tl",label:"Total Level",group:"Operator",type:"knob",min:0,max:127,step:1,default:0,formatValue:"int"},{key:"ar",label:"Attack Rate",group:"Envelope",type:"knob",min:0,max:31,step:1,default:31,formatValue:"int"},{key:"d1r",label:"Decay 1 Rate",group:"Envelope",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"d2r",label:"Decay 2 Rate",group:"Envelope",type:"knob",min:0,max:31,step:1,default:0,formatValue:"int"},{key:"rr",label:"Release Rate",group:"Envelope",type:"knob",min:0,max:15,step:1,default:7,formatValue:"int"},{key:"d1l",label:"Decay 1 Level",group:"Envelope",type:"knob",min:0,max:15,step:1,default:0,formatValue:"int"},{key:"multiple",label:"Multiple",group:"FM",type:"knob",min:0,max:15,step:1,default:1,formatValue:"int"},{key:"detune",label:"Detune",group:"FM",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_freq",label:"LFO Freq",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"lfo_wave",label:"LFO Wave",group:"LFO",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"},{key:"pms",label:"Pitch Mod Sens",group:"LFO",type:"knob",min:0,max:7,step:1,default:0,formatValue:"int"},{key:"ams",label:"Amp Mod Sens",group:"LFO",type:"knob",min:0,max:3,step:1,default:0,formatValue:"int"}]},MAMETR707:{synthType:"MAMETR707",name:"TR-707",subtitle:"Roland TR-707 Drum Machine (1984)",color:"#dc2626",presetCount:0,romConfig:{requiredZip:"tr707.zip (Roland TR-707 voice ROMs)",bankCount:3,romType:"tr707"},parameters:[{key:"volume",label:"Volume",group:"Master",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"bass",label:"Bass",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"snare",label:"Snare",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"low_tom",label:"Low Tom",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"mid_tom",label:"Mid Tom",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"hi_tom",label:"Hi Tom",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"rimshot",label:"Rimshot",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"handclap",label:"Handclap",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"hihat",label:"Hi-Hat",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"crash",label:"Crash",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"ride",label:"Ride",group:"Levels",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"accent",label:"Accent",group:"Master",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"decay",label:"Decay",group:"Master",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"}]},MAMEVASynth:{synthType:"MAMEVASynth",name:"VA Synth",subtitle:"Virtual Analog Subtractive Synthesizer",color:"#7c3aed",presetCount:8,presetNames:["Bass","Lead","Pad","Brass","Strings","Pluck","Keys","FX"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"osc1_wave",label:"Osc 1 Wave",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Saw"},{value:1,label:"Square"},{value:2,label:"Triangle"},{value:3,label:"Noise"}]},{key:"osc2_wave",label:"Osc 2 Wave",group:"Oscillator",type:"select",min:0,max:3,default:0,formatValue:"int",options:[{value:0,label:"Saw"},{value:1,label:"Square"},{value:2,label:"Triangle"},{value:3,label:"Noise"}]},{key:"osc_mix",label:"Osc Mix",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"osc2_detune",label:"Osc 2 Detune",group:"Oscillator",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"filter_cutoff",label:"Filter Cutoff",group:"Filter",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"filter_res",label:"Filter Res",group:"Filter",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"filter_env_depth",label:"Filter Env",group:"Filter",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"}]},CEM3394:{synthType:"CEM3394",name:"CEM3394",subtitle:"Curtis Electromusic Analog Synth Voice (1984)",color:"#f43f5e",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"vco_frequency",label:"VCO Freq",group:"VCO",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"modulation",label:"Modulation",group:"VCO",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"wave_select",label:"Wave Select",group:"VCO",type:"knob",min:0,max:7,step:1,default:2,formatValue:"int"},{key:"pulse_width",label:"Pulse Width",group:"VCO",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"mixer_balance",label:"Mixer Balance",group:"Mixer",type:"knob",min:0,max:1,step:.01,default:.5,formatValue:"percent"},{key:"resonance",label:"Resonance",group:"Filter",type:"knob",min:0,max:1,step:.01,default:0,formatValue:"percent"},{key:"cutoff",label:"Cutoff",group:"Filter",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},SCSP:{synthType:"SCSP",name:"SCSP",subtitle:"Sega Saturn YMF292-F Sound Processor",color:"#475569",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMEAICA:{synthType:"MAMEAICA",name:"AICA",subtitle:"Sega Dreamcast Sound Processor",color:"#0ea5e9",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMEICS2115:{synthType:"MAMEICS2115",name:"ICS2115",subtitle:"ICS WaveFront 32-Voice Synthesizer",color:"#64748b",presetCount:0,romConfig:{requiredZip:"ics2115.zip (ICS WaveFront wavetable ROM)",bankCount:1,romType:"ics2115"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"active_osc",label:"Active Voices",group:"Oscillator",type:"knob",min:1,max:32,step:1,default:8,formatValue:"int"}]},MAMEK054539:{synthType:"MAMEK054539",name:"K054539",subtitle:"Konami K054539 PCM/ADPCM (8-Channel)",color:"#78716c",presetCount:0,romConfig:{requiredZip:"k054539.zip (Konami PCM sample ROM)",bankCount:1,romType:"k054539"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"},{key:"reverb_enable",label:"Reverb",group:"Effects",type:"toggle",min:0,max:1,default:0}]},MAMEC352:{synthType:"MAMEC352",name:"C352",subtitle:"Namco C352 32-Voice PCM",color:"#94a3b8",presetCount:0,romConfig:{requiredZip:"c352.zip (Namco C352 sample ROM)",bankCount:1,romType:"c352"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMERF5C400:{synthType:"MAMERF5C400",name:"RF5C400",subtitle:"Ricoh RF5C400 32-Voice PCM",color:"#6b7280",presetCount:0,romConfig:{requiredZip:"rf5c400.zip (Ricoh RF5C400 sample ROM)",bankCount:1,romType:"rf5c400"},parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},CZ101:{synthType:"CZ101",name:"CZ-101",subtitle:"Casio Phase Distortion Synthesizer (1984)",color:"#8b5cf6",presetCount:4,presetNames:["Brass 1","E.Piano","Synth Bass","Pad"],parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}]},MAMERSA:{synthType:"MAMERSA",name:"Roland D-50",subtitle:"Roland SA Linear Arithmetic (requires ROM)",color:"#6b7280",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}],romConfig:{requiredZip:"mks20.zip (Roland D-50 / MKS-20 ROMs: IC5, IC6, IC7)",bankCount:3,romType:"rsa"}},MAMESWP30:{synthType:"MAMESWP30",name:"Yamaha MU-2000",subtitle:"SWP30 Wavetable (requires ROM)",color:"#6b7280",presetCount:0,parameters:[{key:"volume",label:"Volume",group:"Output",type:"knob",min:0,max:1,step:.01,default:.8,formatValue:"percent"}],romConfig:{requiredZip:"mu100.zip (Yamaha MU-100/MU-2000 wave ROM)",bankCount:1,romType:"swp30"}}};function qg(e){return e in Kg}function $g(e){return Kg[e]}const Xg=n(e=>({pendingRomRequest:null,showRomDialog:t=>{e({pendingRomRequest:t})},dismissRomDialog:()=>{e({pendingRomRequest:null})}}));class Yg{baseChannel;maxVoices;activeVoices=new Map;freeVoices=[];constructor(e,t){this.baseChannel=e,this.maxVoices=t,this.freeVoices=Array.from({length:t},(t,a)=>e+a)}allocate(e,t,a){if(this.freeVoices.length>0){const n=this.freeVoices.pop();return this.activeVoices.set(n,{channelIndex:n,note:e,instrumentId:t,startTime:Date.now(),velocity:a,priority:this.calculatePriority(a,!1),isReleasing:!1}),n}const n=this.findStealableVoice();this.activeVoices.get(n);return this.activeVoices.set(n,{channelIndex:n,note:e,instrumentId:t,startTime:Date.now(),velocity:a,priority:this.calculatePriority(a,!1),isReleasing:!1}),n}findStealableVoice(){let e=1/0,t=-1;for(const[a,n]of this.activeVoices)n.priority<e&&(e=n.priority,t=a);return t}calculatePriority(e,t){let a=e;return t&&(a-=50),Math.max(0,Math.min(100,a))}markReleasing(e){const t=this.activeVoices.get(e);t&&(t.isReleasing=!0,t.priority=this.calculatePriority(t.velocity,!0))}free(e){this.activeVoices.delete(e),this.freeVoices.push(e)}getVoiceState(e){return this.activeVoices.get(e)}getAllActiveVoices(){return Array.from(this.activeVoices.values())}getStats(){return{activeVoices:this.activeVoices.size,freeVoices:this.freeVoices.length,maxVoices:this.maxVoices,utilizationPercent:this.activeVoices.size/this.maxVoices*100}}reset(){this.activeVoices.clear(),this.freeVoices=Array.from({length:this.maxVoices},(e,t)=>this.baseChannel+t)}}class Zg{static instance=null;static itFilterWorkletLoaded=!1;static itFilterWorkletPromise=null;masterInput;synthBus;masterEffectsInput;masterChannel;analyser;fft;analysersConnected=!1;_nativeContext=null;wasmInstance=null;instruments;instrumentSynthTypes=new Map;instrumentLoadingPromises=new Map;decodedAudioBuffers=new Map;liveVoiceAllocation=new Map;voiceAllocator;static LIVE_VOICE_BASE_CHANNEL=100;static MAX_LIVE_VOICES=16;activeVoices=new Map;masterEffectsNodes=[];masterEffectConfigs=new Map;masterEffectsRebuildVersion=0;channelOutputs=new Map;channelMuteStates=new Map;channelPitchState=new Map;channelActivePlayer=new Map;channelLastNote=new Map;static SLIDE_TIME_CONSTANT=.06;static ACCENT_BOOST=1.35;static MIDI_FREQ_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=440*Math.pow(2,(t-69)/12);return e})();static FILTER_CUTOFF_LUT=(()=>{const e=new Float64Array(128);for(let t=0;t<128;t++)e[t]=100*Math.pow(100,t/127);return e})();static PITCH_CENTS_CACHE=new Map;metronomeSynth=null;metronomeVolume=null;metronomeEnabled=!1;metronomePart=null;amigaFilter;amigaFilterEnabled=!0;instrumentEffectChains=new Map;instrumentEffectNodes=new Map;instrumentAnalysers=new Map;releaseRestoreTimeouts=new Map;preloadGeneration=0;constructor(){var e;this._nativeContext=new AudioContext({sampleRate:44100,latencyHint:"interactive"}),he(this._nativeContext),e=this._nativeContext,cs=e,this.masterInput=new p(1),this.amigaFilter=new Lg,this.masterChannel=new fe({volume:-6,pan:0}).toDestination(),this.analyser=new pe("waveform",1024),this.fft=new me(1024),this.masterEffectsInput=new p(1),this.masterInput.connect(this.amigaFilter),this.amigaFilter.connect(this.masterEffectsInput),this.masterEffectsInput.connect(this.masterChannel),this.synthBus=new p(1),this.synthBus.connect(this.masterEffectsInput),this.instruments=new Map,this.voiceAllocator=new Yg(Zg.LIVE_VOICE_BASE_CHANNEL,Zg.MAX_LIVE_VOICES)}static getInstance(){return Zg.instance||(Zg.instance=new Zg,window._toneEngine=Zg.instance),Zg.instance}get nativeContext(){return this._nativeContext}connectNativeSynth(e,t){const a=hs(t);if(a){if(e.context!==a.context)return;try{e.connect(a)}catch(n){}}else{const a=t;if(a.input)try{e.connect(a.input)}catch(n){}}}async decodeAudioData(e){if(e instanceof AudioBuffer)return e;if(e instanceof Uint8Array){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return await k().rawContext.decodeAudioData(t)}if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer type: "+typeof e);return await k().rawContext.decodeAudioData(e.slice(0))}async encodeAudioData(e){return e.getChannelData(0).buffer.slice(0)}getDecodedBuffer(e){return this.decodedAudioBuffers.get(e)}getWasmInstance(){return this.wasmInstance}async init(){"suspended"===k().state&&await ye();const e=Hg.getState().audioLatency||"balanced";this.setAudioLatency(e),N().bpm.value=125;const t=this._nativeContext;"running"!==t.state&&await new Promise(e=>{const a=()=>{"running"===t.state?e():setTimeout(a,10)};a()});let a=null;const n=async()=>{if(a)return a;const e=await fetch("/DEViLBOX/DevilboxDSP.wasm");if(e.ok){a=await e.arrayBuffer();try{const e={env:{abort:()=>{}}},{instance:t}=await WebAssembly.instantiate(a,e);this.wasmInstance=t.exports,this.wasmInstance.init&&this.wasmInstance.init()}catch(t){}return a}return null};Zg.itFilterWorkletLoaded||(Zg.itFilterWorkletPromise||(Zg.itFilterWorkletPromise=(async()=>{try{const e="/DEViLBOX/";await t.audioWorklet.addModule(`${e}ITFilter.worklet.js`);const a=await n();if(a){const e=new AudioWorkletNode(t,"it-filter-processor");e.port.postMessage({type:"init",wasmBinary:a}),e.disconnect()}Zg.itFilterWorkletLoaded=!0}catch(e){const t=e instanceof Error?e.message:"";t.includes("already")||t.includes("duplicate")||(Zg.itFilterWorkletPromise=null)}})()),await Zg.itFilterWorkletPromise);try{const e=lo.getInstance();await e.init(k())}catch(s){}}getContextState(){return k().state}async preloadInstruments(e){const t=++this.preloadGeneration,a=e.map(e=>Tg.ensure(e.synthType)).filter(Boolean);if(a.length>0&&(await Promise.all(a),t!==this.preloadGeneration))return;e.forEach(e=>{const t=this.getInstrumentKey(e.id,-1);this.instruments.has(t)&&this.disposeInstrument(e.id)});const n=e.filter(e=>"Sampler"===e.synthType||"Player"===e.synthType),s=e.filter(e=>"Sam"===e.synthType||"V2"===e.synthType&&e.v2Speech);e.filter(e=>"Sampler"!==e.synthType&&"Player"!==e.synthType&&"Sam"!==e.synthType&&!("V2"===e.synthType&&e.v2Speech)).forEach(e=>{this.getInstrument(e.id,e)}),n.forEach(e=>{this.getInstrument(e.id,e)});const r=[];if(s.forEach(e=>{const t=this.getInstrument(e.id,e);t?.ready&&r.push(t.ready())}),n.length>0)try{if(await ge(),t!==this.preloadGeneration)return;const e=Array.from(this.instrumentLoadingPromises.values());if(e.length>0&&(await Promise.all(e),t!==this.preloadGeneration))return}catch(c){}if(r.length>0)try{if(await Promise.all(r),t!==this.preloadGeneration)return}catch(c){}const i=[];for(const u of e){const e=this.getInstrumentKey(u.id,-1),t=this.instruments.get(e);t&&"function"==typeof t.ensureInitialized&&i.push(t.ensureInitialized())}if(i.length>0)try{if(await Promise.all(i),t!==this.preloadGeneration)return}catch(c){}const o=["MetalSynth","MembraneSynth","NoiseSynth","FMSynth"];for(const u of e)if(o.includes(u.synthType||"")){const e=this.getInstrumentKey(u.id,-1),t=this.instruments.get(e);if(t&&!is(t))try{const e=t,a=e.volume.value;e.volume.value=-1/0,"NoiseSynth"===u.synthType||"MetalSynth"===u.synthType?t.triggerAttackRelease(.001,Z()):"MembraneSynth"===u.synthType?t.triggerAttackRelease("C2",.001,Z()):e.triggerAttackRelease?.("C4",.001,Z()),e.volume.value=a}catch{}}const l=e.filter(e=>{const t=Kg[e.synthType||""];return t?.romConfig});if(l.length>0){const{useInstrumentStore:e}=await ja(async()=>{const{useInstrumentStore:e}=await Promise.resolve().then(()=>Lv);return{useInstrumentStore:e}},void 0),t=e.getState();for(const a of l){const e=this.getInstrumentKey(a.id,-1),n=this.instruments.get(e),s=Kg[a.synthType||""];if(!n||!s?.romConfig)continue;const r=!0===n.romLoaded,i=t.instruments.find(e=>e.id===a.id);if(i&&t.updateInstrument(a.id,{parameters:{...i.parameters,_romsLoaded:r?1:0}}),!r){Xg.getState().showRomDialog({instrumentId:a.id,synthType:a.synthType||"",chipName:s.name,requiredZip:s.romConfig.requiredZip,bankCount:s.romConfig.bankCount});break}}}}async ensureWASMSynthsReady(e){const t=e.filter(e=>["TB303","Buzz3o3","V2","Sam","Synare","DubSiren","SpaceLaser","Dexed","OBXd"].includes(e.synthType||""));if(0===t.length)return;const a=[];for(const n of t){const e=this.getInstrument(n.id,n);e?.ensureInitialized&&a.push(e.ensureInitialized())}a.length>0&&await Promise.all(a)}setMasterVolume(e){this.masterChannel.volume.value=e}setMasterMute(e){this.masterChannel.mute=e}_currentLatency="";setAudioLatency(e){if(this._currentLatency===e)return;this._currentLatency=e;let t=.05;switch(e){case"interactive":t=.01;break;case"balanced":t=.05;break;case"playback":t=.15}k().lookAhead=t}setAmigaFilter(e){this.amigaFilterEnabled=e,this.amigaFilter.ledFilterEnabled=e}getAmigaFilterEnabled(){return this.amigaFilterEnabled}processInstrumentTicks(e=Z()){this.instruments.forEach(t=>{t&&"function"==typeof t.processTick&&t.processTick(e)})}setBPM(e){const t=N();"started"===t.state?t.bpm.rampTo(e,.02):t.bpm.value=e,this.updateBpmSyncedEffects(e)}getBPM(){return N().bpm.value}async start(){"suspended"===k().state&&await ye(),N().start()}stop(){this.releaseAll();const e=this.masterChannel.volume.value;this.masterChannel.volume.value=-1/0,setTimeout(()=>{this.masterChannel.volume.value=e},50),N().stop()}pause(){N().pause()}getPosition(){return N().position}setPosition(e){N().position=e}getInstrumentKey(e,t){return`${e}-${t??-1}`}lastTriggerTime=0;getSafeTime(e){if("running"!==be.state)return null;const t=null==e||isNaN(e)||e<=0?ve():Z();let a;return a=null!=e&&!isNaN(e)&&e>0?e:t+.001,a<=this.lastTriggerTime&&(a=this.lastTriggerTime+5e-4),this.lastTriggerTime=a,a}getImmediateTime(){let e=ve();return e<=this.lastTriggerTime&&(e=this.lastTriggerTime+1e-4),this.lastTriggerTime=e,e}getInstrument(e,t,a){const n=t.synthType?.startsWith("MAME")||"CZ101"===t.synthType||"CEM3394"===t.synthType||"SCSP"===t.synthType,s=t.synthType?.startsWith("Furnace")||"Furnace"===t.synthType,r=t.synthType?.startsWith("Buzz")||"Buzzmachine"===t.synthType,i=["TB303","V2","Sam","DubSiren","SpaceLaser","Synare","Dexed","OBXd","WAM"].includes(t.synthType||""),o=!i&&"string"==typeof t.synthType&&Eg.has(t.synthType),l="Sampler"===t.synthType||"Player"===t.synthType||n||s||r||i||o,c=l?this.getInstrumentKey(e,-1):this.getInstrumentKey(e,a);if(this.instruments.has(c)){const e=this.instruments.get(c),a=this.instrumentSynthTypes.get(c);if(!t.synthType||!a||a===t.synthType||"Player"===a)return e??null;this.disposeInstrumentByKey(c)}const u=void 0!==a&&a>=Zg.LIVE_VOICE_BASE_CHANNEL,d=this.getInstrumentKey(e,-1);if(!l&&!u&&this.instruments.has(d))return this.instruments.get(d)??null;let p=null;switch(t.synthType){case"Synth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new X({voice:Y,maxPolyphony:e,options:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break}case"MonoSynth":p=new Q({oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume||-12});break;case"DuoSynth":p=new J({voice0:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},voice1:{oscillator:{type:"noise"===t.oscillator?.type?"sawtooth":t.oscillator?.type||"sawtooth"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},vibratoAmount:t.oscillator?.detune?t.oscillator.detune/100:.5,vibratoRate:5,volume:t.volume||-12});break;case"FMSynth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?6:3;p=new X({voice:O,maxPolyphony:e,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},modulationIndex:10},volume:t.volume||-12});break}case"AMSynth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new X({voice:ee,maxPolyphony:e,options:{oscillator:{type:"noise"===t.oscillator?.type?"sine":t.oscillator?.type||"sine"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3}},volume:t.volume||-12});break}case"PluckSynth":{const e="high"===this.currentPerformanceQuality?16:"medium"===this.currentPerformanceQuality?8:4;p=new X({voice:te,maxPolyphony:e,options:{attackNoise:1,dampening:t.filter?.frequency||4e3,resonance:.7},volume:t.volume||-12});break}case"MetalSynth":p=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??100)/1e3,sustain:0,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"MembraneSynth":p=new Y({oscillator:{type:"sine"},envelope:{attack:(t.envelope?.attack??1)/1e3,decay:(t.envelope?.decay??400)/1e3,sustain:.01,release:(t.envelope?.release??100)/1e3},volume:t.volume||-12});break;case"NoiseSynth":{const e=new se({noise:{type:"white"},envelope:{attack:(t.envelope?.attack??10)/1e3,decay:(t.envelope?.decay??200)/1e3,sustain:(t.envelope?.sustain??50)/100,release:(t.envelope?.release??1e3)/1e3},volume:t.volume??-12});if(t.filter&&"lowpass"!==t.filter.type){const a=new h({type:t.filter.type,frequency:t.filter.frequency,Q:t.filter.Q||1,rolloff:t.filter.rolloff||-12});e.connect(a),p={triggerAttackRelease:(t,a,n)=>{e.triggerAttackRelease(t,a,n)},triggerAttack:(t,a,n)=>{e.triggerAttack(a,n)},triggerRelease:t=>{e.triggerRelease(t)},connect:e=>a.connect(e),disconnect:()=>a.disconnect(),dispose:()=>{e.dispose(),a.dispose()},volume:e.volume}}else p=e;break}case"TB303":case"SuperSaw":case"PolySynth":case"Organ":case"DrumMachine":case"ChipSynth":case"PWMSynth":case"StringMachine":case"FormantSynth":case"Wavetable":case"WobbleBass":case"Furnace":case"FurnaceOPN":case"FurnaceOPM":case"FurnaceOPL":case"FurnaceOPLL":case"FurnaceOPZ":case"FurnaceOPNA":case"FurnaceOPNB":case"FurnaceOPL4":case"FurnaceY8950":case"FurnaceESFM":case"FurnaceNES":case"FurnaceGB":case"FurnacePSG":case"FurnacePCE":case"FurnaceSNES":case"FurnaceVB":case"FurnaceLynx":case"FurnaceSWAN":case"FurnaceVRC6":case"FurnaceVRC7":case"FurnaceN163":case"FurnaceFDS":case"FurnaceMMC5":case"FurnaceC64":case"FurnaceSID6581":case"FurnaceSID8580":case"FurnaceAY":case"FurnaceVIC":case"FurnaceSAA":case"FurnaceTED":case"FurnaceVERA":case"FurnaceSEGAPCM":case"FurnaceQSOUND":case"FurnaceES5506":case"FurnaceRF5C68":case"FurnaceC140":case"FurnaceK007232":case"FurnaceK053260":case"FurnaceGA20":case"FurnaceOKI":case"FurnaceYMZ280B":case"FurnaceSCC":case"FurnaceX1_010":case"FurnaceBUBBLE":case"FurnaceTIA":case"FurnaceSM8521":case"FurnaceT6W28":case"FurnaceSUPERVISION":case"FurnaceUPD1771":case"FurnaceOPN2203":case"FurnaceOPNBB":case"FurnaceAY8930":case"FurnaceNDS":case"FurnaceGBA":case"FurnacePOKEMINI":case"FurnaceNAMCO":case"FurnacePET":case"FurnacePOKEY":case"FurnaceMSM6258":case"FurnaceMSM5232":case"FurnaceMULTIPCM":case"FurnaceAMIGA":case"FurnacePCSPKR":case"FurnacePONG":case"FurnacePV1000":case"FurnaceDAVE":case"FurnaceSU":case"FurnacePOWERNOISE":case"FurnaceZXBEEPER":case"FurnaceSCVTONE":case"FurnacePCMDAC":case"DrumKit":case"ChiptuneModule":case"Dexed":case"OBXd":case"MAMEVFX":case"MAMEDOC":case"MAMERSA":case"MAMESWP30":case"CZ101":case"CEM3394":case"SCSP":case"MAMEAICA":case"MAMEASC":case"MAMEAstrocade":case"MAMEC352":case"MAMEES5503":case"MAMEICS2115":case"MAMEK054539":case"MAMEMEA8000":case"MAMEMSM5232":case"MAMERF5C400":case"MAMESN76477":case"MAMESNKWave":case"MAMESP0250":case"MAMETIA":case"MAMETMS36XX":case"MAMETMS5220":case"MAMETR707":case"MAMEUPD931":case"MAMEUPD933":case"MAMEVotrax":case"MAMEYMF271":case"MAMEYMOPQ":case"MAMEVASynth":case"BuzzDTMF":case"BuzzFreqBomb":case"BuzzKick":case"BuzzKickXP":case"BuzzNoise":case"BuzzTrilok":case"Buzz4FM2F":case"BuzzDynamite6":case"BuzzM3":case"Buzz3o3":case"DubSiren":case"SpaceLaser":case"V2":case"V2Speech":case"Sam":case"Synare":case"WAM":case"Buzzmachine":p=Fg.createInstrument(t);break;case"Sampler":{let a=t.parameters?.sampleUrl||t.sample?.url;const n=t.sample?.baseNote||"C4",s=!0===t.sample?.loop,r=t.sample?.loopStart||0,i=t.sample?.loopEnd||0,o=t.sample?.audioBuffer;a&&a.startsWith("blob:")&&(a=void 0),a&&(a=Wa(a));const l=o instanceof ArrayBuffer||o instanceof Uint8Array||"string"==typeof o;if(o&&l){let a=o;if("string"==typeof o)try{const e=atob(o),t=new Uint8Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);a=t.buffer}catch{a=null}if(a){const o=t.metadata?.modPlayback?.usePeriodPlayback;if(o||s){p=new oe({loop:s,volume:t.volume||0}),this.instrumentSynthTypes.set(c,"Player");const n=a,o=p,l=(async()=>{try{const a=await this.decodeAudioData(n);if(o.buffer=new xe(a),s){const e=t.sample?.sampleRate||8363,n=a.duration;o.loopStart=Math.min(r/e,n-1e-4),o.loopEnd=Math.min(i/e,n),o.loopEnd<=o.loopStart&&(o.loopEnd=n)}this.decodedAudioBuffers.set(e,a)}catch(a){}})();this.instrumentLoadingPromises.set(c,l)}else{p=new ie({volume:t.volume||-12}),this.instrumentSynthTypes.set(c,"Sampler");const s=a,r=p,i=(async()=>{try{const t=await this.decodeAudioData(s),a=new xe(t);r.add(n,a),this.decodedAudioBuffers.set(e,t)}catch(t){}})();this.instrumentLoadingPromises.set(c,i)}}}if(!p&&a){const o=t.metadata?.modPlayback?.usePeriodPlayback;if(o||s){const n=new oe({url:a,loop:s,volume:t.volume||0,onload:()=>{if(s){const e=t.sample?.sampleRate||8363,a=n.buffer.get(),s=a?a.duration:0;s>0&&(n.loopStart=Math.min(r/e,s-1e-4),n.loopEnd=Math.min(i/e,s),n.loopEnd<=n.loopStart&&(n.loopEnd=s))}const a=n.buffer.get();a&&this.decodedAudioBuffers.set(e,a)},onerror:e=>{}});p=n,this.instrumentSynthTypes.set(c,"Player")}else{const e=t.sample?.multiMap||{};!t.sample?.multiMap&&a&&(e[n]=a),p=new ie({urls:e,volume:t.volume||-12,onerror:e=>{}}),this.instrumentSynthTypes.set(c,"Sampler")}}p||(p=new ie({volume:t.volume||-12}),this.instrumentSynthTypes.set(c,"EmptySampler"));break}case"Player":{const e=t.parameters?.sampleUrl;p=new oe(e?{url:e,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{volume:t.volume||-12});break}case"GranularSynth":{const e=t.granular?.sampleUrl||t.parameters?.sampleUrl,a=t.granular;p=new le(e?{url:e,grainSize:(a?.grainSize||100)/1e3,overlap:(a?.grainOverlap||50)/100,playbackRate:a?.playbackRate||1,detune:a?.detune||0,reverse:a?.reverse||!1,loop:!0,volume:t.volume||-12,onload:()=>{},onerror:e=>{}}:{grainSize:.1,overlap:.5,loop:!0,volume:t.volume||-12});break}default:if(Eg.has(t.synthType||"")||Tg.knows(t.synthType||"")){p=Fg.createInstrument(t);break}return go(t.synthType||"Unknown",`Unsupported synth type "${t.synthType}". This instrument cannot produce sound.`,{synthName:t.name,errorType:"init",debugData:{synthType:t.synthType,instrumentId:e}}),null}return p?(t.filter&&p.filter&&(p.filter.type=t.filter.type,p.filter.frequency.value=t.filter.frequency,p.filter.Q.value=t.filter.Q),this.instruments.set(c,p),this.instrumentSynthTypes.has(c)||this.instrumentSynthTypes.set(c,t.synthType),this.buildInstrumentEffectChain(c,t.effects||[],p).catch(e=>{}),p):null}getInstrumentAnalyser(e){let t=this.instrumentAnalysers.get(e);if(t)return t;t=new zg;let a=this.masterInput;for(const[n,s]of this.instruments)if(n.startsWith(`${e}-`)){is(s)&&(a=this.synthBus);break}t.output.connect(a);return this.instrumentEffectChains.forEach((a,n)=>{const[s]=String(n).split("-");if(s===String(e)){try{a.output.disconnect(this.masterInput)}catch{}try{a.output.disconnect(this.synthBus)}catch{}a.output.connect(t.input)}}),this.instrumentAnalysers.set(e,t),t}disposeInstrumentAnalyser(e){const t=this.instrumentAnalysers.get(e);if(!t)return;const a=this.getInstrumentKey(e,-1);let n=this.instruments.get(a);if(!n)for(const[s,r]of this.instruments)if(s.startsWith(`${e}-`)){n=r;break}if(n){const e=is(n);try{e?n.output.disconnect():n.disconnect()}catch{}const s=this.instrumentEffectChains.get(a),r=t=>{e?this.connectNativeSynth(n.output,t):n.connect(t)};if(s){s.effects.length>0?r(s.effects[0]):r(s.output);try{s.output.disconnect(t.input)}catch{}const a=e?this.synthBus:this.masterInput;s.output.connect(a)}else r(e?this.synthBus:this.masterInput)}t.dispose(),this.instrumentAnalysers.delete(e)}disposeAllInstrumentAnalysers(){this.instrumentAnalysers.forEach((e,t)=>{this.disposeInstrumentAnalyser(t)})}applyAutomation(e,t,a,n){const s=this.getInstrumentKey(e,n),r=this.instruments.get(s);if(!r){const n=this.instruments.get(this.getInstrumentKey(e,-1));if(!n)return;return void this.applyAutomationToInstrument(n,t,a)}this.applyAutomationToInstrument(r,t,a)}applyAutomationToInstrument(e,t,a){const n=this.getSafeTime();if(null!==n)try{if((e instanceof Cr||"BuzzmachineGenerator"===e.constructor.name)&&"function"==typeof e.set)return void e.set(t,a);const s=e;switch(t){case"cutoff":if(s.filter){const e=200*Math.pow(100,a);s.filter.frequency.setValueAtTime(e,n)}break;case"resonance":s.filter&&s.filter.Q.setValueAtTime(10*a,n);break;case"volume":{const t=40*a-40;if(is(e)){const a=Math.pow(10,t/20);e.output.gain.setValueAtTime(a,n)}else s.volume&&s.volume.setValueAtTime(t,n);break}case"pan":{const e=2*a-1;s.pan&&s.pan.setValueAtTime(e,n);break}case"distortion":case"delay":case"reverb":break;default:e instanceof gg?e.setParameter(t,a):"function"==typeof s.setParam&&s.setParam(t,a)}}catch(s){}}applySlideAndAccent(e,t,a,n,s,r,i,o){let l=n;if(s&&(l=Math.min(1,n*Zg.ACCENT_BOOST)),r&&void 0!==i){const n=this.channelLastNote.get(i);if(n&&n.frequency>0){let s=null;const r=e;if(r.oscillator?.frequency?s=r.oscillator.frequency:r.voice0?.oscillator?.frequency?s=r.voice0.oscillator.frequency:r.frequency&&(s=r.frequency),s)try{s.setValueAtTime(n.frequency,a),s.setTargetAtTime(t,a,Zg.SLIDE_TIME_CONSTANT)}catch{}}}return void 0!==i&&void 0!==o&&this.channelLastNote.set(i,{frequency:t,time:a,instrumentId:o}),l}triggerNoteAttack(e,t,a,n=1,s,r,i,o,l,c){const u=this.getInstrument(e,s,l);if(!u)return;if(!(u.triggerAttack||u.start))return;const d=s.isLive?this.getImmediateTime():this.getSafeTime(a);if(null!==d)try{const a=Tg.get(s.synthType);if(a?.onTriggerAttack){if(a.onTriggerAttack(u,t,d,n,{accent:i,slide:o,hammer:c,period:r,channelIndex:l,config:s}))return}if(u instanceof Cr)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,u.triggerAttack(t,d,n,i,o);else if(u instanceof Cr)"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,u.triggerAttack(t,d,n,i,o,c);else if("NoiseSynth"===s.synthType)u.triggerAttack(d,n);else if("Sampler"===s.synthType){const a=this.getInstrumentKey(e,void 0),i=this.instrumentSynthTypes.get(a);if("Player"===i){const e=u;if(!e.buffer||!e.buffer.loaded)return;const a=n>0?we(n):-1/0;if(e.volume.value=a,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let a=r;if(0!==t.finetune){const e=Bg(r,0);e>=0&&(a=jg(e,t.finetune))}const n=t.periodMultiplier/a,i=n/(s.sample?.sampleRate||8363);e.playbackRate=i}else{const a=s.sample?.baseNote||"C4",n=ce(a).toFrequency(),r=ce(t).toFrequency()/n;e.playbackRate=r}e.start(d)}else{if("EmptySampler"===i)return;const e=u;if(!e.loaded)return;try{e.triggerAttack(t,d,n)}catch{}}}else if("Player"===s.synthType||"GranularSynth"===s.synthType){const e=u;if(!e.buffer||!e.buffer.loaded)return;const a=n>0?we(n):-1/0;if(e.volume.value=a,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let a=r;if(0!==t.finetune){const e=Bg(r,0);e>=0&&(a=jg(e,t.finetune))}const n=t.periodMultiplier/a,i=n/(s.sample?.sampleRate||8363);e.playbackRate=i}else{const a=s.sample?.baseNote||"C4",n=ce(a).toFrequency(),r=ce(t).toFrequency()/n;e.playbackRate=r}e.start(d)}else if("NoiseSynth"===s.synthType){const e=u,t=i?Math.min(1,n*Zg.ACCENT_BOOST):n;e.triggerAttack(d,t)}else if("MetalSynth"===s.synthType){const e=u,t=i?Math.min(1,n*Zg.ACCENT_BOOST):n;e.triggerAttack(d,t)}else if("MembraneSynth"===s.synthType){const e=u,a=i?Math.min(1,n*Zg.ACCENT_BOOST):n;e.triggerAttack(t,d,a)}else if("BuzzmachineGenerator"===u.constructor.name)u.triggerAttack(t,d,n,i,o);else if(u instanceof gg)u.triggerAttack(t,d,n);else{if(u instanceof bo&&void 0!==l){const e=bo.getMaxChannels(u.getChipType());u.setChannelIndex(l%e)}const a=ce(t).toFrequency(),s=this.applySlideAndAccent(u,a,d,n,i,o,l,e);u.triggerAttack(t,d,s)}}catch(p){}}triggerNoteRelease(e,t,a,n,s){const r=this.getInstrument(e,n,s);if(!r||!r.triggerRelease)return;const i=n.isLive?this.getImmediateTime():this.getSafeTime(a);if(null!==i)try{const e=Tg.get(n.synthType);if(e?.onTriggerRelease){if(e.onTriggerRelease(r,t,i,{config:n}))return}if("Sampler"===n.synthType){const e=r;if(!e.loaded)return;return void e.triggerRelease(t,i)}if("Player"===n.synthType||"GranularSynth"===n.synthType){const e=r;return void("started"===e.state&&e.stop(i))}"NoiseSynth"===n.synthType||"MonoSynth"===n.synthType||"DuoSynth"===n.synthType||"MetalSynth"===n.synthType||"MembraneSynth"===n.synthType||"TB303"===n.synthType||"DubSiren"===n.synthType||"Synare"===n.synthType||"Furnace"===n.synthType||"BuzzKick"===n.synthType||"BuzzKickXP"===n.synthType||"BuzzNoise"===n.synthType||"BuzzTrilok"===n.synthType||"Buzz4FM2F"===n.synthType||"BuzzDynamite6"===n.synthType||"BuzzM3"===n.synthType||"Buzz3o3"===n.synthType||"SpaceLaser"===n.synthType||"Sam"===n.synthType||"V2"===n.synthType||"V2Speech"===n.synthType||"MAMEVFX"===n.synthType||"MAMEDOC"===n.synthType||"MAMERSA"===n.synthType||"MAMESWP30"===n.synthType||"CZ101"===n.synthType||"CEM3394"===n.synthType||"SCSP"===n.synthType||n.synthType.startsWith("MAME")?r.triggerRelease(i):r.triggerRelease(t,i)}catch(o){}}static NATIVE_POLY_TYPES=new Set(["Synth","FMSynth","AMSynth","PluckSynth","Sampler","SuperSaw","PolySynth","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth","Wavetable","WobbleBass"]);triggerPolyNoteAttack(e,t,a,n,s=!1,r=!1){const i=new Set(["MAMEMEA8000","MAMETMS5220","MAMESP0250","MAMEVotrax","Sam","V2Speech","MAMECM3394","MAMETMS36XX","MAMESN76477","MAMEUPD931","MAMEUPD933","MonoSynth","DuoSynth","TB303","Buzz3o3","DB303","DubSiren","SpaceLaser","Synare"]),o=!!n.synthType&&i.has(n.synthType);(!0===n.monophonic||o)&&(r||this.releaseAllPolyNotes(e,n));const l=n.synthType;if((!l||Zg.NATIVE_POLY_TYPES.has(l))&&!0!==n.monophonic){this.liveVoiceAllocation.set(t,-1);const i=n.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,i,a,n,void 0,s,r)}if("TB303"===l||"Buzz3o3"===l){r||this.releaseAllPolyNotes(e,n),this.liveVoiceAllocation.set(t,-1);const i=n.isLive?this.getImmediateTime():0;return void this.triggerNoteAttack(e,t,i,a,n,void 0,s,r)}this.liveVoiceAllocation.has(t)&&(r||this.triggerPolyNoteRelease(e,t,n));const c=this.voiceAllocator.allocate(t,e,a);this.liveVoiceAllocation.set(t,c);const u=this.getImmediateTime();this.triggerNoteAttack(e,t,u,a,n,void 0,s,r,c)}triggerPolyNoteRelease(e,t,a){const n=this.liveVoiceAllocation.get(t);if(void 0===n)return;this.liveVoiceAllocation.delete(t);const s=a.isLive?this.getImmediateTime():0;-1===n?this.triggerNoteRelease(e,t,s,a):(this.voiceAllocator.markReleasing(n),this.triggerNoteRelease(e,t,s,a,n),setTimeout(()=>{this.voiceAllocator.free(n)},100))}releaseAllPolyNotes(e,t){for(const[a,n]of this.liveVoiceAllocation.entries())-1===n?this.triggerNoteRelease(e,a,0,t):(this.triggerNoteRelease(e,a,0,t,n),this.voiceAllocator.free(n));this.liveVoiceAllocation.clear()}hasActivePolyNotes(){return this.liveVoiceAllocation.size>0}releaseNote(e,t,a,n){const s=this.getInstrumentKey(e,n);let r=this.instruments.get(s);if(r||(r=this.instruments.get(this.getInstrumentKey(e,-1))),!r)return;const i=this.getSafeTime(a);if(null===i)return;const o=this.instrumentSynthTypes.get(s)||this.instrumentSynthTypes.get(this.getInstrumentKey(e,-1));if("Sampler"===o){const e=r;if(e.loaded&&e.triggerRelease)try{e.triggerRelease(t,i)}catch{}return}if("Player"===o||"GranularSynth"===o){const e=r;if("started"===e.state)try{e.stop(i)}catch{}return}if(!r.triggerRelease)return;const l="MonoSynth"===o||"DuoSynth"===o||"MetalSynth"===o||"MembraneSynth"===o||"NoiseSynth"===o||"TB303"===o||"Buzz3o3"===o||"BuzzKick"===o||"BuzzKickXP"===o||"BuzzNoise"===o||"BuzzTrilok"===o||"Buzz4FM2F"===o||"BuzzDynamite6"===o||"BuzzM3"===o||"DubSiren"===o||"Synare"===o;try{l?r.triggerRelease(i):r.triggerRelease(t,i)}catch{try{r.triggerRelease(i)}catch{}}}triggerNote(e,t,a,n,s=1,r,i,o,l,c,u,d=0,p){const m=this.getSafeTime(n);if(null===m)return;const h=this.getInstrument(e,r,l);if(h){if(void 0!==l){let a,n=this.activeVoices.get(l)||[];if(0===d?(n.forEach(e=>{e.instrument!==h&&this.stopVoice(e,m)}),n=n.filter(e=>e.instrument===h)):n.forEach(e=>{2===d&&e.volumeEnv.keyOff(),3===d&&(e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024))}),"Sampler"===r.synthType||"Player"===r.synthType){const e=h;a=new oe(e.buffer),a.loop=e.loop,a.loopStart=e.loopStart,a.loopEnd=e.loopEnd}else a="Synth"===r.synthType?new Y(h.get()):h;const p=n.findIndex(e=>e.instrument===a);if(p>=0)n[p].note=t;else{const e=this.createVoice(l,a,t,r);is(a)||a.connect(e.nodes.gain),n.push(e)}this.activeVoices.set(l,n);try{if(a instanceof oe){const e=s>0?we(s):-1/0;if(a.volume.value=e,r.metadata?.modPlayback?.usePeriodPlayback&&c){const e=r.metadata.modPlayback.periodMultiplier/c,t=r.sample?.sampleRate||8363;a.playbackRate=e/t}else{const e=r.sample?.baseNote||"C4",n=ce(e).toFrequency(),s=ce(t).toFrequency()/n;a.playbackRate=s}const n=u?u/(a.buffer.sampleRate||44100):0;a.start(m,n)}else if(a.triggerAttack){if(is(a)){const e=a.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}if(a instanceof bo&&void 0!==l){const e=bo.getMaxChannels(a.getChipType());a.setChannelIndex(l%e)}if("NoiseSynth"===r.synthType||"MetalSynth"===r.synthType){const e=i?Math.min(1,s*Zg.ACCENT_BOOST):s;a.triggerAttack(m,e)}else if(a instanceof Cr)a.triggerAttack(t,m,s,i,o);else if(a instanceof Cr)a.triggerAttack(t,m,s,i,o);else{const n=ce(t).toFrequency(),r=this.applySlideAndAccent(a,n,m,s,i,o,l,e);a.triggerAttack(t,m,r)}}}catch(f){}return}if(is(h)){const e=h.output.gain;0===e.value&&(e.cancelScheduledValues(0),e.value=1)}try{if(h instanceof Cr)h.triggerAttackRelease(t,a,m,s,i,o);else if(h instanceof Cr)h.triggerAttackRelease(t,a,m,s,i,o,p);else if("NoiseSynth"===r.synthType)h.triggerAttackRelease(a,m,s);else if("MetalSynth"===r.synthType)h.triggerAttackRelease(a,m,s);else if("MembraneSynth"===r.synthType)h.triggerAttackRelease(t,a,m,s);else if("GranularSynth"===r.synthType){const e=h;if(e.buffer&&e.buffer.loaded){const n=s>0?we(s):-1/0;if(e.volume.value=n,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let a=c;if(0!==t.finetune){const e=Bg(c,0);e>=0&&(a=jg(e,t.finetune))}const n=t.periodMultiplier/a,s=n/(r.sample?.sampleRate||8363);e.playbackRate=s*(r.granular?.playbackRate||1)}else{const a=ce("C4").toFrequency(),n=ce(t).toFrequency()/a;e.playbackRate=n*(r.granular?.playbackRate||1)}e.start(m),e.stop(m+a)}}else if("Player"===r.synthType||"Sampler"===r.synthType&&r.sample?.loop||"Sampler"===r.synthType&&r.metadata?.modPlayback?.usePeriodPlayback){const e=h;if(e.buffer&&e.buffer.loaded){const n=i?Math.min(1,s*Zg.ACCENT_BOOST):s,o=n>0?we(n):-1/0;if(e.volume.value=o,r.metadata?.modPlayback?.usePeriodPlayback&&c){const t=r.metadata.modPlayback;let a=c;if(0!==t.finetune){const e=Bg(c,0);e>=0&&(a=jg(e,t.finetune))}const n=t.periodMultiplier/a,s=n/(r.sample?.sampleRate||8363);e.playbackRate=s}else if(r.metadata?.modPlayback?.usePeriodPlayback&&!c);else{const a=ce("C4").toFrequency(),n=ce(t).toFrequency()/a;e.playbackRate=n}const d=u&&u>0?u/(e.buffer?.sampleRate||k().sampleRate):0;if(e.loop){if(void 0!==l){const t=this.channelActivePlayer.get(l);t&&"started"===t.state&&t.stop(m),this.channelActivePlayer.set(l,e)}e.start(m,d)}else e.start(m,d),e.stop(m+a)}}else if("Sampler"!==r.synthType||r.sample?.loop){if("SuperSaw"===r.synthType||"PolySynth"===r.synthType||"Organ"===r.synthType||"ChipSynth"===r.synthType||"PWMSynth"===r.synthType||"StringMachine"===r.synthType||"FormantSynth"===r.synthType){if(h.triggerAttackRelease){const n=ce(t).toFrequency(),r=this.applySlideAndAccent(h,n,m,s,i,o,l,e);h.triggerAttackRelease(t,a,m,r)}}else if(h instanceof gg)h.triggerAttackRelease(t,a,m,s);else if("DrumMachine"===r.synthType){if(h.triggerAttackRelease){const e=i?Math.min(1,s*Zg.ACCENT_BOOST):s;h.triggerAttackRelease(t,a,m,e)}}else if(h.triggerAttackRelease){const n=ce(t).toFrequency(),r=this.applySlideAndAccent(h,n,m,s,i,o,l,e);h.triggerAttackRelease(t,a,m,r)}}else{const e=h;if(e.loaded)if(u&&u>0){const n=r.sample?.baseNote||"C4",i=e,o=i._buffers?.get?.(n)||i._buffers?._buffers?.[n];if(o&&o.duration){const i=256*u/(o.sampleRate||k().sampleRate),l=Math.min(i,o.duration-.001);try{const e=new oe({url:o,volume:we(s)+(r.volume||-12)}).toDestination(),i=ce(n).toFrequency(),c=ce(t).toFrequency()/i;e.playbackRate=c,e.start(m,l),e.stop(m+a),N().scheduleOnce(()=>{e.dispose()},m+a+.1)}catch(f){e.triggerAttackRelease(t,a,m,s)}}else e.triggerAttackRelease(t,a,m,s)}else e.triggerAttackRelease(t,a,m,s)}}catch(y){}}}schedulePatternEvents(e){N().cancel(),e.forEach(e=>{N().schedule(t=>{this.triggerNote(e.instrumentId,e.note,e.duration,t,e.velocity,e.config)},e.time)})}clearSchedule(){N().cancel()}releaseAll(){const e=Z();this.instruments.forEach((t,a)=>{try{t instanceof oe||t instanceof le?"started"===t.state&&t.stop(e):t instanceof Cr?t.releaseAll():t.releaseAll?t.releaseAll(e):is(t)&&t.triggerRelease&&(t.triggerRelease(void 0,e),"function"==typeof t.stopSpeaking&&t.stopSpeaking());const n=t;if(n.volume&&"function"==typeof n.volume.rampTo){const t=n.volume.value;n.volume.rampTo(-1/0,.05,e);const s=this.releaseRestoreTimeouts.get(a);s&&clearTimeout(s);const r=setTimeout(()=>{this.releaseRestoreTimeouts.delete(a);try{n.volume&&(n.volume.value=t)}catch{}},100);this.releaseRestoreTimeouts.set(a,r)}else if(is(t)){const n=t.output.gain,s=this.releaseRestoreTimeouts.get(a);s&&clearTimeout(s),n.cancelScheduledValues(e),n.setValueAtTime(n.value||1,e),n.linearRampToValueAtTime(0,e+.05);const r=setTimeout(()=>{this.releaseRestoreTimeouts.delete(a);try{n.cancelScheduledValues(0),n.value=1}catch{}},100);this.releaseRestoreTimeouts.set(a,r)}}catch(n){}}),this.channelPitchState.clear(),this.channelActivePlayer.clear()}disposeInstrumentByKey(e){const t=this.instruments.get(e);if(t){this.instruments.delete(e),this.instrumentSynthTypes.delete(e),this.instrumentLoadingPromises.delete(e);try{t.disposed||(t.releaseAll?t.releaseAll():t.triggerRelease&&t.triggerRelease())}catch{}this.disposeInstrumentEffectChain(e);try{t.disposed||t.dispose()}catch{}}}disposeInstrument(e){const t=[];this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&t.push(n)}),t.forEach(e=>{this.disposeInstrumentByKey(e)})}disposeAllInstruments(){Array.from(this.instruments.keys()).forEach(e=>{this.disposeInstrumentByKey(e)}),this.instrumentSynthTypes.clear(),this.instrumentLoadingPromises.clear(),this.decodedAudioBuffers.clear(),this.activeVoices.clear(),this.channelLastNote.clear()}invalidateInstrument(e){this.disposeInstrument(e)}updateInstrument(e,t){this.disposeInstrument(e),this.getInstrument(e,t)}async previewSlice(e,t,a){await ye();const n=(await ja(()=>Promise.resolve().then(()=>Lv),void 0).then(e=>e.useInstrumentStore.getState())).instruments.find(t=>t.id===e),s=n?.sample?.audioBuffer,r=n?.sample?.url;if(s||r)try{let e;if(s)e=await this.decodeAudioData(s);else{const t=await fetch(r),a=await t.arrayBuffer();e=await this.decodeAudioData(a)}const n=e.sampleRate,i=a-t;if(i<=0)return;const o=be.createBuffer(e.numberOfChannels,i,n);for(let a=0;a<e.numberOfChannels;a++){const n=e.getChannelData(a),s=o.getChannelData(a);for(let e=0;e<i;e++)s[e]=n[t+e]}const l=new oe(o).toDestination();l.start();setTimeout(()=>{try{l.stop(),l.dispose()}catch{}},i/n*1e3+100)}catch(i){}}async bakeInstrument(e,t=2,a="C4"){return await ke(async()=>{const t=Fg.createInstrument(e);if(e.effects&&e.effects.length>0){const a=await Fg.createEffectChain(e.effects);let n;if(is(t)){const e=new p(1),a=hs(e);a&&t.output.connect(a),n=e}else n=t;let s=n;for(const e of a)s.connect(e),s=e;s.toDestination()}else if(is(t)){const e=new p(1),a=hs(e);a&&t.output.connect(a),e.toDestination()}else t.toDestination();t.triggerAttack&&(t.triggerAttack(a,0),t.triggerRelease&&t.triggerRelease(1))},t)}updateWAMParameters(e,t){const a=[];this.instruments.forEach((t,n)=>{const[s]=n.split("-");s===String(e)&&t instanceof gg&&a.push(t)}),0!==a.length?a.forEach(e=>{t.parameterValues&&Object.entries(t.parameterValues).forEach(([t,a])=>{e.setParameter(t,a)}),t.pluginState&&e.setPluginState(t.pluginState)}):this.invalidateInstrument(e)}updateTB303Parameters(e,t){const a=[];this.instruments.forEach((t,n)=>{const[s]=n.split("-");s===String(e)&&t instanceof Cr&&a.push(t)}),0!==a.length?a.forEach(e=>e.applyConfig(t)):this.invalidateInstrument(e)}updateFurnaceInstrument(e,t){if(!t.furnace||!t.synthType?.startsWith("Furnace"))return;const a=[];this.instruments.forEach((t,n)=>{const[s]=n.split("-");s===String(e)&&t.uploadInstrumentData&&a.push(t)}),0!==a.length?ja(async()=>{const{updateFurnaceInstrument:e}=await Promise.resolve().then(()=>Io);return{updateFurnaceInstrument:e}},void 0).then(({updateFurnaceInstrument:e})=>{const n=t.furnace.furnaceIndex??0,s=e(t.furnace,t.name,n);a.forEach(e=>{e.uploadInstrumentData(s)})}).catch(e=>{}):this.invalidateInstrument(e)}updateHarmonicSynthParameters(e,t){const a=[];this.instruments.forEach((t,n)=>{const[s]=n.split("-");s===String(e)&&t.applyConfig&&a.push(t)}),0!==a.length?a.forEach(e=>e.applyConfig(t)):this.invalidateInstrument(e)}getMAMESynthHandle(e){const t=this.getInstrumentKey(e,-1),a=this.instruments.get(t);return a instanceof Or?a.getHandle():0}getMAMEChipSynth(e){const t=this.getInstrumentKey(e,-1),a=this.instruments.get(t);if(a instanceof $r)return a;for(const[n,s]of this.instruments)if(n.startsWith(`${e}-`)&&s instanceof $r)return s;return null}updateMAMEParameters(e,t){const a=this.getInstrumentKey(e,-1);this.instruments.get(a)}updateMAMEChipParam(e,t,a){const n=this.getInstrumentKey(e,-1),s=this.instruments.get(n);if(!s)return;const r=s;"function"==typeof r.setParam&&r.setParam(t,a)}loadMAMEChipPreset(e,t){const a=this.getInstrumentKey(e,-1),n=this.instruments.get(a);if(!n)return;const s=n;"function"==typeof s.loadPreset&&s.loadPreset(t)}updateMAMEChipTextParam(e,t,a){const n=this.getInstrumentKey(e,-1),s=this.instruments.get(n);if(!s)return;const r=s;"function"==typeof r.setTextParam?r.setTextParam(t,a):"function"==typeof r.applyConfig&&r.applyConfig({[t]:a})}async speakMAMEChipText(e,t){const a=this.getInstrumentKey(e,-1);let n=this.instruments.get(a);if(!n)try{const{useInstrumentStore:t}=await ja(async()=>{const{useInstrumentStore:e}=await Promise.resolve().then(()=>Lv);return{useInstrumentStore:e}},void 0),a=t.getState().instruments.find(t=>t.id===e);a&&(n=this.getInstrument(e,a)??void 0,n&&"function"==typeof n.ensureInitialized&&await n.ensureInitialized(),await new Promise(e=>setTimeout(e,50)))}catch(r){}if(!n)return;const s=n;"function"==typeof s.speakText&&s.speakText(t)}loadSynthROM(e,t,a,n){const s=this.getInstrumentKey(e,-1),r=this.instruments.get(s);if(!r)return;const i=r;"MAMERSA"===t?"function"==typeof i.loadROM&&i.loadROM(a,n):"MAMESWP30"===t?"function"==typeof i.loadWaveROM&&i.loadWaveROM(n.buffer):"function"==typeof i.loadROM?i.loadROM(a,n):"function"==typeof i.setRom&&i.setRom(a,n)}updateDubSirenParameters(e,t){let a=!1;this.instruments.forEach((n,s)=>{const[r]=s.split("-");r===String(e)&&n&&"function"==typeof n.applyConfig&&(n.applyConfig(t),a=!0)})}updateSpaceLaserParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateV2Parameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");if(s===String(e)&&a&&"V2Synth"===a.name){const e=a;t.osc1&&(e.setParameter(2,t.osc1.mode),e.setParameter(4,t.osc1.transpose+64),e.setParameter(5,t.osc1.detune+64),e.setParameter(6,t.osc1.color),e.setParameter(7,t.osc1.level)),t.osc2&&(e.setParameter(8,t.osc2.mode),e.setParameter(9,t.osc2.ringMod?1:0),e.setParameter(10,t.osc2.transpose+64),e.setParameter(11,t.osc2.detune+64),e.setParameter(12,t.osc2.color),e.setParameter(13,t.osc2.level)),t.osc3&&(e.setParameter(14,t.osc3.mode),e.setParameter(15,t.osc3.ringMod?1:0),e.setParameter(16,t.osc3.transpose+64),e.setParameter(17,t.osc3.detune+64),e.setParameter(18,t.osc3.color),e.setParameter(19,t.osc3.level)),t.filter1&&(e.setParameter(20,t.filter1.mode),e.setParameter(21,t.filter1.cutoff),e.setParameter(22,t.filter1.resonance)),t.filter2&&(e.setParameter(23,t.filter2.mode),e.setParameter(24,t.filter2.cutoff),e.setParameter(25,t.filter2.resonance)),t.routing&&(e.setParameter(26,t.routing.mode),e.setParameter(27,t.routing.balance)),t.envelope&&(e.setParameter(32,t.envelope.attack),e.setParameter(33,t.envelope.decay),e.setParameter(34,t.envelope.sustain),e.setParameter(36,t.envelope.release)),t.envelope2&&(e.setParameter(38,t.envelope2.attack),e.setParameter(39,t.envelope2.decay),e.setParameter(40,t.envelope2.sustain),e.setParameter(42,t.envelope2.release)),t.lfo1&&(e.setParameter(47,t.lfo1.rate),e.setParameter(50,t.lfo1.depth))}})}updateSynareParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateFurnaceParameters(e,t){this.instruments.forEach((t,a)=>{const[n]=a.split("-");n===String(e)&&t&&"function"==typeof t.updateParameters&&t.updateParameters()})}applyFurnaceEffect(e,t,a,n=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,i]of this.instruments){const[s]=r.split("-");if(s===String(e)){if(i instanceof jo)return i.applyEffect(t,a,n),!0;if(i instanceof bo)return this.applyFurnaceSynthEffect(i,t,a),!0}}return!1}applyFurnaceExtendedEffect(e,t,a,n=0){const s=this.instrumentSynthTypes.get(String(e));if(!s||!s.startsWith("Furnace"))return!1;for(const[r,i]of this.instruments){const[s]=r.split("-");if(s===String(e)&&i instanceof jo)return i.applyExtendedEffect(t,a,n),!0}return!1}applyFurnaceSynthEffect(e,t,a){const n=a>>4&15,s=15&a,r=e.getChipType();8!==t?this.isFMChip(r)?this.applyFMEffect(e,t,a,n,s):this.isPSGChip(r)?this.applyPSGEffect(e,t,a,r):this.isWavetableChip(r)?this.applyWavetableEffect(e,t,a,r):this.isC64Chip(r)&&this.applyC64Effect(e,t,a):e.writePanRegister(a)}isFMChip(e){return[io.OPN2,io.OPM,io.OPL3,io.OPLL,io.OPNA,io.OPNB,io.OPZ,io.Y8950,io.OPL4,io.OPN,io.OPNB_B,io.ESFM].includes(e)}isPSGChip(e){return[io.NES,io.GB,io.PSG,io.AY,io.AY8930,io.SAA,io.VIC,io.TED].includes(e)}isWavetableChip(e){return[io.PCE,io.SCC,io.SWAN,io.N163,io.NAMCO,io.FDS,io.BUBBLE,io.X1_010,io.SM8521].includes(e)}isC64Chip(e){return[io.SID,io.SID_6581,io.SID_8580].includes(e)}applyFMEffect(e,t,a,n,s){switch(t){case 17:e.writeOperatorTL(n,8*s);break;case 18:e.writeOperatorAR(n,2*s);break;case 19:e.writeOperatorDR(n,2*s);break;case 20:e.writeOperatorMult(n,s);break;case 21:e.writeOperatorRR(n,s);break;case 22:e.writeOperatorSL(n,s)}}applyPSGEffect(e,t,a,n){switch(n){case io.GB:17===t?e.writeWavetableSelect(a):18===t&&e.writeDutyRegister(3&a);break;case io.NES:18===t&&e.writeDutyRegister(a>>6&3)}}applyWavetableEffect(e,t,a,n){switch(n){case io.PCE:18===t&&e.writeWavetableSelect(a);break;case io.SCC:case io.N163:case io.NAMCO:16===t&&e.writeWavetableSelect(a);break;case io.FDS:break;case io.SWAN:case io.SM8521:case io.BUBBLE:case io.X1_010:16!==t&&17!==t||e.writeWavetableSelect(a)}}applyC64Effect(e,t,a){16!==t&&18!==t||e.writeDutyRegister(a)}updateDexedParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateOBXdParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateComplexSynthParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");s===String(e)&&a&&"function"==typeof a.applyConfig&&a.applyConfig(t)})}updateToneJsSynthInPlace(e,t){const a=Zg.EFFECT_RAMP_TIME;this.instruments.forEach((n,s)=>{const[r]=s.split("-");if(r!==String(e))return;const i=n;if(t.oscillator?.type&&i.oscillator)try{const e="noise"===t.oscillator.type?"sawtooth":t.oscillator.type;i.oscillator.type=e}catch{}if(n instanceof X&&t.oscillator?.type)try{const e="noise"===t.oscillator.type?"sawtooth":t.oscillator.type;n.set({oscillator:{type:e}})}catch{}if(t.envelope){const e=t.envelope;try{n instanceof X?n.set({envelope:{attack:(e.attack??10)/1e3,decay:(e.decay??200)/1e3,sustain:(e.sustain??50)/100,release:(e.release??1e3)/1e3}}):i.envelope&&(i.envelope.attack=(e.attack??10)/1e3,i.envelope.decay=(e.decay??200)/1e3,i.envelope.sustain=(e.sustain??50)/100,i.envelope.release=(e.release??1e3)/1e3)}catch{}}if(t.filter&&i.filter)try{void 0!==t.filter.frequency&&i.filter.frequency.rampTo(t.filter.frequency,a),void 0!==t.filter.Q&&i.filter.Q.rampTo(t.filter.Q,a),t.filter.type&&(i.filter.type=t.filter.type)}catch{}if(void 0!==t.volume&&i.volume)try{i.volume.rampTo(t.volume,a)}catch{}})}updateBuzzmachineParameters(e,t){this.instruments.forEach((a,n)=>{const[s]=n.split("-");if(s===String(e)){const e=a;a&&"function"==typeof e.setParameter&&Object.entries(t.parameters).forEach(([t,a])=>{e.setParameter(Number(t),a)})}})}async updateTB303Pedalboard(e,t){if(!t)return;const a=[];if(this.instruments.forEach((t,n)=>{n.startsWith(`${e}-`)&&t instanceof Cr&&a.push(t)}),0===a.length)return;const n=t.enabled&&t.chain.some(e=>e.enabled&&"neural"===e.type);for(const r of a)if(n){const e=t.chain.find(e=>e.enabled&&"neural"===e.type);if(e&&void 0!==e.neuralModelIndex)try{await r.loadGuitarMLModel(e.neuralModelIndex),await r.setGuitarMLEnabled(!0),void 0!==e.parameters?.dryWet&&r.setGuitarMLMix(e.parameters.dryWet)}catch(s){}}else try{await r.setGuitarMLEnabled(!1)}catch(s){}}updateChipSynthArpeggio(e,t){t&&this.instruments.forEach((a,n)=>{n.startsWith(`${e}-`)&&a.updateArpeggio&&a.updateArpeggio(t)})}getChipSynthArpeggioStep(e){for(const[t,a]of this.instruments.entries())if(t.startsWith(`${e}-`)&&a.getCurrentArpeggioStep)return a.getCurrentArpeggioStep();return 0}isChipSynthArpeggioPlaying(e){for(const[t,a]of this.instruments.entries())if(t.startsWith(`${e}-`)&&a.isArpeggioPlaying)return a.isArpeggioPlaying();return!1}initMetronome(){this.metronomeSynth||(this.metronomeSynth=new ne({pitchDecay:.008,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.1,sustain:0,release:.1}}),this.metronomeVolume=new p(.5),this.metronomeSynth.connect(this.metronomeVolume),this.metronomeVolume.connect(this.masterChannel))}setMetronomeEnabled(e){this.metronomeEnabled=e,e&&this.initMetronome()}isMetronomeEnabled(){return this.metronomeEnabled}setMetronomeVolume(e){this.metronomeVolume||this.initMetronome();const t=Math.max(0,Math.min(1,e/100));this.metronomeVolume?.set({gain:t})}triggerMetronomeClick(e,t=!1){if(!this.metronomeEnabled||!this.metronomeSynth)return;const a=t?"C5":"C4",n=t?.8:.5;this.metronomeSynth.triggerAttackRelease(a,"32n",e,n)}stopMetronome(){this.metronomePart&&(this.metronomePart.stop(),this.metronomePart.dispose(),this.metronomePart=null)}disposeMetronome(){this.stopMetronome(),this.metronomeSynth&&(this.metronomeSynth.dispose(),this.metronomeSynth=null),this.metronomeVolume&&(this.metronomeVolume.dispose(),this.metronomeVolume=null)}dispose(){this.stop(),this.clearSchedule(),this.disposeMetronome(),this.disposeAllInstrumentAnalysers(),this.instrumentEffectChains.forEach((e,t)=>{e.effects.forEach(e=>{try{e.dispose()}catch(t){}});try{e.output.dispose()}catch(a){}}),this.instrumentEffectChains.clear(),this.instrumentEffectNodes.clear(),this.instruments.forEach((e,t)=>{try{e.dispose()}catch(a){}}),this.instruments.clear(),this.disposeChannelOutputs(),this.masterEffectsNodes.forEach(e=>{try{e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear(),this.analyser.dispose(),this.fft.dispose(),this.amigaFilter.dispose(),this.synthBus.dispose(),this.masterEffectsInput.dispose(),this.masterInput.dispose(),this.masterChannel.dispose(),Zg.instance=null}async buildInstrumentEffectChain(e,t,a){const n=this.instrumentEffectChains.get(e);if(n){for(const[e,t]of this.instrumentEffectNodes)n.effects.includes(t.node)&&this.instrumentEffectNodes.delete(e);if(n.effects.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),n.bridge)try{n.bridge.disconnect(),n.bridge.dispose()}catch{}n.output.disconnect(),n.output.dispose()}const s=new p(1),r=is(a),i=e=>{r?this.connectNativeSynth(a.output,e):a.connect(e)},o=t.filter(e=>e.enabled);if(0===o.length){i(s);const[t]=String(e).split("-"),a=parseInt(t),n=this.instrumentAnalysers.get(a);return n?s.connect(n.input):s.connect(r?this.synthBus:this.masterInput),void this.instrumentEffectChains.set(e,{effects:[],output:s})}const l=await Promise.all(o.map(e=>Fg.createEffect(e)));let c;if(l.length>0){r?(c=new p(1),i(c),c.connect(l[0])):a.connect(l[0]);for(let e=0;e<l.length-1;e++)l[e].connect(l[e+1]);l[l.length-1].connect(s)}else i(s);const[u]=String(e).split("-"),d=parseInt(u),m=this.instrumentAnalysers.get(d);m?s.connect(m.input):s.connect(r?this.synthBus:this.masterInput),this.instrumentEffectChains.set(e,{effects:l,output:s,bridge:c}),o.forEach((e,t)=>{this.instrumentEffectNodes.set(e.id,{node:l[t],config:e})})}async rebuildInstrumentEffects(e,t){const a=this.getInstrumentKey(e,-1),n=this.instruments.get(a);if(n){try{is(n)?n.output.disconnect():n.disconnect()}catch{}await this.buildInstrumentEffectChain(a,t,n)}}throwInstrumentToEffect(e,t,a=1,n=0){const s=[];this.instrumentEffectChains.forEach((t,a)=>{const[n]=String(a).split("-");n===String(e)&&s.push(t)}),0!==s.length&&s.forEach(e=>{const s=e.effects.find(e=>e._fxType===t);if(s&&"wet"in s){const e=s.wet,t=ve();e.cancelScheduledValues(t),e.rampTo(a,.01,t),n>0&&e.rampTo(0,.1,t+n/1e3)}})}disposeInstrumentEffectChain(e){const t=this.instrumentEffectChains.get(e);if(t){t.effects.forEach(e=>{try{e.dispose()}catch{}});try{t.output.dispose()}catch{}this.instrumentEffectChains.delete(e)}}async rebuildMasterEffects(e){if(this.canUseParameterUpdatePath(e))return void this.updateEffectParameters(e);const t=++this.masterEffectsRebuildVersion,a=structuredClone(e);this.masterEffectsInput.disconnect(),this.masterEffectsNodes.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}}),this.masterEffectsNodes=[],this.masterEffectConfigs.clear();const n=a.filter(e=>e.enabled);if(0===n.length)return void this.masterEffectsInput.connect(this.masterChannel);if("suspended"===k().state)try{await ye()}catch{}if(t!==this.masterEffectsRebuildVersion)return;const s=[],r=[];for(const o of n)try{const e=await Fg.createEffect(o);if(t!==this.masterEffectsRebuildVersion){try{e.disconnect(),e.dispose()}catch{}return void s.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}})}s.push(e),r.push(o)}catch(i){}if(t===this.masterEffectsRebuildVersion)if(0!==s.length){s.forEach((e,t)=>{this.masterEffectsNodes.push(e),this.masterEffectConfigs.set(r[t].id,{node:e,config:r[t]})}),this.masterEffectsInput.connect(this.masterEffectsNodes[0]);for(let e=0;e<this.masterEffectsNodes.length-1;e++)this.masterEffectsNodes[e].connect(this.masterEffectsNodes[e+1]);this.masterEffectsNodes[this.masterEffectsNodes.length-1].connect(this.masterChannel)}else this.masterEffectsInput.connect(this.masterChannel);else s.forEach(e=>{try{e.disconnect(),e.dispose()}catch{}})}canUseParameterUpdatePath(e){const t=e.filter(e=>e.enabled),a=Array.from(this.masterEffectConfigs.keys());if(t.length!==a.length)return!1;for(let n=0;n<t.length;n++){if(t[n].id!==a[n])return!1;const e=this.masterEffectConfigs.get(a[n]);if(!e)return!1;if(t[n].type!==e.config.type)return!1}return!0}updateEffectParameters(e){const t=e.filter(e=>e.enabled);for(const a of t){const e=this.masterEffectConfigs.get(a.id);e&&(Object.entries(a.parameters||{}).forEach(([t,a])=>{if(t in e.node){const n=e.node;void 0!==n[t]?.value?n[t].value=a:n[t]=a}}),"wet"in e.node&&(e.node.wet.value=a.enabled?1:0),e.config=a)}}getMasterEffectNode(e){return this.masterEffectConfigs.get(e)?.node??null}updateMasterEffectParams(e,t){const a=this.masterEffectConfigs.get(e);if(!a)return;const{node:n,config:s}=a;try{if(t.wet!==s.wet){const e=t.wet/100;"wet"in n&&n.wet instanceof A?n.wet.rampTo(e,.02):"wet"in n&&"number"==typeof n.wet&&(n.wet=e)}const e={};for(const[a,n]of Object.entries(t.parameters))s.parameters[a]!==n&&(e[a]=n);Object.keys(e).length>0&&this.applyEffectParametersDiff(n,t.type,e),a.config=t}catch(r){}}updateInstrumentEffectParams(e,t){const a=this.instrumentEffectNodes.get(e);if(!a)return;const{node:n,config:s}=a;try{if(t.wet!==s.wet){const e=t.wet/100;"wet"in n&&n.wet instanceof A?n.wet.rampTo(e,.02):"wet"in n&&"number"==typeof n.wet&&(n.wet=e)}const e={};for(const[a,n]of Object.entries(t.parameters))s.parameters[a]!==n&&(e[a]=n);Object.keys(e).length>0&&this.applyEffectParametersDiff(n,t.type,e),a.config=t}catch(r){}}static EFFECT_RAMP_TIME=.02;applyEffectParametersDiff(e,t,a){const n=Zg.EFFECT_RAMP_TIME;switch(t){case"Distortion":e instanceof b&&("drive"in a&&(e.distortion=a.drive),"oversample"in a&&(e.oversample=a.oversample));break;case"Delay":case"FeedbackDelay":e instanceof _&&("time"in a&&e.delayTime.rampTo(a.time,n),"feedback"in a&&e.feedback.rampTo(a.feedback,n));break;case"Chorus":e instanceof $&&("frequency"in a&&e.frequency.rampTo(a.frequency,n),"depth"in a&&(e.depth=a.depth));break;case"Phaser":e instanceof w&&("frequency"in a&&e.frequency.rampTo(a.frequency,n),"octaves"in a&&(e.octaves=a.octaves));break;case"Tremolo":e instanceof q&&("frequency"in a&&e.frequency.rampTo(a.frequency,n),"depth"in a&&e.depth.rampTo(a.depth,n));break;case"Vibrato":e instanceof K&&("frequency"in a&&e.frequency.rampTo(a.frequency,n),"depth"in a&&e.depth.rampTo(a.depth,n));break;case"BitCrusher":e instanceof U&&"bits"in a&&e.bits.rampTo(a.bits,n);break;case"PingPongDelay":e instanceof L&&("time"in a&&e.delayTime.rampTo(a.time,n),"feedback"in a&&e.feedback.rampTo(a.feedback,n));break;case"PitchShift":e instanceof B&&"pitch"in a&&(e.pitch=a.pitch);break;case"Compressor":e instanceof S&&("threshold"in a&&e.threshold.rampTo(a.threshold,n),"ratio"in a&&e.ratio.rampTo(a.ratio,n),"attack"in a&&e.attack.rampTo(a.attack,n),"release"in a&&e.release.rampTo(a.release,n));break;case"EQ3":e instanceof f&&("low"in a&&e.low.rampTo(a.low,n),"mid"in a&&e.mid.rampTo(a.mid,n),"high"in a&&e.high.rampTo(a.high,n));break;case"Filter":e instanceof h&&("frequency"in a&&e.frequency.rampTo(a.frequency,n),"Q"in a&&e.Q.rampTo(a.Q,n),"type"in a&&(e.type=a.type),"rolloff"in a&&(e.rolloff=a.rolloff),"gain"in a&&e.gain.rampTo(a.gain,n));break;case"AutoFilter":e instanceof H&&("frequency"in a&&e.frequency.rampTo(a.frequency,n),"baseFrequency"in a&&(e.baseFrequency=a.baseFrequency),"octaves"in a&&(e.octaves=a.octaves));break;case"AutoPanner":e instanceof W&&("frequency"in a&&e.frequency.rampTo(a.frequency,n),"depth"in a&&e.depth.rampTo(a.depth,n));break;case"StereoWidener":e instanceof R&&"width"in a&&e.width.rampTo(a.width,n);break;case"SpaceyDelayer":e instanceof hi&&("firstTap"in a&&e.setFirstTap(Number(a.firstTap)),"tapSize"in a&&e.setTapSize(Number(a.tapSize)),"feedback"in a&&e.setFeedback(Number(a.feedback)),"multiTap"in a&&e.setMultiTap(Number(a.multiTap)),"tapeFilter"in a&&e.setTapeFilter(Number(a.tapeFilter)));break;case"RETapeEcho":e instanceof xi&&("mode"in a&&e.setMode(Number(a.mode)),"repeatRate"in a&&e.setRepeatRate(Number(a.repeatRate)),"intensity"in a&&e.setIntensity(Number(a.intensity)),"echoVolume"in a&&e.setEchoVolume(Number(a.echoVolume)),"wow"in a&&e.setWow(Number(a.wow)),"flutter"in a&&e.setFlutter(Number(a.flutter)),"dirt"in a&&e.setDirt(Number(a.dirt)),"inputBleed"in a&&e.setInputBleed(Number(a.inputBleed)),"loopAmount"in a&&e.setLoopAmount(Number(a.loopAmount)),"playheadFilter"in a&&e.setPlayheadFilter(Number(a.playheadFilter)));break;case"SpaceEcho":e instanceof li&&("mode"in a&&e.setMode(Number(a.mode)),"rate"in a&&e.setRate(Number(a.rate)),"intensity"in a&&e.setIntensity(Number(a.intensity)),"echoVolume"in a&&e.setEchoVolume(Number(a.echoVolume)),"reverbVolume"in a&&e.setReverbVolume(Number(a.reverbVolume)),"bass"in a&&e.setBass(Number(a.bass)),"treble"in a&&e.setTreble(Number(a.treble)));break;case"BiPhase":if(e instanceof ki){const t=e;"rateA"in a&&(t.rateA=Number(a.rateA)),"depthA"in a&&(t.depthA=Number(a.depthA)),"rateB"in a&&(t.rateB=Number(a.rateB)),"depthB"in a&&(t.depthB=Number(a.depthB)),"feedback"in a&&(t.feedback=Number(a.feedback))}break;case"DubFilter":if(e instanceof Mi){const t=e;"cutoff"in a&&(t.cutoff=Number(a.cutoff)),"resonance"in a&&(t.resonance=Number(a.resonance)),"gain"in a&&(t.gain=Number(a.gain))}break;case"MoogFilter":e instanceof _i&&("cutoff"in a&&e.setCutoff(Number(a.cutoff)),"resonance"in a&&e.setResonance(Number(a.resonance)/100),"drive"in a&&e.setDrive(Number(a.drive)),"model"in a&&e.setModel(Number(a.model)),"filterMode"in a&&e.setFilterMode(Number(a.filterMode)));break;case"MVerb":e instanceof Fi&&("damping"in a&&e.setDamping(Number(a.damping)),"density"in a&&e.setDensity(Number(a.density)),"bandwidth"in a&&e.setBandwidth(Number(a.bandwidth)),"decay"in a&&e.setDecay(Number(a.decay)),"predelay"in a&&e.setPredelay(Number(a.predelay)),"size"in a&&e.setSize(Number(a.size)),"gain"in a&&e.setGain(Number(a.gain)),"mix"in a&&e.setMix(Number(a.mix)),"earlyMix"in a&&e.setEarlyMix(Number(a.earlyMix)));break;case"Leslie":e instanceof zi&&("speed"in a&&e.setSpeed(Number(a.speed)),"hornRate"in a&&e.setHornRate(Number(a.hornRate)),"drumRate"in a&&e.setDrumRate(Number(a.drumRate)),"hornDepth"in a&&e.setHornDepth(Number(a.hornDepth)),"drumDepth"in a&&e.setDrumDepth(Number(a.drumDepth)),"doppler"in a&&e.setDoppler(Number(a.doppler)),"mix"in a&&e.setMix(Number(a.mix)),"width"in a&&e.setWidth(Number(a.width)),"acceleration"in a&&e.setAcceleration(Number(a.acceleration)));break;case"SpringReverb":e instanceof Ki&&("decay"in a&&e.setDecay(Number(a.decay)),"damping"in a&&e.setDamping(Number(a.damping)),"tension"in a&&e.setTension(Number(a.tension)),"mix"in a&&e.setSpringMix(Number(a.mix)),"drip"in a&&e.setDrip(Number(a.drip)),"diffusion"in a&&e.setDiffusion(Number(a.diffusion)));break;case"Reverb":e instanceof g&&("decay"in a&&(e.decay=a.decay),"preDelay"in a&&(e.preDelay=a.preDelay));break;case"JCReverb":e instanceof j&&"roomSize"in a&&e.roomSize.rampTo(a.roomSize,n);break;case"SidechainCompressor":e instanceof no&&("threshold"in a&&(e.threshold=a.threshold),"ratio"in a&&(e.ratio=a.ratio),"attack"in a&&(e.attack=a.attack),"release"in a&&(e.release=a.release),"knee"in a&&(e.knee=a.knee),"sidechainGain"in a&&(e.sidechainGain=a.sidechainGain));break;case"TapeSaturation":e instanceof Xr&&("drive"in a&&(e.drive=a.drive/100),"tone"in a&&(e.tone=a.tone));break;case"AutoWah":e instanceof G&&("baseFrequency"in a&&(e.baseFrequency=a.baseFrequency),"octaves"in a&&(e.octaves=a.octaves),"sensitivity"in a&&(e.sensitivity=a.sensitivity),"Q"in a&&e.Q.rampTo(a.Q,n),"gain"in a&&e.gain.rampTo(a.gain,n),"follower"in a&&(e.follower=a.follower));break;case"Chebyshev":e instanceof z&&("order"in a&&(e.order=a.order),"oversample"in a&&(e.oversample=a.oversample));break;case"FrequencyShifter":e instanceof V&&"frequency"in a&&e.frequency.rampTo(a.frequency,n);break;case"WAMBigMuff":case"WAMTS9":case"WAMDistoMachine":case"WAMQuadraFuzz":case"WAMVoxAmp":case"WAMStonePhaser":case"WAMPingPongDelay":case"WAMFaustDelay":case"WAMPitchShifter":case"WAMGraphicEQ":case"WAMPedalboard":if(e instanceof bg)for(const[t,n]of Object.entries(a))"bpmSync"!==t&&"syncDivision"!==t&&e.setParameter(t,Number(n))}}async updateBpmSyncedEffects(e){this.masterEffectConfigs.forEach(({node:t,config:a})=>{if(!to(a.parameters))return;const n=Ji[a.type];if(!n)return;const s=ao(a.parameters);for(const r of n){const n=eo(e,s,r.unit);this.applyBpmSyncedParam(t,a.type,r.param,n)}});try{const{useInstrumentStore:t}=await ja(async()=>{const{useInstrumentStore:e}=await Promise.resolve().then(()=>Lv);return{useInstrumentStore:e}},void 0),a=t.getState().instruments;this.instrumentEffectChains.forEach((t,n)=>{const s="number"==typeof n?n:Number(String(n).split("-")[0]),r=a.find(e=>e.id===s);if(!r?.effects)return;r.effects.filter(e=>e.enabled).forEach((a,n)=>{if(n>=t.effects.length)return;if(!to(a.parameters))return;const s=Ji[a.type];if(!s)return;const r=ao(a.parameters),i=t.effects[n];for(const t of s){const n=eo(e,r,t.unit);this.applyBpmSyncedParam(i,a.type,t.param,n)}})})}catch{}}applyBpmSyncedParam(e,t,a,n){try{switch(t){case"Delay":case"FeedbackDelay":"time"===a&&e instanceof _&&e.delayTime.rampTo(n,.02);break;case"PingPongDelay":"time"===a&&e instanceof L&&e.delayTime.rampTo(n,.02);break;case"SpaceEcho":"rate"===a&&e instanceof li&&e.setRate(n);break;case"SpaceyDelayer":"firstTap"===a&&e instanceof hi&&e.setFirstTap(n);break;case"RETapeEcho":"repeatRate"===a&&e instanceof xi&&e.setRepeatRate(n);break;case"Chorus":"frequency"===a&&e instanceof $&&e.frequency.rampTo(n,.02);break;case"BiPhase":"rateA"===a&&e instanceof ki&&(e.rateA=n)}}catch(s){}}getChannelOutput(e){if(!this.channelOutputs.has(e)){const t=new p(1),a=new fe({volume:0,pan:0}),n=new M({smoothing:.8});t.connect(a),a.connect(n),a.connect(this.masterInput),this.channelOutputs.set(e,{input:t,channel:a,meter:n})}return this.channelOutputs.get(e).input}createVoice(e,t,a,n){const s=this.channelOutputs.get(e);if(!s)throw new Error(`Channel ${e} not initialized`);const r=new p(1);let i;if("IT"===n.metadata?.importedFrom&&Zg.itFilterWorkletLoaded){const e=this._nativeContext;i=new AudioWorkletNode(e,"it-filter-processor")}else i=new h({type:"lowpass",frequency:2e4,Q:0,rolloff:-12});const o=new ue(0);i instanceof h?(r.connect(i),i.connect(o)):(r.connect(i),x(i,o)),o.connect(s.input);const l=n.metadata?.envelopes?.[n.id],c=new Vg,u=new Vg,d=new Vg;return l?.volumeEnvelope&&c.init(l.volumeEnvelope),l?.panningEnvelope&&u.init(l.panningEnvelope),l?.pitchEnvelope&&d.init(l.pitchEnvelope),{instrument:t,note:a,volumeEnv:c,panningEnv:u,pitchEnv:d,fadeout:65536,fadeoutStep:n.metadata?.modPlayback?.fadeout||0,isKeyOff:!1,isFilterEnvelope:"filter"===l?.pitchEnvelope?.type,lastCutoff:127,lastResonance:0,nodes:{gain:r,filter:i,panner:o}}}stopVoice(e,t){e.instrument.stop?e.instrument.stop(t):e.instrument.triggerRelease&&e.instrument.triggerRelease(t),setTimeout(()=>{e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()},100)}setChannelVolume(e,t){const a=this.activeVoices.get(e);if(a&&a.length>0){const e=Z(),n=t<=-60?0:Math.pow(10,t/20);for(const t of a)t.nodes.gain&&t.nodes.gain.gain.setValueAtTime(n,e)}this.channelOutputs.get(e)}setChannelFilterCutoff(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=a[a.length-1];n.lastCutoff=t;const s=n.lastResonance,r=n.nodes.filter,i=Z();if(t>=127&&0===s||255===t)r instanceof h?(r.frequency.setValueAtTime(24e3,i),r.Q.setValueAtTime(0,i)):r instanceof AudioWorkletNode&&(r.parameters.get("cutoff")?.setValueAtTime(127,i),r.parameters.get("resonance")?.setValueAtTime(0,i));else if(r instanceof h){const e=100*Math.pow(100,t/127);r.frequency.setValueAtTime(e,i)}else r instanceof AudioWorkletNode&&r.parameters.get("cutoff")?.setValueAtTime(t,i)}setChannelFilterResonance(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=a[a.length-1];n.lastResonance=t;const s=n.lastCutoff,r=n.nodes.filter,i=Z();if(r instanceof h){const e=t/127*(t/127)*25;r.Q.setValueAtTime(e,i)}else r instanceof AudioWorkletNode&&r.parameters.get("resonance")?.setValueAtTime(t,i);t>0&&s>=127&&this.setChannelFilterCutoff(e,s)}setChannelPan(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=(t??0)/100;a[a.length-1].nodes.panner.pan.setValueAtTime(n,Z())}setChannelFunkRepeat(e,t){const a=this.activeVoices.get(e);if(!a||0===a.length)return;const n=a[a.length-1].instrument;if(n instanceof oe&&n.loop){if(0===t)return;if(n.buffer.loaded){const e=n,a=e._originalLoopStart??n.loopStart;void 0===e._originalLoopStart&&(e._originalLoopStart=n.loopStart);const s=t/128*(n.loopEnd-a);n.loopStart=a+s}}}handlePastNoteAction(e,t){const a=this.activeVoices.get(e);if(!a||a.length<=1)return;const n=a.slice(0,a.length-1),s=a[a.length-1];0===t?(n.forEach(e=>this.stopVoice(e,Z())),this.activeVoices.set(e,[s])):2===t?n.forEach(e=>e.volumeEnv.keyOff()):3===t&&n.forEach(e=>{e.isKeyOff=!0,0===e.fadeoutStep&&(e.fadeoutStep=1024)})}setChannelPitch(e,t){const a=this.channelPitchState.get(e);if(!a)return;a.currentPitchMult=t;const n=this.activeVoices.get(e);if(!n||0===n.length){const e=this.instruments.get(a.instrumentKey);if(!e)return;return void this.applyPitchToNode(e,t,a.basePlaybackRate,a.instrumentKey)}const s=n[n.length-1];this.applyPitchToNode(s.instrument,t,a.basePlaybackRate,a.instrumentKey)}applyPitchToNode(e,t,a,n){const s=this.instrumentSynthTypes.get(n),r=1200*Math.log2(t),i=e;e instanceof oe||e instanceof le?e.playbackRate=a*t:"Sampler"===s?void 0!==i.detune&&(i.detune.value=r):void 0!==i.detune&&i.detune instanceof A?i.detune.value=r:void 0!==i.oscillator?.detune?i.oscillator.detune.value=r:void 0!==i.detune&&(i.detune=r)}setChannelFrequency(e,t){const a=this.channelPitchState.get(e);if(!a||0===a.baseFrequency)return;const n=t/a.baseFrequency;this.setChannelPitch(e,n)}initChannelPitch(e,t,a,n=1){this.channelPitchState.set(e,{instrumentKey:t,basePlaybackRate:n,baseFrequency:a,currentPitchMult:1})}clearChannelPitch(e){this.channelPitchState.get(e)&&(this.setChannelPitch(e,1),this.channelPitchState.delete(e))}setChannelMute(e,t){this.channelOutputs.has(e)||this.getChannelOutput(e);const a=this.channelOutputs.get(e);a&&(a.channel.mute=t)}updateMuteStates(e){const t=e.some(e=>e.solo);e.forEach((e,a)=>{const n=t?!e.solo:e.muted;this.channelMuteStates.set(a,n),this.setChannelMute(a,n)})}isChannelMuted(e){return this.channelMuteStates.get(e)??!1}disposeChannelOutputs(){this.channelOutputs.forEach((e,t)=>{try{e.meter.dispose()}catch(a){}try{e.channel.dispose()}catch(a){}try{e.input.dispose()}catch(a){}}),this.channelOutputs.clear()}getChannelLevels(e){const t=[];for(let a=0;a<e;a++){const e=this.channelOutputs.get(a);if(e){const a=e.meter.getValue(),n=Math.max(0,Math.min(1,(a+60)/60));t.push(n)}else t.push(0)}return t}channelTriggerLevels=new Map;triggerLevelsCache=[];triggerChannelMeter(e,t){this.channelTriggerLevels.set(e,Math.min(1,1.2*t))}getChannelTriggerLevels(e){this.triggerLevelsCache.length!==e&&(this.triggerLevelsCache=new Array(e).fill(0));for(let t=0;t<e;t++){const e=this.channelTriggerLevels.get(t)||0;this.triggerLevelsCache[t]=e,e>0&&this.channelTriggerLevels.set(t,0)}return this.triggerLevelsCache}getWaveform(){return this.analyser.getValue()}getFFT(){return this.fft.getValue()}enableAnalysers(){this.analysersConnected||(this.masterChannel.connect(this.analyser),this.masterChannel.connect(this.fft),this.analysersConnected=!0)}disableAnalysers(){this.analysersConnected&&(this.masterChannel.disconnect(this.analyser),this.masterChannel.disconnect(this.fft),this.analysersConnected=!1)}currentPerformanceQuality="high";setPerformanceQuality(e){if(this.currentPerformanceQuality===e)return;this.currentPerformanceQuality=e,this.instruments.forEach(t=>{t instanceof Cr&&t.setQuality(e)});const t=[];this.instruments.forEach((e,a)=>{if(e&&"object"==typeof e&&"maxPolyphony"in e){const e=a.split("-"),n=parseInt(e[0],10),s="-1"===e[1]?void 0:parseInt(e[1],10),r=this.instrumentSynthTypes.get(a);r&&["Synth","FMSynth","AMSynth","PluckSynth"].includes(r)&&t.push({key:a,instrumentId:n,channelIndex:s,config:{synthType:r}})}}),t.length>0&&t.forEach(({key:e})=>{const t=this.instruments.get(e);if(t&&"function"==typeof t.dispose)try{t.dispose()}catch(a){}this.instruments.delete(e),this.instrumentSynthTypes.delete(e)})}updateChannelEnvelopes(e){const t=this.activeVoices.get(e),a=this.channelOutputs.get(e);if(!t||0===t.length||!a)return;const n=Z(),s=a.channel.pan.value;let r=0;const i=t.length;for(let o=0;o<i;o++){const e=t[o],a=e.volumeEnv.tickNext();e.isKeyOff&&e.fadeout>0&&(e.fadeout=Math.max(0,e.fadeout-e.fadeoutStep));const i=a/64*(e.fadeout/65536);e.nodes.gain.gain.setValueAtTime(i,n);const l=e.panningEnv.tickNext();if(32!==l){const t=(l-32)/32,a=Math.max(-1,Math.min(1,s+t));e.nodes.panner.pan.setValueAtTime(a,n)}const c=e.pitchEnv.tickNext();if(e.pitchEnv.isEnabled())if(e.isFilterEnvelope){const t=e.lastCutoff,a=c-32,s=Math.max(0,Math.min(127,t+a));if(e.nodes.filter instanceof h){const t=Zg.FILTER_CUTOFF_LUT[s];e.nodes.filter.frequency.setValueAtTime(t,n)}else e.nodes.filter instanceof AudioWorkletNode&&e.nodes.filter.parameters.get("cutoff")?.setValueAtTime(s,n)}else{const t=(c-32)/32*12,a=e.instrument;void 0!==a.detune&&(a.detune.value=100*t)}e.isKeyOff&&e.fadeout<=0||e.volumeEnv.isFinished()&&e.isKeyOff?(e.nodes.gain.dispose(),"function"==typeof e.nodes.filter.dispose&&e.nodes.filter.dispose(),e.nodes.panner.dispose()):t[r++]=e}r>0?t.length=r:this.activeVoices.delete(e)}setChannelKeyOff(e){const t=this.activeVoices.get(e);t&&t.forEach(e=>{e.isKeyOff=!0,e.volumeEnv.keyOff(),e.panningEnv.keyOff(),e.pitchEnv.keyOff()})}getPerformanceQuality(){return this.currentPerformanceQuality}}const Qg=()=>Zg.getInstance(),Jg=Object.freeze(Object.defineProperty({__proto__:null,ToneEngine:Zg,getToneEngine:Qg},Symbol.toStringTag,{value:"Module"}));let eb=0;const tb={generate:(e="id")=>(eb++,`${e}-${eb}-${Date.now()}`),reset(){eb=0}},ab=16,nb=31,sb=(e,t)=>0!==(e&t),rb=(e,t)=>e^t,ib=(e=64,t=4)=>({id:tb.generate("pattern"),name:"Untitled Pattern",length:e,channels:Array.from({length:t},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,rows:Array.from({length:e},()=>({...dn})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}),ob=n()(Ga((e,t)=>({patterns:[ib()],currentPatternIndex:0,cursor:{channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},selection:null,clipboard:null,trackClipboard:null,followPlayback:!1,showGhostPatterns:!0,columnVisibility:{...un},copyMask:nb,pasteMask:nb,transposeMask:1,macroSlots:Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),insertMode:!1,currentOctave:4,recordMode:!1,editStep:1,multiRecEnabled:!1,multiEditEnabled:!1,multiRecChannels:Array(16).fill(!0),multiKeyJazz:!1,recQuantEnabled:!1,recQuantRes:16,recReleaseEnabled:!1,keyOnTab:Array(16).fill(0),keyOffTime:Array(16).fill(0),keyOffCounter:0,ptnJumpPos:[0,0,0,0],patternOrder:[0],currentPositionIndex:0,originalModuleData:null,setCurrentPattern:t=>e(e=>{t>=0&&t<e.patterns.length&&(e.currentPatternIndex=t)}),moveCursor:t=>e(e=>{const a=e.patterns[e.currentPatternIndex],n=a.channels.length,s=a.length,r=e.cursor.rowIndex,i=e.cursor.channelIndex,o=e.cursor.columnType,l=e.cursor.digitIndex,c={instrument:2,volume:2,effTyp:1,effParam:2,effTyp2:1,effParam2:2,cutoff:2,resonance:2,envMod:2,pan:2,probability:2},u=c[e.cursor.columnType]||0;switch(t){case"up":e.cursor.rowIndex>0?e.cursor.rowIndex--:e.cursor.rowIndex=s-1;break;case"down":e.cursor.rowIndex<s-1?e.cursor.rowIndex++:e.cursor.rowIndex=0;break;case"left":{if(u>0&&e.cursor.digitIndex>0){e.cursor.digitIndex--;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],a=t.indexOf(e.cursor.columnType);if(-1===a){e.cursor.columnType="note",e.cursor.digitIndex=0;break}if(a>0){e.cursor.columnType=t[a-1];const n=c[e.cursor.columnType]||0;e.cursor.digitIndex=n>0?n-1:0}else{e.cursor.channelIndex>0?e.cursor.channelIndex--:e.cursor.channelIndex=n-1,e.cursor.columnType=t[t.length-1];const a=c[e.cursor.columnType]||0;e.cursor.digitIndex=a>0?a-1:0}break}case"right":{if(u>0&&e.cursor.digitIndex<u-1){e.cursor.digitIndex++;break}const t=["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"],a=t.indexOf(e.cursor.columnType);if(-1===a){e.cursor.columnType="note",e.cursor.digitIndex=0;break}a<t.length-1?(e.cursor.columnType=t[a+1],e.cursor.digitIndex=0):(e.cursor.channelIndex<n-1?e.cursor.channelIndex++:e.cursor.channelIndex=0,e.cursor.columnType="note",e.cursor.digitIndex=0);break}}if(e.cursor.rowIndex===r&&e.cursor.channelIndex===i&&e.cursor.columnType===o&&e.cursor.digitIndex===l)return e}),moveCursorToRow:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.length&&(e.cursor.rowIndex=t)}),moveCursorToChannel:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.channels.length&&(e.cursor.channelIndex=t)}),moveCursorToColumn:t=>e(e=>{e.cursor.columnType=t,e.cursor.digitIndex=0}),setCell:(t,a,n)=>e(e=>{const s=e.patterns[e.currentPatternIndex];t>=0&&t<s.channels.length&&a>=0&&a<s.length&&(s.channels[t].rows[a]={...s.channels[t].rows[a],...n})}),clearCell:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];t>=0&&t<n.channels.length&&a>=0&&a<n.length&&(n.channels[t].rows[a]={...dn})}),clearChannel:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];t>=0&&t<a.channels.length&&(a.channels[t].rows=a.channels[t].rows.map(()=>({...dn})))}),clearPattern:()=>e(e=>{e.patterns[e.currentPatternIndex].channels.forEach(e=>{e.rows=e.rows.map(()=>({...dn}))})}),insertRow:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t>=0&&t<n.channels.length&&a>=0&&a<n.length){const e=n.channels[t].rows;for(let t=n.length-1;t>a;t--)e[t]={...e[t-1]};e[a]={...dn}}}),deleteRow:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t>=0&&t<n.channels.length&&a>=0&&a<n.length){const e=n.channels[t].rows;for(let t=a;t<n.length-1;t++)e[t]={...e[t+1]};e[n.length-1]={...dn}}}),setFollowPlayback:t=>e(e=>{e.followPlayback=t}),setShowGhostPatterns:t=>e(e=>{e.showGhostPatterns=t}),setColumnVisibility:t=>e(e=>{Object.assign(e.columnVisibility,t)}),setCopyMask:t=>e(e=>{e.copyMask=t&nb}),setPasteMask:t=>e(e=>{e.pasteMask=t&nb}),setTransposeMask:t=>e(e=>{e.transposeMask=t&nb}),toggleMaskBit:(t,a)=>e(e=>{"copy"===t?e.copyMask=rb(e.copyMask,a):"paste"===t?e.pasteMask=rb(e.pasteMask,a):"transpose"===t&&(e.transposeMask=rb(e.transposeMask,a))}),setCurrentOctave:t=>e(e=>{e.currentOctave=Math.max(1,Math.min(7,t))}),toggleRecordMode:()=>e(e=>{e.recordMode=!e.recordMode}),setEditStep:t=>e(e=>{e.editStep=Math.max(0,Math.min(16,t))}),toggleInsertMode:()=>e(e=>{e.insertMode=!e.insertMode}),setMultiRecEnabled:t=>e(e=>{e.multiRecEnabled=t}),setMultiEditEnabled:t=>e(e=>{e.multiEditEnabled=t}),toggleMultiRecChannel:t=>e(e=>{t>=0&&t<e.multiRecChannels.length&&(e.multiRecChannels[t]=!e.multiRecChannels[t])}),setMultiKeyJazz:t=>e(e=>{e.multiKeyJazz=t}),setRecQuantEnabled:t=>e(e=>{e.recQuantEnabled=t}),setRecQuantRes:t=>e(e=>{[1,2,4,8,16].includes(t)&&(e.recQuantRes=t)}),setRecReleaseEnabled:t=>e(e=>{e.recReleaseEnabled=t}),setKeyOn:(t,a)=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOnTab[t]=a)}),setKeyOff:t=>e(e=>{t>=0&&t<e.keyOnTab.length&&(e.keyOffCounter++,e.keyOnTab[t]=0,e.keyOffTime[t]=e.keyOffCounter)}),findBestChannel:()=>{const e=t(),a=e.patterns[e.currentPatternIndex],n=a?.channels.length||1;if(!e.multiRecEnabled&&!e.multiEditEnabled)return e.cursor.channelIndex;let s=e.cursor.channelIndex,r=1/0;for(let t=0;t<n;t++)e.multiRecChannels[t]&&0===e.keyOnTab[t]&&e.keyOffTime[t]<r&&(s=t,r=e.keyOffTime[t]);return s},resetKeyTracking:()=>e(e=>{e.keyOnTab=e.keyOnTab.map(()=>0),e.keyOffTime=e.keyOffTime.map(()=>0),e.keyOffCounter=0}),setPtnJumpPos:(t,a)=>e(e=>{t>=0&&t<4&&(e.ptnJumpPos[t]=a)}),getPtnJumpPos:e=>{const a=t();return e>=0&&e<4?a.ptnJumpPos[e]:0},startSelection:()=>e(e=>{e.selection={startChannel:e.cursor.channelIndex,endChannel:e.cursor.channelIndex,startRow:e.cursor.rowIndex,endRow:e.cursor.rowIndex,columnTypes:[e.cursor.columnType]}}),updateSelection:(t,a)=>e(e=>{e.selection&&(e.selection.endChannel=t,e.selection.endRow=a)}),endSelection:()=>e(e=>{e.selection&&(e.selection.endChannel=e.cursor.channelIndex,e.selection.endRow=e.cursor.rowIndex)}),clearSelection:()=>e(e=>{e.selection=null}),selectColumn:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:n.length-1,columnTypes:[a]}}),selectChannel:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];e.selection={startChannel:t,endChannel:t,startRow:0,endRow:a.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),selectPattern:()=>e(e=>{const t=e.patterns[e.currentPatternIndex];e.selection={startChannel:0,endChannel:t.channels.length-1,startRow:0,endRow:t.length-1,columnTypes:["note","instrument","volume","effTyp","effParam","effTyp2","effParam2","flag1","flag2","probability"]}}),copySelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:n,startRow:s,endRow:r}=e.selection,i=Math.min(a,n),o=Math.max(a,n),l=Math.min(s,r),c=Math.max(s,r),u=[];if((c-l+1)*(o-i+1)>1e3)for(let d=i;d<=o;d++)u.push(structuredClone(t.channels[d].rows.slice(l,c+1)));else for(let d=i;d<=o;d++){const e=[];for(let a=l;a<=c;a++)e.push({...t.channels[d].rows[a]});u.push(e)}e.clipboard={channels:o-i+1,rows:c-l+1,data:u}}),cutSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:n,startRow:s,endRow:r}=e.selection,i=Math.min(a,n),o=Math.max(a,n),l=Math.min(s,r),c=Math.max(s,r),u=[];for(let d=i;d<=o;d++){const e=[];for(let a=l;a<=c;a++)e.push({...t.channels[d].rows[a]}),t.channels[d].rows[a]={...dn};u.push(e)}e.clipboard={channels:o-i+1,rows:c-l+1,data:u},e.selection=null}),paste:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let i=0;i<s.length;i++){const e=a+i;if(e>=t.channels.length)break;for(let a=0;a<s[i].length;a++){const o=n+a;if(o>=t.length)break;const l=s[i][a],c=t.channels[e].rows[o];sb(r,1)&&(c.note=l.note),sb(r,2)&&(c.instrument=l.instrument),sb(r,4)&&(c.volume=l.volume),sb(r,8)&&(c.effTyp=l.effTyp,c.eff=l.eff),sb(r,ab)&&(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteMix:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e;for(let i=0;i<s.length;i++){const e=a+i;if(e>=t.channels.length)break;for(let a=0;a<s[i].length;a++){const o=n+a;if(o>=t.length)break;const l=s[i][a],c=t.channels[e].rows[o];sb(r,1)&&0!==l.note&&0===c.note&&(c.note=l.note),sb(r,2)&&0!==l.instrument&&0===c.instrument&&(c.instrument=l.instrument),sb(r,4)&&0!==l.volume&&0===c.volume&&(c.volume=l.volume),!sb(r,8)||0===l.effTyp&&0===l.eff||0!==c.effTyp||0!==c.eff||(c.effTyp=l.effTyp,c.eff=l.eff),!sb(r,ab)||0===l.effTyp2&&0===l.eff2||0!==c.effTyp2||0!==c.eff2||(c.effTyp2=l.effTyp2,c.eff2=l.eff2)}}}),pasteFlood:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,i=s[0]?.length||0;if(0!==i)for(let o=0;o<s.length;o++){const e=a+o;if(e>=t.channels.length)break;let l=n;for(;l<t.length;){for(let a=0;a<s[o].length;a++){const n=l+a;if(n>=t.length)break;const i=s[o][a],c=t.channels[e].rows[n];sb(r,1)&&(c.note=i.note),sb(r,2)&&(c.instrument=i.instrument),sb(r,4)&&(c.volume=i.volume),sb(r,8)&&(c.effTyp=i.effTyp,c.eff=i.eff),sb(r,ab)&&(c.effTyp2=i.effTyp2,c.eff2=i.eff2)}l+=i}}}),pastePushForward:()=>e(e=>{if(!e.clipboard)return;const t=e.patterns[e.currentPatternIndex],{channelIndex:a,rowIndex:n}=e.cursor,{data:s}=e.clipboard,{pasteMask:r}=e,i=s[0]?.length||0;if(0!==i)for(let o=0;o<s.length;o++){const e=a+o;if(e>=t.channels.length)break;const l=t.channels[e];for(let a=t.length-1;a>=n+i;a--){const e=a-i;e>=n&&(l.rows[a]={...l.rows[e]})}for(let a=0;a<s[o].length;a++){const e=n+a;if(e>=t.length)break;const i=s[o][a],c=l.rows[e];c.note=0,c.instrument=0,c.volume=0,c.effTyp=0,c.eff=0,c.effTyp2=0,c.eff2=0,sb(r,1)&&(c.note=i.note),sb(r,2)&&(c.instrument=i.instrument),sb(r,4)&&(c.volume=i.volume),sb(r,8)&&(c.effTyp=i.effTyp,c.eff=i.eff),sb(r,ab)&&(c.effTyp2=i.effTyp2,c.eff2=i.eff2)}}}),copyTrack:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t<0||t>=a.channels.length)return;const n=a.channels[t];e.trackClipboard=n.rows.map(e=>({...e}))}),cutTrack:t=>e(e=>{const a=e.patterns[e.currentPatternIndex];if(t<0||t>=a.channels.length)return;const n=a.channels[t];e.trackClipboard=n.rows.map(e=>({...e})),n.rows=n.rows.map(()=>({...dn}))}),pasteTrack:t=>e(e=>{if(!e.trackClipboard)return;const a=e.patterns[e.currentPatternIndex];if(t<0||t>=a.channels.length)return;const n=a.channels[t],{pasteMask:s}=e,r=Math.min(e.trackClipboard.length,a.length);for(let t=0;t<r;t++){const a=e.trackClipboard[t],r=n.rows[t];sb(s,1)&&(r.note=a.note),sb(s,2)&&(r.instrument=a.instrument),sb(s,4)&&(r.volume=a.volume),sb(s,8)&&(r.effTyp=a.effTyp,r.eff=a.eff),sb(s,ab)&&(r.effTyp2=a.effTyp2,r.eff2=a.eff2)}}),writeMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const a=e.patterns[e.currentPatternIndex],{channelIndex:n,rowIndex:s}=e.cursor,r=a.channels[n].rows[s];e.macroSlots[t]={note:r.note,instrument:r.instrument,volume:r.volume,effTyp:r.effTyp,eff:r.eff,effTyp2:r.effTyp2,eff2:r.eff2}}),readMacroSlot:t=>e(e=>{if(t<0||t>=8)return;const a=e.macroSlots[t],n=e.patterns[e.currentPatternIndex],{channelIndex:s,rowIndex:r}=e.cursor,{pasteMask:i}=e;if(e.insertMode){const e=n.channels[s],t={...dn};sb(i,1)&&0!==a.note&&(t.note=a.note),sb(i,2)&&0!==a.instrument&&(t.instrument=a.instrument),sb(i,4)&&0!==a.volume&&(t.volume=a.volume),sb(i,8)&&(t.effTyp=a.effTyp,t.eff=a.eff),!sb(i,ab)||0===a.effTyp2&&0===a.eff2||(t.effTyp2=a.effTyp2,t.eff2=a.eff2),e.rows.splice(r,0,t),e.rows.length>n.length&&e.rows.pop()}else{const e=n.channels[s].rows[r];sb(i,1)&&0!==a.note&&(e.note=a.note),sb(i,2)&&0!==a.instrument&&(e.instrument=a.instrument),sb(i,4)&&0!==a.volume&&(e.volume=a.volume),sb(i,8)&&(e.effTyp=a.effTyp,e.eff=a.eff),!sb(i,ab)||0===a.effTyp2&&0===a.eff2||(e.effTyp2=a.effTyp2,e.eff2=a.eff2)}}),transposeSelection:(t,a=!1)=>e(e=>{const n=e.patterns[e.currentPatternIndex],s=a?e.patterns[e.currentPatternIndex].channels[e.cursor.channelIndex].rows[e.cursor.rowIndex].instrument:null;let r,i,o,l;e.selection?(r=Math.min(e.selection.startChannel,e.selection.endChannel),i=Math.max(e.selection.startChannel,e.selection.endChannel),o=Math.min(e.selection.startRow,e.selection.endRow),l=Math.max(e.selection.startRow,e.selection.endRow)):(r=e.cursor.channelIndex,i=e.cursor.channelIndex,o=e.cursor.rowIndex,l=e.cursor.rowIndex);for(let c=r;c<=i;c++)if(!(c>=n.channels.length))for(let e=o;e<=l;e++){if(e>=n.length)continue;const r=n.channels[c].rows[e];if(!r.note||0===r.note||97===r.note)continue;if(a&&null!==s&&r.instrument!==s)continue;const i=ss(r.note);if(null===i)continue;const o=i+t;o>=12&&o<=107&&(r.note=rs(o))}}),remapInstrument:(t,a,n)=>e(e=>{const s=(e,n,s,r)=>{const i=void 0!==n?n:0,o=void 0!==n?n:e.channels.length-1,l=void 0!==s?s:0,c=void 0!==r?r:e.length-1;for(let u=i;u<=o;u++)for(let n=l;n<=c;n++)e.channels[u].rows[n]?.instrument===t&&(e.channels[u].rows[n].instrument=a)};if("block"===n&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),a=Math.max(e.selection.startChannel,e.selection.endChannel),n=Math.min(e.selection.startRow,e.selection.endRow),r=Math.max(e.selection.startRow,e.selection.endRow);for(let i=t;i<=a;i++)s(e.patterns[e.currentPatternIndex],i,n,r)}else"track"===n?s(e.patterns[e.currentPatternIndex],e.cursor.channelIndex):"pattern"===n?s(e.patterns[e.currentPatternIndex]):"song"===n&&e.patterns.forEach(e=>s(e))}),interpolateSelection:(t,a,n,s="linear")=>e(e=>{if(!e.selection)return;const r=e.patterns[e.currentPatternIndex],{startChannel:i,endChannel:o,startRow:l,endRow:c}=e.selection,u=Math.min(i,o),d=Math.max(i,o),p=Math.min(l,c),m=Math.max(l,c),h=m-p+1;if(h<2)return;const f=e=>{switch(s){case"log":return Math.log(1+9*e)/Math.log(10);case"exp":return(Math.pow(10,e)-1)/9;case"scurve":return e*e*(3-2*e);default:return e}};for(let s=u;s<=d;s++)if(!(s>=r.channels.length))for(let e=p;e<=m;e++){if(e>=r.length)continue;const i=r.channels[s].rows[e],o=f((e-p)/(h-1)),l=Math.round(a+(n-a)*o);"volume"===t?i.volume=Math.max(0,Math.min(64,l)):"cutoff"===t?i.cutoff=Math.max(0,Math.min(127,l)):"resonance"===t?i.resonance=Math.max(0,Math.min(127,l)):"envMod"===t?i.envMod=Math.max(0,Math.min(127,l)):"pan"===t&&(i.pan=Math.max(-100,Math.min(100,l)))}}),humanizeSelection:t=>e(e=>{if(!e.selection)return;const a=e.patterns[e.currentPatternIndex],{startChannel:n,endChannel:s,startRow:r,endRow:i}=e.selection,o=Math.min(n,s),l=Math.max(n,s),c=Math.min(r,i),u=Math.max(r,i);for(let d=o;d<=l;d++)if(!(d>=a.channels.length))for(let e=c;e<=u;e++){if(e>=a.length)continue;const n=a.channels[d].rows[e];if(!n.note||0===n.note||97===n.note)continue;const s=n.volume>=16&&n.volume<=80?n.volume-16:48,r=Math.floor(s*(t/100)),i=Math.floor(Math.random()*(2*r+1))-r,o=Math.max(0,Math.min(64,s+i));n.volume=16+o}}),strumSelection:(t,a)=>e(e=>{if(!e.selection)return;const n=e.patterns[e.currentPatternIndex],{startChannel:s,endChannel:r,startRow:i,endRow:o}=e.selection,l=Math.min(s,r),c=Math.max(s,r),u=Math.min(i,o),d=Math.max(i,o);for(let p=u;p<=d;p++)if(!(p>=n.length))for(let e=l;e<=c;e++){if(e>=n.channels.length)continue;const s=n.channels[e].rows[p];if(!s.note||0===s.note||97===s.note)continue;const r="down"===a?e-l:c-e,i=Math.min(15,r*t);i>0&&(s.effTyp=14,s.eff=208+i)}}),legatoSelection:()=>e(e=>{if(!e.selection)return;const t=e.patterns[e.currentPatternIndex],{startChannel:a,endChannel:n,startRow:s,endRow:r}=e.selection,i=Math.min(a,n),o=Math.max(a,n),l=Math.min(s,r),c=Math.max(s,r);for(let u=i;u<=o;u++){if(u>=t.channels.length)continue;let e=-1;for(let a=l;a<=c;a++){if(a>=t.length)continue;const n=t.channels[u].rows[a];n.note>0&&n.note<97&&(e>=0&&a>e+1&&0===n.effTyp&&(n.effTyp=3,n.eff=255),e=a)}}}),scaleVolume:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];(()=>{const a=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),s=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),i=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=s;e++)for(let t=r;t<=i;t++)e<n.channels.length&&t<n.length&&a.push(n.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<n.channels.length&&a.push(...n.channels[t].rows)}else"pattern"===t&&n.channels.forEach(e=>{a.push(...e.rows)});return a})().forEach(e=>{null!==e.volume&&void 0!==e.volume&&(e.volume=Math.min(64,Math.max(0,Math.round(e.volume*a))))})}),fadeVolume:(t,a,n)=>e(e=>{const s=e.patterns[e.currentPatternIndex],r=(()=>{const a=[];if("block"===t&&e.selection){const t=Math.min(e.selection.startChannel,e.selection.endChannel),n=Math.max(e.selection.startChannel,e.selection.endChannel),r=Math.min(e.selection.startRow,e.selection.endRow),i=Math.max(e.selection.startRow,e.selection.endRow);for(let e=t;e<=n;e++)for(let t=r;t<=i;t++)e<s.channels.length&&t<s.length&&a.push(s.channels[e].rows[t])}else if("track"===t){const t=e.cursor.channelIndex;t<s.channels.length&&a.push(...s.channels[t].rows)}else"pattern"===t&&s.channels.forEach(e=>{a.push(...e.rows)});return a})(),i=r.length;i<2||r.forEach((e,t)=>{const s=t/(i-1),r=Math.round(a+s*(n-a));e.volume=Math.min(64,Math.max(0,r))})}),addPattern:(t=64)=>e(e=>{const a=e.patterns[0]?.channels.length||4;e.patterns.push(ib(t,a)),"undefined"!=typeof window&&ja(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>zv);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN ADDED")})}),deletePattern:t=>e(e=>{e.patterns.length>1&&t>=0&&t<e.patterns.length&&(e.patterns.splice(t,1),e.currentPatternIndex>=e.patterns.length&&(e.currentPatternIndex=e.patterns.length-1),"undefined"!=typeof window&&ja(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>zv);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN DELETED")}))}),clonePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=structuredClone(a);n.id=tb.generate("pattern"),n.name=`${a.name} (Copy)`,e.patterns.splice(t+1,0,n),"undefined"!=typeof window&&ja(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>zv);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("PATTERN CLONED")})}}),resizePattern:(t,a)=>e(e=>{if(t>=0&&t<e.patterns.length&&a>0){const n=e.patterns[t],s=n.length;n.length=a,n.channels.forEach(e=>{if(a>s)for(let t=s;t<a;t++)e.rows.push({...dn});else e.rows.splice(a)})}}),resizeAllPatterns:t=>e(e=>{t>0&&e.patterns.forEach(e=>{const a=e.length;e.length=t,e.channels.forEach(e=>{if(t>a)for(let n=a;n<t;n++)e.rows.push({...dn});else e.rows.splice(t)})})}),duplicatePattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=structuredClone(a);n.id=tb.generate("pattern"),n.name=`${a.name} (Copy)`,e.patterns.splice(t+1,0,n),e.currentPatternIndex=t+1}}),expandPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=a.length,s=Math.min(2*n,256);if(s===n)return;a.length=s,a.channels.forEach(e=>{const t=[];for(let a=0;a<n;a++)t.push(e.rows[a]),t.push({...dn});e.rows=t})}}),shrinkPattern:t=>e(e=>{if(t>=0&&t<e.patterns.length){const a=e.patterns[t],n=a.length,s=Math.max(Math.floor(n/2),1);if(s===n)return;a.length=s,a.channels.forEach(e=>{const t=[];for(let a=0;a<s;a++)t.push(e.rows[2*a]);e.rows=t})}}),reorderPatterns:(t,a)=>e(e=>{if(t>=0&&t<e.patterns.length&&a>=0&&a<e.patterns.length&&t!==a){const[n]=e.patterns.splice(t,1);e.patterns.splice(a,0,n),e.currentPatternIndex===t?e.currentPatternIndex=a:t<e.currentPatternIndex&&a>=e.currentPatternIndex?e.currentPatternIndex--:t>e.currentPatternIndex&&a<=e.currentPatternIndex&&e.currentPatternIndex++}}),updatePatternName:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&a.trim()&&(e.patterns[t].name=a.trim())}),addChannel:()=>e(e=>{const t=cn.filter(e=>null!==e),a=t[Math.floor(Math.random()*t.length)];e.patterns.forEach(e=>{if(e.channels.length<16){const t=e.channels.length;e.channels.push({id:tb.generate("channel"),name:`Channel ${t+1}`,rows:Array.from({length:e.length},()=>({...dn})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:a})}}),"undefined"!=typeof window&&ja(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>zv);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL ADDED")})}),removeChannel:t=>e(e=>{e.patterns.forEach(e=>{e.channels.length>1&&t>=0&&t<e.channels.length&&e.channels.splice(t,1)}),e.cursor.channelIndex>=e.patterns[0]?.channels.length&&(e.cursor.channelIndex=Math.max(0,e.patterns[0].channels.length-1)),"undefined"!=typeof window&&ja(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>zv);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage("CHANNEL REMOVED")})}),toggleChannelMute:a=>{let n=!1;e(e=>{e.patterns.forEach(e=>{a>=0&&a<e.channels.length&&(e.channels[a].muted=!e.channels[a].muted,n=e.channels[a].muted)})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){Qg().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&ja(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>zv);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(n?"MUTED":"UNMUTED")})},toggleChannelSolo:a=>{let n=!1;e(e=>{e.patterns.forEach(e=>{if(a>=0&&a<e.channels.length){const t=e.channels[a].solo;e.channels.forEach(e=>{e.solo=!1}),t||(e.channels[a].solo=!0,n=!0)}})});const s=t(),r=s.patterns[s.currentPatternIndex];if(r){Qg().updateMuteStates(r.channels.map(e=>({muted:e.muted,solo:e.solo})))}"undefined"!=typeof window&&ja(async()=>{const{useUIStore:e}=await Promise.resolve().then(()=>zv);return{useUIStore:e}},void 0).then(({useUIStore:e})=>{e.getState().setStatusMessage(n?"SOLO ON":"SOLO OFF")})},toggleChannelCollapse:t=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].collapsed=!e.channels[t].collapsed)})}),setChannelVolume:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].volume=Math.max(0,Math.min(100,a)))})}),setChannelPan:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].pan=Math.max(-100,Math.min(100,a)))})}),setChannelColor:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].color=a)})}),setChannelRows:(t,a)=>e(e=>{const n=e.patterns[e.currentPatternIndex];if(t>=0&&t<n.channels.length){const e=[...a];for(;e.length<n.length;)e.push({...dn});n.channels[t].rows=e.slice(0,n.length)}}),reorderChannel:(t,a)=>e(e=>{e.patterns.forEach(e=>{if(t>=0&&t<e.channels.length&&a>=0&&a<e.channels.length&&t!==a){const[n]=e.channels.splice(t,1);e.channels.splice(a,0,n)}}),e.cursor.channelIndex===t?e.cursor.channelIndex=a:t<e.cursor.channelIndex&&a>=e.cursor.channelIndex?e.cursor.channelIndex--:t>e.cursor.channelIndex&&a<=e.cursor.channelIndex&&e.cursor.channelIndex++}),setChannelRecordGroup:(t,a)=>e(e=>{e.patterns.forEach(e=>{t>=0&&t<e.channels.length&&(e.channels[t].recordGroup=a)})}),getChannelsInRecordGroup:e=>{const a=t(),n=a.patterns[a.currentPatternIndex];return n?n.channels.map((t,a)=>t.recordGroup===e?a:-1).filter(e=>e>=0):[]},loadPatterns:t=>e(e=>{if(t.length>0){const a=t.map(e=>({...e,length:Math.max(1,e.length),channels:e.channels.map(e=>({...e,color:e.color??null}))}));e.patterns=a,e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null}}),setPatternOrder:t=>e(e=>{t.length>0&&(e.patternOrder=t,e.currentPositionIndex=0)}),setOriginalModuleData:t=>e(e=>{e.originalModuleData=t}),importPattern:a=>{const n=t().patterns.length;return e(e=>{const t={...a,length:Math.max(1,a.length),channels:a.channels.map(e=>({...e,color:e.color??null}))};e.patterns.push(t)}),n},replacePattern:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&(e.patterns[t]=structuredClone(a))}),addToOrder:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&(void 0!==a&&a>=0&&a<=e.patternOrder.length?e.patternOrder.splice(a,0,t):e.patternOrder.push(t))}),removeFromOrder:t=>e(e=>{t>=0&&t<e.patternOrder.length&&e.patternOrder.length>1&&(e.patternOrder.splice(t,1),e.currentPositionIndex>=e.patternOrder.length&&(e.currentPositionIndex=e.patternOrder.length-1))}),insertInOrder:(t,a)=>e(e=>{t>=0&&t<e.patterns.length&&a>=0&&a<=e.patternOrder.length&&e.patternOrder.splice(a,0,t)}),duplicatePosition:t=>e(e=>{if(t>=0&&t<e.patternOrder.length){const a=e.patternOrder[t];e.patternOrder.splice(t+1,0,a)}}),clearOrder:()=>e(e=>{e.patternOrder=[0],e.currentPositionIndex=0}),reorderPositions:(t,a)=>e(e=>{if(t>=0&&t<e.patternOrder.length&&a>=0&&a<e.patternOrder.length){const[n]=e.patternOrder.splice(t,1);e.patternOrder.splice(a,0,n),e.currentPositionIndex===t?e.currentPositionIndex=a:t<e.currentPositionIndex&&a>=e.currentPositionIndex?e.currentPositionIndex--:t>e.currentPositionIndex&&a<=e.currentPositionIndex&&e.currentPositionIndex++}}),setCurrentPosition:t=>e(e=>{t>=0&&t<e.patternOrder.length&&(e.currentPositionIndex=t,e.currentPatternIndex=e.patternOrder[t])}),reset:()=>e(e=>{e.patterns=[ib()],e.currentPatternIndex=0,e.cursor={channelIndex:0,rowIndex:0,columnType:"note",digitIndex:0},e.selection=null,e.clipboard=null,e.trackClipboard=null,e.currentOctave=4,e.recordMode=!1,e.editStep=1,e.insertMode=!1,e.columnVisibility={...un},e.copyMask=nb,e.pasteMask=nb,e.transposeMask=1,e.macroSlots=Array.from({length:8},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),e.patternOrder=[0],e.currentPositionIndex=0})}))),lb=Object.freeze(Object.defineProperty({__proto__:null,MASK_ALL:nb,MASK_EFFECT:8,MASK_EFFECT2:ab,MASK_INSTRUMENT:2,MASK_NOTE:1,MASK_VOLUME:4,hasMaskBit:sb,toggleMaskBit:rb,useTrackerStore:ob},Symbol.toStringTag,{value:"Module"})),cb={enabled:!0,oversamplingOrder:2,filterSelect:0,normalDecay:.164,accentDecay:.006,softAttack:0,accentSoftAttack:.1,passbandCompensation:.09,resTracking:.257,filterInputDrive:.169,diodeCharacter:1,duffingAmount:.03,filterFmDepth:0,lpBpMix:0,filterTracking:0,stageNLAmount:0,ensembleAmount:0,accentSweepEnabled:!0,sweepSpeed:"normal",highResonance:!1,muffler:"off",vegDecay:.5,vegSustain:0},ub=[{type:"synth",name:"DB303 Default",synthType:"TB303",tb303:{engineType:"db303",volume:1,oscillator:{type:"sawtooth",pulseWidth:0,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.5},accent:{amount:.5},slide:{time:.17,mode:"exponential"},devilFish:{...cb},lfo:{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0},chorus:{enabled:!1,mode:0,mix:.5},phaser:{enabled:!1,rate:.5,depth:.7,feedback:0,mix:0},delay:{enabled:!1,time:3,feedback:.3,tone:.5,mix:0,stereo:.5}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Classic",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.65},filterEnvelope:{envMod:.6,decay:.3},accent:{amount:.7},slide:{time:.17,mode:"exponential"},devilFish:{...cb}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Squelchy",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.82},filterEnvelope:{envMod:.85,decay:.4},accent:{amount:.9},slide:{time:.15,mode:"exponential"},devilFish:{...cb,filterInputDrive:.15,normalDecay:.2}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Deep Sub",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.15,resonance:.35},filterEnvelope:{envMod:.25,decay:.2},accent:{amount:.45},slide:{time:.3,mode:"exponential"},devilFish:{...cb}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Square",synthType:"TB303",tb303:{volume:1,oscillator:{type:"square"},filter:{cutoff:.45,resonance:.68},filterEnvelope:{envMod:.55,decay:.25},accent:{amount:.65},slide:{time:.15,mode:"exponential"},devilFish:{...cb}},effects:[],volume:0,pan:0},{type:"synth",name:"303 Screamer",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.35,resonance:.92},filterEnvelope:{envMod:.95,decay:.4},accent:{amount:1},slide:{time:.1,mode:"exponential"},devilFish:{...cb,filterInputDrive:.4,duffingAmount:.3,normalDecay:.15,accentDecay:.003}},effects:[],volume:0,pan:0},{type:"synth",name:"DF Chaos Engine",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.5,resonance:.8},filterEnvelope:{envMod:.75,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"},devilFish:{...cb,normalDecay:.12,accentDecay:.015,softAttack:.05,filterTracking:.6,filterFmDepth:.5,filterInputDrive:.35,diodeCharacter:.4,duffingAmount:.5,sweepSpeed:"fast"}},effects:[],volume:0,pan:0},{type:"synth",name:"DF Acid Burn",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.88},filterEnvelope:{envMod:.9,decay:.35},accent:{amount:.95},slide:{time:.12,mode:"exponential"},devilFish:{...cb,filterInputDrive:.5,duffingAmount:.2,normalDecay:.15,accentDecay:.005}},effects:[],volume:0,pan:0},{type:"synth",name:"Acid RAT",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.55,resonance:.75},filterEnvelope:{envMod:.7,decay:.35},accent:{amount:.85},slide:{time:.12,mode:"exponential"},devilFish:{...cb,filterInputDrive:.2}},effects:[{id:"acid-rat-neural",category:"neural",type:"Neural",enabled:!0,wet:60,parameters:{gain:.55},neuralModelIndex:1,neuralModelName:"ProCo RAT"},{id:"acid-rat-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:0,pan:0},{type:"synth",name:"Acid DS-1",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.5,resonance:.7},filterEnvelope:{envMod:.65,decay:.3},accent:{amount:.8},slide:{time:.15,mode:"exponential"},devilFish:{...cb,filterInputDrive:.15}},effects:[{id:"acid-ds1-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:50,parameters:{distortion:.5,oversample:"2x"}},{id:"acid-ds1-eq",category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:0,mid:3,high:1}},{id:"acid-ds1-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}],volume:0,pan:0},{type:"synth",name:"Acid Warm",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.45,resonance:.6},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.65},slide:{time:.2,mode:"exponential"},devilFish:{...cb}},effects:[{id:"acid-warm-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:60,parameters:{drive:.35,tone:8e3}},{id:"acid-warm-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}}],volume:0,pan:0},{type:"synth",name:"Acid Dub",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.35,resonance:.55},filterEnvelope:{envMod:.45,decay:.5},accent:{amount:.6},slide:{time:.25,mode:"exponential"},devilFish:{...cb}},effects:[{id:"acid-dub-tape",category:"tonejs",type:"TapeSaturation",enabled:!0,wet:30,parameters:{drive:.2,tone:1e4}},{id:"acid-dub-echo",category:"tonejs",type:"SpaceEcho",enabled:!0,wet:35,parameters:{mode:4,rate:400,intensity:.5,echoVolume:.7,reverbVolume:.2}},{id:"acid-dub-spring",category:"wasm",type:"SpringReverb",enabled:!0,wet:25,parameters:{decay:.6,damping:.5,tension:.4,mix:.5,drip:.3}}],volume:0,pan:0},{type:"synth",name:"Acid Echo",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth",pulseWidth:1,subOscGain:0,subOscBlend:1},filter:{cutoff:.5,resonance:.5},filterEnvelope:{envMod:.5,decay:.4},accent:{amount:.5},slide:{time:.17,mode:"exponential"},devilFish:{...cb},delay:{enabled:!0,time:.3,feedback:.3,tone:.5,mix:.5,stereo:.75}},effects:[],volume:0,pan:0},{type:"synth",name:"Acid Trance",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.6,resonance:.72},filterEnvelope:{envMod:.75,decay:.4},accent:{amount:.8},slide:{time:.15,mode:"exponential"},devilFish:{...cb,filterInputDrive:.1}},effects:[{id:"acid-trance-dist",category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.35}},{id:"acid-trance-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:25,parameters:{time:.375,feedback:.45}},{id:"acid-trance-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:30,parameters:{decay:3,preDelay:.03}}],volume:0,pan:0},{type:"synth",name:"Acid Techno",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.65,resonance:.85},filterEnvelope:{envMod:.85,decay:.35},accent:{amount:.9},slide:{time:.1,mode:"exponential"},devilFish:{...cb,filterInputDrive:.3,diodeCharacter:.15,normalDecay:.3}},effects:[{id:"acid-techno-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:6,attack:.002,release:.1}}],volume:0,pan:0},{type:"synth",name:"Acid Industrial",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.45,resonance:.85},filterEnvelope:{envMod:.9,decay:.45},accent:{amount:.95},slide:{time:.08,mode:"exponential"},devilFish:{...cb,filterInputDrive:.6,diodeCharacter:.5,duffingAmount:.6,normalDecay:.12,accentDecay:.008}},effects:[{id:"acid-ind-comp",category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}}],volume:0,pan:0},{type:"synth",name:"Acid Space",synthType:"TB303",tb303:{volume:1,oscillator:{type:"sawtooth"},filter:{cutoff:.4,resonance:.5},filterEnvelope:{envMod:.4,decay:.55},accent:{amount:.5},slide:{time:.3,mode:"exponential"},devilFish:{...cb}},effects:[{id:"acid-space-chorus",category:"tonejs",type:"Chorus",enabled:!0,wet:25,parameters:{frequency:.4,depth:.4}},{id:"acid-space-ppd",category:"tonejs",type:"PingPongDelay",enabled:!0,wet:35,parameters:{time:.5,feedback:.5}},{id:"acid-space-reverb",category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}}],volume:0,pan:0}],db=(e={})=>({enabled:!0,am:!1,ar:31,dr:0,mult:1,rr:15,sl:0,tl:0,dt2:0,rs:0,dt:0,d2r:0,ssg:0,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0,...e}),pb=()=>db({enabled:!1,tl:127,ar:0,rr:0}),mb=[{name:"Genesis Bass",type:"synth",synthType:"FurnaceOPN",volume:-6,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:5,operators:[db({mult:1,tl:20,ar:31,dr:8,sl:2,rr:8}),db({mult:2,tl:30,ar:31,dr:12,sl:4,rr:6,dt:3}),db({mult:1,tl:25,ar:31,dr:10,sl:3,rr:8}),db({mult:4,tl:35,ar:28,dr:15,sl:5,rr:10,dt:-1})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Lead",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:5,feedback:6,operators:[db({mult:1,tl:10,ar:31,dr:4,sl:1,rr:6}),db({mult:3,tl:35,ar:31,dr:8,sl:3,rr:8,dt:2}),db({mult:2,tl:30,ar:31,dr:6,sl:2,rr:8,dt:-2}),db({mult:1,tl:15,ar:31,dr:10,sl:4,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Brass",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:2,feedback:7,operators:[db({mult:1,tl:25,ar:28,dr:10,sl:4,rr:8}),db({mult:1,tl:20,ar:31,dr:8,sl:3,rr:10}),db({mult:2,tl:30,ar:31,dr:12,sl:5,rr:8,dt:1}),db({mult:1,tl:15,ar:25,dr:6,sl:2,rr:6})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Bell",type:"synth",synthType:"FurnaceOPN",volume:-10,pan:0,effects:[],furnace:{chipType:0,algorithm:4,feedback:0,operators:[db({mult:1,tl:15,ar:31,dr:8,sl:0,rr:10}),db({mult:7,tl:40,ar:31,dr:12,sl:2,rr:12,dt:3}),db({mult:1,tl:20,ar:31,dr:10,sl:1,rr:10}),db({mult:14,tl:45,ar:31,dr:15,sl:3,rr:14,dt:-2})],macros:[],opMacros:[],wavetables:[]}},{name:"Genesis Strings",type:"synth",synthType:"FurnaceOPN",volume:-8,pan:0,effects:[],furnace:{chipType:0,algorithm:1,feedback:3,operators:[db({mult:1,tl:20,ar:20,dr:5,sl:2,rr:8}),db({mult:2,tl:35,ar:25,dr:8,sl:4,rr:10,dt:1}),db({mult:1,tl:25,ar:22,dr:6,sl:3,rr:8,dt:-1}),db({mult:3,tl:40,ar:28,dr:10,sl:5,rr:12,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Synth Lead",type:"synth",synthType:"FurnaceOPM",volume:-8,pan:0,effects:[],furnace:{chipType:33,algorithm:5,feedback:6,operators:[db({mult:1,tl:15,ar:31,dr:5,sl:1,rr:6}),db({mult:3,tl:40,ar:31,dr:8,sl:3,rr:8,dt:2}),db({mult:2,tl:35,ar:31,dr:10,sl:4,rr:8,dt:-2}),db({mult:1,tl:25,ar:31,dr:12,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Electric Piano",type:"synth",synthType:"FurnaceOPM",volume:-10,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:2,operators:[db({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),db({mult:14,tl:50,ar:31,dr:15,sl:5,rr:10}),db({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),db({mult:1,tl:45,ar:31,dr:18,sl:6,rr:12,dt:1})],macros:[],opMacros:[],wavetables:[]}},{name:"OPM Metallic Drum",type:"synth",synthType:"FurnaceOPM",volume:-6,pan:0,effects:[],furnace:{chipType:33,algorithm:4,feedback:7,operators:[db({mult:1,tl:20,ar:31,dr:15,sl:0,rr:15}),db({mult:5,tl:30,ar:31,dr:12,sl:0,rr:15,dt:2}),db({mult:9,tl:40,ar:31,dr:10,sl:0,rr:15,dt:-2}),db({mult:2,tl:50,ar:31,dr:8,sl:0,rr:15})],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Organ",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:3,operators:[db({mult:2,tl:30,ar:15,dr:4,sl:8,rr:5,ws:1}),db({mult:1,tl:0,ar:15,dr:2,sl:4,rr:8,ws:0}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Slap Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:5,operators:[db({mult:4,tl:35,ar:15,dr:6,sl:3,rr:4,ws:0}),db({mult:1,tl:0,ar:15,dr:3,sl:2,rr:6,ws:0}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Bass Drum",type:"synth",synthType:"FurnaceOPL",volume:-4,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[db({mult:1,tl:10,ar:31,dr:6,sl:2,rr:6,ws:0}),db({mult:0,tl:0,ar:31,dr:8,sl:0,rr:8,ws:0}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Snare",type:"synth",synthType:"FurnaceOPL",volume:-6,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:0,operators:[db({mult:1,tl:5,ar:31,dr:10,sl:0,rr:10,ws:3}),db({mult:4,tl:20,ar:31,dr:8,sl:0,rr:8,ws:0}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"OPL3 Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:14,algorithm:0,feedback:4,operators:[db({mult:1,tl:25,ar:12,dr:5,sl:5,rr:6,ws:0}),db({mult:1,tl:5,ar:14,dr:4,sl:3,rr:8,ws:0}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[db({mult:1,tl:0,ar:31,dr:0,sl:0,rr:12}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[db({mult:1,tl:5,ar:31,dr:4,sl:2,rr:8}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"NES Triangle",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:34,algorithm:7,feedback:0,operators:[db({mult:1,tl:8,ar:31,dr:2,sl:1,rr:10}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Pulse",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[db({mult:1,tl:5,ar:28,dr:2,sl:2,rr:10}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[db({mult:1,tl:8,ar:31,dr:5,sl:3,rr:8}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"GB Arp Lead",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:2,algorithm:7,feedback:0,operators:[db({mult:1,tl:3,ar:31,dr:3,sl:1,rr:12}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[db({mult:1,tl:8,ar:31,dr:4,sl:3,rr:8}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:8,algorithm:7,feedback:0,operators:[db({mult:1,tl:12,ar:31,dr:6,sl:4,rr:6}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"6581 Pulse Lead",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1200,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Saw Lead",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Saw Bass",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:14,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:512,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Pulse Bass",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:15,r:3,duty:1024,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:400,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Arp Pulse",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:4,s:0,r:2,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Noise Snare",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:4,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:2,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Kick",type:"synth",synthType:"FurnaceSID6581",volume:-4,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:6,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:300,filterResonance:0,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Ring Mod",type:"synth",synthType:"FurnaceSID6581",volume:-10,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:8,s:8,r:6,duty:0,ringMod:!0,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Filter Sweep",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:2,d:10,s:6,r:8,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:900,filterResonance:12,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"6581 Pad",type:"synth",synthType:"FurnaceSID6581",volume:-10,pan:0,effects:[],furnace:{chipType:45,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:8,d:6,s:10,r:10,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:700,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Pulse Lead",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1400,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Saw Lead",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Saw Bass",type:"synth",synthType:"FurnaceSID8580",volume:-6,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:14,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:600,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Pulse Bass",type:"synth",synthType:"FurnaceSID8580",volume:-6,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:15,r:3,duty:1024,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:500,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Arp Saw",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:3,s:0,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Hi-Hat",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:2,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1200,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!0,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Sync Lead",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!0,toFilter:!0,initFilter:!0,filterCutoff:1e3,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"8580 Pad",type:"synth",synthType:"FurnaceSID8580",volume:-10,pan:0,effects:[],furnace:{chipType:46,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:8,d:6,s:10,r:10,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1},macros:[],opMacros:[],wavetables:[]}},{name:"AY Buzzy Lead",type:"synth",synthType:"FurnaceAY",volume:-8,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:1,operators:[db({mult:1,tl:10,ar:31,dr:6,d2r:2,sl:4,rr:6}),db({mult:3,tl:50,ar:31,dr:8,sl:8,rr:10}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"AY Square Bass",type:"synth",synthType:"FurnaceAY",volume:-6,pan:0,effects:[],furnace:{chipType:5,algorithm:7,feedback:0,operators:[db({mult:1,tl:15,ar:31,dr:8,sl:5,rr:5}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:4,algorithm:6,feedback:2,operators:[db({mult:1,tl:12,ar:31,dr:5,sl:2,rr:8}),db({mult:2,tl:40,ar:31,dr:8,sl:4,rr:10}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:4,algorithm:7,feedback:0,operators:[db({mult:1,tl:8,ar:31,dr:6,sl:3,rr:6}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Pulse Lead",type:"synth",synthType:"FurnaceVRC6",volume:-8,pan:0,effects:[],furnace:{chipType:21,algorithm:5,feedback:0,operators:[db({mult:1,tl:5,ar:31,dr:3,sl:1,rr:10}),db({mult:2,tl:30,ar:31,dr:6,sl:3,rr:12}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"VRC6 Saw Bass",type:"synth",synthType:"FurnaceVRC6",volume:-6,pan:0,effects:[],furnace:{chipType:21,algorithm:7,feedback:0,operators:[db({mult:1,tl:10,ar:31,dr:5,sl:2,rr:8}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"N163 Wave Lead",type:"synth",synthType:"FurnaceN163",volume:-8,pan:0,effects:[],furnace:{chipType:22,algorithm:7,feedback:0,operators:[db({mult:1,tl:8,ar:31,dr:4,sl:2,rr:8}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[{id:0,data:[8,10,12,14,15,14,12,10,8,6,4,2,1,2,4,6]}]}},{name:"TIA Buzzy",type:"synth",synthType:"FurnaceTIA",volume:-10,pan:0,effects:[],furnace:{chipType:38,algorithm:7,feedback:7,operators:[db({mult:1,tl:20,ar:31,dr:15,d2r:5,sl:8,rr:4}),db({mult:5,tl:45,ar:31,dr:20,sl:10,rr:6,dt:2}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"VERA PSG Lead",type:"synth",synthType:"FurnaceVERA",volume:-8,pan:0,effects:[],furnace:{chipType:42,algorithm:7,feedback:0,operators:[db({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"SCC Wave",type:"synth",synthType:"FurnaceSCC",volume:-8,pan:0,effects:[],furnace:{chipType:10,algorithm:7,feedback:0,operators:[db({mult:1,tl:8,ar:31,dr:5,sl:2,rr:10}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[{id:0,data:[0,32,64,96,127,96,64,32,0,-32,-64,-96,-127,-96,-64,-32]}]}},{name:"OPLL Piano",type:"synth",synthType:"FurnaceOPLL",volume:-10,pan:0,effects:[],furnace:{chipType:9,algorithm:0,feedback:2,operators:[db({mult:4,tl:35,ar:15,dr:5,sl:6,rr:7}),db({mult:1,tl:0,ar:15,dr:3,sl:3,rr:6}),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Pad",type:"synth",synthType:"FurnaceSNES",volume:-10,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[db({mult:1,tl:12,ar:20,dr:4,sl:2,rr:12}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"SNES Bass",type:"synth",synthType:"FurnaceSNES",volume:-6,pan:0,effects:[],furnace:{chipType:41,algorithm:7,feedback:0,operators:[db({mult:1,tl:8,ar:31,dr:6,sl:3,rr:8}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"FDS Wave",type:"synth",synthType:"FurnaceFDS",volume:-8,pan:0,effects:[],furnace:{chipType:23,algorithm:7,feedback:0,operators:[db({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[{id:0,data:[32,40,48,56,63,56,48,40,32,24,16,8,0,8,16,24]}]}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:32,algorithm:7,feedback:0,operators:[db({mult:1,tl:12,ar:31,dr:5,sl:3,rr:8}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"SAA Square",type:"synth",synthType:"FurnaceSAA",volume:-8,pan:0,effects:[],furnace:{chipType:31,algorithm:7,feedback:0,operators:[db({mult:1,tl:10,ar:31,dr:4,sl:2,rr:10}),pb(),pb(),pb()],macros:[],opMacros:[],wavetables:[]}},{name:"ESFM Lead",type:"synth",synthType:"FurnaceESFM",volume:-8,pan:0,effects:[],furnace:{chipType:48,algorithm:5,feedback:5,operators:[db({mult:1,tl:15,ar:15,dr:4,sl:2,rr:6}),db({mult:3,tl:35,ar:15,dr:6,sl:4,rr:8,dt:1}),db({mult:2,tl:30,ar:15,dr:5,sl:3,rr:8}),db({mult:1,tl:20,ar:15,dr:8,sl:5,rr:10,am:!0})],macros:[],opMacros:[],wavetables:[]}},{name:"OPZ E.Piano",type:"synth",synthType:"FurnaceOPZ",volume:-10,pan:0,effects:[],furnace:{chipType:40,algorithm:4,feedback:3,operators:[db({mult:1,tl:18,ar:31,dr:10,sl:3,rr:8}),db({mult:14,tl:48,ar:31,dr:14,sl:5,rr:10,dt:1}),db({mult:1,tl:20,ar:31,dr:12,sl:4,rr:10}),db({mult:1,tl:45,ar:31,dr:16,sl:6,rr:12})],macros:[],opMacros:[],wavetables:[]}}],hb=[{type:"synth",name:"Classic Siren",synthType:"DubSiren",dubSiren:{...jn,oscillator:{type:"sine",frequency:440},lfo:{enabled:!0,type:"triangle",rate:2,depth:200},delay:{enabled:!0,time:.3,feedback:.4,wet:.3},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!1,decay:1.5,wet:.2}},effects:[],volume:-10,pan:0},{type:"synth",name:"Code Red",synthType:"DubSiren",dubSiren:{...jn,oscillator:{type:"square",frequency:600},lfo:{enabled:!0,type:"square",rate:8,depth:100},delay:{enabled:!1,time:.1,feedback:0,wet:0},filter:{enabled:!1,type:"lowpass",frequency:2e3,rolloff:-24},reverb:{enabled:!0,decay:2,wet:.4}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Echo",synthType:"DubSiren",dubSiren:{...jn,oscillator:{type:"sawtooth",frequency:220},lfo:{enabled:!0,type:"sine",rate:.5,depth:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},filter:{enabled:!0,type:"highpass",frequency:300,rolloff:-12},reverb:{enabled:!0,decay:4,wet:.6}},effects:[],volume:-12,pan:0},{type:"synth",name:"Air Horn",synthType:"DubSiren",dubSiren:{...jn,oscillator:{type:"sawtooth",frequency:150},lfo:{enabled:!0,type:"sawtooth",rate:15,depth:20},delay:{enabled:!0,time:.15,feedback:.2,wet:.2},filter:{enabled:!0,type:"lowpass",frequency:1200,rolloff:-12},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0}],fb=[{type:"synth",name:"Standard Zap",synthType:"SpaceLaser",spaceLaser:{...Un,laser:{startFreq:4e3,endFreq:150,sweepTime:150,sweepCurve:"exponential"},fm:{amount:30,ratio:2},noise:{amount:5,type:"white"},filter:{type:"bandpass",cutoff:2e3,resonance:30}},effects:[],volume:-10,pan:0},{type:"synth",name:"Cosmic Burst",synthType:"SpaceLaser",spaceLaser:{...Un,laser:{startFreq:8e3,endFreq:400,sweepTime:300,sweepCurve:"exponential"},fm:{amount:60,ratio:4.5},noise:{amount:20,type:"pink"},filter:{type:"highpass",cutoff:1e3,resonance:50},delay:{enabled:!0,time:.4,feedback:.7,wet:.5},reverb:{enabled:!0,decay:4,wet:.4}},effects:[],volume:-12,pan:0},{type:"synth",name:"Anime Pew",synthType:"SpaceLaser",spaceLaser:{...Un,laser:{startFreq:6e3,endFreq:2e3,sweepTime:80,sweepCurve:"exponential"},fm:{amount:80,ratio:8},noise:{amount:0,type:"white"},filter:{type:"bandpass",cutoff:4e3,resonance:60},delay:{enabled:!0,time:.1,feedback:.3,wet:.3},reverb:{enabled:!1,decay:1,wet:0}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Blaster",synthType:"SpaceLaser",spaceLaser:{...Un,laser:{startFreq:1500,endFreq:40,sweepTime:500,sweepCurve:"linear"},fm:{amount:20,ratio:1.5},noise:{amount:40,type:"brown"},filter:{type:"lowpass",cutoff:800,resonance:40},delay:{enabled:!0,time:.33,feedback:.6,wet:.6},reverb:{enabled:!0,decay:2.5,wet:.3}},effects:[],volume:-10,pan:0}],yb={type:"synth",name:"V2 Trance Lead",synthType:"V2",v2:{...zn,osc1:{mode:1,detune:0,transpose:0,color:64,level:100},osc2:{mode:1,ringMod:!1,detune:15,transpose:0,color:64,level:80},filter1:{mode:1,cutoff:80,resonance:40},envelope:{attack:5,decay:60,sustain:40,release:40}},effects:[],volume:-10,pan:0},gb={type:"synth",name:"V2 Silk Pad",synthType:"V2",v2:{...zn,osc1:{mode:1,detune:5,transpose:0,color:64,level:60},osc2:{mode:3,ringMod:!1,detune:0,transpose:12,color:64,level:40},filter1:{mode:1,cutoff:40,resonance:20},envelope:{attack:80,decay:100,sustain:100,release:100}},effects:[],volume:-12,pan:0},bb={type:"synth",name:"V2 4k Bass",synthType:"V2",v2:{...zn,osc1:{mode:1,detune:0,transpose:-12,color:64,level:100},osc2:{mode:2,ringMod:!1,detune:0,transpose:-12,color:64,level:60},filter1:{mode:1,cutoff:30,resonance:60},envelope:{attack:0,decay:40,sustain:0,release:10}},effects:[],volume:-8,pan:0},vb={type:"synth",name:"V2 4k Kick",synthType:"V2",v2:{...zn,osc1:{mode:3,detune:0,transpose:-24,color:64,level:120},filter1:{mode:1,cutoff:20,resonance:40},envelope:{attack:0,decay:30,sustain:0,release:10}},effects:[],volume:-6,pan:0},xb={type:"synth",name:"V2 Noise Snare",synthType:"V2",v2:{...zn,osc1:{mode:4,detune:0,transpose:0,color:64,level:100},filter1:{mode:2,cutoff:60,resonance:20},envelope:{attack:0,decay:45,sustain:0,release:20}},effects:[],volume:-10,pan:0},wb={type:"synth",name:"V2 Metal Hat",synthType:"V2",v2:{...zn,osc1:{mode:4,detune:0,transpose:0,color:64,level:80},filter1:{mode:3,cutoff:100,resonance:10},envelope:{attack:0,decay:15,sustain:0,release:10}},effects:[],volume:-14,pan:0},kb=[yb,gb,bb,vb,xb,wb,{type:"synth",name:"V2 Retro Zap",synthType:"V2",v2:{...zn,osc1:{mode:1,detune:0,transpose:12,color:64,level:100},filter1:{mode:1,cutoff:120,resonance:80},envelope:{attack:0,decay:25,sustain:0,release:10}},effects:[],volume:-10,pan:0},{name:"V2 Speech",type:"synth",synthType:"V2Speech",volume:-6,pan:0,effects:[],parameters:{text:"Ready"}}],Sb=[{type:"synth",name:"Disco Tom",synthType:"Synare",synare:{...Gn,oscillator:{type:"square",tune:150,fine:0},sweep:{enabled:!0,amount:24,time:200},envelope:{decay:400,sustain:0},noise:{enabled:!1,type:"white",mix:0,color:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"Dub Perc",synthType:"Synare",synare:{...Gn,oscillator:{type:"square",tune:80,fine:0},sweep:{enabled:!0,amount:12,time:100},filter:{cutoff:400,resonance:85,envMod:80,decay:150},envelope:{decay:200,sustain:0},noise:{enabled:!0,type:"white",mix:.1,color:50}},effects:[],volume:-10,pan:0},{type:"synth",name:"Synare Snare",synthType:"Synare",synare:{...Gn,oscillator:{type:"square",tune:220,fine:0},noise:{enabled:!0,type:"white",mix:.6,color:80},filter:{cutoff:2e3,resonance:30,envMod:40,decay:100},envelope:{decay:150,sustain:0},sweep:{enabled:!1,amount:0,time:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Space Zap",synthType:"Synare",synare:{...Gn,oscillator:{type:"square",tune:600,fine:0},sweep:{enabled:!0,amount:48,time:300},lfo:{enabled:!0,rate:12,depth:50,target:"pitch"},envelope:{decay:500,sustain:0}},effects:[],volume:-12,pan:0}],Mb=(e,t,a)=>({id:`map-${e}-${Date.now()}-${Math.random()}`,noteStart:e,noteEnd:e,sampleId:t,sampleName:t,sampleUrl:`data/samples/packs/drumnibus/${a}`,pitchOffset:0,fineTune:0,volumeOffset:0,panOffset:0}),Nb=(e,t)=>({type:"synth",name:e,synthType:"DrumKit",drumKit:{keymap:t,polyphony:"poly",maxVoices:8,noteCut:!0},effects:[],volume:-6,pan:0}),Cb=[Mb(36,"Kick","kicks/BD_808A1200.wav"),Mb(38,"Snare","snares/SD_Analog Noise1.wav"),Mb(39,"Clap","percussion/CLAP_Juxtapos.wav"),Mb(42,"Closed Hat","hihats/CH_AnalogHihat1.wav"),Mb(46,"Open Hat","hihats/OH_AnalogOpenhatwav.wav"),Mb(41,"Tom Low","percussion/TOM_Warped.wav"),Mb(45,"Tom Mid","percussion/TOM_Stofelectro1.wav"),Mb(49,"Crash","hihats/CYM_Synthique.wav"),Mb(51,"Ride","hihats/CYM_Magnotron.wav"),Mb(60,"FX","fx/FX_AnalogFX1.wav")],Pb=[Mb(36,"Kick","kicks/BD_Digidap.wav"),Mb(38,"Snare","snares/SD_Digidap.wav"),Mb(39,"Clap","percussion/CLAP_Punchtron.wav"),Mb(42,"Closed Hat","hihats/CH_Digidap.wav"),Mb(46,"Open Hat","hihats/OH_Digidap.wav"),Mb(41,"Tom","percussion/TOM_Punchtron.wav"),Mb(49,"Crash","hihats/CYM_Punchtron.wav"),Mb(60,"Zap","fx/FX_Digidap2.wav")],Eb=[Mb(36,"Kick","kicks/BD_LofiHuman.wav"),Mb(38,"Snare","snares/SD_LofiHuman.wav"),Mb(39,"Clap","percussion/CLAP_LofiHuman.wav"),Mb(42,"Closed Hat","hihats/CH_LofiHuman.wav"),Mb(46,"Open Hat","hihats/OH_LofiHuman.wav"),Mb(41,"Tom","percussion/TOM_LofiHuman.wav"),Mb(60,"Vocal FX","fx/FX_LofiHuman.wav")],_b=[Mb(36,"Kick","kicks/BD_Pziforze.wav"),Mb(38,"Snare","snares/SD_Wolf 3.wav"),Mb(39,"Clap","percussion/CLAP_Magnotron.wav"),Mb(42,"Closed Hat","hihats/CH_Magnotron.wav"),Mb(46,"Open Hat","hihats/OH_Magnotron.wav"),Mb(41,"Tom Low","percussion/TOM_Magnotron.wav"),Mb(49,"Crash","hihats/CYM_Magnotron.wav"),Mb(60,"Rumble FX","fx/FX_Magstorm1.wav")],Tb=[Nb("Drumnibus Analog",Cb),Nb("Drumnibus Digital",Pb),Nb("Drumnibus LoFi",Eb),Nb("Drumnibus Techno",_b)],Ab=[{type:"synth",name:"SP_TheProduct",synthType:"V2",v2Speech:{text:"!DHAX_ !prAA_dAHkt",speed:64,pitch:40,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP_Demoscene",synthType:"V2",v2Speech:{text:"!dEH_mOW_sIYn",speed:64,pitch:64,formantShift:64,singMode:!0},effects:[],volume:-10,pan:0},{type:"synth",name:"KY_Rhodesano0",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:0},osc2:{mode:5,ringMod:!1,transpose:0,detune:9,color:0,level:122},osc3:{mode:0,ringMod:!1,transpose:31,detune:29,color:72,level:0},filter1:{mode:1,cutoff:99,resonance:0},filter2:{mode:0,cutoff:94,resonance:99},routing:{mode:1,balance:64},envelope:{attack:13,decay:104,sustain:0,release:44},envelope2:{attack:4,decay:93,sustain:0,release:64},lfo1:{rate:74,depth:75}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_AnaBass#005",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:7,color:0,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:64,level:125},osc3:{mode:0,ringMod:!1,transpose:-12,detune:0,color:0,level:125},filter1:{mode:1,cutoff:52,resonance:91},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_French HornZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Dry BD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:22,level:122},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:0},filter1:{mode:1,cutoff:122,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:5,release:45},envelope2:{attack:0,decay:35,sustain:0,release:33},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Morseh #000",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:-6,detune:0,color:62,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:94,depth:108}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Transortion",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:63,resonance:95},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:90,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Long Pad007",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:16,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-8,color:64,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:4,cutoff:39,resonance:0},filter2:{mode:1,cutoff:35,resonance:69},routing:{mode:1,balance:64},envelope:{attack:71,decay:94,sustain:96,release:106},envelope2:{attack:114,decay:120,sustain:113,release:112},lfo1:{rate:7,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_JarreStrings",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:12,color:1,level:125},osc2:{mode:2,ringMod:!1,transpose:0,detune:0,color:61,level:34},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:5,cutoff:74,resonance:42},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:26,decay:64,sustain:64,release:49},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:78,depth:2}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_His Shadow's Breath",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:4,level:122},osc2:{mode:4,ringMod:!1,transpose:45,detune:0,color:41,level:77},osc3:{mode:1,ringMod:!1,transpose:12,detune:16,color:3,level:122},filter1:{mode:5,cutoff:67,resonance:97},filter2:{mode:2,cutoff:76,resonance:120},routing:{mode:2,balance:64},envelope:{attack:27,decay:64,sustain:122,release:30},envelope2:{attack:0,decay:102,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Deepness001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:14,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-15,color:0,level:126},filter1:{mode:1,cutoff:76,resonance:47},filter2:{mode:1,cutoff:76,resonance:47},routing:{mode:1,balance:42},envelope:{attack:0,decay:14,sustain:115,release:54},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 SD #001",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Marsian Pan Flute",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:28,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:-27,color:64,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:18,resonance:118},filter2:{mode:1,cutoff:100,resonance:70},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:37,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Lullaby09",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:80,resonance:44},filter2:{mode:2,cutoff:115,resonance:108},routing:{mode:2,balance:64},envelope:{attack:0,decay:64,sustain:64,release:75},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Morpher#072",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-8,color:8,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:12,color:24,level:72},osc3:{mode:1,ringMod:!1,transpose:0,detune:-7,color:97,level:126},filter1:{mode:2,cutoff:0,resonance:86},filter2:{mode:2,cutoff:123,resonance:51},routing:{mode:2,balance:63},envelope:{attack:0,decay:25,sustain:126,release:7},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:24,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Jarresque06",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:124},osc2:{mode:4,ringMod:!1,transpose:23,detune:0,color:98,level:49},osc3:{mode:1,ringMod:!1,transpose:12,detune:10,color:6,level:124},filter1:{mode:2,cutoff:68,resonance:0},filter2:{mode:3,cutoff:120,resonance:0},routing:{mode:2,balance:29},envelope:{attack:75,decay:0,sustain:125,release:98},envelope2:{attack:125,decay:125,sustain:125,release:125},lfo1:{rate:10,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"ST_Awaych #000",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-11,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:12,color:0,level:126},filter1:{mode:2,cutoff:86,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:86,decay:114,sustain:109,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:74,depth:23}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Kicking Saw",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:68,resonance:98},filter2:{mode:1,cutoff:62,resonance:105},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:105,depth:32}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Hiphop BaZZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:42,resonance:0},filter2:{mode:2,cutoff:126,resonance:0},routing:{mode:2,balance:64},envelope:{attack:0,decay:12,sustain:64,release:22},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Woodblock",synthType:"V2",v2:{osc1:{mode:3,transpose:12,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:21,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:21,sustain:0,release:25},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Electrons68",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:1,ringMod:!0,transpose:0,detune:-19,color:32,level:125},osc3:{mode:3,ringMod:!0,transpose:31,detune:0,color:114,level:125},filter1:{mode:2,cutoff:67,resonance:95},filter2:{mode:3,cutoff:60,resonance:89},routing:{mode:1,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:91,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Garage Organ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:15,level:125},osc2:{mode:3,ringMod:!1,transpose:48,detune:0,color:32,level:25},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:33},filter1:{mode:1,cutoff:108,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:49,sustain:108,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Lonely Square Lead",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:97},osc2:{mode:2,ringMod:!1,transpose:0,detune:-9,color:64,level:66},osc3:{mode:2,ringMod:!1,transpose:0,detune:6,color:64,level:47},filter1:{mode:2,cutoff:66,resonance:35},filter2:{mode:3,cutoff:98,resonance:10},routing:{mode:2,balance:32},envelope:{attack:0,decay:73,sustain:36,release:55},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Strangeland",synthType:"V2",v2:{osc1:{mode:2,transpose:-12,detune:0,color:2,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:5,color:123,level:126},osc3:{mode:2,ringMod:!1,transpose:0,detune:-9,color:24,level:126},filter1:{mode:3,cutoff:117,resonance:14},filter2:{mode:2,cutoff:91,resonance:15},routing:{mode:2,balance:42},envelope:{attack:10,decay:96,sustain:65,release:102},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:14,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old Saw Percs",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:9,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:23,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:67,resonance:13},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:68},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:50,depth:114}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_SawBass#004",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:4,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:-5,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:0,color:6,level:126},filter1:{mode:1,cutoff:64,resonance:7},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:90,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Ridesecken",synthType:"V2",v2:{osc1:{mode:2,transpose:-4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:4,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:2,cutoff:104,resonance:95},routing:{mode:1,balance:64},envelope:{attack:0,decay:26,sustain:57,release:100},envelope2:{attack:0,decay:90,sustain:0,release:95},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Powerbeam15",synthType:"V2",v2:{osc1:{mode:3,transpose:-45,detune:0,color:0,level:124},osc2:{mode:3,ringMod:!0,transpose:-38,detune:0,color:32,level:124},osc3:{mode:5,ringMod:!1,transpose:-2,detune:0,color:67,level:124},filter1:{mode:1,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:125,sustain:0,release:2},envelope2:{attack:0,decay:125,sustain:0,release:0},lfo1:{rate:94,depth:125}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Glimpse Of a Clavi",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:13,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:82,resonance:102},filter2:{mode:3,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:13},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_PWM Leade)",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:125},osc2:{mode:0,ringMod:!1,transpose:-12,detune:7,color:4,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:73,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:60,decay:114,sustain:80,release:64},envelope2:{attack:126,decay:126,sustain:126,release:0},lfo1:{rate:77,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_LoFi Choir9",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-20,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:82,resonance:98},filter2:{mode:3,cutoff:80,resonance:106},routing:{mode:1,balance:64},envelope:{attack:67,decay:64,sustain:64,release:87},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Old SawsrnZ",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:50},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:10,decay:64,sustain:64,release:64},envelope2:{attack:60,decay:64,sustain:126,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_I like to move it",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-13,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:20,color:32,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:58},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:31},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Industrial VeloHammer",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:15,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:61,resonance:113},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:55,sustain:0,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Rave Siren",synthType:"V2",v2:{osc1:{mode:2,transpose:8,detune:4,color:69,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:53,level:107},osc3:{mode:2,ringMod:!1,transpose:-4,detune:5,color:69,level:126},filter1:{mode:3,cutoff:58,resonance:95},filter2:{mode:2,cutoff:100,resonance:90},routing:{mode:1,balance:64},envelope:{attack:0,decay:13,sustain:28,release:86},envelope2:{attack:0,decay:72,sustain:58,release:73},lfo1:{rate:104,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_Doj's Organ",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:32,level:125},osc2:{mode:3,ringMod:!1,transpose:12,detune:0,color:32,level:125},osc3:{mode:3,ringMod:!1,transpose:36,detune:0,color:32,level:78},filter1:{mode:0,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:38,sustain:107,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Phunny #002",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:26,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:75,resonance:82},filter2:{mode:1,cutoff:64,resonance:0},routing:{mode:2,balance:26},envelope:{attack:7,decay:37,sustain:64,release:53},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:73,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"PA_Fairies#001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:1,level:63},osc2:{mode:1,ringMod:!1,transpose:0,detune:8,color:0,level:63},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:121},filter1:{mode:3,cutoff:42,resonance:101},filter2:{mode:0,cutoff:108,resonance:0},routing:{mode:0,balance:64},envelope:{attack:72,decay:121,sustain:70,release:100},envelope2:{attack:0,decay:125,sustain:56,release:108},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nastyn-303",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-10,color:0,level:125},osc2:{mode:0,ringMod:!1,transpose:0,detune:19,color:0,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:49,resonance:114},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:18},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:61,depth:82}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Squaredance",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:65,level:126},osc3:{mode:2,ringMod:!0,transpose:12,detune:0,color:64,level:22},filter1:{mode:1,cutoff:57,resonance:63},filter2:{mode:2,cutoff:60,resonance:31},routing:{mode:0,balance:64},envelope:{attack:0,decay:26,sustain:100,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Biiiig Drumdamm",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:0,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:81},envelope2:{attack:0,decay:57,sustain:0,release:52},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Random Zaps",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:64,level:0},osc3:{mode:0,ringMod:!1,transpose:44,detune:0,color:53,level:126},filter1:{mode:3,cutoff:80,resonance:51},filter2:{mode:1,cutoff:93,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:126,release:0},envelope2:{attack:0,decay:0,sustain:46,release:3},lfo1:{rate:22,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"KY_What They Called Pian",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:32,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:34,level:124},filter1:{mode:1,cutoff:95,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:79,sustain:64,release:69},envelope2:{attack:96,decay:0,sustain:124,release:62},lfo1:{rate:76,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Debil? ICH?",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:52,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:5,cutoff:97,resonance:62},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:32,sustain:0,release:64},lfo1:{rate:78,depth:113}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Formants From The Cry",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:17,level:126},osc2:{mode:3,ringMod:!0,transpose:36,detune:4,color:112,level:76},osc3:{mode:1,ringMod:!1,transpose:31,detune:0,color:22,level:27},filter1:{mode:2,cutoff:81,resonance:83},filter2:{mode:1,cutoff:73,resonance:104},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_You broke me!bass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:2,level:11},osc2:{mode:1,ringMod:!1,transpose:0,detune:2,color:0,level:10},osc3:{mode:4,ringMod:!1,transpose:6,detune:0,color:53,level:38},filter1:{mode:1,cutoff:78,resonance:30},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:25,depth:117}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Airy HH003",synthType:"V2",v2:{osc1:{mode:4,transpose:35,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:115,resonance:8},filter2:{mode:1,cutoff:116,resonance:24},routing:{mode:1,balance:64},envelope:{attack:0,decay:55,sustain:24,release:37},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:97,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Tag You're Its",synthType:"V2",v2:{osc1:{mode:3,transpose:-6,detune:0,color:60,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:61,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:106,resonance:126},filter2:{mode:3,cutoff:95,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:0,sustain:126,release:10},envelope2:{attack:0,decay:35,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Slow Synthbrass",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:9,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-9,color:0,level:126},filter1:{mode:1,cutoff:74,resonance:24},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:45,decay:66,sustain:64,release:73},envelope2:{attack:98,decay:91,sustain:121,release:72},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Random Arp3",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:126},osc2:{mode:2,ringMod:!1,transpose:0,detune:11,color:18,level:98},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:83},filter2:{mode:0,cutoff:58,resonance:0},routing:{mode:0,balance:64},envelope:{attack:4,decay:50,sustain:0,release:57},envelope2:{attack:0,decay:26,sustain:0,release:31},lfo1:{rate:64,depth:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Analog Mod Bass",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:25,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:19,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:39,resonance:105},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:32,decay:64,sustain:64,release:62},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:97}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_HighSnare02",synthType:"V2",v2:{osc1:{mode:3,transpose:3,detune:0,color:0,level:68},osc2:{mode:3,ringMod:!1,transpose:10,detune:0,color:32,level:64},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:23,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:107,sustain:0,release:64},lfo1:{rate:93,depth:25}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Whistling Wind",synthType:"V2",v2:{osc1:{mode:4,transpose:31,detune:0,color:61,level:126},osc2:{mode:4,ringMod:!1,transpose:-10,detune:-13,color:23,level:126},osc3:{mode:0,ringMod:!1,transpose:24,detune:-5,color:96,level:126},filter1:{mode:4,cutoff:62,resonance:40},filter2:{mode:1,cutoff:80,resonance:53},routing:{mode:1,balance:64},envelope:{attack:46,decay:78,sustain:126,release:66},envelope2:{attack:0,decay:0,sustain:11,release:4},lfo1:{rate:5,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Sweeping Dist",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:11,level:126},osc2:{mode:0,ringMod:!1,transpose:38,detune:0,color:65,level:24},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:66,resonance:126},filter2:{mode:0,cutoff:80,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:13,depth:30}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lofi Squares",synthType:"V2",v2:{osc1:{mode:3,transpose:10,detune:0,color:72,level:126},osc2:{mode:3,ringMod:!0,transpose:12,detune:-1,color:55,level:126},osc3:{mode:2,ringMod:!1,transpose:4,detune:0,color:65,level:126},filter1:{mode:1,cutoff:52,resonance:104},filter2:{mode:2,cutoff:126,resonance:126},routing:{mode:2,balance:64},envelope:{attack:0,decay:41,sustain:43,release:8},envelope2:{attack:0,decay:23,sustain:126,release:14},lfo1:{rate:2,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Not From This World",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:2,color:52,level:126},osc2:{mode:2,ringMod:!0,transpose:4,detune:13,color:23,level:126},osc3:{mode:5,ringMod:!0,transpose:-24,detune:3,color:56,level:126},filter1:{mode:2,cutoff:50,resonance:53},filter2:{mode:2,cutoff:78,resonance:82},routing:{mode:2,balance:63},envelope:{attack:0,decay:83,sustain:126,release:6},envelope2:{attack:0,decay:41,sustain:126,release:10},lfo1:{rate:9,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:-3,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-3,detune:0,color:96,level:126},osc3:{mode:4,ringMod:!1,transpose:21,detune:0,color:36,level:0},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:69,sustain:0,release:55},envelope2:{attack:0,decay:32,sustain:0,release:31},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Mod Perc004",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:10,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:60,resonance:110},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:13,decay:39,sustain:24,release:59},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:0,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Nice Saws87",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:13,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:0,detune:-13,color:0,level:126},filter1:{mode:1,cutoff:126,resonance:107},filter2:{mode:2,cutoff:113,resonance:65},routing:{mode:2,balance:64},envelope:{attack:0,decay:66,sustain:19,release:70},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:12,depth:102}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Roaar! 007",synthType:"V2",v2:{osc1:{mode:1,transpose:12,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:3,color:126,level:126},osc3:{mode:1,ringMod:!1,transpose:-12,detune:-7,color:126,level:26},filter1:{mode:1,cutoff:62,resonance:75},filter2:{mode:3,cutoff:41,resonance:15},routing:{mode:1,balance:64},envelope:{attack:20,decay:64,sustain:126,release:20},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Dist Kick",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_XPlosion007",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:-46,detune:0,color:65,level:126},osc3:{mode:0,ringMod:!1,transpose:-11,detune:0,color:32,level:14},filter1:{mode:1,cutoff:92,resonance:0},filter2:{mode:1,cutoff:25,resonance:10},routing:{mode:1,balance:64},envelope:{attack:0,decay:96,sustain:0,release:96},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Whistlotronic",synthType:"V2",v2:{osc1:{mode:2,transpose:12,detune:0,color:66,level:127},osc2:{mode:0,ringMod:!1,transpose:7,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:4,detune:0,color:27,level:126},filter1:{mode:2,cutoff:86,resonance:0},filter2:{mode:2,cutoff:116,resonance:0},routing:{mode:2,balance:21},envelope:{attack:34,decay:64,sustain:53,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:99,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Tech Arp100",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:13,resonance:32},filter2:{mode:2,cutoff:29,resonance:104},routing:{mode:2,balance:78},envelope:{attack:0,decay:48,sustain:18,release:23},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:1,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Mightyass1",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:9,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:-12,detune:0,color:32,level:126},osc3:{mode:3,ringMod:!1,transpose:24,detune:0,color:32,level:47},filter1:{mode:1,cutoff:25,resonance:69},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:64},envelope2:{attack:0,decay:105,sustain:6,release:81},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Rim#003",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:6,level:126},osc2:{mode:3,ringMod:!1,transpose:20,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:38,detune:0,color:0,level:121},filter1:{mode:0,cutoff:73,resonance:117},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:11,sustain:0,release:0},envelope2:{attack:0,decay:6,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"FX_Hell's Bell",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:91,level:28},osc2:{mode:5,ringMod:!1,transpose:23,detune:50,color:30,level:126},osc3:{mode:3,ringMod:!0,transpose:-64,detune:0,color:102,level:24},filter1:{mode:1,cutoff:80,resonance:106},filter2:{mode:3,cutoff:37,resonance:77},routing:{mode:1,balance:64},envelope:{attack:0,decay:65,sustain:126,release:77},envelope2:{attack:0,decay:46,sustain:15,release:13},lfo1:{rate:28,depth:52}},effects:[],volume:-12,pan:0},{type:"synth",name:"LD_Farscape04",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:4,ringMod:!1,transpose:-44,detune:-10,color:0,level:6},osc3:{mode:3,ringMod:!1,transpose:0,detune:1,color:32,level:126},filter1:{mode:1,cutoff:86,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:80,decay:64,sustain:112,release:94},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:27,depth:109}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Lethal PWM0",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:64,level:126},osc2:{mode:0,ringMod:!1,transpose:24,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:80,resonance:0},filter2:{mode:5,cutoff:114,resonance:91},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:116,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:68,depth:34}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Soaring#088",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-4,color:126,level:126},osc2:{mode:1,ringMod:!1,transpose:0,detune:10,color:0,level:126},osc3:{mode:1,ringMod:!1,transpose:12,detune:-11,color:0,level:126},filter1:{mode:1,cutoff:33,resonance:51},filter2:{mode:1,cutoff:77,resonance:115},routing:{mode:1,balance:64},envelope:{attack:0,decay:126,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:8,depth:46}},effects:[],volume:-12,pan:0},{type:"synth",name:"BR_Trombrato02",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:14,color:0,level:121},osc2:{mode:0,ringMod:!1,transpose:0,detune:-15,color:0,level:82},osc3:{mode:0,ringMod:!1,transpose:12,detune:2,color:0,level:76},filter1:{mode:1,cutoff:70,resonance:0},filter2:{mode:1,cutoff:70,resonance:23},routing:{mode:1,balance:64},envelope:{attack:46,decay:64,sustain:121,release:20},envelope2:{attack:94,decay:125,sustain:125,release:26},lfo1:{rate:0,depth:17}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noiseh #004",synthType:"V2",v2:{osc1:{mode:4,transpose:5,detune:0,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:67,resonance:83},filter2:{mode:2,cutoff:86,resonance:66},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:113,release:26},envelope2:{attack:0,decay:25,sustain:20,release:121},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Disturbing7",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:122},osc2:{mode:4,ringMod:!1,transpose:52,detune:0,color:32,level:0},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:122},filter1:{mode:2,cutoff:89,resonance:89},filter2:{mode:2,cutoff:78,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:77,sustain:123,release:0},envelope2:{attack:0,decay:106,sustain:0,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"BA_Bontempi002",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:-8,color:5,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:2,cutoff:45,resonance:0},filter2:{mode:0,cutoff:47,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:41,release:70},envelope2:{attack:0,decay:64,sustain:64,release:90},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_FlangeHats2",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Screeeam!IKAAAA!!!",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:-17,color:63,level:55},osc2:{mode:1,ringMod:!1,transpose:12,detune:-43,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:2,cutoff:92,resonance:70},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:14,decay:64,sustain:64,release:42},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:82,depth:87}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Big Kick075",synthType:"V2",v2:{osc1:{mode:3,transpose:-2,detune:0,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:-2,detune:0,color:9,level:126},osc3:{mode:0,ringMod:!1,transpose:17,detune:0,color:73,level:40},filter1:{mode:1,cutoff:65,resonance:98},filter2:{mode:3,cutoff:0,resonance:73},routing:{mode:1,balance:64},envelope:{attack:0,decay:5,sustain:126,release:3},envelope2:{attack:0,decay:50,sustain:35,release:13},lfo1:{rate:126,depth:126}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Synth Jew's Harp",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:5,level:123},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:123},filter1:{mode:2,cutoff:9,resonance:113},filter2:{mode:1,cutoff:81,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:64,sustain:64,release:27},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Snaree",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:124},osc2:{mode:4,ringMod:!1,transpose:25,detune:0,color:102,level:108},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:0,cutoff:124,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:39,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_Cheap Arp08",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:124},osc2:{mode:0,ringMod:!1,transpose:0,detune:14,color:0,level:124},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:124},filter1:{mode:1,cutoff:83,resonance:106},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:42,sustain:38,release:71},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 HHs 104",synthType:"V2",v2:{osc1:{mode:2,transpose:4,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:24,level:126},filter1:{mode:3,cutoff:126,resonance:0},filter2:{mode:3,cutoff:104,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:0},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_VeloFuzz001",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:1,color:0,level:126},osc2:{mode:2,ringMod:!0,transpose:24,detune:14,color:63,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:4,resonance:116},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:40},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Hefty Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:-54,detune:3,color:70,level:126},osc2:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:0,color:65,level:126},filter1:{mode:1,cutoff:122,resonance:11},filter2:{mode:3,cutoff:41,resonance:42},routing:{mode:1,balance:64},envelope:{attack:0,decay:98,sustain:126,release:47},envelope2:{attack:0,decay:54,sustain:0,release:0},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"SY_yasgch #005",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:126},osc2:{mode:1,ringMod:!1,transpose:12,detune:9,color:0,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:31,resonance:59},filter2:{mode:0,cutoff:59,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:118,sustain:114,release:35},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_70s Synth Kick",synthType:"V2",v2:{osc1:{mode:1,transpose:-3,detune:0,color:61,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:0,cutoff:27,resonance:56},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:51,sustain:0,release:30},envelope2:{attack:0,decay:34,sustain:0,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 Hihats 2",synthType:"V2",v2:{osc1:{mode:2,transpose:-10,detune:0,color:64,level:126},osc2:{mode:2,ringMod:!1,transpose:8,detune:0,color:64,level:126},osc3:{mode:4,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:126,resonance:91},filter2:{mode:2,cutoff:108,resonance:94},routing:{mode:1,balance:64},envelope:{attack:0,decay:0,sustain:0,release:9},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_808 BD 1001",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:26,resonance:126},filter2:{mode:2,cutoff:25,resonance:126},routing:{mode:1,balance:64},envelope:{attack:0,decay:61,sustain:0,release:45},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 13",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:125},osc2:{mode:3,ringMod:!1,transpose:0,detune:7,color:32,level:125},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:125},filter1:{mode:1,cutoff:125,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:64,release:60},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:76,depth:104}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistKick 28",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:64,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:9,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:1,cutoff:126,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:70,sustain:0,release:92},envelope2:{attack:0,decay:37,sustain:0,release:40},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_DistSnare11",synthType:"V2",v2:{osc1:{mode:3,transpose:8,detune:0,color:32,level:0},osc2:{mode:3,ringMod:!1,transpose:8,detune:36,color:32,level:0},osc3:{mode:4,ringMod:!1,transpose:35,detune:0,color:70,level:124},filter1:{mode:5,cutoff:73,resonance:115},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:56,sustain:0,release:65},envelope2:{attack:0,decay:15,sustain:0,release:0},lfo1:{rate:64,depth:105}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 Ride",synthType:"V2",v2:{osc1:{mode:2,transpose:0,detune:0,color:63,level:14},osc2:{mode:2,ringMod:!1,transpose:10,detune:0,color:64,level:18},osc3:{mode:4,ringMod:!1,transpose:50,detune:0,color:66,level:123},filter1:{mode:3,cutoff:124,resonance:0},filter2:{mode:2,cutoff:104,resonance:100},routing:{mode:1,balance:64},envelope:{attack:0,decay:54,sustain:0,release:75},envelope2:{attack:0,decay:64,sustain:123,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Flanged 808 HHs + Dis",synthType:"V2",v2:{osc1:{mode:2,transpose:-9,detune:0,color:113,level:39},osc2:{mode:2,ringMod:!1,transpose:-7,detune:14,color:25,level:47},osc3:{mode:4,ringMod:!1,transpose:44,detune:0,color:82,level:126},filter1:{mode:3,cutoff:102,resonance:106},filter2:{mode:3,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:27,sustain:0,release:44},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 1 #000",synthType:"V2",v2:{osc1:{mode:3,transpose:-7,detune:0,color:32,level:127},osc2:{mode:3,ringMod:!1,transpose:-7,detune:9,color:32,level:127},osc3:{mode:4,ringMod:!1,transpose:29,detune:0,color:64,level:0},filter1:{mode:0,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:47,sustain:0,release:43},envelope2:{attack:0,decay:46,sustain:1,release:75},lfo1:{rate:90,depth:107}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Kick 2000",synthType:"V2",v2:{osc1:{mode:3,transpose:4,detune:-64,color:0,level:126},osc2:{mode:4,ringMod:!1,transpose:-1,detune:-13,color:32,level:91},osc3:{mode:4,ringMod:!1,transpose:-11,detune:44,color:0,level:34},filter1:{mode:1,cutoff:68,resonance:0},filter2:{mode:2,cutoff:84,resonance:63},routing:{mode:2,balance:15},envelope:{attack:0,decay:0,sustain:65,release:64},envelope2:{attack:0,decay:63,sustain:99,release:76},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_March Snare",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:6,color:0,level:126},osc2:{mode:3,ringMod:!1,transpose:12,detune:1,color:32,level:73},osc3:{mode:4,ringMod:!1,transpose:48,detune:0,color:51,level:126},filter1:{mode:0,cutoff:66,resonance:107},filter2:{mode:0,cutoff:54,resonance:106},routing:{mode:2,balance:64},envelope:{attack:0,decay:35,sustain:0,release:29},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Nice Synth HH",synthType:"V2",v2:{osc1:{mode:4,transpose:53,detune:0,color:0,level:126},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:121,resonance:121},filter2:{mode:1,cutoff:117,resonance:114},routing:{mode:2,balance:64},envelope:{attack:0,decay:20,sustain:20,release:8},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Crash",synthType:"V2",v2:{osc1:{mode:4,transpose:62,detune:62,color:106,level:126},osc2:{mode:4,ringMod:!1,transpose:62,detune:50,color:51,level:126},osc3:{mode:4,ringMod:!1,transpose:62,detune:26,color:108,level:126},filter1:{mode:3,cutoff:126,resonance:55},filter2:{mode:1,cutoff:126,resonance:0},routing:{mode:1,balance:64},envelope:{attack:0,decay:47,sustain:21,release:77},envelope2:{attack:0,decay:113,sustain:70,release:124},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Noisy Open HH",synthType:"V2",v2:{osc1:{mode:4,transpose:36,detune:0,color:82,level:126},osc2:{mode:0,ringMod:!1,transpose:9,detune:0,color:32,level:126},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:126},filter1:{mode:3,cutoff:112,resonance:106},filter2:{mode:0,cutoff:104,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:44,sustain:0,release:32},envelope2:{attack:0,decay:64,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Pop BD #003",synthType:"V2",v2:{osc1:{mode:3,transpose:0,detune:0,color:0,level:121},osc2:{mode:3,ringMod:!1,transpose:0,detune:0,color:32,level:122},osc3:{mode:4,ringMod:!1,transpose:36,detune:0,color:90,level:0},filter1:{mode:1,cutoff:121,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:61,sustain:0,release:52},envelope2:{attack:0,decay:23,sustain:0,release:0},lfo1:{rate:80,depth:84}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Snappy Snare",synthType:"V2",v2:{osc1:{mode:1,transpose:-10,detune:0,color:72,level:126},osc2:{mode:5,ringMod:!1,transpose:0,detune:0,color:64,level:38},osc3:{mode:4,ringMod:!1,transpose:33,detune:0,color:76,level:126},filter1:{mode:3,cutoff:53,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:45,sustain:0,release:19},envelope2:{attack:0,decay:18,sustain:0,release:0},lfo1:{rate:105,depth:11}},effects:[],volume:-12,pan:0},{type:"synth",name:"DR_Ver|bt Snare",synthType:"V2",v2:{osc1:{mode:4,transpose:0,detune:0,color:60,level:126},osc2:{mode:3,ringMod:!1,transpose:0,detune:-21,color:126,level:88},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:0,level:126},filter1:{mode:5,cutoff:82,resonance:126},filter2:{mode:1,cutoff:22,resonance:126},routing:{mode:2,balance:17},envelope:{attack:0,decay:0,sustain:126,release:14},envelope2:{attack:0,decay:83,sustain:64,release:64},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #100",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #101",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #102",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #103",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #104",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #105",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #106",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #107",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #108",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #109",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #110",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #111",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #112",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #113",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #114",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #115",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #116",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #117",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #118",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #119",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #120",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #121",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #122",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #123",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #124",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #125",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #126",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0},{type:"synth",name:"Init Patch #127",synthType:"V2",v2:{osc1:{mode:1,transpose:0,detune:0,color:0,level:127},osc2:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},osc3:{mode:0,ringMod:!1,transpose:0,detune:0,color:32,level:127},filter1:{mode:1,cutoff:127,resonance:0},filter2:{mode:0,cutoff:64,resonance:0},routing:{mode:0,balance:64},envelope:{attack:0,decay:64,sustain:127,release:80},envelope2:{attack:0,decay:64,sustain:127,release:80},lfo1:{rate:64,depth:0}},effects:[],volume:-12,pan:0}],Ob=[{type:"synth",name:"SAM_Classic",synthType:"Sam",sam:{text:"SAM IS BACK",pitch:64,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_C64",synthType:"Sam",sam:{text:"COMMODORE SIXTY FOUR",pitch:64,speed:64,mouth:150,throat:110,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_Robotic",synthType:"Sam",sam:{text:"EXTERMINATE",pitch:40,speed:80,mouth:200,throat:200,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0},{type:"synth",name:"SAM_High",synthType:"Sam",sam:{text:"I HAVE A HIGH VOICE",pitch:100,speed:72,mouth:128,throat:128,singmode:!1,phonetic:!1},effects:[],volume:-10,pan:0}],Ib=[{type:"synth",name:"Astrocade Clean Square",synthType:"MAMEAstrocade",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Vibrato Lead",synthType:"MAMEAstrocade",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Buzz",synthType:"MAMEAstrocade",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Astrocade Noise Rumble",synthType:"MAMEAstrocade",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Laser",synthType:"MAMESN76477",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Explosion",synthType:"MAMESN76477",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Engine",synthType:"MAMESN76477",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SN76477 Siren",synthType:"MAMESN76477",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Organ",synthType:"MAMEMSM5232",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Full Brass",synthType:"MAMEMSM5232",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Strings",synthType:"MAMEMSM5232",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MSM5232 Reedy Combo",synthType:"MAMEMSM5232",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Piano",synthType:"MAMETMS36XX",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Banjo",synthType:"MAMETMS36XX",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS36XX Organ",synthType:"MAMETMS36XX",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Sine",synthType:"MAMESNKWave",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Square",synthType:"MAMESNKWave",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SNKWave Triangle",synthType:"MAMESNKWave",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"YMOPQ E.Piano",synthType:"MAMEYMOPQ",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Brass",synthType:"MAMEYMOPQ",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Strings",synthType:"MAMEYMOPQ",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bass",synthType:"MAMEYMOPQ",parameters:{_program:3},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Organ",synthType:"MAMEYMOPQ",parameters:{_program:4},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Lead",synthType:"MAMEYMOPQ",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Pad",synthType:"MAMEYMOPQ",parameters:{_program:6},effects:[],volume:-8,pan:0},{type:"synth",name:"YMOPQ Bell",synthType:"MAMEYMOPQ",parameters:{_program:7},effects:[],volume:-8,pan:0},{type:"synth",name:"MEA8000 Vowel A",synthType:"MAMEMEA8000",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel E",synthType:"MAMEMEA8000",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Vowel O",synthType:"MAMEMEA8000",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"MEA8000 Nasal",synthType:"MAMEMEA8000",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel AH",synthType:"MAMESP0250",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel EE",synthType:"MAMESP0250",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"SP0250 Vowel OO",synthType:"MAMESP0250",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax EH",synthType:"MAMEVotrax",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AW",synthType:"MAMEVotrax",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax AH",synthType:"MAMEVotrax",parameters:{_program:2},effects:[],volume:-10,pan:0},{type:"synth",name:"Votrax OO",synthType:"MAMEVotrax",parameters:{_program:3},effects:[],volume:-10,pan:0},{type:"synth",name:"ES5503 Default",synthType:"MAMEES5503",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"YMF271 FM Piano",synthType:"MAMEYMF271",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Brass",synthType:"MAMEYMF271",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"YMF271 FM Strings",synthType:"MAMEYMF271",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"TR707 Default Kit",synthType:"MAMETR707",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Bass",synthType:"MAMEVASynth",parameters:{_program:0},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Lead",synthType:"MAMEVASynth",parameters:{_program:1},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pad",synthType:"MAMEVASynth",parameters:{_program:2},effects:[],volume:-8,pan:0},{type:"synth",name:"VA Synth Pluck",synthType:"MAMEVASynth",parameters:{_program:5},effects:[],volume:-8,pan:0},{type:"synth",name:"TIA Square",synthType:"MAMETIA",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TIA Buzz",synthType:"MAMETIA",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD931 Default",synthType:"MAMEUPD931",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"UPD933 Default",synthType:"MAMEUPD933",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"TMS5220 Speech",synthType:"MAMETMS5220",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Sine",synthType:"MAMEASC",parameters:{_program:0},effects:[],volume:-10,pan:0},{type:"synth",name:"ASC Square",synthType:"MAMEASC",parameters:{_program:1},effects:[],volume:-10,pan:0},{type:"synth",name:"AICA Default",synthType:"MAMEAICA",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"SCSP Default",synthType:"SCSP",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"C352 Default",synthType:"MAMEC352",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"RF5C400 Default",synthType:"MAMERF5C400",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"ICS2115 Default",synthType:"MAMEICS2115",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"K054539 Default",synthType:"MAMEK054539",parameters:{volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Bass",synthType:"CEM3394",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"CEM3394 Lead",synthType:"CEM3394",parameters:{_program:1,volume:.8},effects:[],volume:-10,pan:0},{type:"synth",name:"CEM3394 Pad",synthType:"CEM3394",parameters:{_program:2,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"SCSP Synth Bass",synthType:"SCSP",parameters:{_program:0,volume:.8},effects:[],volume:-8,pan:0},{type:"synth",name:"SCSP Poly Pad",synthType:"SCSP",parameters:{_program:1,volume:.8},effects:[],volume:-12,pan:0},{type:"synth",name:"AICA FM Piano",synthType:"MAMEAICA",parameters:{_program:0,volume:.8},effects:[],volume:-10,pan:0}],Fb=(e,t,a=0,n=7)=>({level:e,coarse:t,fine:a,detune:n,egRates:[99,99,99,99],egLevels:[99,99,99,0]}),Db=[{name:"DX7 E.Piano 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Ac["E.PIANO 1"]},{name:"DX7 E.Piano Bright",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{...Ac["E.PIANO 1"],feedback:7}},{name:"DX7 Clavinet",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,60,30,60],egLevels:[99,0,0,0]},{level:80,coarse:2,egRates:[99,50,20,50],egLevels:[99,0,0,0]},Fb(0,1),Fb(0,1),Fb(0,1),Fb(0,1)]}},{name:"DX7 Organ",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:3,feedback:0,operators:[{level:99,coarse:1},{level:90,coarse:2},{level:85,coarse:3},{level:80,coarse:4},Fb(0,1),Fb(0,1)]}},{name:"DX7 Bass 1",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:5,feedback:7,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:75,coarse:1,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},{level:50,coarse:2,fine:0,detune:7,egRates:[99,75,40,60],egLevels:[99,90,0,0]},Fb(0,1),Fb(0,1),Fb(0,1)]}},{name:"DX7 Slap Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:16,feedback:6,operators:[{level:99,coarse:1,egRates:[99,60,40,60],egLevels:[99,95,0,0]},{level:88,coarse:4,egRates:[99,80,60,80],egLevels:[99,0,0,0]},Fb(0,1),Fb(0,1),Fb(0,1),Fb(0,1)]}},{name:"DX7 Solid Bass",type:"synth",synthType:"Dexed",volume:-8,pan:0,effects:[],dexed:{algorithm:18,feedback:4,operators:[{level:99,coarse:0,fine:50},{level:80,coarse:1},{level:70,coarse:1},Fb(0,1),Fb(0,1),Fb(0,1)]}},{name:"DX7 Tubular Bells",type:"synth",synthType:"Dexed",volume:-12,pan:0,effects:[],dexed:{algorithm:1,feedback:5,operators:[{level:99,coarse:1,fine:0,detune:7,egRates:[99,40,20,50],egLevels:[99,0,0,0]},{level:85,coarse:3,fine:50,detune:7,egRates:[99,60,30,50],egLevels:[99,0,0,0]},Fb(0,1),Fb(0,1),Fb(0,1),Fb(0,1)]}},{name:"DX7 Marimba",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:{algorithm:4,feedback:0,operators:[{level:99,coarse:1,egRates:[99,70,30,60],egLevels:[99,0,0,0]},{level:80,coarse:4,egRates:[99,60,20,50],egLevels:[99,0,0,0]},Fb(0,1),Fb(0,1),Fb(0,1),Fb(0,1)]}},{name:"DX7 Brass 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Ac["BRASS 1"]},{name:"DX7 Strings 1",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Ac["STRINGS 1"]},{name:"DX7 Init Voice",type:"synth",synthType:"Dexed",volume:-10,pan:0,effects:[],dexed:Ac["INIT VOICE"]}],Rb=[{name:"OB-X Classic Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Cu["Classic Brass"]},{name:"OB-X Bright Brass",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{...Cu["Classic Brass"],filterCutoff:.6,filterEnvAmount:.7,unison:!0,unisonDetune:.1}},{name:"OB-X Fat Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Cu["Fat Lead"]},{name:"OB-X Sync Lead",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Cu["Sync Lead"]},{name:"OB-X Unison Saw",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,unison:!0,unisonDetune:.2,panSpread:.5,filterCutoff:1,ampRelease:.2}},{name:"OB-X Rez Bass",type:"synth",synthType:"OBXd",volume:-8,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:1,osc2Detune:.08,filterCutoff:.3,filterResonance:.6,filterEnvAmount:.7,filterAttack:.05,filterDecay:.2,ampAttack:.01,ampDecay:.3}},{name:"OB-X Sub Bass",type:"synth",synthType:"OBXd",volume:-6,pan:0,effects:[],obxd:{osc1Waveform:2,osc2Waveform:0,osc2Octave:-1,filterCutoff:.2,filterResonance:0,filterEnvAmount:.3,filterDecay:.4}},{name:"OB-X PWM Strings",type:"synth",synthType:"OBXd",volume:-12,pan:0,effects:[],obxd:{osc1Waveform:1,osc2Waveform:1,osc1PulseWidth:.5,osc2Detune:.03,lfoRate:.2,lfoPwAmount:.4,filterCutoff:.4,filterResonance:.1,ampAttack:.2,ampRelease:.5}},{name:"OB-X Pulse Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Cu["Pulse Pad"]},{name:"OB-X Sweep Pad",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:0,osc2Waveform:0,filterCutoff:.3,filterResonance:.5,lfoRate:.1,lfoFilterAmount:.4,ampAttack:.5,ampRelease:.8}},{name:"OB-X S&H Sci-Fi",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:{osc1Waveform:1,lfoWaveform:4,lfoRate:.7,lfoFilterAmount:.8,lfoOscAmount:.3,filterResonance:.7}},{name:"OB-X Init",type:"synth",synthType:"OBXd",volume:-10,pan:0,effects:[],obxd:Cu.Init}],jb=[{name:"NES Pulse Lead",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:io.NES}},{name:"NES Pulse 12.5%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:io.NES,nes:{dutyNoise:0,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Pulse 25%",type:"synth",synthType:"FurnaceNES",volume:-8,pan:0,effects:[],furnace:{chipType:io.NES,nes:{dutyNoise:1,envMode:"env",envValue:15,sweepEnabled:!1,sweepPeriod:0,sweepNegate:!1,sweepShift:0}}},{name:"NES Triangle Bass",type:"synth",synthType:"FurnaceNES",volume:-6,pan:0,effects:[],furnace:{chipType:io.NES}},{name:"NES Noise Drums",type:"synth",synthType:"FurnaceNES",volume:-10,pan:0,effects:[],furnace:{chipType:io.NES}},{name:"MMC5 Expansion Init",type:"synth",synthType:"FurnaceMMC5",volume:-8,pan:0,effects:[],furnace:{chipType:io.MMC5}},{name:"GB Pulse 50%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:io.GB}},{name:"GB Pulse 25%",type:"synth",synthType:"FurnaceGB",volume:-8,pan:0,effects:[],furnace:{chipType:io.GB}},{name:"GB Wave Bass",type:"synth",synthType:"FurnaceGB",volume:-6,pan:0,effects:[],furnace:{chipType:io.GB}},{name:"GB Noise Snare",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:io.GB}},{name:"GB Wave Organ",type:"synth",synthType:"FurnaceGB",volume:-10,pan:0,effects:[],furnace:{chipType:io.GB}},{name:"GB Noise HiHat",type:"synth",synthType:"FurnaceGB",volume:-12,pan:0,effects:[],furnace:{chipType:io.GB}},{name:"PSG Square Lead",type:"synth",synthType:"FurnacePSG",volume:-8,pan:0,effects:[],furnace:{chipType:io.PSG}},{name:"PSG Bass",type:"synth",synthType:"FurnacePSG",volume:-6,pan:0,effects:[],furnace:{chipType:io.PSG}},{name:"PSG Periodic Noise",type:"synth",synthType:"FurnacePSG",volume:-10,pan:0,effects:[],furnace:{chipType:io.PSG}},{name:"PCE Wave Lead",type:"synth",synthType:"FurnacePCE",volume:-8,pan:0,effects:[],furnace:{chipType:io.PCE}},{name:"PCE Bass",type:"synth",synthType:"FurnacePCE",volume:-6,pan:0,effects:[],furnace:{chipType:io.PCE}},{name:"VIC Pulse",type:"synth",synthType:"FurnaceVIC",volume:-8,pan:0,effects:[],furnace:{chipType:io.VIC}},{name:"VIC Noise",type:"synth",synthType:"FurnaceVIC",volume:-10,pan:0,effects:[],furnace:{chipType:io.VIC}},{name:"TIA Square",type:"synth",synthType:"FurnaceTIA",volume:-8,pan:0,effects:[],furnace:{chipType:io.TIA}},{name:"TIA Bass",type:"synth",synthType:"FurnaceTIA",volume:-6,pan:0,effects:[],furnace:{chipType:io.TIA}},{name:"OPL3 FM Bass",type:"synth",synthType:"FurnaceOPL",volume:-8,pan:0,effects:[],furnace:{chipType:io.OPL3,algorithm:0,feedback:6}},{name:"OPL3 FM Strings",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:io.OPL3,algorithm:1,feedback:2}},{name:"OPL3 FM Brass",type:"synth",synthType:"FurnaceOPL",volume:-10,pan:0,effects:[],furnace:{chipType:io.OPL3,algorithm:0,feedback:4}},{name:"Amiga ST-01 Bass",type:"synth",synthType:"FurnaceAMIGA",volume:-6,pan:0,effects:[],furnace:{chipType:io.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Lead Strings",type:"synth",synthType:"FurnaceAMIGA",volume:-8,pan:0,effects:[],furnace:{chipType:io.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"Amiga Poly Pad",type:"synth",synthType:"FurnaceAMIGA",volume:-10,pan:0,effects:[],furnace:{chipType:io.AMIGA,amiga:{initSample:0,useNoteMap:!1,useSample:!0,useWave:!1,waveLen:32,noteMap:[]}}},{name:"PET Bleep",type:"synth",synthType:"FurnacePET",volume:-10,pan:0,effects:[],furnace:{chipType:io.PET}},{name:"PC Speaker Beeper",type:"synth",synthType:"FurnacePCSPKR",volume:-10,pan:0,effects:[],furnace:{chipType:io.PCSPKR}},{name:"ZX Beeper QuadTone",type:"synth",synthType:"FurnaceZXBEEPER",volume:-10,pan:0,effects:[],furnace:{chipType:io.ZXBEEPER_QT}},{name:"C64 Pulse Lead",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1200,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Saw Lead",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Bass",type:"synth",synthType:"FurnaceC64",volume:-6,pan:0,effects:[],furnace:{chipType:io.SID,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:14,r:2,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:512,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Arp",type:"synth",synthType:"FurnaceC64",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:4,s:0,r:2,duty:2048,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Noise Drum",type:"synth",synthType:"FurnaceC64",volume:-6,pan:0,effects:[],furnace:{chipType:io.SID,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:4,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:2,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"C64 Pad",type:"synth",synthType:"FurnaceC64",volume:-10,pan:0,effects:[],furnace:{chipType:io.SID,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:8,d:6,s:10,r:10,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:700,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 Saw+Pulse",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID_6581,c64:{triOn:!1,sawOn:!0,pulseOn:!0,noiseOn:!1,a:0,d:8,s:10,r:6,duty:1536,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:900,filterResonance:6,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 Triangle Sub",type:"synth",synthType:"FurnaceSID6581",volume:-6,pan:0,effects:[],furnace:{chipType:io.SID_6581,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:10,s:15,r:4,duty:0,ringMod:!1,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 Dirty Reso",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID_6581,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:10,s:8,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:600,filterResonance:14,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"6581 PWM Throb",type:"synth",synthType:"FurnaceSID6581",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID_6581,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:4,d:6,s:12,r:8,duty:512,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:700,filterResonance:8,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Clean Pulse",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID_8580,c64:{triOn:!1,sawOn:!1,pulseOn:!0,noiseOn:!1,a:0,d:6,s:12,r:4,duty:2048,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1400,filterResonance:4,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Bandpass",type:"synth",synthType:"FurnaceSID8580",volume:-8,pan:0,effects:[],furnace:{chipType:io.SID_8580,c64:{triOn:!1,sawOn:!0,pulseOn:!1,noiseOn:!1,a:0,d:8,s:10,r:6,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:800,filterResonance:10,filterLP:!1,filterBP:!0,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Ring Mod",type:"synth",synthType:"FurnaceSID8580",volume:-10,pan:0,effects:[],furnace:{chipType:io.SID_8580,c64:{triOn:!0,sawOn:!1,pulseOn:!1,noiseOn:!1,a:0,d:8,s:8,r:6,duty:0,ringMod:!0,oscSync:!1,toFilter:!1,initFilter:!1,filterCutoff:1024,filterResonance:0,filterLP:!1,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"8580 Noise Perc",type:"synth",synthType:"FurnaceSID8580",volume:-6,pan:0,effects:[],furnace:{chipType:io.SID_8580,c64:{triOn:!1,sawOn:!1,pulseOn:!1,noiseOn:!0,a:0,d:3,s:0,r:0,duty:0,ringMod:!1,oscSync:!1,toFilter:!0,initFilter:!0,filterCutoff:1e3,filterResonance:2,filterLP:!0,filterBP:!1,filterHP:!1,filterCh3Off:!1}}},{name:"GBA Synth Bass",type:"synth",synthType:"FurnaceGBA",volume:-8,pan:0,effects:[],furnace:{chipType:io.GBA_DMA}},{name:"GBA Lead Strings",type:"synth",synthType:"FurnaceGBA",volume:-10,pan:0,effects:[],furnace:{chipType:io.GBA_DMA}},{name:"NDS Piano",type:"synth",synthType:"FurnaceNDS",volume:-10,pan:0,effects:[],furnace:{chipType:io.NDS}},{name:"NDS Pad",type:"synth",synthType:"FurnaceNDS",volume:-12,pan:0,effects:[],furnace:{chipType:io.NDS}},{name:"Virtual Boy Lead",type:"synth",synthType:"FurnaceVB",volume:-10,pan:0,effects:[],furnace:{chipType:io.VB}},{name:"WonderSwan Wave",type:"synth",synthType:"FurnaceSWAN",volume:-10,pan:0,effects:[],furnace:{chipType:io.SWAN}},{name:"Atari Lynx Pulse",type:"synth",synthType:"FurnaceLynx",volume:-10,pan:0,effects:[],furnace:{chipType:io.LYNX}},{name:"Neo Geo Pocket Bass",type:"synth",synthType:"FurnaceT6W28",volume:-8,pan:0,effects:[],furnace:{chipType:io.T6W28}},{name:"QSound Fat Bass",type:"synth",synthType:"FurnaceQSOUND",volume:-6,pan:0,effects:[],furnace:{chipType:io.QSOUND}},{name:"Sega MultiPCM Strings",type:"synth",synthType:"FurnaceMULTIPCM",volume:-10,pan:0,effects:[],furnace:{chipType:io.MULTIPCM}},{name:"Sega PCM Lead",type:"synth",synthType:"FurnaceSEGAPCM",volume:-8,pan:0,effects:[],furnace:{chipType:io.SEGAPCM}},{name:"Namco C140 Drum",type:"synth",synthType:"FurnaceC140",volume:-6,pan:0,effects:[],furnace:{chipType:io.C140}},{name:"OKI MSM6295 Kick",type:"synth",synthType:"FurnaceOKI",volume:-4,pan:0,effects:[],furnace:{chipType:io.OKI}},{name:"OKI MSM6258 Snare",type:"synth",synthType:"FurnaceMSM6258",volume:-6,pan:0,effects:[],furnace:{chipType:io.MSM6258}},{name:"YM2203 FM Bass",type:"synth",synthType:"FurnaceOPN2203",volume:-8,pan:0,effects:[],furnace:{chipType:io.OPN,algorithm:4,feedback:5}},{name:"YM2608 FM Strings",type:"synth",synthType:"FurnaceOPNA",volume:-10,pan:0,effects:[],furnace:{chipType:io.OPNA,algorithm:5,feedback:3}},{name:"YM2610 FM Lead",type:"synth",synthType:"FurnaceOPNB",volume:-8,pan:0,effects:[],furnace:{chipType:io.OPNB,algorithm:4,feedback:6}},{name:"YMF278B FM Piano",type:"synth",synthType:"FurnaceOPL4",volume:-10,pan:0,effects:[],furnace:{chipType:io.OPL4,algorithm:4,feedback:2}},{name:"VRC7 FM Brass",type:"synth",synthType:"FurnaceVRC7",volume:-10,pan:0,effects:[],furnace:{chipType:io.OPLL,algorithm:0,feedback:4}}],Bb="/data/samples/packs/casio-mt40/leads",Lb="/data/samples/packs/drumnibus",Vb=[{name:"MT-40 Accordion",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/accordion.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Brass",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/brass.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Clarinet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/clarinet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Elec Piano",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/elec piano.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Harpsichord",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/harpsichord.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Pipe Organ",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/pipe-organ.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Trumpet",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/trumpet.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Violin",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/violin.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Celesta",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Bb}/celesta.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Funny Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/funny fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Xylophone",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/xylophone.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Gloken",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Bb}/glocken.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Folk Flute",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/folk flute.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 ST Ensemble",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Bb}/st ensemble.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"MT-40 Synth Fuzz",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:`${Bb}/synth fuzz.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Kick 1",type:"synth",synthType:"Sampler",volume:-6,pan:0,effects:[],sample:{url:`${Lb}/kicks/BD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Analog",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Lb}/snares/SD_Analog1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Snare Wolf",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Lb}/snares/SD_Wolf1.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus Percussion Tom",type:"synth",synthType:"Sampler",volume:-8,pan:0,effects:[],sample:{url:`${Lb}/percussion/TOM_Magnotron.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Drumnibus HiHat Digidap",type:"synth",synthType:"Sampler",volume:-12,pan:0,effects:[],sample:{url:`${Lb}/hihats/CH_Digidap.wav`,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1}},{name:"Player Analog Kick",type:"synth",synthType:"Player",volume:-6,pan:0,effects:[],parameters:{sampleUrl:`${Lb}/kicks/BD_Analog1.wav`}},{name:"Player Analog Snare",type:"synth",synthType:"Player",volume:-8,pan:0,effects:[],parameters:{sampleUrl:`${Lb}/snares/SD_Analog1.wav`}},{name:"Player Sci-Fi FX",type:"synth",synthType:"Player",volume:-10,pan:0,effects:[],parameters:{sampleUrl:`${Lb}/fx/FX_AnalogFX1.wav`}},{name:"Granular Casio Flute",type:"synth",synthType:"GranularSynth",volume:-10,pan:0,effects:[],granular:{sampleUrl:`${Bb}/flute.wav`,grainSize:100,grainOverlap:50,detune:10,randomPitch:20,density:8,scanSpeed:10,playbackRate:1,randomPosition:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"Granular Drumnibus Texture",type:"synth",synthType:"GranularSynth",volume:-12,pan:0,effects:[],granular:{sampleUrl:`${Lb}/fx/FX_Blarper.wav`,grainSize:200,grainOverlap:10,detune:-5,randomPosition:30,density:12,scanSpeed:5,playbackRate:1,randomPitch:0,scanPosition:0,reverse:!1,envelope:{attack:10,release:50},filter:{type:"lowpass",cutoff:2e4,resonance:0}}},{name:"MT-40 Full Lead Set",type:"synth",synthType:"Sampler",volume:-10,pan:0,effects:[],sample:{url:"",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1,multiMap:{C2:`${Bb}/bass.wav`,C3:`${Bb}/cello.wav`,C4:`${Bb}/elec piano.wav`,C5:`${Bb}/glocken.wav`,C6:`${Bb}/funny fuzz.wav`}}}],zb=[{name:"Wavetable Bell",type:"synth",synthType:"Wavetable",volume:-12,pan:0,effects:[],wavetable:{wavetableId:"bell-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:1,detune:0,stereoSpread:0},envelope:{attack:10,decay:1e3,sustain:0,release:100},filter:{type:"lowpass",cutoff:12e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Brass",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"brass-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:2,detune:10,stereoSpread:50},envelope:{attack:50,decay:500,sustain:50,release:200},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:30},filterEnvelope:{attack:100,decay:300,sustain:0,release:100}}},{name:"Wavetable Choir",type:"synth",synthType:"Wavetable",volume:-10,pan:0,effects:[],wavetable:{wavetableId:"choir-32x32",morphPosition:0,morphModSource:"none",morphModAmount:0,morphLFORate:0,unison:{voices:4,detune:15,stereoSpread:80},envelope:{attack:200,decay:500,sustain:100,release:500},filter:{type:"lowpass",cutoff:4e3,resonance:5,envelopeAmount:0},filterEnvelope:{attack:0,decay:0,sustain:100,release:0}}},{name:"Wavetable Heavy Bass",type:"synth",synthType:"Wavetable",volume:-8,pan:0,effects:[],wavetable:{wavetableId:"m4-bass01",morphPosition:0,morphModSource:"envelope",morphModAmount:50,morphLFORate:0,unison:{voices:2,detune:15,stereoSpread:40},envelope:{attack:5,decay:400,sustain:20,release:150},filter:{type:"lowpass",cutoff:2e3,resonance:40,envelopeAmount:60},filterEnvelope:{attack:10,decay:300,sustain:0,release:100}}}],Ub={"Soft Clip":{machineType:zl.ARGURU_DISTORTION,parameters:{0:256,1:1024,2:1024,3:1024,4:0,5:0}},"Hard Clip":{machineType:zl.ARGURU_DISTORTION,parameters:{0:512,1:256,2:256,3:768,4:0,5:0}},"Heavy Saturate":{machineType:zl.ARGURU_DISTORTION,parameters:{0:768,1:512,2:512,3:1280,4:0,5:1}}},Gb={"Low Pass":{machineType:zl.ELAK_SVF,parameters:{0:500,1:512}},"Low Pass Resonant":{machineType:zl.ELAK_SVF,parameters:{0:300,1:40960}},"High Pass":{machineType:zl.ELAK_SVF,parameters:{0:700,1:1024}}},Wb={[zl.ARGURU_DISTORTION]:Ub,[zl.ELAK_SVF]:Gb,[zl.FSM_KICK]:{"Hard Kick":{machineType:zl.FSM_KICK,parameters:{0:100,1:80}},"Soft Kick":{machineType:zl.FSM_KICK,parameters:{0:60,1:40}},"Long 808-ish":{machineType:zl.FSM_KICK,parameters:{0:80,1:120}}},[zl.FSM_KICKXP]:{"Init KickXP":{machineType:zl.FSM_KICKXP,parameters:{}},"Extreme Kick":{machineType:zl.FSM_KICKXP,parameters:{0:127,1:127}}},[zl.JESKOLA_TRILOK]:{"Punchy BD":{machineType:zl.JESKOLA_TRILOK,parameters:{0:80,1:60}},"Deep BD":{machineType:zl.JESKOLA_TRILOK,parameters:{0:40,1:90}}},[zl.JESKOLA_NOISE]:{"White Noise":{machineType:zl.JESKOLA_NOISE,parameters:{0:0}},"Pink Noise":{machineType:zl.JESKOLA_NOISE,parameters:{0:1}},"Noisy FX":{machineType:zl.JESKOLA_NOISE,parameters:{0:2,1:100}}},[zl.OOMEK_AGGRESSOR]:{"Acid Bass":{machineType:zl.OOMEK_AGGRESSOR,parameters:{1:120,2:96,3:80,4:64}},"Squelchy Lead":{machineType:zl.OOMEK_AGGRESSOR,parameters:{1:160,2:127,3:96,4:80}},"Soft Sub":{machineType:zl.OOMEK_AGGRESSOR,parameters:{1:48,2:32,3:32,4:96}}},[zl.OOMEK_AGGRESSOR_DF]:{"DF Screamer":{machineType:zl.OOMEK_AGGRESSOR_DF,parameters:{1:176,2:127,13:1,15:2}},"DF Infinite":{machineType:zl.OOMEK_AGGRESSOR_DF,parameters:{1:96,10:100,9:127}}},[zl.MADBRAIN_4FM2F]:{"FM Bass":{machineType:zl.MADBRAIN_4FM2F,parameters:{0:10,1:80,2:40}},"FM Lead":{machineType:zl.MADBRAIN_4FM2F,parameters:{0:40,1:100,2:60}},"FM Pad":{machineType:zl.MADBRAIN_4FM2F,parameters:{0:60,1:50,2:100}}},[zl.MADBRAIN_DYNAMITE6]:{"Additive Lead":{machineType:zl.MADBRAIN_DYNAMITE6,parameters:{0:80,1:40}},"Organ-like":{machineType:zl.MADBRAIN_DYNAMITE6,parameters:{0:60,1:100}}},[zl.MAKK_M3]:{"M3 Lead":{machineType:zl.MAKK_M3,parameters:{0:64,1:64}},"M3 Bass":{machineType:zl.MAKK_M3,parameters:{0:127,1:32}}},[zl.MAKK_M4]:{"M4 Wavetable":{machineType:zl.MAKK_M4,parameters:{0:0}},"M4 Sweep":{machineType:zl.MAKK_M4,parameters:{0:50,1:100}}},[zl.CYANPHASE_DTMF]:{"Phone Tones":{machineType:zl.CYANPHASE_DTMF,parameters:{}}},[zl.ELENZIL_FREQUENCYBOMB]:{"Freq Bomb":{machineType:zl.ELENZIL_FREQUENCYBOMB,parameters:{0:100}}},[zl.ELAK_DIST2]:{},[zl.JESKOLA_DISTORTION]:{},[zl.GEONIK_OVERDRIVE]:{},[zl.GRAUE_SOFTSAT]:{},[zl.WHITENOISE_STEREODIST]:{},[zl.CYANPHASE_NOTCH]:{},[zl.Q_ZFILTER]:{},[zl.FSM_PHILTA]:{},[zl.JESKOLA_DELAY]:{},[zl.JESKOLA_CROSSDELAY]:{},[zl.JESKOLA_FREEVERB]:{},[zl.FSM_PANZERDELAY]:{},[zl.FSM_CHORUS]:{},[zl.FSM_CHORUS2]:{},[zl.WHITENOISE_WHITECHORUS]:{},[zl.BIGYO_FREQUENCYSHIFTER]:{},[zl.GEONIK_COMPRESSOR]:{},[zl.LD_SLIMIT]:{},[zl.OOMEK_EXCITER]:{},[zl.OOMEK_MASTERIZER]:{},[zl.DEDACODE_STEREOGAIN]:{}};function Hb(e){return Object.keys(function(e){return Wb[e]||{}}(e))}const Kb=[zl.FSM_KICK,zl.FSM_KICKXP,zl.JESKOLA_TRILOK,zl.JESKOLA_NOISE,zl.OOMEK_AGGRESSOR,zl.OOMEK_AGGRESSOR_DF,zl.MADBRAIN_4FM2F,zl.MADBRAIN_DYNAMITE6,zl.MAKK_M3,zl.MAKK_M4,zl.CYANPHASE_DTMF,zl.ELENZIL_FREQUENCYBOMB],qb=[];for(const fF of Kb){const e=Wb[fF];if(e)for(const[t,a]of Object.entries(e)){const e=`Buzz ${t}`;qb.push({name:e,type:"synth",synthType:`Buzz${$b(fF)}`,volume:-10,pan:0,effects:[],parameters:a.parameters})}}function $b(e){switch(e){case zl.FSM_KICK:return"Kick";case zl.FSM_KICKXP:return"KickXP";case zl.JESKOLA_TRILOK:return"Trilok";case zl.JESKOLA_NOISE:return"Noise";case zl.OOMEK_AGGRESSOR:return"3o3";case zl.OOMEK_AGGRESSOR_DF:return"3o3DF";case zl.MADBRAIN_4FM2F:return"4FM2F";case zl.MADBRAIN_DYNAMITE6:return"Dynamite6";case zl.MAKK_M3:return"M3";case zl.MAKK_M4:return"M4";case zl.CYANPHASE_DTMF:return"DTMF";case zl.ELENZIL_FREQUENCYBOMB:return"FreqBomb";default:return e}}const Xb=[{name:"M4 Deep Bass",type:"synth",synthType:"BuzzM4",volume:-8,pan:0,effects:[],parameters:{0:1,1:64,2:32,3:80}},{name:"M4 Sub Bass",type:"synth",synthType:"BuzzM4",volume:-6,pan:0,effects:[],parameters:{0:5,1:0,2:20}},{name:"M4 Rezzy Growl",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:13,1:127,2:45,3:110}},{name:"M4 Sharp Saw",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:20,1:64,2:100,3:20}},{name:"M4 Digi Lead",type:"synth",synthType:"BuzzM4",volume:-10,pan:0,effects:[],parameters:{0:45,1:80,2:120}},{name:"M4 Sync Lead",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:30,1:64,4:12}},{name:"M4 Soft Pad",type:"synth",synthType:"BuzzM4",volume:-12,pan:0,effects:[],parameters:{0:60,1:64,2:60,3:10}},{name:"M4 Metallic Text",type:"synth",synthType:"BuzzM4",volume:-14,pan:0,effects:[],parameters:{0:85,1:100,2:80,3:90}}],Yb=Array.from({length:32},(e,t)=>1/(t+1)),Zb=Array.from({length:32},(e,t)=>(t+1)%2==1?1/(t+1):0),Qb=Array.from({length:32},(e,t)=>(t+1)%2==1?1/Math.pow(t+1,2):0),Jb=[{type:"synth",name:"Pure Sine",synthType:"HarmonicSynth",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>0===t?1:0),spectralTilt:0,evenOddBalance:0,filter:{type:"lowpass",cutoff:12e3,resonance:.5},envelope:{attack:50,decay:200,sustain:80,release:300},lfo:{rate:2,depth:0,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Bright Saw",harmonicSynth:{harmonics:Yb,spectralTilt:20,evenOddBalance:0,filter:{type:"lowpass",cutoff:8e3,resonance:2},envelope:{attack:5,decay:150,sustain:70,release:200},lfo:{rate:5,depth:15,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Warm Square",harmonicSynth:{harmonics:Zb,spectralTilt:-10,evenOddBalance:-100,filter:{type:"lowpass",cutoff:2e3,resonance:1},envelope:{attack:10,decay:200,sustain:90,release:150},lfo:{rate:1.5,depth:0,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Mellow Triangle",harmonicSynth:{harmonics:Qb,spectralTilt:-20,evenOddBalance:-80,filter:{type:"lowpass",cutoff:5e3,resonance:.5},envelope:{attack:100,decay:300,sustain:85,release:400},lfo:{rate:.5,depth:5,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Church Organ",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return a%2==0?0:1===a?1:3===a?.8:5===a?.6:7===a?.4:9===a?.3:.2/a}),spectralTilt:0,evenOddBalance:-60,filter:{type:"lowpass",cutoff:1e4,resonance:1},envelope:{attack:20,decay:100,sustain:95,release:100},lfo:{rate:6,depth:3,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Vocal Formant",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return a>=4&&a<=8?1-.15*Math.abs(a-6):.3/a}),spectralTilt:0,evenOddBalance:20,filter:{type:"bandpass",cutoff:1500,resonance:8},envelope:{attack:30,decay:250,sustain:60,release:200},lfo:{rate:4,depth:40,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Spectral Bell",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return Math.exp(.3*-a)}),spectralTilt:-30,evenOddBalance:30,filter:{type:"highpass",cutoff:200,resonance:2},envelope:{attack:1,decay:2e3,sustain:10,release:1500},lfo:{rate:.3,depth:0,target:"pitch"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Metallic Pad",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return 1/a*(a%3==0||a%7==0?1.5:1)*Math.exp(.1*-a)}),spectralTilt:10,evenOddBalance:0,filter:{type:"lowpass",cutoff:6e3,resonance:3},envelope:{attack:200,decay:400,sustain:75,release:600},lfo:{rate:1.2,depth:20,target:"spectral"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Glass Chimes",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return a%2==0?1/Math.sqrt(a):.3/a}),spectralTilt:15,evenOddBalance:100,filter:{type:"highpass",cutoff:400,resonance:4},envelope:{attack:5,decay:1500,sustain:20,release:1e3},lfo:{rate:.8,depth:10,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Nasal Reed",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return 1===a?1:3===a?.9:5===a?.7:7===a?.5:.3/a}),spectralTilt:-5,evenOddBalance:-70,filter:{type:"bandpass",cutoff:2500,resonance:6},envelope:{attack:15,decay:200,sustain:75,release:150},lfo:{rate:5.5,depth:5,target:"pitch"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Plucked String",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return 1/a*Math.exp(.15*-a)}),spectralTilt:-25,evenOddBalance:0,filter:{type:"lowpass",cutoff:4e3,resonance:2},envelope:{attack:2,decay:800,sustain:10,release:200},lfo:{rate:0,depth:0,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Phasing Pad",harmonicSynth:{harmonics:Yb,spectralTilt:-15,evenOddBalance:0,filter:{type:"lowpass",cutoff:7e3,resonance:1.5},envelope:{attack:300,decay:500,sustain:80,release:800},lfo:{rate:.25,depth:80,target:"spectral"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Dark Bass",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>Math.exp(.8*-t)),spectralTilt:-50,evenOddBalance:0,filter:{type:"lowpass",cutoff:800,resonance:4},envelope:{attack:5,decay:150,sustain:90,release:100},lfo:{rate:0,depth:0,target:"pitch"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Bright Lead",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return a<=16?1/Math.sqrt(a):.8/a}),spectralTilt:40,evenOddBalance:0,filter:{type:"lowpass",cutoff:12e3,resonance:3},envelope:{attack:3,decay:100,sustain:80,release:150},lfo:{rate:6,depth:25,target:"filter"},maxVoices:4},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"String Ensemble",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return 1/a*Math.exp(.12*-a)}),spectralTilt:-8,evenOddBalance:15,filter:{type:"lowpass",cutoff:6e3,resonance:1},envelope:{attack:250,decay:400,sustain:85,release:700},lfo:{rate:2,depth:12,target:"pitch"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Hollow Pipe",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return a%2==0?0:1/Math.pow(a,1.5)}),spectralTilt:-30,evenOddBalance:-100,filter:{type:"bandpass",cutoff:1200,resonance:5},envelope:{attack:40,decay:300,sustain:70,release:250},lfo:{rate:3,depth:8,target:"filter"},maxVoices:6},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Synth Choir",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return a>=3&&a<=5?.9:a>=8&&a<=12?.7:.3/a}),spectralTilt:0,evenOddBalance:0,filter:{type:"bandpass",cutoff:1800,resonance:7},envelope:{attack:150,decay:350,sustain:80,release:500},lfo:{rate:.4,depth:30,target:"filter"},maxVoices:8},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Analog Saw Bass",harmonicSynth:{harmonics:Yb,spectralTilt:-10,evenOddBalance:0,filter:{type:"lowpass",cutoff:1500,resonance:8},envelope:{attack:5,decay:120,sustain:70,release:80},lfo:{rate:0,depth:0,target:"pitch"},maxVoices:4},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Sweeping Lead",harmonicSynth:{harmonics:Yb,spectralTilt:10,evenOddBalance:0,filter:{type:"lowpass",cutoff:3e3,resonance:12},envelope:{attack:10,decay:200,sustain:65,release:180},lfo:{rate:3.5,depth:60,target:"filter"},maxVoices:4},effects:[],volume:-6,pan:0},{type:"synth",synthType:"HarmonicSynth",name:"Ethereal Shimmer",harmonicSynth:{harmonics:Array.from({length:32},(e,t)=>{const a=t+1;return Math.sin(a*Math.PI/8)*(1/a)}),spectralTilt:5,evenOddBalance:50,filter:{type:"lowpass",cutoff:9e3,resonance:2},envelope:{attack:400,decay:600,sustain:75,release:1e3},lfo:{rate:.15,depth:90,target:"spectral"},maxVoices:8}}],ev=[{type:"synth",name:"Classic Wobble",synthType:"WobbleBass",wobbleBass:{mode:"classic",osc1:{type:"sawtooth",octave:-1,detune:0,level:100},osc2:{type:"sawtooth",octave:-1,detune:7,level:80},sub:{enabled:!0,octave:-2,level:60},fm:{enabled:!1,amount:30,ratio:2,envelope:50},unison:{voices:4,detune:15,stereoSpread:50},filter:{type:"lowpass",cutoff:800,resonance:60,rolloff:-24,drive:30,keyTracking:0},filterEnvelope:{amount:70,attack:5,decay:300,sustain:20,release:200},wobbleLFO:{enabled:!0,sync:"1/4",rate:4,shape:"sine",amount:80,pitchAmount:0,fmAmount:0,phase:0,retrigger:!0},envelope:{attack:5,decay:200,sustain:80,release:300},distortion:{enabled:!0,type:"soft",drive:40,tone:70},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"Growl Bass",synthType:"WobbleBass",wobbleBass:{mode:"growl",osc1:{type:"sawtooth",octave:-2,detune:0,level:100},osc2:{type:"square",octave:-2,detune:5,level:70},sub:{enabled:!0,octave:-2,level:80},fm:{enabled:!0,amount:40,ratio:1,envelope:60},unison:{voices:2,detune:10,stereoSpread:30},filter:{type:"bandpass",cutoff:600,resonance:40,rolloff:-12,drive:50,keyTracking:20},filterEnvelope:{amount:50,attack:10,decay:400,sustain:40,release:200},wobbleLFO:{enabled:!0,sync:"1/8",rate:4,shape:"saw",amount:60,pitchAmount:0,fmAmount:30,phase:0,retrigger:!0},envelope:{attack:5,decay:300,sustain:60,release:200},distortion:{enabled:!0,type:"hard",drive:60,tone:50},formant:{enabled:!0,vowel:"O",morph:50,lfoAmount:40}},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Wobble",synthType:"WobbleBass",wobbleBass:{mode:"reese",osc1:{type:"sawtooth",octave:-1,detune:-10,level:90},osc2:{type:"sawtooth",octave:-1,detune:10,level:90},sub:{enabled:!0,octave:-2,level:70},fm:{enabled:!1,amount:0,ratio:1,envelope:0},unison:{voices:6,detune:25,stereoSpread:80},filter:{type:"lowpass",cutoff:1200,resonance:30,rolloff:-24,drive:20,keyTracking:0},filterEnvelope:{amount:0,attack:0,decay:0,sustain:0,release:0},wobbleLFO:{enabled:!0,sync:"1/2",rate:1,shape:"triangle",amount:50,pitchAmount:0,fmAmount:0,phase:0,retrigger:!1},envelope:{attack:20,decay:500,sustain:100,release:800},distortion:{enabled:!0,type:"soft",drive:30,tone:60},formant:{enabled:!1,vowel:"A",morph:0,lfoAmount:0}},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Pluck Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:300,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Fat Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:5,octave:-1},envelope:{attack:10,decay:400,sustain:.4,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Sine Sub",synthType:"Synth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"808 Sub",synthType:"MonoSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:5,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:1,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Reese Bass",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:15,octave:0},envelope:{attack:10,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:800,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"House Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Wobble Bass",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:5,decay:400,sustain:0,release:100},filter:{type:"lowpass",frequency:1e3,Q:8,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Duo Sub Bass",synthType:"DuoSynth",oscillator:{type:"triangle",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:1,release:100},effects:[],volume:-6,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},...ub,...hb],tv=[{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Pluck Keys",synthType:"PluckSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:500},filter:{type:"lowpass",frequency:2500,Q:1,rolloff:-12},effects:[],volume:-10,pan:0},{type:"synth",name:"Guitar Pluck",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:-1},envelope:{attack:5,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:200,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"AM Bell",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"AM Sci-Fi",synthType:"AMSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:.5,release:1e3},effects:[],volume:-6,pan:0},{type:"synth",name:"FM Electric Piano",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:.2,release:500},effects:[],volume:-6,pan:0},{type:"synth",name:"Duo Saw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:10,decay:200,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"Square Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:100,sustain:.8,release:100},effects:[],volume:-10,pan:0},{type:"synth",name:"Supersaw Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:20,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"lowpass",frequency:3e3,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Acid Lead",synthType:"MonoSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:350,sustain:0,release:200},filter:{type:"lowpass",frequency:2e3,Q:5,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"FM Stab",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"lowpass",frequency:4e3,Q:3,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Sync Lead",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:10,decay:450,sustain:0,release:300},filter:{type:"lowpass",frequency:2500,Q:3,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Lead",synthType:"Synth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:250,sustain:0,release:100},filter:{type:"lowpass",frequency:3e3,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Trance Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:300},filter:{type:"lowpass",frequency:4e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Detuned Lead",synthType:"DuoSynth",oscillator:{type:"sawtooth",detune:25,octave:0},envelope:{attack:30,decay:450,sustain:0,release:400},filter:{type:"lowpass",frequency:2800,Q:2,rolloff:-24},effects:[],volume:-12,pan:0},{type:"synth",name:"Filtered Lead",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:20,decay:400,sustain:0,release:300},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"AM Tremolo Lead",synthType:"AMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:10,decay:300,sustain:.5,release:200},effects:[],volume:-8,pan:0},{type:"synth",name:"FM Bell Lead",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:1e3,sustain:0,release:800},effects:[],volume:-10,pan:0},{type:"synth",name:"Harp Pluck",synthType:"PluckSynth",oscillator:{type:"sine",detune:0,octave:1},envelope:{attack:1,decay:800,sustain:0,release:500},effects:[],volume:-8,pan:0},{type:"synth",name:"Nylon Guitar",synthType:"PluckSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:1,decay:1200,sustain:0,release:1e3},effects:[],volume:-8,pan:0},{type:"synth",name:"PWM Solo Lead",synthType:"PWMSynth",pwmSynth:{pulseWidth:20,pwmDepth:40,pwmRate:1.5,pwmWaveform:"sine",oscillators:2,detune:5,envelope:{attack:10,decay:300,sustain:.6,release:200},filter:{type:"lowpass",cutoff:3e3,resonance:30,envelopeAmount:20,keyTracking:50},filterEnvelope:{attack:5,decay:400,sustain:.2,release:100}},effects:[],volume:-10,pan:0},{type:"synth",name:"Poly Brass",synthType:"PolySynth",polySynth:{voiceCount:6,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:50,decay:400,sustain:.7,release:200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-10,pan:0},{type:"synth",name:"SuperSaw Lead",synthType:"SuperSaw",superSaw:{voices:7,detune:40,mix:70,stereoSpread:80,envelope:{attack:10,decay:300,sustain:50,release:200},filter:{type:"lowpass",cutoff:5e3,resonance:20,envelopeAmount:50},filterEnvelope:{attack:5,decay:400,sustain:0,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Robot Talk",synthType:"FormantSynth",formantSynth:{vowel:"E",vowelMorph:{target:"U",amount:80,rate:2,mode:"manual"},oscillator:{type:"square"},formants:{...Cn.E,bandwidth:120},envelope:{attack:5,decay:200,sustain:.5,release:100},brightness:80},effects:[],volume:-10,pan:0}],av=[{type:"synth",name:"Ambient Pad",synthType:"Synth",oscillator:{type:"sine",detune:3,octave:0},envelope:{attack:800,decay:2e3,sustain:0,release:1500},filter:{type:"lowpass",frequency:1500,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Dark Pad",synthType:"DuoSynth",oscillator:{type:"triangle",detune:8,octave:0},envelope:{attack:1e3,decay:2500,sustain:0,release:2e3},filter:{type:"lowpass",frequency:800,Q:2,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"String Pad",synthType:"Synth",oscillator:{type:"sawtooth",detune:5,octave:0},envelope:{attack:500,decay:1800,sustain:0,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1.5,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Noise Sweep",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:300,decay:1500,sustain:0,release:1e3},filter:{type:"bandpass",frequency:1e3,Q:5,rolloff:-24},effects:[],volume:-18,pan:0},{type:"synth",name:"AM Atmospheric",synthType:"AMSynth",oscillator:{type:"sine",detune:5,octave:0},envelope:{attack:1500,decay:3e3,sustain:.8,release:2e3},effects:[],volume:-12,pan:0},{type:"synth",name:"Wavetable Evolving Pad",synthType:"Wavetable",wavetable:{wavetableId:"evolve-1",morphPosition:0,morphModSource:"lfo",morphModAmount:80,morphLFORate:.1,unison:{voices:4,detune:12,stereoSpread:60},envelope:{attack:1e3,decay:2e3,sustain:.7,release:1500},filter:{type:"lowpass",cutoff:1500,resonance:20,envelopeAmount:30},filterEnvelope:{attack:2e3,decay:1e3,sustain:.5,release:1e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"Poly Soft Strings",synthType:"PolySynth",polySynth:{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:10,octave:0},envelope:{attack:500,decay:1e3,sustain:.8,release:1200},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},portamento:0},effects:[],volume:-14,pan:0},{type:"synth",name:"PWM Strings",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:30,pwmRate:.5,pwmWaveform:"sine",oscillators:3,detune:12,envelope:{attack:800,decay:1500,sustain:.9,release:1500},filter:{type:"lowpass",cutoff:1200,resonance:15,envelopeAmount:0,keyTracking:30},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"Solina Ensemble",synthType:"StringMachine",stringMachine:{sections:{violin:100,viola:80,cello:60,bass:40},ensemble:{depth:70,rate:2.5,voices:4},attack:300,release:1500,brightness:50},effects:[],volume:-10,pan:0},{type:"synth",name:"Ethereal Choir",synthType:"FormantSynth",formantSynth:{vowel:"A",vowelMorph:{target:"O",amount:50,rate:.2,mode:"lfo"},oscillator:{type:"sawtooth"},formants:{...Cn.A,bandwidth:80},envelope:{attack:1e3,decay:2e3,sustain:.8,release:2e3},brightness:60},effects:[],volume:-12,pan:0},{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"Wavetable Morph Pad",synthType:"Wavetable",wavetable:{wavetableId:"morph-2",morphPosition:50,morphModSource:"lfo",morphModAmount:40,morphLFORate:.2,unison:{voices:6,detune:20,stereoSpread:90},envelope:{attack:1200,decay:2500,sustain:.8,release:2e3},filter:{type:"lowpass",cutoff:2e3,resonance:10,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-12,pan:0},{type:"synth",name:"PWM Soft Pad",synthType:"PWMSynth",pwmSynth:{pulseWidth:50,pwmDepth:20,pwmRate:.3,pwmWaveform:"sine",oscillators:2,detune:8,envelope:{attack:1500,decay:2e3,sustain:.9,release:2e3},filter:{type:"lowpass",cutoff:800,resonance:5,envelopeAmount:0,keyTracking:20},filterEnvelope:{attack:10,decay:500,sustain:1,release:100}},effects:[],volume:-14,pan:0},{type:"synth",name:"Granular Cloud",synthType:"GranularSynth",granular:{sampleUrl:"",grainSize:.1,grainOverlap:.05,detune:5,playbackRate:1,randomPitch:0,randomPosition:0,scanPosition:0,scanSpeed:0,density:1,reverse:!1,envelope:{attack:10,release:100},filter:{type:"lowpass",cutoff:2e3,resonance:1}},effects:[],volume:-10,pan:0}],nv=[vb,xb,wb,{type:"synth",name:"808 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:500,sustain:0,release:100},filter:{type:"lowpass",frequency:100,Q:1,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:300,sustain:0,release:50},filter:{type:"lowpass",frequency:80,Q:2,rolloff:-24},effects:[],volume:-6,pan:0},{type:"synth",name:"Hardcore Kick",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-2},envelope:{attack:1,decay:150,sustain:0,release:20},filter:{type:"lowpass",frequency:120,Q:3,rolloff:-24},effects:[],volume:-4,pan:0},{type:"synth",name:"DnB Snare",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:200,sustain:0,release:100},filter:{type:"highpass",frequency:300,Q:1,rolloff:-12},effects:[],volume:-8,pan:0},{type:"synth",name:"Clap",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:150,sustain:0,release:50},filter:{type:"bandpass",frequency:1e3,Q:2,rolloff:-24},effects:[],volume:-10,pan:0},{type:"synth",name:"Closed Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:50,sustain:0,release:20},filter:{type:"highpass",frequency:8e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Open Hat",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:200},filter:{type:"highpass",frequency:7e3,Q:1,rolloff:-12},effects:[],volume:-12,pan:0},{type:"synth",name:"Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:10,decay:1500,sustain:0,release:1e3},filter:{type:"highpass",frequency:6e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"Synth Low Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:400,sustain:0,release:100},effects:[],volume:-8,pan:-20},{type:"synth",name:"Synth Mid Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:-1},envelope:{attack:1,decay:350,sustain:0,release:80},effects:[],volume:-8,pan:0},{type:"synth",name:"Synth Hi Tom",synthType:"MembraneSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:60},effects:[],volume:-8,pan:20},...Sb],sv=[{type:"synth",name:"NES Major Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:15,delay:200},arpeggio:{enabled:!0,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"C64 Minor Arp",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:4,depth:10,delay:300},arpeggio:{enabled:!0,speed:12,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"SID Dim7 Pad",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:50,decay:600,sustain:0,release:500},vibrato:{speed:3,depth:8,delay:100},arpeggio:{enabled:!0,speed:8,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:6},{noteOffset:9}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Gameboy Sus4",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:12.5},bitDepth:4,sampleRate:16384,envelope:{attack:1,decay:200,sustain:0,release:100},vibrato:{speed:6,depth:20,delay:150},arpeggio:{enabled:!0,speed:18,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:5},{noteOffset:7}],mode:"loop"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Atari Dom7",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:4,sampleRate:15720,envelope:{attack:1,decay:300,sustain:0,release:200},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:20,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Amiga Power Oct",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:8,sampleRate:28867,envelope:{attack:5,decay:300,sustain:0,release:250},vibrato:{speed:4,depth:12,delay:200},arpeggio:{enabled:!0,speed:14,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:7},{noteOffset:12}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Fast Maj9 Stab",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:150,sustain:0,release:80},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!0,speed:30,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7},{noteOffset:11},{noteOffset:14}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Slow Min7 Sweep",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:100,decay:800,sustain:0,release:600},vibrato:{speed:3,depth:15,delay:500},arpeggio:{enabled:!0,speed:4,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:3},{noteOffset:7},{noteOffset:10}],mode:"loop"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Chip Square Lead",synthType:"ChipSynth",chipSynth:{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:300,sustain:0,release:200},vibrato:{speed:6,depth:15,delay:200},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:4},{noteOffset:7}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Triangle Bass",synthType:"ChipSynth",chipSynth:{channel:"triangle",bitDepth:4,sampleRate:22050,envelope:{attack:1,decay:400,sustain:0,release:150},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12}],mode:"loop"}},effects:[],volume:-6,pan:0},{type:"synth",name:"Noise Snare",synthType:"ChipSynth",chipSynth:{channel:"noise",bitDepth:1,sampleRate:22050,envelope:{attack:1,decay:100,sustain:0,release:50},vibrato:{speed:0,depth:0,delay:0},arpeggio:{enabled:!1,speed:15,speedUnit:"hz",steps:[{noteOffset:0}],mode:"loop"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Octave Jump",synthType:"ChipSynth",chipSynth:{channel:"pulse2",pulse:{duty:25},bitDepth:8,sampleRate:22050,envelope:{attack:1,decay:250,sustain:0,release:150},vibrato:{speed:5,depth:10,delay:250},arpeggio:{enabled:!0,speed:10,speedUnit:"hz",steps:[{noteOffset:0},{noteOffset:12},{noteOffset:24}],mode:"loop"}},effects:[],volume:-10,pan:0}],rv=[{type:"synth",name:"909 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",kick:{pitch:80,pitchDecay:50,tone:50,toneDecay:20,decay:300,drive:50,envAmount:2.5,envDuration:50,filterFreq:3e3}},effects:[],volume:-6,pan:0},{type:"synth",name:"909 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",snare:{pitch:220,tone:25,toneDecay:250,snappy:70,decay:100,envAmount:4,envDuration:10,filterType:"notch",filterFreq:1e3}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",clap:{tone:55,decay:80,toneDecay:250,spread:10,filterFreqs:[900,1200],modulatorFreq:40}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Rim",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",rimshot:{decay:30,filterFreqs:[220,500,950],filterQ:10.5,saturation:3}},effects:[],volume:-10,pan:0},{type:"synth",name:"909 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:100,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:200,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",tom:{pitch:300,decay:200,tone:5,toneDecay:100,envAmount:2,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"909 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:60,decay:50,metallic:65}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",hihat:{tone:55,decay:350,metallic:60}},effects:[],volume:-12,pan:0},{type:"synth",name:"909 Ride",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:1,decay:800,sustain:.1,release:500},filter:{type:"highpass",frequency:5e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0},{type:"synth",name:"909 Crash",synthType:"MetalSynth",oscillator:{type:"square",detune:0,octave:0},envelope:{attack:5,decay:2e3,sustain:.05,release:1500},filter:{type:"highpass",frequency:4e3,Q:1,rolloff:-12},effects:[],volume:-14,pan:0}],iv=[{type:"synth",name:"808 Kick",synthType:"DrumMachine",drumMachine:{drumType:"kick",machineType:"808",kick:{pitch:48,pitchDecay:110,tone:50,toneDecay:20,decay:200,drive:60,envAmount:2,envDuration:110,filterFreq:250}},effects:[],volume:-6,pan:0},{type:"synth",name:"808 Snare",synthType:"DrumMachine",drumMachine:{drumType:"snare",machineType:"808",snare:{pitch:238,pitchHigh:476,tone:50,toneDecay:75,snappy:50,decay:100,envAmount:1,envDuration:100,filterType:"highpass",filterFreq:1300}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Clap",synthType:"DrumMachine",drumMachine:{drumType:"clap",machineType:"808",clap:{tone:50,decay:115,toneDecay:200,spread:100,filterFreqs:[1e3,1e3],modulatorFreq:10}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Rimshot",synthType:"DrumMachine",drumMachine:{drumType:"rimshot",machineType:"808",rimshot:{decay:40,filterFreqs:[480,1750,2450],filterQ:5,saturation:2.5}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Clave",synthType:"DrumMachine",drumMachine:{drumType:"clave",machineType:"808",clave:{decay:40,pitch:2450,pitchSecondary:1750,filterFreq:2450}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Cowbell",synthType:"DrumMachine",drumMachine:{drumType:"cowbell",machineType:"808",cowbell:{decay:400,filterFreq:2640}},effects:[],volume:-10,pan:0},{type:"synth",name:"808 Maracas",synthType:"DrumMachine",drumMachine:{drumType:"maracas",machineType:"808",maracas:{decay:30,filterFreq:5e3}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Low Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:90,decay:200,tone:20,toneDecay:155,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:140,decay:190,tone:20,toneDecay:130,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Tom",synthType:"DrumMachine",drumMachine:{drumType:"tom",machineType:"808",tom:{pitch:190,decay:180,tone:20,toneDecay:100,envAmount:1,envDuration:100}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Low Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:190,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Mid Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:280,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Hi Conga",synthType:"DrumMachine",drumMachine:{drumType:"conga",machineType:"808",conga:{pitch:410,decay:180,tuning:50}},effects:[],volume:-8,pan:0},{type:"synth",name:"808 Closed Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:50,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Open Hat",synthType:"DrumMachine",drumMachine:{drumType:"hihat",machineType:"808",hihat:{tone:50,decay:270,metallic:50}},effects:[],volume:-12,pan:0},{type:"synth",name:"808 Cymbal",synthType:"DrumMachine",drumMachine:{drumType:"cymbal",machineType:"808",cymbal:{tone:50,decay:3e3}},effects:[],volume:-14,pan:0}],ov=[{type:"synth",name:"Riser",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:2e3,decay:100,sustain:0,release:100},filter:{type:"lowpass",frequency:200,Q:5,rolloff:-24},effects:[],volume:-16,pan:0},{type:"synth",name:"Downlifter",synthType:"MonoSynth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:10,decay:2e3,sustain:0,release:100},filter:{type:"lowpass",frequency:5e3,Q:3,rolloff:-24},effects:[],volume:-14,pan:0},{type:"synth",name:"Impact",synthType:"NoiseSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:500,sustain:0,release:200},filter:{type:"lowpass",frequency:300,Q:2,rolloff:-24},effects:[],volume:-8,pan:0},{type:"synth",name:"Laser Zap",synthType:"FMSynth",oscillator:{type:"sine",detune:0,octave:0},envelope:{attack:1,decay:300,sustain:0,release:100},filter:{type:"bandpass",frequency:2e3,Q:10,rolloff:-24},effects:[],volume:-12,pan:0}],lv=[{type:"synth",name:"Web Audio Module (WAM)",synthType:"WAM",wam:{moduleUrl:"",pluginState:null},effects:[],volume:-12,pan:0}],cv=[{type:"synth",name:"505 Kick",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Snare",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Clap",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Rim",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"505 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"505 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"505 Crash",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"505 Ride",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"505 Low Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 High Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-cowb-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"505 Low Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-20},{type:"synth",name:"505 High Conga",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-conga-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:20},{type:"synth",name:"505 Timbale",synthType:"Sampler",sample:{url:"data/samples/tr505/tr505-timbal.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0}],uv=[{type:"synth",name:"707 Kick",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Kick Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-kick-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Snare",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-snare.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Clap",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-clap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Closed Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-closed.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Open Hat",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-hihat-open.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Rim",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-rim.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 Low Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Low Tom Rumble",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-l-rumble.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:-30},{type:"synth",name:"707 Mid Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-m.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"707 High Tom",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tom-h.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:30},{type:"synth",name:"707 Cowbell",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-cowbell.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"707 Crash",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-crash.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:-20},{type:"synth",name:"707 Ride",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-ride.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:20},{type:"synth",name:"707 Tambourine",synthType:"Sampler",sample:{url:"data/samples/tr707/tr707-tambourine.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0}],dv=[{type:"synth",name:"DN 808 A1200",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN SubThud",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_SubThud.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Punchtron Kick",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/kicks/BD_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN 808 Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_808A1200.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Analog Noise",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Electro 7000",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_electro7000.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Wolf Snare",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/snares/SD_Wolf1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Closed Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Open Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_Digidap.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Analog Hat",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Cymbal",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/hihats/CYM_Synthique.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Clap",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Clave",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Tom",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-6,pan:0},{type:"synth",name:"DN Lazer",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/percussion/LAZ_R900.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-8,pan:0},{type:"synth",name:"DN Sonar",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Sonar.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Laser",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0},{type:"synth",name:"DN Burst",synthType:"Sampler",sample:{url:"data/samples/packs/drumnibus/fx/FX_Burst1.wav",baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},effects:[],volume:-10,pan:0}],pv=[{type:"synth",name:"VFX Digital Pad",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"VFX Evolving",synthType:"MAMEVFX",effects:[],volume:-10,pan:0},{type:"synth",name:"ESQ-1 Bass",synthType:"MAMEDOC",effects:[],volume:-8,pan:0},{type:"synth",name:"ESQ-1 Gritty Keys",synthType:"MAMEDOC",effects:[],volume:-10,pan:0},{type:"synth",name:"MKS-20 E.Piano 1",synthType:"MAMERSA",effects:[],volume:-10,pan:0},{type:"synth",name:"RD-1000 Grand",synthType:"MAMERSA",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Grand Piano",synthType:"MAMESWP30",effects:[],volume:-8,pan:0},{type:"synth",name:"AWM2 Synth Brass",synthType:"MAMESWP30",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Brass 1",synthType:"CZ101",effects:[],volume:-8,pan:0},{type:"synth",name:"CZ Electric Piano",synthType:"CZ101",effects:[],volume:-10,pan:0},{type:"synth",name:"CZ Synth Bass",synthType:"CZ101",effects:[],volume:-6,pan:0},{type:"synth",name:"CZ Digital Pad",synthType:"CZ101",effects:[],volume:-10,pan:0}],mv=[{type:"synth",name:"Jazz Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!0,volume:60,decay:"fast",harmonic:"third"},keyClick:40,vibrato:{type:"C3",depth:60},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-10,pan:0},{type:"synth",name:"Gospel Organ",synthType:"Organ",organ:{drawbars:[8,8,8,8,8,8,8,8,8],percussion:{enabled:!1,volume:50,decay:"slow",harmonic:"second"},keyClick:20,vibrato:{type:"V3",depth:40},rotary:{enabled:!0,speed:"slow"}},effects:[],volume:-8,pan:0},{type:"synth",name:"Church Organ",synthType:"Organ",organ:{drawbars:[8,0,8,0,8,0,0,8,8],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:0,vibrato:{type:"V1",depth:20},rotary:{enabled:!1,speed:"slow"}},effects:[],volume:-12,pan:0},{type:"synth",name:"Rock Organ",synthType:"Organ",organ:{drawbars:[8,8,8,0,0,0,0,0,0],percussion:{enabled:!1,volume:0,decay:"fast",harmonic:"third"},keyClick:80,vibrato:{type:"C3",depth:80},rotary:{enabled:!0,speed:"fast"}},effects:[],volume:-8,pan:0}],hv=[{type:"synth",name:"Generic Module",synthType:"ChiptuneModule",effects:[],volume:-6,pan:0}],fv=[...ev,...tv,...av,...nv,...pv,...Ib,...mv,...hv,...iv,...rv,...uv,...cv,...sv,...mb,...jb,...ov,...lv,...hb,...fb,...kb,...Ab,...Ob,...dv,...Tb,...Db,...Rb,...Vb,...zb,...qb,...Xb,{type:"synth",name:"Sample Player",synthType:"Player",volume:-6,pan:0,effects:[]}],yv={Bass:ev,Leads:tv,Pads:av,Drums:nv,MAME:[...pv,...Ib],Keys:mv,Module:hv,"TR-808":iv,"TR-909":rv,"TR-707":uv,"TR-505":cv,Chip:sv,Furnace:[...mb,...jb],FX:ov,WAM:lv,Dub:[...hb,...fb,...kb,...Ab,...Sb],DubSiren:hb,SpaceLaser:fb,V2:[...kb,...Ab],Sam:Ob,Synare:Sb,Drumnibus:[...Tb,...dv],Dexed:Db,OBXd:Rb,Samples:Vb,Wavetables:zb,Buzz:qb,Makk:Xb,Harmonic:Jb};function gv(e){const t=yv[e];if(t&&t.length>0)return t[0];const a=fv.find(t=>t.synthType===e);if(a)return a;const n=ub.find(t=>t.synthType===e);if(n)return n;const s=Sb.find(t=>t.synthType===e);return s||null}class bv{view;offset=0;size;constructor(e){e instanceof DataView?this.view=e:this.view=new DataView(e),this.size=this.view.byteLength}getOffset(){return this.offset}setOffset(e){this.offset=e}getSize(){return this.size}seek(e){this.offset=e}skip(e){this.offset+=e}isEOF(){return this.offset>=this.size}readUint8(){const e=this.view.getUint8(this.offset);return this.offset+=1,e}readInt8(){const e=this.view.getInt8(this.offset);return this.offset+=1,e}readUint16(e=!0){const t=this.view.getUint16(this.offset,e);return this.offset+=2,t}readInt16(e=!0){const t=this.view.getInt16(this.offset,e);return this.offset+=2,t}readUint32(e=!0){const t=this.view.getUint32(this.offset,e);return this.offset+=4,t}readInt32(e=!0){const t=this.view.getInt32(this.offset,e);return this.offset+=4,t}readFloat32(e=!0){const t=this.view.getFloat32(this.offset,e);return this.offset+=4,t}readString(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);this.offset+=e;let a=0;for(;a<e&&0!==t[a];)a++;return(new TextDecoder).decode(t.slice(0,a))}readNullTerminatedString(){let e=0;for(;this.offset+e<this.size&&0!==this.view.getUint8(this.offset+e);)e++;const t=this.readString(e);return this.offset<this.size&&this.offset++,t}readPrefixedString(){const e=this.readUint8();return 0===e?"":this.readString(e)}readPrefixedString16(){const e=this.readUint16();return 0===e?"":this.readString(e)}readPrefixedString32(){const e=this.readUint32();return 0===e?"":this.readString(e)}readBytes(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,new Uint8Array(t)}readMagic(e){const t=new Uint8Array(this.view.buffer,this.view.byteOffset+this.offset,e);return this.offset+=e,Array.from(t).map(e=>String.fromCharCode(e)).join("")}}class vv{static parse(e){const t=new bv(e);if(t.readMagic(16).startsWith("-Furnace instr."))return this.parseOldFormat(t);t.seek(0);const a=t.readMagic(4);if("FINS"===a||"INS2"===a||"INST"===a)return this.parseNewFormat(t,a);throw new Error(`Invalid Furnace instrument header: ${a}`)}static parseNewFormat(e,t){"INS2"===t&&e.skip(4),e.skip(2);const a=e.readUint8(),n={...An,chipType:a,operators:Array.from({length:4},()=>({...An.operators[0]})),macros:[],opMacros:Array.from({length:4},()=>({})),wavetables:[]};let s="Furnace Instrument";const r=[];for(;!e.isEOF();)try{if(e.getOffset()+4>e.getSize())break;const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const a=e.readUint16(),i=e.getOffset()+a;if(i>e.getSize())break;switch(t){case"NA":case"NM":s=e.readString(a);break;case"FM":this.readFMFeature(e,n);break;case"WV":case"WL":case"LW":this.readWavePointers(e,r)}e.seek(i)}catch{break}return this.loadWavetables(e,r,n),{name:s,config:n}}static parseOldFormat(e){e.seek(16),e.skip(4);const t=e.readUint32(),a=e.readUint16(),n=e.readUint16();e.skip(4);const s=[];for(let l=0;l<a;l++)s.push(e.readUint32());if(e.skip(4*n),t>=e.getSize())throw new Error("Invalid data pointer");if(e.seek(t),"INST"!==e.readMagic(4))throw new Error("Invalid INST block");e.skip(4),e.skip(2);const r=e.readUint8();e.skip(1);const i=e.readNullTerminatedString(),o={...An,chipType:r,operators:[],macros:[],opMacros:[],wavetables:[]};if(e.getOffset()+8<=e.getSize()){o.algorithm=e.readUint8(),o.feedback=e.readUint8(),e.skip(2);const t=e.readUint8();e.skip(3);for(let a=0;a<4&&!(e.getOffset()+12>e.getSize());a++){const n={enabled:a<t,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.getOffset()+10<=e.getSize()&&e.skip(10),o.operators.push(n)}}return 0===o.operators.length&&(o.operators=Array.from({length:4},()=>({...An.operators[0]}))),this.loadWavetables(e,s,o),{name:i,config:o}}static readFMFeature(e,t){const a=e.readUint8(),n=15&a,s=a>>4&15;t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),e.skip(2),t.operators=[];for(let r=0;r<n;r++){const a={enabled:!!(s>>r&1),mult:15&e.readUint8(),dt:e.readUint8()>>4&7,dt2:0,tl:e.readUint8(),ar:31&e.readUint8(),dr:31&e.readUint8(),d2r:0,sl:e.readUint8()>>4&15,rr:15&e.readUint8(),rs:0,ssg:15&e.readUint8(),am:!1,ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};t.operators.push(a)}}static readWavePointers(e,t){const a=e.readUint16();e.skip(2*a);for(let n=0;n<a;n++)t.push(e.readUint32())}static loadWavetables(e,t,a){for(const n of t)if(n>0&&n<e.getSize()){e.seek(n);const t=this.readWaveBlock(e);t&&a.wavetables.push(t)}}static readWaveBlock(e){if(e.getOffset()+4>e.getSize())return null;if("WAVE"!==e.readMagic(4))return null;e.skip(20);const t=e.readUint32();e.skip(8);const a=[];for(let n=0;n<t&&!(e.getOffset()+4>e.getSize());n++)a.push(e.readInt32());return{id:0,data:a}}}const xv={1:{id:1,name:"YMU759",chipType:19,fmChannels:17,psgChannels:0,totalChannels:17},2:{id:2,name:"Genesis",chipType:0,fmChannels:6,psgChannels:4,totalChannels:10},3:{id:3,name:"SMS",chipType:3,fmChannels:0,psgChannels:4,totalChannels:4},4:{id:4,name:"Game Boy",chipType:5,fmChannels:0,psgChannels:4,totalChannels:4},5:{id:5,name:"PC Engine",chipType:6,fmChannels:0,psgChannels:6,totalChannels:6},6:{id:6,name:"NES",chipType:4,fmChannels:0,psgChannels:5,totalChannels:5},7:{id:7,name:"C64",chipType:10,fmChannels:0,psgChannels:3,totalChannels:3},8:{id:8,name:"Arcade",chipType:1,fmChannels:13,psgChannels:0,totalChannels:13},9:{id:9,name:"Neo Geo",chipType:14,fmChannels:4,psgChannels:7,totalChannels:13},10:{id:10,name:"Genesis Ext",chipType:0,fmChannels:9,psgChannels:4,totalChannels:13},11:{id:11,name:"SMS + OPLL",chipType:11,fmChannels:9,psgChannels:4,totalChannels:13},12:{id:12,name:"NES + VRC7",chipType:4,fmChannels:6,psgChannels:5,totalChannels:11},13:{id:13,name:"NES + FDS",chipType:16,fmChannels:0,psgChannels:6,totalChannels:6}};class wv{static SYSTEM_MAP={1:19,2:0,3:3,4:5,5:6,6:4,7:10,8:1,9:14,10:0,11:11,12:4,13:16};static parse(e,t){const a=new bv(e),n=a.readMagic(16);if("dmf"===t){if(!n.startsWith(".DeFleMask."))throw new Error("Invalid DMF magic");return this.parseDMF(a,n)}if("dmp"===t)return a.seek(0),this.parseDMP(a);if("dmw"===t)return a.seek(0),this.parseDMW(a);throw new Error(`Unknown format: ${t}`)}static parseDMF(e,t){const a=this.extractVersion(t),n=e.readUint8(),s=xv[n]??xv[2],r={version:a,system:s,name:"",author:"",timeBase:0,ticksPerRow:[6,6],framesPerTick:1,patternRows:64,matrixRows:1,arpeggioTickSpeed:1,instruments:[],wavetables:[],patterns:[],patternMatrix:[],channelCount:s.totalChannels};if(a>=17?(r.name=e.readPrefixedString(),r.author=e.readPrefixedString(),e.readUint8(),e.readUint8()):a>=10&&(r.name=e.readNullTerminatedString(),r.author=e.readNullTerminatedString()),r.timeBase=e.readUint8(),r.ticksPerRow=[e.readUint8(),e.readUint8()],a>=14&&(r.framesPerTick=e.readUint8()),a>=19){e.readUint8()&&(e.readUint8(),e.readUint8(),e.readUint8())}r.patternRows=e.readUint32(),r.matrixRows=e.readUint8(),a>=21&&(r.arpeggioTickSpeed=e.readUint8()),r.patternMatrix=[];for(let l=0;l<r.channelCount;l++){const t=[];for(let a=0;a<r.matrixRows;a++)t.push(e.readUint8());r.patternMatrix.push(t)}const i=e.readUint8();for(let l=0;l<i;l++){const t=this.parseInstrument(e,a,s);r.instruments.push(t)}const o=e.readUint8();for(let l=0;l<o;l++){const t=e.readUint32(),a=[];for(let n=0;n<t;n++)a.push(e.readUint32());r.wavetables.push(a)}for(let l=0;l<r.channelCount;l++){const t=e.readUint8();for(let a=0;a<r.matrixRows;a++){const a={rows:[]};for(let n=0;n<r.patternRows;n++){const s={note:e.readUint16(),octave:e.readUint16(),volume:e.readInt16(),instrument:e.readInt16(),effects:[]};for(let a=0;a<t;a++){const t=e.readInt16(),a=e.readInt16();t>=0&&s.effects.push({code:t,value:a})}a.rows[n]||(a.rows[n]=[]),a.rows[n][l]=s}r.patterns.push(a)}}return r}static extractVersion(e){const t=e.match(/\.DeFleMask\.(\d+)/);return t?parseInt(t[1],10):24}static parseInstrument(e,t,a){const n=t>=17?e.readPrefixedString():e.readNullTerminatedString(),s=e.readUint8(),r={...An,chipType:this.SYSTEM_MAP[a.id]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===s){r.algorithm=e.readUint8(),r.feedback=e.readUint8();const n=11===a.id||12===a.id?2:4;t>=19&&(e.readUint8(),e.readUint8());for(let a=0;a<n;a++){const a=this.parseOperator(e,t);r.operators.push(a)}}else this.readMacros(e,r);return{name:n,config:r}}static parseOperator(e,t){const a={enabled:!0,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt:0,dt2:0,rs:0,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};return t>=11&&(a.dt=e.readInt8(),a.rs=e.readUint8()),t>=12&&e.readUint8(),t>=15&&(a.ssg=e.readUint8()),a}static parseDMP(e){e.readUint8();const t=e.readUint8(),a=e.readUint8(),n={...An,chipType:this.SYSTEM_MAP[t]??0,operators:[],macros:[],opMacros:[],wavetables:[]};if(0===a){n.algorithm=e.readUint8(),n.feedback=e.readUint8();for(let t=0;t<4;t++){const t={enabled:!0,mult:e.readUint8(),tl:e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),d2r:0,sl:e.readUint8(),rr:e.readUint8(),dt:e.readInt8(),dt2:0,rs:e.readUint8(),am:!1,ksr:!1,ksl:0,sus:!1,vib:!1,ws:0,ssg:0};n.operators.push(t)}}else this.readMacros(e,n);return{name:"DefleMask Instrument",config:n}}static parseDMW(e){const t=[];for(;!e.isEOF();)t.push(e.readUint8());return t}static readMacros(e,t){const a=["volume","arp","duty","wave","pitch"];for(const n of a){if(e.readUint8()){const s=e.readUint8(),r=e.readUint8(),i=[];for(let t=0;t<s;t++)i.push(e.readInt32());t.macros.push({type:a.indexOf(n),data:i,loop:r,release:-1,mode:0})}}}}function kv(e,t){const a={...e};for(const n of Object.keys(t)){const s=t[n],r=e[n];null!=s&&("object"!=typeof s||Array.isArray(s)||"object"!=typeof r||Array.isArray(r)?a[n]=s:a[n]=kv(r,s))}return a}function Sv(e){const t={...e};switch(e.synthType){case"TB303":case"Buzz3o3":t.tb303=kv(qn,e.tb303||{}),t.tb303?.devilFish&&0!==t.tb303.devilFish.filterSelect&&5!==t.tb303.devilFish.filterSelect&&(t.tb303.devilFish.filterSelect=0);break;case"DrumMachine":t.drumMachine=kv(kn,e.drumMachine||{});break;case"ChipSynth":t.chipSynth=kv(Sn,e.chipSynth||{});break;case"PWMSynth":t.pwmSynth=kv(Mn,e.pwmSynth||{});break;case"Wavetable":t.wavetable=kv(mn,e.wavetable||{});break;case"GranularSynth":t.granular=kv(hn,e.granular||{});break;case"SuperSaw":t.superSaw=kv(vn,e.superSaw||{});break;case"PolySynth":t.polySynth=kv(xn,e.polySynth||{});break;case"Organ":t.organ=kv(wn,e.organ||{});break;case"StringMachine":t.stringMachine=kv(Nn,e.stringMachine||{});break;case"FormantSynth":t.formantSynth=kv(_n,e.formantSynth||{});break;case"WobbleBass":t.wobbleBass=kv(Pn,e.wobbleBass||{});break;case"DubSiren":t.dubSiren=kv(jn,e.dubSiren||{});break;case"SpaceLaser":t.spaceLaser=kv(Un,e.spaceLaser||{});break;case"V2":t.v2=kv(zn,e.v2||{});break;case"Sam":t.sam=kv(Bn,e.sam||{});break;case"Synare":t.synare=kv(Gn,e.synare||{});break;case"Buzzmachine":t.buzzmachine=kv(En,e.buzzmachine||{});break;case"Dexed":t.dexed=kv(On,e.dexed||{});break;case"OBXd":t.obxd=kv(In,e.obxd||{});break;case"DrumKit":t.drumKit=kv(Dn,e.drumKit||{});break;case"Furnace":t.furnace=kv(An,e.furnace||{})}return t}function Mv(e){return"string"==typeof e.note}function Nv(e){return e.some(e=>{const t=e.id;return 0===t||t>0&&t%100==0&&t<3200})}function Cv(e){return 0===e?1:e%100==0&&e<3200?e/100+1:e}function Pv(e){const t={...e};if("string"==typeof e.note?t.note=Qn(e.note):null!==e.note&&void 0!==e.note||(t.note=0),null===e.instrument||void 0===e.instrument?t.instrument=0:"number"==typeof e.instrument&&(t.instrument=Cv(e.instrument)),null===e.volume||void 0===e.volume?t.volume=0:"number"==typeof e.volume&&e.volume<=64&&(t.volume=16+e.volume),void 0!==e.effect&&"string"==typeof e.effect){const a=e.effect;if(a&&"..."!==a&&"000"!==a){const[e,n]=as(a);t.effTyp=e,t.eff=n}else t.effTyp=0,t.eff=0;delete t.effect}if(t.effTyp||0===t.effTyp||(t.effTyp=0),t.eff||0===t.eff||(t.eff=0),void 0!==e.effect2&&"string"==typeof e.effect2){const a=e.effect2;if(a&&"..."!==a&&"000"!==a){const[e,n]=as(a);t.effTyp2=e,t.eff2=n}else t.effTyp2=0,t.eff2=0;delete t.effect2}return void 0!==t.effTyp2&&null!==t.effTyp2||(t.effTyp2=0),void 0!==t.eff2&&null!==t.eff2||(t.eff2=0),t}function Ev(e){return{...e,channels:e.channels.map(e=>({...e,rows:e.rows.map(e=>Pv(e)),instrumentId:null!==e.instrumentId&&void 0!==e.instrumentId?Cv(e.instrumentId):1}))}}function _v(e){const t=new Map;let a=1;for(const n of e)if(!t.has(n.id)){const e=Cv(n.id);Array.from(t.values()).includes(e)?t.set(n.id,a++):(t.set(n.id,e),a=Math.max(a,e+1))}return e.map(e=>{const a=t.get(e.id)??e.id,n="Sampler"===e.synthType||"Player"===e.synthType?"sample":"synth";return{...Sv(e),id:a,type:e.type||n}})}function Tv(e,t){const a=e.some(e=>e.channels.some(e=>e.rows.some(e=>Mv(e)))),n=Nv(t),s=t.some(e=>!e.type),r=t.some(e=>function(e){switch(e.synthType){case"TB303":case"Buzz3o3":return!e.tb303||!e.tb303.filter||!e.tb303.filterEnvelope;case"DrumMachine":return!e.drumMachine;case"ChipSynth":return!e.chipSynth||!e.chipSynth.envelope;case"PWMSynth":return!e.pwmSynth||!e.pwmSynth.envelope;case"SuperSaw":return!e.superSaw||!e.superSaw.envelope;case"PolySynth":return!e.polySynth||!e.polySynth.envelope;case"Organ":return!e.organ||!e.organ.drawbars;case"StringMachine":return!e.stringMachine;case"FormantSynth":return!e.formantSynth||!e.formantSynth.envelope;case"WobbleBass":return!e.wobbleBass||!e.wobbleBass.envelope;case"DubSiren":return!e.dubSiren||!e.dubSiren.reverb;case"SpaceLaser":return!e.spaceLaser;case"Dexed":return!e.dexed;case"OBXd":return!e.obxd;case"DrumKit":return!e.drumKit;case"Furnace":return!e.furnace;default:return!1}}(e));return a||n||s||r}function Av(e,t){return{patterns:e.map(e=>Ev(e)),instruments:_v(t)}}const Ov=Object.freeze(Object.defineProperty({__proto__:null,deepMerge:kv,ensureCompleteInstrumentConfig:Sv,hasOldInstrumentIds:Nv,isOldFormatCell:Mv,migrateCell:Pv,migrateInstrumentId:Cv,migrateInstruments:_v,migratePattern:Ev,migrateProject:Av,needsMigration:Tv},Symbol.toStringTag,{value:"Module"}));class Iv{static reverse(e){const t=e.numberOfChannels,a=e.length,n=e.sampleRate,s=new AudioBuffer({length:a,numberOfChannels:t,sampleRate:n});for(let r=0;r<t;r++){const t=e.getChannelData(r),n=s.getChannelData(r);for(let e=0;e<a;e++)n[e]=t[a-1-e]}return s}static normalize(e){const t=e.numberOfChannels,a=e.length,n=e.sampleRate;let s=0;for(let o=0;o<t;o++){const t=e.getChannelData(o);for(let e=0;e<a;e++){const a=Math.abs(t[e]);a>s&&(s=a)}}if(0===s||1===s)return e;const r=1/s,i=new AudioBuffer({length:a,numberOfChannels:t,sampleRate:n});for(let o=0;o<t;o++){const t=e.getChannelData(o),n=i.getChannelData(o);for(let e=0;e<a;e++)n[e]=t[e]*r}return i}static invertLoop(e,t,a){const n=e.numberOfChannels,s=e.length,r=e.sampleRate,i=new AudioBuffer({length:s,numberOfChannels:n,sampleRate:r});for(let o=0;o<n;o++){const n=e.getChannelData(o),r=i.getChannelData(o);for(let e=0;e<t;e++)r[e]=n[e];for(let e=t;e<a&&e<s;e++)r[e]=-n[e];for(let e=a;e<s;e++)r[e]=n[e]}return i}static applyGain(e,t){const a=e.numberOfChannels,n=e.length,s=e.sampleRate,r=new AudioBuffer({length:n,numberOfChannels:a,sampleRate:s});for(let i=0;i<a;i++){const a=e.getChannelData(i),s=r.getChannelData(i);for(let e=0;e<n;e++)s[e]=a[e]*t}return r}static async bufferToWav(e){const t=e.numberOfChannels,a=e.sampleRate,n=e.length,s=2*t,r=a*s,i=n*s,o=44+i,l=new ArrayBuffer(o),c=new DataView(l);this.writeString(c,0,"RIFF"),c.setUint32(4,o-8,!0),this.writeString(c,8,"WAVE"),this.writeString(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,t,!0),c.setUint32(24,a,!0),c.setUint32(28,r,!0),c.setUint16(32,s,!0),c.setUint16(34,16,!0),this.writeString(c,36,"data"),c.setUint32(40,i,!0);let u=44;for(let d=0;d<n;d++)for(let a=0;a<t;a++){let t=e.getChannelData(a)[d];t=Math.max(-1,Math.min(1,t));const n=t<0?32768*t:32767*t;c.setInt16(u,n,!0),u+=2}return l}static writeString(e,t,a){for(let n=0;n<a.length;n++)e.setUint8(t+n,a.charCodeAt(n))}}function Fv(e){e&&(e.url&&URL.revokeObjectURL(e.url),e.multiMap&&Object.values(e.multiMap).forEach(e=>URL.revokeObjectURL(e)))}const Dv=new Set;function Rv(e,t){const a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=new Set;return e.forEach(e=>{e.channels.forEach(e=>{e.rows.forEach(e=>{if(e.instrument===t&&e.note>0&&e.note<=96){const t=(e.note-1)%12,s=Math.floor((e.note-1)/12),r=a[t];n.add(r.includes("#")?`${r}${s}`:`${r}-${s}`)}})})}),Array.from(n).sort()}function jv(e){for(let t=1;t<=128;t++)if(!e.includes(t))return t;return 1}const Bv=n()(Ga((e,t)=>({instruments:[],currentInstrumentId:0,get currentInstrument(){const e=t();return e.instruments.find(t=>t.id===e.currentInstrumentId)||null},previewInstrument:null,presets:[],setCurrentInstrument:t=>e(e=>{e.instruments.find(e=>e.id===t)&&(e.currentInstrumentId=t)}),setPreviewInstrument:t=>e(e=>{e.previewInstrument=t}),getInstrument:e=>t().instruments.find(t=>t.id===e),updateInstrument:(a,n)=>{const s=t().instruments.find(e=>e.id===a),r=s&&n.synthType&&n.synthType!==s.synthType,i=n.name&&n.synthType,o=!!(n.oscillator||n.envelope||n.filter||n.filterEnvelope||n.superSaw||n.polySynth||n.organ||n.drumMachine||n.chipSynth||n.pwmSynth||n.stringMachine||n.formantSynth||n.wavetable||n.granular||n.furnace||n.dubSiren||n.synare||n.sam||n.v2Speech||n.tb303||n.buzzmachine||n.spaceLaser||n.v2||n.wam);if(e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e=Object.fromEntries(Object.entries(n).filter(([e])=>"id"!==e));if(Object.keys(e).forEach(a=>{const n=e[a],s=a;n&&"object"==typeof n&&!Array.isArray(n)&&t[s]?t[s]={...t[s],...n}:t[s]=n}),r&&!i&&n.synthType?.startsWith("Furnace")){const e=Dg(n.synthType);e&&(t.furnace=e)}if(r&&"DubSiren"===n.synthType&&!t.dubSiren&&(t.dubSiren={...jn}),r&&"SpaceLaser"===n.synthType&&!t.spaceLaser&&(t.spaceLaser={...Un}),r&&"V2"===n.synthType&&!t.v2&&(t.v2={...zn}),r&&"Synare"===n.synthType&&!t.synare&&(t.synare={...Gn}),r&&"Sam"===n.synthType&&!t.sam&&(t.sam={...Bn}),r&&"V2Speech"===n.synthType&&!t.v2Speech&&(t.v2Speech={...Vn}),r&&!i&&n.synthType){const e=t.furnace?.chipType,a=t.buzzmachine?.machineType,s=gv(n.synthType);if(s){const r=s,i=Object.fromEntries(Object.entries(r).filter(([e])=>"name"!==e&&"type"!==e&&"synthType"!==e));Object.keys(i).forEach(e=>{const a=i[e],n=e;a&&"object"==typeof a&&!Array.isArray(a)&&t[n]?Object.assign(t[n],a):t[n]=a}),t.synthType=n.synthType,void 0!==e&&t.furnace&&(t.furnace.chipType=e),a&&t.buzzmachine&&(t.buzzmachine.machineType=a)}}}}),!r&&!i)try{const s=Qg(),r=t().instruments.find(e=>e.id===a);if(r){if(("TB303"===r.synthType||"Buzz3o3"===r.synthType)&&r.tb303&&n.tb303)return void s.updateTB303Parameters(a,r.tb303);if("DubSiren"===r.synthType&&r.dubSiren&&n.dubSiren)return void s.updateDubSirenParameters(a,r.dubSiren);if("SpaceLaser"===r.synthType&&r.spaceLaser&&n.spaceLaser)return void s.updateSpaceLaserParameters(a,r.spaceLaser);if("V2"===r.synthType&&r.v2&&n.v2)return void s.updateV2Parameters(a,r.v2);if(("V2"===r.synthType||"V2Speech"===r.synthType)&&r.v2Speech&&n.v2Speech)return void s.updateComplexSynthParameters(a,r.v2Speech);if("Sam"===r.synthType&&r.sam&&n.sam)return void s.updateComplexSynthParameters(a,r.sam);if("Synare"===r.synthType&&r.synare&&n.synare)return void s.updateSynareParameters(a,r.synare);if("HarmonicSynth"===r.synthType&&r.harmonicSynth&&n.harmonicSynth)return void s.updateHarmonicSynthParameters(a,r.harmonicSynth);if(r.synthType?.startsWith("Furnace")&&r.furnace&&n.furnace)return void s.updateFurnaceInstrument(a,r);if("Buzz3o3"===r.synthType&&r.tb303&&n.tb303){const t=r.tb303,n=r.buzzmachine||{machineType:"OomekAggressor",parameters:{}},i={...n.parameters};return i[0]="square"===t.oscillator.type?1:0,i[1]=Math.round(Math.log2(t.filter.cutoff/200)/Math.log2(25)*240),i[2]=Math.round(t.filter.resonance/100*128),i[3]=Math.round(t.filterEnvelope.envMod/100*128),i[4]=Math.round(Math.log2(t.filterEnvelope.decay/30)/Math.log2(100)*128),i[5]=Math.round(t.accent.amount/100*128),i[6]=Math.round((t.tuning||0)+100),e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(t.buzzmachine={...n,parameters:i})}),void s.updateBuzzmachineParameters(a,{...n,parameters:i})}if(r.synthType.startsWith("Buzz")&&r.buzzmachine&&n.buzzmachine)return void s.updateBuzzmachineParameters(a,r.buzzmachine);if(("Furnace"===r.synthType||r.synthType.startsWith("Furnace"))&&r.furnace&&n.furnace)return void s.updateFurnaceParameters(a,r.furnace);if("WAM"===r.synthType&&r.wam&&n.wam)return void s.updateWAMParameters(a,r.wam);if(["SuperSaw","WobbleBass","Organ","ChipSynth","PWMSynth","StringMachine","FormantSynth"].includes(r.synthType)){const e=r.synthType.charAt(0).toLowerCase()+r.synthType.slice(1),t=r[e];if(t&&n[e])return void s.updateComplexSynthParameters(a,t)}if(["Synth","FMSynth","AMSynth","MonoSynth","DuoSynth","PluckSynth","MembraneSynth","MetalSynth","NoiseSynth"].includes(r.synthType)&&(n.oscillator||n.envelope||n.filter||n.filterEnvelope||void 0!==n.volume))return void s.updateToneJsSynthInPlace(a,r)}}catch(l){}if(r||i||o)try{Qg().invalidateInstrument(a)}catch(l){}},createInstrument:a=>{const n=jv(t().instruments.map(e=>e.id));return e(e=>{const t={id:s=n,name:`TB303 ${String(s).padStart(2,"0")}`,type:"synth",synthType:"TB303",tb303:{...qn},oscillator:{...Wn},envelope:{...Hn},filter:{...Kn},effects:[],volume:0,pan:0};var s;const r=a?kv(t,a):t;if(r.id=n,void 0===a?.monophonic){const e=new Set(["MonoSynth","DuoSynth","TB303","Buzz3o3","DB303","DubSiren","SpaceLaser","Synare","MAMEMEA8000","MAMETMS5220","MAMESP0250","MAMEVotrax","Sam","V2Speech","MAMECM3394","MAMETMS36XX","MAMESN76477","MAMEUPD931","MAMEUPD933"]);r.synthType&&e.has(r.synthType)&&(r.monophonic=!0)}e.instruments.push(r),e.currentInstrumentId=n}),n},addInstrument:t=>{e(e=>{const a={...t};if(void 0===a.monophonic){const e=new Set(["MonoSynth","DuoSynth","TB303","Buzz3o3","DB303","DubSiren","SpaceLaser","Synare","MAMEMEA8000","MAMETMS5220","MAMESP0250","MAMEVotrax","Sam","V2Speech","MAMECM3394","MAMETMS36XX","MAMESN76477","MAMEUPD931","MAMEUPD933"]);a.synthType&&e.has(a.synthType)&&(a.monophonic=!0)}const n=e.instruments.find(e=>e.id===a.id);n?Object.assign(n,a):e.instruments.push(a),e.currentInstrumentId=a.id})},deleteInstrument:t=>e(e=>{const a=e.instruments.findIndex(e=>e.id===t);-1!==a&&e.instruments.length>1&&(Fv(e.instruments[a].sample),e.instruments.splice(a,1),e.currentInstrumentId===t&&(e.currentInstrumentId=e.instruments[0].id))}),cloneInstrument:a=>{const n=t().instruments.find(e=>e.id===a);if(!n)return a;const s=jv(t().instruments.map(e=>e.id));return e(e=>{const t=JSON.parse(JSON.stringify(n));t.id=s,t.name=`${n.name} (Copy)`,e.instruments.push(t),e.currentInstrumentId=s}),s},resetInstrument:t=>{e(e=>{const a=e.instruments.find(e=>e.id===t);if(a){const e=a.synthType,t=function(e){const t={synthType:e,effects:[],volume:-12,pan:0};switch(e){case"TB303":t.tb303={...qn};break;case"DrumMachine":t.drumMachine={...kn};break;case"ChipSynth":t.chipSynth={...Sn};break;case"PWMSynth":t.pwmSynth={...Mn};break;case"Wavetable":t.wavetable={...mn};break;case"GranularSynth":t.granular={...hn};break;case"SuperSaw":t.superSaw={...vn};break;case"PolySynth":t.polySynth={...xn};break;case"Organ":t.organ={...wn};break;case"StringMachine":t.stringMachine={...Nn};break;case"FormantSynth":t.formantSynth={..._n};break;case"WobbleBass":t.wobbleBass={...Pn};break;case"DubSiren":t.dubSiren={...jn};break;case"SpaceLaser":t.spaceLaser={...Un};break;case"V2":t.v2={...zn};break;case"Sam":t.sam={...Bn};break;case"Synare":t.synare={...Gn};break;case"WAMOBXd":case"WAMSynth101":case"WAMTinySynth":case"WAMFaustFlute":case"WAM":t.wam={...Ln};break;case"Buzz3o3":t.tb303={...qn},t.buzzmachine={...En,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}};break;case"Buzzmachine":t.buzzmachine={...En};break;case"Dexed":t.dexed={...On};break;case"OBXd":t.obxd={...In};break;case"DrumKit":t.drumKit={...Dn};break;case"ChiptuneModule":t.chiptuneModule={...bn};break;case"MAMEVFX":t.mame={...fn};break;case"MAMEDOC":t.mame={...yn};break;case"MAMERSA":t.rdpiano={...Fn};break;case"MAMESWP30":t.mame={...gn}}const a=gv(e);if(a){const n=a,s=Object.fromEntries(Object.entries(n).filter(([e])=>"name"!==e&&"type"!==e&&"synthType"!==e));Object.assign(t,s),t.synthType=e}return t}(e);if(Object.assign(a,{...t,synthType:e,name:a.name,tb303:void 0,drumMachine:void 0,chipSynth:void 0,pwmSynth:void 0,wavetable:void 0,granular:void 0,superSaw:void 0,polySynth:void 0,organ:void 0,stringMachine:void 0,formantSynth:void 0,furnace:void 0,chiptuneModule:void 0,wobbleBass:void 0,drumKit:void 0,dubSiren:void 0,spaceLaser:void 0,synare:void 0,v2:void 0}),"TB303"===e||"Buzz3o3"===e)a.tb303={...qn},"Buzz3o3"===e&&(a.buzzmachine={...En,machineType:"OomekAggressor",parameters:{0:0,1:120,2:64,3:64,4:64,5:64,6:100,7:100}});else if("DubSiren"===e)a.dubSiren={...jn};else if("SpaceLaser"===e)a.spaceLaser={...Un};else if("V2"===e)a.v2={...zn};else if("Synare"===e)a.synare={...Gn};else if(e.startsWith("Furnace")){const t=Dg(e);t&&(a.furnace=t)}}});try{Qg().invalidateInstrument(t)}catch(a){}},bakeInstrument:async(a,n="lite")=>{const s=t().instruments.find(e=>e.id===a);if(s&&"Sampler"!==s.synthType&&!Dv.has(a)){Dv.add(a);try{const r=Qg();s.sample&&Fv(s.sample);const i=JSON.parse(JSON.stringify(s));if(delete i.metadata,"pro"===n){const n=Rv((await ja(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>lb);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,a);if(0===n.length)return t().bakeInstrument(a,"lite");const o={};for(const e of n){const t=await r.bakeInstrument(s,2,e),a=await Iv.bufferToWav(t),n=new Blob([a],{type:"audio/wav"});o[e]=URL.createObjectURL(n)}e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:i,bakeType:"pro"}},t.synthType="Sampler",t.sample={url:"",multiMap:o,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}else{const t=await r.bakeInstrument(s,2,"C4"),n=await Iv.bufferToWav(t),o=new Blob([n],{type:"audio/wav"}),l=URL.createObjectURL(o);e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(t.metadata={...t.metadata,preservedSynth:{synthType:t.synthType,config:i,bakeType:"lite"}},t.synthType="Sampler",t.sample={url:l,baseNote:"C4",detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1,playbackRate:1},t.tb303=void 0,t.dubSiren=void 0,t.spaceLaser=void 0,t.synare=void 0,t.furnace=void 0,t.chipSynth=void 0,t.pwmSynth=void 0,t.wobbleBass=void 0)})}r.invalidateInstrument(a)}catch(r){}finally{Dv.delete(a)}}},unbakeInstrument:a=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t&&t.metadata?.preservedSynth){const{synthType:e,config:a}=t.metadata.preservedSynth;Fv(t.sample);const n={...t.metadata};delete n.preservedSynth,Object.assign(t,a),t.synthType=e,t.metadata=n,t.sample=void 0}});try{const e=Qg();e.invalidateInstrument(a);const n=t().instruments.find(e=>e.id===a);n&&e.rebuildInstrumentEffects(a,n.effects)}catch{}},autoBakeInstruments:async()=>{const a=t().instruments.filter(e=>e.metadata?.preservedSynth&&!e.sample?.url&&!e.sample?.multiMap);if(0!==a.length)for(const t of a){const a=t.metadata.preservedSynth,s={...t,...a.config,synthType:a.synthType},r=a.bakeType||"lite";try{const a=Qg();if("pro"===r){const n=Rv((await ja(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>lb);return{useTrackerStore:e}},void 0)).useTrackerStore.getState().patterns,t.id),r={};for(const e of n){const t=await a.bakeInstrument(s,2,e),n=await Iv.bufferToWav(t),i=new Blob([n],{type:"audio/wav"});r[e]=URL.createObjectURL(i)}e(e=>{const a=e.instruments.find(e=>e.id===t.id);a&&a.sample&&(a.sample.multiMap=r)})}else{const n=await a.bakeInstrument(s,2,"C4"),r=await Iv.bufferToWav(n),i=new Blob([r],{type:"audio/wav"}),o=URL.createObjectURL(i);e(e=>{const a=e.instruments.find(e=>e.id===t.id);a&&a.sample&&(a.sample.url=o)})}a.invalidateInstrument(t.id)}catch(n){}}},addEffect:(a,n)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e={id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:n,enabled:!0,wet:50,parameters:Og(n)};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===a);s&&(async()=>{try{const e=Qg();await e.rebuildInstrumentEffects(a,s.effects)}catch(e){}})()},addEffectConfig:(a,n)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e={...n,id:`effect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,parameters:{...Og(n.type),...n.parameters}};t.effects.push(e)}});const s=t().instruments.find(e=>e.id===a);s&&(async()=>{try{const e=Qg();await e.rebuildInstrumentEffects(a,s.effects)}catch(e){}})()},removeEffect:(a,n)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e=t.effects.findIndex(e=>e.id===n);-1!==e&&t.effects.splice(e,1)}});const s=t().instruments.find(e=>e.id===a);s&&(async()=>{try{const e=Qg();await e.rebuildInstrumentEffects(a,s.effects)}catch(e){}})()},updateEffect:(a,n,s)=>{if(e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const e=t.effects.find(e=>e.id===n);e&&(s.parameters&&Object.keys(e.parameters).length<Object.keys(Og(e.type)).length&&(e.parameters={...Og(e.type),...e.parameters}),Object.assign(e,s))}}),void 0!==s.enabled){const e=t().instruments.find(e=>e.id===a);e&&(async()=>{try{const t=Qg();await t.rebuildInstrumentEffects(a,e.effects)}catch(t){}})()}else{const e=t().instruments.find(e=>e.id===a),s=e?.effects.find(e=>e.id===n);if(s)try{Qg().updateInstrumentEffectParams(n,s)}catch{}}const r=t().instruments.find(e=>e.id===a),i=r?.effects.find(e=>e.id===n);if(1===i?.parameters.bpmSync)try{const e=Qg(),t=e.getBPM();e.updateBpmSyncedEffects(t)}catch{}},reorderEffects:(a,n,s)=>{e(e=>{const t=e.instruments.find(e=>e.id===a);if(t){const[e]=t.effects.splice(n,1);t.effects.splice(s,0,e)}});const r=t().instruments.find(e=>e.id===a);r&&(async()=>{try{const e=Qg();await e.rebuildInstrumentEffects(a,r.effects)}catch(e){}})()},loadPreset:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===a);n&&(Object.assign(n,t.config),n.id=a)});try{Qg().invalidateInstrument(a)}catch(n){}},saveAsPreset:(t,a,n)=>e(e=>{const s=e.instruments.find(e=>e.id===t);if(s){const t={id:`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:a,category:n,tags:[],author:"User",config:{name:s.name,type:s.type,synthType:s.synthType,oscillator:s.oscillator,envelope:s.envelope,filter:s.filter,filterEnvelope:s.filterEnvelope,tb303:s.tb303,effects:s.effects,volume:s.volume,pan:s.pan}};e.presets.push(t)}}),loadInstruments:a=>{const n=Qg();t().instruments.forEach(e=>{try{n.invalidateInstrument(e.id)}catch{}});const s=a.map(e=>({...Sv(e),synthType:e.tb303&&"TB303"!==e.synthType&&"Buzz3o3"!==e.synthType?"TB303":e.synthType,type:e.type||("Sampler"===e.synthType?"sample":"synth"),effects:e.effects?.map(e=>({...e,category:e.category||"tonejs"}))||[]}));e(e=>{e.instruments=s,e.currentInstrumentId=s.length>0?s[0].id:null}),Qg().preloadInstruments(s).catch(e=>{})},loadFurnaceInstrument:a=>{try{const{name:n,config:s}=vv.parse(a),r=jv(t().instruments.map(e=>e.id));e(e=>{const t={id:r,name:n||"Furnace Patch",type:"synth",synthType:"Furnace",furnace:s,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=r})}catch(n){}},loadDefleMaskInstrument:a=>{try{const n=wv.parse(a,"dmp"),{name:s,config:r}=n,i=jv(t().instruments.map(e=>e.id));e(e=>{const t={id:i,name:s||"DefleMask Patch",type:"synth",synthType:"Furnace",furnace:r,effects:[],volume:-6,pan:0};e.instruments.push(t),e.currentInstrumentId=i})}catch(n){}},loadDefleMaskWavetable:a=>{try{const n=wv.parse(a,"dmw"),s=t().currentInstrumentId;if(!s)return;e(e=>{const t=e.instruments.find(e=>e.id===s);"Furnace"===t?.synthType&&t.furnace&&t.furnace.wavetables.push({id:t.furnace.wavetables.length,data:n})})}catch(n){}},transformInstrument:(a,n,s)=>{const r=t().instruments.find(e=>e.id===a);if(!r)return;if("Sampler"!==r.synthType)return;const i=r.sample?{...r.sample,envelope:r.envelope||{...Hn}}:void 0;if(!i)return;let o;function l(t,a,n,s){e(e=>{const r=e.instruments.find(e=>e.id===t);if(!r)return;delete r.tb303,delete r.polySynth,delete r.wavetable,delete r.granular,delete r.superSaw,delete r.organ,delete r.drumMachine,delete r.chipSynth,delete r.pwmSynth,delete r.stringMachine,delete r.formantSynth,delete r.sample,r.type="synth",r.synthType=a;r[a.toLowerCase()]=n,r.metadata||(r.metadata={}),r.metadata.preservedSample=s,r.metadata.transformHistory||(r.metadata.transformHistory=[]),r.metadata.transformHistory.push({timestamp:(new Date).toISOString(),fromType:"Sampler",toType:a})});try{Qg().invalidateInstrument(t)}catch(r){}}"analyze"===s?ja(async()=>{const{analyzeSample:e,suggestSynthConfig:t}=await Promise.resolve().then(()=>$T);return{analyzeSample:e,suggestSynthConfig:t}},void 0).then(({analyzeSample:e,suggestSynthConfig:t})=>{const s=e({id:a,name:r.name,pcmData:i.audioBuffer||new ArrayBuffer(0),loopStart:i.loopStart,loopLength:i.loopEnd-i.loopStart,loopType:i.loop?"forward":"none",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:44100,length:1e3},r.metadata?.originalEnvelope);o=t(n,s),l(a,n,o,i)}):(o=function(e){switch(e){case"TB303":return{...qn};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{...Wn},envelope:{...Hn},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:1,detune:10,stereoSpread:50},envelope:{...Hn},filter:{...Kn,cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{...Hn}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{...Hn,attack:5,decay:300},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{...Wn},envelope:{...Hn}}}}(n),l(a,n,o,i))},revertToSample:a=>{const n=t().instruments.find(e=>e.id===a);if(!n)return;const s=n.metadata?.preservedSample;if(s){e(e=>{const t=e.instruments.find(e=>e.id===a);t&&(delete t.tb303,delete t.polySynth,delete t.wavetable,delete t.granular,delete t.superSaw,delete t.organ,delete t.drumMachine,delete t.chipSynth,delete t.pwmSynth,delete t.stringMachine,delete t.formantSynth,t.type="sample",t.synthType="Sampler",t.sample={audioBuffer:s.audioBuffer,url:s.url,baseNote:s.baseNote,detune:s.detune,loop:s.loop,loopStart:s.loopStart,loopEnd:s.loopEnd,reverse:!1,playbackRate:1},t.envelope=s.envelope)});try{Qg().invalidateInstrument(a)}catch(r){}}},reverseSample:async a=>{const n=t().instruments.find(e=>e.id===a);if(!n?.sample?.audioBuffer)return;const s=n.sample.audioBuffer,r=await Qg().decodeAudioData(s),i=Iv.reverse(r),o=await Qg().encodeAudioData(i);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=o)}),Qg().invalidateInstrument(a)},normalizeSample:async a=>{const n=t().instruments.find(e=>e.id===a);if(!n?.sample?.audioBuffer)return;const s=n.sample.audioBuffer,r=await Qg().decodeAudioData(s),i=Iv.normalize(r),o=await Qg().encodeAudioData(i);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=o)}),Qg().invalidateInstrument(a)},invertLoopSample:async a=>{const n=t().instruments.find(e=>e.id===a);if(!n?.sample?.audioBuffer||!n.sample.loop)return;const s=n.sample.audioBuffer,r=await Qg().decodeAudioData(s),i=Iv.invertLoop(r,n.sample.loopStart,n.sample.loopEnd),o=await Qg().encodeAudioData(i);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=o)}),Qg().invalidateInstrument(a)},updateSampleBuffer:async(a,n)=>{const s=t().instruments.find(e=>e.id===a);if(!s?.sample)return;const r=await Qg().encodeAudioData(n);e(e=>{const t=e.instruments.find(e=>e.id===a);t?.sample&&(t.sample.audioBuffer=r)}),Qg().invalidateInstrument(a)},updateSlices:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===t);n?.sample&&(n.sample.slices=a)})},updateSliceConfig:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===t);n?.sample&&(n.sample.sliceConfig=a)})},removeSlice:(t,a)=>{e(e=>{const n=e.instruments.find(e=>e.id===t);if(n?.sample?.slices){const e=n.sample.slices,t=e.findIndex(e=>e.id===a);if(-1!==t&&e.length>1){const a=e[t];t>0?(e[t-1].endFrame=a.endFrame,e[t-1].endTime=a.endTime):t<e.length-1&&(e[t+1].startFrame=a.startFrame,e[t+1].startTime=a.startTime),e.splice(t,1)}}})},createSlicedInstruments:async(a,n,s="Slice")=>{const r=t().instruments.find(e=>e.id===a);if(!r?.sample?.url)return[];const i=[],o=Qg();try{const a=await fetch(r.sample.url),l=await a.arrayBuffer(),c=await o.decodeAudioData(l),u=t().instruments.map(e=>e.id);for(let t=0;t<n.length;t++){const a=n[t],l=jv([...u,...i]);i.push(l);const d=a.endFrame-a.startFrame,p=c.numberOfChannels,m=c.sampleRate,h=new OfflineAudioContext(p,d,m).createBuffer(p,d,m);for(let e=0;e<p;e++){const t=c.getChannelData(e),n=h.getChannelData(e);for(let e=0;e<d;e++)n[e]=t[a.startFrame+e]}const f=await o.encodeAudioData(h),y=new Blob([f],{type:"audio/wav"}),g=await new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(y)}),b=a.label||`${s} ${t+1}`,v=r.name?`${r.name} - ${b}`:b;e(e=>{const t={id:l,name:v.slice(0,22),type:"sample",synthType:"Sampler",sample:{url:g,audioBuffer:f,baseNote:r.sample?.baseNote||"C-4",detune:r.sample?.detune||0,loop:!1,loopStart:0,loopEnd:d,sampleRate:m,reverse:!1,playbackRate:1},envelope:r.envelope||{...Hn},effects:[],volume:r.volume||-6,pan:r.pan||0};e.instruments.push(t)})}return i.length>0&&e(e=>{e.currentInstrumentId=i[0]}),i}catch(l){return[]}},reset:()=>{const a=Qg();t().instruments.forEach(e=>{try{a.invalidateInstrument(e.id)}catch{}}),e(e=>{e.instruments=[{...ub[0],id:1,type:"synth"}],e.currentInstrumentId=1,e.presets=[]})}}))),Lv=Object.freeze(Object.defineProperty({__proto__:null,useInstrumentStore:Bv},Symbol.toStringTag,{value:"Module"})),Vv=n()(Wg(Ga(e=>({visiblePanels:["tracker","oscilloscope","pattern-list"],trackerZoom:100,activePanel:"tracker",modalOpen:null,sidebarCollapsed:!1,useHexNumbers:!0,rowHighlightInterval:4,showBeatLabels:!1,chordEntryMode:!1,blankEmptyCells:!1,tb303Collapsed:!0,oscilloscopeVisible:!0,compactToolbar:!1,autoCompactApplied:!1,showSamplePackModal:!1,uiVersion:8,performanceQuality:"high",activeView:"tracker",tb303PoppedOut:!1,instrumentEditorPoppedOut:!1,masterEffectsPoppedOut:!1,instrumentEffectsPoppedOut:!1,pianoRollPoppedOut:!1,oscilloscopePoppedOut:!1,arrangementPoppedOut:!1,statusMessage:"All Right",prevStatusMessage:"All Right",pendingModuleFile:null,togglePanel:t=>e(e=>{const a=e.visiblePanels.indexOf(t);-1!==a?e.visiblePanels.splice(a,1):e.visiblePanels.push(t)}),setActivePanel:t=>e(e=>{e.activePanel=t,e.visiblePanels.includes(t)||e.visiblePanels.push(t)}),setTrackerZoom:t=>e(e=>{e.trackerZoom=Math.max(80,Math.min(200,t))}),openModal:t=>e(e=>{e.modalOpen=t}),closeModal:()=>e(e=>{e.modalOpen=null}),toggleSidebar:()=>e(e=>{e.sidebarCollapsed=!e.sidebarCollapsed}),setSidebarCollapsed:t=>e(e=>{e.sidebarCollapsed=t}),setUseHexNumbers:t=>e(e=>{e.useHexNumbers=t}),setRowHighlightInterval:t=>e(e=>{e.rowHighlightInterval=Math.max(1,Math.min(32,t))}),toggleBeatLabels:()=>e(e=>{e.showBeatLabels=!e.showBeatLabels}),toggleChordEntryMode:()=>e(e=>{e.chordEntryMode=!e.chordEntryMode}),setBlankEmptyCells:t=>e(e=>{e.blankEmptyCells=t}),setStatusMessage:(t,a=!1,n=2e3)=>e(e=>{if(a&&(e.prevStatusMessage=t),e.statusMessage=t,n>0){const e=window;e._statusTimeout&&clearTimeout(e._statusTimeout),e._statusTimeout=setTimeout(()=>{const t=Vv.getState().prevStatusMessage;Vv.getState().setStatusMessage(t||"All Right",!1,0),e._statusTimeout=null},n)}}),toggleTB303Collapsed:()=>e(e=>{e.tb303Collapsed=!e.tb303Collapsed}),setTB303Collapsed:t=>e(e=>{e.tb303Collapsed=t}),toggleOscilloscopeVisible:()=>e(e=>{e.oscilloscopeVisible=!e.oscilloscopeVisible}),setOscilloscopeVisible:t=>e(e=>{e.oscilloscopeVisible=t}),toggleCompactToolbar:()=>e(e=>{e.compactToolbar=!e.compactToolbar}),setCompactToolbar:t=>e(e=>{e.compactToolbar=t}),applyAutoCompact:()=>e(e=>{const t="undefined"!=typeof window?window.innerHeight:1080;e.uiVersion<8&&(e.uiVersion=8,e.tb303Collapsed=!0,e.compactToolbar=!1),e.autoCompactApplied||(e.autoCompactApplied=!0,t<800&&(e.oscilloscopeVisible=!1))}),setShowSamplePackModal:t=>e(e=>{e.showSamplePackModal=t}),setPerformanceQuality:t=>e(e=>{e.performanceQuality=t}),setActiveView:t=>e(e=>{e.activeView=t}),toggleActiveView:()=>e(e=>{e.activeView="tracker"===e.activeView?"arrangement":"tracker"}),setTB303PoppedOut:t=>e(e=>{e.tb303PoppedOut=t}),setInstrumentEditorPoppedOut:t=>e(e=>{e.instrumentEditorPoppedOut=t}),setMasterEffectsPoppedOut:t=>e(e=>{e.masterEffectsPoppedOut=t}),setInstrumentEffectsPoppedOut:t=>e(e=>{e.instrumentEffectsPoppedOut=t}),setPianoRollPoppedOut:t=>e(e=>{e.pianoRollPoppedOut=t}),setOscilloscopePoppedOut:t=>e(e=>{e.oscilloscopePoppedOut=t}),setArrangementPoppedOut:t=>e(e=>{e.arrangementPoppedOut=t}),setPendingModuleFile:t=>e(e=>{e.pendingModuleFile=t})})),{name:"devilbox-ui-settings",partialize:e=>({tb303Collapsed:e.tb303Collapsed,oscilloscopeVisible:e.oscilloscopeVisible,compactToolbar:e.compactToolbar,sidebarCollapsed:e.sidebarCollapsed,trackerZoom:e.trackerZoom,useHexNumbers:e.useHexNumbers,rowHighlightInterval:e.rowHighlightInterval,showBeatLabels:e.showBeatLabels,chordEntryMode:e.chordEntryMode,blankEmptyCells:e.blankEmptyCells,performanceQuality:e.performanceQuality,activeView:e.activeView,uiVersion:e.uiVersion})})),zv=Object.freeze(Object.defineProperty({__proto__:null,useUIStore:Vv},Symbol.toStringTag,{value:"Module"}));let Uv,Gv=0,Wv=null,Hv=null;const Kv=n()(Ga((e,t)=>({bpm:125,timeSignature:[4,4],swing:100,position:"0:0:0",isPlaying:!1,isPaused:!1,isLooping:!0,currentRow:0,currentPatternIndex:0,continuousRow:0,smoothScrolling:!1,metronomeEnabled:!1,metronomeVolume:75,speed:6,loopStartRow:0,grooveTemplateId:"straight",grooveSteps:2,jitter:0,useMpcScale:!1,currentGlobalRow:0,setBPM:t=>e(e=>{e.bpm=Math.max(20,Math.min(999,t));try{Vv.getState().setStatusMessage(`BPM ${e.bpm}`,!1,1500)}catch{}}),setTimeSignature:(t,a)=>e(e=>{e.timeSignature=[t,a]}),setSwing:t=>e(e=>{e.useMpcScale?e.swing=Math.max(50,Math.min(75,t)):e.swing=Math.max(0,Math.min(200,t))}),setJitter:t=>e(e=>{e.jitter=Math.max(0,Math.min(100,t))}),setUseMpcScale:t=>e(e=>{e.useMpcScale!==t&&(e.useMpcScale=t,e.swing=t?50+e.swing/200*25:(e.swing-50)/25*200)}),setPosition:t=>e(e=>{e.position=t}),play:()=>{Bv.getState().autoBakeInstruments(),e(e=>{e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow})},pause:()=>e(e=>{e.isPlaying=!1,e.isPaused=!0}),stop:()=>e(e=>{e.isPlaying=!1,e.isPaused=!1,e.currentRow=0,e.continuousRow=0,e.position="0:0:0"}),togglePlayPause:()=>{t().isPlaying||Bv.getState().autoBakeInstruments(),e(e=>{e.isPlaying?(e.isPlaying=!1,e.isPaused=!0):(e.isPlaying=!0,e.isPaused=!1,e.continuousRow=e.currentRow)})},setIsLooping:t=>e(e=>{e.isLooping=t}),setCurrentRow:(t,a)=>e(e=>{const n=e.currentRow;if(e.currentRow=t,t>n)e.continuousRow+=t-n;else if(t===n);else if(t<n){if(a?n-t>=a/2:0===t&&n>2){const s=a||n+1;e.continuousRow+=s-n+t}}}),setCurrentRowThrottled:(e,a)=>{const n=performance.now();Wv=e,Uv=a,n-Gv>=20?(Gv=n,t().setCurrentRow(e,a),Wv=null,Uv=void 0,null!==Hv&&(window.clearTimeout(Hv),Hv=null)):null===Hv&&(Hv=window.setTimeout(()=>{null!==Wv&&(Gv=performance.now(),t().setCurrentRow(Wv,Uv),Wv=null,Uv=void 0),Hv=null},20-(n-Gv)))},setCurrentPattern:t=>e(e=>{e.currentPatternIndex=t}),setSmoothScrolling:t=>e(e=>{e.smoothScrolling=t}),setMetronomeEnabled:t=>e(e=>{e.metronomeEnabled=t}),setMetronomeVolume:t=>e(e=>{e.metronomeVolume=Math.max(0,Math.min(100,t))}),toggleMetronome:()=>e(e=>{e.metronomeEnabled=!e.metronomeEnabled}),setSpeed:t=>e(e=>{e.speed=Math.max(1,Math.min(31,t))}),setLoopStartRow:t=>e(e=>{e.loopStartRow=Math.max(0,t)}),setGrooveTemplate:t=>e(e=>{$n.find(e=>e.id===t)&&(e.grooveTemplateId=t)}),setGrooveSteps:t=>e(e=>{e.grooveSteps=Math.max(1,Math.min(64,t))}),getGrooveTemplate:()=>{const e=t();return $n.find(t=>t.id===e.grooveTemplateId)||$n[0]},setCurrentGlobalRow:t=>e(e=>{e.currentGlobalRow=t}),seekToGlobalRow:t=>e(e=>{e.currentGlobalRow=Math.max(0,t)}),reset:()=>e(e=>{e.bpm=125,e.timeSignature=[4,4],e.swing=100,e.position="0:0:0",e.isPlaying=!1,e.isPaused=!1,e.isLooping=!0,e.currentRow=0,e.currentPatternIndex=0,e.continuousRow=0,e.speed=6,e.loopStartRow=0,e.grooveTemplateId="straight",e.grooveSteps=2,e.jitter=0,e.useMpcScale=!1,e.currentGlobalRow=0})}))),qv=Object.freeze(Object.defineProperty({__proto__:null,useTransportStore:Kv},Symbol.toStringTag,{value:"Module"})),$v=n()(Ga((e,t)=>({initialized:!1,contextState:"suspended",masterVolume:0,masterMuted:!1,analyserNode:null,fftNode:null,toneEngineInstance:null,masterEffects:[],setInitialized:t=>e(e=>{e.initialized=t}),setContextState:t=>e(e=>{e.contextState=t}),setMasterVolume:a=>e(e=>{e.masterVolume=Math.max(-60,Math.min(0,a));const n=t().toneEngineInstance;n&&n.setMasterVolume(e.masterVolume)}),setMasterMuted:a=>e(e=>{e.masterMuted=a;const n=t().toneEngineInstance;n&&n.setMasterMute(a)}),toggleMasterMute:()=>e(e=>{e.masterMuted=!e.masterMuted;const a=t().toneEngineInstance;a&&a.setMasterMute(e.masterMuted)}),setAnalyserNode:t=>e(e=>{e.analyserNode=t}),setFFTNode:t=>e(e=>{e.fftNode=t}),setToneEngineInstance:t=>e(e=>{e.toneEngineInstance=t}),addMasterEffect:t=>e(e=>{const a={id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,category:"tonejs",type:t,enabled:!0,wet:50,parameters:Og(t)};e.masterEffects.push(a)}),addMasterEffectConfig:t=>e(e=>{const a={...t,id:`master-fx-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,parameters:{...Og(t.type),...t.parameters}};e.masterEffects.push(a)}),removeMasterEffect:t=>e(e=>{const a=e.masterEffects.findIndex(e=>e.id===t);-1!==a&&e.masterEffects.splice(a,1)}),updateMasterEffect:(a,n)=>e(e=>{const s=e.masterEffects.find(e=>e.id===a);if(s){n.parameters&&Object.keys(s.parameters).length<Object.keys(Og(s.type)).length&&(s.parameters={...Og(s.type),...s.parameters}),Object.assign(s,n);const e=JSON.parse(JSON.stringify(s)),r=t().toneEngineInstance;if(r&&(r.updateMasterEffectParams(a,e),1===e.parameters.bpmSync)){const e=r.getBPM();r.updateBpmSyncedEffects(e)}}}),reorderMasterEffects:(t,a)=>e(e=>{const[n]=e.masterEffects.splice(t,1);e.masterEffects.splice(a,0,n)}),setMasterEffects:t=>e(e=>{const a=t.map(e=>({...e,category:e.category||"tonejs"}));e.masterEffects=a})}))),Xv=n()(Ga(e=>({metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},isDirty:!1,lastSavedAt:null,setMetadata:t=>e(e=>{Object.assign(e.metadata,t),e.metadata.modifiedAt=(new Date).toISOString(),e.isDirty=!0}),setIsDirty:t=>e(e=>{e.isDirty=t}),markAsSaved:()=>e(e=>{e.isDirty=!1,e.lastSavedAt=(new Date).toISOString()}),markAsModified:()=>e(e=>{e.isDirty=!0,e.metadata.modifiedAt=(new Date).toISOString()}),resetProject:()=>e(e=>{e.metadata={id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},e.isDirty=!1,e.lastSavedAt=null})})));function Yv(e){e.automation={},e.curves.forEach(t=>{e.automation[t.patternId]||(e.automation[t.patternId]={}),e.automation[t.patternId][t.channelIndex]||(e.automation[t.patternId][t.channelIndex]={}),e.automation[t.patternId][t.channelIndex][t.parameter]=t})}const Zv=n()(Ga((e,t)=>({curves:[],selectedCurveId:null,editMode:"pencil",presets:[...Yn],automation:{},channelLanes:new Map,addCurve:(t,a,n)=>{const s={id:`curve-${Date.now()}`,patternId:t,channelIndex:a,parameter:n,mode:"curve",interpolation:"linear",points:[],enabled:!0};return e(e=>{e.curves.push(s),e.selectedCurveId=s.id,Yv(e)}),s.id},removeCurve:t=>e(e=>{const a=e.curves.findIndex(e=>e.id===t);-1!==a&&(e.curves.splice(a,1),e.selectedCurveId===t&&(e.selectedCurveId=null),Yv(e))}),updateCurve:(t,a)=>e(e=>{const n=e.curves.find(e=>e.id===t);n&&(Object.assign(n,a),Yv(e))}),setSelectedCurve:t=>e(e=>{e.selectedCurveId=t}),setEditMode:t=>e(e=>{e.editMode=t}),addPoint:(t,a,n)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.findIndex(e=>e.row===a);-1!==t?s.points[t].value=n:(s.points.push({row:a,value:n}),s.points.sort((e,t)=>e.row-t.row)),Yv(e)}}),removePoint:(t,a)=>e(e=>{const n=e.curves.find(e=>e.id===t);if(n){const t=n.points.findIndex(e=>e.row===a);-1!==t&&(n.points.splice(t,1),Yv(e))}}),updatePoint:(t,a,n)=>e(e=>{const s=e.curves.find(e=>e.id===t);if(s){const t=s.points.find(e=>e.row===a);t&&(t.value=n,Yv(e))}}),clearPoints:t=>e(e=>{const a=e.curves.find(e=>e.id===t);a&&(a.points=[],Yv(e))}),applyPreset:(t,a)=>e(e=>{const n=e.curves.find(e=>e.id===t);n&&(n.points=[...a.points],Yv(e))}),getCurvesForPattern:(e,a)=>t().curves.filter(t=>t.patternId===e&&t.channelIndex===a),getValueAtRow:(e,a)=>{const n=t().curves.find(t=>t.id===e);return n&&0!==n.points.length?Xn(n.points,a,n.interpolation,n.mode):null},getAutomation:(e,a,n)=>{const s=t().curves.find(t=>t.patternId===e&&t.channelIndex===a&&t.parameter===n);return s||{id:`temp-${e}-${a}-${n}`,patternId:e,channelIndex:a,parameter:n,mode:"curve",interpolation:"linear",points:[],enabled:!0}},setAutomation:(t,a,n,s)=>e(e=>{const r=e.curves.findIndex(e=>e.patternId===t&&e.channelIndex===a&&e.parameter===n);-1!==r?e.curves[r]=s:e.curves.push(s),Yv(e)}),buildAutomationData:()=>{const e=t(),a={};return e.curves.forEach(e=>{a[e.patternId]||(a[e.patternId]={}),a[e.patternId][e.channelIndex]||(a[e.patternId][e.channelIndex]={}),a[e.patternId][e.channelIndex][e.parameter]=e}),a},loadCurves:t=>e(e=>{e.curves=t,e.selectedCurveId=null,Yv(e)}),getCurves:()=>t().curves,setActiveParameter:(t,a)=>e(e=>{const n=e.channelLanes.get(t)||{activeParameter:"",showLane:!1};e.channelLanes.set(t,{...n,activeParameter:a})}),getActiveParameter:e=>{const a=t();return a.channelLanes.get(e)?.activeParameter||""},setShowLane:(t,a)=>e(e=>{const n=e.channelLanes.get(t)||{activeParameter:"",showLane:!1};e.channelLanes.set(t,{...n,showLane:a})}),getShowLane:e=>{const a=t();return a.channelLanes.get(e)?.showLane||!1},reset:()=>e(e=>{e.curves=[],e.selectedCurveId=null,e.editMode="pencil",e.automation={},e.channelLanes=new Map})}))),Qv=n()(Ga((e,t)=>({undoStack:[],redoStack:[],maxStackSize:100,currentActionId:null,pushAction:(t,a,n,s,r)=>e(e=>{const i={id:`action-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,timestamp:Date.now(),description:a,patternIndex:n,beforeState:JSON.parse(JSON.stringify(s)),afterState:JSON.parse(JSON.stringify(r))};e.undoStack.push(i),e.undoStack.length>e.maxStackSize&&e.undoStack.shift(),e.redoStack=[],e.currentActionId=i.id}),undo:()=>{const a=t();if(0===a.undoStack.length)return null;const n=a.undoStack[a.undoStack.length-1];return e(e=>{const t=e.undoStack.pop();t&&(e.redoStack.push(t),e.currentActionId=e.undoStack.length>0?e.undoStack[e.undoStack.length-1].id:null)}),n.beforeState},redo:()=>{const a=t();if(0===a.redoStack.length)return null;const n=a.redoStack[a.redoStack.length-1];return e(e=>{const t=e.redoStack.pop();t&&(e.undoStack.push(t),e.currentActionId=t.id)}),n.afterState},canUndo:()=>t().undoStack.length>0,canRedo:()=>t().redoStack.length>0,clearHistory:()=>e(e=>{e.undoStack=[],e.redoStack=[],e.currentActionId=null}),setMaxStackSize:t=>e(e=>{e.maxStackSize=Math.max(1,t),e.undoStack.length>e.maxStackSize&&(e.undoStack=e.undoStack.slice(-e.maxStackSize)),e.redoStack.length>e.maxStackSize&&(e.redoStack=e.redoStack.slice(-e.maxStackSize))}),getUndoCount:()=>t().undoStack.length,getRedoCount:()=>t().redoStack.length,getLastAction:()=>{const e=t().undoStack;return e.length>0?e[e.length-1]:null},getActionHistory:()=>t().undoStack.slice(-20)}))),Jv=e=>({EDIT_CELL:"Edit Cell",PASTE_BLOCK:"Paste Block",DELETE_BLOCK:"Delete Block",CUT_BLOCK:"Cut Block",TRANSPOSE_BLOCK:"Transpose Block",AMPLIFY_BLOCK:"Amplify Block",INTERPOLATE_BLOCK:"Interpolate Block",CLEAR_CELL:"Clear Cell",CLEAR_ROW:"Clear Row",CLEAR_CHANNEL:"Clear Channel",CLEAR_PATTERN:"Clear Pattern",INSERT_ROW:"Insert Row",DELETE_ROW:"Delete Row",RESIZE_PATTERN:"Resize Pattern"}[e]||e),ex=e=>{switch(e){case"EDIT_CELL":return"text-blue-400";case"PASTE_BLOCK":case"CUT_BLOCK":case"DELETE_BLOCK":return"text-green-400";case"TRANSPOSE_BLOCK":case"AMPLIFY_BLOCK":case"INTERPOLATE_BLOCK":return"text-yellow-400";case"CLEAR_CELL":case"CLEAR_ROW":case"CLEAR_CHANNEL":case"CLEAR_PATTERN":return"text-red-400";case"INSERT_ROW":case"DELETE_ROW":case"RESIZE_PATTERN":return"text-purple-400";default:return"text-gray-400"}},tx=()=>{const e=ob.getState(),t=Bv.getState(),a=Zv.getState(),n=Xv.getState(),s=Kv.getState();return{patterns:JSON.parse(JSON.stringify(e.patterns)),currentPatternIndex:e.currentPatternIndex,instruments:JSON.parse(JSON.stringify(t.instruments)),currentInstrumentId:t.currentInstrumentId,automationCurves:JSON.parse(JSON.stringify(a.curves)),metadata:JSON.parse(JSON.stringify(n.metadata)),bpm:s.bpm}},ax=e=>{const t=Qg();try{t.stop()}catch{}Kv.getState().reset(),Kv.getState().setBPM(e.bpm),Xv.getState().setMetadata(e.metadata),Xv.getState().setIsDirty(!1),ob.getState().loadPatterns(e.patterns),ob.getState().setCurrentPattern(e.currentPatternIndex),Bv.getState().loadInstruments(e.instruments),null!==e.currentInstrumentId&&Bv.getState().setCurrentInstrument(e.currentInstrumentId),Zv.getState().loadCurves(e.automationCurves)},nx=()=>({id:`tab-${Date.now()}`,name:"Untitled",isDirty:!1,state:null}),sx=nx(),rx=n()(Ga((e,t)=>({tabs:[sx],activeTabId:sx.id,addTab:()=>{const a=t().activeTabId,n=tx();e(e=>{const t=e.tabs.find(e=>e.id===a);t&&(t.state=n);const s=nx();e.tabs.push(s),e.activeTabId=s.id});const s={patterns:[{id:`pattern-${Date.now()}`,name:"Untitled Pattern",length:64,channels:Array.from({length:4},(e,t)=>({id:`channel-${t}`,name:`Channel ${t+1}`,rows:Array.from({length:64},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})),muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:null,color:null}))}],currentPatternIndex:0,instruments:[{id:0,name:"TB303 Classic",type:"synth",synthType:"TB303",tb303:{oscillator:{type:"sawtooth"},filter:{cutoff:400,resonance:15},filterEnvelope:{envMod:50,decay:300},accent:{amount:.8},slide:{time:60,mode:"exponential"}},oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0}],currentInstrumentId:0,automationCurves:[],metadata:{id:`project-${Date.now()}`,name:"Untitled",author:"Unknown",description:"",createdAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),version:"1.0.0"},bpm:125};ax(s)},closeTab:a=>{const n=t();if(n.tabs.length<=1)return;const s=n.tabs.findIndex(e=>e.id===a);if(-1===s)return;let r=n.activeTabId,i=!1;if(n.activeTabId===a){const e=0===s?1:s-1;r=n.tabs[e].id,i=!0}const o=n.tabs.find(e=>e.id===r),l=o?.state;e(e=>{e.activeTabId=r,e.tabs.splice(s,1);const t=e.tabs.find(e=>e.id===r);t&&(t.state=null)}),i&&l&&ax(l)},setActiveTab:a=>{const n=t();if(!n.tabs.some(e=>e.id===a))return;if(n.activeTabId===a)return;const s=n.activeTabId,r=tx(),i=n.tabs.find(e=>e.id===a),o=i?.state;e(e=>{const t=e.tabs.find(e=>e.id===s);t&&(t.state=r),e.activeTabId=a;const n=e.tabs.find(e=>e.id===a);n&&(n.state=null)}),o&&ax(o)},updateTabName:(t,a)=>e(e=>{const n=e.tabs.find(e=>e.id===t);n&&(n.name=a)}),markTabDirty:(t,a)=>e(e=>{const n=e.tabs.find(e=>e.id===t);n&&(n.isDirty=a)})}))),ix={id:"devilbox",name:"DEViLBOX",colors:{bg:"#0b0909",bgSecondary:"#131010",bgTertiary:"#1d1818",bgHover:"#262020",bgActive:"#2f2828",border:"#2f2525",borderLight:"#403535",accent:"#ef4444",accentSecondary:"#f97316",accentGlow:"rgba(239, 68, 68, 0.15)",text:"#f2f0f0",textSecondary:"#a8a0a0",textMuted:"#686060",textInverse:"#0b0909",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0f0c0c",trackerRowOdd:"#131010",trackerRowHighlight:"#181414",trackerRowCurrent:"#2a1a1a",trackerRowCursor:"#251010",cellNote:"#f2f0f0",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#ef4444",cellSlide:"#fb7185",cellEmpty:"#484040"}},ox=[ix,{id:"neodark",name:"NeoDark",colors:{bg:"#0a0a0b",bgSecondary:"#111113",bgTertiary:"#1a1a1d",bgHover:"#222226",bgActive:"#2a2a2f",border:"#2a2a2f",borderLight:"#3a3a40",accent:"#00d4aa",accentSecondary:"#7c3aed",accentGlow:"rgba(0, 212, 170, 0.15)",text:"#f0f0f2",textSecondary:"#a0a0a8",textMuted:"#606068",textInverse:"#0a0a0b",error:"#ef4444",success:"#10b981",warning:"#f59e0b",trackerRowEven:"#0d0d0f",trackerRowOdd:"#111113",trackerRowHighlight:"#151518",trackerRowCurrent:"#1a2a25",trackerRowCursor:"#0d2520",cellNote:"#f0f0f2",cellInstrument:"#fbbf24",cellVolume:"#34d399",cellEffect:"#f97316",cellAccent:"#00d4aa",cellSlide:"#a78bfa",cellEmpty:"#404048"}},{id:"cyan-lineart",name:"Cyan Lineart",colors:{bg:"#030808",bgSecondary:"#051010",bgTertiary:"#071414",bgHover:"#0a1a1a",bgActive:"#0c2020",border:"#00808080",borderLight:"#00b8b8",accent:"#00ffff",accentSecondary:"#00e0e0",accentGlow:"rgba(0, 255, 255, 0.12)",text:"#00ffff",textSecondary:"#00c8c8",textMuted:"#006060",textInverse:"#030808",error:"#ff4080",success:"#00ff88",warning:"#00ffaa",trackerRowEven:"#030808",trackerRowOdd:"#041010",trackerRowHighlight:"#061414",trackerRowCurrent:"#081818",trackerRowCursor:"#0a1c1c",cellNote:"#00ffff",cellInstrument:"#00e8e8",cellVolume:"#00d0d0",cellEffect:"#00b8b8",cellAccent:"#00ffff",cellSlide:"#00a0a0",cellEmpty:"#003838"}}],lx=e=>{const t=document.documentElement,{colors:a}=e;t.setAttribute("data-theme",e.id),t.style.setProperty("--color-bg",a.bg),t.style.setProperty("--color-bg-secondary",a.bgSecondary),t.style.setProperty("--color-bg-tertiary",a.bgTertiary),t.style.setProperty("--color-bg-hover",a.bgHover),t.style.setProperty("--color-bg-active",a.bgActive),t.style.setProperty("--color-border",a.border),t.style.setProperty("--color-border-light",a.borderLight),t.style.setProperty("--color-accent",a.accent),t.style.setProperty("--color-accent-secondary",a.accentSecondary),t.style.setProperty("--color-accent-glow",a.accentGlow),t.style.setProperty("--color-text",a.text),t.style.setProperty("--color-text-secondary",a.textSecondary),t.style.setProperty("--color-text-muted",a.textMuted),t.style.setProperty("--color-text-inverse",a.textInverse),t.style.setProperty("--color-error",a.error),t.style.setProperty("--color-success",a.success),t.style.setProperty("--color-warning",a.warning),t.style.setProperty("--color-tracker-row-even",a.trackerRowEven),t.style.setProperty("--color-tracker-row-odd",a.trackerRowOdd),t.style.setProperty("--color-tracker-row-highlight",a.trackerRowHighlight),t.style.setProperty("--color-tracker-row-current",a.trackerRowCurrent),t.style.setProperty("--color-tracker-row-cursor",a.trackerRowCursor),t.style.setProperty("--color-cell-note",a.cellNote),t.style.setProperty("--color-cell-instrument",a.cellInstrument),t.style.setProperty("--color-cell-volume",a.cellVolume),t.style.setProperty("--color-cell-effect",a.cellEffect),t.style.setProperty("--color-cell-accent",a.cellAccent),t.style.setProperty("--color-cell-slide",a.cellSlide),t.style.setProperty("--color-cell-empty",a.cellEmpty)},cx=n()(Wg((e,t)=>({currentThemeId:"devilbox",setTheme:t=>{const a=ox.find(e=>e.id===t);a&&(lx(a),e({currentThemeId:t}))},getCurrentTheme:()=>{const{currentThemeId:e}=t();return ox.find(t=>t.id===e)||ix}}),{name:"devilbox-theme",onRehydrateStorage:()=>e=>{if(e){const t=ox.find(t=>t.id===e.currentThemeId)||ix;lx(t)}}}));if("undefined"!=typeof window){const e=localStorage.getItem("devilbox-theme");let t="devilbox";if(e)try{const a=JSON.parse(e);t=a.state?.currentThemeId||"devilbox"}catch{}const a=ox.find(e=>e.id===t)||ix;lx(a)}let ux=0;const dx=n((e,t)=>({notifications:[],addNotification:a=>{const n="notification-"+ ++ux,s={...a,id:n,duration:a.duration??5e3};return e(e=>({notifications:[...e.notifications,s]})),s.duration&&s.duration>0&&setTimeout(()=>{t().removeNotification(n)},s.duration),n},removeNotification:t=>{e(e=>({notifications:e.notifications.filter(e=>e.id!==t)}))},clearAll:()=>{e({notifications:[]})}})),px={success:(e,t)=>dx.getState().addNotification({type:"success",message:e,duration:t}),error:(e,t)=>dx.getState().addNotification({type:"error",message:e,duration:t??8e3}),warning:(e,t)=>dx.getState().addNotification({type:"warning",message:e,duration:t}),info:(e,t)=>dx.getState().addNotification({type:"info",message:e,duration:t})},mx=()=>{if("undefined"==typeof navigator)return!1;const e=navigator.userAgent||navigator.vendor,t=/Macintosh/i.test(e)&&navigator.maxTouchPoints>1,a=/iPhone|iPod/i.test(e),n=/iPad/i.test(e);return t||a||n},hx=()=>{if("undefined"==typeof navigator)return!1;const e=navigator.userAgent||navigator.vendor;return/android/i.test(e)},fx=()=>{const e=mx(),t=hx();return(()=>{if("undefined"==typeof navigator)return!1;return"requestMIDIAccess"in navigator})()?e?{isIOS:!0,isSupported:!0,instructions:`To connect MIDI devices on iOS:\n\nUSB MIDI (via Camera Connection Kit):\n1. Connect USB MIDI controller to Lightning/USB-C adapter\n2. DEViLBOX should detect it automatically\n3. Check MIDI settings to verify connection\n\nBluetooth MIDI:\n1. Open Settings  Bluetooth\n2. Turn on your MIDI device\n3. Pair it with your ${/iPad/i.test(navigator.userAgent)?"iPad":"iPhone"}\n4. Return to DEViLBOX (no refresh needed)\n5. Device should appear in MIDI settings\n\nNote: iOS Safari has the best MIDI support. Chrome on iOS does NOT support Web MIDI.`,requiresPairing:!0}:t?{isIOS:!1,isSupported:!0,instructions:"To connect MIDI devices on Android:\n\nUSB MIDI (via USB-C or OTG adapter):\n1. Connect USB MIDI controller via adapter\n2. Grant USB permission when prompted\n3. Check MIDI settings to verify connection\n\nBluetooth MIDI:\n1. Pair MIDI device via Android Bluetooth settings\n2. Open DEViLBOX\n3. Device should appear in MIDI settings\n\nNote: Android MIDI support varies by device and browser. Chrome 43+ required. USB works more reliably than Bluetooth.",requiresPairing:!1}:{isIOS:!1,isSupported:!0,instructions:"Connect your USB MIDI device. It should be detected automatically. Bluetooth MIDI may require pairing first.",requiresPairing:!1}:t?{isIOS:!1,isSupported:!1,instructions:"Web MIDI is not supported on Android Chrome yet.\n\nTo use MIDI on Android:\n1. Try Chrome Canary or Chrome Dev (enable chrome://flags/#enable-web-midi)\n2. Or use a desktop browser (Chrome, Edge, Opera)\n3. USB MIDI controllers work better than Bluetooth on Android\n\nAlternatively, use an iOS device with Safari for full MIDI support.",requiresPairing:!1}:{isIOS:e,isSupported:!1,instructions:"Web MIDI is not supported on this browser. Try Safari on iOS or Chrome/Edge on desktop.",requiresPairing:!1}};class yx{static instance=null;midiAccess=null;inputs=new Map;outputs=new Map;selectedInputId=null;selectedOutputId=null;messageHandlers=new Set;deviceChangeCallbacks=new Set;lastActivityTimestamp=0;boundMessageHandler=null;clockTickCount=0;lastClockTimestamp=0;clockBPM=0;clockSyncEnabled=!1;clockSyncCallbacks=new Set;transportCallbacks=new Set;constructor(){}static getInstance(){return yx.instance||(yx.instance=new yx),yx.instance}isSupported(){return"requestMIDIAccess"in navigator}async init(){if(!this.isSupported())return!1;try{const e=mx()||hx();return this.midiAccess=await navigator.requestMIDIAccess({sysex:!e}),this.updateDevices(),this.midiAccess.onstatechange=()=>{this.updateDevices(),this.notifyDeviceChange()},!0}catch(e){return DOMException,!1}}updateDevices(){if(this.midiAccess){if(this.inputs.clear(),this.outputs.clear(),this.midiAccess.inputs.forEach((e,t)=>{this.inputs.set(t,e)}),this.midiAccess.outputs.forEach((e,t)=>{this.outputs.set(t,e)}),!this.selectedInputId){const e=this.detectTD3Devices().input;e&&this.selectInput(e.id)}if(!this.selectedOutputId){const e=this.detectTD3Devices().output;e&&this.selectOutput(e.id)}}}portToDeviceInfo(e,t){const a=e.name||"Unknown Device",n=e.manufacturer||"";return{id:e.id,name:a,manufacturer:n,type:t,isConnected:"open"===e.connection||"connected"===e.state,isTD3:this.isTD3Device(a,n)}}isTD3Device(e,t){const a=e.toLowerCase(),n=t.toLowerCase();return a.includes("td-3")||a.includes("td3")||n.includes("behringer")&&a.includes("303")}getInputDevices(){const e=[];return this.inputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"input"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}getOutputDevices(){const e=[];return this.outputs.forEach(t=>{e.push(this.portToDeviceInfo(t,"output"))}),e.sort((e,t)=>e.isTD3&&!t.isTD3?-1:!e.isTD3&&t.isTD3?1:e.name.localeCompare(t.name))}detectTD3Devices(){const e=this.getInputDevices(),t=this.getOutputDevices();return{input:e.find(e=>e.isTD3)||null,output:t.find(e=>e.isTD3)||null}}async selectInput(e){if(this.selectedInputId){const e=this.inputs.get(this.selectedInputId);if(e){e.onmidimessage=null;try{await e.close()}catch{}}}if(this.selectedInputId=e,e){const a=this.inputs.get(e);if(a)try{await a.open(),this.boundMessageHandler=this.handleMIDIMessage.bind(this),a.onmidimessage=this.boundMessageHandler}catch(t){}}}selectOutput(e){this.selectedOutputId=e,e&&this.outputs.get(e)}getSelectedInput(){if(!this.selectedInputId)return null;const e=this.inputs.get(this.selectedInputId);return e?this.portToDeviceInfo(e,"input"):null}getSelectedOutput(){if(!this.selectedOutputId)return null;const e=this.outputs.get(this.selectedOutputId);return e?this.portToDeviceInfo(e,"output"):null}handleMIDIMessage(e){const t=e.data;if(!t||0===t.length)return;const a=t[0];if(248!==a){Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join(" "),t[0]>=240||(176==(240&t[0])||(144==(240&t[0])||(128==(240&t[0])||(224==(240&t[0])||t[0]))))}this.lastActivityTimestamp=Date.now();const n=this.parseMIDIMessage(a,t,e.timeStamp);this.clockSyncEnabled&&("clock"===n.type?this.processClockTick(e.timeStamp):"start"!==n.type&&"stop"!==n.type&&"continue"!==n.type||this.processTransportCommand(n.type)),this.messageHandlers.forEach(e=>{try{e(n,this.selectedInputId||"")}catch(t){}})}processClockTick(e){if(this.clockTickCount++,this.lastClockTimestamp>0){const t=e-this.lastClockTimestamp;if(t>0){const e=2500/t;if(0===this.clockBPM?this.clockBPM=e:this.clockBPM=.9*this.clockBPM+.1*e,this.clockTickCount%24==0){const e=Math.round(10*this.clockBPM)/10;this.clockSyncCallbacks.forEach(t=>{try{t(e)}catch(a){}})}}}this.lastClockTimestamp=e}processTransportCommand(e){"start"===e&&(this.clockTickCount=0,this.lastClockTimestamp=0),this.transportCallbacks.forEach(t=>{try{t(e)}catch(a){}})}parseMIDIMessage(e,t,a){let n,s,r,i,o,l,c,u="other";if(e>=240)switch(n=-1,e){case 240:u="sysex";break;case 248:u="clock";break;case 250:u="start";break;case 251:u="continue";break;case 252:u="stop";break;default:u="other"}else{switch(n=15&e,240&e){case 144:u="noteOn",s=t[1],r=t[2],0===r&&(u="noteOff");break;case 128:u="noteOff",s=t[1],r=t[2];break;case 176:u="cc",i=t[1],o=t[2];break;case 192:u="programChange",c=t[1];break;case 224:u="pitchBend",l=(t[2]<<7|t[1])-8192;break;default:u="other"}}return{type:u,channel:n,data:t,timestamp:a,note:s,velocity:r,cc:i,value:o,pitchBend:l,program:c}}addMessageHandler(e){this.messageHandlers.add(e)}removeMessageHandler(e){this.messageHandlers.delete(e)}sendCC(e,t,a){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const s=new Uint8Array([176|15&e,127&t,127&a]);n.send(s)}sendSysEx(e){if(!this.selectedOutputId)return;const t=this.outputs.get(this.selectedOutputId);if(t)try{t.send(e)}catch(a){throw a}}sendNoteOn(e,t,a){if(!this.selectedOutputId)return;const n=this.outputs.get(this.selectedOutputId);if(!n)return;const s=new Uint8Array([144|15&e,127&t,127&a]);n.send(s)}sendNoteOff(e,t){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const n=new Uint8Array([128|15&e,127&t,0]);a.send(n)}sendPitchBend(e,t){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const n=Math.max(0,Math.min(16383,t+8192)),s=new Uint8Array([224|15&e,127&n,n>>7&127]);a.send(s)}sendProgramChange(e,t){if(!this.selectedOutputId)return;const a=this.outputs.get(this.selectedOutputId);if(!a)return;const n=new Uint8Array([192|15&e,127&t]);a.send(n)}setClockSyncEnabled(e){this.clockSyncEnabled=e,e||(this.clockTickCount=0,this.lastClockTimestamp=0,this.clockBPM=0)}isClockSyncEnabled(){return this.clockSyncEnabled}getClockBPM(){return Math.round(10*this.clockBPM)/10}onClockSync(e){return this.clockSyncCallbacks.add(e),()=>{this.clockSyncCallbacks.delete(e)}}onTransportCommand(e){return this.transportCallbacks.add(e),()=>{this.transportCallbacks.delete(e)}}onDeviceChange(e){return this.deviceChangeCallbacks.add(e),()=>{this.deviceChangeCallbacks.delete(e)}}notifyDeviceChange(){this.deviceChangeCallbacks.forEach(e=>{try{e()}catch(t){}})}getLastActivityTimestamp(){return this.lastActivityTimestamp}isInitialized(){return null!==this.midiAccess}dispose(){this.midiAccess&&(this.midiAccess.onstatechange=null),this.inputs.forEach(e=>{e.onmidimessage=null}),this.inputs.clear(),this.outputs.clear(),this.messageHandlers.clear(),this.deviceChangeCallbacks.clear(),this.clockSyncCallbacks.clear(),this.transportCallbacks.clear(),this.selectedInputId=null,this.selectedOutputId=null,this.midiAccess=null,this.clockSyncEnabled=!1,this.clockBPM=0,this.clockTickCount=0,this.lastClockTimestamp=0}}function gx(){return yx.getInstance()}class bx{static instance=null;mappings=new Map;lastCCValues=new Map;smoothedValues=new Map;globalSensitivity=.3;controlledInstrumentId=null;controlledInstrumentListeners=new Set;learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null};changeCallbacks=new Set;learnListeners=new Set;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return bx.instance||(bx.instance=new bx),bx.instance}init(){if(this.handlerRegistered)return;gx().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("cc"!==e.type||void 0===e.cc||void 0===e.value)return;if(this.learnState.isLearning&&this.learnState.callback)return void this.learnState.callback(e.cc,e.channel);const t=`${e.cc}-${e.channel}`,a=e.value,n=this.smoothedValues.get(t)??a,s=this.globalSensitivity,r=n+(a-n)*s;this.smoothedValues.set(t,r),this.mappings.forEach(t=>{if(t.ccNumber!==e.cc)return;if(void 0!==t.midiChannel&&t.midiChannel!==e.channel)return;const s=t.sensitivity??1,i=s<1?n+(a-n)*s:r,o=this.ccToParameter(i,t);this.notifyParameterChange(t.instrumentId,t.parameterPath,o)})};ccToParameter(e,t){const a=e/127;if("logarithmic"===t.curve){const e=Math.max(1,t.min),n=Math.max(e+1,t.max),s=Math.log(e),r=Math.log(n);return Math.exp(s+a*(r-s))}return t.min+a*(t.max-t.min)}parameterToCC(e,t){let a;if("logarithmic"===t.curve){const n=Math.max(1,t.min),s=Math.max(n+1,t.max),r=Math.log(n),i=Math.log(s);a=(Math.log(Math.max(n,e))-r)/(i-r)}else a=(e-t.min)/(t.max-t.min);return Math.round(Math.max(0,Math.min(127,127*a)))}startLearn(e,t,a,n,s,r="linear"){return new Promise(i=>{this.learnState={isLearning:!0,instrumentId:e,parameterPath:t,displayName:a,min:n,max:s,curve:r,callback:(e,t)=>{this.learnState.isLearning=!1,this.learnState.callback=null,this.notifyLearnChange(!1,null),i({ccNumber:e,channel:t})}},this.notifyLearnChange(!0,t)})}cancelLearn(){this.learnState.isLearning&&(this.learnState={isLearning:!1,instrumentId:null,parameterPath:null,displayName:null,min:0,max:100,curve:"linear",callback:null},this.notifyLearnChange(!1,null))}isLearning(){return this.learnState.isLearning}getLearningParameter(){return this.learnState.parameterPath}setMapping(e){this.mappings.forEach((t,a)=>{t.instrumentId===e.instrumentId&&t.parameterPath===e.parameterPath&&this.mappings.delete(a)}),this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}removeMappingsForInstrument(e){const t=[];this.mappings.forEach((a,n)=>{a.instrumentId===e&&t.push(n)}),t.forEach(e=>this.mappings.delete(e)),t.length>0&&(this.saveMappings(),this.notifyMappingChange())}getMappingForParameter(e,t){for(const a of this.mappings.values())if(a.instrumentId===e&&a.parameterPath===t)return a}getMappingsForInstrument(e){const t=[];return this.mappings.forEach(a=>{a.instrumentId===e&&t.push(a)}),t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}onParameterChange(e){return this.changeCallbacks.add(e),()=>this.changeCallbacks.delete(e)}onLearnChange(e){return this.learnListeners.add(e),()=>this.learnListeners.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyParameterChange(e,t,a){this.changeCallbacks.forEach(n=>{try{n(e,t,a)}catch(s){}})}notifyLearnChange(e,t){this.learnListeners.forEach(a=>{try{a(e,t)}catch(n){}})}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}setGlobalSensitivity(e){this.globalSensitivity=Math.max(.05,Math.min(1,e))}getGlobalSensitivity(){return this.globalSensitivity}resetSmoothing(){this.smoothedValues.clear(),this.lastCCValues.clear()}setControlledInstrument(e){this.controlledInstrumentId=e,this.resetSmoothing(),this.notifyControlledInstrumentChange(e)}getControlledInstrument(){return this.controlledInstrumentId}onControlledInstrumentChange(e){return this.controlledInstrumentListeners.add(e),()=>this.controlledInstrumentListeners.delete(e)}notifyControlledInstrumentChange(e){this.controlledInstrumentListeners.forEach(t=>{try{t(e)}catch(a){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("cc-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("cc-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){gx().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.changeCallbacks.clear(),this.learnListeners.clear(),this.mappingListeners.clear()}}function vx(){return bx.getInstance()}class xx{static instance=null;mappings=new Map;actionHandlers=new Map;isLearning=!1;learningAction=null;learnCallback=null;mappingListeners=new Set;handlerRegistered=!1;constructor(){}static getInstance(){return xx.instance||(xx.instance=new xx),xx.instance}init(){if(this.handlerRegistered)return;gx().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if(this.isLearning&&this.learnCallback)return"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?void this.learnCallback(e.note,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63?void this.learnCallback(-e.cc-1,e.channel):void 0;"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity&&e.velocity>0?this.triggerButtonAction(e.note,void 0,e.channel):"cc"===e.type&&void 0!==e.cc&&void 0!==e.value&&e.value>63&&this.triggerButtonAction(void 0,e.cc,e.channel)};triggerButtonAction(e,t,a){for(const n of this.mappings.values()){const s=void 0!==e&&n.midiNote===e,r=void 0!==t&&n.ccNumber===t;if(!s&&!r)continue;if(void 0!==n.midiChannel&&void 0!==a&&n.midiChannel!==a)continue;const i=this.actionHandlers.get(n.action);return void(i&&i())}}startLearn(e){return new Promise(t=>{this.isLearning=!0,this.learningAction=e,this.learnCallback=(e,a)=>{this.isLearning=!1,this.learningAction=null,this.learnCallback=null,t(e<0?{type:"cc",number:-e-1,channel:a}:{type:"note",number:e,channel:a})}})}cancelLearn(){this.isLearning=!1,this.learningAction=null,this.learnCallback=null}isInLearnMode(){return this.isLearning}getLearningAction(){return this.learningAction}setMapping(e){for(const[t,a]of this.mappings.entries())a.action===e.action&&this.mappings.delete(t);this.mappings.set(e.id,e),this.saveMappings(),this.notifyMappingChange()}removeMapping(e){this.mappings.has(e)&&(this.mappings.delete(e),this.saveMappings(),this.notifyMappingChange())}getMappingForAction(e){for(const t of this.mappings.values())if(t.action===e)return t}getAllMappings(){return Array.from(this.mappings.values())}clearAllMappings(){this.mappings.clear(),this.saveMappings(),this.notifyMappingChange()}registerAction(e,t){return this.actionHandlers.set(e,t),()=>this.actionHandlers.delete(e)}unregisterAction(e){this.actionHandlers.delete(e)}onMappingChange(e){return this.mappingListeners.add(e),()=>this.mappingListeners.delete(e)}notifyMappingChange(){this.mappingListeners.forEach(e=>{try{e()}catch(t){}})}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("button-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("button-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>{this.mappings.set(e.id,e)})}}catch(e){}}dispose(){if(this.handlerRegistered){gx().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1}this.mappings.clear(),this.actionHandlers.clear(),this.mappingListeners.clear()}}function wx(){return xx.getInstance()}class kx{static instance=null;mappings=new Map;triggerCallbacks=new Set;handlerRegistered=!1;isLearning=!1;learnCallback=null;constructor(){}static getInstance(){return kx.instance||(kx.instance=new kx),kx.instance}init(){if(this.handlerRegistered)return;gx().addMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!0,this.loadMappings()}handleMIDIMessage=e=>{if("noteOn"!==e.type&&"noteOff"!==e.type)return;if(void 0===e.note)return;if(this.isLearning&&"noteOn"===e.type&&this.learnCallback)return void this.learnCallback(e.note,e.channel);const t=`${e.channel}-${e.note}`,a=this.mappings.get(t);if(a){const t="noteOff"===e.type?0:e.velocity??0;this.notifyTrigger(a,t)}};onTrigger(e){return this.triggerCallbacks.add(e),()=>this.triggerCallbacks.delete(e)}notifyTrigger(e,t){this.triggerCallbacks.forEach(a=>{try{a(e,t)}catch(n){}})}setMapping(e){this.mappings.set(e.id,e),this.saveMappings()}removeMapping(e){this.mappings.delete(e),this.saveMappings()}getMapping(e,t){return this.mappings.get(`${e}-${t}`)}getAllMappings(){return Array.from(this.mappings.values())}clearMappings(){this.mappings.clear(),this.saveMappings()}startLearn(e){this.isLearning=!0,this.learnCallback=(t,a)=>{this.isLearning=!1,this.learnCallback=null,e(t,a)}}cancelLearn(){this.isLearning=!1,this.learnCallback=null}saveMappings(){try{const e=JSON.stringify(Array.from(this.mappings.values()));localStorage.setItem("pad-mappings-v1",e)}catch(e){}}loadMappings(){try{const e=localStorage.getItem("pad-mappings-v1");if(e){const t=JSON.parse(e);this.mappings.clear(),t.forEach(e=>this.mappings.set(e.id,e))}}catch(e){}}dispose(){this.handlerRegistered&&(gx().removeMessageHandler(this.handleMIDIMessage),this.handlerRegistered=!1),this.triggerCallbacks.clear()}}function Sx(){return kx.getInstance()}const Mx={HEADER:new Uint8Array([240,0,32,50,0,1,10]),FOOTER:247,CMD_REQUEST_PATTERN:119,CMD_SEND_PATTERN:120},Nx=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Cx(e){const{name:t,octave:a}=function(e){const t=Math.floor(e/12)-1;return{name:Nx[e%12],octave:t}}(e);return t.includes("#")?`${t}${a}`:`${t}-${a}`}const Px=0,Ex=1,_x=2,Tx=3,Ax="Synthesis",Ox="Filter",Ix="Envelope",Fx="LFO",Dx="Effects",Rx="Modulation",jx="Sequencer",Bx="Arpeggiator",Lx="Mixer",Vx="Output",zx=1313559366,Ux=1313428297,Gx=1313426241,Wx=1347179847,Hx="DEViLBOX",Kx="devilbox-tracker-v1",qx=[{id:"tb303.cutoff",name:"Cutoff",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:74,isAutomatable:!0},{id:"tb303.resonance",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,ccNumber:71,isAutomatable:!0},{id:"tb303.envMod",name:"Env Mod",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,ccNumber:102,isAutomatable:!0},{id:"tb303.decay",name:"Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,ccNumber:103,isAutomatable:!0},{id:"tb303.accent",name:"Accent",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,ccNumber:104,isAutomatable:!0},{id:"tb303.tuning",name:"Tuning",section:Ax,type:Px,min:-1,max:1,defaultValue:0,unit:"semi",formatString:"%.1f",page:0,index:5,ccNumber:105,isAutomatable:!0},{id:"tb303.waveform",name:"Waveform",section:Ax,type:Tx,min:0,max:1,defaultValue:0,valueStrings:["Saw","Square"],page:0,index:6,ccNumber:106,isAutomatable:!0},{id:"tb303.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"dB",formatString:"%.1f",page:0,index:7,ccNumber:7,isAutomatable:!0},{id:"tb303.distortion",name:"Distortion",section:Dx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:0,ccNumber:94,isAutomatable:!0},{id:"tb303.delay.time",name:"Delay Time",section:Dx,type:Px,min:0,max:1,defaultValue:.375,unit:"ms",formatString:"%.0f",page:1,index:1,ccNumber:85,isAutomatable:!0},{id:"tb303.delay.feedback",name:"Delay Fdbk",section:Dx,type:Px,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,ccNumber:86,isAutomatable:!0},{id:"tb303.delay.mix",name:"Delay Mix",section:Dx,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,ccNumber:87,isAutomatable:!0},{id:"tb303.reverb.size",name:"Reverb Size",section:Dx,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:4,ccNumber:91,isAutomatable:!0},{id:"tb303.reverb.mix",name:"Reverb Mix",section:Dx,type:Px,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:5,ccNumber:92,isAutomatable:!0}],$x=[{id:"dexed.algorithm",name:"Algorithm",section:Ax,type:Ex,min:0,max:31,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"dexed.feedback",name:"Feedback",section:Ax,type:Ex,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"dexed.lfoSpeed",name:"LFO Speed",section:Fx,type:Ex,min:0,max:99,defaultValue:35,page:0,index:2,isAutomatable:!0},{id:"dexed.lfoPitchModDepth",name:"LFO Pitch",section:Fx,type:Ex,min:0,max:99,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"dexed.lfoAmpModDepth",name:"LFO Amp",section:Fx,type:Ex,min:0,max:99,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"dexed.lfoWave",name:"LFO Wave",section:Fx,type:Tx,min:0,max:5,defaultValue:0,valueStrings:["Triangle","Saw Down","Saw Up","Square","Sine","S&H"],page:0,index:5,isAutomatable:!0},{id:"dexed.transpose",name:"Transpose",section:Ax,type:Ex,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:6,isAutomatable:!0},{id:"dexed.oscSync",name:"Osc Sync",section:Ax,type:_x,min:0,max:1,defaultValue:1,page:0,index:7,isAutomatable:!0},...function(){const e=[];for(let t=0;t<6;t++){const a=t+1;e.push({id:`dexed.op${t+1}.level`,name:`OP${t+1} Level`,section:Ax,type:Ex,min:0,max:99,defaultValue:0===t?99:0,page:a,index:0,isAutomatable:!0},{id:`dexed.op${t+1}.coarse`,name:`OP${t+1} Coarse`,section:Ax,type:Ex,min:0,max:31,defaultValue:1,page:a,index:1,isAutomatable:!0},{id:`dexed.op${t+1}.fine`,name:`OP${t+1} Fine`,section:Ax,type:Ex,min:0,max:99,defaultValue:0,page:a,index:2,isAutomatable:!0},{id:`dexed.op${t+1}.detune`,name:`OP${t+1} Detune`,section:Ax,type:Ex,min:0,max:14,defaultValue:7,page:a,index:3,isAutomatable:!0},{id:`dexed.op${t+1}.egRate1`,name:`OP${t+1} R1`,section:Ix,type:Ex,min:0,max:99,defaultValue:99,page:a,index:4,isAutomatable:!0},{id:`dexed.op${t+1}.egRate2`,name:`OP${t+1} R2`,section:Ix,type:Ex,min:0,max:99,defaultValue:99,page:a,index:5,isAutomatable:!0},{id:`dexed.op${t+1}.egRate3`,name:`OP${t+1} R3`,section:Ix,type:Ex,min:0,max:99,defaultValue:99,page:a,index:6,isAutomatable:!0},{id:`dexed.op${t+1}.egRate4`,name:`OP${t+1} R4`,section:Ix,type:Ex,min:0,max:99,defaultValue:99,page:a,index:7,isAutomatable:!0})}return e}()];const Xx=[{id:"v2.osc1.mode",name:"Osc1 Mode",section:Ax,type:Tx,min:0,max:7,defaultValue:1,valueStrings:["Off","Saw/Tri","Pulse","Sin","Noise","XX","AuxA","AuxB"],page:0,index:0,isAutomatable:!0},{id:"v2.osc1.transpose",name:"Osc1 Trans",section:Ax,type:Ex,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:1,isAutomatable:!0},{id:"v2.osc1.color",name:"Osc1 Color",section:Ax,type:Ex,min:0,max:127,defaultValue:64,page:0,index:2,isAutomatable:!0},{id:"v2.osc1.level",name:"Osc1 Level",section:Ax,type:Ex,min:0,max:127,defaultValue:127,page:0,index:3,isAutomatable:!0},{id:"v2.osc2.mode",name:"Osc2 Mode",section:Ax,type:Tx,min:0,max:7,defaultValue:0,valueStrings:["!Off","Tri","Pulse","Sin","Noise","FM","AuxA","AuxB"],page:0,index:4,isAutomatable:!0},{id:"v2.osc2.transpose",name:"Osc2 Trans",section:Ax,type:Ex,min:-64,max:63,defaultValue:0,unit:"semi",page:0,index:5,isAutomatable:!0},{id:"v2.osc2.detune",name:"Osc2 Detune",section:Ax,type:Ex,min:-64,max:63,defaultValue:10,page:0,index:6,isAutomatable:!0},{id:"v2.osc2.level",name:"Osc2 Level",section:Ax,type:Ex,min:0,max:127,defaultValue:0,page:0,index:7,isAutomatable:!0},{id:"v2.filter1.mode",name:"Flt1 Mode",section:Ox,type:Tx,min:0,max:7,defaultValue:1,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:0,isAutomatable:!0},{id:"v2.filter1.cutoff",name:"Flt1 Cutoff",section:Ox,type:Ex,min:0,max:127,defaultValue:127,page:1,index:1,isAutomatable:!0},{id:"v2.filter1.resonance",name:"Flt1 Reso",section:Ox,type:Ex,min:0,max:127,defaultValue:0,page:1,index:2,isAutomatable:!0},{id:"v2.filter2.mode",name:"Flt2 Mode",section:Ox,type:Tx,min:0,max:7,defaultValue:0,valueStrings:["Off","Low","Band","High","Notch","All","MoogL","MoogH"],page:1,index:3,isAutomatable:!0},{id:"v2.filter2.cutoff",name:"Flt2 Cutoff",section:Ox,type:Ex,min:0,max:127,defaultValue:127,page:1,index:4,isAutomatable:!0},{id:"v2.filter2.resonance",name:"Flt2 Reso",section:Ox,type:Ex,min:0,max:127,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"v2.routing.mode",name:"Routing",section:Ox,type:Tx,min:0,max:2,defaultValue:0,valueStrings:["Single","Serial","Parallel"],page:1,index:6,isAutomatable:!0},{id:"v2.routing.balance",name:"Balance",section:Ox,type:Ex,min:0,max:127,defaultValue:64,page:1,index:7,isAutomatable:!0},{id:"v2.envelope.attack",name:"Amp Attack",section:Ix,type:Ex,min:0,max:127,defaultValue:0,page:2,index:0,isAutomatable:!0},{id:"v2.envelope.decay",name:"Amp Decay",section:Ix,type:Ex,min:0,max:127,defaultValue:64,page:2,index:1,isAutomatable:!0},{id:"v2.envelope.sustain",name:"Amp Sustain",section:Ix,type:Ex,min:0,max:127,defaultValue:127,page:2,index:2,isAutomatable:!0},{id:"v2.envelope.release",name:"Amp Release",section:Ix,type:Ex,min:0,max:127,defaultValue:32,page:2,index:3,isAutomatable:!0},{id:"v2.envelope2.attack",name:"Env2 Attack",section:Ix,type:Ex,min:0,max:127,defaultValue:0,page:2,index:4,isAutomatable:!0},{id:"v2.envelope2.decay",name:"Env2 Decay",section:Ix,type:Ex,min:0,max:127,defaultValue:64,page:2,index:5,isAutomatable:!0},{id:"v2.lfo1.rate",name:"LFO Rate",section:Fx,type:Ex,min:0,max:127,defaultValue:64,page:2,index:6,isAutomatable:!0},{id:"v2.lfo1.depth",name:"LFO Depth",section:Fx,type:Ex,min:0,max:127,defaultValue:0,page:2,index:7,isAutomatable:!0}],Yx=[{id:"monosynth.oscillator.type",name:"Waveform",section:Ax,type:Tx,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"monosynth.oscillator.detune",name:"Detune",section:Ax,type:Px,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"monosynth.filter.frequency",name:"Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"monosynth.filter.Q",name:"Resonance",section:Ox,type:Px,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"monosynth.filterEnvelope.amount",name:"Flt Env",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"monosynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"monosynth.envelope.decay",name:"Decay",section:Ix,type:Px,min:0,max:2,defaultValue:.2,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"monosynth.envelope.sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"monosynth.envelope.release",name:"Release",section:Ix,type:Px,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:1,index:0,isAutomatable:!0},{id:"monosynth.portamento",name:"Portamento",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"monosynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],Zx=[{id:"polysynth.oscillator.type",name:"Waveform",section:Ax,type:Tx,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"polysynth.oscillator.detune",name:"Detune",section:Ax,type:Px,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"polysynth.filter.frequency",name:"Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"polysynth.filter.Q",name:"Resonance",section:Ox,type:Px,min:0,max:20,defaultValue:1,formatString:"%.1f",page:0,index:3,isAutomatable:!0},{id:"polysynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"polysynth.envelope.decay",name:"Decay",section:Ix,type:Px,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"polysynth.envelope.sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"polysynth.envelope.release",name:"Release",section:Ix,type:Px,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"polysynth.maxPolyphony",name:"Voices",section:Ax,type:Ex,min:1,max:32,defaultValue:8,page:1,index:0,isAutomatable:!0},{id:"polysynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0}],Qx=[{id:"noisesynth.noise.type",name:"Noise Type",section:Ax,type:Tx,min:0,max:2,defaultValue:0,valueStrings:["White","Pink","Brown"],page:0,index:0,isAutomatable:!0},{id:"noisesynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.005,unit:"s",formatString:"%.3f",page:0,index:1,isAutomatable:!0},{id:"noisesynth.envelope.decay",name:"Decay",section:Ix,type:Px,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"noisesynth.envelope.sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"noisesynth.envelope.release",name:"Release",section:Ix,type:Px,min:.01,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"noisesynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],Jx=[{id:"sampler.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:0,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"sampler.release",name:"Release",section:Ix,type:Px,min:0,max:5,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"sampler.baseUrl",name:"Sample",section:Ax,type:Tx,min:0,max:0,defaultValue:0,page:0,index:2,isAutomatable:!1},{id:"sampler.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0}],ew=[{id:"drummachine.kick.tune",name:"Kick Tune",section:Ax,type:Px,min:20,max:200,defaultValue:60,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"drummachine.kick.decay",name:"Kick Decay",section:Ix,type:Px,min:.05,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"drummachine.snare.tune",name:"Snare Tune",section:Ax,type:Px,min:100,max:400,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"drummachine.snare.snappy",name:"Snare Snap",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"drummachine.hihat.decay",name:"HiHat Decay",section:Ix,type:Px,min:.01,max:1,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"drummachine.tone",name:"Tone",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"drummachine.accent",name:"Accent",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"drummachine.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],tw=[{id:"furnace.algorithm",name:"Algorithm",section:Ax,type:Ex,min:0,max:7,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"furnace.feedback",name:"Feedback",section:Ax,type:Ex,min:0,max:7,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"furnace.op1.level",name:"OP1 Level",section:Ax,type:Ex,min:0,max:127,defaultValue:99,page:0,index:2,isAutomatable:!0},{id:"furnace.op1.mult",name:"OP1 Mult",section:Ax,type:Ex,min:0,max:15,defaultValue:1,page:0,index:3,isAutomatable:!0},{id:"furnace.op2.level",name:"OP2 Level",section:Ax,type:Ex,min:0,max:127,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.op2.mult",name:"OP2 Mult",section:Ax,type:Ex,min:0,max:15,defaultValue:1,page:0,index:5,isAutomatable:!0},{id:"furnace.lfoRate",name:"LFO Rate",section:Fx,type:Ex,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],aw=[{id:"furnace.duty",name:"Duty Cycle",section:Ax,type:Tx,min:0,max:3,defaultValue:2,valueStrings:["12.5%","25%","50%","75%"],page:0,index:0,isAutomatable:!0},{id:"furnace.volume",name:"Volume",section:Vx,type:Ex,min:0,max:15,defaultValue:15,page:0,index:1,isAutomatable:!0},{id:"furnace.arpSpeed",name:"Arp Speed",section:Bx,type:Ex,min:0,max:15,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"furnace.pitchSlide",name:"Pitch Slide",section:Rx,type:Ex,min:-127,max:127,defaultValue:0,page:0,index:3,isAutomatable:!0},{id:"furnace.vibrato",name:"Vibrato",section:Fx,type:Ex,min:0,max:15,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"furnace.noise",name:"Noise",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"furnace.envelope",name:"Env Mode",section:Ix,type:Ex,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0}],nw=[{id:"buzzm3.osc1Wave",name:"Osc1 Wave",section:Ax,type:Tx,min:0,max:5,defaultValue:1,valueStrings:["Off","Saw","Pulse","Tri","Sin","Noise"],page:0,index:0,isAutomatable:!0},{id:"buzzm3.osc1PW",name:"Osc1 PW",section:Ax,type:Ex,min:0,max:127,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzzm3.osc2Wave",name:"Osc2 Wave",section:Ax,type:Tx,min:0,max:5,defaultValue:0,valueStrings:["Off","Saw","Pulse","Tri","Sin","Noise"],page:0,index:2,isAutomatable:!0},{id:"buzzm3.mix",name:"Osc Mix",section:Ax,type:Ex,min:0,max:127,defaultValue:64,page:0,index:3,isAutomatable:!0},{id:"buzzm3.filterCutoff",name:"Cutoff",section:Ox,type:Ex,min:0,max:127,defaultValue:100,page:0,index:4,isAutomatable:!0},{id:"buzzm3.filterReso",name:"Resonance",section:Ox,type:Ex,min:0,max:127,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"buzzm3.ampAttack",name:"Attack",section:Ix,type:Ex,min:0,max:127,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"buzzm3.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],sw=[{id:"generic.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,ccNumber:7,isAutomatable:!0},{id:"generic.pan",name:"Pan",section:Vx,type:Px,min:-1,max:1,defaultValue:0,formatString:"%.2f",page:0,index:1,ccNumber:10,isAutomatable:!0}],rw={TB303:qx,Dexed:$x,OBXd:[{id:"obxd.osc1Waveform",name:"Osc1 Wave",section:Ax,type:Tx,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"obxd.osc1Octave",name:"Osc1 Oct",section:Ax,type:Ex,min:-2,max:2,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"obxd.osc1PulseWidth",name:"Osc1 PW",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"obxd.osc1Level",name:"Osc1 Level",section:Ax,type:Px,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"obxd.osc2Waveform",name:"Osc2 Wave",section:Ax,type:Tx,min:0,max:3,defaultValue:0,valueStrings:["Saw","Pulse","Triangle","Noise"],page:0,index:4,isAutomatable:!0},{id:"obxd.osc2Octave",name:"Osc2 Oct",section:Ax,type:Ex,min:-2,max:2,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"obxd.osc2Detune",name:"Osc2 Detune",section:Ax,type:Px,min:-1,max:1,defaultValue:.1,unit:"semi",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"obxd.osc2Level",name:"Osc2 Level",section:Ax,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0},{id:"obxd.filterCutoff",name:"Cutoff",section:Ox,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:0,isAutomatable:!0},{id:"obxd.filterResonance",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"obxd.filterEnvAmount",name:"Env Amount",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"obxd.filterKeyTrack",name:"Key Track",section:Ox,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"obxd.filterAttack",name:"Flt Attack",section:Ix,type:Px,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:1,index:4,isAutomatable:!0},{id:"obxd.filterDecay",name:"Flt Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:5,isAutomatable:!0},{id:"obxd.filterSustain",name:"Flt Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"obxd.filterRelease",name:"Flt Release",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:7,isAutomatable:!0},{id:"obxd.ampAttack",name:"Amp Attack",section:Ix,type:Px,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:2,index:0,isAutomatable:!0},{id:"obxd.ampDecay",name:"Amp Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.2,unit:"s",formatString:"%.2f",page:2,index:1,isAutomatable:!0},{id:"obxd.ampSustain",name:"Amp Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:2,isAutomatable:!0},{id:"obxd.ampRelease",name:"Amp Release",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:2,index:3,isAutomatable:!0},{id:"obxd.masterVolume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:2,index:4,isAutomatable:!0},{id:"obxd.portamento",name:"Portamento",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:2,index:5,isAutomatable:!0},{id:"obxd.unison",name:"Unison",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:2,index:6,isAutomatable:!0},{id:"obxd.unisonDetune",name:"Uni Detune",section:Ax,type:Px,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:2,index:7,isAutomatable:!0},{id:"obxd.lfoRate",name:"LFO Rate",section:Fx,type:Px,min:0,max:1,defaultValue:.2,unit:"Hz",formatString:"%.1f",page:3,index:0,isAutomatable:!0},{id:"obxd.lfoWaveform",name:"LFO Wave",section:Fx,type:Tx,min:0,max:4,defaultValue:0,valueStrings:["Sine","Triangle","Saw","Square","S&H"],page:3,index:1,isAutomatable:!0},{id:"obxd.lfoOscAmount",name:"LFO>Pitch",section:Fx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:2,isAutomatable:!0},{id:"obxd.lfoFilterAmount",name:"LFO>Filter",section:Fx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:3,isAutomatable:!0},{id:"obxd.lfoAmpAmount",name:"LFO>Amp",section:Fx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:4,isAutomatable:!0},{id:"obxd.lfoPwAmount",name:"LFO>PW",section:Fx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:3,index:5,isAutomatable:!0},{id:"obxd.oscSync",name:"Osc Sync",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:3,index:6,isAutomatable:!0},{id:"obxd.oscXor",name:"Ring Mod",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:3,index:7,isAutomatable:!0}],DubSiren:[{id:"dubsiren.oscillator.type",name:"Osc Type",section:Ax,type:Tx,min:0,max:3,defaultValue:0,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:0,isAutomatable:!0},{id:"dubsiren.oscillator.frequency",name:"Frequency",section:Ax,type:Px,min:60,max:1e3,defaultValue:440,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"dubsiren.lfo.enabled",name:"LFO On",section:Fx,type:_x,min:0,max:1,defaultValue:1,page:0,index:2,isAutomatable:!0},{id:"dubsiren.lfo.type",name:"LFO Type",section:Fx,type:Tx,min:0,max:3,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle"],page:0,index:3,isAutomatable:!0},{id:"dubsiren.lfo.rate",name:"LFO Rate",section:Fx,type:Px,min:0,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"dubsiren.lfo.depth",name:"LFO Depth",section:Fx,type:Px,min:0,max:1e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"dubsiren.filter.enabled",name:"Filter On",section:Ox,type:_x,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"dubsiren.filter.frequency",name:"Filter Freq",section:Ox,type:Px,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"dubsiren.delay.enabled",name:"Delay On",section:Dx,type:_x,min:0,max:1,defaultValue:1,page:1,index:0,isAutomatable:!0},{id:"dubsiren.delay.time",name:"Delay Time",section:Dx,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"dubsiren.delay.feedback",name:"Delay Fdbk",section:Dx,type:Px,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"dubsiren.delay.wet",name:"Delay Mix",section:Dx,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"dubsiren.reverb.enabled",name:"Reverb On",section:Dx,type:_x,min:0,max:1,defaultValue:1,page:1,index:4,isAutomatable:!0},{id:"dubsiren.reverb.decay",name:"Reverb Dec",section:Dx,type:Px,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"dubsiren.reverb.wet",name:"Reverb Mix",section:Dx,type:Px,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],SpaceLaser:[{id:"spacelaser.laser.startFreq",name:"Start Freq",section:Ax,type:Px,min:100,max:1e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"spacelaser.laser.endFreq",name:"End Freq",section:Ax,type:Px,min:20,max:2e3,defaultValue:100,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"spacelaser.laser.sweepTime",name:"Sweep Time",section:Ix,type:Px,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"spacelaser.laser.sweepCurve",name:"Curve",section:Ix,type:Tx,min:0,max:1,defaultValue:0,valueStrings:["Exp","Linear"],page:0,index:3,isAutomatable:!0},{id:"spacelaser.fm.amount",name:"FM Amount",section:Rx,type:Px,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"spacelaser.fm.ratio",name:"FM Ratio",section:Rx,type:Px,min:.5,max:16,defaultValue:1,formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"spacelaser.noise.amount",name:"Noise",section:Ax,type:Px,min:0,max:100,defaultValue:0,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"spacelaser.filter.cutoff",name:"Filter",section:Ox,type:Px,min:20,max:2e4,defaultValue:2e4,unit:"Hz",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"spacelaser.delay.enabled",name:"Delay On",section:Dx,type:_x,min:0,max:1,defaultValue:0,page:1,index:0,isAutomatable:!0},{id:"spacelaser.delay.time",name:"Delay Time",section:Dx,type:Px,min:0,max:1,defaultValue:.25,unit:"s",formatString:"%.2f",page:1,index:1,isAutomatable:!0},{id:"spacelaser.delay.feedback",name:"Delay Fdbk",section:Dx,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0},{id:"spacelaser.delay.wet",name:"Delay Mix",section:Dx,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:3,isAutomatable:!0},{id:"spacelaser.reverb.enabled",name:"Reverb On",section:Dx,type:_x,min:0,max:1,defaultValue:0,page:1,index:4,isAutomatable:!0},{id:"spacelaser.reverb.decay",name:"Reverb Dec",section:Dx,type:Px,min:.1,max:10,defaultValue:1.5,unit:"s",formatString:"%.1f",page:1,index:5,isAutomatable:!0},{id:"spacelaser.reverb.wet",name:"Reverb Mix",section:Dx,type:Px,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0}],Synare:[{id:"synare.oscillator.tune",name:"Tune",section:Ax,type:Px,min:20,max:1e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"synare.oscillator.fine",name:"Fine Tune",section:Ax,type:Px,min:-100,max:100,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"synare.oscillator2.enabled",name:"Osc2 On",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"synare.oscillator2.detune",name:"Osc2 Detune",section:Ax,type:Px,min:-24,max:24,defaultValue:7,unit:"semi",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"synare.filter.cutoff",name:"Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"synare.filter.resonance",name:"Resonance",section:Ox,type:Px,min:0,max:100,defaultValue:20,unit:"%",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"synare.filter.envMod",name:"Flt Env",section:Ox,type:Px,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:0,index:6,isAutomatable:!0},{id:"synare.filter.decay",name:"Flt Decay",section:Ix,type:Px,min:10,max:2e3,defaultValue:200,unit:"ms",formatString:"%.0f",page:0,index:7,isAutomatable:!0},{id:"synare.envelope.decay",name:"Amp Decay",section:Ix,type:Px,min:10,max:2e3,defaultValue:300,unit:"ms",formatString:"%.0f",page:1,index:0,isAutomatable:!0},{id:"synare.envelope.sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"synare.sweep.enabled",name:"Sweep On",section:Rx,type:_x,min:0,max:1,defaultValue:1,page:1,index:2,isAutomatable:!0},{id:"synare.sweep.amount",name:"Sweep Amt",section:Rx,type:Px,min:0,max:48,defaultValue:12,unit:"semi",formatString:"%.0f",page:1,index:3,isAutomatable:!0},{id:"synare.sweep.time",name:"Sweep Time",section:Rx,type:Px,min:1,max:500,defaultValue:50,unit:"ms",formatString:"%.0f",page:1,index:4,isAutomatable:!0},{id:"synare.noise.enabled",name:"Noise On",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:1,index:5,isAutomatable:!0},{id:"synare.noise.mix",name:"Noise Mix",section:Ax,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:1,index:6,isAutomatable:!0},{id:"synare.noise.color",name:"Noise Color",section:Ax,type:Px,min:0,max:100,defaultValue:50,unit:"%",formatString:"%.0f",page:1,index:7,isAutomatable:!0}],V2:Xx,Sam:[{id:"sam.speed",name:"Speed",section:Ax,type:Ex,min:20,max:200,defaultValue:72,page:0,index:0,isAutomatable:!0},{id:"sam.pitch",name:"Pitch",section:Ax,type:Ex,min:20,max:200,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"sam.mouth",name:"Mouth",section:Ax,type:Ex,min:0,max:255,defaultValue:128,page:0,index:2,isAutomatable:!0},{id:"sam.throat",name:"Throat",section:Ax,type:Ex,min:0,max:255,defaultValue:128,page:0,index:3,isAutomatable:!0},{id:"sam.singMode",name:"Sing Mode",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"sam.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],MonoSynth:Yx,DuoSynth:[{id:"duosynth.voice0.oscillator.type",name:"V0 Wave",section:Ax,type:Tx,min:0,max:4,defaultValue:1,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:0,isAutomatable:!0},{id:"duosynth.voice0.filter.frequency",name:"V0 Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:2e3,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"duosynth.voice0.filter.Q",name:"V0 Reso",section:Ox,type:Px,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:2,isAutomatable:!0},{id:"duosynth.voice0.envelope.attack",name:"V0 Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"duosynth.voice1.oscillator.type",name:"V1 Wave",section:Ax,type:Tx,min:0,max:4,defaultValue:2,valueStrings:["Sine","Square","Saw","Triangle","Pulse"],page:0,index:4,isAutomatable:!0},{id:"duosynth.voice1.filter.frequency",name:"V1 Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:5,isAutomatable:!0},{id:"duosynth.voice1.filter.Q",name:"V1 Reso",section:Ox,type:Px,min:0,max:20,defaultValue:2,formatString:"%.1f",page:0,index:6,isAutomatable:!0},{id:"duosynth.harmonicity",name:"Harmonicity",section:Ax,type:Px,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:7,isAutomatable:!0},{id:"duosynth.vibratoRate",name:"Vib Rate",section:Fx,type:Px,min:0,max:20,defaultValue:5,unit:"Hz",formatString:"%.1f",page:1,index:0,isAutomatable:!0},{id:"duosynth.vibratoAmount",name:"Vib Amount",section:Fx,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:1,index:1,isAutomatable:!0},{id:"duosynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:1,index:2,isAutomatable:!0}],PolySynth:Zx,Synth:Zx,FMSynth:[{id:"fmsynth.modulationIndex",name:"Mod Index",section:Rx,type:Px,min:0,max:100,defaultValue:10,formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"fmsynth.harmonicity",name:"Harmonicity",section:Ax,type:Px,min:.5,max:8,defaultValue:1,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.attack",name:"Mod Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.decay",name:"Mod Decay",section:Ix,type:Px,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"fmsynth.modulationEnvelope.sustain",name:"Mod Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"fmsynth.envelope.attack",name:"Amp Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"fmsynth.envelope.decay",name:"Amp Decay",section:Ix,type:Px,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"fmsynth.envelope.sustain",name:"Amp Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],AMSynth:[{id:"amsynth.harmonicity",name:"Harmonicity",section:Ax,type:Px,min:.5,max:4,defaultValue:1,formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"amsynth.modulationEnvelope.attack",name:"Mod Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"amsynth.modulationEnvelope.decay",name:"Mod Decay",section:Ix,type:Px,min:0,max:2,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"amsynth.envelope.attack",name:"Amp Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"amsynth.envelope.decay",name:"Amp Decay",section:Ix,type:Px,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"amsynth.envelope.sustain",name:"Amp Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"amsynth.envelope.release",name:"Amp Release",section:Ix,type:Px,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"amsynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MembraneSynth:[{id:"membranesynth.pitchDecay",name:"Pitch Decay",section:Ix,type:Px,min:0,max:.5,defaultValue:.05,unit:"s",formatString:"%.3f",page:0,index:0,isAutomatable:!0},{id:"membranesynth.octaves",name:"Octaves",section:Ax,type:Px,min:.5,max:8,defaultValue:4,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"membranesynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:2,isAutomatable:!0},{id:"membranesynth.envelope.decay",name:"Decay",section:Ix,type:Px,min:.01,max:2,defaultValue:.4,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"membranesynth.envelope.sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.01,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"membranesynth.envelope.release",name:"Release",section:Ix,type:Px,min:.01,max:2,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"membranesynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}],MetalSynth:[{id:"metalsynth.frequency",name:"Frequency",section:Ax,type:Px,min:20,max:8e3,defaultValue:200,unit:"Hz",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"metalsynth.harmonicity",name:"Harmonicity",section:Ax,type:Px,min:1,max:10,defaultValue:5.1,formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"metalsynth.modulationIndex",name:"Mod Index",section:Rx,type:Px,min:0,max:100,defaultValue:32,formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"metalsynth.resonance",name:"Resonance",section:Ax,type:Px,min:0,max:7e3,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"metalsynth.octaves",name:"Octaves",section:Ax,type:Px,min:.5,max:4,defaultValue:1.5,formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"metalsynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:.1,defaultValue:.001,unit:"s",formatString:"%.3f",page:0,index:5,isAutomatable:!0},{id:"metalsynth.envelope.decay",name:"Decay",section:Ix,type:Px,min:.01,max:4,defaultValue:1.4,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"metalsynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],NoiseSynth:Qx,PluckSynth:[{id:"plucksynth.attackNoise",name:"Attack Noise",section:Ax,type:Px,min:0,max:1,defaultValue:1,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"plucksynth.resonance",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:.9,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"plucksynth.dampening",name:"Dampening",section:Ox,type:Px,min:1e3,max:1e4,defaultValue:4e3,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"plucksynth.release",name:"Release",section:Ix,type:Px,min:.1,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"plucksynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0}],Sampler:Jx,Player:Jx,SuperSaw:[{id:"supersaw.detune",name:"Detune",section:Ax,type:Px,min:0,max:100,defaultValue:30,unit:"ct",formatString:"%.0f",page:0,index:0,isAutomatable:!0},{id:"supersaw.mix",name:"Mix",section:Ax,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"supersaw.voices",name:"Voices",section:Ax,type:Ex,min:1,max:7,defaultValue:7,page:0,index:2,isAutomatable:!0},{id:"supersaw.filter.cutoff",name:"Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:8e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"supersaw.filter.resonance",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"supersaw.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"supersaw.envelope.release",name:"Release",section:Ix,type:Px,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"supersaw.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Organ:[{id:"organ.drawbar1",name:"16'",section:Ax,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"organ.drawbar2",name:"5 1/3'",section:Ax,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"organ.drawbar3",name:"8'",section:Ax,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"organ.drawbar4",name:"4'",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"organ.drawbar5",name:"2 2/3'",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"organ.drawbar6",name:"2'",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"organ.percussion",name:"Percussion",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"organ.vibrato",name:"Vibrato",section:Fx,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],DrumMachine:ew,ChipSynth:[{id:"chipsynth.waveform",name:"Waveform",section:Ax,type:Tx,min:0,max:4,defaultValue:1,valueStrings:["Square","Pulse25","Pulse12","Triangle","Noise"],page:0,index:0,isAutomatable:!0},{id:"chipsynth.duty",name:"Duty",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"chipsynth.pitchBend",name:"Pitch Bend",section:Ax,type:Ex,min:-24,max:24,defaultValue:0,unit:"semi",page:0,index:2,isAutomatable:!0},{id:"chipsynth.vibrato",name:"Vibrato",section:Fx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"chipsynth.arpSpeed",name:"Arp Speed",section:Bx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"chipsynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"chipsynth.envelope.decay",name:"Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"chipsynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],PWMSynth:[{id:"pwmsynth.pulseWidth",name:"Pulse Width",section:Ax,type:Px,min:.01,max:.99,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"pwmsynth.lfo.rate",name:"LFO Rate",section:Fx,type:Px,min:.1,max:20,defaultValue:2,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"pwmsynth.lfo.depth",name:"LFO Depth",section:Fx,type:Px,min:0,max:.49,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"pwmsynth.filter.cutoff",name:"Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:5e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"pwmsynth.filter.resonance",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"pwmsynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"pwmsynth.envelope.release",name:"Release",section:Ix,type:Px,min:0,max:5,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"pwmsynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],WobbleBass:[{id:"wobblebass.lfo.rate",name:"Wobble Rate",section:Fx,type:Px,min:.1,max:20,defaultValue:4,unit:"Hz",formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"wobblebass.lfo.depth",name:"Wobble Depth",section:Fx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"wobblebass.filter.cutoff",name:"Cutoff",section:Ox,type:Px,min:20,max:5e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wobblebass.filter.resonance",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:.6,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wobblebass.distortion",name:"Distortion",section:Dx,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"wobblebass.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:1,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wobblebass.envelope.release",name:"Release",section:Ix,type:Px,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"wobblebass.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],StringMachine:[{id:"stringmachine.ensemble",name:"Ensemble",section:Dx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"stringmachine.detune",name:"Detune",section:Ax,type:Px,min:0,max:50,defaultValue:15,unit:"ct",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"stringmachine.voices",name:"Voices",section:Ax,type:Ex,min:2,max:8,defaultValue:4,page:0,index:2,isAutomatable:!0},{id:"stringmachine.filter.cutoff",name:"Cutoff",section:Ox,type:Px,min:20,max:1e4,defaultValue:3e3,unit:"Hz",formatString:"%.0f",page:0,index:3,isAutomatable:!0},{id:"stringmachine.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:3,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"stringmachine.envelope.release",name:"Release",section:Ix,type:Px,min:0,max:5,defaultValue:1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"stringmachine.chorus",name:"Chorus",section:Dx,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"stringmachine.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],FormantSynth:[{id:"formantsynth.vowel",name:"Vowel",section:Ax,type:Tx,min:0,max:4,defaultValue:0,valueStrings:["A","E","I","O","U"],page:0,index:0,isAutomatable:!0},{id:"formantsynth.formant1",name:"Formant 1",section:Ox,type:Px,min:200,max:2e3,defaultValue:800,unit:"Hz",formatString:"%.0f",page:0,index:1,isAutomatable:!0},{id:"formantsynth.formant2",name:"Formant 2",section:Ox,type:Px,min:500,max:4e3,defaultValue:1200,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"formantsynth.nasality",name:"Nasality",section:Ax,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"formantsynth.vibrato",name:"Vibrato",section:Fx,type:Px,min:0,max:1,defaultValue:.2,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"formantsynth.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"formantsynth.envelope.release",name:"Release",section:Ix,type:Px,min:0,max:3,defaultValue:.5,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"formantsynth.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],GranularSynth:[{id:"granular.grainSize",name:"Grain Size",section:Ax,type:Px,min:.01,max:.5,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:0,isAutomatable:!0},{id:"granular.overlap",name:"Overlap",section:Ax,type:Px,min:.1,max:2,defaultValue:.5,formatString:"%.2f",page:0,index:1,isAutomatable:!0},{id:"granular.playbackRate",name:"Speed",section:Ax,type:Px,min:.25,max:4,defaultValue:1,formatString:"%.2f",page:0,index:2,isAutomatable:!0},{id:"granular.detune",name:"Detune",section:Ax,type:Ex,min:-1200,max:1200,defaultValue:0,unit:"ct",page:0,index:3,isAutomatable:!0},{id:"granular.drift",name:"Drift",section:Rx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"granular.reverse",name:"Reverse",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"granular.loop",name:"Loop",section:Ax,type:_x,min:0,max:1,defaultValue:1,page:0,index:6,isAutomatable:!0},{id:"granular.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Wavetable:[{id:"wavetable.tablePosition",name:"Position",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"wavetable.morphSpeed",name:"Morph Speed",section:Rx,type:Px,min:0,max:10,defaultValue:0,unit:"Hz",formatString:"%.1f",page:0,index:1,isAutomatable:!0},{id:"wavetable.filter.cutoff",name:"Cutoff",section:Ox,type:Px,min:20,max:2e4,defaultValue:1e4,unit:"Hz",formatString:"%.0f",page:0,index:2,isAutomatable:!0},{id:"wavetable.filter.resonance",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"wavetable.envelope.attack",name:"Attack",section:Ix,type:Px,min:0,max:2,defaultValue:.01,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"wavetable.envelope.decay",name:"Decay",section:Ix,type:Px,min:0,max:2,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"wavetable.envelope.sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"wavetable.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Buzz3o3:qx,BuzzM3:nw,Buzz4FM2F:tw,BuzzDynamite6:[{id:"buzzdyn6.coarseTune",name:"Coarse",section:Ax,type:Ex,min:1,max:255,defaultValue:128,page:0,index:0,isAutomatable:!0},{id:"buzzdyn6.pipe1Len",name:"Pipe 1 Len",section:Ax,type:Ex,min:0,max:255,defaultValue:128,page:0,index:1,isAutomatable:!0},{id:"buzzdyn6.pipe1Fdbk",name:"Pipe 1 FB",section:Ax,type:Ex,min:0,max:255,defaultValue:128,page:0,index:2,isAutomatable:!0},{id:"buzzdyn6.pipe1Filter",name:"Pipe 1 Flt",section:Ox,type:Ex,min:0,max:255,defaultValue:128,page:0,index:3,isAutomatable:!0},{id:"buzzdyn6.envAttack",name:"Attack",section:Ix,type:Ex,min:0,max:254,defaultValue:4,page:0,index:4,isAutomatable:!0},{id:"buzzdyn6.envDecay",name:"Decay",section:Ix,type:Ex,min:1,max:255,defaultValue:255,page:0,index:5,isAutomatable:!0},{id:"buzzdyn6.routing",name:"Routing",section:Ax,type:Ex,min:0,max:7,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"buzzdyn6.amplification",name:"Amplify",section:Vx,type:Ex,min:1,max:255,defaultValue:32,page:0,index:7,isAutomatable:!0}],BuzzKick:[{id:"buzzkick.startFreq",name:"Start Freq",section:Ax,type:Ex,min:1,max:240,defaultValue:198,page:0,index:0,isAutomatable:!0},{id:"buzzkick.endFreq",name:"End Freq",section:Ax,type:Ex,min:1,max:240,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzzkick.toneDecay",name:"Tone Decay",section:Ix,type:Ex,min:1,max:240,defaultValue:46,page:0,index:2,isAutomatable:!0},{id:"buzzkick.toneShape",name:"Tone Shape",section:Ix,type:Ex,min:1,max:240,defaultValue:27,page:0,index:3,isAutomatable:!0},{id:"buzzkick.ampDecay",name:"Amp Decay",section:Ix,type:Ex,min:1,max:240,defaultValue:55,page:0,index:4,isAutomatable:!0},{id:"buzzkick.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],BuzzKickXP:[{id:"buzzkickxp.startFreq",name:"Start Freq",section:Ax,type:Ex,min:1,max:240,defaultValue:198,page:0,index:0,isAutomatable:!0},{id:"buzzkickxp.endFreq",name:"End Freq",section:Ax,type:Ex,min:1,max:240,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzzkickxp.buzzAmt",name:"Buzz",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"buzzkickxp.clickAmt",name:"Click",section:Ax,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"buzzkickxp.punchAmt",name:"Punch",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"buzzkickxp.toneDecay",name:"Tone Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.4,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"buzzkickxp.decayTime",name:"Decay Time",section:Ix,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"buzzkickxp.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],BuzzTrilok:[{id:"buzztrilok.tone",name:"BD Tone",section:Ax,type:Ex,min:0,max:127,defaultValue:64,page:0,index:0,isAutomatable:!0},{id:"buzztrilok.decay",name:"BD Decay",section:Ix,type:Ex,min:0,max:127,defaultValue:64,page:0,index:1,isAutomatable:!0},{id:"buzztrilok.volume",name:"BD Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0}],BuzzNoise:Qx,BuzzFreqBomb:[{id:"buzzfreqbomb.freq",name:"Frequency",section:Ax,type:Px,min:.01,max:655,defaultValue:50,unit:"Hz",formatString:"%.1f",page:0,index:0,isAutomatable:!0},{id:"buzzfreqbomb.waveform",name:"Waveform",section:Ax,type:Tx,min:0,max:4,defaultValue:0,valueStrings:["Sine","Saw","Square","Triangle","Noise"],page:0,index:1,isAutomatable:!0},{id:"buzzfreqbomb.wavePower",name:"Wave Power",section:Ax,type:Ex,min:1,max:13,defaultValue:1,page:0,index:2,isAutomatable:!0},{id:"buzzfreqbomb.lfoRate",name:"LFO Rate",section:Fx,type:Px,min:.01,max:655,defaultValue:10,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"buzzfreqbomb.lfoAmount",name:"LFO Amount",section:Fx,type:Px,min:0,max:65,defaultValue:0,unit:"Hz",formatString:"%.1f",page:0,index:4,isAutomatable:!0},{id:"buzzfreqbomb.freqAttack",name:"Freq Attack",section:Ix,type:Px,min:0,max:655,defaultValue:.1,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"buzzfreqbomb.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}],BuzzDTMF:[{id:"buzzdtmf.dialNumber",name:"Dial #",section:Ax,type:Ex,min:0,max:11,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"buzzdtmf.sustain",name:"Sustain",section:Ix,type:Ex,min:0,max:254,defaultValue:40,page:0,index:1,isAutomatable:!0},{id:"buzzdtmf.twist",name:"Twist",section:Ax,type:Ex,min:0,max:40,defaultValue:0,unit:"dB",page:0,index:2,isAutomatable:!0},{id:"buzzdtmf.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.75,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0}],Buzzmachine:nw,Furnace:tw,FurnaceOPN:tw,FurnaceOPN2203:tw,FurnaceOPNA:tw,FurnaceOPNB:tw,FurnaceOPNBB:tw,FurnaceOPM:tw,FurnaceOPL:tw,FurnaceOPLL:tw,FurnaceOPL4:tw,FurnaceOPZ:tw,FurnaceY8950:tw,FurnaceESFM:tw,FurnaceVRC7:tw,FurnaceNES:aw,FurnaceGB:aw,FurnacePSG:aw,FurnacePCE:aw,FurnaceSNES:aw,FurnaceVB:aw,FurnaceLynx:aw,FurnaceSWAN:aw,FurnaceNDS:aw,FurnaceGBA:aw,FurnacePOKEMINI:aw,FurnaceVRC6:aw,FurnaceN163:aw,FurnaceFDS:aw,FurnaceMMC5:aw,FurnaceC64:aw,FurnaceSID6581:aw,FurnaceSID8580:aw,FurnaceAY:aw,FurnaceAY8930:aw,FurnaceVIC:aw,FurnacePET:aw,FurnaceSAA:aw,FurnaceTED:aw,FurnaceDAVE:aw,FurnaceVERA:aw,FurnaceSCC:aw,FurnaceTIA:aw,FurnacePOKEY:aw,FurnaceZXBEEPER:aw,FurnaceAMIGA:aw,FurnacePCSPKR:aw,FurnaceSEGAPCM:Jx,FurnaceQSOUND:Jx,FurnaceES5506:Jx,FurnaceRF5C68:Jx,FurnaceC140:Jx,FurnaceK007232:Jx,FurnaceK053260:Jx,FurnaceGA20:Jx,FurnaceOKI:Jx,FurnaceYMZ280B:Jx,FurnaceX1_010:Jx,FurnaceBUBBLE:Jx,FurnaceMULTIPCM:Jx,FurnaceMSM6258:Jx,FurnaceMSM5232:Jx,FurnaceNAMCO:aw,FurnaceSM8521:aw,FurnaceT6W28:aw,FurnaceSUPERVISION:aw,FurnaceUPD1771:aw,FurnacePONG:aw,FurnacePV1000:aw,FurnaceSU:aw,FurnacePOWERNOISE:Qx,FurnaceSCVTONE:aw,FurnacePCMDAC:Jx,V2Speech:Xx,Buzz3o3DF:qx,BuzzM4:[{id:"buzzm4.osc1Wave",name:"Osc1 Wave",section:Ax,type:Ex,min:0,max:99,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"buzzm4.osc2Wave",name:"Osc2 Wave",section:Ax,type:Ex,min:0,max:99,defaultValue:0,page:0,index:1,isAutomatable:!0},{id:"buzzm4.oscMix",name:"Osc Mix",section:Ax,type:Ex,min:0,max:127,defaultValue:64,page:0,index:2,isAutomatable:!0},{id:"buzzm4.filterCutoff",name:"Cutoff",section:Ox,type:Ex,min:0,max:127,defaultValue:100,page:0,index:3,isAutomatable:!0},{id:"buzzm4.filterReso",name:"Resonance",section:Ox,type:Ex,min:0,max:127,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"buzzm4.ampAttack",name:"Attack",section:Ix,type:Ex,min:0,max:127,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"buzzm4.ampRelease",name:"Release",section:Ix,type:Ex,min:0,max:127,defaultValue:30,page:0,index:6,isAutomatable:!0},{id:"buzzm4.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],DexedBridge:$x,TonewheelOrgan:[{id:"tonewheel.drawbar16",name:"16'",section:Ax,type:Ex,min:0,max:8,defaultValue:8,page:0,index:0,isAutomatable:!0},{id:"tonewheel.drawbar8",name:"8'",section:Ax,type:Ex,min:0,max:8,defaultValue:8,page:0,index:1,isAutomatable:!0},{id:"tonewheel.drawbar4",name:"4'",section:Ax,type:Ex,min:0,max:8,defaultValue:0,page:0,index:2,isAutomatable:!0},{id:"tonewheel.percMode",name:"Perc Mode",section:Ax,type:Tx,min:0,max:2,defaultValue:0,valueStrings:["Off","2nd","3rd"],page:0,index:3,isAutomatable:!0},{id:"tonewheel.vibratoType",name:"Vib Type",section:Fx,type:Tx,min:0,max:5,defaultValue:0,valueStrings:["V1","V2","V3","C1","C2","C3"],page:0,index:4,isAutomatable:!0},{id:"tonewheel.click",name:"Click",section:Ax,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"tonewheel.overdrive",name:"Overdrive",section:Dx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"tonewheel.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Melodica:[{id:"melodica.breath",name:"Breath",section:Ax,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"melodica.brightness",name:"Brightness",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"melodica.vibratoRate",name:"Vib Rate",section:Fx,type:Px,min:0,max:10,defaultValue:4,unit:"Hz",formatString:"%.1f",page:0,index:2,isAutomatable:!0},{id:"melodica.vibratoDepth",name:"Vib Depth",section:Fx,type:Px,min:0,max:1,defaultValue:.3,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"melodica.detune",name:"Detune",section:Ax,type:Px,min:-50,max:50,defaultValue:0,unit:"ct",formatString:"%.0f",page:0,index:4,isAutomatable:!0},{id:"melodica.noise",name:"Noise",section:Ax,type:Px,min:0,max:1,defaultValue:.1,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"melodica.portamento",name:"Portamento",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"melodica.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Vital:[{id:"vital.osc1WaveFrame",name:"Osc1 Wave",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"vital.filter1Cutoff",name:"Cutoff",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"vital.filter1Reso",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"vital.env1Attack",name:"Attack",section:Ix,type:Px,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"vital.env1Decay",name:"Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"vital.env1Sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"vital.env1Release",name:"Release",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"vital.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Odin2:[{id:"odin2.osc1Type",name:"Osc1 Type",section:Ax,type:Ex,min:0,max:11,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"odin2.filter1Freq",name:"Flt Freq",section:Ox,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"odin2.filter1Reso",name:"Flt Reso",section:Ox,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"odin2.env1Attack",name:"Attack",section:Ix,type:Px,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"odin2.env1Decay",name:"Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"odin2.env1Sustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"odin2.env1Release",name:"Release",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"odin2.masterVol",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Surge:[{id:"surge.osc1Type",name:"Osc Type",section:Ax,type:Ex,min:0,max:11,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"surge.filterCutoff",name:"Cutoff",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"surge.filterReso",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"surge.envAttack",name:"Attack",section:Ix,type:Px,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:3,isAutomatable:!0},{id:"surge.envDecay",name:"Decay",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"surge.envSustain",name:"Sustain",section:Ix,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"surge.envRelease",name:"Release",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:6,isAutomatable:!0},{id:"surge.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],Monique:[{id:"monique.osc1Wave",name:"Osc1 Wave",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:0,isAutomatable:!0},{id:"monique.filter1Cutoff",name:"Cutoff",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"monique.filter1Reso",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"monique.filter1Dist",name:"Distortion",section:Ox,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"monique.envAttack",name:"Attack",section:Ix,type:Px,min:0,max:1,defaultValue:0,unit:"s",formatString:"%.2f",page:0,index:4,isAutomatable:!0},{id:"monique.envRelease",name:"Release",section:Ix,type:Px,min:0,max:1,defaultValue:.3,unit:"s",formatString:"%.2f",page:0,index:5,isAutomatable:!0},{id:"monique.glide",name:"Glide",section:Ax,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"monique.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.7,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],WAM:sw,DrumKit:ew,ChiptuneModule:Jx,CEM3394:[{id:"cem3394.waveSelect",name:"Waveform",section:Ax,type:Tx,min:0,max:7,defaultValue:2,valueStrings:["Off","Tri","Saw","Tri+Saw","Pulse","Tri+Pls","Saw+Pls","All"],page:0,index:0,isAutomatable:!0},{id:"cem3394.pulseWidth",name:"Pulse Wid",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:1,isAutomatable:!0},{id:"cem3394.filterCutoff",name:"Cutoff",section:Ox,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"cem3394.filterReso",name:"Resonance",section:Ox,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"cem3394.modAmount",name:"Filter FM",section:Rx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"cem3394.mixerBalance",name:"Mix Bal",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"cem3394.vcoFreq",name:"VCO Freq",section:Ax,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"cem3394.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],SCSP:tw,MAMEVFX:tw,MAMEDOC:tw,MAMERSA:Zx,MAMESWP30:tw,CZ101:tw,MAMEYMF271:tw,MAMEYMOPQ:tw,MAMEVASynth:Yx,MAMEAICA:Jx,MAMEC352:Jx,MAMEES5503:Jx,MAMEICS2115:Jx,MAMEK054539:Jx,MAMERF5C400:Jx,MAMETR707:ew,MAMESNKWave:aw,MAMEASC:aw,MAMEAstrocade:aw,MAMESN76477:Qx,MAMETIA:aw,MAMETMS36XX:aw,MAMEMSM5232:aw,MAMEMEA8000:[{id:"mea8000.noiseMode",name:"Noise Mode",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"mea8000.f1Index",name:"F1 Formant",section:Ox,type:Ex,min:0,max:7,defaultValue:3,page:0,index:1,isAutomatable:!0},{id:"mea8000.f2Index",name:"F2 Formant",section:Ox,type:Ex,min:0,max:7,defaultValue:4,page:0,index:2,isAutomatable:!0},{id:"mea8000.f3Index",name:"F3 Formant",section:Ox,type:Ex,min:0,max:7,defaultValue:5,page:0,index:3,isAutomatable:!0},{id:"mea8000.bwIndex",name:"Bandwidth",section:Ox,type:Tx,min:0,max:3,defaultValue:0,valueStrings:["Wide","Medium","Narrow","V.Narrow"],page:0,index:4,isAutomatable:!0},{id:"mea8000.amplitude",name:"Amplitude",section:Ax,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"mea8000.interpTime",name:"Interp Time",section:Rx,type:Px,min:.1,max:10,defaultValue:1,formatString:"%.1f",page:0,index:6,isAutomatable:!0},{id:"mea8000.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMESP0250:[{id:"sp0250.vowel",name:"Vowel",section:Ax,type:Tx,min:0,max:7,defaultValue:0,valueStrings:["AH","EE","IH","OH","OO","NN","ZZ","HH"],page:0,index:0,isAutomatable:!0},{id:"sp0250.voiced",name:"Voiced",section:Ax,type:_x,min:0,max:1,defaultValue:1,page:0,index:1,isAutomatable:!0},{id:"sp0250.brightness",name:"Brightness",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"sp0250.filterMix",name:"Filter Mix",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"sp0250.stereoWidth",name:"Stereo Wid",section:Vx,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"sp0250.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0}],MAMETMS5220:[{id:"tms5220.chirpType",name:"Chirp Type",section:Ax,type:Tx,min:0,max:2,defaultValue:0,valueStrings:["TMS5220","TMS5200","TI99"],page:0,index:0,isAutomatable:!0},{id:"tms5220.pitchIndex",name:"Pitch",section:Ax,type:Ex,min:0,max:63,defaultValue:32,page:0,index:1,isAutomatable:!0},{id:"tms5220.energyIndex",name:"Energy",section:Ax,type:Ex,min:0,max:15,defaultValue:10,page:0,index:2,isAutomatable:!0},{id:"tms5220.k1Index",name:"K1 Formant",section:Ox,type:Ex,min:0,max:31,defaultValue:15,page:0,index:3,isAutomatable:!0},{id:"tms5220.k2Index",name:"K2 Formant",section:Ox,type:Ex,min:0,max:31,defaultValue:15,page:0,index:4,isAutomatable:!0},{id:"tms5220.noiseMode",name:"Noise",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"tms5220.brightness",name:"Brightness",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0},{id:"tms5220.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMEUPD931:[{id:"upd931.waveA",name:"Wave A",section:Ax,type:Ex,min:0,max:7,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"upd931.waveB",name:"Wave B",section:Ax,type:Ex,min:0,max:7,defaultValue:1,page:0,index:1,isAutomatable:!0},{id:"upd931.modeA",name:"Mode A",section:Ax,type:Tx,min:0,max:3,defaultValue:0,valueStrings:["Always","Alternate","Attack","Sustain"],page:0,index:2,isAutomatable:!0},{id:"upd931.modeB",name:"Mode B",section:Ax,type:Tx,min:0,max:3,defaultValue:0,valueStrings:["Always","Alternate","Attack","Sustain"],page:0,index:3,isAutomatable:!0},{id:"upd931.mirror",name:"Mirror",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:4,isAutomatable:!0},{id:"upd931.invert",name:"Invert",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:5,isAutomatable:!0},{id:"upd931.keyScaling",name:"Key Scale",section:Rx,type:_x,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"upd931.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMEUPD933:[{id:"upd933.waveform1",name:"Wave 1",section:Ax,type:Tx,min:0,max:7,defaultValue:0,valueStrings:["Saw","Square","Pulse","Silent","DblSine","Saw+Pls","Reso","DblPls"],page:0,index:0,isAutomatable:!0},{id:"upd933.waveform2",name:"Wave 2",section:Ax,type:Tx,min:0,max:7,defaultValue:0,valueStrings:["Saw","Square","Pulse","Silent","DblSine","Saw+Pls","Reso","DblPls"],page:0,index:1,isAutomatable:!0},{id:"upd933.dcwDepth",name:"DCW Depth",section:Ox,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:2,isAutomatable:!0},{id:"upd933.dcaRate",name:"DCA Rate",section:Ix,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:3,isAutomatable:!0},{id:"upd933.dcwRate",name:"DCW Rate",section:Ix,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:4,isAutomatable:!0},{id:"upd933.dcoDepth",name:"Pitch Env",section:Rx,type:Px,min:0,max:1,defaultValue:0,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"upd933.ringMod",name:"Ring Mod",section:Ax,type:_x,min:0,max:1,defaultValue:0,page:0,index:6,isAutomatable:!0},{id:"upd933.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:7,isAutomatable:!0}],MAMEVotrax:[{id:"votrax.phoneme",name:"Phoneme",section:Ax,type:Ex,min:0,max:63,defaultValue:0,page:0,index:0,isAutomatable:!0},{id:"votrax.inflection",name:"Inflection",section:Ax,type:Tx,min:0,max:3,defaultValue:0,valueStrings:["Normal","Rise","Fall","Stress"],page:0,index:1,isAutomatable:!0},{id:"votrax.f1Override",name:"F1 Formant",section:Ox,type:Ex,min:-1,max:15,defaultValue:-1,page:0,index:2,isAutomatable:!0},{id:"votrax.f2Override",name:"F2 Formant",section:Ox,type:Ex,min:-1,max:15,defaultValue:-1,page:0,index:3,isAutomatable:!0},{id:"votrax.f3Override",name:"F3 Formant",section:Ox,type:Ex,min:-1,max:15,defaultValue:-1,page:0,index:4,isAutomatable:!0},{id:"votrax.stereoWidth",name:"Stereo Wid",section:Vx,type:Px,min:0,max:1,defaultValue:.5,unit:"%",formatString:"%.0f%%",page:0,index:5,isAutomatable:!0},{id:"votrax.volume",name:"Volume",section:Vx,type:Px,min:0,max:1,defaultValue:.8,unit:"%",formatString:"%.0f%%",page:0,index:6,isAutomatable:!0}]};function iw(e){return rw[e]||sw}function ow(e){if(e.pdi)return e.pdi;switch(e.type){case _x:return{type:"toggle",style:"power"};case Tx:{const t=e.valueStrings?.length??Math.round(e.max-e.min+1),a=e.name.toLowerCase();let n="menu";return a.includes("wave")||a.includes("osc type")||a.includes("waveform")?n="waveform":a.includes("filter")&&(a.includes("mode")||a.includes("type"))&&(n="filterType"),{type:"discrete",style:n,value_count:t,display_values:e.valueStrings}}case Ex:return{type:e.min<0?"discrete_bipolar":"discrete",style:"value",value_count:Math.round(e.max-e.min+1)};default:return{type:e.min<0?"continuous_bipolar":"continuous",style:"knob"}}}const lw={"tb303.cutoff":"cutoff","tb303.resonance":"resonance","tb303.envMod":"envMod","tb303.decay":"decay","tb303.accent":"accent","tb303.volume":"mixer.volume","dubsiren.oscillator.frequency":"siren.osc.frequency","dubsiren.lfo.rate":"siren.lfo.rate","dubsiren.lfo.depth":"siren.lfo.depth","dubsiren.delay.time":"siren.delay.time","dubsiren.delay.feedback":"siren.delay.feedback","dubsiren.delay.wet":"siren.delay.wet","dubsiren.filter.frequency":"siren.filter.frequency","dubsiren.reverb.wet":"siren.reverb.wet","furnace.algorithm":"furnace.algorithm","furnace.feedback":"furnace.feedback","furnace.op1.level":"furnace.op1TL","furnace.lfoRate":"furnace.fms","v2.osc1.level":"v2.osc1Level","v2.filter1.cutoff":"v2.filter1Cutoff","v2.filter1.resonance":"v2.filter1Reso","v2.envelope.attack":"v2.envAttack","v2.envelope.decay":"v2.envDecay","v2.envelope.sustain":"v2.envSustain","v2.envelope.release":"v2.envRelease","v2.lfo1.depth":"v2.lfo1Depth","synare.oscillator.tune":"synare.tune","synare.oscillator2.mix":"synare.osc2Mix","synare.filter.cutoff":"synare.filterCutoff","synare.filter.resonance":"synare.filterReso","synare.filter.envMod":"synare.filterEnvMod","synare.filter.decay":"synare.filterDecay","synare.sweep.amount":"synare.sweepAmount","synare.sweep.time":"synare.sweepTime","dexed.algorithm":"dexed.algorithm","dexed.feedback":"dexed.feedback","dexed.lfoSpeed":"dexed.lfoSpeed","dexed.lfoPitchModDepth":"dexed.lfoPitchMod","dexed.lfoAmpModDepth":"dexed.lfoAmpMod","dexed.transpose":"dexed.transpose","obxd.filterCutoff":"obxd.filterCutoff","obxd.filterResonance":"obxd.filterReso","obxd.filterEnvAmount":"obxd.filterEnv","obxd.ampAttack":"obxd.ampAttack","obxd.ampDecay":"obxd.ampDecay","obxd.masterVolume":"obxd.volume","obxd.osc1Level":"obxd.osc1Level","obxd.osc2Level":"obxd.osc2Level","spacelaser.laser.startFreq":"spacelaser.startFreq","spacelaser.laser.endFreq":"spacelaser.endFreq","spacelaser.laser.sweepTime":"spacelaser.sweepTime","spacelaser.fm.amount":"spacelaser.fmAmount","spacelaser.fm.ratio":"spacelaser.fmRatio","spacelaser.filter.cutoff":"spacelaser.filterCutoff","spacelaser.filter.resonance":"spacelaser.filterReso","spacelaser.delay.wet":"spacelaser.delayWet","sam.speed":"sam.speed","sam.pitch":"sam.pitch","sam.mouth":"sam.mouth","sam.throat":"sam.throat","generic.volume":"mixer.volume","generic.pan":"mixer.pan"};function cw(e){return e.engineParam?e.engineParam:lw[e.id]||e.id}function uw(e){return{id:e.id,name:e.name,pdi:ow(e),defaultValue:e.defaultValue,unit:e.unit,ccNumber:e.ccNumber,engineParam:cw(e)}}function dw(e){const t=iw(e),a=t.map(uw),n=function(e){const t=new Map;for(const n of e)!1!==n.isAutomatable&&(t.has(n.page)||t.set(n.page,[]),t.get(n.page).push(n));const a=[];for(const[n,s]of t.entries()){s.sort((e,t)=>e.index-t.index);const e=s.map(e=>e.section),t=new Map;for(const a of e)t.set(a,(t.get(a)||0)+1);let r=e[0],i=0;for(const[a,n]of t.entries())n>i&&(r=a,i=n);a.push({id:`page_${n}`,name:`${r} ${n+1}`,parameters:s})}return a.sort((e,t)=>parseInt(e.id.split("_")[1])-parseInt(t.id.split("_")[1])),a}(t);return{synthType:e,parameters:a,navigation:{performance:n.slice(0,2).map(e=>({name:e.name,parameters:e.parameters.map(uw)})),editGroups:n.length>2?n.slice(2).map(e=>({name:e.name,sections:[{name:e.name,parameters:e.parameters.map(uw)}]})):void 0}}}const pw=new Map;function mw(e){const t=function(e){let t=pw.get(e);return t||(t=dw(e),pw.set(e,t)),t}(e);return t.navigation.performance.flatMap(e=>e.parameters).slice(0,16)}const hw={303:[{cc:70,param:"cutoff",label:"Cutoff"},{cc:71,param:"resonance",label:"Resonance"},{cc:72,param:"envMod",label:"Env Mod"},{cc:73,param:"decay",label:"Decay"},{cc:74,param:"accent",label:"Accent"},{cc:75,param:"overdrive",label:"Drive"},{cc:76,param:"slideTime",label:"Slide"},{cc:77,param:"mixer.volume",label:"Volume"}],Siren:[{cc:70,param:"siren.osc.frequency",label:"Osc Freq"},{cc:71,param:"siren.lfo.rate",label:"LFO Rate"},{cc:72,param:"siren.lfo.depth",label:"LFO Depth"},{cc:73,param:"siren.delay.time",label:"Delay Time"},{cc:74,param:"siren.delay.feedback",label:"Feedback"},{cc:75,param:"siren.delay.wet",label:"Delay Mix"},{cc:76,param:"siren.filter.frequency",label:"Filter"},{cc:77,param:"siren.reverb.wet",label:"Reverb"}],Furnace:[{cc:70,param:"furnace.algorithm",label:"Algorithm"},{cc:71,param:"furnace.feedback",label:"Feedback"},{cc:72,param:"furnace.op1TL",label:"Op1 TL"},{cc:73,param:"furnace.op1AR",label:"Op1 AR"},{cc:74,param:"furnace.op1DR",label:"Op1 DR"},{cc:75,param:"furnace.op1SL",label:"Op1 SL"},{cc:76,param:"furnace.op1RR",label:"Op1 RR"},{cc:77,param:"furnace.fms",label:"FM Sens"}],V2:[{cc:70,param:"v2.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"v2.filter1Cutoff",label:"Cutoff"},{cc:72,param:"v2.filter1Reso",label:"Reso"},{cc:73,param:"v2.envAttack",label:"Attack"},{cc:74,param:"v2.envDecay",label:"Decay"},{cc:75,param:"v2.envSustain",label:"Sustain"},{cc:76,param:"v2.envRelease",label:"Release"},{cc:77,param:"v2.lfo1Depth",label:"LFO Dep"}],Synare:[{cc:70,param:"synare.tune",label:"Tune"},{cc:71,param:"synare.osc2Mix",label:"Osc2 Mix"},{cc:72,param:"synare.filterCutoff",label:"Cutoff"},{cc:73,param:"synare.filterReso",label:"Reso"},{cc:74,param:"synare.filterEnvMod",label:"Env Mod"},{cc:75,param:"synare.filterDecay",label:"Flt Dcy"},{cc:76,param:"synare.sweepAmount",label:"Sweep"},{cc:77,param:"synare.sweepTime",label:"Swp Time"}],Dexed:[{cc:70,param:"dexed.algorithm",label:"Algorithm"},{cc:71,param:"dexed.feedback",label:"Feedback"},{cc:72,param:"dexed.op1Level",label:"Op1 Lvl"},{cc:73,param:"dexed.op1Coarse",label:"Op1 Coarse"},{cc:74,param:"dexed.lfoSpeed",label:"LFO Spd"},{cc:75,param:"dexed.lfoPitchMod",label:"LFO Pitch"},{cc:76,param:"dexed.lfoAmpMod",label:"LFO Amp"},{cc:77,param:"dexed.transpose",label:"Transpose"}],OBXd:[{cc:70,param:"obxd.osc1Level",label:"Osc1 Lvl"},{cc:71,param:"obxd.osc2Level",label:"Osc2 Lvl"},{cc:72,param:"obxd.filterCutoff",label:"Cutoff"},{cc:73,param:"obxd.filterReso",label:"Reso"},{cc:74,param:"obxd.filterEnv",label:"Flt Env"},{cc:75,param:"obxd.ampAttack",label:"Attack"},{cc:76,param:"obxd.ampDecay",label:"Decay"},{cc:77,param:"obxd.volume",label:"Volume"}],SpaceLaser:[{cc:70,param:"spacelaser.startFreq",label:"Start Hz"},{cc:71,param:"spacelaser.endFreq",label:"End Hz"},{cc:72,param:"spacelaser.sweepTime",label:"Sweep"},{cc:73,param:"spacelaser.fmAmount",label:"FM Amt"},{cc:74,param:"spacelaser.fmRatio",label:"FM Ratio"},{cc:75,param:"spacelaser.filterCutoff",label:"Cutoff"},{cc:76,param:"spacelaser.filterReso",label:"Reso"},{cc:77,param:"spacelaser.delayWet",label:"Delay"}],SAM:[{cc:70,param:"sam.pitch",label:"Pitch"},{cc:71,param:"sam.speed",label:"Speed"},{cc:72,param:"sam.mouth",label:"Mouth"},{cc:73,param:"sam.throat",label:"Throat"},{cc:74,param:"mixer.volume",label:"Volume"},{cc:75,param:"mixer.volume",label:"-"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],Organ:[{cc:70,param:"organ.drawbar16",label:"16'"},{cc:71,param:"organ.drawbar8",label:"8'"},{cc:72,param:"organ.drawbar4",label:"4'"},{cc:73,param:"organ.percussion",label:"Perc"},{cc:74,param:"organ.vibratoType",label:"Vib Type"},{cc:75,param:"organ.vibratoDepth",label:"Vib Dep"},{cc:76,param:"organ.overdrive",label:"Drive"},{cc:77,param:"organ.volume",label:"Volume"}],Melodica:[{cc:70,param:"melodica.breath",label:"Breath"},{cc:71,param:"melodica.brightness",label:"Bright"},{cc:72,param:"melodica.vibratoRate",label:"Vib Rate"},{cc:73,param:"melodica.vibratoDepth",label:"Vib Dep"},{cc:74,param:"melodica.detune",label:"Detune"},{cc:75,param:"melodica.portamento",label:"Porta"},{cc:76,param:"melodica.attack",label:"Attack"},{cc:77,param:"melodica.volume",label:"Volume"}],FX:[{cc:70,param:"echo.rate",label:"Echo Rate"},{cc:71,param:"echo.intensity",label:"Intensity"},{cc:72,param:"echo.echoVolume",label:"Echo Vol"},{cc:73,param:"echo.reverbVolume",label:"Rev Vol"},{cc:74,param:"echo.mode",label:"Echo Mode"},{cc:75,param:"biphase.rateA",label:"Phase A"},{cc:76,param:"biphase.feedback",label:"Phase FB"},{cc:77,param:"biphase.routing",label:"Routing"}],Mixer:[{cc:70,param:"mixer.volume",label:"Vol 1"},{cc:71,param:"mixer.volume",label:"Vol 2"},{cc:72,param:"mixer.volume",label:"Vol 3"},{cc:73,param:"mixer.volume",label:"Vol 4"},{cc:74,param:"mixer.pan",label:"Pan 1"},{cc:75,param:"mixer.pan",label:"Pan 2"},{cc:76,param:"mixer.pan",label:"Pan 3"},{cc:77,param:"mixer.pan",label:"Pan 4"}]},fw=[hw[303],[{cc:70,param:"passbandCompensation",label:"Bass"},{cc:71,param:"resTracking",label:"Rez"},{cc:72,param:"filterInputDrive",label:"Satur"},{cc:73,param:"diodeCharacter",label:"Bite"},{cc:74,param:"duffingAmount",label:"Tensn"},{cc:75,param:"filterFmDepth",label:"F.FM"},{cc:76,param:"lpBpMix",label:"LP/BP"},{cc:77,param:"filterTracking",label:"K.Trk"}],[{cc:70,param:"normalDecay",label:"N.Dec"},{cc:71,param:"accentDecay",label:"A.Dec"},{cc:72,param:"softAttack",label:"S.Atk"},{cc:73,param:"accentSoftAttack",label:"A.Atk"},{cc:74,param:"slideTime",label:"Slide"},{cc:75,param:"stageNLAmount",label:"StgNL"},{cc:76,param:"ensembleAmount",label:"Ensem"},{cc:77,param:"overdrive",label:"Drive"}],[{cc:70,param:"korgBite",label:"Bite"},{cc:71,param:"korgClip",label:"Clip"},{cc:72,param:"korgCrossmod",label:"XMod"},{cc:73,param:"korgQSag",label:"Q.Sag"},{cc:74,param:"korgSharpness",label:"Sharp"},{cc:75,param:"mixer.volume",label:"-"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],[{cc:70,param:"lfoRate",label:"Rate"},{cc:71,param:"lfoContour",label:"Contour"},{cc:72,param:"lfoPitchDepth",label:"Pitch"},{cc:73,param:"lfoPwmDepth",label:"PWM"},{cc:74,param:"lfoFilterDepth",label:"Filter"},{cc:75,param:"lfoStiffDepth",label:"Stiff"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"-"}],[{cc:70,param:"chorusMix",label:"Chorus"},{cc:71,param:"phaserRate",label:"Ph.Rate"},{cc:72,param:"phaserFeedback",label:"Ph.FB"},{cc:73,param:"phaserMix",label:"Ph.Mix"},{cc:74,param:"delayTime",label:"Dly.T"},{cc:75,param:"delayFeedback",label:"Dly.FB"},{cc:76,param:"delayMix",label:"Dly.Mix"},{cc:77,param:"delaySpread",label:"Spread"}],[{cc:70,param:"tuning",label:"Tune"},{cc:71,param:"waveform",label:"Wave"},{cc:72,param:"pulseWidth",label:"PWM"},{cc:73,param:"subOscGain",label:"SubG"},{cc:74,param:"subOscBlend",label:"SubB"},{cc:75,param:"pitchToPw",label:"PPW"},{cc:76,param:"mixer.volume",label:"-"},{cc:77,param:"mixer.volume",label:"Volume"}]],yw={303:{x:{param:"cutoff",min:0,max:1,curve:"linear"},y:{param:"resonance",min:0,max:1,curve:"linear"}},Siren:{x:{param:"siren.osc.frequency",min:60,max:1500,curve:"linear"},y:{param:"siren.lfo.rate",min:.1,max:20,curve:"linear"}},Furnace:{x:{param:"furnace.fms",min:0,max:7,curve:"linear"},y:{param:"furnace.op1SL",min:0,max:15,curve:"linear"}},V2:{x:{param:"v2.filter1Cutoff",min:0,max:127,curve:"linear"},y:{param:"v2.filter1Reso",min:0,max:127,curve:"linear"}},Synare:{x:{param:"synare.filterCutoff",min:20,max:2e4,curve:"log"},y:{param:"synare.filterEnvMod",min:0,max:100,curve:"linear"}},Dexed:{x:{param:"dexed.lfoPitchMod",min:0,max:99,curve:"linear"},y:{param:"dexed.lfoAmpMod",min:0,max:99,curve:"linear"}},OBXd:{x:{param:"obxd.filterCutoff",min:0,max:1,curve:"linear"},y:{param:"obxd.filterReso",min:0,max:1,curve:"linear"}},SpaceLaser:{x:{param:"spacelaser.fmAmount",min:0,max:100,curve:"linear"},y:{param:"spacelaser.filterCutoff",min:20,max:2e4,curve:"log"}},SAM:{x:{param:"sam.pitch",min:0,max:255,curve:"linear"},y:{param:"sam.speed",min:0,max:255,curve:"linear"}},Organ:{x:{param:"organ.vibratoDepth",min:0,max:1,curve:"linear"},y:{param:"organ.overdrive",min:0,max:1,curve:"linear"}},Melodica:{x:{param:"melodica.vibratoRate",min:0,max:10,curve:"linear"},y:{param:"melodica.brightness",min:0,max:1,curve:"linear"}}};function gw(e){return"TB303"===e||"Buzz3o3"===e||"Buzz3o3DF"===e?"303":"DubSiren"===e?"Siren":e.startsWith("Furnace")?"Furnace":"V2"===e||"V2Speech"===e?"V2":"Synare"===e?"Synare":"Dexed"===e||"DexedBridge"===e?"Dexed":"OBXd"===e?"OBXd":"SpaceLaser"===e?"SpaceLaser":"Sam"===e?"SAM":"TonewheelOrgan"===e?"Organ":"Melodica"===e?"Melodica":null}function bw(e,t){const a=gw(e);if("303"===a)return t>=0&&t<fw.length?fw[t]:[];if(a)return 0===t?hw[a]:[];const n=mw(e);if(0===n.length)return 0===t?hw.Mixer:[];const s=8*t;return n.slice(s,s+8).map((e,t)=>({cc:70+t,param:e.engineParam,label:e.name.substring(0,10)}))}const vw={cutoff:{type:"config",path:"tb303.filter.cutoff"},resonance:{type:"config",path:"tb303.filter.resonance"},envMod:{type:"config",path:"tb303.filterEnvelope.envMod"},decay:{type:"config",path:"tb303.filterEnvelope.decay"},accent:{type:"config",path:"tb303.accent.amount"},overdrive:{type:"config",path:"tb303.overdrive.amount"},slideTime:{type:"config",path:"tb303.slide.time"},tuning:{type:"config",path:"tb303.tuning",transform:e=>2*e-1},waveform:{type:"config",path:"tb303.oscillator.waveformBlend"},pulseWidth:{type:"config",path:"tb303.oscillator.pulseWidth"},subOscGain:{type:"config",path:"tb303.oscillator.subOscGain"},subOscBlend:{type:"config",path:"tb303.oscillator.subOscBlend"},pitchToPw:{type:"config",path:"tb303.oscillator.pitchToPw"},volume:{type:"config",path:"tb303.volume"},passbandCompensation:{type:"config",path:"tb303.devilFish.passbandCompensation"},resTracking:{type:"config",path:"tb303.devilFish.resTracking"},filterInputDrive:{type:"config",path:"tb303.devilFish.filterInputDrive"},diodeCharacter:{type:"config",path:"tb303.devilFish.diodeCharacter"},duffingAmount:{type:"config",path:"tb303.devilFish.duffingAmount",transform:e=>2*e-1},filterFmDepth:{type:"config",path:"tb303.devilFish.filterFmDepth"},lpBpMix:{type:"config",path:"tb303.devilFish.lpBpMix"},normalDecay:{type:"config",path:"tb303.devilFish.normalDecay"},accentDecay:{type:"config",path:"tb303.devilFish.accentDecay"},softAttack:{type:"config",path:"tb303.devilFish.softAttack"},accentSoftAttack:{type:"config",path:"tb303.devilFish.accentSoftAttack"},filterTracking:{type:"config",path:"tb303.devilFish.filterTracking"},stageNLAmount:{type:"config",path:"tb303.devilFish.stageNLAmount"},ensembleAmount:{type:"config",path:"tb303.devilFish.ensembleAmount"},korgBite:{type:"config",path:"tb303.devilFish.korgBite"},korgClip:{type:"config",path:"tb303.devilFish.korgClip"},korgCrossmod:{type:"config",path:"tb303.devilFish.korgCrossmod"},korgQSag:{type:"config",path:"tb303.devilFish.korgQSag"},korgSharpness:{type:"config",path:"tb303.devilFish.korgSharpness"},lfoRate:{type:"config",path:"tb303.lfo.rate"},lfoContour:{type:"config",path:"tb303.lfo.contour",transform:e=>2*e-1},lfoPitchDepth:{type:"config",path:"tb303.lfo.pitchDepth"},lfoPwmDepth:{type:"config",path:"tb303.lfo.pwmDepth"},lfoFilterDepth:{type:"config",path:"tb303.lfo.filterDepth"},lfoStiffDepth:{type:"config",path:"tb303.lfo.stiffDepth"},chorusMix:{type:"config",path:"tb303.chorus.mix"},phaserRate:{type:"config",path:"tb303.phaser.rate"},phaserWidth:{type:"config",path:"tb303.phaser.depth"},phaserFeedback:{type:"config",path:"tb303.phaser.feedback"},phaserMix:{type:"config",path:"tb303.phaser.mix"},delayTime:{type:"config",path:"tb303.delay.time"},delayFeedback:{type:"config",path:"tb303.delay.feedback"},delayTone:{type:"config",path:"tb303.delay.tone"},delayMix:{type:"config",path:"tb303.delay.mix"},delaySpread:{type:"config",path:"tb303.delay.stereo"},"siren.osc.frequency":{type:"config",path:"dubSiren.oscillator.frequency",transform:e=>60+940*e},"siren.lfo.rate":{type:"config",path:"dubSiren.lfo.rate",transform:e=>.1+19.9*e},"siren.lfo.depth":{type:"config",path:"dubSiren.lfo.depth",transform:e=>500*e},"siren.delay.time":{type:"config",path:"dubSiren.delay.time",transform:e=>.01+.99*e},"siren.delay.feedback":{type:"config",path:"dubSiren.delay.feedback",transform:e=>.95*e},"siren.delay.wet":{type:"config",path:"dubSiren.delay.wet"},"siren.filter.frequency":{type:"config",path:"dubSiren.filter.frequency",transform:e=>20+9980*e},"siren.reverb.wet":{type:"config",path:"dubSiren.reverb.wet"},"furnace.algorithm":{type:"config",path:"furnace.algorithm",transform:e=>Math.round(7*e)},"furnace.feedback":{type:"config",path:"furnace.feedback",transform:e=>Math.round(7*e)},"furnace.op1TL":{type:"config",path:"furnace.operators.0.tl",transform:e=>Math.round(127*e)},"furnace.op1AR":{type:"config",path:"furnace.operators.0.ar",transform:e=>Math.round(31*e)},"furnace.op1DR":{type:"config",path:"furnace.operators.0.dr",transform:e=>Math.round(31*e)},"furnace.op1SL":{type:"config",path:"furnace.operators.0.sl",transform:e=>Math.round(15*e)},"furnace.op1RR":{type:"config",path:"furnace.operators.0.rr",transform:e=>Math.round(15*e)},"furnace.fms":{type:"config",path:"furnace.fms",transform:e=>Math.round(7*e)},"v2.osc1Level":{type:"config",path:"v2.osc1.level",transform:e=>Math.round(127*e)},"v2.filter1Cutoff":{type:"config",path:"v2.filter1.cutoff",transform:e=>Math.round(127*e)},"v2.filter1Reso":{type:"config",path:"v2.filter1.resonance",transform:e=>Math.round(127*e)},"v2.envAttack":{type:"config",path:"v2.envelope.attack",transform:e=>Math.round(127*e)},"v2.envDecay":{type:"config",path:"v2.envelope.decay",transform:e=>Math.round(127*e)},"v2.envSustain":{type:"config",path:"v2.envelope.sustain",transform:e=>Math.round(127*e)},"v2.envRelease":{type:"config",path:"v2.envelope.release",transform:e=>Math.round(127*e)},"v2.lfo1Depth":{type:"config",path:"v2.lfo1.depth",transform:e=>Math.round(127*e)},"synare.tune":{type:"config",path:"synare.oscillator.tune",transform:e=>20+980*e},"synare.osc2Mix":{type:"config",path:"synare.oscillator2.mix"},"synare.filterCutoff":{type:"config",path:"synare.filter.cutoff",transform:e=>20*Math.pow(1e3,e)},"synare.filterReso":{type:"config",path:"synare.filter.resonance",transform:e=>100*e},"synare.filterEnvMod":{type:"config",path:"synare.filter.envMod",transform:e=>100*e},"synare.filterDecay":{type:"config",path:"synare.filter.decay",transform:e=>10+1990*e},"synare.sweepAmount":{type:"config",path:"synare.sweep.amount",transform:e=>48*e},"synare.sweepTime":{type:"config",path:"synare.sweep.time",transform:e=>5+495*e},"dexed.algorithm":{type:"config",path:"dexed.algorithm",transform:e=>Math.round(31*e)},"dexed.feedback":{type:"config",path:"dexed.feedback",transform:e=>Math.round(7*e)},"dexed.op1Level":{type:"config",path:"dexed.operators.0.level",transform:e=>Math.round(99*e)},"dexed.op1Coarse":{type:"config",path:"dexed.operators.0.coarse",transform:e=>Math.round(31*e)},"dexed.lfoSpeed":{type:"config",path:"dexed.lfoSpeed",transform:e=>Math.round(99*e)},"dexed.lfoPitchMod":{type:"config",path:"dexed.lfoPitchModDepth",transform:e=>Math.round(99*e)},"dexed.lfoAmpMod":{type:"config",path:"dexed.lfoAmpModDepth",transform:e=>Math.round(99*e)},"dexed.transpose":{type:"config",path:"dexed.transpose",transform:e=>Math.round(48*e-24)},"obxd.osc1Level":{type:"config",path:"obxd.osc1Level"},"obxd.osc2Level":{type:"config",path:"obxd.osc2Level"},"obxd.filterCutoff":{type:"config",path:"obxd.filterCutoff"},"obxd.filterReso":{type:"config",path:"obxd.filterResonance"},"obxd.filterEnv":{type:"config",path:"obxd.filterEnvAmount"},"obxd.ampAttack":{type:"config",path:"obxd.ampAttack"},"obxd.ampDecay":{type:"config",path:"obxd.ampDecay"},"obxd.volume":{type:"config",path:"obxd.masterVolume"},"spacelaser.startFreq":{type:"config",path:"spaceLaser.laser.startFreq",transform:e=>100+9900*e},"spacelaser.endFreq":{type:"config",path:"spaceLaser.laser.endFreq",transform:e=>20+4980*e},"spacelaser.sweepTime":{type:"config",path:"spaceLaser.laser.sweepTime",transform:e=>10+2990*e},"spacelaser.fmAmount":{type:"config",path:"spaceLaser.fm.amount",transform:e=>100*e},"spacelaser.fmRatio":{type:"config",path:"spaceLaser.fm.ratio",transform:e=>.5+15.5*e},"spacelaser.filterCutoff":{type:"config",path:"spaceLaser.filter.cutoff",transform:e=>20*Math.pow(1e3,e)},"spacelaser.filterReso":{type:"config",path:"spaceLaser.filter.resonance",transform:e=>100*e},"spacelaser.delayWet":{type:"config",path:"spaceLaser.delay.wet"},"sam.pitch":{type:"config",path:"sam.pitch",transform:e=>Math.round(255*e)},"sam.speed":{type:"config",path:"sam.speed",transform:e=>Math.round(255*e)},"sam.mouth":{type:"config",path:"sam.mouth",transform:e=>Math.round(255*e)},"sam.throat":{type:"config",path:"sam.throat",transform:e=>Math.round(255*e)},"organ.drawbar16":{type:"vstbridge",paramId:0,transform:e=>8*e},"organ.drawbar8":{type:"vstbridge",paramId:2,transform:e=>8*e},"organ.drawbar4":{type:"vstbridge",paramId:3,transform:e=>8*e},"organ.percussion":{type:"vstbridge",paramId:9},"organ.vibratoType":{type:"vstbridge",paramId:13,transform:e=>Math.round(5*e)},"organ.vibratoDepth":{type:"vstbridge",paramId:14},"organ.overdrive":{type:"vstbridge",paramId:15},"organ.volume":{type:"vstbridge",paramId:16},"melodica.breath":{type:"vstbridge",paramId:0},"melodica.brightness":{type:"vstbridge",paramId:1},"melodica.vibratoRate":{type:"vstbridge",paramId:2,transform:e=>10*e},"melodica.vibratoDepth":{type:"vstbridge",paramId:3},"melodica.detune":{type:"vstbridge",paramId:4,transform:e=>100*e-50},"melodica.portamento":{type:"vstbridge",paramId:6},"melodica.attack":{type:"vstbridge",paramId:7},"melodica.volume":{type:"vstbridge",paramId:9},"echo.rate":{type:"effect",effectType:"SpaceEcho",param:"rate",transform:e=>50+950*e},"echo.intensity":{type:"effect",effectType:"SpaceEcho",param:"intensity",transform:e=>1.2*e},"echo.echoVolume":{type:"effect",effectType:"SpaceEcho",param:"echoVolume"},"echo.reverbVolume":{type:"effect",effectType:"SpaceEcho",param:"reverbVolume"},"echo.mode":{type:"effect",effectType:"SpaceEcho",param:"mode",transform:e=>Math.floor(1+11*e)},"biphase.rateA":{type:"effect",effectType:"BiPhase",param:"rateA",transform:e=>.1+9.9*e},"biphase.feedback":{type:"effect",effectType:"BiPhase",param:"feedback",transform:e=>.95*e},"biphase.routing":{type:"effect",effectType:"BiPhase",param:"routing",transform:e=>e>.5?1:0},"mixer.volume":{type:"config",path:"volume",transform:e=>60*e-60},"mixer.pan":{type:"config",path:"pan",transform:e=>200*e-100}};const xw=new Map;let ww=!1;function kw(){ww=!1;const e=Bv.getState();for(const[t,a]of xw)e.updateInstrument(t,a);xw.clear()}function Sw(e,t){const a=xw.get(e);a?Mw(a,t):xw.set(e,t),ww||(ww=!0,requestAnimationFrame(kw))}function Mw(e,t){for(const a of Object.keys(t)){const n=t[a],s=e[a];"object"!=typeof n||null===n||Array.isArray(n)||"object"!=typeof s||null===s||Array.isArray(s)?e[a]=n:(Object.isFrozen(s)&&(e[a]={...s}),Mw(e[a],n))}}function Nw(e,t,a){const n=vw[e];if(!n)return;const s=Bv.getState(),r=s.currentInstrumentId,i=s.instruments.find(e=>e.id===r);if(!i)return;const o=n.transform?n.transform(t):t;switch(n.type){case"config":{!function(e,t,a){try{Qg().instruments.forEach((n,s)=>{const[r]=s.split("-"),i=n;r===String(e)&&"function"==typeof i.set&&i.set(t,a)})}catch{}}(i.id,e,o);const t=function(e,t,a){const n=e.split(".");if(1===n.length)return{[n[0]]:t};const s=n[0],r=a[s]||{};if(2===n.length)return{[s]:{...r,[n[1]]:t}};if(3===n.length){const e=n[1],a=n[2],i=r[e]||{};return{[s]:{...r,[e]:{...i,[a]:t}}}}if(4===n.length&&/^\d+$/.test(n[2])){const e=n[1],a=parseInt(n[2]),i=n[3],o=r[e],l=Array.isArray(o)?[...o]:[];return l[a]={...l[a],[i]:t},{[s]:{...r,[e]:l}}}return function e(a,s){if(a===n.length-1)return t;const r=n[a],i=n[a+1];if(/^\d+$/.test(i)){const o=parseInt(i),l=s?.[r],c=Array.isArray(l)?[...l]:[],u=c[o]?{...c[o]}:{},d=n[a+2];return void 0!==d&&(u[d]=e(a+3,u),a+3>=n.length&&(u[d]=t)),c[o]=u,{...s,[r]:c}}const o=s?.[r]||{},l=e(a+1,o);return a+1===n.length-1?{...s,[r]:{...o,[n[a+1]]:l}}:{...s,[r]:l}}(0,a)}(n.path,o,i);Sw(i.id,t);break}case"vstbridge":{const e=function(e){const t=`${e}--1`;return Qg().instruments.get(t)}(i.id);e&&"object"==typeof e&&"setParameter"in e&&e.setParameter(n.paramId,o);break}case"effect":{const e=i.effects.find(e=>e.type===n.effectType);e&&s.updateEffect(i.id,e.id,{parameters:{...e.parameters,[n.param]:o}});break}}}const Cw=[240,71,127],Pw=100,Ew=[{mode:85,cc:86,min:87,max:88,name:89},{mode:105,cc:106,min:107,max:108,name:109},{mode:125,cc:126,min:127,max:128,name:129},{mode:145,cc:146,min:147,max:148,name:149},{mode:165,cc:166,min:167,max:168,name:169},{mode:185,cc:186,min:187,max:188,name:189},{mode:205,cc:206,min:207,max:208,name:209},{mode:225,cc:226,min:227,max:228,name:229}];let _w=null;let Tw=null;function Aw(){if(Tw)return Tw;const e=new Uint8Array(246);e[0]=0,Ow(e,1,"DEViLBOX        ",16),e[17]=0,e[18]=0,e[19]=0,e[20]=4;for(let t=0;t<8;t++){const a=Ew[t];e[a.mode]=0,e[a.cc]=70+t,e[a.min]=0,e[a.max]=127,Ow(e,a.name,`Knob ${t+1}`,16)}return Tw=e,e}function Ow(e,t,a,n){for(let s=0;s<n;s++)e[t+s]=s<a.length?Math.min(127,a.charCodeAt(s)):32}async function Iw(e){const t=await async function(){if(_w&&"connected"===_w.state)return _w;if(!Gw.getState().outputDevices.some(e=>e.name?.includes("MPK mini")))return _w=null,null;try{const e=await navigator.requestMIDIAccess({sysex:!0}),t=Array.from(e.outputs.values()).find(e=>e.name?.includes("MPK mini"));return _w=t??null,_w}catch(e){return _w=null,null}}();if(!t)return;const a=e.length>>7&127,n=127&e.length,s=new Uint8Array([...Cw,73,Pw,a,n,...e,247]);t.send(s)}async function Fw(e,t){const a=Aw();Ow(a,1,e.substring(0,8).padEnd(8)+t.substring(0,8).padEnd(8),16);try{await Iw(a)}catch(n){}}function Dw(e,t,a,n){const s=Aw(),r=a>1?` ${t+1}/${a}`:"",i=16-r.length;Ow(s,1,e.substring(0,i)+r,16);for(let o=0;o<8;o++){const e=n[o],t=Ew[o];if(e){const a=(e.name||e.id).replace(/Cutoff/i,"Cut").replace(/Resonance/i,"Res").replace(/Attack/i,"Atk").replace(/Decay/i,"Dec").replace(/Sustain/i,"Sus").replace(/Release/i,"Rel").replace(/Volume/i,"Vol").replace(/Feedback/i,"Fdb").replace(/Frequency/i,"Frq").replace(/Algorithm/i,"Alg").replace(/Overdrive/i,"OD").replace(/Waveform/i,"Wav");Ow(s,t.name,a,16)}else Ow(s,t.name,`Knob ${o+1}`,16)}Iw(s).catch(()=>{})}let Rw=!1;const jw=(e,t)=>{Nw(e,t/127)};function Bw(e,t){return`${e}:${t}`}function Lw(e,t,a,n){return t+function(e,t="linear"){const a=Math.max(0,Math.min(127,e))/127;switch(t){case"exponential":return Math.pow(a,2);case"logarithmic":return Math.sqrt(a);default:return a}}(e,n)*(a-t)}const Vw=[{ccNumber:74,parameter:"cutoff",min:200,max:2e4,curve:"logarithmic"},{ccNumber:71,parameter:"resonance",min:0,max:100,curve:"linear"},{ccNumber:10,parameter:"envMod",min:0,max:100,curve:"linear"},{ccNumber:75,parameter:"decay",min:30,max:3e3,curve:"logarithmic"},{ccNumber:16,parameter:"accent",min:0,max:100,curve:"linear"}],zw=new Map,Uw=new Map,Gw=n()(Wg(Ga((e,t)=>({isSupported:null,isInitialized:!1,lastError:null,inputDevices:[],outputDevices:[],selectedInputId:null,selectedOutputId:null,ccMappings:[...Vw],isLearning:!1,learningParameter:null,lastActivityTimestamp:0,controlledInstrumentId:null,knobBank:"303",padBank:"A",nksKnobAssignments:[],nksKnobPage:0,nksKnobTotalPages:0,nksActiveSynthType:null,midiOctaveOffset:0,showPatternDialog:!1,showKnobBar:!1,midiOutputEnabled:!0,init:async()=>{const a=gx();if(!a.isSupported())return e(e=>{e.isSupported=!1,e.lastError="Web MIDI API not supported in this browser"}),!1;e(e=>{e.isSupported=!0});try{if(await a.init()){Rw||(Rw=!0,a.addMessageHandler(e=>{const a=t();if(a.updateActivity(),"noteOn"===e.type&&void 0!==e.note&&void 0!==e.velocity){if(Sx().getMapping(e.channel,e.note))return;if(36===e.note)return void a.setKnobBank("303");if(37===e.note)return void a.setKnobBank("Siren");if(38===e.note)return void a.setKnobBank("FX");if(39===e.note)return void a.setKnobBank("Mixer");if(40===e.note)return void a.prevKnobPage();if(41===e.note)return void a.nextKnobPage();const t=a.midiOctaveOffset||0,n=Cx(e.note+12*t).replace("-",""),s=Bv.getState(),r=s.currentInstrumentId,i=s.instruments.find(e=>e.id===r),o=s.previewInstrument||i||s.instruments[0];if(o){const t=gw(o.synthType);t&&a.knobBank!==t&&a.setKnobBank(t),a.nksActiveSynthType!==o.synthType&&a.syncKnobsToSynth(o.synthType);const s=Qg(),{midiPolyphonic:r}=Hg.getState(),i=e.velocity/127,l=Math.max(.5,Math.sqrt(i));if(Uw.set(e.note,n),r)s.triggerPolyNoteAttack(o.id,n,l,o);else{if(Uw.size>1){for(const[a,n]of Uw.entries())a!==e.note&&s.triggerPolyNoteRelease(o.id,n,o);const t=Uw.get(e.note);Uw.clear(),t&&Uw.set(e.note,t)}s.triggerPolyNoteAttack(o.id,n,l,o)}}return}if("noteOff"===e.type&&void 0!==e.note){if(Sx().getMapping(e.channel,e.note))return;const t=Uw.get(e.note);if(t){Uw.delete(e.note);const a=Bv.getState(),n=a.currentInstrumentId,s=a.instruments.find(e=>e.id===n),r=a.previewInstrument||s||a.instruments[0];if(r){Qg().triggerPolyNoteRelease(r.id,t,r)}}return}if("pitchBend"===e.type&&void 0!==e.pitchBend){const t=yw[a.knobBank];if(t?.x){const a=Math.round((e.pitchBend+8192)/16383*127);jw(t.x.param,a)}return}if("cc"===e.type&&void 0!==e.cc&&void 0!==e.value){if(1===e.cc){const t=yw[a.knobBank];t?.y&&jw(t.y.param,e.value)}if(a.isLearning&&a.learningParameter)return void a.handleLearnedCC(e.cc);if(e.cc>=70&&e.cc<=77){const t=e.cc-70,n=a.nksKnobAssignments[t];if(n)return void jw(n.param,e.value);const s=hw[a.knobBank].find(t=>t.cc===e.cc);if(s)return void jw(s.param,e.value)}const t=a.ccMappings.find(t=>t.ccNumber===e.cc);if(t){const a=e.value/127;let n;if("logarithmic"===t.curve){const e=Math.max(1,t.min),s=Math.max(e+1,t.max),r=Math.log(e),i=Math.log(s);n=Math.exp(r+a*(i-r))}else n=t.min+a*(t.max-t.min);const s=zw.get(t.parameter);s&&s(n)}}})),a.onDeviceChange(()=>{t().refreshDevices();const a=t();!a.selectedInputId&&a.inputDevices.length>0&&t().selectInput(a.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0})}),t().refreshDevices();const n=t();!n.selectedInputId&&n.inputDevices.length>0&&await t().selectInput(n.inputDevices[0].id),e(e=>{e.showKnobBar=e.inputDevices.length>0});vx().init();return wx().init(),e(e=>{e.isInitialized=!0,e.lastError=null}),!0}return e(e=>{e.lastError="Failed to initialize MIDI access"}),!1}catch(n){return e(e=>{e.lastError=n instanceof Error?n.message:"Unknown error"}),!1}},refreshDevices:()=>{const t=gx();e(e=>{e.inputDevices=t.getInputDevices(),e.outputDevices=t.getOutputDevices();const a=t.getSelectedInput(),n=t.getSelectedOutput();e.selectedInputId=a?.id||null,e.selectedOutputId=n?.id||null})},selectInput:async t=>{const a=gx();await a.selectInput(t),e(e=>{e.selectedInputId=t})},selectOutput:t=>{gx().selectOutput(t),e(e=>{e.selectedOutputId=t})},setMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t.ccNumber&&e.parameter!==t.parameter),e.ccMappings.push(t)})},removeMapping:t=>{e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==t)})},resetMappings:()=>{e(e=>{e.ccMappings=[...Vw]})},startLearn:t=>{e(e=>{e.isLearning=!0,e.learningParameter=t})},cancelLearn:()=>{e(e=>{e.isLearning=!1,e.learningParameter=null})},handleLearnedCC:a=>{const{learningParameter:n}=t();if(!n)return;const s=Vw.find(e=>e.parameter===n),r=s?{...s,ccNumber:a}:{ccNumber:a,parameter:n,min:0,max:100,curve:"linear"};e(e=>{e.ccMappings=e.ccMappings.filter(e=>e.ccNumber!==a&&e.parameter!==n),e.ccMappings.push(r),e.isLearning=!1,e.learningParameter=null})},updateActivity:()=>{const a=Date.now(),n=t().lastActivityTimestamp;a-n>100&&e(e=>{e.lastActivityTimestamp=a})},openPatternDialog:()=>{e(e=>{e.showPatternDialog=!0})},closePatternDialog:()=>{e(e=>{e.showPatternDialog=!1})},registerCCHandler:(e,t)=>{zw.set(e,t)},unregisterCCHandler:e=>{zw.delete(e)},setControlledInstrument:t=>{e(e=>{e.controlledInstrumentId=t})},setKnobBank:t=>e(e=>{e.knobBank=t}),togglePadBank:()=>e(e=>{e.padBank="A"===e.padBank?"B":"A"}),setPadBank:t=>e(e=>{e.padBank=t}),syncKnobsToSynth:t=>{const a=bw(t,0),n=function(e){const t=gw(e);if("303"===t)return fw.length;if(t)return 1;const a=mw(e);return 0===a.length?1:Math.ceil(a.length/8)}(t);e(e=>{e.nksKnobAssignments=a,e.nksKnobPage=0,e.nksKnobTotalPages=n,e.nksActiveSynthType=t});const s=a.map(e=>({id:e.param,name:e.label}));Dw(t,0,n,s)},nextKnobPage:()=>{const{nksActiveSynthType:a,nksKnobPage:n,nksKnobTotalPages:s}=t();if(!a||s<=1)return;const r=(n+1)%s,i=bw(a,r);e(e=>{e.nksKnobAssignments=i,e.nksKnobPage=r});const o=i.map(e=>({id:e.param,name:e.label}));Dw(a,r,s,o)},prevKnobPage:()=>{const{nksActiveSynthType:a,nksKnobPage:n,nksKnobTotalPages:s}=t();if(!a||s<=1)return;const r=(n-1+s)%s,i=bw(a,r);e(e=>{e.nksKnobAssignments=i,e.nksKnobPage=r});const o=i.map(e=>({id:e.param,name:e.label}));Dw(a,r,s,o)},setKnobPage:a=>{const{nksActiveSynthType:n,nksKnobTotalPages:s}=t();if(!n||a<0||a>=s)return;const r=bw(n,a);e(e=>{e.nksKnobAssignments=r,e.nksKnobPage=a});const i=r.map(e=>({id:e.param,name:e.label}));Dw(n,a,s,i)},setShowKnobBar:t=>{e(e=>{e.showKnobBar=t})},sendCC:(e,a,n=0)=>{const{midiOutputEnabled:s}=t();if(!s)return;const r=gx(),i=Math.max(0,Math.min(127,Math.round(a)));r.sendCC(n,e,i)},setMidiOutputEnabled:t=>{e(e=>{e.midiOutputEnabled=t})},setMidiOctaveOffset:t=>{e(e=>{e.midiOctaveOffset=Math.max(-4,Math.min(4,t))})},gridMappings:{},gridIsLearning:!1,gridLearningParameter:null,addGridMapping:t=>{t.channel<0||t.channel>15||t.controller<0||t.controller>127||t.min>t.max||e(e=>{const a=Bw(t.channel,t.controller);e.gridMappings[a]=t})},removeGridMapping:(t,a)=>{e(e=>{const n=Bw(t,a);delete e.gridMappings[n]})},getGridMapping:(e,a)=>{const n=Bw(e,a);return t().gridMappings[n]},clearGridMappings:()=>{e(e=>{e.gridMappings={}})},startGridLearning:a=>{t().gridIsLearning||e(e=>{e.gridIsLearning=!0,e.gridLearningParameter=a})},stopGridLearning:()=>{e(e=>{e.gridIsLearning=!1,e.gridLearningParameter=null})},applyGridMIDIValue:(e,a,n)=>{const s=t().getGridMapping(e,a);return s?Lw(n,s.min,s.max,s.curve):null}})),{name:"midi-settings",partialize:e=>({ccMappings:e.ccMappings,selectedInputId:e.selectedInputId,selectedOutputId:e.selectedOutputId,controlledInstrumentId:e.controlledInstrumentId,knobBank:e.knobBank,showKnobBar:e.showKnobBar,midiOutputEnabled:e.midiOutputEnabled,midiOctaveOffset:e.midiOctaveOffset,gridMappings:e.gridMappings})}));Bv.subscribe((e,t)=>{if(e.currentInstrumentId!==t.currentInstrumentId){const t=e.instruments.find(t=>t.id===e.currentInstrumentId);if(!t)return;const a=Gw.getState(),n=gw(t.synthType);n&&a.knobBank!==n&&a.setKnobBank(n),a.nksActiveSynthType!==t.synthType&&a.syncKnobsToSynth(t.synthType)}});const Ww=n(e=>({activeNotes:new Map,adsrStages:new Map,adsrProgress:new Map,lfoPhases:new Map,samplePositions:new Map,setActiveNote:(t,a)=>{e(e=>{const n=new Map(e.activeNotes),s=n.get(t)||[],r=s.findIndex(e=>e.note===a.note);return r>=0?s[r]=a:s.push(a),n.set(t,s),{activeNotes:n}})},clearActiveNote:(t,a)=>{e(e=>{const n=new Map(e.activeNotes),s=(n.get(t)||[]).filter(e=>e.note!==a);return 0===s.length?n.delete(t):n.set(t,s),{activeNotes:n}})},clearChannelNotes:t=>{e(e=>{const a=new Map(e.activeNotes);return a.delete(t),{activeNotes:a}})},clearAllNotes:()=>{e({activeNotes:new Map})},setADSRStage:(t,a,n=0)=>{e(e=>{const s=new Map(e.adsrStages),r=new Map(e.adsrProgress);return s.set(t,a),r.set(t,n),{adsrStages:s,adsrProgress:r}})},setADSRProgress:(t,a)=>{e(e=>{const n=new Map(e.adsrProgress);return n.set(t,a),{adsrProgress:n}})},setLFOPhase:(t,a)=>{e(e=>{const n=new Map(e.lfoPhases);return n.set(t,a),{lfoPhases:n}})},setSamplePosition:(t,a)=>{e(e=>{const n=new Map(e.samplePositions);return n.set(t,Math.max(0,Math.min(1,a))),{samplePositions:n}})},clearSamplePosition:t=>{e(e=>{const a=new Map(e.samplePositions);return a.delete(t),{samplePositions:a}})}})),Hw=n()(Ga((e,t)=>({isLiveMode:!1,pendingPatternIndex:null,pendingPositionIndex:null,queueMode:"end-of-pattern",channelQueues:new Map,showQueueCountdown:!0,barsUntilSwitch:0,toggleLiveMode:()=>{const a=!t().isLiveMode;e(e=>{e.isLiveMode=a,a||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues=new Map)})},setLiveMode:t=>{e(e=>{e.isLiveMode=t,t||(e.pendingPatternIndex=null,e.pendingPositionIndex=null,e.channelQueues.clear())})},queuePattern:t=>{e(e=>{e.pendingPatternIndex=t})},queuePosition:t=>{e(e=>{e.pendingPositionIndex=t})},clearQueue:()=>{e(e=>{e.pendingPatternIndex=null,e.pendingPositionIndex=null})},setQueueMode:t=>{e(e=>{e.queueMode=t})},queueChannelAction:(t,a)=>{e(e=>{const n=e.channelQueues.get(t)||[];n.push(a),e.channelQueues.set(t,n)})},clearChannelQueue:t=>{e(e=>{e.channelQueues.delete(t)})},popChannelAction:a=>{const n=t().channelQueues.get(a);if(!n||0===n.length)return;const s=n.shift();return e(e=>{0===n.length?e.channelQueues.delete(a):e.channelQueues.set(a,n)}),s},updateBarsUntilSwitch:t=>{e(e=>{e.barsUntilSwitch=t})},setShowQueueCountdown:t=>{e(e=>{e.showQueueCountdown=t})}}))),Kw={horizontalZoom:16,verticalZoom:12,scrollX:0,scrollY:0,snapToGrid:!0,gridDivision:4,showVelocity:!0,showVelocityLane:!1,channelIndex:0,multiChannel:!1,scaleKey:"chromatic",scaleRoot:0,noteLengthPreset:0},qw={notes:new Set,startRow:null,endRow:null,startNote:null,endNote:null},$w=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Xw(e){const t=Math.floor(e/12)-1;return`${$w[e%12]}${t}`}function Yw(e){return[1,3,6,8,10].includes(e%12)}const Zw=[{label:"Grid",value:0},{label:"1/32",value:1},{label:"1/16",value:2},{label:"1/8",value:4},{label:"1/4",value:8},{label:"1/2",value:16},{label:"1/1",value:32}],Qw=n()(Ga((e,t)=>({view:{...Kw},selection:{...qw,notes:new Set},drag:{isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},tool:"select",clipboard:null,contextMenu:{visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},ghostNotes:[],setHorizontalZoom:t=>e(e=>{e.view.horizontalZoom=Math.max(4,Math.min(64,t))}),setVerticalZoom:t=>e(e=>{e.view.verticalZoom=Math.max(8,Math.min(32,t))}),setScroll:(t,a)=>e(e=>{e.view.scrollX=Math.max(0,t),e.view.scrollY=Math.max(0,Math.min(127,a))}),scrollBy:(t,a)=>e(e=>{e.view.scrollX=Math.max(0,e.view.scrollX+t),e.view.scrollY=Math.max(0,Math.min(127,e.view.scrollY+a))}),setSnapToGrid:t=>e(e=>{e.view.snapToGrid=t}),setGridDivision:t=>e(e=>{e.view.gridDivision=t}),setShowVelocity:t=>e(e=>{e.view.showVelocity=t}),setShowVelocityLane:t=>e(e=>{e.view.showVelocityLane=t}),setChannelIndex:t=>e(e=>{e.view.channelIndex=t}),setMultiChannel:t=>e(e=>{e.view.multiChannel=t}),setScaleKey:t=>e(e=>{e.view.scaleKey=t}),setScaleRoot:t=>e(e=>{e.view.scaleRoot=Math.max(0,Math.min(11,t))}),setNoteLengthPreset:t=>e(e=>{e.view.noteLengthPreset=t}),selectNote:(t,a=!1)=>e(e=>{a?e.selection.notes.add(t):e.selection.notes=new Set([t])}),selectNotes:t=>e(e=>{e.selection.notes=new Set(t)}),selectAll:t=>e(e=>{e.selection.notes=new Set(t)}),deselectNote:t=>e(e=>{e.selection.notes.delete(t)}),clearSelection:()=>e(e=>{e.selection.notes=new Set,e.selection.startRow=null,e.selection.endRow=null,e.selection.startNote=null,e.selection.endNote=null}),setSelectionBox:(t,a,n,s)=>e(e=>{e.selection.startRow=t,e.selection.endRow=a,e.selection.startNote=n,e.selection.endNote=s}),startDrag:(t,a,n,s)=>e(e=>{e.drag.isDragging=!0,e.drag.mode=t,e.drag.startX=a,e.drag.startY=n,e.drag.currentX=a,e.drag.currentY=n,e.drag.noteId=s||null}),updateDrag:(t,a)=>e(e=>{e.drag.currentX=t,e.drag.currentY=a}),endDrag:()=>e(e=>{e.drag.isDragging=!1,e.drag.mode="none",e.drag.noteId=null,e.drag.originalNotes=[],e.ghostNotes=[]}),setTool:t=>e(e=>{e.tool=t}),copyNotes:t=>e(e=>{if(0===t.length)return;const a=Math.min(...t.map(e=>e.startRow)),n=Math.min(...t.map(e=>e.midiNote));e.clipboard={notes:t.map(e=>({...e})),minRow:a,minNote:n}}),getClipboard:()=>t().clipboard,showContextMenu:(t,a,n,s,r)=>e(e=>{e.contextMenu={visible:!0,x:t,y:a,noteId:n,row:s,midiNote:r}}),hideContextMenu:()=>e(e=>{e.contextMenu.visible=!1}),setGhostNotes:t=>e(e=>{e.ghostNotes=t}),clearGhostNotes:()=>e(e=>{e.ghostNotes=[]}),resetView:()=>e(e=>{e.view={...Kw},e.selection={...qw,notes:new Set},e.drag={isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]},e.tool="select",e.clipboard=null,e.contextMenu={visible:!1,x:0,y:0,noteId:null,row:0,midiNote:60},e.ghostNotes=[]})})));const Jw=new class{buffer=[];encode(e){return this.buffer=[],this.writeValue(e),new Uint8Array(this.buffer)}writeValue(e){null==e?this.buffer.push(192):"boolean"==typeof e?this.buffer.push(e?195:194):"number"==typeof e?Number.isInteger(e)?this.writeInt(e):this.writeFloat64(e):"string"==typeof e?this.writeString(e):Array.isArray(e)?this.writeArray(e):"object"==typeof e&&this.writeMap(e)}writeInt(e){e>=0?e<=127?this.buffer.push(e):e<=255?this.buffer.push(204,e):e<=65535?this.buffer.push(205,e>>8&255,255&e):this.buffer.push(206,e>>24&255,e>>16&255,e>>8&255,255&e):e>=-32?this.buffer.push(255&e):e>=-128?this.buffer.push(208,255&e):e>=-32768?this.buffer.push(209,e>>8&255,255&e):this.buffer.push(210,e>>24&255,e>>16&255,e>>8&255,255&e)}writeFloat64(e){this.buffer.push(203);const t=new ArrayBuffer(8);new DataView(t).setFloat64(0,e,!1);const a=new Uint8Array(t);for(let n=0;n<8;n++)this.buffer.push(a[n])}writeString(e){const t=(new TextEncoder).encode(e),a=t.length;a<=31?this.buffer.push(160|a):a<=255?this.buffer.push(217,a):a<=65535?this.buffer.push(218,a>>8&255,255&a):this.buffer.push(219,a>>24&255,a>>16&255,a>>8&255,255&a);for(let n=0;n<a;n++)this.buffer.push(t[n])}writeArray(e){const t=e.length;t<=15?this.buffer.push(144|t):t<=65535?this.buffer.push(220,t>>8&255,255&t):this.buffer.push(221,t>>24&255,t>>16&255,t>>8&255,255&t);for(const a of e)this.writeValue(a)}writeMap(e){const t=Object.keys(e),a=t.length;a<=15?this.buffer.push(128|a):a<=65535?this.buffer.push(222,a>>8&255,255&a):this.buffer.push(223,a>>24&255,a>>16&255,a>>8&255,255&a);for(const n of t)this.writeString(n),this.writeValue(e[n])}},ek=new class{data;view;offset=0;decode(e){return this.data=e,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.offset=0,this.readValue()}readValue(){if(this.offset>=this.data.length)return null;const e=this.data[this.offset++];if(e<=127)return e;if(e>=128&&e<=143)return this.readMapEntries(15&e);if(e>=144&&e<=159)return this.readArrayEntries(15&e);if(e>=160&&e<=191)return this.readStringBytes(31&e);if(e>=224)return e-256;switch(e){case 192:default:return null;case 194:return!1;case 195:return!0;case 202:{const e=this.view.getFloat32(this.offset,!1);return this.offset+=4,e}case 203:{const e=this.view.getFloat64(this.offset,!1);return this.offset+=8,e}case 204:return this.data[this.offset++];case 205:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,e}case 206:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,e}case 208:{const e=this.view.getInt8(this.offset);return this.offset+=1,e}case 209:{const e=this.view.getInt16(this.offset,!1);return this.offset+=2,e}case 210:{const e=this.view.getInt32(this.offset,!1);return this.offset+=4,e}case 217:{const e=this.data[this.offset++];return this.readStringBytes(e)}case 218:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readStringBytes(e)}case 219:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readStringBytes(e)}case 220:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readArrayEntries(e)}case 221:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readArrayEntries(e)}case 222:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readMapEntries(e)}case 223:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readMapEntries(e)}case 196:{const e=this.data[this.offset++];return this.readBinaryBytes(e)}case 197:{const e=this.view.getUint16(this.offset,!1);return this.offset+=2,this.readBinaryBytes(e)}case 198:{const e=this.view.getUint32(this.offset,!1);return this.offset+=4,this.readBinaryBytes(e)}}}readStringBytes(e){const t=this.data.subarray(this.offset,this.offset+e);return this.offset+=e,(new TextDecoder).decode(t)}readBinaryBytes(e){const t=this.data.slice(this.offset,this.offset+e);return this.offset+=e,t}readArrayEntries(e){const t=[];for(let a=0;a<e;a++)t.push(this.readValue());return t}readMapEntries(e){const t={};for(let a=0;a<e;a++){t[String(this.readValue())]=this.readValue()}return t}};function tk(e){return Jw.encode(e)}function ak(e){return ek.decode(e)}const nk=1380533830,sk=1313426259,rk=1313428297,ik=1313424193,ok=1346586699,lk=1347176772;async function ck(e){const t=new DataView(e).getUint32(0,!1);if(t===nk)return function(e){const t=new DataView(e);let a=0;const n=t.getUint32(a,!1);if(n!==nk)throw new Error("Invalid RIFF header");a+=4;const s=t.getUint32(a,!0);a+=4;const r=t.getUint32(a,!1);if(r!==sk)throw new Error("Invalid NIKS form type");a+=4;const i={vendor:Hx,uuid:Kx,version:"1.0"},o={};let l,c;const u=Math.min(8+s,e.byteLength);for(;a+8<=u;){const n=t.getUint32(a,!1),s=t.getUint32(a+4,!0);a+=8;const r=a+s;switch(n){case rk:{const t=new Uint8Array(e,a+4,s-4);try{const e=ak(t);e.name&&(i.name=String(e.name)),e.vendor&&(i.vendor=String(e.vendor)),e.author&&(i.author=String(e.author)),e.comment&&(i.comment=String(e.comment)),e.deviceType&&(i.deviceType=String(e.deviceType)),e.UUID&&(i.uuid=String(e.UUID)),Array.isArray(e.bankchain)&&(i.bankChain=e.bankchain.map(String).slice(0,3)),Array.isArray(e.types)&&(i.types=e.types.map(e=>Array.isArray(e)?e.map(String):[String(e),""])),Array.isArray(e.Character)&&(i.modes=e.Character.map(String))}catch(d){}break}case ik:{const t=new Uint8Array(e,a+4,s-4);try{const e=ak(t);if(e.ni8&&Array.isArray(e.ni8)){c=e.ni8;for(const e of c)if(Array.isArray(e))for(const t of e)t&&"object"==typeof t&&"id"in t&&(o[`param.${t.id}`]=0)}}catch(d){}break}case lk:{const t=new Uint8Array(e,a+4,s-4);try{const e=ak(t);void 0!==e["VST.magic"]&&(i.vstMagic=Number(e["VST.magic"])),Array.isArray(e["VST3.uid"])&&4===e["VST3.uid"].length&&(i.vst3Uid=e["VST3.uid"].map(Number))}catch(d){}break}case ok:l=e.slice(a+4,r)}a=r,a%2!=0&&a++}return{metadata:i,parameters:o,blob:l}}(e);if(t===zx)return function(e){const t=new DataView(e);let a=0;a+=8;const n={vendor:Hx,uuid:Kx,version:"1.0"},s={};let r;for(;a<e.byteLength;){const o=t.getUint32(a,!1),l=t.getUint32(a+4,!0);a+=8;const c=a;switch(o){case Ux:{const t=pk(new Uint8Array(e,c,l));try{Object.assign(n,JSON.parse(t))}catch(i){}break}case Gx:{const t=new DataView(e,c,l);let a=0;const n=t.getUint32(a,!0);a+=4;const r=n>0&&a<l?t.getUint8(a):0;if(r>0&&r<128&&a+1+r+4<=l)for(let i=0;i<n&&a<l;i++){const n=t.getUint8(a);a+=1;const r=new Uint8Array(e,c+a,n);a+=n,s[(new TextDecoder).decode(r)]=t.getFloat32(a,!0),a+=4}else for(let e=0;e<n&&a+8<=l;e++){const e=t.getUint32(a,!0);a+=4,s[`param.${e}`]=t.getFloat32(a,!0),a+=4}break}case Wx:r=e.slice(c,c+l)}a=c+l}return{metadata:n,parameters:s,blob:r}}(e);throw new Error("Invalid NKSF file: unrecognized header")}function uk(e){const t=[],a=function(e){const t={};void 0!==e.vstMagic&&(t["VST.magic"]=e.vstMagic);e.vst3Uid&&(t["VST3.uid"]=[...e.vst3Uid]);t["VST.magic"]||t["VST3.uid"]||(t["VST.magic"]=function(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a)|0;return t>>>0}(e.uuid||Kx));const a=tk(t);return dk(lk,1,a)}(e.metadata);t.push(a);const n=function(e){const t={};t.name=e.name||"Untitled",t.vendor=e.vendor||Hx,t.deviceType=e.deviceType||"INST",t.bankchain=e.bankChain||["DEViLBOX"],e.author&&(t.author=e.author);e.comment&&(t.comment=e.comment);e.uuid&&(t.UUID=e.uuid);e.types&&e.types.length>0&&(t.types=e.types.map(e=>e.length>=2?[e[0],e[1]]:[e[0]||"",""]));e.modes&&e.modes.length>0&&(t.Character=e.modes);const a=tk(t);return dk(rk,1,a)}(e.metadata);t.push(n);const s=function(e){const t=e.nicaPages;if(t&&t.length>0)return function(e){const t=[];for(const s of e){const e=[];for(let t=0;t<8;t++){const a=s[t];if(!a||void 0===a.id&&!a.name){e.push({name:""});continue}const n={name:a.name||""};void 0!==a.id&&a.id>=0&&(n.id=a.id),a.section&&(n.section=a.section),!0===a.autoname&&(n.autoname=!0),!0===a.vflag&&(n.vflag=!0),e.push(n)}t.push(e)}0===t.length&&t.push(Array.from({length:8},()=>({name:""})));const a={ni8:t},n=tk(a);return dk(ik,1,n)}(t);const a=Object.entries(e.parameters),n=[];let s=[];for(let i=0;i<a.length;i++){const[e]=a[i],t={name:e};e.startsWith("param.")?t.id=parseInt(e.replace("param.",""),10):t.id=i,s.push(t),8===s.length&&(n.push(s),s=[])}if(s.length>0){for(;s.length<8;)s.push({name:""});n.push(s)}0===n.length&&n.push(Array.from({length:8},()=>({name:""})));const r=tk({ni8:n});return dk(ik,1,r)}(e);if(t.push(s),e.blob){const a=(r=e.blob,dk(ok,1,new Uint8Array(r)));t.push(a)}var r;const i=4+t.reduce((e,t)=>e+(t.byteLength+t.byteLength%2),0),o=new ArrayBuffer(8+i),l=new DataView(o);let c=0;l.setUint32(c,nk,!1),c+=4,l.setUint32(c,i,!0),c+=4,l.setUint32(c,sk,!1),c+=4;for(const u of t)new Uint8Array(o,c,u.byteLength).set(new Uint8Array(u)),c+=u.byteLength,c%2!=0&&(l.setUint8(c,0),c++);return o}function dk(e,t,a){const n=4+a.byteLength,s=new ArrayBuffer(8+n),r=new DataView(s);return r.setUint32(0,e,!1),r.setUint32(4,n,!0),r.setUint32(8,t,!0),new Uint8Array(s,12,a.byteLength).set(a),s}function pk(e){let t=e.indexOf(0);return-1===t&&(t=e.length),(new TextDecoder).decode(e.subarray(0,t))}const mk=["Acoustic","Additive","Airy","Analog","Arpeggiated","Bright","Chord","Clean","Dark","Deep","Digital","Dirty","Distorted","Dry","Electric","Evolving","Filtered","FM","Glide / Pitch Mod","Granular","Huge","Human","Layered","Lead","Lick","Lo-Fi","Long Release","Melodic","Metallic","Mono Aftertouch","Monophonic","Percussive","Physical Model","Poly Aftertouch","Processed","Riser","Sample-based","Stabs & Hits","Sub","Surround","Synthetic","Tempo-synced","Top","Vinyl","Vocoded","Wet"],hk=new Set(["Bass","Bowed Strings","Brass","Drums","Flute","Guitar","Mallet Instruments","Organ","Percussion","Piano / Keys","Plucked Strings","Reed Instruments","Sound Effects","Soundscapes","Synth Lead","Synth Misc","Synth Pad","Vocal"]);function fk(e){return hk.has(e)}new Set(mk),new Set(["Amps & Cabinets","Audio Repair","Character","Delay","Distortion","Dynamics","EQ","Filter","Mix Chain","Modulation","Multi FX","Pitch","Reverb","Specialized","Surround","Utilities"]),new Set(["Bass","Drums","Guitar","Keys","Mastering","Mixbus","Pads","Piano","Plucks","Special FX","Strings","Synth","Vocal"]);const yk={TB303:{type:"Bass",subType:"Synth",characters:["Analog","Monophonic"]},Buzz3o3DF:{type:"Bass",subType:"Synth",characters:["Analog","Monophonic"]},FMSynth:{type:"Synth Lead",subType:"Classic Poly",characters:["FM","Digital"]},Dexed:{type:"Synth Lead",subType:"Classic Poly",characters:["FM","Digital"]},DexedBridge:{type:"Synth Lead",subType:"Classic Poly",characters:["FM","Digital"]},MonoSynth:{type:"Synth Lead",subType:"Classic Mono",characters:["Analog","Monophonic"]},PolySynth:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog"]},AMSynth:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog"]},DuoSynth:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Layered"]},Synth:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},OBXd:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Huge"]},V2:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Digital"]},V2Speech:{type:"Vocal",subType:"Computer",characters:["Synthetic","Digital"]},Wavetable:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},Vital:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},Odin2:{type:"Synth Lead",subType:"Classic Poly",characters:["Analog","Digital"]},Surge:{type:"Synth Lead",subType:"Classic Poly",characters:["Digital"]},Monique:{type:"Synth Lead",subType:"Classic Mono",characters:["Analog","Monophonic"]},DubSiren:{type:"Sound Effects",subType:"Synth",characters:["Analog","Dirty"]},SpaceLaser:{type:"Sound Effects",subType:"Synth",characters:["Digital","Percussive"]},Synare:{type:"Drums",subType:"Tom",characters:["Analog","Percussive"]},GranularSynth:{type:"Synth Misc",subType:"Sweeps & Swells",characters:["Granular","Evolving"]},FormantSynth:{type:"Vocal",subType:"Synth Choir",characters:["Synthetic","Human"]},Sam:{type:"Vocal",subType:"Computer",characters:["Digital","Synthetic"]},PWMSynth:{type:"Synth Lead",subType:"Classic Mono",characters:["Analog","Monophonic"]},SuperSaw:{type:"Synth Lead",subType:"Classic Poly",characters:["Huge","Bright"]},WobbleBass:{type:"Bass",subType:"Synth",characters:["Digital","Filtered"]},StringMachine:{type:"Synth Pad",subType:"Basic",characters:["Analog","Layered"]},ChipSynth:{type:"Synth Misc",subType:"Classic",characters:["Digital","Lo-Fi"]},MembraneSynth:{type:"Drums",subType:"Kick",characters:["Analog","Percussive"]},MetalSynth:{type:"Drums",subType:"Hi-Hat",characters:["Metallic","Percussive"]},NoiseSynth:{type:"Sound Effects",subType:"Noise",characters:["Synthetic"]},DrumMachine:{type:"Drums",subType:"Kit",characters:["Analog","Percussive"]},DrumKit:{type:"Drums",subType:"Kit",characters:["Sample-based"]},TonewheelOrgan:{type:"Organ",subType:"Electric",characters:["Electric","Analog"]},Organ:{type:"Organ",subType:"Electric",characters:["Electric"]},PluckSynth:{type:"Plucked Strings",subType:"Other",characters:["Physical Model","Percussive"]},Melodica:{type:"Reed Instruments",subType:"Melodica",characters:["Acoustic","Airy"]},WAM:{type:"Synth Lead",subType:"Other",characters:["Digital"]}},gk={Bass:{bankChain:["DEViLBOX","Bass"],type:"Bass"},Lead:{bankChain:["DEViLBOX","Lead"],type:"Synth Lead"},Pad:{bankChain:["DEViLBOX","Pad"],type:"Synth Pad"},Drum:{bankChain:["DEViLBOX","Drum"],type:"Drums"},FX:{bankChain:["DEViLBOX","FX"],type:"Sound Effects"},User:{bankChain:["DEViLBOX","User"],type:"Synth Misc"}};function bk(e){const t=e.toLowerCase();return t.includes("bass")?"Bass":t.includes("lead")||"synth lead"===t?"Lead":t.includes("pad")||"synth pad"===t||"soundscapes"===t?"Pad":t.includes("drum")||t.includes("percussion")?"Drum":t.includes("effect")||t.includes("sound effects")?"FX":"User"}const vk={Bass:gk.Bass.bankChain,Lead:gk.Lead.bankChain,Pad:gk.Pad.bankChain,Drum:gk.Drum.bankChain,FX:gk.FX.bankChain,User:gk.User.bankChain};function xk(e){for(const a of e)if(fk(a))return bk(a);const t=e.join(" ").toLowerCase();return t.includes("bass")?"Bass":t.includes("lead")||t.includes("synth lead")?"Lead":t.includes("pad")||t.includes("ambient")||t.includes("soundscape")?"Pad":t.includes("drum")||t.includes("perc")?"Drum":t.includes("fx")||t.includes("effect")||t.includes("sound effect")?"FX":"User"}function wk(e,t){const a=[];return e&&a.push(...e.flat().filter(Boolean).map(e=>e.toLowerCase())),t&&a.push(...t.map(e=>e.toLowerCase())),[...new Set(a)]}function kk(e){const t=[],a=function(e){return e.filter(e=>mk.some(t=>t.toLowerCase()===e.toLowerCase())).map(e=>mk.find(t=>t.toLowerCase()===e.toLowerCase())||e)}(e);for(const n of e)fk(n)&&t.push(n);if(0===t.length){const a=e.join(" ").toLowerCase();a.includes("bass")?t.push("Bass"):a.includes("lead")?t.push("Synth Lead"):a.includes("pad")?t.push("Synth Pad"):a.includes("drum")||a.includes("perc")?t.push("Drums"):a.includes("fx")||a.includes("effect")?t.push("Sound Effects"):a.includes("key")||a.includes("piano")?t.push("Piano / Keys"):a.includes("organ")?t.push("Organ"):a.includes("vocal")||a.includes("voice")?t.push("Vocal"):a.includes("string")?t.push("Bowed Strings"):a.includes("brass")&&t.push("Brass")}return{types:t,modes:a}}function Sk(e,t){const a=e.synthType,n=function(e,t){const a={},n=e.synthType.toLowerCase();for(const s of t){const t=s.id.replace(`${n}.`,"").split(".");let r=e;const i=e[n];i&&"object"==typeof i&&(r=i);for(const a of t){if(!r||"object"!=typeof r||!(a in r)){if("cutoff"===a&&void 0!==e.filter?.frequency){r=e.filter.frequency;break}if("resonance"===a&&void 0!==e.filter?.Q){r=e.filter.Q;break}if("attack"===a&&void 0!==e.envelope?.attack){r=e.envelope.attack;break}if("decay"===a&&void 0!==e.envelope?.decay){r=e.envelope.decay;break}if("sustain"===a&&void 0!==e.envelope?.sustain){r=e.envelope.sustain;break}if("release"===a&&void 0!==e.envelope?.release){r=e.envelope.release;break}r=void 0;break}r=r[a]}if("number"==typeof r){const e=(r-s.min)/(s.max-s.min);a[s.id]=Math.max(0,Math.min(1,e))}else if("boolean"==typeof r)a[s.id]=r?1:0;else if("string"==typeof r&&s.valueStrings){const e=s.valueStrings.indexOf(r);a[s.id]=-1!==e?e/Math.max(1,s.valueStrings.length-1):s.defaultValue}else a[s.id]=s.defaultValue}return a}(e,iw(a)),{types:s,modes:r}=kk(t?.tags||[]),i=t?.category?vk[t.category]:["DEViLBOX",e.synthType],o=function(e,t){const a=yk[e];if(a)return a;const n=e;if(n.startsWith("Furnace")||n.startsWith("MAME")||n.startsWith("Buzz"))return{type:"Synth Misc",subType:"Classic",characters:["Digital","Lo-Fi"]};if(n.includes("Bridge")||n.includes("VST"))return{type:"Synth Lead",subType:"Other",characters:["Digital"]};if(t)return{type:gk[t].type};return{type:"Synth Misc"}}(a,t?.category),l=s.length>0?s.map(e=>[e]):[[o.type]],c=r.length>0?r:o.characters;return{metadata:{vendor:Hx,uuid:Kx,version:"1.0",name:t?.name||e.name,author:t?.author||"DEViLBOX User",comment:t?.comment||`${a} preset for DEViLBOX`,deviceType:"INST",bankChain:i,types:l,modes:c,isUser:!0},parameters:n,blob:(new TextEncoder).encode(JSON.stringify(e)).buffer}}function Mk(e,t,a){if(e.blob)try{const a=(new TextDecoder).decode(new Uint8Array(e.blob)),n=JSON.parse(a);if(n.synthType)return{...n,id:t,name:e.metadata.name||n.name||"NKS Preset"}}catch{}const n=a||function(e){const t=e.bankChain.join(" ").toLowerCase(),a=(e.types||[]).flat().join(" ").toLowerCase(),n=(e.comment||"").toLowerCase(),s=(e.name||"").toLowerCase(),r=`${t} ${a} ${n} ${s}`;return r.includes("tb303")||r.includes("db303")||r.includes("open303")?"TB303":r.includes("tb808")||r.includes("808")||r.includes("drum machine")?"DrumMachine":r.includes("dub siren")||r.includes("dubsiren")?"DubSiren":r.includes("space laser")||r.includes("spacelaser")?"SpaceLaser":r.includes("synare")?"Synare":r.includes("dexed")||r.includes("dx7")?"Dexed":r.includes("obxd")||r.includes("ob-x")?"OBXd":r.includes("v2synth")||r.includes("v2 synth")?"V2":r.includes("vital")?"Vital":r.includes("odin")?"Odin2":r.includes("surge")?"Surge":r.includes("tonewheel")||r.includes("organ")?"TonewheelOrgan":r.includes("melodica")?"Melodica":r.includes("sam")&&r.includes("speech")?"Sam":r.includes("supersaw")?"SuperSaw":r.includes("wobble")?"WobbleBass":r.includes("string machine")?"StringMachine":r.includes("chip")&&r.includes("synth")?"ChipSynth":r.includes("pwm")?"PWMSynth":r.includes("formant")?"FormantSynth":r.includes("granular")?"GranularSynth":r.includes("wavetable")?"Wavetable":r.includes("fm")||a.includes("fm")?"FMSynth":r.includes("membrane")||r.includes("kick")?"MembraneSynth":r.includes("metal")||r.includes("hihat")||r.includes("cymbal")?"MetalSynth":r.includes("pluck")?"PluckSynth":r.includes("noise")?"NoiseSynth":r.includes("duo")?"DuoSynth":r.includes("am synth")||r.includes("amsyn")?"AMSynth":a.includes("synth lead")&&r.includes("mono")?"MonoSynth":a.includes("synth lead")||a.includes("synth pad")?"PolySynth":a.includes("bass")?"MonoSynth":null}(e.metadata)||"Synth",s=iw(n),r={id:t,name:e.metadata.name||"NKS Preset",type:"synth",synthType:n,effects:[],volume:-6,pan:0};return function(e,t,a){const n=e.synthType.toLowerCase(),s={};for(const r of a){const a=t[r.id];if(void 0===a)continue;const i=a*(r.max-r.min)+r.min,o=r.id.replace(`${n}.`,""),l=o.split(".");let c=s;for(let e=0;e<l.length-1;e++)l[e]in c||(c[l[e]]={}),c=c[l[e]];const u=l[l.length-1];if(r.valueStrings&&r.valueStrings.length>0){const e=Math.round(a*(r.valueStrings.length-1));c[u]=r.valueStrings[Math.min(e,r.valueStrings.length-1)]}else 2===r.type?c[u]=a>=.5:c[u]=i;"cutoff"!==u&&"frequency"!==u||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.frequency=i),"resonance"!==u&&"Q"!==u||(e.filter||(e.filter={type:"lowpass",frequency:1e3,Q:1,rolloff:-24}),e.filter.Q=i),"attack"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.attack=i),"decay"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.decay=i),"sustain"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.sustain=i),"release"!==u||o.includes("filter")||(e.envelope||(e.envelope={attack:.01,decay:.1,sustain:.5,release:.3}),e.envelope.release=i)}Object.keys(s).length>0&&(e[n]=s)}(r,e.parameters,s),r}function Nk(e){return Sk({id:0,...e.config},{name:e.name,category:e.category,tags:e.tags})}function Ck(e,t){const a=Mk(e,0,t),{id:n,...s}=a;return{name:e.metadata.name||"NKS Preset",category:xk(e.metadata.bankChain),synthType:a.synthType,tags:wk(e.metadata.types,e.metadata.modes),config:s}}function Pk(e,t){const a=uk(Sk(e,t)),n=new Blob([a],{type:"application/octet-stream"}),s=URL.createObjectURL(n),r=`${t?.name||e.name||"preset"}.nksf`,i=document.createElement("a");i.href=s,i.download=r,i.click(),URL.revokeObjectURL(s)}const Ek=n()(Wg(Ga((e,t)=>({userPresets:[],recentPresetIds:[],savePreset:(t,a,n,s=[])=>{const r=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return e(e=>{const i={id:r,name:a,category:n,synthType:t.synthType,tags:s,createdAt:Date.now(),updatedAt:Date.now(),config:{name:t.name,type:t.type,synthType:t.synthType,oscillator:t.oscillator,envelope:t.envelope,filter:t.filter,filterEnvelope:t.filterEnvelope,tb303:t.tb303,wavetable:t.wavetable,effects:t.effects?[...t.effects]:[],volume:t.volume,pan:t.pan,parameters:t.parameters}};e.userPresets.push(i)}),r},deletePreset:t=>e(e=>{const a=e.userPresets.findIndex(e=>e.id===t);-1!==a&&e.userPresets.splice(a,1);const n=e.recentPresetIds.indexOf(t);-1!==n&&e.recentPresetIds.splice(n,1)}),updatePreset:(t,a)=>e(e=>{const n=e.userPresets.find(e=>e.id===t);n&&(Object.assign(n,a),n.updatedAt=Date.now())}),getPreset:e=>t().userPresets.find(t=>t.id===e),getPresetsByCategory:e=>t().userPresets.filter(t=>t.category===e),getPresetsBySynthType:e=>t().userPresets.filter(t=>t.synthType===e),addToRecent:t=>e(e=>{const a=e.recentPresetIds.indexOf(t);-1!==a&&e.recentPresetIds.splice(a,1),e.recentPresetIds.unshift(t),e.recentPresetIds.length>10&&e.recentPresetIds.pop()}),clearRecent:()=>e(e=>{e.recentPresetIds=[]}),importPresets:t=>e(e=>{t.forEach(t=>{const a=e.userPresets.findIndex(e=>e.id===t.id);-1!==a?e.userPresets[a]=t:e.userPresets.push(t)})}),exportPresets:()=>t().userPresets,exportPresetAsNKSF:e=>{const a=t().getPreset(e);if(a)try{const e=uk(Nk(a)),t=new Blob([e],{type:"application/octet-stream"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=`${a.name}.nksf`,s.click(),URL.revokeObjectURL(n)}catch(n){}},exportAllPresetsAsNKSF:e=>{const a=t().userPresets;if(0!==a.length)try{const t=function(e,t){return e.map(e=>{const a=Nk(e);return t&&(a.metadata.author=t),{filename:`${e.name}.nksf`,buffer:uk(a)}})}(a,e);t.forEach((e,t)=>{setTimeout(()=>{const t=new Blob([e.buffer],{type:"application/octet-stream"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=e.filename,n.click(),URL.revokeObjectURL(a)},100*t)})}catch(n){}},importNKSFFiles:async t=>{const a=[];try{const n=await async function(e){const t=[];for(const n of e)try{const e=await n.arrayBuffer(),a=await ck(e);t.push(Ck(a))}catch(a){}return t}(t);for(const t of n){const n=`preset-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;e(e=>{const a={id:n,...t,createdAt:Date.now(),updatedAt:Date.now()};e.userPresets.push(a)}),a.push(n)}}catch(n){}return a}})),{name:"devilbox-user-presets",version:1})),_k="538",Tk="53e4ef5",Ak=`1.0.1.${_k}`,Ok=[{version:"1.0.1",date:"2026-02-14",changes:[{type:"fix",description:"Remove unused variables in cable routing"},{type:"fix",description:"Fix piano keyboard - white keys now visible"},{type:"fix",description:"Accept nullable ref in usePortPositions hook"},{type:"feature",description:"Expand mobile hamburger menu with FT2Toolbar features"},{type:"fix",description:"Add Safari-specific MIDI troubleshooting and debug logging"},{type:"improvement",description:"Optimize instrument loading and fix unused variable"},{type:"fix",description:"Use correct TrackerStore methods for cursor movement"},{type:"feature",description:"Add tap-to-cell and improve horizontal swipe gestures"},{type:"feature",description:"Add hamburger menu and improve MIDI support"},{type:"fix",description:"Convert HARMONIC_PRESETS to InstrumentPreset['config'][] format"},{type:"feature",description:"Mobile MIDI support, harmonic presets, and modular synth UI"},{type:"fix",description:"Resolve 8 type errors across modular synth and hooks"},{type:"fix",description:"Re-enable silent auto-preview for waveform visualization"},{type:"fix",description:"Wire up HarmonicSynth parameter updates"},{type:"fix",description:"Disable auto-preview - user triggers notes manually"},{type:"fix",description:"Prevent auto-preview during playback and debounce when editing"},{type:"fix",description:"Update instrument name when changing synth type"},{type:"fix",description:"Use SynthRegistry.knows() for lazy-loaded synths"},{type:"fix",description:"Add SynthRegistry check for HarmonicSynth and other registry synths"},{type:"feature",description:"Add HarmonicSynth to pads category"},{type:"improvement",description:"Add comprehensive Plugin SDK documentation"},{type:"improvement",description:"Chore: update changelog and instrument editor"},{type:"feature",description:"Register HarmonicSynth in SDK"},{type:"feature",description:"Add effect registry descriptors for all effect types"},{type:"feature",description:"Integrate EffectRegistry system"},{type:"feature",description:"Add HarmonicSynth - additive/spectral synthesis engine"},{type:"improvement",description:"Add comprehensive performance optimization summary"},{type:"improvement",description:"Integrate requestIdleCallback for idle-time auto-save"},{type:"improvement",description:"Comprehensive performance optimization across rendering, audio, and state management"},{type:"feature",description:"Make piano roll/input panel collapsible"},{type:"feature",description:"Add instrument selector and fix cursor bar styling"},{type:"fix",description:"Enable native scrolling and add clipboard actions"},{type:"feature",description:"Add swipe gestures for cursor movement and channel switching"},{type:"fix",description:"Remove unused touch variable in handleKeyTouch"},{type:"fix",description:"Resolve remaining TypeScript errors"},{type:"fix",description:"Resolve TypeScript compilation errors in mobile UX code"},{type:"improvement",description:"Chore: sync remaining changes from previous development"},{type:"improvement",description:"Update project memory with mobile UX implementation"},{type:"improvement",description:"Add comprehensive mobile UX documentation"},{type:"feature",description:"Add mobile MIDI support section to settings"},{type:"feature",description:"Optimize drum pads and pedalboard for mobile layouts"},{type:"feature",description:"Optimize all instrument editors for touch devices"},{type:"fix",description:"Solve knob scroll conflict with touch-action CSS"},{type:"feature",description:"Add mobile pattern editor with context-aware input"},{type:"feature",description:"Add mobile UX infrastructure"}]},{version:"2026-02-13",date:"2026-02-13",changes:[{type:"fix",description:"Remove URL shim that shadowed global URL constructor"},{type:"fix",description:"Fix WASM OOM and self-not-defined in AudioWorklet scope"},{type:"improvement",description:"Chore(tms5220): update C++ docs and rebuild WASM binary with index clamping"},{type:"fix",description:"Clamp TMS5220 table indices and clean up FurnaceDispatch naming"},{type:"fix",description:"Chore: update project docs, migration, nibbles fixes, and misc improvements"}]}],Ik=Ak,Fk=Ak,Dk=({label:e,devices:t,selectedId:a,onSelect:n,disabled:s=!1})=>{const r=t.find(e=>e.id===a);return Ea.jsxs("div",{className:"space-y-1",children:[Ea.jsx("label",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:e}),Ea.jsxs("div",{className:"relative",children:[Ea.jsxs("select",{value:a||"",onChange:e=>n(e.target.value||null),disabled:s,className:`\n            w-full px-3 py-2 pr-8 rounded-md text-sm\n            bg-dark-bgTertiary border border-dark-border\n            text-text-primary appearance-none cursor-pointer\n            hover:border-dark-borderLight focus:border-accent-primary focus:outline-none\n            disabled:opacity-50 disabled:cursor-not-allowed\n            ${r?.isTD3?"border-accent-success/50":""}\n          `,children:[Ea.jsx("option",{value:"",children:"No device"}),t.map(e=>Ea.jsxs("option",{value:e.id,children:[e.isTD3?" ":"",e.name,e.manufacturer?` (${e.manufacturer})`:""]},e.id))]}),Ea.jsx(Me,{size:14,className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none"})]}),r?.isTD3&&Ea.jsxs("div",{className:"flex items-center gap-1 text-xs text-accent-success",children:[Ea.jsx(Ne,{size:12}),Ea.jsx("span",{children:"TD-3 detected"})]})]})};function Rk(){const[e,t]=s.useState([]),[a]=s.useState(()=>"requestMIDIAccess"in navigator),[n,r]=s.useState(!1),[i,o]=s.useState(null),l=s.useRef(null),c=s.useRef(null),u=s.useRef(new Set),d=s.useCallback(e=>{const t=e;if(!t.data)return;const a=function(e){if(e.length<1)return{type:"unknown",channel:0,raw:e};const[t,a=0,n=0]=e,s=15&t;switch(t>>4&15){case 9:return{type:n>0?"noteon":"noteoff",channel:s,note:a,velocity:n,raw:e};case 8:return{type:"noteoff",channel:s,note:a,velocity:n,raw:e};case 11:return{type:"cc",channel:s,controller:a,value:n,raw:e};case 14:return{type:"pitchbend",channel:s,value:n<<7|a,raw:e};case 13:return{type:"aftertouch",channel:s,value:a,raw:e};default:return{type:"unknown",channel:s,raw:e}}}(t.data);o(a),u.current.forEach(e=>{e(a)})},[]),p=s.useCallback(e=>{const a=[];e.inputs.forEach(e=>{a.push({id:e.id,name:e.name||"Unknown Device",manufacturer:e.manufacturer||"Unknown",state:e.state})}),t(a)},[]),m=s.useCallback(async()=>{if(!a)throw new Error("Web MIDI API not supported in this browser");if(n)return;const e=await navigator.requestMIDIAccess();l.current=e,e.inputs.forEach(e=>{e.addEventListener("midimessage",d)});const t=()=>{p(e),e.inputs.forEach(e=>{e.removeEventListener("midimessage",d),e.addEventListener("midimessage",d)})};c.current=t,e.addEventListener("statechange",t),p(e),r(!0)},[a,n,d,p]),h=s.useCallback(()=>{l.current&&(l.current.inputs.forEach(e=>{e.removeEventListener("midimessage",d)}),c.current&&(l.current.removeEventListener("statechange",c.current),c.current=null),l.current=null),r(!1),t([]),o(null)},[d]),f=s.useCallback(e=>(u.current.add(e),()=>{u.current.delete(e)}),[]);return s.useEffect(()=>()=>{h()},[h]),{devices:e,isSupported:a,isEnabled:n,lastMessage:i,enableMIDI:m,disableMIDI:h,onMessage:f}}const jk={1:{mode:92,cc:93,min:94,max:95,name:96},2:{mode:112,cc:113,min:114,max:115,name:116},3:{mode:132,cc:133,min:134,max:135,name:136},4:{mode:152,cc:153,min:154,max:155,name:156},5:{mode:172,cc:173,min:174,max:175,name:176},6:{mode:192,cc:193,min:194,max:195,name:196},7:{mode:212,cc:213,min:214,max:215,name:216},8:{mode:232,cc:233,min:234,max:235,name:236}};class Bk{static instance=null;currentPreset=null;deviceName=null;constructor(){}static getInstance(){return Bk.instance||(Bk.instance=new Bk),Bk.instance}checkConnection(){const e=gx().getInputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return this.deviceName=t.name||"MPK Mini",!0}return this.deviceName=null,!1}getDeviceName(){return this.deviceName}createDefaultPreset(){const e=new Uint8Array(246);e[0]=0;const t=this.stringToBytes("DEViLBOX       ",16);e.set(t,1),e[17]=0,e[18]=0,e[19]=0,e[20]=4;for(let a=1;a<=8;a++){const t=jk[a];e[t.mode-7]=0,e[t.cc-7]=70+a-1,e[t.min-7]=0,e[t.max-7]=127;const n=`Knob ${a}        `,s=this.stringToBytes(n,16);e.set(s,t.name-7)}return e}stringToBytes(e,t){const a=new Uint8Array(t);for(let n=0;n<t;n++)n<e.length?a[n]=Math.min(127,e.charCodeAt(n)):a[n]=32;return a}buildSysExMessage(e){const t=e.length,a=t>>7&127,n=127&t,s=new Uint8Array(7+e.length+1);return s[0]=240,s[1]=71,s[2]=127,s[3]=73,s[4]=100,s[5]=a,s[6]=n,s.set(e,7),s[s.length-1]=247,s}findMPKMiniOutputId(){const e=gx().getOutputDevices();for(const t of e){const e=t.name?.toLowerCase()||"";if(e.includes("mpk mini")||e.includes("mpkmini"))return t.id}return null}async sendSysEx(e){const t=gx(),a=this.findMPKMiniOutputId();if(!a)return!1;const n=t.getSelectedOutput(),s=n?.id||null;try{return t.selectOutput(a),t.sendSysEx(e),s&&s!==a&&t.selectOutput(s),!0}catch(r){if(s)try{t.selectOutput(s)}catch{}return!1}}async setKnobName(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const a=jk[e],n=this.stringToBytes(t,16);this.currentPreset.set(n,a.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async setKnobNames(e){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());for(const[a,n]of Object.entries(e)){const e=parseInt(a);if(e>=1&&e<=8){const t=jk[e],a=this.stringToBytes(n,16);this.currentPreset.set(a,t.name-7)}}const t=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(t)}async setKnobConfig(e,t){if(!this.checkConnection())return!1;this.currentPreset||(this.currentPreset=this.createDefaultPreset());const a=jk[e];void 0!==t.mode&&(this.currentPreset[a.mode-7]="relative"===t.mode?1:0),void 0!==t.cc&&(this.currentPreset[a.cc-7]=127&t.cc),void 0!==t.min&&(this.currentPreset[a.min-7]=127&t.min),void 0!==t.max&&(this.currentPreset[a.max-7]=127&t.max);const n=this.stringToBytes(t.name,16);this.currentPreset.set(n,a.name-7);const s=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(s)}async applyDEViLBOXPreset(){return this.setKnobNames({1:"Cutoff",2:"Resonance",3:"Env Mod",4:"Decay",5:"Accent",6:"Overdrive",7:"Slide Time",8:"Filter FM"})}async resetKnobNames(){this.currentPreset=this.createDefaultPreset();const e=this.buildSysExMessage(this.currentPreset);return this.sendSysEx(e)}}function Lk(){return Bk.getInstance()}const Vk={"transport.play":{label:"Play",category:"Transport"},"transport.stop":{label:"Stop",category:"Transport"},"transport.pause":{label:"Pause",category:"Transport"},"transport.record":{label:"Record",category:"Transport"},"transport.loop":{label:"Toggle Loop",category:"Transport"},"nav.patternUp":{label:"Pattern Up",category:"Navigation"},"nav.patternDown":{label:"Pattern Down",category:"Navigation"},"nav.positionUp":{label:"Song Position Up",category:"Navigation"},"nav.positionDown":{label:"Song Position Down",category:"Navigation"},"nav.rowUp":{label:"Row Up",category:"Navigation"},"nav.rowDown":{label:"Row Down",category:"Navigation"},"nav.toStart":{label:"Go to Start",category:"Navigation"},"nav.toEnd":{label:"Go to End",category:"Navigation"},"edit.octaveUp":{label:"Octave Up",category:"Editing"},"edit.octaveDown":{label:"Octave Down",category:"Editing"},"edit.instrumentUp":{label:"Instrument Up",category:"Editing"},"edit.instrumentDown":{label:"Instrument Down",category:"Editing"},"edit.undo":{label:"Undo",category:"Editing"},"edit.redo":{label:"Redo",category:"Editing"},"edit.copy":{label:"Copy",category:"Editing"},"edit.paste":{label:"Paste",category:"Editing"},"edit.delete":{label:"Delete",category:"Editing"},"edit.insertRow":{label:"Insert Row",category:"Editing"},"edit.deleteRow":{label:"Delete Row",category:"Editing"},"channel.mute1":{label:"Mute Ch 1",category:"Channels"},"channel.mute2":{label:"Mute Ch 2",category:"Channels"},"channel.mute3":{label:"Mute Ch 3",category:"Channels"},"channel.mute4":{label:"Mute Ch 4",category:"Channels"},"channel.mute5":{label:"Mute Ch 5",category:"Channels"},"channel.mute6":{label:"Mute Ch 6",category:"Channels"},"channel.mute7":{label:"Mute Ch 7",category:"Channels"},"channel.mute8":{label:"Mute Ch 8",category:"Channels"},"channel.solo1":{label:"Solo Ch 1",category:"Channels"},"channel.solo2":{label:"Solo Ch 2",category:"Channels"},"channel.solo3":{label:"Solo Ch 3",category:"Channels"},"channel.solo4":{label:"Solo Ch 4",category:"Channels"},"pattern.new":{label:"New Pattern",category:"Pattern"},"pattern.clone":{label:"Clone Pattern",category:"Pattern"},"pattern.delete":{label:"Delete Pattern",category:"Pattern"},"view.toggleEditor":{label:"Toggle Editor",category:"View"},"view.toggleMixer":{label:"Toggle Mixer",category:"View"}},zk={"tb303.cutoff":{label:"Cutoff",min:200,max:5e3,category:"303 Main"},"tb303.resonance":{label:"Resonance",min:0,max:100,category:"303 Main"},"tb303.envMod":{label:"Env Mod",min:0,max:100,category:"303 Main"},"tb303.decay":{label:"Decay",min:200,max:2e3,category:"303 Main"},"tb303.accent":{label:"Accent",min:0,max:100,category:"303 Main"},"tb303.slideTime":{label:"Slide Time",min:2,max:360,category:"303 Main"},"tb303.overdrive":{label:"Overdrive",min:0,max:100,category:"303 Main"},"tb303.normalDecay":{label:"Normal Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.accentDecay":{label:"Accent Decay",min:30,max:3e3,category:"Devil Fish"},"tb303.softAttack":{label:"Soft Attack",min:.3,max:30,category:"Devil Fish"},"tb303.vegSustain":{label:"VEG Sustain",min:0,max:100,category:"Devil Fish"},"tb303.filterFM":{label:"Filter FM",min:0,max:100,category:"Devil Fish"},"tb303.filterTracking":{label:"Key Track",min:0,max:200,category:"Devil Fish"}},Uk=[{id:"akai-mpk-mini-mk3",name:"MPK Mini MK3",manufacturer:"Akai",detectPatterns:["mpk mini","mpk mini mk3","mpkmini"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1",defaultMapping:"transport.play"},{note:37,name:"Pad 2",defaultMapping:"transport.stop"},{note:38,name:"Pad 3",defaultMapping:"transport.record"},{note:39,name:"Pad 4",defaultMapping:"transport.loop"},{note:40,name:"Pad 5",defaultMapping:"nav.patternDown"},{note:41,name:"Pad 6",defaultMapping:"nav.patternUp"},{note:42,name:"Pad 7",defaultMapping:"edit.octaveDown"},{note:43,name:"Pad 8",defaultMapping:"edit.octaveUp"}],extras:{pitchBend:!0,modWheel:{cc:1}},suggestedLayout:{knobs:{70:"tb303.cutoff",71:"tb303.resonance",72:"tb303.envMod",73:"tb303.decay",74:"tb303.accent",75:"tb303.overdrive",76:"tb303.slideTime"}}},{id:"akai-mpk-mini-plus",name:"MPK Mini Plus",manufacturer:"Akai",detectPatterns:["mpk mini plus","mpkminiplus"],knobs:[{cc:70,name:"K1",defaultMapping:"tb303.cutoff"},{cc:71,name:"K2",defaultMapping:"tb303.resonance"},{cc:72,name:"K3",defaultMapping:"tb303.envMod"},{cc:73,name:"K4",defaultMapping:"tb303.decay"},{cc:74,name:"K5",defaultMapping:"tb303.accent"},{cc:75,name:"K6",defaultMapping:"tb303.overdrive"},{cc:76,name:"K7",defaultMapping:"tb303.slideTime"},{cc:77,name:"K8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1}}},{id:"novation-launchkey-mini-mk3",name:"Launchkey Mini MK3",manufacturer:"Novation",detectPatterns:["launchkey mini","launchkey"],knobs:[{cc:21,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:22,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:23,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:24,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:25,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:26,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:27,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:28,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"},{note:44,name:"Pad 9"},{note:45,name:"Pad 10"},{note:46,name:"Pad 11"},{note:47,name:"Pad 12"},{note:48,name:"Pad 13"},{note:49,name:"Pad 14"},{note:50,name:"Pad 15"},{note:51,name:"Pad 16"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}},{id:"arturia-minilab-3",name:"MiniLab 3",manufacturer:"Arturia",detectPatterns:["minilab","arturia minilab"],knobs:[{cc:74,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:71,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:76,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:77,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:93,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:73,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:75,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:114,name:"Knob 8"}],pads:[{note:36,name:"Pad 1"},{note:37,name:"Pad 2"},{note:38,name:"Pad 3"},{note:39,name:"Pad 4"},{note:40,name:"Pad 5"},{note:41,name:"Pad 6"},{note:42,name:"Pad 7"},{note:43,name:"Pad 8"}],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64},faders:[{cc:85,name:"Fader 1"},{cc:86,name:"Fader 2"},{cc:87,name:"Fader 3"},{cc:88,name:"Fader 4"}]}},{id:"korg-nanokontrol2",name:"nanoKONTROL2",manufacturer:"Korg",detectPatterns:["nanokontrol","nano kontrol","korg nano"],knobs:[{cc:16,name:"Knob 1",defaultMapping:"tb303.cutoff"},{cc:17,name:"Knob 2",defaultMapping:"tb303.resonance"},{cc:18,name:"Knob 3",defaultMapping:"tb303.envMod"},{cc:19,name:"Knob 4",defaultMapping:"tb303.decay"},{cc:20,name:"Knob 5",defaultMapping:"tb303.accent"},{cc:21,name:"Knob 6",defaultMapping:"tb303.overdrive"},{cc:22,name:"Knob 7",defaultMapping:"tb303.slideTime"},{cc:23,name:"Knob 8"}],pads:[{cc:32,name:"S1",defaultMapping:"channel.solo1"},{cc:33,name:"S2",defaultMapping:"channel.solo2"},{cc:34,name:"S3",defaultMapping:"channel.solo3"},{cc:35,name:"S4",defaultMapping:"channel.solo4"},{cc:48,name:"M1",defaultMapping:"channel.mute1"},{cc:49,name:"M2",defaultMapping:"channel.mute2"},{cc:50,name:"M3",defaultMapping:"channel.mute3"},{cc:51,name:"M4",defaultMapping:"channel.mute4"},{cc:64,name:"R1"},{cc:65,name:"R2"},{cc:66,name:"R3"},{cc:67,name:"R4"},{cc:41,name:"Play",defaultMapping:"transport.play"},{cc:42,name:"Stop",defaultMapping:"transport.stop"},{cc:43,name:"Rewind",defaultMapping:"nav.toStart"},{cc:44,name:"Forward",defaultMapping:"nav.toEnd"},{cc:45,name:"Record",defaultMapping:"transport.record"},{cc:46,name:"Cycle",defaultMapping:"transport.loop"}],extras:{faders:[{cc:0,name:"Fader 1"},{cc:1,name:"Fader 2"},{cc:2,name:"Fader 3"},{cc:3,name:"Fader 4"},{cc:4,name:"Fader 5"},{cc:5,name:"Fader 6"},{cc:6,name:"Fader 7"},{cc:7,name:"Fader 8"}]}},{id:"behringer-xtouch-mini",name:"X-Touch Mini",manufacturer:"Behringer",detectPatterns:["x-touch","xtouch","behringer x-touch"],knobs:[{cc:1,name:"Encoder 1",defaultMapping:"tb303.cutoff"},{cc:2,name:"Encoder 2",defaultMapping:"tb303.resonance"},{cc:3,name:"Encoder 3",defaultMapping:"tb303.envMod"},{cc:4,name:"Encoder 4",defaultMapping:"tb303.decay"},{cc:5,name:"Encoder 5",defaultMapping:"tb303.accent"},{cc:6,name:"Encoder 6",defaultMapping:"tb303.overdrive"},{cc:7,name:"Encoder 7",defaultMapping:"tb303.slideTime"},{cc:8,name:"Encoder 8"}],pads:[{note:0,name:"Button 1",defaultMapping:"transport.play"},{note:1,name:"Button 2",defaultMapping:"transport.stop"},{note:2,name:"Button 3",defaultMapping:"transport.record"},{note:3,name:"Button 4",defaultMapping:"transport.loop"},{note:4,name:"Button 5"},{note:5,name:"Button 6"},{note:6,name:"Button 7"},{note:7,name:"Button 8"},{note:8,name:"Button 9"},{note:9,name:"Button 10"},{note:10,name:"Button 11"},{note:11,name:"Button 12"},{note:12,name:"Button 13"},{note:13,name:"Button 14"},{note:14,name:"Button 15"},{note:15,name:"Button 16"}],extras:{faders:[{cc:9,name:"Fader"}]}},{id:"generic",name:"Generic MIDI Controller",manufacturer:"Unknown",detectPatterns:[],knobs:[{cc:1,name:"CC 1"},{cc:7,name:"CC 7 (Volume)"},{cc:10,name:"CC 10 (Pan)"},{cc:11,name:"CC 11 (Expression)"},{cc:74,name:"CC 74 (Cutoff)"},{cc:71,name:"CC 71 (Resonance)"}],pads:[],extras:{pitchBend:!0,modWheel:{cc:1},sustain:{cc:64}}}];function Gk(e){const t=e.toLowerCase();for(const a of Uk)for(const e of a.detectPatterns)if(t.includes(e.toLowerCase()))return a;return null}const Wk=({isOpen:e,onClose:t})=>{const{devices:a,isSupported:n,isEnabled:r,lastMessage:i,enableMIDI:o}=Rk(),l=vx(),c=Bv(e=>e.instruments);s.useEffect(()=>{e&&r&&l.init()},[e,r,l]);const[u,d]=s.useState("devices"),[p,m]=s.useState(null),[h,f]=s.useState(null),[y,g]=s.useState(!1),[b,v]=s.useState(null),[x,w]=s.useState([]),[k,S]=s.useState(new Set(["Transport","303 Main"])),[M,N]=s.useState(l.getGlobalSensitivity()),[C,P]=s.useState(!1),[E,_]=s.useState("idle"),[T,A]=s.useState(l.getControlledInstrument());s.useEffect(()=>l.onControlledInstrumentChange(e=>{A(e)}),[l]);const O=s.useCallback(e=>{l.setControlledInstrument(e),A(e)},[l]);s.useEffect(()=>{if(r&&a.length>0){const e=Lk();requestAnimationFrame(()=>P(e.checkConnection()))}},[r,a]);const I=s.useCallback(async()=>{const e=Lk();if(!e.checkConnection())return void _("error");_("syncing");const t={},a={70:1,71:2,72:3,73:4,74:5,75:6,76:7,77:8};x.forEach(e=>{const n=a[e.ccNumber];n&&e.displayName&&(t[n]=e.displayName.substring(0,16))});try{const a=await e.setKnobNames(t);_(a?"success":"error"),a&&setTimeout(()=>_("idle"),2e3)}catch{_("error")}},[x]),F=s.useCallback(async()=>{const e=Lk();_("syncing");try{const t=await e.applyDEViLBOXPreset();_(t?"success":"error"),t&&setTimeout(()=>_("idle"),2e3)}catch{_("error")}},[]),D=s.useCallback(()=>{w(l.getAllMappings())},[l]);s.useEffect(()=>{if(a.length>0){const e=Gk(a[0].name||"");requestAnimationFrame(()=>{m(e),e&&!h&&f(e)})}},[a,h]),s.useEffect(()=>(requestAnimationFrame(()=>D()),l.onMappingChange(D)),[l,D]),s.useEffect(()=>{if(!y||!b)return;return l.onLearnChange(e=>{e||(g(!1),v(null),D())})},[y,b,l,D]);const R=async e=>{g(!0),v(e);const t=await l.startLearn(0,e.id,e.label,"parameter"===e.type?e.min:0,"parameter"===e.type?e.max:127,"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear");t&&l.setMapping({id:`${t.channel}-${t.ccNumber}-${e.id}`,ccNumber:t.ccNumber,midiChannel:t.channel,instrumentId:0,parameterPath:e.id,min:"parameter"===e.type?e.min:0,max:"parameter"===e.type?e.max:127,curve:"parameter"===e.type&&e.id.includes("cutoff")?"logarithmic":"linear",displayName:e.label}),g(!1),v(null)},j=()=>{h&&(h.knobs.forEach(e=>{if(e.defaultMapping){const t=zk[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:t.min,max:t.max,curve:e.defaultMapping.includes("cutoff")?"logarithmic":"linear",displayName:t.label})}}),h.pads.forEach(e=>{if(e.defaultMapping&&void 0!==e.cc){const t=Vk[e.defaultMapping];t&&l.setMapping({id:`suggested-${e.cc}-${e.defaultMapping}`,ccNumber:e.cc,instrumentId:0,parameterPath:e.defaultMapping,min:0,max:127,curve:"linear",displayName:t.label})}}),D())},B=()=>{l.clearAllMappings(),D()},L=e=>{S(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},V=e=>x.some(t=>t.parameterPath===e),z=e=>x.find(t=>t.parameterPath===e);if(!e)return null;const U=Object.entries(zk).reduce((e,[t,a])=>{const n=a.category;return e[n]||(e[n]=[]),e[n].push({id:t,...a}),e},{}),G=Object.entries(Vk).reduce((e,[t,a])=>{const n=a.category;return e[n]||(e[n]=[]),e[n].push({id:t,...a}),e},{});return Ea.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:Ea.jsxs("div",{className:"bg-dark-bg border border-dark-border rounded-lg w-[800px] max-h-[85vh] flex flex-col",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Ea.jsxs("h2",{className:"text-lg font-semibold text-text-primary flex items-center gap-2",children:[Ea.jsx(Ce,{size:20}),"MIDI Controller Setup"]}),Ea.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary transition-colors",children:Ea.jsx(Pe,{size:20})})]}),y&&b&&Ea.jsxs("div",{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-10 rounded-lg",children:[Ea.jsx(Ee,{size:48,className:"text-accent-primary animate-spin mb-4"}),Ea.jsx("p",{className:"text-text-primary text-lg mb-2",children:"Move a controller to map to:"}),Ea.jsx("p",{className:"text-accent-primary text-xl font-bold mb-4",children:b.label}),i&&"cc"===i.type&&Ea.jsxs("p",{className:"text-text-muted text-sm mb-4",children:["Last: CH",i.channel+1," CC",i.controller," = ",i.value]}),Ea.jsx("button",{onClick:()=>{l.cancelLearn(),g(!1),v(null)},className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Cancel"})]}),Ea.jsx("div",{className:"flex border-b border-dark-border",children:[{id:"devices",label:"Devices",icon:Ce},{id:"parameters",label:"TB-303",icon:_e},{id:"actions",label:"Tracker",icon:Te},{id:"mappings",label:"Mappings",icon:Ae},{id:"settings",label:"Settings",icon:Oe}].map(e=>Ea.jsxs("button",{onClick:()=>d(e.id),className:`\n                flex items-center gap-2 px-4 py-2.5 text-sm font-medium transition-colors\n                ${u===e.id?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-secondary"}\n              `,children:[Ea.jsx(e.icon,{size:16}),e.label]},e.id))}),Ea.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:["devices"===u&&Ea.jsx("div",{className:"space-y-4",children:n?r?0===a.length?Ea.jsxs("div",{className:"text-center py-8",children:[Ea.jsx(Ce,{size:48,className:"mx-auto text-text-muted mb-4"}),Ea.jsx("p",{className:"text-text-secondary",children:"No MIDI devices detected"}),Ea.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Connect a MIDI controller and refresh"})]}):Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("div",{children:[Ea.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Connected Devices"}),Ea.jsx("div",{className:"space-y-2",children:a.map(e=>Ea.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded p-3",children:[Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsx("span",{className:"w-3 h-3 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),Ea.jsxs("div",{children:[Ea.jsx("div",{className:"text-text-primary font-medium",children:e.name}),Ea.jsx("div",{className:"text-text-muted text-xs",children:e.manufacturer})]})]}),p&&e.name?.toLowerCase().includes(p.detectPatterns[0])&&Ea.jsxs("span",{className:"text-xs bg-accent-primary/20 text-accent-primary px-2 py-1 rounded",children:["Auto-detected: ",p.name]})]},e.id))})]}),Ea.jsxs("div",{children:[Ea.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Controller Profile"}),Ea.jsxs("select",{value:h?.id||"",onChange:e=>{const t=Uk.find(t=>t.id===e.target.value);f(t||null)},className:"w-full bg-dark-bgSecondary border border-dark-border rounded px-3 py-2 text-text-primary",children:[Ea.jsx("option",{value:"",children:"Select a profile..."}),Uk.map(e=>Ea.jsxs("option",{value:e.id,children:[e.manufacturer," ",e.name]},e.id))]})]}),h&&Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[Ea.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ea.jsxs("h4",{className:"text-sm font-medium text-text-primary",children:[h.manufacturer," ",h.name]}),Ea.jsx("button",{onClick:j,className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white text-sm rounded transition-colors",children:"Apply Suggested Mappings"})]}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-text-muted",children:"Knobs:"})," ",Ea.jsx("span",{className:"text-text-secondary",children:h.knobs.length})]}),Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-text-muted",children:"Pads:"})," ",Ea.jsx("span",{className:"text-text-secondary",children:h.pads.length})]}),h.extras?.faders&&Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-text-muted",children:"Faders:"})," ",Ea.jsx("span",{className:"text-text-secondary",children:h.extras.faders.length})]})]})]})]}):Ea.jsxs("div",{className:"text-center py-8",children:[Ea.jsx(Ce,{size:48,className:"mx-auto text-text-muted mb-4"}),Ea.jsx("p",{className:"text-text-secondary mb-4",children:"Enable MIDI to connect your controller"}),Ea.jsx("button",{onClick:o,className:"px-6 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded font-medium transition-colors",children:"Enable MIDI"})]}):Ea.jsxs("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-4",children:[Ea.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[Ea.jsx(Ie,{size:20}),Ea.jsx("span",{children:"Web MIDI API not supported"})]}),Ea.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})}),"parameters"===u&&Ea.jsx("div",{className:"space-y-3",children:Object.entries(U).map(([e,t])=>Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[Ea.jsxs("button",{onClick:()=>L(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[Ea.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?Ea.jsx(Me,{size:16,className:"text-text-muted"}):Ea.jsx(Fe,{size:16,className:"text-text-muted"})]}),k.has(e)&&Ea.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),a=z(e.id),n=y&&b?.id===e.id;return Ea.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${n?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[t&&Ea.jsx(De,{size:14,className:"text-accent-success"}),Ea.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[a&&Ea.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",a.ccNumber]}),Ea.jsx("button",{onClick:()=>R({type:"parameter",id:e.id,label:e.label,min:e.min,max:e.max,category:e.category}),disabled:y,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${n?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:n?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"actions"===u&&Ea.jsx("div",{className:"space-y-3",children:Object.entries(G).map(([e,t])=>Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded overflow-hidden",children:[Ea.jsxs("button",{onClick:()=>L(e),className:"w-full flex items-center justify-between px-3 py-2 hover:bg-dark-bgActive transition-colors",children:[Ea.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e}),k.has(e)?Ea.jsx(Me,{size:16,className:"text-text-muted"}):Ea.jsx(Fe,{size:16,className:"text-text-muted"})]}),k.has(e)&&Ea.jsx("div",{className:"px-3 pb-3 grid grid-cols-2 gap-2",children:t.map(e=>{const t=V(e.id),a=z(e.id),n=y&&b?.id===e.id;return Ea.jsxs("div",{className:`\n                              flex items-center justify-between px-3 py-2 rounded text-sm\n                              ${n?"bg-accent-primary text-white":t?"bg-accent-success/20 border border-accent-success/30":"bg-dark-bgTertiary"}\n                            `,children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[t&&Ea.jsx(De,{size:14,className:"text-accent-success"}),Ea.jsx("span",{className:t?"text-accent-success":"text-text-secondary",children:e.label})]}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[a&&Ea.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:["CC",a.ccNumber]}),Ea.jsx("button",{onClick:()=>R({type:"action",id:e.id,label:e.label,category:e.category}),disabled:y,className:`\n                                  px-2 py-0.5 rounded text-xs transition-colors\n                                  ${n?"bg-white/20":"bg-dark-bgActive hover:bg-accent-primary/20 text-text-muted hover:text-accent-primary"}\n                                `,children:n?"Learning...":"Learn"})]})]},e.id)})})]},e))}),"mappings"===u&&Ea.jsx("div",{className:"space-y-4",children:0===x.length?Ea.jsxs("div",{className:"text-center py-8",children:[Ea.jsx(Ae,{size:48,className:"mx-auto text-text-muted mb-4"}),Ea.jsx("p",{className:"text-text-secondary",children:"No mappings configured"}),Ea.jsx("p",{className:"text-text-muted text-sm mt-2",children:"Go to TB-303 or Tracker tabs to create mappings"})]}):Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("div",{className:"flex justify-end",children:Ea.jsxs("button",{onClick:B,className:"flex items-center gap-1 text-sm text-accent-error hover:underline",children:[Ea.jsx(Re,{size:14}),"Clear All"]})}),Ea.jsx("div",{className:"space-y-2",children:x.map(e=>Ea.jsxs("div",{className:"flex items-center justify-between bg-dark-bgSecondary rounded px-4 py-3",children:[Ea.jsxs("div",{children:[Ea.jsx("div",{className:"text-text-primary font-medium",children:e.displayName||e.parameterPath}),Ea.jsx("div",{className:"text-text-muted text-xs",children:e.parameterPath})]}),Ea.jsxs("div",{className:"flex items-center gap-4",children:[Ea.jsxs("div",{className:"text-right",children:[Ea.jsxs("div",{className:"text-text-secondary font-mono text-sm",children:[void 0!==e.midiChannel?`CH${e.midiChannel+1} `:"","CC",e.ccNumber]}),Ea.jsxs("div",{className:"text-text-muted text-xs",children:[e.min," - ",e.max," (",e.curve,")"]})]}),Ea.jsx("button",{onClick:()=>{return t=e.id,l.removeMapping(t),void D();var t},className:"text-accent-error hover:text-accent-error/80 transition-colors",children:Ea.jsx(Re,{size:16})})]})]},e.id))})]})}),"settings"===u&&Ea.jsxs("div",{className:"space-y-6",children:[Ea.jsxs("div",{children:[Ea.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Knob Sensitivity"}),Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[Ea.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ea.jsx("span",{className:"text-text-muted text-sm",children:"Slow (Smooth)"}),Ea.jsx("span",{className:"text-text-primary font-mono",children:M.toFixed(2)}),Ea.jsx("span",{className:"text-text-muted text-sm",children:"Fast (Direct)"})]}),Ea.jsx("input",{type:"range",min:"0.05",max:"1",step:"0.05",value:M,onChange:e=>{return t=parseFloat(e.target.value),N(t),void l.setGlobalSensitivity(t);var t},className:"w-full accent-accent-primary"}),Ea.jsx("p",{className:"text-text-muted text-xs mt-2",children:"Lower values make knobs respond more smoothly but slower. Higher values give immediate response."})]})]}),Ea.jsxs("div",{children:[Ea.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[Ea.jsx(_e,{size:16}),"Controlled Instrument"]}),Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4",children:[Ea.jsxs("select",{value:T??"all",onChange:e=>{const t=e.target.value;O("all"===t?null:parseInt(t))},className:"w-full bg-dark-bgTertiary border border-dark-border rounded px-3 py-2 text-text-primary mb-2",children:[Ea.jsx("option",{value:"all",children:"All TB-303 Instruments"}),c.map(e=>Ea.jsxs("option",{value:e.id,children:[e.id,". ",e.name," (",e.synthType||"Sampler",")"]},e.id))]}),Ea.jsx("p",{className:"text-text-muted text-xs",children:'Choose which instrument responds to MIDI CC knobs. "All TB-303" controls every TB-303 synth at once.'})]})]}),Ea.jsxs("div",{children:[Ea.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Quick Setup"}),Ea.jsxs("div",{className:"space-y-2",children:[Ea.jsxs("button",{onClick:j,disabled:!h,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgSecondary disabled:text-text-muted text-white rounded font-medium transition-colors",children:[Ea.jsx(Ae,{size:18}),"Apply Suggested Mappings"]}),Ea.jsxs("button",{onClick:B,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:[Ea.jsx(Re,{size:18}),"Clear All Mappings"]})]})]}),C&&Ea.jsxs("div",{children:[Ea.jsxs("h3",{className:"text-sm font-medium text-text-secondary mb-3 flex items-center gap-2",children:[Ea.jsx(je,{size:16}),"MPK Mini MK3 Display"]}),Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded p-4 space-y-3",children:[Ea.jsx("p",{className:"text-text-muted text-xs",children:"Sync parameter names to your MPK Mini's OLED display. Names will show when you turn the knobs."}),Ea.jsxs("div",{className:"space-y-2",children:[Ea.jsxs("button",{onClick:I,disabled:"syncing"===E||0===x.length,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 disabled:bg-dark-bgTertiary disabled:text-text-muted text-white rounded text-sm transition-colors",children:[Ea.jsx(je,{size:16}),"syncing"===E?"Syncing...":"Sync Current Mappings"]}),Ea.jsxs("button",{onClick:F,disabled:"syncing"===E,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-sm transition-colors",children:[Ea.jsx(Ae,{size:16}),"Apply DEViLBOX Preset (TB-303)"]})]}),"success"===E&&Ea.jsxs("p",{className:"text-accent-success text-xs flex items-center gap-1",children:[Ea.jsx(De,{size:12})," Display updated!"]}),"error"===E&&Ea.jsxs("p",{className:"text-accent-error text-xs flex items-center gap-1",children:[Ea.jsx(Ie,{size:12})," Failed to update display"]})]})]}),Ea.jsxs("div",{children:[Ea.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Supported Controllers"}),Ea.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Uk.filter(e=>"generic"!==e.id).map(e=>Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded px-3 py-2 text-text-muted",children:[e.manufacturer," ",e.name]},e.id))})]})]})]}),Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-dark-border",children:[Ea.jsxs("div",{className:"text-xs text-text-muted",children:[x.length," mapping",1!==x.length?"s":""," active"]}),Ea.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgSecondary hover:bg-dark-bgActive text-text-secondary rounded transition-colors",children:"Close"})]})]})})},Hk=()=>{const e=Gw(e=>e.nksKnobAssignments),t=Gw(e=>e.nksKnobPage),a=Gw(e=>e.nksKnobTotalPages),n=Gw(e=>e.nksActiveSynthType),s=Gw(e=>e.nextKnobPage),r=Gw(e=>e.prevKnobPage),i=Gw(e=>e.outputDevices).some(e=>e.name?.toLowerCase().includes("mpk mini"));return Ea.jsxs("div",{className:"nks-settings-panel p-4 space-y-3",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{children:[Ea.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"NKS Performance"}),n&&Ea.jsx("div",{className:"text-xs text-accent-primary mt-0.5",children:n})]}),a>1&&Ea.jsxs("div",{className:"text-xs text-text-muted font-mono",children:["Page ",t+1,"/",a]})]}),e.length>0?Ea.jsxs("div",{className:"space-y-2",children:[Ea.jsx("div",{className:"grid grid-cols-4 gap-1.5",children:e.map((e,t)=>Ea.jsxs("div",{className:"flex flex-col items-center p-1.5 rounded bg-dark-bgSecondary border border-dark-border",children:[Ea.jsxs("span",{className:"text-[8px] font-mono text-text-muted",children:["K",t+1]}),Ea.jsx("span",{className:"text-[10px] font-bold text-accent-primary uppercase truncate w-full text-center",children:e.label})]},`${e.param}-${t}`))}),a>1&&Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("button",{onClick:r,className:"flex-1 px-2 py-1 bg-dark-bgSecondary hover:bg-dark-bgHover text-text-secondary rounded transition-colors text-xs",children:"Prev"}),Ea.jsxs("div",{className:"px-3 py-1 bg-dark-bgSecondary rounded text-text-primary text-xs font-mono",children:[t+1," / ",a]}),Ea.jsx("button",{onClick:s,className:"flex-1 px-2 py-1 bg-dark-bgSecondary hover:bg-dark-bgHover text-text-secondary rounded transition-colors text-xs",children:"Next"})]})]}):Ea.jsx("div",{className:"text-xs text-text-muted py-2",children:"Play a note to auto-detect synth and load knob assignments."}),i&&Ea.jsxs("div",{className:"space-y-1.5 pt-2 border-t border-dark-border",children:[Ea.jsx("div",{className:"text-[10px] font-medium text-text-muted uppercase",children:"Display"}),Ea.jsx("button",{onClick:async()=>{await Fw(" ** TEST ","** READY"),setTimeout(()=>{Fw("DEViLBOX"," Tracker ")},2e3)},className:"w-full px-3 py-1.5 bg-accent-primary/20 hover:bg-accent-primary/30 text-accent-primary rounded transition-colors text-xs",children:"Test Display"}),Ea.jsx("div",{className:"text-[9px] text-text-muted",children:"MK3 pad LEDs are hardware-only (not MIDI controllable)"})]})]})},Kk=e.memo(()=>{const[e,t]=s.useState(!1),[a,n]=s.useState(!1),[r,i]=s.useState(!1),o=s.useRef(null),l=Gw(e=>e.isSupported),c=Gw(e=>e.isInitialized),u=Gw(e=>e.lastError),d=Gw(e=>e.inputDevices),p=Gw(e=>e.outputDevices),m=Gw(e=>e.selectedInputId),h=Gw(e=>e.selectedOutputId),f=Gw(e=>e.isLearning),y=Gw(e=>e.lastActivityTimestamp),g=Gw(e=>e.init),b=Gw(e=>e.selectInput),v=Gw(e=>e.selectOutput),x=Gw(e=>e.cancelLearn),w=Gw(e=>e.openPatternDialog);s.useEffect(()=>{c||null!==l||(requestAnimationFrame(()=>n(!0)),g().finally(()=>requestAnimationFrame(()=>n(!1))))},[c,l,g]),s.useEffect(()=>{if(!e)return;const a=e=>{o.current&&!o.current.contains(e.target)&&(t(!1),f&&x())};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[e,f,x]);const[k,S]=s.useState(!1);s.useEffect(()=>{if(y>0){requestAnimationFrame(()=>S(!0));const e=setTimeout(()=>S(!1),100);return()=>clearTimeout(e)}},[y]);const M=fx();return Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("div",{className:"relative",ref:o,children:[Ea.jsxs("button",{onClick:()=>t(!e),className:`\n          flex items-center gap-2 px-2 py-1 rounded text-sm font-medium\n          transition-all duration-150\n          ${e?"bg-dark-bgActive text-text-primary":"hover:bg-dark-bgHover"}\n          ${null===l||!1===l?"text-text-muted":u?"text-accent-error":c?m||h?"text-accent-success":"text-accent-warning":"text-text-muted"}\n        `,title:l?c?m||h?"MIDI connected":"No MIDI device":"MIDI not initialized":"MIDI not supported",children:[Ea.jsxs("div",{className:"relative",children:[Ea.jsx(Ce,{size:16}),k&&Ea.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-accent-primary rounded-full animate-ping"})]}),Ea.jsx("span",{className:"hidden sm:inline",children:"MIDI"})]}),e&&Ea.jsxs("div",{className:"absolute right-0 top-full mt-1 w-80 max-h-[80vh] bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl z-50 overflow-y-auto",children:[Ea.jsxs("div",{className:"px-4 py-3 border-b border-dark-border bg-dark-bgSecondary",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("h3",{className:"text-sm font-bold text-text-primary",children:"MIDI Settings"}),a&&Ea.jsx(Be,{size:14,className:"animate-spin text-accent-primary"})]}),u&&Ea.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-accent-error",children:[Ea.jsx(Ie,{size:12}),Ea.jsx("span",{children:u})]})]}),!1===l?Ea.jsxs("div",{className:"px-4 py-6",children:[Ea.jsx("div",{className:"flex items-center gap-2 mb-3 justify-center",children:M.isIOS||M.instructions?.includes("Android")?Ea.jsx(Le,{size:24,className:"text-text-muted"}):Ea.jsx(Ie,{size:24,className:"text-text-muted"})}),Ea.jsx("p",{className:"text-sm text-text-secondary text-center mb-3",children:"Web MIDI API is not supported in this browser."}),M.isIOS&&Ea.jsxs("div",{className:"text-xs bg-accent-warning/10 border border-accent-warning/30 rounded p-3 mb-3",children:[Ea.jsx("p",{className:"font-bold text-accent-warning mb-2",children:"Safari Troubleshooting:"}),Ea.jsxs("ul",{className:"list-disc list-inside space-y-1 text-text-secondary",children:[Ea.jsxs("li",{children:["Make sure you're using ",Ea.jsx("strong",{children:"Safari"})," (not Chrome on iOS)"]}),Ea.jsxs("li",{children:["Web MIDI requires ",Ea.jsx("strong",{children:"HTTPS"})," - check the URL starts with https://"]}),Ea.jsxs("li",{children:["Disable ",Ea.jsx("strong",{children:"Private Browsing Mode"})," - MIDI doesn't work in private mode"]}),Ea.jsxs("li",{children:["Update to ",Ea.jsx("strong",{children:"iOS 15+"})," for full MIDI support"]}),Ea.jsx("li",{children:"Check browser console for detailed error messages"})]})]}),M.instructions&&Ea.jsx("div",{className:"text-xs text-text-muted text-left bg-dark-bgSecondary rounded p-3 max-h-64 overflow-y-auto whitespace-pre-line",children:M.instructions})]}):null===l?Ea.jsxs("div",{className:"px-4 py-6 text-center",children:[Ea.jsx(Be,{size:24,className:"mx-auto mb-2 text-text-muted animate-spin"}),Ea.jsx("p",{className:"text-sm text-text-secondary",children:"Checking MIDI support..."})]}):Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("div",{className:"px-4 py-3 space-y-3 border-b border-dark-border",children:[Ea.jsx(Dk,{label:"Input Device",devices:d,selectedId:m,onSelect:b}),Ea.jsx(Dk,{label:"Output Device",devices:p,selectedId:h,onSelect:v}),(M.isIOS||M.instructions?.includes("Android"))&&0===d.length&&0===p.length&&Ea.jsxs("div",{className:"mt-2 p-3 bg-dark-bgSecondary rounded border border-dark-border",children:[Ea.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Ea.jsx(Le,{size:14,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-xs font-medium text-text-primary",children:"Mobile MIDI Setup"})]}),Ea.jsx("div",{className:"text-xs text-text-muted whitespace-pre-line max-h-48 overflow-y-auto",children:M.instructions})]})]}),Ea.jsxs("div",{className:"px-4 py-2 border-b border-dark-border space-y-2",children:[Ea.jsxs("button",{onClick:()=>{t(!1),i(!0)},className:"w-full px-3 py-2 text-sm font-medium bg-accent-primary/20 border border-accent-primary/30 rounded flex items-center justify-center gap-2 hover:bg-accent-primary/30 transition-colors text-accent-primary",children:[Ea.jsx(Ve,{size:14}),"MIDI Controller Setup..."]}),Ea.jsxs("button",{onClick:()=>{t(!1),w()},className:"w-full px-3 py-2 text-sm font-medium bg-dark-bgActive rounded flex items-center justify-center gap-2 hover:bg-dark-bgHover transition-colors",children:[Ea.jsx(ze,{size:14}),"TD-3 Patterns..."]})]}),Ea.jsx("div",{className:"border-t border-dark-border",children:Ea.jsx(Hk,{})}),m&&Ea.jsx("div",{className:"px-4 py-2 border-t border-dark-border bg-dark-bgSecondary",children:Ea.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[Ea.jsx(Ue,{size:10,className:k?"text-accent-success":"text-text-muted"}),Ea.jsx("span",{children:k?"Receiving MIDI...":"Listening for MIDI input"})]})})]})]})]}),Ea.jsx(Wk,{isOpen:r,onClose:()=>i(!1)})]})}),qk=({variant:e="default",size:t="md",color:a="default",fullWidth:n=!1,loading:s=!1,icon:r,iconPosition:i="left",children:o,className:l="",disabled:c,...u})=>{const d={primary:"btn-primary",default:"btn",ghost:"btn-ghost",icon:"btn-icon",danger:"btn-danger",ft2:""},p={sm:"btn-sm",md:"btn-md",lg:"btn-lg",icon:""};let m="inline-flex items-center justify-center gap-2 font-medium transition-colors focus:outline-none";if("ft2"===e)m+=` ft2-btn ${{sm:"ft2-btn-small",md:"",lg:"",icon:""}[t]} ${{default:"",red:"ft2-btn-red",green:"ft2-btn-green",yellow:"ft2-btn-yellow",blue:"ft2-btn-blue",purple:"ft2-btn-purple",cyan:"",amber:""}[a]}`;else{m+=` ${d[e]||d.default}`,p[t]&&(m+=` ${p[t]}`)}n&&(m+=" w-full"),(c||s)&&(m+=" opacity-50 cursor-not-allowed"),l&&(m+=` ${l}`);const h=Ea.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[Ea.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Ea.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});return Ea.jsxs("button",{...u,className:m,disabled:c||s,children:[s&&h,!s&&r&&"left"===i&&r,o,!s&&r&&"right"===i&&r]})},$k=({isOpen:e,onClose:t})=>{if(!e)return null;const a=[{name:"Windows",icon:Ea.jsx(je,{size:24}),desc:"Installer (.exe) or Portable (.zip)",color:"text-blue-400"},{name:"macOS",icon:Ea.jsx(He,{size:24}),desc:"Disk Image (.dmg) for Intel/Apple Silicon",color:"text-gray-300"},{name:"Linux",icon:Ea.jsx(Ke,{size:24}),desc:"AppImage, Debian, or Tarball",color:"text-orange-400"}];return Ea.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[100] animate-fade-in",children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-xl shadow-2xl w-full max-w-lg mx-4 overflow-hidden animate-slide-in-up",children:[Ea.jsxs("div",{className:"bg-dark-bgTertiary px-6 py-4 flex items-center justify-between border-b border-dark-border",children:[Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsx("div",{className:"p-2 rounded-lg bg-accent-primary/20 text-accent-primary",children:Ea.jsx(Ge,{size:20})}),Ea.jsxs("div",{children:[Ea.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Download DEViLBOX"}),Ea.jsx("p",{className:"text-xs text-text-muted font-mono",children:"Native Desktop Applications"})]})]}),Ea.jsx(qk,{variant:"icon",size:"icon",onClick:t,"aria-label":"Close dialog",children:Ea.jsx(Pe,{size:20})})]}),Ea.jsxs("div",{className:"p-6",children:[Ea.jsx("p",{className:"text-sm text-text-secondary mb-6 leading-relaxed",children:"Experience DEViLBOX with lower latency, better performance, and offline support. Native apps provide full access to system audio and MIDI resources."}),Ea.jsx("div",{className:"space-y-3",children:a.map(e=>Ea.jsxs("a",{href:"https://github.com/spotUP/DEViLBOX/releases/latest",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-4 p-4 rounded-xl border border-dark-border bg-dark-bg hover:bg-dark-bgHover hover:border-accent-primary/50 transition-all duration-200 shadow-sm",children:[Ea.jsx("div",{className:`p-3 rounded-lg bg-dark-bgSecondary ${e.color} group-hover:scale-110 transition-transform duration-200`,children:e.icon}),Ea.jsxs("div",{className:"flex-1",children:[Ea.jsx("h3",{className:"font-semibold text-text-primary group-hover:text-accent-primary transition-colors",children:e.name}),Ea.jsx("p",{className:"text-xs text-text-muted",children:e.desc})]}),Ea.jsx(We,{size:16,className:"text-text-muted group-hover:text-text-primary group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"})]},e.name))}),Ea.jsx("div",{className:"mt-8 pt-6 border-t border-dark-border text-center",children:Ea.jsx("p",{className:"text-[10px] text-text-muted font-mono uppercase tracking-widest",children:"Built with Electron & Tone.js"})})]})]})})},Xk=()=>"undefined"!=typeof window&&!0===window.electron?.isElectron,Yk=()=>Xk()&&!!window.electron?.fs,Zk=e.memo(()=>{const e=Xv(e=>e.metadata),t=Xv(e=>e.isDirty),a=$v(e=>e.masterVolume),n=$v(e=>e.setMasterVolume),r=rx(e=>e.tabs),i=rx(e=>e.activeTabId),o=rx(e=>e.addTab),l=rx(e=>e.closeTab),c=rx(e=>e.setActiveTab),u=rx(e=>e.updateTabName),d=rx(e=>e.markTabDirty),p=cx(e=>e.currentThemeId),m=cx(e=>e.setTheme),h=cx(e=>e.getCurrentTheme),[f,y]=s.useState(!1),[g,b]=s.useState(!1),v=h();s.useEffect(()=>{e.name&&i&&u(i,e.name)},[e.name,i,u]),s.useEffect(()=>{i&&d(i,t)},[t,i,d]),s.useEffect(()=>{if(!f)return;const e=e=>{e.target.closest("[data-theme-menu]")||y(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[f]);return Ea.jsxs("div",{className:"bg-dark-bgSecondary border-b border-dark-border relative z-40",children:[Ea.jsxs("nav",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-border",children:[Ea.jsxs("div",{className:"flex items-center gap-4",children:[Ea.jsx("h1",{className:"font-bold text-lg tracking-tight",children:Ea.jsx("span",{className:"text-accent-primary",children:"DEViLBOX"})}),Ea.jsxs("span",{className:"text-xs font-medium text-text-inverse bg-accent-primary px-2 py-0.5 rounded cursor-help",title:`${Tk}  2026-02-14`,children:["1.0.",_k]})]}),Ea.jsxs("div",{className:"flex items-center gap-4",children:[!Xk()&&Ea.jsx(qk,{variant:"primary",size:"sm",onClick:()=>b(!0),icon:Ea.jsx(Ge,{size:14}),iconPosition:"left",title:"Download Desktop App",children:Ea.jsx("span",{className:"hidden sm:inline uppercase whitespace-nowrap",children:"Desktop App"})}),Ea.jsx(Kk,{}),Ea.jsxs("div",{className:"relative","data-theme-menu":!0,children:[Ea.jsxs("button",{onClick:()=>y(!f),className:"flex items-center gap-2 px-2 py-1 rounded text-text-secondary hover:text-text-primary hover:bg-dark-bgHover transition-colors whitespace-nowrap",title:"Change theme",children:[Ea.jsx(qe,{size:16}),Ea.jsx("span",{className:"text-sm",children:v.name})]}),f&&Ea.jsx("div",{className:"absolute right-0 top-full mt-1 bg-dark-bgTertiary border border-dark-border rounded-md shadow-lg z-50 min-w-[140px]",children:ox.map(e=>Ea.jsxs("button",{onClick:()=>{m(e.id),y(!1)},className:`\n                      w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2\n                      ${p===e.id?"bg-dark-bgActive text-text-primary":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary"}\n                    `,children:[Ea.jsx("span",{className:"w-3 h-3 rounded-full border border-dark-borderLight",style:{backgroundColor:e.colors.accent}}),e.name]},e.id))})]}),Ea.jsx("input",{type:"range",value:a,onChange:e=>{const t=parseInt(e.target.value,10);n(t)},min:"-60",max:"0",step:"1",className:"w-24",title:`Volume: ${a} dB`})]})]}),Ea.jsxs("div",{className:"flex items-center px-2 py-1 border-b border-dark-border bg-dark-bgTertiary",children:[Ea.jsx("div",{className:"flex items-center gap-1 flex-1 overflow-x-auto scrollbar-none",children:r.map(e=>Ea.jsxs("button",{onClick:()=>c(e.id),className:`\n                group flex items-center gap-2 px-3 py-1.5 rounded-t-md text-sm font-medium\n                transition-all duration-150 min-w-0 max-w-[200px]\n                ${i===e.id?"bg-dark-bg text-text-primary border-t border-x border-dark-border -mb-px":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary hover:bg-dark-bg/50"}\n              `,children:[Ea.jsxs("span",{className:"truncate",children:[e.name||"Untitled",e.isDirty&&Ea.jsx("span",{className:"text-accent-primary ml-1",children:"*"})]}),r.length>1&&Ea.jsx("span",{onClick:t=>((e,t)=>{e.stopPropagation(),l(t)})(t,e.id),className:`\n                    flex-shrink-0 p-0.5 rounded hover:bg-dark-border/50\n                    ${i===e.id?"opacity-60 hover:opacity-100":"opacity-0 group-hover:opacity-60 hover:!opacity-100"}\n                  `,children:Ea.jsx(Pe,{size:12})})]},e.id))}),Ea.jsx("button",{onClick:()=>{o()},className:"flex-shrink-0 p-1.5 ml-1 rounded hover:bg-dark-border/50 text-text-muted hover:text-text-primary transition-colors",title:"New project tab",children:Ea.jsx($e,{size:16})})]}),Ea.jsx($k,{isOpen:g,onClose:()=>b(!1)})]})}),Qk=({onShowSettings:e,onShowExport:t,onShowHelp:a,onShowMasterFX:n,onShowPatterns:r,onLoad:i,onSave:o,onNew:l,onClear:c,onShowInstruments:u,onShowPatternOrder:d,onShowDrumpads:p,onShowGrooveSettings:m})=>{const[h,f]=s.useState(!1),y=e=>{e&&e(),f(!1)};return Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("button",{onClick:()=>f(!h),className:"fixed top-2 right-2 z-50 p-2 bg-dark-bgSecondary border border-dark-border rounded-lg shadow-lg hover:bg-dark-bgHover transition-colors","aria-label":"Menu",children:h?Ea.jsx(Pe,{size:24}):Ea.jsx(Xe,{size:24})}),h&&Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>f(!1)}),Ea.jsxs("div",{className:"fixed top-0 right-0 bottom-0 w-80 max-w-[85vw] bg-dark-bgTertiary border-l border-dark-border z-50 overflow-y-auto",children:[Ea.jsxs("div",{className:"sticky top-0 bg-dark-bgSecondary border-b border-dark-border p-4 flex items-center justify-between",children:[Ea.jsx("h2",{className:"font-bold text-lg text-text-primary",children:"Menu"}),Ea.jsx("button",{onClick:()=>f(!1),className:"p-1 hover:bg-dark-bgHover rounded transition-colors","aria-label":"Close menu",children:Ea.jsx(Pe,{size:20})})]}),Ea.jsxs("div",{className:"p-4 space-y-2",children:[Ea.jsxs("div",{className:"mb-4",children:[Ea.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3",children:"MIDI Settings"}),Ea.jsx("div",{className:"bg-dark-bgSecondary rounded-lg p-3",children:Ea.jsx(Kk,{})})]}),Ea.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3 mt-6",children:"File"}),i&&Ea.jsxs("button",{onClick:()=>y(i),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Ye,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Load"})]}),o&&Ea.jsxs("button",{onClick:()=>y(o),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Ze,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Save / Download"})]}),l&&Ea.jsxs("button",{onClick:()=>y(l),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Qe,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"New"})]}),c&&Ea.jsxs("button",{onClick:()=>y(c),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Re,{size:20,className:"text-accent-warning"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Clear"})]}),t&&Ea.jsxs("button",{onClick:()=>y(t),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Ge,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Export / Import"})]}),Ea.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3 mt-6",children:"View"}),d&&Ea.jsxs("button",{onClick:()=>y(d),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Je,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Pattern Order"})]}),u&&Ea.jsxs("button",{onClick:()=>y(u),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Te,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Instruments"})]}),p&&Ea.jsxs("button",{onClick:()=>y(p),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(et,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Drum Pads"})]}),r&&Ea.jsxs("button",{onClick:()=>y(r),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Ae,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Patterns"})]}),n&&Ea.jsxs("button",{onClick:()=>y(n),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(_e,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Master Effects"})]}),Ea.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase mb-2 px-3 mt-6",children:"Options"}),m&&Ea.jsxs("button",{onClick:()=>y(m),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(tt,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Groove Settings"})]}),e&&Ea.jsxs("button",{onClick:()=>y(e),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(Oe,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Settings"})]}),a&&Ea.jsxs("button",{onClick:()=>y(a),className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors text-left",children:[Ea.jsx(at,{size:20,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-text-primary font-medium",children:"Help"})]})]})]})]})]})};function Jk(){const[e,t]=s.useState(()=>{const e="undefined"!=typeof window?window.innerWidth:1024;return{width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024}});return s.useEffect(()=>{const e=()=>{const e=window.innerWidth;t({width:e,isMobile:e<768,isTablet:e>=768&&e<1024,isDesktop:e>=1024})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}const eS=({children:e,onShowSettings:t,onShowExport:a,onShowHelp:n,onShowMasterFX:s,onShowPatterns:r,onLoad:i,onSave:o,onNew:l,onClear:c,onShowInstruments:u,onShowPatternOrder:d,onShowDrumpads:p,onShowGrooveSettings:m})=>{const{isMobile:h}=Jk();return Ea.jsxs("div",{className:"h-screen flex flex-col bg-dark-bg text-text-primary overflow-y-hidden",children:[Ea.jsx("div",{className:h?"hidden":"block",children:Ea.jsx(Zk,{})}),h&&Ea.jsx(Qk,{onShowSettings:t,onShowExport:a,onShowHelp:n,onShowMasterFX:s,onShowPatterns:r,onLoad:i,onSave:o,onNew:l,onClear:c,onShowInstruments:u,onShowPatternOrder:d,onShowDrumpads:p,onShowGrooveSettings:m}),Ea.jsx("main",{className:"flex-1 flex min-h-0 overflow-y-hidden",children:e})]})};function tS(e){switch(e){case Ox:return"var(--color-synth-filter)";case Ix:return"var(--color-synth-envelope)";case Ax:return"var(--color-synth-accent)";case Fx:case Rx:return"var(--color-synth-pan)";case Dx:return"var(--color-synth-effects)";case Vx:case Lx:return"var(--color-synth-volume)";case jx:case Bx:return"var(--color-synth-drive)";default:return"var(--color-synth-filter)"}}function aS(e){const t={Cutoff:"Cut",Resonance:"Res",Volume:"Vol",Feedback:"Fb",Algorithm:"Alg",Decay:"Dec",Attack:"Atk",Release:"Rel",Sustain:"Sus",Detune:"Det",Level:"Lvl","Env Mod":"Env",Accent:"Acc",Tuning:"Tun",Waveform:"Wav",Distortion:"Dst",Portamento:"Prt",Unison:"Uni"};return t[e]?t[e]:e.replace(/[^A-Za-z0-9]/g,"").slice(0,3)}function nS(e){const t=ob(t=>t.patterns[t.currentPatternIndex]?.channels[e]?.instrumentId??null),a=Bv(Ua(e=>{if(null===t)return null;const a=e.instruments.find(e=>e.id===t);return a?{synthType:a.synthType,name:a.name}:null}));return s.useMemo(()=>{if(!a)return{params:[],groups:[],synthType:null,instrumentName:null};const e=function(e){return e.filter(e=>e.isAutomatable).map(e=>({key:e.id,name:e.name,shortLabel:aS(e.name),section:e.section,color:tS(e.section),min:e.min,max:e.max}))}(iw(a.synthType)),t=function(e){const t=new Map;for(const a of e)t.has(a.section)||t.set(a.section,[]),t.get(a.section).push(a);return Array.from(t.entries()).map(([e,t])=>({label:e,section:e,params:t}))}(e);return{params:e,groups:t,synthType:a.synthType,instrumentName:a.name}},[a])}const sS=20,rS=({patternId:e,patternLength:t,rowHeight:a,channelCount:n,channelWidth:r,rowNumWidth:i,scrollOffset:o,visibleStart:l,parameter:c="cutoff",prevPatternId:u,prevPatternLength:d,nextPatternId:p,nextPatternLength:m})=>{const h=Zv(e=>e.curves),f=Zv(e=>e.addPoint),y=Zv(e=>e.removePoint),[g,b]=s.useState(null),v=s.useRef(null),x=s.useMemo(()=>{const t=[];for(let a=0;a<n;a++){const n=h.find(t=>t.patternId===e&&t.channelIndex===a&&t.parameter===c);t.push(n&&n.points.length>0?n:null)}return t},[e,n,c,h]),w=s.useMemo(()=>{if(!u)return[];const e=[];for(let t=0;t<n;t++){const a=h.find(e=>e.patternId===u&&e.channelIndex===t&&e.parameter===c);e.push(a&&a.points.length>0?a:null)}return e},[u,n,c,h]),k=s.useMemo(()=>{if(!p)return[];const e=[];for(let t=0;t<n;t++){const a=h.find(e=>e.patternId===p&&e.channelIndex===t&&e.parameter===c);e.push(a&&a.points.length>0?a:null)}return e},[p,n,c,h]),S=function(e){const t=ob(e=>e.patterns),a=ob(e=>e.currentPatternIndex),n=Bv(e=>e.instruments);return s.useMemo(()=>{const s=t[a];if(!s)return"var(--color-synth-filter)";for(const t of s.channels){if(null===t.instrumentId)continue;const a=n.find(e=>e.id===t.instrumentId);if(!a)continue;const s=iw(a.synthType).find(t=>t.id===e);if(s)return tS(s.section)}return"var(--color-synth-filter)"},[e,t,a,n])}(c),M=u?d||t:0,N=p?m||t:0,C=M*a+t*a+N*a,P=s.useCallback((e,n,s,r,i)=>{if(0!==e.button)return;e.preventDefault(),e.stopPropagation();const o=v.current?.getBoundingClientRect();if(!o)return;const l=e.clientY-o.top-i,c=Math.floor(l/a);if(c<0||c>=t)return;const u=e.clientX-o.left-r,d=Math.max(0,Math.min(1,(u-1)/18));f(n.id,c,d),b({curveId:n.id,row:c,channelIndex:s})},[t,a,f]),E=s.useCallback(e=>{if(!g||!v.current)return;const n=v.current.getBoundingClientRect(),s=x[g.channelIndex];if(!s)return;const i=g.channelIndex*r+r-sS-4,o=M*a,l=e.clientY-n.top-o,c=Math.floor(l/a);if(c<0||c>=t)return;const u=e.clientX-n.left-i,d=Math.max(0,Math.min(1,(u-1)/18));f(s.id,c,d)},[g,x,r,M,a,t,f]),_=s.useCallback(()=>{b(null)},[]),T=s.useCallback((e,n,s)=>{const r=v.current?.getBoundingClientRect();if(!r)return;const i=e.clientY-r.top-s,o=Math.floor(i/a);if(o<0||o>=t)return;n.points.find(e=>e.row===o)&&y(n.id,o)},[t,a,y]);if(!(x.some(e=>null!==e)||w.some(e=>null!==e)||k.some(e=>null!==e)))return null;const A=(e,t,n,s,i,o)=>e.map((e,l)=>{if(!e)return null;const c=l*r+r-sS-4,u=t*a,d=n*a,p=[],m=[`M 20 ${u}`];for(let n=0;n<t;n++){const t=Xn(e.points,n,e.interpolation,e.mode);if(null!==t){const e=18*t+1,s=n*a+a/2;p.push(`${0===p.length?"M":"L"} ${e} ${s}`)}}for(let n=t-1;n>=0;n--){const t=Xn(e.points,n,e.interpolation,e.mode);if(null!==t){const e=18*t+1,s=n*a+a/2;m.push(`L ${e} ${s}`)}}return m.push("L 20 0 Z"),Ea.jsx("div",{style:{position:"absolute",left:c,top:d,width:sS,height:u,cursor:o?"crosshair":"default"},onMouseDown:o?t=>P(t,e,l,c,d):void 0,onDoubleClick:o?t=>T(t,e,d):void 0,children:Ea.jsxs("svg",{width:sS,height:u,children:[Ea.jsx("path",{d:m.join(" "),fill:S,fillOpacity:.1*s}),Ea.jsx("path",{d:p.join(" "),fill:"none",stroke:S,strokeWidth:1.5,strokeOpacity:.6*s,strokeLinecap:"round",strokeLinejoin:"round"}),1===s&&e.points.map((e,t)=>Ea.jsx("circle",{cx:18*e.value+1,cy:e.row*a+a/2,r:2,fill:S,fillOpacity:.8},t))]})},`${i}-${l}`)});return Ea.jsxs("div",{ref:v,className:"automation-lanes",style:{position:"absolute",top:o-l*a-M*a,left:i,right:0,height:C,zIndex:5},onMouseMove:E,onMouseUp:_,onMouseLeave:_,children:[w.length>0&&A(w,M,0,.5,"prev",!1),A(x,t,M,1,"current",!0),k.length>0&&A(k,N,M+t,.5,"next",!1)]})},iS=e.memo(({level:e,isActive:t})=>null);iS.displayName="ChannelVUMeter";const oS=25,lS=(e,t,a=0)=>{if(!t)return{bg:"transparent",glow:"none"};const n=`hsl(${a}, ${180===a?100:75+10*e}%, ${180===a?45+15*e:40+20*e}%)`;return{bg:n,glow:`0 0 6px ${n}`}},cS=s.memo(({channelWidth:e,scrollLeft:t=0})=>{const{patterns:a,currentPatternIndex:n}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),r=cx(e=>e.currentThemeId),i=Vv(e=>e.performanceQuality),o=a[n],l=o?.channels.length||4,c=s.useRef(null),u=s.useRef([]),d=s.useRef([]),p=s.useRef([]),m=s.useRef(null),h=s.useRef(200),f="cyan-lineart"===r?180:0;s.useEffect(()=>{p.current=Array(l).fill(null).map((e,t)=>({level:0,position:(t%2==0?-1:1)*oS*.5,direction:t%2==0?1:-1})),u.current=Array(l).fill(null),d.current=Array(l).fill(null).map(()=>Array(26).fill(null))},[l]),s.useEffect(()=>{const e=()=>{c.current&&(h.current=c.current.clientHeight,u.current.forEach(e=>{e&&(e.style.height=h.current-4+"px")}))};e();const t=new ResizeObserver(e);return c.current&&t.observe(c.current),()=>t.disconnect()},[]);const y=s.useRef(l),g=s.useRef(t),b=s.useRef(f);if(s.useEffect(()=>{y.current=l},[l]),s.useEffect(()=>{g.current=t},[t]),s.useEffect(()=>{b.current=f},[f]),s.useEffect(()=>{if("low"===i)return void(m.current&&(cancelAnimationFrame(m.current),m.current=null));const e=()=>{const t=Qg(),a=y.current,n=t.getChannelTriggerLevels(a);c.current&&(c.current.style.transform=`translateX(${-g.current}px)`);for(let e=0;e<a;e++){const t=p.current[e];if(!t)continue;const a=n[e]||0,s=.012*e;if(a>0)t.level=a;else{const e=.92-s;t.level=t.level*e,t.level<.01&&(t.level=0)}if(t.level>.02){const e=Math.abs(t.position)/oS,a=.8*(1-.7*Math.max(0,(e-.7)/.3));t.position+=a*t.direction,t.position>=oS?(t.position=oS,t.direction=-1):t.position<=-25&&(t.position=-25,t.direction=1)}const r=u.current[e];r&&(r.style.transform=`translateX(${t.position}px)`);const i=Math.round(26*t.level),o=d.current[e];if(o)for(let e=0;e<26;e++){const t=o[e];if(!t)continue;const a=e<i,n=e/25,{bg:s,glow:r}=lS(n,a,b.current);t.style.backgroundColor=s,t.style.boxShadow=r}}m.current=requestAnimationFrame(e)};return m.current=requestAnimationFrame(e),()=>{m.current&&(cancelAnimationFrame(m.current),m.current=null)}},[i]),"low"===i)return null;const v=e||260;return Ea.jsx("div",{ref:c,className:"vu-meters-overlay",children:Array(l).fill(0).map((t,a)=>{const n=(t=>{if(e)return t*v+v/2;if(!o)return t*v+v/2;let a=0;for(let e=0;e<t;e++){const t=o.channels[e]?.collapsed;a+=t?60:v}return a+(o.channels[t]?.collapsed?60:v)/2})(a);return Ea.jsx("div",{ref:e=>{u.current[a]=e},className:"vu-meter-vertical",style:{left:n-14+"px",width:"28px",height:"calc(100% - 4px)",display:"flex",flexDirection:"column-reverse",alignItems:"stretch",gap:"4px"},children:Array.from({length:26},(e,t)=>Ea.jsx("div",{ref:e=>{d.current[a]||(d.current[a]=[]),d.current[a][t]=e},style:{height:"4px",backgroundColor:"transparent",borderRadius:"1px"}},t))},a)})})});cS.displayName="ChannelVUMeters";var uS=l();const dS=({currentColor:e,onColorSelect:t})=>{const[a,n]=s.useState(!1),[r,i]=s.useState({top:0,left:0}),o=s.useRef(null),l=s.useRef(null);s.useEffect(()=>{if(a&&o.current){const e=o.current.getBoundingClientRect();i({top:e.bottom+4,left:e.left})}},[a]),s.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&o.current&&!o.current.contains(e.target)&&n(!1)};if(a)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[a]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&n(!1)};if(a)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]);const c=a?Ea.jsxs("div",{ref:l,className:"fixed bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-2 animate-fade-in",style:{top:r.top,left:r.left,zIndex:9999,minWidth:"140px"},children:[Ea.jsx("div",{className:"text-xs text-text-muted mb-2 px-1",children:"Channel Color"}),Ea.jsx("div",{className:"grid grid-cols-4 gap-1",children:cn.map((a,s)=>Ea.jsx("button",{type:"button",onClick:e=>((e,a)=>{a.stopPropagation(),t(e),n(!1)})(a,e),className:"w-7 h-7 rounded border-2 transition-all flex items-center justify-center "+(e===a?"border-accent-primary scale-110":"border-transparent hover:border-dark-borderLight hover:scale-105"),style:{backgroundColor:a||"transparent"},title:a||"No color",children:null===a&&Ea.jsx(Pe,{size:14,className:"text-text-muted"})},s))})]}):null;return Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("button",{ref:o,type:"button",onClick:e=>{e.stopPropagation(),e.preventDefault(),n(!a)},className:"p-1 rounded transition-colors "+(e?"text-text-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),style:e?{color:e}:void 0,title:"Channel Color",children:Ea.jsx(qe,{size:12})}),c&&uS.createPortal(c,document.body)]})},pS=({items:e,position:t,onClose:a,className:n=""})=>{const r=s.useRef(null),[i,o]=s.useState(t),[l,c]=s.useState(null),[u,d]=s.useState(null),p=s.useRef(null);s.useEffect(()=>{if(!t||!r.current)return;const e=r.current.getBoundingClientRect(),a=window.innerWidth,n=window.innerHeight;let s=t.x,i=t.y;s+e.width>a-10&&(s=a-e.width-10),s<10&&(s=10),i+e.height>n-10&&(i=n-e.height-10),i<10&&(i=10);const l=requestAnimationFrame(()=>{o({x:s,y:i})});return()=>cancelAnimationFrame(l)},[t]),s.useEffect(()=>{const e=e=>{if(r.current&&!r.current.contains(e.target)){const t=e.target;if(t.closest?.("[data-context-menu]"))return;a()}},t=e=>{"Escape"===e.key&&a()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t),p.current&&clearTimeout(p.current)}},[a]);const m=s.useCallback((e,t)=>{p.current&&(clearTimeout(p.current),p.current=null);const a=t.getBoundingClientRect();c(e),d({x:a.right-2,y:a.top-4})},[]),h=s.useCallback(()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{c(null),d(null)},300)},[]),f=s.useCallback(()=>{p.current&&(clearTimeout(p.current),p.current=null)},[]);return t?uS.createPortal(Ea.jsx("div",{ref:r,"data-context-menu":!0,className:`\n        fixed z-[100] min-w-[180px] py-1\n        bg-dark-bgTertiary border border-dark-border rounded-lg shadow-xl\n        ${n}\n      `,style:{left:i?.x??t.x,top:i?.y??t.y},onMouseEnter:f,children:0===e.length?Ea.jsx("div",{className:"px-4 py-2 text-xs text-text-muted italic",children:"Empty"}):e.map((e,t)=>{if(!e)return null;if("divider"===e.type)return Ea.jsx("div",{className:"h-px bg-dark-border my-1 mx-2"},`divider-${t}`);const n=e.submenu&&e.submenu.length>0;return Ea.jsxs("div",{className:`\n                flex items-center gap-2 px-3 py-1.5 text-sm cursor-pointer transition-colors\n                ${e.disabled?"opacity-50 cursor-not-allowed":"hover:bg-dark-bgHover"}\n                ${e.danger?"text-accent-error hover:bg-accent-error/10":"text-text-secondary"}\n                ${l===e.id?"bg-dark-bgHover":""}\n              `,onClick:()=>{e.disabled||n||(e.onClick?.(),a())},onMouseEnter:t=>{n?m(e.id,t.currentTarget):(c(null),d(null))},onMouseLeave:()=>{n&&h()},children:[void 0!==e.checked&&Ea.jsx("span",{className:"w-4 flex justify-center",children:e.radio?e.checked?Ea.jsx(nt,{size:8,className:"fill-accent-primary text-accent-primary"}):null:e.checked?Ea.jsx(De,{size:14,className:"text-accent-primary"}):null}),e.icon&&Ea.jsx("span",{className:"w-4 flex justify-center",children:e.icon}),Ea.jsx("span",{className:"flex-1",children:e.label}),e.shortcut&&Ea.jsx("span",{className:"text-xs text-text-muted ml-4",children:e.shortcut}),n&&Ea.jsx(Fe,{size:14,className:"text-text-muted"}),n&&l===e.id&&u&&Ea.jsx(mS,{items:e.submenu,position:u,onClose:a})]},e.id)})}),document.body):null},mS=e=>Ea.jsx(pS,{...e}),hS=()=>{const[e,t]=s.useState(null);return{position:e,open:s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),t({x:e.clientX,y:e.clientY})},[]),close:s.useCallback(()=>{t(null)},[]),isOpen:null!==e}},fS=({items:e,children:t,className:a="",disabled:n=!1})=>{const r=s.useRef(null),[i,o]=s.useState(!1),[l,c]=s.useState(null),u=s.useCallback(()=>{if(!n&&r.current){const e=r.current.getBoundingClientRect();c({x:e.left,y:e.bottom+4}),o(!0)}},[n]),d=s.useCallback(()=>{o(!1),c(null)},[]);return Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("button",{ref:r,onClick:u,disabled:n,className:a,children:t}),i&&l&&Ea.jsx(pS,{items:e,position:l,onClose:d})]})},yS=()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}),gS=(e,t,a=64,n=!1)=>({note:e,instrument:t,volume:16+a,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:n?1:0});const bS={"4on4":{name:"4/4 Kicks",description:"Every 4 rows on beat",category:"drums",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[];for(let o=0;o<t;o++)if(o%4==0){const e=o%16==0;i.push(gS(n,a,s,r||e))}else i.push(yS());return i}},offbeat:{name:"Offbeat",description:"Every 4 rows, offset by 2",category:"drums",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=56,accent:r}=e,i=[];for(let o=0;o<t;o++)(o+2)%4==0?i.push(gS(n,a,s,r)):i.push(yS());return i}},"8ths":{name:"8th Notes",description:"Every 2 rows",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=56,accent:r}=e,i=[];for(let o=0;o<t;o++)if(o%2==0){const e=o%8==0;i.push(gS(n,a,e?s:s-8,r))}else i.push(yS());return i}},"16ths":{name:"16th Notes",description:"Every row",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=48,accent:r}=e,i=[];for(let o=0;o<t;o++){const e=o%4==0?s:o%2==0?s-8:s-16;i.push(gS(n,a,Math.max(16,e),r))}return i}},backbeat:{name:"Backbeat (2&4)",description:"Snare on beats 2 and 4",category:"drums",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[];for(let o=0;o<t;o++)o%16==4||o%16==12?i.push(gS(n,a,s,r)):i.push(yS());return i}},random:{name:"Random",description:"30% density random fill",category:"general",generate:e=>function(e,t=.3){const{patternLength:a,instrumentId:n,note:s,velocity:r=64,accent:i}=e,o=[];for(let l=0;l<a;l++)if(Math.random()<t){const e=Math.max(32,r-Math.floor(16*Math.random())),t=i||Math.random()<.25;o.push(gS(s,n,e,t))}else o.push(yS());return o}(e,.3)},build:{name:"Build",description:"Increasing density for transitions",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[],o=t/4;for(let l=0;l<t;l++){const e=Math.floor(l/o);let t;switch(e){case 0:t=8;break;case 1:default:t=4;break;case 2:t=2;break;case 3:t=1}if(l%t===0){const t=Math.min(64,s-16+8*e);i.push(gS(n,a,t,r))}else i.push(yS())}return i}},breakdown:{name:"Breakdown",description:"Sparse, minimal pattern",category:"general",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=48,accent:r}=e,i=[];for(let o=0;o<t;o++)o%16==0?i.push(gS(n,a,s,r)):i.push(yS());return i}},syncopated:{name:"Syncopated",description:"Offbeat acid pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=64,accent:r}=e,i=[],o=[0,3,8,11,14];for(let l=0;l<t;l++){const e=l%16;if(o.includes(e)){const t=3===e||11===e,o=gS(n,a,s,r);o.flag2=t?2:0,i.push(o)}else i.push(yS())}return i}},walking:{name:"Walking Bass",description:"Simple ascending pattern",category:"bass",generate:function(e){const{patternLength:t,instrumentId:a,note:n,velocity:s=56}=e,r=[],i=n||Qn("C-4"),o=ss(i);if(null===o)return r;const l=e=>{const t=o+e;return t>=12&&t<=107?rs(t):i},c=[0,5,7,5];for(let u=0;u<t;u++)if(u%4==0){const e=l(c[Math.floor(u/4)%c.length]);r.push(gS(e,a,s,!1))}else r.push(yS());return r}},hiHats:{name:"Hi-Hats",description:"Open/closed hat pattern",category:"drums",generate:function(e,t){const{patternLength:a,instrumentId:n,note:s,velocity:r=56,accent:i}=e,o=[],l=t||Qn("A#3");for(let c=0;c<a;c++)if(c%2==0){const e=(c+4)%8==0,t=e?l:s,a=e?r:r-8;o.push(gS(t,n,a,i))}else o.push(yS());return o}},clear:{name:"Clear",description:"Remove all notes",category:"general",generate:e=>{return t=e.patternLength,Array(t).fill(null).map(()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));var t}}},vS=[{name:"Clean Master",description:"Subtle compression and EQ for polished output",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.2}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:1,mid:0,high:.5}}]},{name:"Transparent",description:"Very light processing, preserves dynamics",category:"Clean",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:2,attack:.02,release:.3}}]},{name:"Stereo Wide",description:"Clean stereo enhancement for wider soundstage",category:"Clean",effects:[{category:"tonejs",type:"StereoWidener",enabled:!0,wet:100,parameters:{width:.7}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:2.5,attack:.015,release:.25}}]},{name:"Club Ready",description:"Punchy compression with subs, ready for the dancefloor",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.005,release:.15}}]},{name:"Techno Master",description:"Hard compression and subs for driving techno",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:-2,high:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}},{category:"tonejs",type:"Distortion",enabled:!0,wet:15,parameters:{distortion:.15}}]},{name:"Acid House",description:"Warm compression with subtle room reverb",category:"Club",effects:[{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3.5,attack:.01,release:.2}},{category:"tonejs",type:"Reverb",enabled:!0,wet:12,parameters:{decay:1.5,preDelay:.01}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}}]},{name:"Deep House",description:"Smooth and warm with controlled dynamics",category:"Club",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:1,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2.5,attack:.02,release:.3}},{category:"tonejs",type:"Chorus",enabled:!0,wet:15,parameters:{frequency:.5,depth:.3}}]},{name:"Lo-Fi Crunch",description:"Bit-crushed and filtered for retro vibes",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:40,parameters:{bits:8}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:8e3,type:"lowpass",Q:1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]},{name:"Tape Warmth",description:"Subtle saturation and filtering like vintage tape",category:"Lo-Fi",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.2}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:12e3,type:"lowpass",Q:.7}},{category:"tonejs",type:"Chorus",enabled:!0,wet:8,parameters:{frequency:.2,depth:.15}}]},{name:"VHS Vibe",description:"Wobbly and degraded like old VHS audio",category:"Lo-Fi",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:25,parameters:{bits:12}},{category:"tonejs",type:"Vibrato",enabled:!0,wet:30,parameters:{frequency:4,depth:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:6e3,type:"lowpass",Q:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:15,parameters:{decay:1.2,preDelay:.02}}]},{name:"Ambient Space",description:"Lush reverb and delay for atmospheric soundscapes",category:"Ambient",effects:[{category:"tonejs",type:"Reverb",enabled:!0,wet:45,parameters:{decay:5,preDelay:.05}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{delayTime:.4,feedback:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-20,ratio:2,attack:.05,release:.4}}]},{name:"Dreamy Haze",description:"Soft and floaty with modulated delays",category:"Ambient",effects:[{category:"tonejs",type:"Chorus",enabled:!0,wet:35,parameters:{frequency:.3,depth:.5}},{category:"tonejs",type:"Reverb",enabled:!0,wet:55,parameters:{decay:6,preDelay:.08}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:5e3,type:"lowpass",Q:.5}}]},{name:"Cathedral",description:"Massive reverb for epic, cavernous sound",category:"Ambient",effects:[{category:"tonejs",type:"JCReverb",enabled:!0,wet:60,parameters:{roomSize:.9}},{category:"tonejs",type:"Delay",enabled:!0,wet:20,parameters:{delayTime:.25,feedback:.3}}]},{name:"Underwater",description:"Filtered and submerged atmospheric effect",category:"Ambient",effects:[{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:1200,type:"lowpass",Q:2}},{category:"tonejs",type:"Chorus",enabled:!0,wet:40,parameters:{frequency:.4,depth:.6}},{category:"tonejs",type:"Reverb",enabled:!0,wet:50,parameters:{decay:4,preDelay:.03}}]},{name:"Industrial",description:"Harsh distortion and compression for aggressive sound",category:"Aggressive",effects:[{category:"tonejs",type:"Distortion",enabled:!0,wet:45,parameters:{distortion:.6}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:8,attack:.001,release:.08}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:2,high:4}}]},{name:"Crushed",description:"Heavy bit-crushing and distortion",category:"Aggressive",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:60,parameters:{bits:6}},{category:"tonejs",type:"Distortion",enabled:!0,wet:35,parameters:{distortion:.5}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-8,ratio:10,attack:.001,release:.05}}]},{name:"Hardstyle",description:"Punchy kick-focused processing for hard dance",category:"Aggressive",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:6,attack:.002,release:.08}},{category:"tonejs",type:"Distortion",enabled:!0,wet:20,parameters:{distortion:.3}}]},{name:"Gabber",description:"Extreme compression and saturation for hardcore",category:"Aggressive",effects:[{category:"tonejs",type:"Chebyshev",enabled:!0,wet:50,parameters:{order:8}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-6,ratio:20,attack:5e-4,release:.03}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:0,high:5}}]},{name:"Dub Station",description:"Space Echo and Bi-Phase for authentic dub vibes",category:"Dub",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:40,parameters:{mode:4,rate:300,intensity:.6,echoVolume:.8,reverbVolume:.2}},{category:"tonejs",type:"BiPhase",enabled:!0,wet:30,parameters:{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0}}]},{name:"Sound System",description:"Heavy subs and performance filtering",category:"Dub",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:6,mid:-2,high:1}},{category:"tonejs",type:"DubFilter",enabled:!0,wet:100,parameters:{cutoff:20,resonance:15,gain:1.2}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-15,ratio:4,attack:.01,release:.2}}]},{name:"Reggae",description:"Dotted-eighth skank echo with warm bass  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:25,parameters:{mode:4,rate:375,intensity:.4,echoVolume:.7,reverbVolume:.15,bpmSync:1,syncDivision:"1/8d"}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:4,mid:0,high:-1}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.01,release:.25}}]},{name:"Dub",description:"Heavy quarter-note echo with phaser swirl  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"SpaceEcho",enabled:!0,wet:45,parameters:{mode:4,rate:500,intensity:.7,echoVolume:.85,reverbVolume:.2,bpmSync:1,syncDivision:"1/4"}},{category:"tonejs",type:"BiPhase",enabled:!0,wet:30,parameters:{rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0,bpmSync:1,syncDivision:"1/2"}},{category:"tonejs",type:"Reverb",enabled:!0,wet:25,parameters:{decay:3,preDelay:.03}}]},{name:"Techno",description:"Driving eighth-note delay with hard compression  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"Delay",enabled:!0,wet:20,parameters:{time:.25,feedback:.35,bpmSync:1,syncDivision:"1/8"}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-12,ratio:5,attack:.003,release:.1}},{category:"tonejs",type:"Distortion",enabled:!0,wet:12,parameters:{distortion:.15}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:3,mid:-1,high:2}}]},{name:"House",description:"Ping-pong delay and chorus groove  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:18,parameters:{time:.25,feedback:.4,bpmSync:1,syncDivision:"1/8"}},{category:"tonejs",type:"Chorus",enabled:!0,wet:20,parameters:{frequency:1,depth:.4,bpmSync:1,syncDivision:"1/4"}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-16,ratio:3.5,attack:.008,release:.18}},{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:2,mid:0,high:1}}]},{name:"Ambient",description:"Long reverb with dotted-quarter ping-pong  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"Reverb",enabled:!0,wet:50,parameters:{decay:6,preDelay:.06}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:30,parameters:{time:.375,feedback:.5,bpmSync:1,syncDivision:"1/4d"}},{category:"tonejs",type:"Chorus",enabled:!0,wet:25,parameters:{frequency:.25,depth:.5,bpmSync:1,syncDivision:"1/1"}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:6e3,type:"lowpass",Q:.5}}]},{name:"Lo-Fi Hip Hop",description:"Lazy swing delay with vinyl crunch  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"BitCrusher",enabled:!0,wet:20,parameters:{bits:10}},{category:"tonejs",type:"Filter",enabled:!0,wet:100,parameters:{frequency:7e3,type:"lowpass",Q:.8}},{category:"tonejs",type:"Delay",enabled:!0,wet:22,parameters:{time:.375,feedback:.3,bpmSync:1,syncDivision:"1/8d"}},{category:"tonejs",type:"Vibrato",enabled:!0,wet:15,parameters:{frequency:4,depth:.06}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-18,ratio:3,attack:.015,release:.25}}]},{name:"Drum & Bass",description:"Tight sixteenth-note delay with sub boost  auto-syncs to BPM",category:"Genre",effects:[{category:"tonejs",type:"EQ3",enabled:!0,wet:100,parameters:{low:5,mid:-1,high:3}},{category:"tonejs",type:"Compressor",enabled:!0,wet:100,parameters:{threshold:-10,ratio:5,attack:.002,release:.08}},{category:"tonejs",type:"PingPongDelay",enabled:!0,wet:15,parameters:{time:.125,feedback:.3,bpmSync:1,syncDivision:"1/16"}},{category:"tonejs",type:"Reverb",enabled:!0,wet:12,parameters:{decay:.8,preDelay:.01}}]}],xS=({channelIndex:e,channel:t,patternId:a,onFillPattern:n,onClearChannel:r,onCopyChannel:i,onCutChannel:o,onPasteChannel:l,onTranspose:c,onHumanize:u,onInterpolate:d,onAcidGenerator:p})=>{const{isLiveMode:m,queueChannelAction:h}=Hw(),{toggleChannelMute:f,toggleChannelSolo:y,removeChannel:g,setChannelColor:b,patterns:v}=ob(),{setActiveParameter:x,setShowLane:w,getShowLane:k,removeCurve:S,getCurvesForPattern:M}=Zv(),{updateInstrument:N}=Bv(),C=s.useCallback(a=>{const n=vS.find(e=>e.name===a);if(!n||!t.instrumentId)return;const s=n.effects.map((e,t)=>({...e,id:`channel-fx-${Date.now()}-${t}`}));N(t.instrumentId,{effects:s}),px.success(`Applied ${n.name} to CH ${(e+1).toString().padStart(2,"0")}`)},[t.instrumentId,e,N]),P=k(e),E=M(a,e),_=E.length>0,{params:T}=nS(e),A=s.useMemo(()=>T.slice(0,8).map(e=>({id:e.key,label:e.name,color:e.color})),[T]),O=s.useMemo(()=>m?[{id:"trigger",label:"Trigger",icon:Ea.jsx(Ae,{size:14}),submenu:[{id:"trigger-kicks",label:"4/4 Kicks",onClick:()=>{h(e,{type:"trigger",pattern:"kicks"}),n(e,"4on4")}},{id:"trigger-build",label:"Build",onClick:()=>{h(e,{type:"trigger",pattern:"build"}),n(e,"build")}},{id:"trigger-drop",label:"Drop",onClick:()=>{h(e,{type:"trigger",pattern:"drop"}),n(e,"16ths")}},{id:"trigger-breakdown",label:"Breakdown",onClick:()=>{h(e,{type:"trigger",pattern:"breakdown"}),n(e,"breakdown")}}]},{id:"stutter",label:"Stutter",icon:Ea.jsx(st,{size:14}),onClick:()=>h(e,{type:"stutter"})},{id:"roll",label:"Roll",icon:Ea.jsx(Ee,{size:14}),submenu:[{id:"roll-4",label:"1/4 Note",onClick:()=>h(e,{type:"roll",division:"1/4"})},{id:"roll-8",label:"1/8 Note",onClick:()=>h(e,{type:"roll",division:"1/8"})},{id:"roll-16",label:"1/16 Note",onClick:()=>h(e,{type:"roll",division:"1/16"})}]},{type:"divider"},{id:"automation",label:"Automation",icon:Ea.jsx(rt,{size:14}),submenu:[{id:"auto-sweep-up",label:"Filter Sweep Up",onClick:()=>h(e,{type:"filterSweep",direction:"up",bars:4})},{id:"auto-sweep-down",label:"Filter Sweep Down",onClick:()=>h(e,{type:"filterSweep",direction:"down",bars:4})},{id:"auto-fade-in",label:"Volume Fade In",onClick:()=>h(e,{type:"volumeFade",direction:"in",bars:4})},{id:"auto-fade-out",label:"Volume Fade Out",onClick:()=>h(e,{type:"volumeFade",direction:"out",bars:4})},{type:"divider"},...A.slice(0,2).map(t=>({id:`auto-show-${t.id}`,label:`Show ${t.label}`,onClick:()=>{x(e,t.id),w(e,!0)}}))]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?Ea.jsx(it,{size:14}):Ea.jsx(ot,{size:14}),checked:t.muted,onClick:()=>f(e)},{id:"solo",label:"Solo",icon:Ea.jsx(lt,{size:14}),checked:t.solo,onClick:()=>y(e)},{id:"kill",label:"Kill",icon:Ea.jsx(Ae,{size:14}),danger:!0,onClick:()=>{h(e,{type:"kill"}),f(e)}}]:[{id:"fill",label:"Fill",icon:Ea.jsx(Te,{size:14}),submenu:[{id:"fill-4on4",label:bS["4on4"].name,onClick:()=>n(e,"4on4")},{id:"fill-offbeat",label:bS.offbeat.name,onClick:()=>n(e,"offbeat")},{id:"fill-backbeat",label:bS.backbeat.name,onClick:()=>n(e,"backbeat")},{id:"fill-hihats",label:bS.hiHats.name,onClick:()=>n(e,"hiHats")},{type:"divider"},{id:"fill-8ths",label:bS["8ths"].name,onClick:()=>n(e,"8ths")},{id:"fill-16ths",label:bS["16ths"].name,onClick:()=>n(e,"16ths")},{id:"fill-random",label:bS.random.name,onClick:()=>n(e,"random")},{id:"fill-acid",label:" Acid Generator...",icon:Ea.jsx(ct,{size:14}),onClick:()=>p(e)},{type:"divider"},{id:"fill-syncopated",label:bS.syncopated.name,onClick:()=>n(e,"syncopated")},{id:"fill-walking",label:bS.walking.name,onClick:()=>n(e,"walking")},{type:"divider"},{id:"fill-build",label:bS.build.name,onClick:()=>n(e,"build")},{id:"fill-breakdown",label:bS.breakdown.name,onClick:()=>n(e,"breakdown")}]},{id:"clear",label:"Clear Channel",icon:Ea.jsx(Re,{size:14}),onClick:()=>r(e)},{id:"copy",label:"Copy Track",icon:Ea.jsx(ut,{size:14}),onClick:()=>i(e)},{id:"cut",label:"Cut Track",icon:Ea.jsx(dt,{size:14}),onClick:()=>o(e)},{id:"paste",label:"Paste Track",icon:Ea.jsx(pt,{size:14}),onClick:()=>l(e)},{type:"divider"},{id:"fx-presets",label:"FX Presets",icon:Ea.jsx(mt,{size:14}),submenu:(()=>{const e={};return vS.forEach(t=>{const a=t.category||"General";e[a]||(e[a]=[]),e[a].push(t)}),Object.keys(e).sort().map(t=>({id:`fx-cat-${t.toLowerCase()}`,label:t,submenu:e[t].map(e=>({id:`fx-preset-${e.name.replace(/\s+/g,"-")}`,label:e.name,onClick:()=>C(e.name)}))}))})()},{type:"divider"},{id:"transpose",label:"Transpose",icon:Ea.jsx(ze,{size:14}),submenu:[{id:"transpose-12",label:"+12 (Octave Up)",onClick:()=>c(e,12)},{id:"transpose-7",label:"+7 (Fifth)",onClick:()=>c(e,7)},{id:"transpose-1",label:"+1 (Semitone)",onClick:()=>c(e,1)},{type:"divider"},{id:"transpose--1",label:"-1 (Semitone)",onClick:()=>c(e,-1)},{id:"transpose--7",label:"-7 (Fifth)",onClick:()=>c(e,-7)},{id:"transpose--12",label:"-12 (Octave Down)",onClick:()=>c(e,-12)}]},{id:"humanize",label:"Humanize",icon:Ea.jsx(ct,{size:14}),shortcut:"Ctrl+H",onClick:()=>u(e)},{id:"interpolate",label:"Interpolate",icon:Ea.jsx(ht,{size:14}),shortcut:"Ctrl+I",onClick:()=>d(e)},{type:"divider"},{id:"automation",label:"Automation",icon:Ea.jsx(gt,{size:14}),submenu:[...A.map(t=>({id:`auto-${t.id}`,label:t.label,icon:Ea.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),onClick:()=>{x(e,t.id),w(e,!0)}})),{type:"divider"},{id:"auto-toggle-lane",label:P?"Hide Lane":"Show Lane",icon:P?Ea.jsx(ft,{size:14}):Ea.jsx(yt,{size:14}),onClick:()=>w(e,!P)},{id:"auto-clear-all",label:"Clear All Automation",icon:Ea.jsx(Re,{size:14}),danger:!0,disabled:!_,onClick:()=>{E.forEach(e=>S(e.id))}}]},{type:"divider"},{id:"mute",label:"Mute",icon:t.muted?Ea.jsx(it,{size:14}):Ea.jsx(ot,{size:14}),checked:t.muted,onClick:()=>f(e)},{id:"solo",label:"Solo",icon:Ea.jsx(lt,{size:14}),checked:t.solo,onClick:()=>y(e)},{id:"color",label:"Color",icon:Ea.jsx(qe,{size:14}),submenu:cn.map((a,n)=>({id:`color-${n}`,label:null===a?"None":"",icon:a?Ea.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:a}}):Ea.jsx("span",{className:"w-4 h-4 rounded border border-dark-border"}),checked:t.color===a,onClick:()=>b(e,a)}))},{id:"delete",label:"Delete Channel",icon:Ea.jsx(bt,{size:14}),danger:!0,disabled:v[0]?.channels.length<=1,onClick:()=>g(e)}],[m,e,t,P,_,E,v,n,r,i,o,l,c,u,d,p,f,y,g,b,h,x,w,S,C,A]);return Ea.jsx(fS,{items:O,className:`\n        p-1 rounded transition-colors\n        ${m?"text-accent-error hover:bg-accent-error/20":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"}\n      `,children:Ea.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[Ea.jsx("circle",{cx:"12",cy:"12",r:"1"}),Ea.jsx("circle",{cx:"12",cy:"5",r:"1"}),Ea.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})},wS=({position:e,onClose:t,rowIndex:a,channelIndex:n,onInterpolate:r,onHumanize:i,onStrum:o,onLegato:l,onOpenParameterEditor:c})=>{const{patterns:u,currentPatternIndex:d,setCell:p,cursor:m,selectColumn:h,selectChannel:f}=ob(),y=u[d],g=s.useCallback(()=>{if(!y)return;const e=y.channels[n].rows[a];localStorage.setItem("devilbox-cell-clipboard",JSON.stringify(e))},[y,n,a]),b=s.useCallback(()=>{g(),p(n,a,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[g,p,n,a]),v=s.useCallback(()=>{const e=localStorage.getItem("devilbox-cell-clipboard");if(e)try{const t=JSON.parse(e);p(n,a,t)}catch(t){}},[p,n,a]),x=s.useCallback(()=>{p(n,a,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[p,n,a]),w=s.useCallback(()=>{if(y){for(let e=y.length-1;e>a;e--){const t=y.channels[n].rows[e-1];p(n,e,t)}p(n,a,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[y,n,a,p]),k=s.useCallback(()=>{if(y){for(let e=a;e<y.length-1;e++){const t=y.channels[n].rows[e+1];p(n,e,t)}p(n,y.length-1,{note:0,instrument:0,volume:0,effTyp:0,eff:0})}},[y,n,a,p]),S=s.useCallback(()=>{h(n,m.columnType),t()},[n,m.columnType,h,t]),M=s.useCallback(()=>{f(n),t()},[n,f,t]),N=s.useMemo(()=>[{id:"cut",label:"Cut",icon:Ea.jsx(dt,{size:14}),shortcut:"Ctrl+X",onClick:b},{id:"copy",label:"Copy",icon:Ea.jsx(ut,{size:14}),shortcut:"Ctrl+C",onClick:g},{id:"paste",label:"Paste",icon:Ea.jsx(pt,{size:14}),shortcut:"Ctrl+V",onClick:v},{id:"clear",label:"Clear",icon:Ea.jsx(Re,{size:14}),shortcut:"Del",onClick:x},{type:"divider"},{id:"insert-row",label:"Insert Row",icon:Ea.jsx(vt,{size:14}),shortcut:"Ins",onClick:w},{id:"delete-row",label:"Delete Row",icon:Ea.jsx(xt,{size:14}),shortcut:"Backspace",onClick:k},{type:"divider"},{id:"interpolate",label:"Interpolate",icon:Ea.jsx(ht,{size:14}),shortcut:"Ctrl+I",onClick:r},{id:"humanize",label:"Humanize",icon:Ea.jsx(ct,{size:14}),shortcut:"Ctrl+H",onClick:i},{id:"strum",label:"Strum/Arpeggiate",icon:Ea.jsx(Te,{size:14}),onClick:o},{id:"legato",label:"Legato (Connect Notes)",icon:Ea.jsx(wt,{size:14}),onClick:l},{type:"divider"},{id:"param-editor",label:"Visual Parameter Editor",icon:Ea.jsx(kt,{size:14}),submenu:[{id:"param-volume",label:"Edit Volume...",onClick:()=>c?.("volume")},{id:"param-effect",label:"Edit Effect Type...",onClick:()=>c?.("effect")},{id:"param-effectparam",label:"Edit Effect Parameter...",onClick:()=>c?.("effectParam")}]},{type:"divider"},{id:"select-column",label:"Select Column",icon:Ea.jsx(St,{size:14}),onClick:S},{id:"select-channel",label:"Select Channel",icon:Ea.jsx(Mt,{size:14}),onClick:M}],[b,g,v,x,w,k,r,i,o,l,c,S,M]);return e?Ea.jsx(pS,{items:N,position:e,onClose:t}):null},kS={volume:{label:"Volume",min:0,max:64,default:64,color:"#22c55e",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effectParam:{label:"Effect Parameter",min:0,max:255,default:0,color:"#f59e0b",format:e=>e.toString(16).toUpperCase().padStart(2,"0")},effect:{label:"Effect Type",min:0,max:35,default:0,color:"#8b5cf6",format:e=>e<10?e.toString():String.fromCharCode(55+e)},note:{label:"Note",min:0,max:119,default:48,color:"#3b82f6",format:e=>{const t=Math.floor(e/12);return`${["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"][e%12]}${t}`}},instrument:{label:"Instrument",min:0,max:99,default:1,color:"#ec4899",format:e=>e.toString().padStart(2,"0")}},SS=({onClose:e,channelIndex:t,startRow:a,endRow:n,field:r})=>{const i=s.useRef(null),o=s.useRef(null),l=ob(e=>e.patterns),c=ob(e=>e.currentPatternIndex),u=ob(e=>e.setCell),d=kS[r],p=n-a+1,[m,h]=s.useState(!1),[f,y]=s.useState("overwrite"),[g,b]=s.useState(null),v=Vv(e=>e.useHexNumbers),x=s.useMemo(()=>{const e=l[c];if(!e)return[];const s=e.channels[t];if(!s)return[];const i=[];for(let t=a;t<=n;t++){const e=s.rows[t];if(!e){i.push(d.default);continue}let a=d.default;switch(r){case"volume":a=e.volume??d.default;break;case"effect":e.effect&&"..."!==e.effect&&(a=parseInt(e.effect[0],16)||0);break;case"effectParam":e.effect&&"..."!==e.effect&&e.effect.length>=3&&(a=parseInt(e.effect.substring(1),16)||0);break;case"note":e.note&&0!==e.note&&(a=e.note);break;case"instrument":a=e.instrument??d.default}i.push(a)}return i},[l,c,t,a,n,r,d.default]),[w,k]=s.useState(x),[S,M]=s.useState(()=>`${c}-${t}-${a}-${n}-${r}`),N=`${c}-${t}-${a}-${n}-${r}`;N!==S&&(M(N),k(x));const C=12,P=20,E=Math.max(400,14*p+40),_=200,T=s.useCallback(()=>{const e=i.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.fillStyle="#1a1a2e",t.fillRect(0,0,E,_),t.strokeStyle="#2a2a4a",t.lineWidth=1;for(let a=0;a<=4;a++){const e=P+a/4*160;t.beginPath(),t.moveTo(P,e),t.lineTo(E-P,e),t.stroke();const n=Math.round(d.max-(d.max-d.min)*(a/4));t.fillStyle="#666",t.font="10px monospace",t.textAlign="right",t.fillText(d.format(n),16,e+3)}(g||w).forEach((e,n)=>{const s=P+14*n,r=160*((e-d.min)/(d.max-d.min)),i=180-r,o=t.createLinearGradient(s,i,s,180);o.addColorStop(0,d.color),o.addColorStop(1,d.color+"40"),t.fillStyle=o,t.fillRect(s,i,C,r),t.strokeStyle=d.color,t.lineWidth=1,t.strokeRect(s,i,C,r),(a+n)%4==0&&(t.fillStyle="#888",t.font="9px monospace",t.textAlign="center",t.fillText(v?(a+n).toString(16).toUpperCase().padStart(2,"0"):(a+n).toString().padStart(2,"0"),s+6,196))})},[w,g,E,_,d,a,v]);s.useEffect(()=>{T()},[T]);const A=s.useCallback(e=>{const t=i.current;if(!t)return null;const a=t.getBoundingClientRect(),n=e.clientX-a.left,s=e.clientY-a.top,r=Math.floor((n-P)/14);if(r<0||r>=p)return null;const o=1-(s-P)/160,l=Math.round(d.min+o*(d.max-d.min));return{rowIndex:r,value:Math.max(d.min,Math.min(d.max,l))}},[p,d,_]),O=s.useCallback((e,t,a)=>{k(n=>{const s=[...n],r=s[e];switch(a){case"overwrite":s[e]=t;break;case"fill_blanks":0!==r&&r!==d.default||(s[e]=t);break;case"add":s[e]=Math.max(d.min,Math.min(d.max,r+(t-d.max/2)));break;case"scale":{const a=t/d.max;s[e]=Math.round(r*a);break}}return s})},[d]),I=s.useCallback(e=>{const t=A(e);if(t){if(2===e.button)return e.preventDefault(),void O(t.rowIndex,t.value,"overwrite");h(!0),O(t.rowIndex,t.value,f)}},[A,O,f]),F=s.useCallback(e=>{if(!m){const t=A(e);return void(t&&b(()=>{const e=[...w];return e[t.rowIndex]=t.value,e}))}const t=A(e);t&&O(t.rowIndex,t.value,f)},[m,A,O,f,w]),D=s.useCallback(()=>{h(!1)},[]),R=s.useCallback(()=>{h(!1),b(null)},[]),j=s.useCallback(e=>{e.preventDefault()},[]),B=s.useCallback(()=>{w.forEach((e,n)=>{const s=a+n,i=l[c];if(!i)return;const o=i.channels[t]?.rows[s];if(!o)return;const p={};switch(r){case"volume":p.volume=e;break;case"effect":{const t=o.effect||"000",a=t.length>=3?t.substring(1):"00";p.effect=d.format(e)+a;break}case"effectParam":{const t=o.effect?.[0]||"0";p.effect=t+e.toString(16).toUpperCase().padStart(2,"0");break}case"note":p.note=e;break;case"instrument":p.instrument=e}u(t,s,p)}),e()},[w,a,l,c,t,r,d,u,e]),L=s.useCallback(e=>{const t=Array(p).fill(0).map((t,a)=>{const n=a/(p-1||1),s=d.max-d.min;switch(e){case"ramp_up":return Math.round(d.min+n*s);case"ramp_down":return Math.round(d.max-n*s);case"triangle":return Math.round(d.min+Math.abs(1-2*n)*s);case"random":return Math.round(d.min+Math.random()*s);case"sine":return Math.round(d.min+(Math.sin(n*Math.PI*2)+1)/2*s);default:return d.default}});k(t)},[p,d]),V=s.useCallback(()=>{if(w.length<2)return;const e=w[0],t=w[w.length-1],a=w.map((a,n)=>{const s=n/(w.length-1);return Math.round(e+(t-e)*s)});k(a)},[w]),z=s.useCallback(()=>{k(x)},[x]);return Ea.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",children:Ea.jsxs("div",{ref:o,className:"bg-dark-bg border border-dark-border rounded-lg shadow-2xl max-w-[95vw] overflow-hidden",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-dark-bgSecondary border-b border-dark-border",children:[Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsxs("h2",{className:"text-text-primary font-bold",children:[d.label," Editor"]}),Ea.jsxs("span",{className:"text-xs text-text-secondary",children:["Channel ",t+1,", Rows ",a,"-",n]})]}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:e,children:Ea.jsx(Pe,{size:18})})]}),Ea.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-dark-bgSecondary/50 border-b border-dark-border",children:[Ea.jsxs("div",{className:"flex items-center gap-1 mr-4",children:[Ea.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Mode:"}),["overwrite","fill_blanks","add","scale"].map(e=>Ea.jsx("button",{onClick:()=>y(e),className:"px-2 py-1 text-xs rounded "+(f===e?"bg-blue-600 text-white":"bg-dark-bg text-text-secondary hover:bg-dark-bgSecondary"),children:"fill_blanks"===e?"Fill Empty":e.charAt(0).toUpperCase()+e.slice(1)},e))]}),Ea.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[Ea.jsx("span",{className:"text-xs text-text-secondary mr-1",children:"Generate:"}),Ea.jsx("button",{onClick:()=>L("ramp_up"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Up",children:""}),Ea.jsx("button",{onClick:()=>L("ramp_down"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Ramp Down",children:""}),Ea.jsx("button",{onClick:()=>L("triangle"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Triangle",children:""}),Ea.jsx("button",{onClick:()=>L("sine"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Sine",children:""}),Ea.jsx("button",{onClick:()=>L("random"),className:"px-2 py-1 text-xs bg-dark-bg hover:bg-dark-bgSecondary rounded",title:"Random",children:"?"})]}),Ea.jsxs("div",{className:"flex items-center gap-1 border-l border-dark-border pl-4",children:[Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:V,title:"Interpolate between first and last",children:Ea.jsx(ze,{size:14})}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:z,title:"Reset to original",children:Ea.jsx(Nt,{size:14})})]})]}),Ea.jsx("div",{className:"p-4 overflow-x-auto",children:Ea.jsx("canvas",{ref:i,width:E,height:_,onMouseDown:I,onMouseMove:F,onMouseUp:D,onMouseLeave:R,onContextMenu:j,className:"cursor-crosshair border border-dark-border rounded",style:{minWidth:E}})}),Ea.jsxs("div",{className:"px-4 py-2 text-xs text-text-secondary bg-dark-bgSecondary/30 border-t border-dark-border",children:[Ea.jsx("span",{className:"font-medium",children:"Tips:"})," Click + drag to paint values. Right-click for single-row precision."]}),Ea.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 bg-dark-bgSecondary border-t border-dark-border",children:[Ea.jsx(qk,{variant:"ghost",onClick:e,children:"Cancel"}),Ea.jsxs(qk,{variant:"primary",onClick:B,children:[Ea.jsx(ct,{size:14,className:"mr-1"}),"Apply"]})]})]})})},MS=()=>"vibrate"in navigator,NS=e=>{if(!MS())return!1;try{return navigator.vibrate(e)}catch(t){return!1}},CS=()=>NS(10),PS=()=>NS(20),ES=()=>NS(30),_S=()=>NS([10,50,10]),TS=()=>NS([5,30,5]),AS=()=>NS(5);function OS(e,t){const a=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(a*a+n*n)}function IS({onSwipeUp:e,onSwipeDown:t,onSwipeLeft:a,onSwipeRight:n,onTap:r,onLongPress:i,onPinchZoom:o,onScroll:l,swipeThreshold:c=50,longPressDelay:u=500,enabled:d=!0}){const p=s.useRef(null),m=s.useCallback(()=>{p.current?.longPressTimer&&(clearTimeout(p.current.longPressTimer),p.current.longPressTimer=null)},[]);return{onTouchStart:s.useCallback(e=>{if(!d)return;const t=e.touches[0],a=e.touches.length;p.current={startX:t.clientX,startY:t.clientY,currentX:t.clientX,currentY:t.clientY,lastY:t.clientY,startTime:Date.now(),touches:a,initialDistance:2===a?OS(e.touches[0],e.touches[1]):0,longPressTimer:null,hasMoved:!1},1===a&&i&&(p.current.longPressTimer=setTimeout(()=>{p.current&&!p.current.hasMoved&&(ES(),i(p.current.startX,p.current.startY),p.current=null)},u))},[d,i,u]),onTouchMove:s.useCallback(e=>{if(!d||!p.current)return;const t=e.touches[0],a=e.touches.length;p.current.currentX=t.clientX,p.current.currentY=t.clientY;const n=t.clientX-p.current.startX,s=t.clientY-p.current.startY;if(Math.sqrt(n*n+s*s)>10&&(p.current.hasMoved=!0,m()),2===a&&o&&2===e.touches.length){const t=OS(e.touches[0],e.touches[1]),a=t-p.current.initialDistance;if(Math.abs(a)>50){const e=t/p.current.initialDistance;o(e),p.current.initialDistance=t}e.preventDefault()}if(1===a&&l){const e=p.current.lastY-t.clientY,a=Math.abs(n);Math.abs(e)>1.5*a&&Math.abs(e)>1&&(l(e),p.current.lastY=t.clientY)}},[d,o,l,m]),onTouchEnd:s.useCallback(s=>{if(!d||!p.current)return;m();const i=s.changedTouches[0],o=i.clientX-p.current.startX,l=i.clientY-p.current.startY,u=Date.now()-p.current.startTime,h=Math.sqrt(o*o+l*l);if(!p.current.hasMoved&&h<10&&u<300&&1===p.current.touches&&r)return AS(),r(p.current.startX,p.current.startY),void(p.current=null);if(p.current.hasMoved&&u<500&&1===p.current.touches){const s=Math.abs(o),r=Math.abs(l);s>r&&s>c?(TS(),o>0&&n?n():o<0&&a&&a()):r>s&&r>c&&(TS(),l>0&&t?t():l<0&&e&&e())}p.current=null},[d,c,e,t,a,n,r,m]),onTouchCancel:s.useCallback(()=>{m(),p.current=null},[m])}}const FS=640,DS=1024;function RS(){const[e,t]=s.useState(()=>"undefined"!=typeof window?window.innerWidth:1024);return s.useEffect(()=>{if("undefined"==typeof window)return;let e;requestAnimationFrame(()=>t(window.innerWidth));const a=()=>{clearTimeout(e),e=setTimeout(()=>{t(window.innerWidth)},100)};return window.addEventListener("resize",a),window.addEventListener("orientationchange",a),()=>{clearTimeout(e),window.removeEventListener("resize",a),window.removeEventListener("orientationchange",a)}},[]),s.useMemo(()=>{const t=function(e){return e<FS?"mobile":e<DS?"tablet":"desktop"}(e);return{breakpoint:t,isMobile:"mobile"===t,isTablet:"tablet"===t,isDesktop:"desktop"===t,width:e}},[e])}const jS=s.createContext(null);function BS({children:e}){const t={...RS(),isTouch:function(){const[e]=s.useState(()=>"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0));return e}()};return Ea.jsx(jS.Provider,{value:t,children:e})}const LS=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,111,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,125,118,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114],VS=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"],zS=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function US(e){if(e<=0||e>96)return"C4";const t=e+11,a=Math.floor(t/12)-1;return`${zS[t%12]}${a}`}function GS(e){for(let t=0;t<8;t++)for(let a=0;a<12;a++){const n=12*t+a;if(n<36&&LS[n]<=e)return`${VS[a].replace("-","")}${t+1}`}return"C4"}const WS=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24];class HS{song=null;playing=!1;songPos=0;pattPos=0;currentTick=0;speed=6;bpm=125;globalVolume=64;pBreakPos=0;pBreakFlag=!1;posJumpFlag=!1;posJumpPos=0;patternDelay=0;channels=[];masterGain;stateQueue=[];lastDequeuedState=null;static MAX_STATE_QUEUE_SIZE=256;bufferCache=new Map;onRowChange=null;onSongEnd=null;onTickProcess=null;constructor(){const e=Qg();this.masterGain=new p(1),this.masterGain.connect(e.masterInput)}loadSong(e){this.stop(),this.song=e,this.bufferCache.clear();for(const t of this.channels){for(const e of t.playerPool)try{e.dispose()}catch{}try{t.gainNode.dispose()}catch{}try{t.panNode.dispose()}catch{}}this.channels=[];for(let t=0;t<e.numChannels;t++)this.channels.push(this.createChannel(t,e.numChannels));this.songPos=0,this.pattPos=0,this.currentTick=0,this.speed=e.initialSpeed,this.bpm=e.initialBPM,this.pBreakFlag=!1,this.posJumpFlag=!1,this.patternDelay=0}createChannel(e,t){let a=0;a=4===t?0===e||3===e?-.7:.7:e%2==0?-.5:.5;const n=new ue(a),s=new p(1);s.connect(n),n.connect(this.masterGain);const r=[];for(let i=0;i<2;i++){const e=new oe;e.connect(s),r.push(e)}return{note:0,period:0,volume:64,panning:128,sampleNum:0,sampleOffset:0,finetune:0,portaSpeed:0,portaTarget:0,tonePortaSpeed:0,vibratoPos:0,vibratoCmd:0,tremoloPos:0,tremoloCmd:0,waveControl:0,retrigCount:0,retrigVolSlide:0,patternLoopRow:0,patternLoopCount:0,globalVolSlide:0,panSlide:0,macroPos:0,macroReleased:!1,macroPitchOffset:0,macroArpNote:0,macroDuty:0,macroWaveform:0,previousSlideFlag:!1,gateHigh:!1,lastPlayedNoteName:null,xmNote:0,player:null,playerPool:r,activePlayerIdx:0,gainNode:s,panNode:n,instrument:null}}scheduleAheadTime=.1;schedulerInterval=.015;nextScheduleTime=0;startTime=0;totalTicksScheduled=0;lastGrooveTemplateId="straight";lastSwingAmount=100;lastGrooveSteps=2;schedulerTimerId=null;async play(){if(!this.song||this.playing)return;await ye();const e=Qg();await e.ensureWASMSynthsReady(this.song.instruments),this.playing=!0;const t=Kv.getState();this.lastGrooveTemplateId=t.grooveTemplateId,this.lastSwingAmount=t.swing,this.lastGrooveSteps=t.grooveSteps,this.startScheduler()}stop(){this.playing=!1,null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null);for(let e=0;e<this.channels.length;e++)this.stopChannel(this.channels[e],e);try{Qg().releaseAll()}catch{}this.songPos=0,this.pattPos=0,this.currentTick=0,this.totalTicksScheduled=0,this.lastGrooveTemplateId="straight",this.lastSwingAmount=100,this.lastGrooveSteps=2,this.clearStateQueue()}pause(){null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null),this.playing=!1}resume(){this.song&&!this.playing&&(this.playing=!0,this.startScheduler())}startScheduler(){this.startTime=Z()+.02,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0;const e=()=>{if(!this.playing)return;const e=Z(),t=e+this.scheduleAheadTime,a=Kv.getState();(a.grooveTemplateId!==this.lastGrooveTemplateId||a.swing!==this.lastSwingAmount||a.grooveSteps!==this.lastGrooveSteps||Math.abs(a.bpm-this.bpm)>.1)&&(this.startTime=e+.01,this.nextScheduleTime=this.startTime,this.totalTicksScheduled=0,this.lastGrooveTemplateId=a.grooveTemplateId,this.lastSwingAmount=a.swing,this.lastGrooveSteps=a.grooveSteps,this.bpm=a.bpm,this.speed=a.speed);const n=2.5/this.bpm;for(;this.nextScheduleTime<t&&this.playing;)this.processTick(this.nextScheduleTime),this.totalTicksScheduled++,this.nextScheduleTime=this.startTime+this.totalTicksScheduled*n};e(),this.schedulerTimerId=setInterval(e,1e3*this.schedulerInterval)}calculateGrooveOffset(e,t,a){const n=$n.find(e=>e.id===a.grooveTemplateId);if(n&&"straight"!==n.id){const s=a.swing/100,r=function(e,t,a){if(!e.values||0===e.values.length)return 0;const n=t%e.values.length;return e.values[n]/100*a}(n,e,t)*s;return r}{const n=(a.swing-100)/100,s=a.grooveSteps||2,r=e%s>=s/2;if(100!==a.swing&&r){return n*.3333*t}}return 0}processTick(e){if(!this.song||!this.playing)return;if(this.patternDelay>0)return void this.patternDelay--;const t=Kv.getState();t.bpm!==this.bpm&&(this.bpm=t.bpm);const a=2.5/this.bpm;let n=e;if(0===this.currentTick){const e=a*this.speed;n+=this.calculateGrooveOffset(this.pattPos,e,t)}if(t.jitter>0){const e=t.jitter/100*.01;n+=(2*Math.random()-1)*e}const s=this.song.songPositions[this.songPos],r=this.song.patterns[s];if(r){0===this.currentTick&&this.queueDisplayState(n,this.pattPos,s,this.songPos,0);for(let e=0;e<this.channels.length;e++){const t=this.channels[e],s=r.channels[e]?.rows[this.pattPos];s&&(0===this.currentTick?this.processRow(e,t,s,n):this.processEffectTick(e,t,s,n+this.currentTick*a),this.processMacros(t,n+this.currentTick*a))}this.onTickProcess&&this.onTickProcess(this.currentTick,this.pattPos),this.currentTick++,this.currentTick>=this.speed&&(this.currentTick=0,this.advanceRow())}}queueDisplayState(e,t,a,n,s){const r={time:e,row:t,pattern:a,position:n,tick:s};this.stateQueue.length>=HS.MAX_STATE_QUEUE_SIZE&&this.stateQueue.shift(),this.stateQueue.push(r)}getStateAtTime(e,t=!1){if(!this.playing)return this.lastDequeuedState;if(t){let t=this.lastDequeuedState;for(const a of this.stateQueue){if(!(a.time<=e))break;t=a}return t}let a=this.lastDequeuedState;for(;this.stateQueue.length>0;){if(!(this.stateQueue[0].time<=e))break;a=this.stateQueue.shift(),this.lastDequeuedState=a}return a}clearStateQueue(){this.stateQueue=[],this.lastDequeuedState=null}processRow(e,t,a,n){if(!this.song)return;const s=1===a.flag1||1===a.flag2,r=2===a.flag1||2===a.flag2,i=3===a.flag1||3===a.flag2,o=4===a.flag1||4===a.flag2;if(i){if(t.gainNode.gain.setValueAtTime(0,n),t.player){try{t.player.stop(n)}catch{}t.player=null}return}const l=a.effTyp??(a.effect?parseInt(a.effect[0],16):0),c=a.eff??(a.effect?parseInt(a.effect.substring(1),16):0),u=a.instrument??0;if(u>0){const e=this.song.instruments.find(e=>e.id===u);e&&(t.instrument=e,t.sampleNum=u,t.volume=64,t.finetune=e.metadata?.modPlayback?.finetune??0,t.gainNode.gain.setValueAtTime(t.volume/64,n))}const d=a.note,p=a.period,m=a.probability,h=void 0!==m&&m>0&&m<100&&100*Math.random()>=m,f=r||o;if(d&&0!==d&&97!==d&&!h){t.xmNote=d;const a=p||this.noteToPeriod(d,t.finetune);if(3===l||5===l)t.portaTarget=a,0!==c&&3===l&&(t.tonePortaSpeed=c);else{t.note=a,t.period=t.note;let r=0;9===l&&(r=c>0?256*c:256*t.sampleOffset,t.sampleOffset=c>0?c:t.sampleOffset);const i=t.previousSlideFlag&&null!==d&&!o,u="TB303"===t.instrument?.synthType||"Buzz3o3"===t.instrument?.synthType;if("undefined"!=typeof window&&window.TB303_DEBUG_ENABLED&&u){const e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=d?d+11:0,a=Math.floor(t/12)-1;d&&e[t%12]}const p=u?US(d):GS(a);i&&null!==t.lastPlayedNoteName&&t.lastPlayedNoteName;t.lastPlayedNoteName=p,this.triggerNote(t,n,r,e,s,i,f,o),4&t.waveControl||(t.vibratoPos=0),64&t.waveControl||(t.tremoloPos=0)}}if(d&&97!==d&&(t.previousSlideFlag=(r||o)??!1),97===d){t.previousSlideFlag=!1;"TB303"===t.instrument?.synthType||t.instrument;"undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,this.releaseMacros(t),this.stopChannel(t,e)}void 0!==a.volume&&a.volume>=16&&a.volume<=80&&(t.volume=a.volume-16,t.gainNode.gain.setValueAtTime(t.volume/64,n)),this.processEffect0(e,t,l,c,n);const y=a.effTyp2??0,g=a.eff2??0;0===y&&0===g||this.processEffect0(e,t,y,g,n)}processEffect0(e,t,a,n,s){const r=n>>4&15,i=15&n;if(t.instrument?.synthType?.startsWith("Furnace")){const s=Qg();11===a||13===a||15===a||(14===a?s.applyFurnaceExtendedEffect(t.instrument.id,r,i,e):s.applyFurnaceEffect(t.instrument.id,a,n,e))}switch(a){case 0:case 5:case 6:case 10:break;case 1:case 2:0!==n&&(t.portaSpeed=n);break;case 3:0!==n&&(t.tonePortaSpeed=n);break;case 4:0!==r&&(t.vibratoCmd=15&t.vibratoCmd|r<<4),0!==i&&(t.vibratoCmd=240&t.vibratoCmd|i);break;case 7:0!==r&&(t.tremoloCmd=15&t.tremoloCmd|r<<4),0!==i&&(t.tremoloCmd=240&t.tremoloCmd|i);break;case 8:t.panning=n,t.panNode.pan.setValueAtTime((n-128)/128,s);break;case 9:0!==n&&(t.sampleOffset=n);break;case 11:this.posJumpPos=n,this.posJumpFlag=!0,this.pBreakFlag=!0;break;case 12:t.volume=Math.min(64,n),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 13:this.pBreakPos=10*r+i,this.pBreakPos>63&&(this.pBreakPos=0),this.pBreakFlag=!0;break;case 14:this.processExtendedEffect0(e,t,r,i,s);break;case 15:0===n||(n<32?this.speed!==n&&(this.speed=n,Kv.getState().setSpeed(n)):this.bpm!==n&&(this.bpm=n,Kv.getState().setBPM(n)));break;case 16:this.globalVolume=Math.min(64,n),this.updateAllChannelVolumes(s);break;case 17:0!==n&&(t.globalVolSlide=n);break;case 25:0!==n&&(t.panSlide=n);break;case 27:t.retrigCount=15&n,t.retrigVolSlide=n>>4&15}}processExtendedEffect0(e,t,a,n,s){switch(a){case 1:t.period=Math.max(113,t.period-n),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+n),this.updatePeriod(t);break;case 4:t.waveControl=240&t.waveControl|15&n;break;case 5:t.finetune=n>7?n-16:n;break;case 6:0===n?t.patternLoopRow=this.pattPos:(0===t.patternLoopCount?t.patternLoopCount=n:t.patternLoopCount--,0!==t.patternLoopCount&&(this.pBreakPos=t.patternLoopRow,this.pBreakFlag=!0));break;case 7:t.waveControl=15&t.waveControl|(15&n)<<4;break;case 9:t.retrigCount=n;break;case 10:t.volume=Math.min(64,t.volume+n),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 11:t.volume=Math.max(0,t.volume-n),t.gainNode.gain.setValueAtTime(t.volume/64,s);break;case 14:this.patternDelay=n*this.speed}}processEffectTick(e,t,a,n){const s=1===a.flag1||1===a.flag2,r=2===a.flag1||2===a.flag2,i=3===a.flag1||3===a.flag2;if(4===a.flag1||a.flag2,i)return;const o=a.effTyp??(a.effect?parseInt(a.effect[0],16):0),l=a.eff??(a.effect?parseInt(a.effect.substring(1),16):0),c=l>>4&15,u=15&l,d=a.effTyp2??0,p=a.eff2??0;switch(0===d&&0===p||this.processEffectTickSingle(e,t,a,d,p,n),t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,o,l,c,u),o){case 0:0!==l&&this.doArpeggio(t,l);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,l,n);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,l,n);break;case 7:this.doTremolo(t,n);break;case 10:this.doVolumeSlide(t,l,n);break;case 14:if(9===c&&u>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=u,this.triggerNote(t,n,0,e,s,!1,!1));else if(12===c&&u===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,n);else if(13===c&&u===this.currentTick){const a=t.previousSlideFlag;this.triggerNote(t,n,0,e,s,a,r)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,n);break;case 25:this.doPanSlide(t,t.panSlide,n);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&l,this.applyRetrigVolSlide(t,t.retrigVolSlide,n),this.triggerNote(t,n,0,e,s,!1,!1)))}}processEffectTickSingle(e,t,a,n,s,r){const i=1===a.flag1||1===a.flag2,o=2===a.flag1||2===a.flag2,l=s>>4&15,c=15&s;switch(t.instrument?.synthType?.startsWith("Furnace")&&this.forwardEffectToFurnace(t,e,n,s,l,c),n){case 0:0!==s&&this.doArpeggio(t,s);break;case 1:t.period=Math.max(113,t.period-t.portaSpeed),this.updatePeriod(t);break;case 2:t.period=Math.min(856,t.period+t.portaSpeed),this.updatePeriod(t);break;case 3:this.doTonePortamento(t);break;case 4:this.doVibrato(t);break;case 5:this.doTonePortamento(t),this.doVolumeSlide(t,s,r);break;case 6:this.doVibrato(t),this.doVolumeSlide(t,s,r);break;case 7:this.doTremolo(t,r);break;case 10:this.doVolumeSlide(t,s,r);break;case 14:if(9===l&&c>0)t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=c,this.triggerNote(t,r,0,e,i,!1,!1));else if(12===l&&c===this.currentTick)t.volume=0,t.gainNode.gain.setValueAtTime(0,r);else if(13===l&&c===this.currentTick){const a=t.previousSlideFlag;this.triggerNote(t,r,0,e,i,a,o)}break;case 17:this.doGlobalVolumeSlide(t.globalVolSlide,r);break;case 25:this.doPanSlide(t,t.panSlide,r);break;case 27:t.retrigCount>0&&(t.retrigCount--,t.retrigCount<=0&&(t.retrigCount=15&s,this.applyRetrigVolSlide(t,t.retrigVolSlide,r),this.triggerNote(t,r,0,e,i,!1,!1)))}}forwardEffectToFurnace(e,t,a,n,s,r){if(11===a||13===a||15===a||0===a&&0===n)return;const i=Qg();14===a?i.applyFurnaceExtendedEffect(e.instrument.id,s,r,t):i.applyFurnaceEffect(e.instrument.id,a,n,t)}doArpeggio(e,t){const a=t>>4&15,n=15&t,s=this.currentTick%3;let r=e.note;1===s?r=this.periodPlusSemitones(e.note,a,e.finetune):2===s&&(r=this.periodPlusSemitones(e.note,n,e.finetune)),this.updatePeriodDirect(e,r)}doTonePortamento(e){0!==e.portaTarget&&e.period!==e.portaTarget&&(e.period<e.portaTarget?(e.period+=e.tonePortaSpeed,e.period>e.portaTarget&&(e.period=e.portaTarget)):(e.period-=e.tonePortaSpeed,e.period<e.portaTarget&&(e.period=e.portaTarget)),this.updatePeriod(e))}doVibrato(e){const t=e.vibratoCmd>>4&15,a=15&e.vibratoCmd,n=3&e.waveControl;let s;0===n?s=WS[31&e.vibratoPos]:1===n?(s=8*(31&e.vibratoPos),e.vibratoPos>=32&&(s=255-s)):s=255;let r=s*a>>7;e.vibratoPos>=32&&(r=-r),this.updatePeriodDirect(e,e.period+r),e.vibratoPos=e.vibratoPos+t&63}doTremolo(e,t){const a=e.tremoloCmd>>4&15,n=15&e.tremoloCmd,s=e.waveControl>>4&3;let r;0===s?r=WS[31&e.tremoloPos]:1===s?(r=8*(31&e.tremoloPos),e.tremoloPos>=32&&(r=255-r)):r=255;let i=r*n>>6;e.tremoloPos>=32&&(i=-i);const o=Math.max(0,Math.min(64,e.volume+i));e.gainNode.gain.setValueAtTime(o/64,t),e.tremoloPos=e.tremoloPos+a&63}doVolumeSlide(e,t,a){const n=t>>4&15,s=15&t;n>0?e.volume=Math.min(64,e.volume+n):s>0&&(e.volume=Math.max(0,e.volume-s)),e.gainNode.gain.setValueAtTime(e.volume/64,a)}doGlobalVolumeSlide(e,t){const a=e>>4&15,n=15&e;a>0?this.globalVolume=Math.min(64,this.globalVolume+a):n>0&&(this.globalVolume=Math.max(0,this.globalVolume-n)),this.updateAllChannelVolumes(t)}doPanSlide(e,t,a){const n=t>>4&15,s=15&t;n>0?e.panning=Math.min(255,e.panning+n):s>0&&(e.panning=Math.max(0,e.panning-s)),e.panNode.pan.setValueAtTime((e.panning-128)/128,a)}applyRetrigVolSlide(e,t,a){switch(t){case 0:case 8:break;case 1:e.volume=Math.max(0,e.volume-1);break;case 2:e.volume=Math.max(0,e.volume-2);break;case 3:e.volume=Math.max(0,e.volume-4);break;case 4:e.volume=Math.max(0,e.volume-8);break;case 5:e.volume=Math.max(0,e.volume-16);break;case 6:e.volume=Math.floor(2*e.volume/3);break;case 7:e.volume=Math.floor(e.volume/2);break;case 9:e.volume=Math.min(64,e.volume+1);break;case 10:e.volume=Math.min(64,e.volume+2);break;case 11:e.volume=Math.min(64,e.volume+4);break;case 12:e.volume=Math.min(64,e.volume+8);break;case 13:e.volume=Math.min(64,e.volume+16);break;case 14:e.volume=Math.min(64,Math.floor(3*e.volume/2));break;case 15:e.volume=Math.min(64,2*e.volume)}e.gainNode.gain.setValueAtTime(e.volume/64,a)}processMacros(e,t){if(!e.instrument?.furnace?.macros)return;const a=e.instrument.furnace.macros;if(0!==a.length){for(const n of a){if(!n.data||0===n.data.length)continue;let a=e.macroPos;const s=n.speed||1;if(this.currentTick%s!==0)continue;e.macroReleased&&n.release>=0&&a<n.release&&(a=n.release),a>=n.data.length&&(a=n.loop>=0&&n.loop<n.data.length?e.macroReleased&&n.release>=0&&n.loop<n.release?n.data.length-1:n.loop:n.data.length-1);const r=n.data[a]??0;this.applyMacroValue(e,n.type,r,t)}e.macroPos++}}applyMacroValue(e,t,a,n){switch(t){case Tn.VOL:e.volume=Math.round(a/15*64),e.gainNode.gain.setValueAtTime(e.volume/64*(this.globalVolume/64),n);break;case Tn.ARP:if(e.macroArpNote=a>127?a-256:a,e.period>0){const t=Math.pow(2,e.macroArpNote/12),a=Math.round(e.note/t);this.updatePeriodDirect(e,a)}break;case Tn.DUTY:e.macroDuty=a;break;case Tn.WAVE:e.macroWaveform=a;break;case Tn.PITCH:if(e.macroPitchOffset=a>127?a-256:a,e.period>0){const t=e.macroPitchOffset/64,a=Math.round(e.period*(1-.01*t));this.updatePeriodDirect(e,Math.max(113,Math.min(856,a)))}break;case Tn.EX1:case Tn.EX2:case Tn.EX3:case Tn.EX4:case Tn.EX5:case Tn.EX6:case Tn.EX7:case Tn.EX8:case Tn.ALG:case Tn.FB:case Tn.FMS:case Tn.AMS:break;case Tn.PAN_L:e.panning=Math.max(0,128-8*a),e.panNode.pan.setValueAtTime((e.panning-128)/128,n);break;case Tn.PAN_R:e.panning=Math.min(255,128+8*a),e.panNode.pan.setValueAtTime((e.panning-128)/128,n)}}releaseMacros(e){e.macroReleased=!0}triggerNote(e,t,a,n,s,r,i,o){if(void 0!==n){if(Qg().isChannelMuted(n))return}const l=t??Z();if(e.player)try{e.player.stop(l)}catch{}if(e.macroPos=0,e.macroReleased=!1,e.macroPitchOffset=0,e.macroArpNote=0,!e.instrument){if(!(this.song&&this.song.instruments.length>0))return;e.instrument=this.song.instruments[0],e.sampleNum=this.song.instruments[0].id,e.volume=64,e.finetune=e.instrument.metadata?.modPlayback?.finetune??0}const c=Qg(),u=e.instrument.synthType&&"Sampler"!==e.instrument.synthType&&e.xmNote>0&&e.xmNote<97?US(e.xmNote):GS(e.period),d=Kv.getState(),p=d.grooveTemplateId,m=$n.find(e=>e.id===p),h=d.swing/100;let f=0;m&&(f=function(e,t){if(!e.velocityOffsets||0===e.velocityOffsets.length)return 0;const a=t%e.velocityOffsets.length;return e.velocityOffsets[a]}(m,this.pattPos)*h);const y=Math.max(0,Math.min(1,e.volume/64+f));if(100!==d.swing&&this.pattPos,void 0!==n&&Se.schedule(()=>{c.triggerChannelMeter(n,y)},l),e.instrument.synthType&&"Sampler"!==e.instrument.synthType){const t=2.5/this.bpm*this.speed,a=("TB303"===e.instrument.synthType||"Buzz3o3"===e.instrument.synthType)&&!i?.8*t:1.05*t;return void c.triggerNote(e.instrument.id,u,a,l,y,e.instrument,s,r,n,e.period,void 0,0,o)}const g=c.getDecodedBuffer(e.instrument.id);if(!g)return;const b=e.instrument.sample;if(!e.period||e.period<=0)return;const v=e.finetune,x=Math.pow(2,v/96),w=428/e.period*x;let k=this.bufferCache.get(e.instrument.id);k||(k=new xe(g),this.bufferCache.set(e.instrument.id,k));const S=(e.activePlayerIdx+1)%e.playerPool.length,M=e.playerPool[S];if(e.activePlayerIdx=S,"started"===M.state)try{M.stop(l)}catch{}M.buffer=k;const N=b?.sampleRate||8363,C=g.duration;b?.loop&&(b.loopEnd??0)>(b.loopStart??0)?(M.loop=!0,M.loopStart=Math.min((b.loopStart??0)/N,C-1e-4),M.loopEnd=Math.min((b.loopEnd??0)/N,C),M.loopEnd<=M.loopStart&&(M.loopEnd=C)):M.loop=!1,M.playbackRate=w,e.player=M;try{const e=a>0?a/N:0;M.start(l,Math.min(e,C-1e-4))}catch(P){}}stopChannel(e,t){for(const a of e.playerPool)try{"started"===a.state&&a.stop()}catch{}if(e.player=null,e.instrument&&e.instrument.synthType&&"Sampler"!==e.instrument.synthType&&e.lastPlayedNoteName)try{Qg().triggerNoteRelease(e.instrument.id,e.lastPlayedNoteName,0,e.instrument,t)}catch{}e.lastPlayedNoteName=null}updatePeriod(e){this.updatePeriodDirect(e,e.period)}updatePeriodDirect(e,t){if(!e.player||0===t)return;const a=e.instrument?.sample?.sampleRate||8363,n=3546895/t;e.player.playbackRate=n/a}updateAllChannelVolumes(e){const t=this.globalVolume/64;for(const a of this.channels){const n=a.volume/64*t;a.gainNode.gain.setValueAtTime(n,e)}}noteToPeriod(e,t){if("number"==typeof e&&e>0){if(e>=113&&e<=856)return e;if(e<97){let a=e-1,n=0;for(;a<12;)a+=12,n--;for(;a>47;)a-=12,n++;if(a-=12,a>=0&&a<36){let e=this.getPeriod(a,t);return n>0?e=Math.round(e/Math.pow(2,n)):n<0&&(e=Math.round(e*Math.pow(2,-n))),e}}}else if("string"==typeof e)return this.noteStringToPeriod(e,t);return 0}noteStringToPeriod(e,t){const a=e.match(/^([A-G][#]?)-?(\d)$/);if(!a)return 0;const n={C:0,"C#":1,D:2,"D#":3,E:4,F:5,"F#":6,G:7,"G#":8,A:9,"A#":10,B:11}[a[1]]??0,s=12*(parseInt(a[2],10)-1)+n;return s<0||s>=36?0:this.getPeriod(s,t)}getPeriod(e,t){return LS[36*(t>=0?t:t+16)+Math.min(35,Math.max(0,e))]}periodPlusSemitones(e,t,a){const n=36*(a>=0?a:a+16);let s=0;for(let i=0;i<36;i++)if(LS[n+i]<=e){s=i;break}const r=Math.min(35,Math.max(0,s+t));return LS[n+r]}advanceRow(){if(!this.song)return;this.pBreakFlag?(this.pattPos=this.pBreakPos,this.pBreakFlag=!1,this.pBreakPos=0,this.posJumpFlag||this.songPos++):this.pattPos++,this.posJumpFlag&&(this.songPos=this.posJumpPos,this.posJumpFlag=!1);const e=this.song.songPositions[this.songPos],t=this.song.patterns[e],a=t?.length??64;if(this.pattPos>=a&&(this.pattPos=0,this.songPos++),this.songPos>=this.song.songLength&&(this.songPos=this.song.restartPosition<this.song.songLength?this.song.restartPosition:0,this.onSongEnd?.()),this.onRowChange&&this.song){const e=this.song.songPositions[this.songPos];this.onRowChange(this.pattPos,e,this.songPos)}}seekTo(e,t){if(!this.song)return;const a=this.playing;null!==this.schedulerTimerId&&(clearInterval(this.schedulerTimerId),this.schedulerTimerId=null),this.playing=!1;for(let r=0;r<this.channels.length;r++)this.stopChannel(this.channels[r],r);this.clearStateQueue(),this.songPos=Math.max(0,Math.min(e,this.song.songLength-1)),this.pattPos=Math.max(0,t),this.currentTick=0,this.totalTicksScheduled=0;const n=this.song.songPositions[this.songPos],s=this.song.patterns[n];s&&this.pattPos>=s.length&&(this.pattPos=0),this.pBreakFlag=!1,this.posJumpFlag=!1,this.patternDelay=0,this.onRowChange&&this.onRowChange(this.pattPos,n,this.songPos),a&&(this.playing=!0,this.startScheduler())}isPlaying(){return this.playing}getBPM(){return this.bpm}getSpeed(){return this.speed}getCurrentRow(){return this.pattPos}getCurrentPosition(){return this.songPos}getCurrentTick(){return this.currentTick}dispose(){this.stop();for(const e of this.channels){for(const t of e.playerPool)try{t.dispose()}catch{}e.gainNode.dispose(),e.panNode.dispose()}this.bufferCache.clear(),this.masterGain.dispose(),this.channels=[],this.song=null}}let KS=null;function qS(){return KS||(KS=new HS),KS}const $S=24,XS=10,YS=40,ZS=["C-","C#","D-","D#","E-","F-","F#","G-","G#","A-","A#","B-"];function QS(e){if(0===e)return"---";if(97===e)return"OFF";const t=(e-1)%12,a=Math.floor((e-1)/12);return`${ZS[t]}${a}`}function JS(e){return e.toString(16).toUpperCase().padStart(2,"0")}const eM=e.memo(({onAcidGenerator:t,visibleChannels:a,startChannel:n=0,onSwipeLeft:r,onSwipeRight:i,onSwipeUp:o,onSwipeDown:l})=>{const{isMobile:c}=s.useContext(jS)||{breakpoint:"desktop",isMobile:!1,isTablet:!1,isDesktop:!0,width:1024,isTouch:!1},u=s.useRef(null),d=s.useRef(null),p=s.useRef(null),[m,h]=s.useState({width:800,height:600}),[f,y]=s.useState(0),[g,b]=s.useState(0),[v,x]=s.useState(0),[w,k]=s.useState(0),S=s.useRef([]),M=s.useRef({}),N=s.useRef({}),C=s.useRef({}),P=s.useRef(null),{pattern:E,patterns:_,currentPatternIndex:T,addChannel:A,removeChannel:O,toggleChannelMute:I,toggleChannelSolo:F,setChannelColor:D,setCell:R,moveCursorToChannel:j,copyTrack:B,cutTrack:L,pasteTrack:V,mobileChannelIndex:z,cursor:U,selection:G,showGhostPatterns:W}=ob(Ua(e=>({pattern:e.patterns[e.currentPatternIndex],patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,addChannel:e.addChannel,removeChannel:e.removeChannel,toggleChannelMute:e.toggleChannelMute,toggleChannelSolo:e.toggleChannelSolo,setChannelColor:e.setChannelColor,setCell:e.setCell,moveCursorToChannel:e.moveCursorToChannel,copyTrack:e.copyTrack,cutTrack:e.cutTrack,pasteTrack:e.pasteTrack,mobileChannelIndex:e.cursor.channelIndex,cursor:e.cursor,selection:e.selection,showGhostPatterns:e.showGhostPatterns}))),{instruments:H}=Bv(Ua(e=>({instruments:e.instruments}))),K=s.useCallback(()=>{if(!E||!c)return;const e=Math.max(0,U.rowIndex-4);ob.getState().moveCursorToRow(e)},[E,c,U.rowIndex]),q=s.useCallback(()=>{if(!E||!c)return;const e=Math.min(E.length-1,U.rowIndex+4);ob.getState().moveCursorToRow(e)},[E,c,U.rowIndex]),$=s.useCallback(e=>{if(!E||!c)return;const t=Math.round(e/$S);if(Math.abs(t)>0){const e=Math.max(0,Math.min(E.length+31,U.rowIndex+t));ob.getState().moveCursorToRow(e)}},[E,c,U.rowIndex]),X=IS({onSwipeLeft:r,onSwipeRight:i,onSwipeUp:K,onSwipeDown:q,onTap:s.useCallback((e,t)=>{if(!E||!c||!d.current)return;const a=d.current.getBoundingClientRect(),n=e-a.left+f,s=t-a.top+d.current.scrollTop,r=Math.floor((s-32)/$S);let i=0;n>YS&&(i=Math.floor((n-YS)/200),i=Math.max(0,Math.min(i,E.channels.length-1)));const o=Math.max(0,Math.min(r,E.length-1)),l=ob.getState();l.moveCursorToRow(o),l.moveCursorToChannel(i)},[E,c,f,U.columnType]),onScroll:$,swipeThreshold:30,enabled:c}),Y=s.useRef(null),Q=s.useRef(-1),J=s.useRef(0),ee=cx(e=>e.currentThemeId),te=cx(e=>e.getCurrentTheme)(),ae=s.useRef(ee),ne="cyan-lineart"===ee,se=(()=>{const[t,a]=e.useState({position:null,rowIndex:0,channelIndex:0}),n=s.useCallback((e,t,n)=>{e.preventDefault(),e.stopPropagation(),a({position:{x:e.clientX,y:e.clientY},rowIndex:t,channelIndex:n})},[]),r=s.useCallback(()=>{a(e=>({...e,position:null}))},[]),i=s.useCallback(e=>{e.preventDefault()},[]);return{...t,openMenu:n,closeMenu:r,isOpen:null!==t.position,handleContextMenu:i,cellInfo:t.position?{rowIndex:t.rowIndex,channelIndex:t.channelIndex}:null}})(),[re,ie]=s.useState(null),oe=s.useCallback(e=>{if(!E)return;const t=se.cellInfo?.channelIndex??U.channelIndex,a=G?.startRow??U.rowIndex,n=G?.endRow??Math.min(U.rowIndex+15,E.length-1);ie({isOpen:!0,field:e,channelIndex:t,startRow:a,endRow:n}),se.closeMenu()},[se,U,G,E]);s.useEffect(()=>{ae.current!==ee&&(M.current={},N.current={},C.current={},ae.current=ee)},[ee]);const le=s.useMemo(()=>({bg:"#0a0a0b",rowNormal:"#0d0d0e",rowHighlight:"#111113",centerLine:te.colors.accentGlow,cursor:te.colors.accent,cursorBg:te.colors.accentGlow,text:"#e0e0e0",textMuted:"#505050",textNote:"#909090",textNoteActive:"#ffffff",textInstrument:"#4ade80",textVolume:"#60a5fa",textEffect:"#f97316",border:"#252530",lineNumber:"#707070",lineNumberHighlight:"#f97316"}),[ne]),ce=s.useCallback(()=>{if(!E||!c)return;const e=Math.min(E.channels.length-1,z+1);e!==z&&j(e)},[E,c,z,j]),ue=s.useCallback(()=>{if(!E||!c)return;const e=Math.max(0,z-1);e!==z&&j(e)},[E,c,z,j]),de=function({threshold:e=50,onSwipeLeft:t,onSwipeRight:a}){const n=s.useRef(null);return{onTouchStart:s.useCallback(e=>{const t=e.touches[0];n.current={startX:t.clientX,startY:t.clientY,startTime:Date.now()}},[]),onTouchEnd:s.useCallback(s=>{if(!n.current)return;const r=s.changedTouches[0],i=r.clientX-n.current.startX,o=r.clientY-n.current.startY,l=Date.now()-n.current.startTime;Math.abs(i)>e&&Math.abs(i)>1.5*Math.abs(o)&&l<500&&(i>0&&a?a():i<0&&t&&t()),n.current=null},[e,t,a]),onTouchCancel:s.useCallback(()=>{n.current=null},[])}}({threshold:50,onSwipeLeft:ce,onSwipeRight:ue}),pe=s.useCallback((e,t)=>{if(!E)return;const a=bS[t];if(!a)return;const n=E.channels[e].instrumentId??1;a.generate({patternLength:E.length,instrumentId:n,note:49,velocity:64}).forEach((t,a)=>{R(e,a,t)})},[E,R]),me=s.useCallback(e=>{if(E){for(let t=0;t<E.length;t++)R(e,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0});Vv.getState().setStatusMessage("CHANNEL CLEARED")}},[E,R]),he=s.useCallback(e=>{B(e)},[B]),fe=s.useCallback(e=>{L(e)},[L]),ye=s.useCallback(e=>{V(e)},[V]),ge=s.useCallback((e,t)=>{if(E){for(let a=0;a<E.length;a++){const n=E.channels[e].rows[a];if(n.note&&0!==n.note&&97!==n.note){let s=n.note+t;s=Math.max(1,Math.min(96,s)),R(e,a,{...n,note:s})}}Vv.getState().setStatusMessage(`TRANSPOSE ${t>0?"+":""}${t}`)}},[E,R]),be=s.useCallback(e=>{if(E){for(let t=0;t<E.length;t++){const a=E.channels[e].rows[t];if(null!==a.volume&&a.volume>=16){const n=Math.floor(8*Math.random())-4,s=Math.max(16,Math.min(80,a.volume+n));R(e,t,{...a,volume:s})}}Vv.getState().setStatusMessage("HUMANIZED")}},[E,R]),ve=s.useCallback(e=>{if(!E)return;const t=E.channels[e];if(!t)return;let a=-1,n=-1,s=0,r=0;for(let o=0;o<E.length;o++){const e=t.rows[o];null!==e.volume&&e.volume>=16&&e.volume<=80&&(-1===a&&(a=o,s=e.volume),n=o,r=e.volume)}if(-1===a||-1===n||n-a<2)return;const i=n-a;for(let o=a+1;o<n;o++){const n=(o-a)/i,l=Math.round(s+(r-s)*n),c=t.rows[o];R(e,o,{...c,volume:l})}Vv.getState().setStatusMessage("INTERPOLATED")},[E,R]);s.useEffect(()=>{E&&(S.current=E.channels.map(()=>({level:0,triggered:!1})))},[E?.channels.length]);const xe=s.useCallback((e,t=!1)=>{const a=`${e}-${t?"a":"n"}`;if(M.current[a])return M.current[a];const n=document.createElement("canvas");n.width=34,n.height=$S;const s=n.getContext("2d");return s.font='14px "JetBrains Mono", "Fira Code", monospace',s.textBaseline="middle",s.fillStyle=0===e?le.textMuted:97===e?le.textEffect:t?le.textNoteActive:le.textNote,s.fillText(QS(e),0,12),M.current[a]=n,n},[le.textMuted,le.textEffect,le.textNote,le.textNoteActive]),we=s.useCallback((e,t,a,n,s,r,i,o,l,c)=>{const u=`${e}-${t}-${a}-${n}-${s}-${r}-f1${i??"x"}-f2${o??"x"}-p${l??"x"}-${c?"B":""}`;if(N.current[u])return N.current[u];const d=void 0!==i||void 0!==o,p=void 0!==l&&l>0,m=document.createElement("canvas");m.width=116+(d?28:0)+(p?24:0),m.height=$S;const h=m.getContext("2d");h.font='14px "JetBrains Mono", "Fira Code", monospace',h.textBaseline="middle";let f=0;const y=12;0!==e?(h.fillStyle=le.textInstrument,h.fillText(JS(e),f,y)):c||(h.fillStyle=le.textMuted,h.fillText("..",f,y)),f+=24;t>=16&&t<=80?(h.fillStyle=le.textVolume,h.fillText(JS(t),f,y)):c||(h.fillStyle=le.textMuted,h.fillText("..",f,y)),f+=24;0!==a||0!==n?(h.fillStyle=le.textEffect,h.fillText(a.toString(16).toUpperCase()+JS(n),f,y)):c||(h.fillStyle=le.textMuted,h.fillText("...",f,y)),f+=34;if(0!==s||0!==r?(h.fillStyle=le.textEffect,h.fillText(s.toString(16).toUpperCase()+JS(r),f,y)):c||(h.fillStyle=le.textMuted,h.fillText("...",f,y)),f+=34,d&&(1===i?(h.fillStyle="#f59e0b",h.fillText("A",f,y)):2===i?(h.fillStyle="#06b6d4",h.fillText("S",f,y)):3===i?(h.fillStyle="#facc15",h.fillText("M",f,y)):4===i?(h.fillStyle="#22d3ee",h.fillText("H",f,y)):c||(h.fillStyle=le.textMuted,h.fillText(".",f,y)),f+=14,1===o?(h.fillStyle="#f59e0b",h.fillText("A",f,y)):2===o?(h.fillStyle="#06b6d4",h.fillText("S",f,y)):3===o?(h.fillStyle="#facc15",h.fillText("M",f,y)):4===o?(h.fillStyle="#22d3ee",h.fillText("H",f,y)):c||(h.fillStyle=le.textMuted,h.fillText(".",f,y)),f+=14),p){const e=Math.min(99,Math.max(0,l)),t=e>=75?"#4ade80":e>=50?"#facc15":e>=25?"#fb923c":"#f87171";h.fillStyle=t,h.fillText(e.toString(10).padStart(2,"0"),f,y)}return N.current[u]=m,m},[le.textMuted,le.textInstrument,le.textVolume,le.textEffect]),ke=s.useCallback((e,t)=>{const a=e%4==0,n=`${e}-${t}-${a}`;if(C.current[n])return C.current[n];const s=document.createElement("canvas");s.width=YS,s.height=$S;const r=s.getContext("2d");r.font=a?'bold 12px "JetBrains Mono", monospace':'12px "JetBrains Mono", monospace',r.textBaseline="middle",r.textAlign="center",r.fillStyle=a?le.lineNumberHighlight:le.lineNumber;const i=t?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return r.fillText(i,20,12),C.current[n]=s,s},[le.lineNumber,le.lineNumberHighlight]),Se=s.useCallback(()=>{const e=u.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const a=ob.getState(),n=Kv.getState(),s=Vv.getState(),r=a.patterns[a.currentPatternIndex],i=n.smoothScrolling,o=a.showGhostPatterns;if(!r)return t.fillStyle=le.bg,t.fillRect(0,0,m.width,m.height),t.fillStyle=le.textMuted,t.font="16px sans-serif",t.textAlign="center",t.textBaseline="middle",void t.fillText("No pattern loaded",m.width/2,m.height/2);const l=a.cursor,c=n.isPlaying,d=s.useHexNumbers,p=s.blankEmptyCells,h=n.speed,y=n.bpm,{width:w,height:S}=m,M=r.length;let N,C=0;if(c){const e=qS(),t=Z()+.01,a=e.getStateAtTime(t);if(a){if(Y.current=a,N=a.row,i){const n=e.getStateAtTime(t+.5,!0);let s;s=n&&n.row!==a.row?n.time-a.time:2.5/y*h;const r=t-a.time;C=Math.min(Math.max(r/s,0),1)*$S}else C=0;Q.current=N,J.current=C}else N=n.currentRow}else N=l.rowIndex,Y.current=null,Q.current=-1,J.current=0;const P=Math.ceil(S/$S)+2,E=Math.floor(P/2),A=N-E,O=A+P,I=Math.floor(S/2)-12,F=I-E*$S-C,D=r.channels.length;(Math.abs(F-g)>.5||A!==v)&&(b(F),x(A),k(e=>e+1));let R=!1,j=!1;for(const u of r.channels){if(R&&j)break;if(!R&&null!==u.instrumentId){const e=H.find(e=>e.id===u.instrumentId);"TB303"!==e?.synthType&&"Buzz3o3"!==e?.synthType||(R=!0)}const e=u.rows[0];e&&(void 0===e.flag1&&void 0===e.flag2||(R=!0),void 0!==e.probability&&(j=!0))}const B=34+(116+(R?28:0)+(j?24:0)+20+4)+20;t.fillStyle=le.bg,t.fillRect(0,0,w,S);for(let u=v;u<O;u++){let e,a=!1,n=null;if(c)if(o&&u<0)if(T>0){if(n=_[T-1],e=n.length+u,e<0||e>=n.length)continue;a=!0}else{if(!(_.length>1))continue;if(n=_[_.length-1],e=n.length+u,e<0||e>=n.length)continue;a=!0}else if(o&&u>=M)if(T<_.length-1){if(n=_[T+1],e=u-M,e<0||e>=n.length)continue;a=!0}else{if(!(_.length>1))continue;if(n=_[0],e=u-M,e<0||e>=n.length)continue;a=!0}else{if(u<0||u>=M)continue;e=u}else if(o&&u<0)if(T>0){if(n=_[T-1],e=n.length+u,e<0||e>=n.length)continue;a=!0}else{if(!(_.length>1))continue;if(n=_[_.length-1],e=n.length+u,e<0||e>=n.length)continue;a=!0}else if(o&&u>=M)if(T<_.length-1){if(n=_[T+1],e=u-M,e<0||e>=n.length)continue;a=!0}else{if(!(_.length>1))continue;if(n=_[0],e=u-M,e<0||e>=n.length)continue;a=!0}else{if(u<0||u>=M)continue;e=u}const s=F+(u-A)*$S;if(s<-24||s>S+$S)continue;const i=e%4==0;a&&(t.globalAlpha=.35),t.fillStyle=i?le.rowHighlight:le.rowNormal,t.fillRect(0,s,w,$S),a&&(t.globalAlpha=1);const l=ke(e,d);t.drawImage(l,4,s),a&&(t.globalAlpha=.35);const m=n||r;for(let o=0;o<D;o++){const n=YS+o*B+8-f,l=YS+o*B-f;if(n+B<0||n>w)continue;const u=r.channels[o]?.color;if(u){const e=t.globalAlpha;t.globalAlpha=a?.02:i?.07:.05,t.fillStyle=u,t.fillRect(l,s,B,$S),t.globalAlpha=e}if(!m.channels[o]){t.fillStyle=le.border,t.fillRect(YS+(o+1)*B-f,s,1,$S);continue}const d=m.channels[o].rows[e];if(!d)continue;if(!d)continue;const h=c&&!a&&e===N,y=d.note||0;if(!p||0!==y){const e=xe(y,h&&y>0);t.drawImage(e,n,s)}const g=we(d.instrument||0,d.volume||0,d.effTyp||0,d.eff||0,d.effTyp2||0,d.eff2||0,d.flag1,d.flag2,d.probability,p);if(t.drawImage(g,n+34+4,s),t.fillStyle=le.border,t.fillRect(YS+(o+1)*B-f,s,1,$S),u){const e=t.globalAlpha;t.globalAlpha=a?.15:.4,t.fillStyle=u,t.fillRect(l,s,2,$S),t.globalAlpha=e}}a&&(t.globalAlpha=1)}t.fillStyle=le.centerLine,t.fillRect(0,I,w,$S);{const e=YS+l.channelIndex*B+8-f;let s=0,i=XS;const o=38,u=0,d=24,p=48,m=82,h=116,y=h+(R?28:0);switch(l.columnType){case"note":i=34;break;case"instrument":s=o+u+l.digitIndex*XS;break;case"volume":s=o+d+l.digitIndex*XS;break;case"effTyp":default:s=o+p;break;case"effParam":s=o+p+XS+l.digitIndex*XS;break;case"effTyp2":s=o+m;break;case"effParam2":s=o+m+XS+l.digitIndex*XS;break;case"flag1":s=o+h;break;case"flag2":s=o+h+XS+4;break;case"probability":s=o+y+l.digitIndex*XS}const g=a.recordMode,b=n.isPlaying;let v;v=g?te.colors.accent:b?te.colors.accentSecondary:te.colors.accent;const x=$S,w=I,k=e+s,S=i;t.clearRect(k,w,S,x),t.fillStyle=v,t.fillRect(k,w,S,x);const M=c?N:l.rowIndex,C=r.channels[l.channelIndex]?.rows[M];if(C){let e="";const a=l.columnType,n=l.digitIndex;if("note"===a)e=QS(C.note??0);else if("instrument"===a){const t=JS(C.instrument??0);e=0===(C.instrument??0)?"..":t,e=e[n]??"."}else if("volume"===a){const t=C.volume??0;e=(t>=16&&t<=80?JS(t):"..")[n]??"."}else if("effTyp"===a){const t=C.effTyp??0,a=C.eff??0;e=0!==t||0!==a?t.toString(16).toUpperCase():"."}else if("effParam"===a){const t=C.effTyp??0,a=C.eff??0;e=(0!==t||0!==a?JS(a):"..")[n]??"."}else if("effTyp2"===a){const t=C.effTyp2??0,a=C.eff2??0;e=0!==t||0!==a?t.toString(16).toUpperCase():"."}else if("effParam2"===a){const t=C.effTyp2??0,a=C.eff2??0;e=(0!==t||0!==a?JS(a):"..")[n]??"."}else if("flag1"===a)e=1===C.flag1?"A":2===C.flag1?"S":".";else if("flag2"===a)e=1===C.flag2?"A":2===C.flag2?"S":".";else if("probability"===a){const t=C.probability??0;e=(t>0?t.toString(10).padStart(2,"0"):"..")[n]??"."}t.font='14px "JetBrains Mono", "Fira Code", monospace',t.textBaseline="middle",t.fillStyle="#ffffff",t.fillText(e,k,w+x/2)}}},[m,le,xe,we,ke,f,ne,v,H,T,_,g]),Me=s.useRef(Se);s.useEffect(()=>{Me.current=Se},[Se]),s.useEffect(()=>{const e=()=>{Me.current(),P.current=requestAnimationFrame(e)};return P.current=requestAnimationFrame(e),()=>{P.current&&cancelAnimationFrame(P.current)}},[]),s.useEffect(()=>{const e=d.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e){const{width:e,height:a}=t.contentRect;e>0&&a>0&&h({width:e,height:a})}});t.observe(e);const a=e.getBoundingClientRect();return a.width>0&&a.height>0&&h({width:a.width,height:a.height}),()=>t.disconnect()},[]),s.useEffect(()=>{const e=u.current;e&&(e.width=m.width,e.height=m.height,M.current={},N.current={},C.current={})},[m]),s.useEffect(()=>{const e=d.current;if(!e)return;const t=e=>{e.preventDefault();if(!Kv.getState().isPlaying)if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){const t=2*Math.sign(e.deltaY),a=ob.getState(),n=a.patterns[a.currentPatternIndex];if(!n)return;const s=a.cursor.rowIndex,r=Math.min(n.length+32,s+t);ob.getState().moveCursorToRow(r)}else y(t=>Math.max(0,t+e.deltaX))};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]);const Ne=s.useCallback(e=>{y(e.currentTarget.scrollLeft)},[]),Ce=E?.channels[0]?.rows[0],Pe=34+(116+(void 0!==Ce?.flag1||void 0!==Ce?.flag2?28:0)+(void 0!==Ce?.probability?24:0)+20+4)+20+20,Ee=E?E.channels.length*Pe:0;if(!E)return Ea.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const _e=E.channels[z],Te=0,Ae=!1;return Ea.jsxs("div",{className:"flex flex-col h-full",...c?de:{},children:[c&&Ea.jsxs("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border relative",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[Ea.jsx("button",{onClick:ue,disabled:z<=0,className:"p-2 rounded-lg transition-colors "+(z<=0?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:Ea.jsx(Ct,{size:20})}),Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsxs("span",{className:"font-bold font-mono text-lg",style:{color:_e?.color||"var(--color-accent)"},children:["CH ",(z+1).toString().padStart(2,"0")]}),Ea.jsxs("span",{className:"text-xs text-text-muted",children:["/ ",E.channels.length.toString().padStart(2,"0")]}),Ea.jsx(iS,{level:Te,isActive:Ae})]}),Ea.jsx("button",{onClick:ce,disabled:z>=E.channels.length-1,className:"p-2 rounded-lg transition-colors "+(z>=E.channels.length-1?"text-text-muted opacity-30":"text-text-secondary hover:bg-dark-bgHover"),children:Ea.jsx(Fe,{size:20})})]}),Ea.jsxs("div",{className:"flex items-center justify-center gap-2 px-3 py-1 border-t border-dark-border/50",children:[Ea.jsx("button",{onClick:()=>I(z),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(_e?.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:bg-dark-bgHover"),children:_e?.muted?Ea.jsx(ot,{size:14}):Ea.jsx(it,{size:14})}),Ea.jsx("button",{onClick:()=>F(z),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(_e?.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:bg-dark-bgHover"),children:Ea.jsx(lt,{size:14})}),Ea.jsx(dS,{currentColor:_e?.color,onColorSelect:e=>D(z,e)})]})]}),!c&&Ea.jsx("div",{className:"flex-shrink-0 bg-dark-bgTertiary border-b border-dark-border z-20 relative h-[37px]",children:Ea.jsxs("div",{className:"flex h-full",children:[Ea.jsx("div",{className:"flex-shrink-0 px-2 text-text-muted text-xs font-medium text-center border-r border-dark-border flex items-center justify-center",style:{width:YS},children:"ROW"}),Ea.jsx("div",{ref:p,onScroll:Ne,className:"overflow-x-auto scrollbar-hidden flex-1","data-vu-scroll":!0,children:Ea.jsxs("div",{className:"flex",style:{width:Ee},children:[E.channels.map((e,a)=>{const n=0,s=!1;return Ea.jsxs("div",{className:`flex-shrink-0 flex items-center justify-between gap-2 px-3 py-1.5\n                        border-r border-dark-border transition-colors relative\n                        ${e.muted?"opacity-50":""}\n                        ${e.solo?"bg-accent-primary/10":""}`,style:{width:Pe,backgroundColor:e.color?`${e.color}15`:void 0,boxShadow:e.color?`inset 3px 0 0 ${e.color}`:void 0},children:[Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsx("span",{className:"font-bold font-mono text-sm",style:{color:e.color||"var(--color-accent)"},children:(a+1).toString().padStart(2,"0")}),Ea.jsx(iS,{level:n,isActive:s})]}),Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsx(xS,{channelIndex:a,channel:e,patternId:E.id,patternLength:E.length,onFillPattern:pe,onClearChannel:me,onCopyChannel:he,onCutChannel:fe,onPasteChannel:ye,onTranspose:ge,onHumanize:be,onInterpolate:ve,onAcidGenerator:t||(()=>{})}),Ea.jsx(dS,{currentColor:e.color,onColorSelect:e=>D(a,e)}),Ea.jsx("button",{onClick:()=>I(a),className:"p-1 rounded transition-colors "+(e.muted?"bg-accent-error/20 text-accent-error":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.muted?"Unmute":"Mute",children:e.muted?Ea.jsx(ot,{size:12}):Ea.jsx(it,{size:12})}),Ea.jsx("button",{onClick:()=>F(a),className:"p-1 rounded transition-colors "+(e.solo?"bg-accent-primary/20 text-accent-primary":"text-text-muted hover:text-text-primary hover:bg-dark-bgHover"),title:e.solo?"Unsolo":"Solo",children:Ea.jsx(lt,{size:12})}),E.channels.length>1&&Ea.jsx("button",{onClick:()=>O(a),className:"p-1 rounded text-text-muted hover:text-accent-error hover:bg-dark-bgHover transition-colors",title:"Remove Channel",children:Ea.jsx(bt,{size:12})})]})]},e.id)}),E.channels.length<16&&Ea.jsx("button",{onClick:A,className:"flex-shrink-0 w-12 flex items-center justify-center border-r border-dark-border\n                      text-text-muted hover:text-accent-primary hover:bg-dark-bgHover transition-colors",title:"Add Channel",children:Ea.jsx($e,{size:16})})]})})]})}),Ea.jsxs("div",{ref:d,className:"flex-1 relative bg-dark-bg",style:{minHeight:200},tabIndex:0,onContextMenu:se.handleContextMenu,...X,children:[Ea.jsx("canvas",{ref:u,style:{width:m.width,height:m.height,display:"block"}}),E&&Ea.jsx(rS,{patternId:E.id,patternLength:E.length,rowHeight:$S,channelCount:E.channels.length,channelWidth:Pe,rowNumWidth:YS,scrollOffset:g,visibleStart:v,parameter:"cutoff",prevPatternId:W?T>0?_[T-1]?.id:_.length>1?_[_.length-1]?.id:void 0:void 0,prevPatternLength:W?T>0?_[T-1]?.length:_.length>1?_[_.length-1]?.length:void 0:void 0,nextPatternId:W?T<_.length-1?_[T+1]?.id:_.length>1?_[0]?.id:void 0:void 0,nextPatternLength:W?T<_.length-1?_[T+1]?.length:_.length>1?_[0]?.length:void 0:void 0},`automation-${E.id}-${w}`),Ea.jsx("div",{className:"absolute right-0 pointer-events-none z-30 overflow-hidden",style:{top:0,left:YS,height:"calc(50% - 12px)"},children:Ea.jsx(cS,{channelWidth:Pe,scrollLeft:f})}),Ea.jsx(wS,{isOpen:se.isOpen,position:se.position,onClose:se.closeMenu,channelIndex:se.cellInfo?.channelIndex??0,rowIndex:se.cellInfo?.rowIndex??0,onOpenParameterEditor:oe}),re?.isOpen&&Ea.jsx(SS,{onClose:()=>ie(null),channelIndex:re.channelIndex,startRow:re.startRow,endRow:re.endRow,field:re.field})]})]})}),tM=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],aM={noteIndex:null,octaveShift:0,accent:!1,slide:!1,tie:!1,mute:!1,hammer:!1,velocity:100};function nM(e,t){if(!e||0===e||97===e)return null;const a=Jn(e).match(/^([A-G])(#?)(-?\d)$/);if(!a)return null;const[,n,s,r]=a,i=parseInt(r,10),o=n+(s||""),l=tM.indexOf(o);if(-1===l)return null;const c=i-t;return c<-1||c>1?{noteIndex:l,octaveShift:Math.max(-1,Math.min(1,c))}:{noteIndex:l,octaveShift:c}}function sM(e,t){if(null===e.noteIndex)return 0;const a=tM[e.noteIndex],n=t+e.octaveShift;let s;return s=a.includes("#")?`${a}${n}`:`${a}-${n}`,Qn(s)}function rM(e){const{patterns:t,currentPatternIndex:a,setCell:n,resizePattern:r,resizeAllPatterns:i}=ob(),[o,l]=s.useState(3),c=t[a],u=c?.channels[e],d=u?.rows||[],p=c?.length||16,m=s.useCallback(e=>{r(a,e)},[a,r]),h=s.useMemo(()=>function(e,t,a){const n=[];for(let s=0;s<a;s++){const a=e[s];if(!a){n.push({...aM});continue}const r=nM(a.note,t);let i=!1;if(s>0&&r&&e[s-1]){const a=nM(e[s-1].note,t);a&&a.noteIndex===r.noteIndex&&a.octaveShift===r.octaveShift&&(i=!0)}n.push({noteIndex:r?.noteIndex??null,octaveShift:r?.octaveShift??0,accent:1===a.flag1||1===a.flag2,slide:2===a.flag1||2===a.flag2,tie:i,mute:3===a.flag1||3===a.flag2,hammer:4===a.flag1||4===a.flag2,velocity:a.volume??100})}return{steps:n,baseOctave:t,length:a}}(d,o,p),[d,o,p]),f=s.useCallback((t,a,s=0)=>{if(t<0||t>=p)return;const r=null!==a?sM({noteIndex:a,octaveShift:s},o):0,i=d[t];if(0!==r&&0===(i?.instrument||0)){n(e,t,{note:r,instrument:u?.instrumentId??1})}else n(e,t,{note:r})},[e,n,o,p,d,u]),y=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=1===d[t]?.flag1||1===d[t]?.flag2;n(e,t,{flag1:a?0:1})},[e,d,n]),g=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=2===d[t]?.flag1||2===d[t]?.flag2;n(e,t,{flag2:a?0:2})},[e,d,n]),b=s.useCallback((t,a)=>{if(t<0||t>=d.length)return;const s=d[t];if(!s?.note)return;const r=nM(s.note,o);if(!r)return;const i=sM({noteIndex:r.noteIndex,octaveShift:a},o);n(e,t,{note:i})},[e,d,n,o]),v=s.useCallback(t=>{t<0||t>=p||n(e,t,{note:0,flag1:0,flag2:0})},[e,n,p]),x=s.useCallback(()=>{for(let t=0;t<p;t++)n(e,t,{note:0,flag1:0,flag2:0})},[e,n,p]),w=s.useCallback((t,a)=>{if(t<0||t>=d.length)return;const s=Math.max(0,Math.min(127,a));n(e,t,{volume:s})},[e,d,n]),k=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=3===d[t]?.flag1||3===d[t]?.flag2;n(e,t,{flag1:a?0:3})},[e,d,n]),S=s.useCallback(t=>{if(t<0||t>=d.length)return;const a=4===d[t]?.flag1||4===d[t]?.flag2;n(e,t,{flag2:a?0:4})},[e,d,n]);return{gridPattern:h,baseOctave:o,setBaseOctave:l,maxSteps:p,setMaxSteps:m,resizeAllPatterns:i,setNote:f,toggleAccent:y,toggleSlide:g,toggleMute:k,toggleHammer:S,setOctaveShift:b,setVelocity:w,clearStep:v,clearAll:x}}const iM={chromatic:{name:"Chromatic",intervals:[0,1,2,3,4,5,6,7,8,9,10,11],description:"All notes"},major:{name:"Major",intervals:[0,2,4,5,7,9,11],description:"Ionian mode"},minor:{name:"Natural Minor",intervals:[0,2,3,5,7,8,10],description:"Aeolian mode"},harmonicMinor:{name:"Harmonic Minor",intervals:[0,2,3,5,7,8,11],description:"Minor with raised 7th"},melodicMinor:{name:"Melodic Minor",intervals:[0,2,3,5,7,9,11],description:"Minor with raised 6th and 7th"},dorian:{name:"Dorian",intervals:[0,2,3,5,7,9,10],description:"Minor with raised 6th"},phrygian:{name:"Phrygian",intervals:[0,1,3,5,7,8,10],description:"Minor with lowered 2nd"},lydian:{name:"Lydian",intervals:[0,2,4,6,7,9,11],description:"Major with raised 4th"},mixolydian:{name:"Mixolydian",intervals:[0,2,4,5,7,9,10],description:"Major with lowered 7th"},locrian:{name:"Locrian",intervals:[0,1,3,5,6,8,10],description:"Diminished scale"},pentatonicMajor:{name:"Pentatonic Major",intervals:[0,2,4,7,9],description:"5-note major scale"},pentatonicMinor:{name:"Pentatonic Minor",intervals:[0,3,5,7,10],description:"5-note minor scale"},blues:{name:"Blues",intervals:[0,3,5,6,7,10],description:"Minor pentatonic + blue note"},wholeTone:{name:"Whole Tone",intervals:[0,2,4,6,8,10],description:"All whole steps"},diminished:{name:"Diminished",intervals:[0,2,3,5,6,8,9,11],description:"Half-whole diminished"}};const oM=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],lM=({scaleKey:e,rootNote:t,onScaleChange:a,onRootNoteChange:n})=>{const r=s.useMemo(()=>Object.entries(iM).map(([e,t])=>({value:e,label:t.name,description:t.description})),[]),i=s.useMemo(()=>iM[e]||iM.chromatic,[e]);return Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Root:"}),Ea.jsx("select",{value:t,onChange:e=>n(parseInt(e.target.value,10)),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary",children:oM.map((e,t)=>Ea.jsx("option",{value:t,children:e},t))})]}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("label",{className:"text-xs text-text-secondary whitespace-nowrap",children:"Scale:"}),Ea.jsx("select",{value:e,onChange:e=>a(e.target.value),className:"bg-dark-bgSecondary border border-dark-border rounded px-2 py-1 text-xs text-text-primary focus:outline-none focus:ring-1 focus:ring-accent-primary min-w-[140px]",title:i?.description,children:r.map(e=>Ea.jsx("option",{value:e.value,title:e.description,children:e.label},e.value))})]}),"Chromatic"!==i.name&&Ea.jsxs("span",{className:"text-[10px] text-text-muted",children:["(",i.intervals.length," notes)"]})]})},cM={baseOctave:{label:"Base Octave",min:1,max:6,group:"General"},velocity:{label:"Velocity",min:0,max:127,group:"General"},cutoff:{label:"Cutoff",min:200,max:5e3,group:"303 Main"},resonance:{label:"Resonance",min:0,max:100,group:"303 Main"},envMod:{label:"Env Mod",min:0,max:100,group:"303 Main"},decay:{label:"Decay",min:200,max:2e3,group:"303 Main"},accent:{label:"Accent",min:0,max:100,group:"303 Main"},slideTime:{label:"Slide Time",min:2,max:360,group:"303 Main"},overdrive:{label:"Overdrive",min:0,max:100,group:"303 Main"},normalDecay:{label:"Normal Decay",min:30,max:3e3,group:"Devil Fish"},accentDecay:{label:"Accent Decay",min:30,max:3e3,group:"Devil Fish"},softAttack:{label:"Soft Attack",min:.3,max:30,group:"Devil Fish"},vegSustain:{label:"VEG Sustain",min:0,max:100,group:"Devil Fish"},filterFM:{label:"Filter FM",min:0,max:100,group:"Devil Fish"},filterTracking:{label:"Key Track",min:0,max:200,group:"Devil Fish"}},uM=({onClose:e})=>{const{devices:t,isSupported:a,isEnabled:n,lastMessage:r,enableMIDI:i,disableMIDI:o,onMessage:l}=Rk(),{gridMappings:c,gridIsLearning:u,gridLearningParameter:d,addGridMapping:p,removeGridMapping:m,clearGridMappings:h,startGridLearning:f,stopGridLearning:y}=Gw(),[g,b]=s.useState(null);s.useEffect(()=>{if(!u||!d)return;return l(e=>{if("cc"===e.type&&void 0!==e.controller&&void 0!==e.value){const t=cM[d];p({channel:e.channel,controller:e.controller,parameter:d,min:t.min,max:t.max,curve:"linear"}),y()}})},[u,d,l,p,y]);return a?Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4 space-y-4",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("h3",{className:"text-sm font-semibold text-text-primary flex items-center gap-2",children:[Ea.jsx(Ce,{size:16}),"MIDI Learn"]}),e&&Ea.jsx("button",{onClick:e,className:"text-text-muted hover:text-text-primary text-xs",children:"Close"})]}),Ea.jsx("div",{className:"flex items-center gap-3",children:n?Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("button",{onClick:o,className:"px-3 py-1.5 bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary rounded text-xs transition-colors",children:"Disable MIDI"}),Ea.jsxs("span",{className:"flex items-center gap-1 text-xs text-accent-success",children:[Ea.jsx("span",{className:"w-2 h-2 bg-accent-success rounded-full animate-pulse"}),"Connected"]})]}):Ea.jsx("button",{onClick:async()=>{try{b(null),await i()}catch(e){b(e instanceof Error?e.message:"Failed to enable MIDI")}},className:"px-3 py-1.5 bg-accent-primary hover:bg-accent-primary/80 text-white rounded text-xs font-medium transition-colors",children:"Enable MIDI"})}),g&&Ea.jsx("div",{className:"bg-accent-error/10 border border-accent-error/30 rounded p-2 text-xs text-accent-error",children:g}),n&&t.length>0&&Ea.jsxs("div",{children:[Ea.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-2",children:"Connected Devices"}),Ea.jsx("div",{className:"space-y-1",children:t.map(e=>Ea.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted bg-dark-bgTertiary rounded px-2 py-1",children:[Ea.jsx("span",{className:"w-2 h-2 rounded-full "+("connected"===e.state?"bg-accent-success":"bg-text-muted")}),Ea.jsx("span",{className:"flex-1",children:e.name}),Ea.jsx("span",{className:"text-[10px] opacity-60",children:e.manufacturer})]},e.id))})]}),n&&r&&"cc"===r.type&&Ea.jsxs("div",{className:"bg-dark-bgTertiary rounded p-2",children:[Ea.jsx("div",{className:"text-xs text-text-muted",children:"Last CC Message:"}),Ea.jsxs("div",{className:"text-xs font-mono text-text-primary mt-1",children:["CH",r.channel+1," CC",r.controller," = ",r.value]})]}),n&&Ea.jsxs("div",{className:"space-y-3",children:[Ea.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Map Parameters"}),["General","303 Main","Devil Fish"].map(e=>{const t=Object.keys(cM).filter(t=>cM[t].group===e);return 0===t.length?null:Ea.jsxs("div",{children:[Ea.jsx("div",{className:"text-[10px] font-medium text-text-muted uppercase tracking-wide mb-1.5",children:e}),Ea.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:t.map(e=>{const t=Object.values(c).some(t=>t.parameter===e),a=u&&d===e;return Ea.jsxs("button",{onClick:()=>{a?y():f(e)},className:`\n                          flex items-center gap-2 px-2 py-1.5 rounded text-xs transition-colors\n                          ${a?"bg-accent-primary text-white animate-pulse":t?"bg-accent-success/20 text-accent-success border border-accent-success/30":"bg-dark-bgTertiary hover:bg-dark-bgActive text-text-secondary"}\n                        `,children:[a&&Ea.jsx(Ee,{size:12,className:"animate-spin"}),Ea.jsx("span",{className:"flex-1 text-left",children:cM[e].label}),t&&!a&&Ea.jsx("span",{className:"text-[10px]",children:""})]},e)})})]},e)}),u&&Ea.jsxs("p",{className:"text-xs text-accent-primary mt-2 animate-pulse",children:["Move a MIDI controller to assign it to ",cM[d].label,"..."]})]}),n&&Object.keys(c).length>0&&Ea.jsxs("div",{children:[Ea.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ea.jsx("h4",{className:"text-xs font-medium text-text-secondary",children:"Active Mappings"}),Ea.jsxs("button",{onClick:h,className:"flex items-center gap-1 text-xs text-accent-error hover:underline",children:[Ea.jsx(Re,{size:10}),"Clear All"]})]}),Ea.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Object.entries(c).map(([e,t])=>Ea.jsxs("div",{className:"flex items-center justify-between bg-dark-bgTertiary rounded px-2 py-1 text-xs",children:[Ea.jsx("span",{className:"text-text-primary",children:cM[t.parameter].label}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsxs("span",{className:"font-mono text-text-muted text-[10px]",children:["CH",t.channel+1," CC",t.controller]}),Ea.jsx("button",{onClick:()=>m(t.channel,t.controller),className:"text-accent-error hover:text-accent-error/80",children:Ea.jsx(Re,{size:10})})]})]},e))})]})]}):Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded p-4",children:[Ea.jsxs("div",{className:"flex items-center gap-2 text-accent-error",children:[Ea.jsx(Pt,{size:16}),Ea.jsx("span",{className:"text-sm",children:"Web MIDI API not supported in this browser"})]}),Ea.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Try using Chrome, Edge, or Opera for MIDI support"})]})},dM=({baseOctave:e,onBaseOctaveChange:t,maxSteps:a,onMaxStepsChange:n,onResizeAllPatterns:r,scaleKey:i,rootNote:o,onScaleChange:l,onRootNoteChange:c,onClearAll:u,onRandomize:d,onAcidGenerator:p})=>{const[m,h]=s.useState(!1);return Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("div",{className:"flex items-center gap-4 p-2 bg-dark-bgSecondary border-b border-dark-border",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Octave"}),Ea.jsxs("div",{className:"flex items-center",children:[Ea.jsx("button",{onClick:()=>t(Math.max(1,e-1)),disabled:e<=1,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:Ea.jsx(Me,{size:14})}),Ea.jsx("span",{className:"w-8 text-center text-sm font-mono text-text-primary",children:e}),Ea.jsx("button",{onClick:()=>t(Math.min(6,e+1)),disabled:e>=6,className:"p-1 rounded hover:bg-dark-bgActive text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed",children:Ea.jsx(Et,{size:14})})]}),Ea.jsxs("span",{className:"text-xs text-text-muted",children:["C",e," - C",e+2]})]}),Ea.jsx("div",{className:"w-px h-6 bg-dark-border"}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-xs text-text-muted uppercase",children:"Steps"}),Ea.jsxs("select",{value:a,onChange:e=>n(Number(e.target.value)),className:"px-2 py-1 text-sm bg-dark-bgTertiary border border-dark-border rounded text-text-primary",children:[Ea.jsx("option",{value:4,children:"4"}),Ea.jsx("option",{value:8,children:"8"}),Ea.jsx("option",{value:12,children:"12"}),Ea.jsx("option",{value:16,children:"16"}),Ea.jsx("option",{value:24,children:"24"}),Ea.jsx("option",{value:32,children:"32"}),Ea.jsx("option",{value:64,children:"64"})]}),Ea.jsx("button",{onClick:()=>r(a),className:"px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Apply this step count to all patterns",children:"Apply All"})]}),Ea.jsx("div",{className:"w-px h-6 bg-dark-border"}),Ea.jsx(lM,{scaleKey:i,rootNote:o,onScaleChange:l,onRootNoteChange:c}),Ea.jsx("div",{className:"w-px h-6 bg-dark-border"}),Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsxs("button",{onClick:()=>h(!m),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors "+(m?"bg-accent-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-dark-bgActive"),title:"MIDI Learn",children:[Ea.jsx(Ce,{size:12}),"MIDI"]}),p&&Ea.jsxs("button",{onClick:p,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate 303 acid pattern",children:[Ea.jsx(ct,{size:12}),"Acid"]}),d&&Ea.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-text-primary hover:bg-dark-bgActive rounded transition-colors",title:"Generate random pattern",children:[Ea.jsx(_t,{size:12}),"Random"]}),Ea.jsxs("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-xs text-text-secondary hover:text-accent-error hover:bg-accent-error/10 rounded transition-colors",title:"Clear all steps",children:[Ea.jsx(Re,{size:12}),"Clear"]})]})]}),m&&Ea.jsx("div",{className:"border-b border-dark-border p-3 bg-dark-bg",children:Ea.jsx(uM,{onClose:()=>h(!1)})})]})},pM=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],mM=127,hM=s.memo(({isActive:e,isCurrentStep:t=!1,onClick:a,color:n="default",size:s="normal"})=>{const r="small"===s?"w-5 h-5":"w-7 h-7";return Ea.jsx("button",{onClick:a,className:`\n        ${r} rounded transition-all duration-75 border\n        ${(()=>{if(!e)return"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border";switch(n){case"accent":return"bg-accent-warning hover:bg-accent-warning/80 border-accent-warning/50";case"slide":return"bg-accent-secondary hover:bg-accent-secondary/80 border-accent-secondary/50";case"octave":return"bg-accent-primary/50 hover:bg-accent-primary/70 border-accent-primary/50";default:return"bg-accent-primary hover:bg-accent-primary/80 border-accent-primary/50"}})()}\n        ${t?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":""}\n        ${e?"shadow-sm":""}\n      `})}),fM=({x:e,y:t,accent:a,slide:n,mute:r,hammer:i,octaveShift:o,velocity:l,onToggleAccent:c,onToggleSlide:u,onToggleMute:d,onToggleHammer:p,onSetOctave:m,onSetVelocity:h,onClose:f})=>{const[y,g]=s.useState(l);return s.useEffect(()=>{const e=e=>{"Escape"===e.key&&f()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]),Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("div",{className:"fixed inset-0 z-40",onClick:f}),Ea.jsxs("div",{className:"fixed z-50 bg-dark-bgSecondary border border-dark-border rounded shadow-lg py-1 min-w-[160px]",style:{left:e,top:t},children:[Ea.jsxs("button",{onClick:()=>{c(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(a?"text-accent-warning":"text-text-secondary"),children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm "+(a?"bg-accent-warning":"border border-text-muted")}),"Accent ",a&&""]}),Ea.jsxs("button",{onClick:()=>{u(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(n?"text-accent-secondary":"text-text-secondary"),children:[Ea.jsx("span",{className:"w-3 h-3 "+(n?"text-accent-secondary":"text-text-muted"),children:""}),"Slide ",n&&""]}),Ea.jsx("div",{className:"border-t border-dark-border my-1"}),Ea.jsxs("button",{onClick:()=>{d(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(r?"text-yellow-400":"text-text-secondary"),children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm "+(r?"bg-yellow-400":"border border-text-muted")}),"Mute ",r&&""]}),Ea.jsxs("button",{onClick:()=>{p(),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(i?"text-cyan-400":"text-text-secondary"),children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm "+(i?"bg-cyan-400":"border border-text-muted")}),"Hammer ",i&&""]}),Ea.jsx("div",{className:"border-t border-dark-border my-1"}),Ea.jsxs("button",{onClick:()=>{m(1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(1===o?"text-cyan-400":"text-text-secondary"),children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm "+(1===o?"bg-accent-primary ring-2 ring-cyan-400 ring-inset":"border border-text-muted")}),"Oct+ ",1===o&&""]}),Ea.jsxs("button",{onClick:()=>{m(0),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(0===o?"text-accent-primary":"text-text-secondary"),children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm "+(0===o?"bg-accent-primary":"border border-text-muted")}),"Normal ",0===o&&""]}),Ea.jsxs("button",{onClick:()=>{m(-1),f()},className:"w-full px-3 py-1.5 text-left text-xs hover:bg-dark-bgActive flex items-center gap-2 "+(-1===o?"text-pink-400":"text-text-secondary"),children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm "+(-1===o?"bg-accent-primary ring-2 ring-pink-400 ring-inset":"border border-text-muted")}),"Oct- ",-1===o&&""]}),Ea.jsx("div",{className:"border-t border-dark-border my-1"}),Ea.jsxs("div",{className:"px-3 py-2",children:[Ea.jsxs("div",{className:"flex items-center justify-between mb-1",children:[Ea.jsx("span",{className:"text-xs text-text-secondary",children:"Velocity"}),Ea.jsx("span",{className:"text-xs text-text-primary font-mono",children:y})]}),Ea.jsx("input",{type:"range",min:1,max:mM,value:y,onChange:e=>{const t=parseInt(e.target.value,10);g(t),h(t)},className:"w-full h-1 bg-dark-bgTertiary rounded-lg appearance-none cursor-pointer accent-accent-primary"}),Ea.jsxs("div",{className:"flex justify-between mt-1 text-[10px] text-text-muted",children:[Ea.jsx("button",{onClick:()=>{h(64),g(64)},className:"hover:text-text-secondary",children:"50%"}),Ea.jsx("button",{onClick:()=>{h(100),g(100)},className:"hover:text-text-secondary",children:"Default"}),Ea.jsx("button",{onClick:()=>{h(mM),g(mM)},className:"hover:text-text-secondary",children:"Max"})]})]})]})]})},yM=s.memo(({noteIndex:e,stepIndex:t,isActive:a,isCurrentStep:n,isTriggered:r=!1,isFocused:i=!1,accent:o=!1,slide:l=!1,mute:c=!1,hammer:u=!1,octaveShift:d=0,velocity:p=100,onClick:m,onToggleAccent:h,onToggleSlide:f,onToggleMute:y,onToggleHammer:g,onSetOctave:b,onSetVelocity:v,onFocus:x})=>{const[w,k]=s.useState(null),S=s.useCallback(n=>{if(a){if(n.shiftKey&&h)return void h(t);if((n.ctrlKey||n.metaKey)&&f)return void f(t);if(n.altKey&&b){return void b(t,0===d?1:1===d?-1:0)}}m(e,t,{shift:n.shiftKey,ctrl:n.ctrlKey||n.metaKey,alt:n.altKey})},[m,e,t,a,h,f,b,d]),M=s.useCallback(e=>{a&&(e.preventDefault(),k({x:e.clientX,y:e.clientY}))},[a]),N=s.useCallback(()=>{k(null)},[]),C=s.useCallback(()=>{h?.(t)},[h,t]),P=s.useCallback(()=>{f?.(t)},[f,t]),E=s.useCallback(()=>{y?.(t)},[y,t]),_=s.useCallback(()=>{g?.(t)},[g,t]),T=s.useCallback(e=>{b?.(t,e)},[b,t]),A=s.useCallback(e=>{v?.(t,e)},[v,t]),O=s.useCallback(e=>{if(!a||!v)return;e.preventDefault();const n=e.deltaY>0?-5:5,s=Math.max(1,Math.min(mM,p+n));v(t,s)},[a,v,t,p]),I=s.useCallback(()=>{x?.()},[x]);return Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("button",{onClick:S,onContextMenu:M,onWheel:O,onFocus:I,tabIndex:i?0:-1,className:`\n          w-7 h-7 rounded transition-all duration-75 border relative\n          ${a?o?"bg-accent-warning hover:brightness-110 border-accent-warning/50":"bg-accent-primary hover:brightness-110 border-accent-primary/50":"bg-dark-bgTertiary hover:bg-dark-bgActive border-dark-border"}\n          ${n?"ring-2 ring-accent-primary ring-offset-1 ring-offset-dark-bg":a&&0!==d?d>0?"ring-2 ring-cyan-400 ring-inset":"ring-2 ring-pink-400 ring-inset":""}\n          ${i&&!n?"ring-2 ring-text-secondary ring-offset-1 ring-offset-dark-bg":""}\n          ${a?"shadow-sm":""}\n          ${r&&a?"!bg-white scale-110 shadow-lg shadow-white/50":""}\n          ${!a||p>=100?"":p<50?"ring-1 ring-inset ring-black/30":p<80?"ring-1 ring-inset ring-black/15":""}\n          focus:outline-none\n        `,title:a?`Velocity: ${p} | Shift+click: accent, Ctrl+click: slide, Alt+click: octave, Scroll: velocity`:"","aria-label":`Step ${t+1}, Note ${pM[e]}${a?", Active":""}`,"aria-pressed":a,children:[a&&l&&!c&&Ea.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-white/90 text-xs font-bold",children:""}),a&&c&&Ea.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-yellow-400 text-xs font-bold",children:"M"}),a&&u&&!c&&Ea.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-cyan-400 text-xs font-bold",children:"H"})]}),w&&Ea.jsx(fM,{x:w.x,y:w.y,accent:o,slide:l,mute:c,hammer:u,octaveShift:d,velocity:p,onToggleAccent:C,onToggleSlide:P,onToggleMute:E,onToggleHammer:_,onSetOctave:T,onSetVelocity:A,onClose:N})]})});s.memo(({stepIndex:t,isActive:a,isCurrentStep:n,color:s,onClick:r})=>{const i=e.useCallback(()=>{r(t)},[r,t]);return Ea.jsx(hM,{isActive:a,isCurrentStep:n,onClick:i,color:s})});const gM=["MINOR","MAJOR","DORIAN","MIXOLYDIAN","PHRYGIAN","HARMONIC_MINOR","PHRYGIAN_DOMINANT","MELODIC_MINOR","LYDIAN_DOMINANT","HUNGARIAN_MINOR"],bM={MINOR:[0,2,3,5,7,8,10],MAJOR:[0,2,4,5,7,9,11],DORIAN:[0,2,3,5,7,9,10],MIXOLYDIAN:[0,2,4,5,7,9,10],PHRYGIAN:[0,1,3,5,7,8,10],HARMONIC_MINOR:[0,2,3,5,7,8,11],PHRYGIAN_DOMINANT:[0,1,4,5,7,8,10],MELODIC_MINOR:[0,2,3,5,7,9,11],LYDIAN_DOMINANT:[0,2,4,6,7,9,10],HUNGARIAN_MINOR:[0,2,3,6,7,8,11]};function vM(e,t){return Math.floor(Math.random()*(t-e+1))+e}function xM(e,t){const a=[...e],n=[],s=Math.min(t,e.length);for(let r=0;r<s;r++){const e=Math.floor(Math.random()*(a.length-r))+r;[a[r],a[e]]=[a[e],a[r]],n.push(a[r])}return n}function wM(e={}){const{patternLength:t=16,density:a=60,spread:n=60,accentsDensity:s=50,slidesDensity:r=40,scale:i="MINOR",rootNote:o="C2",instrumentId:l=1}=e,c=function(e){const{patternLength:t,density:a,spread:n,accentsDensity:s,slidesDensity:r}=e,i=Array.from({length:t},(e,t)=>t),o=Math.round(t*(a/100)),l=vM(Math.round(o/2),o),c=xM(i,l),u=Math.max(1,Math.round(l/2*(s/100))),d=Math.round(l/2*(r/100)),p=xM(c,vM(1,u)),m=xM(c,vM(0,d)),h=Math.round(n/100*6),f=xM(Array.from({length:7},(e,t)=>t),Math.max(1,h)),y=xM(c,vM(0,l));return i.map(e=>{if(!c.includes(e))return{note:null,octave:null,accent:null,slide:null};const t=vM(-1,1);return{note:y.includes(e)&&f.length>0?f[vM(0,f.length-1)]:0,octave:t,accent:p.includes(e),slide:m.includes(e)}})}({patternLength:t,density:a,spread:n,accentsDensity:s,slidesDensity:r}),u=bM[i],d=function(e){const t=e.match(/^([A-G][b#]?)(-?\d+)$/);if(!t)return 36;const[,a,n]=t,s=parseInt(n,10),r={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[a];return void 0===r?36:r+12*(s+1)}(o);return c.map(e=>{if(null===e.note||null===e.octave)return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};const t=function(e,t,a,n){return t[e]+a+12*n}(e.note,u,d,e.octave),a=rs(t),n=e.accent?64:vM(48,56);return{note:a,instrument:l,volume:16+n,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:void 0,flag2:e.slide?2:void 0}})}function kM(e){return{MINOR:"Minor (Natural)",MAJOR:"Major",DORIAN:"Dorian",MIXOLYDIAN:"Mixolydian",PHRYGIAN:"Phrygian",HARMONIC_MINOR:"Harmonic Minor",PHRYGIAN_DOMINANT:"Phrygian Dominant",MELODIC_MINOR:"Melodic Minor",LYDIAN_DOMINANT:"Lydian Dominant",HUNGARIAN_MINOR:"Hungarian Minor"}[e]}function SM(e){return e.some(e=>0!==e.note||0!==e.instrument||0!==e.effTyp||0!==e.eff)}const MM=({channelIndex:e,onClose:t})=>{const{patterns:a,currentPatternIndex:n,setChannelRows:r}=ob(),i=Bv(e=>e.instruments),o=Bv(e=>e.createInstrument),l=a[n],[c,u]=s.useState(e),d=l?.channels[c],[p,m]=s.useState(!1),h=s.useMemo(()=>i.find(e=>"TB303"===e.synthType||"Buzz3o3"===e.synthType),[i]),[f,y]=s.useState(h?.id??-1),[g,b]=s.useState(60),[v,x]=s.useState(60),[w,k]=s.useState(50),[S,M]=s.useState(40),[N,C]=s.useState("MINOR"),[P,E]=s.useState("C2"),_=["C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3"],T=s.useCallback(()=>{if(!d||!l)return;let e=f;-1===e&&(e=o({name:"TB-303",synthType:"TB303"}));const t=wM({patternLength:l.length,density:g,spread:v,accentsDensity:w,slidesDensity:S,scale:N,rootNote:P,instrumentId:e});r(c,t)},[d,l,f,o,g,v,w,S,N,P,c,r]),A=s.useCallback(()=>{d&&(SM(d.rows)?m(!0):(T(),t()))},[d,T,t]),O=s.useCallback(()=>{m(!1),T(),t()},[T,t]);return l?p?Ea.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:()=>m(!1),children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-accent-warning rounded-lg shadow-2xl w-full max-w-sm",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-ft2-border bg-accent-warning/10",children:[Ea.jsx(Tt,{size:20,className:"text-accent-warning"}),Ea.jsx("h3",{className:"font-bold text-ft2-text",children:"Overwrite Channel?"})]}),Ea.jsxs("div",{className:"px-4 py-4 text-sm text-ft2-textDim",children:["Channel ",(c+1).toString().padStart(2,"0")," already contains note data. Generating will replace all existing data in this channel."]}),Ea.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-ft2-border",children:[Ea.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"}),Ea.jsx("button",{onClick:O,className:"px-4 py-2 bg-accent-warning hover:bg-accent-warning/80 text-black rounded transition-colors font-medium",children:"Overwrite"})]})]})}):Ea.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:t,children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx(ct,{size:18,className:"text-accent-primary"}),Ea.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"Acid Pattern Generator"})]}),Ea.jsx("button",{onClick:t,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:Ea.jsx(Pe,{size:18})})]}),Ea.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[Ea.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Channel"}),Ea.jsx("select",{value:c,onChange:e=>u(parseInt(e.target.value)),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:l.channels.map((e,t)=>Ea.jsxs("option",{value:t,children:[(t+1).toString().padStart(2,"0"),": ",e.name,SM(e.rows)?" *":""]},e.id))})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Instrument"}),Ea.jsxs("select",{value:f,onChange:e=>y(parseInt(e.target.value)),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[Ea.jsx("option",{value:-1,children:"+ New TB-303"}),i.map(e=>Ea.jsxs("option",{value:e.id,children:[e.id,": ",e.name," (",e.synthType,")"]},e.id))]})]})]}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Scale"}),Ea.jsx("select",{value:N,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:gM.map(e=>Ea.jsx("option",{value:e,children:kM(e)},e))})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:"Root Note"}),Ea.jsx("select",{value:P,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 bg-dark-bgTertiary text-ft2-text border border-ft2-border rounded focus:outline-none focus:ring-2 focus:ring-accent-primary",children:_.map(e=>Ea.jsx("option",{value:e,children:e},e))})]})]}),Ea.jsxs("div",{children:[Ea.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Density: ",Ea.jsxs("span",{className:"font-mono text-accent-primary",children:[g,"%"]})]}),Ea.jsx("input",{type:"range",min:"0",max:"100",value:g,onChange:e=>b(parseInt(e.target.value)),className:"w-full"}),Ea.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many notes in the pattern (sparse - dense)"})]}),Ea.jsxs("div",{children:[Ea.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Note Spread: ",Ea.jsxs("span",{className:"font-mono text-accent-primary",children:[v,"%"]})]}),Ea.jsx("input",{type:"range",min:"0",max:"100",value:v,onChange:e=>x(parseInt(e.target.value)),className:"w-full"}),Ea.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"Note range variety (narrow - wide)"})]}),Ea.jsxs("div",{children:[Ea.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Accents: ",Ea.jsxs("span",{className:"font-mono text-accent-primary",children:[w,"%"]})]}),Ea.jsx("input",{type:"range",min:"0",max:"100",value:w,onChange:e=>k(parseInt(e.target.value)),className:"w-full"}),Ea.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many accented notes (subtle - punchy)"})]}),Ea.jsxs("div",{children:[Ea.jsxs("label",{className:"block text-sm font-medium mb-2 text-ft2-text",children:["Slides: ",Ea.jsxs("span",{className:"font-mono text-accent-primary",children:[S,"%"]})]}),Ea.jsx("input",{type:"range",min:"0",max:"100",value:S,onChange:e=>M(parseInt(e.target.value)),className:"w-full"}),Ea.jsx("div",{className:"text-xs text-ft2-textDim mt-1",children:"How many slides/portamento (few - many)"})]})]}),Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-ft2-border bg-dark-bgTertiary",children:[Ea.jsxs("button",{onClick:()=>{b(Math.floor(60*Math.random())+40),x(Math.floor(60*Math.random())+40),k(Math.floor(60*Math.random())+20),M(Math.floor(60*Math.random())+20),C(gM[Math.floor(Math.random()*gM.length)]),E(_[Math.floor(Math.random()*_.length)])},className:"flex items-center gap-2 px-3 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:[Ea.jsx(At,{size:14}),"Randomize"]}),Ea.jsxs("div",{className:"flex gap-2",children:[Ea.jsx("button",{onClick:t,className:"px-4 py-2 bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded transition-colors",children:"Cancel"}),Ea.jsx("button",{onClick:A,className:"px-4 py-2 bg-accent-primary hover:bg-accent-primary/80 text-white rounded transition-colors font-medium",children:"Generate Pattern"})]})]})]})}):null},NM=["B","A#","A","G#","G","F#","F","E","D#","D","C#","C"],CM=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],PM=[11,10,9,8,7,6,5,4,3,2,1,0],EM=({channelIndex:e})=>{const{gridPattern:t,baseOctave:a,setBaseOctave:n,maxSteps:r,setMaxSteps:i,resizeAllPatterns:o,setNote:l,toggleAccent:c,toggleSlide:u,toggleMute:d,toggleHammer:p,setOctaveShift:m,setVelocity:h,clearAll:f}=rM(e),{currentRow:y,isPlaying:g,smoothScrolling:b,bpm:v,speed:x}=Kv(),w=g?y%r:-1,k=s.useRef(null),S=s.useRef(-1),M=s.useRef(0),N=s.useRef(0),C=s.useRef(0),P=s.useRef(t.steps);s.useEffect(()=>{P.current=t.steps},[t.steps]);const[E,_]=s.useState(null),T=s.useRef(null),[A,O]=s.useState("chromatic"),[I,F]=s.useState(0),[D,R]=s.useState(!1),{onMessage:j}=Rk(),{applyGridMIDIValue:B}=Gw();s.useEffect(()=>{null===E&&r>0&&requestAnimationFrame(()=>_({noteIndex:11,stepIndex:0}))},[E,r]),s.useEffect(()=>{if(!g||!b)return S.current=-1,M.current=0,void(C.current&&(cancelAnimationFrame(C.current),C.current=0));const e=k.current;if(!e)return;const t=2.5/v*x*1e3,a=()=>{const n=performance.now();w!==S.current&&(S.current=w,M.current=n);const s=n-M.current,r=Math.min(s/t,1),i=48+32*(w+r),o=e.clientWidth,l=Math.max(0,i-.4*o);N.current+=.15*(l-N.current),e.scrollLeft=N.current,C.current=requestAnimationFrame(a)};return N.current=e.scrollLeft,C.current=requestAnimationFrame(a),()=>{C.current&&(cancelAnimationFrame(C.current),C.current=0)}},[g,b,v,x,w]),s.useEffect(()=>j(e=>{if("cc"!==e.type||void 0===e.controller||void 0===e.value)return;const t=B(e.channel,e.controller,e.value);if(null===t)return;const a=Gw.getState().getGridMapping(e.channel,e.controller);if(a&&"baseOctave"===a.parameter)n(Math.round(t))}),[j,B,n]);const[L]=s.useState(!0),V=s.useCallback((t,n=0,s=!1,r=!1)=>{if(L)try{const i=Qg();if(!i)return;const{patterns:o,currentPatternIndex:l}=ob.getState(),c=o[l],u=c?.channels[e],d=u?.instrumentId??1,p=Bv.getState().instruments.find(e=>e.id===d);if(p){const e=`${CM[t]}${a+n}`;i.triggerNote(d,e,.2,Z(),.8,p,s,r)}}catch(i){}},[L,e,a]),z=s.useCallback((e,t)=>{const a=P.current[t];if(a?.noteIndex===e)l(t,null);else{const n=null!==a?.noteIndex?a.octaveShift:0;l(t,e,n),V(e,n,a?.accent||!1,a?.slide||!1)}},[l,V]),U=s.useCallback((e,t)=>{m(e,t)},[m]),G=s.useCallback(()=>{for(let e=0;e<r;e++)if(Math.random()<.7){const t=Math.floor(12*Math.random()),a=Math.random()<.3?Math.random()<.5?-1:1:0;l(e,t,a),Math.random()<.25&&c(e),e>0&&Math.random()<.2&&u(e)}else l(e,null)},[r,l,c,u]),W=s.useCallback(()=>{R(!0)},[]),H=s.useMemo(()=>Array.from({length:r},(e,t)=>t),[r]),K=s.useMemo(()=>{const e=iM[A];return e&&"chromatic"!==A?PM.filter(t=>function(e,t,a){if(e<0||e>11)return!1;if(t<0||t>11)return!1;const n=(e-t+12)%12;return a.intervals.includes(n)}(t,I,e)):PM},[A,I]),q=s.useCallback(e=>{if(!E)return;const{noteIndex:t,stepIndex:a}=E,n=P.current[a],s=n?.noteIndex===t;if("ArrowRight"===e.key)e.preventDefault(),_({noteIndex:t,stepIndex:Math.min(a+1,r-1)});else if("ArrowLeft"===e.key)e.preventDefault(),_({noteIndex:t,stepIndex:Math.max(a-1,0)});else if("ArrowDown"===e.key){e.preventDefault();const n=PM.indexOf(t),s=Math.min(n+1,PM.length-1);_({noteIndex:PM[s],stepIndex:a})}else if("ArrowUp"===e.key){e.preventDefault();const n=PM.indexOf(t),s=Math.max(n-1,0);_({noteIndex:PM[s],stepIndex:a})}else if("Enter"===e.key||" "===e.key)e.preventDefault(),z(t,a);else if(s)if("a"===e.key||"A"===e.key)e.preventDefault(),c(a);else if("s"===e.key||"S"===e.key)e.preventDefault(),u(a);else if("m"===e.key||"M"===e.key)e.preventDefault(),d(a);else if("h"===e.key||"H"===e.key)e.preventDefault(),p(a);else if("o"===e.key||"O"===e.key){e.preventDefault();const t=n?.octaveShift??0;m(a,0===t?1:1===t?-1:0)}else if("v"===e.key||"V"===e.key)e.preventDefault(),h(a,100);else if("+"===e.key||"="===e.key){e.preventDefault();const t=n?.velocity??100;h(a,Math.min(127,t+10))}else if("-"===e.key||"_"===e.key){e.preventDefault();const t=n?.velocity??100;h(a,Math.max(1,t-10))}},[E,z,r,c,u,d,p,m,h]);return Ea.jsxs("div",{className:"flex flex-col h-full bg-dark-bg",children:[Ea.jsx(dM,{baseOctave:a,onBaseOctaveChange:n,maxSteps:r,onMaxStepsChange:i,onResizeAllPatterns:o,scaleKey:A,rootNote:I,onScaleChange:O,onRootNoteChange:F,onClearAll:f,onRandomize:G,onAcidGenerator:W}),Ea.jsxs("div",{ref:k,className:"flex-1 overflow-auto p-2",children:[Ea.jsxs("div",{ref:T,className:"inline-block min-w-full",role:"grid","aria-label":"TB-303 Pattern Grid",onKeyDown:q,tabIndex:0,children:[Ea.jsx("div",{className:"flex items-center mb-1 pl-12",role:"row",children:H.map(e=>Ea.jsx("div",{className:`w-7 h-4 flex items-center justify-center text-[10px] font-mono mx-0.5\n                  ${e%4==0?"text-text-primary":"text-text-muted"}\n                  ${w===e?"text-accent-primary font-bold":""}\n                `,children:(e+1).toString().padStart(2,"0")},e))}),K.map(e=>{const a=PM.indexOf(e),n=e===I;return Ea.jsxs("div",{className:"flex items-center mb-0.5",role:"row",children:[Ea.jsxs("div",{className:`w-10 mr-2 text-right text-xs font-mono\n                    ${n?"text-accent-primary font-bold":NM[a].includes("#")?"text-text-muted":"text-text-secondary"}\n                  `,"aria-label":`Note ${NM[a]}${n?" (Root)":""}`,children:[NM[a],n&&Ea.jsx("span",{className:"ml-0.5 text-[8px]",children:""})]}),H.map(a=>{const n=t.steps[a],s=n?.noteIndex===e,r=E?.noteIndex===e&&E?.stepIndex===a;return Ea.jsx("div",{className:"mx-0.5",role:"gridcell",children:Ea.jsx(yM,{noteIndex:e,stepIndex:a,isActive:s,isCurrentStep:w===a,isTriggered:w===a&&s,isFocused:r,accent:!!s&&n?.accent,slide:!!s&&n?.slide,mute:!!s&&n?.mute,hammer:!!s&&n?.hammer,octaveShift:s?n?.octaveShift:0,velocity:s?n?.velocity:100,onClick:z,onToggleAccent:c,onToggleSlide:u,onToggleMute:d,onToggleHammer:p,onSetOctave:U,onSetVelocity:h,onFocus:()=>_({noteIndex:e,stepIndex:a})})},a)})]},e)})]}),Ea.jsxs("div",{className:"mt-4 pt-3 border-t border-dark-border space-y-2",children:[Ea.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[Ea.jsx("span",{children:"Click: note"}),Ea.jsxs("span",{className:"flex items-center gap-1",children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-warning/80"})," Shift+click: accent"]}),Ea.jsxs("span",{className:"flex items-center gap-1",children:[Ea.jsx("span",{className:"text-accent-secondary",children:""})," Ctrl+click: slide"]}),Ea.jsxs("span",{className:"flex items-center gap-1",children:[Ea.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-cyan-400 ring-inset"}),Ea.jsx("span",{className:"w-3 h-3 rounded-sm bg-accent-primary ring-2 ring-pink-400 ring-inset"}),"Alt+click: octave"]}),Ea.jsx("span",{children:"Right-click: menu"}),Ea.jsx("span",{children:"Scroll: velocity"})]}),Ea.jsxs("div",{className:"flex items-center gap-6 text-[10px] text-text-muted flex-wrap",children:[Ea.jsx("span",{className:"font-semibold text-text-secondary",children:"Keyboard:"}),Ea.jsx("span",{children:"Arrows: navigate"}),Ea.jsx("span",{children:"Enter/Space: toggle"}),Ea.jsx("span",{children:"A: accent"}),Ea.jsx("span",{children:"S: slide"}),Ea.jsx("span",{children:"M: mute"}),Ea.jsx("span",{children:"H: hammer"}),Ea.jsx("span",{children:"O: octave"}),Ea.jsx("span",{children:"V: velocity reset"}),Ea.jsx("span",{children:"+/-: velocity 10"})]})]})]}),D&&Ea.jsx(MM,{channelIndex:e,onClose:()=>R(!1)})]})},_M={z:{note:"C",octaveOffset:0},s:{note:"C#",octaveOffset:0},x:{note:"D",octaveOffset:0},d:{note:"D#",octaveOffset:0},c:{note:"E",octaveOffset:0},v:{note:"F",octaveOffset:0},g:{note:"F#",octaveOffset:0},b:{note:"G",octaveOffset:0},h:{note:"G#",octaveOffset:0},n:{note:"A",octaveOffset:0},j:{note:"A#",octaveOffset:0},m:{note:"B",octaveOffset:0},",":{note:"C",octaveOffset:1},q:{note:"C",octaveOffset:1},2:{note:"C#",octaveOffset:1},w:{note:"D",octaveOffset:1},3:{note:"D#",octaveOffset:1},e:{note:"E",octaveOffset:1},r:{note:"F",octaveOffset:1},5:{note:"F#",octaveOffset:1},t:{note:"G",octaveOffset:1},6:{note:"G#",octaveOffset:1},y:{note:"A",octaveOffset:1},7:{note:"A#",octaveOffset:1},u:{note:"B",octaveOffset:1},i:{note:"C",octaveOffset:2},9:{note:"C#",octaveOffset:2},o:{note:"D",octaveOffset:2},0:{note:"D#",octaveOffset:2},p:{note:"E",octaveOffset:2}},TM={q:0,w:1,e:2,r:3,t:4,y:5,u:6,i:7},AM={a:8,s:9,d:10,f:11,g:12,h:13,j:14,k:15},OM="0123456789ABCDEFabcdef",IM={0:0,1:1,2:2,3:3,4:4,"-":6,"+":7,d:8,u:9,s:10,v:11,p:12,l:13,r:14,m:15},FM={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,g:16,h:17,i:18,j:19,k:20,l:21,m:22,n:23,o:24,p:25,q:26,r:27,s:28,t:29,u:30,v:31,w:32,x:33,y:34,z:35};let DM=1;function RM(e){return`${e}-${Date.now()}-${DM++}`}const jM=["#ef4444","#f97316","#eab308","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#ec4899","#6b7280"],BM=n()(Ga((e,t)=>({tracks:[],clips:[],markers:[],groups:[],automationLanes:[],view:{pixelsPerRow:4,scrollRow:0,scrollY:0,snapDivision:1,followPlayback:!0,loopStart:null,loopEnd:null},tool:"select",isArrangementMode:!1,selectedClipIds:new Set,selectedTrackId:null,drag:null,playbackRow:0,undoStack:[],redoStack:[],addClip:t=>{const a=RM("clip");return e(e=>{e.clips.push({id:a,...t,fadeInRows:t.fadeInRows??0,fadeOutRows:t.fadeOutRows??0,fadeInCurve:t.fadeInCurve??"linear",fadeOutCurve:t.fadeOutCurve??"linear",gain:t.gain??1,transpose:t.transpose??0,reversed:t.reversed??!1,timeStretch:t.timeStretch??1,crossfadeInRows:t.crossfadeInRows??0,crossfadeOutRows:t.crossfadeOutRows??0})}),a},removeClip:t=>e(e=>{e.clips=e.clips.filter(e=>e.id!==t),e.selectedClipIds.delete(t)}),removeClips:t=>e(e=>{const a=new Set(t);e.clips=e.clips.filter(e=>!a.has(e.id));for(const n of t)e.selectedClipIds.delete(n)}),moveClip:(t,a,n)=>e(e=>{const s=e.clips.find(e=>e.id===t);s&&(s.startRow=Math.max(0,a),s.trackId=n)}),moveClips:(t,a,n)=>e(e=>{const s=[...e.tracks].sort((e,t)=>e.index-t.index);for(const r of t){const t=e.clips.find(e=>e.id===r);if(t&&(t.startRow=Math.max(0,t.startRow+a),0!==n)){const a=e.tracks.find(e=>e.id===t.trackId);if(a){const e=s[Math.max(0,Math.min(s.length-1,a.index+n))];e&&(t.trackId=e.id)}}}}),resizeClipStart:(t,a)=>e(e=>{const n=e.clips.find(e=>e.id===t);if(!n)return;const s=Math.max(0,a),r=s-n.startRow;0!==r&&(n.offsetRows=Math.max(0,n.offsetRows+r),n.startRow=s,null!==n.clipLengthRows&&(n.clipLengthRows=Math.max(1,n.clipLengthRows-r)))}),resizeClipEnd:(t,a)=>e(e=>{const n=e.clips.find(e=>e.id===t);if(!n)return;const s=Math.max(1,a-n.startRow);n.clipLengthRows=s}),splitClip:(t,a)=>e(e=>{const n=e.clips.find(e=>e.id===t);if(!n)return;const s=n.startRow+(n.clipLengthRows??64);if(a<=n.startRow||a>=s)return;const r=RM("clip"),i=a-n.startRow;e.clips.push({...n,id:r,startRow:a,offsetRows:n.offsetRows+i,clipLengthRows:null!==n.clipLengthRows?n.clipLengthRows-i:null}),n.clipLengthRows=i}),duplicateClips:t=>{const a=[];return e(e=>{for(const n of t){const t=e.clips.find(e=>e.id===n);if(!t)continue;const s=RM("clip"),r=t.clipLengthRows??64;e.clips.push({...t,id:s,startRow:t.startRow+r}),a.push(s)}}),a},toggleClipMute:t=>e(e=>{const a=e.clips.find(e=>e.id===t);a&&(a.muted=!a.muted)}),setClipColor:(t,a)=>e(e=>{const n=e.clips.find(e=>e.id===t);n&&(n.color=a)}),addTrack:(t,a)=>{const n=RM("track");return e(e=>{const s=e.tracks.length;e.tracks.push({id:n,name:t??`Track ${s+1}`,index:s,color:jM[s%jM.length],volume:100,pan:0,muted:!1,solo:!1,collapsed:!1,height:80,groupId:null,instrumentId:a??null,automationVisible:!1,automationParameter:null,frozen:!1,armRecord:!1})}),n},removeTrack:t=>e(e=>{e.tracks=e.tracks.filter(e=>e.id!==t),e.clips=e.clips.filter(e=>e.trackId!==t),e.automationLanes=e.automationLanes.filter(e=>e.trackId!==t),e.tracks.sort((e,t)=>e.index-t.index).forEach((e,t)=>{e.index=t})}),reorderTrack:(t,a)=>e(e=>{const n=e.tracks.find(e=>e.id===t);if(!n)return;const s=n.index;if(s!==a)for(const r of e.tracks)r.id===t?r.index=a:s<a&&r.index>s&&r.index<=a?r.index--:s>a&&r.index>=a&&r.index<s&&r.index++}),updateTrack:(t,a)=>e(e=>{const n=e.tracks.find(e=>e.id===t);if(!n)return;const{id:s,...r}=a;Object.assign(n,r)}),toggleTrackMute:t=>e(e=>{const a=e.tracks.find(e=>e.id===t);a&&(a.muted=!a.muted)}),toggleTrackSolo:t=>e(e=>{const a=e.tracks.find(e=>e.id===t);a&&(a.solo=!a.solo)}),setTrackHeight:(t,a)=>e(e=>{const n=e.tracks.find(e=>e.id===t);n&&(n.height=Math.max(30,Math.min(200,a)))}),addMarker:t=>{const a=RM("marker");return e(e=>{e.markers.push({...t,id:a})}),a},removeMarker:t=>e(e=>{e.markers=e.markers.filter(e=>e.id!==t)}),moveMarker:(t,a)=>e(e=>{const n=e.markers.find(e=>e.id===t);n&&(n.row=Math.max(0,a))}),updateMarker:(t,a)=>e(e=>{const n=e.markers.find(e=>e.id===t);n&&Object.assign(n,a)}),addGroup:t=>{const a=RM("group");return e(e=>{e.groups.push({id:a,name:t,color:null,collapsed:!1,folded:!1,index:e.groups.length})}),a},removeGroup:t=>e(e=>{e.groups=e.groups.filter(e=>e.id!==t);for(const a of e.tracks)a.groupId===t&&(a.groupId=null)}),assignTrackToGroup:(t,a)=>e(e=>{const n=e.tracks.find(e=>e.id===t);n&&(n.groupId=a)}),toggleGroupCollapse:t=>e(e=>{const a=e.groups.find(e=>e.id===t);a&&(a.collapsed=!a.collapsed)}),toggleGroupFold:t=>e(e=>{const a=e.groups.find(e=>e.id===t);a&&(a.folded=!a.folded)}),selectClip:(t,a=!1)=>e(e=>{a?e.selectedClipIds.add(t):e.selectedClipIds=new Set([t])}),selectClips:t=>e(e=>{e.selectedClipIds=new Set(t)}),clearSelection:()=>e(e=>{e.selectedClipIds=new Set}),selectClipsInRange:(t,a,n)=>e(e=>{const s=Math.min(t,a),r=Math.max(t,a),i=new Set(n),o=new Set;for(const t of e.clips){if(!i.has(t.trackId))continue;const e=t.startRow+(t.clipLengthRows??64);t.startRow<r&&e>s&&o.add(t.id)}e.selectedClipIds=o}),selectAllClipsOnTrack:t=>e(e=>{e.selectedClipIds=new Set(e.clips.filter(e=>e.trackId===t).map(e=>e.id))}),setPixelsPerRow:t=>e(e=>{e.view.pixelsPerRow=Math.max(.5,Math.min(32,t))}),setScrollRow:t=>e(e=>{e.view.scrollRow=Math.max(0,t)}),setScrollY:t=>e(e=>{e.view.scrollY=Math.max(0,t)}),setSnapDivision:t=>e(e=>{e.view.snapDivision=t}),setFollowPlayback:t=>e(e=>{e.view.followPlayback=t}),setLoopRegion:(t,a)=>e(e=>{e.view.loopStart=t,e.view.loopEnd=a}),clearLoopRegion:()=>e(e=>{e.view.loopStart=null,e.view.loopEnd=null}),zoomToFit:()=>e(e=>{const t=zM(e);t<=0||(e.view.pixelsPerRow=Math.max(.5,Math.min(32,800/t)),e.view.scrollRow=0,e.view.scrollY=0)}),setTool:t=>e(e=>{e.tool=t}),setIsArrangementMode:t=>e(e=>{e.isArrangementMode=t}),setDrag:t=>e(e=>{e.drag=t}),setPlaybackRow:t=>e(e=>{e.playbackRow=t}),addAutomationLane:(t,a)=>{const n=RM("autolane");return e(e=>{e.automationLanes.push({id:n,trackId:t,parameter:a,points:[],enabled:!0,visible:!0})}),n},removeAutomationLane:t=>e(e=>{e.automationLanes=e.automationLanes.filter(e=>e.id!==t)}),addAutomationPoint:(t,a)=>e(e=>{const n=e.automationLanes.find(e=>e.id===t);if(!n)return;const s={...a,curve:a.curve??"linear",tension:a.tension??.5},r=n.points.findIndex(e=>e.row>a.row);-1===r?n.points.push(s):n.points.splice(r,0,s)}),removeAutomationPoint:(t,a)=>e(e=>{const n=e.automationLanes.find(e=>e.id===t);n&&a>=0&&a<n.points.length&&n.points.splice(a,1)}),moveAutomationPoint:(t,a,n,s)=>e(e=>{const r=e.automationLanes.find(e=>e.id===t);if(!r||!r.points[a])return;const[i]=r.points.splice(a,1);i.row=Math.max(0,n),i.value=Math.max(0,Math.min(1,s));const o=r.points.findIndex(e=>e.row>i.row);-1===o?r.points.push(i):r.points.splice(o,0,i)}),toggleAutomationLaneVisibility:t=>e(e=>{const a=e.automationLanes.find(e=>e.id===t);a&&(a.visible=!a.visible)}),pushUndo:t=>e(e=>{const a=t??LM(e);e.undoStack.push(a),e.undoStack.length>50&&e.undoStack.shift(),e.redoStack=[]}),undo:()=>e(e=>{if(0===e.undoStack.length)return;const t=LM(e);e.redoStack.push(t);const a=e.undoStack.pop();VM(e,a)}),redo:()=>e(e=>{if(0===e.redoStack.length)return;const t=LM(e);e.undoStack.push(t);const a=e.redoStack.pop();VM(e,a)}),canUndo:()=>t().undoStack.length>0,canRedo:()=>t().redoStack.length>0,importFromPatternOrder:(t,a)=>e(e=>{if(0===a.length||0===t.length)return;const n=a[0]?.channels?.length??1;e.tracks=[];for(let t=0;t<n;t++){const n=a[0].channels[t];e.tracks.push({id:RM("track"),name:n?.name??`Track ${t+1}`,index:t,color:n?.color??jM[t%jM.length],volume:n?.volume??100,pan:n?.pan??0,muted:n?.muted??!1,solo:n?.solo??!1,collapsed:!1,height:80,groupId:null,instrumentId:n?.instrumentId??null,automationVisible:!1,automationParameter:null,frozen:!1,armRecord:!1})}e.clips=[];let s=0;for(const r of t){const t=a[r];if(t){for(let a=0;a<n;a++){const n=e.tracks[a];n&&e.clips.push({id:RM("clip"),patternId:t.id,trackId:n.id,startRow:s,offsetRows:0,clipLengthRows:null,sourceChannelIndex:a,color:null,muted:!1,fadeInRows:0,fadeOutRows:0,fadeInCurve:"linear",fadeOutCurve:"linear",gain:1,transpose:0,reversed:!1,timeStretch:1,crossfadeInRows:0,crossfadeOutRows:0})}s+=t.length}}e.markers=[],e.groups=[],e.automationLanes=[],e.isArrangementMode=!0}),getSnapshot:()=>LM(t()),loadSnapshot:t=>e(e=>{VM(e,t)}),getTotalRows:()=>zM(t()),getClipsForTrack:e=>t().clips.filter(t=>t.trackId===e),getClipEndRow:(e,t)=>{if(null!==e.clipLengthRows)return e.startRow+e.clipLengthRows;const a=t.find(t=>t.id===e.patternId);return e.startRow+(a?.length??64)-e.offsetRows}})));function LM(e){return JSON.parse(JSON.stringify({tracks:e.tracks,clips:e.clips,markers:e.markers,groups:e.groups,automationLanes:e.automationLanes}))}function VM(e,t){e.tracks=t.tracks,e.clips=t.clips,e.markers=t.markers,e.groups=t.groups,e.automationLanes=t.automationLanes}function zM(e){let t=0;for(const a of e.clips){const e=a.startRow+(a.clipLengthRows??64);e>t&&(t=e)}return t}const UM={note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0};function GM(e,t,a,n){let s=null;for(const r of e){if(r.trackId!==t)continue;if(a<r.startRow)continue;const e=n.get(r.patternId),i=r.clipLengthRows??(e?e.length-r.offsetRows:64);a>=r.startRow+i||(!s||r.startRow>s.startRow)&&(s=r)}return s}const WM=()=>{const{patterns:e,currentPatternIndex:t,setCurrentPattern:a,patternOrder:n,currentPositionIndex:r,setCurrentPosition:i}=ob(),{isPlaying:o,isLooping:l,bpm:c,setCurrentRow:u,setCurrentRowThrottled:d}=Kv(),{instruments:p}=Bv();Zv();const{masterEffects:m}=$v(),h=n[r]??t,f=e[h],y=s.useRef(Qg()),g=s.useRef(qS());s.useEffect(()=>{y.current=Qg(),g.current=qS()});const b=s.useRef(!1);s.useEffect(()=>{y.current.setBPM(c)},[c]);const v=s.useMemo(()=>m.map(e=>`${e.id}:${e.enabled}:${e.type}`).join("|"),[m]);return s.useEffect(()=>{y.current.rebuildMasterEffects(m)},[v]),s.useEffect(()=>{if(f){const e=y.current;f.channels.forEach((t,a)=>{const n=t.volume>0?t.volume/100*60-60:-1/0;e.setChannelVolume(a,n),e.setChannelPan(a,t.pan)}),e.updateMuteStates(f.channels.map(e=>({muted:e.muted,solo:e.solo})))}},[f]),s.useEffect(()=>{const s=g.current;if(o&&f&&!b.current){b.current=!0;const r=BM.getState(),o=f.importMetadata?.sourceFormat??"XM",u=f.importMetadata?.modData;let m,h,y=e,g=f.channels.length;if(r.isArrangementMode&&r.clips.length>0){const t=function(e,t,a){if(0===e.length||0===t.length)return{songPositions:[0],virtualPatterns:a.length>0?[a[0]]:[],totalRows:0,rowToGlobalRow:new Map};const n=new Map;for(const p of a)n.set(p.id,p);const s=t.some(e=>e.solo),r=[...t].filter(e=>s?e.solo:!e.muted).sort((e,t)=>e.index-t.index),i=e.filter(e=>!e.muted);let o=0;for(const p of i){const e=n.get(p.patternId),t=p.clipLengthRows??(e?e.length-p.offsetRows:64),a=p.startRow+t;a>o&&(o=a)}if(0===o)return{songPositions:[0],virtualPatterns:a.length>0?[a[0]]:[],totalRows:0,rowToGlobalRow:new Map};const l=Math.ceil(o/64),c=[],u=[],d=new Map;for(let p=0;p<l;p++){const e=64*p,t=Math.min(e+64,o)-e,a=r.map((a,s)=>{const r=[];for(let o=0;o<t;o++){const t=e+o,s=GM(i,a.id,t,n);if(s){const e=n.get(s.patternId);if(e){const a=s.offsetRows+(t-s.startRow),n=e.channels[s.sourceChannelIndex];n&&a>=0&&a<n.rows.length?r.push({...n.rows[a]}):r.push({...UM})}else r.push({...UM})}else r.push({...UM})}return{id:`vch-${p}-${s}`,name:a.name,rows:r,muted:!1,solo:!1,collapsed:!1,volume:a.volume,pan:a.pan,instrumentId:a.instrumentId,color:a.color}}),s={id:`vp-${p}`,name:`Chunk ${p}`,length:t,channels:a},l=c.length;c.push(s),u.push(l);for(let n=0;n<t;n++)d.set(64*p+n,e+n)}return{songPositions:u,virtualPatterns:c,totalRows:o,rowToGlobalRow:d}}(r.clips,r.tracks,e,u?.initialSpeed??6);y=t.virtualPatterns,m=t.songPositions,h=t.songPositions.length,g=t.virtualPatterns[0]?.channels?.length??f.channels.length}else{m=l?[t]:n,h=l?1:u?.songLength??n.length}s.loadSong({name:f.importMetadata?.sourceFile??f.name??"Untitled",format:o,patterns:y,instruments:p,songPositions:m,songLength:h,restartPosition:0,numChannels:g,initialSpeed:u?.initialSpeed??6,initialBPM:u?.initialBPM??c});let v=-1,x=-1;s.onRowChange=(e,t,n)=>{if(d(e,y[t]?.length??64),r.isArrangementMode){const t=64*n+e;BM.getState().setPlaybackRow(t),Kv.getState().setCurrentGlobalRow(t)}0!==e||t===v&&n===x||(v=t,x=n,queueMicrotask(()=>{a(t),i(n)}))},s.onSongEnd=()=>{},s.play().catch(e=>{})}else!o&&b.current&&(b.current=!1,s.stop(),s.onRowChange=null,s.onSongEnd=null,u(0));return()=>{!o&&b.current&&(g.current.stop(),g.current.onRowChange=null,g.current.onSongEnd=null)}},[o,l,f,p,n,e,c,t,a,i,u,d]),{isPlaying:o}};const HM=({isOpen:e,onClose:t,children:a,theme:n="modern",size:r="md",backdropOpacity:i="medium",rounded:o=!0,closeOnBackdropClick:l=!0,closeOnEscape:c=!0,animation:u="fade",className:d=""})=>{s.useEffect(()=>{if(!e||!c)return;const a=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,c,t]);if(!e)return null;const p=`\n    fixed inset-0 z-50 flex items-center justify-center p-4\n    ${{light:"bg-black/50",medium:"bg-black/60",dark:"bg-black/80"}[i]}\n  `,m=`\n    ${{sm:"w-80 max-w-sm",md:"w-96 max-w-md",lg:"max-w-2xl w-full",xl:"max-w-4xl w-full",fullscreen:"w-full h-full"}[r]}\n    ${"retro"===n?"bg-ft2-bg border-ft2-border":"bg-dark-bg border-dark-border"}\n    ${"retro"===n?"border-2":"border"}\n    ${o?"rounded-lg":""}\n    ${{fade:"animate-fade-in",slide:"animate-slide-in-up",scale:"animate-scale-in"}[u]}\n    ${"fullscreen"!==r?"shadow-xl max-h-[90vh] overflow-hidden":""}\n    ${d}\n    flex flex-col\n  `;return Ea.jsx("div",{className:p,onClick:e=>{l&&e.target===e.currentTarget&&t()},children:Ea.jsx("div",{className:m,children:a})})},KM=({title:e,subtitle:t,icon:a,onClose:n,theme:s="modern",showCloseButton:r=!0})=>{const i="retro"===s?"bg-ft2-header border-ft2-border text-ft2-highlight":"bg-dark-bgSecondary border-dark-border text-text-primary",o="retro"===s?"border-b-2":"border-b",l="retro"===s?"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none":"p-2 rounded-lg hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors focus:outline-none";return Ea.jsxs("div",{className:`flex items-center justify-between px-4 py-3 ${o} ${i}`,children:[Ea.jsxs("div",{className:"flex items-center gap-3",children:[a&&Ea.jsx("div",{className:"text-accent-primary",children:a}),Ea.jsxs("div",{className:"flex flex-col",children:[Ea.jsx("h2",{className:"font-bold tracking-wide "+("retro"===s?"text-sm":"text-base"),children:e}),t&&Ea.jsx("p",{className:"text-text-secondary "+("retro"===s?"text-xs":"text-sm"),children:t})]})]}),r&&n&&Ea.jsx("button",{onClick:n,className:l,"aria-label":"Close",title:"Close (Esc)",children:Ea.jsx(Pe,{size:16})})]})},qM=({children:e,theme:t="modern",align:a="right"})=>{const n="retro"===t?"bg-ft2-header border-ft2-border":"bg-dark-bgSecondary border-dark-border",s="retro"===t?"border-t-2":"border-t";return Ea.jsx("div",{className:`flex gap-2 px-4 py-3 ${s} ${n} ${{left:"justify-start",center:"justify-center",right:"justify-end",between:"justify-between"}[a]}`,children:e})},$M=[{value:"volume",label:"Volume",min:0,max:64},{value:"cutoff",label:"Cutoff",min:0,max:127},{value:"resonance",label:"Resonance",min:0,max:127},{value:"envMod",label:"Env Mod",min:0,max:127},{value:"pan",label:"Pan",min:-100,max:100}],XM=[{value:"linear",label:"Linear",description:"Constant rate of change"},{value:"log",label:"Logarithmic",description:"Fast start, gradual end"},{value:"exp",label:"Exponential",description:"Gradual start, fast end"},{value:"scurve",label:"S-Curve",description:"Smooth ease in/out"}],YM=({isOpen:e,onClose:t})=>{const{selection:a,interpolateSelection:n}=ob(),[r,i]=s.useState("volume"),[o,l]=s.useState(64),[c,u]=s.useState(0),[d,p]=s.useState("linear"),m=$M.find(e=>e.value===r);return Ea.jsxs(HM,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Ea.jsx(KM,{title:"Interpolate Selection",icon:Ea.jsx(ht,{size:18}),onClose:t,theme:"modern"}),Ea.jsxs("div",{className:"p-4 space-y-4",children:[Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Column"}),Ea.jsx("select",{value:r,onChange:e=>(e=>{i(e);const t=$M.find(t=>t.value===e);"pan"===e?(l(-100),u(100)):(l(t.max),u(0))})(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:$M.map(e=>Ea.jsx("option",{value:e.value,children:e.label},e.value))})]}),Ea.jsxs("div",{children:[Ea.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["Start Value (",m.min," - ",m.max,")"]}),Ea.jsx("input",{type:"number",value:o,onChange:e=>l(Math.max(m.min,Math.min(m.max,parseInt(e.target.value)||0))),min:m.min,max:m.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),Ea.jsxs("div",{children:[Ea.jsxs("label",{className:"block text-xs text-text-muted mb-1",children:["End Value (",m.min," - ",m.max,")"]}),Ea.jsx("input",{type:"number",value:c,onChange:e=>u(Math.max(m.min,Math.min(m.max,parseInt(e.target.value)||0))),min:m.min,max:m.max,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Curve"}),Ea.jsx("div",{className:"grid grid-cols-4 gap-1",children:XM.map(e=>Ea.jsx("button",{onClick:()=>p(e.value),className:"px-2 py-1.5 text-xs rounded border transition-colors "+(d===e.value?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),title:e.description,children:e.label},e.value))}),Ea.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:XM.find(e=>e.value===d)?.description})]}),!a&&Ea.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),Ea.jsxs(qM,{theme:"modern",align:"right",children:[Ea.jsx(qk,{variant:"ghost",onClick:t,children:"Cancel"}),Ea.jsx(qk,{variant:"primary",onClick:()=>{a?(n(r,o,c,d),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!a,children:"Apply"})]})]})},ZM=({isOpen:e,onClose:t})=>{const{selection:a,humanizeSelection:n}=ob(),[r,i]=s.useState(15);return Ea.jsxs(HM,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Ea.jsx(KM,{title:"Humanize Selection",icon:Ea.jsx(mt,{size:18}),onClose:t,theme:"modern"}),Ea.jsxs("div",{className:"p-4 space-y-4",children:[Ea.jsx("p",{className:"text-xs text-text-muted",children:"Add random variation to volume values to create a more human feel."}),Ea.jsxs("div",{children:[Ea.jsxs("label",{className:"block text-xs text-text-muted mb-2",children:["Volume Variation: ",Ea.jsxs("span",{className:"text-accent-primary font-mono",children:[r,"%"]})]}),Ea.jsx("input",{type:"range",value:r,onChange:e=>i(parseInt(e.target.value)),min:0,max:50,className:"w-full accent-accent-primary"}),Ea.jsxs("div",{className:"flex justify-between text-xs text-text-muted mt-1",children:[Ea.jsx("span",{children:"0% (none)"}),Ea.jsx("span",{children:"50% (max)"})]})]}),Ea.jsx("div",{className:"bg-dark-bg rounded p-3 text-xs text-text-secondary",children:Ea.jsxs("p",{children:["Each note's volume will be randomly adjusted by up to ",r,"% of its current value."]})}),!a&&Ea.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),Ea.jsxs(qM,{theme:"modern",align:"right",children:[Ea.jsx(qk,{variant:"ghost",onClick:t,children:"Cancel"}),Ea.jsx(qk,{variant:"primary",onClick:()=>{a?(n(r),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!a,children:"Apply"})]})]})},QM=({isOpen:e,onClose:t})=>{const{patterns:a,currentPatternIndex:n,selection:r}=ob(),[i,o]=s.useState("note"),[l,c]=s.useState("pattern"),[u,d]=s.useState(""),[p,m]=s.useState(""),[h,f]=s.useState(null),[y,g]=s.useState(null),b=a[n];return Ea.jsxs(HM,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Ea.jsx(KM,{title:"Find & Replace",icon:Ea.jsx(Ot,{size:18}),onClose:t,theme:"modern"}),Ea.jsxs("div",{className:"p-4 space-y-4",children:[Ea.jsx("div",{className:"flex gap-2",children:["note","instrument","effect"].map(e=>Ea.jsx("button",{onClick:()=>o(e),className:"flex-1 px-3 py-2 text-xs rounded transition-colors "+(i===e?"bg-accent-primary text-white":"bg-dark-bg text-text-secondary hover:text-text-primary"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Scope"}),Ea.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary focus:outline-none focus:border-accent-primary",children:[Ea.jsxs("option",{value:"selection",disabled:!r,children:["Selection ",!r&&"(none)"]}),Ea.jsx("option",{value:"pattern",children:"Current Pattern"}),Ea.jsx("option",{value:"all",children:"All Patterns"})]})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Find"}),Ea.jsxs("div",{className:"relative",children:[Ea.jsx(Ot,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),Ea.jsx("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"note"===i?"e.g., C-4":"instrument"===i?"e.g., 01":"e.g., A0F",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Replace with (empty to clear)"}),Ea.jsxs("div",{className:"relative",children:[Ea.jsx(It,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),Ea.jsx("input",{type:"text",value:p,onChange:e=>m(e.target.value),placeholder:"Leave empty to clear",className:"w-full pl-9 pr-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]})]}),null!==h&&Ea.jsxs("p",{className:"text-xs text-accent-primary",children:["Found ",h," match",1!==h?"es":""]}),null!==y&&Ea.jsxs("p",{className:"text-xs text-accent-success",children:["Replaced ",y," occurrence",1!==y?"s":""]})]}),Ea.jsxs(qM,{theme:"modern",align:"right",children:[Ea.jsx(qk,{variant:"ghost",onClick:t,children:"Close"}),Ea.jsx(qk,{variant:"default",onClick:()=>{let e=0;const t="all"===l?a:[b];for(const a of t)for(const t of a.channels)for(let n=0;n<a.length;n++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),s=Math.max(r.startChannel,r.endChannel),i=Math.min(r.startRow,r.endRow),o=Math.max(r.startRow,r.endRow),l=a.channels.indexOf(t);if(l<e||l>s||n<i||n>o)continue}const s=t.rows[n];if("note"===i&&s.note&&0!==s.note&&97!==s.note){Jn(s.note).toLowerCase().includes(u.toLowerCase())&&e++}else if("instrument"===i&&0!==s.instrument){s.instrument.toString(16).toUpperCase().padStart(2,"0").includes(u.toUpperCase())&&e++}else if("effect"===i&&(0!==s.effTyp||0!==s.eff)){ns(s.effTyp,s.eff).toLowerCase().includes(u.toLowerCase())&&e++}}f(e),g(null)},disabled:!u,children:"Find"}),Ea.jsx(qk,{variant:"primary",onClick:()=>{if(!u)return;let e=0;ob.setState(t=>{const a="all"===l?t.patterns:[t.patterns[n]];for(const n of a)for(let t=0;t<n.channels.length;t++){const a=n.channels[t];for(let s=0;s<n.length;s++){if("selection"===l&&r){const e=Math.min(r.startChannel,r.endChannel),a=Math.max(r.startChannel,r.endChannel),n=Math.min(r.startRow,r.endRow),i=Math.max(r.startRow,r.endRow);if(t<e||t>a||s<n||s>i)continue}const n=a.rows[s];if("note"===i&&n.note&&0!==n.note&&97!==n.note){Jn(n.note).toLowerCase().includes(u.toLowerCase())&&(n.note=""===p?0:Qn(p.toUpperCase()),e++)}else if("instrument"===i&&0!==n.instrument){n.instrument.toString(16).toUpperCase().padStart(2,"0").includes(u.toUpperCase())&&(n.instrument=""===p?0:parseInt(p,16)||0,e++)}else if("effect"===i&&(0!==n.effTyp||0!==n.eff)){if(ns(n.effTyp,n.eff).toLowerCase().includes(u.toLowerCase())){if(""===p)n.effTyp=0,n.eff=0;else{const[e,t]=as(p.toUpperCase());n.effTyp=e,n.eff=t}e++}}}}}),g(e),f(null)},disabled:!u,children:"Replace All"})]})]})};class JM{context=null;gain=null;processNode=null;config;handlers=new Map;initialized=!1;initError=null;initPromise=null;meta=null;duration=0;currentTime=0;order=0;pattern=0;row=0;constructor(e={}){this.config={repeatCount:-1,stereoSeparation:100,interpolationFilter:0,...e}}async ensureInitialized(){return!!this.initialized||!this.initError&&(this.initPromise?(await this.initPromise,this.initialized):(this.initPromise=this.initWorklet(),await this.initPromise,this.initialized))}async initWorklet(){try{this.context=new AudioContext,this.gain=this.context.createGain(),this.gain.gain.value=1;const e="/DEViLBOX/";await this.context.audioWorklet.addModule(`${e}chiptune3/chiptune3.worklet.js`),this.processNode=new AudioWorkletNode(this.context,"libopenmpt-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.processNode.port.onmessage=this.handleMessage.bind(this),this.processNode.port.postMessage({cmd:"config",val:this.config}),this.processNode.connect(this.gain),this.gain.connect(this.context.destination),this.initialized=!0,this.fireEvent("onInitialized")}catch(e){const t=e instanceof Error?e.message:String(e);this.initError=t,this.fireEvent("onError",{type:"init",message:t})}}handleMessage(e){const{cmd:t,meta:a,pos:n,order:s,pattern:r,row:i,val:o}=e.data;switch(t){case"meta":this.meta=a,this.duration=a?.dur||0,this.fireEvent("onMetadata",a);break;case"pos":this.currentTime=n,this.order=s,this.pattern=r,this.row=i,this.fireEvent("onProgress",e.data);break;case"end":this.fireEvent("onEnded");break;case"err":this.fireEvent("onError",{type:o})}}fireEvent(e,t){const a=this.handlers.get(e);a&&a.forEach(e=>e(t))}addHandler(e,t){this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t)}onInitialized(e){this.initialized?e():this.initError?this.fireEvent("onError",{type:"init",message:this.initError}):(this.addHandler("onInitialized",e),this.ensureInitialized())}onEnded(e){this.addHandler("onEnded",e)}onError(e){this.addHandler("onError",e)}onMetadata(e){this.addHandler("onMetadata",e)}onProgress(e){this.addHandler("onProgress",e)}async play(e){await this.ensureInitialized()&&this.processNode&&this.context?("suspended"===this.context.state&&await this.context.resume(),this.processNode.port.postMessage({cmd:"play",val:e})):this.fireEvent("onError",{type:"not_initialized"})}stop(){this.processNode?.port.postMessage({cmd:"stop"})}pause(){this.processNode?.port.postMessage({cmd:"pause"})}unpause(){this.processNode?.port.postMessage({cmd:"unpause"})}setVol(e){this.gain&&(this.gain.gain.value=e)}setPos(e){this.processNode?.port.postMessage({cmd:"setPos",val:e})}setRepeatCount(e){this.processNode?.port.postMessage({cmd:"repeatCount",val:e})}isAvailable(){return this.initialized&&!this.initError}getInitError(){return this.initError}}async function eN(e){const t=new DataView(e);let a=0;const n=function(e,t){const a=iN(e,t,17);if("Extended Module: "!==a)throw new Error("Invalid XM file: incorrect header signature");const n=iN(e,t+17,20).trim();t+=38;const s=iN(e,t,20).trim();t+=20;const r=e.getUint16(t,!0);t+=2;const i=e.getUint32(t,!0);t+=4;const o=e.getUint16(t,!0);t+=2;const l=e.getUint16(t,!0);t+=2;const c=e.getUint16(t,!0);t+=2;const u=e.getUint16(t,!0);t+=2;const d=e.getUint16(t,!0);t+=2;const p=e.getUint16(t,!0);t+=2;const m=e.getUint16(t,!0);t+=2;const h=e.getUint16(t,!0);t+=2;const f=[];for(let y=0;y<256;y++)f.push(e.getUint8(t+y));return{idText:a,moduleName:n,trackerName:s,versionNumber:r,headerSize:i,songLength:o,restartPosition:l,channelCount:c,patternCount:u,instrumentCount:d,flags:p,defaultTempo:m,defaultBPM:h,patternOrderTable:f}}(t,a);a+=n.headerSize;const s=[];for(let o=0;o<n.patternCount;o++){const e=tN(t,a,n.channelCount);s.push(e.notes),a+=e.totalSize}const r=[];for(let o=0;o<n.instrumentCount;o++){const e=aN(t,a);e.parsed.id=o+1,e.parsed.samples.forEach(e=>{e.id=o+1}),r.push(e.parsed),a+=e.totalSize}const i={sourceFormat:"XM",sourceFile:n.moduleName,importedAt:(new Date).toISOString(),originalChannelCount:n.channelCount,originalPatternCount:n.patternCount,originalInstrumentCount:n.instrumentCount,modData:{moduleType:"XM",initialSpeed:n.defaultTempo,initialBPM:n.defaultBPM,amigaPeriods:!(1&n.flags),channelNames:Array.from({length:n.channelCount},(e,t)=>`Channel ${t+1}`),songLength:n.songLength,restartPosition:n.restartPosition,patternOrderTable:n.patternOrderTable},xmData:{frequencyType:1&n.flags?"linear":"amiga",defaultPanning:Array.from({length:n.channelCount},()=>128)},originalSamples:{},envelopes:{}};return r.forEach(e=>{e.samples.forEach(e=>{i.originalSamples[e.id]=e}),i.envelopes[e.id]={volumeEnvelope:e.volumeEnvelope,panningEnvelope:e.panningEnvelope,autoVibrato:e.autoVibrato,fadeout:e.fadeout}}),{header:n,patterns:s,instruments:r,metadata:i}}function tN(e,t,a){const n=t;e.getUint32(t,!0),t+=4,e.getUint8(t),t+=1;const s=e.getUint16(t,!0)||64;t+=2;const r=e.getUint16(t,!0);t+=2;const i=[],o=new Uint8Array(e.buffer,t,r);t+=r;let l=0;for(let c=0;c<s;c++){const e=[];for(let t=0;t<a;t++){const t={note:0,instrument:0,volume:0,effectType:0,effectParam:0};if(l>=o.length){e.push(t);continue}const a=o[l++];128&a?(1&a&&(t.note=o[l++]),2&a&&(t.instrument=o[l++]),4&a&&(t.volume=o[l++]),8&a&&(t.effectType=o[l++]),16&a&&(t.effectParam=o[l++])):(t.note=a,t.instrument=o[l++],t.volume=o[l++],t.effectType=o[l++],t.effectParam=o[l++]),e.push(t)}i.push(e)}return{notes:i,totalSize:t-n}}function aN(e,t){const a=t,n=e.getUint32(t,!0),s=iN(e,t+=4,22).trim();t+=22,e.getUint8(t),t+=1;const r=e.getUint16(t,!0);t+=2;let i,o,l,c=0,u=[],d=0;if(r>0){c=e.getUint32(t,!0),t+=4,u=[];for(let i=0;i<96;i++)u.push(e.getUint8(t+i));i=nN(e,t+=96),o=nN(e,t+=48),t+=48;const a=e.getUint8(t);t+=1;const n=e.getUint8(t);t+=1,i.enabled=!!(1&a),o.enabled=!!(1&n);const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const p=e.getUint8(t);t+=1;const m=e.getUint8(t);t+=1,l={type:["sine","square","rampDown","rampUp"][s],sweep:r,depth:p,rate:m},d=e.getUint16(t,!0),t+=2,t+=22}t=a+n;const p=[];for(let h=0;h<r;h++)p.push(sN(e,t)),t+=c;const m=[];for(let h=0;h<r;h++){const a=p[h],n=rN(e,t,a);t+=a.length,m.push({id:h,name:a.name,pcmData:n,loopStart:a.loopStart/(16&a.type?2:1),loopLength:a.loopLength/(16&a.type?2:1),loopType:3&a.type?1==(3&a.type)?"forward":"pingpong":"none",volume:a.volume,finetune:a.finetune,relativeNote:a.relativeNote,panning:a.panning,bitDepth:16&a.type?16:8,sampleRate:44100,length:a.length/(16&a.type?2:1)})}return{parsed:{id:0,name:s,samples:m,volumeEnvelope:i,panningEnvelope:o,autoVibrato:l,fadeout:d,volumeType:"envelope",panningType:"envelope"},totalSize:t-a}}function nN(e,t){const a=[];for(let o=0;o<12;o++){const n=e.getUint16(t+4*o,!0),s=e.getUint16(t+4*o+2,!0);a.push({tick:n,value:s})}const n=e.getUint8(t+48),s=e.getUint8(t+49),r=e.getUint8(t+50),i=e.getUint8(t+51);return{enabled:!1,points:a.slice(0,n),sustainPoint:n>0?s:null,loopStartPoint:n>0?r:null,loopEndPoint:n>0?i:null}}function sN(e,t){return{length:e.getUint32(t,!0),loopStart:e.getUint32(t+4,!0),loopLength:e.getUint32(t+8,!0),volume:e.getUint8(t+12),finetune:e.getInt8(t+13),type:e.getUint8(t+14),panning:e.getUint8(t+15),relativeNote:e.getInt8(t+16),reserved:e.getUint8(t+17),name:iN(e,t+18,22).trim()}}function rN(e,t,a){const n=!!(16&a.type),s=a.length;if(n){const a=new Int16Array(s/2);let n=0;for(let s=0;s<a.length;s++){n+=e.getInt16(t+2*s,!0),a[s]=n}return a.buffer}{const a=new Int8Array(s);let n=0;for(let s=0;s<a.length;s++){n+=e.getInt8(t+s),a[s]=n}return a.buffer}}function iN(e,t,a){const n=[];for(let s=0;s<a;s++){const a=e.getUint8(t+s);if(0===a)break;n.push(a)}return String.fromCharCode(...n)}const oN={"M.K.":4,"M!K!":4,FLT4:4,FLT8:8,"4CHN":4,"6CHN":6,"8CHN":8,OCTA:8,CD81:8,"2CHN":2,TDZ1:1,TDZ2:2,TDZ3:3};async function lN(e){const t=new DataView(e);let a=0;const n=function(e){let t=0;const a=dN(e,t,20).trim();t+=20;const n=[];for(let c=0;c<31;c++){const a=dN(e,t,22).trim(),s=e.getUint16(t+22,!1),r=15&e.getUint8(t+24),i=Math.min(e.getUint8(t+25),64),o=e.getUint16(t+26,!1),l=e.getUint16(t+28,!1);n.push({name:a,length:s,finetune:r>7?r-16:r,volume:i,loopStart:o,loopLength:l}),t+=30}const s=e.getUint8(t);t+=1;const r=e.getUint8(t);t+=1;const i=[];let o=0;for(let c=0;c<128;c++){const a=e.getUint8(t+c);i.push(a),c<s&&a>o&&(o=a)}t+=128;const l=dN(e,t,4);return{title:a,samples:n,songLength:s,restartPosition:r,patternOrderTable:i,formatTag:l,channelCount:oN[l]||4,patternCount:o+1}}(t);a=1084;const s=[];for(let c=0;c<n.patternCount;c++){const e=cN(t,a,n.channelCount);s.push(e),a+=64*n.channelCount*4}const{initialSpeed:r,initialBPM:i}=function(e,t){let a=6,n=125,s=!1,r=!1;const i=[];for(let u=0;u<e.length;u++){const t=e[u];if(t)for(let e=0;e<t.length;e++){const a=t[e];if(a)for(let t=0;t<a.length;t++){const n=a[t];15===n.effect&&0!==n.effectParam&&i.push({pat:u,row:e,ch:t,param:n.effectParam})}}}i.length;const o=t[0],l=e[o];if(!l)return{initialSpeed:a,initialBPM:n};const c=Math.min(16,l.length);for(let u=0;u<c&&(!s||!r);u++){const e=l[u];if(e)for(const t of e)if(15===t.effect){const e=t.effectParam;if(0===e)continue;e<32?s||(a=e,s=!0):r||(n=e,r=!0)}}return{initialSpeed:a,initialBPM:n}}(s,n.patternOrderTable),o=[];for(let c=0;c<31;c++){const e=n.samples[c];if(0===e.length)continue;const s=uN(t,a,e);a+=2*e.length;const r=2*e.loopStart,i=2*e.loopLength,l=c+1,u={id:l,name:e.name,pcmData:s,loopStart:r,loopLength:i,loopType:e.loopLength>1?"forward":"none",volume:e.volume,finetune:e.finetune,relativeNote:0,panning:128,bitDepth:8,sampleRate:8363,length:2*e.length};o.push({id:l,name:e.name,samples:[u],fadeout:0,volumeType:"none",panningType:"none"})}const l={sourceFormat:"MOD",sourceFile:n.title,importedAt:(new Date).toISOString(),originalChannelCount:n.channelCount,originalPatternCount:n.patternCount,originalInstrumentCount:o.length,modData:{moduleType:n.formatTag,initialSpeed:r,initialBPM:i,amigaPeriods:!0,channelNames:Array.from({length:n.channelCount},(e,t)=>`Channel ${t+1}`),songLength:n.songLength,restartPosition:n.restartPosition,patternOrderTable:n.patternOrderTable},originalSamples:{},envelopes:{}};return o.forEach(e=>{e.samples.forEach(e=>{l.originalSamples[e.id]=e})}),{header:n,patterns:s,instruments:o,metadata:l}}function cN(e,t,a){const n=[];for(let s=0;s<64;s++){const s=[];for(let n=0;n<a;n++){const a=e.getUint8(t++),n=e.getUint8(t++),r=e.getUint8(t++),i=(15&a)<<8|n,o=240&a|(240&r)>>4,l=15&r,c=e.getUint8(t++);s.push({period:i,instrument:o,effect:l,effectParam:c})}n.push(s)}return n}function uN(e,t,a){const n=2*a.length,s=new Int8Array(n);for(let r=0;r<n;r++)s[r]=e.getInt8(t+r);return s.buffer}function dN(e,t,a){const n=[];for(let s=0;s<a;s++){const a=e.getUint8(t+s);if(0===a)break;n.push(a)}return String.fromCharCode(...n)}function pN(e){let t=e.length;for(;--t>=0;)e[t]=0}const mN=256,hN=286,fN=30,yN=15,gN=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),bN=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vN=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),xN=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wN=new Array(576);pN(wN);const kN=new Array(60);pN(kN);const SN=new Array(512);pN(SN);const MN=new Array(256);pN(MN);const NN=new Array(29);pN(NN);const CN=new Array(fN);function PN(e,t,a,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let EN,_N,TN;function AN(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}pN(CN);const ON=e=>e<256?SN[e]:SN[256+(e>>>7)],IN=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},FN=(e,t,a)=>{e.bi_valid>16-a?(e.bi_buf|=t<<e.bi_valid&65535,IN(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=a-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=a)},DN=(e,t,a)=>{FN(e,a[2*t],a[2*t+1])},RN=(e,t)=>{let a=0;do{a|=1&e,e>>>=1,a<<=1}while(--t>0);return a>>>1},jN=(e,t,a)=>{const n=new Array(16);let s,r,i=0;for(s=1;s<=yN;s++)i=i+a[s-1]<<1,n[s]=i;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=RN(n[t]++,t))}},BN=e=>{let t;for(t=0;t<hN;t++)e.dyn_ltree[2*t]=0;for(t=0;t<fN;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},LN=e=>{e.bi_valid>8?IN(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},VN=(e,t,a,n)=>{const s=2*t,r=2*a;return e[s]<e[r]||e[s]===e[r]&&n[t]<=n[a]},zN=(e,t,a)=>{const n=e.heap[a];let s=a<<1;for(;s<=e.heap_len&&(s<e.heap_len&&VN(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!VN(t,n,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=n},UN=(e,t,a)=>{let n,s,r,i,o=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+o++],n+=(255&e.pending_buf[e.sym_buf+o++])<<8,s=e.pending_buf[e.sym_buf+o++],0===n?DN(e,s,t):(r=MN[s],DN(e,r+mN+1,t),i=gN[r],0!==i&&(s-=NN[r],FN(e,s,i)),n--,r=ON(n),DN(e,r,a),i=bN[r],0!==i&&(n-=CN[r],FN(e,n,i)))}while(o<e.sym_next);DN(e,256,t)},GN=(e,t)=>{const a=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let i,o,l,c=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<r;i++)0!==a[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):a[2*i+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,a[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=n[2*l+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)zN(e,a,i);l=r;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],zN(e,a,1),o=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=o,a[2*l]=a[2*i]+a[2*o],e.depth[l]=(e.depth[i]>=e.depth[o]?e.depth[i]:e.depth[o])+1,a[2*i+1]=a[2*o+1]=l,e.heap[1]=l++,zN(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const a=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,i=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,u,d,p,m,h,f=0;for(p=0;p<=yN;p++)e.bl_count[p]=0;for(a[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)u=e.heap[c],p=a[2*a[2*u+1]+1]+1,p>l&&(p=l,f++),a[2*u+1]=p,u>n||(e.bl_count[p]++,m=0,u>=o&&(m=i[u-o]),h=a[2*u],e.opt_len+=h*(p+m),r&&(e.static_len+=h*(s[2*u+1]+m)));if(0!==f){do{for(p=l-1;0===e.bl_count[p];)p--;e.bl_count[p]--,e.bl_count[p+1]+=2,e.bl_count[l]--,f-=2}while(f>0);for(p=l;0!==p;p--)for(u=e.bl_count[p];0!==u;)d=e.heap[--c],d>n||(a[2*d+1]!==p&&(e.opt_len+=(p-a[2*d+1])*a[2*d],a[2*d+1]=p),u--)}})(e,t),jN(a,c,e.bl_count)},WN=(e,t,a)=>{let n,s,r=-1,i=t[1],o=0,l=7,c=4;for(0===i&&(l=138,c=3),t[2*(a+1)+1]=65535,n=0;n<=a;n++)s=i,i=t[2*(n+1)+1],++o<l&&s===i||(o<c?e.bl_tree[2*s]+=o:0!==s?(s!==r&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=s,0===i?(l=138,c=3):s===i?(l=6,c=3):(l=7,c=4))},HN=(e,t,a)=>{let n,s,r=-1,i=t[1],o=0,l=7,c=4;for(0===i&&(l=138,c=3),n=0;n<=a;n++)if(s=i,i=t[2*(n+1)+1],!(++o<l&&s===i)){if(o<c)do{DN(e,s,e.bl_tree)}while(0!==--o);else 0!==s?(s!==r&&(DN(e,s,e.bl_tree),o--),DN(e,16,e.bl_tree),FN(e,o-3,2)):o<=10?(DN(e,17,e.bl_tree),FN(e,o-3,3)):(DN(e,18,e.bl_tree),FN(e,o-11,7));o=0,r=s,0===i?(l=138,c=3):s===i?(l=6,c=3):(l=7,c=4)}};let KN=!1;const qN=(e,t,a,n)=>{FN(e,0+(n?1:0),3),LN(e),IN(e,a),IN(e,~a),a&&e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a};var $N={_tr_init:e=>{KN||((()=>{let e,t,a,n,s;const r=new Array(16);for(a=0,n=0;n<28;n++)for(NN[n]=a,e=0;e<1<<gN[n];e++)MN[a++]=n;for(MN[a-1]=n,s=0,n=0;n<16;n++)for(CN[n]=s,e=0;e<1<<bN[n];e++)SN[s++]=n;for(s>>=7;n<fN;n++)for(CN[n]=s<<7,e=0;e<1<<bN[n]-7;e++)SN[256+s++]=n;for(t=0;t<=yN;t++)r[t]=0;for(e=0;e<=143;)wN[2*e+1]=8,e++,r[8]++;for(;e<=255;)wN[2*e+1]=9,e++,r[9]++;for(;e<=279;)wN[2*e+1]=7,e++,r[7]++;for(;e<=287;)wN[2*e+1]=8,e++,r[8]++;for(jN(wN,287,r),e=0;e<fN;e++)kN[2*e+1]=5,kN[2*e]=RN(e,5);EN=new PN(wN,gN,257,hN,yN),_N=new PN(kN,bN,0,fN,yN),TN=new PN(new Array(0),vN,0,19,7)})(),KN=!0),e.l_desc=new AN(e.dyn_ltree,EN),e.d_desc=new AN(e.dyn_dtree,_N),e.bl_desc=new AN(e.bl_tree,TN),e.bi_buf=0,e.bi_valid=0,BN(e)},_tr_stored_block:qN,_tr_flush_block:(e,t,a,n)=>{let s,r,i=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,a=4093624447;for(t=0;t<=31;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<mN;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),GN(e,e.l_desc),GN(e,e.d_desc),i=(e=>{let t;for(WN(e,e.dyn_ltree,e.l_desc.max_code),WN(e,e.dyn_dtree,e.d_desc.max_code),GN(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*xN[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=s&&(s=r)):s=r=a+5,a+4<=s&&-1!==t?qN(e,t,a,n):4===e.strategy||r===s?(FN(e,2+(n?1:0),3),UN(e,wN,kN)):(FN(e,4+(n?1:0),3),((e,t,a,n)=>{let s;for(FN(e,t-257,5),FN(e,a-1,5),FN(e,n-4,4),s=0;s<n;s++)FN(e,e.bl_tree[2*xN[s]+1],3);HN(e,e.dyn_ltree,t-1),HN(e,e.dyn_dtree,a-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),UN(e,e.dyn_ltree,e.dyn_dtree)),BN(e),n&&LN(e)},_tr_tally:(e,t,a)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=a,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(MN[a]+mN+1)]++,e.dyn_dtree[2*ON(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{FN(e,2,3),DN(e,256,wN),(e=>{16===e.bi_valid?(IN(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var XN=(e,t,a,n)=>{let s=65535&e,r=e>>>16&65535,i=0;for(;0!==a;){i=a>2e3?2e3:a,a-=i;do{s=s+t[n++]|0,r=r+s|0}while(--i);s%=65521,r%=65521}return s|r<<16};const YN=new Uint32Array((()=>{let e,t=[];for(var a=0;a<256;a++){e=a;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());var ZN=(e,t,a,n)=>{const s=YN,r=n+a;e^=-1;for(let i=n;i<r;i++)e=e>>>8^s[255&(e^t[i])];return-1^e},QN={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},JN={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:eC,_tr_stored_block:tC,_tr_flush_block:aC,_tr_tally:nC,_tr_align:sC}=$N,{Z_NO_FLUSH:rC,Z_PARTIAL_FLUSH:iC,Z_FULL_FLUSH:oC,Z_FINISH:lC,Z_BLOCK:cC,Z_OK:uC,Z_STREAM_END:dC,Z_STREAM_ERROR:pC,Z_DATA_ERROR:mC,Z_BUF_ERROR:hC,Z_DEFAULT_COMPRESSION:fC,Z_FILTERED:yC,Z_HUFFMAN_ONLY:gC,Z_RLE:bC,Z_FIXED:vC,Z_DEFAULT_STRATEGY:xC,Z_UNKNOWN:wC,Z_DEFLATED:kC}=JN,SC=258,MC=262,NC=42,CC=113,PC=666,EC=(e,t)=>(e.msg=QN[t],t),_C=e=>2*e-(e>4?9:0),TC=e=>{let t=e.length;for(;--t>=0;)e[t]=0},AC=e=>{let t,a,n,s=e.w_size;t=e.hash_size,n=t;do{a=e.head[--n],e.head[n]=a>=s?a-s:0}while(--t);t=s,n=t;do{a=e.prev[--n],e.prev[n]=a>=s?a-s:0}while(--t)};let OC=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const IC=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},FC=(e,t)=>{aC(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,IC(e.strm)},DC=(e,t)=>{e.pending_buf[e.pending++]=t},RC=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},jC=(e,t,a,n)=>{let s=e.avail_in;return s>n&&(s=n),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=XN(e.adler,t,s,a):2===e.state.wrap&&(e.adler=ZN(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},BC=(e,t)=>{let a,n,s=e.max_chain_length,r=e.strstart,i=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-MC?e.strstart-(e.w_size-MC):0,c=e.window,u=e.w_mask,d=e.prev,p=e.strstart+SC;let m=c[r+i-1],h=c[r+i];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(a=t,c[a+i]===h&&c[a+i-1]===m&&c[a]===c[r]&&c[++a]===c[r+1]){r+=2,a++;do{}while(c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&c[++r]===c[++a]&&r<p);if(n=SC-(p-r),r=p-SC,n>i){if(e.match_start=t,i=n,n>=o)break;m=c[r+i-1],h=c[r+i]}}}while((t=d[t&u])>l&&0!==--s);return i<=e.lookahead?i:e.lookahead},LC=e=>{const t=e.w_size;let a,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MC)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),AC(e),n+=t),0===e.strm.avail_in)break;if(a=jC(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=a,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=OC(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=OC(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<MC&&0!==e.strm.avail_in)},VC=(e,t)=>{let a,n,s,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,i=0,o=e.strm.avail_in;do{if(a=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,n=e.strstart-e.block_start,a>n+e.strm.avail_in&&(a=n+e.strm.avail_in),a>s&&(a=s),a<r&&(0===a&&t!==lC||t===rC||a!==n+e.strm.avail_in))break;i=t===lC&&a===n+e.strm.avail_in?1:0,tC(e,0,0,i),e.pending_buf[e.pending-4]=a,e.pending_buf[e.pending-3]=a>>8,e.pending_buf[e.pending-2]=~a,e.pending_buf[e.pending-1]=~a>>8,IC(e.strm),n&&(n>a&&(n=a),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,a-=n),a&&(jC(e.strm,e.strm.output,e.strm.next_out,a),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a)}while(0===i);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?4:t!==rC&&t!==lC&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(jC(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,r=s>e.w_size?e.w_size:s,n=e.strstart-e.block_start,(n>=r||(n||t===lC)&&t!==rC&&0===e.strm.avail_in&&n<=s)&&(a=n>s?s:n,i=t===lC&&0===e.strm.avail_in&&a===n?1:0,tC(e,e.block_start,a,i),e.block_start+=a,IC(e.strm)),i?3:1)},zC=(e,t)=>{let a,n;for(;;){if(e.lookahead<MC){if(LC(e),e.lookahead<MC&&t===rC)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=OC(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-MC&&(e.match_length=BC(e,a)),e.match_length>=3)if(n=nC(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=OC(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=OC(e,e.ins_h,e.window[e.strstart+1]);else n=nC(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(FC(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===lC?(FC(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(FC(e,!1),0===e.strm.avail_out)?1:2},UC=(e,t)=>{let a,n,s;for(;;){if(e.lookahead<MC){if(LC(e),e.lookahead<MC&&t===rC)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=OC(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-MC&&(e.match_length=BC(e,a),e.match_length<=5&&(e.strategy===yC||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,n=nC(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=OC(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(FC(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=nC(e,0,e.window[e.strstart-1]),n&&FC(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=nC(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===lC?(FC(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(FC(e,!1),0===e.strm.avail_out)?1:2};function GC(e,t,a,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=n,this.func=s}const WC=[new GC(0,0,0,0,VC),new GC(4,4,8,4,zC),new GC(4,5,16,8,zC),new GC(4,6,32,32,zC),new GC(4,4,16,16,UC),new GC(8,16,32,32,UC),new GC(8,16,128,128,UC),new GC(8,32,128,256,UC),new GC(32,128,258,1024,UC),new GC(32,258,258,4096,UC)];function HC(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=kC,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),TC(this.dyn_ltree),TC(this.dyn_dtree),TC(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),TC(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),TC(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const KC=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==NC&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==CC&&t.status!==PC?1:0},qC=e=>{if(KC(e))return EC(e,pC);e.total_in=e.total_out=0,e.data_type=wC;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?NC:CC,e.adler=2===t.wrap?0:1,t.last_flush=-2,eC(t),uC},$C=e=>{const t=qC(e);var a;return t===uC&&((a=e.state).window_size=2*a.w_size,TC(a.head),a.max_lazy_match=WC[a.level].max_lazy,a.good_match=WC[a.level].good_length,a.nice_match=WC[a.level].nice_length,a.max_chain_length=WC[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),t},XC=(e,t,a,n,s,r)=>{if(!e)return pC;let i=1;if(t===fC&&(t=6),n<0?(i=0,n=-n):n>15&&(i=2,n-=16),s<1||s>9||a!==kC||n<8||n>15||t<0||t>9||r<0||r>vC||8===n&&1!==i)return EC(e,pC);8===n&&(n=9);const o=new HC;return e.state=o,o.strm=e,o.status=NC,o.wrap=i,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=r,o.method=a,$C(e)};var YC={deflateInit:(e,t)=>XC(e,t,kC,15,8,xC),deflateInit2:XC,deflateReset:$C,deflateResetKeep:qC,deflateSetHeader:(e,t)=>KC(e)||2!==e.state.wrap?pC:(e.state.gzhead=t,uC),deflate:(e,t)=>{if(KC(e)||t>cC||t<0)return e?EC(e,pC):pC;const a=e.state;if(!e.output||0!==e.avail_in&&!e.input||a.status===PC&&t!==lC)return EC(e,0===e.avail_out?hC:pC);const n=a.last_flush;if(a.last_flush=t,0!==a.pending){if(IC(e),0===e.avail_out)return a.last_flush=-1,uC}else if(0===e.avail_in&&_C(t)<=_C(n)&&t!==lC)return EC(e,hC);if(a.status===PC&&0!==e.avail_in)return EC(e,hC);if(a.status===NC&&0===a.wrap&&(a.status=CC),a.status===NC){let t=kC+(a.w_bits-8<<4)<<8,n=-1;if(n=a.strategy>=gC||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=n<<6,0!==a.strstart&&(t|=32),t+=31-t%31,RC(a,t),0!==a.strstart&&(RC(a,e.adler>>>16),RC(a,65535&e.adler)),e.adler=1,a.status=CC,IC(e),0!==a.pending)return a.last_flush=-1,uC}if(57===a.status)if(e.adler=0,DC(a,31),DC(a,139),DC(a,8),a.gzhead)DC(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),DC(a,255&a.gzhead.time),DC(a,a.gzhead.time>>8&255),DC(a,a.gzhead.time>>16&255),DC(a,a.gzhead.time>>24&255),DC(a,9===a.level?2:a.strategy>=gC||a.level<2?4:0),DC(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(DC(a,255&a.gzhead.extra.length),DC(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=ZN(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(DC(a,0),DC(a,0),DC(a,0),DC(a,0),DC(a,0),DC(a,9===a.level?2:a.strategy>=gC||a.level<2?4:0),DC(a,3),a.status=CC,IC(e),0!==a.pending)return a.last_flush=-1,uC;if(69===a.status){if(a.gzhead.extra){let t=a.pending,n=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+n>a.pending_buf_size;){let s=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>t&&(e.adler=ZN(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex+=s,IC(e),0!==a.pending)return a.last_flush=-1,uC;t=0,n-=s}let s=new Uint8Array(a.gzhead.extra);a.pending_buf.set(s.subarray(a.gzindex,a.gzindex+n),a.pending),a.pending+=n,a.gzhead.hcrc&&a.pending>t&&(e.adler=ZN(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let t,n=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>n&&(e.adler=ZN(e.adler,a.pending_buf,a.pending-n,n)),IC(e),0!==a.pending)return a.last_flush=-1,uC;n=0}t=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,DC(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>n&&(e.adler=ZN(e.adler,a.pending_buf,a.pending-n,n)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let t,n=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>n&&(e.adler=ZN(e.adler,a.pending_buf,a.pending-n,n)),IC(e),0!==a.pending)return a.last_flush=-1,uC;n=0}t=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,DC(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>n&&(e.adler=ZN(e.adler,a.pending_buf,a.pending-n,n))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(IC(e),0!==a.pending))return a.last_flush=-1,uC;DC(a,255&e.adler),DC(a,e.adler>>8&255),e.adler=0}if(a.status=CC,IC(e),0!==a.pending)return a.last_flush=-1,uC}if(0!==e.avail_in||0!==a.lookahead||t!==rC&&a.status!==PC){let n=0===a.level?VC(a,t):a.strategy===gC?((e,t)=>{let a;for(;;){if(0===e.lookahead&&(LC(e),0===e.lookahead)){if(t===rC)return 1;break}if(e.match_length=0,a=nC(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(FC(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===lC?(FC(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(FC(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===bC?((e,t)=>{let a,n,s,r;const i=e.window;for(;;){if(e.lookahead<=SC){if(LC(e),e.lookahead<=SC&&t===rC)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,n=i[s],n===i[++s]&&n===i[++s]&&n===i[++s])){r=e.strstart+SC;do{}while(n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&n===i[++s]&&s<r);e.match_length=SC-(r-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(a=nC(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=nC(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(FC(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===lC?(FC(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(FC(e,!1),0===e.strm.avail_out)?1:2})(a,t):WC[a.level].func(a,t);if(3!==n&&4!==n||(a.status=PC),1===n||3===n)return 0===e.avail_out&&(a.last_flush=-1),uC;if(2===n&&(t===iC?sC(a):t!==cC&&(tC(a,0,0,!1),t===oC&&(TC(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),IC(e),0===e.avail_out))return a.last_flush=-1,uC}return t!==lC?uC:a.wrap<=0?dC:(2===a.wrap?(DC(a,255&e.adler),DC(a,e.adler>>8&255),DC(a,e.adler>>16&255),DC(a,e.adler>>24&255),DC(a,255&e.total_in),DC(a,e.total_in>>8&255),DC(a,e.total_in>>16&255),DC(a,e.total_in>>24&255)):(RC(a,e.adler>>>16),RC(a,65535&e.adler)),IC(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?uC:dC)},deflateEnd:e=>{if(KC(e))return pC;const t=e.state.status;return e.state=null,t===CC?EC(e,mC):uC},deflateSetDictionary:(e,t)=>{let a=t.length;if(KC(e))return pC;const n=e.state,s=n.wrap;if(2===s||1===s&&n.status!==NC||n.lookahead)return pC;if(1===s&&(e.adler=XN(e.adler,t,a,0)),n.wrap=0,a>=n.w_size){0===s&&(TC(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(a-n.w_size,a),0),t=e,a=n.w_size}const r=e.avail_in,i=e.next_in,o=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,LC(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=OC(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,LC(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=i,e.input=o,e.avail_in=r,n.wrap=s,uC},deflateInfo:"pako deflate (from Nodeca project)"};const ZC=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var QC=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const t in a)ZC(a,t)&&(e[t]=a[t])}}return e},JC=e=>{let t=0;for(let n=0,s=e.length;n<s;n++)t+=e[n].length;const a=new Uint8Array(t);for(let n=0,s=0,r=e.length;n<r;n++){let t=e[n];a.set(t,s),s+=t.length}return a};let eP=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(hF){eP=!1}const tP=new Uint8Array(256);for(let fF=0;fF<256;fF++)tP[fF]=fF>=252?6:fF>=248?5:fF>=240?4:fF>=224?3:fF>=192?2:1;tP[254]=tP[254]=1;var aP=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,a,n,s,r,i=e.length,o=0;for(s=0;s<i;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<i&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),o+=a<128?1:a<2048?2:a<65536?3:4;for(t=new Uint8Array(o),r=0,s=0;r<o;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<i&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),a<128?t[r++]=a:a<2048?(t[r++]=192|a>>>6,t[r++]=128|63&a):a<65536?(t[r++]=224|a>>>12,t[r++]=128|a>>>6&63,t[r++]=128|63&a):(t[r++]=240|a>>>18,t[r++]=128|a>>>12&63,t[r++]=128|a>>>6&63,t[r++]=128|63&a);return t},nP=(e,t)=>{const a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,s;const r=new Array(2*a);for(s=0,n=0;n<a;){let t=e[n++];if(t<128){r[s++]=t;continue}let i=tP[t];if(i>4)r[s++]=65533,n+=i-1;else{for(t&=2===i?31:3===i?15:7;i>1&&n<a;)t=t<<6|63&e[n++],i--;i>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&eP)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let a="";for(let n=0;n<t;n++)a+=String.fromCharCode(e[n]);return a})(r,s)},sP=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+tP[e[a]]>t?a:t};var rP=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const iP=Object.prototype.toString,{Z_NO_FLUSH:oP,Z_SYNC_FLUSH:lP,Z_FULL_FLUSH:cP,Z_FINISH:uP,Z_OK:dP,Z_STREAM_END:pP,Z_DEFAULT_COMPRESSION:mP,Z_DEFAULT_STRATEGY:hP,Z_DEFLATED:fP}=JN;function yP(e){this.options=QC({level:mP,method:fP,chunkSize:16384,windowBits:15,memLevel:8,strategy:hP},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rP,this.strm.avail_out=0;let a=YC.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==dP)throw new Error(QN[a]);if(t.header&&YC.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?aP(t.dictionary):"[object ArrayBuffer]"===iP.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=YC.deflateSetDictionary(this.strm,e),a!==dP)throw new Error(QN[a]);this._dict_set=!0}}function gP(e,t){const a=new yP(t);if(a.push(e,!0),a.err)throw a.msg||QN[a.err];return a.result}yP.prototype.push=function(e,t){const a=this.strm,n=this.options.chunkSize;let s,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?uP:oP,"string"==typeof e?a.input=aP(e):"[object ArrayBuffer]"===iP.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(n),a.next_out=0,a.avail_out=n),(r===lP||r===cP)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(s=YC.deflate(a,r),s===pP)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),s=YC.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===dP;if(0!==a.avail_out){if(r>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},yP.prototype.onData=function(e){this.chunks.push(e)},yP.prototype.onEnd=function(e){e===dP&&(this.result=JC(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bP={Deflate:yP,deflate:gP,deflateRaw:function(e,t){return(t=t||{}).raw=!0,gP(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,gP(e,t)}};const vP=16209;var xP=function(e,t){let a,n,s,r,i,o,l,c,u,d,p,m,h,f,y,g,b,v,x,w,k,S,M,N;const C=e.state;a=e.next_in,M=e.input,n=a+(e.avail_in-5),s=e.next_out,N=e.output,r=s-(t-e.avail_out),i=s+(e.avail_out-257),o=C.dmax,l=C.wsize,c=C.whave,u=C.wnext,d=C.window,p=C.hold,m=C.bits,h=C.lencode,f=C.distcode,y=(1<<C.lenbits)-1,g=(1<<C.distbits)-1;e:do{m<15&&(p+=M[a++]<<m,m+=8,p+=M[a++]<<m,m+=8),b=h[p&y];t:for(;;){if(v=b>>>24,p>>>=v,m-=v,v=b>>>16&255,0===v)N[s++]=65535&b;else{if(!(16&v)){if(64&v){if(32&v){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=vP;break e}b=h[(65535&b)+(p&(1<<v)-1)];continue t}for(x=65535&b,v&=15,v&&(m<v&&(p+=M[a++]<<m,m+=8),x+=p&(1<<v)-1,p>>>=v,m-=v),m<15&&(p+=M[a++]<<m,m+=8,p+=M[a++]<<m,m+=8),b=f[p&g];;){if(v=b>>>24,p>>>=v,m-=v,v=b>>>16&255,16&v){if(w=65535&b,v&=15,m<v&&(p+=M[a++]<<m,m+=8,m<v&&(p+=M[a++]<<m,m+=8)),w+=p&(1<<v)-1,w>o){e.msg="invalid distance too far back",C.mode=vP;break e}if(p>>>=v,m-=v,v=s-r,w>v){if(v=w-v,v>c&&C.sane){e.msg="invalid distance too far back",C.mode=vP;break e}if(k=0,S=d,0===u){if(k+=l-v,v<x){x-=v;do{N[s++]=d[k++]}while(--v);k=s-w,S=N}}else if(u<v){if(k+=l+u-v,v-=u,v<x){x-=v;do{N[s++]=d[k++]}while(--v);if(k=0,u<x){v=u,x-=v;do{N[s++]=d[k++]}while(--v);k=s-w,S=N}}}else if(k+=u-v,v<x){x-=v;do{N[s++]=d[k++]}while(--v);k=s-w,S=N}for(;x>2;)N[s++]=S[k++],N[s++]=S[k++],N[s++]=S[k++],x-=3;x&&(N[s++]=S[k++],x>1&&(N[s++]=S[k++]))}else{k=s-w;do{N[s++]=N[k++],N[s++]=N[k++],N[s++]=N[k++],x-=3}while(x>2);x&&(N[s++]=N[k++],x>1&&(N[s++]=N[k++]))}break}if(64&v){e.msg="invalid distance code",C.mode=vP;break e}b=f[(65535&b)+(p&(1<<v)-1)]}}break}}while(a<n&&s<i);x=m>>3,a-=x,m-=x<<3,p&=(1<<m)-1,e.next_in=a,e.next_out=s,e.avail_in=a<n?n-a+5:5-(a-n),e.avail_out=s<i?i-s+257:257-(s-i),C.hold=p,C.bits=m};const wP=15,kP=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),SP=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),MP=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),NP=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var CP=(e,t,a,n,s,r,i,o)=>{const l=o.bits;let c,u,d,p,m,h,f=0,y=0,g=0,b=0,v=0,x=0,w=0,k=0,S=0,M=0,N=null;const C=new Uint16Array(16),P=new Uint16Array(16);let E,_,T,A=null;for(f=0;f<=wP;f++)C[f]=0;for(y=0;y<n;y++)C[t[a+y]]++;for(v=l,b=wP;b>=1&&0===C[b];b--);if(v>b&&(v=b),0===b)return s[r++]=20971520,s[r++]=20971520,o.bits=1,0;for(g=1;g<b&&0===C[g];g++);for(v<g&&(v=g),k=1,f=1;f<=wP;f++)if(k<<=1,k-=C[f],k<0)return-1;if(k>0&&(0===e||1!==b))return-1;for(P[1]=0,f=1;f<wP;f++)P[f+1]=P[f]+C[f];for(y=0;y<n;y++)0!==t[a+y]&&(i[P[t[a+y]]++]=y);if(0===e?(N=A=i,h=20):1===e?(N=kP,A=SP,h=257):(N=MP,A=NP,h=0),M=0,y=0,f=g,m=r,x=v,w=0,d=-1,S=1<<v,p=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){E=f-w,i[y]+1<h?(_=0,T=i[y]):i[y]>=h?(_=A[i[y]-h],T=N[i[y]-h]):(_=96,T=0),c=1<<f-w,u=1<<x,g=u;do{u-=c,s[m+(M>>w)+u]=E<<24|_<<16|T}while(0!==u);for(c=1<<f-1;M&c;)c>>=1;if(0!==c?(M&=c-1,M+=c):M=0,y++,0===--C[f]){if(f===b)break;f=t[a+i[y]]}if(f>v&&(M&p)!==d){for(0===w&&(w=v),m+=g,x=f-w,k=1<<x;x+w<b&&(k-=C[x+w],!(k<=0));)x++,k<<=1;if(S+=1<<x,1===e&&S>852||2===e&&S>592)return 1;d=M&p,s[d]=v<<24|x<<16|m-r}}return 0!==M&&(s[m+M]=f-w<<24|64<<16),o.bits=v,0};const{Z_FINISH:PP,Z_BLOCK:EP,Z_TREES:_P,Z_OK:TP,Z_STREAM_END:AP,Z_NEED_DICT:OP,Z_STREAM_ERROR:IP,Z_DATA_ERROR:FP,Z_MEM_ERROR:DP,Z_BUF_ERROR:RP,Z_DEFLATED:jP}=JN,BP=16180,LP=16190,VP=16191,zP=16192,UP=16194,GP=16199,WP=16200,HP=16206,KP=16209,qP=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function $P(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const XP=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<BP||t.mode>16211?1:0},YP=e=>{if(XP(e))return IP;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=BP,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,TP},ZP=e=>{if(XP(e))return IP;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,YP(e)},QP=(e,t)=>{let a;if(XP(e))return IP;const n=e.state;return t<0?(a=0,t=-t):(a=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?IP:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=a,n.wbits=t,ZP(e))},JP=(e,t)=>{if(!e)return IP;const a=new $P;e.state=a,a.strm=e,a.window=null,a.mode=BP;const n=QP(e,t);return n!==TP&&(e.state=null),n};let eE,tE,aE=!0;const nE=e=>{if(aE){eE=new Int32Array(512),tE=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(CP(1,e.lens,0,288,eE,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;CP(2,e.lens,0,32,tE,0,e.work,{bits:5}),aE=!1}e.lencode=eE,e.lenbits=9,e.distcode=tE,e.distbits=5},sE=(e,t,a,n)=>{let s;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(t.subarray(a-r.wsize,a),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>n&&(s=n),r.window.set(t.subarray(a-n,a-n+s),r.wnext),(n-=s)?(r.window.set(t.subarray(a-n,a),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0};var rE={inflateReset:ZP,inflateReset2:QP,inflateResetKeep:YP,inflateInit:e=>JP(e,15),inflateInit2:JP,inflate:(e,t)=>{let a,n,s,r,i,o,l,c,u,d,p,m,h,f,y,g,b,v,x,w,k,S,M=0;const N=new Uint8Array(4);let C,P;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(XP(e)||!e.output||!e.input&&0!==e.avail_in)return IP;a=e.state,a.mode===VP&&(a.mode=zP),i=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,n=e.input,o=e.avail_in,c=a.hold,u=a.bits,d=o,p=l,S=TP;e:for(;;)switch(a.mode){case BP:if(0===a.wrap){a.mode=zP;break}for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(2&a.wrap&&35615===c){0===a.wbits&&(a.wbits=15),a.check=0,N[0]=255&c,N[1]=c>>>8&255,a.check=ZN(a.check,N,2,0),c=0,u=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",a.mode=KP;break}if((15&c)!==jP){e.msg="unknown compression method",a.mode=KP;break}if(c>>>=4,u-=4,k=8+(15&c),0===a.wbits&&(a.wbits=k),k>15||k>a.wbits){e.msg="invalid window size",a.mode=KP;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&c?16189:VP,c=0,u=0;break;case 16181:for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(a.flags=c,(255&a.flags)!==jP){e.msg="unknown compression method",a.mode=KP;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=KP;break}a.head&&(a.head.text=c>>8&1),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,a.check=ZN(a.check,N,2,0)),c=0,u=0,a.mode=16182;case 16182:for(;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.head&&(a.head.time=c),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,N[2]=c>>>16&255,N[3]=c>>>24&255,a.check=ZN(a.check,N,4,0)),c=0,u=0,a.mode=16183;case 16183:for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.head&&(a.head.xflags=255&c,a.head.os=c>>8),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,a.check=ZN(a.check,N,2,0)),c=0,u=0,a.mode=16184;case 16184:if(1024&a.flags){for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.length=c,a.head&&(a.head.extra_len=c),512&a.flags&&4&a.wrap&&(N[0]=255&c,N[1]=c>>>8&255,a.check=ZN(a.check,N,2,0)),c=0,u=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(m=a.length,m>o&&(m=o),m&&(a.head&&(k=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(n.subarray(r,r+m),k)),512&a.flags&&4&a.wrap&&(a.check=ZN(a.check,n,m,r)),o-=m,r+=m,a.length-=m),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===o)break e;m=0;do{k=n[r+m++],a.head&&k&&a.length<65536&&(a.head.name+=String.fromCharCode(k))}while(k&&m<o);if(512&a.flags&&4&a.wrap&&(a.check=ZN(a.check,n,m,r)),o-=m,r+=m,k)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===o)break e;m=0;do{k=n[r+m++],a.head&&k&&a.length<65536&&(a.head.comment+=String.fromCharCode(k))}while(k&&m<o);if(512&a.flags&&4&a.wrap&&(a.check=ZN(a.check,n,m,r)),o-=m,r+=m,k)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;u<16;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(4&a.wrap&&c!==(65535&a.check)){e.msg="header crc mismatch",a.mode=KP;break}c=0,u=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=VP;break;case 16189:for(;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}e.adler=a.check=qP(c),c=0,u=0,a.mode=LP;case LP:if(0===a.havedict)return e.next_out=i,e.avail_out=l,e.next_in=r,e.avail_in=o,a.hold=c,a.bits=u,OP;e.adler=a.check=1,a.mode=VP;case VP:if(t===EP||t===_P)break e;case zP:if(a.last){c>>>=7&u,u-=7&u,a.mode=HP;break}for(;u<3;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}switch(a.last=1&c,c>>>=1,u-=1,3&c){case 0:a.mode=16193;break;case 1:if(nE(a),a.mode=GP,t===_P){c>>>=2,u-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=KP}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",a.mode=KP;break}if(a.length=65535&c,c=0,u=0,a.mode=UP,t===_P)break e;case UP:a.mode=16195;case 16195:if(m=a.length,m){if(m>o&&(m=o),m>l&&(m=l),0===m)break e;s.set(n.subarray(r,r+m),i),o-=m,r+=m,l-=m,i+=m,a.length-=m;break}a.mode=VP;break;case 16196:for(;u<14;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(a.nlen=257+(31&c),c>>>=5,u-=5,a.ndist=1+(31&c),c>>>=5,u-=5,a.ncode=4+(15&c),c>>>=4,u-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=KP;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;u<3;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.lens[E[a.have++]]=7&c,c>>>=3,u-=3}for(;a.have<19;)a.lens[E[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,C={bits:a.lenbits},S=CP(0,a.lens,0,19,a.lencode,0,a.work,C),a.lenbits=C.bits,S){e.msg="invalid code lengths set",a.mode=KP;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;M=a.lencode[c&(1<<a.lenbits)-1],y=M>>>24,g=M>>>16&255,b=65535&M,!(y<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(b<16)c>>>=y,u-=y,a.lens[a.have++]=b;else{if(16===b){for(P=y+2;u<P;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(c>>>=y,u-=y,0===a.have){e.msg="invalid bit length repeat",a.mode=KP;break}k=a.lens[a.have-1],m=3+(3&c),c>>>=2,u-=2}else if(17===b){for(P=y+3;u<P;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=y,u-=y,k=0,m=3+(7&c),c>>>=3,u-=3}else{for(P=y+7;u<P;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=y,u-=y,k=0,m=11+(127&c),c>>>=7,u-=7}if(a.have+m>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=KP;break}for(;m--;)a.lens[a.have++]=k}}if(a.mode===KP)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=KP;break}if(a.lenbits=9,C={bits:a.lenbits},S=CP(1,a.lens,0,a.nlen,a.lencode,0,a.work,C),a.lenbits=C.bits,S){e.msg="invalid literal/lengths set",a.mode=KP;break}if(a.distbits=6,a.distcode=a.distdyn,C={bits:a.distbits},S=CP(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,C),a.distbits=C.bits,S){e.msg="invalid distances set",a.mode=KP;break}if(a.mode=GP,t===_P)break e;case GP:a.mode=WP;case WP:if(o>=6&&l>=258){e.next_out=i,e.avail_out=l,e.next_in=r,e.avail_in=o,a.hold=c,a.bits=u,xP(e,p),i=e.next_out,s=e.output,l=e.avail_out,r=e.next_in,n=e.input,o=e.avail_in,c=a.hold,u=a.bits,a.mode===VP&&(a.back=-1);break}for(a.back=0;M=a.lencode[c&(1<<a.lenbits)-1],y=M>>>24,g=M>>>16&255,b=65535&M,!(y<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(g&&!(240&g)){for(v=y,x=g,w=b;M=a.lencode[w+((c&(1<<v+x)-1)>>v)],y=M>>>24,g=M>>>16&255,b=65535&M,!(v+y<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=v,u-=v,a.back+=v}if(c>>>=y,u-=y,a.back+=y,a.length=b,0===g){a.mode=16205;break}if(32&g){a.back=-1,a.mode=VP;break}if(64&g){e.msg="invalid literal/length code",a.mode=KP;break}a.extra=15&g,a.mode=16201;case 16201:if(a.extra){for(P=a.extra;u<P;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.length+=c&(1<<a.extra)-1,c>>>=a.extra,u-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;M=a.distcode[c&(1<<a.distbits)-1],y=M>>>24,g=M>>>16&255,b=65535&M,!(y<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(!(240&g)){for(v=y,x=g,w=b;M=a.distcode[w+((c&(1<<v+x)-1)>>v)],y=M>>>24,g=M>>>16&255,b=65535&M,!(v+y<=u);){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}c>>>=v,u-=v,a.back+=v}if(c>>>=y,u-=y,a.back+=y,64&g){e.msg="invalid distance code",a.mode=KP;break}a.offset=b,a.extra=15&g,a.mode=16203;case 16203:if(a.extra){for(P=a.extra;u<P;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}a.offset+=c&(1<<a.extra)-1,c>>>=a.extra,u-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=KP;break}a.mode=16204;case 16204:if(0===l)break e;if(m=p-l,a.offset>m){if(m=a.offset-m,m>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=KP;break}m>a.wnext?(m-=a.wnext,h=a.wsize-m):h=a.wnext-m,m>a.length&&(m=a.length),f=a.window}else f=s,h=i-a.offset,m=a.length;m>l&&(m=l),l-=m,a.length-=m;do{s[i++]=f[h++]}while(--m);0===a.length&&(a.mode=WP);break;case 16205:if(0===l)break e;s[i++]=a.length,l--,a.mode=WP;break;case HP:if(a.wrap){for(;u<32;){if(0===o)break e;o--,c|=n[r++]<<u,u+=8}if(p-=l,e.total_out+=p,a.total+=p,4&a.wrap&&p&&(e.adler=a.check=a.flags?ZN(a.check,s,p,i-p):XN(a.check,s,p,i-p)),p=l,4&a.wrap&&(a.flags?c:qP(c))!==a.check){e.msg="incorrect data check",a.mode=KP;break}c=0,u=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;u<32;){if(0===o)break e;o--,c+=n[r++]<<u,u+=8}if(4&a.wrap&&c!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=KP;break}c=0,u=0}a.mode=16208;case 16208:S=AP;break e;case KP:S=FP;break e;case 16210:return DP;default:return IP}return e.next_out=i,e.avail_out=l,e.next_in=r,e.avail_in=o,a.hold=c,a.bits=u,(a.wsize||p!==e.avail_out&&a.mode<KP&&(a.mode<HP||t!==PP))&&sE(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,a.total+=p,4&a.wrap&&p&&(e.adler=a.check=a.flags?ZN(a.check,s,p,e.next_out-p):XN(a.check,s,p,e.next_out-p)),e.data_type=a.bits+(a.last?64:0)+(a.mode===VP?128:0)+(a.mode===GP||a.mode===UP?256:0),(0===d&&0===p||t===PP)&&S===TP&&(S=RP),S},inflateEnd:e=>{if(XP(e))return IP;let t=e.state;return t.window&&(t.window=null),e.state=null,TP},inflateGetHeader:(e,t)=>{if(XP(e))return IP;const a=e.state;return 2&a.wrap?(a.head=t,t.done=!1,TP):IP},inflateSetDictionary:(e,t)=>{const a=t.length;let n,s,r;return XP(e)?IP:(n=e.state,0!==n.wrap&&n.mode!==LP?IP:n.mode===LP&&(s=1,s=XN(s,t,a,0),s!==n.check)?FP:(r=sE(e,t,a,a),r?(n.mode=16210,DP):(n.havedict=1,TP)))},inflateInfo:"pako inflate (from Nodeca project)"};var iE=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const oE=Object.prototype.toString,{Z_NO_FLUSH:lE,Z_FINISH:cE,Z_OK:uE,Z_STREAM_END:dE,Z_NEED_DICT:pE,Z_STREAM_ERROR:mE,Z_DATA_ERROR:hE,Z_MEM_ERROR:fE}=JN;function yE(e){this.options=QC({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rP,this.strm.avail_out=0;let a=rE.inflateInit2(this.strm,t.windowBits);if(a!==uE)throw new Error(QN[a]);if(this.header=new iE,rE.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=aP(t.dictionary):"[object ArrayBuffer]"===oE.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=rE.inflateSetDictionary(this.strm,t.dictionary),a!==uE)))throw new Error(QN[a])}function gE(e,t){const a=new yE(t);if(a.push(e),a.err)throw a.msg||QN[a.err];return a.result}yE.prototype.push=function(e,t){const a=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let r,i,o;if(this.ended)return!1;for(i=t===~~t?t:!0===t?cE:lE,"[object ArrayBuffer]"===oE.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(n),a.next_out=0,a.avail_out=n),r=rE.inflate(a,i),r===pE&&s&&(r=rE.inflateSetDictionary(a,s),r===uE?r=rE.inflate(a,i):r===hE&&(r=pE));a.avail_in>0&&r===dE&&a.state.wrap>0&&0!==e[a.next_in];)rE.inflateReset(a),r=rE.inflate(a,i);switch(r){case mE:case hE:case pE:case fE:return this.onEnd(r),this.ended=!0,!1}if(o=a.avail_out,a.next_out&&(0===a.avail_out||r===dE))if("string"===this.options.to){let e=sP(a.output,a.next_out),t=a.next_out-e,s=nP(a.output,e);a.next_out=t,a.avail_out=n-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(r!==uE||0!==o){if(r===dE)return r=rE.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},yE.prototype.onData=function(e){this.chunks.push(e)},yE.prototype.onEnd=function(e){e===uE&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=JC(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bE={Inflate:yE,inflate:gE,inflateRaw:function(e,t){return(t=t||{}).raw=!0,gE(e,t)},ungzip:gE};const{Deflate:vE,deflate:xE,deflateRaw:wE,gzip:kE}=bP,{Inflate:SE,inflate:ME,inflateRaw:NE,ungzip:CE}=bE;var PE={Deflate:vE,deflate:xE,deflateRaw:wE,gzip:kE,Inflate:SE,inflate:ME,inflateRaw:NE,ungzip:CE,constants:JN};const EE={0:"ChipSynth",1:"FurnaceOPN",2:"FurnaceGB",3:"FurnaceC64",4:"Sampler",5:"FurnacePCE",6:"FurnaceAY",7:"FurnaceAY",8:"FurnaceTIA",9:"FurnaceSAA",10:"FurnaceVIC",11:"ChipSynth",12:"FurnaceVRC6",13:"FurnaceOPLL",14:"FurnaceOPL",15:"FurnaceFDS",16:"FurnaceVB",17:"FurnaceN163",18:"FurnaceSCC",19:"FurnaceOPZ",20:"ChipSynth",21:"ChipSynth",22:"FurnaceSWAN",23:"FurnaceLynx",24:"FurnaceVERA",25:"FurnaceX1_010",26:"FurnaceVRC6",27:"FurnaceES5506",28:"Sampler",29:"FurnaceSNES",30:"ChipSynth",31:"ChipSynth",32:"FurnaceOPL",33:"FurnaceOPM",34:"FurnaceNES",35:"Sampler",36:"FurnaceOKI",37:"Sampler",38:"Sampler",39:"FurnaceSEGAPCM",40:"FurnaceQSOUND",41:"FurnaceYMZ280B",42:"FurnaceRF5C68",43:"ChipSynth",44:"FurnaceT6W28",45:"FurnaceK007232",46:"FurnaceGA20",47:"ChipSynth",48:"FurnaceSM8521",49:"ChipSynth",50:"FurnaceK053260",52:"FurnaceTED",53:"FurnaceC140",54:"Sampler",55:"FurnaceESFM",56:"ChipSynth",57:"ChipSynth",58:"ChipSynth",59:"Sampler",60:"Sampler",61:"Sampler",62:"ChipSynth",63:"FurnaceC64",64:"FurnaceSUPERVISION",65:"FurnaceUPD1771",66:"FurnaceC64"};const _E=[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],TE=[250,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,253,253,253,253,254,254,254,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9],AE={2:0,3:3,4:5,5:6,6:4,7:10,71:10,240:10,128:12,129:0,130:1,131:0,132:15,135:24,136:9,137:11,138:16,141:47,142:13,143:2,144:2,145:2,151:18,152:22,160:0},OE={2:1,3:0,4:2,5:5,6:34,7:3,71:3,128:6,129:4,130:33,131:1,132:8,133:10,135:29,136:12,137:13,138:15,141:1,142:1,143:14,144:14,145:14,151:9,152:19,154:7,160:1},IE={0:0,1:17,2:10,3:4,4:4,5:6,6:5,7:3,71:3,128:3,129:4,130:8,131:6,132:2,133:4,134:1,135:8,136:3,137:9,138:1,139:3,140:8,141:6,142:16,143:9,144:9,145:18,146:28,147:1,148:4,149:8,150:4,151:6,152:8,153:1,154:3,155:16,156:6,157:6,158:16,159:6,160:9,161:5,162:11,163:11,164:20,165:14,166:17,167:11,168:4,170:4,171:1,172:17,173:2,174:42,175:44,176:16,177:32,178:10,179:12,180:5,181:8,182:9,183:19,184:8,185:3,186:8,187:8,188:8,189:11,190:7,191:4,192:1,193:10,194:18,195:10,196:20,197:20,198:2,199:4,200:3,202:5,203:3,204:4,205:2,206:24,207:16,209:18,212:4,213:6,214:16,215:2,216:16,217:4,222:19,224:19,226:4,227:4,229:4,240:3,241:5,245:7,252:1,253:8};function FE(e){let t="";for(;!e.isEOF();){const a=e.readUint8();if(0===a)break;t+=String.fromCharCode(a)}return t}async function DE(e){const t=function(e){if(120===e[0])try{return PE.inflate(e)}catch(t){throw new Error("Failed to decompress Furnace file: "+t)}return e}(new Uint8Array(e)),a=new bv(t.buffer),n=a.readMagic(16);if(!n.startsWith("-Furnace module-"))throw new Error(`Invalid Furnace file header: "${n}"`);const s=a.readUint16();a.skip(2);const r=a.readUint32();a.seek(r);const i={name:"",author:"",category:"",systemName:"",tuning:440,masterVol:1,version:s,systemLen:0,systems:[],systemChans:[],systemVol:[],systemPan:[],systemPanFR:[],chans:0,subsongs:[],instruments:[],wavetables:[],samples:[],patterns:new Map,comment:""};return s>=240?await async function(e,t,a){const n=e.readMagic(4);if("INF2"!==n)throw new Error(`Expected INF2 block, got: "${n}"`);if(e.readUint32(),t.name=FE(e),t.author=FE(e),t.systemName=FE(e),t.category=FE(e),FE(e),FE(e),FE(e),FE(e),t.tuning=e.readFloat32(),e.readUint8(),t.masterVol=e.readFloat32(),t.chans=e.readUint16(),t.systemLen=e.readUint16(),t.systemLen<1)throw new Error("Zero chips in module!");let s=0;for(let m=0;m<t.systemLen;m++){const a=e.readUint16();t.systems.push(a);const n=e.readUint16();t.systemChans.push(n),s+=n,t.systemVol.push(e.readFloat32()),t.systemPan.push(e.readFloat32()),t.systemPanFR.push(e.readFloat32())}t.chans!==s&&(t.chans=s);const r=e.readUint32();e.skip(4*r),e.readUint8();const i=[],o=[],l=[],c=[],u=[];let d=0,p=!0;for(;p;){switch(e.readUint8()){case 0:p=!1;break;case 1:{const t=e.readUint32();for(let a=0;a<t;a++)c.push(e.readUint32());break}case 2:{const t=e.readUint32();e.skip(4*t);break}case 3:{const t=e.readUint32();e.skip(4*t);break}case 4:{const t=e.readUint32();for(let a=0;a<t;a++)i.push(e.readUint32());break}case 5:{const t=e.readUint32();for(let a=0;a<t;a++)o.push(e.readUint32());break}case 6:{const t=e.readUint32();for(let a=0;a<t;a++)l.push(e.readUint32());break}case 7:{const t=e.readUint32();for(let a=0;a<t;a++)u.push(e.readUint32());break}case 8:e.readUint32(),e.readUint32();break;case 9:e.readUint32(),d=e.readUint32();break;case 10:{const t=e.readUint32();e.skip(4*t);break}default:{const t=e.readUint32();e.skip(4*t);break}}}for(const m of c){e.seek(m);const n=RE(e,t.chans,a);t.subsongs.push(n)}for(let m=0;m<i.length;m++){const a=i[m];e.seek(a);const n=e.getOffset(),s=jE(e),r=e.getOffset()-n;e.seek(n);const o=e.readBytes(r);s.rawBinaryData=o,t.instruments.push(s)}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],a=OE[e]??0;t.instruments.push({name:"Default",type:a,macros:[],samples:[],wavetables:[]})}for(const m of o){e.seek(m);const a=VE(e);t.wavetables.push(a)}for(const m of l){e.seek(m);const n=zE(e,a);t.samples.push(n)}for(const m of u){e.seek(m);const n=UE(e,t.chans,t.subsongs,a),s=`${n.subsong}_${n.channel}_${n.index}`;if(t.patterns.set(s,n),t.patterns.size<=3){if(n.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)){n.rows.findIndex(e=>e.note>=0||e.instrument>=0)}}}if(d>0){e.seek(d);"CMNT"===e.readMagic(4)&&(e.readUint32(),t.comment=FE(e))}}(a,i,s):await async function(e,t,a){const n=e.readMagic(4);if("INFO"!==n)throw new Error(`Expected INFO block, got: "${n}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8();const r=e.readUint16(),i=e.readUint16(),o=e.readUint16(),l=e.readUint32();const c=[];for(let y=0;y<32;y++){const t=e.readUint8();0!==t&&c.push(t)}t.systems=c.filter(e=>0!==e),t.systemLen=t.systems.length;for(let y=0;y<32;y++){const a=e.readInt8();y<t.systemLen&&t.systemVol.push(a/64)}for(let y=0;y<32;y++){const a=e.readInt8();y<t.systemLen&&t.systemPan.push(a/127)}e.skip(128);t.name=FE(e),t.author=FE(e),t.tuning=e.readFloat32(),e.skip(20);const u=[],d=[],p=[],m=[];for(let y=0;y<r;y++)u.push(e.readUint32());for(let y=0;y<i;y++)d.push(e.readUint32());for(let y=0;y<o;y++)p.push(e.readUint32());let h=0;for(const y of t.systems){const e=IE[y]||4;t.systemChans.push(e),h+=e}t.chans=h;for(let y=0;y<l;y++)m.push(e.readUint32());s.orders=[];for(let y=0;y<t.chans;y++){const t=[];for(let a=0;a<s.ordersLen;a++)t.push(e.readUint8());s.orders.push(t)}s.effectColumns=[];for(let y=0;y<t.chans;y++)s.effectColumns.push(e.readUint8());if(a>=39){e.skip(2*t.chans);for(let a=0;a<t.chans;a++)s.channelNames.push(FE(e));for(let a=0;a<t.chans;a++)s.channelShortNames.push(FE(e));t.comment=FE(e)}t.masterVol=a>=59?e.readFloat32():2;a>=70&&e.skip(28);a>=96?(s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16()):e.skip(4);if(a>=95){FE(e),FE(e);const t=e.readUint8();e.skip(3);for(let a=0;a<t;a++)e.readUint32()}a>=103&&(FE(e),FE(e),FE(e),FE(e),FE(e),FE(e));if(a>=135){for(let n=0;n<t.systems.length;n++)e.skip(12);const a=e.readUint32();e.skip(4*a)}a>=136&&e.readUint8();a>=138&&e.skip(8);if(a>=139){e.skip(17);const t=e.readUint8();for(let a=0;a<t;a++)e.skip(17)}a>=156&&e.skip(12);t.subsongs.push(s);for(let y=0;y<u.length;y++){const a=u[y];if(0===a)continue;e.seek(a);const n=e.getOffset();try{const a=jE(e),s=e.getOffset()-n;e.seek(n);const r=e.readBytes(s);a.rawBinaryData=r,t.instruments.push(a)}catch(f){t.instruments.push({name:"Error",type:0,macros:[],samples:[],wavetables:[]})}}if(0===t.instruments.length&&t.systems.length>0){const e=t.systems[0],a=OE[e]??0;t.instruments.push({name:"Default",type:a,macros:[],samples:[],wavetables:[]})}for(const y of d)if(0!==y){e.seek(y);try{const a=VE(e);t.wavetables.push(a)}catch(f){}}for(const y of p)if(0!==y){e.seek(y);try{const n=zE(e,a);t.samples.push(n)}catch(f){}}for(const y of m)if(0!==y){e.seek(y);try{const n=UE(e,t.chans,t.subsongs,a),s=`${n.subsong}_${n.channel}_${n.index}`;if(t.patterns.set(s,n),t.patterns.size<=3){n.rows.some(e=>e.note>=0||e.instrument>=0||e.effects.length>0)}}catch(f){}}}(a,i,s),i}function RE(e,t,a){const n=e.readMagic(4);if("SNG2"!==n&&"SONG"!==n)throw new Error(`Expected SNG2/SONG block, got: "${n}"`);e.readUint32();const s={name:"",comment:"",timeBase:0,speed1:6,speed2:6,arpLen:1,hz:60,patLen:64,ordersLen:1,hilightA:4,hilightB:16,virtualTempo:150,virtualTempoD:150,orders:[],effectColumns:[],channelNames:[],channelShortNames:[]};if("SNG2"===n){s.hz=e.readFloat32(),s.arpLen=e.readUint8(),e.readUint8(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16();const t=e.readUint8(),a=[];for(let n=0;n<16;n++)a.push(e.readUint16());s.speed1=a[0]||6,s.speed2=t>1?a[1]:s.speed1,s.name=FE(e),s.comment=FE(e)}else s.timeBase=e.readUint8(),s.speed1=e.readUint8(),s.speed2=e.readUint8(),s.arpLen=e.readUint8(),s.hz=e.readFloat32(),s.patLen=e.readUint16(),s.ordersLen=e.readUint16(),s.hilightA=e.readUint8(),s.hilightB=e.readUint8(),s.virtualTempo=e.readUint16(),s.virtualTempoD=e.readUint16(),s.name=FE(e),s.comment=FE(e);for(let r=0;r<t;r++){const t=[];for(let a=0;a<s.ordersLen;a++)t.push(e.readUint8());s.orders.push(t)}for(let r=0;r<t;r++)s.effectColumns.push(e.readUint8());e.skip(2*t);for(let r=0;r<t;r++)s.channelNames.push(FE(e));for(let r=0;r<t;r++)s.channelShortNames.push(FE(e));return a>=240&&e.skip(4*t),s}function jE(e){const t=e.readMagic(4),a={name:"",type:0,macros:[],samples:[],wavetables:[]};if("INS2"===t||"FINS"===t)for("INS2"===t&&e.readUint32(),e.readUint16(),a.type=e.readUint16();!e.isEOF();){const t=e.readMagic(2);if("EN"===t||"\0\0"===t)break;const n=e.readUint16(),s=e.getOffset()+n;switch(t){case"NA":a.name=FE(e);break;case"FM":a.fm=BE(e);break;case"MA":LE(e,a);break;case"SM":{const t=e.readInt16(),n=e.readUint8(),s=e.readUint8(),r=!!(1&n),i=!!(2&n),o=!!(4&n);if(t>=0&&a.samples.push(t),a.amiga={initSample:t,useNoteMap:r,useSample:i,useWave:o,waveLen:s},r){a.amiga.noteMap=[];const t=new Set(a.samples);for(let n=0;n<120;n++){const n=e.readInt16(),s=e.readInt16();a.amiga.noteMap.push({freq:n,map:s}),s>=0&&!t.has(s)&&(t.add(s),a.samples.push(s))}}break}case"SL":case"LS":{const n="LS"===t?e.readUint16():e.readUint8();for(let s=0;s<n;s++)"LS"===t?a.samples.push(e.readUint16()):a.samples.push(e.readUint8());break}case"WL":case"LW":{const n="LW"===t?e.readUint16():e.readUint8();for(let s=0;s<n;s++)"LW"===t?a.wavetables.push(e.readUint16()):a.wavetables.push(e.readUint8());break}case"GB":{const t=e.readUint8(),n=e.readUint8(),s=e.readUint8(),r=e.readUint8(),i=[];for(let a=0;a<r;a++)i.push({cmd:e.readUint8(),data:e.readInt16()});a.gb={envVol:15&t,envDir:16&t?1:0,envLen:t>>5&7,soundLen:n,softEnv:!!(1&s),alwaysInit:!!(2&s),doubleWave:!!(4&s),hwSeqLen:r,hwSeq:i};break}case"64":{const t=e.readUint8(),n=e.readUint8(),r=e.readUint8(),i=e.readUint8(),o=4095&e.readUint16(),l=e.readUint16();let c=l>>12,u=!1;if(e.getOffset()<s){const t=e.readUint8();c|=(15&t)<<4,u=!!(16&t)}a.c64={triOn:!!(1&t),sawOn:!!(2&t),pulseOn:!!(4&t),noiseOn:!!(8&t),toFilter:!!(16&t),initFilter:!!(64&t),dutyIsAbs:!!(128&t),lp:!!(1&n),bp:!!(4&n),hp:!!(2&n),ch3off:!!(8&n),filterIsAbs:!!(16&n),noTest:!!(32&n),ringMod:!!(64&n),oscSync:!!(128&n),a:r>>4&15,d:15&r,s:i>>4&15,r:15&i,duty:o,cut:4095&l,res:c,resetDuty:u};break}case"SN":{const t=e.readUint8(),n=e.readUint8(),r=e.readUint8(),i=e.readUint8();let o=8&r?1:0,l=0;if(e.getOffset()<s){const t=e.readUint8();o=t>>5&3,l=31&t}a.snes={a:15&t,d:t>>4&7,s:n>>5&7,r:31&n,useEnv:!!(16&r),sus:o,gainMode:7&r,gain:i,d2:l};break}case"N1":{const t=e.readInt32(),n=e.readUint8(),r=e.readUint8(),i=e.readUint8();let o=!1;if(e.getOffset()<s&&(o=0!==e.readUint8(),o)){for(let t=0;t<8;t++)e.readUint8();for(let t=0;t<8;t++)e.readUint8()}a.n163={wave:t,wavePos:n,waveLen:r,waveMode:i,perChanPos:o};break}case"FD":{const t=e.readInt32(),n=e.readInt32(),s=0!==e.readUint8(),r=[];for(let a=0;a<32;a++)r.push(e.readUint8());a.fds={modSpeed:t,modDepth:n,initModTableWithFirstWave:s,modTable:r};break}}e.seek(s)}else{if("INST"!==t)throw new Error(`Unknown instrument format: "${t}"`);e.readUint32(),e.readUint16(),a.type=e.readUint8(),e.readUint8(),a.name=FE(e),0!==a.type&&1!==a.type||(a.fm=function(e){const t={...An,operators:[],macros:[],opMacros:[],wavetables:[]};t.algorithm=7&e.readUint8(),t.feedback=7&e.readUint8(),t.fms=7&e.readUint8(),t.ams=3&e.readUint8();const a=e.readUint8();t.ops=a,t.opllPreset=31&e.readUint8(),e.skip(2);for(let n=0;n<4;n++){const s={enabled:n<a,am:0!==e.readUint8(),ar:e.readUint8(),dr:e.readUint8(),mult:e.readUint8(),rr:e.readUint8(),sl:e.readUint8(),tl:e.readUint8(),dt2:e.readUint8(),rs:e.readUint8(),dt:e.readInt8(),d2r:e.readUint8(),ssg:15&e.readUint8(),ksl:0,ksr:!1,sus:!1,vib:!1,ws:0};e.skip(10),t.operators.push(s)}return t}(e))}return a}function BE(e){const t={...An,operators:[],macros:[],opMacros:[],wavetables:[]},a=e.readUint8(),n=15&a,s=a>>4&15;t.ops=n;const r=e.readUint8();t.algorithm=r>>4&7,t.feedback=7&r;const i=e.readUint8();t.fms2=i>>5&7,t.ams=i>>3&3,t.fms=7&i;const o=e.readUint8();t.ams2=o>>6&3,t.opllPreset=31&o;for(let l=0;l<n;l++){const a=e.readUint8(),n=e.readUint8(),r=e.readUint8(),i=e.readUint8(),o=e.readUint8(),c=e.readUint8(),u=e.readUint8(),d=e.readUint8(),p={enabled:!!(s>>l&1),mult:15&a,dt:a>>4&7,ksr:!!(a>>7&1),tl:127&n,sus:!!(n>>7&1),ar:31&r,vib:!!(r>>5&1),rs:r>>6&3,dr:31&i,ksl:i>>5&3,am:!!(i>>7&1),egt:!!(o>>7&1),kvs:o>>5&3,d2r:31&o,sl:c>>4&15,rr:15&c,dvb:u>>4&15,ssg:15&u,dam:d>>5&7,dt2:d>>3&3,ws:7&d};t.operators.push(p)}return t}function LE(e,t){const a=e.readUint16(),n=e.getOffset()+a;for(;e.getOffset()<n;){const a=e.readUint8();if(255===a)break;const n={code:a,length:e.readUint8(),loop:e.readUint8(),release:e.readUint8(),mode:e.readUint8(),type:e.readUint8(),delay:e.readUint8(),speed:e.readUint8(),data:[]},s=n.type>>6&3;for(let t=0;t<n.length;t++)switch(s){case 0:n.data.push(e.readUint8());break;case 1:n.data.push(e.readInt8());break;case 2:n.data.push(e.readInt16());break;case 3:n.data.push(e.readInt32())}t.macros.push(n)}}function VE(e){const t=e.readMagic(4);if("WAVE"!==t)throw new Error(`Expected WAVE block, got: "${t}"`);e.readUint32();const a={name:FE(e),width:e.readUint32(),height:0,data:[]};e.readUint32(),a.height=e.readUint32();for(let n=0;n<a.width;n++)a.data.push(e.readInt32());return a}function zE(e,t){const a=e.readMagic(4),n={name:"",length:0,compatRate:0,c4Rate:0,depth:16,loopStart:-1,loopEnd:-1,loopDirection:0,data:new Int16Array(0)};if("SMP2"===a)if(e.readUint32(),n.name=FE(e),n.length=e.readUint32(),n.compatRate=e.readUint32(),n.c4Rate=e.readUint32(),n.depth=e.readUint8(),n.loopDirection=t>=123?e.readUint8():0,e.readUint8(),e.readUint8(),n.loopStart=e.readInt32(),n.loopEnd=e.readInt32(),e.skip(16),16===n.depth){const t=new Int16Array(n.length);for(let a=0;a<n.length;a++)t[a]=e.readInt16();n.data=t}else if(8===n.depth){const t=new Int8Array(n.length);for(let a=0;a<n.length;a++)t[a]=e.readInt8();n.data=t}else n.data=e.readBytes(n.length);else{if("SMPL"!==a)throw new Error(`Unknown sample format: "${a}"`);{e.readUint32(),n.name=FE(e),n.length=e.readUint32(),n.compatRate=e.readUint32(),t<58?(e.readUint16(),e.readUint16()):e.skip(4),n.depth=e.readUint8(),e.readUint8(),t>=32&&(n.c4Rate=e.readUint16()),t>=19&&(n.loopStart=e.readInt32());const a=t<58?2*n.length:n.length;if(16===n.depth){const t=new Int16Array(n.length);for(let a=0;a<n.length;a++)t[a]=e.readInt16();n.data=t}else{const t=new Int8Array(a);for(let n=0;n<a;n++)t[n]=e.readInt8();n.data=t}}}return n}function UE(e,t,a,n){const s=e.readMagic(4),r={subsong:0,channel:0,index:0,name:"",rows:[]};if("PATN"===s){e.readUint32(),r.subsong=e.readUint8(),r.channel=e.readUint8(),r.index=e.readUint16(),n>=51&&(r.name=FE(e));const t=a[r.subsong]||a[0],s=t?.patLen||64;t?.effectColumns[r.channel];for(let e=0;e<s;e++)r.rows.push({note:-1,octave:0,instrument:-1,volume:-1,effects:[]});let i=0;for(;i<s&&!e.isEOF();){const t=e.readUint8();if(255===t)break;if(128&t){i+=2+(127&t);continue}if(0===t){i++;continue}const a=r.rows[i],n=!!(1&t),s=!!(2&t),o=!!(4&t),l=!!(8&t),c=!!(16&t),u=!!(64&t);let d=0,p=0;if(!!(32&t)&&(d=e.readUint8()),u&&(p=e.readUint8()),n){const t=e.readUint8();t>=180?(a.note=t,a.octave=0):t<180&&(a.note=_E[t]||0,a.octave=TE[t]||0,a.octave>=250&&(a.octave=a.octave-256))}if(s&&(a.instrument=e.readUint8()),o&&(a.volume=e.readUint8()),l){const t=e.readUint8(),n=c?e.readUint8():0;a.effects.push({type:t,value:n})}else c&&e.readUint8();for(let r=1;r<=3;r++){const t=!!(d&1<<2*r+1);if(!!(d&1<<2*r)){const n=e.readUint8(),s=t?e.readUint8():0;a.effects.push({type:n,value:s})}else t&&e.readUint8()}for(let r=4;r<=7;r++){const t=!!(p&1<<2*(r-4)+1);if(!!(p&1<<2*(r-4))){const n=e.readUint8(),s=t?e.readUint8():0;a.effects.push({type:n,value:s})}else t&&e.readUint8()}i++}}else{if("PATR"!==s)throw new Error(`Unknown pattern format: "${s}"`);{e.readUint32(),r.channel=e.readUint16(),r.index=e.readUint16(),n>=95&&(r.subsong=e.readUint16()),e.skip(2);const t=a[r.subsong]||a[0],s=t?.patLen||64,i=t?.effectColumns[r.channel]||1;for(let a=0;a<s;a++){const t={note:e.readInt16(),octave:e.readInt16(),instrument:e.readInt16(),volume:e.readInt16(),effects:[]};0===t.note&&0===t.octave?t.note=-1:100===t.note?(t.note=180,t.octave=0):101===t.note?(t.note=181,t.octave=0):102===t.note?(t.note=182,t.octave=0):12===t.note?(t.note=12,t.octave++):t.note>=1&&t.note<=11&&t.octave>=128&&(t.octave=t.octave-256);for(let a=0;a<i;a++){const a=e.readInt16(),n=e.readInt16();a>=0&&t.effects.push({type:a,value:n>=0?n:0})}r.rows.push(t)}n>=51&&(r.name=FE(e))}}return r}function GE(e){const t=function(e){const t={2:[1,1,1,1,1,1,4,0,0,0,0]},a=[];let n=0;for(let s=0;s<e.systemLen;s++){const r=e.systems[s],i=e.systemChans[s]??0,o=t[r];if(o)for(let e=0;e<i;e++)a[n+e]=o[e]??0;else{const e=OE[r]??0;for(let t=0;t<i;t++)a[n+t]=e}n+=i}return a}(e),a=function(e){const t=[];let a=0;for(let n=0;n<e.systemLen;n++){const s=e.systems[n],r=e.systemChans[n]??0;for(let e=0;e<r;e++)t[a+e]=s;a+=r}return t}(e),n=function(e){const t=new Map,a=e.subsongs[0];if(!a)return t;for(let n=0;n<a.ordersLen;n++)for(let s=0;s<e.chans;s++){const r=`0_${s}_${a.orders[s]?.[n]??0}`,i=e.patterns.get(r);if(i)for(const e of i.rows)if(e.instrument>=0){let a=t.get(e.instrument);a||(a=new Set,t.set(e.instrument,a)),a.add(s)}}return t}(e),s=e.instruments.map((s,r)=>{const i=[];let o=(l=s.type,EE[l]||"ChipSynth");var l;if(0===s.type&&"ChipSynth"===o){const a=n.get(r);if(a&&a.size>0){const e=new Map;for(const r of a){const a=t[r];void 0!==a&&0!==a&&e.set(a,(e.get(a)||0)+1)}let n=0,s=0;for(const[t,a]of e)a>s&&(n=t,s=a);if(n>0){const e=EE[n];e&&(o=e)}}else if(e.systems.length>0){const t=e.systems[0],a=OE[t];if(void 0!==a&&0!==a){const e=EE[a];e&&(o=e)}}}if("FurnaceC64"===o){const t=n.get(r);let s=e.systems.length>0?e.systems[0]:0;if(t&&t.size>0){const e=t.values().next().value;void 0!==e&&void 0!==a[e]&&(s=a[e])}71===s||240===s?o="FurnaceSID6581":7===s&&(o="FurnaceSID8580")}const c="Sampler"===o||"Player"===o;if(s.samples&&s.samples.length>0){for(const t of s.samples)if(t<e.samples.length){const a=e.samples[t];i.push(HE(a,t))}}else if(c&&r<e.samples.length){const t=e.samples[r];i.push(HE(t,r))}const u=e.systems.length>0?e.systems[0]:0,d={chipType:AE[u]??s.type,synthType:o,macros:s.macros.map(e=>({code:e.code,type:e.code,data:[...e.data],loop:e.loop,release:e.release,speed:e.speed,mode:e.mode,delay:e.delay})),wavetables:s.wavetables.filter(t=>t<e.wavetables.length).map(t=>{const a=e.wavetables[t];return{id:t,data:[...a.data],len:a.width,max:a.height}})};s.fm&&(d.fm={algorithm:s.fm.algorithm,feedback:s.fm.feedback,fms:s.fm.fms,ams:s.fm.ams,ops:s.fm.ops,opllPreset:s.fm.opllPreset,operators:s.fm.operators.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2,rs:e.rs,am:e.am,ksr:e.ksr,ksl:e.ksl,sus:e.sus,vib:e.vib,ws:e.ws,ssg:e.ssg,egt:e.egt,kvs:e.kvs,dvb:e.dvb,dam:e.dam}))});const p={};return s.gb&&(p.gb=s.gb),s.c64&&(p.c64=s.c64),s.snes&&(p.snes=s.snes),s.n163&&(p.n163=s.n163),s.fds&&(p.fds=s.fds),Object.keys(p).length>0&&(d.chipConfig=p),{id:r+1,name:s.name||`Instrument ${r+1}`,samples:i,fadeout:0,volumeType:"none",panningType:"none",furnace:d,rawBinaryData:s.rawBinaryData}}),r=[],i=e.subsongs[0];if(!i)return{instruments:s,patterns:[],metadata:WE(e)};const o=[];for(let l=0;l<i.ordersLen;l++){const t=[];for(let a=0;a<i.patLen;a++){const n=[];for(let t=0;t<e.chans;t++){const s=`0_${t}_${i.orders[t]?.[l]??0}`,r=e.patterns.get(s);if(r&&r.rows[a]){const e=r.rows[a];e.note>=1&&e.note<=12&&0,e.effects.length>0&&e.effects.some(e=>e.type>=0)&&0;const s=KE(e);if(s.note>0&&s.note<97&&0,e.note>=1&&e.note<=12&&0===s.note&&o.length<5){const n=["?","C#","D","D#","E","F","F#","G","G#","A","A#","B","C"];o.push(`${n[e.note]||"?"}${e.octave} (ord=${l} ch=${t} row=${a})`)}n.push(s)}else 0===a&&0===l&&0,n.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0,effectType2:0,effectParam2:0})}t.push(n)}r.push(t)}r.filter(e=>e.some(e=>e.some(e=>e.note>0||e.instrument>0||e.effectType>0)));return o.length,{instruments:s,patterns:r,metadata:WE(e)}}function WE(e){const t=e.subsongs[0],a=t?.virtualTempo||150,n=t?.virtualTempoD||150,s=t?.hz||60,r=t?.speed1||6,i=Math.round(2.5*s*(a/n));return{sourceFormat:"XM",sourceFile:e.name||"Furnace Module",importedAt:(new Date).toISOString(),originalChannelCount:e.chans,originalPatternCount:e.patterns.size,originalInstrumentCount:e.instruments.length,modData:{moduleType:"FUR",initialSpeed:r,initialBPM:i,amigaPeriods:!1,channelNames:t?.channelNames||Array.from({length:e.chans},(e,t)=>`Ch ${t+1}`),songLength:t?.ordersLen||1,restartPosition:0,patternOrderTable:Array.from({length:t?.ordersLen||1},(e,t)=>t),songMessage:e.comment}}}function HE(e,t){let a;if(16===e.depth&&e.data instanceof Int16Array)a=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength);else if(e.data instanceof Int8Array){const t=new Int16Array(e.length);for(let a=0;a<e.length;a++)t[a]=256*e.data[a];a=t.buffer}else a=new ArrayBuffer(2*e.length);return{id:t,name:e.name,pcmData:a,loopStart:e.loopStart>=0?e.loopStart:0,loopLength:e.loopEnd>e.loopStart?e.loopEnd-e.loopStart:0,loopType:e.loopStart<0?"none":2===e.loopDirection?"pingpong":"forward",volume:64,finetune:0,relativeNote:0,panning:128,bitDepth:16,sampleRate:e.c4Rate||e.compatRate||22050,length:e.length}}function KE(e){let t=0;if(180===e.note||181===e.note||182===e.note)t=97;else if(e.note>=1&&e.note<=12){const a=12===e.note?0:e.note,n=12===e.note?e.octave+1:e.octave;t=12*(n<0?0:n)+a+1-24,t>96&&(t=96),t<1&&(t=0)}let a=0;e.volume>=0&&(a=16+Math.min(64,Math.floor(e.volume/2)));let n=0,s=0,r=0,i=0;if(e.effects.length>0){const t=e.effects[0];if(n=qE(t.type),s=255&t.value,n>=224&&n<=239){const e=15&n;n=14,s=e<<4|15&s}}if(e.effects.length>1){const t=e.effects[1];if(r=qE(t.type),i=255&t.value,r>=224&&r<=239){const e=15&r;r=14,i=e<<4|15&i}}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:a,effectType:n,effectParam:s,effectType2:r,effectParam2:i}}function qE(e){return{0:0,1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:8,9:15,10:10,11:11,12:233,13:13,15:15,16:16,17:17,128:8,129:8,130:8,131:25,132:25,136:8,137:8,138:8,144:9,145:9,146:9,147:9,148:9,149:9,150:9,151:9,152:9,153:9,154:9,155:9,156:9,157:9,158:9,159:9,192:15,193:15,194:15,195:15,211:10,212:10,220:236,224:0,225:225,226:226,227:228,228:4,229:0,230:3,231:0,232:3,233:3,234:0,235:0,236:236,237:237,238:0,240:15,241:225,242:226,243:234,244:235,245:0,246:0,247:0,248:234,249:235,250:10,252:236,253:15,254:15,255:0}[e]??e}const $E=Object.freeze(Object.defineProperty({__proto__:null,convertFurnaceToDevilbox:GE,parseFurnaceSong:DE},Symbol.toStringTag,{value:"Module"}));async function XE(e){return new Promise((t,a)=>{const n=new FileReader;n.onload=async n=>{const s=n.target?.result;if(!s)return void a(new Error("Failed to read file"));const r=e.name.toLowerCase().slice(e.name.lastIndexOf(".")),i=".xm"===r||".mod"===r||".fur"===r||".dmf"===r;try{if(i)try{const a=await async function(e,t){try{if(".xm"===t){const t=await eN(e);return{format:"XM",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".mod"===t){const t=await lN(e);return{format:"MOD",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".fur"===t){const t=GE(await DE(e));return{format:"FUR",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}if(".dmf"===t){const t=function(e){const t=e.instruments.map((e,t)=>({id:t+1,name:e.name||`Instrument ${t+1}`,samples:[],fadeout:0,volumeType:"none",panningType:"none"})),a=[];for(let i=0;i<e.matrixRows;i++){const t=[];for(let a=0;a<e.patternRows;a++){const n=[];for(let t=0;t<e.channelCount;t++){const s=e.patternMatrix[t]?.[i]||0,r=t*e.matrixRows+s,o=e.patterns[r],l=o?.rows?.[a]?.[t];l?n.push(t_(l)):n.push({note:0,instrument:0,volume:0,effectType:0,effectParam:0})}t.push(n)}a.push(t)}const n=60,s=Math.round(2.5*n/(e.timeBase+1)/e.ticksPerRow[0]*4),r={sourceFormat:"XM",sourceFile:e.name||"DefleMask Module",importedAt:(new Date).toISOString(),originalChannelCount:e.channelCount,originalPatternCount:a.length,originalInstrumentCount:e.instruments.length,modData:{moduleType:"DMF",initialSpeed:e.ticksPerRow[0],initialBPM:s>0?s:125,amigaPeriods:!1,channelNames:Array.from({length:e.channelCount},(e,t)=>`Ch ${t+1}`),songLength:e.matrixRows,restartPosition:0,patternOrderTable:Array.from({length:e.matrixRows},(e,t)=>t),songMessage:`${e.name} by ${e.author}`}};return{instruments:t,patterns:a,metadata:r}}(wv.parse(e,"dmf"));return{format:"DMF",importMetadata:t.metadata,instruments:t.instruments,patterns:t.patterns}}}catch(a){return null}return null}(s,r);if(a){const n={title:a.importMetadata.sourceFile,type:".fur"===r?"Furnace":".dmf"===r?"DefleMask":a.format,channels:a.importMetadata.originalChannelCount,patterns:a.importMetadata.originalPatternCount,orders:a.importMetadata.modData?.songLength||1,instruments:a.importMetadata.originalInstrumentCount,samples:a.importMetadata.originalInstrumentCount,duration:0,message:a.importMetadata.modData?.songMessage};let i;return".fur"!==r&&".dmf"!==r&&(i=await QE(s)),void t({metadata:n,arrayBuffer:s,player:i,file:e,nativeData:a})}}catch(o){if(".fur"===r||".dmf"===r)return void a(new Error(`Failed to parse ${r} file: ${o instanceof Error?o.message:"unknown error"}`))}const n=await QE(s),l=await new Promise((t,a)=>{const s=setTimeout(()=>{a(new Error("Timeout waiting for metadata"))},5e3);n.onMetadata(a=>{let n;clearTimeout(s),a.song&&(n={channels:a.song.channels||[],instruments:a.song.instruments||[],samples:a.song.samples||[],orders:a.song.orders||[],patterns:a.song.patterns||[],numSubsongs:a.song.numSubsongs||1}),t({title:a.title||e.name.replace(/\.[^/.]+$/,""),type:a.type||"Unknown",channels:a.song?.channels?.length||a.channels||4,patterns:a.song?.patterns?.length||a.totalPatterns||a.patterns||1,orders:a.song?.orders?.length||a.totalOrders||a.orders||1,instruments:a.song?.instruments?.length||a.instruments||0,samples:a.song?.samples?.length||a.samples||0,duration:a.dur||0,message:a.message,song:n})}),n.onError(e=>{clearTimeout(s),a(new Error(`Failed to load module: ${e.type||e.message||"unknown error"}`))})});t({metadata:l,arrayBuffer:s,player:n,file:e})}catch(l){a(l)}},n.onerror=()=>a(new Error("Failed to read file")),n.readAsArrayBuffer(e)})}async function YE(e){e.player&&await e.player.play(e.arrayBuffer)}function ZE(e){e.player&&e.player.stop()}async function QE(e){const t=new JM({repeatCount:0});if(!(await new Promise(e=>{const a=setTimeout(()=>{e(!1)},1e4);t.onInitialized(()=>{clearTimeout(a),e(!0)}),t.onError(t=>{"init"===t.type&&(clearTimeout(a),e(!1))})})))throw new Error("Module player not available. The audio worklet failed to load.");return await t.play(e),t.stop(),t}function JE(){return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"]}function e_(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].includes(t)}function t_(e){let t=0;if(100===e.note)t=97;else if(e.note>=0&&e.note<=11){t=12*Math.max(0,Math.min(7,e.octave))+e.note+1,t>96&&(t=96),t<1&&(t=0)}let a=0;e.volume>=0&&(a=16+Math.floor(4*e.volume));let n=0,s=0;if(e.effects.length>0){const t=e.effects[0];n={0:0,1:1,2:2,3:3,4:4,7:7,8:8,9:9,10:10,11:11,12:12,13:13,15:15,16:16,225:225,226:226,233:233,234:234,235:235,236:236,237:237}[t.code]??0,s=255&t.value}return{note:t,instrument:e.instrument>=0?e.instrument+1:0,volume:a,effectType:n,effectParam:s}}const a_=Object.freeze(Object.defineProperty({__proto__:null,getSupportedExtensions:JE,isSupportedModule:e_,loadModuleFile:XE,previewModule:YE,stopPreview:ZE},Symbol.toStringTag,{value:"Module"})),n_=({isOpen:e,onClose:t,onImport:a,initialFile:n})=>{const[r,i]=s.useState(null),[o,l]=s.useState(!1),[c,u]=s.useState(null),[d,p]=s.useState(!1),[m,h]=s.useState(!0),f=s.useRef(null),y=s.useCallback(async e=>{if(e_(e.name)){l(!0),u(null),i(null);try{const t=await XE(e);i(t)}catch(t){u(t instanceof Error?t.message:"Failed to load module")}finally{l(!1)}}else u(`Unsupported file format. Supported: ${[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].slice(0,5).join(", ")}...`)},[]);s.useEffect(()=>{n&&e&&y(n)},[n,e,y]);const g=s.useCallback(e=>{e.preventDefault();const t=e.dataTransfer.files[0];t&&y(t)},[y]),b=s.useCallback(e=>{e.preventDefault()},[]),v=s.useCallback(e=>{const t=e.target.files?.[0];t&&y(t)},[y]),x=s.useCallback(()=>{r&&(d?(ZE(r),p(!1)):(YE(r),p(!0)))},[r,d]),w=s.useCallback(()=>{r&&(d&&(ZE(r),p(!1)),a(r,{useLibopenmpt:m}),t())},[r,d,a,t,m]),k=s.useCallback(()=>{r&&d&&ZE(r),i(null),u(null),p(!1),t()},[r,d,t]);return e?Ea.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50",children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[480px] max-h-[80vh] overflow-hidden",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx(Ft,{size:18,className:"text-accent-primary"}),Ea.jsx("h2",{className:"text-sm font-semibold text-text-primary",children:"Import Tracker Module"})]}),Ea.jsx(qk,{variant:"icon",size:"icon",onClick:k,"aria-label":"Close dialog",children:Ea.jsx(Pe,{size:16})})]}),Ea.jsxs("div",{className:"p-4 space-y-4",children:[Ea.jsxs("div",{onDrop:g,onDragOver:b,onClick:()=>f.current?.click(),className:`\n              border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\n              ${o?"border-accent-primary/50 bg-accent-primary/5":"border-dark-border hover:border-accent-primary/50 hover:bg-dark-bgHover"}\n            `,children:[Ea.jsx("input",{ref:f,type:"file",accept:[".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack"].join(","),onChange:v,className:"hidden"}),o?Ea.jsxs("div",{className:"flex flex-col items-center gap-2",children:[Ea.jsx("div",{className:"w-8 h-8 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),Ea.jsx("p",{className:"text-sm text-text-muted",children:"Loading module..."})]}):Ea.jsxs("div",{className:"flex flex-col items-center gap-2",children:[Ea.jsx(Dt,{size:32,className:"text-text-muted"}),Ea.jsx("p",{className:"text-sm text-text-primary",children:"Drop a tracker file here or click to browse"}),Ea.jsx("p",{className:"text-xs text-text-muted",children:"Supports MOD, XM, IT, S3M and 20+ other formats"})]})]}),c&&Ea.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent-error/10 border border-accent-error/30 rounded text-sm text-accent-error",children:[Ea.jsx(Ie,{size:16}),c]}),r&&Ea.jsxs("div",{className:"bg-dark-bg rounded-lg p-4 space-y-3",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx(Te,{size:16,className:"text-accent-primary"}),Ea.jsx("span",{className:"font-medium text-text-primary",children:r.metadata.title})]}),Ea.jsx("span",{className:"text-xs px-2 py-0.5 bg-accent-primary/20 text-accent-primary rounded",children:r.metadata.type})]}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[Ea.jsxs("div",{className:"flex justify-between text-text-muted",children:[Ea.jsx("span",{children:"Channels:"}),Ea.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.channels})]}),Ea.jsxs("div",{className:"flex justify-between text-text-muted",children:[Ea.jsx("span",{children:"Patterns:"}),Ea.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.patterns})]}),Ea.jsxs("div",{className:"flex justify-between text-text-muted",children:[Ea.jsx("span",{children:"Instruments:"}),Ea.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.instruments})]}),Ea.jsxs("div",{className:"flex justify-between text-text-muted",children:[Ea.jsx("span",{children:"Samples:"}),Ea.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.samples})]}),Ea.jsxs("div",{className:"flex justify-between text-text-muted",children:[Ea.jsx("span",{children:"Orders:"}),Ea.jsx("span",{className:"text-text-primary font-mono",children:r.metadata.orders})]}),Ea.jsxs("div",{className:"flex justify-between text-text-muted",children:[Ea.jsx("span",{children:"Duration:"}),Ea.jsxs("span",{className:"text-text-primary font-mono",children:[Math.floor(r.metadata.duration/60),":",String(Math.floor(r.metadata.duration%60)).padStart(2,"0")]})]})]}),r.metadata.message&&Ea.jsx("div",{className:"text-xs text-text-muted bg-dark-bgSecondary p-2 rounded max-h-20 overflow-y-auto font-mono whitespace-pre-wrap",children:r.metadata.message}),Ea.jsx(qk,{variant:"ghost",fullWidth:!0,onClick:x,icon:d?Ea.jsx(Rt,{size:14}):Ea.jsx(jt,{size:14}),className:d?"text-red-400 hover:text-red-300":"text-green-400 hover:text-green-300",children:d?"Stop Preview":"Preview"})]}),r&&Ea.jsxs("div",{className:"bg-dark-bg rounded-lg p-3 space-y-2",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("input",{type:"checkbox",id:"useLibopenmpt",checked:m,onChange:e=>h(e.target.checked),className:"w-4 h-4 rounded border-dark-border bg-dark-bgSecondary accent-accent-primary"}),Ea.jsx("label",{htmlFor:"useLibopenmpt",className:"text-sm text-text-primary cursor-pointer",children:"Use libopenmpt for sample-accurate playback"})]}),Ea.jsxs("div",{className:"flex items-start gap-2 text-xs text-text-muted",children:[Ea.jsx(Bt,{size:12,className:"mt-0.5 flex-shrink-0"}),Ea.jsx("span",{children:"When enabled, uses libopenmpt WASM for authentic tracker effects (smooth vibrato, portamento). Editing will use Tone.js approximation."})]})]}),r&&!m&&Ea.jsx("p",{className:"text-xs text-text-muted",children:"Note: Importing will create patterns and sampler instruments from this module. Complex effects may not translate perfectly."})]}),Ea.jsxs("div",{className:"flex justify-end gap-2 px-4 py-3 border-t border-dark-border",children:[Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:k,children:"Cancel"}),Ea.jsx(qk,{variant:"primary",size:"sm",onClick:w,disabled:!r,children:"Import Module"})]})]})}):null},s_=({scope:e,onConfirm:t,onCancel:a})=>{const[n,r]=s.useState(1),i=()=>{t(n)};return Ea.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:a,children:Ea.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),i()):"Escape"===e.key&&(e.preventDefault(),a())},children:[Ea.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Scale Volume (",e,")"]}),Ea.jsxs("div",{className:"space-y-4",children:[Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Scale Factor"}),Ea.jsxs("div",{className:"flex items-center gap-4",children:[Ea.jsx("input",{type:"range",min:"0",max:"2",step:"0.05",value:n,onChange:e=>r(parseFloat(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),Ea.jsxs("span",{className:"text-neutral-100 font-mono text-sm w-20 text-right",children:[n.toFixed(2)," (",Math.round(100*n),"%)"]})]}),Ea.jsxs("div",{className:"flex justify-between text-xs text-neutral-500 mt-1",children:[Ea.jsx("span",{children:"0 (silence)"}),Ea.jsx("span",{children:"1 (unchanged)"}),Ea.jsx("span",{children:"2 (double)"})]})]}),Ea.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[Ea.jsxs("p",{className:"mb-1",children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Scale volume multiplies all volume values by the factor."]}),Ea.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[Ea.jsx("li",{children:"0.5 = half volume (50%)"}),Ea.jsx("li",{children:"1.0 = no change (100%)"}),Ea.jsx("li",{children:"2.0 = double volume (200%, clamped to max)"})]})]})]}),Ea.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[Ea.jsxs("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",Ea.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),Ea.jsxs("button",{onClick:i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",Ea.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},r_=({scope:e,onConfirm:t,onCancel:a})=>{const[n,r]=s.useState(64),[i,o]=s.useState(0),l=()=>{t(n,i)};return Ea.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:a,children:Ea.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),a())},children:[Ea.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Fade Volume (",e,")"]}),Ea.jsxs("div",{className:"space-y-4",children:[Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Start Volume"}),Ea.jsxs("div",{className:"flex items-center gap-4",children:[Ea.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:n,onChange:e=>r(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500",autoFocus:!0}),Ea.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:n.toString().padStart(2,"0")})]})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"End Volume"}),Ea.jsxs("div",{className:"flex items-center gap-4",children:[Ea.jsx("input",{type:"range",min:"0",max:"64",step:"1",value:i,onChange:e=>o(parseInt(e.target.value)),className:"flex-1 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),Ea.jsx("span",{className:"text-neutral-100 font-mono text-sm w-16 text-right",children:i.toString().padStart(2,"0")})]})]}),Ea.jsx("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3",children:Ea.jsxs("div",{className:"text-xs text-neutral-400 space-y-2",children:[Ea.jsxs("p",{children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Fade Direction:"})," ",n>i?Ea.jsx("span",{className:"text-red-400",children:"Fade out (loud  quiet)"}):n<i?Ea.jsx("span",{className:"text-green-400",children:"Fade in (quiet  loud)"}):Ea.jsx("span",{className:"text-neutral-400",children:"No change (flat)"})]}),Ea.jsxs("p",{children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Fade volume applies linear interpolation from start to end across all rows in the ",e,"."]})]})})]}),Ea.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[Ea.jsxs("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",Ea.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),Ea.jsxs("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors",children:["Apply ",Ea.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},i_=({scope:e,onConfirm:t,onCancel:a})=>{const[n,r]=s.useState(0),[i,o]=s.useState(0),l=()=>{t(n,i)};return Ea.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:a,children:Ea.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-xl p-6 min-w-[400px]",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),a())},children:[Ea.jsxs("h3",{className:"text-lg font-semibold mb-4 text-neutral-100",children:["Remap Instrument (",e,")"]}),Ea.jsxs("div",{className:"space-y-4",children:[Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Source Instrument"}),Ea.jsx("input",{type:"number",min:"0",max:"255",value:n,onChange:e=>r(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),Ea.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to find (0-255)"})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-sm font-medium text-neutral-300 mb-2",children:"Destination Instrument"}),Ea.jsx("input",{type:"number",min:"0",max:"255",value:i,onChange:e=>o(Math.max(0,Math.min(255,parseInt(e.target.value)||0))),className:"w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-neutral-100 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500"}),Ea.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Instrument ID to replace with (0-255)"})]}),Ea.jsxs("div",{className:"bg-neutral-800 border border-neutral-700 rounded p-3 text-xs text-neutral-400",children:[Ea.jsxs("p",{className:"mb-1",children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Tip:"})," Remap instrument replaces all occurrences of the source instrument ID with the destination ID."]}),Ea.jsxs("ul",{className:"list-disc list-inside space-y-0.5 ml-2",children:[Ea.jsxs("li",{children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Block:"})," Only in selected region"]}),Ea.jsxs("li",{children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Track:"})," Entire current channel"]}),Ea.jsxs("li",{children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Pattern:"})," Entire current pattern"]}),Ea.jsxs("li",{children:[Ea.jsx("strong",{className:"text-neutral-300",children:"Song:"})," All patterns"]})]})]}),n===i&&Ea.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 rounded p-3 text-xs text-yellow-300",children:" Source and destination are the same - no changes will be made."})]}),Ea.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[Ea.jsxs("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-neutral-300 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:["Cancel ",Ea.jsx("span",{className:"text-neutral-500",children:"(Esc)"})]}),Ea.jsxs("button",{onClick:l,disabled:n===i,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Remap ",Ea.jsx("span",{className:"opacity-75",children:"(Enter)"})]})]})]})})},o_=({onClose:e})=>{const t=ob(e=>e.patternOrder),a=ob(e=>e.currentPositionIndex),n=ob(e=>e.currentPatternIndex),r=ob(e=>e.addToOrder),i=ob(e=>e.removeFromOrder),o=ob(e=>e.duplicatePosition),l=ob(e=>e.clearOrder),c=ob(e=>e.reorderPositions),u=ob(e=>e.setCurrentPosition),[d,p]=s.useState(null),m=e=>{e.currentTarget.classList.remove("bg-accent-primary/20")},h=()=>{p(null),document.querySelectorAll(".bg-accent-primary\\/20").forEach(e=>{e.classList.remove("bg-accent-primary/20")})};return Ea.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl max-w-4xl w-full max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center justify-between bg-ft2-header",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-lg font-bold text-ft2-text",children:"Pattern Order"}),Ea.jsxs("span",{className:"text-sm text-ft2-textDim",children:["(",t.length," positions)"]})]}),Ea.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-dark-bgHover transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:Ea.jsx(Pe,{size:20})})]}),Ea.jsxs("div",{className:"px-4 py-3 border-b border-ft2-border flex items-center gap-2 bg-dark-bgTertiary",children:[Ea.jsxs("button",{onClick:()=>{r(n),px.success(`Added Pattern ${n.toString(16).padStart(2,"0").toUpperCase()}`,2e3)},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Add current pattern to order",children:[Ea.jsx($e,{size:14}),"Add Current Pattern"]}),Ea.jsxs("button",{onClick:()=>{confirm("Clear all positions? This will reset to just the first pattern.")&&(l(),px.info("Pattern order cleared",2e3))},className:"px-3 py-2 text-sm bg-dark-bgActive hover:bg-dark-bgHover text-ft2-text border border-ft2-border rounded flex items-center gap-2 transition-colors",title:"Clear all positions",children:[Ea.jsx(Re,{size:14}),"Clear All"]}),Ea.jsxs("div",{className:"ml-auto text-xs text-ft2-textDim",children:["Current Pattern: ",n.toString(16).padStart(2,"0").toUpperCase()]})]}),Ea.jsx("div",{className:"flex-1 overflow-y-auto p-4 bg-ft2-bg",children:Ea.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 lg:grid-cols-12 xl:grid-cols-16 gap-2",children:t.map((e,n)=>Ea.jsxs("div",{draggable:!0,onDragStart:e=>((e,t)=>{p(t),e.dataTransfer.effectAllowed="move"})(e,n),onDragOver:e=>((e,t)=>{e.preventDefault(),null!==d&&d!==t&&e.currentTarget.classList.add("bg-accent-primary/20")})(e,n),onDragLeave:m,onDrop:e=>((e,t)=>{e.preventDefault(),e.currentTarget.classList.remove("bg-accent-primary/20"),null!==d&&d!==t&&(c(d,t),p(null),px.success("Position reordered",2e3))})(e,n),onDragEnd:h,onClick:()=>u(n),onContextMenu:e=>{e.preventDefault(),e.shiftKey?(o(n),px.success("Position duplicated",2e3)):(e.ctrlKey||e.metaKey)&&(e=>{t.length>1?(i(e),px.info("Position removed",2e3)):px.warning("Cannot remove last position",2e3)})(n)},className:`\n                  relative px-3 py-2 rounded border cursor-pointer transition-all\n                  ${n===a?"bg-dark-bgActive border-accent-primary text-accent-primary font-bold":"bg-dark-bgTertiary border-dark-border text-text-secondary hover:bg-dark-bgHover hover:border-dark-borderLight"}\n                  ${d===n?"opacity-50":""}\n                `,title:`Position ${n.toString(16).padStart(2,"0").toUpperCase()}: Pattern ${e.toString(16).padStart(2,"0").toUpperCase()}\nClick to select\nShift+Click to duplicate\nCtrl+Click to remove\nDrag to reorder`,children:[Ea.jsx("div",{className:"text-xs text-center leading-none opacity-60",children:n.toString(16).padStart(2,"0").toUpperCase()}),Ea.jsx("div",{className:"text-lg text-center font-mono leading-none mt-1",children:e.toString(16).padStart(2,"0").toUpperCase()})]},`pos-${n}`))})}),Ea.jsxs("div",{className:"px-4 py-3 border-t border-ft2-border text-sm text-ft2-textDim bg-dark-bgTertiary",children:[Ea.jsx("strong",{children:"Controls:"})," Click: Select  Drag: Reorder  Shift+Click: Duplicate  Ctrl+Click: Remove"]})]})})},l_=({isOpen:e,onClose:t})=>{const{selection:a,strumSelection:n}=ob(),[r,i]=s.useState(1),[o,l]=s.useState("down");return Ea.jsxs(HM,{isOpen:e,onClose:t,size:"sm",theme:"modern",backdropOpacity:"medium",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Ea.jsx(KM,{title:"Strum / Arpeggiate",icon:Ea.jsx(Te,{size:18}),onClose:t,theme:"modern"}),Ea.jsxs("div",{className:"p-4 space-y-4",children:[Ea.jsx("div",{className:"text-xs text-text-secondary",children:"Add incremental note delays (EDx) across channels to create a strum or arpeggio effect."}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Ticks per channel (1-15)"}),Ea.jsx("input",{type:"number",value:r,onChange:e=>i(Math.max(1,Math.min(15,parseInt(e.target.value)||1))),min:1,max:15,className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary font-mono focus:outline-none focus:border-accent-primary"})]}),Ea.jsxs("div",{children:[Ea.jsx("label",{className:"block text-xs text-text-muted mb-1",children:"Direction"}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Ea.jsx("button",{onClick:()=>l("down"),className:"px-3 py-2 text-xs rounded border transition-colors "+("down"===o?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Down (left to right)"}),Ea.jsx("button",{onClick:()=>l("up"),className:"px-3 py-2 text-xs rounded border transition-colors "+("up"===o?"bg-accent-primary border-accent-primary text-white":"bg-dark-bg border-dark-border text-text-secondary hover:border-text-muted"),children:"Up (right to left)"})]})]}),!a&&Ea.jsx("p",{className:"text-xs text-accent-warning",children:"No selection active. Use Alt+Arrow keys to select a region."})]}),Ea.jsxs(qM,{theme:"modern",align:"right",children:[Ea.jsx(qk,{variant:"ghost",onClick:t,children:"Cancel"}),Ea.jsx(qk,{variant:"primary",onClick:()=>{a?(n(r,o),t()):alert("Please select a region first (Alt+Arrow keys to select)")},disabled:!a,children:"Apply"})]})]})},c_=()=>{const e=ob(e=>e.macroSlots),t=ob(e=>e.writeMacroSlot),a=ob(e=>e.readMacroSlot),n=e=>null==e?"..":"string"==typeof e?e:e.toString(16).padStart(2,"0").toUpperCase();return Ea.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg p-4",children:[Ea.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ea.jsx("h4",{className:"text-sm font-semibold text-neutral-100",children:"Macro Slots"}),Ea.jsx("span",{className:"text-xs text-neutral-500",children:"FT2-Style Quick Entry"})]}),Ea.jsx("div",{className:"space-y-2",children:e.map((e,s)=>{const r=0===e.note&&0===e.instrument&&0===e.volume&&0===e.effTyp&&0===e.eff&&0===e.effTyp2&&0===e.eff2;return Ea.jsxs("div",{className:"flex items-center gap-2 p-2 bg-neutral-800 border border-neutral-700 rounded hover:bg-neutral-750 transition-colors",children:[Ea.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-neutral-700 border border-neutral-600 rounded text-xs font-bold text-neutral-300",children:s+1}),Ea.jsxs("div",{className:"flex-1 font-mono text-xs text-neutral-300 flex items-center gap-1",children:[Ea.jsx("span",{className:e.note?"text-blue-400":"text-neutral-600",children:e.note||"..."}),Ea.jsx("span",{className:null!==e.instrument?"text-green-400":"text-neutral-600",children:n(e.instrument)}),Ea.jsx("span",{className:null!==e.volume?"text-yellow-400":"text-neutral-600",children:n(e.volume)}),Ea.jsx("span",{className:0!==e.effTyp||0!==e.eff?"text-purple-400":"text-neutral-600",children:0!==e.effTyp||0!==e.eff?`${e.effTyp.toString(16).toUpperCase()}${e.eff.toString(16).padStart(2,"0").toUpperCase()}`:"..."}),Ea.jsx("span",{className:0!==e.effTyp2||0!==e.eff2?"text-pink-400":"text-neutral-600",children:0!==e.effTyp2||0!==e.eff2?`${e.effTyp2.toString(16).toUpperCase()}${e.eff2.toString(16).padStart(2,"0").toUpperCase()}`:"..."})]}),Ea.jsxs("div",{className:"flex gap-1",children:[Ea.jsx("button",{onClick:()=>t(s),className:"px-2 py-1 text-xs font-medium text-neutral-300 bg-neutral-700 border border-neutral-600 rounded hover:bg-neutral-600 transition-colors",title:`Write current cell to slot ${s+1} (Ctrl+Shift+${s+1})`,children:"Write"}),Ea.jsx("button",{onClick:()=>a(s),disabled:r,className:"px-2 py-1 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:`Paste macro slot ${s+1} (Ctrl+${s+1})`,children:"Read"})]})]},s)})}),Ea.jsxs("div",{className:"mt-4 p-3 bg-neutral-800/50 border border-neutral-700 rounded text-xs text-neutral-400",children:[Ea.jsx("div",{className:"font-semibold text-neutral-300 mb-2",children:"Keyboard Shortcuts:"}),Ea.jsxs("div",{className:"space-y-1",children:[Ea.jsxs("div",{className:"flex justify-between",children:[Ea.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+1-8"}),Ea.jsx("span",{children:"Read macro slot 1-8"})]}),Ea.jsxs("div",{className:"flex justify-between",children:[Ea.jsx("kbd",{className:"px-1.5 py-0.5 bg-neutral-700 border border-neutral-600 rounded font-mono text-neutral-300",children:"Ctrl+Shift+1-8"}),Ea.jsx("span",{children:"Write current cell to slot 1-8"})]})]}),Ea.jsx("p",{className:"mt-2 text-neutral-500",children:"Macros store cell data for quick entry. Perfect for repeated patterns!"})]})]})},u_=({onClose:e,onShowScaleVolume:t,onShowFadeVolume:a,onShowRemapInstrument:n,onExportPattern:r,onExportTrack:i,onReverse:o,onExpand:l,onShrink:c,onDuplicate:u,onMath:d})=>{const{selection:p}=ob(),[m,h]=s.useState("macros"),[f,y]=s.useState(1),[g,b]=s.useState("volume"),v=null!==p,x=e=>{h(m===e?null:e)};return Ea.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4",onClick:e,children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border-2 border-ft2-border rounded-lg shadow-2xl w-full max-w-2xl flex flex-col max-h-[80vh]",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-ft2-border bg-ft2-header",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx(_e,{size:18,className:"text-accent-primary"}),Ea.jsx("h2",{className:"text-lg font-bold text-ft2-text",children:"FT2 Advanced Edit"})]}),Ea.jsx("button",{onClick:e,className:"p-1 hover:bg-dark-bgHover rounded transition-colors text-ft2-textDim hover:text-ft2-text",title:"Close",children:Ea.jsx(Pe,{size:20})})]}),Ea.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-dark-bg",children:[Ea.jsxs("div",{className:"border border-ft2-border rounded",children:[Ea.jsxs("button",{onClick:()=>x("volume"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Ea.jsx("span",{children:"Volume Operations"}),Ea.jsx("span",{children:"volume"===m?"":""})]}),"volume"===m&&Ea.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Ea.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform volume values across selection, track, or pattern"}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Ea.jsx("button",{onClick:()=>t?.("block"),disabled:!v,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Scale Block"}),Ea.jsx("button",{onClick:()=>a?.("block"),disabled:!v,className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Fade Block"}),Ea.jsx("button",{onClick:()=>t?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Track"}),Ea.jsx("button",{onClick:()=>a?.("track"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Track"}),Ea.jsx("button",{onClick:()=>t?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Scale Pattern"}),Ea.jsx("button",{onClick:()=>a?.("pattern"),className:"px-3 py-1.5 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors",children:"Fade Pattern"})]})]})]}),Ea.jsxs("div",{className:"border border-ft2-border rounded",children:[Ea.jsxs("button",{onClick:()=>x("blockops"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Ea.jsxs("span",{className:"flex items-center gap-2",children:[Ea.jsx(ze,{size:14}),"Block Operations"]}),Ea.jsx("span",{children:"blockops"===m?"":""})]}),"blockops"===m&&Ea.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Ea.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Transform selected block content"}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Ea.jsxs("button",{onClick:o,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Ea.jsx(ze,{size:12}),"Reverse"]}),Ea.jsxs("button",{onClick:u,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Ea.jsx(ut,{size:12}),"Duplicate"]}),Ea.jsxs("button",{onClick:l,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Ea.jsx(Lt,{size:12}),"Expand 2x"]}),Ea.jsxs("button",{onClick:c,disabled:!v,className:"px-3 py-1.5 text-xs bg-orange-600 hover:bg-orange-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-1",children:[Ea.jsx(Vt,{size:12}),"Shrink 2x"]})]}),Ea.jsxs("div",{className:"mt-3 pt-2 border-t border-ft2-border",children:[Ea.jsxs("div",{className:"text-xs text-ft2-textDim mb-2 flex items-center gap-1",children:[Ea.jsx(zt,{size:12}),"Math Operations"]}),Ea.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[Ea.jsxs("select",{value:g,onChange:e=>b(e.target.value),className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text",children:[Ea.jsx("option",{value:"volume",children:"Volume"}),Ea.jsx("option",{value:"eff",children:"Effect"})]}),Ea.jsx("input",{type:"number",value:f,onChange:e=>{const t=Number(e.target.value);isNaN(t)||y(Math.max(0,Math.min(255,t)))},className:"bg-dark-bg border border-ft2-border rounded px-2 py-1 text-xs text-ft2-text w-16",min:0,max:255})]}),Ea.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[Ea.jsx("button",{onClick:()=>d?.("add",f,g),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"+"}),Ea.jsx("button",{onClick:()=>d?.("sub",f,g),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),Ea.jsx("button",{onClick:()=>d?.("mul",f,g),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""}),Ea.jsx("button",{onClick:()=>d?.("div",f,g),disabled:!v,className:"px-2 py-1 text-xs bg-teal-600 hover:bg-teal-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:""})]})]}),Ea.jsx("div",{className:"text-[10px] text-ft2-textDim mt-1",children:"Alt+R = Reverse | Alt+D = Duplicate"})]})]}),Ea.jsxs("div",{className:"border border-ft2-border rounded",children:[Ea.jsxs("button",{onClick:()=>x("remap"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Ea.jsxs("span",{className:"flex items-center gap-2",children:[Ea.jsx(_t,{size:14}),"Instrument Remap"]}),Ea.jsx("span",{children:"remap"===m?"":""})]}),"remap"===m&&Ea.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Ea.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Find and replace instrument IDs"}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Ea.jsx("button",{onClick:()=>n?.("block"),disabled:!v,className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:"Remap Block"}),Ea.jsx("button",{onClick:()=>n?.("track"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Track"}),Ea.jsx("button",{onClick:()=>n?.("pattern"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Pattern"}),Ea.jsx("button",{onClick:()=>n?.("song"),className:"px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors",children:"Remap Song"})]})]})]}),Ea.jsxs("div",{className:"border border-ft2-border rounded",children:[Ea.jsxs("button",{onClick:()=>x("export"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Ea.jsxs("span",{className:"flex items-center gap-2",children:[Ea.jsx(Ge,{size:14}),"Export/Import"]}),Ea.jsx("span",{children:"export"===m?"":""})]}),"export"===m&&Ea.jsxs("div",{className:"p-3 space-y-2 bg-dark-bgSecondary",children:[Ea.jsx("div",{className:"text-xs text-ft2-textDim mb-2",children:"Export patterns and tracks as FT2-compatible files"}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Ea.jsxs("button",{onClick:r,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[Ea.jsx(Ge,{size:12}),"Pattern (.xp)"]}),Ea.jsxs("button",{onClick:i,className:"px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded flex items-center justify-center gap-1 transition-colors",children:[Ea.jsx(Ge,{size:12}),"Track (.xt)"]})]}),Ea.jsx("div",{className:"text-xs text-ft2-textDim mt-2",children:"Import: Use File  Open Module"})]})]}),Ea.jsxs("div",{className:"border border-ft2-border rounded",children:[Ea.jsxs("button",{onClick:()=>x("macros"),className:"w-full px-3 py-2 bg-dark-bgTertiary hover:bg-dark-bgHover text-left text-sm font-medium text-ft2-text flex items-center justify-between transition-colors",children:[Ea.jsx("span",{children:"Macro Slots"}),Ea.jsx("span",{children:"macros"===m?"":""})]}),"macros"===m&&Ea.jsx("div",{className:"p-3 bg-dark-bgSecondary",children:Ea.jsx(c_,{})})]})]})]})})},d_=[{title:"Navigation",shortcuts:[{keys:"Arrow Up/Down",action:"Move cursor up/down"},{keys:"Arrow Left/Right",action:"Move cursor left/right"},{keys:"Tab / Shift+Tab",action:"Next/prev channel"},{keys:"PageUp / PageDown",action:"Jump 16 rows"},{keys:"Home / End",action:"Jump to first/last row"},{keys:"F9-F12",action:"Jump to 0%/25%/50%/75%"},{keys:"Shift+Arrow L/R",action:"Prev/next pattern"},{keys:"Alt+Q-I",action:"Jump to tracks 0-7"},{keys:"Alt+A-K",action:"Jump to tracks 8-15"}]},{title:"Playback",shortcuts:[{keys:"Space",action:"Stop / toggle edit mode"},{keys:"Right Shift",action:"Record + play pattern"},{keys:"Right Ctrl",action:"Play song"},{keys:"Right Alt",action:"Play pattern"},{keys:"Ctrl+Enter",action:"Play song"}]},{title:"Note Entry",shortcuts:[{keys:"Z-M (bottom row)",action:"Notes C-B (lower octave)"},{keys:"Q-P (top row)",action:"Notes C-E (upper octave)"},{keys:"F1-F7",action:"Select octave 1-7"},{keys:"Numpad +/-",action:"Octave up/down"},{keys:"CapsLock",action:"Note off"},{keys:"` / ~",action:"Edit step +1 / -1"}]},{title:"Editing",shortcuts:[{keys:"Delete",action:"Delete at cursor"},{keys:"Shift+Delete",action:"Delete entire cell"},{keys:"Backspace",action:"Delete previous & move up"},{keys:"Insert",action:"Insert row / toggle insert mode"},{keys:"Shift+Insert",action:"Insert entire line"}]},{title:"Block Operations",shortcuts:[{keys:"Alt+B / Alt+E",action:"Mark block start/end"},{keys:"Ctrl+C / Ctrl+X",action:"Copy / Cut"},{keys:"Ctrl+V",action:"Paste"},{keys:"Ctrl+Shift+V",action:"Mix paste (fill empty)"},{keys:"Ctrl+Shift+F",action:"Flood paste (to end)"},{keys:"F3 / F4 / F5",action:"Cut / Copy / Paste (FT2)"},{keys:"Alt+Arrow keys",action:"Extend selection"}]},{title:"Transpose",shortcuts:[{keys:"Ctrl+Up/Down",action:"Transpose 1 semitone"},{keys:"Ctrl+Shift+Up/Down",action:"Transpose 1 octave"},{keys:"Alt+T / Alt+Shift+T",action:"Block transpose 1"}]},{title:"Macros & Dialogs",shortcuts:[{keys:"Ctrl+1-8",action:"Recall macro slot"},{keys:"Ctrl+Shift+1-8",action:"Save macro slot"},{keys:"Ctrl+I",action:"Interpolate"},{keys:"Ctrl+H",action:"Humanize"},{keys:"Ctrl+F",action:"Find & Replace"},{keys:"Ctrl+O",action:"Import module"},{keys:"?",action:"This shortcut sheet"}]},{title:"Effect Commands",shortcuts:[{keys:"0xy",action:"Arpeggio"},{keys:"1/2xx",action:"Pitch slide up/down"},{keys:"3xx",action:"Tone portamento"},{keys:"4xy",action:"Vibrato"},{keys:"Axy",action:"Volume slide"},{keys:"Cxx",action:"Set volume (00-40)"},{keys:"Fxx",action:"Speed (01-1F) / BPM (20-FF)"},{keys:"Exy",action:"Extended commands"}]}],p_=({isOpen:e,onClose:t})=>{const a=s.useRef(null),[n,r]=s.useState("");if(s.useEffect(()=>{if(!e)return;const a=e=>{"Escape"===e.key&&(e.preventDefault(),t())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[e,t]),!e)return null;const i=n.toLowerCase(),o=d_.map(e=>({...e,shortcuts:e.shortcuts.filter(e=>e.keys.toLowerCase().includes(i)||e.action.toLowerCase().includes(i))})).filter(e=>e.shortcuts.length>0);return Ea.jsx("div",{ref:a,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",onClick:t,children:Ea.jsxs("div",{className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[720px] max-w-[90vw] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-neutral-700",children:[Ea.jsx("h2",{className:"text-lg font-semibold text-neutral-100",children:"Keyboard Shortcuts"}),Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsx("input",{type:"text",placeholder:"Filter...",value:n,onChange:e=>r(e.target.value),className:"bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 w-32 focus:outline-none focus:border-blue-500",autoFocus:!0,"aria-label":"Filter keyboard shortcuts"}),Ea.jsx("button",{onClick:t,className:"text-neutral-400 hover:text-neutral-200 transition-colors",children:Ea.jsx(Pe,{size:18})})]})]}),Ea.jsx("div",{className:"overflow-y-auto p-5",children:Ea.jsx("div",{className:"grid grid-cols-2 gap-4",children:o.map(e=>Ea.jsxs("div",{className:"space-y-1",children:[Ea.jsx("h3",{className:"text-xs font-bold text-blue-400 uppercase tracking-wide mb-2",children:e.title}),e.shortcuts.map((t,a)=>Ea.jsxs("div",{className:"flex items-center justify-between gap-2 py-0.5",children:[Ea.jsx("kbd",{className:"text-[10px] font-mono bg-neutral-800 border border-neutral-600 rounded px-1.5 py-0.5 text-yellow-300 whitespace-nowrap",children:t.keys}),Ea.jsx("span",{className:"text-[11px] text-neutral-300 text-right",children:t.action})]},`${e.title}-${a}`))]},e.title))})}),Ea.jsxs("div",{className:"px-5 py-2 border-t border-neutral-700 text-[10px] text-neutral-500 text-center",children:["Press ",Ea.jsx("kbd",{className:"bg-neutral-800 border border-neutral-600 rounded px-1 text-yellow-400",children:"Esc"})," to close"," "," | Ctrl/Cmd shown as Ctrl (use Cmd on macOS)"]})]})})},m_={0:{command:"0xy",name:"Arpeggio",description:"Rapidly cycle between note, note+x semitones, note+y semitones",parameters:"x=1st offset (0-F hex), y=2nd offset (0-F hex)",tick:"tick-N",category:"misc"},1:{command:"1xx",name:"Pitch Slide Up",description:"Slide pitch upward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},2:{command:"2xx",name:"Pitch Slide Down",description:"Slide pitch downward continuously",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},3:{command:"3xx",name:"Tone Portamento",description:"Slide pitch toward target note",parameters:"xx=speed (01-FF hex, 00=use last)",tick:"tick-N",category:"pitch"},4:{command:"4xy",name:"Vibrato",description:"Oscillate pitch up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"pitch"},5:{command:"5xy",name:"Tone Porta + Vol Slide",description:"Continue tone portamento while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},6:{command:"6xy",name:"Vibrato + Vol Slide",description:"Continue vibrato while sliding volume",parameters:"x=vol slide up speed, y=vol slide down speed",tick:"both",category:"pitch"},7:{command:"7xy",name:"Tremolo",description:"Oscillate volume up/down",parameters:"x=speed (0-F hex), y=depth (0-F hex)",tick:"tick-N",category:"volume"},8:{command:"8xx",name:"Set Panning",description:"Set channel panning position",parameters:"xx=position (00=left, 80=center, FF=right)",tick:"tick-0",category:"panning"},9:{command:"9xx",name:"Sample Offset",description:"Start sample playback at offset",parameters:"xx=offset (multiply by 256 samples)",tick:"tick-0",category:"sample"},A:{command:"Axy",name:"Volume Slide",description:"Slide volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"volume"},B:{command:"Bxx",name:"Position Jump",description:"Jump to pattern in order list",parameters:"xx=position (00-FF hex)",tick:"tick-0",category:"global"},C:{command:"Cxx",name:"Set Volume",description:"Set channel volume directly",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"volume"},D:{command:"Dxx",name:"Pattern Break",description:"Break pattern and jump to row in next pattern",parameters:"xx=row (00-3F hex, 0-63 decimal)",tick:"tick-0",category:"global"},E:{command:"Exy",name:"Extended Command",description:"Extended effects (see E-commands)",parameters:"x=sub-command (0-F), y=parameter",tick:"both",category:"misc"},F:{command:"Fxx",name:"Set Speed/BPM",description:"Set speed (01-1F) or BPM (20-FF)",parameters:"xx=speed/BPM (01-1F=speed, 20-FF=BPM)",tick:"tick-0",category:"global"},G:{command:"Gxx",name:"Set Global Volume",description:"Set global volume for all channels",parameters:"xx=volume (00-40 hex, 64 decimal)",tick:"tick-0",category:"global"},H:{command:"Hxy",name:"Global Volume Slide",description:"Slide global volume up or down",parameters:"x=slide up speed, y=slide down speed",tick:"tick-N",category:"global"}},h_={E0:{command:"E0x",name:"Set Filter (Amiga)",description:"Enable/disable Amiga LED filter",parameters:"x=0 (filter on) or 1 (filter off)",tick:"tick-0",category:"misc"},E1:{command:"E1x",name:"Fine Pitch Slide Up",description:"Slide pitch up once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E2:{command:"E2x",name:"Fine Pitch Slide Down",description:"Slide pitch down once at tick 0",parameters:"x=fine slide value (1-F hex)",tick:"tick-0",category:"pitch"},E3:{command:"E3x",name:"Glissando Control",description:"Enable/disable glissando (semitone portamento)",parameters:"x=0 (off) or 1 (on)",tick:"tick-0",category:"pitch"},E4:{command:"E4x",name:"Set Vibrato Waveform",description:"Set vibrato waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"pitch"},E5:{command:"E5x",name:"Set Finetune",description:"Set sample finetune",parameters:"x=finetune (-8 to +7, stored as 0-F)",tick:"tick-0",category:"sample"},E6:{command:"E6x",name:"Pattern Loop",description:"Loop pattern section",parameters:"x=0 (set loop start) or 1-F (loop count)",tick:"tick-0",category:"global"},E7:{command:"E7x",name:"Set Tremolo Waveform",description:"Set tremolo waveform type",parameters:"x=waveform (0=sine, 1=ramp down, 2=square, 3=random)",tick:"tick-0",category:"volume"},E8:{command:"E8x",name:"Set Panning (Fine)",description:"Set panning with fine control",parameters:"x=panning (0=left, 8=center, F=right)",tick:"tick-0",category:"panning"},E9:{command:"E9x",name:"Retrigger Note",description:"Retrigger note every x ticks",parameters:"x=retrigger rate (1-F ticks)",tick:"tick-N",category:"timing"},EA:{command:"EAx",name:"Fine Volume Slide Up",description:"Slide volume up once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EB:{command:"EBx",name:"Fine Volume Slide Down",description:"Slide volume down once at tick 0",parameters:"x=fine volume value (1-F hex)",tick:"tick-0",category:"volume"},EC:{command:"ECx",name:"Note Cut",description:"Cut note (set volume to 0) at tick x",parameters:"x=tick to cut (0=immediate, 1-F=delayed)",tick:"both",category:"timing"},ED:{command:"EDx",name:"Note Delay",description:"Delay note trigger by x ticks",parameters:"x=delay in ticks (0-F)",tick:"tick-N",category:"timing"},EE:{command:"EEx",name:"Pattern Delay",description:"Delay pattern by x rows",parameters:"x=rows to delay (0-F)",tick:"tick-0",category:"global"},EF:{command:"EFx",name:"Funk Repeat (Invert Loop)",description:"Invert sample loop at speed x (Amiga)",parameters:"x=invert speed (0-F)",tick:"tick-N",category:"sample"}},f_={10:{command:"10xx",name:"Set LFO Speed",description:"Set the LFO speed for FM chip vibrato/tremolo",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set TL (Total Level)",description:"Set operator total level (volume)",parameters:"xx=TL value (00-7F, lower=louder)",tick:"tick-0",category:"volume"},12:{command:"12xx",name:"Set AR (Attack Rate)",description:"Set operator attack rate",parameters:"xx=AR value (00-1F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set DR (Decay Rate)",description:"Set operator decay rate",parameters:"xx=DR value (00-1F)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set MULT (Multiplier)",description:"Set operator frequency multiplier",parameters:"xx=MULT value (00-0F)",tick:"tick-0",category:"pitch"},15:{command:"15xx",name:"Set RR (Release Rate)",description:"Set operator release rate",parameters:"xx=RR value (00-0F)",tick:"tick-0",category:"misc"},16:{command:"16xx",name:"Set SL (Sustain Level)",description:"Set operator sustain level",parameters:"xx=SL value (00-0F)",tick:"tick-0",category:"volume"},17:{command:"17xx",name:"Set DT (Detune)",description:"Set operator detune",parameters:"xx=DT value (00-07)",tick:"tick-0",category:"pitch"},18:{command:"18xx",name:"Set SSG-EG",description:"Set SSG envelope generator mode",parameters:"xx=SSG-EG mode (00-0F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"Set Algorithm",description:"Set FM algorithm (operator routing)",parameters:"xx=algorithm (00-07)",tick:"tick-0",category:"misc"},"1A":{command:"1Axx",name:"Set Feedback",description:"Set operator 1 feedback level",parameters:"xx=feedback (00-07)",tick:"tick-0",category:"misc"},"1B":{command:"1Bxy",name:"Set AM/PM Depth",description:"Set amplitude/phase modulation depth",parameters:"x=AM depth (0-3), y=PM depth (0-7)",tick:"tick-0",category:"misc"},"1C":{command:"1Cxx",name:"FM Hard Reset",description:"Force hard reset on note (key-off before key-on)",parameters:"xx=01 (enable), 00 (disable)",tick:"tick-0",category:"misc"}},y_={10:{command:"10xx",name:"Set Filter Cutoff",description:"Set SID filter cutoff frequency",parameters:"xx=cutoff (00-FF, 11-bit scaled)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Filter Resonance",description:"Set SID filter resonance",parameters:"xx=resonance (00-0F)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Filter Mode",description:"Set SID filter mode",parameters:"xx: 0=off, 1=LP, 2=BP, 4=HP (can combine)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Ring Mod",description:"Enable/disable ring modulation",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Hard Sync",description:"Enable/disable oscillator hard sync",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pulse Width",description:"Set pulse wave width",parameters:"xx=pulse width (00-FF, scaled to 12-bit)",tick:"tick-0",category:"misc"}},g_={11:{command:"11xx",name:"Set DMC",description:"Set DMC sample parameters",parameters:"xx=DMC control value",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty/Noise",description:"Set pulse duty or noise mode",parameters:"xx: pulse 0-3=duty, noise 0=short 1=long",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (pulse channels)",parameters:"x=period, y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Envelope Mode",description:"Set envelope/length counter mode",parameters:"xx=envelope settings",tick:"tick-0",category:"misc"},18:{command:"18xx",name:"FDS Mod Depth",description:"Set FDS modulation depth",parameters:"xx=mod depth (00-3F)",tick:"tick-0",category:"misc"},19:{command:"19xx",name:"FDS Mod Speed High",description:"Set FDS modulation speed (high byte)",parameters:"xx=speed high byte",tick:"tick-0",category:"misc"}},b_={10:{command:"10xx",name:"Set Envelope Shape",description:"Set AY envelope shape",parameters:"xx=shape (00-0F)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Envelope Period Low",description:"Set AY envelope period (low byte)",parameters:"xx=period low byte",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Envelope Period High",description:"Set AY envelope period (high byte)",parameters:"xx=period high byte",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Auto-Envelope",description:"Enable auto-envelope (track note pitch)",parameters:"xx=auto-envelope numerator",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Noise Freq",description:"Set noise frequency",parameters:"xx=noise period (00-1F)",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Noise Mode",description:"Set noise/tone mixing mode",parameters:"xx=mode bits (tone/noise enable)",tick:"tick-0",category:"misc"}},v_={10:{command:"10xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Wave Position",description:"Set wave position in RAM",parameters:"xx=position (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave Length",description:"Set wave length",parameters:"xx=length (must be power of 2)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Wave Load",description:"Load wave from position",parameters:"xx=load parameters",tick:"tick-0",category:"misc"},14:{command:"14xx",name:"Set Channel Limit",description:"Set max active channels (N163)",parameters:"xx=channel count (1-8)",tick:"tick-0",category:"misc"}},x_={10:{command:"10xx",name:"Set Sample Mode",description:"Set sample playback mode",parameters:"xx=mode (chip-specific)",tick:"tick-0",category:"sample"},11:{command:"11xx",name:"Set Sample Bank",description:"Set sample bank",parameters:"xx=bank number",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Direction",description:"Set sample playback direction",parameters:"xx: 0=forward, 1=reverse",tick:"tick-0",category:"sample"},20:{command:"20xx",name:"ES5506 Filter Mode",description:"Set ES5506 filter mode",parameters:"xx=filter mode (00-03)",tick:"tick-0",category:"misc"},21:{command:"21xx",name:"ES5506 Filter K1",description:"Set ES5506 filter K1 coefficient",parameters:"xx=K1 value",tick:"tick-0",category:"misc"},22:{command:"22xx",name:"ES5506 Filter K2",description:"Set ES5506 filter K2 coefficient",parameters:"xx=K2 value",tick:"tick-0",category:"misc"},30:{command:"30xx",name:"QSound Echo",description:"Set QSound echo feedback",parameters:"xx=echo feedback",tick:"tick-0",category:"misc"},31:{command:"31xx",name:"QSound Surround",description:"Set QSound surround/3D position",parameters:"xx=surround position",tick:"tick-0",category:"panning"}},w_={FurnaceOPN:f_,FurnaceOPN2:f_,FurnaceOPM:f_,FurnaceOPL:f_,FurnaceOPL2:f_,FurnaceOPL3:f_,FurnaceOPLL:f_,FurnaceOPZ:f_,FurnaceESFM:f_,FurnaceC64:y_,FurnaceSID2:y_,FurnaceSID3:y_,FurnaceGB:{10:{command:"10xx",name:"Set Envelope",description:"Set volume envelope (NRx2 register)",parameters:"xx: high nibble=volume, low nibble=direction+period",tick:"tick-0",category:"volume"},11:{command:"11xx",name:"Set Wave",description:"Load wavetable into wave channel",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"},12:{command:"12xx",name:"Set Duty",description:"Set pulse wave duty cycle",parameters:"xx: 0=12.5%, 1=25%, 2=50%, 3=75%",tick:"tick-0",category:"misc"},13:{command:"13xy",name:"Set Sweep",description:"Set frequency sweep (channel 1 only)",parameters:"x=period (0-7), y=direction+shift",tick:"tick-0",category:"pitch"},14:{command:"14xx",name:"Set Noise Mode",description:"Set noise channel width mode",parameters:"xx: 0=15-bit (normal), 1=7-bit (metallic)",tick:"tick-0",category:"misc"}},FurnaceNES:g_,FurnaceFDS:g_,FurnaceVRC6:g_,Furnace5E01:g_,FurnacePCE:{10:{command:"10xx",name:"Set LFO Mode",description:"Set PCE LFO mode",parameters:"xx=LFO mode (00-03)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set LFO Speed",description:"Set PCE LFO speed",parameters:"xx=LFO speed (00-FF)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Wave",description:"Load wavetable",parameters:"xx=wavetable index (00-FF)",tick:"tick-0",category:"sample"}},FurnaceAY:b_,FurnaceAY8930:b_,FurnaceSAA:b_,FurnaceSMS:b_,FurnaceT6W28:b_,FurnaceN163:v_,FurnaceSCC:v_,FurnaceVB:v_,FurnaceSWAN:v_,FurnaceX1_010:v_,FurnaceSNES:{10:{command:"10xx",name:"Set Echo Enable",description:"Enable/disable echo for channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"misc"},11:{command:"11xx",name:"Set Echo Delay",description:"Set echo delay time",parameters:"xx=delay (00-0F, 16ms steps)",tick:"tick-0",category:"misc"},12:{command:"12xx",name:"Set Echo Feedback",description:"Set echo feedback amount",parameters:"xx=feedback (-80 to 7F)",tick:"tick-0",category:"misc"},13:{command:"13xx",name:"Set Echo Volume",description:"Set echo volume",parameters:"xx=volume (-80 to 7F)",tick:"tick-0",category:"volume"},14:{command:"14xx",name:"Set Echo FIR",description:"Set echo FIR filter coefficient",parameters:"xx=coefficient index and value",tick:"tick-0",category:"misc"},15:{command:"15xx",name:"Set Pitch Mod",description:"Enable pitch modulation from prev channel",parameters:"xx=01 (on), 00 (off)",tick:"tick-0",category:"pitch"},16:{command:"16xx",name:"Set Gain Mode",description:"Set ADSR/gain mode",parameters:"xx=gain mode (see SNES docs)",tick:"tick-0",category:"misc"},17:{command:"17xx",name:"Set Invert",description:"Invert waveform phase",parameters:"xx: 1=left, 2=right, 3=both",tick:"tick-0",category:"misc"}},FurnaceAmiga:x_,FurnaceSEGAPCM:x_,FurnaceQSOUND:x_,FurnaceES5506:x_,FurnaceRF5C68:x_,FurnaceC140:x_,FurnaceC219:x_,FurnaceK054539:x_,FurnaceYMZ280B:x_,FurnaceGA20:x_,FurnaceK007232:x_,FurnaceK053260:x_,FurnaceOKI:x_};const k_={pitch:"Pitch",volume:"Volume",panning:"Panning",timing:"Timing",global:"Global",sample:"Sample",misc:"Misc",chip:"Chip"},S_=["pitch","volume","panning","timing","global","sample","misc"],M_={pitch:"text-blue-400",volume:"text-emerald-400",panning:"text-purple-400",timing:"text-yellow-400",global:"text-red-400",sample:"text-cyan-400",misc:"text-orange-400",chip:"text-pink-400"},N_=({isOpen:e,position:t,onSelect:a,onClose:n,synthType:r})=>{const[i,o]=s.useState(""),[l,c]=s.useState("all"),u=s.useRef(null),d=s.useRef(null);s.useEffect(()=>{e&&d.current&&d.current.focus()},[e]),s.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&(e.preventDefault(),n())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e,n]);const p=r&&function(e){return e.startsWith("Furnace")||e in w_}(r),m=s.useMemo(()=>{const e=[];if(Object.entries(m_).forEach(([t,a])=>{e.push({...a,key:t,isExtended:!1,isFurnace:!1})}),Object.entries(h_).forEach(([t,a])=>{e.push({...a,key:t,isExtended:!0,isFurnace:!1})}),p&&r){const t=function(e){return e&&w_[e]?Object.values(w_[e]):Object.values(f_)}(r);t.forEach(t=>{const a=t.command.substring(0,2);e.push({...t,key:a,isExtended:!1,isFurnace:!0,category:"misc"})})}return e},[p,r]),h=s.useMemo(()=>{const e=i.toLowerCase();return m.filter(t=>{if("chip"===l){if(!t.isFurnace)return!1}else if("all"!==l){if(t.isFurnace)return!1;if(t.category!==l)return!1}return!i||(t.name.toLowerCase().includes(e)||t.command.toLowerCase().includes(e)||t.description.toLowerCase().includes(e))})},[m,i,l]);if(!e)return null;const f=t?{position:"fixed",left:Math.max(0,Math.min(t.x,window.innerWidth-400)),top:Math.max(0,Math.min(t.y,window.innerHeight-500)),zIndex:60}:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:60};return Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("div",{className:"fixed inset-0 bg-black/40 z-50",onClick:n}),Ea.jsxs("div",{ref:u,className:"bg-neutral-900 border border-neutral-700 rounded-lg shadow-2xl w-[380px] max-h-[480px] flex flex-col z-[60]",style:f,children:[Ea.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[Ea.jsx("h3",{className:"text-sm font-semibold text-neutral-100",children:"Effect Commands"}),Ea.jsx("button",{onClick:n,className:"text-neutral-400 hover:text-neutral-200","aria-label":"Close effect picker",children:Ea.jsx(Pe,{size:16})})]}),Ea.jsx("div",{className:"px-3 py-2 border-b border-neutral-800",children:Ea.jsx("input",{ref:d,type:"text",placeholder:"Search effects...",value:i,onChange:e=>o(e.target.value),className:"w-full bg-neutral-800 border border-neutral-600 rounded px-2 py-1 text-xs text-neutral-200 focus:outline-none focus:border-blue-500","aria-label":"Search effects"})}),Ea.jsxs("div",{className:"flex flex-wrap gap-1 px-3 py-1.5 border-b border-neutral-800",children:[Ea.jsx("button",{onClick:()=>c("all"),className:"px-2 py-0.5 text-[10px] rounded "+("all"===l?"bg-neutral-700 text-white":"text-neutral-400 hover:text-neutral-200"),children:"All"}),S_.map(e=>Ea.jsx("button",{onClick:()=>c(e),className:"px-2 py-0.5 text-[10px] rounded "+(l===e?"bg-neutral-700 text-white":`${M_[e]} hover:opacity-80`),children:k_[e]},e)),p&&Ea.jsxs("button",{onClick:()=>c("chip"),className:"px-2 py-0.5 text-[10px] rounded "+("chip"===l?"bg-pink-700 text-white":`${M_.chip} hover:opacity-80`),children:[k_.chip," (",r?.replace("Furnace",""),")"]})]}),Ea.jsx("div",{className:"overflow-y-auto flex-1 p-1",children:0===h.length?Ea.jsx("div",{className:"text-center text-neutral-500 text-xs py-4",children:"No effects match"}):h.map(e=>{const t=e.isFurnace?M_.chip:M_[e.category];return Ea.jsxs("button",{onClick:()=>(e=>{if(e.isExtended){const t=parseInt(e.key.substring(1),16);a(14,t<<4)}else if(e.isFurnace){const t=parseInt(e.key,16);a(t,0)}else{const t=parseInt(e.key,16);a(t,0)}n()})(e),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded hover:bg-neutral-800 transition-colors text-left group",children:[Ea.jsx("span",{className:`font-mono text-xs font-bold w-8 ${t}`,children:e.command.substring(0,3)}),Ea.jsxs("div",{className:"flex-1 min-w-0",children:[Ea.jsxs("div",{className:"text-xs text-neutral-200 truncate",children:[e.name,e.isFurnace&&Ea.jsx("span",{className:"ml-1 text-[9px] text-pink-400",children:"(Chip)"})]}),Ea.jsx("div",{className:"text-[10px] text-neutral-500 truncate",children:e.description})]}),Ea.jsx("span",{className:"text-[9px] text-neutral-600 group-hover:text-neutral-400",children:"tick-0"===e.tick?"T0":"tick-N"===e.tick?"TN":"T*"})]},e.isFurnace?`f-${e.key}`:e.isExtended?`e-${e.key}`:`n-${e.key}`)})})]})]})},C_={"text-blue-400":"bg-blue-400","text-green-400":"bg-green-400","text-yellow-400":"bg-yellow-400","text-red-400":"bg-red-400","text-purple-400":"bg-purple-400","text-orange-400":"bg-orange-400","text-cyan-400":"bg-cyan-400","text-neutral-400":"bg-neutral-400"},P_=e=>C_[e]||"bg-neutral-400",E_=({isOpen:e,onClose:t})=>{const{undoStack:a,redoStack:n,undo:s,redo:r}=Qv();if(!e)return null;const i=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return Ea.jsxs("div",{className:"absolute right-0 top-0 w-64 h-full bg-neutral-900 border-l border-neutral-700 flex flex-col z-30 shadow-xl",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx(Ut,{size:14,className:"text-neutral-400"}),Ea.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"History"})]}),Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsx("button",{onClick:s,disabled:0===a.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Undo","aria-label":"Undo",children:Ea.jsx(Gt,{size:12,className:"text-neutral-400"})}),Ea.jsx("button",{onClick:r,disabled:0===n.length,className:"p-1 rounded hover:bg-neutral-800 disabled:opacity-30 transition-colors",title:"Redo","aria-label":"Redo",children:Ea.jsx(Wt,{size:12,className:"text-neutral-400"})}),Ea.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors text-xs","aria-label":"Close history panel",children:"x"})]})]}),Ea.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n.length>0&&Ea.jsxs("div",{className:"opacity-40",children:[Ea.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Redo (",n.length,")"]}),[...n].reverse().map((e,t)=>Ea.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>r(),title:"Redo one step",children:[Ea.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${P_(ex(e.type))}`}),Ea.jsx("div",{className:"flex-1 min-w-0",children:Ea.jsx("div",{className:"text-[10px] text-neutral-400 truncate",children:Jv(e.type)})}),Ea.jsx("span",{className:"text-[9px] text-neutral-600",children:i(e.timestamp)})]},`redo-${e.id}-${t}`))]}),Ea.jsx("div",{className:"px-3 py-1 bg-blue-900/30 border-y border-blue-800/50",children:Ea.jsx("span",{className:"text-[10px] text-blue-400 font-medium",children:"Current State"})}),a.length>0?Ea.jsxs("div",{children:[Ea.jsxs("div",{className:"px-3 py-1 text-[9px] text-neutral-500 uppercase tracking-wider",children:["Undo (",a.length,")"]}),[...a].reverse().map((e,t)=>Ea.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-neutral-800/50 cursor-pointer",onClick:()=>s(),title:"Undo one step",children:[Ea.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${P_(ex(e.type))}`}),Ea.jsxs("div",{className:"flex-1 min-w-0",children:[Ea.jsx("div",{className:"text-[10px] text-neutral-300 truncate",children:Jv(e.type)}),e.description&&Ea.jsx("div",{className:"text-[9px] text-neutral-500 truncate",children:e.description})]}),Ea.jsx("span",{className:"text-[9px] text-neutral-600",children:i(e.timestamp)})]},`undo-${e.id}-${t}`))]}):Ea.jsx("div",{className:"text-center text-neutral-600 text-xs py-8",children:"No history yet"})]}),Ea.jsx("div",{className:"px-3 py-1.5 border-t border-neutral-700 text-[9px] text-neutral-600 text-center",children:"Ctrl+Z undo | Ctrl+Y redo"})]})},__=({isOpen:e,onClose:t})=>{const{patterns:a,patternOrder:n,currentPositionIndex:r,setCurrentPosition:i,addToOrder:o,removeFromOrder:l}=ob(Ua(e=>({patterns:e.patterns,patternOrder:e.patternOrder,currentPositionIndex:e.currentPositionIndex,setCurrentPosition:e.setCurrentPosition,addToOrder:e.addToOrder,removeFromOrder:e.removeFromOrder}))),c=s.useCallback(e=>{i(e)},[i]),u=s.useCallback(()=>{o(0)},[o]),d=s.useCallback(e=>{n.length>1&&l(e)},[l,n.length]),p=s.useCallback((e,t)=>{ob.setState(a=>{const n=[...a.patternOrder];return n[e]=t,{patternOrder:n}})},[]);return e?Ea.jsxs("div",{className:"absolute left-0 top-0 w-56 h-full bg-neutral-900 border-r border-neutral-700 flex flex-col z-30 shadow-xl",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-neutral-700",children:[Ea.jsx("span",{className:"text-xs font-semibold text-neutral-200",children:"Pattern Matrix"}),Ea.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-neutral-800 text-neutral-500 hover:text-neutral-300 transition-colors",children:Ea.jsx(Pe,{size:14})})]}),Ea.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:Ea.jsxs("table",{className:"w-full border-collapse",children:[Ea.jsx("thead",{children:Ea.jsxs("tr",{children:[Ea.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pos"}),Ea.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-left",children:"Pattern"}),Ea.jsx("th",{className:"text-[9px] text-neutral-500 font-normal px-1 py-0.5 text-right",children:"Len"}),Ea.jsx("th",{className:"w-6"})]})}),Ea.jsx("tbody",{children:n.map((e,t)=>{const s=t===r,i=a[e];return Ea.jsxs("tr",{className:"cursor-pointer transition-colors "+(s?"bg-blue-900/40 text-blue-300":"hover:bg-neutral-800 text-neutral-300"),onClick:()=>c(t),children:[Ea.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-neutral-500",children:t.toString(16).toUpperCase().padStart(2,"0")}),Ea.jsx("td",{className:"px-1 py-0.5",children:Ea.jsx("select",{value:e,onChange:e=>{e.stopPropagation(),p(t,parseInt(e.target.value))},onClick:e=>e.stopPropagation(),className:"w-full bg-transparent text-[10px] font-mono cursor-pointer focus:outline-none "+(s?"text-blue-300":"text-neutral-300"),children:a.map((e,t)=>Ea.jsxs("option",{value:t,className:"bg-neutral-900 text-neutral-200",children:[t.toString(16).toUpperCase().padStart(2,"0"),a[t]?.name?` ${a[t].name}`:""]},t))})}),Ea.jsx("td",{className:"text-[10px] font-mono px-1 py-0.5 text-right text-neutral-500",children:i?.length||"?"}),Ea.jsx("td",{className:"px-0.5 py-0.5",children:Ea.jsx("button",{onClick:e=>{e.stopPropagation(),d(t)},className:"p-0.5 rounded hover:bg-red-900/50 text-neutral-600 hover:text-red-400 transition-colors",title:"Remove position",disabled:n.length<=1,children:Ea.jsx(Pe,{size:10})})})]},t)})})]})}),Ea.jsxs("div",{className:"px-3 py-2 border-t border-neutral-700 flex items-center justify-between",children:[Ea.jsxs("span",{className:"text-[9px] text-neutral-500",children:[n.length," positions | ",a.length," patterns"]}),Ea.jsxs("button",{onClick:u,className:"flex items-center gap-1 px-2 py-1 text-[10px] bg-neutral-800 hover:bg-neutral-700 text-neutral-300 rounded transition-colors",children:[Ea.jsx($e,{size:10}),"Add"]})]})]}):null},T_=({label:e,value:t,onChange:a,min:n=0,max:r=999,step:i=1,format:o="decimal",throttleMs:l=0,presets:c})=>{const u=s.useRef(null),d=s.useRef(null),p=s.useRef(t),m=s.useRef(0),h=s.useRef(null),[f,y]=s.useState(!1),[g,b]=s.useState({x:0,y:0});s.useEffect(()=>{p.current=t},[t]),s.useEffect(()=>()=>{u.current&&clearInterval(u.current),d.current&&clearTimeout(d.current)},[]),s.useEffect(()=>{if(!f)return;const e=e=>{h.current&&!h.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]);const v=s.useCallback(e=>{c&&0!==c.length&&(e.preventDefault(),b({x:e.clientX,y:e.clientY}),y(!0))},[c]),x=s.useCallback(e=>{a(e),y(!1)},[a]),w=s.useCallback(e=>{const t=Date.now();l>0&&t-m.current<l||(m.current=t,a(e))},[a,l]),k=s.useCallback(()=>{const e=Math.min(r,p.current+i);p.current=e,w(e)},[r,i,w]),S=s.useCallback(()=>{const e=Math.max(n,p.current-i);p.current=e,w(e)},[n,i,w]),M=s.useCallback(e=>{e(),d.current&&clearTimeout(d.current),u.current&&clearInterval(u.current),d.current=window.setTimeout(()=>{u.current=window.setInterval(e,80)},300)},[]),N=s.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),u.current&&(clearInterval(u.current),u.current=null)},[]);return Ea.jsxs("div",{ref:h,className:"ft2-numeric-group",onContextMenu:v,title:c?"Right-click for presets":void 0,children:[Ea.jsxs("span",{className:"ft2-numeric-label",children:[e,":"]}),Ea.jsx("span",{className:"ft2-numeric-value",children:(C=t,"hex"===o?C.toString(16).toUpperCase().padStart(2,"0"):C.toString().padStart(3,"0"))}),Ea.jsxs("div",{className:"ft2-numeric-arrows",children:[Ea.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>M(k),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(k),onTouchEnd:N,title:`Increase ${e}`,children:Ea.jsx("span",{className:"ft2-arrow-icon",children:""})}),Ea.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>M(S),onMouseUp:N,onMouseLeave:N,onTouchStart:()=>M(S),onTouchEnd:N,title:`Decrease ${e}`,children:Ea.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),f&&c&&Ea.jsx("div",{className:"ft2-presets-menu",style:{position:"fixed",left:g.x,top:g.y,zIndex:1e3,backgroundColor:"#1a1a1d",border:"1px solid #333",borderRadius:"4px",padding:"4px 0",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",minWidth:"100px"},children:c.map(e=>Ea.jsx("button",{onClick:()=>x(e.value),className:"ft2-preset-item",style:{display:"block",width:"100%",padding:"6px 12px",textAlign:"left",background:t===e.value?"#333":"transparent",border:"none",color:t===e.value?"#ef4444":"#e0e0e0",cursor:"pointer",fontSize:"12px",fontFamily:"monospace"},onMouseEnter:e=>e.currentTarget.style.background="#2a2a2d",onMouseLeave:a=>a.currentTarget.style.background=t===e.value?"#333":"transparent",children:e.label},e.value))})]});var C},A_={TB303:{type:"TB303",name:"TB-303",shortName:"303",description:"Classic acid bass synthesizer with resonant filter and slide",bestFor:["Acid bass","Squelchy lines","Techno","House"],icon:"Zap",color:"text-accent-primary"},MonoSynth:{type:"MonoSynth",name:"Mono Synth",shortName:"Mono",description:"Single-voice synth with oscillator, filter, and envelope",bestFor:["Bass","Lead lines","Portamento"],icon:"AudioLines",color:"text-blue-400"},Synth:{type:"Synth",name:"Basic Synth",shortName:"Synth",description:"Simple polyphonic synthesizer with amplitude envelope",bestFor:["Pads","Chords","Simple sounds"],icon:"Music2",color:"text-purple-400"},DuoSynth:{type:"DuoSynth",name:"Duo Synth",shortName:"Duo",description:"Two-voice synth with harmonics and vibratoesque LFO",bestFor:["Rich leads","Detuned sounds","Fat bass"],icon:"Layers",color:"text-indigo-400"},FMSynth:{type:"FMSynth",name:"FM Synth",shortName:"FM",description:"Frequency modulation synth for complex harmonic tones",bestFor:["Bells","Electric piano","Metallic sounds"],icon:"Radio",color:"text-cyan-400"},AMSynth:{type:"AMSynth",name:"AM Synth",shortName:"AM",description:"Amplitude modulation synth with ring modulation character",bestFor:["Tremolo effects","Ring mod","Atmospheric"],icon:"Activity",color:"text-teal-400"},PluckSynth:{type:"PluckSynth",name:"Pluck Synth",shortName:"Pluck",description:"Karplus-Strong string synthesis for plucked strings",bestFor:["Guitar","Harp","Pizzicato","String plucks"],icon:"Guitar",color:"text-amber-400"},MembraneSynth:{type:"MembraneSynth",name:"Membrane Synth",shortName:"Membrane",description:"Drum membrane simulation for kicks and toms",bestFor:["Kick drums","Toms","Percussion"],icon:"Circle",color:"text-orange-400"},MetalSynth:{type:"MetalSynth",name:"Metal Synth",shortName:"Metal",description:"Metallic percussion synthesis with harmonics",bestFor:["Hi-hats","Cymbals","Bells","Metallic hits"],icon:"Hexagon",color:"text-yellow-400"},NoiseSynth:{type:"NoiseSynth",name:"Noise Synth",shortName:"Noise",description:"Filtered noise generator with envelope",bestFor:["Snares","Hi-hats","Risers","FX"],icon:"Hash",color:"text-gray-400"},Wavetable:{type:"Wavetable",name:"Wavetable",shortName:"Wave",description:"Wavetable synth with morphing and unison",bestFor:["Evolving pads","Modern bass","Complex timbres"],icon:"Waves",color:"text-pink-400"},HarmonicSynth:{type:"HarmonicSynth",name:"Harmonic Synth",shortName:"Harmonic",description:"Additive/spectral synth with 32-harmonic editor",bestFor:["Organ tones","Bells","Custom timbres","Spectral design"],icon:"BarChart3",color:"text-emerald-400"},Sampler:{type:"Sampler",name:"Sampler",shortName:"Sampler",description:"Multi-sample playback with velocity layers",bestFor:["Realistic instruments","Sample kits","One-shots"],icon:"FileAudio",color:"text-rose-400"},Player:{type:"Player",name:"Sample Player",shortName:"Player",description:"Simple one-shot sample playback",bestFor:["Loops","One-shots","Vocal samples"],icon:"Play",color:"text-lime-400"},GranularSynth:{type:"GranularSynth",name:"Granular Synth",shortName:"Granular",description:"Sample-based granular synthesis with grain manipulation",bestFor:["Textures","Pads","Ambient","Sound design","Glitch"],icon:"Sparkles",color:"text-violet-400"},SuperSaw:{type:"SuperSaw",name:"SuperSaw",shortName:"SSaw",description:"Massive detuned saw waves for trance and EDM",bestFor:["Trance leads","EDM drops","Big chords","Supersaw stabs"],icon:"Layers",color:"text-orange-500"},PolySynth:{type:"PolySynth",name:"Poly Synth",shortName:"Poly",description:"True polyphonic synth with voice management",bestFor:["Chords","Pads","Polyphonic parts","Layered sounds"],icon:"LayoutGrid",color:"text-blue-500"},Organ:{type:"Organ",name:"Drawbar Organ",shortName:"Organ",description:"Hammond-style tonewheel organ with drawbars",bestFor:["House","Gospel","Jazz","Rock organ"],icon:"Piano",color:"text-amber-600"},DrumMachine:{type:"DrumMachine",name:"Roland TR-808/909",shortName:"808/909",description:"Analog drum synthesis (808/909 style)",bestFor:["Kicks","Snares","Hi-hats","Electronic drums"],icon:"Disc",color:"text-red-500"},ChipSynth:{type:"ChipSynth",name:"Chip Synth",shortName:"Chip",description:"8-bit video game console sounds",bestFor:["Chiptune","Retro","Lo-fi","Arpeggios"],icon:"Gamepad2",color:"text-green-400"},PWMSynth:{type:"PWMSynth",name:"PWM Synth",shortName:"PWM",description:"Pulse width modulation for rich analog tones",bestFor:["Analog pads","Warm leads","Classic synth"],icon:"Waves",color:"text-emerald-400"},StringMachine:{type:"StringMachine",name:"String Machine",shortName:"Strings",description:"Vintage ensemble strings (Solina-style)",bestFor:["Lush pads","Disco strings","Ambient","Retro"],icon:"Music4",color:"text-rose-400"},FormantSynth:{type:"FormantSynth",name:"Formant Synth",shortName:"Vocal",description:"Vowel synthesis for vocal-like sounds",bestFor:["Vocal pads","Talk box","Choir","Robotic"],icon:"Mic",color:"text-fuchsia-400"},Furnace:{type:"Furnace",name:"Furnace FM",shortName:"FUI",description:"FM engine compatible with Furnace Tracker (.fui) instruments",bestFor:["Genesis bass","FM bells","Retro arcade","4-op FM"],icon:"Cpu",color:"text-amber-500"},FurnaceOPN:{type:"FurnaceOPN",name:"Sega Genesis (YM2612)",shortName:"Genesis",description:"Sega Genesis / Mega Drive YM2612 - 6 channels of 4-op FM",bestFor:["Genesis bass","FM leads","Slap bass","16-bit game music"],icon:"Gamepad2",color:"text-blue-500"},FurnaceOPM:{type:"FurnaceOPM",name:"Arcade / X68000 (YM2151)",shortName:"OPM",description:"Yamaha YM2151 - Sharp X68000, arcade machines",bestFor:["Arcade FM","Bright leads","Brass","Game music"],icon:"Cpu",color:"text-cyan-500"},FurnaceOPL:{type:"FurnaceOPL",name:"AdLib / Sound Blaster (OPL3)",shortName:"OPL3",description:"Yamaha YMF262 - AdLib, Sound Blaster, DOS games",bestFor:["DOS game music","MIDI synth","Organs","PC gaming"],icon:"Monitor",color:"text-yellow-500"},FurnaceOPLL:{type:"FurnaceOPLL",name:"MSX / Sega (OPLL)",shortName:"OPLL",description:"Yamaha YM2413 - MSX, SMS FM unit, budget FM",bestFor:["MSX music","SMS FM","Lo-fi FM","Simple FM"],icon:"Radio",color:"text-orange-400"},FurnaceESFM:{type:"FurnaceESFM",name:"ESFM",shortName:"ESFM",description:"Enhanced Sound FM - advanced OPL3 with operator detune",bestFor:["Modern retro","Enhanced FM","Detuned sounds"],icon:"Zap",color:"text-purple-500"},FurnaceOPZ:{type:"FurnaceOPZ",name:"Yamaha TX81Z (OPZ)",shortName:"OPZ",description:"Yamaha YM2414 - TX81Z, DX11, advanced FM",bestFor:["Lately bass","DX bells","Complex FM","E-piano"],icon:"Piano",color:"text-indigo-500"},FurnaceNES:{type:"FurnaceNES",name:"Nintendo NES (2A03)",shortName:"NES",description:"Nintendo Entertainment System - 2 pulse, triangle, noise, DPCM",bestFor:["NES chiptune","8-bit melodies","Retro drums","Famicom"],icon:"Gamepad2",color:"text-red-500"},FurnaceGB:{type:"FurnaceGB",name:"Nintendo Game Boy",shortName:"GB",description:"Nintendo Game Boy - 2 pulse, wave, noise channels",bestFor:["Game Boy music","Lo-fi chiptune","Portable gaming"],icon:"Smartphone",color:"text-green-500"},FurnaceC64:{type:"FurnaceC64",name:"Commodore 64 (SID)",shortName:"SID",description:"Commodore 64 SID chip - 3 voices with filters",bestFor:["SID leads","Arpeggios","Filter sweeps","Demoscene"],icon:"Terminal",color:"text-violet-500"},FurnaceAY:{type:"FurnaceAY",name:"ZX Spectrum / Amstrad (AY)",shortName:"AY",description:"General Instrument AY - ZX Spectrum, MSX, Atari ST",bestFor:["ZX Spectrum","MSX","Amstrad CPC","Envelope tricks"],icon:"Tv",color:"text-sky-500"},FurnaceTIA:{type:"FurnaceTIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 - primitive but distinctive sound",bestFor:["Atari 2600","Primitive bleeps","Retro FX"],icon:"Joystick",color:"text-amber-600"},FurnaceVERA:{type:"FurnaceVERA",name:"Commander X16 (VERA)",shortName:"VERA",description:"Commander X16 - modern retro 16 channels PSG + PCM",bestFor:["Modern retro","X16 music","Rich PSG"],icon:"Cpu",color:"text-teal-500"},FurnaceSAA:{type:"FurnaceSAA",name:"SAM Coup (SAA1099)",shortName:"SAA",description:"Philips SAA1099 - Sam Coup, some PC sound cards",bestFor:["Sam Coup","Stereo chips","European home computers"],icon:"Speaker",color:"text-pink-500"},FurnacePSG:{type:"FurnacePSG",name:"Sega Master System (PSG)",shortName:"PSG",description:"TI SN76489 - Master System, Game Gear, BBC Micro",bestFor:["Master System","Colecovision","Square wave PSG"],icon:"SquareStack",color:"text-emerald-500"},FurnaceVIC:{type:"FurnaceVIC",name:"Commodore VIC-20",shortName:"VIC",description:"Commodore VIC-20 - 3 square + noise",bestFor:["VIC-20 music","Early 80s","Simple tones"],icon:"Monitor",color:"text-lime-500"},FurnaceLynx:{type:"FurnaceLynx",name:"Atari Lynx",shortName:"Lynx",description:"Atari Lynx - 4 channel wavetable",bestFor:["Lynx music","Portable gaming","Wavetable"],icon:"Gamepad",color:"text-rose-500"},FurnaceSID6581:{type:"FurnaceSID6581",name:"SID 6581",shortName:"6581",description:"Classic C64 SID - warm, gritty original chip",bestFor:["Authentic C64","Warm bass","Classic demoscene"],icon:"Terminal",color:"text-violet-400"},FurnaceSID8580:{type:"FurnaceSID8580",name:"SID 8580",shortName:"8580",description:"Revised SID - cleaner filter, brighter sound",bestFor:["Clean SID","Later C64/C128","Clearer filters"],icon:"Terminal",color:"text-violet-600"},FurnaceOPNA:{type:"FurnaceOPNA",name:"NEC PC-98 (OPNA)",shortName:"OPNA",description:"YM2608 - NEC PC-98, arcade machines",bestFor:["PC-98 music","Touhou-style","Japanese arcade"],icon:"Cpu",color:"text-blue-400"},FurnaceOPNB:{type:"FurnaceOPNB",name:"SNK Neo Geo (OPNB)",shortName:"OPNB",description:"YM2610 - SNK Neo Geo",bestFor:["Neo Geo music","Fighting games","SNK"],icon:"Gamepad2",color:"text-red-400"},FurnaceOPL4:{type:"FurnaceOPL4",name:"Yamaha OPL4",shortName:"OPL4",description:"Yamaha YMF278 - FM + wavetable hybrid",bestFor:["Advanced OPL","FM + samples","Late DOS"],icon:"Layers",color:"text-yellow-400"},FurnaceY8950:{type:"FurnaceY8950",name:"MSX-Audio (Y8950)",shortName:"Y8950",description:"Yamaha Y8950 - MSX-Audio, OPL + ADPCM",bestFor:["MSX-Audio","OPL with drums","Japanese PC"],icon:"Radio",color:"text-orange-300"},FurnacePCE:{type:"FurnacePCE",name:"PC Engine / TurboGrafx",shortName:"PCE",description:"PC Engine / TurboGrafx-16 - 6 channel wavetable",bestFor:["PC Engine","TurboGrafx","HuCard games"],icon:"Tv",color:"text-orange-500"},FurnaceSNES:{type:"FurnaceSNES",name:"Super Nintendo (SPC700)",shortName:"SNES",description:"Super Nintendo - Sony SPC700 8-channel BRR",bestFor:["SNES music","16-bit classics","BRR samples"],icon:"Gamepad2",color:"text-purple-400"},FurnaceVB:{type:"FurnaceVB",name:"Nintendo Virtual Boy",shortName:"VB",description:"Nintendo Virtual Boy - 6 channel wavetable",bestFor:["Virtual Boy","Stereo 3D audio","Nintendo VB"],icon:"Glasses",color:"text-red-600"},FurnaceSWAN:{type:"FurnaceSWAN",name:"Bandai WonderSwan",shortName:"SWAN",description:"Bandai WonderSwan - 4 channel wavetable + PCM",bestFor:["WonderSwan","Portable gaming","Bandai"],icon:"Smartphone",color:"text-cyan-400"},FurnaceVRC6:{type:"FurnaceVRC6",name:"Famicom (VRC6)",shortName:"VRC6",description:"Konami VRC6 - 2 pulse + saw (Castlevania 3 JP)",bestFor:["Castlevania 3","Konami NES","Extra channels"],icon:"Zap",color:"text-amber-400"},FurnaceVRC7:{type:"FurnaceVRC7",name:"Famicom (VRC7)",shortName:"VRC7",description:"Konami VRC7 - OPLL clone (Lagrange Point)",bestFor:["Lagrange Point","FM on NES","Konami FM"],icon:"Radio",color:"text-amber-500"},FurnaceN163:{type:"FurnaceN163",name:"Namco Arcade (N163)",shortName:"N163",description:"Namco 163 - 8 channel wavetable",bestFor:["Namco NES","Wavetable","Complex tones"],icon:"Waves",color:"text-green-400"},FurnaceFDS:{type:"FurnaceFDS",name:"Famicom Disk System",shortName:"FDS",description:"Famicom Disk System - wavetable + modulation",bestFor:["FDS games","Wavy bass","Zelda FDS"],icon:"Disc",color:"text-yellow-500"},FurnaceMMC5:{type:"FurnaceMMC5",name:"Famicom (MMC5)",shortName:"MMC5",description:"MMC5 - 2 extra pulse channels",bestFor:["Castlevania 3 US","Extra NES pulse","CV3"],icon:"Plus",color:"text-blue-300"},FurnaceTED:{type:"FurnaceTED",name:"Commodore Plus/4 (TED)",shortName:"TED",description:"Commodore Plus/4 TED - 2 square + noise",bestFor:["Plus/4 music","Commodore 16","Budget C64"],icon:"Monitor",color:"text-violet-400"},FurnaceSEGAPCM:{type:"FurnaceSEGAPCM",name:"Sega Arcade (SegaPCM)",shortName:"SEGAPCM",description:"Sega System 16/18 - 16 channel PCM",bestFor:["OutRun","After Burner","Sega arcade"],icon:"Speaker",color:"text-blue-500"},FurnaceQSOUND:{type:"FurnaceQSOUND",name:"Capcom Arcade (QSound)",shortName:"QSound",description:"Capcom QSound - CPS1/CPS2 with 3D audio",bestFor:["Street Fighter","CPS games","3D positioning"],icon:"Headphones",color:"text-purple-500"},FurnaceES5506:{type:"FurnaceES5506",name:"ES5506",shortName:"ES5506",description:"Ensoniq ES5506 - 32 voice wavetable",bestFor:["Taito F3","Ensoniq synths","High quality"],icon:"AudioLines",color:"text-pink-400"},FurnaceRF5C68:{type:"FurnaceRF5C68",name:"RF5C68",shortName:"RF5C68",description:"Ricoh RF5C68 - Sega CD, 8 channel PCM",bestFor:["Sega CD","Mega CD","CD audio"],icon:"Disc",color:"text-cyan-500"},FurnaceC140:{type:"FurnaceC140",name:"C140",shortName:"C140",description:"Namco C140 - System 2, 24 channel PCM",bestFor:["Namco arcade","System 2","Assault"],icon:"Cpu",color:"text-yellow-400"},FurnaceK007232:{type:"FurnaceK007232",name:"K007232",shortName:"K007232",description:"Konami K007232 - 2 channel PCM",bestFor:["Contra arcade","Konami PCM","TMNT"],icon:"Speaker",color:"text-red-400"},FurnaceK053260:{type:"FurnaceK053260",name:"K053260",shortName:"K053260",description:"Konami K053260 - 4 channel PCM with ADPCM",bestFor:["Sunset Riders","Simpsons","Konami 90s"],icon:"Speaker",color:"text-orange-400"},FurnaceGA20:{type:"FurnaceGA20",name:"GA20",shortName:"GA20",description:"Irem GA20 - 4 channel PCM",bestFor:["R-Type Leo","Irem arcade","In the Hunt"],icon:"Cpu",color:"text-teal-400"},FurnaceOKI:{type:"FurnaceOKI",name:"OKI MSM6295",shortName:"OKI",description:"OKI MSM6295 - 4 channel ADPCM",bestFor:["Neo Geo","Data East","ADPCM drums"],icon:"Volume2",color:"text-gray-400"},FurnaceYMZ280B:{type:"FurnaceYMZ280B",name:"YMZ280B",shortName:"YMZ280B",description:"Yamaha YMZ280B - 8 channel ADPCM",bestFor:["Cave shmups","Late arcade","High quality"],icon:"AudioLines",color:"text-indigo-400"},FurnaceSCC:{type:"FurnaceSCC",name:"Konami SCC",shortName:"SCC",description:"Konami SCC - 5 channel wavetable (MSX)",bestFor:["Gradius","Snatcher","MSX Konami"],icon:"Waves",color:"text-green-500"},FurnaceX1_010:{type:"FurnaceX1_010",name:"X1-010",shortName:"X1-010",description:"Seta X1-010 - 16 channel wavetable",bestFor:["Seta arcade","Wavetable","Twin Eagle"],icon:"Waves",color:"text-lime-400"},FurnaceBUBBLE:{type:"FurnaceBUBBLE",name:"Bubble System",shortName:"BUBBLE",description:"Konami Bubble System - wavetable",bestFor:["Konami arcade","Bubble System","Wavetable"],icon:"Circle",color:"text-sky-400"},FurnaceSM8521:{type:"FurnaceSM8521",name:"SM8521",shortName:"SM8521",description:"Sharp SM8521 - Game.com",bestFor:["Game.com","Tiger electronics","Obscure"],icon:"Smartphone",color:"text-gray-500"},FurnaceT6W28:{type:"FurnaceT6W28",name:"T6W28",shortName:"T6W28",description:"NEC T6W28 - PC-6001, stereo PSG",bestFor:["NEC PC-6001","Japanese PC","Stereo PSG"],icon:"Monitor",color:"text-blue-300"},FurnaceSUPERVISION:{type:"FurnaceSUPERVISION",name:"Supervision",shortName:"SV",description:"Watara Supervision - 4 channel + noise/DMA",bestFor:["Supervision","Portable gaming","Watara"],icon:"Gamepad",color:"text-emerald-400"},FurnaceUPD1771:{type:"FurnaceUPD1771",name:"PD1771",shortName:"UPD1771",description:"NEC PD1771 - Epoch Super Cassette Vision",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-400"},FurnaceOPN2203:{type:"FurnaceOPN2203",name:"YM2203 / OPN",shortName:"OPN",description:"YM2203 - PC-88/98, simpler 3-channel FM + SSG",bestFor:["PC-88 music","Japanese PC games","Simpler FM"],icon:"Cpu",color:"text-blue-300"},FurnaceOPNBB:{type:"FurnaceOPNBB",name:"YM2610B",shortName:"OPNB-B",description:"YM2610B - Extended Neo Geo with more FM channels",bestFor:["Neo Geo CD","Extended OPNB","SNK"],icon:"Gamepad2",color:"text-red-300"},FurnaceAY8930:{type:"FurnaceAY8930",name:"AY-8930",shortName:"AY+",description:"Enhanced AY-3-8910 with expanded features",bestFor:["Enhanced chiptune","Extended AY","Microchip"],icon:"Tv",color:"text-sky-400"},FurnaceNDS:{type:"FurnaceNDS",name:"Nintendo DS",shortName:"NDS",description:"Nintendo DS - 16 channel PCM/PSG",bestFor:["NDS music","Portable gaming","Modern chiptune"],icon:"Smartphone",color:"text-slate-400"},FurnaceGBA:{type:"FurnaceGBA",name:"Game Boy Advance",shortName:"GBA",description:"GBA DMA Sound - 2 channel direct PCM",bestFor:["GBA music","Portable gaming","PCM"],icon:"Gamepad",color:"text-purple-300"},FurnacePOKEMINI:{type:"FurnacePOKEMINI",name:"Pokemon Mini",shortName:"PKMN",description:"Pokemon Mini - tiny handheld sound",bestFor:["Pokemon Mini","Tiny tunes","Lo-fi"],icon:"Star",color:"text-yellow-300"},FurnaceNAMCO:{type:"FurnaceNAMCO",name:"Namco WSG",shortName:"WSG",description:"Namco WSG - Pac-Man, Galaga wavetable",bestFor:["Pac-Man","Galaga","Classic arcade"],icon:"Circle",color:"text-yellow-400"},FurnacePET:{type:"FurnacePET",name:"Commodore PET",shortName:"PET",description:"Commodore PET - single voice shift register",bestFor:["PET music","Early 80s","Primitive"],icon:"Monitor",color:"text-green-300"},FurnacePOKEY:{type:"FurnacePOKEY",name:"Atari POKEY",shortName:"POKEY",description:"Atari POKEY - Atari 800/5200/arcade",bestFor:["Atari 8-bit","Atari arcade","Classic chiptune"],icon:"Joystick",color:"text-orange-400"},FurnaceMSM6258:{type:"FurnaceMSM6258",name:"MSM6258",shortName:"MSM6258",description:"OKI MSM6258 - 4-bit ADPCM voice",bestFor:["Voice samples","ADPCM","Japanese arcade"],icon:"Mic",color:"text-pink-300"},FurnaceMSM5232:{type:"FurnaceMSM5232",name:"MSM5232",shortName:"MSM5232",description:"OKI MSM5232 - 8-voice PSG synthesizer",bestFor:["Early arcade","Organ sounds","8-voice"],icon:"Music2",color:"text-amber-300"},FurnaceMULTIPCM:{type:"FurnaceMULTIPCM",name:"Sega MultiPCM",shortName:"MPCM",description:"Sega MultiPCM - System 32, Model 1/2",bestFor:["Virtua Racing","Sega arcade","High quality PCM"],icon:"Headphones",color:"text-blue-400"},FurnaceAMIGA:{type:"FurnaceAMIGA",name:"Amiga Paula",shortName:"PAULA",description:"Amiga Paula - 4 channel 8-bit PCM",bestFor:["Amiga MODs","Demoscene","Classic samples"],icon:"Disc",color:"text-slate-300"},FurnacePCSPKR:{type:"FurnacePCSPKR",name:"PC Speaker",shortName:"PCSPK",description:"PC Speaker - internal IBM PC beeper",bestFor:["DOS games","Beeper music","Lo-fi PC"],icon:"Volume2",color:"text-gray-400"},FurnacePONG:{type:"FurnacePONG",name:"AY-3-8500",shortName:"PONG",description:"AY-3-8500 - original Pong chip sound",bestFor:["Pong","Retro bleeps","Primitive"],icon:"Circle",color:"text-white"},FurnacePV1000:{type:"FurnacePV1000",name:"Casio PV-1000",shortName:"PV1K",description:"Casio PV-1000 - 3 channel PSG",bestFor:["PV-1000","Obscure","Japanese"],icon:"Tv",color:"text-green-400"},FurnaceDAVE:{type:"FurnaceDAVE",name:"Enterprise DAVE",shortName:"DAVE",description:"Enterprise DAVE - 3 channel + noise",bestFor:["Enterprise 64/128","Hungarian","European"],icon:"Monitor",color:"text-red-300"},FurnaceSU:{type:"FurnaceSU",name:"Sound Unit",shortName:"SU",description:"Commander X16 Sound Unit",bestFor:["X16 music","Modern retro","Sound Unit"],icon:"Speaker",color:"text-teal-300"},FurnacePOWERNOISE:{type:"FurnacePOWERNOISE",name:"Power Noise",shortName:"PNOISE",description:"Power Noise - noise generator chip",bestFor:["Noise music","Experimental","Harsh sounds"],icon:"Zap",color:"text-violet-400"},FurnaceZXBEEPER:{type:"FurnaceZXBEEPER",name:"ZX Beeper",shortName:"BEEP",description:"ZX Spectrum beeper - 1-bit audio",bestFor:["ZX Spectrum","Beeper music","1-bit audio"],icon:"Speaker",color:"text-cyan-300"},FurnaceSCVTONE:{type:"FurnaceSCVTONE",name:"SCV Tone",shortName:"SCV",description:"Epoch SCV tone generator",bestFor:["Super Cassette Vision","Epoch","Japanese"],icon:"Tv",color:"text-stone-300"},FurnacePCMDAC:{type:"FurnacePCMDAC",name:"PCM DAC",shortName:"DAC",description:"Generic PCM DAC output",bestFor:["PCM output","Generic DAC","Simple samples"],icon:"AudioLines",color:"text-gray-300"},ChiptuneModule:{type:"ChiptuneModule",name:"Chiptune Module",shortName:"MOD",description:"Libopenmpt-powered playback for MOD/XM/IT/S3M files",bestFor:["Tracker modules","Retro game music","Sample-accurate playback"],icon:"Gamepad2",color:"text-lime-400"},WobbleBass:{type:"WobbleBass",name:"Wobble Bass",shortName:"Wobble",description:"Dubstep/DnB bass with tempo-synced LFO, Reese detuning, FM growl",bestFor:["Dubstep","DnB","Jungle","Neurofunk","Riddim"],icon:"Waves",color:"text-fuchsia-500"},DrumKit:{type:"DrumKit",name:"Drum Kit",shortName:"Kit",description:"Multi-sample instrument with keymap - assign different samples to different notes",bestFor:["Drum kits","Instrument layers","Velocity splits","Sample mapping"],icon:"Piano",color:"text-amber-500"},Buzzmachine:{type:"Buzzmachine",name:"Buzzmachine",shortName:"Buzz",description:"Jeskola Buzz machines - classic tracker effects and generators from the Buzz ecosystem",bestFor:["Effects","Generators","Classic tracker sounds","Buzz compatibility"],icon:"Cpu",color:"text-yellow-500"},BuzzDTMF:{type:"BuzzDTMF",name:"CyanPhase DTMF",shortName:"DTMF",description:"Phone dial tone generator - classic DTMF tones",bestFor:["Phone tones","Retro effects","Experimental"],icon:"Phone",color:"text-cyan-400"},BuzzFreqBomb:{type:"BuzzFreqBomb",name:"Frequency Bomb",shortName:"FreqBomb",description:"Elenzil Frequency Bomb - chaotic frequency modulation",bestFor:["Noise","Chaos","Experimental"],icon:"Bomb",color:"text-red-500"},BuzzKick:{type:"BuzzKick",name:"FSM Kick",shortName:"Kick",description:"FSM Kick drum synthesizer",bestFor:["Kick drums","Bass drums","Percussion"],icon:"Drum",color:"text-orange-500"},BuzzKickXP:{type:"BuzzKickXP",name:"FSM KickXP",shortName:"KickXP",description:"Extended FSM Kick with more parameters",bestFor:["Kick drums","Deep bass","EDM kicks"],icon:"Drum",color:"text-orange-600"},BuzzNoise:{type:"BuzzNoise",name:"Jeskola Noise",shortName:"Noise",description:"Jeskola Noise generator",bestFor:["Noise","Hi-hats","Textures"],icon:"Waves",color:"text-gray-400"},BuzzTrilok:{type:"BuzzTrilok",name:"Jeskola Trilok",shortName:"Trilok",description:"Jeskola Trilok bass drum synthesizer",bestFor:["Bass drums","Toms","Percussion"],icon:"Drum",color:"text-amber-500"},Buzz4FM2F:{type:"Buzz4FM2F",name:"MadBrain 4FM2F",shortName:"4FM2F",description:"4-operator FM synthesizer with 2 filters",bestFor:["FM sounds","Complex timbres","DX-style"],icon:"Radio",color:"text-purple-500"},BuzzDynamite6:{type:"BuzzDynamite6",name:"MadBrain Dynamite6",shortName:"Dyn6",description:"6-voice additive synthesizer",bestFor:["Additive synthesis","Organs","Complex sounds"],icon:"Zap",color:"text-yellow-500"},BuzzM3:{type:"BuzzM3",name:"Makk M3",shortName:"M3",description:"Dual-oscillator mono synth",bestFor:["Bass","Leads","Classic synth"],icon:"AudioLines",color:"text-green-500"},Buzz3o3:{type:"Buzz3o3",name:"Oomek Aggressor 3o3",shortName:"3o3",description:"TB-303 style acid synth clone",bestFor:["Acid bass","Squelchy lines","Techno"],icon:"Zap",color:"text-lime-500"},MAMEVFX:{type:"MAMEVFX",name:"Ensoniq VFX",shortName:"VFX",description:"Ensoniq ES5506 (OTTO) 32-voice wavetable synthesis",bestFor:["Evolving pads","90s digital","Cinematic","Layers"],icon:"AudioLines",color:"text-pink-400"},MAMEDOC:{type:"MAMEDOC",name:"Ensoniq ESQ-1",shortName:"DOC",description:"Ensoniq ES5503 (DOC) 8-bit wavetable synthesis",bestFor:["Lo-fi digital","ESQ-1 pads","Gritty bass","80s digital"],icon:"Waves",color:"text-amber-400"},MAMERSA:{type:"MAMERSA",name:"Roland SA",shortName:"MKS20",description:"Roland Structured Adaptive Synthesis (MKS-20/RD-1000)",bestFor:["Electric piano","Authentic piano","80s keys"],icon:"Piano",color:"text-sky-400"},MAMESWP30:{type:"MAMESWP30",name:"Yamaha SWP30",shortName:"AWM2",description:"Yamaha SWP30 (AWM2) 64-voice ROMpler/DSP engine",bestFor:["Realistic instruments","90s ROMpler","Advanced effects","AWM2 sounds"],icon:"Cpu",color:"text-emerald-400"},CZ101:{type:"CZ101",name:"Casio CZ-101",shortName:"CZ",description:"Casio Phase Distortion synthesis - 8 voices, dual oscillator with DCO/DCW/DCA envelopes",bestFor:["Digital bass","Metallic leads","Synth brass","80s digital","Phase distortion"],icon:"Activity",color:"text-violet-400"},CEM3394:{type:"CEM3394",name:"CEM3394 (Curtis)",shortName:"CEM",description:"Curtis Electromusic analog synth voice - used in Prophet VS, Matrix-6, ESQ-1, Six-Trak",bestFor:["Analog bass","Warm pads","Classic leads","80s analog","Prophet sounds"],icon:"Waves",color:"text-emerald-400"},SCSP:{type:"SCSP",name:"Sega Saturn SCSP",shortName:"SCSP",description:"Yamaha YMF292-F 32-voice sound processor - Sega Saturn, Model 2/3 arcade",bestFor:["Arcade sounds","90s gaming","Saturn pads","Virtua sounds","Sega classics"],icon:"Gamepad2",color:"text-blue-500"},DubSiren:{type:"DubSiren",name:"Dub Siren",shortName:"Siren",description:"Classic dub sound system siren with LFO and delay",bestFor:["Dub FX","Reggae","Sound system","Alerts"],icon:"Megaphone",color:"text-red-500"},SpaceLaser:{type:"SpaceLaser",name:"Space Laser",shortName:"Laser",description:"FM-based cosmic zap generator for classic reggae and anime effects",bestFor:["Laser shots","Anime FX","Reggae dubs","Sci-fi"],icon:"Zap",color:"text-green-500"},V2:{type:"V2",name:"Farbrausch V2 Synth",shortName:"V2",description:"Authentic 4k/64k demoscene synthesis with multi-voice subtractive engine.",bestFor:["Demoscene","Trance","Techno","Leads"],icon:"Radio",color:"amber"},V2Speech:{type:"V2Speech",name:"V2 Speech",shortName:"V2Sp",description:"Farbrausch V2 speech synthesis module for robotic and vocoder-style voices.",bestFor:["Speech","Robotic Voices","Demoscene","FX"],icon:"Radio",color:"amber"},Sam:{type:"Sam",name:"Commodore SAM",shortName:"SAM",description:"Software Automatic Mouth - classic 8-bit speech synthesizer from 1982.",bestFor:["Speech","Robotic Voices","Lo-Fi","FX"],icon:"MessageSquare",color:"amber"},Synare:{type:"Synare",name:"Synare 3",shortName:"Synare",description:'Classic electronic percussion synthesizer for "disco tom" and dub sounds',bestFor:["Dub percussion","Disco toms","Electronic drums","SFX"],icon:"Drum",color:"text-yellow-500"},WAM:{type:"WAM",name:"Web Audio Module",shortName:"WAM",description:"Load external audio plugins from URL (standard WAM 2.0 format)",bestFor:["External plugins","Community synths","Rich UI"],icon:"Globe",color:"text-cyan-400"},WAMOBXd:{type:"WAMOBXd",name:"OB-Xd (WAM)",shortName:"OBXd-W",description:"Oberheim OB-X virtual analog synth via WAM 2.0",bestFor:["Analog pads","Warm leads","Classic analog","Rich UI"],icon:"Waves",color:"text-amber-400"},WAMSynth101:{type:"WAMSynth101",name:"Synth-101 (WAM)",shortName:"SH101",description:"Roland SH-101 monophonic synthesizer via WAM 2.0",bestFor:["Mono bass","Acid lines","Classic mono","Rich UI"],icon:"AudioLines",color:"text-blue-400"},WAMTinySynth:{type:"WAMTinySynth",name:"TinySynth (WAM)",shortName:"Tiny",description:"GM-mapped multi-timbral synth via WAM 2.0",bestFor:["General MIDI","Multi-timbral","Quick patches","Rich UI"],icon:"Music2",color:"text-green-400"},WAMFaustFlute:{type:"WAMFaustFlute",name:"Faust Flute (WAM)",shortName:"Flute",description:"Physical modelling flute via Faust DSP and WAM 2.0",bestFor:["Physical model","Wind instruments","Expressive","Rich UI"],icon:"Wind",color:"text-sky-400"},Dexed:{type:"Dexed",name:"Dexed (DX7)",shortName:"DX7",description:"Yamaha DX7 FM synthesizer emulation - 6-operator FM with 32 algorithms",bestFor:["FM Bass","Electric Piano","Bells","Pads","Classic FM sounds"],icon:"Piano",color:"text-blue-400"},OBXd:{type:"OBXd",name:"OBXd (Oberheim)",shortName:"OBXd",description:"Oberheim OB-X analog polysynth emulation - classic warm analog sounds",bestFor:["Pads","Brass","Strings","Warm leads","Analog sounds"],icon:"Waves",color:"text-amber-400"},DexedBridge:{type:"DexedBridge",name:"Dexed DX7 (Bridge)",shortName:"DX7B",description:"Dexed DX7 via VSTBridge generic framework - test/validation of the bridge",bestFor:["FM Bass","Electric Piano","Bells","Bridge testing"],icon:"Plug",color:"text-purple-400"},Vital:{type:"Vital",name:"Vital (Wavetable)",shortName:"Vital",description:"Spectral warping wavetable synthesizer - 3 oscillators with spectral morphing, 13 morph types, phase distortion",bestFor:["Wavetable","Spectral","Modern bass","Pads","Leads","Sound design"],icon:"Waves",color:"text-violet-400"},Odin2:{type:"Odin2",name:"Odin2 (Hybrid)",shortName:"Odin2",description:"Semi-modular hybrid synth - 11 oscillator types (analog, wavetable, FM, vector, chiptune), 9 filter types, modulation matrix",bestFor:["Hybrid synthesis","Analog","Wavetable","FM","Vector","Chiptune"],icon:"Zap",color:"text-emerald-400"},Surge:{type:"Surge",name:"Surge XT (Hybrid)",shortName:"Surge",description:"Professional hybrid synth - dual scenes, 12 oscillator types, 32 effect types, 765 parameters, open source since 2018",bestFor:["Professional","Hybrid","Sound design","Bass","Pads","Leads","FX"],icon:"Activity",color:"text-cyan-400"},TonewheelOrgan:{type:"TonewheelOrgan",name:"Tonewheel Organ",shortName:"Organ",description:"Hammond-style tonewheel organ - 9 drawbars, key click, percussion, vibrato/chorus scanner, overdrive",bestFor:["Reggae organ","Gospel","Jazz","Blues","Rock organ","Ska"],icon:"Music",color:"text-amber-400"},Melodica:{type:"Melodica",name:"Melodica",shortName:"Melod",description:"Monophonic reed instrument physical model - breath dynamics, body resonance, vibrato, portamento",bestFor:["Reggae melodica","Dub","Ska","Augustus Pablo","Lead melodies"],icon:"Wind",color:"text-teal-400"},Monique:{type:"Monique",name:"Monique (Monosynth)",shortName:"Moniq",description:"Morphing monosynth - 3 oscillators, 3 cross-routed filters, 4 tempo-synced MFOs, distortion, delay, arpeggiator",bestFor:["Wobble bass","Dubstep","DnB bass","Acid","Mono leads","Bass"],icon:"AudioLines",color:"text-rose-400"},Buzz3o3DF:{type:"Buzz3o3DF",name:"Aggressor Devil Fish",shortName:"3o3DF",description:"Enhanced TB-303 clone with Devil Fish mods - accent decay, VEG, filter tracking, muffler",bestFor:["Acid bass","Deep acid","Experimental","Devil Fish tones"],icon:"Zap",color:"text-lime-400"},BuzzM4:{type:"BuzzM4",name:"Makk M4",shortName:"M4",description:"Wavetable synth with 100+ waveforms, dual oscillators, sub osc, and dual LFOs",bestFor:["Wavetable","Leads","Pads","Bass"],icon:"Layers",color:"text-sky-400"},MAMEAICA:{type:"MAMEAICA",name:"Sega AICA",shortName:"AICA",description:"Sega Dreamcast/Naomi AICA - 64-voice ADPCM+FM sound processor",bestFor:["Dreamcast sounds","Arcade PCM","90s gaming","ADPCM samples"],icon:"Gamepad2",color:"text-blue-400"},MAMEASC:{type:"MAMEASC",name:"Apple Sound Chip",shortName:"ASC",description:"Apple ASC - 4-voice wavetable synthesis from Apple IIGS and Mac",bestFor:["Retro Mac","Wavetable","IIGS sounds","80s digital"],icon:"Cpu",color:"text-gray-400"},MAMEAstrocade:{type:"MAMEAstrocade",name:"Bally Astrocade",shortName:"Astro",description:"Bally Astrocade custom sound - 3 voices + noise, vibrato modulation",bestFor:["Retro arcade","Lo-fi","Noise FX","Vintage gaming"],icon:"Gamepad2",color:"text-purple-400"},MAMEC352:{type:"MAMEC352",name:"Namco C352",shortName:"C352",description:"Namco System 22/23 - 32-voice PCM with built-in effects (needs ROM)",bestFor:["Namco arcade","Ridge Racer","Tekken sounds","Arcade PCM"],icon:"Gamepad2",color:"text-red-400"},MAMEES5503:{type:"MAMEES5503",name:"Ensoniq ES5503",shortName:"ES5503",description:"Ensoniq DOC - 32-oscillator wavetable chip (Apple IIGS, ESQ-1, Mirage)",bestFor:["Wavetable","Lo-fi digital","80s synth","IIGS music"],icon:"Waves",color:"text-amber-400"},MAMEICS2115:{type:"MAMEICS2115",name:"ICS WaveFront",shortName:"ICS",description:"ICS 2115 WaveFront - 32-voice wavetable with interpolation (needs ROM)",bestFor:["Wavetable","90s soundcard","GUS compatible","Tracker music"],icon:"Cpu",color:"text-teal-400"},MAMEK054539:{type:"MAMEK054539",name:"Konami K054539",shortName:"K054",description:"Konami 054539 - 8-channel PCM for Konami arcade (needs ROM)",bestFor:["Konami arcade","TMNT","Gradius","Arcade samples"],icon:"Gamepad2",color:"text-yellow-400"},MAMEMEA8000:{type:"MAMEMEA8000",name:"Philips MEA8000",shortName:"MEA",description:"Philips MEA8000 - LPC speech synthesis with formant modeling",bestFor:["Speech","Robotic voice","Retro talking","Voice FX"],icon:"Mic",color:"text-green-400"},MAMEMSM5232:{type:"MAMEMSM5232",name:"OKI MSM5232",shortName:"MSM",description:"OKI MSM5232 - 8-voice PSG organ/synth chip (MAME native emulation)",bestFor:["Organ","Arcade melody","Retro synth","Simple tones"],icon:"Cpu",color:"text-orange-400"},MAMERF5C400:{type:"MAMERF5C400",name:"Ricoh RF5C400",shortName:"RF5C",description:"Ricoh RF5C400 - 32-voice PCM with digital filtering (needs ROM)",bestFor:["Seta arcade","PCM playback","Arcade samples"],icon:"Cpu",color:"text-indigo-400"},MAMESN76477:{type:"MAMESN76477",name:"TI SN76477",shortName:"SN77",description:"TI SN76477 Complex Sound Generator - VCO, noise, envelope, mixer",bestFor:["Sci-fi FX","Laser sounds","Space Invaders","Retro arcade FX"],icon:"Zap",color:"text-green-500"},MAMESNKWave:{type:"MAMESNKWave",name:"SNK Wave",shortName:"SNK",description:"SNK custom wavetable sound generator - Neo Geo era",bestFor:["Retro arcade","Wavetable","SNK sounds","Lo-fi"],icon:"Gamepad2",color:"text-red-500"},MAMESP0250:{type:"MAMESP0250",name:"GI SP0250",shortName:"SP02",description:"General Instrument SP0250 - LPC speech synthesis for arcade machines",bestFor:["Arcade speech","Robotic voice","Q*bert sounds","Retro talking"],icon:"Mic",color:"text-yellow-500"},MAMETIA:{type:"MAMETIA",name:"Atari TIA",shortName:"TIA",description:"Atari 2600 TIA - MAME-accurate 2-voice with 16 distortion modes",bestFor:["Atari sounds","2600 bleeps","Lo-fi","Retro FX"],icon:"Gamepad2",color:"text-amber-500"},MAMETMS36XX:{type:"MAMETMS36XX",name:"TMS36XX Organ",shortName:"TMS3",description:"TI TMS3615/3617 - electronic organ chip with 13 chromatic notes",bestFor:["Electronic organ","Retro tones","Circus music","Simple melody"],icon:"Music2",color:"text-rose-400"},MAMETMS5220:{type:"MAMETMS5220",name:"Speak & Spell",shortName:"TMS5",description:"TI TMS5220 LPC speech - the Speak & Spell chip, phoneme-based voice",bestFor:["Speech","Speak & Spell","Robotic voice","LPC vocoder"],icon:"Mic",color:"text-orange-500"},MAMETR707:{type:"MAMETR707",name:"Roland TR-707",shortName:"707",description:"Roland TR-707 PCM drum machine - 10 voices with analog filtering (needs ROM)",bestFor:["House drums","Electro beats","80s rhythm","Classic drum machine"],icon:"Disc",color:"text-red-400"},MAMEUPD931:{type:"MAMEUPD931",name:"NEC uPD931",shortName:"931",description:"NEC uPD931 - speech synthesis processor with LPC coding",bestFor:["Japanese speech","Arcade voice","Retro talking","Speech FX"],icon:"Mic",color:"text-cyan-400"},MAMEUPD933:{type:"MAMEUPD933",name:"NEC uPD933",shortName:"933",description:"NEC uPD933 raw phase distortion chip - the core of the Casio CZ series",bestFor:["Phase distortion","CZ sounds","Digital bass","Metallic leads"],icon:"Activity",color:"text-violet-400"},MAMEVotrax:{type:"MAMEVotrax",name:"Votrax SC-01",shortName:"Vtrx",description:"Votrax SC-01 - classic 1980s phoneme speech synthesizer chip",bestFor:["Robotic speech","Arcade talking","Q*bert","Retro voice"],icon:"Mic",color:"text-emerald-400"},MAMEYMF271:{type:"MAMEYMF271",name:"Yamaha OPX",shortName:"OPX",description:"Yamaha YMF271 OPX - 12-voice FM+PCM synthesis for arcade hardware",bestFor:["Arcade FM","FM+PCM","Jaleco sounds","Complex FM"],icon:"Radio",color:"text-blue-500"},MAMEYMOPQ:{type:"MAMEYMOPQ",name:"Yamaha OPQ",shortName:"OPQ",description:"Yamaha YM3806 OPQ - 4-op FM synthesis for Yamaha keyboards",bestFor:["FM synthesis","Yamaha sounds","Vintage FM","Keyboard sounds"],icon:"Radio",color:"text-indigo-500"},MAMEVASynth:{type:"MAMEVASynth",name:"Virtual Analog",shortName:"VA",description:"Virtual Analog modeling synthesizer - subtractive with multi-waveform oscillators",bestFor:["Analog modeling","Bass","Leads","Pads","Classic analog"],icon:"Waves",color:"text-pink-500"},VFX:{type:"VFX",name:"Ensoniq VFX",shortName:"VFX",description:"Ensoniq VFX transwave synthesizer - alias for MAMEVFX",bestFor:["Transwave","Digital","Pads","Textures"],icon:"Cpu",color:"text-cyan-500"},D50:{type:"D50",name:"Roland D-50",shortName:"D-50",description:"Roland D-50 virtual analog synthesizer",bestFor:["Digital","Pads","Strings","Vintage digital"],icon:"Cpu",color:"text-rose-500"},ModularSynth:{type:"ModularSynth",name:"Modular Synth",shortName:"Modular",description:"Patch editor with modules (VCO, VCF, VCA, ADSR, LFO) and cable routing",bestFor:["Sound design","Experimental","Custom patches","Flexible routing"],icon:"Cable",color:"text-indigo-500"}},O_=[{id:"bass",name:"Bass",description:"Deep and punchy bass synths",synths:[A_.TB303,A_.MonoSynth,A_.WobbleBass]},{id:"lead",name:"Lead",description:"Melodic lead synthesizers",synths:[A_.Synth,A_.DuoSynth,A_.FMSynth,A_.AMSynth,A_.PluckSynth,A_.SuperSaw,A_.ChipSynth,A_.PWMSynth,A_.FormantSynth,A_.ModularSynth,A_.V2]},{id:"drums",name:"Drums",description:"Percussion and drum synthesis",synths:[A_.MembraneSynth,A_.MetalSynth,A_.NoiseSynth,A_.DrumMachine,A_.DrumKit,A_.Synare,A_.MAMETR707]},{id:"speech",name:"Speech & Voice",description:"Speech synthesis and voice generation",synths:[A_.Sam,A_.V2Speech,A_.MAMETMS5220,A_.MAMEVotrax,A_.MAMESP0250,A_.MAMEMEA8000,A_.MAMEUPD931]},{id:"pads",name:"Pads",description:"Evolving textures and pads",synths:[A_.Wavetable,A_.GranularSynth,A_.PolySynth,A_.StringMachine,A_.HarmonicSynth,A_.V2]},{id:"dub",name:"Dub & FX",description:"Classic sound system and special effects",synths:[A_.DubSiren,A_.SpaceLaser,A_.V2,A_.Synare]},{id:"vintage",name:"Keys",description:"Keyboard instruments",synths:[A_.Organ]},{id:"samples",name:"Samples",description:"Sample-based instruments",synths:[A_.Sampler,A_.Player]},{id:"plugins",name:"Plugins",description:"External Web Audio Modules (WAM 2.0)",synths:[A_.WAMOBXd,A_.WAMSynth101,A_.WAMTinySynth,A_.WAMFaustFlute,A_.WAM]},{id:"fx",name:"FX",description:"Sound effects and noise generators",synths:[A_.DubSiren]},{id:"furnace",name:" Furnace Chips",description:"All Furnace chip emulations - 70+ authentic retro sound chips",synths:[A_.FurnaceOPN,A_.FurnaceOPN2203,A_.FurnaceOPNA,A_.FurnaceOPNB,A_.FurnaceOPNBB,A_.FurnaceOPM,A_.FurnaceOPL,A_.FurnaceOPLL,A_.FurnaceOPL4,A_.FurnaceOPZ,A_.FurnaceY8950,A_.FurnaceESFM,A_.FurnaceVRC7,A_.FurnaceNES,A_.FurnaceGB,A_.FurnaceSNES,A_.FurnacePCE,A_.FurnacePSG,A_.FurnaceVB,A_.FurnaceLynx,A_.FurnaceSWAN,A_.FurnaceNDS,A_.FurnaceGBA,A_.FurnacePOKEMINI,A_.FurnaceVRC6,A_.FurnaceN163,A_.FurnaceFDS,A_.FurnaceMMC5,A_.FurnaceC64,A_.FurnaceSID6581,A_.FurnaceSID8580,A_.FurnaceAY,A_.FurnaceAY8930,A_.FurnaceVIC,A_.FurnacePET,A_.FurnaceSAA,A_.FurnaceTED,A_.FurnaceDAVE,A_.FurnaceVERA,A_.FurnaceSCC,A_.FurnaceTIA,A_.FurnacePOKEY,A_.FurnaceZXBEEPER,A_.FurnaceAMIGA,A_.FurnacePCSPKR,A_.FurnaceSEGAPCM,A_.FurnaceQSOUND,A_.FurnaceES5506,A_.FurnaceRF5C68,A_.FurnaceC140,A_.FurnaceK007232,A_.FurnaceK053260,A_.FurnaceGA20,A_.FurnaceOKI,A_.FurnaceYMZ280B,A_.FurnaceX1_010,A_.FurnaceBUBBLE,A_.FurnaceMULTIPCM,A_.FurnaceMSM6258,A_.FurnaceMSM5232,A_.FurnaceNAMCO,A_.FurnaceSM8521,A_.FurnaceT6W28,A_.FurnaceSUPERVISION,A_.FurnaceUPD1771,A_.FurnacePONG,A_.FurnacePV1000,A_.FurnaceSU,A_.FurnacePOWERNOISE,A_.FurnaceSCVTONE,A_.FurnacePCMDAC,A_.Furnace]},{id:"chiptune-fm",name:"FM Chips",description:"Yamaha FM synthesis chips (OPN, OPL, OPM families)",synths:[A_.FurnaceOPN,A_.FurnaceOPN2203,A_.FurnaceOPNA,A_.FurnaceOPNB,A_.FurnaceOPNBB,A_.FurnaceOPM,A_.FurnaceOPL,A_.FurnaceOPLL,A_.FurnaceOPL4,A_.FurnaceOPZ,A_.FurnaceY8950,A_.FurnaceESFM,A_.FurnaceVRC7]},{id:"chiptune-console",name:"Console Chips",description:"Game console sound chips (Nintendo, Sega, etc.)",synths:[A_.FurnaceNES,A_.FurnaceGB,A_.FurnaceSNES,A_.FurnacePCE,A_.FurnacePSG,A_.FurnaceVB,A_.FurnaceLynx,A_.FurnaceSWAN,A_.FurnaceNDS,A_.FurnaceGBA,A_.FurnacePOKEMINI,A_.FurnaceVRC6,A_.FurnaceN163,A_.FurnaceFDS,A_.FurnaceMMC5]},{id:"chiptune-computer",name:"Computer Chips",description:"Home computer sound chips (C64, Spectrum, etc.)",synths:[A_.FurnaceC64,A_.FurnaceSID6581,A_.FurnaceSID8580,A_.FurnaceAY,A_.FurnaceAY8930,A_.FurnaceVIC,A_.FurnacePET,A_.FurnaceSAA,A_.FurnaceTED,A_.FurnaceDAVE,A_.FurnaceVERA,A_.FurnaceSCC,A_.FurnaceTIA,A_.FurnacePOKEY,A_.FurnaceZXBEEPER,A_.FurnaceAMIGA,A_.FurnacePCSPKR]},{id:"chiptune-arcade",name:"Arcade PCM",description:"Arcade game PCM/ADPCM chips (Sega, Namco, Konami, Capcom)",synths:[A_.FurnaceSEGAPCM,A_.FurnaceQSOUND,A_.FurnaceES5506,A_.FurnaceRF5C68,A_.FurnaceC140,A_.FurnaceK007232,A_.FurnaceK053260,A_.FurnaceGA20,A_.FurnaceOKI,A_.FurnaceYMZ280B,A_.FurnaceX1_010,A_.FurnaceBUBBLE,A_.FurnaceMULTIPCM,A_.FurnaceMSM6258,A_.FurnaceMSM5232,A_.FurnaceNAMCO]},{id:"chiptune-other",name:"Other Chips",description:"Obscure and miscellaneous sound chips",synths:[A_.FurnaceSM8521,A_.FurnaceT6W28,A_.FurnaceSUPERVISION,A_.FurnaceUPD1771,A_.FurnacePONG,A_.FurnacePV1000,A_.FurnaceSU,A_.FurnacePOWERNOISE,A_.FurnaceSCVTONE,A_.FurnacePCMDAC,A_.Furnace]},{id:"buzzmachines",name:"Buzzmachines",description:"Jeskola Buzz machines - classic tracker synths and drums",synths:[A_.Buzz3o3,A_.Buzz3o3DF,A_.BuzzM3,A_.BuzzM4,A_.Buzz4FM2F,A_.BuzzDynamite6,A_.BuzzKick,A_.BuzzKickXP,A_.BuzzTrilok,A_.BuzzNoise,A_.BuzzFreqBomb,A_.BuzzDTMF]},{id:"mame-synths",name:"MAME Hardware Synths",description:"Hardware-accurate synth and keyboard chip emulations",synths:[A_.MAMEVFX,A_.MAMEDOC,A_.MAMEES5503,A_.MAMERSA,A_.MAMESWP30,A_.CZ101,A_.MAMEUPD933,A_.CEM3394,A_.SCSP,A_.MAMEVASynth,A_.MAMEYMF271,A_.MAMEYMOPQ]},{id:"mame-arcade",name:"MAME Arcade & Retro",description:"Arcade game and retro computer sound chips (MAME-emulated)",synths:[A_.MAMEAICA,A_.MAMEASC,A_.MAMEAstrocade,A_.MAMEC352,A_.MAMEICS2115,A_.MAMEK054539,A_.MAMEMSM5232,A_.MAMERF5C400,A_.MAMESN76477,A_.MAMESNKWave,A_.MAMETIA,A_.MAMETMS36XX]},{id:"juce-synths",name:" JUCE Synths",description:"Professional quality WASM-based synth emulations",synths:[A_.Dexed,A_.OBXd]},{id:"vstbridge",name:" VST Bridge",description:"Open-source synths ported via the generic VSTBridge framework",synths:[A_.Vital,A_.Surge,A_.Odin2,A_.DexedBridge,A_.TonewheelOrgan,A_.Melodica,A_.Monique]}],I_=Object.keys(A_).sort((e,t)=>A_[e].shortName.localeCompare(A_[t].shortName));function F_(e){return A_[e]}const D_=({compact:e=!1})=>{const{instruments:t,currentInstrumentId:a,setCurrentInstrument:n}=Bv(),r=Vv(e=>e.useHexNumbers),[i,o]=s.useState(!1),l=s.useRef(null),c=s.useRef(a??0);s.useEffect(()=>{c.current=a??0},[a]);const u=[...t].sort((e,t)=>e.id-t.id),d=t.find(e=>e.id===a);s.useEffect(()=>{if(!i)return;const e=e=>{l.current&&!l.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[i]);const p=s.useCallback(e=>{const t=u.findIndex(e=>e.id===c.current);if(-1===t)return;const a=t+e;if(a>=0&&a<u.length){const e=u[a].id;c.current=e,n(e)}},[u,n]),m=s.useRef(null),h=s.useRef(null);s.useEffect(()=>()=>{m.current&&clearInterval(m.current),h.current&&clearTimeout(h.current)},[]);const f=s.useCallback(e=>{e(),h.current&&clearTimeout(h.current),m.current&&clearInterval(m.current),h.current=window.setTimeout(()=>{m.current=window.setInterval(e,80)},300)},[]),y=s.useCallback(()=>{h.current&&(clearTimeout(h.current),h.current=null),m.current&&(clearInterval(m.current),m.current=null)},[]),g=e=>r?e.toString(16).toUpperCase().padStart(2,"0"):e.toString(10).padStart(2,"0");return Ea.jsxs("div",{className:"ft2-numeric-group relative",ref:l,children:[Ea.jsx("span",{className:"ft2-numeric-label",children:"Instr:"}),Ea.jsx("button",{className:"ft2-numeric-value cursor-pointer hover:bg-dark-bgHover rounded px-1",onClick:()=>o(!i),title:d?.name||"Select instrument",children:g(a??0)}),!e&&d&&Ea.jsx("span",{className:"ml-1 text-[10px] text-text-muted truncate max-w-[60px]",title:d.name,children:d.name.slice(0,8)}),Ea.jsxs("div",{className:"ft2-numeric-arrows",children:[Ea.jsx("button",{className:"ft2-arrow ft2-arrow-up",onMouseDown:()=>f(()=>p(-1)),onMouseUp:y,onMouseLeave:y,onTouchStart:()=>f(()=>p(-1)),onTouchEnd:y,title:"Previous instrument",children:Ea.jsx("span",{className:"ft2-arrow-icon",children:""})}),Ea.jsx("button",{className:"ft2-arrow ft2-arrow-down",onMouseDown:()=>f(()=>p(1)),onMouseUp:y,onMouseLeave:y,onTouchStart:()=>f(()=>p(1)),onTouchEnd:y,title:"Next instrument",children:Ea.jsx("span",{className:"ft2-arrow-icon",children:""})})]}),i&&Ea.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 max-h-64 overflow-y-auto bg-dark-bgTertiary border border-dark-border rounded shadow-xl z-50 scrollbar-modern",children:u.map(e=>{const t=F_(e.synthType),s=(r=t.icon,Ht[r]||Kt);var r;const i=e.id===a;return Ea.jsxs("div",{onClick:()=>{return t=e.id,n(t),void o(!1);var t},className:`\n                  flex items-center gap-2 px-3 py-2 cursor-pointer transition-colors\n                  ${i?"bg-accent-primary/20 text-text-primary":"hover:bg-dark-bgHover text-text-secondary"}\n                `,children:[Ea.jsx("span",{className:"font-mono text-xs w-5 text-text-muted",children:g(e.id)}),Ea.jsx(s,{size:12,className:t.color}),Ea.jsx("span",{className:"flex-1 text-xs truncate",children:e.name}),Ea.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:t.shortName})]},e.id)})})]})};const R_=new Map;function j_(e){const t=R_.get(e);return!(!t||t.closed)&&(t.focus(),!0)}const B_=({isOpen:e,onClose:t,title:a="DEViLBOX",width:n=900,height:r=600,fitContent:i=!1,children:o})=>{const l=s.useRef(null),c=s.useRef(!1),[u,d]=s.useState(!1),[p,m]=s.useState(null),h=s.useRef(t);return s.useEffect(()=>{h.current=t}),s.useEffect(()=>{if(!e){l.current&&!l.current.closed&&l.current.close(),l.current=null;const e=requestAnimationFrame(()=>{m(null),d(!1)});return()=>cancelAnimationFrame(e)}if(l.current&&!l.current.closed)return void l.current.focus();const s=Math.round(screen.width/2-n/2),o=Math.round(screen.height/2-r/2),u=["popup=yes",`width=${n}`,`height=${r}`,`left=${s}`,`top=${o}`,"toolbar=no","location=no","menubar=no","status=no"].join(","),p=window.open("","",u);if(!p)return px.warning("Popup blocked  please allow popups for this site"),void t();l.current=p,R_.set(a,p),p.document.open(),p.document.write(`<!DOCTYPE html><html><head><title>${a}</title><style>\n      html, body { margin: 0; padding: 0; background: #0b0909; color: #f2f0f0; overflow: auto; height: 100%; }\n      #popout-root { display: inline-block; min-width: 100%; }\n    </style></head><body><div id="popout-root"></div></body></html>`),p.document.close();const f=p.document.head;document.head.querySelectorAll("style").forEach(e=>{const t=p.document.createElement("style");t.textContent=e.textContent,t.dataset.cloned="true",f.appendChild(t)}),document.head.querySelectorAll('link[rel="stylesheet"]').forEach(e=>{const t=p.document.createElement("link");t.rel="stylesheet",t.href=e.href,t.dataset.cloned="true",f.appendChild(t)});const y=p.document.getElementById("popout-root");requestAnimationFrame(()=>{m(y),d(!0)});let g=null;if(i){let e=!1;g=new ResizeObserver(()=>{e||p.closed||requestAnimationFrame(()=>{if(p.closed)return;const t=y.scrollWidth,a=y.scrollHeight;if(t>0&&a>0){const n=t+(p.outerWidth-p.innerWidth),s=a+(p.outerHeight-p.innerHeight),r=Math.round(screen.width/2-n/2),i=Math.round(screen.height/2-s/2);p.moveTo(Math.max(0,r),Math.max(0,i)),p.resizeTo(Math.min(n,screen.availWidth),Math.min(s,screen.availHeight)),e=!0}})}),g.observe(y)}const b=new MutationObserver(e=>{if(!p.closed)for(const t of e){for(const e of t.addedNodes){if(e instanceof HTMLStyleElement){const t=p.document.createElement("style");t.textContent=e.textContent,t.dataset.cloned="true",p.document.head.appendChild(t)}if(e instanceof HTMLLinkElement&&"stylesheet"===e.rel){const t=p.document.createElement("link");t.rel="stylesheet",t.href=e.href,t.dataset.cloned="true",p.document.head.appendChild(t)}}for(const e of t.removedNodes){if(p.closed)return;if(e instanceof HTMLStyleElement||e instanceof HTMLLinkElement){p.document.head.querySelectorAll('[data-cloned="true"]').forEach(t=>{(t instanceof HTMLStyleElement&&e instanceof HTMLStyleElement&&t.textContent===e.textContent||t instanceof HTMLLinkElement&&e instanceof HTMLLinkElement&&t.href===e.href)&&t.remove()})}}}});b.observe(document.head,{childList:!0}),c.current=!1;const v=()=>{c.current||(c.current=!0,m(null),d(!1),setTimeout(()=>h.current(),0))};return p.addEventListener("pagehide",v),p.onbeforeunload=v,()=>{g?.disconnect(),b.disconnect(),c.current=!0,R_.delete(a),p&&!p.closed&&(p.removeEventListener("pagehide",v),p.onbeforeunload=null,p.close()),l.current=null,m(null),d(!1)}},[e,a,n,r,i]),e&&u&&p?uS.createPortal(o,p):null},L_=({children:e,className:t="",variant:a="default",style:n})=>Ea.jsxs("div",{className:`viz-frame viz-frame--${a} ${t}`,style:n,children:[Ea.jsx("div",{className:"viz-frame__content",children:e}),Ea.jsx("div",{className:"viz-frame__vignette"})]}),V_=({width:e=800,height:t=120,mode:a="waveform"})=>{const n=s.useRef(null),r=s.useRef(null),i=s.useRef(0),{analyserNode:o,fftNode:l}=$v(),[c,u]=s.useState(800),d="auto"!==e?e:c;s.useEffect(()=>{if("auto"!==e)return;const t=n.current;if(!t)return;const a=()=>{const e=t.getBoundingClientRect();u(Math.floor(e.width))};a();const s=new ResizeObserver(a);return s.observe(t),()=>s.disconnect()},[e]);const{currentThemeId:p}=cx(),m="cyan-lineart"===p,h=Kv(e=>e.isPlaying);return s.useEffect(()=>{const e=r.current;if(!e)return;const n=e.getContext("2d");if(!n)return;if(e.width=d,e.height=t,!h){const e=m?"#030808":"#0a0a0b",a=m?"rgba(0, 255, 255, 0.08)":"#1a1a1d",s=m?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)";n.fillStyle=e,n.fillRect(0,0,d,t),n.strokeStyle=a,n.lineWidth=1;for(let r=0;r<d;r+=50)n.beginPath(),n.moveTo(r,0),n.lineTo(r,t),n.stroke();for(let r=0;r<t;r+=30)n.beginPath(),n.moveTo(0,r),n.lineTo(d,r),n.stroke();return n.strokeStyle=s,n.beginPath(),n.moveTo(0,t/2),n.lineTo(d,t/2),void n.stroke()}let s=!0,c=0;const u=1e3/30,p=m?"#030808":"#0a0a0b",f=m?"rgba(0, 255, 255, 0.08)":"#1a1a1d",y=m?"#00ffff":"#00d4aa",g=m?"#00ffff":"#7c3aed",b=m?"rgba(0, 255, 255, 0.2)":"rgba(0, 212, 170, 0.2)",v=n.createLinearGradient(0,0,d,0);v.addColorStop(0,y),v.addColorStop(.5,y),v.addColorStop(1,g);const x=[];if("spectrum"===a)for(let t=0;t<1024;t++)if(m)x.push("rgba(0, 255, 255, 0.75)");else{const e=160+t/1024*120;x.push(`hsla(${e}, 80%, 50%, 0.8)`)}const w=r=>{if(!s||!e||!n)return;const h=r-c;if(h<u)i.current=requestAnimationFrame(w);else{c=r-h%u,n.fillStyle=p,n.fillRect(0,0,d,t),n.strokeStyle=f,n.lineWidth=1;for(let e=0;e<d;e+=50)n.beginPath(),n.moveTo(e,0),n.lineTo(e,t),n.stroke();for(let e=0;e<t;e+=30)n.beginPath(),n.moveTo(0,e),n.lineTo(d,e),n.stroke();if("waveform"===a&&o){const e=o.getValue();n.strokeStyle=v,n.lineWidth=2,n.beginPath();const a=d/e.length;let s=0;for(let r=0;r<e.length;r++){const i=(e[r]+1)/2*t;0===r?n.moveTo(s,i):n.lineTo(s,i),s+=a}n.stroke(),n.strokeStyle=b,n.lineWidth=1,n.beginPath(),n.moveTo(0,t/2),n.lineTo(d,t/2),n.stroke()}else if("spectrum"===a&&l){const e=l.getValue(),a=d/e.length;let s=0;for(let r=0;r<e.length;r++){const i=(e[r]+100)/100,o=i*t;m?(n.globalAlpha=.5+.5*i,n.fillStyle="rgb(0, 255, 255)"):n.fillStyle=x[r]||x[x.length-1],n.fillRect(s,t-o,a-1,o),s+=a}n.globalAlpha=1}i.current=requestAnimationFrame(w)}};return i.current=requestAnimationFrame(w),()=>{s=!1,i.current&&cancelAnimationFrame(i.current)}},[d,t,a,o,l,m,h]),Ea.jsx("div",{ref:n,className:"auto"===e?"w-full":"",children:Ea.jsx("canvas",{ref:r,style:{width:"auto"===e?"100%":`${d}px`,height:`${t}px`}})})},z_=({height:e=100,width:t="auto"})=>{const a=s.useRef(null),n=s.useRef(null),r=s.useRef(null),i=s.useRef([]),o=s.useRef([]),{patterns:l,currentPatternIndex:c}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),u=Kv(e=>e.isPlaying),{currentThemeId:d}=cx(),p=l[c],m=p?.channels.length||4,h="cyan-lineart"===d;s.useEffect(()=>{i.current=new Array(m).fill(0),o.current=new Array(m).fill(null).map(()=>({level:0,frames:0}))},[m]);const f=s.useRef(m),y=s.useRef(e),g=s.useRef(h);return s.useEffect(()=>{f.current=m},[m]),s.useEffect(()=>{y.current=e},[e]),s.useEffect(()=>{g.current=h},[h]),s.useEffect(()=>{if(!u){r.current&&(cancelAnimationFrame(r.current),r.current=null);const t=n.current,s=a.current;if(t&&s){const a=t.getContext("2d");if(a){const n=s.clientWidth;t.width=n,t.height=e;const r=h?"#030808":"#0a0a0b";a.fillStyle=r,a.fillRect(0,0,n,e);const i=Math.max(6,(e-24-3*(m-1))/m),o=n-40,l=12;for(let e=0;e<m;e++){const t=l+e*(i+3);a.fillStyle=h?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",a.font="9px monospace",a.textAlign="left",a.fillText(`${e+1}`,4,t+i-1),a.fillStyle=h?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",a.fillRect(20,t,o,i)}a.fillStyle=h?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",a.font="10px sans-serif",a.textAlign="center",a.fillText("Channel Levels",n/2,e-3)}}return i.current=new Array(m).fill(0),void(o.current=new Array(m).fill(null).map(()=>({level:0,frames:0})))}const t=()=>{const e=n.current,s=a.current;if(!e||!s)return void(r.current=requestAnimationFrame(t));const l=e.getContext("2d");if(!l)return void(r.current=requestAnimationFrame(t));const c=f.current,u=y.current,d=g.current,p=s.clientWidth;e.width===p&&e.height===u||(e.width=p,e.height=u);const m=Qg().getChannelTriggerLevels(c);for(let t=0;t<c;t++){const e=m[t]||0,a=i.current[t]||0;e>a?i.current[t]=a+.7*(e-a):(i.current[t]=.88*a,i.current[t]<.01&&(i.current[t]=0));const n=o.current[t];i.current[t]>=n.level?(n.level=i.current[t],n.frames=30):n.frames>0?n.frames--:(n.level*=.95,n.level<.01&&(n.level=0))}const h=d?"#030808":"#0a0a0b";l.fillStyle=h,l.fillRect(0,0,p,u);const b=Math.max(6,(u-24-3*(c-1))/c),v=p-40;for(let t=0;t<c;t++){const e=12+t*(b+3),a=i.current[t],n=o.current[t],s=a*v,r=20+n.level*v;if(l.fillStyle=d?"rgba(0, 255, 255, 0.5)":"rgba(255, 255, 255, 0.4)",l.font="9px monospace",l.textAlign="left",l.fillText(`${t+1}`,4,e+b-1),l.fillStyle=d?"rgba(0, 255, 255, 0.1)":"rgba(255, 255, 255, 0.1)",l.fillRect(20,e,v,b),s>0){const t=l.createLinearGradient(20,0,20+v,0);d?(t.addColorStop(0,"rgba(0, 200, 200, 0.8)"),t.addColorStop(.7,"rgba(0, 255, 255, 1)"),t.addColorStop(1,"rgba(255, 100, 100, 1)")):(t.addColorStop(0,"rgba(0, 180, 140, 0.8)"),t.addColorStop(.7,"rgba(0, 212, 170, 1)"),t.addColorStop(1,"rgba(255, 80, 80, 1)")),l.fillStyle=t,l.fillRect(20,e,s,b)}n.level>.02&&(l.fillStyle=d?"#00ffff":"#ff4444",l.fillRect(r-1,e,2,b))}l.fillStyle=d?"rgba(0, 255, 255, 0.4)":"rgba(255, 255, 255, 0.3)",l.font="10px sans-serif",l.textAlign="center",l.fillText("Channel Levels",p/2,u-3),r.current=requestAnimationFrame(t)};return r.current=requestAnimationFrame(t),()=>{r.current&&(cancelAnimationFrame(r.current),r.current=null)}},[u,m,e,h]),Ea.jsx("div",{ref:a,className:"auto"===t?"w-full":"",children:Ea.jsx("canvas",{ref:n,style:{width:"100%",height:`${e}px`}})})},U_=e.memo(({height:e=100,onComplete:t})=>{const a=s.useRef(null),n=s.useRef(null),[r,i]=s.useState(null),o=s.useRef(null),l=s.useRef(null),c=s.useRef(t);s.useEffect(()=>{c.current=t},[t]);const u=s.useRef(!1),{currentThemeId:d}=cx(),p="cyan-lineart"===d;s.useEffect(()=>{fetch("/DEViLBOX/assets/up-rough-logo.svg").then(e=>e.text()).then(e=>{let t=e;t=t.replace(/stroke="#000"/g,'stroke="currentColor"'),t=t.replace(/stroke-width="0"/g,'stroke-width="0" fill="currentColor"'),i(t)}).catch(e=>{})},[]);s.useEffect(()=>(u.current=!1,l.current=setTimeout(()=>{(()=>{if(!n.current)return;const e=n.current.querySelector("svg");e&&(e.querySelectorAll("*").forEach(e=>{e.style.animationPlayState="paused"}),e.style.animationPlayState="paused")})(),u.current=!0,c.current?.()},1e4),()=>{l.current&&clearTimeout(l.current)}),[]);const m=s.useRef(p);s.useEffect(()=>{m.current=p},[p]),s.useEffect(()=>{const e=()=>{if(!n.current)return void(o.current=requestAnimationFrame(e));const t=n.current,a=m.current?"#00ffff":"#00d4aa";t.style.color=a,t.style.transform="scale(1.5)",t.style.filter="",o.current=requestAnimationFrame(e)};return o.current=requestAnimationFrame(e),()=>{o.current&&(cancelAnimationFrame(o.current),o.current=null)}},[]);const h=p?"#00ffff":"#00d4aa";return Ea.jsx("div",{ref:a,className:"w-full flex items-center justify-center overflow-hidden",style:{height:`${e}px`},onClick:e=>{e.stopPropagation(),l.current&&clearTimeout(l.current),o.current&&cancelAnimationFrame(o.current),c.current?.()},title:"Click to skip",children:r?Ea.jsx("div",{ref:n,className:"flex items-center justify-center",style:{height:"100%",width:"100%",color:h,transformOrigin:"center center",transform:"scale(1.5)"},dangerouslySetInnerHTML:{__html:r}}):Ea.jsx("span",{className:"text-text-muted text-sm",children:"Loading..."})})}),G_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const i=window.devicePixelRatio||1;s.width=n*i,s.height=e*i,r.scale(i,i);const o=n/2,l=e/2,c=.4*Math.min(n,e),u=()=>{r.clearRect(0,0,n,e);const t=Qg().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}r.strokeStyle="#333",r.lineWidth=2,r.beginPath(),r.arc(o,l,c,0,2*Math.PI),r.stroke();for(let e=0;e<3;e++){const t=c*(.4+.2*e),a=Math.max(0,s-.3*e);if(a>0){const e=2*Math.PI*Math.min(2*a,1),n=r.createLinearGradient(o-t,l,o+t,l);n.addColorStop(0,"#00d4aa"),n.addColorStop(.5,"#00ffff"),n.addColorStop(1,"#00d4aa"),r.strokeStyle=n,r.lineWidth=8,r.lineCap="round",r.beginPath(),r.arc(o,l,t,-Math.PI/2,-Math.PI/2+e),r.stroke()}}r.fillStyle=s>.5?"#00ffff":"#333",r.beginPath(),r.arc(o,l,4,0,2*Math.PI),r.fill(),a.current=requestAnimationFrame(u)};return u(),()=>{a.current&&cancelAnimationFrame(a.current)}},[n,e]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},W_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),i=s.useRef([]);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const l=n/32,c=new Array(32).fill(0);i.current=Array.from({length:32},(t,a)=>{const n=a*l,s=r.createLinearGradient(n,0,n,e);return s.addColorStop(0,"#00ffff"),s.addColorStop(.5,"#00d4aa"),s.addColorStop(1,"#006655"),s});const u=Qg();u.enableAnalysers();const d=()=>{r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Qg().getFFT();if(t){const a=t,n=Math.floor(a.length/32);for(let t=0;t<32;t++){const s=(a[t*n]+140)/140,o=Math.max(0,Math.min(1,s))*e*.9;c[t]+=.3*(o-c[t]);const u=t*l,d=c[t];r.fillStyle=i.current[t],r.fillRect(u+1,e-d,l-2,d),r.fillStyle="rgba(0, 255, 255, 0.5)",r.fillRect(u+1,e-d,l-2,2),r.fillStyle="rgba(0, 0, 0, 0.3)",r.fillRect(u+l-2,e-d,1,d)}}a.current=requestAnimationFrame(d)};return d(),()=>{a.current&&cancelAnimationFrame(a.current),u.disableAnalysers()}},[n,e]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},H_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),n=s.useRef([]),[r,i]=s.useState(300);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&i(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const i=s.getContext("2d");if(!i)return;const o=window.devicePixelRatio||1;s.width=r*o,s.height=e*o,i.scale(o,o);const l=n.current,c=Qg();c.enableAnalysers();const u=(e,t,a)=>({x:e,y:t,vx:(Math.random()-.5)*a*4,vy:(Math.random()-.5)*a*4,size:3*Math.random()+1,life:1}),d=()=>{i.fillStyle="rgba(10, 10, 11, 0.15)",i.fillRect(0,0,r,e);const t=Qg().getWaveform();let n=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);n=Math.min(1,10*e)}if(n>.1&&l.length<150){const t=Math.floor(8*n);for(let a=0;a<t;a++)l.push(u(r/2+40*(Math.random()-.5),e/2+40*(Math.random()-.5),n))}for(let a=l.length-1;a>=0;a--){const t=l[a];t.x+=t.vx,t.y+=t.vy,t.life-=.015;const s=r/2-t.x,o=e/2-t.y,c=s*s+o*o;if(c>400){const e=2/c;t.vx+=s*e,t.vy+=o*e}if(t.vx*=.98,t.vy*=.98,t.life<=0){l.splice(a,1);continue}const u=t.life,d=(60*t.life+160)%360;i.fillStyle=`hsla(${d}, 100%, 60%, ${u})`,i.beginPath(),i.arc(t.x,t.y,t.size*t.life,0,2*Math.PI),i.fill(),n>.5&&(i.fillStyle=`hsla(${d}, 100%, 80%, ${.3*u})`,i.beginPath(),i.arc(t.x,t.y,t.size*t.life*2,0,2*Math.PI),i.fill())}a.current=requestAnimationFrame(d)};return d(),()=>{a.current&&cancelAnimationFrame(a.current),n.current=[],c.disableAnalysers()}},[r,e]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},K_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),l=i[o],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const u=Math.min(4,c),d=Math.ceil(c/u),p=n/u,m=e/d,h=Qg();h.enableAnalysers();const f=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Qg().getWaveform();if(t){const e=t;for(let t=0;t<c;t++){const a=Math.floor(t/u),n=t%u*p,s=a*m;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(n,s,p,m),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,n+4,s+10);const i=4,o=m-2*i-12,d=s+i+12,h=Math.max(1,Math.floor(e.length/(p-2*i))),f=Math.floor(t/c*e.length),y=123*t%e.length;r.strokeStyle=l?.channels[t]?.muted?"#333":"#00d4aa",r.lineWidth=1.5,r.beginPath();for(let l=0;l<p-2*i;l++){let a=e[(f+l*h+y)%e.length];a=a*(.3+t/c*.5)*(1+t%3);const s=n+i+l,u=d+o/2+a*o*.4;0===l?r.moveTo(s,u):r.lineTo(s,u)}r.stroke()}}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current),h.disableAnalysers()}},[n,e,c,l]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},q_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),l=i[o],c=l?.channels.length||4,u=s.useRef(new Array(32).fill(0));return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const d=Math.min(8,c),p=Math.ceil(c/d),m=n/d,h=e/p,f=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Qg().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/d),a=e%d*m,n=t*h,i=Date.now()/1e3,o=2.1*e,c=.4*Math.sin(2*i+o)+.3*Math.cos(1.3*i+.7*o),p=.5+e%4*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*p+c));u.current[e]+=.2*(f-u.current[e]);const y=u.current[e],g=2;r.fillStyle="#111",r.fillRect(a+g,n+g,m-2*g,h-2*g);const b=(h-2*g)*y,v=r.createLinearGradient(a,n+h,a,n+h-b);y>.8?(v.addColorStop(0,"#ff0000"),v.addColorStop(.3,"#ffff00"),v.addColorStop(1,"#00ff00")):y>.5?(v.addColorStop(0,"#ffff00"),v.addColorStop(1,"#00ff00")):(v.addColorStop(0,"#00ff00"),v.addColorStop(1,"#00d4aa")),r.fillStyle=v,r.fillRect(a+g,n+h-g-b,m-2*g,b),r.fillStyle=y>.5?"#000":"#666",r.font="9px monospace",r.textAlign="center",r.fillText((e+1).toString(),a+m/2,n+h/2+3),r.strokeStyle=l?.channels[e]?.solo?"#00ffff":"#222",r.lineWidth=l?.channels[e]?.solo?2:1,r.strokeRect(a+g,n+g,m-2*g,h-2*g)}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},$_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),l=i[o],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const u=Math.min(4,c),d=Math.ceil(c/u),p=n/u,m=e/d,h=Qg();h.enableAnalysers();const f=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Qg().getFFT();if(t){const e=t,a=16,n=Date.now()/1e3;for(let t=0;t<c;t++){const s=Math.floor(t/u),i=t%u*p,o=s*m;r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(i,o,p,m),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${t+1}`,i+4,o+10);const d=4,h=(p-2*d)/a,f=m-2*d-12;for(let u=0;u<a;u++){const s=Math.floor(t/c*e.length*.6),p=(e[(Math.floor(u/a*e.length)+s)%e.length]+140)/140,m=1.7*t,y=.4+t%3*.3,g=Math.max(0,Math.min(1,p))*f*(l?.channels[t]?.muted?0:.3*Math.sin(1.5*n+m+.4*u)+y),b=i+d+u*h,v=o+d+12+f-g,x=u/a*180+180;r.fillStyle=`hsl(${x}, 80%, 50%)`,r.fillRect(b,v,h-1,g)}}}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current),h.disableAnalysers()}},[n,e,c,l]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},X_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),l=i[o],c=l?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const u=Math.min(4,c),d=Math.ceil(c/u),p=n/u,m=e/d,h=()=>{if(!i)return;r.fillStyle="#0a0a0b",r.fillRect(0,0,n,e);const t=Qg().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/u),a=e%u*p,n=t*m,i=Date.now()/1e3,o=2.5*e,d=.3*Math.sin(2*i+o),h=.6+e%3*.2,f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*h+d));r.strokeStyle="#222",r.lineWidth=1,r.strokeRect(a,n,p,m),r.fillStyle="#555",r.font="8px monospace",r.fillText(`CH${e+1}`,a+4,n+10);const y=a+p/2,g=n+m/2,b=Math.min(p,m)/2-12;r.strokeStyle="#333",r.lineWidth=1,r.beginPath(),r.arc(y,g,b,0,2*Math.PI),r.stroke();const v=2;for(let s=0;s<v;s++){const t=b*(.5+.3*s),a=Math.max(0,f-.4*s);if(a>0){const n=2*Math.PI*Math.min(1.5*a,1),s=(i+.3*e)%(2*Math.PI),o=160+e/c*60;r.strokeStyle=`hsl(${o}, 80%, 50%)`,r.lineWidth=4,r.lineCap="round",r.beginPath(),r.arc(y,g,t,-Math.PI/2+s,-Math.PI/2+s+n),r.stroke()}}r.fillStyle=f>.5?"#00ffff":"#333",r.beginPath(),r.arc(y,g,3,0,2*Math.PI),r.fill()}a.current=requestAnimationFrame(h)};return h(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},Y_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),n=s.useRef([]),[r,i]=s.useState(300),{patterns:o,currentPatternIndex:l}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),c=o[l],u=c?.channels.length||4;return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&i(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const i=s.getContext("2d");if(!i)return;let o=!0;const l=window.devicePixelRatio||1;s.width=r*l,s.height=e*l,i.scale(l,l);const d=Math.min(4,u),p=Math.ceil(u/d),m=r/d,h=e/p;n.current=Array(u).fill(0).map(()=>[]);const f=()=>{if(!o)return;i.fillStyle="#0a0a0b",i.fillRect(0,0,r,e);const t=Qg().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<u;e++){const t=Math.floor(e/d),a=e%d*m,r=t*h,o=Date.now()/1e3,l=2.3*e,p=.35*Math.sin(2.5*o+l),f=.5+e%4*.25,y=c?.channels[e]?.muted?0:Math.max(0,Math.min(1,s*f+p));i.strokeStyle="#222",i.lineWidth=1,i.strokeRect(a,r,m,h),i.fillStyle="#555",i.font="8px monospace",i.fillText(`CH${e+1}`,a+4,r+10);const g=a+m/2,b=r+h/2,v=20,x=n.current[e];if(y>.1&&x.length<v){const t=Math.floor(3*y);for(let a=0;a<t;a++){const t=Math.random()*Math.PI*2,a=.5+1.5*Math.random();x.push({x:g,y:b,vx:Math.cos(t)*a,vy:Math.sin(t)*a,life:1,maxLife:.5+.5*Math.random(),channelIndex:e})}}for(let n=x.length-1;n>=0;n--){const t=x[n];t.x+=t.vx,t.y+=t.vy;const a=g-t.x,s=b-t.y;if(Math.sqrt(a*a+s*s)>5&&(t.vx+=.01*a,t.vy+=.01*s),t.vx*=.98,t.vy*=.98,t.life-=.02,t.life<=0){x.splice(n,1);continue}const r=t.life,o=160+e/u*60,l=2+2*r;i.fillStyle=`hsla(${o}, 80%, 50%, ${.8*r})`,i.beginPath(),i.arc(t.x,t.y,l,0,2*Math.PI),i.fill(),i.fillStyle=`hsla(${o}, 80%, 50%, ${.2*r})`,i.beginPath(),i.arc(t.x,t.y,2*l,0,2*Math.PI),i.fill()}}a.current=requestAnimationFrame(f)};return f(),()=>{o=!1,a.current&&cancelAnimationFrame(a.current)}},[r,e,u,c]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${r}px`,height:`${e}px`}})})},Z_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),l=i[o],c=l?.channels.length||4,u=s.useRef(new Array(32).fill(0));return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const d=Math.min(4,c),p=Math.ceil(c/d),m=n/d,h=e/p,f=()=>{if(!i)return;r.fillStyle="#000",r.fillRect(0,0,n,e);const t=Qg().getWaveform();let s=0;if(t&&t.length>0){const e=Math.sqrt(t.reduce((e,t)=>e+t*t,0)/t.length);s=Math.min(1,10*e)}for(let e=0;e<c;e++){const t=Math.floor(e/d),a=e%d*m,n=t*h,i=Date.now()/1e3,o=1.5*e,p=.2*Math.sin(3*i+o),f=l?.channels[e]?.muted?0:Math.max(0,Math.min(1,s+p));u.current[e]+=.15*(f-u.current[e]);const y=u.current[e],g=a+m/2,b=n+h/2,v=Math.min(m,h)/2-10;r.fillStyle="#333",r.font="8px monospace",r.fillText((e+1).toString(),a+4,n+10);const x=3;for(let s=0;s<x;s++){const t=Math.max(0,y-.2*s),a=v/x*(s+1)+10*t,n=.2+.8*t,i=180+e/c*120+20*s;r.beginPath(),r.arc(g,b,a,0,2*Math.PI),r.strokeStyle=`hsla(${i}, 80%, 50%, ${n})`,r.lineWidth=1+3*t,r.stroke(),t>.3&&(r.shadowBlur=10*t,r.shadowColor=`hsla(${i}, 100%, 50%, 0.5)`,r.stroke(),r.shadowBlur=0)}r.strokeStyle="#111",r.lineWidth=1,r.beginPath(),r.moveTo(g-5,b),r.lineTo(g+5,b),r.moveTo(g,b-5),r.lineTo(g,b+5),r.stroke()}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},Q_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),l=i[o],c=l?.channels.length||4,u=s.useRef(0);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const d=Math.min(4,c),p=Math.ceil(c/d),m=n/d,h=e/p,f=()=>{if(!i)return;r.fillStyle="#000",r.fillRect(0,0,n,e);const t=Qg().getFFT();u.current+=.05;for(let e=0;e<c;e++){const a=Math.floor(e/d),n=e%d*m,s=a*h,i=n+m/2,o=s+h/2;let p=0;if(t&&t.length>0){const a=e*Math.floor(t.length/c);let n=0;for(let e=0;e<10;e++)n+=(t[a+e]+140)/140;p=Math.max(0,Math.min(1,n/10))}l?.channels[e]?.muted&&(p=0);const f=8;for(let t=0;t<f;t++){const a=(t/f+u.current%(1/f))%1,l=1-a,d=.8*a,y=200+e/c*100+50*a;r.strokeStyle=`hsla(${y}, 80%, 50%, ${d})`,r.lineWidth=1+2*p;const g=m*l,b=h*l;r.strokeRect(i-g/2,o-b/2,g,b),0===t&&p>.5&&(r.beginPath(),r.moveTo(n,s),r.lineTo(i-g/2,o-b/2),r.moveTo(n+m,s),r.lineTo(i+g/2,o-b/2),r.moveTo(n,s+h),r.lineTo(i-g/2,o+b/2),r.moveTo(n+m,s+h),r.lineTo(i+g/2,o+b/2),r.stroke())}const y=r.createRadialGradient(i,o,0,i,o,10+20*p),g=180+e/c*60;y.addColorStop(0,`hsla(${g}, 100%, 70%, ${.5*p})`),y.addColorStop(1,"transparent"),r.fillStyle=y,r.fillRect(n,s,m,h)}a.current=requestAnimationFrame(f)};return f(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},J_=({height:e=100})=>{const t=s.useRef(null),a=s.useRef(void 0),[n,r]=s.useState(300),{patterns:i,currentPatternIndex:o}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex}))),l=i[o],c=l?.channels.length||4,u=s.useRef(0),d=s.useRef([]);return s.useEffect(()=>{const e=t.current;if(!e)return;const a=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&r(e)}});return a.observe(e.parentElement),()=>a.disconnect()},[]),s.useEffect(()=>{const s=t.current;if(!s)return;const r=s.getContext("2d");if(!r)return;let i=!0;const o=window.devicePixelRatio||1;s.width=n*o,s.height=e*o,r.scale(o,o);const p=Math.min(4,c),m=Math.ceil(c/p),h=n/p,f=e/m;d.current.length!==c&&(d.current=Array(c).fill(0).map(()=>[]));const y=()=>{if(!i)return;r.fillStyle="#000",r.fillRect(0,0,n,e);const t=Qg().getWaveform();u.current+=.05;for(let e=0;e<c;e++){const a=Math.floor(e/p),n=e%p*h+h/2,s=a*f+f/2,i=Math.min(h,f)/2-5;r.strokeStyle="#111",r.lineWidth=1,r.beginPath(),r.arc(n,s,i,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(n,s,.6*i,0,2*Math.PI),r.stroke(),r.beginPath(),r.arc(n,s,.3*i,0,2*Math.PI),r.stroke(),r.beginPath(),r.moveTo(n-i,s),r.lineTo(n+i,s),r.moveTo(n,s-i),r.lineTo(n,s+i),r.stroke();let o=0;if(t&&t.length>0){const a=Math.floor(e/c*t.length),n=Math.floor((e+1)/c*t.length);let s=0;for(let e=a;e<n;e+=10)s+=Math.abs(t[e]);o=Math.min(1,s/((n-a)/10)*5)}if(l?.channels[e]?.muted&&(o=0),o>.3){const t=u.current%(2*Math.PI),a=(.2+.8*Math.random())*i;d.current[e].push({x:n+Math.cos(t)*a,y:s+Math.sin(t)*a,age:1,hue:120+e/c*100})}for(let t=d.current[e].length-1;t>=0;t--){const a=d.current[e][t];r.fillStyle=`hsla(${a.hue}, 100%, 50%, ${a.age})`,r.beginPath(),r.arc(a.x,a.y,2*a.age,0,2*Math.PI),r.fill(),a.age-=.01,a.age<=0&&d.current[e].splice(t,1)}const m=r.createConicGradient(u.current,n,s),y=120+e/c*100;m.addColorStop(0,`hsla(${y}, 100%, 50%, 0.5)`),m.addColorStop(.1,`hsla(${y}, 100%, 50%, 0)`),m.addColorStop(1,`hsla(${y}, 100%, 50%, 0)`),r.fillStyle=m,r.beginPath(),r.moveTo(n,s),r.arc(n,s,i,u.current,u.current-.5,!0),r.fill(),r.strokeStyle=`hsla(${y}, 100%, 70%, 0.8)`,r.lineWidth=2,r.beginPath(),r.moveTo(n,s),r.lineTo(n+Math.cos(u.current)*i,s+Math.sin(u.current)*i),r.stroke()}a.current=requestAnimationFrame(y)};return y(),()=>{i=!1,a.current&&cancelAnimationFrame(a.current)}},[n,e,c,l]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center",children:Ea.jsx("canvas",{ref:t,style:{width:`${n}px`,height:`${e}px`}})})},eT=[{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,2,2,2,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,9,8,9,9,8,9,9,9,9,9,10,9,10,10,9,10,10,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,10,10,9,10,10,9,10,9,9,9,9,9,8,9,9,8,9,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,8,1,8,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,1,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,2,3,2,3,4,3,4,4,4,3,4,3,2,3,2,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,8,9,10,1,8,1,8,1,8,1,8,1,8,9,0,0,0,0,0,0,0,1,8,1,8,1,8,1,8,1,8,1,8,9,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,8,9,8,9,8,9,8,9,8,9,8,9,10,0,0,0,0,0,0,0,1,9,8,9,8,9,8,9,8,9,8,9,8,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,10,9,10,9,10,9,10,9,10,9,10,9,10,10,0,0,0,0,0,0,0,8,10,9,10,9,10,9,10,9,10,9,10,9,10,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,4,3,4,4,4,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[10,10,9,10,9,9,9,8,8,9,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,8,8,9,9,9,10,9,10,10],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,4,4,4,3,4,3,3,3,2,3,2,2,3,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,1,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,2,2,2,4,4,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,1,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,9,9,8,8,8,9,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,2,3,3,4,1,4,3,3,2,3,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,1,8,9,10,9,8,1,0,0,0,0,0,0,0,1,4,3,2,3,4,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,7,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,1,1,1,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,4,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,1,0,0,0,0,0,0,0,0,0,0,2,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,4,4,4,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,4,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,0,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,9,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,1,8,1,8,8,8,9,9,9,10,9,10,10,10,10,9,10,9,9,9,8,9,8,8,8,1,8,1,0,0,0],[0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,10,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,1,4,1,4,4,3,4,3,3,3,4,3,4,4,1,4,1,0,0,0,0,10,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,1,1,4,1,4,4,3,4,3,3,2,2,3,4,3,4,4,1,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:0,p2Dir:5,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,4,4,3,4,3,3,3,2,3,0,0,0,0,0,0,0,0,0,0,0,3,2,3,3,3,4,3,4,4,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,1,4,1,4,3,4,3,2,3,3,2,3,4,3,4,1,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,3,4,4,4,4,4,0,0,2,2,2,3,4,4,4,4,4,0,0,9,9,9,9,9,10,10,10,0,0,9,9,9,9,9,10,10,10,0,0,0,7,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,4,0,0,2,0,0,0,0,0,0,0,4,0,0,9,0,0,0,0,9,10,10,0,0,9,0,0,0,0,9,10,10,0,0,0,0,0,0],[0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0,0,9,9,10,0,0,0,0,0,0],[0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,9,9,0,0,0,0,0,0,0,0,0,9,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,10,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,10,10,9,0,0,0,0,0,9,0,0,10,10,9,0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,2,0,0,4,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,6,0,0,10,10,10,9,9,9,9,9,9,0,0,10,10,10,9,9,9,9,9,9,0,0,4,4,4,4,3,2,2,2,0,0,4,4,4,4,3,2,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,2,2,2,3,3,4,4,1,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,0,1,0,1,0,4,0,3,0,2,0,2,0,3,0,4,0,1,1,4,4,3,3,2,2,2,2],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,4,4,3,3,2,2,2,2,3,3,4,0,0,0,0,0,0,0,4,3,3,2,2,2,2,3,3,4,4,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,1,0,1,0,4,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,6,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,7,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,4,1,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,1,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,4,4,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,4,4,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,1,1,3,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,1,0,0,1,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,2,3,4,1,4,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,1,4,3,2,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,6,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,7,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,4,4,4,0,4,4,4,0,0,0,8,8,8,0,8,8,8,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,4,4,4,0,4,4,4,4,0,8,8,8,8,0,8,8,8,8,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,8,8,8,8,0,8,8,8,8,0,4,4,4,4,0,4,4,4,4,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,8,8,8,0,8,8,8,0,0,0,4,4,4,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,8,8,0,8,8,0,0,0,0,0,4,4,0,4,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,0,0,0,0,0,4,0,4,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,4,4,4,3,3,3,3,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,4,4,4,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,2,0,0,0,0,0,2,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,4,1,4,4,4,3,4,3,3,3,2,3,3,2,2,2,2,2,3,3,2,3,3,3,4,3,4,4,4,1,4,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0],[0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0],[0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0],[0,0,0,0,0,9,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0],[0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,9,0,0,0,0,0,0],[0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,9,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,0,0,1,9,0,0,0,0,0,0,10,1,10,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,9,9,9,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,9,8,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,8,8,0,0,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,8,8,8,8,0,0,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,9,8,8,8,0,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,8,10,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,1,9,0,0,0,0,0],[0,0,10,1,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,0,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,0,0,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,2,2,2,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,2,2,2,2,0,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,0,0,0,2,2,0,0,0,0,0,3,3,3,3,3,3,0,0,0,4,4,4,4,4,0,0,0,0,3,3,3,3,3,3,0,0,2,2,2,2,2,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,0,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,0,0,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,0,3,3,3,0,0,4,4,4,0,0,0,4,4,4,0,1,1,0,3,3,3,0,0,0,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,3,0,3,2,2,2,3,3,0,3,4,4,4,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,3,3,0,2,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,1,0,4,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,0,2,2,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0],[0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,4,4,1,0,1,4,4,0,3,3,3,0,2,2,4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,2,2,2,0,3,3,4,4,4,0,1,1,1,4,4,0,3,3,3,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:6,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,10,10,10,10,0,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,8,8,8,8,8,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,10,10,10,10,0,9,9,9,0,0,0,0,0,0,8,8,8,0,0,0,0,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,3,2,2,3,2,3,3,3,3,4,3,3,4,3,4,4,1,1,1,1,1,4,4,3,4,3,3,4,3,3,3,3,2,3,2,2,3,2,2,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:7,p2Dir:7,grid:[[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,7,0],[0,0,0,0,0,8,0,9,0,1,0,9,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,2,0,3,0,4,0,1,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,9,0,10,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,4,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,8,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,4,0,3,0,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,2,0,4,0,2,2,2,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,9,0,1,0,10,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,3,0,4,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,3,0,4,0,0,0,0,0],[0,0,0,0,0,8,0,1,0,1,0,9,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,9,0,8,8,8,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,0,2,0,4,0,1,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,3,0,4,4,4,0,3,0,0,0,0,0],[0,0,0,0,0,1,0,1,0,8,8,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,9,0,8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,4,0,3,3,3,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,4,0,1,0,3,0,2,0,0,0,0,0],[0,0,0,0,0,9,0,8,0,9,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,9,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,3,0,1,0,4,0,2,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,3,0,4,0,1,1,1,0,0,0,0,0],[0,0,0,0,0,10,0,8,0,1,0,8,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,9,0,8,0,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,1,0,3,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,3,3,3,0,4,0,0,0,0,0],[0,0,0,0,0,9,9,9,0,8,0,9,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,1,0,9,9,9,0,8,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,3,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,3,0,2,0,3,0,0,0,0,0],[0,0,0,0,0,8,0,10,0,1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,8,0,10,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,2,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,3,0,1,0,0,0,0,0],[0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,9,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:6,p2Dir:7,grid:[[6,0,0,0,0,3,4,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,2,0,0,0,0,0,0,0,4,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,3,0,1,0,0,0,0,3,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,2,0],[0,0,0,0,0,0,1,0,0,0,3,4,1,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,4,3,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,3,0,3,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,4,0,3,1,1,4,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,2,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,4,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0],[0,3,0,0,0,0,0,1,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,0,0,0,3,0,0,0,1,4,0],[0,4,3,0,1,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,1,0,0,0,2,2,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,3,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,2,0,0,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0],[0,0,0,0,0,4,1,1,4,0,0,0,0,0,0,0,0,4,1,4,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,2,0,0,0,3,0,0,0,0,0,0,1,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,0,1,0,0,0,0,0,0,2,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,3,4,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,4,0,0],[0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,3,0,0,0,0,0,1,0,7]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,10,10,10,10,10,10,10,0,9,9,9,9,9,9,9,0,0,8,8,8,0,8,8,8,8,8,8,8,0,0,9,9,9,9,9,9,0,0,10,10,0,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,9,9,9,9,0,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,10,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,10,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,9,9,9,0,0,9,9,9,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,0,0,10,10,10,0,0,0,9,9,9,0,0,9,9,9,0,8,8,8,0,0,0,8,8,8,0,0,0,0,9,9,9,9,9,9,0,0,10,10,10,0,0,10,10,10,0,0,0],[0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,2,2,2,2,2,0,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,3,3,3,0,0,3,3,3,0,4,4,4,0,0,4,4,4,0,3,3,3,0,0,3,3,3,0,2,2,2,0,0,2,2,2,0,0,0,0],[0,0,0,2,2,2,0,0,2,2,2,0,0,3,3,3,3,3,3,0,0,4,4,4,4,4,4,4,4,0,3,3,3,3,3,3,3,3,0,0,2,2,2,2,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},{p1Dir:5,p2Dir:0,grid:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,0],[0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,0],[0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,0,4,4,4,4,4,4,0,0,0,4,4,4,4,4,4,0],[0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,3,0,3,3,3,3,3,3,0,0,0,3,3,3,3,3,3,0],[0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0],[0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}],tT="nibbles";const aT=new class{db=null;initPromise=null;async init(){if(!this.db)return this.initPromise||(this.initPromise=new Promise((e,t)=>{const a=indexedDB.open("devilbox-scores",1);a.onerror=()=>{t(a.error)},a.onsuccess=()=>{this.db=a.result,e()},a.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(tT)){const e=t.createObjectStore(tT,{keyPath:"id",autoIncrement:!0});e.createIndex("score","score",{unique:!1}),e.createIndex("date","date",{unique:!1})}}})),this.initPromise}async ensureDb(){if(await this.init(),!this.db)throw new Error("Database not initialized");return this.db}async saveScore(e){const t=await this.ensureDb(),a={...e,date:new Date};return new Promise((e,n)=>{const s=t.transaction([tT],"readwrite").objectStore(tT).add(a);s.onsuccess=()=>{e(s.result)},s.onerror=()=>{n(s.error)}})}async getTopScores(e=10){const t=await this.ensureDb();return new Promise((a,n)=>{const s=t.transaction([tT],"readonly").objectStore(tT).index("score").openCursor(null,"prev"),r=[];s.onsuccess=()=>{const t=s.result;t&&r.length<e?(r.push(t.value),t.continue()):a(r)},s.onerror=()=>{n(s.error)}})}async clearAll(){const e=await this.ensureDb();return new Promise((t,a)=>{const n=e.transaction([tT],"readwrite").objectStore(tT).clear();n.onsuccess=()=>t(),n.onerror=()=>a(n.error)})}},nT=[12,8,6,4],sT=51,rT=23,iT=["#000000","#5397FF","#000067","#4BFFFF","#AB7787","#FFFFFF","#7F7F7F","#ABCDEF","#733747","#F7CBDB","#434343","#D3D3D3","#FFFF00"],oT=["#1a1a2e","#16213e","#0f3460","#533483","#7b2cbf","#9d4edd","#c77dff","#e0aaff","#ff006e","#fb5607","#ffbe0b","#8ac926","#1982c4","#6a4c93","#06ffa5","#fffb00"],lT=({height:t=120,onExit:a})=>{const n=s.useRef(null),r=s.useRef(null),[i,o]=s.useState(200),[l,c]=s.useState(t),[u,d]=s.useState({level:0,score1:0,score2:0,lives1:3,lives2:3,isPlaying:!1,showMenu:!1,showHighScores:!1}),[p,m]=s.useState(1),[h,f]=s.useState(1),[y,g]=s.useState(!1),[b,v]=s.useState(!0),[x,w]=s.useState(!1),[k,S]=s.useState(!0),[M,N]=s.useState(!0),[C,P]=s.useState([]),[E,_]=s.useState(!1),[T,A]=s.useState(1),[O,I]=s.useState(0),[F,D]=s.useState(0),[R,j]=s.useState(""),[B,L]=s.useState(new Uint8Array(128)),[V,z]=s.useState(0),U=s.useRef(null),G=s.useRef(0),W=s.useRef(null),[H,K]=s.useState(0),[q,$]=s.useState(1),[X,Y]=s.useState(1),Z=s.useRef(0),Q=s.useRef(0),J=s.useRef(0),ee=s.useRef([]),te=s.useRef(0),ae=s.useRef(0),ne=s.useRef(0),se=s.useRef(3),re=s.useRef(3),ie=s.useRef(!1),oe=s.useRef([]),le=s.useRef([]),ce=s.useRef([]),ue=s.useRef(0),de=s.useRef(0),pe=s.useRef(5),me=s.useRef(5),he=s.useRef(0),fe=s.useRef(0),ye=s.useRef(0),ge=s.useRef([]),be=s.useRef([]),ve=s.useRef(null),xe=s.useCallback(()=>{d({level:te.current,score1:ae.current,score2:ne.current,lives1:se.current,lives2:re.current,isPlaying:ie.current,showMenu:!1,showHighScores:!1})},[]),we=e=>d(t=>({...t,showMenu:e})),ke=e=>d(t=>({...t,showHighScores:e})),Se=e=>{ie.current=e,d(t=>({...t,isPlaying:e}))},Me=s.useCallback(async()=>{const e=await aT.getTopScores(10);P(e)},[]),Ne=s.useCallback(()=>{let e=0;for(;e<1e3;){const t=Math.floor(Math.random()*sT),a=Math.floor(Math.random()*rT),n=oe.current[a]?.[t];if(0===n)return ye.current++,void(oe.current[a][t]=16+ye.current);e++}},[]),Ce=s.useCallback(e=>{const t=eT[e%eT.length],a=t.grid.map(e=>[...e]);let n=2,s=2,r=48,i=20;for(let l=0;l<rT;l++)for(let e=0;e<sT;e++){const t=a[l]?.[e];6===t&&(n=e,s=l,a[l][e]=0),7===t&&(r=e,i=l,a[l][e]=0)}oe.current=a;const o=e=>0===e?2:5===e?3:6===e?0:7===e?1:0;ue.current=o(t.p1Dir),de.current=o(t.p2Dir),le.current=Array(256).fill(null),le.current[0]={x:n,y:s},ce.current=Array(256).fill(null),ce.current[0]={x:r,y:i},pe.current=5,me.current=5,he.current=0,fe.current=0,ye.current=0,oe.current[s]&&(oe.current[s][n]=6),2===h&&oe.current[i]&&(oe.current[i][r]=7),ge.current=[],be.current=[],Ne()},[h,Ne]),Pe=s.useCallback(()=>{ie.current=!1,te.current=0,ae.current=0,ne.current=0,se.current=3,re.current=3,z(0),K(0),$(1),Y(1),ee.current=[],J.current=0,Q.current=0,Z.current=0,Ce(0),xe()},[Ce,xe]);s.useEffect(()=>{requestAnimationFrame(()=>Me())},[Me]);const Ee=s.useCallback(()=>{try{const{analyserNode:e}=$v.getState();if(!e)return;const t=e.context.rawContext||e.context;if(!t)return;const a=t.createAnalyser();a.fftSize=256,a.smoothingTimeConstant=.8,e.connect(a),U.current=a}catch(e){}},[]),_e=s.useCallback(()=>nT[p]*(.9+.3*(B.length>0?B.reduce((e,t)=>e+t,0)/B.length/255:0)),[p,B]),Te=s.useCallback(()=>{const e=U.current;if(!e)return;let t=W.current;t&&t.length===e.frequencyBinCount||(t=new Uint8Array(e.frequencyBinCount),W.current=t),e.getByteFrequencyData(t),L(t);const a=t.reduce((e,t)=>e+t,0)/t.length,n=a-G.current;if(n>15){const e=Math.min(n/30,1);z(e),K(e),$(1+.15*e),e>.5&&Date.now()-Q.current>2e3&&(J.current++,Q.current=Date.now())}else z(e=>Math.max(0,e-.05)),K(e=>Math.max(0,e-.08)),$(e=>Math.max(1,e-.02));G.current=a},[]);s.useEffect(()=>{Ee()},[Ee]),s.useEffect(()=>{const e=()=>{r.current&&(o(r.current.clientWidth),c(r.current.clientHeight))};e();const t=new ResizeObserver(e);return r.current&&t.observe(r.current),()=>t.disconnect()},[]);const Ae=s.useCallback((e,t,a,n)=>{ee.current=ee.current.filter(s=>{if(s.x+=s.vx,s.y+=s.vy,s.life-=.02,s.vy+=.1,s.life>0){e.globalAlpha=s.life,e.fillStyle=s.color;const r=a+s.x*t,i=n+s.y*t;e.fillRect(r-s.size/2,i-s.size/2,s.size,s.size),e.globalAlpha=1}return s.life>0})},[]),Oe=s.useCallback((e,t,a)=>{const n=a?ce.current:le.current,s=a?me.current:pe.current;for(let r=0;r<s;r++){const a=n[r];if(a&&a.x===e&&a.y===t)return r}return 0},[]),Ie=s.useCallback((e,t)=>{if(0===B.length)return iT[t];const a=3*e%B.length;if(B[a]/255>.3){const e=Math.min(Math.floor(a/B.length*oT.length),oT.length-1);return oT[e]}return iT[t]},[B]),Fe=s.useCallback((e,t)=>{if(!B||0===B.length)return;for(let a=0;a<51;a++){const n=Math.floor(a/51*B.length),s=B[n]/255;if(s<=.05)continue;const r=Math.floor(23*s),i=Math.min(Math.floor(n/B.length*oT.length),oT.length-1),o=oT[i],l=.2+.4*s,c=a*t;e.fillStyle=o,e.globalAlpha=l;for(let a=23-r;a<23;a++){const n=a*t;e.fillRect(c,n,t,t)}e.globalAlpha=1}},[B]),De=s.useCallback(async()=>{Se(!1);const e=ae.current,t=ne.current,a=te.current,n=C.length<10?0:C[C.length-1].score;return e>n?(A(1),I(e),D(a+1),j("Player 1"),void _(!0)):2===h&&t>n?(A(2),I(t),D(a+1),j("Player 2"),void _(!0)):(Me(),ke(!0),void Pe())},[h,p,C,Me,Pe]),Re=s.useCallback(async()=>{if(R.trim()&&await aT.saveScore({name:R.trim(),score:O,level:F,players:h,speed:p}),_(!1),1===T&&2===h){const e=ne.current,t=te.current;if(e>(C.length<10?0:C[C.length-1].score))return A(2),I(e),D(t+1),j("Player 2"),void _(!0)}Me(),ke(!0),Pe()},[R,O,F,T,h,p,C,Me,Pe]),je=s.useCallback((e,t,a)=>{let n=e,s=t;if(0===a?n++:1===a?s--:2===a?n--:3===a&&s++,y)n<0&&(n=50),n>=sT&&(n=0),s<0&&(s=22),s>=rT&&(s=0);else if(n<0||n>=sT||s<0||s>=rT)return!0;const r=oe.current[s]?.[n];return r>=1&&r<=15},[y]),Be=s.useCallback(()=>{if(!ie.current)return;if(Te(),J.current>0&&(Ne(),J.current--),ge.current.length>0){const e=ge.current.shift();0===e&&2===ue.current||2===e&&0===ue.current||1===e&&3===ue.current||3===e&&1===ue.current||(ue.current=e)}if(2===h&&be.current.length>0){const e=be.current.shift();0===e&&2===de.current||2===e&&0===de.current||1===e&&3===de.current||3===e&&1===de.current||(de.current=e)}const e=(e,t)=>{let{x:a,y:n}=e;return 0===t?a++:1===t?n--:2===t?a--:3===t&&n++,a<0&&(a=50),a>=sT&&(a=0),n<0&&(n=22),n>=rT&&(n=0),{x:a,y:n}},t=je(le.current[0].x,le.current[0].y,ue.current),a=2===h&&je(ce.current[0].x,ce.current[0].y,de.current),n=e(le.current[0],ue.current),s=2===h?e(ce.current[0],de.current):null,r=s&&n.x===s.x&&n.y===s.y;if(t||a||r)return se.current-=t||r?1:0,re.current-=a||r?1:0,void(se.current<=0||2===h&&re.current<=0?De():(Se(!1),Ce(te.current),xe()));let i=!1,o=!1;const l=oe.current[n.y][n.x];if(l>=16){const e=Date.now(),t=999*(l-16)*(te.current+1),a=V>.3,s=a?2:1;ae.current+=t*s,he.current=pe.current>>1,i=!0,a&&(Y(2),setTimeout(()=>Y(1),500)),Z.current=e;const r=n.x,o=n.y;for(let n=0;n<8;n++){const e=2*Math.PI*n/8,t=2+3*Math.random();ee.current.push({x:r,y:o,vx:Math.cos(e)*t,vy:Math.sin(e)*t,life:1,color:iT[12],size:3+3*Math.random()})}}if(s){const e=oe.current[s.y][s.x];if(e>=16){const t=Date.now(),a=999*(e-16)*(te.current+1),n=V>.3,r=n?2:1;ne.current+=a*r,fe.current=me.current>>1,o=!0,n&&(Y(2),setTimeout(()=>Y(1),500)),Z.current=t;const i=s.x,l=s.y;for(let e=0;e<8;e++){const t=2*Math.PI*e/8,a=2+3*Math.random();ee.current.push({x:i,y:l,vx:Math.cos(t)*a,vy:Math.sin(t)*a,life:1,color:iT[12],size:3+3*Math.random()})}}}if(i||o){if(9===ye.current)return te.current++,Ce(te.current),void xe();Ne()}for(let c=255;c>0;c--){const e=le.current[c-1];if(le.current[c]=e?{x:e.x,y:e.y}:null,2===h){const e=ce.current[c-1];ce.current[c]=e?{x:e.x,y:e.y}:null}}if(le.current[0]=n,s&&(ce.current[0]=s),!x){if(he.current>0&&pe.current<255)he.current--,pe.current++;else{const e=le.current[pe.current];e&&oe.current[e.y]&&(oe.current[e.y][e.x]=0)}if(2===h)if(fe.current>0&&me.current<255)fe.current--,me.current++;else{const e=ce.current[me.current];e&&oe.current[e.y]&&(oe.current[e.y][e.x]=0)}}ae.current=Math.max(0,ae.current-17),2===h&&(ne.current=Math.max(0,ne.current-17)),oe.current[n.y]&&(oe.current[n.y][n.x]=6),s&&oe.current[s.y]&&(oe.current[s.y][s.x]=7),xe()},[h,y,x,Ce,De,xe,je,Te]);return s.useEffect(()=>{let e=0;const t=a=>{ie.current&&a-e>=16.67*_e()&&(e=a,Be()),ve.current=requestAnimationFrame(t)};return ve.current=requestAnimationFrame(t),()=>{ve.current&&cancelAnimationFrame(ve.current)}},[p,Be,_e]),s.useEffect(()=>{const e=e=>{if(ie.current)if(k){if("ArrowLeft"===e.key){e.preventDefault();const t=(ue.current+1)%4;ge.current.push(t)}if("ArrowRight"===e.key){e.preventDefault();const t=(ue.current+3)%4;ge.current.push(t)}if("a"===e.key.toLowerCase()){e.preventDefault();const t=(de.current+1)%4;be.current.push(t)}if("d"===e.key.toLowerCase()){e.preventDefault();const t=(de.current+3)%4;be.current.push(t)}}else"ArrowRight"===e.key&&(e.preventDefault(),ge.current.push(0)),"ArrowUp"===e.key&&(e.preventDefault(),ge.current.push(1)),"ArrowLeft"===e.key&&(e.preventDefault(),ge.current.push(2)),"ArrowDown"===e.key&&(e.preventDefault(),ge.current.push(3)),"d"===e.key.toLowerCase()&&(e.preventDefault(),be.current.push(0)),"w"===e.key.toLowerCase()&&(e.preventDefault(),be.current.push(1)),"a"===e.key.toLowerCase()&&(e.preventDefault(),be.current.push(2)),"s"===e.key.toLowerCase()&&(e.preventDefault(),be.current.push(3))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[k]),s.useEffect(()=>{const e=n.current;if(!e)return;const t=e.getContext("2d");if(!t)return;let a=!0,s=null;const r=()=>{if(!a)return;if(t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),u.showMenu||u.showHighScores)return void(s=requestAnimationFrame(r));const n=Math.min(e.width/sT,e.height/rT),i=sT*n,o=rT*n,l=(e.width-i)/2,c=(e.height-o)/2;x?(t.strokeStyle=iT[11],t.lineWidth=2,H>.1&&(t.shadowColor=iT[11],t.shadowBlur=10*H),t.strokeRect(l,c,i,o),t.shadowBlur=0):(t.strokeStyle="rgba(34, 211, 238, 0.3)",t.lineWidth=2,t.strokeRect(l,c,i,o));for(let e=0;e<rT;e++)for(let a=0;a<sT;a++){const s=oe.current[e]?.[a];if(void 0===s||0===s)continue;const r=l+a*n,i=c+e*n;if(s>=16)b?(t.fillStyle="#000",t.fillRect(r,i,n,n),t.fillStyle=iT[12],t.fillRect(r+2,i+2,n-4,n-4)):(t.fillStyle=iT[12],t.fillRect(r,i,n,n)),t.fillStyle="#000",t.font=`bold ${Math.floor(.7*n)}px monospace`,t.textAlign="center",t.textBaseline="middle",t.fillText((s-16).toString(),r+n/2,i+n/2+1);else{let e=iT[s]||"#fff";if(b){t.fillStyle="#000",t.fillRect(r,i,n,n),t.fillStyle=e;const a=2/q,s=(n-4)*q;t.fillRect(r+a,i+a,s,s)}else t.fillStyle=e,t.fillRect(r,i,n,n)}}Ae(t,n,l,c),s=requestAnimationFrame(r)};return s=requestAnimationFrame(r),()=>{a=!1,null!==s&&cancelAnimationFrame(s)}},[b,x,H,q,u.showMenu,u.showHighScores,M,Fe,Ae,Oe,Ie]),s.useEffect(()=>{Ce(0),xe()},[]),Ea.jsxs("div",{ref:r,className:"w-full h-full flex flex-col items-stretch relative group overflow-hidden",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"absolute top-0 left-0 w-full flex justify-between px-2 py-0.5 pointer-events-none z-10 bg-black/40 backdrop-blur-sm transition-opacity opacity-0 "+(u.isPlaying?"group-hover:opacity-100":""),children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsxs("span",{className:"font-mono text-[8px] text-white uppercase",children:["P1: ",u.score1," | L:",u.lives1]}),X>1&&Ea.jsxs("span",{className:"text-yellow-400 font-bold text-[9px] animate-pulse",children:["x",X]})]}),Ea.jsxs("div",{className:"font-mono text-[8px] text-accent-primary font-bold",children:["LVL ",u.level+1]}),Ea.jsxs("div",{className:"font-mono text-[8px] text-white uppercase",children:["P2: ",u.score2," | L:",u.lives2]})]}),Ea.jsx("canvas",{ref:n,width:i,height:l,className:"cursor-pointer w-full h-full",onClick:e=>{e.stopPropagation(),u.isPlaying||(Pe(),Se(!0))}}),!u.isPlaying&&!u.showMenu&&!u.showHighScores&&Ea.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-20",children:Ea.jsxs("div",{className:"flex flex-col items-center gap-2 scale-75 md:scale-100",children:[Ea.jsx("h3",{className:"text-white font-bold text-sm tracking-widest uppercase",children:"NIBBLES"}),Ea.jsx("button",{onClick:e=>{e.stopPropagation(),Pe(),Se(!0)},className:"bg-accent-primary hover:bg-accent-secondary text-white px-6 py-1 rounded-full text-xs font-bold uppercase transition-all shadow-glow-sm",children:"Start Game"}),Ea.jsxs("div",{className:"flex gap-4",children:[Ea.jsx("button",{onClick:e=>{e.stopPropagation(),we(!0)},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"Options"}),Ea.jsx("button",{onClick:e=>{e.stopPropagation(),ke(!0),Me()},className:"text-text-muted hover:text-white text-[9px] uppercase font-mono",children:"High Scores"}),Ea.jsx("button",{onClick:e=>{e.stopPropagation(),a?.()},className:"text-red-400/70 hover:text-red-400 text-[9px] uppercase font-mono",children:"Exit"})]})]})}),u.showHighScores&&!u.isPlaying&&Ea.jsxs("div",{className:"absolute inset-0 bg-black z-40 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[Ea.jsx("span",{className:"text-accent-primary font-bold text-[10px] uppercase tracking-wider",children:"Fasttracker Nibbles Highscore"}),Ea.jsx("button",{onClick:e=>{e.stopPropagation(),ke(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"})]}),Ea.jsx("div",{className:"flex-1 flex flex-col gap-1 mt-1",children:0===C.length?Ea.jsx("div",{className:"text-center text-text-muted py-4 text-[9px] uppercase font-mono",children:"No high scores yet!"}):Ea.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto] gap-x-4 gap-y-1",children:[Ea.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30",children:"Player"}),Ea.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Score"}),Ea.jsx("div",{className:"text-text-muted text-[8px] uppercase font-bold border-b border-dark-border/30 text-right",children:"Lvl"}),C.map((t,a)=>Ea.jsxs(e.Fragment,{children:[Ea.jsx("div",{className:"text-text-primary text-[9px] truncate font-mono",children:t.name}),Ea.jsx("div",{className:"text-accent-secondary text-[9px] font-mono text-right",children:t.score.toLocaleString()}),Ea.jsx("div",{className:"text-text-secondary text-[9px] font-mono text-right",children:t.level})]},t.id||a))]})}),Ea.jsx("button",{onClick:async e=>{e.stopPropagation(),confirm("Are you sure you want to clear all high scores?")&&(await aT.clearAll(),Me())},className:"text-red-500/50 hover:text-red-500 uppercase text-[8px] font-mono mt-auto pt-2",children:"Clear All"})]}),u.showMenu&&!u.isPlaying&&Ea.jsxs("div",{className:"absolute inset-0 bg-black z-30 p-2 flex flex-col gap-2 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex justify-between items-center border-b border-dark-border pb-1",children:[Ea.jsx("span",{className:"text-white font-bold text-[10px] uppercase",children:"Options"}),Ea.jsx("button",{onClick:e=>{e.stopPropagation(),we(!1)},className:"text-text-muted hover:text-white uppercase text-[10px]",children:"Close"})]}),Ea.jsxs("div",{className:"grid grid-cols-2 gap-2 text-[9px] font-mono uppercase text-text-secondary",children:[Ea.jsxs("div",{className:"flex flex-col gap-1",children:[Ea.jsx("span",{children:"Speed:"}),Ea.jsxs("select",{value:p,onChange:e=>{e.stopPropagation(),m(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[Ea.jsx("option",{value:0,children:"Novice"}),Ea.jsx("option",{value:1,children:"Average"}),Ea.jsx("option",{value:2,children:"Pro"}),Ea.jsx("option",{value:3,children:"Up Rough"})]})]}),Ea.jsxs("div",{className:"flex flex-col gap-1",children:[Ea.jsx("span",{children:"Players:"}),Ea.jsxs("select",{value:h,onChange:e=>{e.stopPropagation(),f(parseInt(e.target.value))},className:"bg-dark-bgTertiary border border-dark-border rounded px-1 py-0.5 text-white",children:[Ea.jsx("option",{value:1,children:"1 Player"}),Ea.jsx("option",{value:2,children:"2 Players"})]})]})]}),Ea.jsxs("div",{className:"flex flex-wrap gap-3 mt-1",children:[Ea.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Ea.jsx("input",{type:"checkbox",checked:y,onChange:e=>{e.stopPropagation(),g(e.target.checked)},className:"accent-accent-primary"}),"Wrap"]}),Ea.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Ea.jsx("input",{type:"checkbox",checked:b,onChange:e=>{e.stopPropagation(),v(e.target.checked)},className:"accent-accent-primary"}),"Grid"]}),Ea.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Ea.jsx("input",{type:"checkbox",checked:x,onChange:e=>{e.stopPropagation(),w(e.target.checked)},className:"accent-accent-primary"}),"Surround"]}),Ea.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Ea.jsx("input",{type:"checkbox",checked:k,onChange:e=>{e.stopPropagation(),S(e.target.checked)},className:"accent-accent-primary"}),"2-Key"]}),Ea.jsxs("label",{className:"flex items-center gap-1 text-[9px] text-text-muted cursor-pointer uppercase font-mono",children:[Ea.jsx("input",{type:"checkbox",checked:M,onChange:e=>{e.stopPropagation(),N(e.target.checked)},className:"accent-accent-primary"}),"Music FX"]})]})]}),E&&Ea.jsx("div",{className:"absolute inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:e=>e.stopPropagation(),children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-accent-primary rounded p-4 flex flex-col gap-3 min-w-[200px]",children:[Ea.jsx("div",{className:"text-accent-primary font-bold text-[11px] uppercase tracking-wider text-center",children:"High Score!"}),Ea.jsxs("div",{className:"text-text-secondary text-[9px] font-mono text-center",children:["Player ",T," - ",O.toLocaleString()," pts"]}),Ea.jsx("input",{type:"text",value:R,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),Re()),"Escape"===e.key&&(e.preventDefault(),Re())},maxLength:20,placeholder:"Enter your name",autoFocus:!0,className:"bg-dark-bgTertiary border border-dark-border rounded px-2 py-1 text-white text-[10px] font-mono focus:border-accent-primary focus:outline-none"}),Ea.jsxs("div",{className:"flex gap-2",children:[Ea.jsx("button",{onClick:e=>{e.stopPropagation(),Re()},className:"flex-1 bg-accent-primary hover:bg-accent-secondary text-white px-3 py-1 rounded text-[9px] font-bold uppercase transition-all",children:"Submit"}),Ea.jsx("button",{onClick:e=>{e.stopPropagation(),j(""),Re()},className:"bg-dark-bgTertiary hover:bg-dark-border text-text-muted px-3 py-1 rounded text-[9px] uppercase transition-all",children:"Skip"})]})]})})]})},cT=({height:e=100,text:t="*** GREETINGS FLIES OUT TO....     AEROSOL   AFRIKA   ANDROMEDA   ATE BIT   ATLANTIS   BLACK MAIDEN   BOOZE DESIGN   BOOZOHOLICS   BYTERAPERS   CENSOR DESIGN   DA JORMAS  DCS   DEKADENCE   DEPTH   DESIRE   DIVINE STYLERS   DUREX   ELCREW   ELUDE   EPHIDRENA   EPSILON DESIGN   FAIRLIGHT   FATZONE   FIT   FLUSH  FUNKTION   GENESIS PROJECT   HACK N TRADE   HAUJOBB   HARD BOYLING BOYS   HOAXERS   LFT  IMPURE ASCII 1940  INSANE   INSTINCT   IRIS  JOSSYSTEM   JUDAS   KESO   LA PAZ   LAXATIVE EFFECTS   LEMON  LOONIES     MAHONEY   MANKIND  MAWI   MOODS PLATEAU   NATURE  NONAMENO   NUKLEUS   OFFENCE  ONSALA SECTOR     ONSLAUGHT   OUTBREAK   OXYRON   PACIF!C   PANDA DESIGN   PARADOX   PERFOMERS   PLANET JAZZ   POWERLINE   RAZOR 1911   REALITY   RELAPSE  RNO   RESISTANCE SCARAB   SCENESAT   SCOOPEX   SHARE AND ENJOY   SHAPE   SIGFLUP   SPACEBALLS   STRUTS SUBSPACE   STYLE   THE ELECTRONIC KNIGHTS   THE BLACK LOTUS   THE GANG   TITAN   TPOLM   TRAKTOR   TRIAD   TRSI   TULOU   UK SCENE ALLSTARS   UNIQUE   UNSTABLE LABEL   Y-CREW   AND   ZENON ***"})=>{const a=s.useRef(null),n=s.useRef(void 0),r=s.useRef(0),[i,o]=s.useState(800),{bpm:l,isPlaying:c}=Kv();return s.useEffect(()=>{const e=a.current;if(!e)return;const t=e.parentElement;if(!t)return;const n=new ResizeObserver(e=>{for(const t of e){const e=t.contentRect.width;e>0&&o(e)}});return n.observe(t),()=>n.disconnect()},[]),s.useEffect(()=>{const s=a.current;if(!s)return;const o=s.getContext("2d");if(!o)return;const u=window.devicePixelRatio||1;s.width=i*u,s.height=e*u,o.scale(u,u);let d=!0;const p=[];for(let t=0;t<200;t++)p.push({x:(Math.random()-.5)*i*2,y:(Math.random()-.5)*e*2,z:1e3*Math.random(),speed:.5+1.5*Math.random()});const m=Math.min(.4*e,32),h=.6*m,f=.2*e,y=2*(c?l/125:1);let g=0,b=1,v=0;const x=(t+"     ").repeat(5),w=()=>{if(!d)return;const a=Qg().getWaveform();let s=0;if(a&&a.length>0&&c){const e=Math.sqrt(a.reduce((e,t)=>e+t*t,0)/a.length);s=Math.min(1,10*e)}v+=.15*(s-v),o.fillStyle="#0a0a0b",o.fillRect(0,0,i,e);const l=i/2,u=e/2;for(const t of p){t.z-=t.speed*(1+1*v),t.z<=0&&(t.x=(Math.random()-.5)*i*2,t.y=(Math.random()-.5)*e*2,t.z=1e3);const a=200/t.z,n=l+t.x*a,s=u+t.y*a;if(n<0||n>i||s<0||s>e)continue;const r=Math.max(1,3*(1-t.z/1e3)),c=Math.floor(255*(1-t.z/1e3));o.fillStyle=`rgb(${.8*c}, ${.9*c}, ${c})`,o.beginPath(),o.arc(n,s,r,0,2*Math.PI),o.fill()}const k=Date.now()/1e3;b=1+.8*v,g=Math.sin(.5*k*b)*e*.3;const S=f;r.current+=y,r.current>h*(t.length+5)&&(r.current=0),o.font=`bold ${m}px monospace`,o.textBaseline="middle";for(let t=0;t<x.length;t++){const a=x[t];if(" "===a)continue;const n=i+t*h-r.current;if(n<-h||n>i+h)continue;const s=.035*(r.current+t*h),l=e/2+Math.sin(s)*S,c=o.createLinearGradient(0,g,0,e+g),u=30*k*b%360;c.addColorStop(0,`hsl(${u}, 100%, 60%)`),c.addColorStop(.25,`hsl(${(u+60)%360}, 100%, 70%)`),c.addColorStop(.5,`hsl(${(u+120)%360}, 100%, 70%)`),c.addColorStop(.75,`hsl(${(u+180)%360}, 100%, 70%)`),c.addColorStop(1,`hsl(${(u+240)%360}, 100%, 60%)`);const d=(u+.3*n)%360,p=10+8*v;o.shadowColor=`hsla(${d}, 100%, 50%, ${.5+.3*v})`,o.shadowBlur=p,o.fillStyle=c,o.fillText(a,n,l),o.shadowBlur=0,o.strokeStyle="rgba(0, 0, 0, 0.6)",o.lineWidth=2,o.strokeText(a,n,l)}n.current=requestAnimationFrame(w)};return w(),()=>{d=!1,n.current&&cancelAnimationFrame(n.current)}},[i,e,t]),Ea.jsx("div",{className:"w-full h-full flex items-center justify-center overflow-hidden",children:Ea.jsx("canvas",{ref:a,style:{width:`${i}px`,height:`${e}px`}})})},uT=e.memo(({label:e,value:t,onChange:a,color:n="#00d4aa",size:s="md",disabled:r=!1,title:i})=>{const o="cyan-lineart"===cx(e=>e.currentThemeId),l=o?"#00ffff":n,c=o?"#0a1a1f":"#1a1a1f",u=o?"#0a3333":"#333",d=o?"#0a6666":"#666",{width:p,height:m,fontSize:h}={sm:{width:36,height:18,fontSize:9},md:{width:44,height:22,fontSize:10}}[s];return Ea.jsxs("div",{className:"toggle-container",style:{width:p+10,opacity:r?.4:1},children:[Ea.jsx("div",{className:"toggle-label",style:{fontSize:h-1},children:e}),Ea.jsx("button",{className:"toggle-switch "+(t?"toggle-on":"toggle-off"),onClick:()=>!r&&a(!t),disabled:r,title:i,style:{width:p,height:m,borderRadius:m/2,backgroundColor:t?l:c,border:`2px solid ${t?l:u}`,cursor:r?"not-allowed":"pointer"},children:Ea.jsx("div",{className:"toggle-thumb",style:{width:m-6,height:m-6,borderRadius:"50%",backgroundColor:t?"#fff":d,transform:`translateX(${t?p-m+2:0}px)`,transition:"transform 0.15s ease-out, background-color 0.15s",boxShadow:t?`0 0 6px ${l}`:"none"}})})]})},(e,t)=>e.value===t.value&&e.label===t.label&&e.disabled===t.disabled&&e.color===t.color&&e.size===t.size);uT.displayName="Toggle";const dT=({onClose:e})=>{const{useHexNumbers:t,setUseHexNumbers:a,blankEmptyCells:n,setBlankEmptyCells:r,tb303Collapsed:i,setTB303Collapsed:o,oscilloscopeVisible:l,setOscilloscopeVisible:c,compactToolbar:u,setCompactToolbar:d}=Vv(),{currentThemeId:p,setTheme:m}=cx(),{amigaLimits:h,setAmigaLimits:f,linearInterpolation:y,setLinearInterpolation:g,audioLatency:b,setAudioLatency:v,midiPolyphonic:x,setMidiPolyphonic:w}=Hg(),[k,S]=s.useState(!!document.fullscreenElement);s.useEffect(()=>{const e=()=>{S(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);return Ea.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:Ea.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-lg shadow-xl",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[Ea.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-wide",children:"SETTINGS"}),Ea.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none","aria-label":"Close",children:Ea.jsx(Pe,{size:16})})]}),Ea.jsxs("div",{className:"p-4 space-y-6 max-h-[70vh] overflow-y-auto scrollbar-ft2",children:[Ea.jsxs("section",{children:[Ea.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"DISPLAY"}),Ea.jsxs("div",{className:"space-y-3",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Theme:"}),Ea.jsx("select",{value:p,onChange:e=>m(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:ox.map(e=>Ea.jsx("option",{value:e.id,className:"bg-ft2-bg text-ft2-text",children:e.name},e.id))})]}),Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Number Format:"}),Ea.jsxs("select",{value:t?"hex":"dec",onChange:e=>a("hex"===e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-xs font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[Ea.jsx("option",{value:"hex",className:"bg-ft2-bg text-ft2-text",children:"Hexadecimal (01, 02, 0A, 0F)"}),Ea.jsx("option",{value:"dec",className:"bg-ft2-bg text-ft2-text",children:"Decimal (01, 02, 10, 15)"})]})]}),Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{className:"flex flex-col",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Blank Empty Cells:"}),Ea.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Hide ---, .., ... on empty rows"})]}),Ea.jsx(uT,{label:"",value:n,onChange:r,size:"sm"})]})]})]}),Ea.jsxs("section",{children:[Ea.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"LAYOUT"}),Ea.jsxs("div",{className:"space-y-3",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"TB-303 Panel:"}),Ea.jsx(uT,{label:"",value:!i,onChange:e=>o(!e),size:"sm"})]}),Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Oscilloscope:"}),Ea.jsx(uT,{label:"",value:l,onChange:c,size:"sm"})]}),Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Compact Toolbar:"}),Ea.jsx(uT,{label:"",value:u,onChange:d,size:"sm"})]}),Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx(Lt,{size:14,className:"text-ft2-textDim"}),Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Fullscreen:"})]}),Ea.jsx(uT,{label:"",value:k,onChange:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},size:"sm"})]})]})]}),Ea.jsxs("section",{children:[Ea.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"MIDI"}),Ea.jsxs("div",{className:"space-y-3",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{className:"flex flex-col",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Polyphonic Mode:"}),Ea.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Play multiple notes simultaneously"})]}),Ea.jsx(uT,{label:"",value:x,onChange:w,size:"sm"})]}),Ea.jsx("div",{className:"pt-3 border-t border-ft2-border/30",children:Ea.jsxs("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-2",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-ft2-highlight",children:"Mobile MIDI:"}),Ea.jsx("span",{children:(()=>{const e=/iPad|iPhone|iPod/i.test(navigator.userAgent)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1;return"requestMIDIAccess"in navigator?e?" iOS (Bluetooth pairing required)":" Supported":" Not supported"})()})]}),/iPad|iPhone|iPod/i.test(navigator.userAgent)||/Macintosh/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1?Ea.jsxs("div",{className:"bg-ft2-bg/50 rounded p-2 text-[9px] leading-relaxed",children:[Ea.jsx("div",{className:"font-bold mb-1",children:"To connect Bluetooth MIDI:"}),Ea.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 ml-1",children:[Ea.jsx("li",{children:"Open Settings  Bluetooth"}),Ea.jsx("li",{children:"Turn on your MIDI device"}),Ea.jsx("li",{children:"Pair it with your device"}),Ea.jsx("li",{children:"Return to DEViLBOX and refresh"})]})]}):null]})})]})]}),Ea.jsxs("section",{children:[Ea.jsx("h3",{className:"text-ft2-highlight text-xs font-bold mb-3 tracking-wide",children:"ENGINE"}),Ea.jsxs("div",{className:"space-y-3",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{className:"flex flex-col",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Amiga Limits:"}),Ea.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Clamp periods to 113-856"})]}),Ea.jsx(uT,{label:"",value:h,onChange:f,size:"sm"})]}),Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{className:"flex flex-col",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Sample Interpolation:"}),Ea.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Linear (clean) vs None (crunchy)"})]}),Ea.jsx(uT,{label:"",value:y,onChange:g,size:"sm"})]}),Ea.jsxs("div",{className:"flex items-center justify-between border-t border-ft2-border/30 pt-3",children:[Ea.jsxs("div",{className:"flex flex-col",children:[Ea.jsx("label",{className:"text-ft2-text text-xs font-mono",children:"Audio Latency Mode:"}),Ea.jsx("span",{className:"text-[9px] text-ft2-textDim font-mono",children:"Low latency for live jamming vs stable playback"})]}),Ea.jsxs("select",{value:b,onChange:e=>v(e.target.value),className:"bg-ft2-bg border border-ft2-border text-ft2-text text-[10px] font-mono px-2 py-1 focus:outline-none focus:border-ft2-highlight",children:[Ea.jsx("option",{value:"interactive",children:"Interactive (10ms)"}),Ea.jsx("option",{value:"balanced",children:"Balanced (50ms)"}),Ea.jsx("option",{value:"playback",children:"Stable (150ms)"})]})]})]})]}),Ea.jsx("section",{className:"pt-4 border-t border-ft2-border",children:Ea.jsxs("div",{className:"text-ft2-textDim text-[10px] font-mono space-y-1",children:[Ea.jsx("div",{children:"DEViLBOX v1.0.0"}),Ea.jsx("div",{children:"TB-303 Acid Tracker"}),Ea.jsx("div",{className:"text-ft2-highlight",children:"Settings are saved automatically"})]})})]}),Ea.jsx("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-end",children:Ea.jsx("button",{onClick:e,className:"px-4 py-1.5 bg-ft2-cursor border border-ft2-cursor text-ft2-bg text-xs font-bold hover:bg-ft2-highlight hover:border-ft2-highlight transition-colors focus:outline-none",children:"CLOSE"})})]})})},pT=({onClose:e})=>{const{swing:t,setSwing:a,grooveSteps:n,setGrooveSteps:s,jitter:r,setJitter:i,useMpcScale:o,setUseMpcScale:l,grooveTemplateId:c,setGrooveTemplate:u}=Kv();return Ea.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[9999] p-4 backdrop-blur-sm",children:Ea.jsxs("div",{className:"bg-ft2-bg border-2 border-ft2-border w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[Ea.jsx("div",{className:"flex items-center gap-2",children:Ea.jsx("h2",{className:"text-ft2-highlight font-bold text-sm tracking-widest uppercase",children:"Groove & Swing Settings"})}),Ea.jsx("button",{onClick:e,className:"p-1 hover:bg-ft2-border transition-colors text-ft2-text hover:text-ft2-highlight focus:outline-none",children:Ea.jsx(Pe,{size:18})})]}),Ea.jsxs("div",{className:"flex-1 overflow-hidden p-0 flex flex-col md:flex-row min-h-0",children:[Ea.jsx("div",{className:"w-full md:w-72 flex flex-col bg-dark-bgSecondary border-r border-ft2-border min-h-0",children:Ea.jsxs("section",{className:"flex flex-col flex-1 min-h-0 p-6",children:[Ea.jsx("h3",{className:"flex-shrink-0 text-ft2-highlight text-xs font-bold mb-4 tracking-wider uppercase flex items-center gap-2",children:"Groove Templates"}),Ea.jsx("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-ft2 space-y-4",children:["straight","shuffle","swing","funk","hip-hop","custom"].map(e=>{const t=$n.filter(t=>t.category===e);return 0===t.length?null:Ea.jsxs("div",{className:"space-y-1",children:[Ea.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase px-1 pb-1 border-b border-dark-border",children:e}),Ea.jsx("div",{className:"grid grid-cols-1 gap-1 pt-1",children:t.map(e=>Ea.jsxs("button",{onClick:()=>u(e.id),className:"w-full text-left px-3 py-2 text-xs font-mono transition-all rounded "+(e.id===c?"bg-accent-primary text-white font-bold shadow-glow-sm":"text-text-secondary hover:bg-dark-bgHover hover:text-text-primary bg-dark-bgSecondary border border-transparent hover:border-ft2-border"),children:[Ea.jsxs("div",{className:"flex justify-between items-center",children:[Ea.jsx("span",{children:e.name}),e.id===c&&Ea.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse"})]}),e.description&&Ea.jsx("div",{className:"text-[10px] mt-0.5 leading-tight "+(e.id===c?"text-white":"opacity-60"),children:e.description})]},e.id))})]},e)})})]})}),Ea.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-ft2 p-6 space-y-8 min-h-0",children:[Ea.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Global Intensity"}),Ea.jsx("div",{className:"flex items-center gap-2",children:Ea.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer group bg-dark-bgTertiary px-2 py-1 rounded border border-ft2-border hover:border-accent-primary transition-colors",title:"Use authentic MPC 50-75% scale",children:[Ea.jsx("input",{type:"checkbox",checked:o,onChange:e=>l(e.target.checked),className:"w-3 h-3 accent-accent-primary"}),Ea.jsx("span",{className:"text-[10px] text-text-muted group-hover:text-text-secondary font-bold uppercase",children:"MPC SCALE"})]})})]}),Ea.jsxs("div",{className:"space-y-2",children:[Ea.jsxs("div",{className:"flex justify-between items-end",children:[Ea.jsx("span",{className:"text-[10px] text-text-secondary font-mono uppercase",children:"Groove Amount"}),Ea.jsx("span",{className:"text-xl font-mono text-accent-primary font-bold leading-none",children:o?t:`${t}%`})]}),Ea.jsx("input",{type:"range",min:o?50:0,max:o?75:200,value:t,onChange:e=>a(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),a(o?50:100)},className:"w-full h-2 accent-accent-primary cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),Ea.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[Ea.jsx("span",{children:o?"50%":"Fixed"}),Ea.jsx("span",{children:o?"66%":"100%"}),Ea.jsx("span",{children:o?"75%":"200%"})]}),Ea.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:o?"Authentic MPC timing. 66% is the perfect triplet ratio. Right-click to reset.":"Scales template intensity. 100% is standard. Right-click to reset."})]})]}),Ea.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[Ea.jsx("h3",{className:"text-ft2-highlight text-xs font-bold tracking-wider uppercase",children:"Swing Resolution"}),Ea.jsx("div",{className:"grid grid-cols-3 gap-2",children:[2,4,8,16,32,64].map(e=>Ea.jsxs("button",{onClick:()=>{s(e),"straight"!==c&&u("straight")},className:"px-2 py-2 text-[10px] font-mono border rounded transition-all "+(n===e&&"straight"===c?"bg-accent-primary border-accent-primary text-white font-bold":"bg-dark-bgTertiary border-ft2-border text-text-secondary hover:border-text-muted"),children:[2===e?"16th":4===e?"8th":8===e?"4th":e/16+"b",Ea.jsxs("div",{className:"text-[8px] opacity-60",children:["(",e," stp)"]})]},e))}),Ea.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed",children:"Determines which notes in the pattern cycle are swung. 16th is standard for electronic music."})]}),Ea.jsxs("section",{className:"bg-dark-bgSecondary p-4 border border-ft2-border rounded-lg space-y-4",children:[Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("h3",{className:"text-cyan-400 text-xs font-bold tracking-wider uppercase",children:"Humanization (Jitter)"}),Ea.jsxs("span",{className:"text-lg font-mono text-cyan-400 font-bold leading-none",children:[r,"%"]})]}),Ea.jsxs("div",{className:"space-y-2",children:[Ea.jsx("input",{type:"range",min:"0",max:"100",value:r,onChange:e=>i(parseInt(e.target.value)),onContextMenu:e=>{e.preventDefault(),i(0)},className:"w-full h-2 accent-cyan-500 cursor-pointer bg-dark-bgTertiary rounded-lg appearance-none"}),Ea.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted font-mono uppercase px-1",children:[Ea.jsx("span",{children:"Robotic"}),Ea.jsx("span",{children:"Loose"}),Ea.jsx("span",{children:"Drunken"})]}),Ea.jsx("p",{className:"text-[10px] text-text-muted italic leading-relaxed pt-2",children:"Adds random micro-timing offsets (0-10ms) to every note. Simulates unstable vintage clocks or human performance."})]})]})]})]}),Ea.jsxs("div",{className:"px-4 py-3 bg-ft2-header border-t-2 border-ft2-border flex justify-between items-center",children:[Ea.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[Ea.jsx(Bt,{size:12,className:"text-ft2-highlight"}),Ea.jsx("span",{children:"Groove affects all patterns globally"})]}),Ea.jsx("button",{onClick:e,className:"px-6 py-1.5 bg-accent-primary border border-accent-primary text-white text-xs font-bold hover:bg-accent-secondary hover:border-accent-secondary transition-all rounded shadow-glow-sm focus:outline-none uppercase tracking-widest",children:"Accept"})]})]})})},mT=()=>"showOpenFilePicker"in window&&"showDirectoryPicker"in window;let hT=null;function fT(){return hT}async function yT(e,t){const a=await e.createWritable();await a.write(t),await a.close()}const gT=JSON.parse('["/public/data/instruments/furnace/AY/Closed Hat.fui","/public/data/instruments/furnace/AY/Hat-EnvBass.fui","/public/data/instruments/furnace/AY/Heavy Kick and Snare.fui","/public/data/instruments/furnace/AY/Heavy Kick.fui","/public/data/instruments/furnace/AY/Kick E-1.fui","/public/data/instruments/furnace/AY/Open Hat.fui","/public/data/instruments/furnace/AY/Snare A#3.fui","/public/data/instruments/furnace/AY/kick.fui","/public/data/instruments/furnace/AY/snare.fui","/public/data/instruments/furnace/C64/C64Lead.fui","/public/data/instruments/furnace/C64/C64_Bass.fui","/public/data/instruments/furnace/C64/Castanets.fui","/public/data/instruments/furnace/C64/Closed_Hi-hat.fui","/public/data/instruments/furnace/C64/Gunshot.fui","/public/data/instruments/furnace/C64/Open_Hi-hat.fui","/public/data/instruments/furnace/C64/Side_Stick.fui","/public/data/instruments/furnace/C64/Snare.fui","/public/data/instruments/furnace/C64/string_c64.fui","/public/data/instruments/furnace/ESFM/ESFM Guitar Power Chord (note cut for palm mute).fui","/public/data/instruments/furnace/ESFM/Hi-Hat_ESFM.fui","/public/data/instruments/furnace/ESFM/Synth Bass.fui","/public/data/instruments/furnace/ESFM/deep_bass.fui","/public/data/instruments/furnace/ESFM/delayed.fui","/public/data/instruments/furnace/ESFM/djtBMX_1chostinato.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opBassESFM.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings2.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings3.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opESFMStrings4.fui","/public/data/instruments/furnace/ESFM/djtBMX_4opRubbaBassESFM.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMBRAS.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMBRASSSECT.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMGIT.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMPWM.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMSYN.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresobell-short.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresobell.fui","/public/data/instruments/furnace/ESFM/djtBMX_ESFMresopipe.fui","/public/data/instruments/furnace/ESFM/djtBMX_PULSELESSBUZZER.fui","/public/data/instruments/furnace/ESFM/djtBMX_analogoctbas.fui","/public/data/instruments/furnace/ESFM/djtBMX_bells.fui","/public/data/instruments/furnace/ESFM/djtBMX_brarsesin.fui","/public/data/instruments/furnace/ESFM/djtBMX_brassin.fui","/public/data/instruments/furnace/ESFM/djtBMX_bwaro.fui","/public/data/instruments/furnace/ESFM/djtBMX_chorbel.fui","/public/data/instruments/furnace/ESFM/djtBMX_chorpad.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger2.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger3.fui","/public/data/instruments/furnace/ESFM/djtBMX_clanger4.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-basskick.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-closehh.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-marimba.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-openhh.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-padbrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-sinetom.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-snare.fui","/public/data/instruments/furnace/ESFM/djtBMX_compile-springbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compileagogo.fui","/public/data/instruments/furnace/ESFM/djtBMX_compilebrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_compilefartbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_didgeritune.fui","/public/data/instruments/furnace/ESFM/djtBMX_drlead.fui","/public/data/instruments/furnace/ESFM/djtBMX_egless-kick.fui","/public/data/instruments/furnace/ESFM/djtBMX_explosion.fui","/public/data/instruments/furnace/ESFM/djtBMX_falcomkey.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitbsyn3.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitbsyn4.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitsyn2.fui","/public/data/instruments/furnace/ESFM/djtBMX_gitty.fui","/public/data/instruments/furnace/ESFM/djtBMX_hammeredkeypad.fui","/public/data/instruments/furnace/ESFM/djtBMX_kikbas.fui","/public/data/instruments/furnace/ESFM/djtBMX_lfotest.fui","/public/data/instruments/furnace/ESFM/djtBMX_lofibrass.fui","/public/data/instruments/furnace/ESFM/djtBMX_lylemays.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino2.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino3.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino4.fui","/public/data/instruments/furnace/ESFM/djtBMX_m1stylepaino5.fui","/public/data/instruments/furnace/ESFM/djtBMX_nearest-drone.fui","/public/data/instruments/furnace/ESFM/djtBMX_neophytekick.fui","/public/data/instruments/furnace/ESFM/djtBMX_neophytekick2.fui","/public/data/instruments/furnace/ESFM/djtBMX_noisytom.fui","/public/data/instruments/furnace/ESFM/djtBMX_panfluter.fui","/public/data/instruments/furnace/ESFM/djtBMX_pianoyorgan.fui","/public/data/instruments/furnace/ESFM/djtBMX_piezoclavi.fui","/public/data/instruments/furnace/ESFM/djtBMX_pulselesspulse.fui","/public/data/instruments/furnace/ESFM/djtBMX_pulselesspwm.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwm2.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwm3.fui","/public/data/instruments/furnace/ESFM/djtBMX_pwminv.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope2.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedcalilope3.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizeddrone2.fui","/public/data/instruments/furnace/ESFM/djtBMX_quantizedhorn.fui","/public/data/instruments/furnace/ESFM/djtBMX_santur.fui","/public/data/instruments/furnace/ESFM/djtBMX_santurys.fui","/public/data/instruments/furnace/ESFM/djtBMX_segapiano.fui","/public/data/instruments/furnace/ESFM/djtBMX_shttomsz.fui","/public/data/instruments/furnace/ESFM/djtBMX_sinusoidgit.fui","/public/data/instruments/furnace/ESFM/djtBMX_sitardrone.fui","/public/data/instruments/furnace/ESFM/djtBMX_slapbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_softstar-string-enhanced.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass2.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass3.fui","/public/data/instruments/furnace/ESFM/djtBMX_springbass4.fui","/public/data/instruments/furnace/ESFM/djtBMX_squeiuz.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass2.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass3.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass4.fui","/public/data/instruments/furnace/ESFM/djtBMX_sunsoftbass5.fui","/public/data/instruments/furnace/ESFM/djtBMX_superpwm.fui","/public/data/instruments/furnace/ESFM/djtBMX_sync-invtest.fui","/public/data/instruments/furnace/ESFM/djtBMX_syncpwm-abuse.fui","/public/data/instruments/furnace/ESFM/djtBMX_tabla.fui","/public/data/instruments/furnace/ESFM/djtBMX_tarnceseq.fui","/public/data/instruments/furnace/ESFM/djtBMX_vic20square.fui","/public/data/instruments/furnace/ESFM/djtBMX_vic20squaretest.fui","/public/data/instruments/furnace/ESFM/djtBMX_wurly.fui","/public/data/instruments/furnace/ESFM/fakebits.fui","/public/data/instruments/furnace/ESFM/maj_chord.fui","/public/data/instruments/furnace/ESFM/min_chord.fui","/public/data/instruments/furnace/ESFM/obligatory_supersaw.fui","/public/data/instruments/furnace/ESFM/phat_square.fui","/public/data/instruments/furnace/ESFM/sine_w_reverb.fui","/public/data/instruments/furnace/ESFM/squishsine_organ.fui","/public/data/instruments/furnace/ESFM/stereo_brass_or_strings.fui","/public/data/instruments/furnace/ESFM/weird_bass.fui","/public/data/instruments/furnace/ESFM/wood_block.fui","/public/data/instruments/furnace/GB/GB_Kick.fui","/public/data/instruments/furnace/GB/GB_Lead.fui","/public/data/instruments/furnace/GB/GB_Snare.fui","/public/data/instruments/furnace/GB/closed hi-hat.fui","/public/data/instruments/furnace/GB/kick.fui","/public/data/instruments/furnace/GB/open hihat.fui","/public/data/instruments/furnace/GB/snare.fui","/public/data/instruments/furnace/GB/square fade-in.fui","/public/data/instruments/furnace/Lynx/harmonica.fui","/public/data/instruments/furnace/NES/0-2-5_arp_lead.fui","/public/data/instruments/furnace/NES/0-3-5_arp_lead.fui","/public/data/instruments/furnace/NES/Noise Hi-Hat Closed.fui","/public/data/instruments/furnace/NES/Noise Hi-Hat Open.fui","/public/data/instruments/furnace/NES/Noise Kick.fui","/public/data/instruments/furnace/NES/Noise Snare.fui","/public/data/instruments/furnace/NES/Triangle Kick+Bass.fui","/public/data/instruments/furnace/NES/Triangle Kick.fui","/public/data/instruments/furnace/NES/Triangle Snare+Bass.fui","/public/data/instruments/furnace/NES/Triangle Snare.fui","/public/data/instruments/furnace/OPL/2-OP OPL3 Slap Bass.fui","/public/data/instruments/furnace/OPL/2-op strings.fui","/public/data/instruments/furnace/OPL/2OP Compressed Snare C-3 (Part 1).fui","/public/data/instruments/furnace/OPL/2OP Compressed Snare C-3 (Part 2).fui","/public/data/instruments/furnace/OPL/4op Bass.fui","/public/data/instruments/furnace/OPL/Chorus Organ.fui","/public/data/instruments/furnace/OPL/Closed Hi-hat.fui","/public/data/instruments/furnace/OPL/Crystal.fui","/public/data/instruments/furnace/OPL/DX7 Electric Piano.fui","/public/data/instruments/furnace/OPL/Distortion Guitar.fui","/public/data/instruments/furnace/OPL/Guitar 2.fui","/public/data/instruments/furnace/OPL/Guitar.fui","/public/data/instruments/furnace/OPL/Low Overdriven Guitar (Sine Carrier).fui","/public/data/instruments/furnace/OPL/Low Overdriven Guitar (Square Carrier).fui","/public/data/instruments/furnace/OPL/OPL-ClickKik.fui","/public/data/instruments/furnace/OPL/OPL-RhythmTemplate.fui","/public/data/instruments/furnace/OPL/OPL-RollingDrum.fui","/public/data/instruments/furnace/OPL/OPL1_Ride_Closed.fui","/public/data/instruments/furnace/OPL/OPL2-TwinkleBlare.fui","/public/data/instruments/furnace/OPL/OPL3-4opbrass11.fui","/public/data/instruments/furnace/OPL/OPL3-4opharmonica.fui","/public/data/instruments/furnace/OPL/OPL3-4opsitar.fui","/public/data/instruments/furnace/OPL/OPL3-FakeFalcomGuitar.fui","/public/data/instruments/furnace/OPL/OPL3-FakeFalcomString.fui","/public/data/instruments/furnace/OPL/OPL3-GabberKick.fui","/public/data/instruments/furnace/OPL/OPL3-GabberKick3-60hz-.fui","/public/data/instruments/furnace/OPL/OPL3-MajorSquare.fui","/public/data/instruments/furnace/OPL/OPL3-PWM.fui","/public/data/instruments/furnace/OPL/OPL3-PeriodicNoise.fui","/public/data/instruments/furnace/OPL/OPL3-SegaBass.fui","/public/data/instruments/furnace/OPL/OPL3-SyncDuck.fui","/public/data/instruments/furnace/OPL/OPL3-TwinkleKey.fui","/public/data/instruments/furnace/OPL/OPL3-clap.fui","/public/data/instruments/furnace/OPL/OPL3-easyhoova.fui","/public/data/instruments/furnace/OPL/OPL3_-_C64_like_sqr_snare.fui","/public/data/instruments/furnace/OPL/OPL3_-_PWM_Lead.fui","/public/data/instruments/furnace/OPL/OPL3_BigBass.fui","/public/data/instruments/furnace/OPL/OPL3_C64_Kick_or_Snare_Start.fui","/public/data/instruments/furnace/OPL/OPL3_C64_Snare_Carry.fui","/public/data/instruments/furnace/OPL/OPL3_Slap_Bass.fui","/public/data/instruments/furnace/OPL/OPL3_Springybass.fui","/public/data/instruments/furnace/OPL/OPL_GoodPanFlute.fui","/public/data/instruments/furnace/OPL/OPL_KoreanSquare.fui","/public/data/instruments/furnace/OPL/OPL_SupersawUnit.fui","/public/data/instruments/furnace/OPL/OPL_horn.fui","/public/data/instruments/furnace/OPL/Open Hi-hat.fui","/public/data/instruments/furnace/OPL/Overdriven Guitar.fui","/public/data/instruments/furnace/OPL/Psuedo-PoKEY Perodic Noise (4OP).fui","/public/data/instruments/furnace/OPL/Snare Drum 2.fui","/public/data/instruments/furnace/OPL/Snare Drum.fui","/public/data/instruments/furnace/OPL/Synth Brass.fui","/public/data/instruments/furnace/OPL/Synth Guitar.fui","/public/data/instruments/furnace/OPL/Timpani (OPL3).fui","/public/data/instruments/furnace/OPL/Violin.fui","/public/data/instruments/furnace/OPL/asterix gb clarinet.fui","/public/data/instruments/furnace/OPL/clavinetmaybe.fui","/public/data/instruments/furnace/OPL/detuneexample.fui","/public/data/instruments/furnace/OPL/grand piano.fui","/public/data/instruments/furnace/OPL/kalimba or plain sine i cant tell.fui","/public/data/instruments/furnace/OPL/key.fui","/public/data/instruments/furnace/OPL/marimba.fui","/public/data/instruments/furnace/OPL/opl1 square.fui","/public/data/instruments/furnace/OPL/opl1-hat.fui","/public/data/instruments/furnace/OPL/opl1-kick.fui","/public/data/instruments/furnace/OPL/opl1-snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_1.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_2.fui","/public/data/instruments/furnace/OPL/opl3_4op_bass_3.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_kick.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_power_snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_snare.fui","/public/data/instruments/furnace/OPL/opl3_4op_drum_tom.fui","/public/data/instruments/furnace/OPL/opl3_4op_growl_synth.fui","/public/data/instruments/furnace/OPL/opl3_4op_lead_guitar.fui","/public/data/instruments/furnace/OPL/opl3_4op_piano_bell.fui","/public/data/instruments/furnace/OPL/opl3_4op_rhythm_guitar_1.fui","/public/data/instruments/furnace/OPL/opl3_4op_rhythm_guitar_2.fui","/public/data/instruments/furnace/OPL/opl3_4op_strings.fui","/public/data/instruments/furnace/OPL/sax.fui","/public/data/instruments/furnace/OPL/tuba trumpet thing.fui","/public/data/instruments/furnace/OPLL/Acoustic Bass.fui","/public/data/instruments/furnace/OPLL/Almost_Sine.fui","/public/data/instruments/furnace/OPLL/Alt_Oboe.fui","/public/data/instruments/furnace/OPLL/Better_Electric_Guitar.fui","/public/data/instruments/furnace/OPLL/Chime.fui","/public/data/instruments/furnace/OPLL/Electric_Guitar_2.fui","/public/data/instruments/furnace/OPLL/Electric_Guitar_3.fui","/public/data/instruments/furnace/OPLL/Finger_Bass.fui","/public/data/instruments/furnace/OPLL/Glass_and_Wood.fui","/public/data/instruments/furnace/OPLL/Half_Sine.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Hi-Hat.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Kick.fui","/public/data/instruments/furnace/OPLL/HeeminYT_VRC7Snare.fui","/public/data/instruments/furnace/OPLL/Hihat_Plus_Brass.fui","/public/data/instruments/furnace/OPLL/OPLL_Clickik.fui","/public/data/instruments/furnace/OPLL/Overdriven_Guitar.fui","/public/data/instruments/furnace/OPLL/Rainbow_Bell.fui","/public/data/instruments/furnace/OPLL/Reedlike_Sound.fui","/public/data/instruments/furnace/OPLL/Soft_Bass.fui","/public/data/instruments/furnace/OPLL/Soft_Clarinet.fui","/public/data/instruments/furnace/OPLL/Soft_EP.fui","/public/data/instruments/furnace/OPLL/Soft_Flute.fui","/public/data/instruments/furnace/OPLL/Steel_Guitar.fui","/public/data/instruments/furnace/OPLL/Synth_Marimba.fui","/public/data/instruments/furnace/OPLL/Triangle_Recorder.fui","/public/data/instruments/furnace/OPLL/Weeppiko-piano_guitar_idk.fui","/public/data/instruments/furnace/OPM/Acid_Bass.fui","/public/data/instruments/furnace/OPM/OPM Power Snare.fui","/public/data/instruments/furnace/OPM/OPMSquare.fui","/public/data/instruments/furnace/OPM/OPMTrumpet.fui","/public/data/instruments/furnace/OPM/Picked_Bass.fui","/public/data/instruments/furnace/OPM/Timpani (OPM).fui","/public/data/instruments/furnace/OPM/dx7tubularbell_opm.fui","/public/data/instruments/furnace/OPN/bass/4-OP_Vowel_Bass.fui","/public/data/instruments/furnace/OPN/bass/4_OP_Funky_Bass.fui","/public/data/instruments/furnace/OPN/bass/A.Bass1.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2a.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2b.fui","/public/data/instruments/furnace/OPN/bass/A.Bass2c.fui","/public/data/instruments/furnace/OPN/bass/Algorithmic Bass.fui","/public/data/instruments/furnace/OPN/bass/Bass.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass1.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass2.fui","/public/data/instruments/furnace/OPN/bass/Digi.Bass3.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1d.fui","/public/data/instruments/furnace/OPN/bass/E.Bass1e.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass2c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3d.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3e.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3f.fui","/public/data/instruments/furnace/OPN/bass/E.Bass3g.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4a.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4b.fui","/public/data/instruments/furnace/OPN/bass/E.Bass4c.fui","/public/data/instruments/furnace/OPN/bass/E.Bass5.fui","/public/data/instruments/furnace/OPN/bass/E.Bass6.fui","/public/data/instruments/furnace/OPN/bass/E.Bass7.fui","/public/data/instruments/furnace/OPN/bass/FM_CriminalBass.fui","/public/data/instruments/furnace/OPN/bass/Finger Bass.fui","/public/data/instruments/furnace/OPN/bass/FingerBass.fui","/public/data/instruments/furnace/OPN/bass/House Bass 2.fui","/public/data/instruments/furnace/OPN/bass/House Bass.fui","/public/data/instruments/furnace/OPN/bass/House_Bass.fui","/public/data/instruments/furnace/OPN/bass/PickBass.fui","/public/data/instruments/furnace/OPN/bass/PickMD.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 2.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 3.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass 4.fui","/public/data/instruments/furnace/OPN/bass/Slap Bass.fui","/public/data/instruments/furnace/OPN/bass/bass1.fui","/public/data/instruments/furnace/OPN/bass/bass2.fui","/public/data/instruments/furnace/OPN/bass/bass3.fui","/public/data/instruments/furnace/OPN/bass/bass4.fui","/public/data/instruments/furnace/OPN/bass/bass5.fui","/public/data/instruments/furnace/OPN/bass/bass6.fui","/public/data/instruments/furnace/OPN/bass/bass_acoustic_00.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_00.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_01.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_02.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_03_muffled.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_04.fui","/public/data/instruments/furnace/OPN/bass/bass_electric_05_amp.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_00_wobbly.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_01_wobbly2.fui","/public/data/instruments/furnace/OPN/bass/bass_growl_02_wobbly3.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_00.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_01_snappy.fui","/public/data/instruments/furnace/OPN/bass/bass_picked_02.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_00.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_01.fui","/public/data/instruments/furnace/OPN/bass/bass_slap_02.fui","/public/data/instruments/furnace/OPN/bass/fm_bass1.fui","/public/data/instruments/furnace/OPN/bass/fm_bass2.fui","/public/data/instruments/furnace/OPN/bass/fm_bass3.fui","/public/data/instruments/furnace/OPN/bass/opm_nestri.fui","/public/data/instruments/furnace/OPN/bass/tarylbass1.fui","/public/data/instruments/furnace/OPN/default.fui","/public/data/instruments/furnace/OPN/drums/4-7 Snare.fui","/public/data/instruments/furnace/OPN/drums/Compressed Clap.fui","/public/data/instruments/furnace/OPN/drums/Compressed FM Snare Drum.fui","/public/data/instruments/furnace/OPN/drums/Cymbal.fui","/public/data/instruments/furnace/OPN/drums/Drum.fui","/public/data/instruments/furnace/OPN/drums/GB Tom.fui","/public/data/instruments/furnace/OPN/drums/Heavy EDM Kick F#5.fui","/public/data/instruments/furnace/OPN/drums/Heavy EDM Kick+Snare F#5.fui","/public/data/instruments/furnace/OPN/drums/Heavy Kick.fui","/public/data/instruments/furnace/OPN/drums/Kick Drum.fui","/public/data/instruments/furnace/OPN/drums/OPM-lowpitch-fmclap.fui","/public/data/instruments/furnace/OPN/drums/Single Clap.fui","/public/data/instruments/furnace/OPN/drums/Snare Drum.fui","/public/data/instruments/furnace/OPN/drums/Squishy Snare.fui","/public/data/instruments/furnace/OPN/drums/crash_00.fui","/public/data/instruments/furnace/OPN/drums/fmbigkick.fui","/public/data/instruments/furnace/OPN/drums/fmclap.fui","/public/data/instruments/furnace/OPN/drums/fmclap2.fui","/public/data/instruments/furnace/OPN/drums/fmhat.fui","/public/data/instruments/furnace/OPN/drums/fmopenhat.fui","/public/data/instruments/furnace/OPN/drums/hihat_00.fui","/public/data/instruments/furnace/OPN/drums/idk_something_percussion.fui","/public/data/instruments/furnace/OPN/drums/kick_00_classic.fui","/public/data/instruments/furnace/OPN/drums/kick_01_power.fui","/public/data/instruments/furnace/OPN/drums/kick_02_power2.fui","/public/data/instruments/furnace/OPN/drums/kick_03_muffled.fui","/public/data/instruments/furnace/OPN/drums/kick_04_bassdrum.fui","/public/data/instruments/furnace/OPN/drums/kick_05_noisy.fui","/public/data/instruments/furnace/OPN/drums/kick_06_fat.fui","/public/data/instruments/furnace/OPN/drums/kick_07_fat2.fui","/public/data/instruments/furnace/OPN/drums/powersnare.fui","/public/data/instruments/furnace/OPN/drums/snare_00_simple.fui","/public/data/instruments/furnace/OPN/drums/snare_01_curvy.fui","/public/data/instruments/furnace/OPN/drums/snare_02_weak.fui","/public/data/instruments/furnace/OPN/drums/snare_03_weak2.fui","/public/data/instruments/furnace/OPN/drums/snare_04_muffled.fui","/public/data/instruments/furnace/OPN/drums/snare_05_intense.fui","/public/data/instruments/furnace/OPN/drums/snareclap_G-2.fui","/public/data/instruments/furnace/OPN/effect/Wind.fui","/public/data/instruments/furnace/OPN/effect/fm_propeller.fui","/public/data/instruments/furnace/OPN/effect/weird.fui","/public/data/instruments/furnace/OPN/guitar/ElectricGuitar.fui","/public/data/instruments/furnace/OPN/guitar/Funk Guitar.fui","/public/data/instruments/furnace/OPN/guitar/Hard Guitar.fui","/public/data/instruments/furnace/OPN/guitar/YM2151_DistGuitar.fui","/public/data/instruments/furnace/OPN/guitar/distguitar_00.fui","/public/data/instruments/furnace/OPN/guitar/distortion2.fui","/public/data/instruments/furnace/OPN/guitar/powerchord.fui","/public/data/instruments/furnace/OPN/horn/Brass Lead 1.fui","/public/data/instruments/furnace/OPN/horn/Brass Lead 2.fui","/public/data/instruments/furnace/OPN/horn/SynthBrass.fui","/public/data/instruments/furnace/OPN/horn/Trumpet 1.fui","/public/data/instruments/furnace/OPN/horn/Trumpet 2.fui","/public/data/instruments/furnace/OPN/horn/Tuba.fui","/public/data/instruments/furnace/OPN/horn/brass_00_wobbly.fui","/public/data/instruments/furnace/OPN/horn/brass_01_bassish.fui","/public/data/instruments/furnace/OPN/horn/brass_02_boring.fui","/public/data/instruments/furnace/OPN/horn/brass_03_boring2.fui","/public/data/instruments/furnace/OPN/keys/Acoustic E-Piano.fui","/public/data/instruments/furnace/OPN/keys/Circus Organ.fui","/public/data/instruments/furnace/OPN/keys/Digital Clav 1.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 1.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 2.fui","/public/data/instruments/furnace/OPN/keys/Digital Piano 3.fui","/public/data/instruments/furnace/OPN/keys/ElisOrgan.fui","/public/data/instruments/furnace/OPN/keys/Organ 3.fui","/public/data/instruments/furnace/OPN/keys/Organ 4.fui","/public/data/instruments/furnace/OPN/keys/Piano.fui","/public/data/instruments/furnace/OPN/keys/PianoMD.fui","/public/data/instruments/furnace/OPN/keys/YM2151_E-PIANO.fui","/public/data/instruments/furnace/OPN/keys/fmpiano.fui","/public/data/instruments/furnace/OPN/percussion/BellMD.fui","/public/data/instruments/furnace/OPN/percussion/ChurchBell.fui","/public/data/instruments/furnace/OPN/percussion/Dangerously Cheap Timpani.fui","/public/data/instruments/furnace/OPN/percussion/Kalimba.fui","/public/data/instruments/furnace/OPN/percussion/Marimba.fui","/public/data/instruments/furnace/OPN/percussion/MusicBox.fui","/public/data/instruments/furnace/OPN/percussion/Music_Box.fui","/public/data/instruments/furnace/OPN/percussion/OPM-lowpitch-fmclap.fui","/public/data/instruments/furnace/OPN/percussion/Timpani (OPN).fui","/public/data/instruments/furnace/OPN/percussion/agogo.fui","/public/data/instruments/furnace/OPN/percussion/bell_00_glockenspiel.fui","/public/data/instruments/furnace/OPN/percussion/bell_01_glockenspiel_echoing.fui","/public/data/instruments/furnace/OPN/percussion/bell_02_glockenspiel_wobbly.fui","/public/data/instruments/furnace/OPN/percussion/dx7tubularbell_opn.fui","/public/data/instruments/furnace/OPN/percussion/fm_cowbell.fui","/public/data/instruments/furnace/OPN/percussion/octave_8_bell.fui","/public/data/instruments/furnace/OPN/strings/5thsPad.fui","/public/data/instruments/furnace/OPN/strings/Slow Strings.fui","/public/data/instruments/furnace/OPN/strings/String.fui","/public/data/instruments/furnace/OPN/strings/Violin.fui","/public/data/instruments/furnace/OPN/strings/ViolinMD.fui","/public/data/instruments/furnace/OPN/strings/strings_00.fui","/public/data/instruments/furnace/OPN/synth/Cricket Chorus.fui","/public/data/instruments/furnace/OPN/synth/FM_noname1.fui","/public/data/instruments/furnace/OPN/synth/Kirby SNES Synth Pad.fui","/public/data/instruments/furnace/OPN/synth/Metallic FM Lead.fui","/public/data/instruments/furnace/OPN/synth/Octave_Square.fui","/public/data/instruments/furnace/OPN/synth/Octave_Square2.fui","/public/data/instruments/furnace/OPN/synth/Reverby_Live_Chords.fui","/public/data/instruments/furnace/OPN/synth/Saw Lead.fui","/public/data/instruments/furnace/OPN/synth/Square.fui","/public/data/instruments/furnace/OPN/synth/dodo.fui","/public/data/instruments/furnace/OPN/synth/fm_grinder.fui","/public/data/instruments/furnace/OPN/synth/fm_horror.fui","/public/data/instruments/furnace/OPN/synth/fm_noname2.fui","/public/data/instruments/furnace/OPN/synth/fm_noname3.fui","/public/data/instruments/furnace/OPN/synth/fm_noname4.fui","/public/data/instruments/furnace/OPN/synth/fm_noname5.fui","/public/data/instruments/furnace/OPN/synth/fm_noname6.fui","/public/data/instruments/furnace/OPN/synth/fm_noname7.fui","/public/data/instruments/furnace/OPN/synth/growl.fui","/public/data/instruments/furnace/OPN/synth/pateta.fui","/public/data/instruments/furnace/OPN/wind/BottleBlow.fui","/public/data/instruments/furnace/OPN/wind/Clarinet.fui","/public/data/instruments/furnace/OPN/wind/FM_4OP_-_Tenor_Sax.fui","/public/data/instruments/furnace/OPN/wind/Harmonica 2.fui","/public/data/instruments/furnace/OPN/wind/Sax 1.fui","/public/data/instruments/furnace/OPN/wind/Sax 2 (Bari).fui","/public/data/instruments/furnace/OPN/wind/bassoon.fui","/public/data/instruments/furnace/OPN/wind/bassoon_clarinet.fui","/public/data/instruments/furnace/OPN/wind/fm_pipeflute.fui","/public/data/instruments/furnace/OPN/wind/woodwind_00.fui","/public/data/instruments/furnace/OPZ/Another_Synth_Bass.fui","/public/data/instruments/furnace/OPZ/Banjo.fui","/public/data/instruments/furnace/OPZ/Fake SNES Bass_OPZ.fui","/public/data/instruments/furnace/OPZ/Fake_Famicom_Tri.fui","/public/data/instruments/furnace/OPZ/Funky_Bass.fui","/public/data/instruments/furnace/OPZ/Heavy_synth_bass.fui","/public/data/instruments/furnace/OPZ/Organ_OPZ.fui","/public/data/instruments/furnace/OPZ/Synth Bass.fui","/public/data/instruments/furnace/OPZ/accordion.fui","/public/data/instruments/furnace/OPZ/accordion2.fui","/public/data/instruments/furnace/OPZ/bagpipe.fui","/public/data/instruments/furnace/OPZ/distortedhalfsinepad.fui","/public/data/instruments/furnace/OPZ/funkysynthbass.fui","/public/data/instruments/furnace/OPZ/halfsine_pad.fui","/public/data/instruments/furnace/OPZ/horrorpad.fui","/public/data/instruments/furnace/OPZ/overdriven_guitar.fui","/public/data/instruments/furnace/OPZ/pickbass.fui","/public/data/instruments/furnace/OPZ/reedorgan.fui","/public/data/instruments/furnace/OPZ/rimshot.fui","/public/data/instruments/furnace/OPZ/sitar.fui","/public/data/instruments/furnace/OPZ/synthdulcimer.fui","/public/data/instruments/furnace/OPZ/timpani_oct2.fui","/public/data/instruments/furnace/SAA/EnvBass.fui","/public/data/instruments/furnace/SAA/RanedomHatC.fui","/public/data/instruments/furnace/SAA/RanedomKick.fui","/public/data/instruments/furnace/SAA/RanedomSnare.fui","/public/data/instruments/furnace/SN7/0-2-5_arp_lead.fui","/public/data/instruments/furnace/SN7/0-3-5_arp_lead.fui","/public/data/instruments/furnace/SN7/Echo.fui","/public/data/instruments/furnace/SN7/Flute.fui","/public/data/instruments/furnace/SN7/Follin Guitar 2.fui","/public/data/instruments/furnace/SN7/Follin Guitar.fui","/public/data/instruments/furnace/SN7/Guitar.fui","/public/data/instruments/furnace/SN7/Octave Arp.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [Hat] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [KickSnare] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc ExampleInst [Nothing] CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Hat_Closed CH4 [D].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Hat_Open CH4 [D].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Kick CH4 [C].fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc KickSnare CH3.fui","/public/data/instruments/furnace/SN7/SMSPerc/SMSPerc Snare CH4 [D].fui","/public/data/instruments/furnace/SN7/compatibility.fui","/public/data/instruments/furnace/TIA/Bass Drum.fui","/public/data/instruments/furnace/TIA/Clap.fui","/public/data/instruments/furnace/TIA/Hi-Hat Long.fui","/public/data/instruments/furnace/TIA/Hi-Hat.fui","/public/data/instruments/furnace/TIA/Snare Drum.fui","/public/data/instruments/furnace/TODO/(WSG) Supersaw.fui","/public/data/instruments/furnace/TODO/FDS-oneofthosejapaneseguitarsidkhowtheyarecalledyeah.fui","/public/data/instruments/furnace/TODO/FDS-overfuckingholyshitdriven-guitar.fui","/public/data/instruments/furnace/TODO/FDS-slapassbass.fui","/public/data/instruments/furnace/VERA/0-2-5_arp_lead.fui","/public/data/instruments/furnace/VERA/0-3-5_arp_lead.fui","/public/data/instruments/furnace/VERA/Noise_Kick.fui","/public/data/instruments/furnace/VERA/Noise_Snare.fui","/public/data/instruments/furnace/VIC/kick.fui","/public/data/samples/packs/casio-mt40/leads/accordion.wav","/public/data/samples/packs/casio-mt40/leads/banjo.wav","/public/data/samples/packs/casio-mt40/leads/bass.wav","/public/data/samples/packs/casio-mt40/leads/brass.wav","/public/data/samples/packs/casio-mt40/leads/celesta.wav","/public/data/samples/packs/casio-mt40/leads/cello.wav","/public/data/samples/packs/casio-mt40/leads/clarinet.wav","/public/data/samples/packs/casio-mt40/leads/elec piano.wav","/public/data/samples/packs/casio-mt40/leads/flute.wav","/public/data/samples/packs/casio-mt40/leads/folk flute.wav","/public/data/samples/packs/casio-mt40/leads/funny fuzz.wav","/public/data/samples/packs/casio-mt40/leads/glocken.wav","/public/data/samples/packs/casio-mt40/leads/guitar.wav","/public/data/samples/packs/casio-mt40/leads/harpsichord.wav","/public/data/samples/packs/casio-mt40/leads/organ.wav","/public/data/samples/packs/casio-mt40/leads/oriental.wav","/public/data/samples/packs/casio-mt40/leads/pipe-organ.wav","/public/data/samples/packs/casio-mt40/leads/recorder.wav","/public/data/samples/packs/casio-mt40/leads/st ensemble.wav","/public/data/samples/packs/casio-mt40/leads/synth fuzz.wav","/public/data/samples/packs/casio-mt40/leads/trumpet.wav","/public/data/samples/packs/casio-mt40/leads/violin.wav","/public/data/samples/packs/casio-mt40/leads/xylophone.wav","/public/data/samples/packs/drumnibus/fx/FX_AnalogFX1.wav","/public/data/samples/packs/drumnibus/fx/FX_AnalogFX2.wav","/public/data/samples/packs/drumnibus/fx/FX_Blarper.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst2.wav","/public/data/samples/packs/drumnibus/fx/FX_Briesherfst3.wav","/public/data/samples/packs/drumnibus/fx/FX_Burst1.wav","/public/data/samples/packs/drumnibus/fx/FX_Burst2.wav","/public/data/samples/packs/drumnibus/fx/FX_Chainmalz.wav","/public/data/samples/packs/drumnibus/fx/FX_Digidap2.wav","/public/data/samples/packs/drumnibus/fx/FX_Digidap3.wav","/public/data/samples/packs/drumnibus/fx/FX_Drumaxia.wav","/public/data/samples/packs/drumnibus/fx/FX_Drumaxia2.wav","/public/data/samples/packs/drumnibus/fx/FX_ElectroIsland.wav","/public/data/samples/packs/drumnibus/fx/FX_ElectroIsland2.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx1.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx2.wav","/public/data/samples/packs/drumnibus/fx/FX_Emerx3.wav","/public/data/samples/packs/drumnibus/fx/FX_LofiHuman.wav","/public/data/samples/packs/drumnibus/fx/FX_LofiHuman2.wav","/public/data/samples/packs/drumnibus/fx/FX_Magstorm1.wav","/public/data/samples/packs/drumnibus/fx/FX_Magstorm2.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiElastiek.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLaser1.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLectric.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiLectric2.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiSnip.wav","/public/data/samples/packs/drumnibus/fx/FX_NomiSpring.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni1.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni2.wav","/public/data/samples/packs/drumnibus/fx/FX_Poni3.wav","/public/data/samples/packs/drumnibus/fx/FX_Quarkulator.wav","/public/data/samples/packs/drumnibus/fx/FX_Quarkulator2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sloiz.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon1.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon2.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon3.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon3B.wav","/public/data/samples/packs/drumnibus/fx/FX_Snakamon5.wav","/public/data/samples/packs/drumnibus/fx/FX_Sonar.wav","/public/data/samples/packs/drumnibus/fx/FX_Sonar2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum1.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum2.wav","/public/data/samples/packs/drumnibus/fx/FX_Sydrum3.wav","/public/data/samples/packs/drumnibus/fx/FX_Timpio.wav","/public/data/samples/packs/drumnibus/hihats/CH_Digidap.wav","/public/data/samples/packs/drumnibus/hihats/CH_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/hihats/CH_DraconisD921.wav","/public/data/samples/packs/drumnibus/hihats/CH_DraconisD922.wav","/public/data/samples/packs/drumnibus/hihats/CH_Fantio_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Filtix_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/CH_LofiHuman.wav","/public/data/samples/packs/drumnibus/hihats/CH_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/CH_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/CH_Rezmatix_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CH_Rubydub.wav","/public/data/samples/packs/drumnibus/hihats/CH_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/CH_Sizzel_Closed_Hat.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/CYM_Synthique.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogHihat1.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogOpenhatwav.wav","/public/data/samples/packs/drumnibus/hihats/OH_AnalogVeryLongHat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Digidap.wav","/public/data/samples/packs/drumnibus/hihats/OH_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/hihats/OH_DraconisD921.wav","/public/data/samples/packs/drumnibus/hihats/OH_DraconisD922.wav","/public/data/samples/packs/drumnibus/hihats/OH_Drumaxia.wav","/public/data/samples/packs/drumnibus/hihats/OH_Fantio_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Filtix_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Juxtapos.wav","/public/data/samples/packs/drumnibus/hihats/OH_LofiHuman.wav","/public/data/samples/packs/drumnibus/hihats/OH_Magnotron.wav","/public/data/samples/packs/drumnibus/hihats/OH_Punchtron.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rezmatix_Open_Hat.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rezmatix_Open_Hat_Long.wav","/public/data/samples/packs/drumnibus/hihats/OH_Rubydub.wav","/public/data/samples/packs/drumnibus/hihats/OH_Ruflex.wav","/public/data/samples/packs/drumnibus/hihats/OH_Sizzel_Open_Hat.wav","/public/data/samples/packs/drumnibus/kicks/BB_Electro1short.wav","/public/data/samples/packs/drumnibus/kicks/BD_808A1200.wav","/public/data/samples/packs/drumnibus/kicks/BD_DiggerLong.wav","/public/data/samples/packs/drumnibus/kicks/BD_Digidap.wav","/public/data/samples/packs/drumnibus/kicks/BD_Digimozzy.wav","/public/data/samples/packs/drumnibus/kicks/BD_Dikkie.wav","/public/data/samples/packs/drumnibus/kicks/BD_Dome_Long.wav","/public/data/samples/packs/drumnibus/kicks/BD_Drumaxia.wav","/public/data/samples/packs/drumnibus/kicks/BD_EchoRam1.wav","/public/data/samples/packs/drumnibus/kicks/BD_EchoRam2.wav","/public/data/samples/packs/drumnibus/kicks/BD_Electro1shorter.wav","/public/data/samples/packs/drumnibus/kicks/BD_Juxtapos.wav","/public/data/samples/packs/drumnibus/kicks/BD_Lite2021.wav","/public/data/samples/packs/drumnibus/kicks/BD_LofiHuman.wav","/public/data/samples/packs/drumnibus/kicks/BD_Losamplix.wav","/public/data/samples/packs/drumnibus/kicks/BD_Magnotron..wav","/public/data/samples/packs/drumnibus/kicks/BD_Matrixtape1.wav","/public/data/samples/packs/drumnibus/kicks/BD_Matrixtape2.wav","/public/data/samples/packs/drumnibus/kicks/BD_Plastiklog.wav","/public/data/samples/packs/drumnibus/kicks/BD_Pufsub.wav","/public/data/samples/packs/drumnibus/kicks/BD_Punchtron.wav","/public/data/samples/packs/drumnibus/kicks/BD_Punchysplur.wav","/public/data/samples/packs/drumnibus/kicks/BD_Pziforze.wav","/public/data/samples/packs/drumnibus/kicks/BD_Ritmo.wav","/public/data/samples/packs/drumnibus/kicks/BD_Romkick1.wav","/public/data/samples/packs/drumnibus/kicks/BD_Rubydub.wav","/public/data/samples/packs/drumnibus/kicks/BD_Ruflex.wav","/public/data/samples/packs/drumnibus/kicks/BD_Simpletron.wav","/public/data/samples/packs/drumnibus/kicks/BD_Springworth.wav","/public/data/samples/packs/drumnibus/kicks/BD_Spriverbion.wav","/public/data/samples/packs/drumnibus/kicks/BD_Stuf.wav","/public/data/samples/packs/drumnibus/kicks/BD_SubThud.wav","/public/data/samples/packs/drumnibus/kicks/BD_Zistort.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Darkgong.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Filterbell.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal2.wav","/public/data/samples/packs/drumnibus/percussion/BELL_Hypnoschaal3.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Ryhtmbox.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Ryhtmbox2.wav","/public/data/samples/packs/drumnibus/percussion/BONGO_Simple.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_LofiHuman.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/CLAP_Ruflex.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Simple.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Singalique.wav","/public/data/samples/packs/drumnibus/percussion/CLAVE_Syntheticblox.wav","/public/data/samples/packs/drumnibus/percussion/CONGA_Lowpark.wav","/public/data/samples/packs/drumnibus/percussion/CONGA_Syntique.wav","/public/data/samples/packs/drumnibus/percussion/COW_Syntique.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Blip3.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Chewy1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Digidap.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Drumaxia.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Lectrophy.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Lectrophy2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Mambalazesnare.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_R900.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_Softrond3.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix1.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix2.wav","/public/data/samples/packs/drumnibus/percussion/LAZ_lowvix3.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Losimple.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/RIM_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker1.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker2.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_AnalogShaker3.wav","/public/data/samples/packs/drumnibus/percussion/SHAKE_Ritmo.wav","/public/data/samples/packs/drumnibus/percussion/SNAP_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/TABLA_Mamba.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_Tamb&Shaker.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake1.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake2.wav","/public/data/samples/packs/drumnibus/percussion/TAMB_TapeShake3.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DistortedRitmo.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DistortedRitmoHi.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DraconisDS92.wav","/public/data/samples/packs/drumnibus/percussion/TOM_DraconisDS92high.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Druimaxia.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Juxtapos.wav","/public/data/samples/packs/drumnibus/percussion/TOM_LofiHuman.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Magnotron.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Osciaz.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Punchtron.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Rubydub.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Ruflex.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Stofelectro1.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom2.wav","/public/data/samples/packs/drumnibus/percussion/TOM_TamborineTom3.wav","/public/data/samples/packs/drumnibus/percussion/TOM_Warped.wav","/public/data/samples/packs/drumnibus/percussion/TOM_digger.wav","/public/data/samples/packs/drumnibus/snares/SD_808A1200.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise1.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_2.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_4.wav","/public/data/samples/packs/drumnibus/snares/SD_Analog_Noise_5.wav","/public/data/samples/packs/drumnibus/snares/SD_CompuCrunchy.wav","/public/data/samples/packs/drumnibus/snares/SD_Digidap.wav","/public/data/samples/packs/drumnibus/snares/SD_Draconis1.wav","/public/data/samples/packs/drumnibus/snares/SD_Draconis2.wav","/public/data/samples/packs/drumnibus/snares/SD_Drumaxia.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram1.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram2.wav","/public/data/samples/packs/drumnibus/snares/SD_Echoram3.wav","/public/data/samples/packs/drumnibus/snares/SD_Hark.wav","/public/data/samples/packs/drumnibus/snares/SD_Juxtapos.wav","/public/data/samples/packs/drumnibus/snares/SD_Kitcatlitter.wav","/public/data/samples/packs/drumnibus/snares/SD_LoDigital_1.wav","/public/data/samples/packs/drumnibus/snares/SD_LoDigital_2.wav","/public/data/samples/packs/drumnibus/snares/SD_LofiHuman.wav","/public/data/samples/packs/drumnibus/snares/SD_Magnotron.wav","/public/data/samples/packs/drumnibus/snares/SD_Mamba.wav","/public/data/samples/packs/drumnibus/snares/SD_Mambalazesnare.wav","/public/data/samples/packs/drumnibus/snares/SD_Mambalazesnare2.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnare.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnareLazer.wav","/public/data/samples/packs/drumnibus/snares/SD_NomiSnareWhip.wav","/public/data/samples/packs/drumnibus/snares/SD_Punchtron..wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz1.wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz2.wav","/public/data/samples/packs/drumnibus/snares/SD_Reverz3.wav","/public/data/samples/packs/drumnibus/snares/SD_Ritmo.wav","/public/data/samples/packs/drumnibus/snares/SD_Rubydubwav.wav","/public/data/samples/packs/drumnibus/snares/SD_Ruflex.wav","/public/data/samples/packs/drumnibus/snares/SD_Strakker.wav","/public/data/samples/packs/drumnibus/snares/SD_Turbosound.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf1.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf2.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_3.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_5.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_6.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_7.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_8.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolf_9.wav","/public/data/samples/packs/drumnibus/snares/SD_Wolfsweep1.wav","/public/data/samples/packs/drumnibus/snares/SD_electro7000.wav","/public/data/samples/tr505/tr505-clap.wav","/public/data/samples/tr505/tr505-conga-h.wav","/public/data/samples/tr505/tr505-conga-l.wav","/public/data/samples/tr505/tr505-cowb-h.wav","/public/data/samples/tr505/tr505-cowb-l.wav","/public/data/samples/tr505/tr505-crash.wav","/public/data/samples/tr505/tr505-hihat-closed.wav","/public/data/samples/tr505/tr505-hihat-open.wav","/public/data/samples/tr505/tr505-kick.wav","/public/data/samples/tr505/tr505-ride.wav","/public/data/samples/tr505/tr505-rim.wav","/public/data/samples/tr505/tr505-snare.wav","/public/data/samples/tr505/tr505-timbal.wav","/public/data/samples/tr505/tr505-tom-h.wav","/public/data/samples/tr505/tr505-tom-l.wav","/public/data/samples/tr505/tr505-tom-m.wav","/public/data/samples/tr707/tr707-clap.wav","/public/data/samples/tr707/tr707-cowbell.wav","/public/data/samples/tr707/tr707-crash.wav","/public/data/samples/tr707/tr707-hihat-closed.wav","/public/data/samples/tr707/tr707-hihat-open.wav","/public/data/samples/tr707/tr707-kick-rumble.wav","/public/data/samples/tr707/tr707-kick.wav","/public/data/samples/tr707/tr707-ride.wav","/public/data/samples/tr707/tr707-rim.wav","/public/data/samples/tr707/tr707-snare.wav","/public/data/samples/tr707/tr707-tambourine.wav","/public/data/samples/tr707/tr707-tom-h.wav","/public/data/samples/tr707/tr707-tom-l-rumble.wav","/public/data/samples/tr707/tr707-tom-l.wav","/public/data/samples/tr707/tr707-tom-m.wav","/public/data/songs/furnace/a2600/Balmeranda.fur","/public/data/songs/furnace/a2600/Funky_Afternoon.fur","/public/data/songs/furnace/a2600/Slam_the_Door.fur","/public/data/songs/furnace/a2600/Watch My Tone.fur","/public/data/songs/furnace/a2600/morepain.fur","/public/data/songs/furnace/a2600/twin.fur","/public/data/songs/furnace/amiga/Ibiza.fur","/public/data/songs/furnace/amiga/a_wave_powerhouse.fur","/public/data/songs/furnace/amiga/bruno_time.fur","/public/data/songs/furnace/amiga/m7 vibe.fur","/public/data/songs/furnace/amiga/serendipid.fur","/public/data/songs/furnace/arcade/Changsha_DnB_Inferno_NamcoNA1.fur","/public/data/songs/furnace/arcade/Crystal Dimension Section 2 WSG Mix.fur","/public/data/songs/furnace/arcade/Destiny_Islands_Irem_M92.fur","/public/data/songs/furnace/arcade/Eternal_Forest_TaitoArcade.fur","/public/data/songs/furnace/arcade/Grape_Jelly_Alpha5232.fur","/public/data/songs/furnace/arcade/Hexionology.fur","/public/data/songs/furnace/arcade/Ice_Wind_SegaPCM.fur","/public/data/songs/furnace/arcade/JoyfulStart_Seta.fur","/public/data/songs/furnace/arcade/Mars_Bar_On_Mars_NamcoWSG.fur","/public/data/songs/furnace/arcade/Maximum_Overdrive_NamcoWSG.fur","/public/data/songs/furnace/arcade/Phoenix_cover_NamcoWSG.fur","/public/data/songs/furnace/arcade/Physics_Exam_TaitoArcade.fur","/public/data/songs/furnace/arcade/Point_of_No_Return_SegaPCM.fur","/public/data/songs/furnace/arcade/QSound_smile.fur","/public/data/songs/furnace/arcade/REPROGRAMMED.fur","/public/data/songs/furnace/arcade/SHIN_YA.fur","/public/data/songs/furnace/arcade/Salamander_Starfield.fur","/public/data/songs/furnace/arcade/Slow Brew.fur","/public/data/songs/furnace/arcade/Some_Creatures_SegaPCM.fur","/public/data/songs/furnace/arcade/The_Good_Times_SegaPCM.fur","/public/data/songs/furnace/arcade/ToHeart_QoH98_TPower_Asuka120Style.fur","/public/data/songs/furnace/arcade/Tubelectric_Fictional_Arcade.fur","/public/data/songs/furnace/arcade/U.N. Owen Was Her (NS2).fur","/public/data/songs/furnace/arcade/UT99_Run_TaitoArcade.fur","/public/data/songs/furnace/arcade/WSG_Loop_Tune_NamcoWSG.fur","/public/data/songs/furnace/arcade/eek_qsound.fur","/public/data/songs/furnace/arcade/ice_cap_NamcoC30.fur","/public/data/songs/furnace/arcade/last_day_of_summer_NamcoC15.fur","/public/data/songs/furnace/arcade/living crystal cave.fur","/public/data/songs/furnace/arcade/the_machines_are_socialising_SegaPCM.fur","/public/data/songs/furnace/arcade/trance_TaitoArcade.fur","/public/data/songs/furnace/ay8910/AY-3-8910_Jam.fur","/public/data/songs/furnace/ay8910/AyMate.fur","/public/data/songs/furnace/ay8910/Drifting in Colour.fur","/public/data/songs/furnace/ay8910/Flat Wave Society.fur","/public/data/songs/furnace/ay8910/Second_Addition.fur","/public/data/songs/furnace/ay8910/cardboardmywater.fur","/public/data/songs/furnace/ay8910/demoscenetypebeat.fur","/public/data/songs/furnace/ay8910/remark_music.fur","/public/data/songs/furnace/ay8910/vibe_zone.fur","/public/data/songs/furnace/ay8930/AY8930Shuffle.fur","/public/data/songs/furnace/ay8930/Obscure_Temptation.fur","/public/data/songs/furnace/ay8930/One_Minute_Waltz.fur","/public/data/songs/furnace/ay8930/Playing_On_The_Stairs.fur","/public/data/songs/furnace/ay8930/Red_Planet.fur","/public/data/songs/furnace/ay8930/duty fun.fur","/public/data/songs/furnace/ay8930/joyful.fur","/public/data/songs/furnace/ay8930/powerful-sample-generator.fur","/public/data/songs/furnace/blank/5 AM Sunrise.fur","/public/data/songs/furnace/blank/Electric Blanket.fur","/public/data/songs/furnace/blank/Electrical Inteference.fur","/public/data/songs/furnace/blank/Empty Aquatic.fur","/public/data/songs/furnace/blank/Exquisite Invitation.fur","/public/data/songs/furnace/blank/For the 19 bonus points NES DPCM only.fur","/public/data/songs/furnace/blank/Planet Zero-Algorima.fur","/public/data/songs/furnace/blank/SURVIVE.fur","/public/data/songs/furnace/blank/Super_Instrumentless_Echo_Synth_Demonstration.fur","/public/data/songs/furnace/blank/The Emptyness.fur","/public/data/songs/furnace/blank/WHERE DID I PUT IT.fur","/public/data/songs/furnace/blank/Wandering.fur","/public/data/songs/furnace/blank/emotional_blackmail.fur","/public/data/songs/furnace/blank/enterthering.fur","/public/data/songs/furnace/blank/hope_in_a_time_of_monsters.fur","/public/data/songs/furnace/blank/map01.fur","/public/data/songs/furnace/blank/samba_do_SID.fur","/public/data/songs/furnace/blank/sawvibes.fur","/public/data/songs/furnace/blank/they dont know im empty inside.fur","/public/data/songs/furnace/blank/waytoohard.fur","/public/data/songs/furnace/c64/C64 junk.fur","/public/data/songs/furnace/c64/ChaosTune.fur","/public/data/songs/furnace/c64/FairlightC64.fur","/public/data/songs/furnace/c64/Hellcharger.fur","/public/data/songs/furnace/c64/LowBeatz.fur","/public/data/songs/furnace/c64/PICOHOTCREDITS.fur","/public/data/songs/furnace/c64/deadlock.fur","/public/data/songs/furnace/c64/yeah!.fur","/public/data/songs/furnace/esfm/AAAA.fur","/public/data/songs/furnace/esfm/ALCATRAZ_ALWAYS.fur","/public/data/songs/furnace/esfm/CampingJourney.fur","/public/data/songs/furnace/esfm/Deadline.fur","/public/data/songs/furnace/esfm/Devil_Detective.fur","/public/data/songs/furnace/esfm/EdgeRunning_2078.fur","/public/data/songs/furnace/esfm/Fighting_the_Dimensions_Big_Bad_Because_its_Fun.fur","/public/data/songs/furnace/esfm/I_Cant_Escape_Your_Memory.fur","/public/data/songs/furnace/esfm/Just_me_and_my_Brain.fur","/public/data/songs/furnace/esfm/Ken_Stage.fur","/public/data/songs/furnace/esfm/Magician_Lake_Cover.fur","/public/data/songs/furnace/esfm/Napalm-Loader.fur","/public/data/songs/furnace/esfm/Perilous059.fur","/public/data/songs/furnace/esfm/Poets_I.fur","/public/data/songs/furnace/esfm/Redial.fur","/public/data/songs/furnace/esfm/SearchPrincess.fur","/public/data/songs/furnace/esfm/Second_Start.fur","/public/data/songs/furnace/esfm/Strange_Sunset.fur","/public/data/songs/furnace/esfm/Tangent_to_a_Segue.fur","/public/data/songs/furnace/esfm/TheOneWayFuture.fur","/public/data/songs/furnace/esfm/Unconscious_Unravelling.fur","/public/data/songs/furnace/esfm/Unknown_Location.fur","/public/data/songs/furnace/esfm/WalkInThePark.fur","/public/data/songs/furnace/esfm/WindFjordsESFM.fur","/public/data/songs/furnace/esfm/act_of_fighter.fur","/public/data/songs/furnace/esfm/cielos_esfumados.fur","/public/data/songs/furnace/esfm/experiment.fur","/public/data/songs/furnace/esfm/flashback.fur","/public/data/songs/furnace/esfm/frosty_dusk.fur","/public/data/songs/furnace/esfm/haunted_castle.fur","/public/data/songs/furnace/esfm/her_wishes.fur","/public/data/songs/furnace/esfm/ledstorm.fur","/public/data/songs/furnace/esfm/loneguitarist.fur","/public/data/songs/furnace/esfm/moon_closedspace.fur","/public/data/songs/furnace/esfm/pcbend.fur","/public/data/songs/furnace/esfm/sticker1.fur","/public/data/songs/furnace/esfm/synthy.fur","/public/data/songs/furnace/esfm/wack.fur","/public/data/songs/furnace/esfm/x_evil_soul.fur","/public/data/songs/furnace/gameboy/GB_WaitForMe.fur","/public/data/songs/furnace/gameboy/On_Hold.fur","/public/data/songs/furnace/gameboy/Pleasure_of_Tension.fur","/public/data/songs/furnace/gameboy/You\'re_Doing_Well!.fur","/public/data/songs/furnace/gameboy/cheap.fur","/public/data/songs/furnace/gameboy/contested.fur","/public/data/songs/furnace/gameboy/dancing_to_the_death.fur","/public/data/songs/furnace/gameboy/finger.fur","/public/data/songs/furnace/gameboy/lagtrain.fur","/public/data/songs/furnace/gameboy/minos.fur","/public/data/songs/furnace/gameboy/puggs_in_space.fur","/public/data/songs/furnace/gameboy/snowdin.fur","/public/data/songs/furnace/gameboy/spreadtro.fur","/public/data/songs/furnace/genesis/All Good Times.fur","/public/data/songs/furnace/genesis/ChocolateFactory.fur","/public/data/songs/furnace/genesis/Electric Keet - Imperfectionist.fur","/public/data/songs/furnace/genesis/Equinox Intro.fur","/public/data/songs/furnace/genesis/Fancy_Promenard.fur","/public/data/songs/furnace/genesis/Kobito_of_the_Shining_Needle.fur","/public/data/songs/furnace/genesis/MegadriveOverdrive.fur","/public/data/songs/furnace/genesis/Plok_Beach.fur","/public/data/songs/furnace/genesis/Puyopuyo~n_DopplegangerArle-TsuuStyle.fur","/public/data/songs/furnace/genesis/RaveOfDoom.fur","/public/data/songs/furnace/genesis/RubyIllusions_Genesis.fur","/public/data/songs/furnace/genesis/Shovel_Knight_Title.fur","/public/data/songs/furnace/genesis/Solar_Man.fur","/public/data/songs/furnace/genesis/SpareHalloween2.fur","/public/data/songs/furnace/genesis/Stereotactics_Rewritten.fur","/public/data/songs/furnace/genesis/darkstar.fur","/public/data/songs/furnace/genesis/djtBMX_zweitrigger_bluesky_badfmmix.fur","/public/data/songs/furnace/genesis/eternallydoomedtogroove.fur","/public/data/songs/furnace/genesis/flatulence mountain\'s fm orchestra.fur","/public/data/songs/furnace/genesis/golden_shit.fur","/public/data/songs/furnace/genesis/highscorefollin.fur","/public/data/songs/furnace/genesis/imaginarium.fur","/public/data/songs/furnace/genesis/mm5_boss.fur","/public/data/songs/furnace/genesis/newer_song_lol.fur","/public/data/songs/furnace/genesis/notime.fur","/public/data/songs/furnace/genesis/shiningcrystal_cave.fur","/public/data/songs/furnace/genesis/the_serenity_of_lonliness.fur","/public/data/songs/furnace/genesis/waterfall.fur","/public/data/songs/furnace/genesis/wwfrtw_credits_arrange.fur","/public/data/songs/furnace/lynx/LedStorm.fur","/public/data/songs/furnace/lynx/Road_Rash_Grass_Valley.fur","/public/data/songs/furnace/lynx/Tyrian-Camanis.fur","/public/data/songs/furnace/lynx/chippylotus.fur","/public/data/songs/furnace/lynx/insert_title_here.fur","/public/data/songs/furnace/misc/Back_In_Detroit_Supervision.fur","/public/data/songs/furnace/misc/CORRUPT.FUR","/public/data/songs/furnace/misc/Dreamliner_FMTowns.fur","/public/data/songs/furnace/misc/FiveTwoThreeTwo_MSM5232.fur","/public/data/songs/furnace/misc/Fly_to_the_Sky_Sharp_X1.fur","/public/data/songs/furnace/misc/Galactic_Melody_PowerNoise.fur","/public/data/songs/furnace/misc/GreenIdeas_PET.fur","/public/data/songs/furnace/misc/Inner Machinations YM2610B.fur","/public/data/songs/furnace/misc/IntoTheLight_CapcomQSound.fur","/public/data/songs/furnace/misc/Miami_Ice_Sharp_X1.fur","/public/data/songs/furnace/misc/Playground_2xT6W28.fur","/public/data/songs/furnace/misc/Someting_I_can_feel_MSM5232.fur","/public/data/songs/furnace/misc/Special Stage Sonic 3 (GBA).fur","/public/data/songs/furnace/misc/SplittersGroove_bifurcator.fur","/public/data/songs/furnace/misc/StrobesPowerNoise.fur","/public/data/songs/furnace/misc/T_Six_T6W28.fur","/public/data/songs/furnace/misc/TerminalZone_SM8521.fur","/public/data/songs/furnace/misc/Weightlessness_ES5506.fur","/public/data/songs/furnace/misc/Yellow_Desert_bifurcator.fur","/public/data/songs/furnace/misc/ZX Extinction Sequence.fur","/public/data/songs/furnace/misc/ZetaForceLevel2.fur","/public/data/songs/furnace/misc/beeper_torture.fur","/public/data/songs/furnace/misc/biffy_bifurcator.fur","/public/data/songs/furnace/misc/combat_vehicle_pokey.fur","/public/data/songs/furnace/misc/cutbluetape_PV1000.fur","/public/data/songs/furnace/misc/david.fur","/public/data/songs/furnace/misc/deepmist_dave.fur","/public/data/songs/furnace/misc/feeding_my_pet_peeve_PV1000.fur","/public/data/songs/furnace/misc/firetrucking_PV1000.fur","/public/data/songs/furnace/misc/fragments_turbosound.fur","/public/data/songs/furnace/misc/fursuits_for_the_suspiciously_rich_MSM5232.fur","/public/data/songs/furnace/misc/hittingtherevlimiter_RF5C68.fur","/public/data/songs/furnace/misc/horizon_beyond_gba.fur","/public/data/songs/furnace/misc/mainframe_pokemini.fur","/public/data/songs/furnace/misc/meaningful_connection_es5506.fur","/public/data/songs/furnace/misc/midnight_freeze_bifurcator.fur","/public/data/songs/furnace/misc/mushroomhill_SM8521.fur","/public/data/songs/furnace/misc/nails_PV1000.fur","/public/data/songs/furnace/misc/navi_clash_GBA.fur","/public/data/songs/furnace/misc/pseudogba_pwaa_godot.fur","/public/data/songs/furnace/misc/sawmen_break_SM8521.fur","/public/data/songs/furnace/misc/space_mackerel_bifurcator.fur","/public/data/songs/furnace/misc/sparkling_aria_pokemini.fur","/public/data/songs/furnace/misc/spite_is_the_best_motivator_PV1000.fur","/public/data/songs/furnace/misc/sucked_something_zx.fur","/public/data/songs/furnace/misc/tech_low_qual_era_RF5C68.fur","/public/data/songs/furnace/misc/teddy_bear_midnight_jam_ted.fur","/public/data/songs/furnace/misc/teknofurcator.fur","/public/data/songs/furnace/misc/this_is_kind_of_better_PV1000.fur","/public/data/songs/furnace/misc/walkontheroof_T6W28.fur","/public/data/songs/furnace/msx/2024 BOTB MSX-MUSIC GRINDCORE LIVE ON STAGE (MSX-MUSIC).fur","/public/data/songs/furnace/msx/21492413.fur","/public/data/songs/furnace/msx/BREEZE_SENSATION.fur","/public/data/songs/furnace/msx/Gyruss_Stage_2.fur","/public/data/songs/furnace/msx/Juice_Stand.fur","/public/data/songs/furnace/msx/Morning_Alarm.fur","/public/data/songs/furnace/msx/Nemesis2AirBattle.fur","/public/data/songs/furnace/msx/OPLL_High_and_Rising.fur","/public/data/songs/furnace/msx/OPLL_OperationPleaseLeaveLeave.fur","/public/data/songs/furnace/msx/Port Sun.fur","/public/data/songs/furnace/msx/Princess_of_the_Dead.fur","/public/data/songs/furnace/msx/Striking_Towards_Opposition.fur","/public/data/songs/furnace/multichip/1_bit_bros.fur","/public/data/songs/furnace/multichip/Between_the_Circuits.fur","/public/data/songs/furnace/multichip/CR_yasui_cs.fur","/public/data/songs/furnace/multichip/Chip_Duel_AY-3-8910+SN76489.fur","/public/data/songs/furnace/multichip/Cossack Stage Boss.fur","/public/data/songs/furnace/multichip/Entry_2xSID3+ES5506.fur","/public/data/songs/furnace/multichip/FamiMega Aliance.fur","/public/data/songs/furnace/multichip/Fantasy_Chip_Christmas.fur","/public/data/songs/furnace/multichip/Fight Against the Dark Matter.fur","/public/data/songs/furnace/multichip/Furnace-tan VS the spirit of the Mask.fur","/public/data/songs/furnace/multichip/Fusion.fur","/public/data/songs/furnace/multichip/HoldOn.fur","/public/data/songs/furnace/multichip/Jet_Pack_Adventure_GBAesque.fur","/public/data/songs/furnace/multichip/MegaMari-Cirno.fur","/public/data/songs/furnace/multichip/Melancholy_Girl_multichip.fur","/public/data/songs/furnace/multichip/MetalSlug_BaseCamp_SMS_TIA.fur","/public/data/songs/furnace/multichip/Namco_C30_C219_Loop.fur","/public/data/songs/furnace/multichip/OPL3_SegaPCM_Xeno_Crisis_-_Facility_Area_2.fur","/public/data/songs/furnace/multichip/PinBot-C30C140.fur","/public/data/songs/furnace/multichip/Sunset Hill Zone Act 2.fur","/public/data/songs/furnace/multichip/TheOnlyWayIsForward.fur","/public/data/songs/furnace/multichip/WakeUpAndDance_MMC5_SM8521.fur","/public/data/songs/furnace/multichip/all_old_zero_new.fur","/public/data/songs/furnace/multichip/collab.fur","/public/data/songs/furnace/multichip/cueball.fur","/public/data/songs/furnace/multichip/double-dragon-stage1.fur","/public/data/songs/furnace/multichip/government funding breakcore-ish remix.fur","/public/data/songs/furnace/multichip/invicibility_mmc5_n163_fds.fur","/public/data/songs/furnace/multichip/meteor_shower.fur","/public/data/songs/furnace/multichip/one.fur","/public/data/songs/furnace/multichip/pont of noreturn.fur","/public/data/songs/furnace/multichip/ridiculous_game.fur","/public/data/songs/furnace/multichip/satellite_interconnects.fur","/public/data/songs/furnace/multichip/second_dimension_demo.fur","/public/data/songs/furnace/multichip/silverlining.fur","/public/data/songs/furnace/multichip/skate_or_die.fur","/public/data/songs/furnace/multichip/splashingwater.fur","/public/data/songs/furnace/multichip/steak.fur","/public/data/songs/furnace/multichip/sunlight.fur","/public/data/songs/furnace/multichip/super_fantasy_zone_mango.fur","/public/data/songs/furnace/multichip/the tempest\'s melody.fur","/public/data/songs/furnace/multichip/track8_n163_k053260.fur","/public/data/songs/furnace/multichip/urgency.fur","/public/data/songs/furnace/nes/Byte-Sized Bop.fur","/public/data/songs/furnace/nes/Famitune1.fur","/public/data/songs/furnace/nes/Fur_Nes.fur","/public/data/songs/furnace/nes/Future_Re-ference.fur","/public/data/songs/furnace/nes/Rise_against_the_ashes_to_the_new_dawn.fur","/public/data/songs/furnace/nes/Sky Sanctuary Zone.fur","/public/data/songs/furnace/nes/Super cool and awesome samurai.fur","/public/data/songs/furnace/nes/Super_Space_Invaders_Title.fur","/public/data/songs/furnace/nes/The Cheetahmen.fur","/public/data/songs/furnace/nes/The East.fur","/public/data/songs/furnace/nes/blanketcritter release ver.fur","/public/data/songs/furnace/nes/carve_your_own_path.fur","/public/data/songs/furnace/nes/christmas-fever.fur","/public/data/songs/furnace/nes/going_up_a_step_at_time.fur","/public/data/songs/furnace/nes/infinity.fur","/public/data/songs/furnace/nes/oby1_ingame.fur","/public/data/songs/furnace/nes/one_sided_love.fur","/public/data/songs/furnace/nes/smashtv.fur","/public/data/songs/furnace/nes/sweatsmile_bossfight.fur","/public/data/songs/furnace/nes/the_best-1990.fur","/public/data/songs/furnace/nes/turtle_byte.fur","/public/data/songs/furnace/opl/Air_Combat_Over_the_Vast_Mountain.fur","/public/data/songs/furnace/opl/Contraduct Design OPL3 Cover.fur","/public/data/songs/furnace/opl/Egyptian_Rule.fur","/public/data/songs/furnace/opl/Memories_of_Triumph.fur","/public/data/songs/furnace/opl/Midnight_Dog_Orchestra.fur","/public/data/songs/furnace/opl/Moon.fur","/public/data/songs/furnace/opl/Oh no, more sine waves.fur","/public/data/songs/furnace/opl/One_Sided_Love_Again.fur","/public/data/songs/furnace/opl/Perpetual_Motion.fur","/public/data/songs/furnace/opl/PhantomBreakerBattleGrounds_ShinjukuStage-OPL3.fur","/public/data/songs/furnace/opl/Sliding_on_a_Rainbow.fur","/public/data/songs/furnace/opl/TeamInnocent-BGM4-OPL3Plus.fur","/public/data/songs/furnace/opl/Time_Is_Lost_OPL4.fur","/public/data/songs/furnace/opl/Waterworld_-_Map.fur","/public/data/songs/furnace/opl/femteknyl.fur","/public/data/songs/furnace/opl/fight and flight.fur","/public/data/songs/furnace/opl/green_biker_dude_opl.fur","/public/data/songs/furnace/opl/home_wfl_opl3.fur","/public/data/songs/furnace/opl/rain.cloud.sunset.fur","/public/data/songs/furnace/opl/the_foggy_cave_in_the_darkness.fur","/public/data/songs/furnace/opm/hope_for_the_dream.fur","/public/data/songs/furnace/opm/lagrange_point_2023.fur","/public/data/songs/furnace/opm/the_king_of_crisp.fur","/public/data/songs/furnace/opm/vortex.fur","/public/data/songs/furnace/opm/waterworld_map.fur","/public/data/songs/furnace/opz/\'90 lost media.fur","/public/data/songs/furnace/opz/Clashing Angels.fur","/public/data/songs/furnace/opz/Fly to the Leaden Sky.fur","/public/data/songs/furnace/opz/Glacier BM0.fur","/public/data/songs/furnace/opz/The Hedgehog Knows One Thing.fur","/public/data/songs/furnace/opz/The bongos and teh base OPZx2.fur","/public/data/songs/furnace/opz/boost.fur","/public/data/songs/furnace/opz/goodbye my dreams.fur","/public/data/songs/furnace/opz/massive_x_opz.fur","/public/data/songs/furnace/opz/myst_grove.fur","/public/data/songs/furnace/opz/only_dream_opz.fur","/public/data/songs/furnace/opz/sea of crises.fur","/public/data/songs/furnace/pc98/Blue_Nebula.fur","/public/data/songs/furnace/pc98/CT_maintheme.fur","/public/data/songs/furnace/pc98/Counterattack.fur","/public/data/songs/furnace/pc98/atomic_failure.fur","/public/data/songs/furnace/pce/Contest thing 2025.fur","/public/data/songs/furnace/pce/Fake Gameboy.fur","/public/data/songs/furnace/pce/Final_Fight_Metro_City_Slums.fur","/public/data/songs/furnace/pce/Ma-Da-Ra.fur","/public/data/songs/furnace/pce/Peace.fur","/public/data/songs/furnace/pce/Processing Plant 2025 Edit.fur","/public/data/songs/furnace/pce/Warpdrive_Engage.fur","/public/data/songs/furnace/pce/continuity_error.fur","/public/data/songs/furnace/pce/fd_PCB.fur","/public/data/songs/furnace/pce/pcengineasdmo.fur","/public/data/songs/furnace/quickstart.fur","/public/data/songs/furnace/sn7/456nm_TI994A.fur","/public/data/songs/furnace/sn7/FlowOfSN7.fur","/public/data/songs/furnace/sn7/Last Frecuency System.fur","/public/data/songs/furnace/sn7/Night_Market_TI994A.fur","/public/data/songs/furnace/sn7/Protaras.fur","/public/data/songs/furnace/sn7/Tidal_Tempest_Zone.fur","/public/data/songs/furnace/sn7/Updraft Flight.fur","/public/data/songs/furnace/sn7/doorintosummer.fur","/public/data/songs/furnace/sn7/gg_silver_surfer_st1.fur","/public/data/songs/furnace/sn7/gg_soniccd_collision_chaos.fur","/public/data/songs/furnace/sn7/thunderblade-type-ii.fur","/public/data/songs/furnace/snes/64kb.fur","/public/data/songs/furnace/snes/Breezy.fur","/public/data/songs/furnace/snes/Cosmic_Warehouse.fur","/public/data/songs/furnace/snes/Dear Blue SNES.fur","/public/data/songs/furnace/snes/IMU Caf.fur","/public/data/songs/furnace/snes/MM8_Frost_Man.fur","/public/data/songs/furnace/snes/ManbowSMW.fur","/public/data/songs/furnace/snes/Sadness.fur","/public/data/songs/furnace/snes/Sunken Lights.fur","/public/data/songs/furnace/snes/Unreal_Something_SNES.fur","/public/data/songs/furnace/snes/XCDunes_SNES.fur","/public/data/songs/furnace/snes/XCHQ_SPC700.fur","/public/data/songs/furnace/snes/amalgam.fur","/public/data/songs/furnace/snes/analog.fur","/public/data/songs/furnace/snes/aurora.fur","/public/data/songs/furnace/snes/changeyourheart.fur","/public/data/songs/furnace/snes/encjslt.fur","/public/data/songs/furnace/snes/segacd.fur","/public/data/songs/furnace/snes/sound processing unit.fur","/public/data/songs/furnace/snes/spd10.fur","/public/data/songs/furnace/snes/spd24.fur","/public/data/songs/furnace/snes/tetristheme.fur","/public/data/songs/furnace/snes/time_of_the_dreamwatch.fur","/public/data/songs/furnace/snes/very chill snes.fur","/public/data/songs/furnace/snes/wonders_of_synthia.fur","/public/data/songs/furnace/specs2/Tim_Follin.fur","/public/data/songs/furnace/specs2/acidic_juice_of_hell.fur","/public/data/songs/furnace/specs2/atmosphere.fur","/public/data/songs/furnace/specs2/back_into_adventure.fur","/public/data/songs/furnace/specs2/object.fur","/public/data/songs/furnace/specs2/rastaline_dub.fur","/public/data/songs/furnace/specs2/spa.fur","/public/data/songs/furnace/specs2/thick bass test.fur","/public/data/songs/furnace/vic20/BlueBolt.fur","/public/data/songs/furnace/vic20/h.fur","/public/data/songs/furnace/virtualboy/4_dimensionnal_goddess_of_existance.fur","/public/data/songs/furnace/virtualboy/Cherry_Vertex.fur","/public/data/songs/furnace/virtualboy/Dimensional.fur","/public/data/songs/furnace/virtualboy/Double_Puzzle_Trouble.fur","/public/data/songs/furnace/virtualboy/DoublingDown.fur","/public/data/songs/furnace/virtualboy/God_Rest_Ye_Deadly_Gentlemen.fur","/public/data/songs/furnace/virtualboy/Iridion_3D_Stage_3.fur","/public/data/songs/furnace/virtualboy/LN2StreetLoader-VB.fur","/public/data/songs/furnace/virtualboy/La_Folia_ground_bass.fur","/public/data/songs/furnace/virtualboy/No_Such_Thing.fur","/public/data/songs/furnace/virtualboy/Professional_Beat.fur","/public/data/songs/furnace/virtualboy/Rave_Dancetune.fur","/public/data/songs/furnace/virtualboy/Red_And_Black_Orchid.fur","/public/data/songs/furnace/virtualboy/Red_Revolver.fur","/public/data/songs/furnace/virtualboy/Redworld.fur","/public/data/songs/furnace/virtualboy/Scarlet_Horizons.fur","/public/data/songs/furnace/virtualboy/SeeingRed.fur","/public/data/songs/furnace/virtualboy/StuckTerminologyRealVB.fur","/public/data/songs/furnace/virtualboy/Virtual_Promises.fur","/public/data/songs/furnace/virtualboy/air_fight.fur","/public/data/songs/furnace/virtualboy/blueseed.fur","/public/data/songs/furnace/virtualboy/devil_crash.fur","/public/data/songs/furnace/virtualboy/eek.fur","/public/data/songs/furnace/virtualboy/ghx_melodic.fur","/public/data/songs/furnace/virtualboy/groove_in_the_virtual_realm.fur","/public/data/songs/furnace/virtualboy/honeydippedkiwis.fur","/public/data/songs/furnace/virtualboy/lastninja-sewersloader.fur","/public/data/songs/furnace/virtualboy/mission_breafing.fur","/public/data/songs/furnace/virtualboy/needforspeed2semainmenu.fur","/public/data/songs/furnace/virtualboy/red_joke.fur","/public/data/songs/furnace/virtualboy/redboas.fur","/public/data/songs/furnace/virtualboy/redshift.fur","/public/data/songs/furnace/virtualboy/virtual_namachuukei_pennant_race.fur","/public/data/songs/furnace/wonderswan/Bullet_Hell.fur","/public/data/songs/furnace/wonderswan/Rusty_-_Queen_in_the_Dark_Night.fur","/public/data/songs/furnace/wonderswan/Space Station of Enormous Proportions.fur","/public/data/songs/furnace/wonderswan/TimeTrial.fur","/public/data/songs/furnace/wonderswan/sijofsjfsoeife.fur","/public/data/songs/furnace/wonderswan/thesign_ws.fur","/public/data/songs/furnace/x16/Cafe - 010 Editor 2.0kg.fur","/public/data/songs/furnace/x16/Exerion_II_Tune.fur","/public/data/songs/furnace/x16/Identity_Believer.fur","/public/data/songs/furnace/x16/Shades of Blue.fur","/public/data/songs/furnace/x16/TFV_Rise.fur","/public/data/songs/furnace/x16/dance with me.fur","/public/data/songs/furnace/x16/her11.fur","/public/data/songs/furnace/x16/keygen19.fur","/public/data/songs/furnace/x16/richca.fur","/public/data/songs/furnace/x16/watching_paint_dry.fur","/public/data/songs/furnace/x68000/LN2_Office_Loader.fur","/public/data/songs/furnace/x68000/Optimistic.fur","/public/data/songs/furnace/x68000/TimeMan.fur","/public/data/songs/furnace/x68000/Wicked_Express.fur","/public/data/songs/furnace/x68000/boomer.fur","/public/data/songs/furnace/ymz280b/evilevilsong.fur","/public/data/songs/furnace/ymz280b/notreallyfm.fur","/public/data/songs/midi/Samplab_mathew.mid","/public/data/songs/midi/mathew.mid","/public/data/songs/midi/pattern07 (1).mid","/public/data/songs/midi/pattern07 (2).mid","/public/data/songs/midi/pattern07.mid","/public/data/songs/midi/pattern14 (1).mid","/public/data/songs/midi/pattern14.mid","/public/data/songs/midi/pattern19 (1).mid","/public/data/songs/midi/pattern19.mid","/public/data/songs/midi/pattern23 (1).mid","/public/data/songs/midi/pattern23 (2).mid","/public/data/songs/midi/pattern23.mid","/public/data/songs/mod/break the box.mod","/public/data/songs/modules.json"]'),bT="http://localhost:3001";function vT(){return Array.isArray(gT)&&gT.length>0}async function xT(e){const t=e.replace(/^\/+/,""),a=await fetch(`${bT}/api/files/${t}`);if(!a.ok)throw new Error(`Failed to read file: ${a.statusText}`);return a.arrayBuffer()}async function wT(e){const t=`/DEViLBOX/data/${e.replace(/^\/+/,"")}`,a=await fetch(t);if(!a.ok)throw new Error(`Failed to fetch static file: ${a.status} ${t}`);return a.arrayBuffer()}const kT=[".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx"],ST=[...kT,".sqs",".seq"];function MT(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return kT.includes(t)}const NT=({isOpen:e,onClose:t,onLoad:a,onLoadTrackerModule:n,mode:r,currentProjectData:i,suggestedFilename:o="untitled.dbx"})=>{const[l,c]=s.useState([]),[u,d]=s.useState(!1),[p,m]=s.useState(null),[h,f]=s.useState(null),[y,g]=s.useState(o),[b,v]=s.useState(!1),[x,w]=s.useState(!1),[k,S]=s.useState(""),[M,N]=s.useState(null);s.useEffect(()=>{e&&(()=>{const e=Yk(),t=mT()&&!!fT();v(e||t)})()},[e]);const C=s.useCallback(async()=>{d(!0),m(null);try{let e=[];if(Yk()&&window.electron?.fs){if(!M)return void d(!1);const t=M||k;if(t){e=(await window.electron.fs.readdir(t,[])).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),e.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}}else{if(!x){const e=await async function(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),1e3),a=await fetch(`${bT}/api/files/songs`,{method:"HEAD",signal:e.signal});return clearTimeout(t),a.ok}catch{return!1}}();w(e)}if(x)try{const t=k||"songs";e=(await async function(e){const t=e.replace(/^\/+/,""),a=await fetch(`${bT}/api/files/${t}`);if(!a.ok)throw new Error(`Failed to list directory: ${a.statusText}`);return(await a.json()).items||[]}(t)).map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt?new Date(e.modifiedAt):void 0,source:"filesystem"})),e.sort((e,t)=>e.isDirectory&&!t.isDirectory?-1:!e.isDirectory&&t.isDirectory?1:e.name.localeCompare(t.name))}catch{w(!1)}if(0===e.length&&vT()){const t=function(e){const t=e.replace(/^\/+/,"").replace(/\/+$/,""),a=new Set,n=[];for(const r of gT){const e=r.replace(/^\/public\/data\//,"");if(t&&!e.startsWith(t+"/"))continue;const s=t?e.slice(t.length+1):e;if(!s)continue;const i=s.indexOf("/");if(-1!==i){const e=s.slice(0,i);a.add(e)}else n.push({name:s,path:t?`${t}/${s}`:s,isDirectory:!1})}const s=Array.from(a).sort().map(e=>({name:e,path:t?`${t}/${e}`:e,isDirectory:!0}));return n.sort((e,t)=>e.name.localeCompare(t.name)),[...s,...n]}(k||"");e=t.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,source:"filesystem"}))}if(0===e.length){const t=fT();if(t){const a=await async function(e,t){const a=e||hT;if(!a)throw new Error("No directory handle available");const n=[];for await(const[s,r]of a.entries()){const e="directory"===r.kind;let i,o;if(!e&&t&&t.length>0){const e="."+s.split(".").pop()?.toLowerCase();if(!t.includes(e))continue}if(!e)try{const e=await r.getFile();i=e.size,o=new Date(e.lastModified)}catch{}n.push({name:s,path:`${a.name}/${s}`,isDirectory:e,size:i,modifiedAt:o,handle:r})}return n.sort((e,t)=>e.isDirectory!==t.isDirectory?e.isDirectory?-1:1:e.name.localeCompare(t.name)),n}(t,[]);e=a.map(e=>({id:e.path,name:e.name,isDirectory:e.isDirectory,path:e.path,size:e.size,modifiedAt:e.modifiedAt,source:"filesystem",handle:e.handle}))}}}c(e)}catch(e){m(e instanceof Error?e.message:"Failed to load files")}finally{d(!1)}},[k,M,x]);s.useEffect(()=>{e&&C()},[e,C]);const P=async()=>{const e=await async function(){if(!mT())return null;try{const e=await window.showDirectoryPicker({mode:"readwrite",startIn:"documents"});return hT=e,e}catch(p){if("AbortError"===p.name)return null;throw p}}();e&&v(!0)},E=async()=>{if(h){d(!0),m(null);try{if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return ST.includes(t)}(h.name)){if(!n)throw new Error("Binary file loading not supported");let e;if("filesystem"!==h.source)throw new Error("Cannot read tracker module");if(Yk()&&window.electron?.fs&&h.path)e=await window.electron.fs.readFile(h.path);else if(x&&h.path)e=await xT(h.path);else if(h.handle){const t=await h.handle.getFile();e=await t.arrayBuffer()}else{if(!h.path||!vT())throw new Error("Cannot read tracker module");e=await wT(h.path)}return await n(e,h.name),void t()}let e;const s=h.name.toLowerCase().endsWith(".xml");if(Yk()&&window.electron?.fs&&h.path){const t=await window.electron.fs.readFile(h.path),a=(new TextDecoder).decode(t);e=s?a:JSON.parse(a)}else if(x&&h.path){const t=await xT(h.path),a=(new TextDecoder).decode(t);e=s?a:JSON.parse(a)}else if(h.handle){const t=await async function(e){return(await e.getFile()).text()}(h.handle);e=s?t:JSON.parse(t)}else{if(!h.path||!vT())throw new Error("Cannot read file");{const t=await wT(h.path),a=(new TextDecoder).decode(t);e=s?a:JSON.parse(a)}}a(e,h.name),t()}catch(e){m(e instanceof Error?e.message:"Failed to load file")}finally{d(!1)}}},_=async e=>{if(confirm(`Delete "${e.name}"?`))try{const t=fT();t&&await async function(e,t){const a=t||hT;if(!a)throw new Error("No directory handle available");await a.removeEntry(e)}(e.name,t),C()}catch(t){m(t instanceof Error?t.message:"Failed to delete file")}};return e?Ea.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:t,children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl w-[800px] max-w-[90vw] h-[600px] max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-dark-border",children:[Ea.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"load"===r?"Load Module":"Save Module"}),Ea.jsx("button",{onClick:t,className:"text-text-muted hover:text-text-primary","aria-label":"Close",children:Ea.jsx(Pe,{size:18})})]}),Ea.jsx("div",{className:"flex border-b border-dark-border",children:Ea.jsx("button",{onClick:()=>b?null:P(),className:"px-4 py-2 text-sm font-medium "+(b?"text-accent-primary border-b-2 border-accent-primary":"text-text-muted hover:text-text-primary"),children:b?"Filesystem":"Open Folder..."})}),k&&Ea.jsx("div",{className:"px-4 py-2 bg-dark-bgTertiary border-b border-dark-border",children:Ea.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-muted font-mono truncate",children:[Ea.jsx(Ye,{size:14})," ",k]})}),Ea.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[p&&Ea.jsx("div",{className:"bg-red-900/30 border border-red-500 text-red-300 px-4 py-2 rounded mb-4",children:p}),u?Ea.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"Loading..."}):0===l.length?Ea.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[Ea.jsx("p",{className:"mb-4",children:"No files found"}),!Yk()&&!x&&!b&&Ea.jsx("button",{onClick:P,className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Open Folder"}),Yk()&&!M&&Ea.jsx("button",{onClick:async()=>{if(window.electron?.fs){const e=await window.electron.fs.openDirectory();e&&(N(e),S(e),C())}},className:"px-4 py-2 bg-accent-primary text-white rounded hover:bg-accent-hover",children:"Select Folder"})]}):Ea.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[""!==k&&Ea.jsxs("div",{onClick:()=>{if(Yk()&&k){const e=k.split("/").slice(0,-1).join("/")||"/";S(e),N(e)}else if(k){const e=k.split("/").slice(0,-1).join("/")||"";S(e)}f(null)},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors bg-dark-bgSecondary hover:bg-dark-bgHover border border-dark-border",children:[Ea.jsx(qt,{size:18,className:"text-text-muted"}),Ea.jsx("div",{className:"flex-1",children:Ea.jsx("div",{className:"font-medium text-text-primary",children:".. (back)"})})]}),l.map(e=>Ea.jsxs("div",{onClick:()=>f(e),onDoubleClick:()=>{e.isDirectory?Yk()?(S(e.path),N(e.path),f(null)):(S(e.path),f(null)):(f(e),"load"===r&&E())},className:"flex items-center gap-3 p-3 rounded cursor-pointer transition-colors "+(h?.id===e.id?"bg-accent-primary/20 border border-accent-primary":"bg-dark-bgTertiary hover:bg-dark-bgHover border border-transparent"),children:[Ea.jsx("div",{className:"text-text-muted flex-shrink-0",children:e.isDirectory?Ea.jsx($t,{size:18}):MT(e.name)?Ea.jsx(Ft,{size:18}):Ea.jsx(Xt,{size:18})}),Ea.jsxs("div",{className:"flex-1 min-w-0",children:[Ea.jsx("div",{className:"font-medium text-text-primary truncate",children:e.name}),Ea.jsxs("div",{className:"text-xs text-text-muted",children:[e.size?`${(e.size/1024).toFixed(1)} KB`:"",e.modifiedAt&&`  ${e.modifiedAt.toLocaleDateString()}`]})]}),Ea.jsx("button",{onClick:t=>{t.stopPropagation(),_(e)},className:"text-text-muted hover:text-red-400 p-1",title:"Delete","aria-label":"Delete",children:Ea.jsx(Re,{size:14})})]},e.id))]})]}),Ea.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 border-t border-dark-border",children:["save"===r&&Ea.jsx("input",{type:"text",value:y,onChange:e=>g(e.target.value),placeholder:"Filename",className:"flex-1 px-3 py-2 bg-dark-bgTertiary border border-dark-border rounded text-text-primary"}),Ea.jsx("div",{className:"flex-1"}),Ea.jsx("button",{onClick:t,className:"px-4 py-2 text-text-muted hover:text-text-primary",children:"Cancel"}),Ea.jsx("button",{onClick:"load"===r?E:async()=>{if(i){d(!0),m(null);try{const e=i(),a=y.endsWith(".dbx")?y:`${y}.dbx`;if(Yk()&&window.electron?.fs){const t=`${M||k}/${a}`,n=JSON.stringify(e,null,2),s=(new TextEncoder).encode(n);await window.electron.fs.writeFile(t,s)}else if(x){const t=k?`${k}/${a}`:`songs/${a}`,n=JSON.stringify(e,null,2),s=(new TextEncoder).encode(n);await async function(e,t){const a=e.replace(/^\/+/,""),n=t instanceof ArrayBuffer?new Uint8Array(t):t,s=btoa(String.fromCharCode(...n)),r=await fetch(`${bT}/api/files/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})});if(!r.ok)throw new Error(`Failed to write file: ${r.statusText}`)}(t,s)}else{const t=fT();if(t)await async function(e,t,a){const n=a||hT;if(!n)throw new Error("No directory handle available");const s=await n.getFileHandle(e,{create:!0});return await yT(s,t),s}(a,JSON.stringify(e,null,2),t);else{const t=await async function(e,t){if(!mT())throw new Error("File System Access API not supported");try{return await window.showSaveFilePicker({suggestedName:e,types:t??[{description:"DEViLBOX Module",accept:{"application/json":[".dbox"]}}]})}catch(p){if("AbortError"===p.name)return null;throw p}}(a);t&&await yT(t,JSON.stringify(e,null,2))}}C(),t()}catch(e){m(e instanceof Error?e.message:"Failed to save file")}finally{d(!1)}}},disabled:"load"===r&&(!h||h.isDirectory),className:"px-6 py-2 rounded font-medium "+("load"!==r||h&&!h.isDirectory?"bg-accent-primary text-white hover:bg-accent-primaryHover":"bg-dark-bgTertiary text-text-muted cursor-not-allowed"),children:"load"===r?"Load":"Save"})]})]})}):null};var CT=r();function PT(e,t,a,n,s,r,i,o,l={},c){const u={format:"devilbox-song",version:Fk,metadata:e,bpm:t,instruments:a,patterns:n,sequence:s,...r&&Object.keys(r).length>0?{automation:r}:{},...o&&o.length>0?{automationCurves:o}:{},...i&&i.length>0?{masterEffects:i}:{},...c&&"straight"!==c?{grooveTemplateId:c}:{}},d=l.prettify?JSON.stringify(u,null,2):JSON.stringify(u),p=new Blob([d],{type:"application/json"}),m=`${FT(e.name)}.dbx`;CT.saveAs(p,m)}function ET(e,t,a,n,s={}){const r={format:"devilbox-sfx",version:Fk,name:e,instrument:t,pattern:a,bpm:n},i=s.prettify?JSON.stringify(r,null,2):JSON.stringify(r),o=new Blob([i],{type:"application/json"}),l=`${FT(e)}.sfx.json`;CT.saveAs(o,l)}function _T(e,t={}){const a={format:"devilbox-instrument",version:Fk,instrument:e},n=t.prettify?JSON.stringify(a,null,2):JSON.stringify(a),s=new Blob([n],{type:"application/json"}),r=`${FT(e.name)}.dbi`;CT.saveAs(s,r)}async function TT(e){try{const t=await e.text(),a=JSON.parse(t);if("devilbox-song"!==a.format)throw new Error("Invalid song format");return a}catch(t){return null}}async function AT(e){try{const t=await e.text(),a=JSON.parse(t);if("devilbox-sfx"!==a.format)throw new Error("Invalid SFX format");return a}catch(t){return null}}async function OT(e){try{const t=await e.text(),a=JSON.parse(t);if("devilbox-instrument"!==a.format)throw new Error("Invalid instrument format");return a}catch(t){return null}}async function IT(e){try{const t=await e.text(),a=JSON.parse(t);return"devilbox-song"===a.format?"song":"devilbox-sfx"===a.format?"sfx":"devilbox-instrument"===a.format?"instrument":"unknown"}catch{return"unknown"}}function FT(e){return e.replace(/[^a-z0-9_-]/gi,"_").replace(/_{2,}/g,"_").toLowerCase()}function DT(e){const t=new Uint8Array(e),a=[];for(let n=0;n<t.length;n+=32768){const e=t.subarray(n,Math.min(n+32768,t.length));a.push(String.fromCharCode.apply(null,e))}return btoa(a.join(""))}function RT(e){const[t,a,,n,s,r]=e;let i=0;t>0&&t<=120?i=Math.max(1,t-12):254!==t&&255!==t||(i=97);return{note:i,instrument:a>0?a:0,volume:s>0?Math.min(16+Math.min(s,64),80):0,effTyp:n,eff:r,effTyp2:0,eff2:0}}function jT(e){const t=e.note,a=e.effectType,n=e.effectParam,s=e.volume,r=e.instrument;let i=0,o=0;if(s>=96){const e=function(e){const t=15&e;switch(e>>4){case 6:return[10,t];case 7:return[10,t<<4];case 8:return[14,176+t];case 9:return[14,160+t];case 11:return[4,t];case 12:return[8,17*t];case 13:return[25,t];case 14:return[25,t<<4];case 15:return[3,t>0?16*t:0];default:return null}}(s);null!==e&&(i=e[0],o=e[1])}return{note:t,instrument:r,volume:s,effTyp:a,eff:n,effTyp2:i,eff2:o}}function BT(e){const t=function(e){if(0===e)return 0;const t=[1712,1616,1525,1440,1357,1281,1209,1141,1077,1017,961,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,75,71,67,63,60,56,53,50,47,45,42,40,37,35,33,31,30,28];let a=0,n=1/0;for(let r=0;r<t.length;r++){const s=Math.abs(t[r]-e);s<n&&(n=s,a=r+1)}const s=a+24;return Math.min(96,Math.max(1,s))}(e.period),a=e.instrument,n=(s=e.effect,r=e.effectParam,`${s.toString(16).toUpperCase()}${r.toString(16).padStart(2,"0").toUpperCase()}`);var s,r;const[i,o]=n?as(n):[0,0];return{note:t,instrument:a,volume:0,effTyp:i,eff:o,effTyp2:0,eff2:0,period:e.period}}function LT(e){return e.instruments||[]}function VT(e){return e.samples||[]}function zT(e){const t=function(e){if(!e.patterns||0===e.patterns.length)return[];const t=[],a=e.channels.length;for(let n=0;n<e.patterns.length;n++){const s=e.patterns[n],r=s.rows.length;if(0===r)continue;const i=[];for(let t=0;t<a;t++){const a=e.channels[t]||`Channel ${t+1}`,o=[];let l=null;for(let e=0;e<r;e++){const a=s.rows[e];if(a&&a[t]){const e=RT(a[t]);0!==e.instrument&&(l=e.instrument),o.push(e)}else o.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const c=null!==l&&0!==l?l:1;i.push({id:`import-ch-${n}-${t}-${Date.now()}`,name:a||`Ch ${t+1}`,rows:o,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:c,color:null})}const o=s.name||`Pattern ${n}`;t.push({id:`import-pat-${n}-${Date.now()}`,name:o,length:r,channels:i})}return t}(e),a=function(e){return e.orders?e.orders.map(e=>e.pat):[]}(e);let n;return n=a.length>0?a.map((e,a)=>{const n=t[e];return n?{...n,id:`import-pos-${a}-pat-${e}-${Date.now()}`,name:`${String(a).padStart(2,"0")}: ${n.name}`,channels:n.channels.map(e=>({...e,id:`${e.id}-pos-${a}`,rows:[...e.rows]}))}:t[0]}):t,{patterns:n,order:a,instrumentNames:LT(e),sampleNames:VT(e),channelCount:e.channels?.length||4}}function UT(e,t,a,n,s){const r=[];for(let u=0;u<e.length;u++){const n=e[u],s=n.length,i=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let a=0;a<s;a++){const s=n[a]?.[e];if(s){const e=jT(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const o=null!==r?r:0;i.push({id:`xm-ch-${u}-${e}-${Date.now()}`,name:a.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:o,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`xm-pat-${u}-${Date.now()}`,name:`Pattern ${u}`,length:s,channels:i,importMetadata:a})}const i=a.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t),o=a.modData?.songLength||i.length,l=i.slice(0,o);let c;return s&&(c={base64:DT(s),format:"XM",sourceFile:a.sourceFile}),{patterns:r,order:l,instrumentNames:n,sampleNames:n,channelCount:t,metadata:a,originalModuleData:c}}function GT(e,t,a,n,s){const r=[];for(let u=0;u<e.length;u++){const n=e[u],s=[];for(let e=0;e<t;e++){const t=[];let r=null;for(let a=0;a<64;a++){const s=n[a]?.[e];if(s){const e=BT(s);null!==e.instrument&&(r=e.instrument),t.push(e)}else t.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}const i=null!==r?r:0;s.push({id:`mod-ch-${u}-${e}-${Date.now()}`,name:a.modData?.channelNames[e]||`Channel ${e+1}`,rows:t,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,instrumentId:i,color:null,channelMeta:{importedFromMOD:!0,originalIndex:e,channelType:"sample"}})}r.push({id:`mod-pat-${u}-${Date.now()}`,name:`Pattern ${u}`,length:64,channels:s,importMetadata:a})}const i=a.modData?.patternOrderTable||Array.from({length:r.length},(e,t)=>t),o=a.modData?.songLength||i.length,l=i.slice(0,o);let c;return s&&(c={base64:DT(s),format:"MOD",sourceFile:a.sourceFile}),{patterns:r,order:l,instrumentNames:n,sampleNames:n,channelCount:t,metadata:a,originalModuleData:c}}function WT(e,t=0){const a={attack:10,decay:500,sustain:t,release:100};if(!e||!e.enabled||e.points.length<2)return a;const n=e.points;try{const t=function(e){if(0===e.length)return 10;const t=e[0];let a=0,n=e[0].value;for(let o=1;o<e.length;o++)if(e[o].value>n)n=e[o].value,a=o;else if(e[o].value<n-5)break;const s=e[a],r=s.tick-t.tick,i=32;return Math.max(1,r*i)}(n),{decay:a,sustain:s}=function(e,t,a){if(0===e.length)return{decay:500,sustain:0};let n=0,s=e[0].value;for(let d=0;d<e.length;d++)e[d].value>s&&(s=e[d].value,n=d);let r=a??n,i=e[r]?.value??s;if(null!==a&&a<e.length)i=e[a].value;else for(let d=n+1;d<e.length;d++){if(Math.abs(e[d].value-e[d-1].value)<6){r=d,i=e[d].value;break}}const o=e[r].tick-e[n].tick,l=32,c=Math.max(0,o*l),u=i/64*100;return{decay:c,sustain:u}}(n,0,e.sustainPoint),r=function(e,t){if(0===e.length)return 100;const a=t??Math.max(0,e.length-2);if(a>=e.length-1)return 100;let n=e.length-1;for(let i=a+1;i<e.length;i++)if(e[i].value<5){n=i;break}const s=e[n].tick-e[a].tick,r=32;return Math.max(10,s*r)}(n,e.sustainPoint);return{attack:Math.max(0,Math.min(2e3,t)),decay:Math.max(0,Math.min(2e3,a)),sustain:Math.max(0,Math.min(100,s)),release:Math.max(0,Math.min(5e3,r))}}catch(s){return a}}function HT(e,t,a){const n=[];if(e.furnace){const s=e.furnace.synthType;if("Sampler"===s||"Player"===s){if(e.samples.length>0)for(let s=0;s<e.samples.length;s++){const r=qT(e.samples[s],e,t+s,a);n.push(r)}else{const a=KT(e,t);n.push(a)}return n}const r=KT(e,t);n.push(r);for(let i=0;i<e.samples.length;i++){const s=qT(e.samples[i],e,t+i+1,a);n.push(s)}return n}for(let s=0;s<e.samples.length;s++){const r=qT(e.samples[s],e,t+s,a);n.push(r)}return n}function KT(e,t){const a=e.furnace,n=a.synthType,s={chipType:a.chipType,furnaceIndex:e.id-1,rawBinaryData:e.rawBinaryData,algorithm:a.fm?.algorithm??0,feedback:a.fm?.feedback??0,fms:a.fm?.fms??0,ams:a.fm?.ams??0,ops:a.fm?.ops??4,opllPreset:a.fm?.opllPreset??0,operators:a.fm?.operators?.map(e=>({enabled:e.enabled,mult:e.mult,tl:e.tl,ar:e.ar,dr:e.dr,d2r:e.d2r??0,sl:e.sl,rr:e.rr,dt:e.dt,dt2:e.dt2??0,rs:e.rs??0,am:e.am??!1,ksr:e.ksr??!1,ksl:e.ksl??0,sus:e.sus??!1,vib:e.vib??!1,ws:e.ws??0,ssg:e.ssg??0}))??[],macros:a.macros.map(e=>({code:e.type,type:e.type,data:[...e.data],loop:e.loop,release:e.release,mode:e.mode??0,delay:e.delay,speed:e.speed})),opMacros:[],wavetables:a.wavetables.map(e=>({id:e.id,data:[...e.data],len:e.len,max:e.max}))};if(a.chipConfig){const e=a.chipConfig;if(e.gb){const t=e.gb;s.gb={envVol:t.envVol,envDir:t.envDir,envLen:t.envLen,soundLen:t.soundLen,softEnv:t.softEnv,alwaysInit:t.alwaysInit,hwSeqLen:t.hwSeqLen,hwSeq:t.hwSeq}}if(e.c64){const t=e.c64;s.c64={triOn:t.triOn,sawOn:t.sawOn,pulseOn:t.pulseOn,noiseOn:t.noiseOn,a:t.a,d:t.d,s:t.s,r:t.r,duty:t.duty,ringMod:t.ringMod,oscSync:t.oscSync,toFilter:t.toFilter,initFilter:t.initFilter,filterResonance:t.res,filterCutoff:t.cut,filterLP:t.lp,filterBP:t.bp,filterHP:t.hp,filterCh3Off:t.ch3off,dutyIsAbs:t.dutyIsAbs,filterIsAbs:t.filterIsAbs,noTest:t.noTest,resetDuty:t.resetDuty}}if(e.snes){const t=e.snes;s.snes={useEnv:t.useEnv,gainMode:t.gainMode,gain:t.gain,a:t.a,d:t.d,s:t.s,r:t.r,d2:t.d2,sus:t.sus}}if(e.n163){const t=e.n163;s.n163={wave:t.wave,wavePos:t.wavePos,waveLen:t.waveLen,waveMode:t.waveMode,perChPos:t.perChanPos??!1}}if(e.fds){const t=e.fds;s.fds={modSpeed:t.modSpeed,modDepth:t.modDepth,modTable:[...t.modTable],initModTableWithFirstWave:t.initModTableWithFirstWave}}}const r={id:t,name:e.name||`Furnace Inst ${t}`,type:"synth",synthType:n,envelope:{attack:10,decay:100,sustain:80,release:100},effects:[],volume:0,pan:0,metadata:{importedFrom:"FUR"},furnace:s,parameters:{}};a.chipConfig&&Object.keys(a.chipConfig).join(",");return r}function qT(e,t,a,n){const{audioBuffer:s,blobUrl:r}=function(e){const t=e.sampleRate||8363,a=Math.max(1,e.length),n=new Int16Array(a);if(8===e.bitDepth){const t=e.pcmData instanceof Float32Array?new Float32Array(e.pcmData):new Int8Array(e.pcmData);for(let e=0;e<a;e++)t instanceof Float32Array?n[e]=Math.round(32767*t[e]):n[e]=256*t[e]}else if(16===e.bitDepth){const t=new Int16Array(e.pcmData);for(let e=0;e<a;e++)n[e]=t[e]}const s="none"!==e.loopType?{start:e.loopStart,end:e.loopStart+e.loopLength}:void 0,r=function(e,t,a){const n=1,s=2*e.length,r=a?68:0,i=44+s+r,o=new ArrayBuffer(i),l=new DataView(o),c=(e,t)=>{for(let a=0;a<t.length;a++)l.setUint8(e+a,t.charCodeAt(a))};c(0,"RIFF"),l.setUint32(4,i-8,!0),c(8,"WAVE"),c(12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,n,!0),l.setUint32(24,t,!0),l.setUint32(28,t*n*2,!0),l.setUint16(32,2*n,!0),l.setUint16(34,16,!0),c(36,"data"),l.setUint32(40,s,!0);let u=44;for(let d=0;d<e.length;d++)l.setInt16(u,e[d],!0),u+=2;a&&(c(u,"smpl"),l.setUint32(u+4,60,!0),l.setUint32(u+8,0,!0),l.setUint32(u+12,0,!0),l.setUint32(u+16,Math.floor(1e9/t),!0),l.setUint32(u+20,60,!0),l.setUint32(u+24,0,!0),l.setUint32(u+28,0,!0),l.setUint32(u+32,0,!0),l.setUint32(u+36,1,!0),l.setUint32(u+40,0,!0),l.setUint32(u+44,0,!0),l.setUint32(u+48,0,!0),l.setUint32(u+52,a.start,!0),l.setUint32(u+56,a.end-1,!0),l.setUint32(u+60,0,!0),l.setUint32(u+64,0,!0));return o}(n,t,s),i=function(e){const t=new Uint8Array(e);let a="";for(let n=0;n<t.byteLength;n++)a+=String.fromCharCode(t[n]);return btoa(a)}(r);return{audioBuffer:r,blobUrl:`data:audio/wav;base64,${i}`}}(e),i=(e.sampleRate,function(e){const t=48+e,a=Math.floor(t/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}${a}`}(e.relativeNote,e.finetune)),o=100*e.finetune/128,l=WT(t.volumeEnvelope),c=e.sampleRate||8363,u={audioBuffer:s,url:r,baseNote:i,detune:o,loop:"none"!==e.loopType,loopStart:e.loopStart,loopEnd:e.loopStart+e.loopLength,sampleRate:c,reverse:!1,playbackRate:1},d={importedFrom:"FUR"===n||"DMF"===n?"FUR":n,originalEnvelope:t.volumeEnvelope,autoVibrato:t.autoVibrato,preservedSample:{audioBuffer:u.audioBuffer,url:u.url,baseNote:u.baseNote,detune:u.detune,loop:u.loop,loopStart:u.loopStart,loopEnd:u.loopEnd,envelope:l},modPlayback:{usePeriodPlayback:!0,periodMultiplier:3546895,finetune:e.finetune,defaultVolume:e.volume}};return{id:a,name:e.name||t.name||`Instrument ${a}`,type:"sample",synthType:"Sampler",sample:u,envelope:l,effects:[],volume:0,pan:(e.panning-128)/127*100,metadata:d,parameters:{sampleUrl:r}}}const $T=Object.freeze(Object.defineProperty({__proto__:null,analyzeSample:function(e,t){const a=function(e){if(!e||!e.enabled||e.points.length<2)return{type:"unknown",hasQuickAttack:!1,hasSustain:!1,hasLongRelease:!1};const t=WT(e),a=t.attack<20,n=t.sustain>20,s=t.release>500;let r="unknown";return a&&!n&&t.decay<300?r="pluck":a&&!n&&t.decay<100?r="percussive":!a&&n?r="pad":a&&n&&(r="sustained"),{type:r,hasQuickAttack:a,hasSustain:n,hasLongRelease:s}}(t),n="none"!==e.loopType,s=0!==e.relativeNote||n;return{dominantFrequency:s?440:null,harmonicContent:e.length<8e3&&!n&&"percussive"===a.type?"noise":s?"rich":"pure",envelopeShape:a.type,hasLoop:n,isPitched:s,bandwidth:1e3}},convertToInstrument:HT,suggestSynthConfig:function(e,t){switch(e){case"TB303":return{oscillator:{type:"rich"===t.harmonicContent?"sawtooth":"square"},filter:{cutoff:t.dominantFrequency?500:1e3,resonance:70},filterEnvelope:{envMod:60,decay:"pluck"===t.envelopeShape?200:500},accent:{amount:70},slide:{time:60,mode:"exponential"}};case"PolySynth":return{voiceCount:8,voiceType:"Synth",stealMode:"oldest",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:"pad"===t.envelopeShape?200:50,decay:500,sustain:t.hasLoop?50:0,release:100},portamento:0};case"Wavetable":return{wavetableId:"basic-saw",morphPosition:0,morphModSource:"none",morphModAmount:50,morphLFORate:2,unison:{voices:"rich"===t.harmonicContent?3:1,detune:10,stereoSpread:50},envelope:{attack:10,decay:500,sustain:0,release:100},filter:{type:"lowpass",cutoff:8e3,resonance:20,envelopeAmount:0},filterEnvelope:{attack:10,decay:500,sustain:0,release:100}};case"ChipSynth":return{channel:"pulse1",pulse:{duty:50},bitDepth:8,sampleRate:22050,envelope:{attack:5,decay:"percussive"===t.envelopeShape?100:300,sustain:0,release:50},vibrato:{speed:6,depth:0,delay:200},arpeggio:{enabled:!1,speed:15,pattern:[0,4,7]}};default:return{oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:50,decay:500,sustain:0,release:100}}}}},Symbol.toStringTag,{value:"Module"}));var XT,YT,ZT,QT,JT,eA={},tA={};function aA(){if(YT)return XT;function e(e){for(var a,n=new t(e),s=[];!n.eof();){var r=i();s.push(r)}return s;function i(){var e={};e.deltaTime=n.readVarInt();var t=n.readUInt8();if(240&~t){var s;if(128&t)s=n.readUInt8(),a=t;else{if(null===a)throw"Running status byte encountered before status byte";s=t,t=a,e.running=!0}var r=t>>4;switch(e.channel=15&t,r){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=n.readUInt8(),e;case 9:var i=n.readUInt8();return e.type=0===i?"noteOff":"noteOn",e.noteNumber=s,e.velocity=i,0===i&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=n.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=n.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(n.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+r}}else{if(255!==t){if(240==t){e.type="sysEx";l=n.readVarInt();return e.data=n.readBytes(l),e}if(247==t){e.type="endSysEx";l=n.readVarInt();return e.data=n.readBytes(l),e}throw"Unrecognised MIDI event type byte: "+t}e.meta=!0;var o=n.readUInt8(),l=n.readVarInt();switch(o){case 0:if(e.type="sequenceNumber",2!==l)throw"Expected length for sequenceNumber event is 2, got "+l;return e.number=n.readUInt16(),e;case 1:return e.type="text",e.text=n.readString(l),e;case 2:return e.type="copyrightNotice",e.text=n.readString(l),e;case 3:return e.type="trackName",e.text=n.readString(l),e;case 4:return e.type="instrumentName",e.text=n.readString(l),e;case 5:return e.type="lyrics",e.text=n.readString(l),e;case 6:return e.type="marker",e.text=n.readString(l),e;case 7:return e.type="cuePoint",e.text=n.readString(l),e;case 32:if(e.type="channelPrefix",1!=l)throw"Expected length for channelPrefix event is 1, got "+l;return e.channel=n.readUInt8(),e;case 33:if(e.type="portPrefix",1!=l)throw"Expected length for portPrefix event is 1, got "+l;return e.port=n.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=l)throw"Expected length for endOfTrack event is 0, got "+l;return e;case 81:if(e.type="setTempo",3!=l)throw"Expected length for setTempo event is 3, got "+l;return e.microsecondsPerBeat=n.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=l)throw"Expected length for smpteOffset event is 5, got "+l;var c=n.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&c],e.hour=31&c,e.min=n.readUInt8(),e.sec=n.readUInt8(),e.frame=n.readUInt8(),e.subFrame=n.readUInt8(),e;case 88:if(e.type="timeSignature",2!=l&&4!=l)throw"Expected length for timeSignature event is 4 or 2, got "+l;return e.numerator=n.readUInt8(),e.denominator=1<<n.readUInt8(),4===l?(e.metronome=n.readUInt8(),e.thirtyseconds=n.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",2!=l)throw"Expected length for keySignature event is 2, got "+l;return e.key=n.readInt8(),e.scale=n.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=n.readBytes(l),e;default:return e.type="unknownMeta",e.data=n.readBytes(l),e.metatypeByte=o,e}}}}function t(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}return YT=1,t.prototype.eof=function(){return this.pos>=this.bufferLen},t.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},t.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},t.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},t.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},t.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},t.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},t.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},t.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},t.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},XT=function(a){var n=new t(a),s=n.readChunk();if("MThd"!=s.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+s.id+"'";for(var r=function(e){var a=new t(e),n=a.readUInt16(),s=a.readUInt16(),r={format:n,numTracks:s},i=a.readUInt16();32768&i?(r.framesPerSecond=256-(i>>8),r.ticksPerFrame=255&i):r.ticksPerBeat=i;return r}(s.data),i=[],o=0;!n.eof()&&o<r.numTracks;o++){var l=n.readChunk();if("MTrk"!=l.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var c=e(l.data);i.push(c)}return{header:r,tracks:i}}}function nA(){if(QT)return ZT;function e(e,n,s){var r,i=new a,o=n.length,l=null;for(r=0;r<o;r++)!1!==s.running&&(s.running||n[r].running)||(l=null),l=t(i,n[r],l,s.useByte9ForNoteOff);e.writeChunk("MTrk",i.buffer)}function t(e,t,a,n){var s=t.type,r=t.deltaTime,i=t.text||"",o=t.data||[],l=null;switch(e.writeVarInt(r),s){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(i.length),e.writeString(i);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(i.length),e.writeString(i);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(i.length),e.writeString(i);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(i.length),e.writeString(i);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(i.length),e.writeString(i);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(i.length),e.writeString(i);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(i.length),e.writeString(i);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(c),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var u=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(u),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(o.length),e.writeBytes(o);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(o.length),e.writeBytes(o));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(o.length),e.writeBytes(o);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(o.length),e.writeBytes(o);break;case"noteOff":(l=(!1!==n&&t.byte9||n&&0==t.velocity?144:128)|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(l=144|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(l=160|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(l=176|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(l=192|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(l=208|t.channel)!==a&&e.writeUInt8(l),e.writeUInt8(t.amount);break;case"pitchBend":(l=224|t.channel)!==a&&e.writeUInt8(l);var d=8192+t.value,p=127&d,m=d>>7&127;e.writeUInt8(p),e.writeUInt8(m);break;default:throw"Unrecognized event type: "+s}return l}function a(){this.buffer=[]}return QT=1,a.prototype.writeUInt8=function(e){this.buffer.push(255&e)},a.prototype.writeInt8=a.prototype.writeUInt8,a.prototype.writeUInt16=function(e){var t=e>>8&255,a=255&e;this.writeUInt8(t),this.writeUInt8(a)},a.prototype.writeInt16=a.prototype.writeUInt16,a.prototype.writeUInt24=function(e){var t=e>>16&255,a=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(a),this.writeUInt8(n)},a.prototype.writeInt24=a.prototype.writeUInt24,a.prototype.writeUInt32=function(e){var t=e>>24&255,a=e>>16&255,n=e>>8&255,s=255&e;this.writeUInt8(t),this.writeUInt8(a),this.writeUInt8(n),this.writeUInt8(s)},a.prototype.writeInt32=a.prototype.writeUInt32,a.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},a.prototype.writeString=function(e){var t,a=e.length,n=[];for(t=0;t<a;t++)n.push(e.codePointAt(t));this.writeBytes(n)},a.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,a=[];for(a.push(127&t),t>>=7;t;){var n=127&t|128;a.push(n),t>>=7}this.writeBytes(a.reverse())}},a.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},ZT=function(t,n){if("object"!=typeof t)throw"Invalid MIDI data";n=n||{};var s,r=t.header||{},i=t.tracks||[],o=i.length,l=new a;for(function(e,t,n){var s=null==t.format?1:t.format,r=128;t.timeDivision?r=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?r=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(r=32767&t.ticksPerBeat);var i=new a;i.writeUInt16(s),i.writeUInt16(n),i.writeUInt16(r),e.writeChunk("MThd",i.buffer)}(l,r,o),s=0;s<o;s++)e(l,i[s],n);return l.buffer}}function sA(){return JT||(JT=1,tA.parseMidi=aA(),tA.writeMidi=nA()),tA}var rA,iA,oA={},lA={};function cA(){if(rA)return lA;function e(e,t,a){void 0===a&&(a="ticks");var n=0,s=e.length,r=s;if(s>0&&e[s-1][a]<=t)return s-1;for(;n<r;){var i=Math.floor(n+(r-n)/2),o=e[i],l=e[i+1];if(o[a]===t){for(var c=i;c<e.length;c++){e[c][a]===t&&(i=c)}return i}if(o[a]<t&&l[a]>t)return i;o[a]>t?r=i:o[a]<t&&(n=i+1)}return-1}return rA=1,Object.defineProperty(lA,"__esModule",{value:!0}),lA.insert=lA.search=void 0,lA.search=e,lA.insert=function(t,a,n){if(void 0===n&&(n="ticks"),t.length){var s=e(t,a[n],n);t.splice(s+1,0,a)}else t.push(a)},lA}function uA(){return iA||(iA=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=cA(),a=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var n=function(){function n(t){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",a.set(this,480),t){a.set(this,t.header.ticksPerBeat),t.tracks.forEach(function(t){t.forEach(function(t){t.meta&&("timeSignature"===t.type?n.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?n.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&n.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))})});var s=0;t.tracks[0].forEach(function(e){s+=e.deltaTime,e.meta&&("trackName"===e.type?n.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||n.meta.push({text:e.text,ticks:s,type:e.type}))}),this.update()}}return n.prototype.update=function(){var e=this,t=0,a=0;this.tempos.sort(function(e,t){return e.ticks-t.ticks}),this.tempos.forEach(function(n,s){var r=s>0?e.tempos[s-1].bpm:e.tempos[0].bpm,i=n.ticks/e.ppq-a,o=60/r*i;n.time=o+t,t=n.time,a+=i}),this.timeSignatures.sort(function(e,t){return e.ticks-t.ticks}),this.timeSignatures.forEach(function(t,a){var n=a>0?e.timeSignatures[a-1]:e.timeSignatures[0],s=(t.ticks-n.ticks)/e.ppq/n.timeSignature[0]/(n.timeSignature[1]/4);n.measures=n.measures||0,t.measures=s+n.measures})},n.prototype.ticksToSeconds=function(e){var a=(0,t.search)(this.tempos,e);if(-1!==a){var n=this.tempos[a],s=n.time,r=(e-n.ticks)/this.ppq;return s+60/n.bpm*r}return.5*(e/this.ppq)},n.prototype.ticksToMeasures=function(e){var a=(0,t.search)(this.timeSignatures,e);if(-1!==a){var n=this.timeSignatures[a],s=(e-n.ticks)/this.ppq;return n.measures+s/(n.timeSignature[0]/n.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return a.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(e){var a=(0,t.search)(this.tempos,e,"time");if(-1!==a){var n=this.tempos[a],s=(e-n.time)/(60/n.bpm);return Math.round(n.ticks+s*this.ppq)}var r=e/.5;return Math.round(r*this.ppq)},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(e){return Object.assign({},e)}),this.timeSignatures=e.timeSignatures.map(function(e){return Object.assign({},e)}),this.keySignatures=e.keySignatures.map(function(e){return Object.assign({},e)}),this.meta=e.meta.map(function(e){return Object.assign({},e)}),a.set(this,e.ppq),this.update()},n.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},n}();e.Header=n}(oA)),oA}var dA,pA={},mA={};function hA(){return dA||(dA=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(t,a){return t[e.controlChangeNames[a]]=a,t},{});var t=new WeakMap,a=new WeakMap,n=function(){function n(e,n){t.set(this,n),a.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(n.prototype,"number",{get:function(){return a.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){return t.get(this).ticksToSeconds(this.ticks)},set:function(e){var a=t.get(this);this.ticks=a.secondsToTicks(e)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n}();e.ControlChange=n}(mA)),mA}var fA,yA={};var gA,bA={};var vA,xA,wA={},kA={};function SA(){if(xA)return wA;xA=1,Object.defineProperty(wA,"__esModule",{value:!0}),wA.Instrument=void 0;var e=(vA||(vA=1,Object.defineProperty(kA,"__esModule",{value:!0}),kA.DrumKitByPatchID=kA.InstrumentFamilyByID=kA.instrumentByPatchID=void 0,kA.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],kA.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],kA.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),kA),t=new WeakMap,a=function(){function a(e,a){if(this.number=0,t.set(this,a),this.number=0,e){var n=e.find(function(e){return"programChange"===e.type});n&&(this.number=n.programNumber)}}return Object.defineProperty(a.prototype,"name",{get:function(){return this.percussion?e.DrumKitByPatchID[this.number]:e.instrumentByPatchID[this.number]},set:function(t){var a=e.instrumentByPatchID.indexOf(t);-1!==a&&(this.number=a)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"family",{get:function(){return this.percussion?"drums":e.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"percussion",{get:function(){return 9===t.get(this).channel},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},a.prototype.fromJSON=function(e){this.number=e.number},a}();return wA.Instrument=a,wA}var MA,NA,CA={};function PA(){if(MA)return CA;function e(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}MA=1,Object.defineProperty(CA,"__esModule",{value:!0}),CA.Note=void 0;var t=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(a){var n=e.exec(a),s=n[1],r=n[2];return t[s.toLowerCase()]+12*(parseInt(r,10)+1)}}(),a=new WeakMap,n=function(){function n(e,t,n){a.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(n.prototype,"name",{get:function(){return t=this.midi,a=Math.floor(t/12)-1,e(t)+a.toString();var t,a},set:function(e){this.midi=t(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"pitch",{get:function(){return e(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){var e=a.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){return a.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bars",{get:function(){return a.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},n}();return CA.Note=n,CA}function EA(){if(NA)return pA;NA=1,Object.defineProperty(pA,"__esModule",{value:!0}),pA.Track=void 0;var e=cA(),t=hA(),a=function(){if(fA)return yA;fA=1,Object.defineProperty(yA,"__esModule",{value:!0}),yA.createControlChanges=void 0;var e=hA();return yA.createControlChanges=function(){return new Proxy({},{get:function(t,a){return t[a]?t[a]:e.controlChangeIds.hasOwnProperty(a)?t[e.controlChangeIds[a]]:void 0},set:function(t,a,n){return e.controlChangeIds.hasOwnProperty(a)?t[e.controlChangeIds[a]]=n:t[a]=n,!0}})},yA}(),n=function(){if(gA)return bA;gA=1,Object.defineProperty(bA,"__esModule",{value:!0}),bA.PitchBend=void 0;var e=new WeakMap,t=function(){function t(t,a){e.set(this,a),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return e.get(this).ticksToSeconds(this.ticks)},set:function(t){var a=e.get(this);this.ticks=a.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return bA.PitchBend=t,bA}(),s=SA(),r=PA(),i=new WeakMap,o=function(){function o(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=(0,a.createControlChanges)(),this.pitchBends=[],i.set(this,t),e){var r=e.find(function(e){return"trackName"===e.type});this.name=r?r.text:""}if(this.instrument=new s.Instrument(e,this),this.channel=0,e){for(var o=e.filter(function(e){return"noteOn"===e.type}),l=e.filter(function(e){return"noteOff"===e.type}),c=function(){var e=o.shift();u.channel=e.channel;var t=l.findIndex(function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime});if(-1!==t){var a=l.splice(t,1)[0];u.addNote({durationTicks:a.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:a.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},u=this;o.length;)c();e.filter(function(e){return"controller"===e.type}).forEach(function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})}),e.filter(function(e){return"pitchBend"===e.type}).forEach(function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})});var d=e.find(function(e){return"endOfTrack"===e.type});this.endOfTrackTicks=void 0!==d?d.absoluteTime:void 0}}return o.prototype.addNote=function(t){var a=i.get(this),n=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},a);return Object.assign(n,t),(0,e.insert)(this.notes,n,"ticks"),this},o.prototype.addCC=function(a){var n=i.get(this),s=new t.ControlChange({controllerType:a.number},n);return delete a.number,Object.assign(s,a),Array.isArray(this.controlChanges[s.number])||(this.controlChanges[s.number]=[]),(0,e.insert)(this.controlChanges[s.number],s,"ticks"),this},o.prototype.addPitchBend=function(t){var a=i.get(this),s=new n.PitchBend({},a);return Object.assign(s,t),(0,e.insert)(this.pitchBends,s,"ticks"),this},Object.defineProperty(o.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var a=this.notes[t].time+this.notes[t].duration;e<a&&(e=a)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var a=this.notes[t].ticks+this.notes[t].durationTicks;e<a&&(e=a)}return e},enumerable:!1,configurable:!0}),o.prototype.fromJSON=function(e){var t=this;for(var a in this.name=e.name,this.channel=e.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[a]&&e.controlChanges[a].forEach(function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})});e.notes.forEach(function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})})},o.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map(function(e){return e.toJSON()}));var a={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map(function(e){return e.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(e){return e.toJSON()})};return void 0!==this.endOfTrackTicks&&(a.endOfTrackTicks=this.endOfTrackTicks),a},o}();return pA.Track=o,pA}var _A={};function TA(e,t){for(var a=0;a<e.length;a++){var n=e[a];Array.isArray(n)?TA(n,t):t.push(n)}}const AA=u(Object.freeze(Object.defineProperty({__proto__:null,flatten:function(e){var t=[];return TA(e,t),t}},Symbol.toStringTag,{value:"Module"})));var OA,IA;function FA(){if(OA)return _A;OA=1;var e=_A&&_A.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var n,s=0,r=t.length;s<r;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(_A,"__esModule",{value:!0}),_A.encode=void 0;var t=sA(),a=uA(),n=AA;function s(e){return(0,n.flatten)(e.notes.map(function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)}))}function r(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function i(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}return _A.encode=function(n){var o={header:{format:1,numTracks:n.tracks.length+1,ticksPerBeat:n.header.ppq},tracks:e([e(e(e(e([{absoluteTime:0,deltaTime:0,meta:!0,text:n.header.name,type:"trackName"}],n.header.keySignatures.map(function(e){return function(e){var t=a.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)}),!0),n.header.meta.map(function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t}),!0),n.header.tempos.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)}),!0),n.header.timeSignatures.map(function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)}),!0)],n.tracks.map(function(t){return e(e(e([(a=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:a,type:"trackName"}),i(t)],s(t),!0),function(e){for(var t=[],a=0;a<127;a++)e.controlChanges.hasOwnProperty(a)&&e.controlChanges[a].forEach(function(a){t.push(r(a,e.channel))});return t}(t),!0),function(e){var t=[];return e.pitchBends.forEach(function(a){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(a,e.channel))}),t}(t),!0);var a}),!0)};return o.tracks=o.tracks.map(function(e){e=e.sort(function(e,t){return e.absoluteTime-t.absoluteTime});var t=0;return e.forEach(function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime}),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e}),new Uint8Array((0,t.writeMidi)(o))},_A}var DA=(IA||(IA=1,function(e){var t=eA&&eA.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(s,r){function i(e){try{l(n.next(e))}catch(t){r(t)}}function o(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(i,o)}l((n=n.apply(e,t||[])).next())})},a=eA&&eA.__generator||function(e,t){var a,n,s,r,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,n=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){i=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){i.label=r[1];break}if(6===r[0]&&i.label<s[1]){i.label=s[1],s=r;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(r);break}s[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(o){r=[6,o],n=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var n=sA(),s=uA(),r=EA(),i=FA(),o=function(){function e(e){var t=this,a=null;if(e){var i=e instanceof ArrayBuffer?new Uint8Array(e):e;(a=(0,n.parseMidi)(i)).tracks.forEach(function(e){var t=0;e.forEach(function(e){t+=e.deltaTime,e.absoluteTime=t})}),a.tracks=function(e){for(var t=[],a=0;a<e.length;a++)for(var n=t.length,s=new Map,r=Array(16).fill(0),i=0,o=e[a];i<o.length;i++){var l=o[i],c=n,u=l.channel;if(void 0!==u){"programChange"===l.type&&(r[u]=l.programNumber);var d=r[u],p="".concat(d," ").concat(u);s.has(p)?c=s.get(p):(c=n+s.size,s.set(p,c))}t[c]||t.push([]),t[c].push(l)}return t}(a.tracks)}this.header=new s.Header(a),this.tracks=[],e&&(this.tracks=a.tracks.map(function(e){return new r.Track(e,t.header)}),1===a.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(n){return t(this,void 0,void 0,function(){var t;return a(this,function(a){switch(a.label){case 0:return[4,fetch(n)];case 1:return(t=a.sent()).ok?[4,t.arrayBuffer()]:[3,3];case 2:return[2,new e(a.sent())];case 3:throw new Error("Could not load '".concat(n,"'"))}})})},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map(function(e){return e.duration});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map(function(e){return e.durationTicks});return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(){var e=new r.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return(0,i.encode)(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(e){return e.toJSON()})}},e.prototype.fromJSON=function(e){var t=this;this.header=new s.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map(function(e){var a=new r.Track(void 0,t.header);return a.fromJSON(e),a})},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();e.Midi=o;var l=EA();Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var c=uA();Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}})}(eA)),eA);function RA(e="id"){return`${e}-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}const jA={quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64};async function BA(e,t={}){const a={...jA,...t},n=await e.arrayBuffer(),s=new DA.Midi(n),r=s.header.ppq||480;if(0===r)throw new Error("Invalid MIDI file: PPQ (pulses per quarter note) cannot be zero");const i=s.header.tempos.length>0?Math.round(s.header.tempos[0].bpm):120,o=s.header.timeSignatures.length>0?[s.header.timeSignatures[0].timeSignature[0],s.header.timeSignatures[0].timeSignature[1]]:[4,4],l=[];if(a.mergeChannels){const e=function(e,t,a,n){const s=e.duration*(e.header.tempos[0]?.bpm||120)/60,r=Math.min(256,Math.max(t.defaultPatternLength||64,Math.ceil(s*n))),i=new Map;e.tracks.forEach(e=>{e.notes.forEach(e=>{const t=e.midi%16;i.has(t)||i.set(t,[]),i.get(t).push({tick:e.ticks,note:e})})});const o=Array.from(i.entries()).sort((e,t)=>e[0]-t[0]).map(([e,s])=>{const i=Array.from({length:r},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return s.forEach(({tick:e,note:s})=>{const o=VA(e,a,n,t.quantize);if(o<0||o>=r)return;const l=rs(s.midi);if(!l)return;if(i[o].note=l,t.velocityToVolume){const e=zA(127*s.velocity);i[o].volume=16+Math.round(e/64*64)}const c=VA(e+s.durationTicks,a,n,t.quantize);c<r&&c>o&&(i[c].note=97)}),{id:RA("channel"),name:`Ch ${e+1}`,instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:i}});return{id:RA("pattern"),name:e.name||"MIDI Import",length:r,channels:o}}(s,a,r,4);l.push(e)}else for(let c=0;c<s.tracks.length;c++){const e=s.tracks[c];if(0===e.notes.length)continue;const t=LA(e,c,a,r,4);l.push(t)}return{patterns:l,bpm:i,timeSignature:o,metadata:{name:s.name||e.name.replace(/\.[^/.]+$/,""),tracks:s.tracks.length,totalTicks:s.durationTicks}}}function LA(e,t,a,n,s){const r=e.notes.length>0?e.notes[e.notes.length-1]:null,i=VA(r?r.ticks+r.durationTicks:0,n,s,0),o=Math.min(256,Math.max(a.defaultPatternLength||64,64*Math.ceil(i/64))),l=Array.from({length:o},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}));return e.notes.forEach(e=>{const t=VA(e.ticks,n,s,a.quantize);if(t<0||t>=o)return;const r=rs(e.midi);if(!r)return;if(l[t].note=r,a.velocityToVolume){const a=zA(127*e.velocity);l[t].volume=16+Math.round(a/64*64)}const i=VA(e.ticks+e.durationTicks,n,s,a.quantize);i<o&&i>t&&(l[i].note=97)}),{id:RA("pattern"),name:e.name||`Track ${t+1}`,length:o,channels:[{id:RA("channel"),name:"Channel 1",instrumentId:null,color:null,muted:!1,solo:!1,collapsed:!1,volume:80,pan:0,rows:l}]}}function VA(e,t,a,n=0){if(0===t)return 0;const s=Math.round(e/t*a);return n>0?Math.round(s/n)*n:s}function zA(e){return Math.round(e/127*64)}function UA(e,t="DB303 Pattern",a=1){const n=(new DOMParser).parseFromString(e,"text/xml"),s=n.querySelector("parsererror");if(s)throw new Error("Invalid XML: "+s.textContent);const r=n.querySelector("db303-pattern");if(!r)throw new Error("Invalid pattern XML: missing db303-pattern element");const i=parseInt(r.getAttribute("numSteps")||"16",10),o=Math.max(1,Math.min(256,isNaN(i)?16:i)),l=parseInt(r.getAttribute("rootNote")||"36",10),c=r.getAttribute("tempo")?parseInt(r.getAttribute("tempo"),10):void 0,u=r.getAttribute("swing")?parseFloat(r.getAttribute("swing")):void 0,d=[];n.querySelectorAll("step").forEach(e=>{const t=parseInt(e.getAttribute("index")||"0",10),a=parseInt(e.getAttribute("key")||"0",10),n=parseInt(e.getAttribute("octave")||"0",10),s="true"===e.getAttribute("gate"),r="true"===e.getAttribute("accent"),i="true"===e.getAttribute("slide"),o="true"===e.getAttribute("mute"),l="true"===e.getAttribute("hammer");d.push({index:t,key:a,octave:n,gate:s,accent:r,slide:i,mute:o,hammer:l})}),d.sort((e,t)=>e.index-t.index);const p=new Map(d.map(e=>[e.index,e])),m=[];let h=-1;for(let f=0;f<o;f++){const e=p.get(f);if(e){let t=0;if(e.gate){t=l+e.key+12*e.octave-11,t=Math.max(1,Math.min(96,t)),h=f}else h>=0&&(t=97);m.push({note:t,instrument:e.gate?a:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:e.accent?1:e.mute?3:e.hammer?4:void 0,flag2:e.slide?2:!e.hammer||e.accent||e.mute?void 0:4})}else m.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}return{pattern:{id:`db303-${Date.now()}`,name:t,length:o,channels:[{id:"ch-1",name:"TB-303",rows:m,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:"#22c55e"}]},tempo:c,swing:u}}function GA(e,t=120,a=0,n=36){const s=[];s.push('<?xml version="1.0" encoding="UTF-8"?>');const r=e.channels?.[0];if(!r)throw new Error("Pattern has no channels to export");const i=Math.min(e.length,32),o=a>0?` swing="${a.toFixed(2)}"`:"";s.push(`<db303-pattern version="1.0" numSteps="${i}" tempo="${Math.round(t)}"${o} rootNote="${n}">`);for(let l=0;l<i;l++){const e=r?.rows[l];if(!e){s.push(`  <step index="${l}" key="0" octave="0" gate="false" accent="false" slide="false" mute="false" hammer="false"/>`);continue}const t=e.note>0&&e.note<=96,a=t,i=1===e.flag1||1===e.flag2,o=2===e.flag1||2===e.flag2,c=3===e.flag1||3===e.flag2,u=4===e.flag1||4===e.flag2;let d=0,p=0;if(t){const t=e.note-1-n;p=Math.floor(t/12),d=(t%12+12)%12,p=Math.max(-1,Math.min(1,p))}s.push(`  <step index="${l}" key="${d}" octave="${p}" gate="${a}" accent="${i}" slide="${o}" mute="${c}" hammer="${u}"/>`)}return s.push("</db303-pattern>"),s.join("\n")}function WA(e,t="pattern",a=120,n=0,s=36){const r=GA(e,a,n,s),i=new Blob([r],{type:"application/xml"}),o=URL.createObjectURL(i),l=document.createElement("a");l.href=o,l.download=`${t}.xml`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}async function HA(e=0,t){const{useTrackerStore:a}=await ja(async()=>{const{useTrackerStore:e}=await Promise.resolve().then(()=>lb);return{useTrackerStore:e}},void 0),{useTransportStore:n}=await ja(async()=>{const{useTransportStore:e}=await Promise.resolve().then(()=>qv);return{useTransportStore:e}},void 0),s=a.getState(),r=n.getState(),i=s.patterns,o=s.currentPatternIndex;if(!i||0===i.length)return;const l=i[o];if(!l)return;let c=l;e>0&&l.channels[e]&&(c={...l,channels:[l.channels[e]]});const u=r.bpm||120,d=r.swing||0;WA(c,t||l.name?.replace(/[^a-zA-Z0-9-_]/g,"_")||"pattern",u,d,36)}if("undefined"!=typeof window){const e=window;e.exportCurrentPatternToDb303=HA,e.convertToDb303Pattern=GA,e.downloadDb303Pattern=WA}const KA=Object.freeze(Object.defineProperty({__proto__:null,convertToDb303Pattern:GA,downloadDb303Pattern:WA,exportCurrentPatternToDb303:HA,parseDb303Pattern:UA},Symbol.toStringTag,{value:"Module"})),qA=[".json",".song.json",".dbx",".xml",".mod",".xm",".it",".s3m",".mptm",".669",".amf",".ams",".dbm",".digi",".dmf",".dsm",".far",".ftm",".gdm",".gmc",".imf",".j2b",".m15",".mdl",".med",".mms",".mt2",".mtm",".okt",".psm",".pt36",".ptm",".puma",".sfx",".sfx2",".stk",".stm",".stp",".stx",".symmod",".ult",".umx",".fur",".zip",".lha",".rar",".gz",".mmcmp",".xpk",".pp",".pack",".mid",".midi"].join(",");function $A(e,t,a){const n=new Set;for(const i of e)for(const e of i.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&n.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const i of Array.from(n).sort((e,t)=>e-t)){const e=t[i-1]||`Instrument ${i}`;{const t=r[(i-1)%r.length];s.push({id:i,name:e.trim()||`Instrument ${i}`,type:"synth",synthType:"Synth",oscillator:{...Wn,type:t},envelope:{...Hn},filter:{...Kn},effects:[],volume:-6,pan:0})}}for(const i of[0,1])n.has(i)||s.push({id:i,name:0===i?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{...Wn,type:"sawtooth"},envelope:{...Hn},filter:{...Kn},effects:[],volume:-6,pan:0});return s.sort((e,t)=>e.id-t.id),s}const XA=({onShowExport:t,onShowHelp:a,onShowMasterFX:n,onShowInstruments:r,onShowPatternOrder:i,onShowDrumpads:o,showMasterFX:l})=>{const{patterns:c,currentPatternIndex:u,setCurrentPattern:d,expandPattern:p,shrinkPattern:m,resizePattern:h,loadPatterns:f,setPatternOrder:y,patternOrder:g,currentPositionIndex:b,setCurrentPosition:v,recordMode:x,editStep:w,toggleRecordMode:k,setEditStep:S,reset:M,duplicatePosition:N,removeFromOrder:C}=ob(),{isPlaying:P,isLooping:E,bpm:_,setBPM:T,speed:A,setSpeed:O,setIsLooping:I,play:F,stop:D,grooveTemplateId:R,setGrooveTemplate:j,swing:B,jitter:L,useMpcScale:V,reset:z}=Kv(),{isDirty:U,setMetadata:G,metadata:W}=Xv(),{instruments:H,loadInstruments:K,updateInstrument:q,addInstrument:$,reset:X}=Bv(),{masterEffects:Y}=$v(),{compactToolbar:Z,toggleCompactToolbar:Q,oscilloscopeVisible:J}=Vv(),{curves:ee,reset:te}=Zv(),ae=rx(e=>e.addTab),ne=Qg(),se=s.useRef(null),[re,ie]=s.useState(!1),[oe,le]=s.useState("logo"),{tap:ce,tapCount:ue,isActive:de}=function(e){const[t,a]=s.useState(0),[n,r]=s.useState(null),[i,o]=s.useState(!1),l=s.useRef([]),c=s.useRef(null),u=s.useCallback(()=>{l.current=[],a(0),r(null),o(!1),c.current&&(clearTimeout(c.current),c.current=null)},[]);return s.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),{bpm:n,tapCount:t,isActive:i,tap:s.useCallback(()=>{const t=performance.now();c.current&&clearTimeout(c.current);const n=l.current[l.current.length-1];n&&t-n>2e3&&(l.current=[]),l.current.push(t),o(!0),l.current.length>8&&(l.current=l.current.slice(-8));const s=l.current;if(a(s.length),s.length>=2){const t=[];for(let e=1;e<s.length;e++)t.push(s[e]-s[e-1]);const a=t.reduce((e,t)=>e+t,0)/t.length;let n=Math.round(6e4/a);n=Math.max(20,Math.min(999,n)),r(n),e&&e(n)}c.current=setTimeout(()=>{o(!1)},2e3)},[e]),reset:u}}(T),[pe,me]=s.useState(!1),[he,fe]=s.useState(!1),[ye,ge]=s.useState(!1),[be,ve]=s.useState(!1),[xe,we]=s.useState(!1),[ke,Se]=s.useState(!1),[Ne,Ce]=s.useState(!!document.fullscreenElement),Pe=s.useCallback(()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf("logo")+1)%e.length;le(e[t])},[]);e.useEffect(()=>{const e=()=>{Ce(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),e.useEffect(()=>{},[]);const Ee=s.useRef(null);e.useEffect(()=>{if(!pe)return;const e=e=>{pe&&Ee.current&&!Ee.current.contains(e.target)&&me(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[pe]);const _e=()=>{try{const e=c.map(e=>e.id),t={};c.forEach(e=>{e.channels.forEach((a,n)=>{const s=ee.filter(t=>t.patternId===e.id&&t.channelIndex===n);s.length>0&&(t[e.id]||(t[e.id]={}),t[e.id][n]=s.reduce((e,t)=>(e[t.parameter]=t,e),{}))})}),PT(W,_,H,c,e,Object.keys(t).length>0?t:void 0,Y.length>0?Y:void 0,ee.length>0?ee:void 0,{prettify:!0},R),px.success("Song downloaded!",2e3)}catch(e){px.error("Failed to download file")}},Te=async e=>{P&&D(),ne.releaseAll(),te(),z(),X(),ne.disposeAllInstruments(),ie(!0);try{let t,a;if(e.nativeData?.patterns){const{format:a,patterns:n,importMetadata:s,instruments:r}=e.nativeData,i=s.originalChannelCount,o=r?.map(e=>e.name)||[];if("XM"===a)t=UT(n,i,s,o,e.arrayBuffer);else if("MOD"===a)t=GT(n,i,s,o,e.arrayBuffer);else{if("FUR"!==a&&"DMF"!==a)return void px.error(`Unsupported native format: ${a}`);{const e=s.modData?.patternOrderTable||[],a=n[0]?.length||64,r=s.originalChannelCount||n[0]?.[0]?.length||4;t={patterns:n.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:a,importMetadata:s,channels:Array.from({length:r},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[a]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0}})}))})),order:e.length>0?e:[0],instrumentNames:o}}}}else{if(!e.metadata.song)return void px.error(`Module "${e.metadata.title}" has no pattern data`);t=zT(e.metadata.song)}if(e.nativeData?.instruments){const t=e.nativeData.instruments,n=e.nativeData.format;let s=1;a=[];for(const e of t){const t=HT(e,s,n);a.push(...t),s+=t.length}}else a=$A(t.patterns,t.instrumentNames);K(a),f(t.patterns),t.order&&t.order.length>0&&(y(t.order),d(t.order[0])),G({name:e.metadata.title,author:"",description:`Imported from ${e.metadata.type}`});const n=e.nativeData?.importMetadata.modData?.initialBPM;n&&T(n);const s=e.nativeData?.importMetadata.modData?.initialSpeed;s&&O(s),px.success(`Imported ${e.metadata.type}: ${e.metadata.title}`,3e3),await ne.preloadInstruments(a)}catch{px.error("Failed to import module")}finally{ie(!1)}},Ae=c[u],Oe=Ae?.length||64,Ie=g.length,Fe=P&&!E,De=P&&E;return Ea.jsxs("div",{className:"ft2-toolbar "+(Z?"ft2-toolbar-compact":""),children:[Ea.jsx("button",{className:"panel-collapse-toggle",onClick:Q,children:Z?Ea.jsx(Me,{size:12}):Ea.jsx(Et,{size:12})}),Ea.jsxs("div",{className:"flex flex-1 min-w-0 overflow-hidden min-h-[120px]",children:[Ea.jsxs("div",{className:"flex-shrink min-w-0",children:[Ea.jsxs("div",{className:"ft2-toolbar-row",children:[Ea.jsxs("div",{className:"ft2-section ft2-col-1",children:[Ea.jsx(T_,{label:"Position",value:b,onChange:e=>{v(e)},min:0,max:g.length-1,format:"hex"}),Ea.jsxs("div",{className:"flex gap-1 ml-auto",children:[Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>N(b),className:"min-w-[32px]",children:"Ins"}),Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>{g.length>1&&C(b)},disabled:g.length<=1,className:"min-w-[32px]",children:"Del"})]})]}),Ea.jsxs("div",{className:"ft2-section ft2-col-2",children:[Ea.jsx(T_,{label:"BPM",value:_,onChange:T,min:32,max:255,throttleMs:50}),Ea.jsx(qk,{variant:de?"primary":"default",size:"sm",onClick:ce,title:`Tap Tempo (${ue} taps)`,className:"min-w-[40px] ml-1",children:Ea.jsx(Yt,{size:14})})]}),Ea.jsx("div",{className:"ft2-section ft2-col-3",children:Ea.jsx(T_,{label:"Pattern",value:g[b]??u,onChange:e=>{const t=[...g];t[b]=e,y(t),d(e)},min:0,max:c.length-1,format:"hex"})}),Ea.jsx("div",{className:"ft2-section ft2-col-instrument",children:Ea.jsx(D_,{})}),Ea.jsxs("div",{className:"ft2-section ft2-section-playback",children:[Ea.jsx(qk,{variant:Fe?"danger":"primary",size:"sm",onClick:async()=>{P&&!E?(qS().stop(),D(),ne.releaseAll()):(P&&(qS().stop(),D(),ne.releaseAll()),I(!1),await ne.init(),F())},className:"min-w-[72px]",children:Fe?"Stop Song":"Play Song"}),Ea.jsx(qk,{variant:De?"danger":"primary",size:"sm",onClick:async()=>{P&&E?(qS().stop(),D(),ne.releaseAll()):(P&&(qS().stop(),D(),ne.releaseAll()),I(!0),await ne.init(),F())},className:"min-w-[88px]",children:De?"Stop Pattern":"Play Pattern"}),Ea.jsx(qk,{variant:x?"danger":"default",size:"sm",className:"min-w-[48px]",onClick:k,children:x?" Rec":"Rec"})]})]}),!Z&&Ea.jsxs("div",{className:"ft2-toolbar-row",children:[Ea.jsx("div",{className:"ft2-section ft2-col-1",children:Ea.jsx(T_,{label:"Song Len",value:Ie,onChange:e=>{const t=g.length;if(e>t){const a=[...g];for(let n=t;n<e;n++)a.push(g[g.length-1]??0);y(a)}else if(e<t&&e>=1){const t=g.slice(0,e);y(t),b>=e&&v(e-1)}},min:1,max:256,format:"hex"})}),Ea.jsxs("div",{className:"ft2-section ft2-col-2",children:[Ea.jsx(T_,{label:"Speed",value:A,onChange:O,min:1,max:31,format:"hex"}),Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>fe(!0),title:`Groove & Swing Settings (Current: ${$n.find(e=>e.id===R)?.name||"None"})`,className:"min-w-[32px] ml-1 "+("straight"!==R||B!==(V?50:100)||L>0?"text-accent-primary font-bold shadow-glow-sm border-accent-primary/50":""),children:"Groove"}),he&&Ea.jsx(pT,{onClose:()=>fe(!1)})]}),Ea.jsx("div",{className:"ft2-section ft2-col-3",children:Ea.jsx(T_,{label:"Length",value:Oe,onChange:e=>{e>=1&&e<=256&&h(u,e)},min:1,max:256,format:"hex",presets:[{label:"16 rows",value:16},{label:"32 rows",value:32},{label:"48 rows",value:48},{label:"64 rows (default)",value:64},{label:"96 rows",value:96},{label:"128 rows",value:128},{label:"192 rows",value:192},{label:"256 rows (max)",value:256}]})}),Ea.jsx("div",{className:"ft2-section ft2-col-4"})]}),!Z&&Ea.jsxs("div",{className:"ft2-toolbar-row",children:[Ea.jsx("div",{className:"ft2-section ft2-col-1",children:Ea.jsx(T_,{label:"Edit Step",value:w,onChange:S,min:0,max:16,format:"hex"})}),Ea.jsx("div",{className:"ft2-section ft2-col-2",children:Ea.jsxs("div",{className:"ft2-numeric-group",children:[Ea.jsx("span",{className:"ft2-numeric-label",children:"Modify:"}),Ea.jsxs("div",{className:"flex gap-1 ml-1",children:[Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>p?.(u),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Expand"}),Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>m?.(u),className:"min-w-[48px] text-[10px] py-0 h-5",children:"Shrink"})]})]})}),Ea.jsx("div",{className:"ft2-section ft2-col-3"}),Ea.jsx("div",{className:"ft2-section ft2-col-4"})]}),Ea.jsx("div",{className:"ft2-toolbar-row ft2-toolbar-row-menu",children:Ea.jsxs("div",{className:"ft2-section",children:[Ea.jsx("input",{ref:se,type:"file",accept:qA,onChange:async e=>{const t=e.target.files?.[0];if(t)if(e.target.value="",e_(t.name))ve(!0);else{P&&(D(),ne.releaseAll()),ie(!0);try{if(t.name.toLowerCase().endsWith(".xml")){const e=await t.text(),a=t.name.replace(".xml","")||"Imported Pattern",{pattern:n}=UA(e,a),s=[...c,n];return f(s),d(s.length-1),px.success(`Loaded DB303 pattern: ${n.name}`),void ie(!1)}if(function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return".mid"===t||".midi"===t}(t.name)){const e=await BA(t,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64}),a=$A(e.patterns,[]);f(e.patterns),K(a),G({name:e.metadata.name,author:"",description:`Imported from ${t.name} (${e.metadata.tracks} tracks)`}),T(e.bpm),px.success(`Loaded MIDI: ${e.metadata.name}`)}else{const e=await TT(t);if(!e)return void px.error("Failed to import song");const{needsMigration:a,migrateProject:n}=await ja(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>Ov);return{needsMigration:e,migrateProject:t}},void 0);let s=e.patterns,r=e.instruments;if(a(s,r)){const e=n(s,r);s=e.patterns,r=e.instruments}if(f(s),e.sequence&&Array.isArray(e.sequence)){const t=new Map(s.map((e,t)=>[e.id,t])),a=e.sequence.map(e=>t.get(e)).filter(e=>void 0!==e);a.length>0&&y(a)}r&&K(r),e.masterEffects&&$v.getState().setMasterEffects(e.masterEffects),T(e.bpm),G(e.metadata),j(e.grooveTemplateId||"straight"),px.success(`Loaded: ${e.metadata?.name||t.name}`)}}catch(a){px.error(`Failed to load ${t.name}`)}finally{ie(!1)}}},className:"hidden"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:()=>we(!0),disabled:re,loading:re,children:"Load"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:_e,children:U?"Save*":"Save"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:_e,children:"Download"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:t,children:"Export"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:()=>ae(),icon:Ea.jsx(Qe,{size:14}),iconPosition:"left",children:"New"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:()=>Se(!0),children:"Clear"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:i,children:"Order"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:r,children:"Instruments"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:o,children:"Pads"}),Ea.jsx(qk,{variant:l?"primary":"ghost",size:"sm",onClick:n,children:"Master FX"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:a,children:"Help"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:()=>ge(!0),children:"Settings"}),Ea.jsx(qk,{variant:Ne?"primary":"ghost",size:"sm",onClick:async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){}},title:Ne?"Exit Fullscreen (F11)":"Enter Fullscreen (F11)",children:Ne?Ea.jsx(Vt,{size:14}):Ea.jsx(Lt,{size:14})})]})})]}),Ea.jsx(L_,{variant:"compact",className:"flex-1 min-w-[120px] border-l border-dark-border cursor-pointer group",style:{display:"flex",alignItems:"stretch",justifyContent:"center"},children:Ea.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",onClick:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf(oe)+1)%e.length;le(e[t])},children:[Ea.jsx("button",{onClick:e=>{e.stopPropagation();Vv.getState().oscilloscopePoppedOut?j_("DEViLBOX  Visualizer"):Vv.getState().setOscilloscopePoppedOut(!0)},className:"absolute top-1 right-1 p-0.5 rounded text-text-muted/0 group-hover:text-text-muted hover:!text-cyan-400 transition-all z-10",title:"Pop out visualizer",children:Ea.jsx(We,{size:12})}),Ea.jsxs("div",{className:"absolute bottom-1 right-2 text-[9px] font-mono text-text-muted opacity-40 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:["v",Ik]}),J&&Ea.jsxs(Ea.Fragment,{children:[("waveform"===oe||"spectrum"===oe)&&Ea.jsx(V_,{width:"auto",height:Z?70:100,mode:oe}),"channels"===oe&&Ea.jsx(z_,{height:Z?70:100}),"logo"===oe&&Ea.jsx(U_,{height:Z?70:100,onComplete:Pe}),"circular"===oe&&Ea.jsx(G_,{height:Z?70:100}),"bars"===oe&&Ea.jsx(W_,{height:Z?70:100}),"particles"===oe&&Ea.jsx(H_,{height:Z?70:100}),"chanWaves"===oe&&Ea.jsx(K_,{height:Z?70:100}),"chanActivity"===oe&&Ea.jsx(q_,{height:Z?70:100}),"chanSpectrum"===oe&&Ea.jsx($_,{height:Z?70:100}),"chanCircular"===oe&&Ea.jsx(X_,{height:Z?70:100}),"chanParticles"===oe&&Ea.jsx(Y_,{height:Z?70:100}),"chanRings"===oe&&Ea.jsx(Z_,{height:Z?70:100}),"chanTunnel"===oe&&Ea.jsx(Q_,{height:Z?70:100}),"chanRadar"===oe&&Ea.jsx(J_,{height:Z?70:100}),"chanNibbles"===oe&&Ea.jsx(lT,{height:Z?70:100,onExit:()=>{const e=["waveform","spectrum","channels","logo","circular","bars","particles","chanWaves","chanActivity","chanSpectrum","chanCircular","chanParticles","chanRings","chanTunnel","chanRadar","chanNibbles","sineScroll"],t=(e.indexOf("chanNibbles")+1)%e.length;le(e[t])}}),"sineScroll"===oe&&Ea.jsx(cT,{height:Z?70:100})]})]})})]}),ye&&Ea.jsx(dT,{onClose:()=>ge(!1)}),Ea.jsx(n_,{isOpen:be,onClose:()=>ve(!1),onImport:Te}),Ea.jsx(NT,{isOpen:xe,onClose:()=>we(!1),mode:"load",onLoad:async(e,t)=>{P&&(D(),ne.releaseAll());try{const n="string"==typeof e?e:null;if(n&&t.toLowerCase().endsWith(".xml"))try{const e=n.includes("<db303-preset"),a=n.includes("<db303-pattern");if(e){const{parseDb303Preset:e}=await ja(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-Dp8mjs8G.js");return{parseDb303Preset:e}},[]),a=e(n);let s=H.find(e=>"TB303"===e.synthType);if(!s){const{createDefaultTB303Instrument:e}=await ja(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-u4Vykyyz.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();$(t),s=t}const r={...s.tb303,...a};q(s.id,{tb303:r});H.find(e=>e.id===s.id);return void px.success(`Loaded DB303 preset: ${t.replace(".xml","")}`)}if(a){const e=t.replace(".xml","")||"Imported Pattern";let a=H.find(e=>"TB303"===e.synthType);if(!a){const{createDefaultTB303Instrument:e}=await ja(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-u4Vykyyz.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();$(t),a=t}const{pattern:s,tempo:r}=UA(n,e,a.id);s.channels[0].instrumentId=a.id;const i=[...c,s];return f(i),d(i.length-1),y([i.length-1]),void 0!==r&&T(r),void px.success(`Loaded DB303 pattern: ${s.name} (${s.length} steps${r?`, ${r} BPM`:""})`)}return void px.error("Unknown XML format. Expected db303-pattern or db303-preset.")}catch(a){return void px.error(`Failed to parse XML: ${a instanceof Error?a.message:"Unknown error"}`)}const s=e,{needsMigration:r,migrateProject:i}=await ja(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>Ov);return{needsMigration:e,migrateProject:t}},void 0);let o=s.patterns,l=s.instruments;if(r(o,l)){const e=i(o,l);o=e.patterns,l=e.instruments}if(o&&(f(o),s.sequence&&Array.isArray(s.sequence))){const e=new Map(o.map((e,t)=>[e.id,t])),t=s.sequence.map(t=>e.get(t)).filter(e=>void 0!==e);t.length>0&&y(t)}l&&K(l),s.metadata&&G(s.metadata),s.bpm&&T(s.bpm),j(s.grooveTemplateId||"straight"),px.success(`Loaded: ${s.metadata?.name||t}`)}catch{px.error("Failed to load file")}},onLoadTrackerModule:async(e,t)=>{P&&(D(),ne.releaseAll());try{const a=t.toLowerCase();if(a.endsWith(".sqs")||a.endsWith(".seq")){const{parseTD3File:t}=await ja(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:a}=await ja(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-CBKh8Tva.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([6,1,2,3,4])),{loadPatterns:n,setCurrentPattern:s,setPatternOrder:r}=ob.getState(),{instruments:i,addInstrument:o}=Bv.getState();let l=i.find(e=>"TB303"===e.synthType);if(!l){const{createDefaultTB303Instrument:e}=await ja(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-u4Vykyyz.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();o(t),l=t}const c=await t(e);if(0===c.patterns.length)return void px.error("No patterns found in file");const u=Bv.getState().instruments.findIndex(e=>e.id===l.id)+1||1,d=c.patterns.map((e,t)=>{const n=a(e.steps,2),s=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:s,channels:[{id:`ch-${l.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:l.id,color:"#ec4899",rows:n.slice(0,s).map(e=>({...e,instrument:e.note?u:0}))}]}});n(d),s(0),r(d.map((e,t)=>t)),px.success(`Imported ${d.length} TD-3 pattern(s)`)}else{const{loadModuleFile:a}=await ja(async()=>{const{loadModuleFile:e}=await Promise.resolve().then(()=>a_);return{loadModuleFile:e}},void 0),n=await a(new File([e],t));n&&await Te(n)}}catch{px.error("Failed to load file")}}}),ke&&Ea.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60",children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg p-6 max-w-sm w-full mx-4 shadow-xl",children:[Ea.jsx("h2",{className:"text-lg font-bold text-text-primary mb-4",children:"Clear Project"}),Ea.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"What would you like to clear?"}),Ea.jsxs("div",{className:"flex flex-col gap-2",children:[Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>{P&&(D(),ne.releaseAll()),X(),Se(!1),px.success("Instruments cleared")},children:"Clear Instruments"}),Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>{P&&(D(),ne.releaseAll()),M(),Se(!1),px.success("Song data cleared")},children:"Clear Song Data"}),Ea.jsx(qk,{variant:"default",size:"sm",onClick:()=>{P&&(D(),ne.releaseAll()),X(),M(),Se(!1),px.success("Project cleared")},children:"Clear Both"}),Ea.jsx(qk,{variant:"danger",size:"sm",onClick:()=>{P&&(D(),ne.releaseAll()),X(),M(),z(),Se(!1),px.success("Reset to defaults")},children:"Reset to Defaults"}),Ea.jsx(qk,{variant:"ghost",size:"sm",onClick:()=>Se(!1),children:"Cancel"})]})]})})]})},YA=(e,t,a)=>{const n=Math.log(t),s=Math.log(a);return(Math.log(e)-n)/(s-n)},ZA=e.memo(({value:e,min:t,max:a,label:n,title:r,unit:i="",onChange:o,logarithmic:l=!1,defaultValue:c,size:u="md",color:d="#00d4aa",displayValue:p,isActive:m=!1,bipolar:h=!1,formatValue:f,step:y,disabled:g=!1})=>{const b=s.useRef(null),[v,x]=s.useState(!1),[w,k]=s.useState(!1),[S,M]=s.useState(!1),[N,C]=s.useState({x:0,y:0}),P=s.useRef(0),E=s.useRef(0),_=s.useRef(0),T=s.useRef(0),A=s.useRef(null),O=s.useRef(null),I=s.useRef(null),F=s.useId(),D=s.useRef(o),R=s.useRef(t),j=s.useRef(a),B=s.useRef(l),L=s.useRef(y);s.useEffect(()=>{D.current=o,R.current=t,j.current=a,B.current=l,L.current=y},[o,t,a,l,y]);const V="cyan-lineart"===cx(e=>e.currentThemeId),z=V?"#00ffff":d,U=V?"#0a3a3a":"#2a2a2a",G=V?"#0a4a4a":"#444",W=V?"#0a4a4a":"#4a4a4a",H=V?"#0a3a3a":"#3a3a3a",K=V?"#0a2a2a":"#2a2a2a",{knob:q,fontSize:$,stroke:X}={sm:{knob:40,fontSize:10,stroke:3},md:{knob:56,fontSize:11,stroke:4},lg:{knob:72,fontSize:12,stroke:5}}[u],Y=s.useCallback(()=>l?YA(Math.max(t,Math.min(a,e)),t,a):(e-t)/(a-t),[e,t,a,l]),Z=s.useCallback(()=>{const n=void 0!==p?p:e,s=Math.max(t,Math.min(a,n));return l?YA(s,t,a):(s-t)/(a-t)},[p,e,t,a,l])(),Q=isNaN(Z)||!isFinite(Z)?-135:270*Z-135,J=f||(e=>isNaN(e)||null==e?"0":e>=1e3?`${(e/1e3).toFixed(1)}k`:e<10?e.toFixed(1):Math.round(e).toString()),ee=h?0:-135,te=Q,ae=(q-2*X)/2,ne=q/2,se=e=>{const t=((isNaN(e)||!isFinite(e)?-135:e)-90)*Math.PI/180;return{x:ne+ae*Math.cos(t),y:ne+ae*Math.sin(t)}},re=(e,t)=>{const a=se(e),n=se(t),s=Math.abs(t-e)>180?1:0,r=t>e?1:0;return`M ${a.x} ${a.y} A ${ae} ${ae} 0 ${s} ${r} ${n.x} ${n.y}`},ie=s.useCallback(()=>{A.current&&(clearTimeout(A.current),A.current=null)},[]),oe=s.useCallback(e=>{if(g)return;const t=Date.now();t-T.current<300?(ie(),PS(),k(!0),T.current=0):T.current=t},[g,ie]),le=s.useCallback(e=>{if(g)return;const t=b.current?.getBoundingClientRect();t&&C({x:t.left+t.width/2,y:t.top}),A.current=setTimeout(()=>{ES(),M(!0)},500)},[g]),ce=s.useCallback(e=>{_S(),o(e),M(!1)},[o]),ue=s.useCallback(e=>{const n=Math.max(t,Math.min(a,e));_S(),o(n),k(!1)},[t,a,o]),de=s.useCallback(e=>{if(g)return;e.preventDefault();const t="touches"in e,a=t?e.touches[0].clientY:e.clientY,n=t?e.touches[0].clientX:e.clientX;t&&(oe(e),le(e)),x(!0),P.current=a,E.current=n,_.current=Y(),document.body.style.cursor="ns-resize";const s=e=>{ie();const t="touches"in e?e.touches[0].clientY:e.clientY,a="touches"in e?e.touches[0].clientX:e.clientX,n=P.current-t,s=a-E.current,r=(Math.abs(s)>Math.abs(n)?s:n)/150,i=Math.max(0,Math.min(1,_.current+r));let o;o=B.current?((e,t,a)=>{const n=Math.log(t),s=Math.log(a);return Math.exp(n+e*(s-n))})(i,R.current,j.current):R.current+i*(j.current-R.current);const l=L.current;o=void 0!==l&&l>0?Math.round(o/l)*l:Math.round(100*o)/100,I.current=o,O.current||(O.current=requestAnimationFrame(()=>{null!==I.current&&(D.current(I.current),I.current=null),O.current=null}))},r=()=>{ie(),x(!1),document.body.style.cursor="",window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r),window.removeEventListener("touchmove",s),window.removeEventListener("touchend",r),O.current&&(cancelAnimationFrame(O.current),O.current=null)};window.addEventListener("mousemove",s),window.addEventListener("mouseup",r),window.addEventListener("touchmove",s,{passive:!1}),window.addEventListener("touchend",r)},[Y,g,oe,le,ie]),pe=s.useCallback(()=>{g||o(void 0!==c?c:h?(a+t)/2:t)},[c,h,t,a,o,g]),me=s.useCallback(e=>{e.preventDefault(),g||o(void 0!==c?c:h?(a+t)/2:t)},[c,h,t,a,o,g]),he=s.useCallback(n=>{let s=e;const r=y||(l?(a-t)/100:(a-t)/50),i=10*r;switch(n.key){case"ArrowUp":case"ArrowRight":n.preventDefault(),s=Math.min(a,e+(n.shiftKey?i:r));break;case"ArrowDown":case"ArrowLeft":n.preventDefault(),s=Math.max(t,e-(n.shiftKey?i:r));break;case"Home":n.preventDefault(),s=t;break;case"End":n.preventDefault(),s=a;break;case"PageUp":n.preventDefault(),s=Math.min(a,e+i);break;case"PageDown":n.preventDefault(),s=Math.max(t,e-i);break;default:return}s=void 0!==y&&y>0?Math.round(s/y)*y:a-t>100?Math.round(s):Math.round(10*s)/10,o(s)},[e,t,a,l,y,o]);s.useEffect(()=>()=>{O.current&&cancelAnimationFrame(O.current),ie()},[ie]);const fe=se(Q),ye={x:ne+(ae-8)*Math.cos((Q-90)*Math.PI/180),y:ne+(ae-8)*Math.sin((Q-90)*Math.PI/180)};return Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("div",{className:"knob-container",style:{width:q+20,opacity:g?.4:1,pointerEvents:g?"none":"auto",touchAction:"none"},title:r,children:[n&&Ea.jsx("div",{className:"knob-label",style:{fontSize:$-1},children:n}),Ea.jsx("div",{ref:b,className:"knob-body "+(v?"cursor-grabbing":""),style:{width:q,height:q,touchAction:"none"},onMouseDown:de,onTouchStart:de,onDoubleClick:pe,onContextMenu:me,onKeyDown:he,role:"slider","aria-label":`${n||"Knob"}${i?` (${i})`:""}`,"aria-valuemin":t,"aria-valuemax":a,"aria-valuenow":Math.round(10*e)/10,"aria-valuetext":`${J(void 0!==p?p:e)}${i}`,tabIndex:0,children:Ea.jsxs("svg",{width:q,height:q,viewBox:`0 0 ${q} ${q}`,children:[Ea.jsx("path",{d:re(-135,135),fill:"none",stroke:U,strokeWidth:X,strokeLinecap:"round"}),h?.5!==Z&&Ea.jsx("path",{d:re(Z>.5?ee:te,Z>.5?te:ee),fill:"none",stroke:z,strokeWidth:X,strokeLinecap:"round",style:{filter:m?`drop-shadow(0 0 4px ${z})`:`drop-shadow(0 0 2px ${z})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}):Ea.jsx("path",{d:re(-135,Q),fill:"none",stroke:z,strokeWidth:X,strokeLinecap:"round",style:{filter:m?`drop-shadow(0 0 4px ${z})`:`drop-shadow(0 0 2px ${z})`,transition:void 0!==p?"none":"stroke-dasharray 0.05s ease-out"}}),Ea.jsx("circle",{cx:ne,cy:ne,r:ae-X-4,fill:`url(#kg-${F})`,stroke:G,strokeWidth:"1"}),Ea.jsx("line",{x1:ye.x,y1:ye.y,x2:fe.x,y2:fe.y,stroke:z,strokeWidth:"2",strokeLinecap:"round",style:{filter:m?`drop-shadow(0 0 3px ${z})`:"none",transition:void 0!==p?"transform 0.016s linear":"transform 0.1s ease-out"}}),Ea.jsx("defs",{children:Ea.jsxs("linearGradient",{id:`kg-${F}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[Ea.jsx("stop",{offset:"0%",stopColor:W}),Ea.jsx("stop",{offset:"50%",stopColor:H}),Ea.jsx("stop",{offset:"100%",stopColor:K})]})})]})}),Ea.jsxs("div",{className:"knob-value",style:{fontSize:$,color:m?z:void 0,textShadow:m?`0 0 4px ${z}80`:"none"},children:[J(void 0!==p?p:e),i]})]}),w&&Ea.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center",onClick:()=>k(!1),children:Ea.jsxs("div",{className:"bg-dark-bgSecondary rounded-lg p-6 shadow-xl",onClick:e=>e.stopPropagation(),children:[Ea.jsx("div",{className:"text-sm font-mono text-text-secondary mb-3",children:n||"Value"}),Ea.jsx("input",{type:"number",min:t,max:a,step:y,defaultValue:e,autoFocus:!0,className:"w-full px-4 py-3 text-lg font-mono bg-dark-bg border-2 border-accent-primary rounded-lg text-text-primary focus:outline-none",onKeyDown:e=>{"Enter"===e.key?ue(parseFloat(e.currentTarget.value)):"Escape"===e.key&&k(!1)}}),Ea.jsxs("div",{className:"flex gap-2 mt-4",children:[Ea.jsx("button",{onClick:()=>ue(parseFloat(document.querySelector('input[type="number"]')?.value||String(e))),className:"flex-1 py-2 bg-accent-primary text-text-inverse rounded-lg font-mono text-sm",children:"OK"}),Ea.jsx("button",{onClick:()=>k(!1),className:"flex-1 py-2 bg-dark-bgTertiary text-text-secondary rounded-lg font-mono text-sm",children:"Cancel"})]})]})}),S&&Ea.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>M(!1),children:Ea.jsxs("div",{className:"absolute bg-dark-bgSecondary rounded-lg shadow-xl p-2 min-w-[120px]",style:{left:`${N.x}px`,top:`${N.y}px`,transform:"translate(-50%, -100%) translateY(-8px)"},onClick:e=>e.stopPropagation(),children:[Ea.jsx("div",{className:"text-xs font-mono text-text-muted text-center mb-2 px-2 py-1",children:n||"Preset"}),[0,.25,.5,.75,1].map(e=>{const n=t+e*(a-t);return Ea.jsxs("button",{onClick:()=>ce(n),className:"w-full px-3 py-2 text-sm font-mono text-text-secondary hover:bg-accent-primary hover:text-text-inverse rounded transition-colors",children:[(100*e).toFixed(0),"% (",J(n),i,")"]},e)})]})})]})},(e,t)=>e.value===t.value&&e.displayValue===t.displayValue&&e.isActive===t.isActive&&e.min===t.min&&e.max===t.max&&e.label===t.label&&e.color===t.color&&e.size===t.size&&e.disabled===t.disabled);ZA.displayName="Knob";const QA=200,JA=["ACID SCREAM: Cutoff LOW (20-30%) + Resonance HIGH (90%+) + Env Mod HIGH (90%+) = maximum squelch","The filter envelope is the soul of acid. Env Mod controls HOW FAR the filter sweeps, Decay controls HOW LONG","For fat basslines, keep Resonance below 40% and Cutoff around 50%. Resonance scoops out the bass!","Accent doesn't just add volume  it pushes the filter HARDER. Accent + high Env Mod = face-melting sweep","Classic 303 trick: Set Cutoff to 0%, Env Mod to 100%, Resonance to 80%. Every note becomes a filter sweep from zero","Slides are everything in acid. Enable Devil Fish mods and crank the Slide time for long, gliding portamento","SAW wave = buzzy, aggressive acid. SQR wave = hollow, woody, more vintage. Mix with Sub Osc for both","PWM on square wave adds movement and thickness. Automate it with the LFO for evolving textures","Sub Oscillator adds weight without muddying the filter. Set SubG to 30-50% for solid low-end foundation","Devil Fish 'Drive' pushes the filter into saturation. Even small amounts (10-20%) add analog warmth","The Korg Ladder filter (in Mods) has a completely different character  darker, more aggressive self-oscillation","For dub techno bass: Cutoff 40%, Reso 30%, Env Mod 50%, Decay 70%. Warm and deep, not screaming","Quick reset: Double-click any knob to snap it back to its default value","Try the Phaser effect at low mix (10-20%) for subtle stereo movement on your acid lines","Delay + high feedback + short time = metallic resonance. Great for industrial acid textures","LFO  Filter at slow rate creates classic auto-wah. Speed it up for ring-mod-like timbres","Accent works best on every 2nd or 4th note. Too many accents = no accents. Let them breathe","Diode character (in Mods) adds asymmetric distortion  the secret sauce of real 303 clones","LP/BP mix blends lowpass and bandpass. Bandpass at high resonance creates nasal, vocal-like tones","For TB-303 authenticity: SAW wave, Cutoff 25%, Reso 60%, Env Mod 75%, Decay 40%. Pure Roland acid"],eO=s.memo(({config:e,instrumentId:t})=>{const a=s.useRef(null),n=s.useRef(null),r=s.useRef(null),[i,o]=s.useState(200),l=s.useRef(e);s.useEffect(()=>{l.current=e});s.useEffect(()=>{const e=a.current;if(!e)return;const t=()=>{const t=e.getBoundingClientRect();t.width>0&&o(Math.floor(t.width))};t();const n=new ResizeObserver(t);return n.observe(e),()=>n.disconnect()},[]),s.useLayoutEffect(()=>{const e=n.current;if(!e)return;const t=e.getContext("2d",{alpha:!1});if(!t)return;const a=window.devicePixelRatio||1;e.width=i*a,e.height=80*a,t.setTransform(1,0,0,1,0,0),t.scale(a,a),r.current=t},[i]);const c=s.useCallback(()=>{const e=r.current;if(!e)return!1;const a=i,n=80,s=l.current;e.fillStyle="#0d0d0d",e.fillRect(0,0,a,n);const o=Qg().getInstrumentAnalyser(t);let c=!1;if(o){const t=o.getWaveform();if(o.hasActivity()){c=!0,e.strokeStyle="#ffcc00",e.lineWidth=1.5,e.shadowColor="#ffcc00",e.shadowBlur=4,e.beginPath();const s=a/t.length;for(let a=0;a<t.length;a++){const r=(t[a]+1)/2*n;0===a?e.moveTo(a*s,r):e.lineTo(a*s,r)}e.stroke(),e.shadowBlur=0}}if(!c){const t=s.filter?.cutoff??.5,n=s.filter?.resonance??0,r=s.filterEnvelope?.envMod??.5,i=.5+24.5*n,o=36,l=1.6,c=(e,t,a)=>{if(t<=.001)return e<.001?1:1e-4;const n=e/t,s=n*n;return 1/Math.max(Math.sqrt((1-s)*(1-s)+s/(a*a)),1e-4)},u=(t,n,s,r,i)=>{e.beginPath(),e.strokeStyle=s,e.lineWidth=r,i?e.setLineDash(i):e.setLineDash([]);for(let u=0;u<a;u++){const s=u/a,r=20*Math.log10(Math.max(c(s,t,n),1e-4)),i=Math.max(2,Math.min(78,o-r*l));0===u?e.moveTo(u,i):e.lineTo(u,i)}e.stroke(),e.setLineDash([])};if(r>.02){u(Math.min(1,t+r*(1-t)),i,"rgba(255, 204, 0, 0.12)",1,[4,4])}u(t,i,"rgba(255, 204, 0, 0.4)",1.5),e.shadowColor="#ffcc00",e.shadowBlur=3,u(t,i,"rgba(255, 204, 0, 0.15)",1),e.shadowBlur=0,e.fillStyle="rgba(255, 204, 0, 0.25)",e.font="7px monospace",e.fillText("FILTER",4,76)}return c},[t,i]);return s.useEffect(()=>{let e,t=!0,a=0;const n=s=>{t&&(s-a>=33&&(a=s,c()),e=requestAnimationFrame(n))};return e=requestAnimationFrame(n),()=>{t=!1,cancelAnimationFrame(e)}},[c]),Ea.jsx("div",{ref:a,className:"w-full",style:{height:"80px"},children:Ea.jsx("canvas",{ref:n,className:"rounded",style:{width:"100%",height:"80px",display:"block"}})})});eO.displayName="DB303Scope";const tO=({instrumentId:e})=>{const[t,a]=s.useState(null),[n,r]=s.useState(!1);return s.useEffect(()=>{const e=()=>{r("undefined"!=typeof window&&!!window.DB303_TRACE)};e();const t=setInterval(e,2e3);return()=>clearInterval(t)},[]),s.useEffect(()=>{if(!n)return void a(null);let t=!1;const s=async()=>{try{const{getToneEngine:n}=await ja(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>Jg);return{getToneEngine:e}},void 0),s=n().instruments,r=s?.get(e);if(r?.getDiagnostics){const e=await r.getDiagnostics();!t&&e&&Object.keys(e).length>0&&a(e)}}catch{}};s();const r=setInterval(s,500);return()=>{t=!0,clearInterval(r)}},[e,n]),n&&t?Ea.jsx("div",{className:"absolute inset-0 flex items-end pointer-events-none",style:{fontSize:"8px",fontFamily:"monospace"},children:Ea.jsxs("div",{className:"bg-black/70 text-green-400 px-2 py-0.5 rounded-t flex gap-3 flex-wrap",children:[void 0!==t.cutoff&&Ea.jsxs("span",{children:["CUT:",t.cutoff.toFixed(3)]}),void 0!==t.resonance&&Ea.jsxs("span",{children:["RES:",t.resonance.toFixed(3)]}),void 0!==t.envMod&&Ea.jsxs("span",{children:["ENV:",t.envMod.toFixed(3)]}),void 0!==t.volume&&Ea.jsxs("span",{children:["VOL:",t.volume.toFixed(3)]}),void 0!==t.peakAmplitude&&Ea.jsxs("span",{children:["PEAK:",t.peakAmplitude.toFixed(4)]}),void 0!==t.currentNote&&Ea.jsxs("span",{children:["NOTE:",t.currentNote]})]})}):null},aO=s.memo(({config:e,onChange:t,onPresetLoad:a,isBuzz3o3:n=!1,instrumentId:r,headerActions:i})=>{const o={...qn,...e,oscillator:{...qn.oscillator,...e.oscillator},filter:{...qn.filter,...e.filter},filterEnvelope:{...qn.filterEnvelope,...e.filterEnvelope},accent:{...qn.accent,...e.accent},slide:{...qn.slide,...e.slide}},l=s.useRef(null),[c,u]=s.useState("osc"),d=!n||"lfo"!==c&&"fx"!==c?c:"osc",p=s.useRef(o);s.useEffect(()=>{p.current=o});const m=Gw(e=>e.setKnobPage);s.useEffect(()=>{const e={osc:1,mojo:2,lfo:3,devilfish:4,fx:5}[d];void 0!==e&&m(e)},[d,m]);const[h,f]=s.useState(()=>Math.floor(Math.random()*JA.length)),[y,g]=s.useState(!1),b=s.useCallback(e=>{g(!0),setTimeout(()=>{f(t=>(t+e+JA.length)%JA.length),g(!1)},200)},[]);s.useEffect(()=>{const e=setInterval(()=>b(1),12e3);return()=>clearInterval(e)},[b]);const[v,x]=s.useState(1200);s.useLayoutEffect(()=>{const e=()=>{if(l.current?.parentElement){const e=l.current.parentElement.clientWidth-32;x(Math.max(1e3,e))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const w=(e,a)=>{t({filter:{...p.current.filter,[e]:a}})},k=(e,a)=>{t({filterEnvelope:{...p.current.filterEnvelope,[e]:a}})},S=(e,a)=>{const n=p.current.devilFish||{enabled:!0,normalDecay:.5,accentDecay:.5,vegDecay:.5,vegSustain:0,softAttack:0,filterTracking:0,filterFmDepth:0,sweepSpeed:"normal",accentSweepEnabled:!0,highResonance:!1,muffler:"off"};t({devilFish:{...n,[e]:a}})},M=(e,a)=>{t({oscillator:{...p.current.oscillator,[e]:a}})},N=e=>{const a=p.current.lfo||{waveform:0,rate:0,contour:0,pitchDepth:0,pwmDepth:0,filterDepth:0,stiffDepth:0};t({lfo:{...a,...e}})},C=e=>{const a=p.current.chorus||{enabled:!1,mode:1,mix:.3};t({chorus:{...a,...e}})},P=(e,t,a,n)=>({left:`${e}px`,top:`${t}px`,width:`${a}px`,height:`${n}px`,position:"absolute"}),E=[{id:"osc",label:"OSC",color:"#06b6d4",bgClass:"bg-cyan-500",textClass:"text-cyan-400"},{id:"mojo",label:"MOJO",color:"#ff9900",bgClass:"bg-orange-500",textClass:"text-orange-400"},...n?[]:[{id:"lfo",label:"LFO",color:"#a855f7",bgClass:"bg-purple-500",textClass:"text-purple-400",ledOn:o.lfo?.enabled||!1}],{id:"devilfish",label:"DEVILFISH",color:"#ff3333",bgClass:"bg-red-500",textClass:"text-red-400"},...n?[]:[{id:"fx",label:"FX",color:"#22c55e",bgClass:"bg-green-500",textClass:"text-green-400",ledOn:!(!o.chorus?.mode&&!o.delay?.mix)}]];return Ea.jsx("div",{ref:l,className:"w-full overflow-visible flex justify-center py-4 select-none",style:{minHeight:"512px"},children:Ea.jsxs("div",{className:"relative bg-[#1a1a1a] rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] border-b-8 border-r-4 border-black/40 overflow-hidden",style:{width:`${v}px`,height:"480px",background:"linear-gradient(180deg, #252525 0%, #1a1a1a 100%)"},children:[Ea.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[Ea.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-black/20"}),Ea.jsx("div",{className:"absolute top-[110px] left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]"}),Ea.jsx("div",{style:(_=40,T=115,A=600,{left:`${_}px`,top:`${T}px`,width:`${A}px`,position:"absolute",textAlign:"center",fontSize:"10px",fontWeight:"bold",color:"#888",textTransform:"uppercase",letterSpacing:"0.08em"}),className:"text-accent-primary opacity-80",children:"Classic"}),Ea.jsx("div",{className:"absolute left-4 right-4 h-[2px] bg-black/40 shadow-[0_1px_0_rgba(255,255,255,0.05)]",style:{top:"285px"}})]}),Ea.jsx("div",{style:P(40,145,65,80),children:Ea.jsx(ZA,{value:o.tuning??.5,min:0,max:1,defaultValue:.5,bipolar:!0,onChange:e=>{t({tuning:e})},label:"Tone",size:"md",color:"#ffcc00",formatValue:e=>(e-.5>0?"+":"")+Math.round(100*(e-.5))+"c"})}),Ea.jsxs("div",{style:P(145,140,65,100),children:[Ea.jsx(ZA,{value:o.filter.cutoff,min:0,max:1,defaultValue:.5,onChange:e=>w("cutoff",e),label:"Cutoff",size:"md",color:"#ffcc00",formatValue:e=>Math.round(314*Math.pow(2394/314,e))+" Hz"}),Ea.jsxs("label",{className:"flex items-center gap-1 justify-center mt-1 cursor-pointer",children:[Ea.jsx("input",{type:"checkbox",checked:o.devilFish?.extendedCutoff||!1,onChange:e=>S("extendedCutoff",e.target.checked),className:"w-3 h-3 accent-yellow-500 rounded"}),Ea.jsx("span",{className:"text-[8px] text-gray-400 uppercase",children:"Wide"})]})]}),Ea.jsx("div",{style:P(250,145,65,80),children:Ea.jsx(ZA,{value:o.filter.resonance,min:0,max:1,defaultValue:0,onChange:e=>w("resonance",e),label:"Reso",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsxs("div",{style:P(355,140,65,100),children:[Ea.jsx(ZA,{value:o.filterEnvelope.envMod,min:0,max:1,defaultValue:.5,onChange:e=>k("envMod",e),label:"EnvMod",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"}),Ea.jsxs("label",{className:"flex items-center gap-1 justify-center mt-1 cursor-pointer",children:[Ea.jsx("input",{type:"checkbox",checked:o.devilFish?.extendedEnvMod||!1,onChange:e=>S("extendedEnvMod",e.target.checked),className:"w-3 h-3 accent-yellow-500 rounded"}),Ea.jsx("span",{className:"text-[8px] text-gray-400 uppercase",children:"Wide"})]})]}),Ea.jsx("div",{style:P(460,145,65,80),children:Ea.jsx(ZA,{value:o.filterEnvelope.decay,min:0,max:1,defaultValue:.5,onChange:e=>k("decay",e),label:"Decay",size:"md",color:"#ffcc00",formatValue:e=>Math.round(QA*Math.pow(10,e))+" ms"})}),Ea.jsx("div",{style:P(565,145,65,80),children:Ea.jsx(ZA,{value:o.accent.amount,min:0,max:1,defaultValue:.5,onChange:e=>{return a="amount",n=e,void t({accent:{...p.current.accent,[a]:n}});var a,n},label:"Accent",size:"md",color:"#ffcc00",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:P(670,145,65,80),children:Ea.jsx(ZA,{value:o.volume??.75,min:0,max:1,defaultValue:.75,onChange:e=>t({volume:e}),label:"Level",size:"md",color:"#00ffff",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsxs("div",{style:{position:"absolute",left:20,right:20,top:290,height:30},className:"flex items-center gap-1.5",children:[E.map(e=>Ea.jsxs("button",{onClick:()=>{return t=e.id,void((!n||"lfo"!==t&&"fx"!==t)&&u(t));var t},className:Zt("relative px-3.5 py-1.5 text-[10px] font-bold uppercase tracking-wider rounded-full border transition-all duration-200",d===e.id?`${e.bgClass} text-white border-transparent shadow-lg shadow-${"osc"===e.id?"cyan":"mojo"===e.id?"orange":"devilfish"===e.id?"red":"lfo"===e.id?"purple":"green"}-500/30`:`bg-black/40 ${e.textClass} border-white/10 hover:border-white/25 hover:bg-black/60`),children:[e.label,void 0!==e.ledOn&&Ea.jsx("span",{className:Zt("absolute -top-0.5 -right-0.5 w-2 h-2 rounded-full border border-black/50 transition-all duration-300",e.ledOn?`${e.bgClass} shadow-[0_0_6px_${e.color}]`:"bg-gray-800")})]},e.id)),Ea.jsxs("span",{className:"ml-auto text-[9px] text-gray-600 font-mono tracking-wider",children:[E.findIndex(e=>e.id===d)+1,"/",E.length]})]}),Ea.jsxs("div",{style:{position:"absolute",left:0,right:0,top:324,bottom:30},children:["osc"===d&&Ea.jsxs("div",{className:"flex items-center gap-3 h-full px-6",children:[Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.oscillator.waveformBlend??("square"===o.oscillator.type?1:0),min:0,max:1,defaultValue:0,onChange:e=>M("waveformBlend",e),label:"Waveform",size:"md",color:"#06b6d4",formatValue:e=>e<.05?"SAW":e>.95?"SQR":Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.oscillator.pulseWidth??0,min:0,max:1,defaultValue:0,onChange:e=>M("pulseWidth",e),label:"Pulse W",size:"md",color:"#06b6d4",formatValue:e=>Math.round(50+49*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.oscillator.subOscGain??0,min:0,max:1,defaultValue:0,onChange:e=>M("subOscGain",e),label:"Sub Osc",size:"md",color:"#06b6d4",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.oscillator.subOscBlend??1,min:0,max:1,defaultValue:1,onChange:e=>M("subOscBlend",e),label:"Sub Wave",size:"md",color:"#06b6d4",formatValue:e=>e<.5?"-2 Oct":"-1 Oct"})})]}),"mojo"===d&&Ea.jsxs("div",{className:"flex items-center gap-3 h-full px-6",children:[Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.passbandCompensation??.9,min:0,max:1,defaultValue:.9,onChange:e=>S("passbandCompensation",e),label:"Bass",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.resTracking??.7,min:0,max:1,defaultValue:.7,onChange:e=>S("resTracking",e),label:"Rez",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.filterInputDrive??0,min:0,max:1,defaultValue:0,onChange:e=>S("filterInputDrive",e),label:"Satur",size:"md",color:"#ff9900",formatValue:e=>(10*e).toFixed(1)})}),Ea.jsx("div",{className:"w-px h-14 bg-gray-800 flex-shrink-0"}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.diodeCharacter??0,min:0,max:1,defaultValue:0,onChange:e=>S("diodeCharacter",e),label:"Bite",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.duffingAmount??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>S("duffingAmount",e),label:"Tension",size:"md",color:"#ff9900",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.lpBpMix??0,min:0,max:1,defaultValue:0,onChange:e=>S("lpBpMix",e),label:"LP/BP",size:"md",color:"#ff9900",formatValue:e=>e<.05?"LP":e>.95?"BP":"Mix"})}),Ea.jsx("div",{className:"w-px h-14 bg-gray-800 flex-shrink-0"}),Ea.jsxs("div",{className:"flex flex-col gap-1",children:[Ea.jsx("label",{className:"text-[8px] font-bold text-orange-500/70",children:"FILTER"}),Ea.jsxs("select",{value:o.devilFish?.filterSelect??1,onChange:e=>S("filterSelect",parseInt(e.target.value)),className:"bg-[#111] text-[10px] text-orange-400 border border-orange-900/30 rounded px-1 py-1 outline-none focus:border-orange-500",children:[Ea.jsx("option",{value:0,children:"DiodeLadder"}),Ea.jsx("option",{value:5,children:"MissThang-20"})]})]})]}),"lfo"===d&&!n&&Ea.jsxs("div",{className:"flex items-center gap-3 h-full px-6",children:[Ea.jsxs("div",{className:"flex flex-col items-center gap-1.5 flex-shrink-0",children:[Ea.jsx("span",{className:"text-[9px] font-bold text-purple-400/60 tracking-wider",children:"WAVE"}),Ea.jsx("div",{className:"flex gap-1.5 items-center",children:[0,1,2,3,4,5].map(e=>Ea.jsx("button",{onClick:()=>N({enabled:!0,waveform:e}),className:Zt("w-10 h-8 text-[10px] font-bold rounded-md border-2 transition-all",o.lfo?.waveform===e?"bg-purple-500 text-white border-purple-400 shadow-[0_0_8px_rgba(168,85,247,0.4)]":"bg-black/50 text-purple-400/50 border-purple-900/40 hover:border-purple-500/50 hover:text-purple-400"),children:["TRI","SAW","SAW","SQR","S&H","NSE"][e]},e))})]}),Ea.jsx("div",{className:"w-px h-14 bg-gray-800 flex-shrink-0"}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.lfo?.rate??0,min:0,max:1,defaultValue:0,onChange:e=>N({enabled:!0,rate:e}),label:"Rate",size:"md",color:"#a855f7",formatValue:e=>{const t=.05*Math.pow(400,e);return t>=10?t.toFixed(1)+"Hz":t.toFixed(2)+"Hz"}})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.lfo?.contour??0,min:-1,max:1,defaultValue:0,bipolar:!0,onChange:e=>N({enabled:!0,contour:e}),label:"Contour",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.lfo?.pwmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>N({enabled:!0,pwmDepth:e}),label:"PWM Mod",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.lfo?.pitchDepth??0,min:0,max:1,defaultValue:0,onChange:e=>N({enabled:!0,pitchDepth:e}),label:"Pitch",size:"md",color:"#a855f7",formatValue:e=>"+"+Math.round(12*e)+" semi"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.lfo?.filterDepth??0,min:0,max:1,defaultValue:0,onChange:e=>N({enabled:!0,filterDepth:e}),label:"Filter",size:"md",color:"#a855f7",formatValue:e=>"+"+(2*e).toFixed(1)+" oct"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.lfo?.stiffDepth??0,min:0,max:1,defaultValue:0,onChange:e=>N({enabled:!0,stiffDepth:e}),label:"Tension",size:"md",color:"#a855f7",formatValue:e=>Math.round(100*e)+"%"})})]}),"devilfish"===d&&Ea.jsxs("div",{className:"flex items-center gap-3 h-full px-6",children:[Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.filterFmDepth??0,min:0,max:1,defaultValue:0,onChange:e=>S("filterFmDepth",e),label:"Filt FM",size:"md",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.filterTracking??0,min:0,max:1,defaultValue:0,onChange:e=>S("filterTracking",e),label:"Filt Trk",size:"md",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.slide?.time??.17,min:0,max:1,defaultValue:.17,onChange:e=>{t({slide:{...p.current.slide,time:e}})},label:"Slide",size:"md",color:"#ff3333",formatValue:e=>Math.round(2*Math.pow(180,e))+" ms"})}),Ea.jsx("div",{className:"w-px h-14 bg-gray-800 flex-shrink-0"}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.softAttack??0,min:0,max:1,defaultValue:0,onChange:e=>S("softAttack",e),label:"S.Atk",size:"md",color:"#ff3333",formatValue:e=>(.3*Math.pow(100,e)).toFixed(1)+" ms"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.normalDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>S("normalDecay",e),label:"N.Dec",size:"md",color:"#ff3333",formatValue:e=>Math.round(QA*Math.pow(10,e))+" ms"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.accentDecay??.5,min:0,max:1,defaultValue:.5,onChange:e=>S("accentDecay",e),label:"Acc Dec",size:"md",color:"#ff3333",formatValue:e=>Math.round(QA*Math.pow(10,e))+" ms"})}),Ea.jsx("div",{style:{width:"65px"},children:Ea.jsx(ZA,{value:o.devilFish?.accentSoftAttack??.5,min:0,max:1,defaultValue:.5,onChange:e=>S("accentSoftAttack",e),label:"Acc Soft",size:"md",color:"#ff3333",formatValue:e=>Math.round(100*e)+"%"})})]}),"fx"===d&&!n&&Ea.jsxs("div",{className:"flex items-start gap-5 h-full px-6 py-3",children:[Ea.jsxs("div",{className:"flex flex-col gap-2",children:[Ea.jsx("span",{className:"text-[9px] font-bold text-green-400/60 tracking-wider",children:"DIMENSION"}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-[9px] text-gray-400 flex-shrink-0",children:"Mode"}),Ea.jsx("div",{className:"flex gap-1",children:[0,1,2,3,4].map(e=>{const t=o.chorus?.enabled&&(o.chorus?.mode??0)>0?o.chorus?.mode??0:0;return Ea.jsx("button",{onClick:()=>C({mode:e,enabled:e>0}),className:Zt("px-2.5 py-1 text-[10px] font-bold rounded border transition-all",t===e?"bg-green-500 text-white border-green-400":"bg-black/50 text-green-400/50 border-green-900/40 hover:border-green-500/50"),children:0===e?"Off":e},e)})})]}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-[9px] text-gray-400 flex-shrink-0 w-8",children:"Mix"}),Ea.jsx("input",{type:"range",min:0,max:1,step:.01,value:o.chorus?.mix??.5,onChange:e=>C({mix:parseFloat(e.target.value)}),className:"flex-1 h-1.5 accent-green-500 cursor-pointer",style:{minWidth:"80px"}}),Ea.jsxs("span",{className:"text-[10px] text-gray-300 w-8 text-right tabular-nums",children:[Math.round(100*(o.chorus?.mix??.5)),"%"]})]})]}),Ea.jsx("div",{className:"w-px self-stretch bg-gray-800 flex-shrink-0"}),Ea.jsxs("div",{className:"flex flex-col gap-1.5 flex-1",children:[Ea.jsx("span",{className:"text-[9px] font-bold text-green-400/60 tracking-wider",children:"DELAY"}),[{label:"Time",key:"time",min:0,max:16,step:1,value:o.delay?.time??3,fmt:e=>`${e} 16ths`},{label:"Feedback",key:"feedback",min:0,max:1,step:.01,value:o.delay?.feedback??.3,fmt:e=>`${Math.round(100*e)}%`},{label:"Tone",key:"tone",min:0,max:1,step:.01,value:o.delay?.tone??.5,fmt:e=>e<.4?"LP":e>.6?"HP":"Bypass"},{label:"Mix",key:"mix",min:0,max:1,step:.01,value:o.delay?.mix??0,fmt:e=>`${Math.round(100*e)}%`},{label:"Spread",key:"stereo",min:0,max:1,step:.01,value:o.delay?.stereo??.75,fmt:e=>`${Math.round(100*e)}%`}].map(e=>Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-[9px] text-gray-400 w-14 flex-shrink-0",children:e.label}),Ea.jsx("input",{type:"range",min:e.min,max:e.max,step:e.step,value:e.value,onChange:a=>{const n=parseFloat(a.target.value);((e,a)=>{const n=p.current.delay||{enabled:!1,time:3,feedback:0,tone:.5,mix:0,stereo:.75};t({delay:{...n,enabled:!0,[e]:a}})})(e.key,"convert"in e?e.convert(n):n)},className:"flex-1 h-1.5 accent-green-500 cursor-pointer"}),Ea.jsx("span",{className:"text-[10px] text-gray-300 w-14 text-right tabular-nums",children:e.fmt(e.value)})]},e.key))]})]})]}),Ea.jsxs("div",{className:"absolute top-4 left-6 flex items-center gap-4",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("div",{className:"bg-accent-primary p-1 rounded",children:Ea.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"black",strokeWidth:"3",children:Ea.jsx("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})})}),Ea.jsxs("div",{className:"flex flex-col -space-y-1",children:[Ea.jsx("span",{className:"text-white font-black italic text-xl tracking-tighter",children:"DB-303"}),Ea.jsx("span",{className:"text-[8px] text-gray-500 font-bold uppercase tracking-widest",children:"TB-303 WASM Engine"})]})]}),Ea.jsx("div",{className:"h-8 w-px bg-gray-800"}),Ea.jsxs("div",{className:"flex flex-col",children:[Ea.jsx("label",{className:"text-[8px] font-bold text-gray-500 mb-1",children:"PRESET"}),Ea.jsxs("select",{value:"",onChange:e=>{const n=ub.find(t=>t.name===e.target.value);n&&(a?a(n):n.tb303&&t(n.tb303))},className:"bg-[#111] text-[10px] text-accent-primary border border-gray-800 rounded px-2 py-1 outline-none focus:border-accent-primary transition-colors max-w-[160px]",children:[Ea.jsx("option",{value:"",disabled:!0,children:"Load Preset..."}),ub.map(e=>Ea.jsxs("option",{value:e.name,children:[e.name,e.effects?.length?` [${e.effects.length} FX]`:""]},e.name))]})]})]}),void 0!==r&&Ea.jsx("div",{className:"absolute pointer-events-none",style:{top:"10px",left:"480px",right:"20px",height:"80px"},children:Ea.jsxs("div",{className:"viz-frame w-full h-full",children:[Ea.jsxs("div",{className:"viz-frame__content",children:[Ea.jsx(eO,{config:o,instrumentId:r}),Ea.jsx(tO,{instrumentId:r})]}),Ea.jsx("div",{className:"viz-frame__glass"}),Ea.jsx("div",{className:"viz-frame__vignette"})]})}),i&&Ea.jsx("div",{className:"absolute top-2 right-5 z-10 flex items-center gap-1",children:i}),Ea.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center gap-2 px-4 py-1.5 bg-black/50 border-t border-white/5",children:[Ea.jsx(Qt,{size:12,className:"text-yellow-500/70 flex-shrink-0"}),Ea.jsx("button",{onClick:()=>b(-1),className:"text-gray-600 hover:text-gray-400 text-[10px] flex-shrink-0 px-0.5",children:""}),Ea.jsx("span",{className:Zt("text-[10px] text-gray-400 flex-1 transition-opacity duration-200 min-w-0 truncate",y?"opacity-0":"opacity-100"),title:JA[h],children:JA[h]}),Ea.jsx("button",{onClick:()=>b(1),className:"text-gray-600 hover:text-gray-400 text-[10px] flex-shrink-0 px-0.5",children:""}),Ea.jsxs("span",{className:"text-[7px] text-gray-600 font-mono flex-shrink-0 ml-2",children:["V",Ik]})]})]})});var _,T,A});aO.displayName="JC303StyledKnobPanel";const nO=({children:e,className:t=""})=>{const a=s.useRef(null),[n,r]=s.useState(!1);return s.useEffect(()=>{const e=a.current;if(!e)return;const t=e=>{const t=e.target;(t.closest("[data-prevent-scroll]")||t.closest(".knob-body")||t.closest('[role="slider"]')||t.closest('input[type="range"]'))&&r(!0)},n=()=>{r(!1)};return e.addEventListener("touchstart",t,{passive:!0}),e.addEventListener("touchend",n,{passive:!0}),e.addEventListener("touchcancel",n,{passive:!0}),()=>{e.removeEventListener("touchstart",t),e.removeEventListener("touchend",n),e.removeEventListener("touchcancel",n)}},[]),s.useEffect(()=>{if(n){const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[n]),Ea.jsx("div",{ref:a,className:`scroll-lock-container ${t}`,style:{overflowY:n?"hidden":"auto",touchAction:n?"none":"auto"},children:e})},sO=s.memo(()=>{const{instruments:e,updateInstrument:t}=Bv(Ua(e=>({instruments:e.instruments,updateInstrument:e.updateInstrument}))),{tb303Collapsed:a,toggleTB303Collapsed:n,tb303PoppedOut:r,setTB303PoppedOut:i}=Vv(Ua(e=>({tb303Collapsed:e.tb303Collapsed,toggleTB303Collapsed:e.toggleTB303Collapsed,tb303PoppedOut:e.tb303PoppedOut,setTB303PoppedOut:e.setTB303PoppedOut}))),{controlledInstrumentId:o}=Gw(),l=o?e.find(e=>e.id===o&&"TB303"===e.synthType):e.find(e=>"TB303"===e.synthType),c=s.useCallback(e=>{if(!l)return;const a=Bv.getState().instruments.find(e=>e.id===l.id);a?.tb303&&t(l.id,{tb303:{...a.tb303,...e}})},[l,t]),u=s.useCallback(async e=>{if(l&&(e.tb303&&c(e.tb303),void 0!==e.effects)){const a=e.effects.map((e,t)=>({...e,id:e.id||`tb303-fx-${Date.now()}-${t}`}));t(l.id,{effects:a});const{getToneEngine:n}=await ja(async()=>{const{getToneEngine:e}=await Promise.resolve().then(()=>Jg);return{getToneEngine:e}},void 0),s=n();await s.rebuildInstrumentEffects(l.id,a)}},[l,c,t]);if(!l||!l.tb303)return r?Ea.jsx(B_,{isOpen:!0,onClose:()=>i(!1),title:"DEViLBOX  TB-303",width:1200,height:560,fitContent:!0,children:Ea.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-sm",children:"No TB-303 instrument found"})}):null;if(r)return Ea.jsxs(Ea.Fragment,{children:[Ea.jsx(B_,{isOpen:!0,onClose:()=>i(!1),title:"DEViLBOX  TB-303",width:1200,height:560,fitContent:!0,children:Ea.jsx("div",{style:{background:"#1a1a1a"},children:Ea.jsx(nO,{children:Ea.jsx(aO,{config:l.tb303,onChange:c,onPresetLoad:u,instrumentId:l.id},l.id)})})}),Ea.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",height:"40px",background:"#1a1a1a",borderTop:"1px solid #333"},children:[Ea.jsxs("div",{className:"absolute top-0 left-0 p-2 text-xs font-mono text-accent-primary flex items-center gap-2",children:[Ea.jsx("span",{className:"font-bold",children:"TB-303"}),Ea.jsx("span",{className:"text-gray-500",children:"Popped Out"})]}),Ea.jsx("div",{className:"absolute top-0 right-0 z-50",children:Ea.jsxs("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80 rounded-bl-lg flex items-center gap-1 text-xs",onClick:()=>i(!1),title:"Restore panel inline",children:[Ea.jsx(Gt,{size:14}),"Restore"]})})]})]});if(a)return Ea.jsxs("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",height:"40px",background:"#1a1a1a",borderTop:"1px solid #333"},children:[Ea.jsx("div",{className:"absolute top-0 right-0 z-50",children:Ea.jsx("button",{className:"p-2 text-gray-400 hover:text-white bg-black/50 hover:bg-black/80 rounded-bl-lg",onClick:n,title:"Expand synth panel",children:Ea.jsx(Me,{size:16})})}),Ea.jsxs("div",{className:"absolute top-0 left-0 p-2 text-xs font-mono text-accent-primary flex items-center gap-2",children:[Ea.jsx("span",{className:"font-bold",children:"TB-303"}),Ea.jsxs("span",{className:"text-gray-500",children:["CH",String(e.indexOf(l)+1).padStart(2,"0")]}),Ea.jsx("span",{className:"text-gray-400",children:l.name})]})]});const d=Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("button",{className:"p-1.5 text-gray-500 hover:text-cyan-400 bg-black/40 hover:bg-black/70 rounded transition-colors",onClick:()=>{r?j_("DEViLBOX  TB-303"):i(!0)},title:"Pop out to separate window",children:Ea.jsx(We,{size:14})}),Ea.jsx("button",{className:"p-1.5 text-gray-500 hover:text-white bg-black/40 hover:bg-black/70 rounded transition-colors",onClick:n,title:"Collapse synth panel",children:Ea.jsx(Et,{size:14})}),Ea.jsx("button",{className:"p-1.5 text-gray-500 hover:text-red-400 bg-black/40 hover:bg-black/70 rounded transition-colors",onClick:()=>Vv.getState().setTB303Collapsed(!0),title:"Close synth panel",children:Ea.jsx(Pe,{size:14})})]});return Ea.jsx("div",{className:"tb303-knob-panel",style:{position:"relative",width:"100%",maxHeight:"400px",background:"#1a1a1a",borderTop:"1px solid #333",overflow:"auto"},children:Ea.jsx(nO,{children:Ea.jsx(aO,{config:l.tb303,onChange:c,onPresetLoad:u,instrumentId:l.id,headerActions:d},l.id)})})});sO.displayName="TB303KnobPanel";const rO=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],iO=[1,3,6,8,10],oO=({step:e,stepIndex:t,position:a,onChange:n,onClose:r,onNavigate:i,unitId:o=1})=>{const[l,c]=s.useState(!0),u=s.useRef(null);s.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&r()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[r]),s.useEffect(()=>{const e=e=>{"Escape"===e.key&&r()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]);const d=s.useCallback(t=>{if(n({note:t}),l)try{const a=Qg(),n=Bv.getState().instruments.find(e=>e.id===o);if(n&&a){const s=`${t}${e.octave??2}`;a.triggerNote(o,s,.2,Z(),.8,n,e.accent,e.slide)}}catch(a){}},[n,l,o,e.octave,e.accent,e.slide]),p=s.useCallback(t=>{const a=e.octave===t?2:t;n({octave:a})},[e.octave,n]),m=s.useCallback(t=>{n({[t]:!e[t]})},[e,n]),h={position:"fixed",left:`${a.x}px`,top:`${a.y}px`,transform:"translate(-50%, -100%) translateY(-10px)",zIndex:1e4};return Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("div",{className:"piano-popover-overlay"}),Ea.jsxs("div",{ref:u,className:"piano-popover",style:h,children:[Ea.jsxs("div",{className:"popover-header",children:[Ea.jsxs("div",{className:"step-navigation",children:[Ea.jsx("button",{className:"nav-btn",onClick:()=>i("prev"),"aria-label":"Previous step",children:""}),Ea.jsxs("div",{className:"step-indicator",children:["Step ",(t+1).toString().padStart(2,"0")]}),Ea.jsx("button",{className:"nav-btn",onClick:()=>i("next"),"aria-label":"Next step",children:""})]}),Ea.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:""})]}),Ea.jsxs("div",{className:"popover-controls",children:[Ea.jsxs("div",{className:"control-group",children:[Ea.jsx("div",{className:"control-label",children:"Octave"}),Ea.jsxs("div",{className:"octave-selector",children:[Ea.jsx("button",{className:"octave-select-btn "+(1===e.octave?"active":""),onClick:()=>p(1),children:"DN"}),Ea.jsx("button",{className:"octave-select-btn "+(2===e.octave?"active":""),onClick:()=>p(2),children:"MID"}),Ea.jsx("button",{className:"octave-select-btn "+(3===e.octave?"active":""),onClick:()=>p(3),children:"UP"})]})]}),Ea.jsxs("div",{className:"control-group",children:[Ea.jsx("div",{className:"control-label",children:"Modifiers"}),Ea.jsxs("div",{className:"modifier-toggles",children:[Ea.jsx("button",{className:"modifier-btn accent "+(e.accent?"active":""),onClick:()=>m("accent"),children:Ea.jsx("span",{children:"AC"})}),Ea.jsx("button",{className:"modifier-btn slide "+(e.slide?"active":""),onClick:()=>m("slide"),children:Ea.jsx("span",{children:"SL"})})]})]}),Ea.jsxs("div",{className:"control-group",children:[Ea.jsx("div",{className:"control-label",children:"TT-303"}),Ea.jsxs("div",{className:"modifier-toggles",children:[Ea.jsx("button",{className:"modifier-btn mute "+(e.mute?"active":""),onClick:()=>m("mute"),title:"Mute - silent step, data preserved",children:Ea.jsx("span",{children:"MT"})}),Ea.jsx("button",{className:"modifier-btn hammer "+(e.hammer?"active":""),onClick:()=>m("hammer"),title:"Hammer - legato without pitch glide",children:Ea.jsx("span",{children:"HM"})})]})]}),Ea.jsxs("div",{className:"preview-toggle",children:[Ea.jsx("input",{type:"checkbox",id:`preview-${o}-${t}`,checked:l,onChange:e=>c(e.target.checked)}),Ea.jsx("label",{htmlFor:`preview-${o}-${t}`,children:"Preview Sound"})]})]}),Ea.jsx("div",{className:"piano-keyboard",children:rO.map((t,a)=>{const n=iO.includes(a),s=e.note===t;return Ea.jsx("div",{className:`\n                  piano-key\n                  ${n?"black":"white"}\n                  ${s?"selected":""}\n                `,onClick:()=>d(t),children:Ea.jsx("div",{className:"key-label",children:t})},t)})})]})]})},lO=({steps:e,currentStep:t=-1,isPlaying:a=!1,onStepChange:n,onStepToggle:r,unitId:i=1})=>{const[o,l]=s.useState(null),c=s.useRef(null),u=s.useCallback(e=>{r&&r(e)},[r]),d=s.useCallback((e,t)=>{e.stopPropagation();const a=e.target.getBoundingClientRect();l({visible:!0,stepIndex:t,x:a.left+a.width/2,y:a.top})},[]),p=s.useCallback((t,a,s)=>{if(t.stopPropagation(),!n)return;const r=e[a],i=r.octave===s?2:s;n(a,{...r,octave:i})},[e,n]),m=s.useCallback((t,a,s)=>{if(t.stopPropagation(),!n)return;const r=e[a];n(a,{...r,[s]:!r[s]})},[e,n]),h=s.useCallback((t,a)=>{if(!n)return;const s=e[t];n(t,{...s,...a})},[e,n]),f=s.useCallback(()=>{l(null)},[]),y=s.useCallback(e=>{if(!o)return;const t="prev"===e?(o.stepIndex-1+16)%16:(o.stepIndex+1)%16;l({...o,stepIndex:t})},[o]);return Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("div",{ref:c,className:"tb303-sequencer",children:e.map((e,n)=>Ea.jsxs("div",{className:`\n              tb303-step\n              ${e.active?"active":""}\n              ${a&&n===t?"current":""}\n            `,onClick:()=>u(n),children:[Ea.jsx("div",{className:"step-led"}),Ea.jsx("div",{className:"step-note",onClick:e=>d(e,n),children:e.note}),Ea.jsxs("div",{className:"step-octave-btns",children:[Ea.jsx("div",{className:"octave-btn "+(1===e.octave?"active":""),onClick:e=>p(e,n,1),children:"DN"}),Ea.jsx("div",{className:"octave-btn "+(3===e.octave?"active":""),onClick:e=>p(e,n,3),children:"UP"})]}),Ea.jsxs("div",{className:"step-toggles",children:[Ea.jsx("div",{className:"toggle-btn accent "+(e.accent?"active":""),onClick:e=>m(e,n,"accent"),children:"AC"}),Ea.jsx("div",{className:"toggle-btn slide "+(e.slide?"active":""),onClick:e=>m(e,n,"slide"),children:"SL"})]})]},n))}),o?.visible&&Ea.jsx(oO,{step:e[o.stepIndex],stepIndex:o.stepIndex,position:{x:o.x,y:o.y},onChange:e=>h(o.stepIndex,e),onClose:f,onNavigate:y,unitId:i})]})},cO=e=>{if("number"==typeof e){if(0===e||97===e)return{note:"C",octave:2};const t=Jn(e),a=t.substring(0,2),n=t.substring(2),s=parseInt(n,10);let r=2;s<=2?r=1:s>=4&&(r=3);return{note:a.replace("-",""),octave:r}}if("string"==typeof e){if(!e||"..."===e||"==="===e)return{note:"C",octave:2};const t=e.substring(0,2),a=e.substring(2),n=parseInt(a,10);let s=2;n<=2?s=1:n>=4&&(s=3);return{note:t.replace("-",""),octave:s}}return{note:"C",octave:2}},uO=(e,t)=>{const a=1===t?2:2===t?3:4;return Qn(`${1===e.length?`${e}-`:e}${a}`)},dO=({channelIndex:e=0})=>{const{patterns:t,currentPatternIndex:a,setCell:n}=ob(),{instruments:r,updateInstrument:i}=Bv(),{isPlaying:o,currentRow:l,bpm:c}=Kv(),u=t[a],d=u?.channels[e],p=d?.instrumentId??0,m=r.find(e=>e.id===p),h=o?l%16:-1,[f,y]=s.useState(!1),g=s.useRef(m),b=s.useRef(m?.tb303);s.useEffect(()=>{g.current=m,b.current=m?.tb303},[m]);const v=s.useRef(null),x=s.useCallback(e=>{v.current&&clearTimeout(v.current),v.current=window.setTimeout(()=>{i(p,e),v.current=null},300)},[p,i]),w=m?.tb303,k="square"===w?.oscillator.type?1:0,S=w?.filter.cutoff??1e3,M=w?.filter.resonance??50,N=w?.filterEnvelope.envMod??50,C=w?.filterEnvelope.decay??300,P=w?.accent.amount??50,E=s.useMemo(()=>{if(!u||!u.channels[e])return Array.from({length:16},()=>({active:!1,note:"C",octave:2,accent:!1,slide:!1}));const t=u.channels[e],a=[];for(let e=0;e<16;e++){const n=t.rows[e],s=!(!n||!n.note||0===n.note||97===n.note),{note:r,octave:i}=s?cO(n.note):{note:"C",octave:2};a.push({active:s,note:r,octave:i,accent:!(1!==n?.flag1&&1!==n?.flag2),slide:!(2!==n?.flag1&&2!==n?.flag2)})}return a},[u,e]),_=s.useCallback(e=>{m&&w&&i(p,{tb303:{...w,oscillator:{...w.oscillator,type:e<.5?"sawtooth":"square"}}})},[p,m,w,i]),T=s.useCallback(e=>{const t=b.current;if(!g.current||!t)return;const a={...t,filter:{...t.filter,cutoff:e}};Qg().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),A=s.useCallback(e=>{const t=b.current;if(!g.current||!t)return;const a={...t,filter:{...t.filter,resonance:e}};Qg().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),O=s.useCallback(e=>{const t=b.current;if(!g.current||!t)return;const a={...t,filterEnvelope:{...t.filterEnvelope,envMod:e}};Qg().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),I=s.useCallback(e=>{const t=b.current;if(!g.current||!t)return;const a={...t,filterEnvelope:{...t.filterEnvelope,decay:e}};Qg().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),F=s.useCallback(e=>{const t=b.current;if(!g.current||!t)return;const a={...t,accent:{...t.accent,amount:e}};Qg().updateTB303Parameters(p,a),x({tb303:a})},[p,x]),D=s.useCallback((t,a)=>{n(e,t,{note:a.active?uO(a.note,a.octave):0,flag1:a.accent?1:void 0,flag2:a.slide?2:void 0})},[e,n]),R=s.useCallback(t=>{const a=E[t],s=!a.active;n(e,t,{note:s?uO(a.note,a.octave):0,flag1:a.accent?1:void 0,flag2:a.slide?2:void 0})},[e,n,E]);return m?w||"TB303"===m.synthType||"Buzz3o3"===m.synthType?Ea.jsxs("div",{className:"tb303-view",children:[Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("div",{className:"tb303-transport",children:[o&&Ea.jsxs("div",{className:"transport-step",children:["Step ",(h+1).toString().padStart(2,"0"),"/16 @ ",c," BPM"]}),Ea.jsx("div",{className:"transport-spacer"}),Ea.jsxs("button",{onClick:()=>y(!0),className:"pattern-btn acid",children:[Ea.jsx(ct,{size:16}),Ea.jsx("span",{children:"Acid"})]}),Ea.jsxs("button",{onClick:()=>{const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];for(let a=0;a<16;a++){const s=Math.random()>.3,r=t[Math.floor(Math.random()*t.length)],i=Math.floor(3*Math.random())+1,o=Math.random()>.7,l=Math.random()>.8;n(e,a,{note:s?uO(r,i):0,flag1:o?1:0,flag2:l?2:0})}},className:"pattern-btn randomize",children:[Ea.jsx(_t,{size:16}),Ea.jsx("span",{children:"Random"})]}),Ea.jsxs("button",{onClick:()=>{for(let t=0;t<16;t++)n(e,t,{note:0,flag1:0,flag2:0})},className:"pattern-btn clear",children:[Ea.jsx(Re,{size:16}),Ea.jsx("span",{children:"Clear"})]})]}),Ea.jsxs("div",{className:"tb303-sequencer-section",children:[Ea.jsx("h3",{className:"section-title",children:"Pattern Sequencer"}),Ea.jsx(lO,{steps:E,currentStep:h,isPlaying:o,onStepChange:D,onStepToggle:R,unitId:1})]}),Ea.jsxs("div",{className:"tb303-params-section",children:[Ea.jsx("h3",{className:"section-title",children:"TB-303 Parameters"}),Ea.jsxs("div",{className:"params-grid",children:[Ea.jsxs("div",{className:"param-item",children:[Ea.jsx(ZA,{label:"Waveform",value:k,min:0,max:1,step:.01,onChange:_,bipolar:!1,size:"md"}),Ea.jsx("div",{className:"param-value",children:k<.5?"Saw":"Square"})]}),Ea.jsxs("div",{className:"param-item",children:[Ea.jsx(ZA,{label:"Cutoff",value:S,min:200,max:5e3,logarithmic:!0,onChange:T,bipolar:!1,size:"md"}),Ea.jsxs("div",{className:"param-value",children:[Math.round(S),"Hz"]})]}),Ea.jsxs("div",{className:"param-item",children:[Ea.jsx(ZA,{label:"Resonance",value:M,min:0,max:100,onChange:A,bipolar:!1,size:"md"}),Ea.jsxs("div",{className:"param-value",children:[M,"%"]})]}),Ea.jsxs("div",{className:"param-item",children:[Ea.jsx(ZA,{label:"Env Mod",value:N,min:0,max:100,onChange:O,bipolar:!1,size:"md"}),Ea.jsxs("div",{className:"param-value",children:[N,"%"]})]}),Ea.jsxs("div",{className:"param-item",children:[Ea.jsx(ZA,{label:"Decay",value:C,min:200,max:2e3,logarithmic:!0,onChange:I,bipolar:!1,size:"md"}),Ea.jsxs("div",{className:"param-value",children:[Math.round(C),"ms"]})]}),Ea.jsxs("div",{className:"param-item",children:[Ea.jsx(ZA,{label:"Accent",value:P,min:0,max:100,onChange:F,bipolar:!1,size:"md"}),Ea.jsxs("div",{className:"param-value",children:[P,"%"]})]})]})]})]}),f&&Ea.jsx(MM,{channelIndex:e,onClose:()=>y(!1)})]}):Ea.jsx("div",{className:"tb303-view",children:Ea.jsxs("div",{className:"tb303-error",children:["Channel ",e+1," is using ",m.synthType,", not TB-303"]})}):Ea.jsx("div",{className:"tb303-view",children:Ea.jsxs("div",{className:"tb303-error",children:["No instrument assigned to channel ",e+1]})})},pO=[{id:"pattern",label:"Pattern",icon:Ea.jsx(et,{size:20})},{id:"instruments",label:"Instruments",icon:Ea.jsx(Kt,{size:20})},{id:"controls",label:"Controls",icon:Ea.jsx(Jt,{size:20})}],mO=({activeTab:e,onTabChange:t})=>Ea.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-dark-bgSecondary border-t border-dark-border safe-area-bottom",children:Ea.jsx("div",{className:"flex items-stretch",children:pO.filter(e=>e&&e.icon).map(a=>{const n=e===a.id;return Ea.jsxs("button",{onClick:()=>t(a.id),className:`\n                flex-1 flex flex-col items-center justify-center gap-1\n                py-2 min-h-[56px] transition-colors\n                ${n?"text-accent-primary bg-accent-primary/10":"text-text-muted hover:text-text-secondary active:bg-dark-bgTertiary"}\n              `,"aria-current":n?"page":void 0,children:[Ea.jsx("span",{className:n?"scale-110 transition-transform":"",children:a.icon}),Ea.jsx("span",{className:"text-[10px] font-medium",children:a.label})]},a.id)})})}),hO=({isOpen:e,currentName:t,onConfirm:a,onClose:n})=>{const[r,i]=s.useState(t),o=s.useRef(null);s.useEffect(()=>{e&&(requestAnimationFrame(()=>i(t)),setTimeout(()=>o.current?.select(),0))},[e,t]);return e?uS.createPortal(Ea.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:n,children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px]",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Ea.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Rename Instrument"}),Ea.jsx("button",{onClick:n,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:Ea.jsx(Pe,{size:14})})]}),Ea.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&r!==t&&a(r.trim()),n()},children:[Ea.jsx("input",{ref:o,type:"text",value:r,onChange:e=>i(e.target.value),onKeyDown:e=>{"Escape"===e.key&&n()},className:"w-full px-3 py-2 bg-dark-bg border border-dark-border rounded text-sm text-text-primary\n                     focus:outline-none focus:border-accent-primary",placeholder:"Enter instrument name",autoFocus:!0}),Ea.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[Ea.jsx("button",{type:"button",onClick:n,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                       hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),Ea.jsx("button",{type:"submit",disabled:!r.trim()||r===t,className:"px-3 py-1.5 text-sm bg-accent-primary text-text-inverse rounded\n                       hover:bg-accent-primary/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Rename"})]})]})]})}),document.body):null},fO=({isOpen:e,title:t,message:a,confirmLabel:n="Confirm",danger:r=!1,onConfirm:i,onClose:o})=>{const l=s.useCallback(e=>{"Escape"===e.key?o():"Enter"===e.key&&(i(),o())},[o,i]);return s.useEffect(()=>{if(e)return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[e,l]),e?uS.createPortal(Ea.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",onClick:o,children:Ea.jsxs("div",{className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl p-4 min-w-[300px] max-w-[400px]",onClick:e=>e.stopPropagation(),children:[Ea.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ea.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:t}),Ea.jsx("button",{onClick:o,className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-bgTertiary rounded",children:Ea.jsx(Pe,{size:14})})]}),Ea.jsx("p",{className:"text-sm text-text-secondary mb-4",children:a}),Ea.jsxs("div",{className:"flex justify-end gap-2",children:[Ea.jsx("button",{onClick:o,className:"px-3 py-1.5 text-sm text-text-secondary hover:text-text-primary\n                     hover:bg-dark-bgTertiary rounded transition-colors",children:"Cancel"}),Ea.jsx("button",{onClick:()=>{i(),o()},className:"px-3 py-1.5 text-sm rounded transition-colors "+(r?"bg-accent-error text-white hover:bg-accent-error/80":"bg-accent-primary text-text-inverse hover:bg-accent-primary/80"),children:n})]})]})}),document.body):null},yO=({instrumentId:e,onEdit:t,onSavePreset:a,children:n})=>{const{position:r,open:i,close:o,isOpen:l}=hS(),{instruments:c,setCurrentInstrument:u,cloneInstrument:d,deleteInstrument:p,updateInstrument:m}=Bv(),[h,f]=s.useState(!1),[y,g]=s.useState(!1),b=c.find(t=>t.id===e),v=c.length>1,x=s.useCallback(t=>{m(e,{name:t})},[e,m]),w=s.useCallback(()=>{m(e,{synthType:"Synth",oscillator:{type:"sawtooth",detune:0,octave:0},envelope:{attack:.01,decay:.2,sustain:.5,release:.3},filter:{type:"lowpass",frequency:2e3,Q:1,rolloff:-12},effects:[],volume:-6,pan:0})},[e,m]),k=s.useMemo(()=>b?[{id:"edit",label:"Edit",icon:Ea.jsx(ea,{size:14}),onClick:()=>{u(e),t?.()}},{type:"divider"},{id:"duplicate",label:"Duplicate",icon:Ea.jsx(ut,{size:14}),onClick:()=>d(e)},{id:"delete",label:"Delete",icon:Ea.jsx(Re,{size:14}),danger:!0,disabled:!v,onClick:()=>p(e)},{type:"divider"},{id:"rename",label:"Rename",icon:Ea.jsx(ta,{size:14}),onClick:()=>f(!0)},{type:"divider"},{id:"copy-settings",label:"Copy Settings",icon:Ea.jsx(aa,{size:14}),onClick:()=>{localStorage.setItem("devilbox-instrument-clipboard",JSON.stringify(b))}},{id:"paste-settings",label:"Paste Settings",icon:Ea.jsx(pt,{size:14}),onClick:()=>{const t=localStorage.getItem("devilbox-instrument-clipboard");if(t)try{const a=JSON.parse(t),{id:n,name:s,...r}=a;m(e,r)}catch(a){}}},{type:"divider"},{id:"save-preset",label:"Save as Preset",icon:Ea.jsx(Ze,{size:14}),onClick:()=>{a?.()}},{id:"reset",label:"Reset to Default",icon:Ea.jsx(Nt,{size:14}),danger:!0,onClick:()=>g(!0)}]:[],[b,e,v,u,d,p,m,t,a]);return Ea.jsxs("div",{onContextMenu:i,children:[n,l&&Ea.jsx(pS,{items:k,position:r,onClose:o}),Ea.jsx(hO,{isOpen:h,currentName:b?.name||"",onConfirm:x,onClose:()=>f(!1)}),Ea.jsx(fO,{isOpen:y,title:"Reset Instrument",message:"Reset this instrument to default settings? This cannot be undone.",confirmLabel:"Reset",danger:!0,onConfirm:w,onClose:()=>g(!1)})]})},gO=({onClose:e})=>{const{currentInstrumentId:t,updateInstrument:a,setPreviewInstrument:n}=Bv(),{userPresets:r,deletePreset:i,addToRecent:o,exportPresets:l,importPresets:c,importNKSFFiles:u,exportAllPresetsAsNKSF:d}=Ek(),[p,m]=s.useState("factory"),[h,f]=s.useState("Bass"),[y,g]=s.useState("All"),[b,v]=s.useState(""),[x,w]=s.useState(null),[k,S]=s.useState(null),M=s.useRef(null),N=s.useRef(null),C=Object.keys(yv),P=e=>{m(e),w(null),S(null),v("")},E=s.useMemo(()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);return e?e.config:null}return"factory"===p&&x&&yv[h].find(e=>e.name===x)||null},[p,x,h,k,r]);s.useEffect(()=>{const t=t=>{"Escape"===t.key&&(t.preventDefault(),e())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[e]),s.useEffect(()=>{if(E){const e={...E,id:999,isLive:!0};n(e);try{Qg().invalidateInstrument(999)}catch{}}else n(null);return()=>{n(null);try{Qg().invalidateInstrument(999)}catch{}}},[E,n]),s.useEffect(()=>{const e=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&E){const e=Qg(),a={...E,id:999,isLive:!0};e.triggerPolyNoteAttack(999,t,1,a)}},t=e=>{if("INPUT"===document.activeElement?.tagName)return;const t={z:"C4",s:"C#4",x:"D4",d:"D#4",c:"E4",v:"F4",g:"F#4",b:"G4",h:"G#4",n:"A4",j:"A#4",m:"B4",",":"C5",q:"C5",2:"C#5",w:"D5",3:"D#5",e:"E5",r:"F5",5:"F#5",t:"G5",6:"G#5",y:"A5",7:"A#5",u:"B5",i:"C6"}[e.key.toLowerCase()];if(t&&E){const e=Qg(),a={...E,id:999,isLive:!0};e.triggerPolyNoteRelease(999,t,a)}};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[E]);const _=e=>Ht[e]||Kt,T=s.useMemo(()=>{const e=yv[h]||[];if(!b.trim())return e;const t=b.toLowerCase();return e.filter(e=>e.name?.toLowerCase().includes(t)||e.synthType?.toLowerCase().includes(t))},[h,b]),A=s.useMemo(()=>{let e=r;if("All"!==y&&(e=e.filter(e=>e.category===y)),!b.trim())return e;const t=b.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.synthType.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))},[r,y,b]),O=n=>{null!==t&&(a(t,n),e())},I=(n,s)=>{null!==t&&(o(n),a(t,s),e())},F=e=>({Bass:"text-blue-400",Leads:"text-yellow-400",Pads:"text-purple-400",Drums:"text-red-400","TR-808":"text-red-500","TR-909":"text-orange-400","TR-707":"text-rose-400","TR-505":"text-amber-400",Chip:"text-cyan-400",Furnace:"text-teal-400",FX:"text-green-400",Dub:"text-green-400",DubSiren:"text-red-500",SpaceLaser:"text-green-500",V2:"text-amber-500",Sam:"text-amber-500",Synare:"text-yellow-500",Drumnibus:"text-emerald-400",Keys:"text-amber-600",MAME:"text-pink-400",Module:"text-lime-400",Lead:"text-yellow-400",Pad:"text-purple-400",Drum:"text-red-400",User:"text-gray-400",All:"text-ft2-highlight"}[e]||"text-ft2-highlight"),D="factory"===p?T.length:A.length;return Ea.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",children:[Ea.jsxs("div",{className:"w-full h-full bg-ft2-bg flex flex-col overflow-hidden",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-b-2 border-ft2-border",children:[Ea.jsxs("div",{children:[Ea.jsx("h2",{className:"text-ft2-highlight font-bold text-sm uppercase tracking-widest",children:"LOAD PRESET"}),Ea.jsx("p",{className:"text-ft2-textDim text-[10px]",children:"Browse, Jam and Load sounds"})]}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsxs("div",{className:"flex bg-ft2-bg rounded overflow-hidden border border-ft2-border",children:[Ea.jsx("button",{onClick:()=>P("factory"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("factory"===p?"bg-ft2-cursor text-ft2-bg":"text-ft2-textDim hover:text-ft2-text"),children:"Factory"}),Ea.jsxs("button",{onClick:()=>P("user"),className:"px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter transition-all "+("user"===p?"bg-amber-500 text-black":"text-ft2-textDim hover:text-ft2-text"),children:["User (",r.length,")"]})]}),Ea.jsx("button",{onClick:e,className:"p-2 text-ft2-textDim hover:text-ft2-text hover:bg-ft2-border rounded transition-colors",children:Ea.jsx(Pe,{size:20})})]})]}),Ea.jsx("div",{className:"px-4 py-3 bg-ft2-header border-b border-ft2-border",children:Ea.jsxs("div",{className:"relative",children:[Ea.jsx(Ot,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-ft2-textDim"}),Ea.jsx("input",{type:"text",value:b,onChange:e=>v(e.target.value),placeholder:"factory"===p?"Search factory presets...":"Search user presets by name, synth type, or tag...",className:"w-full pl-10 pr-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text rounded focus:border-ft2-highlight focus:outline-none placeholder:text-ft2-textDim/50",autoFocus:!0})]})}),Ea.jsx("div",{className:"flex flex-wrap gap-1 px-4 py-2 bg-ft2-header border-b border-ft2-border",children:"factory"===p?C.map(e=>{const t=h===e;return Ea.jsx("button",{onClick:()=>(e=>{f(e),w(null),v("")})(e),className:`\n                    px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                    ${t?"bg-ft2-cursor text-ft2-bg shadow-[0_0_15px_rgba(255,255,255,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-ft2-highlight ${F(e)}`}\n                  `,children:e},e)}):Ea.jsxs(Ea.Fragment,{children:[["All","Bass","Lead","Pad","Drum","FX","User"].map(e=>{const t=y===e;return Ea.jsx("button",{onClick:()=>{g(e),S(null)},className:`\n                      px-3 py-1.5 text-[10px] font-black rounded transition-all uppercase tracking-tighter\n                      ${t?"bg-amber-500 text-black shadow-[0_0_15px_rgba(245,158,11,0.2)]":`bg-ft2-bg border border-ft2-border hover:border-amber-500/50 ${F(e)}`}\n                    `,children:e},e)}),Ea.jsxs("div",{className:"ml-auto flex items-center gap-1",children:[Ea.jsxs("button",{onClick:()=>M.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import presets from JSON file",children:[Ea.jsx(Dt,{size:10})," Import"]}),Ea.jsxs("button",{onClick:()=>N.current?.click(),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Import .nksf preset files",children:[Ea.jsx(Dt,{size:10})," NKSF"]}),Ea.jsxs("button",{onClick:()=>{const e=l();if(0===e.length)return void px.warning("No user presets to export");const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="devilbox-presets.json",n.click(),URL.revokeObjectURL(a),px.success(`Exported ${e.length} presets`,2e3)},className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all user presets as JSON",children:[Ea.jsx(Ge,{size:10})," Export"]}),Ea.jsxs("button",{onClick:()=>d("DEViLBOX User"),className:"px-2 py-1.5 text-[10px] font-bold rounded bg-ft2-bg border border-ft2-border hover:border-ft2-highlight text-ft2-textDim hover:text-ft2-text transition-all flex items-center gap-1",title:"Export all presets as .nksf files",children:[Ea.jsx(Ge,{size:10})," NKS"]})]})]})}),Ea.jsx("div",{className:"flex-1 overflow-y-auto p-4 scrollbar-ft2",children:"factory"===p?0===T.length?Ea.jsxs("div",{className:"flex items-center justify-center h-full text-ft2-textDim font-mono text-sm uppercase",children:['No presets found matching "',b,'"']}):Ea.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:T.map((e,t)=>{const a=F_(e.synthType||"Synth"),n=_(a.icon),s=x===e.name;return Ea.jsxs("button",{onClick:()=>(e=>{w(e.name||null),S(null);const t=Qg(),a={...e,id:999,isLive:!0};t.triggerPolyNoteAttack(999,"C4",1,a),setTimeout(()=>{t.triggerPolyNoteRelease(999,"C4",a)},300)})(e),onDoubleClick:()=>O(e),className:`\n                        p-3 rounded border-2 text-left transition-all group\n                        ${s?"bg-ft2-cursor text-ft2-bg border-ft2-cursor shadow-[0_0_20px_rgba(255,255,255,0.1)]":"bg-ft2-header border-ft2-border hover:border-ft2-highlight hover:bg-ft2-bg"}\n                      `,children:[Ea.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Ea.jsx(n,{size:14,className:s?"text-ft2-bg":a.color}),Ea.jsx("span",{className:"font-bold text-sm truncate "+(s?"text-ft2-bg":"text-ft2-text"),children:e.name})]}),Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsx("span",{className:"text-[10px] font-mono uppercase "+(s?"text-ft2-bg/80":"text-ft2-textDim"),children:e.synthType}),e.effects&&e.effects.length>0&&Ea.jsxs("span",{className:"text-[9px] px-1.5 font-bold rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-green-600/20 text-green-400"),children:[e.effects.length," FX"]})]})]},`${h}-${e.name}-${t}`)})}):0===A.length?Ea.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-3 text-ft2-textDim",children:[Ea.jsx("span",{className:"font-mono text-sm uppercase",children:0===r.length?"No user presets yet":`No presets matching "${b}"`}),0===r.length&&Ea.jsx("p",{className:"text-xs text-center max-w-md",children:"Save presets from the instrument editor to build your library. You can also import presets using the buttons above."})]}):Ea.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3",children:A.map(e=>{const t=F_(e.synthType),a=_(t.icon),n=k===e.id;return Ea.jsxs("div",{onClick:()=>((e,t)=>{S(e),w(null);const a=Qg(),n={...t,id:999,isLive:!0};a.triggerPolyNoteAttack(999,"C4",1,n),setTimeout(()=>{a.triggerPolyNoteRelease(999,"C4",n)},300)})(e.id,e.config),onDoubleClick:()=>I(e.id,e.config),className:`\n                        p-3 rounded border-2 text-left transition-all group cursor-pointer relative\n                        ${n?"bg-amber-500 text-black border-amber-500 shadow-[0_0_20px_rgba(245,158,11,0.2)]":"bg-ft2-header border-ft2-border hover:border-amber-500/50 hover:bg-ft2-bg"}\n                      `,children:[Ea.jsx("button",{onClick:t=>((e,t)=>{e.stopPropagation(),i(t),k===t&&S(null),px.success("Preset deleted",2e3)})(t,e.id),className:"absolute top-1 right-1 p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity "+(n?"hover:bg-black/20 text-black/60":"hover:bg-red-500/20 text-red-400/60 hover:text-red-400"),title:"Delete preset",children:Ea.jsx(Re,{size:12})}),Ea.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Ea.jsx(a,{size:14,className:n?"text-black":t.color}),Ea.jsx("span",{className:"font-bold text-sm truncate "+(n?"text-black":"text-ft2-text"),children:e.name})]}),Ea.jsxs("div",{className:"flex items-center justify-between mb-1",children:[Ea.jsx("span",{className:"text-[10px] font-mono uppercase "+(n?"text-black/70":"text-ft2-textDim"),children:e.synthType}),Ea.jsx("span",{className:"text-[9px] px-1.5 font-bold rounded "+(n?"bg-black/10 text-black/70":"bg-amber-500/10 text-amber-400"),children:e.category})]}),e.tags.length>0&&Ea.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.tags.slice(0,3).map(e=>Ea.jsxs("span",{className:"text-[8px] px-1 rounded flex items-center gap-0.5 "+(n?"bg-black/10 text-black/60":"bg-ft2-bg text-ft2-textDim"),children:[Ea.jsx(na,{size:7}),e]},e))})]},e.id)})})},`${p}-${h}-${y}`),Ea.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-ft2-header border-t-2 border-ft2-border",children:[Ea.jsxs("div",{className:"flex items-center gap-4",children:[Ea.jsxs("div",{className:"text-ft2-textDim text-xs font-mono",children:[D," PRESET",1!==D?"S":"","  ","factory"===p?h.toUpperCase():"All"===y?"ALL USER":y.toUpperCase(),(x||k)&&Ea.jsx("span",{className:"ml-2 text-ft2-text",children:" DOUBLE-CLICK TO APPLY"})]}),E&&Ea.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-amber-500/10 border border-amber-500/30 rounded animate-pulse-glow",children:[Ea.jsx(Ae,{size:12,className:"text-amber-400 fill-amber-400"}),Ea.jsx("span",{className:"text-[10px] font-black text-amber-400 uppercase tracking-widest",children:"JAM ACTIVE"})]})]}),Ea.jsxs("div",{className:"flex gap-2",children:[Ea.jsx("button",{onClick:e,className:"px-4 py-2 bg-ft2-bg border border-ft2-border text-ft2-text hover:border-ft2-highlight rounded transition-colors font-bold text-xs uppercase",children:"Cancel"}),Ea.jsxs("button",{onClick:()=>{if("user"===p&&k){const e=r.find(e=>e.id===k);e&&I(e.id,e.config)}else E&&O(E)},disabled:!E,className:"flex items-center gap-2 px-6 py-2 bg-ft2-cursor text-ft2-bg font-black hover:bg-ft2-highlight rounded transition-all disabled:opacity-30 disabled:cursor-not-allowed uppercase text-xs",children:[Ea.jsx(De,{size:16}),"Load Preset"]})]})]})]}),Ea.jsx("input",{ref:M,type:"file",accept:".json",className:"hidden",onChange:e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=()=>{try{const e=JSON.parse(a.result);Array.isArray(e)?(c(e),px.success(`Imported ${e.length} presets`,2e3)):px.error("Invalid preset file format")}catch{px.error("Failed to parse preset file")}},a.readAsText(t),M.current&&(M.current.value="")}}),Ea.jsx("input",{ref:N,type:"file",accept:".nksf",multiple:!0,className:"hidden",onChange:async e=>{const t=e.target.files;if(!t||0===t.length)return;const a=await u(Array.from(t));a.length>0?px.success(`Imported ${a.length} NKSF presets`,2e3):px.error("Failed to import NKSF files"),N.current&&(N.current.value="")}})]})},bO=s.memo(({compact:e=!1,maxHeight:t="300px",showActions:a=!0,onInstrumentChange:n,showPreviewOnClick:r=!1,showSamplePackButton:i=!1,showPresetButton:o=!1,showEditButton:l=!1,onEditInstrument:c,variant:u="default"})=>{const{instruments:d,currentInstrumentId:p,setCurrentInstrument:m,createInstrument:h,deleteInstrument:f,cloneInstrument:y,updateInstrument:g}=Bv(Ua(e=>({instruments:e.instruments,currentInstrumentId:e.currentInstrumentId,setCurrentInstrument:e.setCurrentInstrument,createInstrument:e.createInstrument,deleteInstrument:e.deleteInstrument,cloneInstrument:e.cloneInstrument,updateInstrument:e.updateInstrument}))),{useHexNumbers:b,setShowSamplePackModal:v,setInstrumentEditorPoppedOut:x,instrumentEditorPoppedOut:w}=Vv(Ua(e=>({useHexNumbers:e.useHexNumbers,setShowSamplePackModal:e.setShowSamplePackModal,setInstrumentEditorPoppedOut:e.setInstrumentEditorPoppedOut,instrumentEditorPoppedOut:e.instrumentEditorPoppedOut}))),k=s.useRef(null),S=s.useRef(null),M=s.useRef(null),N=s.useRef(null),[C,P]=s.useState(!1),[E,_]=s.useState(null),[T,A]=s.useState(""),O="ft2"===u;s.useEffect(()=>{S.current&&k.current&&S.current.scrollIntoView({behavior:"smooth",block:"nearest"})},[p]);const I=s.useCallback(async e=>{if(r)try{await ye(),M.current&&window.clearTimeout(M.current);const t=Qg(),a="TB303"===e.synthType||e.name.toLowerCase().includes("bass")?"C3":"C4",n=Z();t.triggerNoteAttack(e.id,a,n,.8,e),M.current=window.setTimeout(()=>{t.triggerNoteRelease(e.id,a,Z(),e)},300)}catch(t){}},[r]),F=(e,t)=>{m(e),n?.(e),r&&I(t)},D=(e,t)=>{e.stopPropagation(),d.length>1&&f(t)},R=(e,t)=>{e.stopPropagation(),y(t)},j=(e,t,a)=>{e.stopPropagation(),_(t),A(a),setTimeout(()=>N.current?.focus(),0)},B=()=>{null!==E&&T.trim()&&g(E,{name:T.trim()}),_(null),A("")},L=e=>{"Enter"===e.key?B():"Escape"===e.key&&(_(null),A(""))},V=(e,t)=>{e.stopPropagation(),m(t),w?j_("DEViLBOX  Instrument Editor"):x(!0)},z=[...d].sort((e,t)=>e.id-t.id),U=O&&(o||i||l);return Ea.jsxs("div",{className:"flex flex-col h-full "+(O?"bg-ft2-bg border-l border-ft2-border":""),children:[U&&Ea.jsx("div",{className:"px-2 py-2 bg-ft2-header border-b border-ft2-border flex-shrink-0",children:Ea.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[Ea.jsxs("button",{onClick:()=>{if(O){h(ev[0])}else h()},className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Add new instrument (303 Classic)",children:[Ea.jsx($e,{size:14}),Ea.jsx("span",{className:"text-[8px] font-bold",children:"ADD"})]}),o&&Ea.jsxs("button",{onClick:()=>P(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Load preset into current instrument",children:[Ea.jsx(Ye,{size:14}),Ea.jsx("span",{className:"text-[8px] font-bold",children:"PRESET"})]}),i&&Ea.jsxs("button",{onClick:()=>v(!0),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-green-600 text-green-400 hover:bg-green-600 hover:text-ft2-bg transition-colors",title:"Browse sample packs",children:[Ea.jsx(sa,{size:14}),Ea.jsx("span",{className:"text-[8px] font-bold",children:"SAMPLE"})]}),l&&Ea.jsxs("button",{onClick:()=>c?.(p),className:"flex flex-col items-center gap-0.5 px-1 py-1.5 bg-ft2-bg border border-ft2-border hover:border-ft2-highlight hover:text-ft2-highlight transition-colors text-ft2-text",title:"Edit current instrument",children:[Ea.jsx(ra,{size:14}),Ea.jsx("span",{className:"text-[8px] font-bold",children:"EDIT"})]})]})}),Ea.jsx("div",{ref:k,className:"flex-1 overflow-y-auto "+(O?"scrollbar-ft2 min-h-0":"scrollbar-modern"),style:O?void 0:{maxHeight:t},children:Ea.jsx("div",{className:"flex flex-col divide-y divide-ft2-border/30",children:z.map(t=>{const n=F_(t.synthType),s=t.id===p,r=Ht[n?.icon||"Music2"]||Kt;return O?Ea.jsxs("div",{ref:s?S:void 0,onClick:()=>F(t.id,t),className:`\n                  instrument-list-item\n                  flex items-center gap-2 px-2 py-1.5 cursor-pointer border-b border-ft2-border\n                  transition-colors group\n                  ${s?"bg-ft2-cursor text-ft2-bg":"hover:bg-ft2-header text-ft2-text"}\n                `,children:[Ea.jsx("span",{className:"font-mono text-xs font-bold w-6 "+(s?"text-ft2-bg":"text-ft2-highlight"),children:b?t.id.toString(16).toUpperCase().padStart(2,"0"):t.id.toString(10).padStart(2,"0")}),Ea.jsx(r,{size:12,className:s?"text-ft2-bg":n?.color||"text-ft2-highlight"}),E===t.id?Ea.jsx("input",{ref:N,type:"text",value:T,onChange:e=>A(e.target.value),onBlur:B,onKeyDown:L,onClick:e=>e.stopPropagation(),className:"text-xs font-mono bg-ft2-bg border border-ft2-cursor px-1 py-0.5 rounded text-ft2-text focus:outline-none w-24",autoFocus:!0}):Ea.jsx("span",{className:"text-xs font-mono whitespace-nowrap cursor-text",onDoubleClick:e=>j(e,t.id,t.name),title:"Double-click to rename",children:t.name}),Ea.jsx("span",{className:"text-[9px] px-1 rounded "+(s?"bg-ft2-bg/20 text-ft2-bg":"bg-ft2-header text-ft2-textDim"),children:n?.shortName||t.synthType}),a&&Ea.jsxs("div",{className:`instrument-action-buttons flex gap-0.5 ${s?"opacity-100":"opacity-0 group-hover:opacity-100"} transition-opacity`,children:[Ea.jsx("button",{onClick:e=>V(e,t.id),className:`p-0.5 rounded ${s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-cyan-400`,title:"Pop out editor",children:Ea.jsx(We,{size:10})}),Ea.jsx("button",{onClick:e=>R(e,t.id),className:"p-0.5 rounded "+(s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"),title:"Duplicate",children:Ea.jsx(ut,{size:10})}),d.length>1&&Ea.jsx("button",{onClick:e=>D(e,t.id),className:`p-0.5 rounded ${s?"hover:bg-ft2-bg/20":"hover:bg-ft2-border"} text-red-400`,title:"Delete",children:Ea.jsx(Re,{size:10})})]})]},t.id):Ea.jsx(yO,{instrumentId:t.id,children:Ea.jsxs("div",{ref:s?S:void 0,onClick:()=>F(t.id,t),className:`\n                  group flex items-center gap-2 px-3 py-2 cursor-pointer transition-all\n                  ${s?"bg-accent-primary/20 border-l-2 border-accent-primary":"hover:bg-dark-bgHover border-l-2 border-transparent"}\n                `,children:[Ea.jsx("span",{className:`\n                    font-mono text-xs w-6 text-center\n                    ${s?"text-accent-primary":"text-text-muted"}\n                  `,children:String(t.id).padStart(2,"0")}),Ea.jsx(r,{size:e?12:14,className:n?.color||"text-accent-primary"}),E===t.id?Ea.jsx("input",{ref:N,type:"text",value:T,onChange:e=>A(e.target.value),onBlur:B,onKeyDown:L,onClick:e=>e.stopPropagation(),className:"text-sm bg-dark-bg border border-accent-primary px-1 py-0.5 rounded text-text-primary focus:outline-none w-28",autoFocus:!0}):Ea.jsx("span",{className:`\n                      text-sm whitespace-nowrap cursor-text\n                      ${s?"text-text-primary":"text-text-secondary"}\n                    `,onDoubleClick:e=>j(e,t.id,t.name),title:"Double-click to rename",children:t.name}),!e&&Ea.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:n?.shortName||t.synthType}),t.sample?.loop&&Ea.jsx("span",{className:"text-text-muted ml-auto",title:"pingpong"===t.sample.loopType?"Ping-pong loop":"Forward loop",children:"pingpong"===t.sample.loopType?Ea.jsx(st,{size:10,className:"text-blue-400"}):Ea.jsx(ia,{size:10,className:"text-green-400"})}),a&&Ea.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity ml-auto",children:[Ea.jsx("button",{onClick:e=>V(e,t.id),className:"p-1 text-text-muted hover:text-cyan-400",title:"Pop out editor",children:Ea.jsx(We,{size:12})}),Ea.jsx("button",{onClick:e=>R(e,t.id),className:"p-1 text-text-muted hover:text-accent-primary",title:"Clone instrument",children:Ea.jsx(ut,{size:12})}),d.length>1&&Ea.jsx("button",{onClick:e=>D(e,t.id),className:"p-1 text-text-muted hover:text-accent-error",title:"Delete instrument",children:Ea.jsx(Re,{size:12})})]})]})},t.id)})})}),Ea.jsx("div",{className:O?"px-3 py-1.5 bg-ft2-header border-t border-ft2-border":"px-3 py-1 border-t border-dark-border bg-dark-bgSecondary",children:Ea.jsxs("span",{className:O?"text-ft2-textDim text-[10px] font-mono":"text-[10px] text-text-muted",children:[d.length," instrument",1!==d.length?"s":""]})}),C&&Ea.jsx(gO,{onClose:()=>P(!1)})]})});bO.displayName="InstrumentList";const vO=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],xO=[1,3,6,8,10],wO=({onNoteInput:e,onHexInput:t,onDelete:a,onCopy:n,onCut:r,onPaste:i,onCollapseChange:o})=>{const{cursor:l,currentOctave:c,setCurrentOctave:u}=ob(),[d,p]=s.useState(!1),[m,h]=s.useState(!1),f=s.useMemo(()=>"note"===l.columnType?"piano":"instrument"===l.columnType||"volume"===l.columnType||"effTyp"===l.columnType||"effParam"===l.columnType?"hex":"piano",[l.columnType]),y=s.useCallback(t=>{const a=12*c+t+1;CS(),e(a)},[c,e]),g=s.useCallback(()=>{PS(),e(97)},[e]),b=s.useCallback(()=>{c>0&&(CS(),u(c-1))},[c,u]),v=s.useCallback(()=>{c<7&&(CS(),u(c+1))},[c,u]),x=s.useCallback(e=>{CS(),t(e)},[t]),w=s.useCallback(()=>{PS(),a()},[a]),k=s.useCallback(()=>{TS();const e=!m;h(e),o?.(e)},[m,o]),S=s.useCallback(()=>{ES(),p(!0)},[]),M=s.useCallback(e=>{_S(),e(),p(!1)},[]);return Ea.jsxs("div",{className:"mobile-pattern-input safe-bottom",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-dark-bgTertiary border-t border-dark-border",children:[Ea.jsx("div",{className:"flex items-center gap-2",children:"piano"===f?Ea.jsxs(Ea.Fragment,{children:[Ea.jsx(oa,{size:16,className:"text-accent-primary"}),Ea.jsx("span",{className:"text-xs font-mono text-text-secondary",children:"NOTE INPUT"})]}):Ea.jsxs(Ea.Fragment,{children:[Ea.jsx(la,{size:16,className:"text-accent-secondary"}),Ea.jsx("span",{className:"text-xs font-mono text-text-secondary",children:l.columnType.toUpperCase()})]})}),Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsx("button",{onClick:S,className:"p-1.5 rounded bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors","aria-label":"Show context menu",children:Ea.jsx(ut,{size:14,className:"text-text-muted"})}),Ea.jsx("button",{onClick:k,className:"p-1.5 rounded bg-dark-bgSecondary hover:bg-dark-bgHover transition-colors","aria-label":m?"Expand input":"Collapse input",children:m?Ea.jsx(Et,{size:14,className:"text-text-muted"}):Ea.jsx(Me,{size:14,className:"text-text-muted"})})]})]}),!m&&Ea.jsx("div",{className:"p-2 bg-dark-bgSecondary",children:"piano"===f?Ea.jsx(kO,{currentOctave:c,onNotePress:y,onNoteOff:g,onOctaveDown:b,onOctaveUp:v,onDelete:w}):Ea.jsx(SO,{onHexPress:x,onDelete:w})}),d&&Ea.jsx(MO,{onCopy:n?()=>M(n):void 0,onCut:r?()=>M(r):void 0,onPaste:i?()=>M(i):void 0,onClose:()=>p(!1)})]})},kO=({currentOctave:e,onNotePress:t,onNoteOff:a,onOctaveDown:n,onOctaveUp:r,onDelete:i})=>{const o=s.useCallback((e,a)=>{t(e)},[t]);return Ea.jsxs("div",{className:"flex flex-col gap-2",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsxs("div",{className:"flex items-center gap-1 bg-dark-bgTertiary rounded-lg p-1",children:[Ea.jsx("button",{onClick:n,disabled:0===e,className:"piano-octave-btn","aria-label":"Octave down",children:Ea.jsx(Ct,{size:18})}),Ea.jsxs("div",{className:"px-3 py-1 min-w-[48px] text-center",children:[Ea.jsx("span",{className:"text-xs text-text-muted font-mono",children:"OCT"}),Ea.jsx("div",{className:"text-lg font-bold text-accent-primary font-mono",children:e})]}),Ea.jsx("button",{onClick:r,disabled:7===e,className:"piano-octave-btn","aria-label":"Octave up",children:Ea.jsx(Fe,{size:18})})]}),Ea.jsxs("button",{onClick:a,className:"flex-1 piano-utility-btn",children:[Ea.jsx("span",{className:"font-mono text-sm",children:"---"}),Ea.jsx("span",{className:"text-[10px] text-text-muted",children:"OFF"})]}),Ea.jsxs("button",{onClick:i,className:"flex-1 piano-utility-btn",children:[Ea.jsx(ca,{size:18}),Ea.jsx("span",{className:"text-[10px] text-text-muted",children:"DEL"})]})]}),Ea.jsx("div",{className:"relative h-[120px] bg-dark-bg rounded-lg overflow-hidden",children:Ea.jsxs("div",{className:"absolute inset-0 flex",children:[vO.map((a,n)=>xO.includes(n)?null:Ea.jsx("button",{onTouchStart:e=>o(n,e),onClick:()=>t(n),className:"piano-key piano-key-white","aria-label":`${a}${e}`,children:Ea.jsxs("span",{className:"piano-key-label",children:[a,Ea.jsx("span",{className:"text-[10px] opacity-60",children:e})]})},n)),vO.map((a,n)=>{if(!xO.includes(n))return null;const s=vO.slice(0,n).filter((e,t)=>!xO.includes(t)).length*(100/7)-3;return Ea.jsx("button",{onTouchStart:e=>o(n,e),onClick:()=>t(n),className:"piano-key piano-key-black",style:{left:`${s}%`},"aria-label":`${a}${e}`,children:Ea.jsxs("span",{className:"piano-key-label",children:[a,Ea.jsx("span",{className:"text-[10px] opacity-60",children:e})]})},n)})]})})]})},SO=({onHexPress:e,onDelete:t})=>{const a=s.useMemo(()=>{const e=[];for(let t=0;t<16;t++)e.push(t.toString(16).toUpperCase());return e},[]);return Ea.jsxs("div",{className:"flex flex-col gap-2",children:[Ea.jsx("div",{className:"grid grid-cols-4 gap-2",children:a.map((t,a)=>Ea.jsx("button",{onClick:()=>e(a),className:"hex-btn","aria-label":`Hex ${t}`,children:t},t))}),Ea.jsxs("button",{onClick:t,className:"hex-btn hex-btn-delete w-full",children:[Ea.jsx(ca,{size:20}),Ea.jsx("span",{className:"text-sm",children:"DELETE"})]})]})},MO=({onCopy:e,onCut:t,onPaste:a,onClose:n})=>Ea.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-end",onClick:n,children:Ea.jsx("div",{className:"w-full bg-dark-bgSecondary rounded-t-2xl p-4 safe-bottom",onClick:e=>e.stopPropagation(),children:Ea.jsxs("div",{className:"flex flex-col gap-2",children:[Ea.jsx("div",{className:"text-xs font-mono text-text-muted text-center mb-2",children:"QUICK ACTIONS"}),e&&Ea.jsxs("button",{onClick:e,className:"context-menu-btn",children:[Ea.jsx(ut,{size:18}),Ea.jsx("span",{children:"Copy"})]}),t&&Ea.jsxs("button",{onClick:t,className:"context-menu-btn",children:[Ea.jsx(dt,{size:18}),Ea.jsx("span",{children:"Cut"})]}),a&&Ea.jsxs("button",{onClick:a,className:"context-menu-btn",children:[Ea.jsx(ut,{size:18,className:"rotate-180"}),Ea.jsx("span",{children:"Paste"})]}),Ea.jsx("button",{onClick:n,className:"context-menu-btn context-menu-btn-cancel",children:"Cancel"})]})})});function NO(e,t){return e>t?"landscape":"portrait"}function CO(){return void 0!==window.screen?.orientation?.angle?window.screen.orientation.angle:void 0!==window.orientation?window.orientation:0}const PO=({onShowPatterns:e,onShowExport:t,onShowHelp:a,onShowMasterFX:n,onShowInstruments:r,showPatterns:i,showMasterFX:o})=>{const[l,c]=s.useState("pattern"),[u,d]=s.useState(0),[p,m]=s.useState(!1),{isPlaying:h,togglePlayPause:f}=Kv(),{patterns:y,currentPatternIndex:g,cursor:b,setCell:v,moveCursor:x,copySelection:w,cutSelection:k,paste:S}=ob(),{instruments:M,currentInstrumentId:N,setCurrentInstrument:C}=Bv(),P=y[g],{isPortrait:E,isLandscape:_}=function(){const[e,t]=s.useState(()=>{if("undefined"==typeof window)return{orientation:"portrait",isPortrait:!0,isLandscape:!1,angle:0};const e=NO(window.innerWidth,window.innerHeight);return{orientation:e,isPortrait:"portrait"===e,isLandscape:"landscape"===e,angle:CO()}});return s.useEffect(()=>{if("undefined"==typeof window)return;const e=()=>{const e=NO(window.innerWidth,window.innerHeight),a=CO();t({orientation:e,isPortrait:"portrait"===e,isLandscape:"landscape"===e,angle:a})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),window.screen?.orientation&&window.screen.orientation.addEventListener("change",e),e(),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e),window.screen?.orientation&&window.screen.orientation.removeEventListener("change",e)}},[]),e}(),T=_?4:1,A=E?u:0,O=s.useCallback(()=>{u>0&&(TS(),d(u-1))},[u]),I=s.useCallback(()=>{const e=P?.channels.length||8;u<e-1&&(TS(),d(u+1))},[u,P]),F=s.useCallback(e=>{v(b.channelIndex,b.rowIndex,{note:e,instrument:1})},[b,v]),D=s.useCallback(e=>{const{channelIndex:t,rowIndex:a,columnType:n}=b;switch(n){case"instrument":v(t,a,{instrument:e});break;case"volume":v(t,a,{volume:e});break;case"effTyp":v(t,a,{effTyp:e});break;case"effParam":v(t,a,{eff:e})}x("right")},[b,v,x]),R=s.useCallback(()=>{const{channelIndex:e,rowIndex:t}=b;v(e,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0})},[b,v]),j=IS({onSwipeLeft:I,onSwipeRight:O,enabled:E}),B=s.useCallback(()=>{_S(),w()},[w]),L=s.useCallback(()=>{_S(),k()},[k]),V=s.useCallback(()=>{_S(),S()},[S]),z=s.useCallback(()=>{x("left")},[x]),U=s.useCallback(()=>{x("right")},[x]);return Ea.jsxs("div",{className:"flex flex-col flex-1 min-h-0 bg-dark-bg",children:[Ea.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between px-3 py-2 bg-dark-bgSecondary border-b border-dark-border safe-top",children:[Ea.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[Ea.jsx("span",{className:"text-xs text-text-muted font-mono",children:"PAT"}),Ea.jsx("span",{className:"text-sm font-bold text-accent-primary font-mono",children:(g+1).toString().padStart(2,"0")}),Ea.jsx("span",{className:"text-xs text-text-secondary truncate max-w-[60px]",children:P?.name||"Untitled"}),E&&Ea.jsxs("div",{className:"flex items-center gap-1 ml-1 pl-1 border-l border-dark-border touch-none",...j,children:[Ea.jsx("button",{onClick:O,disabled:0===u,className:"p-1 rounded bg-dark-bgTertiary disabled:opacity-30 touch-target-sm","aria-label":"Previous channel",children:Ea.jsx(Ct,{size:14})}),Ea.jsxs("span",{className:"text-xs font-mono text-accent-primary min-w-[28px] text-center",children:["CH ",(u+1).toString().padStart(2,"0")]}),Ea.jsx("button",{onClick:I,disabled:u>=(P?.channels.length||8)-1,className:"p-1 rounded bg-dark-bgTertiary disabled:opacity-30 touch-target-sm","aria-label":"Next channel",children:Ea.jsx(Fe,{size:14})})]}),Ea.jsx("div",{className:"ml-1 pl-1 border-l border-dark-border flex-1 min-w-0",children:Ea.jsx("select",{value:N??1,onChange:e=>C(parseInt(e.target.value,10)),className:"w-full text-xs bg-dark-bgTertiary border border-dark-border rounded px-2 py-1 text-text-primary font-mono truncate",style:{maxWidth:"140px"},children:M.map(e=>Ea.jsx("option",{value:e.id,children:e.name.substring(0,20)},e.id))})})]}),Ea.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:Ea.jsx("button",{onClick:f,className:`\n              p-2 rounded-lg transition-colors touch-target\n              ${h?"bg-accent-primary text-text-inverse":"bg-dark-bgTertiary text-text-primary hover:bg-dark-bgHover"}\n            `,children:h?Ea.jsx(Rt,{size:18}):Ea.jsx(jt,{size:18})})})]}),Ea.jsxs("div",{className:"flex-1 min-h-0 overflow-hidden",style:{paddingBottom:"pattern"===l?`calc(${p?"56px":"180px"} + env(safe-area-inset-bottom, 0))`:"calc(56px + env(safe-area-inset-bottom, 0))"},children:["pattern"===l&&Ea.jsx("div",{className:"h-full flex flex-col",children:Ea.jsx("div",{className:"flex-1 overflow-auto",children:Ea.jsx(eM,{visibleChannels:T,startChannel:A,onSwipeLeft:z,onSwipeRight:U})})}),"instruments"===l&&Ea.jsx("div",{className:"h-full overflow-y-auto",children:Ea.jsx(bO,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})}),"controls"===l&&Ea.jsxs("div",{className:"h-full overflow-y-auto",children:[Ea.jsx("div",{className:"p-4 border-b border-dark-border",children:Ea.jsx(sO,{})}),Ea.jsx("div",{className:"p-2",children:Ea.jsx(XA,{onShowPatterns:e,onShowExport:t,onShowHelp:a,onShowMasterFX:n,onShowInstruments:r,showPatterns:i,showMasterFX:o})})]})]}),"pattern"===l&&Ea.jsx(wO,{onNoteInput:F,onHexInput:D,onDelete:R,onCopy:B,onCut:L,onPaste:V,onCollapseChange:m}),Ea.jsx(mO,{activeTab:l,onTabChange:c})]})},EO=72,_O=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],TO=e.memo(({verticalZoom:e,scrollY:t,visibleNotes:a,containerHeight:n,activeNotes:r=new Set,scaleNotes:i,dragTargetMidi:o=null,onNotePreview:l,onNoteRelease:c})=>{const u=s.useRef(null),d=s.useRef(null),p=s.useRef(!0),m=s.useRef(""),h=s.useRef(!1),f=s.useRef(null);s.useEffect(()=>{const s=`${e}_${t}_${a}_${n}_${[...r].join(",")}_${i?[...i].join(","):"chr"}_${o}_${f.current}`;s!==m.current&&(m.current=s,p.current=!0)});const y=s.useCallback(()=>{const a=u.current;if(!a)return void(d.current=requestAnimationFrame(y));if(!p.current)return void(d.current=requestAnimationFrame(y));p.current=!1;const s=a.getContext("2d");if(!s)return void(d.current=requestAnimationFrame(y));const l=window.devicePixelRatio||1,c=Math.ceil(EO*l),m=Math.ceil(n*l);a.width===c&&a.height===m||(a.width=c,a.height=m,a.style.width="72px",a.style.height=`${n}px`),s.setTransform(l,0,0,l,0,0),s.fillStyle="#111",s.fillRect(0,0,EO,n);const h=t+60,g=Math.min(127,Math.ceil(h)+2),b=Math.max(0,Math.floor(h)-Math.ceil(n/e)-2);for(let u=g;u>=b;u--){const a=(t+60-u)*e;if(a+e<0||a>n)continue;const l=e,c=Yw(u),d=u%12==0,p=r.has(u),m=o===u,h=u%12,y=void 0!==i&&!i.has(h),g=f.current===u;s.fillStyle=p||m?"#06b6d4":c?y?"#1a1a1c":"#22242a":y?"#333338":"#e8e8ec",s.fillRect(0,a,EO,l),s.fillStyle=c?"#333":"#888",s.fillRect(0,a+l-.5,EO,.5),!y||p||m||(s.globalAlpha=.4,s.fillStyle="#000",s.fillRect(0,a,EO,l),s.globalAlpha=1),!g||p||m||(s.fillStyle="rgba(59,130,246,0.15)",s.fillRect(0,a,EO,l));if(d||e>=14&&!c){const e=d?Xw(u):_O[h];s.fillStyle=p||m?"#fff":c?"#888":"#333",s.font=`${d?"bold ":""}${Math.min(10,l-2)}px Inter, system-ui, sans-serif`,s.textAlign="left",s.textBaseline="middle",s.fillText(e,6,a+l/2)}(p||m)&&(s.fillStyle="rgba(255,255,255,0.15)",s.fillRect(2,a+1,68,l-2))}s.fillStyle="rgba(255,255,255,0.12)",s.fillRect(71,0,1,n),d.current=requestAnimationFrame(y)},[e,t,a,n,r,i,o]);s.useEffect(()=>(p.current=!0,d.current=requestAnimationFrame(y),()=>{null!==d.current&&cancelAnimationFrame(d.current)}),[y]);const g=s.useCallback(a=>{const n=u.current?.getBoundingClientRect();if(!n)return 60;const s=a.clientY-n.top,r=t+60-Math.floor(s/e);return Math.max(0,Math.min(127,r))},[t,e]),b=s.useCallback(e=>{h.current=!0;const t=g(e);l?.(t)},[g,l]),v=s.useCallback(()=>{h.current=!1,c?.()},[c]),x=s.useCallback(e=>{const t=g(e);f.current!==t&&(f.current=t,p.current=!0),h.current&&l?.(t)},[g,l]),w=s.useCallback(()=>{null!==f.current&&(f.current=null,p.current=!0),h.current&&(h.current=!1,c?.())},[c]);return Ea.jsx("canvas",{ref:u,className:"shrink-0",style:{width:EO,height:n},onMouseDown:b,onMouseUp:v,onMouseMove:x,onMouseLeave:w,role:"group","aria-label":"Piano keyboard"})});class AO{scrollX=0;scrollY=0;horizontalZoom=16;verticalZoom=12;width=800;height=400;update(e){void 0!==e.scrollX&&(this.scrollX=e.scrollX),void 0!==e.scrollY&&(this.scrollY=e.scrollY),void 0!==e.horizontalZoom&&(this.horizontalZoom=e.horizontalZoom),void 0!==e.verticalZoom&&(this.verticalZoom=e.verticalZoom),void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height)}rowToPixelX(e){return(e-this.scrollX)*this.horizontalZoom}pixelXToRow(e){return e/this.horizontalZoom+this.scrollX}noteToPixelY(e){return(this.scrollY+60-e)*this.verticalZoom}pixelYToNote(e){return this.scrollY+60-e/this.verticalZoom}snapRow(e,t){const a=this.gridStep(t);return Math.round(e/a)*a}gridStep(e){return 4/e}getVisibleRange(){const e=Math.floor(this.scrollX),t=Math.ceil(this.scrollX+this.width/this.horizontalZoom)+1,a=Math.ceil(this.scrollY+60),n=Math.floor(this.scrollY+60-this.height/this.verticalZoom)-1;return{startRow:Math.max(0,e),endRow:t,startNote:Math.max(0,n),endNote:Math.min(127,a)}}get visibleRows(){return this.width/this.horizontalZoom}get visibleNotes(){return this.height/this.verticalZoom}}const OO={background:"#0a0a0b",laneDark:"rgba(255,255,255,0.06)",laneLight:"rgba(255,255,255,0.02)",laneOutOfScale:"rgba(0,0,0,0.45)",gridLine:"rgba(255,255,255,0.06)",beatLine:"rgba(255,255,255,0.15)",measureLine:"rgba(255,255,255,0.28)",cNoteLine:"rgba(255,255,255,0.18)",patternEnd:"rgba(239,68,68,0.5)",beyondPattern:"rgba(100,100,100,0.1)"};class IO{canvas=null;ctx=null;lastKey="";colors={...OO};cacheKey(e,t,a,n,s){const r=n?Array.from(n).sort().join(","):"chr";return`${e.scrollX.toFixed(2)}_${e.scrollY.toFixed(2)}_${e.horizontalZoom}_${e.verticalZoom}_${e.width}_${e.height}_${t}_${a}_${r}_${s}`}render(e,t,a,n,s){const r=this.cacheKey(e,t,a,n,s);if(r===this.lastKey&&this.canvas)return this.canvas;const i=Math.ceil(e.width*s),o=Math.ceil(e.height*s);if(i<=0||o<=0)return null;this.canvas&&this.canvas.width===i&&this.canvas.height===o||(this.canvas=new OffscreenCanvas(i,o),this.ctx=this.canvas.getContext("2d"));const l=this.ctx;if(!l)return null;l.setTransform(s,0,0,s,0,0),l.fillStyle=this.colors.background,l.fillRect(0,0,e.width,e.height);const c=e.getVisibleRange();for(let p=c.endNote;p>=c.startNote;p--){const t=e.noteToPixelY(p),a=e.verticalZoom;if(t+a<0||t>e.height)continue;const s=p%12,r=Yw(p);void 0!==n&&!n.has(s)?(l.fillStyle=this.colors.laneOutOfScale,l.fillRect(0,t,e.width,a)):r?(l.fillStyle=this.colors.laneDark,l.fillRect(0,t,e.width,a)):(l.fillStyle=this.colors.laneLight,l.fillRect(0,t,e.width,a)),0===s&&(l.fillStyle=this.colors.cNoteLine,l.fillRect(0,t,e.width,1))}const u=e.gridStep(t);for(let p=Math.floor(c.startRow/u)*u;p<=c.endRow;p+=u){const t=e.rowToPixelX(p);if(t<-1||t>e.width+1)continue;const n=p%16==0,s=p%4==0;p>a?(l.fillStyle=this.colors.beyondPattern,l.fillRect(t,0,1,e.height)):n?(l.fillStyle=this.colors.measureLine,l.fillRect(t,0,1,e.height)):s?(l.fillStyle=this.colors.beatLine,l.fillRect(t,0,1,e.height)):(l.fillStyle=this.colors.gridLine,l.fillRect(t,0,1,e.height))}const d=e.rowToPixelX(a);return d>=0&&d<=e.width&&(l.fillStyle=this.colors.patternEnd,l.fillRect(d,0,2,e.height)),this.lastKey=r,this.canvas}invalidate(){this.lastKey=""}}const FO=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6"],DO={selectionRing:"#ffffff",ghostBorder:"rgba(255,255,255,0.5)",slideIndicator:"rgba(250,204,21,0.7)",accentIndicator:"rgba(255,100,0,0.85)",hammerIndicator:"rgba(168,85,247,0.7)",muteIndicator:"rgba(107,114,128,0.7)",playhead:"#ef4444",playheadGlow:"rgba(239,68,68,0.12)",selectionBox:"#60a5fa",selectionBoxFill:"rgba(59,130,246,0.12)"};class RO{colors={...DO};render(e,t,a,n,s,r){const i=t.getVisibleRange();for(const o of r)this.drawGhostNote(e,t,o);for(const o of a){if(o.endRow<i.startRow||o.startRow>i.endRow)continue;if(o.midiNote<i.startNote||o.midiNote>i.endNote)continue;const a=n.has(o.id);this.drawNote(e,t,o,a,s)}}drawNote(e,t,a,n,s){const r=t.rowToPixelX(a.startRow),i=(a.endRow-a.startRow)*t.horizontalZoom,o=t.noteToPixelY(a.midiNote)+1,l=t.verticalZoom-2-1,c=Math.max(4,i-1),u=FO[a.channelIndex%FO.length],d=a.velocity/127,p=.33+.67*d*d;if(e.globalAlpha=p,e.fillStyle=n?this.brighten(u):u,this.roundRect(e,r,o,c,l,5),e.fill(),n?(e.globalAlpha=1,e.strokeStyle=this.colors.selectionRing,e.lineWidth=2.5,this.roundRect(e,r,o,c,l,5),e.stroke()):(e.globalAlpha=.2,e.strokeStyle="#000",e.lineWidth=1,this.roundRect(e,r,o,c,l,5),e.stroke()),e.globalAlpha=1,s&&c>16){const t=l*(1-a.velocity/127);t>0&&(e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(r,o,c,t))}if(this.drawIndicators(e,r,o,c,l,a),c>24&&t.verticalZoom>=10){e.fillStyle="rgba(255,255,255,0.9)",e.font=`${Math.min(9,t.verticalZoom-3)}px Inter, system-ui, sans-serif`,e.textBaseline="middle";const n=this.getNoteName(a.midiNote);e.fillText(n,r+3,o+l/2)}c>14&&(e.fillStyle="rgba(255,245,157,0.85)",e.fillRect(r+c-2,o+3,1,l-6))}drawIndicators(e,t,a,n,s,r){if(r.slide&&(e.fillStyle=this.colors.slideIndicator,e.fillRect(t+n-4,a,3,s)),r.accent&&(e.fillStyle=this.colors.accentIndicator,e.beginPath(),e.moveTo(t,a),e.lineTo(t+7,a),e.lineTo(t,a+7),e.closePath(),e.fill()),r.hammer){const n=t+(r.accent?12:5),i=a+s/2,o=Math.min(4,s/3);e.fillStyle=this.colors.hammerIndicator,e.beginPath(),e.moveTo(n,i-o),e.lineTo(n+o,i),e.lineTo(n,i+o),e.lineTo(n-o,i),e.closePath(),e.fill()}if(r.mute){e.globalAlpha=.4,e.fillStyle=this.colors.muteIndicator,e.fillRect(t,a,n,s),e.strokeStyle="rgba(0,0,0,0.5)",e.lineWidth=1,e.beginPath();for(let r=t-s;r<t+n;r+=6)e.moveTo(r,a+s),e.lineTo(r+s,a);e.stroke(),e.globalAlpha=1}}drawGhostNote(e,t,a){const n=t.rowToPixelX(a.startRow),s=(a.endRow-a.startRow)*t.horizontalZoom,r=t.noteToPixelY(a.midiNote)+1,i=t.verticalZoom-2-1,o=Math.max(4,s-1),l=FO[a.channelIndex%FO.length];e.globalAlpha=.35,e.fillStyle=l,this.roundRect(e,n,r,o,i,5),e.fill(),e.globalAlpha=.5,e.setLineDash([4,3]),e.strokeStyle=this.colors.ghostBorder,e.lineWidth=1,this.roundRect(e,n,r,o,i,5),e.stroke(),e.setLineDash([]),e.globalAlpha=1}drawPlayhead(e,t,a){const n=t.rowToPixelX(a);n<-3||n>t.width+3||(e.fillStyle=this.colors.playheadGlow,e.fillRect(n-2,0,7,t.height),e.fillStyle=this.colors.playhead,e.fillRect(n,0,3,t.height))}drawSelectionBox(e,t,a,n,s){const r=Math.min(t,n),i=Math.min(a,s),o=Math.abs(n-t),l=Math.abs(s-a);e.fillStyle=this.colors.selectionBoxFill,e.fillRect(r,i,o,l),e.strokeStyle=this.colors.selectionBox,e.lineWidth=1,e.strokeRect(r+.5,i+.5,o,l)}brighten(e){return`rgb(${Math.min(255,parseInt(e.slice(1,3),16)+40)},${Math.min(255,parseInt(e.slice(3,5),16)+40)},${Math.min(255,parseInt(e.slice(5,7),16)+40)})`}roundRect(e,t,a,n,s,r){r=Math.min(r,n/2,s/2),e.beginPath(),e.moveTo(t+r,a),e.lineTo(t+n-r,a),e.quadraticCurveTo(t+n,a,t+n,a+r),e.lineTo(t+n,a+s-r),e.quadraticCurveTo(t+n,a+s,t+n-r,a+s),e.lineTo(t+r,a+s),e.quadraticCurveTo(t,a+s,t,a+s-r),e.lineTo(t,a+r),e.quadraticCurveTo(t,a,t+r,a),e.closePath()}getNoteName(e){const t=Math.floor(e/12)-1;return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}${t}`}}class jO{rects=[];rebuild(e,t){this.rects=e.map(e=>({note:e,x:t.rowToPixelX(e.startRow),y:t.noteToPixelY(e.midiNote),w:(e.endRow-e.startRow)*t.horizontalZoom,h:t.verticalZoom-1}))}hitTest(e,t){let a=null;for(const n of this.rects){if(e<n.x||e>n.x+n.w)continue;if(t<n.y||t>n.y+n.h)continue;const s=e-n.x;let r="body";s<=8&&n.w>16?r="resize-start":s>=n.w-8&&(r="resize-end"),a={note:n.note,zone:r}}return a}findInRect(e,t,a,n){const s=Math.min(e,a),r=Math.max(e,a),i=Math.min(t,n),o=Math.max(t,n),l=[];for(const c of this.rects)c.x+c.w<s||c.x>r||c.y+c.h<i||c.y>o||l.push(c.note);return l}getCursor(e,t,a){if("draw"===a)return"crosshair";if("erase"===a)return"not-allowed";const n=this.hitTest(e,t);if(!n)return"default";switch(n.zone){case"resize-start":case"resize-end":return"ew-resize";case"body":return"move";default:return"default"}}}const BO=e.memo(({notes:e,patternLength:t,horizontalZoom:a,verticalZoom:n,scrollX:r,scrollY:i,gridDivision:o,showVelocity:l,selectedNotes:c,playheadRow:u,containerHeight:d,scaleNotes:p,tool:m,onNoteSelect:h,onNoteDragStart:f,onGridClick:y,onGridRightClick:g,onScroll:b,onSelectionBoxStart:v,onNoteErase:x,onGridDraw:w})=>{const k=s.useRef(null),S=s.useRef(null),M=s.useRef(null),N=s.useRef(null),C=s.useRef(800),P=s.useRef(new AO),E=s.useRef(new IO),_=s.useRef(new RO),T=s.useRef(new jO),A=s.useRef(null),O=s.useRef({notes:[],selectedNotes:new Set,showVelocity:!0,ghostNotes:[],playheadRow:null,gridDivision:4,patternLength:64,scaleNotes:void 0,containerHeight:400,drag:{isDragging:!1,mode:"none",startX:0,startY:0,currentX:0,currentY:0,noteId:null,originalNotes:[]}}),I=s.useRef(!0),F=s.useRef(!0),D=s.useRef(""),R=s.useRef(null),j=Qw(e=>e.ghostNotes),B=Qw(e=>e.drag);s.useEffect(()=>{O.current.notes=e,O.current.selectedNotes=c,O.current.showVelocity=l,O.current.ghostNotes=j,O.current.playheadRow=u,O.current.gridDivision=o,O.current.patternLength=t,O.current.scaleNotes=p,O.current.containerHeight=d,O.current.drag=B}),s.useEffect(()=>{P.current.update({scrollX:r,scrollY:i,horizontalZoom:a,verticalZoom:n,width:C.current,height:d}),I.current=!0},[r,i,a,n,d]),s.useEffect(()=>{T.current.rebuild(e,P.current),I.current=!0},[e,r,i,a,n]),s.useEffect(()=>{const s=`${r}_${i}_${a}_${n}_${o}_${t}_${e.length}_${c.size}_${l}_${j.length}_${B.isDragging}_${B.currentX}_${B.currentY}`;s!==D.current&&(D.current=s,I.current=!0,F.current=!0),u!==R.current&&(R.current=u,F.current=!0)}),s.useEffect(()=>{const t=M.current;if(!t)return;const a=new ResizeObserver(t=>{const a=t[0];if(!a)return;const n=a.contentRect.width;C.current=n,P.current.update({width:n}),T.current.rebuild(e,P.current),I.current=!0});return a.observe(t),()=>a.disconnect()},[e]),s.useEffect(()=>{I.current=!0;const e=()=>{const t=k.current,a=S.current;if(!t||!a)return void(N.current=requestAnimationFrame(e));const n=t.getContext("2d"),s=a.getContext("2d");if(!n||!s)return void(N.current=requestAnimationFrame(e));const r=P.current,i=window.devicePixelRatio||1,o=O.current,l=C.current,c=o.containerHeight,u=Math.ceil(l*i),d=Math.ceil(c*i);if(t.width===u&&t.height===d||(t.width=u,t.height=d,t.style.width=`${l}px`,t.style.height=`${c}px`,I.current=!0),a.width===u&&a.height===d||(a.width=u,a.height=d,a.style.width=`${l}px`,a.style.height=`${c}px`,F.current=!0),I.current){I.current=!1,n.setTransform(i,0,0,i,0,0);const e=E.current.render(r,o.gridDivision,o.patternLength,o.scaleNotes,i);if(e&&n.drawImage(e,0,0,l,c),_.current.render(n,r,o.notes,o.selectedNotes,o.showVelocity,o.ghostNotes),o.drag.isDragging&&"select-box"===o.drag.mode){const e=M.current?.getBoundingClientRect();if(e){const t=o.drag.startX-e.left,a=o.drag.startY-e.top,s=o.drag.currentX-e.left,r=o.drag.currentY-e.top;_.current.drawSelectionBox(n,t,a,s,r)}}}F.current&&(F.current=!1,s.setTransform(i,0,0,i,0,0),s.clearRect(0,0,l,c),null!==o.playheadRow&&_.current.drawPlayhead(s,r,o.playheadRow)),N.current=requestAnimationFrame(e)};return N.current=requestAnimationFrame(e),()=>{null!==N.current&&cancelAnimationFrame(N.current)}},[]);const L=s.useCallback(e=>{const t=M.current?.getBoundingClientRect();if(!t)return{x:0,y:0,row:0,midiNote:60};const a=e.clientX-t.left,n=e.clientY-t.top,s=P.current,r=Math.floor(s.pixelXToRow(a)),i=Math.floor(s.pixelYToNote(n));return{x:a,y:n,row:Math.max(0,r),midiNote:Math.max(0,Math.min(127,i))}},[]),V=s.useCallback(e=>{if(2===e.button)return;if(0!==e.button)return;const{x:t,y:a,row:n,midiNote:s}=L(e),r=T.current.hitTest(t,a);if("erase"!==m)if("draw"!==m)if(r){h(r.note.id,e.shiftKey||e.ctrlKey||e.metaKey);const t="resize-end"===r.zone?"resize-end":"resize-start"===r.zone?"resize-start":"move";f(r.note.id,t,e)}else v(n,s,e);else r?h(r.note.id,e.shiftKey||e.ctrlKey||e.metaKey):(y(n,s),A.current=`${n}_${s}`);else r&&x(r.note.id)},[m,L,h,f,y,v,x]),z=s.useRef(null),U=s.useCallback(e=>{const{x:t,y:a}=L(e),n=k.current;n&&(n.style.cursor=T.current.getCursor(t,a,m));const s=z.current;if(s&&0===e.buttons){const e=T.current.hitTest(t,a);if(e){const n=e.note,r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],i=Math.floor(n.midiNote/12)-1,o=`${r[n.midiNote%12]}${i}`,l=n.endRow-n.startRow;s.textContent=`${o}  vel:${n.velocity}  len:${l}`,s.style.display="block",s.style.left=`${t+12}px`,s.style.top=a-24+"px"}else s&&(s.style.display="none")}else s&&(s.style.display="none");if("erase"===m&&1===e.buttons){const e=T.current.hitTest(t,a);e&&x(e.note.id)}if("draw"===m&&1===e.buttons&&w){const{row:n,midiNote:s}=L(e),r=`${n}_${s}`;if(r!==A.current){T.current.hitTest(t,a)||(w(n,s),A.current=r)}}},[m,L,x,w]),G=s.useCallback(()=>{A.current=null},[]),W=s.useCallback(()=>{const e=z.current;e&&(e.style.display="none"),A.current=null},[]),H=s.useCallback(e=>{e.preventDefault();const{row:t,midiNote:a}=L(e);g(t,a,e.clientX,e.clientY)},[L,g]),K=s.useRef(b);return s.useEffect(()=>{K.current=b},[b]),s.useEffect(()=>{const e=M.current;if(!e)return;const t=e=>{e.preventDefault();const t=P.current,a=e.shiftKey?e.deltaY:e.deltaX,n=e.shiftKey?0:e.deltaY,s=a/t.horizontalZoom,r=-n/t.verticalZoom;K.current(s,r)};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]),Ea.jsxs("div",{ref:M,className:"flex-1 w-full h-full relative overflow-hidden",style:{height:d},children:[Ea.jsx("canvas",{ref:k,onMouseDown:V,onMouseMove:U,onMouseUp:G,onMouseLeave:W,onContextMenu:H,role:"grid","aria-label":"Piano roll note grid",style:{display:"block",width:"100%",height:"100%"}}),Ea.jsx("canvas",{ref:S,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),Ea.jsx("div",{ref:z,style:{display:"none",position:"absolute",pointerEvents:"none",background:"rgba(0,0,0,0.85)",color:"#e8e8ec",padding:"2px 6px",borderRadius:4,fontSize:10,fontFamily:"Inter, system-ui, sans-serif",whiteSpace:"nowrap",zIndex:10}})]})}),LO=80,VO=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6"],zO=e.memo(({notes:e,horizontalZoom:t,scrollX:a,selectedNotes:n,onBeginDrag:r,onDragVelocity:i,onDragMultiVelocity:o,onEndDrag:l,onAdjustVelocity:c})=>{const u=s.useRef(null),d=s.useRef(null),p=s.useRef(null),m=s.useRef(!0),h=s.useRef(""),[f,y]=s.useState(null),[g,b]=s.useState(800),v=s.useRef(null);s.useEffect(()=>{const e=d.current;if(!e)return;const t=new ResizeObserver(e=>{const t=e[0]?.contentRect.width;t&&(b(t),m.current=!0)});return t.observe(e),()=>t.disconnect()},[]),s.useEffect(()=>{const s=`${t}_${a}_${e.length}_${n.size}_${v.current}_${g}`;s!==h.current&&(h.current=s,m.current=!0)});const x=s.useRef(e),w=s.useRef(n),k=s.useRef(t),S=s.useRef(a),M=s.useRef(g);s.useEffect(()=>{x.current=e},[e]),s.useEffect(()=>{w.current=n},[n]),s.useEffect(()=>{k.current=t},[t]),s.useEffect(()=>{S.current=a},[a]),s.useEffect(()=>{M.current=g},[g]),s.useEffect(()=>{m.current=!0;const e=()=>{const t=u.current;if(!t)return void(p.current=requestAnimationFrame(e));if(!m.current)return void(p.current=requestAnimationFrame(e));m.current=!1;const a=t.getContext("2d");if(!a)return void(p.current=requestAnimationFrame(e));const n=M.current,s=window.devicePixelRatio||1,r=Math.ceil(n*s),i=Math.ceil(LO*s);t.width===r&&t.height===i||(t.width=r,t.height=i,t.style.width=`${n}px`,t.style.height="80px"),a.setTransform(s,0,0,s,0,0),a.fillStyle="#0d0d0e",a.fillRect(0,0,n,LO),a.strokeStyle="rgba(255,255,255,0.06)",a.lineWidth=.5;for(const e of[32,64,96,127]){const t=LO-e/127*LO;a.beginPath(),a.moveTo(0,t),a.lineTo(n,t),a.stroke(),a.fillStyle="rgba(255,255,255,0.15)",a.font="8px monospace",a.textAlign="left",a.textBaseline="bottom",a.fillText(String(e),2,t)}const o=k.current,l=S.current,c=w.current;for(const e of x.current){const t=(e.startRow-l)*o,s=(e.endRow-e.startRow)*o;if(t+s<0||t>n)continue;const r=e.velocity/127*LO,i=Math.max(3,s-1),u=c.has(e.id),d=v.current===e.id,p=VO[e.channelIndex%VO.length];a.globalAlpha=u?1:d?.9:.7,a.fillStyle=p;const m=LO-r,h=Math.min(3,i/2,r/2);a.beginPath(),a.moveTo(t+h,m),a.lineTo(t+i-h,m),a.quadraticCurveTo(t+i,m,t+i,m+h),a.lineTo(t+i,LO),a.lineTo(t,LO),a.lineTo(t,m+h),a.quadraticCurveTo(t,m,t+h,m),a.closePath(),a.fill(),u&&(a.strokeStyle="#ffffff",a.lineWidth=1,a.stroke()),a.globalAlpha=1}a.fillStyle="rgba(255,255,255,0.2)",a.font="9px monospace",a.textAlign="left",a.textBaseline="top",a.fillText("VEL",4,4),p.current=requestAnimationFrame(e)};return p.current=requestAnimationFrame(e),()=>{null!==p.current&&cancelAnimationFrame(p.current)}},[]);const N=s.useCallback(e=>{const t=Math.round(127*(1-e/LO));return Math.max(1,Math.min(127,t))},[]),C=s.useCallback(n=>{const s=d.current?.getBoundingClientRect();if(!s)return null;const r=n-s.left,i=r/t+a;let o=null,l=1/0;for(const c of e)if(i>=c.startRow&&i<c.endRow){const e=Math.abs(r-(c.startRow-a)*t);e<l&&(l=e,o=c)}return o},[e,t,a]),P=s.useCallback(e=>{e.preventDefault();const t=d.current?.getBoundingClientRect();if(!t)return;const a=C(e.clientX);if(!a)return;y(a.id),r();const s=e.clientY-t.top,l=N(s);n.has(a.id)&&n.size>1?o(Array.from(n),l):i(a.id,l),m.current=!0},[C,n,r,i,o,N]),E=s.useCallback(e=>{const t=C(e.clientX),a=t?.id??null;if(a!==v.current&&(v.current=a,m.current=!0),!f)return;const s=d.current?.getBoundingClientRect();if(!s)return;const r=e.clientY-s.top,l=N(r);n.has(f)&&n.size>1?o(Array.from(n),l):i(f,l),m.current=!0},[f,C,n,i,o,N]),_=s.useCallback(()=>{f&&l(),y(null)},[f,l]),T=s.useRef(c);return s.useEffect(()=>{T.current=c},[c]),s.useEffect(()=>{const n=d.current;if(!n)return;const s=s=>{if(!T.current)return;s.preventDefault();const r=s.deltaY<0?5:-5,i=n.getBoundingClientRect(),o=(s.clientX-i.left)/t+a;let l=null;for(const t of e)if(o>=t.startRow&&o<t.endRow){l=t;break}if(!l)return;const c=w.current,u=c.has(l.id)?Array.from(c):[l.id];T.current(u,r),m.current=!0};return n.addEventListener("wheel",s,{passive:!1}),()=>n.removeEventListener("wheel",s)},[e,t,a]),Ea.jsx("div",{ref:d,className:"relative shrink-0 border-t border-dark-border overflow-hidden",style:{height:LO},children:Ea.jsx("canvas",{ref:u,style:{display:"block",width:"100%",height:LO},onMouseDown:P,onMouseMove:E,onMouseUp:_,onMouseLeave:_})})}),UO=({icon:e,label:t,shortcut:a,onClick:n,disabled:s,hideContextMenu:r})=>Ea.jsxs("button",{className:"flex items-center gap-2 w-full px-3 py-1.5 text-xs text-left rounded transition-colors\n      "+(s?"text-text-muted/50 cursor-not-allowed":"text-text-primary hover:bg-dark-bgTertiary"),onClick:()=>{s||(n(),r())},disabled:s,children:[e,Ea.jsx("span",{className:"flex-1",children:t}),a&&Ea.jsx("span",{className:"text-text-muted text-[10px]",children:a})]}),GO=()=>Ea.jsx("div",{className:"h-px bg-dark-border mx-2 my-1"}),WO=({onCopy:e,onCut:t,onPaste:a,onDelete:n,onSelectAll:r,onQuantize:i,onToggleSlide:o,onToggleAccent:l,onSetVelocity:c,hasSelection:u,hasClipboard:d,selectionVelocity:p})=>{const{contextMenu:m,hideContextMenu:h}=Qw(),f=s.useRef(null);if(s.useEffect(()=>{if(!m.visible)return;const e=e=>{f.current&&!f.current.contains(e.target)&&h()},t=e=>{"Escape"===e.key&&h()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[m.visible,h]),!m.visible)return null;const y=Math.min(m.x,window.innerWidth-200),g=Math.min(m.y,window.innerHeight-260),b={position:"fixed",left:Math.max(0,y),top:Math.max(0,g),zIndex:100};return Ea.jsxs("div",{ref:f,className:"bg-dark-bgSecondary border border-dark-border rounded-lg shadow-xl py-1 min-w-[180px]",style:b,children:[Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(ut,{size:12}),label:"Copy",shortcut:"Ctrl+C",onClick:e,disabled:!u}),Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(dt,{size:12}),label:"Cut",shortcut:"Ctrl+X",onClick:t,disabled:!u}),Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(pt,{size:12}),label:"Paste",shortcut:"Ctrl+V",onClick:a,disabled:!d}),Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(Re,{size:12}),label:"Delete",shortcut:"Del",onClick:n,disabled:!u}),Ea.jsx(GO,{}),Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(ua,{size:12}),label:"Select All",shortcut:"Ctrl+A",onClick:r}),Ea.jsx(GO,{}),Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(et,{size:12}),label:"Quantize",shortcut:"Q",onClick:i,disabled:!u}),Ea.jsx(GO,{}),u&&c&&Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5",children:[Ea.jsx(da,{size:12,className:"text-text-muted shrink-0"}),Ea.jsx("span",{className:"text-xs text-text-muted shrink-0",children:"Vel"}),Ea.jsx("input",{type:"range",min:1,max:127,value:p??100,onChange:e=>c(parseInt(e.target.value,10)),className:"flex-1 h-1 accent-accent-primary",style:{cursor:"pointer"}}),Ea.jsx("span",{className:"text-xs text-text-primary w-6 text-right tabular-nums",children:p??100})]}),Ea.jsx(GO,{})]}),Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(pa,{size:12}),label:"Toggle Slide",shortcut:"S",onClick:o,disabled:!u}),Ea.jsx(UO,{hideContextMenu:h,icon:Ea.jsx(Ae,{size:12}),label:"Toggle Accent",shortcut:"A",onClick:l,disabled:!u})]})};function HO(e,t){return`${e}-${t}`}function KO(e,t,a){for(let n=t+1;n<a;n++){const a=e[n];if(97===a.note)return n-t;if(a.note&&0!==a.note&&97!==a.note)return n-t}return a-t}function qO(e){return JSON.parse(JSON.stringify(e))}function $O(e,t,a,n){(0,Qv.getState().pushAction)("EDIT_CELL",n,a,e,JSON.parse(JSON.stringify(t)))}function XO(e){const{patterns:t,currentPatternIndex:a,setCell:n}=ob(),r=t[a],i=s.useMemo(()=>r?function(e,t){const a=[];return(void 0!==t?[e.channels[t]].filter(Boolean):e.channels).forEach((n,s)=>{const r=void 0!==t?t:s;for(let t=0;t<n.rows.length;t++){const s=n.rows[t];if(!s.note||0===s.note||97===s.note)continue;const i=ss(s.note);if(null===i)continue;const o=KO(n.rows,t,e.length),l=s.volume>=16&&s.volume<=80?Math.round((s.volume-16)/64*127):100;a.push({id:HO(r,t),channelIndex:r,startRow:t,endRow:t+o,midiNote:i,velocity:l,instrument:s.instrument,slide:2===s.flag1||2===s.flag2,accent:1===s.flag1||1===s.flag2,hammer:4===s.flag1||4===s.flag2,mute:3===s.flag1||3===s.flag2})}}),a}(r,e):[],[r,e]),o=s.useCallback((t,s,i,o=100,l)=>{const c=l??e??0;if(!r)return;const u=qO(r),d=rs(t),p=Math.round(o/127*64);n(c,s,{note:d,volume:16+p}),s+i<(r?.length||64)&&n(c,s+i,{note:97});const m=ob.getState().patterns[a];m&&$O(u,m,a,"Add note")},[e,r,a,n]),l=s.useCallback(e=>{const[t,s]=e.split("-"),o=parseInt(t,10),l=parseInt(s,10),c=i.find(t=>t.id===e);if(!c||!r)return;const u=qO(r);if(n(o,l,{note:0,volume:0}),c.endRow<(r?.length||64)){const e=r?.channels[o]?.rows[c.endRow];97===e?.note&&n(o,c.endRow,{note:0})}const d=ob.getState().patterns[a];d&&$O(u,d,a,"Delete note")},[i,r,a,n]),c=s.useCallback(e=>{if(!r||0===e.length)return;const t=qO(r);e.forEach(e=>{const[t,s]=e.split("-"),o=parseInt(t,10),l=parseInt(s,10),c=i.find(t=>t.id===e);if(c&&(n(o,l,{note:0,volume:0}),c.endRow<(r?.length||64))){const e=ob.getState().patterns[a],t=e?.channels[o]?.rows[c.endRow];97===t?.note&&n(o,c.endRow,{note:0})}});const s=ob.getState().patterns[a];s&&$O(t,s,a,`Delete ${e.length} notes`)},[i,r,a,n]),u=s.useCallback((e,t,s)=>{const o=i.find(t=>t.id===e);if(!o||!r)return;const l=qO(r),c=Math.max(0,o.startRow+t),u=Math.max(0,Math.min(127,o.midiNote+s)),d=o.endRow-o.startRow,[p,m]=e.split("-"),h=parseInt(p,10),f=parseInt(m,10);if(n(h,f,{note:0,volume:0}),o.endRow<(r?.length||64)){const e=r?.channels[h]?.rows[o.endRow];97===e?.note&&n(h,o.endRow,{note:0})}const y=rs(u),g=16+Math.round(o.velocity/127*64);n(o.channelIndex,c,{note:y,volume:g}),c+d<(r?.length||64)&&n(o.channelIndex,c+d,{note:97});const b=ob.getState().patterns[a];b&&$O(l,b,a,"Move note")},[i,r,a,n]),d=s.useCallback((e,t)=>{const s=i.find(t=>t.id===e);if(!s||!r)return;const o=qO(r),l=Math.max(1,t-s.startRow),[c,u]=e.split("-"),d=parseInt(c,10),p=parseInt(u,10);if(n(d,p,{note:0,volume:0}),s.endRow<(r?.length||64)){const e=r?.channels[d]?.rows[s.endRow];97===e?.note&&n(d,s.endRow,{note:0})}const m=rs(s.midiNote),h=16+Math.round(s.velocity/127*64);n(s.channelIndex,s.startRow,{note:m,volume:h}),s.startRow+l<(r?.length||64)&&n(s.channelIndex,s.startRow+l,{note:97});const f=ob.getState().patterns[a];f&&$O(o,f,a,"Resize note")},[i,r,a,n]),p=s.useCallback((e,t)=>{const s=i.find(t=>t.id===e);if(!s||!r)return;const o=Math.max(0,Math.min(t,s.endRow-1));if(o===s.startRow)return;const l=qO(r),[c]=e.split("-"),u=parseInt(c,10);if(n(u,s.startRow,{note:0,volume:0}),s.endRow<(r?.length||64)){const e=r?.channels[u]?.rows[s.endRow];97===e?.note&&n(u,s.endRow,{note:0})}const d=rs(s.midiNote),p=16+Math.round(s.velocity/127*64);n(s.channelIndex,o,{note:d,volume:p}),s.endRow<(r?.length||64)&&n(s.channelIndex,s.endRow,{note:97});const m=ob.getState().patterns[a];m&&$O(l,m,a,"Resize note start")},[i,r,a,n]),m=s.useCallback((e,t)=>{const[s,i]=e.split("-"),o=parseInt(s,10),l=parseInt(i,10);if(!r)return;const c=qO(r),u=Math.round(t/127*64);n(o,l,{volume:16+u});const d=ob.getState().patterns[a];d&&$O(c,d,a,"Set velocity")},[r,a,n]),h=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=qO(r),i=16+Math.round(t/127*64);e.forEach(e=>{const[t,a]=e.split("-"),s=parseInt(t,10),r=parseInt(a,10);n(s,r,{volume:i})});const o=ob.getState().patterns[a];o&&$O(s,o,a,`Set velocity (${e.length} notes)`)},[r,a,n]),f=s.useRef(null),y=s.useCallback(()=>{r&&(f.current=qO(r))},[r]),g=s.useCallback((e,t)=>{const[a,s]=e.split("-"),r=parseInt(a,10),i=parseInt(s,10),o=Math.round(t/127*64);n(r,i,{volume:16+o})},[n]),b=s.useCallback((e,t)=>{const a=16+Math.round(t/127*64);e.forEach(e=>{const[t,s]=e.split("-"),r=parseInt(t,10),i=parseInt(s,10);n(r,i,{volume:a})})},[n]),v=s.useCallback(()=>{if(!f.current)return;const e=ob.getState().patterns[a];e&&$O(f.current,e,a,"Adjust velocity"),f.current=null},[a]),x=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=qO(r);e.forEach(e=>{const[a,s]=e.split("-"),r=parseInt(a,10),i=parseInt(s,10);n(r,i,{flag2:t?2:0})});const i=ob.getState().patterns[a];i&&$O(s,i,a,"Toggle slide")},[r,a,n]),w=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=qO(r);e.forEach(e=>{const[a,s]=e.split("-"),r=parseInt(a,10),i=parseInt(s,10);n(r,i,{flag1:t?1:0})});const i=ob.getState().patterns[a];i&&$O(s,i,a,"Toggle accent")},[r,a,n]),k=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=qO(r),o=Math.max(1,Math.floor(4/t));e.forEach(e=>{const t=i.find(t=>t.id===e);if(!t)return;const s=Math.round(t.startRow/o)*o;if(s===t.startRow)return;const l=t.endRow-t.startRow,[c,u]=e.split("-"),d=parseInt(c,10),p=parseInt(u,10);if(n(d,p,{note:0,volume:0}),t.endRow<(r?.length||64)){const e=ob.getState().patterns[a],s=e?.channels[d]?.rows[t.endRow];97===s?.note&&n(d,t.endRow,{note:0})}const m=rs(t.midiNote),h=16+Math.round(t.velocity/127*64);n(t.channelIndex,s,{note:m,volume:h}),s+l<(r?.length||64)&&n(t.channelIndex,s+l,{note:97})});const l=ob.getState().patterns[a];l&&$O(s,l,a,"Quantize notes")},[i,r,a,n]),S=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=qO(r);e.forEach(e=>{const s=i.find(t=>t.id===e);if(!s)return;const o=Math.max(0,Math.min(127,s.midiNote+t));if(o===s.midiNote)return;const[l]=e.split("-"),c=parseInt(l,10),u=s.endRow-s.startRow;if(n(c,s.startRow,{note:0,volume:0}),s.endRow<(r?.length||64)){const e=ob.getState().patterns[a],t=e?.channels[c]?.rows[s.endRow];97===t?.note&&n(c,s.endRow,{note:0})}const d=rs(o),p=16+Math.round(s.velocity/127*64);n(s.channelIndex,s.startRow,{note:d,volume:p}),s.startRow+u<(r?.length||64)&&n(s.channelIndex,s.startRow+u,{note:97})});const o=ob.getState().patterns[a];o&&$O(s,o,a,`Transpose ${t>0?"+":""}${t}`)},[i,r,a,n]),M=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=qO(r);e.forEach(e=>{const s=i.find(t=>t.id===e);if(!s)return;const o=Math.max(1,s.endRow-s.startRow+t),l=s.startRow+o,[c]=e.split("-"),u=parseInt(c,10);if(n(u,s.startRow,{note:0,volume:0}),s.endRow<(r?.length||64)){const e=ob.getState().patterns[a],t=e?.channels[u]?.rows[s.endRow];97===t?.note&&n(u,s.endRow,{note:0})}const d=rs(s.midiNote),p=16+Math.round(s.velocity/127*64);n(s.channelIndex,s.startRow,{note:d,volume:p}),l<(r?.length||64)&&n(s.channelIndex,l,{note:97})});const o=ob.getState().patterns[a];o&&$O(s,o,a,`Adjust length ${t>0?"+":""}${t}`)},[i,r,a,n]),N=s.useCallback(e=>{if(!r||0===e.length)return;const t=qO(r),s=e.map(e=>i.find(t=>t.id===e)).filter(Boolean);if(0===s.length)return;const o=Math.min(...s.map(e=>e.startRow)),l=Math.max(...s.map(e=>e.endRow))-o;s.forEach(e=>{const t=e.startRow+l;if(t>=(r?.length||64))return;const a=e.endRow-e.startRow,s=rs(e.midiNote),i=16+Math.round(e.velocity/127*64);n(e.channelIndex,t,{note:s,volume:i}),t+a<(r?.length||64)&&n(e.channelIndex,t+a,{note:97})});const c=ob.getState().patterns[a];c&&$O(t,c,a,`Duplicate ${e.length} notes`)},[i,r,a,n]),C=s.useCallback((e,t)=>{if(!r||0===e.length)return;const s=qO(r);e.forEach(e=>{const a=i.find(t=>t.id===e);if(!a)return;const s=Math.max(1,Math.min(127,a.velocity+t)),r=16+Math.round(s/127*64),[o,l]=e.split("-"),c=parseInt(o,10),u=parseInt(l,10);n(c,u,{volume:r})});const o=ob.getState().patterns[a];o&&$O(s,o,a,`Adjust velocity ${t>0?"+":""}${t}`)},[i,r,a,n]),P=s.useCallback((t,s,i,o)=>{if(!r||0===t.notes.length)return;const l=qO(r),c=s-t.minRow,u=i-t.minNote,d=o??e??0;t.notes.forEach(e=>{const t=e.startRow+c,a=Math.max(0,Math.min(127,e.midiNote+u)),s=e.endRow-e.startRow;if(t<0||t>=(r?.length||64))return;const i=rs(a),o=Math.round(e.velocity/127*64);n(d,t,{note:i,volume:16+o}),t+s<(r?.length||64)&&n(d,t+s,{note:97})});const p=ob.getState().patterns[a];p&&$O(l,p,a,"Paste notes")},[e,r,a,n]);return{notes:i,pattern:r,addNote:o,deleteNote:l,deleteNotes:c,moveNote:u,resizeNote:d,resizeNoteStart:p,setNoteVelocity:m,setMultipleVelocities:h,beginVelocityDrag:y,setVelocityNoUndo:g,setMultipleVelocitiesNoUndo:b,endVelocityDrag:v,toggleSlide:x,toggleAccent:w,quantizeNotes:k,transposeNotes:S,adjustNoteLengths:M,duplicateNotes:N,adjustVelocities:C,pasteNotes:P}}const YO={z:0,s:1,x:2,d:3,c:4,v:5,g:6,b:7,h:8,n:9,j:10,m:11,q:12,2:13,w:14,3:15,e:16,r:17,5:18,t:19,6:20,y:21,7:22,u:23,i:24,9:25,o:26,0:27,p:28},ZO=({channelIndex:e})=>{const{view:t,selection:a,tool:n,drag:r,clipboard:i,setHorizontalZoom:o,setVerticalZoom:l,setScroll:c,setSnapToGrid:u,setGridDivision:d,setShowVelocity:p,setShowVelocityLane:m,setChannelIndex:h,setMultiChannel:f,setScaleKey:y,setScaleRoot:g,setNoteLengthPreset:b,selectNote:v,selectNotes:x,selectAll:w,clearSelection:k,setTool:S,startDrag:M,updateDrag:N,endDrag:C,copyNotes:P,showContextMenu:E,hideContextMenu:_,setGhostNotes:T}=Qw(),{notes:A,pattern:O,addNote:I,deleteNote:F,deleteNotes:D,moveNote:R,resizeNote:j,resizeNoteStart:B,beginVelocityDrag:L,setVelocityNoUndo:V,setMultipleVelocitiesNoUndo:z,endVelocityDrag:U,setMultipleVelocities:G,toggleSlide:W,toggleAccent:H,quantizeNotes:K,transposeNotes:q,adjustNoteLengths:$,duplicateNotes:X,adjustVelocities:Y,pasteNotes:Q}=XO(t.multiChannel?void 0:e??t.channelIndex),J=Kv(e=>e.isPlaying),ee=Kv(e=>e.currentRow),{instruments:te,currentInstrumentId:ae}=Bv(),ne=s.useRef(null),[se,re]=s.useState(400),[ie,oe]=s.useState(!1),le=s.useRef(null);s.useEffect(()=>{void 0!==e&&h(e)},[e,h]);const ce=s.useRef(null);s.useEffect(()=>{if(0===A.length)return;const e=ob.getState().currentPatternIndex;if(ce.current===e)return;ce.current=e;const a=A.map(e=>e.midiNote),n=(Math.min(...a)+Math.max(...a))/2-60+(se-(t.showVelocityLane?80:0))/(2*t.verticalZoom);c(0,Math.max(0,Math.min(127,n)))},[A,se,t.showVelocityLane,t.verticalZoom,c]);const ue=s.useRef(null),de=s.useRef(null);s.useEffect(()=>{if(J&&null!==ee){if(de.current!==O)Qw.setState({view:{...Qw.getState().view,scrollX:0}}),de.current=O,ue.current=ee;else if(null===ue.current||ee>=ue.current){const e=72;if((ee-t.scrollX)*t.horizontalZoom>e+t.horizontalZoom){const a=ee-e/t.horizontalZoom;Qw.setState({view:{...Qw.getState().view,scrollX:Math.max(0,a)}})}ue.current=ee}}else ue.current=null,de.current=null},[J,ee,O,t.scrollX,t.horizontalZoom]),s.useEffect(()=>{const e=()=>{if(ne.current){const e=ne.current.clientHeight-44;re(Math.max(200,e))}};e();const t=new ResizeObserver(e);return ne.current&&t.observe(ne.current),()=>t.disconnect()},[]);const pe=s.useMemo(()=>Math.ceil(se/t.verticalZoom)+2,[se,t.verticalZoom]),me=s.useMemo(()=>Math.floor(pe/12),[pe]),he=s.useMemo(()=>{if(!J||null===ee)return new Set;const e=new Set;return A.forEach(t=>{ee>=t.startRow&&ee<t.endRow&&e.add(t.midiNote)}),e},[J,ee,A]),fe=s.useMemo(()=>{if("chromatic"===t.scaleKey)return;const e=iM[t.scaleKey];return e?new Set(function(e,t){return e<0||e>11?[]:t.intervals.map(t=>(e+t)%12)}(t.scaleRoot,e)):void 0},[t.scaleKey,t.scaleRoot]),ye=s.useMemo(()=>{if(!r.isDragging||"move"!==r.mode||!r.noteId)return null;const e=A.find(e=>e.id===r.noteId);if(!e)return null;const a=-Math.round((r.currentY-r.startY)/t.verticalZoom);return Math.max(0,Math.min(127,e.midiNote+a))},[r.isDragging,r.mode,r.noteId,r.currentY,r.startY,t.verticalZoom,A]),ge=s.useCallback(()=>t.noteLengthPreset>0?t.noteLengthPreset:t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1,[t.noteLengthPreset,t.snapToGrid,t.gridDivision]),be=s.useCallback(e=>{if(!fe)return e;if(fe.has(e%12))return e;for(let t=1;t<=6;t++){if(fe.has((e+t)%12))return e+t;if(fe.has((e-t+12)%12))return e-t}return e},[fe]),ve=s.useCallback(e=>{if(null===ae)return;const t=Qg(),a=te.find(e=>e.id===ae);if(!a)return;const n=Xw(e);le.current=n,t.triggerNoteAttack(ae,n,Z(),.8,a)},[ae,te]),xe=s.useCallback(()=>{if(le.current&&null!==ae){Qg().releaseNote(ae,le.current),le.current=null}},[ae]),we=s.useCallback((e,t)=>{"erase"===n?F(e):v(e,t)},[n,F,v]),ke=s.useCallback((e,t,a)=>{if(a.altKey&&"move"===t){const t=A.find(t=>t.id===e);t&&I(t.midiNote,t.startRow,t.endRow-t.startRow,t.velocity,t.channelIndex)}M(t,a.clientX,a.clientY,e)},[M,A,I]),Se=s.useCallback((e,a)=>{if(_(),"draw"===n){const n=be(a),s=ge();I(n,e,s,100,t.channelIndex)}else"select"===n&&(r.isDragging||k())},[n,t.channelIndex,I,k,_,r.isDragging,be,ge]),Me=s.useCallback((e,a)=>{if("draw"!==n)return;const s=be(a),r=ge();I(s,e,r,100,t.channelIndex)},[n,t.channelIndex,I,be,ge]),Ne=s.useCallback((e,t,n,s)=>{const r=A.find(a=>e>=a.startRow&&e<a.endRow&&t===a.midiNote);r&&!a.notes.has(r.id)&&v(r.id,!1),E(n,s,r?.id||null,e,t)},[A,a.notes,v,E]),Ce=s.useCallback(e=>{F(e)},[F]),Pe=s.useCallback((e,t,a)=>{if("select"!==n)return;A.find(a=>e>=a.startRow&&e<a.endRow&&t===a.midiNote)||M("select-box",a.clientX,a.clientY)},[n,A,M]),Ee=s.useRef(t.scrollX),_e=s.useRef(t.scrollY),Ae=s.useRef(null),Oe=s.useRef(t.scrollX),Ie=s.useRef(t.scrollY);s.useEffect(()=>{t.scrollX!==Oe.current&&(Ee.current=t.scrollX),t.scrollY!==Ie.current&&(_e.current=t.scrollY),Oe.current=t.scrollX,Ie.current=t.scrollY},[t.scrollX,t.scrollY]),s.useEffect(()=>()=>{null!==Ae.current&&cancelAnimationFrame(Ae.current)},[]);const Fe=s.useRef(()=>{});s.useEffect(()=>{Fe.current=()=>{const e=Qw.getState().view.scrollX,t=Qw.getState().view.scrollY,a=Ee.current,n=_e.current,s=a-e,r=n-t;if(Math.abs(s)<.1&&Math.abs(r)<.1)return c(a,n),Oe.current=a,Ie.current=n,void(Ae.current=null);const i=e+.25*s,o=t+.25*r;c(i,o),Oe.current=i,Ie.current=o,Ae.current=requestAnimationFrame(()=>Fe.current())}});const De=s.useCallback(()=>{Fe.current()},[]),Re=s.useCallback((e,t)=>{Ee.current=Math.max(0,Ee.current+e),_e.current=Math.max(0,Math.min(127,_e.current+t)),null===Ae.current&&(Ae.current=requestAnimationFrame(De))},[De]);s.useEffect(()=>{const e=e=>{const a=Qw.getState().drag;if(!a.isDragging)return;N(e.clientX,e.clientY);const n=t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1;if("move"===a.mode&&a.noteId){const s=e.clientX-a.startX,r=e.clientY-a.startY,i=s/t.horizontalZoom,o=Math.round(i/n)*n,l=-Math.round(r/t.verticalZoom);if(0!==o||0!==l){const e=A.find(e=>e.id===a.noteId);if(e){const t=Qw.getState().selection.notes,a=(t.has(e.id)?Array.from(t):[e.id]).map(e=>{const t=A.find(t=>t.id===e);return t?{...t,startRow:Math.max(0,t.startRow+o),endRow:Math.max(1,t.endRow+o),midiNote:Math.max(0,Math.min(127,t.midiNote+l))}:null}).filter(Boolean);T(a)}}}if(("resize-end"===a.mode||"resize-start"===a.mode)&&a.noteId){const s=(e.clientX-a.startX)/t.horizontalZoom,r=Math.round(s/n)*n,i=A.find(e=>e.id===a.noteId);if(i&&0!==r){const e={...i};"resize-end"===a.mode?e.endRow=Math.max(i.startRow+1,i.endRow+r):e.startRow=Math.min(i.endRow-1,Math.max(0,i.startRow+r)),T([e])}}if("select-box"===a.mode){const n=document.querySelector('[role="grid"]');if(!n)return;const s=n.getBoundingClientRect(),r=Math.min(a.startX,e.clientX)-s.left,i=Math.max(a.startX,e.clientX)-s.left,o=Math.min(a.startY,e.clientY)-s.top,l=Math.max(a.startY,e.clientY)-s.top,c=Math.floor(r/t.horizontalZoom)+t.scrollX,u=Math.ceil(i/t.horizontalZoom)+t.scrollX,d=t.scrollY+60-Math.floor(l/t.verticalZoom),p=t.scrollY+60-Math.floor(o/t.verticalZoom),m=A.filter(e=>e.startRow<u&&e.endRow>c&&e.midiNote>=d&&e.midiNote<=p).map(e=>e.id);x(m)}},a=()=>{const e=Qw.getState().drag;if(!e.isDragging)return;if("select-box"===e.mode)return void C();if(!e.noteId)return void C();const a=e.currentX-e.startX,n=e.currentY-e.startY,s=t.snapToGrid?Math.max(1,Math.floor(4/t.gridDivision)):1,r=Math.round(a/t.horizontalZoom/s)*s,i=-Math.round(n/t.verticalZoom);if("move"!==e.mode||0===r&&0===i){if("resize-end"===e.mode){const t=A.find(t=>t.id===e.noteId);t&&j(e.noteId,t.endRow+r)}else if("resize-start"===e.mode){const t=A.find(t=>t.id===e.noteId);t&&B(e.noteId,t.startRow+r)}}else R(e.noteId,r,i);C()};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",a),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",a)}},[t.horizontalZoom,t.verticalZoom,t.scrollX,t.scrollY,t.snapToGrid,t.gridDivision,A,R,j,B,N,C,x,T]);const je=s.useCallback(()=>{const e=A.filter(e=>a.notes.has(e.id));e.length>0&&P(e)},[A,a.notes,P]),Be=s.useCallback(()=>{je();const e=Array.from(a.notes);D(e),k()},[je,a.notes,D,k]),Le=s.useCallback(()=>{const e=Qw.getState().clipboard;e&&Q(e,Math.floor(t.scrollX),Math.round(t.scrollY+60),t.channelIndex)},[Q,t.scrollX,t.scrollY,t.channelIndex]),Ve=s.useCallback(()=>{const e=Array.from(a.notes);D(e),k()},[a.notes,D,k]),ze=s.useCallback(()=>{w(A.map(e=>e.id))},[A,w]),Ue=s.useCallback(()=>{const e=Array.from(a.notes);K(e,t.gridDivision)},[a.notes,K,t.gridDivision]),Ge=s.useCallback(()=>{const e=Array.from(a.notes),t=A.filter(e=>a.notes.has(e.id)).some(e=>e.slide);W(e,!t)},[A,a.notes,W]),He=s.useCallback(()=>{const e=Array.from(a.notes),t=A.filter(e=>a.notes.has(e.id)).some(e=>e.accent);H(e,!t)},[A,a.notes,H]),Ke=s.useCallback(()=>{const e=Qv.getState().undo();e&&ob.getState().replacePattern(ob.getState().currentPatternIndex,e)},[]),qe=s.useCallback(()=>{const e=Qv.getState().redo();e&&ob.getState().replacePattern(ob.getState().currentPatternIndex,e)},[]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if(e.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const s=e.key,r=s.toLowerCase();if((e.ctrlKey||e.metaKey)&&"z"===r&&!e.shiftKey)return e.preventDefault(),void Ke();if((e.ctrlKey||e.metaKey)&&("y"===r||"z"===r&&e.shiftKey))return e.preventDefault(),void qe();if((e.ctrlKey||e.metaKey)&&"c"===r)return e.preventDefault(),void je();if((e.ctrlKey||e.metaKey)&&"x"===r)return e.preventDefault(),void Be();if((e.ctrlKey||e.metaKey)&&"v"===r)return e.preventDefault(),void Le();if((e.ctrlKey||e.metaKey)&&"a"===r)return e.preventDefault(),void ze();if("Delete"===s||"Backspace"===s)return e.preventDefault(),void Ve();if("Escape"===s)return e.preventDefault(),k(),void _();if((e.ctrlKey||e.metaKey)&&"d"===r&&a.notes.size>0)return e.preventDefault(),void X(Array.from(a.notes));if(a.notes.size>0&&("ArrowUp"===s||"ArrowDown"===s||"ArrowLeft"===s||"ArrowRight"===s)){e.preventDefault();const n=Array.from(a.notes);if("ArrowUp"===s)return void q(n,e.shiftKey?12:1);if("ArrowDown"===s)return void q(n,e.shiftKey?-12:-1);if("ArrowLeft"===s&&e.shiftKey){const e=Math.max(1,Math.floor(4/t.gridDivision));return void $(n,-e)}if("ArrowRight"===s&&e.shiftKey){const e=Math.max(1,Math.floor(4/t.gridDivision));return void $(n,e)}}if(("+"===s||"="===s||"-"===s||"_"===s)&&a.notes.size>0&&!e.ctrlKey&&!e.metaKey){e.preventDefault();const t="+"===s||"="===s?10:-10;return void Y(Array.from(a.notes),t)}if(!e.ctrlKey&&!e.metaKey&&!e.altKey){if("q"===r&&a.notes.size>0&&"select"===n)return e.preventDefault(),void Ue();if("s"===r&&a.notes.size>0&&"select"===n&&!e.shiftKey&&"select"===n)return e.preventDefault(),void Ge();if("a"===r&&a.notes.size>0&&"select"===n&&!e.shiftKey)return e.preventDefault(),void He();if("draw"!==n){if("1"===s)return S("select"),void e.preventDefault();if("2"===s)return S("draw"),void e.preventDefault();if("3"===s)return S("erase"),void e.preventDefault()}}if(!("draw"!==n||e.ctrlKey||e.metaKey||e.altKey||e.repeat)){const a=YO[r];if(void 0!==a){e.preventDefault();const n=ob.getState().currentOctave||4,s=be(12*n+a),r=Math.floor(t.scrollX),i=ge();return I(s,r,i,100,t.channelIndex),void ve(s)}}},s=e=>{const t=e.key.toLowerCase();"draw"===n&&void 0!==YO[t]&&xe()};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[n,a.notes,t.scrollX,t.channelIndex,t.gridDivision,A,I,je,Be,Le,Ve,ze,Ue,Ge,He,Ke,qe,k,_,S,be,ge,ve,xe,q,$,X,Y]);const $e=s.useMemo(()=>t.showVelocityLane?se-80:se,[se,t.showVelocityLane]),Xe=O?.length||64,Ye=s.useMemo(()=>Object.entries(iM).map(([e,t])=>({value:e,label:t.name})),[]);return Ea.jsxs("div",{ref:ne,className:"flex flex-col h-full w-full bg-dark-bgSecondary",role:"application","aria-label":"Piano roll editor",children:[Ea.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-dark-border bg-dark-bgTertiary shrink-0 flex-wrap",children:[Ea.jsxs("div",{className:"flex items-center bg-dark-bg rounded-md p-0.5",role:"toolbar","aria-label":"Editing tools",children:[Ea.jsx("button",{onClick:()=>S("select"),className:"p-1.5 rounded transition-colors "+("select"===n?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Select (1)","aria-pressed":"select"===n,children:Ea.jsx(ma,{size:14})}),Ea.jsx("button",{onClick:()=>S("draw"),className:"p-1.5 rounded transition-colors "+("draw"===n?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Draw (2)","aria-pressed":"draw"===n,children:Ea.jsx(ra,{size:14})}),Ea.jsx("button",{onClick:()=>S("erase"),className:"p-1.5 rounded transition-colors "+("erase"===n?"bg-accent-primary text-text-inverse":"text-text-muted hover:text-text-primary"),title:"Erase (3)","aria-pressed":"erase"===n,children:Ea.jsx(ha,{size:14})})]}),Ea.jsx("div",{className:"w-px h-4 bg-dark-border"}),Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsx("span",{className:"text-[10px] text-text-muted",children:"H"}),Ea.jsx("button",{onClick:()=>o(.8*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out horizontally",children:Ea.jsx(fa,{size:14})}),Ea.jsx("span",{className:"text-xs text-text-muted w-6 text-center",children:Math.round(t.horizontalZoom)}),Ea.jsx("button",{onClick:()=>o(1.25*t.horizontalZoom),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in horizontally",children:Ea.jsx(ya,{size:14})})]}),Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsx("span",{className:"text-[10px] text-text-muted",children:"V"}),Ea.jsx("button",{onClick:()=>l(t.verticalZoom-2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom out vertically",children:Ea.jsx(Vt,{size:14})}),Ea.jsxs("span",{className:"text-xs text-text-muted w-10 text-center",title:`${me} octaves visible`,children:[me,"oct"]}),Ea.jsx("button",{onClick:()=>l(t.verticalZoom+2),className:"p-1 text-text-muted hover:text-text-primary",title:"Zoom in vertically",children:Ea.jsx(Lt,{size:14})})]}),Ea.jsx("div",{className:"w-px h-4 bg-dark-border"}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("button",{onClick:()=>u(!t.snapToGrid),className:"p-1 rounded transition-colors "+(t.snapToGrid?"text-accent-primary":"text-text-muted"),title:"Snap to grid","aria-pressed":t.snapToGrid,children:Ea.jsx(et,{size:14})}),Ea.jsxs("select",{value:t.gridDivision,onChange:e=>d(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Grid division","aria-label":"Grid division",children:[Ea.jsx("option",{value:1,children:"1/1"}),Ea.jsx("option",{value:2,children:"1/2"}),Ea.jsx("option",{value:4,children:"1/4"}),Ea.jsx("option",{value:8,children:"1/8"}),Ea.jsx("option",{value:16,children:"1/16"})]})]}),Ea.jsx("select",{value:t.noteLengthPreset,onChange:e=>b(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Note length","aria-label":"Note length preset",children:Zw.map(e=>Ea.jsx("option",{value:e.value,children:e.label},e.value))}),Ea.jsx("div",{className:"w-px h-4 bg-dark-border"}),Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsx(Te,{size:12,className:"text-text-muted"}),Ea.jsx("select",{value:t.scaleRoot,onChange:e=>g(Number(e.target.value)),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary w-10",title:"Root note","aria-label":"Scale root note",children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((e,t)=>Ea.jsx("option",{value:t,children:e},t))}),Ea.jsx("select",{value:t.scaleKey,onChange:e=>y(e.target.value),className:"px-1 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary",title:"Scale","aria-label":"Scale type",children:Ye.map(e=>Ea.jsx("option",{value:e.value,children:e.label},e.value))})]}),Ea.jsx("div",{className:"w-px h-4 bg-dark-border"}),Ea.jsx("button",{onClick:()=>p(!t.showVelocity),className:"p-1 rounded transition-colors "+(t.showVelocity?"text-accent-primary":"text-text-muted"),title:"Show velocity on notes","aria-pressed":t.showVelocity,children:t.showVelocity?Ea.jsx(yt,{size:14}):Ea.jsx(ft,{size:14})}),Ea.jsx("button",{onClick:()=>m(!t.showVelocityLane),className:"p-1 rounded transition-colors "+(t.showVelocityLane?"text-accent-primary":"text-text-muted"),title:"Velocity editing lane","aria-pressed":t.showVelocityLane,children:Ea.jsx(kt,{size:14})}),Ea.jsx("button",{onClick:()=>f(!t.multiChannel),className:"p-1 rounded transition-colors "+(t.multiChannel?"text-accent-primary":"text-text-muted"),title:"Show all channels","aria-pressed":t.multiChannel,children:Ea.jsx(ua,{size:14})}),Ea.jsx("div",{className:"w-px h-4 bg-dark-border"}),Ea.jsxs("button",{onClick:()=>oe(!0),className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-text-primary rounded transition-colors",title:"Generate 303 acid pattern",children:[Ea.jsx(ct,{size:12}),"Acid"]}),!t.multiChannel&&void 0===e&&O&&Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("div",{className:"w-px h-4 bg-dark-border"}),Ea.jsxs("div",{className:"flex items-center gap-1.5",children:[Ea.jsx("span",{className:"text-xs text-text-muted",children:"CH"}),Ea.jsx("select",{value:t.channelIndex,onChange:e=>h(Number(e.target.value)),className:"px-1.5 py-0.5 text-xs bg-dark-bg border border-dark-border rounded text-text-primary","aria-label":"Channel",children:O.channels.map((e,t)=>Ea.jsxs("option",{value:t,children:[String(t+1).padStart(2,"0")," ",e.name?`- ${e.name}`:""]},t))})]})]}),Ea.jsx("div",{className:"flex-1"}),Ea.jsxs("span",{className:"text-xs text-text-muted",children:[A.length," notes",a.notes.size>0&&` (${a.notes.size} sel)`,i&&` | clip:${i.notes.length}`]}),Ea.jsx("div",{className:"w-px h-4 bg-dark-border"}),Ea.jsx("button",{onClick:()=>{Vv.getState().pianoRollPoppedOut?j_("DEViLBOX  Piano Roll"):Vv.getState().setPianoRollPoppedOut(!0)},className:"p-1 rounded transition-colors text-text-muted hover:text-cyan-400",title:"Pop out to separate window",children:Ea.jsx(We,{size:14})})]}),Ea.jsxs("div",{className:"flex-1 flex flex-col w-full overflow-hidden min-h-0",children:[Ea.jsxs("div",{className:"flex-1 flex w-full overflow-hidden min-h-0",children:[Ea.jsx(TO,{verticalZoom:t.verticalZoom,scrollY:t.scrollY,visibleNotes:pe,containerHeight:$e,activeNotes:he,scaleNotes:fe,dragTargetMidi:ye,onNotePreview:ve,onNoteRelease:xe}),Ea.jsx(BO,{notes:A,patternLength:Xe,horizontalZoom:t.horizontalZoom,verticalZoom:t.verticalZoom,scrollX:t.scrollX,scrollY:t.scrollY,gridDivision:t.gridDivision,showVelocity:t.showVelocity,selectedNotes:a.notes,playheadRow:J?ee:null,containerHeight:$e,scaleNotes:fe,tool:n,onNoteSelect:we,onNoteDragStart:ke,onGridClick:Se,onGridRightClick:Ne,onScroll:Re,onSelectionBoxStart:Pe,onNoteErase:Ce,onGridDraw:Me})]}),t.showVelocityLane&&Ea.jsxs("div",{className:"flex w-full shrink-0",children:[Ea.jsx("div",{className:"shrink-0",style:{width:72}})," ",Ea.jsx(zO,{notes:A,horizontalZoom:t.horizontalZoom,scrollX:t.scrollX,selectedNotes:a.notes,onBeginDrag:L,onDragVelocity:V,onDragMultiVelocity:z,onEndDrag:U,onAdjustVelocity:Y})]})]}),Ea.jsx(WO,{onCopy:je,onCut:Be,onPaste:Le,onDelete:Ve,onSelectAll:ze,onQuantize:Ue,onToggleSlide:Ge,onToggleAccent:He,onSetVelocity:e=>G(Array.from(a.notes),e),hasSelection:a.notes.size>0,hasClipboard:null!==i,selectionVelocity:a.notes.size>0?Math.round(A.filter(e=>a.notes.has(e.id)).reduce((e,t)=>e+t.velocity,0)/Math.max(1,A.filter(e=>a.notes.has(e.id)).length)):void 0}),ie&&Ea.jsx(MM,{channelIndex:e??t.channelIndex,onClose:()=>oe(!1)})]})},QO=Object.freeze(Object.defineProperty({__proto__:null,PianoRoll:ZO,default:ZO},Symbol.toStringTag,{value:"Module"}));e.memo(({verticalZoom:e,scrollY:t,visibleNotes:a,containerHeight:n,activeNotes:r=new Set,scaleNotes:i,onNoteClick:o,onNotePreview:l,onNoteRelease:c})=>{const u=s.useCallback(e=>{l?.(e),o?.(e)},[o,l]),d=s.useCallback(()=>{c?.()},[c]),p=s.useMemo(()=>{const e=[],n=Math.min(127,t+a),s=Math.max(0,t);for(let t=n;t>=s;t--){const a=t%12,n=!i||i.has(a);e.push({midiNote:t,isBlack:Yw(t),name:Xw(t),inScale:n})}return e},[t,a,i]);return Ea.jsx("div",{className:"flex flex-col bg-gray-900 border-r border-dark-border overflow-hidden shrink-0",style:{width:48,height:n||"auto"},role:"group","aria-label":"Piano keyboard",children:p.map(({midiNote:t,isBlack:a,name:n,inScale:s})=>{const i=t%12==0,o=r.has(t),l=!s;return Ea.jsx("div",{className:`\n              flex items-center justify-end pr-1 text-[9px] font-mono cursor-pointer\n              select-none border-b transition-all duration-75 shrink-0\n              ${o?"bg-accent-primary text-text-inverse border-accent-primary brightness-110 shadow-lg":a?"bg-gray-800 text-gray-400 border-gray-700 hover:bg-gray-700 "+(l?"opacity-40":""):"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200 "+(l?"opacity-40":"")}\n              ${i?"font-bold":""}\n            `,style:{height:e,transform:o?"translateX(2px)":"translateX(0)"},onMouseDown:()=>u(t),onMouseUp:d,onMouseLeave:d,title:n,role:"button","aria-label":`Play ${n}`,"aria-pressed":o,children:i?n:""},t)})})});const JO=e.memo(({note:e,horizontalZoom:t,verticalZoom:a,scrollX:n,scrollY:r,isSelected:i,showVelocity:o,isGhost:l=!1,onSelect:c,onDragStart:u})=>{const d=(e.startRow-n)*t,p=(e.endRow-e.startRow)*t,m=(r+60-e.midiNote)*a,h=s.useCallback(t=>{if(l)return;t.stopPropagation();const a=t.currentTarget.getBoundingClientRect(),n=t.clientX-a.left>p-8;c?.(e.id,t.shiftKey||t.ctrlKey||t.metaKey),u&&u(e.id,n?"resize-end":"move",t)},[e.id,p,l,c,u]);if(d+p<-50||d>3e3||m<-50||m>2e3)return null;const f=e.velocity/127*100,y=["bg-cyan-500","bg-purple-500","bg-green-500","bg-amber-500","bg-pink-500","bg-blue-500","bg-red-500","bg-teal-500"],g=y[e.channelIndex%y.length],b=p>30&&a>=10,v=Xw(e.midiNote);return l?Ea.jsx("div",{className:`absolute rounded-sm pointer-events-none ${g}`,style:{left:d,top:m,width:Math.max(4,p-1),height:a-1,opacity:.3,border:"1px dashed rgba(255,255,255,0.5)"}}):Ea.jsxs("div",{className:`\n        absolute rounded-sm cursor-move select-none\n        ${g}\n        ${i?"ring-2 ring-accent-primary ring-opacity-100 brightness-125 z-10":"ring-1 ring-black/30"}\n        hover:brightness-125 hover:ring-accent-primary/50 hover:z-20\n        transition-all duration-75\n        shadow-md hover:shadow-lg\n      `,style:{left:d,top:m,width:Math.max(4,p-1),height:a-1,opacity:.8+e.velocity/127*.2},onMouseDown:h,title:`${v} vel:${e.velocity}${e.slide?" [SLIDE]":""}${e.accent?" [ACCENT]":""}`,role:"button","aria-label":`Note ${v}, velocity ${e.velocity}${e.slide?", slide":""}${e.accent?", accent":""}`,tabIndex:0,children:[b&&Ea.jsx("span",{className:"absolute left-1 top-0 text-[8px] text-white/80 font-mono leading-none pointer-events-none",style:{lineHeight:a-1+"px"},children:v}),o&&p>20&&Ea.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/30 pointer-events-none",style:{height:100-f+"%"}}),e.slide&&Ea.jsx("div",{className:"absolute top-0 right-3 w-1.5 h-full bg-yellow-400/60 pointer-events-none"}),e.accent&&Ea.jsx("div",{className:"absolute top-0 left-0 w-0 h-0 pointer-events-none",style:{borderLeft:"6px solid rgba(255,100,0,0.8)",borderBottom:"6px solid transparent"}}),Ea.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-white/30 transition-colors"})]})});e.memo(({notes:t,patternLength:a,horizontalZoom:n,verticalZoom:r,scrollX:i,scrollY:o,gridDivision:l,showVelocity:c,selectedNotes:u,playheadRow:d,containerHeight:p,scaleNotes:m,onNoteSelect:h,onNoteDragStart:f,onGridClick:y,onGridRightClick:g,onScroll:b,onSelectionBoxStart:v})=>{const x=s.useRef(null),w=Qw(e=>e.ghostNotes),k=Qw(e=>e.drag),[S,M]=e.useState(800);e.useEffect(()=>{const e=()=>{x.current&&M(x.current.clientWidth)};e();const t=new ResizeObserver(e);return x.current&&t.observe(x.current),()=>t.disconnect()},[]);const N=s.useMemo(()=>Math.ceil(S/n)+2,[n,S]),C=s.useMemo(()=>{const e=p||400;return Math.ceil(e/r)+2},[r,p]),P=s.useCallback(e=>{e.preventDefault();const t=e.shiftKey?e.deltaY:e.deltaX,a=e.shiftKey?0:e.deltaY;b(t/n,-a/r)},[n,r,b]),E=s.useCallback(e=>{if(!x.current)return;if(2===e.button)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(a/n)+i,c=o+60-Math.floor(s/r);y(Math.max(0,l),Math.max(0,Math.min(127,c)))},[n,r,i,o,y]),_=s.useCallback(e=>{if(e.preventDefault(),!x.current)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(a/n)+i,c=o+60-Math.floor(s/r);g(Math.max(0,l),Math.max(0,Math.min(127,c)),e.clientX,e.clientY)},[n,r,i,o,g]),T=s.useCallback(e=>{if(!x.current||0!==e.button)return;const t=x.current.getBoundingClientRect(),a=e.clientX-t.left,s=e.clientY-t.top,l=Math.floor(a/n)+i,c=o+60-Math.floor(s/r);v(Math.max(0,l),Math.max(0,Math.min(127,c)),e)},[n,r,i,o,v]),A=s.useMemo(()=>{const e=[],t=a*n,s=Math.max(S,t),c=Math.floor(i),u=Math.ceil(i+N),d=4/l,p=Math.max(u,Math.ceil(S/n+i));for(let r=c;r<=p;r++){const t=(r-i)*n,s=r%4==0,o=r%16==0,l=r>a;(r%d===0||s||o)&&e.push(Ea.jsx("div",{className:"absolute top-0 bottom-0 "+(l?"bg-gray-700/20":o?"bg-gray-500/50":s?"bg-gray-600/40":"bg-gray-700/30"),style:{left:t,width:1}},`v-${r}`))}for(let a=0;a<C;a++){const t=o+60-a;if(t<0||t>127)continue;const n=a*r,i=t%12==0,l=Yw(t),c=t%12,u=m&&!m.has(c);e.push(Ea.jsx("div",{className:`absolute left-0 ${u?"bg-gray-900/70":l?"bg-gray-800/50":"bg-gray-900/30"} ${i?"border-t border-gray-500/50":""}`,style:{top:n,height:r,width:s}},`h-${t}`))}return e},[i,o,n,r,a,N,C,l,S,m]),O=null!==d?(d-i)*n:null,I=Qw(e=>e.tool),F="draw"===I?"cursor-crosshair":"erase"===I?"cursor-not-allowed":"cursor-default",[D,R]=s.useState(null);s.useEffect(()=>{"select-box"===k.mode&&k.isDragging&&x.current&&R(x.current.getBoundingClientRect())},[k.mode,k.isDragging]);const j=s.useMemo(()=>{if("select-box"!==k.mode||!k.isDragging)return null;if(!D)return null;return{left:Math.min(k.startX,k.currentX)-D.left,top:Math.min(k.startY,k.currentY)-D.top,width:Math.abs(k.currentX-k.startX),height:Math.abs(k.currentY-k.startY)}},[k,D]);return Ea.jsxs("div",{ref:x,className:`flex-1 w-full h-full relative overflow-hidden bg-gray-900 ${F}`,onWheel:P,onClick:E,onContextMenu:_,onMouseDown:T,role:"grid","aria-label":"Piano roll note grid",children:[Ea.jsx("div",{className:"absolute inset-0 pointer-events-none",children:A}),w.map(e=>Ea.jsx(JO,{note:e,horizontalZoom:n,verticalZoom:r,scrollX:i,scrollY:o,isSelected:!1,showVelocity:!1,isGhost:!0},`ghost-${e.id}`)),t.map(e=>Ea.jsx(JO,{note:e,horizontalZoom:n,verticalZoom:r,scrollX:i,scrollY:o,isSelected:u.has(e.id),showVelocity:c,onSelect:h,onDragStart:f},e.id)),j&&Ea.jsx("div",{className:"absolute border-2 border-accent-primary/60 bg-accent-primary/10 pointer-events-none z-20",style:j}),null!==O&&O>=0&&Ea.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-accent-primary pointer-events-none z-10",style:{left:O}}),Ea.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-red-500/50 pointer-events-none",style:{left:(a-i)*n}})]})});e.memo(({notes:e,horizontalZoom:t,scrollX:a,selectedNotes:n,onBeginDrag:r,onDragVelocity:i,onDragMultiVelocity:o,onEndDrag:l})=>{const c=s.useRef(null),[u,d]=s.useState(null),[p,m]=s.useState(null),h=s.useCallback(e=>{const t=Math.round(127*(1-e/80));return Math.max(1,Math.min(127,t))},[]),f=s.useCallback((e,t)=>{if(t.preventDefault(),t.stopPropagation(),d(e),r(),!c.current)return;const a=c.current.getBoundingClientRect(),s=t.clientY-a.top,l=h(s);n.has(e)&&n.size>1?o(Array.from(n),l):i(e,l)},[n,r,i,o,h]),y=s.useCallback(e=>{if(!u||!c.current)return;const t=c.current.getBoundingClientRect(),a=e.clientY-t.top,s=h(a);n.has(u)&&n.size>1?o(Array.from(n),s):i(u,s)},[u,n,i,o,h]),g=s.useCallback(()=>{u&&l(),d(null)},[u,l]),b=s.useMemo(()=>e.map(e=>{const s=(e.startRow-a)*t,r=(e.endRow-e.startRow)*t;if(s+r<0||s>2e3)return null;const i=e.velocity/127*80,o=n.has(e.id),l=p===e.id,c=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6"],u=c[e.channelIndex%c.length];return Ea.jsx("div",{className:"absolute bottom-0 cursor-ns-resize",style:{left:s,width:Math.max(3,r-1),height:i,backgroundColor:u,opacity:o?1:l?.9:.7,border:o?"1px solid #facc15":"none",borderRadius:"2px 2px 0 0",transition:"opacity 75ms"},onMouseDown:t=>f(e.id,t),onMouseEnter:()=>m(e.id),onMouseLeave:()=>m(null),title:`Velocity: ${e.velocity}`},e.id)}).filter(Boolean),[e,t,a,n,p,f]),v=s.useMemo(()=>{const e=[];return[32,64,96,127].forEach(t=>{const a=80-t/127*80;e.push(Ea.jsxs("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:a},children:[Ea.jsx("div",{className:"border-t border-gray-700/40 w-full"}),Ea.jsx("span",{className:"absolute left-1 text-[8px] text-text-muted/40 -translate-y-full",children:t})]},t))}),e},[]);return Ea.jsxs("div",{ref:c,className:"relative bg-gray-900/80 border-t border-dark-border overflow-hidden shrink-0",style:{height:80},onMouseMove:y,onMouseUp:g,onMouseLeave:g,children:[v,Ea.jsx("div",{className:"absolute top-1 left-1 text-[9px] text-text-muted/50 pointer-events-none z-10",children:"VEL"}),b]})});const eI=({curve:e,parameter:t,patternLength:a,onChange:n})=>{const r=s.useRef(null),i=s.useRef(null),[o]=s.useState("pencil"),[l,c]=s.useState(!1),[u,d]=s.useState(null),[p,m]=s.useState(800),h=200,f=35,y=10,g="cyan-lineart"===cx(e=>e.currentThemeId),b=g?"#00ffff":"#00d4aa",v=g?"#00ffff":"#7c3aed",x=g?"rgba(0, 255, 255, 0.3)":"rgba(0, 212, 170, 0.3)",w=g?"#0a2020":"#1a1a1d",k=g?"#0f3030":"#252528",S=g?"#030808":"#0a0a0b",M=g?"#00a0a0":"#606068";s.useEffect(()=>{const e=r.current;if(!e)return;const t=new ResizeObserver(e=>{for(const t of e)m(t.contentRect.width)});return t.observe(e),m(e.clientWidth),()=>t.disconnect()},[]);const N=p-f-10,C=165,P=s.useCallback(e=>f+e/a*N,[a,N]),E=s.useCallback(e=>y+(1-e)*C,[C]),_=s.useCallback(e=>{const t=(e-f)/N;return Math.round(t*a)},[a,N]),T=s.useCallback(e=>{const t=1-(e-y)/C;return Math.max(0,Math.min(1,t))},[C]),A=s.useCallback(()=>{const t=i.current;if(!t)return;const n=t.getContext("2d");if(n){n.fillStyle=S,n.fillRect(0,0,p,h);for(let e=0;e<=a;e++){const t=P(e),s=e%16==0,r=e%4==0;n.strokeStyle=s?k:w,n.lineWidth=s?1.5:.5,(a<=64||r)&&(n.beginPath(),n.moveTo(t,y),n.lineTo(t,175),n.stroke()),s&&e<a&&(n.fillStyle=M,n.font="9px JetBrains Mono, monospace",n.textAlign="center",n.fillText(e.toString(),t,192))}n.strokeStyle=w,n.lineWidth=.5;for(let e=0;e<=4;e++){const t=y+e/4*C,a=2===e;n.strokeStyle=a?k:w,n.lineWidth=a?1:.5,n.beginPath(),n.moveTo(f,t),n.lineTo(p-10,t),n.stroke()}if(n.fillStyle=M,n.font="9px JetBrains Mono, monospace",n.textAlign="right",n.fillText("1.0",30,14),n.fillText("0.5",30,95.5),n.fillText("0.0",30,178),e.points.length>0){const t=n.createLinearGradient(f,0,p-10,0);t.addColorStop(0,b),t.addColorStop(1,v),n.strokeStyle=t,n.lineWidth=2,n.beginPath();const a=[...e.points].sort((e,t)=>e.row-t.row);a.forEach((t,s)=>{const r=P(t.row),i=E(t.value);if(0===s)n.moveTo(r,i);else if("linear"===e.interpolation)n.lineTo(r,i);else if("exponential"===e.interpolation){const e=a[s-1],t=P(e.row),o=t+.5*(r-t),l=E(e.value);n.quadraticCurveTo(o,l,r,i)}}),n.stroke(),a.forEach((e,t)=>{const a=P(e.row),s=E(e.value);t===u&&(n.fillStyle=x,n.beginPath(),n.arc(a,s,10,0,2*Math.PI),n.fill()),n.fillStyle=t===u?b:v,n.beginPath(),n.arc(a,s,5,0,2*Math.PI),n.fill(),n.fillStyle="#ffffff",n.beginPath(),n.arc(a,s,2,0,2*Math.PI),n.fill()})}}},[e,a,u,P,E,b,v,x,p,S,w,k,M,N,C]);s.useEffect(()=>{A()},[A]);const[O,I]=s.useState(!1),F=()=>{c(!1),I(!1)},D=s.useCallback(t=>{if(("Delete"===t.key||"Backspace"===t.key)&&null!==u){const t=e.points.filter((e,t)=>t!==u);n({...e,points:t}),d(null)}},[u,e,n]);s.useEffect(()=>(window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)),[D]);const R=(t,s)=>{if(t<0||t>a)return;const r=[...e.points],i=r.findIndex(e=>e.row===t);i>=0?r[i].value=s:r.push({row:t,value:s}),n({...e,points:r.sort((e,t)=>e.row-t.row)})},j=t=>{const s=[];for(let e=0;e<=a;e+=4){let n=0;switch(t){case"rampUp":n=e/a;break;case"rampDown":n=1-e/a;break;case"triangle":n=e<a/2?e/a*2:2-e/a*2;break;case"sine":n=(Math.sin(e/a*Math.PI*2-Math.PI/2)+1)/2;break;case"saw":n=e%(a/4)/(a/4);break;case"square":n=e<a/2?1:0;break;case"random":n=Math.random()}s.push({row:e,value:n})}n({...e,points:s})};return Ea.jsxs("div",{className:"bg-dark-bg p-4",children:[Ea.jsx("div",{className:"text-accent-primary text-sm font-semibold mb-3",children:t.toUpperCase()}),Ea.jsxs("div",{className:"flex gap-2 mb-3 flex-wrap",children:[Ea.jsxs("div",{className:"flex gap-1 flex-wrap",children:[Ea.jsx("button",{onClick:()=>j("rampUp"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Up"}),Ea.jsx("button",{onClick:()=>j("rampDown"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Ramp Down"}),Ea.jsx("button",{onClick:()=>j("triangle"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Triangle"}),Ea.jsx("button",{onClick:()=>j("sine"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Sine"}),Ea.jsx("button",{onClick:()=>j("random"),className:"px-2.5 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-text-secondary border border-dark-border hover:border-dark-borderLight transition-colors",children:"Random"})]}),Ea.jsx("div",{className:"w-px bg-dark-border mx-1"}),Ea.jsx("button",{onClick:()=>{n({...e,points:[]})},className:"px-3 py-1.5 text-xs font-medium rounded-md bg-dark-bgTertiary text-accent-error border border-dark-border hover:border-accent-error transition-colors",children:"Clear"})]}),Ea.jsx("div",{ref:r,className:"w-full",children:Ea.jsx("canvas",{ref:i,width:p,height:h,onMouseDown:t=>{const a=i.current;if(!a)return;const n=a.getBoundingClientRect(),s=a.width/n.width,r=a.height/n.height,l=(t.clientX-n.left)*s,u=(t.clientY-n.top)*r,p=_(l),m=T(u),h=e.points.findIndex(e=>{const t=P(e.row),a=E(e.value);return Math.hypot(t-l,a-u)<15});if(h>=0)return d(h),void I(!0);"pencil"===o?(c(!0),R(p,m)):"select"===o&&d(null)},onMouseMove:t=>{const s=i.current;if(!s)return;const r=s.getBoundingClientRect(),c=s.width/r.width,p=s.height/r.height,m=(t.clientX-r.left)*c,h=(t.clientY-r.top)*p,f=_(m),y=T(h);if(O&&null!==u){const t=[...e.points],s=Math.max(0,Math.min(a,f));t[u]={row:s,value:y};const r=t.sort((e,t)=>e.row-t.row),i=r.findIndex(e=>e.row===s&&Math.abs(e.value-y)<.001);n({...e,points:r}),i>=0&&i!==u&&d(i)}else"pencil"===o&&l&&R(f,y)},onMouseUp:F,onMouseLeave:F,onContextMenu:t=>{t.preventDefault();const a=i.current;if(!a)return;const s=a.getBoundingClientRect(),r=a.width/s.width,o=a.height/s.height,l=(t.clientX-s.left)*r,c=(t.clientY-s.top)*o,u=e.points.findIndex(e=>{const t=P(e.row),a=E(e.value);return Math.hypot(t-l,a-c)<15});if(u>=0){const t=e.points.filter((e,t)=>t!==u);n({...e,points:t}),d(null)}},className:"w-full rounded-lg border border-dark-border "+(O?"cursor-grabbing":"cursor-crosshair"),style:{height:h},tabIndex:0})}),Ea.jsxs("div",{className:"mt-3 flex gap-2 items-center",children:[Ea.jsx("span",{className:"text-text-muted text-xs",children:"Interpolation:"}),Ea.jsx("button",{onClick:()=>n({...e,interpolation:"linear"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("linear"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Linear"}),Ea.jsx("button",{onClick:()=>n({...e,interpolation:"exponential"}),className:"px-3 py-1.5 text-xs font-medium rounded-md border transition-colors "+("exponential"===e.interpolation?"bg-accent-primary text-text-inverse border-accent-primary":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"),children:"Exponential"})]})]})},tI=()=>{const{patterns:e,currentPatternIndex:t}=ob(),{getAutomation:a,setAutomation:n}=Zv(),[r,i]=s.useState(null),[o,l]=s.useState(0),c="cyan-lineart"===cx(e=>e.currentThemeId),u=c?"bg-cyan-500/20":"bg-orange-500/20",d=c?"text-cyan-400":"text-orange-400",p=c?"border-cyan-500":"border-orange-500",m=c?"hover:bg-cyan-500/30":"hover:bg-orange-500/30",h=c?"bg-cyan-500":"bg-orange-500",f=e[t],y=f?.channels.length||4,g=Math.min(o,y-1),{groups:b,instrumentName:v}=nS(g);if(s.useEffect(()=>{if(0===b.length)return;const e=b.flatMap(e=>e.params.map(e=>e.key));r&&e.includes(r)||requestAnimationFrame(()=>i(e[0]))},[b,r]),!f)return Ea.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"No pattern loaded"});const x=r??b[0]?.params[0]?.key??"tb303.cutoff",w=a(f.id,g,x);return Ea.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden bg-dark-bg",children:[Ea.jsx("div",{className:"bg-dark-bgSecondary border-b border-dark-border px-4 py-3",children:Ea.jsxs("div",{className:"flex items-center justify-between",children:[Ea.jsxs("div",{className:"flex items-center gap-3",children:[Ea.jsx("span",{className:"text-text-secondary text-sm",children:"Automation"}),Ea.jsxs("span",{className:"text-text-primary font-medium",children:["Pattern ",String(t).padStart(2,"0"),": ",f.name]}),v&&Ea.jsxs("span",{className:"text-text-muted text-xs",children:["(",v,")"]})]}),Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsx("span",{className:"text-text-muted text-xs",children:"Channel:"}),Ea.jsx("div",{className:"flex gap-1",children:Array.from({length:y},(e,t)=>{const a=f.channels[t];return Ea.jsx("button",{onClick:()=>l(t),className:`\n                      w-8 h-7 text-xs font-mono rounded border transition-all\n                      ${g===t?"text-text-inverse border-transparent":"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight"}\n                    `,style:g===t?{backgroundColor:a?.color||"#22c55e"}:void 0,title:a?.name||`Channel ${t+1}`,children:t+1},t)})})]})]})}),Ea.jsx("div",{className:"border-b border-dark-border bg-dark-bgSecondary p-3",children:b.length>0?Ea.jsx("div",{className:"flex gap-6 flex-wrap",children:b.map(e=>Ea.jsxs("div",{className:"flex flex-col gap-1.5",children:[Ea.jsx("div",{className:"text-text-muted text-[10px] font-medium uppercase tracking-wider",children:e.label}),Ea.jsx("div",{className:"flex gap-1.5 flex-wrap",children:e.params.map(e=>{const t=a(f.id,g,e.key).points.length>0,n=x===e.key;return Ea.jsxs("button",{onClick:()=>i(e.key),className:`\n                          relative px-3 py-1.5 text-xs rounded-md border transition-all duration-150\n                          ${n?"bg-accent-primary text-text-inverse border-accent-primary shadow-glow-sm":t?`${u} ${d} ${p} ${m}`:"bg-dark-bgTertiary text-text-secondary border-dark-border hover:border-dark-borderLight hover:text-text-primary"}\n                        `,title:e.name+(t?" (has automation)":""),children:[e.name,t&&!n&&Ea.jsx("span",{className:`absolute -top-1 -right-1 w-2 h-2 ${h} rounded-full`})]},e.key)})})]},e.label))}):Ea.jsx("div",{className:"text-text-muted text-xs",children:"No instrument assigned to this channel"})}),Ea.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:Ea.jsx(eI,{curve:w,parameter:x,patternLength:f.length,onChange:e=>{n(f.id,g,x,e)}})})]})};function aI(e,t,a){let n="";for(let s=0;s<a;s++){const a=e[t+s];if(0===a)break;n+=String.fromCharCode(a)}return n.trim()}function nI(e,t){return e[t]|e[t+1]<<8}function sI(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}async function rI(e){const t=await e.arrayBuffer(),a=new Uint8Array(t),n=function(e){if(e.length>1084){const t=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);if(["M.K.","M!K!","4CHN","6CHN","8CHN","FLT4","FLT8"].includes(t))return"MOD";if(t.match(/^\d\dCH$/))return"MOD"}if(e.length>17&&"Extended Module: "===String.fromCharCode(...e.slice(0,17)))return"XM";if(e.length>48&&26===e[44]&&16===e[45]&&16===e[29])return"S3M";if(e.length>4&&"IMPM"===String.fromCharCode(e[0],e[1],e[2],e[3]))return"IT";return null}(a);if(!n)throw new Error("Unknown or unsupported module format");switch(n){case"MOD":return function(e){const t=aI(e,0,20),a=[],n=[];for(let u=0;u<31;u++){const t=20+30*u,a=aI(e,t,22),s=2*(e[t+22]<<8|e[t+23]),r=15&e[t+24],i=e[t+25],o=2*(e[t+26]<<8|e[t+27]),l=2*(e[t+28]<<8|e[t+29]);n.push({name:a,length:s,fineTune:r,volume:i,loopStart:o,loopLength:l})}const s=e[950],r=e.slice(952,1080);let i=0;for(let u=0;u<s;u++)r[u]>i&&(i=r[u]);const o=String.fromCharCode(e[1080],e[1081],e[1082],e[1083]);let l=4;"6CHN"===o?l=6:"8CHN"===o||"FLT8"===o?l=8:o.match(/^\d\dCH$/)&&(l=parseInt(o.substring(0,2),10));let c=1084+64*(i+1)*l*4;for(let u=0;u<31;u++){const t=n[u];if(0===t.length)continue;const s=new Float32Array(t.length);for(let a=0;a<t.length;a++){const t=e[c+a],n=t>127?t-256:t;s[a]=n/128}let r="none";t.loopLength>2&&(r="forward"),a.push({name:t.name||`Sample ${u+1}`,sampleRate:8363,channels:1,bitDepth:8,pcmData:s,loopStart:t.loopStart,loopEnd:t.loopStart+t.loopLength,loopType:r,baseNote:"C-4",fineTune:t.fineTune>7?t.fineTune-16:t.fineTune,volume:t.volume}),c+=t.length}return{samples:a,format:"MOD",title:t}}(a);case"XM":return function(e){const t=aI(e,17,20),a=[],n=sI(e,60),s=nI(e,72);let r=60+n;for(let i=0;i<s&&!(r>=e.length);i++){const t=sI(e,r),n=aI(e,r+4,22),s=nI(e,r+27);if(0===s){r+=t;continue}const i=sI(e,r+29);r+=t;const o=[];for(let a=0;a<s&&!(r+40>e.length);a++)o.push({length:sI(e,r),loopStart:sI(e,r+4),loopLength:sI(e,r+8),volume:e[r+12],fineTune:e[r+13]>127?e[r+13]-256:e[r+13],type:e[r+14],pan:e[r+15],relNote:e[r+16]>127?e[r+16]-256:e[r+16],name:aI(e,r+18,22)}),r+=i;for(let l=0;l<s;l++){const t=o[l];if(0===t.length)continue;const s=!!(16&t.type),i=s?t.length/2:t.length,c=new Float32Array(i);if(s){let a=0;for(let t=0;t<i;t++){const n=nI(e,r+2*t);a+=n>32767?n-65536:n,a>32767&&(a-=65536),a<-32768&&(a+=65536),c[t]=a/32768}r+=t.length}else{let a=0;for(let n=0;n<t.length;n++){const t=e[r+n];a+=t>127?t-256:t,a>127&&(a-=256),a<-128&&(a+=256),c[n]=a/128}r+=t.length}let u="none";1==(3&t.type)?u="forward":2==(3&t.type)&&(u="pingpong"),a.push({name:t.name||n||`Sample ${a.length+1}`,sampleRate:8363,channels:1,bitDepth:s?16:8,pcmData:c,loopStart:s?t.loopStart/2:t.loopStart,loopEnd:s?(t.loopStart+t.loopLength)/2:t.loopStart+t.loopLength,loopType:u,baseNote:"C-4",fineTune:t.fineTune,volume:t.volume})}}return{samples:a,format:"XM",title:t}}(a);case"S3M":return function(e){const t=aI(e,0,28),a=[],n=nI(e,34),s=[];for(let r=0;r<n;r++)s.push(16*nI(e,96+2*r));for(let r=0;r<n;r++){const t=s[r];if(0===t||t>=e.length)continue;if(1!==e[t])continue;const n=aI(e,t+48,28),i=nI(e,t+16)|e[t+18]<<16,o=nI(e,t+20)|e[t+22]<<16,l=nI(e,t+24)|e[t+26]<<16,c=e[t+28],u=e[t+31],d=sI(e,t+32),p=16*(e[t+13]<<16|nI(e,t+14));if(0===i||p>=e.length)continue;const m=!!(4&u),h=!!(1&u),f=i/((m?2:1)*(2&u?2:1)),y=new Float32Array(f);if(m)for(let a=0;a<f;a++){const t=nI(e,p+2*a);y[a]=(t-32768)/32768}else for(let a=0;a<f;a++){const t=e[p+a];y[a]=(t-128)/128}a.push({name:n||`Sample ${r+1}`,sampleRate:d||8363,channels:1,bitDepth:m?16:8,pcmData:y,loopStart:h?m?o/2:o:void 0,loopEnd:h?m?l/2:l:void 0,loopType:h?"forward":"none",baseNote:"C-4",volume:c})}return{samples:a,format:"S3M",title:t}}(a);case"IT":throw new Error("IT format sample extraction not yet implemented");default:throw new Error(`Unsupported format: ${n}`)}}function iI(e){const{pcmData:t,sampleRate:a,channels:n}=e,s=t.length,r=2*n,i=a*r,o=2*s,l=44+o,c=new ArrayBuffer(l),u=new DataView(c);oI(u,0,"RIFF"),u.setUint32(4,l-8,!0),oI(u,8,"WAVE"),oI(u,12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,n,!0),u.setUint32(24,a,!0),u.setUint32(28,i,!0),u.setUint16(32,r,!0),u.setUint16(34,16,!0),oI(u,36,"data"),u.setUint32(40,o,!0);let d=44;for(let h=0;h<s;h++){const e=Math.max(-1,Math.min(1,t[h])),a=Math.round(32767*e);u.setInt16(d,a,!0),d+=2}const p=new Uint8Array(c);let m="";for(let h=0;h<p.length;h++)m+=String.fromCharCode(p[h]);return`data:audio/wav;base64,${btoa(m)}`}function oI(e,t,a){for(let n=0;n<a.length;n++)e.setUint8(t+n,a.charCodeAt(n))}function lI(e,t){const a=function(e){const t={version:1,name:e.name,rows:e.length,channels:e.channels.length,data:e.channels.map(e=>e.rows)},a=JSON.stringify(t,null,2);return new Blob([a],{type:"application/json"})}(e),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=`${e.name}.xp`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}function cI(e,t,a){const n=t.channels[e];if(!n)throw new Error(`Channel ${e} not found in pattern`);const s=function(e,t){const a=t.channels[e];if(!a)throw new Error(`Channel ${e} not found in pattern`);const n={version:1,name:a.name,rows:t.length,data:a.rows},s=JSON.stringify(n,null,2);return new Blob([s],{type:"application/json"})}(e,t),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`${n.name}.xt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}const uI=({onShowExport:e,onShowHelp:t,onShowMasterFX:a,onShowInstrumentFX:n,onShowInstruments:r,onShowImportModule:i,onShowDrumpads:o,showMasterFX:l,showInstrumentFX:c,showImportModule:u})=>{const{isMobile:d,width:p}=Jk(),{patterns:m,currentPatternIndex:h,cursor:f,showGhostPatterns:y,loadPatterns:g,setPatternOrder:b,setOriginalModuleData:v,setShowGhostPatterns:x,scaleVolume:w,fadeVolume:S,remapInstrument:M}=ob(Ua(e=>({patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,cursor:e.cursor,showGhostPatterns:e.showGhostPatterns,loadPatterns:e.loadPatterns,setPatternOrder:e.setPatternOrder,setOriginalModuleData:e.setOriginalModuleData,setShowGhostPatterns:e.setShowGhostPatterns,scaleVolume:e.scaleVolume,fadeVolume:e.fadeVolume,remapInstrument:e.remapInstrument}))),{loadInstruments:N}=Bv(Ua(e=>({loadInstruments:e.loadInstruments}))),{setMetadata:C}=Xv(Ua(e=>({setMetadata:e.setMetadata}))),{setBPM:P,setSpeed:E,smoothScrolling:_,setSmoothScrolling:T,grooveTemplateId:A,swing:O,jitter:I,useMpcScale:F,stop:D}=Kv(Ua(e=>({setBPM:e.setBPM,setSpeed:e.setSpeed,smoothScrolling:e.smoothScrolling,setSmoothScrolling:e.setSmoothScrolling,grooveTemplateId:e.grooveTemplateId,swing:e.swing,jitter:e.jitter,useMpcScale:e.useMpcScale,stop:e.stop}))),{masterMuted:R,toggleMasterMute:j}=$v(Ua(e=>({masterMuted:e.masterMuted,toggleMasterMute:e.toggleMasterMute}))),B=Vv(e=>e.statusMessage),L=Vv(e=>e.pendingModuleFile),V=Vv(e=>e.setPendingModuleFile),z=Vv(e=>e.setActiveView),[U,G]=s.useState("tracker"),[W,H]=s.useState(0),[K,q]=s.useState(!1),[$,X]=s.useState(!1),[Y,Z]=s.useState(!1),[Q,J]=s.useState(!1),[ee,te]=s.useState(!1),[ae,ne]=s.useState(!1),[se,re]=s.useState(!1),[ie,oe]=s.useState(!1),[le,ce]=s.useState(!1),[ue,de]=s.useState(!1),[pe,me]=s.useState(!1),[he,fe]=s.useState(!1),[ye,ge]=s.useState(!1),[be,ve]=s.useState("block"),[xe,we]=s.useState("block"),[ke,Se]=s.useState(!1),[Me,Ne]=s.useState(0),[Ce,Pe]=s.useState(!1),_e=u??ue,Te=i??de,[Oe,Ie]=s.useState(!0),[Fe,De]=s.useState(!1),[Re,je]=s.useState(!1),{fps:Be,averageFps:Le,quality:Ve}={fps:60,averageFps:60,quality:Vv(e=>e.performanceQuality)};s.useEffect(()=>{"grid"===U&&requestAnimationFrame(()=>{H(f.channelIndex)})},[U,f.channelIndex]);const ze=s.useCallback(e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return!e.ctrlKey&&!e.metaKey||"i"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"h"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"f"!==e.key.toLowerCase()||e.shiftKey||e.altKey?!e.ctrlKey&&!e.metaKey||"o"!==e.key.toLowerCase()||e.shiftKey||e.altKey?"?"!==e.key||e.ctrlKey||e.metaKey||e.altKey?!e.ctrlKey&&!e.metaKey||"e"!==e.key.toLowerCase()||e.shiftKey||e.altKey?(e.ctrlKey||e.metaKey)&&"h"===e.key.toLowerCase()&&e.shiftKey&&!e.altKey?(e.preventDefault(),void re(e=>!e)):!e.ctrlKey&&!e.metaKey||"m"!==e.key.toLowerCase()||e.shiftKey||e.altKey?void 0:(e.preventDefault(),void oe(e=>!e)):(e.preventDefault(),void ne(e=>!e)):(e.preventDefault(),void J(e=>!e)):(e.preventDefault(),void Te(!0)):(e.preventDefault(),void Z(!0)):(e.preventDefault(),void X(!0)):(e.preventDefault(),void q(!0))},[Te,q,X,Z]);s.useEffect(()=>(window.addEventListener("keydown",ze),()=>window.removeEventListener("keydown",ze)),[ze]),s.useEffect(()=>{L&&Te(!0)},[L,Te]),(()=>{const{cursor:e,patterns:t,currentPatternIndex:a,selection:n,currentOctave:r,recordMode:i,editStep:o,insertMode:l,multiRecEnabled:c,multiEditEnabled:u,recReleaseEnabled:d}=ob(Ua(e=>({cursor:e.cursor,patterns:e.patterns,currentPatternIndex:e.currentPatternIndex,selection:e.selection,currentOctave:e.currentOctave,recordMode:e.recordMode,editStep:e.editStep,insertMode:e.insertMode,multiRecEnabled:e.multiRecEnabled,multiEditEnabled:e.multiEditEnabled,recReleaseEnabled:e.recReleaseEnabled}))),p=ob(e=>e.moveCursor),m=ob(e=>e.moveCursorToRow),h=ob(e=>e.moveCursorToChannel),f=ob(e=>e.moveCursorToColumn),y=ob(e=>e.setCell),g=ob(e=>e.clearCell),b=ob(e=>e.setCurrentPattern),v=ob(e=>e.startSelection),x=ob(e=>e.endSelection),w=ob(e=>e.clearSelection),k=ob(e=>e.copySelection),S=ob(e=>e.cutSelection),M=ob(e=>e.paste),N=ob(e=>e.pasteMix),C=ob(e=>e.pasteFlood),P=ob(e=>e.pastePushForward),E=ob(e=>e.setCurrentOctave),_=ob(e=>e.transposeSelection),T=ob(e=>e.toggleRecordMode),A=ob(e=>e.setEditStep),O=ob(e=>e.writeMacroSlot),I=ob(e=>e.readMacroSlot),F=ob(e=>e.toggleInsertMode),D=ob(e=>e.setKeyOn),R=ob(e=>e.setKeyOff),j=ob(e=>e.findBestChannel),B=ob(e=>e.insertRow),L=ob(e=>e.deleteRow),V=ob(e=>e.setPtnJumpPos),z=ob(e=>e.getPtnJumpPos),U=ob(e=>e.interpolateSelection),{isPlaying:G,currentRow:W,stop:H,play:K,setIsLooping:q}=Kv(Ua(e=>({isPlaying:e.isPlaying,currentRow:e.currentRow,stop:e.stop,play:e.play,setIsLooping:e.setIsLooping}))),{instruments:$,currentInstrumentId:X,setCurrentInstrument:Y}=Bv(),Z=t[a],Q=s.useRef(new Map),J=s.useRef(0),ee=s.useCallback(()=>u&&i&&!G||c&&i&&G?j():e.channelIndex,[e.channelIndex,i,G,u,c,j]),te=s.useCallback((e,t,a)=>{if(null===X)return;const n=Qg(),s=$.find(e=>e.id===X);if(!s)return;const r=`${e}${t}`,i=Qn(`${e}-${t}`);if(Q.current.has(a))return;const o=Q.current.size>0,l="TB303"===s.synthType||"Buzz3o3"===s.synthType,c=o&&l,u=!1,d=ee(),{midiPolyphonic:p}=Hg.getState();p?n.triggerPolyNoteAttack(X,r,1,s,u,c):n.triggerNoteAttack(X,r,0,1,s,void 0,u,c),Q.current.set(a,{note:r,xmNote:i,instrumentId:X,channelIndex:d}),D(d,i)},[X,$,ee,D]),ae=s.useCallback(e=>{const t=Q.current.get(e);if(!t)return;const a=Qg(),n=$.find(e=>e.id===t.instrumentId),{midiPolyphonic:s}=Hg.getState();s&&n?a.triggerPolyNoteRelease(t.instrumentId,t.note,n):a.releaseNote(t.instrumentId,t.note),R(t.channelIndex),d&&i&&G&&y(t.channelIndex,W,{note:97}),Q.current.delete(e)},[$,R,d,i,G,y,W]),ne=s.useCallback((t,a,n)=>{const s=Qn(`${t}-${a}`);if(0===s)return;const r=void 0!==n?n:ee(),c=i&&G?W:e.rowIndex;if(l&&!G&&B(r,c),y(r,c,{note:s,instrument:null!==X?X:void 0}),Vv.getState().chordEntryMode&&!G&&void 0===n){const t=Z.channels.length,a=e.channelIndex+1;if(a<t)return void h(a)}o>0&&!G&&m((e.rowIndex+o)%Z.length)},[e,y,i,o,Z,m,h,G,W,l,B,ee,X]),se=s.useCallback(()=>{B(e.channelIndex,e.rowIndex)},[e,B]),re=s.useCallback(()=>{L(e.channelIndex,e.rowIndex)},[e,L]),ie=s.useCallback(s=>{if(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement||s.target instanceof HTMLSelectElement)return;if(document.querySelector(".fixed.inset-0.z-50"))return;const l=s.key,c=l.toLowerCase();if("F9"===l){if(s.preventDefault(),s.shiftKey)V(0,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=z(0);m(e),G&&H(),q(!1),Qg().init().then(()=>K())}else m(0);return}if("F10"===l){if(s.preventDefault(),s.shiftKey)V(1,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=z(1);m(e),G&&H(),q(!1),Qg().init().then(()=>K())}else m(Math.floor(.25*Z.length));return}if("F11"===l){if(s.preventDefault(),s.shiftKey)V(2,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=z(2);m(e),G&&H(),q(!1),Qg().init().then(()=>K())}else m(Math.floor(.5*Z.length));return}if("F12"===l){if(s.preventDefault(),s.shiftKey)V(3,e.rowIndex);else if(s.ctrlKey||s.metaKey){const e=z(3);m(e),G&&H(),q(!1),Qg().init().then(()=>K())}else m(Math.floor(.75*Z.length));return}if("PageUp"===l)return s.preventDefault(),void m(Math.max(0,e.rowIndex-16));if("PageDown"===l)return s.preventDefault(),void m(Math.min(Z.length-1,e.rowIndex+16));if("Home"===l)return s.preventDefault(),void m(0);if("End"===l)return s.preventDefault(),void m(Z.length-1);if("Tab"===l)return s.preventDefault(),s.shiftKey?"note"===e.columnType&&(e.channelIndex>0?h(e.channelIndex-1):h(Z.channels.length-1)):e.channelIndex<Z.channels.length-1?h(e.channelIndex+1):h(0),void f("note");if(s.altKey&&void 0!==TM[c]){s.preventDefault();const e=TM[c]%Z.channels.length;return h(e),void f("note")}if(s.altKey&&void 0!==AM[c]){s.preventDefault();const e=AM[c]%Z.channels.length;return h(e),void f("note")}if((s.ctrlKey||s.metaKey)&&l>="1"&&l<="8"&&!s.altKey){s.preventDefault();const e=parseInt(l)-1;return void(s.shiftKey?O(e):I(e))}if("Insert"===l)return s.preventDefault(),void(i?(s.shiftKey,se()):F());if(i&&(s.ctrlKey||s.metaKey)&&"ArrowUp"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?_(12):_(1));if(i&&(s.ctrlKey||s.metaKey)&&"ArrowDown"===l&&!s.altKey)return s.preventDefault(),void(s.shiftKey?_(-12):_(-1));if("ArrowUp"===l)return s.preventDefault(),void(s.altKey||s.shiftKey?(n||v(),p("up"),x()):p("up"));if("ArrowDown"===l)return s.preventDefault(),void(s.altKey||s.shiftKey?(n||v(),p("down"),x()):p("down"));if("ArrowLeft"===l)return s.preventDefault(),void(s.altKey||s.shiftKey?(n||v(),p("left"),x()):p("left"));if("ArrowRight"===l)return s.preventDefault(),void(s.altKey||s.shiftKey?(n||v(),p("right"),x()):p("right"));if("Delete"===l&&i)return s.preventDefault(),s.shiftKey?y(e.channelIndex,e.rowIndex,{note:0,instrument:0,volume:0,effTyp:0,eff:0}):s.ctrlKey||s.metaKey?y(e.channelIndex,e.rowIndex,{volume:0,effTyp:0,eff:0}):s.altKey?y(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"note"===e.columnType?y(e.channelIndex,e.rowIndex,{note:0,instrument:0}):"instrument"===e.columnType?y(e.channelIndex,e.rowIndex,{instrument:0}):"volume"===e.columnType?y(e.channelIndex,e.rowIndex,{volume:0}):"effTyp"===e.columnType||"effParam"===e.columnType?y(e.channelIndex,e.rowIndex,{effTyp:0,eff:0}):"effTyp2"===e.columnType||"effParam2"===e.columnType?y(e.channelIndex,e.rowIndex,{effTyp2:0,eff2:0}):"probability"===e.columnType?y(e.channelIndex,e.rowIndex,{probability:void 0}):g(e.channelIndex,e.rowIndex),void(o>0&&!G&&m((e.rowIndex+o)%Z.length));if("Backspace"===l&&i)return s.preventDefault(),void(s.shiftKey?e.rowIndex>0&&(p("up"),re()):e.rowIndex>0&&(p("up"),g(e.channelIndex,e.rowIndex)));if("F3"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&S());if("F4"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&k());if("F5"===l)return s.preventDefault(),void((s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)&&M());if((s.ctrlKey||s.metaKey)&&"c"===c&&!s.altKey)return s.preventDefault(),k(),void Vv.getState().setStatusMessage("COPY");if((s.ctrlKey||s.metaKey)&&"x"===c&&!s.altKey)return s.preventDefault(),S(),void Vv.getState().setStatusMessage("CUT");if((s.ctrlKey||s.metaKey)&&"v"===c&&!s.altKey)return s.preventDefault(),void(s.shiftKey?(N(),Vv.getState().setStatusMessage("MIX PASTE")):(M(),Vv.getState().setStatusMessage("PASTE")));if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"f"===c)return s.preventDefault(),void C();if((s.ctrlKey||s.metaKey)&&s.shiftKey&&"i"===c)return s.preventDefault(),void P();if(!("i"!==c||s.ctrlKey||s.metaKey||s.altKey||s.shiftKey)){if(s.preventDefault(),n&&"volume"===e.columnType){const t=Math.min(n.startRow,n.endRow),a=Math.max(n.startRow,n.endRow),s=e.channelIndex,r=Z.channels[s].rows[t],i=Z.channels[s].rows[a],o=r.volume||0,l=i.volume||64;U("volume",o,l,"linear"),Vv.getState().setStatusMessage(`INTERPOLATE: ${o}  ${l}`)}else"volume"===e.columnType?Vv.getState().setStatusMessage("SELECT VOLUME RANGE FIRST"):Vv.getState().setStatusMessage("INTERPOLATE: VOLUME COLUMN ONLY");return}if((s.ctrlKey||s.metaKey)&&"h"===c&&!s.altKey){if(s.preventDefault(),"note"===e.columnType){const t=Z.channels[e.channelIndex].rows[e.rowIndex];if(t.note&&t.note>0&&t.note<97){const a=t.note,n=a+4,s=a+7;e.channelIndex+2<Z.channels.length?(y(e.channelIndex+1,e.rowIndex,{note:n,instrument:t.instrument}),y(e.channelIndex+2,e.rowIndex,{note:s,instrument:t.instrument}),Vv.getState().setStatusMessage("CHORD: MAJOR")):Vv.getState().setStatusMessage("CHORD: NOT ENOUGH CHANNELS")}else Vv.getState().setStatusMessage("CHORD: NO NOTE")}return}if("Escape"===l){s.preventDefault();const e=Date.now();return void(e-J.current<500?(Qg().releaseAll(),Vv.getState().setStatusMessage("PANIC - ALL NOTES OFF"),J.current=0):(w(),J.current=e))}if("Shift"===s.key&&2===s.location)return s.preventDefault(),i||T(),G&&H(),q(!1),void Qg().init().then(()=>K());if("Control"===s.key&&2===s.location)return s.preventDefault(),G&&H(),q(!1),void Qg().init().then(()=>K());if("Alt"===s.key&&2===s.location)return s.preventDefault(),G&&H(),q(!0),void Qg().init().then(()=>K());if(" "===l){if(s.preventDefault(),G)qS().stop(),H(),Qg().releaseAll(),Vv.getState().setStatusMessage("STOPPED");else{T();const e=ob.getState().recordMode;Vv.getState().setStatusMessage(e?"RECORD ON":"RECORD OFF")}return}if("Enter"===l&&(s.ctrlKey||s.metaKey))return s.preventDefault(),G&&H(),q(!1),Qg().init().then(()=>K()),void Vv.getState().setStatusMessage("PLAYING");if("CapsLock"===l){if(s.preventDefault(),"note"===e.columnType){const t=i&&G?W:e.rowIndex;y(e.channelIndex,t,{note:97}),o>0&&!G&&m((e.rowIndex+o)%Z.length)}return}if(l>="F1"&&l<="F7"){s.preventDefault();const e=parseInt(l.substring(1));return E(e),void Vv.getState().setStatusMessage(`OCTAVE ${e}`)}if("`"===l||"~"===l){let e;return s.preventDefault(),e=s.shiftKey?0===o?16:o-1:16===o?0:o+1,A(e),void Vv.getState().setStatusMessage(`EDIT STEP ${e}`)}if("NumpadAdd"===s.code||"+"===l&&!s.shiftKey&&3===s.location)return s.preventDefault(),void(r<7&&E(r+1));if("NumpadSubtract"===s.code||"-"===l&&3===s.location)return s.preventDefault(),void(r>1&&E(r-1));if(s.shiftKey&&"ArrowLeft"===l)return s.preventDefault(),void(a>0&&b(a-1));if(s.shiftKey&&"ArrowRight"===l)return s.preventDefault(),void(a<t.length-1&&b(a+1));if(s.shiftKey&&"ArrowUp"===l){if(s.preventDefault(),null!==X&&X>0){const e=$.find(e=>e.id===X-1);e&&Y(e.id)}return}if(s.shiftKey&&"ArrowDown"===l){if(s.preventDefault(),null!==X){const e=$.find(e=>e.id===X+1);e&&Y(e.id)}return}if(_M[c]&&!s.altKey&&!s.ctrlKey&&!s.metaKey&&!s.repeat&&"note"===e.columnType){s.preventDefault();const{note:e,octaveOffset:t}=_M[c],a=r+t;if(te(e,a,c),i){const t=Q.current.get(c),n=t?.channelIndex;ne(e,a,n)}return}if(_M[c]&&s.repeat&&"note"===e.columnType){if(s.preventDefault(),i&&!G){const{note:e,octaveOffset:t}=_M[c],a=r+t,n=Q.current.get(c);ne(e,a,n?.channelIndex)}return}const u=Z.channels[e.channelIndex].rows[e.rowIndex];if(i&&"instrument"===e.columnType&&OM.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),a=u.instrument||0;let n;return n=0===e.digitIndex?t<<4|15&a:240&a|t,n>128&&(n=128),y(e.channelIndex,e.rowIndex,{instrument:n}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}if(i&&"volume"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=u.volume||0;if(0===e.digitIndex){const a=IM[c];if(void 0!==a){s.preventDefault();let n=a<<4|15&t;return n>=81&&n<=95&&(n=80),y(e.channelIndex,e.rowIndex,{volume:n}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}}else if(OM.includes(l)){s.preventDefault();const a=parseInt(l,16);let n;return n=t<16?16+a:240&t|a,n>=81&&n<=95&&(n=80),y(e.channelIndex,e.rowIndex,{volume:n}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}}if(i&&"effTyp"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=FM[c];if(void 0!==t)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{effTyp:t}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}if(i&&"effParam"===e.columnType&&OM.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),a=u.eff||0;let n;return n=0===e.digitIndex?t<<4|15&a:240&a|t,y(e.channelIndex,e.rowIndex,{eff:n}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}if(i&&"effTyp2"===e.columnType&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=FM[c];if(void 0!==t)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{effTyp2:t}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}if(i&&("flag1"===e.columnType||"flag2"===e.columnType)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){const t=e.columnType;if("a"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:1}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length));if("s"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:2}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length));if("m"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:3}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length));if("h"===c)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:4}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length));if("0"===l||"."===l)return s.preventDefault(),y(e.channelIndex,e.rowIndex,{[t]:0}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}if(i&&"effParam2"===e.columnType&&OM.includes(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,16),a=u.eff2||0;let n;return n=0===e.digitIndex?t<<4|15&a:240&a|t,y(e.channelIndex,e.rowIndex,{eff2:n}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}if(i&&"probability"===e.columnType&&/^[0-9]$/.test(l)&&!s.altKey&&!s.ctrlKey&&!s.metaKey){s.preventDefault();const t=parseInt(l,10),a=u.probability||0;let n;return n=0===e.digitIndex?10*t+a%10:10*Math.floor(a/10)+t,n=Math.min(99,Math.max(0,n)),y(e.channelIndex,e.rowIndex,{probability:n}),void(o>0&&!G&&m((e.rowIndex+o)%Z.length))}},[e,Z,t,a,G,W,r,X,$,n,i,T,o,A,p,m,h,f,y,g,b,Y,H,K,v,x,w,k,S,M,N,C,P,te,ne,se,re,_,V,z,I,O,E,F]),oe=s.useCallback(e=>{const t=e.key.toLowerCase();_M[t]&&ae(t)},[ae]);s.useEffect(()=>(window.addEventListener("keydown",ie,{capture:!0}),window.addEventListener("keyup",oe,{capture:!0}),()=>{window.removeEventListener("keydown",ie,{capture:!0}),window.removeEventListener("keyup",oe,{capture:!0})}),[ie,oe])})();const Ue=(()=>{const{cursor:e,selection:t,clipboard:a,patterns:n,currentPatternIndex:r,startSelection:i,endSelection:o,clearSelection:l,copySelection:c,cutSelection:u,paste:d,setCell:p}=ob(),[m,h]=s.useState({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}),f=n[r],y=s.useCallback(()=>{i(),h(e=>({...e,blockStartMarked:!0,blockEndMarked:!1,isBlockSelected:!1}))},[i,e]),g=s.useCallback(()=>{o(),h(e=>({...e,blockEndMarked:!0,isBlockSelected:!0}))},[o,e]),b=s.useCallback(()=>{t&&c()},[t,c]),v=s.useCallback(()=>{a&&d()},[a,d,e]),x=s.useCallback(()=>{t&&(u(),h({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1}))},[t,u]),w=s.useCallback(()=>{l(),h({blockStartMarked:!1,blockEndMarked:!1,isBlockSelected:!1})},[l]),k=s.useCallback(()=>t?{startChannel:Math.min(t.startChannel,t.endChannel),endChannel:Math.max(t.startChannel,t.endChannel),startRow:Math.min(t.startRow,t.endRow),endRow:Math.max(t.startRow,t.endRow)}:null,[t]),S=s.useCallback((e,t)=>{const a=k();return!!a&&e>=a.startChannel&&e<=a.endChannel&&t>=a.startRow&&t<=a.endRow},[k]),M=s.useCallback(e=>{const t=k();if(t)for(let a=t.startChannel;a<=t.endChannel;a++)for(let n=t.startRow;n<=t.endRow;n++){const t=f.channels[a].rows[n];if(t.note&&0!==t.note&&97!==t.note){const s=ss(t.note);if(null!==s){const t=s+e;if(t>=12&&t<=107){const e=rs(t);p(a,n,{note:e})}}}}},[k,f,p]),N=s.useCallback(e=>{const t=k();if(t)for(let a=t.startChannel;a<=t.endChannel;a++)for(let n=t.startRow;n<=t.endRow;n++){const t=f.channels[a].rows[n];if(null!==t.volume){const s=Math.min(64,Math.max(0,Math.round(t.volume*e)));p(a,n,{volume:s})}}},[k,f,p]),C=s.useCallback(e=>{const t=k();if(t)for(let a=t.startChannel;a<=t.endChannel;a++){const n=f.channels[a].rows[t.startRow],s=f.channels[a].rows[t.endRow],r=n[e]||0,i=s[e]||0,o=t.endRow-t.startRow;if(!(o<=1))for(let l=1;l<o;l++){const n=l/o,s=Math.round(r+(i-r)*n),c=t.startRow+l;p(a,c,{[e]:s})}}},[k,f,p]),P=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const a=[];for(let n=e.startChannel;n<=e.endChannel;n++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[n].rows[a]});a.push(t)}for(let n=e.startChannel;n<=e.endChannel;n++){const s=n-e.startChannel;for(let r=0;r<t;r++){const i=a[s][t-1-r];p(n,e.startRow+r,{note:i.note,instrument:i.instrument,volume:i.volume,effTyp:i.effTyp,eff:i.eff,effTyp2:i.effTyp2,eff2:i.eff2,flag1:i.flag1,flag2:i.flag2})}}},[k,f,p]),E=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,a=f.channels[0]?.rows.length||64,n=[];for(let s=e.startChannel;s<=e.endChannel;s++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[s].rows[a]});n.push(t)}for(let s=e.startChannel;s<=e.endChannel;s++){const r=s-e.startChannel;for(let i=0;i<2*t;i++){const t=e.startRow+i;if(t>=a)break;if(i%2==0){const e=n[r][i/2];p(s,t,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(s,t,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}e.startRow},[k,f,p]),_=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1;if(t<2)return;const a=[];for(let n=e.startChannel;n<=e.endChannel;n++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[n].rows[a]});a.push(t)}for(let n=e.startChannel;n<=e.endChannel;n++){const s=n-e.startChannel;for(let r=0;r<t;r++){const i=e.startRow+r,o=2*r;if(o<t){const e=a[s][o];p(n,i,{note:e.note,instrument:e.instrument,volume:e.volume,effTyp:e.effTyp,eff:e.eff,effTyp2:e.effTyp2,eff2:e.eff2,flag1:e.flag1,flag2:e.flag2})}else p(n,i,{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0,flag1:0,flag2:0})}}},[k,f,p]),T=s.useCallback((e,t,a)=>{const n=k();if(n)for(let s=n.startChannel;s<=n.endChannel;s++)for(let r=n.startRow;r<=n.endRow;r++){const n=f.channels[s].rows[r][a];if(0===n&&"volume"===a)continue;let i;switch(e){case"add":i=n+t;break;case"sub":i=n-t;break;case"mul":i=Math.round(n*t);break;case"div":i=0!==t?Math.round(n/t):n}const o="volume"===a?80:255;i=Math.max(0,Math.min(o,i)),p(s,r,{[a]:i})}},[k,f,p]),A=s.useCallback(()=>{const e=k();if(!e)return;const t=e.endRow-e.startRow+1,a=f.channels[0]?.rows.length||64,n=[];for(let r=e.startChannel;r<=e.endChannel;r++){const t=[];for(let a=e.startRow;a<=e.endRow;a++)t.push({...f.channels[r].rows[a]});n.push(t)}let s=e.endRow+1;for(;s<a;){for(let a=e.startChannel;a<=e.endChannel;a++){const r=a-e.startChannel,i=(s-e.endRow-1)%t,o=n[r][i];p(a,s,{note:o.note,instrument:o.instrument,volume:o.volume,effTyp:o.effTyp,eff:o.eff,effTyp2:o.effTyp2,eff2:o.eff2,flag1:o.flag1,flag2:o.flag2})}s++}},[k,f,p]);return s.useEffect(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))return e.altKey&&"b"===e.key.toLowerCase()?(e.preventDefault(),void y()):e.altKey&&"e"===e.key.toLowerCase()?(e.preventDefault(),void g()):e.altKey&&"c"===e.key.toLowerCase()?(e.preventDefault(),void b()):!e.altKey||"v"!==e.key.toLowerCase()&&"p"!==e.key.toLowerCase()?e.altKey&&"x"===e.key.toLowerCase()?(e.preventDefault(),void x()):"Escape"===e.key&&t?(e.preventDefault(),void w()):e.altKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(1)):e.altKey&&e.shiftKey&&"t"===e.key.toLowerCase()?(e.preventDefault(),void M(-1)):!e.altKey||"r"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?!e.altKey||"d"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey?void 0:(e.preventDefault(),void A()):(e.preventDefault(),void P()):(e.preventDefault(),void v())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[y,g,b,v,x,w,M,P,A,t]),{blockState:m,selection:t,clipboard:a,markBlockStart:y,markBlockEnd:g,copyBlock:b,pasteBlock:v,cutBlock:x,clearBlock:w,isCellInBlock:S,getBlockBounds:k,transposeBlock:M,amplifyBlock:N,interpolateBlock:C,reverseBlock:P,expandBlock:E,shrinkBlock:_,mathBlock:T,duplicateBlock:A}})();WM();const Ge=s.useCallback(async(e,t)=>{const{useLibopenmpt:a}=t;if(Qg().releaseAll(),e.nativeData){const{format:t,importMetadata:n,instruments:s,patterns:r}=e.nativeData;let o;if("XM"===t)o=UT(r,n.originalChannelCount,n,s.map(e=>e.name),a?e.arrayBuffer:void 0);else if("MOD"===t)o=GT(r,n.originalChannelCount,n,s.map(e=>e.name),a?e.arrayBuffer:void 0);else if("FUR"===t||"DMF"===t){const e=n.modData?.patternOrderTable||[],t=r[0]?.length||64,a=n.originalChannelCount||r[0]?.[0]?.length||4;o={patterns:r.map((e,s)=>({id:`pattern-${s}`,name:`Pattern ${s}`,length:t,importMetadata:n,channels:Array.from({length:a},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[a]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:t.effectType2||0,eff2:t.effectParam2||0}})}))})),order:e.length>0?e:[0],instrumentNames:s.map(e=>e.name)}}else o=GT(r,n.originalChannelCount,n,s.map(e=>e.name),a?e.arrayBuffer:void 0);if(0===o.patterns.length)return void px.error(`Module "${e.metadata.title}" contains no patterns to import.`);const l=[];let c=1;for(let e=0;e<s.length;e++){const a=HT(s[e],c,t);l.push(...a),c+=a.length}D();try{const e=k(),t=e.rawContext||e._context;if(t&&"running"!==t.state){await e.resume();let a=0;for(;"running"!==t.state&&a<20;)await new Promise(e=>setTimeout(e,50)),a++}}catch(i){}N(l),g(o.patterns),o.order&&o.order.length>0&&b(o.order),o.originalModuleData?v(o.originalModuleData):v(null),C({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"} (${t})`}),P(n.modData?.initialBPM||125),E(n.modData?.initialSpeed||6);return l.filter(e=>"Sampler"===e.synthType).length>0&&await Qg().preloadInstruments(l),void px.success(`Imported "${e.metadata.title}" - ${o.patterns.length} patterns, ${l.length} instruments`)}if(!e.metadata.song)return void px.error(`Module "${e.metadata.title}" loaded but no pattern data found.`);const n=zT(e.metadata.song);if(0===n.patterns.length)return void px.error(`Module "${e.metadata.title}" contains no patterns to import.`);let s;if(e.file&&function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return[".mod",".xm",".s3m"].includes(t)}(e.file.name))try{const t=await rI(e.file);s=new Map;for(let e=0;e<t.samples.length;e++){const a=t.samples[e];if(a.pcmData.length>0){const t=iI(a);s.set(e+1,t)}}}catch(i){}const r=function(e,t,a){const n=new Set;for(const i of e)for(const e of i.channels)for(const t of e.rows)null!==t.instrument&&t.instrument>0&&n.add(t.instrument);const s=[],r=["sawtooth","square","triangle","sine"];for(const i of Array.from(n).sort((e,t)=>e-t)){const e=t[i-1]||`Instrument ${i}`,n=a?.get(i);if(n)s.push({id:i,name:e.trim()||`Sample ${i}`,type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:n}});else{const t=r[(i-1)%r.length];s.push({id:i,name:e.trim()||`Instrument ${i}`,type:"synth",synthType:"Synth",oscillator:{...Wn,type:t},envelope:{...Hn},filter:{...Kn},effects:[],volume:-6,pan:0})}}for(const i of[0,1])if(!n.has(i)){const e=a?.get(i);e?s.push({id:i,name:0===i?"Default":"Sample 01",type:"sample",synthType:"Sampler",effects:[],volume:-6,pan:0,parameters:{sampleUrl:e}}):s.push({id:i,name:0===i?"Default":"Instrument 01",type:"synth",synthType:"Synth",oscillator:{...Wn,type:"sawtooth"},envelope:{...Hn},filter:{...Kn},effects:[],volume:-6,pan:0})}return s.sort((e,t)=>e.id-t.id),s}(n.patterns,n.instrumentNames,s);N(r),g(n.patterns),n.order&&n.order.length>0&&b(n.order),C({name:e.metadata.title,author:"",description:`Imported from ${e.file?.name||"module"}`}),P(125);r.filter(e=>"Sampler"===e.synthType).length>0&&await Qg().preloadInstruments(r),px.success(`Imported "${e.metadata.title}" - ${n.patterns.length} patterns, ${r.length} instruments`)},[N,g,C,P,E,b,v]),We=s.useCallback(e=>{Ne(e),Se(!0)},[]),He=m[h];return d?Ea.jsxs(Ea.Fragment,{children:[Ea.jsx(PO,{onShowExport:e,onShowHelp:t,onShowMasterFX:a,onShowInstruments:r,showMasterFX:l}),Ea.jsx(YM,{isOpen:K,onClose:()=>q(!1)}),Ea.jsx(ZM,{isOpen:$,onClose:()=>X(!1)}),Ea.jsx(QM,{isOpen:Y,onClose:()=>Z(!1)}),Ea.jsx(p_,{isOpen:Q,onClose:()=>J(!1)}),Ea.jsx(l_,{isOpen:ee,onClose:()=>te(!1)}),Ea.jsx(N_,{isOpen:ae,onSelect:(e,t)=>{const{cursor:a,setCell:n}=ob.getState();n(a.channelIndex,a.rowIndex,{effTyp:e,eff:t}),ne(!1)},onClose:()=>ne(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:a}=ob.getState(),n=t[a];if(!n)return;const s=n.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Bv.getState().getInstrument(s.instrument);return r?.synthType})()}),Ea.jsx(E_,{isOpen:se,onClose:()=>re(!1)}),Ea.jsx(__,{isOpen:ie,onClose:()=>oe(!1)}),Ea.jsx(n_,{isOpen:_e,onClose:()=>{Te(!1),V(null)},onImport:Ge,initialFile:L}),pe&&Ea.jsx(s_,{scope:be,onConfirm:e=>{w(be,e),me(!1)},onCancel:()=>me(!1)}),he&&Ea.jsx(r_,{scope:be,onConfirm:(e,t)=>{S(be,e,t),fe(!1)},onCancel:()=>fe(!1)}),ye&&Ea.jsx(i_,{scope:xe,onConfirm:(e,t)=>{M(e,t,xe),ge(!1)},onCancel:()=>ge(!1)}),ke&&Ea.jsx(MM,{channelIndex:Me,onClose:()=>Se(!1)})]}):Ea.jsxs("div",{className:"flex-1 min-h-0 flex flex-col bg-dark-bg overflow-y-hidden",children:[Ea.jsx("div",{className:"flex-shrink min-h-[80px]",children:Ea.jsx(XA,{onShowExport:e,onShowHelp:t,onShowMasterFX:a,onShowInstrumentFX:n,onShowInstruments:r,onShowPatternOrder:()=>Pe(!0),onShowDrumpads:o,showMasterFX:l,showInstrumentFX:c})}),"tb303"!==U&&Ea.jsx("div",{className:"flex-shrink-0",children:Ea.jsx(sO,{})}),Ea.jsxs("div",{className:"flex-shrink flex items-center justify-between px-2 py-1 bg-dark-bgTertiary border-b border-dark-border min-h-[28px]",children:[Ea.jsxs("div",{className:"flex items-center gap-2",children:[Ea.jsxs("div",{className:"flex items-center gap-1",children:["tracker"===U&&Ea.jsx(Je,{size:14,className:"text-text-secondary"}),"grid"===U&&Ea.jsx(et,{size:14,className:"text-text-secondary"}),"pianoroll"===U&&Ea.jsx(oa,{size:14,className:"text-text-secondary"}),"tb303"===U&&Ea.jsx(Ee,{size:14,className:"text-text-secondary"}),Ea.jsxs("select",{value:U,onChange:e=>{const t=e.target.value;"arrangement"===t?z("arrangement"):G(t)},className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",title:"Select editor view",children:[Ea.jsx("option",{value:"tracker",children:"Tracker"}),Ea.jsx("option",{value:"grid",children:"Grid"}),Ea.jsx("option",{value:"pianoroll",children:"Piano Roll"}),Ea.jsx("option",{value:"tb303",children:"TB-303"}),Ea.jsx("option",{value:"arrangement",children:"Arrangement"})]})]}),("grid"===U||"pianoroll"===U)&&He&&Ea.jsxs(Ea.Fragment,{children:[Ea.jsx("span",{className:"text-text-secondary text-[10px] font-medium",children:"CH:"}),Ea.jsx("select",{value:W,onChange:e=>H(Number(e.target.value)),className:"px-2 py-1 text-xs bg-dark-bgSecondary text-text-primary border border-dark-border rounded hover:bg-dark-bgHover transition-colors",children:He.channels.map((e,t)=>Ea.jsx("option",{value:t,children:(t+1).toString().padStart(2,"0")},t))})]}),"tracker"===U&&Ea.jsxs("button",{onClick:()=>x(!y),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${y?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:y?"Hide ghost patterns":"Show ghost patterns",children:[y?Ea.jsx(yt,{size:12}):Ea.jsx(ft,{size:12}),Ea.jsx("span",{children:"Ghosts"})]}),"tracker"===U&&Ea.jsxs("button",{onClick:()=>De(!Fe),className:`\n                flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors\n                ${Fe?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n              `,title:"Toggle Advanced Edit Panel",children:[Ea.jsx(Ae,{size:12}),Ea.jsx("span",{children:"Edit"})]}),"tracker"===U&&Ea.jsxs("button",{onClick:()=>je(!0),className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Automation Editor",children:[Ea.jsx(rt,{size:12}),Ea.jsx("span",{children:"Auto"})]}),Ea.jsxs("button",{onClick:o,className:"flex items-center gap-1 px-2 py-1 text-xs rounded transition-colors bg-dark-bgSecondary text-text-secondary hover:text-text-primary",title:"Open Drumpad Editor",children:[Ea.jsx(Mt,{size:12}),Ea.jsx("span",{children:"Pads"})]}),Ea.jsx("div",{className:"w-px h-4 bg-dark-border mx-1"}),Ea.jsx("button",{onClick:j,className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${R?"bg-accent-error/20 text-accent-error":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:R?"Unmute master output":"Mute master output",children:R?"Unmute":"Mute"}),Ea.jsx("button",{onClick:()=>T(!_),className:`\n              px-2 py-1 text-xs rounded font-medium transition-colors\n              ${_?"bg-accent-primary/20 text-accent-primary":"bg-dark-bgSecondary text-text-secondary hover:text-text-primary"}\n            `,title:_?"Switch to stepped scrolling":"Switch to smooth scrolling",children:_?"Smooth":"Stepped"}),Ea.jsxs("div",{className:"flex items-center gap-1 ml-1 pl-2 border-l border-dark-border",children:[Ea.jsx("button",{onClick:()=>ce(!0),className:"px-2 py-1 text-[10px] rounded font-mono font-bold transition-colors "+("straight"!==A||O!==(F?50:100)||I>0?"bg-accent-primary/20 text-accent-primary border border-accent-primary/50":"bg-dark-bgSecondary text-text-secondary border border-dark-border hover:text-text-primary"),title:`Groove Settings (Current: ${$n.find(e=>e.id===A)?.name||"None"})`,children:"GROOVE"}),le&&Ea.jsx(pT,{onClose:()=>ce(!1)})]}),B&&Ea.jsx("div",{className:"flex items-center px-3 ml-2 pl-3 border-l border-dark-border",children:Ea.jsx("span",{className:"text-accent-primary font-bold tracking-[0.3em] text-[11px] animate-pulse font-mono",children:B.toUpperCase()})})]}),Ea.jsxs("div",{className:`\n            flex items-center gap-1 px-2 py-0.5 text-xs rounded font-mono\n            ${"low"===Ve?"bg-accent-error/20 text-accent-error":"medium"===Ve?"bg-orange-500/20 text-orange-400":"bg-green-500/20 text-green-400"}\n          `,title:`Performance: ${Ve.toUpperCase()} | Avg FPS: ${Le} | Current: ${Be}`,children:[Ea.jsx("span",{className:"font-bold",children:Le}),Ea.jsx("span",{className:"text-[10px] opacity-70",children:"FPS"}),Ea.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${"low"===Ve?"bg-accent-error":"medium"===Ve?"bg-orange-400":"bg-green-400"} animate-pulse`})]})]}),Ea.jsxs("div",{className:"flex-1 min-h-0 min-w-0 relative z-10 flex overflow-hidden",children:[Ea.jsx("div",{className:"flex-1 min-w-0 min-h-0 flex flex-col overflow-hidden",children:"tracker"===U?Ea.jsx(eM,{onAcidGenerator:We}):"grid"===U?Ea.jsx(EM,{channelIndex:W}):"pianoroll"===U?Ea.jsx(ZO,{channelIndex:W}):Ea.jsx("div",{className:"flex-1 w-full overflow-y-auto overflow-x-hidden bg-dark-bgPrimary",children:Ea.jsx(dO,{channelIndex:W})})}),p>=900&&Ea.jsx("button",{onClick:()=>Ie(!Oe),className:`\n              flex-shrink-0 w-6 flex items-center justify-center\n              bg-ft2-header border-l border-ft2-border\n              hover:bg-ft2-border transition-colors\n              ${Oe?"text-ft2-highlight":"text-ft2-textDim"}\n            `,title:Oe?"Hide Instruments":"Show Instruments",children:Ea.jsx(Kt,{size:14,className:Oe?"":"rotate-180"})}),p>=900&&Oe&&Ea.jsx("div",{className:"flex-shrink-0 w-fit min-w-48 max-w-80 border-l border-ft2-border flex flex-col overflow-hidden animate-fade-in",children:Ea.jsx(bO,{variant:"ft2",showPreviewOnClick:!0,showPresetButton:!0,showSamplePackButton:!0,showEditButton:!0,onEditInstrument:r})})]}),Ea.jsx(YM,{isOpen:K,onClose:()=>q(!1)}),Ea.jsx(ZM,{isOpen:$,onClose:()=>X(!1)}),Ea.jsx(QM,{isOpen:Y,onClose:()=>Z(!1)}),Ea.jsx(p_,{isOpen:Q,onClose:()=>J(!1)}),Ea.jsx(l_,{isOpen:ee,onClose:()=>te(!1)}),Ea.jsx(N_,{isOpen:ae,onSelect:(e,t)=>{const{cursor:a,setCell:n}=ob.getState();n(a.channelIndex,a.rowIndex,{effTyp:e,eff:t}),ne(!1)},onClose:()=>ne(!1),synthType:(()=>{const{cursor:e,patterns:t,currentPatternIndex:a}=ob.getState(),n=t[a];if(!n)return;const s=n.channels[e.channelIndex]?.rows[e.rowIndex];if(!s?.instrument)return;const r=Bv.getState().getInstrument(s.instrument);return r?.synthType})()}),Ea.jsx(E_,{isOpen:se,onClose:()=>re(!1)}),Ea.jsx(__,{isOpen:ie,onClose:()=>oe(!1)}),Ea.jsx(n_,{isOpen:_e,onClose:()=>{Te(!1),V(null)},onImport:Ge,initialFile:L}),pe&&Ea.jsx(s_,{scope:be,onConfirm:e=>{w(be,e),me(!1)},onCancel:()=>me(!1)}),he&&Ea.jsx(r_,{scope:be,onConfirm:(e,t)=>{S(be,e,t),fe(!1)},onCancel:()=>fe(!1)}),ye&&Ea.jsx(i_,{scope:xe,onConfirm:(e,t)=>{M(e,t,xe),ge(!1)},onCancel:()=>ge(!1)}),Ce&&Ea.jsx(o_,{onClose:()=>Pe(!1)}),Fe&&Ea.jsx(u_,{onClose:()=>De(!1),onShowScaleVolume:e=>{ve(e),me(!0)},onShowFadeVolume:e=>{ve(e),fe(!0)},onShowRemapInstrument:e=>{we(e),ge(!0)},onExportPattern:()=>{lI(m[h])},onExportTrack:()=>{const e=m[h];cI(f.channelIndex,e)},onReverse:Ue.reverseBlock,onExpand:Ue.expandBlock,onShrink:Ue.shrinkBlock,onDuplicate:Ue.duplicateBlock,onMath:Ue.mathBlock}),ke&&Ea.jsx(MM,{channelIndex:Me,onClose:()=>Se(!1)}),Re&&Ea.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50 animate-fade-in",children:Ea.jsxs("div",{className:"bg-dark-bgPrimary border border-dark-border rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] flex flex-col overflow-hidden",children:[Ea.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-dark-border bg-dark-bgSecondary",children:[Ea.jsxs("h2",{className:"text-lg font-bold text-text-primary flex items-center gap-2",children:[Ea.jsx(rt,{size:20,className:"text-accent-primary"}),"Automation Editor"]}),Ea.jsx("button",{onClick:()=>je(!1),className:"p-2 rounded hover:bg-dark-bgHover text-text-muted hover:text-text-primary transition-colors",title:"Close",children:Ea.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:Ea.jsx("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})]}),Ea.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-modern",children:Ea.jsx(tI,{})})]})})]})},dI=e.memo(({onShowTips:e})=>{const t=ob(e=>e.cursor),a=ob(e=>e.currentOctave),n=ob(e=>e.insertMode),s=ob(e=>e.recordMode),r=ob(e=>e.patterns[e.currentPatternIndex]?.length||64),{isPlaying:i,currentRow:o}=Kv(),{contextState:l}=$v(),{knobBank:c,setKnobBank:u,isInitialized:d,inputDevices:p,selectedInputId:m,showKnobBar:h,setShowKnobBar:f}=Gw(),y=i?o:t.rowIndex,g=`${String(y).padStart(2,"0")}/${String(r-1).padStart(2,"0")}`,b=`Ch ${t.channelIndex+1}`,v=d&&p.length>0,x=v?p.find(e=>e.id===m)||p[0]:null,w=x?.name||"MIDI Controller",k=[{id:"303",label:"303/Synth",icon:Oe},{id:"Siren",label:"Dub Siren",icon:rt},{id:"FX",label:"Effects",icon:gt},{id:"Mixer",label:"Mixer",icon:_e}],S=v?hw[c]:[];return Ea.jsxs("div",{className:"flex flex-col",children:[v&&h&&Ea.jsxs("div",{className:"bg-dark-bgTertiary border-t border-dark-border px-4 py-2 flex flex-col gap-2",children:[Ea.jsxs("div",{className:"flex items-center gap-1",children:[Ea.jsx("div",{className:"text-[10px] font-bold text-text-muted uppercase mr-2 tracking-widest",children:"Knob Bank:"}),k.map(e=>{const t=e.icon,a=c===e.id;return Ea.jsxs("button",{onClick:()=>u(e.id),className:`\n                    flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase transition-all border\n                    ${a?"bg-accent-primary text-dark-bg border-accent-primary shadow-[0_0_10px_rgba(0,255,255,0.3)]":"bg-dark-bgSecondary text-text-muted border-dark-border hover:border-text-muted"}\n                  `,children:[Ea.jsx(t,{size:12}),e.label]},e.id)})]}),Ea.jsx("div",{className:"grid grid-cols-8 gap-2",children:S.map((e,t)=>Ea.jsxs("div",{className:"flex flex-col items-center p-1.5 rounded bg-dark-bgSecondary border border-dark-border relative group overflow-hidden",children:[Ea.jsx("div",{className:"absolute top-0 left-0 w-full h-[2px] bg-accent-primary/20 group-hover:bg-accent-primary/50 transition-colors"}),Ea.jsxs("span",{className:"text-[8px] font-mono text-text-muted mb-1 flex items-center gap-1",children:[Ea.jsx(ga,{size:8})," K",t+1," (CC ",e.cc,")"]}),Ea.jsx("span",{className:"text-[10px] font-bold text-accent-primary uppercase truncate w-full text-center",children:e.label})]},t))})]}),Ea.jsxs("div",{className:"bg-dark-bgSecondary border-t border-dark-border flex items-center justify-between px-4 py-1.5 text-xs font-mono",children:[Ea.jsxs("div",{className:"flex items-center gap-4",children:[Ea.jsxs("span",{className:"text-text-secondary",children:["Row ",Ea.jsx("span",{className:"text-accent-primary font-semibold",children:g})]}),Ea.jsx("div",{className:"w-px h-3 bg-dark-border"}),Ea.jsx("span",{className:"text-text-secondary",children:b}),Ea.jsx("div",{className:"w-px h-3 bg-dark-border"}),Ea.jsx("span",{className:"text-text-secondary capitalize",children:t.columnType}),Ea.jsx("div",{className:"w-px h-3 bg-dark-border"}),Ea.jsxs("span",{className:"text-text-secondary",children:["Oct ",Ea.jsx("span",{className:"text-accent-primary font-semibold",children:a})]}),Ea.jsx("div",{className:"w-px h-3 bg-dark-border"}),Ea.jsxs("span",{className:"text-text-secondary",title:n?"Insert mode: new data shifts rows down":"Overwrite mode: new data replaces existing",children:["Mode: ",Ea.jsx("span",{className:n?"text-accent-warning":"text-accent-primary",children:n?"INS":"OVR"})]}),Ea.jsx("div",{className:"w-px h-3 bg-dark-border"}),Ea.jsx("span",{className:"px-2 py-0.5 rounded "+(s?"bg-accent-error/20 text-accent-error":"text-text-muted"),children:s?"REC":"EDIT"})]}),Ea.jsxs("div",{className:"flex items-center gap-4",children:[v&&Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("button",{onClick:()=>f(!h),className:"flex items-center gap-1.5 text-[10px] text-text-muted hover:text-accent-primary transition-colors",title:h?"Hide MIDI controls":"Show MIDI controls",children:[Ea.jsx("span",{className:"w-2 h-2 rounded-full bg-accent-success animate-pulse"}),Ea.jsx("span",{className:"font-bold uppercase",children:w}),h?Ea.jsx(Me,{size:12}):Ea.jsx(Et,{size:12})]}),Ea.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),e&&Ea.jsxs(Ea.Fragment,{children:[Ea.jsxs("button",{onClick:e,className:"flex items-center gap-1.5 px-2 py-0.5 rounded bg-accent-warning/10 text-accent-warning hover:bg-accent-warning/20 transition-colors",title:"Tip of the Day",children:[Ea.jsx(Qt,{size:12}),Ea.jsx("span",{className:"text-[10px] font-bold uppercase tracking-tight",children:"Tips"})]}),Ea.jsx("div",{className:"w-px h-3 bg-dark-border"})]}),Ea.jsxs("span",{className:"flex items-center gap-1.5 "+("running"===l?"text-accent-success":"text-text-muted"),children:[Ea.jsx("span",{className:"w-2 h-2 rounded-full "+("running"===l?"bg-accent-success":"bg-text-muted")}),"running"===l?"Audio Active":"Audio Off"]})]})]})]})});const pI="devilbox-project",mI="undefined"!=typeof window&&window.requestIdleCallback||(e=>setTimeout(()=>e({didTimeout:!1,timeRemaining:()=>50}),1)),hI="undefined"!=typeof window&&window.cancelIdleCallback||(e=>clearTimeout(e)),fI=mI,yI=hI;function gI(){try{const t=ob.getState(),a=Bv.getState(),n=Xv.getState(),s=Kv.getState(),r=Zv.getState(),i=$v.getState(),o=BM.getState(),l={version:"1.0.0",schemaVersion:13,savedAt:(new Date).toISOString(),metadata:n.metadata,bpm:s.bpm,patterns:t.patterns,patternOrder:t.patternOrder,instruments:a.instruments.map(e=>{if(e.metadata?.preservedSynth&&e.sample?.url?.startsWith("blob:")){const t={...e};return t.sample={...e.sample,url:""},t}if(e.sample?.audioBuffer){const t={...e};return t.sample={...e.sample,audioBuffer:void 0},t.metadata?.preservedSample?.audioBuffer&&(t.metadata={...t.metadata,preservedSample:{...t.metadata.preservedSample,audioBuffer:void 0}}),t}return e}),automation:r.curves,masterEffects:i.masterEffects,..."straight"!==s.grooveTemplateId?{grooveTemplateId:s.grooveTemplateId}:{},...o.tracks.length>0?{arrangement:o.getSnapshot()}:{}};try{localStorage.setItem(pI,JSON.stringify(l))}catch(e){return!1}return n.markAsSaved(),!0}catch(t){return!1}}function bI(){try{const e=localStorage.getItem(pI);if(!e)return!1;const t=JSON.parse(e);if(!t.version||!t.patterns||!t.instruments)return!1;if(!t.schemaVersion||t.schemaVersion<13)return localStorage.removeItem(pI),!1;if(Tv(t.patterns,t.instruments)){const e=Av(t.patterns,t.instruments);t.patterns=e.patterns,t.instruments=e.instruments}const a=ob.getState(),n=Bv.getState(),s=Xv.getState(),r=Kv.getState(),i=Zv.getState(),o=$v.getState();if(a.loadPatterns(t.patterns),t.patternOrder&&t.patternOrder.length>0&&a.setPatternOrder(t.patternOrder),n.loadInstruments(t.instruments),s.setMetadata(t.metadata),r.setBPM(t.bpm),t.automation&&i.loadCurves(t.automation),t.masterEffects&&o.setMasterEffects(t.masterEffects),r.setGrooveTemplate(t.grooveTemplateId||"straight"),t.arrangement){BM.getState().loadSnapshot(t.arrangement)}return n.autoBakeInstruments(),s.markAsSaved(),!0}catch(e){return!1}}function vI(){try{return null!==localStorage.getItem(pI)}catch{return!1}}function xI(){try{localStorage.removeItem(pI)}catch(e){}}const wI={success:Ea.jsx(ba,{size:18}),error:Ea.jsx(Ie,{size:18}),warning:Ea.jsx(Tt,{size:18}),info:Ea.jsx(Bt,{size:18})},kI={success:"text-accent-success border-accent-success/30 bg-accent-success/10",error:"text-accent-error border-accent-error/30 bg-accent-error/10",warning:"text-accent-warning border-accent-warning/30 bg-accent-warning/10",info:"text-accent-primary border-accent-primary/30 bg-accent-primary/10"},SI=()=>{const{notifications:e,removeNotification:t}=dx();return 0===e.length?null:Ea.jsx("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-sm",children:e.map(e=>Ea.jsxs("div",{className:`\n            flex items-start gap-3 px-4 py-3 rounded-lg border shadow-lg\n            animate-slide-in-right\n            ${kI[e.type]}\n          `,role:"alert",children:[Ea.jsx("span",{className:"flex-shrink-0 mt-0.5",children:wI[e.type]}),Ea.jsx("p",{className:"flex-1 text-sm font-medium text-text-primary",children:e.message}),Ea.jsx("button",{onClick:()=>t(e.id),className:"flex-shrink-0 p-0.5 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss notification",children:Ea.jsx(Pe,{size:14,className:"text-text-muted"})})]},e.id))})},MI=({onRefresh:e,onDismiss:t,currentVersion:a,latestVersion:n})=>Ea.jsx("div",{className:"fixed top-4 left-1/2 -translate-x-1/2 z-[60] max-w-md w-full px-4",children:Ea.jsxs("div",{className:"\n          flex items-center gap-3 px-4 py-3 rounded-lg border shadow-2xl\n          bg-accent-primary/20 border-accent-primary/40 backdrop-blur-sm\n          animate-slide-in-top\n        ",role:"alert",children:[Ea.jsx(At,{size:20,className:"text-accent-primary flex-shrink-0 animate-pulse"}),Ea.jsxs("div",{className:"flex-1 min-w-0",children:[Ea.jsx("p",{className:"text-sm font-semibold text-text-primary mb-1",children:"Update Available"}),Ea.jsxs("p",{className:"text-xs text-text-muted",children:["Version ",n," is now available (current: ",a,")"]})]}),Ea.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[Ea.jsx(qk,{onClick:e,className:"px-3 py-1.5 text-xs bg-accent-primary hover:bg-accent-primary/80 text-white font-medium rounded",children:"Refresh"}),Ea.jsx("button",{onClick:t,className:"p-1 rounded hover:bg-dark-bgHover transition-colors","aria-label":"Dismiss update notification",children:Ea.jsx(Pe,{size:16,className:"text-text-muted"})})]})]})}),NI=()=>{const{activeError:e,dismissError:t,copyToClipboard:a,getDebugString:n}=yo(),[r,i]=s.useState(!1),[o,l]=s.useState(!1);if(!e)return null;const c=()=>{t(e.id),i(!1),l(!1)};return Ea.jsxs(HM,{isOpen:!0,onClose:c,size:"lg",closeOnBackdropClick:!1,closeOnEscape:!0,children:[Ea.jsx(KM,{title:"Synth Error",subtitle:{init:"Initialization Error",wasm:"WASM Engine Error",runtime:"Runtime Error",audio:"Audio Context Error"}[e.errorType],icon:Ea.jsx(Tt,{className:"w-6 h-6 text-red-500"})}),Ea.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[Ea.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-4",children:Ea.jsx("div",{className:"flex items-start gap-3",children:Ea.jsxs("div",{className:"flex-1",children:[Ea.jsxs("p",{className:"font-mono text-sm text-red-300",children:[Ea.jsx("span",{className:"text-red-400 font-bold",children:e.synthType}),e.synthName&&Ea.jsxs("span",{className:"text-red-300/70",children:[" (",e.synthName,")"]})]}),Ea.jsx("p",{className:"mt-2 text-white",children:e.message})]})})}),Ea.jsxs("button",{onClick:()=>l(!o),className:"flex items-center gap-2 text-sm text-dark-text-secondary hover:text-white transition-colors",children:[o?Ea.jsx(Et,{size:16}):Ea.jsx(Me,{size:16}),o?"Hide":"Show"," Debug Details"]}),o&&Ea.jsxs("div",{className:"bg-dark-surface rounded-lg p-4 space-y-3",children:[Ea.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-dark-text-secondary",children:"Timestamp:"}),Ea.jsx("p",{className:"font-mono text-xs",children:e.debugData.timestamp})]}),Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-dark-text-secondary",children:"AudioContext:"}),Ea.jsx("p",{className:"font-mono text-xs",children:e.debugData.audioContextState})]}),Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-dark-text-secondary",children:"WASM Supported:"}),Ea.jsx("p",{className:"font-mono text-xs",children:e.debugData.wasmSupported?"Yes":"No"})]}),Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-dark-text-secondary",children:"Error Type:"}),Ea.jsx("p",{className:"font-mono text-xs",children:e.errorType})]})]}),e.stack&&Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Stack Trace:"}),Ea.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-red-300 overflow-x-auto max-h-32 overflow-y-auto",children:e.stack})]}),Ea.jsxs("div",{children:[Ea.jsx("span",{className:"text-dark-text-secondary text-sm",children:"Full Debug Report:"}),Ea.jsx("pre",{className:"mt-1 p-2 bg-black/50 rounded text-xs font-mono text-dark-text-secondary overflow-x-auto max-h-40 overflow-y-auto whitespace-pre-wrap",children:n(e)})]})]}),Ea.jsx("p",{className:"text-sm text-dark-text-secondary",children:"This synth failed to initialize properly. Please copy the debug information and report this issue. The synth will not be available until the error is resolved."})]}),Ea.jsx(qM,{children:Ea.jsxs("div",{className:"flex justify-between w-full",children:[Ea.jsx("button",{onClick:async()=>{await a(e)&&(i(!0),setTimeout(()=>i(!1),2e3))},className:"flex items-center gap-2 px-4 py-2 bg-dark-surface hover:bg-dark-hover rounded transition-colors",children:r?Ea.jsxs(Ea.Fragment,{children:[Ea.jsx(De,{size:16,className:"text-green-500"}),Ea.jsx("span",{className:"text-green-500",children:"Copied!"})]}):Ea.jsxs(Ea.Fragment,{children:[Ea.jsx(ut,{size:16}),Ea.jsx("span",{children:"Copy Debug Info"})]})}),Ea.jsxs("button",{onClick:c,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded transition-colors",children:[Ea.jsx(Pe,{size:16}),Ea.jsx("span",{children:"Dismiss"})]})]})})]})},CI=()=>{const{pendingRomRequest:e,dismissRomDialog:t}=Xg(),a=Bv(e=>e.updateInstrument),n=Bv(e=>e.instruments),[r,i]=s.useState(!1),[o,l]=s.useState(!1),[c,u]=s.useState(null),d=s.useRef(null),p=s.useCallback(async s=>{const r=s.target.files?.[0];if(r&&e){i(!0),u(null);try{const s=Qg(),{instrumentId:o,synthType:c}=e;if(r.name.toLowerCase().endsWith(".zip")){const e=new Ya,t=await e.loadAsync(r),a=[];t.forEach((e,t)=>{const n=e.toLowerCase().match(/\.(txt|md|pdf|url|inf)$/);t.dir||n||a.push({name:e,entry:t})}),a.sort((e,t)=>e.name.localeCompare(t.name,void 0,{numeric:!0,sensitivity:"base"}));for(let n=0;n<a.length;n++){const e=await a[n].entry.async("uint8array");s.loadSynthROM(o,c,n,e)}}else{const e=await r.arrayBuffer(),t=new Uint8Array(e);s.loadSynthROM(o,c,0,t)}const u=n.find(e=>e.id===o);u&&a(o,{parameters:{...u.parameters,_romsLoaded:1}}),l(!0),setTimeout(()=>{t(),l(!1),i(!1)},1200)}catch(o){u(o instanceof Error?o.message:"Failed to load ROM file"),i(!1)}d.current&&(d.current.value="")}},[e,n,a,t]),m=s.useCallback(()=>{t(),l(!1),u(null),i(!1)},[t]);if(!e)return null;const{chipName:h,requiredZip:f}=e;return Ea.jsxs(HM,{isOpen:!0,onClose:m,size:"md",closeOnBackdropClick:!0,closeOnEscape:!0,children:[Ea.jsx(KM,{title:"ROM Required",subtitle:`${h} needs ROM data to produce sound`,icon:Ea.jsx(va,{className:"w-6 h-6 text-amber-400"})}),Ea.jsxs("div",{className:"p-4 space-y-4",children:[Ea.jsx("div",{className:"bg-amber-900/20 border border-amber-500/30 rounded-lg p-4",children:Ea.jsxs("div",{className:"flex items-start gap-3",children:[Ea.jsx(Tt,{size:18,className:"text-amber-400 mt-0.5 shrink-0"}),Ea.jsxs("div",{className:"text-sm",children:[Ea.jsx("p",{className:"text-white",children:"This synth requires ROM files that couldn't be loaded automatically."}),Ea.jsxs("p",{className:"mt-2 text-dark-text-secondary",children:["Without ROMs, the synth will be silent. You can upload the ROM file below, or place it in ",Ea.jsx("code",{className:"text-amber-300 bg-black/30 px-1 rounded",children:"/public/roms/"})," for auto-loading."]})]})]})}),Ea.jsxs("div",{className:"bg-dark-surface rounded-lg p-3",children:[Ea.jsx("div",{className:"text-xs text-dark-text-secondary uppercase tracking-wider mb-1",children:"Expected ROM file"}),Ea.jsx("div",{className:"font-mono text-sm text-amber-300",children:f})]}),Ea.jsxs("div",{className:"flex flex-col items-center gap-3",children:[o?Ea.jsxs("div",{className:"flex items-center gap-2 text-green-400 py-4",children:[Ea.jsx(De,{size:20}),Ea.jsx("span",{className:"font-medium",children:"ROMs loaded successfully!"})]}):Ea.jsxs("label",{className:"w-full cursor-pointer",children:[Ea.jsxs("div",{className:`\n                border-2 border-dashed rounded-lg p-6\n                flex flex-col items-center gap-2 transition-colors\n                ${r?"border-amber-500/50 bg-amber-900/10":"border-dark-border hover:border-amber-400/50 hover:bg-amber-900/5"}\n              `,children:[Ea.jsx(Dt,{size:24,className:r?"text-amber-400 animate-pulse":"text-dark-text-secondary"}),Ea.jsx("span",{className:"text-sm text-dark-text-secondary",children:r?"Loading ROM...":"Click to upload ROM file (.zip or raw ROM)"})]}),Ea.jsx("input",{ref:d,type:"file",accept:".zip,.bin,.rom,.vsm",className:"hidden",onChange:p,disabled:r})]}),c&&Ea.jsx("div",{className:"text-sm text-red-400 bg-red-900/20 border border-red-500/30 rounded px-3 py-2 w-full",children:c})]})]}),Ea.jsx(qM,{children:Ea.jsx("div",{className:"flex justify-end w-full",children:Ea.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-dark-surface hover:bg-dark-hover rounded transition-colors",children:[Ea.jsx(Pe,{size:16}),Ea.jsx("span",{children:o?"Close":"Skip"})]})})})]})};const PI=[".dbx",".dbi",".xml",".sqs",".seq",".mod",".xm",".it",".s3m",".fur",".mptm",".669",".amf",".ams",".dbm",".dmf",".dsm",".far",".ftm",".gdm",".imf",".mdl",".med",".mt2",".mtm",".okt",".psm",".ptm",".sfx",".stm",".ult",".umx",".mid",".midi",".wav",".mp3",".ogg",".flac",".aiff",".aif"];const EI=({onFileLoaded:e,children:t})=>{const[a,n]=s.useState(!1),[,r]=s.useState(0),i=s.useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),r(e=>e+1),e.dataTransfer.items&&e.dataTransfer.items.length>0){Array.from(e.dataTransfer.items).some(e=>"file"===e.kind)&&n(!0)}},[]),o=s.useCallback(e=>{e.preventDefault(),e.stopPropagation(),r(e=>{const t=e-1;return 0===t&&n(!1),t})},[]),l=s.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),c=s.useCallback(async t=>{t.preventDefault(),t.stopPropagation(),n(!1),r(0);const a=Array.from(t.dataTransfer.files);if(0===a.length)return;const s=a.find(e=>function(e){const t=e.toLowerCase().slice(e.lastIndexOf("."));return PI.includes(t)}(e.name));if(s)try{await e(s)}catch(i){}},[e]);return Ea.jsxs("div",{onDragEnter:i,onDragLeave:o,onDragOver:l,onDrop:c,className:"relative w-full h-full",children:[t,a&&Ea.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/80 flex items-center justify-center pointer-events-none animate-fade-in",children:Ea.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary border-dashed rounded-xl p-12 flex flex-col items-center gap-4 shadow-2xl",children:[Ea.jsx(Dt,{size:64,className:"text-accent-primary animate-bounce"}),Ea.jsxs("div",{className:"text-center",children:[Ea.jsx("p",{className:"text-2xl font-bold text-white mb-2",children:"Drop your file here"}),Ea.jsx("p",{className:"text-text-muted text-sm",children:"Supports .dbx, .dbi, .xml, .mod, .xm, .it, .s3m, .fur, .mid, and more"})]})]})})]})},_I=s.lazy(()=>ja(()=>import("./HelpModal-D89D4CH6.js"),__vite__mapDeps([7,1,2,4,3])).then(e=>({default:e.HelpModal}))),TI=s.lazy(()=>ja(()=>import("./ExportDialog-BwxW_bCa.js"),__vite__mapDeps([8,1,2,3,4])).then(e=>({default:e.ExportDialog}))),AI=s.lazy(()=>ja(()=>import("./EditInstrumentModal-BNv_KW_M.js"),__vite__mapDeps([9,1,2,10,4,3,11,12])).then(e=>({default:e.EditInstrumentModal}))),OI=s.lazy(()=>ja(()=>import("./index-I5waO5pI.js"),__vite__mapDeps([13,1,2,12,4,3])).then(e=>({default:e.MasterEffectsModal}))),II=s.lazy(()=>ja(()=>import("./index-I5waO5pI.js"),__vite__mapDeps([13,1,2,12,4,3])).then(e=>({default:e.InstrumentEffectsModal}))),FI=s.lazy(()=>ja(()=>import("./index-I5waO5pI.js"),__vite__mapDeps([13,1,2,12,4,3])).then(e=>({default:e.EffectParameterEditor}))),DI=s.lazy(()=>ja(()=>import("./TD3PatternDialog-dbve9bcY.js"),__vite__mapDeps([14,1,2,5,3,4,6,15])).then(e=>({default:e.TD3PatternDialog}))),RI=s.lazy(()=>ja(()=>import("./DrumpadEditorModal-BWtpwvMF.js"),__vite__mapDeps([16,1,2,4,3])).then(e=>({default:e.DrumpadEditorModal}))),jI=s.lazy(()=>ja(()=>import("./TipOfTheDay-Cb99Ks1p.js"),__vite__mapDeps([17,1,2,4,3])).then(e=>({default:e.TipOfTheDay}))),BI=s.lazy(()=>ja(()=>import("./PatternManagement-DHCob9Cg.js"),__vite__mapDeps([18,1,2,12,4,3])).then(e=>({default:e.PatternManagement}))),LI=s.lazy(()=>ja(()=>import("./SamplePackBrowser-DsIyjL-K.js"),__vite__mapDeps([19,1,2,3,4])).then(e=>({default:e.SamplePackBrowser}))),VI=s.lazy(()=>ja(()=>import("./InstrumentEditorPopout-cDNpDyvi.js"),__vite__mapDeps([20,1,2,10,4,3,11,12])).then(e=>({default:e.InstrumentEditorPopout}))),zI=s.lazy(()=>ja(()=>Promise.resolve().then(()=>QO),void 0).then(e=>({default:e.PianoRoll}))),UI=s.lazy(()=>ja(()=>import("./OscilloscopePopout-D9ASEl9Y.js"),__vite__mapDeps([21,1,2,3,4])).then(e=>({default:e.OscilloscopePopout}))),GI=s.lazy(()=>ja(()=>import("./index-dOzbBcp0.js"),__vite__mapDeps([22,1,2,4,3])).then(e=>({default:e.ArrangementView})));function WI(){const{updateAvailable:e,latestVersion:t,currentVersion:a,refresh:n}=function(e=3e5){const[t,a]=s.useState(!1),[n,r]=s.useState(null),i=async()=>{try{const e=`/DEViLBOX/version.json?t=${Date.now()}`,t=await fetch(e,{cache:"no-cache"});if(!t.ok)return;const n=await t.json();r(n),n.buildHash!==Tk&&a(!0)}catch(e){}};return s.useEffect(()=>{i();const t=setInterval(i,e);return()=>clearInterval(t)},[e]),{updateAvailable:t,latestVersion:n,currentVersion:{buildNumber:_k,buildHash:Tk},refresh:()=>{window.location.reload()}}}(),[r,i]=s.useState(!1),{initialized:o,contextState:l,setInitialized:c,setContextState:u,setToneEngineInstance:d,setAnalyserNode:p,setFFTNode:m}=$v(Ua(e=>({initialized:e.initialized,contextState:e.contextState,setInitialized:e.setInitialized,setContextState:e.setContextState,setToneEngineInstance:e.setToneEngineInstance,setAnalyserNode:e.setAnalyserNode,setFFTNode:e.setFFTNode}))),{showSamplePackModal:h,setShowSamplePackModal:f,applyAutoCompact:y,activeView:g,toggleActiveView:b,instrumentEditorPoppedOut:v,setInstrumentEditorPoppedOut:x,masterEffectsPoppedOut:w,setMasterEffectsPoppedOut:k,instrumentEffectsPoppedOut:S,setInstrumentEffectsPoppedOut:M,pianoRollPoppedOut:N,setPianoRollPoppedOut:C,oscilloscopePoppedOut:P,setOscilloscopePoppedOut:E,arrangementPoppedOut:_,setArrangementPoppedOut:T}=Vv(),[A,O]=s.useState(null),[I,F]=s.useState(!1),[D,R]=s.useState(!1),[j,B]=s.useState(!1),[L,V]=s.useState(!1),[z,U]=s.useState(!1),[G,W]=s.useState(!1),[H,K]=s.useState(!1),[q,$]=s.useState(!1),[X,Y]=s.useState("tips"),[Z,Q]=s.useState(null),[J,ee]=s.useState(!1),[te,ae]=s.useState(null),[ne,se]=s.useState(!1),{showPatternDialog:re,closePatternDialog:ie,showKnobBar:oe,setShowKnobBar:le}=Gw();s.useEffect(()=>{const e=localStorage.getItem("devilbox-seen-version"),t="false"!==localStorage.getItem("show-tips-at-startup");e!==a.buildNumber?(Y("changelog"),$(!0)):t&&(Y("tips"),$(!0))},[a.buildNumber]),function(){const{isPlaying:e,togglePlayPause:t,stop:a}=Kv(),{currentPatternIndex:n,patterns:r,setCurrentPattern:i,currentOctave:o,setCurrentOctave:l,cursor:c,moveCursorToChannel:u}=ob();s.useEffect(()=>{const e=wx();e.init();const s=[];return s.push(e.registerAction("transport.play",()=>{t()})),s.push(e.registerAction("transport.stop",()=>{a()})),s.push(e.registerAction("transport.playFromStart",()=>{a(),setTimeout(()=>t(),50)})),s.push(e.registerAction("pattern.next",()=>{n<r.length-1&&i(n+1)})),s.push(e.registerAction("pattern.previous",()=>{n>0&&i(n-1)})),s.push(e.registerAction("pattern.first",()=>{i(0)})),s.push(e.registerAction("pattern.last",()=>{i(r.length-1)})),s.push(e.registerAction("octave.up",()=>{o<8&&l(o+1)})),s.push(e.registerAction("octave.down",()=>{o>0&&l(o-1)})),s.push(e.registerAction("channel.next",()=>{const e=r[n];e&&c.channelIndex<e.channels.length-1&&u(c.channelIndex+1)})),s.push(e.registerAction("channel.previous",()=>{c.channelIndex>0&&u(c.channelIndex-1)})),()=>{s.forEach(e=>e())}},[e,t,a,n,r,i,o,l,c,u])}(),function(){const e=s.useCallback(e=>{const{patterns:t,currentPatternIndex:a,setCurrentPattern:n,currentOctave:s,setCurrentOctave:r}=ob.getState(),{isPlaying:i,isLooping:o,play:l,stop:c,pause:u,setIsLooping:d,currentRow:p,setCurrentRow:m}=Kv.getState(),{currentInstrumentId:h,setCurrentInstrument:f,instruments:y}=Bv.getState(),{undo:g,redo:b}=Qv.getState();switch(e){case"transport.play":i||l();break;case"transport.stop":c();break;case"transport.pause":u();break;case"transport.loop":d(!o);break;case"nav.patternUp":a<t.length-1&&n(a+1);break;case"nav.patternDown":a>0&&n(a-1);break;case"nav.rowUp":p>0&&m(p-1);break;case"nav.rowDown":{const e=t[a];e&&p<e.length-1&&m(p+1);break}case"nav.toStart":m(0);break;case"nav.toEnd":{const e=t[a];e&&m(e.length-1);break}case"edit.octaveUp":s<8&&r(s+1);break;case"edit.octaveDown":s>0&&r(s-1);break;case"edit.instrumentUp":if(null!==h){const e=h+1;y.some(t=>t.id===e)&&f(e)}break;case"edit.instrumentDown":if(null!==h&&h>1){const e=h-1;y.some(t=>t.id===e)&&f(e)}break;case"edit.undo":g();break;case"edit.redo":b()}},[]),t=s.useCallback((e,t)=>{const{instruments:a}=Bv.getState(),n=Qg(),s=vx().getControlledInstrument();let r=a.filter(e=>("TB303"===e.synthType||"Buzz3o3"===e.synthType)&&e.tb303);if(null!==s){const e=a.find(e=>e.id===s);if(e&&e.tb303)r=[e];else if(e)return}0!==r.length&&r.forEach(a=>{if(!a.tb303)return;const s=JSON.parse(JSON.stringify(a.tb303));switch(e){case"cutoff":s.filter&&(s.filter.cutoff=t);break;case"resonance":s.filter&&(s.filter.resonance=t);break;case"envMod":s.filterEnvelope&&(s.filterEnvelope.envMod=t);break;case"decay":s.filterEnvelope&&(s.filterEnvelope.decay=t);break;case"accent":s.accent&&(s.accent.amount=t);break;case"slideTime":s.slide&&(s.slide.time=t);break;case"overdrive":s.overdrive&&(s.overdrive.amount=t);break;case"normalDecay":s.devilFish&&(s.devilFish.normalDecay=t);break;case"accentDecay":s.devilFish&&(s.devilFish.accentDecay=t);break;case"softAttack":s.devilFish&&(s.devilFish.softAttack=t);break;case"vegSustain":s.devilFish&&(s.devilFish.vegSustain=t);break;case"filterFM":s.devilFish&&(s.devilFish.filterFM=t);break;case"filterTracking":s.devilFish&&(s.devilFish.filterTracking=t)}n.updateTB303Parameters(a.id,s)})},[]),a=s.useCallback((a,n,s)=>{if(n.startsWith("transport.")||n.startsWith("nav.")||n.startsWith("edit.")||n.startsWith("channel.")||n.startsWith("pattern.")||n.startsWith("view."))s>64&&e(n);else if(n.startsWith("tb303.")){const e=n.replace("tb303.","");return void t(e,s)}},[e,t]);s.useEffect(()=>vx().onParameterChange(a),[a])}(),s.useEffect(()=>{const e=Sx(),t=Zg.getInstance();e.init();const a=(e,a)=>{const n=Bv.getState().instruments.find(t=>t.id===e.targetInstrumentId);if(!n)return;const s=e.targetNote??60,r=ce(s,"midi").toNote(),i=2===r.length?r.charAt(0)+"-"+r.charAt(1):r,o=a/127;if(a>0){t.triggerPolyNoteAttack(n.id,r,o,{...n,isLive:!0});const e=ob.getState(),a=Kv.getState();if(e.recordMode){const t=a.isPlaying?a.currentRow:e.cursor.rowIndex;let s=e.cursor.channelIndex;e.multiRecEnabled&&a.isPlaying&&(s=e.findBestChannel());const r=Qn(i);if(e.setCell(s,t,{note:r,instrument:n.id}),!a.isPlaying&&e.editStep>0){const a=e.patterns[e.currentPatternIndex];if(a){const n=(t+e.editStep)%a.length;e.moveCursorToRow(n)}}}}else{t.triggerPolyNoteRelease(n.id,r,{...n,isLive:!0});const e=ob.getState(),a=Kv.getState();e.recordMode&&a.isPlaying&&e.recReleaseEnabled}},n=e.onTrigger(a),s=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const n=Gw.getState();if("NumpadEnter"===t.code||"Enter"===t.key&&3===t.location)return t.preventDefault(),void n.togglePadBank();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===n.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&a(r,127)}},r=t=>{if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;const n=Gw.getState();let s={Numpad1:0,Numpad2:1,Numpad3:2,Numpad4:3,Numpad5:4,Numpad6:5,Numpad7:6,Numpad8:7,Numpad9:8}[t.code];if(void 0!==s){"B"===n.padBank&&(s+=8);const t=36+s,r=e.getMapping(9,t);r&&a(r,0)}};return window.addEventListener("keydown",s),window.addEventListener("keyup",r),()=>{n(),window.removeEventListener("keydown",s),window.removeEventListener("keyup",r)}},[]);const{updateMasterEffect:ue}=$v();s.useEffect(()=>{y()},[y]);const{save:de}=function(){const{isDirty:e,markAsModified:t}=Xv(),a=s.useRef(null),n=s.useRef(!1),r=s.useRef(!0);s.useEffect(()=>{!n.current&&vI()&&(n.current=!0,bI())},[]),s.useEffect(()=>ob.subscribe((e,a)=>{r.current?r.current=!1:e.patterns!==a.patterns&&t()}),[t]),s.useEffect(()=>Bv.subscribe((e,a)=>{e.instruments!==a.instruments&&t()}),[t]),s.useEffect(()=>Kv.subscribe((e,a)=>{e.bpm===a.bpm&&e.grooveTemplateId===a.grooveTemplateId||t()}),[t]),s.useEffect(()=>BM.subscribe((e,a)=>{e.clips===a.clips&&e.tracks===a.tracks&&e.markers===a.markers||t()}),[t]);const i=s.useRef(null),o=s.useCallback(()=>{a.current&&clearTimeout(a.current),i.current&&yI(i.current),a.current=setTimeout(()=>{e&&(i.current=fI(t=>{t.timeRemaining()>100?gI():a.current=setTimeout(()=>{e&&gI()},5e3)},{timeout:6e4}))},3e4)},[e]);return s.useEffect(()=>(e&&o(),()=>{a.current&&clearTimeout(a.current),i.current&&yI(i.current)}),[e,o]),s.useEffect(()=>{const t=t=>{e&&(gI(),t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e]),{save:s.useCallback(()=>gI(),[]),load:s.useCallback(()=>bI(),[]),hasSaved:vI(),clear:xI,isDirty:e}}();s.useEffect(()=>{(async()=>{try{const e=Qg();d(e),p(e.analyser),m(e.fft),u(e.getContextState()),c(!0)}catch(e){O(e instanceof Error?e.message:"Unknown error")}})()},[]);const{undo:pe,redo:me,canUndo:he,canRedo:fe}=Qv(),{replacePattern:ye,currentPatternIndex:ge}=ob(),be=s.useCallback(()=>{if(!he())return;const e=pe();e&&ye(ge,e)},[pe,he,ye,ge]),ve=s.useCallback(()=>{if(!fe())return;const e=me();e&&ye(ge,e)},[me,fe,ye,ge]);s.useEffect(()=>{const e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;if((e.ctrlKey||e.metaKey)&&"z"===e.key&&!e.shiftKey)return e.preventDefault(),void be();if((e.ctrlKey||e.metaKey)&&"z"===e.key&&e.shiftKey||(e.ctrlKey||e.metaKey)&&"y"===e.key)return e.preventDefault(),void ve();if((e.ctrlKey||e.metaKey)&&"s"===e.key)return e.preventDefault(),void de();if("Escape"===e.key)return e.preventDefault(),void(D?R(!1):j?B(!1):L&&V(!1));if(e.shiftKey&&"?"===e.key)return e.preventDefault(),void R(!0);if(e.ctrlKey&&e.shiftKey&&"E"===e.key)return e.preventDefault(),void B(!0);if(e.ctrlKey&&e.shiftKey&&"P"===e.key)return e.preventDefault(),void V(!L);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"A"===e.key)return e.preventDefault(),void b();if((e.ctrlKey||e.metaKey)&&"k"===e.key)return e.preventDefault(),void le(!oe);if((e.ctrlKey||e.metaKey)&&"i"===e.key&&!e.shiftKey)return e.preventDefault(),void ee(!J);if((e.ctrlKey||e.metaKey)&&"m"===e.key&&!e.shiftKey)return e.preventDefault(),void U(!z);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"F"===e.key)return e.preventDefault(),void W(!G);if((e.ctrlKey||e.metaKey)&&e.shiftKey&&"M"===e.key)return e.preventDefault(),void $v.getState().toggleMasterMute();if(!("l"!==e.key&&"L"!==e.key||e.ctrlKey||e.metaKey||e.altKey))return e.preventDefault(),void Hw.getState().toggleLiveMode();const t=parseInt(e.key);if(!isNaN(t)&&t>=1&&t<=9){const a=Hw.getState();if(a.isLiveMode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();const n=t-1;return void(n<ob.getState().patterns.length&&a.queuePattern(n))}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[L,D,j,J,z,G,be,ve,de,b]);s.useEffect(()=>{const e=async()=>{if("running"!==l)try{const e=Qg();await e.init(),u(e.getContextState())}catch(t){}window.removeEventListener("click",e),window.removeEventListener("keydown",e)};return window.addEventListener("click",e),window.addEventListener("keydown",e),()=>{window.removeEventListener("click",e),window.removeEventListener("keydown",e)}},[l,u]);const xe=s.useCallback(async e=>{const{loadPatterns:t,setPatternOrder:a}=ob.getState(),{loadInstruments:n}=Bv.getState(),{setBPM:s,setGrooveTemplate:r}=Kv.getState(),{setMetadata:i}=Xv.getState();try{const o=e.name.toLowerCase();if(o.endsWith(".mid")||o.endsWith(".midi")){const a=await BA(e,{quantize:1,mergeChannels:!1,velocityToVolume:!0,defaultPatternLength:64});t(a.patterns);n(a.patterns.map((e,t)=>({id:t+1,name:`Track ${t+1}`,type:"synth",synthType:"Synth",effects:[],volume:-6,pan:0}))),i({name:a.metadata.name,author:"",description:`Imported from ${e.name} (${a.metadata.tracks} tracks)`}),s(a.bpm),px.success(`Loaded MIDI: ${a.metadata.name}`)}else if(o.endsWith(".fur")||o.endsWith(".dmf")){const{parseFurnaceSong:r,convertFurnaceToDevilbox:o}=await ja(async()=>{const{parseFurnaceSong:e,convertFurnaceToDevilbox:t}=await Promise.resolve().then(()=>$E);return{parseFurnaceSong:e,convertFurnaceToDevilbox:t}},void 0),{convertToInstrument:l}=await ja(async()=>{const{convertToInstrument:e}=await Promise.resolve().then(()=>$T);return{convertToInstrument:e}},void 0),c=await e.arrayBuffer(),u=o(await r(c)),d=u.instruments.map((e,t)=>l(e,t+1,"FUR")).flat().map((e,t)=>({...e,id:t+1})),p=u.metadata.modData?.patternOrderTable||[],m=u.patterns,h=m[0]?.length||64,f=m[0]?.[0]?.length||4,y=m.map((e,t)=>({id:`pattern-${t}`,name:`Pattern ${t}`,length:h,channels:Array.from({length:f},(t,a)=>({id:`channel-${a}`,name:`Channel ${a+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:e.map(e=>{const t=e[a]||{};return{note:t.note||0,instrument:t.instrument||0,volume:t.volume||0,effTyp:t.effectType||0,eff:t.effectParam||0,effTyp2:0,eff2:0}})}))}));n(d),t(y),p.length>0&&a(p),s(u.metadata.modData?.initialBPM||150),i({name:u.metadata.sourceFile.replace(/\.[^/.]+$/,""),author:"",description:`Imported from ${e.name} (Furnace)`}),px.success(`Loaded Furnace: ${e.name} (${d.length} instruments, ${y.length} patterns)`)}else if(o.match(/\.(mod|xm|it|s3m|mptm|669|amf|ams|dbm|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/))Vv.getState().setPendingModuleFile(e),px.info(`Opening import dialog for ${e.name}...`);else if(o.endsWith(".dbx")){const o=await e.text(),l=JSON.parse(o),{needsMigration:c,migrateProject:u}=await ja(async()=>{const{needsMigration:e,migrateProject:t}=await Promise.resolve().then(()=>Ov);return{needsMigration:e,migrateProject:t}},void 0);let d=l.patterns,p=l.instruments;if(c(d,p)){const e=u(d,p);d=e.patterns,p=e.instruments}if(t(d),l.sequence&&Array.isArray(l.sequence)){const e=new Map(d.map((e,t)=>[e.id,t])),t=l.sequence.map(t=>e.get(t)).filter(e=>void 0!==e);t.length>0&&a(t)}p&&n(p),l.masterEffects&&$v.getState().setMasterEffects(l.masterEffects),s(l.bpm),i(l.metadata),r(l.grooveTemplateId||"straight"),px.success(`Loaded: ${l.metadata?.name||e.name}`)}}catch(o){px.error(`Failed to load ${e.name}`)}},[]),we=s.useCallback(async e=>{const{addInstrument:t}=Bv.getState();try{const a=e.name.toLowerCase();if(a.match(/\.(dbx|mid|midi|mod|xm|it|s3m|fur|mptm|669|amf|ams|dbm|dmf|dsm|far|ftm|gdm|imf|mdl|med|mt2|mtm|okt|psm|ptm|sfx|stm|ult|umx)$/))return ae(e),void se(!0);if(a.endsWith(".dbi")){const a=await OT(e);a?.instrument?(t(a.instrument),px.success(`Loaded instrument: ${a.instrument.name||"Untitled"}`)):px.error(`Failed to load instrument: ${e.name}`)}else if(a.endsWith(".xml")){const t=await e.text(),a=t.includes("<db303-preset"),n=t.includes("<db303-pattern");if(a){const{parseDb303Preset:a}=await ja(async()=>{const{parseDb303Preset:e}=await import("./Db303PresetConverter-Dp8mjs8G.js");return{parseDb303Preset:e}},[]),{instruments:n,updateInstrument:s,addInstrument:r}=Bv.getState(),i=a(t);let o=n.find(e=>"TB303"===e.synthType);if(!o){const{createDefaultTB303Instrument:e}=await ja(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-u4Vykyyz.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();r(t),o=t}s(o.id,{tb303:{...o.tb303,...i}}),px.success(`Loaded DB303 preset: ${e.name}`)}else if(n){const{parseDb303Pattern:a}=await ja(async()=>{const{parseDb303Pattern:e}=await Promise.resolve().then(()=>KA);return{parseDb303Pattern:e}},void 0),{patterns:n,loadPatterns:s,setCurrentPattern:r,setPatternOrder:i}=ob.getState(),{instruments:o,addInstrument:l}=Bv.getState(),{setBPM:c}=Kv.getState();let u=o.find(e=>"TB303"===e.synthType);if(!u){const{createDefaultTB303Instrument:e}=await ja(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-u4Vykyyz.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();l(t),u=t}const d=e.name.replace(".xml","")||"Imported Pattern",{pattern:p,tempo:m}=a(t,d,u.id);p.channels[0].instrumentId=u.id;const h=[...n,p];s(h),r(h.length-1),i([h.length-1]),void 0!==m&&c(m),px.success(`Loaded DB303 pattern: ${p.name}`)}else px.error("Unknown XML format. Expected db303-pattern or db303-preset.")}else if(a.endsWith(".sqs")||a.endsWith(".seq")){const{parseTD3File:t}=await ja(async()=>{const{parseTD3File:e}=await import("./TD3PatternLoader-C1bZAG-1.js");return{parseTD3File:e}},[]),{td3StepsToTrackerCells:a}=await ja(async()=>{const{td3StepsToTrackerCells:e}=await import("./TD3PatternTranslator-CBKh8Tva.js");return{td3StepsToTrackerCells:e}},__vite__mapDeps([6,1,2,3,4])),{patterns:n,loadPatterns:s,setCurrentPattern:r,setPatternOrder:i}=ob.getState(),{instruments:o,addInstrument:l}=Bv.getState();let c=o.find(e=>"TB303"===e.synthType);if(!c){const{createDefaultTB303Instrument:e}=await ja(async()=>{const{createDefaultTB303Instrument:e}=await import("./instrumentFactory-u4Vykyyz.js");return{createDefaultTB303Instrument:e}},__vite__mapDeps([5,1,2,3,4])),t=e();l(t),c=t}const u=await e.arrayBuffer(),d=await t(u);if(0===d.patterns.length)return void px.error("No patterns found in SQS file");const p=Bv.getState().instruments.findIndex(e=>e.id===c.id)+1||1,m=d.patterns.map((e,t)=>{const n=a(e.steps,2),s=e.length||16;return{id:`td3-${Date.now()}-${t}`,name:e.name||`TD-3 Pattern ${t+1}`,length:s,channels:[{id:`ch-${c.id}-${t}`,name:"TB-303",muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:c.id,color:"#ec4899",rows:n.slice(0,s).map(e=>({...e,instrument:e.note?p:0}))}]}});s([...n,...m]),r(n.length),i(m.map((e,t)=>n.length+t)),px.success(`Loaded ${m.length} TD-3 pattern(s) from ${e.name}`)}else a.match(/\.(wav|mp3|ogg|flac|aiff|aif)$/)?(px.info(`Audio sample: ${e.name}. Opening instrument editor...`),ee(!0)):px.warning(`Unsupported file format: ${e.name}`)}catch(a){px.error(`Failed to handle ${e.name}`)}},[]),ke=async()=>{try{const e=Qg();await e.init(),u(e.getContextState()),F(!1)}catch(e){O(e instanceof Error?e.message:"Unknown error")}};return A?Ea.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:Ea.jsxs("div",{className:"panel p-8 max-w-md",children:[Ea.jsx("h2",{className:"text-xl font-bold text-accent-error mb-4",children:"Audio Initialization Error"}),Ea.jsx("p",{className:"text-text-secondary mb-4",children:A}),Ea.jsx(qk,{variant:"primary",onClick:()=>window.location.reload(),children:"Reload Application"})]})}):o?I&&"running"!==l?Ea.jsx(eS,{onShowExport:()=>B(!0),onShowHelp:()=>R(!0),onShowMasterFX:()=>U(!z),onShowPatterns:()=>V(!L),onShowInstruments:()=>ee(!0),onShowDrumpads:()=>K(!0),children:Ea.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:Ea.jsxs("div",{className:"text-center max-w-2xl",children:[Ea.jsxs("div",{className:"mb-8",children:[Ea.jsx("h1",{className:"text-5xl font-bold text-text-primary mb-2 tracking-tight",children:"DEViLBOX"}),Ea.jsx("p",{className:"text-lg text-text-secondary",children:"TB-303 Acid Tracker with Devil Fish Mod"})]}),Ea.jsx(qk,{variant:"primary",size:"lg",onClick:ke,icon:Ea.jsx(Ae,{size:20}),className:"shadow-glow animate-pulse-glow",children:"Start Audio Engine"}),Ea.jsxs("div",{className:"mt-12 grid grid-cols-2 gap-4 text-left",children:[Ea.jsxs("div",{className:"card p-4",children:[Ea.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[Ea.jsx("div",{className:"p-2 rounded-md bg-accent-primary/20 text-accent-primary",children:Ea.jsx(Te,{size:18})}),Ea.jsx("h3",{className:"font-semibold text-text-primary",children:"22 Synth Engines"})]}),Ea.jsx("p",{className:"text-sm text-text-secondary",children:"Including authentic TB-303 with accent and slide"})]}),Ea.jsxs("div",{className:"card p-4",children:[Ea.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[Ea.jsx("div",{className:"p-2 rounded-md bg-accent-secondary/20 text-accent-secondary",children:Ea.jsx(Je,{size:18})}),Ea.jsx("h3",{className:"font-semibold text-text-primary",children:"Pattern Editor"})]}),Ea.jsx("p",{className:"text-sm text-text-secondary",children:"4-16 channels with FT2-style keyboard layout"})]}),Ea.jsxs("div",{className:"card p-4",children:[Ea.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[Ea.jsx("div",{className:"p-2 rounded-md bg-accent-warning/20 text-accent-warning",children:Ea.jsx(_e,{size:18})}),Ea.jsx("h3",{className:"font-semibold text-text-primary",children:"Automation"})]}),Ea.jsx("p",{className:"text-sm text-text-secondary",children:"Real-time parameter curves for filter sweeps"})]}),Ea.jsxs("div",{className:"card p-4",children:[Ea.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[Ea.jsx("div",{className:"p-2 rounded-md bg-accent-success/20 text-accent-success",children:Ea.jsx(Ge,{size:18})}),Ea.jsx("h3",{className:"font-semibold text-text-primary",children:"36+ Presets"})]}),Ea.jsx("p",{className:"text-sm text-text-secondary",children:"Factory sounds for instant acid basslines"})]})]}),Ea.jsxs("p",{className:"mt-8 text-sm text-text-muted",children:["Press ",Ea.jsx("kbd",{className:"px-2 py-0.5 rounded bg-dark-bgTertiary border border-dark-border text-text-secondary",children:"?"})," anytime for help"]})]})})}):Ea.jsx(EI,{onFileLoaded:we,children:Ea.jsxs(eS,{onShowExport:()=>B(!0),onShowHelp:()=>R(!0),onShowMasterFX:()=>U(!z),onShowPatterns:()=>V(!L),onShowInstruments:()=>ee(!0),onShowDrumpads:()=>K(!0),children:[Ea.jsxs("div",{className:"flex flex-col flex-1 min-h-0 min-w-0 overflow-y-hidden",children:[Ea.jsx("div",{className:"flex flex-1 min-h-0 min-w-0 overflow-y-hidden",children:Ea.jsxs("div",{className:"flex flex-col min-h-0 min-w-0 flex-1",children:["tracker"===g&&Ea.jsxs(Ea.Fragment,{children:[L&&Ea.jsx("div",{className:"h-48 border-b border-dark-border animate-fade-in",children:Ea.jsx(s.Suspense,{fallback:Ea.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:"Loading patterns..."}),children:Ea.jsx(BI,{})})}),Ea.jsx("div",{className:"flex-1 min-h-0 min-w-0 flex flex-col",children:Ea.jsx(uI,{onShowPatterns:()=>V(!L),onShowExport:()=>B(!0),onShowHelp:()=>R(!0),onShowMasterFX:()=>U(!z),onShowInstrumentFX:()=>W(!G),onShowInstruments:()=>ee(!0),onShowDrumpads:()=>K(!0),showPatterns:L,showMasterFX:z,showInstrumentFX:G})})]}),"arrangement"===g&&Ea.jsx(s.Suspense,{fallback:Ea.jsx("div",{className:"flex-1 flex items-center justify-center text-text-muted",children:"Loading arrangement..."}),children:Ea.jsx(GI,{})})]})}),Ea.jsx(dI,{onShowTips:()=>$(!0)})]}),Ea.jsxs(s.Suspense,{fallback:null,children:[D&&Ea.jsx(_I,{isOpen:D,onClose:()=>R(!1)}),j&&Ea.jsx(TI,{isOpen:j,onClose:()=>B(!1)}),J&&Ea.jsx(AI,{isOpen:J,onClose:()=>ee(!1)}),z&&Ea.jsx(OI,{isOpen:z,onClose:()=>U(!1)}),G&&Ea.jsx(II,{isOpen:G,onClose:()=>W(!1)}),re&&Ea.jsx(DI,{isOpen:re,onClose:ie}),H&&Ea.jsx(RI,{isOpen:H,onClose:()=>K(!1)}),h&&Ea.jsx(LI,{onClose:()=>f(!1)}),q&&Ea.jsx(jI,{isOpen:q,onClose:()=>$(!1),initialTab:X}),Z&&Ea.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in",children:Ea.jsx("div",{className:"max-w-md w-full mx-4 animate-slide-in-up",children:Ea.jsx(FI,{effect:Z.effect,onUpdateParameter:(e,t)=>{if(!Z)return;const a={...Z.effect.parameters,[e]:t};ue(Z.effect.id,{parameters:a}),Q({...Z,effect:{...Z.effect,parameters:a}})},onUpdateWet:e=>{Z&&(ue(Z.effect.id,{wet:e}),Q({...Z,effect:{...Z.effect,wet:e}}))},onClose:()=>Q(null)})})}),ne&&te&&Ea.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in",children:Ea.jsxs("div",{className:"bg-dark-bgPrimary border-2 border-accent-primary rounded-xl p-6 max-w-md mx-4 animate-slide-in-up shadow-2xl",children:[Ea.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Load Song File?"}),Ea.jsxs("p",{className:"text-text-secondary mb-6",children:["Loading ",Ea.jsx("span",{className:"text-accent-primary font-mono",children:te.name})," will replace your current project."]}),Ea.jsx("p",{className:"text-text-muted text-sm mb-6",children:"Make sure you've saved any unsaved changes before continuing."}),Ea.jsxs("div",{className:"flex gap-3 justify-end",children:[Ea.jsx(qk,{variant:"ghost",onClick:()=>{se(!1),ae(null)},children:"Cancel"}),Ea.jsx(qk,{variant:"primary",onClick:async()=>{te&&await xe(te),se(!1),ae(null)},children:"Load File"})]})]})})]}),v&&Ea.jsx(s.Suspense,{fallback:null,children:Ea.jsx(B_,{isOpen:!0,onClose:()=>x(!1),title:"DEViLBOX  Instrument Editor",width:1e3,height:800,children:Ea.jsx(VI,{})})}),w&&Ea.jsx(s.Suspense,{fallback:null,children:Ea.jsx(B_,{isOpen:!0,onClose:()=>k(!1),title:"DEViLBOX  Master Effects",width:1e3,height:800,children:Ea.jsx(OI,{isOpen:!0,onClose:()=>k(!1)})})}),S&&Ea.jsx(s.Suspense,{fallback:null,children:Ea.jsx(B_,{isOpen:!0,onClose:()=>M(!1),title:"DEViLBOX  Instrument Effects",width:1e3,height:800,children:Ea.jsx(II,{isOpen:!0,onClose:()=>M(!1)})})}),N&&Ea.jsx(s.Suspense,{fallback:null,children:Ea.jsx(B_,{isOpen:!0,onClose:()=>C(!1),title:"DEViLBOX  Piano Roll",width:1200,height:600,children:Ea.jsx("div",{className:"h-screen w-screen bg-dark-bgSecondary",children:Ea.jsx(zI,{})})})}),_&&Ea.jsx(s.Suspense,{fallback:null,children:Ea.jsx(B_,{isOpen:!0,onClose:()=>T(!1),title:"DEViLBOX  Arrangement",width:1400,height:700,children:Ea.jsx("div",{className:"h-screen w-screen bg-dark-bg",children:Ea.jsx(GI,{})})})}),P&&Ea.jsx(s.Suspense,{fallback:null,children:Ea.jsx(B_,{isOpen:!0,onClose:()=>E(!1),title:"DEViLBOX  Visualizer",width:800,height:500,children:Ea.jsx(UI,{})})}),Ea.jsx(SI,{}),Ea.jsx(NI,{}),Ea.jsx(CI,{}),e&&!r&&Ea.jsx(MI,{onRefresh:n,onDismiss:()=>i(!0),currentVersion:a.buildNumber,latestVersion:t?.buildNumber||"unknown"})]})}):Ea.jsx("div",{className:"h-screen flex items-center justify-center bg-dark-bg text-text-primary",children:Ea.jsx("div",{className:"panel p-8",children:Ea.jsxs("div",{className:"flex items-center gap-3 text-accent-primary",children:[Ea.jsx("div",{className:"w-5 h-5 border-2 border-accent-primary border-t-transparent rounded-full animate-spin"}),Ea.jsx("span",{children:"Initializing audio engine..."})]})})})}class HI extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t})}handleReload=()=>{window.location.reload()};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:Ea.jsx("div",{className:"min-h-screen bg-bg flex items-center justify-center p-4",children:Ea.jsxs("div",{className:"max-w-lg w-full bg-bg-secondary rounded-lg border border-border p-6 text-center",children:[Ea.jsx("div",{className:"text-6xl mb-4",children:""}),Ea.jsx("h1",{className:"text-2xl font-bold text-text mb-2",children:"Something went wrong"}),Ea.jsx("p",{className:"text-text-secondary mb-4",children:"DEViLBOX encountered an unexpected error. Your work may have been auto-saved."}),!1,Ea.jsxs("div",{className:"flex gap-3 justify-center",children:[Ea.jsx("button",{onClick:this.handleReset,className:"px-4 py-2 bg-bg-tertiary hover:bg-border rounded text-text transition-colors",children:"Try Again"}),Ea.jsx("button",{onClick:this.handleReload,className:"px-4 py-2 bg-accent hover:bg-accent-hover rounded text-white transition-colors",children:"Reload App"})]})]})}):this.props.children}}const KI={Synth:11,MonoSynth:14,DuoSynth:5,FMSynth:16,AMSynth:22,PluckSynth:32,MetalSynth:23,MembraneSynth:10,NoiseSynth:7};function qI(e,t){return(t??-12)+(KI[e]??0)}function $I(e){return{attack:(e.envelope?.attack??10)/1e3,decay:(e.envelope?.decay??200)/1e3,sustain:(e.envelope?.sustain??50)/100,release:(e.envelope?.release??1e3)/1e3}}const XI=1.35,YI=[{id:"Synth",name:"Synth",category:"tone",loadMode:"eager",volumeOffsetDb:11,create:e=>{const t=new X(Y,{oscillator:{type:e.oscillator?.type||"sawtooth"},envelope:$I(e),volume:qI("Synth",e.volume)});return e.oscillator?.detune&&t.set({detune:e.oscillator.detune}),t}},{id:"MonoSynth",name:"Mono Synth",category:"tone",loadMode:"eager",volumeOffsetDb:14,create:e=>{const t={oscillator:{type:e.oscillator?.type||"sawtooth",detune:e.oscillator?.detune||0},envelope:$I(e),volume:qI("MonoSynth",e.volume)};return e.filter&&e.filter.type&&e.filter.frequency&&(t.filter={type:e.filter.type,frequency:e.filter.frequency,Q:e.filter.Q??1,rolloff:e.filter.rolloff??-12}),e.filterEnvelope&&void 0!==e.filterEnvelope.baseFrequency&&void 0!==e.filterEnvelope.attack&&(t.filterEnvelope={baseFrequency:e.filterEnvelope.baseFrequency,octaves:e.filterEnvelope.octaves??3,attack:e.filterEnvelope.attack/1e3,decay:(e.filterEnvelope.decay??200)/1e3,sustain:(e.filterEnvelope.sustain??50)/100,release:(e.filterEnvelope.release??1e3)/1e3}),new Q(t)},onTriggerRelease:(e,t,a)=>(e.triggerRelease(a),!0)},{id:"DuoSynth",name:"Duo Synth",category:"tone",loadMode:"eager",volumeOffsetDb:5,create:e=>{const t=e.oscillator?.type||"sawtooth",a=$I(e);return new J({voice0:{oscillator:{type:t},envelope:a},voice1:{oscillator:{type:t},envelope:a},vibratoAmount:e.oscillator?.detune?e.oscillator.detune/100:.5,vibratoRate:5,volume:qI("DuoSynth",e.volume)})},onTriggerRelease:(e,t,a)=>(e.triggerRelease(a),!0)},{id:"FMSynth",name:"FM Synth",category:"tone",loadMode:"eager",volumeOffsetDb:16,create:e=>new X(O,{oscillator:{type:e.oscillator?.type||"sine"},envelope:$I(e),modulationIndex:10,volume:qI("FMSynth",e.volume)})},{id:"AMSynth",name:"AM Synth",category:"tone",loadMode:"eager",volumeOffsetDb:22,create:e=>new X(ee,{oscillator:{type:e.oscillator?.type||"sine"},envelope:$I(e),volume:qI("AMSynth",e.volume)})},{id:"PluckSynth",name:"Pluck Synth",category:"tone",loadMode:"eager",volumeOffsetDb:32,create:e=>{const t=new X(te);return t.set({attackNoise:1,dampening:4e3,resonance:.7}),t.volume.value=qI("PluckSynth",e.volume),t}},{id:"MetalSynth",name:"Metal Synth",category:"tone",loadMode:"eager",volumeOffsetDb:23,create:e=>new ae({envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??100)/1e3,release:(e.envelope?.release??100)/1e3},volume:qI("MetalSynth",e.volume)}),onTriggerAttack:(e,t,a,n,s)=>{const r=s.accent?Math.min(1,n*XI):n;return e.triggerAttack(a,r),!0},onTriggerRelease:(e,t,a)=>(e.triggerRelease(a),!0)},{id:"MembraneSynth",name:"Membrane Synth",category:"tone",loadMode:"eager",volumeOffsetDb:10,create:e=>new ne({pitchDecay:.05,octaves:10,oscillator:{type:e.oscillator?.type||"sine"},envelope:{attack:(e.envelope?.attack??1)/1e3,decay:(e.envelope?.decay??400)/1e3,sustain:.01,release:(e.envelope?.release??100)/1e3},volume:qI("MembraneSynth",e.volume)}),onTriggerAttack:(e,t,a,n,s)=>{const r=s.accent?Math.min(1,n*XI):n;return e.triggerAttack(t,a,r),!0},onTriggerRelease:(e,t,a)=>(e.triggerRelease(a),!0)},{id:"NoiseSynth",name:"Noise Synth",category:"tone",loadMode:"eager",volumeOffsetDb:7,create:e=>new se({noise:{type:"white"},envelope:$I(e),volume:qI("NoiseSynth",e.volume)}),onTriggerAttack:(e,t,a,n,s)=>{const r=s.accent?Math.min(1,n*XI):n;return e.triggerAttack(a,r),!0},onTriggerRelease:(e,t,a)=>(e.triggerRelease(a),!0)}];function ZI(e,t){return(t??-12)+({Sampler:10,Player:10,GranularSynth:-47}[e]??0)}function QI(e,t,a,n,s,r){if(!e.buffer||!e.buffer.loaded)return;const i=n>0?we(n):-1/0;if(e.volume.value=i,s.metadata?.modPlayback?.usePeriodPlayback&&r){const t=s.metadata.modPlayback;let a=r;if(0!==t.finetune){const e=Bg(r,0);e>=0&&(a=jg(e,t.finetune))}const n=t.periodMultiplier/a/(s.sample?.sampleRate||8363);e.playbackRate=n}else{const a=s.sample?.baseNote||"C4",n=ce(a).toFrequency(),r=ce(t).toFrequency();e.playbackRate=r/n}e.start(a)}Tg.register(YI);const JI=[{id:"Sampler",name:"Sampler",category:"tone",loadMode:"eager",volumeOffsetDb:10,controlsComponent:"SampleControls",create:e=>{const t=e.metadata?.modPlayback?.usePeriodPlayback;if(t){const t=e.parameters,a=t?.sampleUrl;return new oe(a?{url:a,volume:ZI("Player",e.volume)}:{volume:ZI("Player",e.volume)})}if(e.sample?.multiMap&&Object.keys(e.sample.multiMap).length>0)return new ie({urls:e.sample.multiMap,volume:ZI("Sampler",e.volume)});const a=e.parameters,n=a?.sampleUrl||e.sample?.url,s=e.sample?.baseNote||"C4";if(n){const t={};return t[s]=n,new ie({urls:t,volume:ZI("Sampler",e.volume)})}return new ie({volume:ZI("Sampler",e.volume)})},onTriggerAttack:(e,t,a,n,s)=>{if(s.config.metadata?.modPlayback?.usePeriodPlayback)return QI(e,t,a,n,s.config,s.period),!0;const r=e;if(!r.loaded)return!0;try{r.triggerAttack(t,a,n)}catch{}return!0},onTriggerRelease:(e,t,a,n)=>{if(n.config.metadata?.modPlayback?.usePeriodPlayback){const t=e;return"started"===t.state&&t.stop(a),!0}const s=e;return!s.loaded||(s.triggerRelease(t||"C4",a),!0)}},{id:"Player",name:"Player",category:"tone",loadMode:"eager",volumeOffsetDb:10,create:e=>{const t=e.parameters,a=t?.sampleUrl,n=t?.reverseMode||"forward";return new oe(a?{url:a,volume:ZI("Player",e.volume),reverse:"reverse"===n}:{volume:ZI("Player",e.volume)})},onTriggerAttack:(e,t,a,n,s)=>(QI(e,t,a,n,s.config,s.period),!0),onTriggerRelease:(e,t,a)=>{const n=e;return"started"===n.state&&n.stop(a),!0}},{id:"GranularSynth",name:"Granular Synth",category:"tone",loadMode:"eager",volumeOffsetDb:-47,create:e=>{const t=e.granular?.sampleUrl||e.parameters?.sampleUrl,a=e.granular;return new le(t?{url:t,grainSize:(a?.grainSize||100)/1e3,overlap:(a?.grainOverlap||50)/100,playbackRate:a?.playbackRate||1,detune:a?.detune||0,reverse:a?.reverse||!1,loop:!0,loopStart:0,loopEnd:0,volume:ZI("GranularSynth",e.volume)}:{grainSize:.1,overlap:.5,playbackRate:1,loop:!0,volume:ZI("GranularSynth",e.volume)})},onTriggerAttack:(e,t,a,n,s)=>(QI(e,t,a,n,s.config,s.period),!0),onTriggerRelease:(e,t,a)=>{const n=e;return"started"===n.state&&n.stop(a),!0}}];Tg.register(JI);const eF={id:"TB303",name:"TB-303 Bass Line",category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:15,controlsComponent:"TB303Controls",hardwareComponent:"TB303Hardware",create:e=>{const t=e.tb303||{...qn},a=(e.volume??-12)+15;const n=new Cr;return n.applyConfig(t),void 0!==a&&(n.output.gain.value=re(a)),n},onTriggerAttack:(e,t,a,n,s)=>("undefined"!=typeof window&&window.TB303_DEBUG_ENABLED,e.triggerAttack(t,a,n,s.accent,s.slide,s.hammer),!0),onTriggerRelease:(e,t,a)=>(e.triggerRelease(a),!0)};Tg.register(eF);const tF={Furnace:0,FurnaceOPN:7,FurnaceOPM:2,FurnaceOPL:10,FurnaceOPLL:12,FurnaceESFM:19,FurnaceOPZ:-14,FurnaceOPNA:6,FurnaceOPNB:7,FurnaceOPL4:9,FurnaceY8950:9,FurnaceVRC7:8,FurnaceOPN2203:-3,FurnaceOPNBB:2,FurnaceNES:7,FurnaceGB:4,FurnaceSNES:-10,FurnacePCE:5,FurnacePSG:3,FurnaceVB:16,FurnaceLynx:3,FurnaceSWAN:4,FurnaceVRC6:3,FurnaceN163:7,FurnaceFDS:3,FurnaceMMC5:37,FurnaceGBA:-10,FurnaceNDS:3,FurnacePOKEMINI:-10,FurnaceC64:6,FurnaceSID6581:6,FurnaceSID8580:6,FurnaceAY:3,FurnaceAY8930:25,FurnaceVIC:-1,FurnaceSAA:6,FurnaceTED:-4,FurnaceVERA:14,FurnaceSCC:9,FurnaceTIA:-7,FurnaceAMIGA:15,FurnacePET:-10,FurnacePCSPKR:-10,FurnaceZXBEEPER:-4,FurnacePOKEY:7,FurnacePONG:-10,FurnacePV1000:3,FurnaceDAVE:15,FurnaceSU:27,FurnacePOWERNOISE:-4,FurnaceSEGAPCM:-5,FurnaceQSOUND:18,FurnaceES5506:80,FurnaceRF5C68:0,FurnaceC140:33,FurnaceK007232:-4,FurnaceK053260:17,FurnaceGA20:3,FurnaceOKI:44,FurnaceYMZ280B:39,FurnaceX1_010:15,FurnaceMSM6258:-10,FurnaceMSM5232:10,FurnaceMULTIPCM:56,FurnaceNAMCO:-5,FurnacePCMDAC:8,FurnaceBUBBLE:3,FurnaceSM8521:9,FurnaceT6W28:3,FurnaceSUPERVISION:-1,FurnaceUPD1771:9,FurnaceSCVTONE:3},aF={0:{algorithm:4,feedback:5,operators:[{enabled:!0,mult:1,tl:20,ar:31,dr:8,d2r:0,sl:2,rr:8,dt:0,am:!1},{enabled:!0,mult:2,tl:30,ar:31,dr:12,d2r:0,sl:4,rr:6,dt:3,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:10,d2r:0,sl:3,rr:8,dt:0,am:!1},{enabled:!0,mult:4,tl:35,ar:28,dr:15,d2r:0,sl:5,rr:10,dt:-1,am:!1}]},1:{algorithm:5,feedback:6,operators:[{enabled:!0,mult:1,tl:15,ar:31,dr:5,d2r:0,sl:1,rr:6,dt:0,am:!1},{enabled:!0,mult:3,tl:40,ar:31,dr:8,d2r:0,sl:3,rr:8,dt:2,am:!1},{enabled:!0,mult:2,tl:35,ar:31,dr:10,d2r:0,sl:4,rr:8,dt:-2,am:!1},{enabled:!0,mult:1,tl:25,ar:31,dr:12,d2r:0,sl:5,rr:10,dt:0,am:!0}]}},nF=[{enabled:!0,mult:1,tl:0,ar:31,dr:0,d2r:0,sl:0,rr:15,dt:0,am:!1},{enabled:!0,mult:2,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:40,ar:31,dr:10,d2r:5,sl:8,rr:8,dt:0,am:!1},{enabled:!0,mult:1,tl:20,ar:31,dr:15,d2r:0,sl:4,rr:10,dt:0,am:!1}];function sF(e,t,a){return e.triggerRelease(a),!0}const rF={FurnaceNES:So.NES,FurnaceGB:So.GB,FurnaceSNES:So.SNES,FurnacePCE:So.PCE,FurnacePSG:So.SMS,FurnaceVB:So.VBOY,FurnaceLynx:So.LYNX,FurnaceSWAN:So.SWAN,FurnaceVRC6:So.VRC6,FurnaceN163:So.N163,FurnaceFDS:So.FDS,FurnaceMMC5:So.MMC5,FurnaceGBA:So.GBA_DMA,FurnaceNDS:So.NDS,FurnacePOKEMINI:So.POKEMINI,FurnaceC64:So.C64_6581,FurnaceSID6581:So.C64_6581,FurnaceSID8580:So.C64_8580,FurnaceAY:So.AY8910,FurnaceAY8930:So.AY8930,FurnaceVIC:So.VIC20,FurnaceSAA:So.SAA1099,FurnaceTED:So.TED,FurnaceVERA:So.VERA,FurnaceSCC:So.SCC,FurnaceTIA:So.TIA,FurnaceAMIGA:So.AMIGA,FurnacePET:So.PET,FurnacePCSPKR:So.PCSPKR,FurnaceZXBEEPER:So.SFX_BEEPER,FurnacePOKEY:So.POKEY,FurnacePONG:So.PONG,FurnacePV1000:So.PV1000,FurnaceDAVE:So.DAVE,FurnaceSU:So.SOUND_UNIT,FurnacePOWERNOISE:So.POWERNOISE,FurnaceSEGAPCM:So.SEGAPCM,FurnaceQSOUND:So.QSOUND,FurnaceES5506:So.ES5506,FurnaceRF5C68:So.RF5C68,FurnaceC140:So.C140,FurnaceK007232:So.K007232,FurnaceK053260:So.K053260,FurnaceGA20:So.GA20,FurnaceOKI:So.MSM6295,FurnaceYMZ280B:So.YMZ280B,FurnaceX1_010:So.X1_010,FurnaceMSM6258:So.MSM6258,FurnaceMSM5232:So.MSM5232,FurnaceMULTIPCM:So.MULTIPCM,FurnaceNAMCO:So.NAMCO,FurnacePCMDAC:So.PCM_DAC,FurnaceBUBBLE:So.BUBSYS_WSG,FurnaceSM8521:So.SM8521,FurnaceT6W28:So.T6W28,FurnaceSUPERVISION:So.SUPERVISION,FurnaceUPD1771:So.UPD1771C,FurnaceSCVTONE:So.UPD1771C},iF=[{id:"FurnaceOPN",name:"Sega Genesis (YM2612)",chipType:io.OPN2},{id:"FurnaceOPM",name:"Yamaha OPM (X68000)",chipType:io.OPM},{id:"FurnaceOPL",name:"OPL3 (AdLib)",chipType:io.OPL3},{id:"FurnaceOPLL",name:"Yamaha OPLL (MSX)",chipType:io.OPLL},{id:"FurnaceESFM",name:"Enhanced OPL3 FM",chipType:io.ESFM},{id:"FurnaceOPZ",name:"Yamaha OPZ (TX81Z)",chipType:io.OPZ},{id:"FurnaceOPNA",name:"YM2608 (PC-98)",chipType:io.OPNA},{id:"FurnaceOPNB",name:"YM2610 (Neo Geo)",chipType:io.OPNB},{id:"FurnaceOPL4",name:"YMF278B (OPL4)",chipType:io.OPL4},{id:"FurnaceY8950",name:"Y8950 (MSX-Audio)",chipType:io.Y8950},{id:"FurnaceVRC7",name:"Konami VRC7",chipType:io.OPLL},{id:"FurnaceOPN2203",name:"YM2203 (PC-88)",chipType:io.OPN},{id:"FurnaceOPNBB",name:"YM2610B (Neo Geo ext.)",chipType:io.OPNB_B}].map(e=>({id:e.id,name:e.name,category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:tF[e.id]??0,controlsComponent:"FurnaceControls",create:t=>function(e,t){const a=aF[t]||{algorithm:0,feedback:0,operators:nF},n=e.furnace||{algorithm:a.algorithm??0,feedback:a.feedback??0,operators:a.operators||[],macros:[],opMacros:[],wavetables:a.wavetables||[]};return new bo({...n,chipType:t})}(t,e.chipType),onTriggerRelease:sF})),oF={id:"Furnace",name:"Furnace",category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:0,controlsComponent:"FurnaceControls",create:e=>{if(!e.furnace)throw new Error("Furnace config required for Furnace synth type");return new bo(e.furnace)},onTriggerRelease:sF},lF=Object.keys(rF).map(e=>({id:e,name:e.replace("Furnace",""),category:"wasm",loadMode:"eager",sharedInstance:!0,useSynthBus:!0,volumeOffsetDb:tF[e]??0,controlsComponent:"FurnaceControls",create:t=>{const a=new jo(rF[e]),n=t.furnace?.furnaceIndex??0;return a.setFurnaceInstrumentIndex(n),t.furnace&&a.uploadInstrumentFromConfig(t.furnace,t.name).catch(e=>{}),a},onTriggerRelease:sF}));Tg.register(oF),Tg.register(iF),Tg.register(lF),Tg.registerLazy(["MAMEAICA","MAMEASC","MAMEAstrocade","MAMEC352","MAMEES5503","MAMEICS2115","MAMEK054539","MAMEMEA8000","MAMERF5C400","MAMESN76477","MAMESNKWave","MAMESP0250","MAMETMS36XX","MAMETMS5220","MAMETR707","MAMEUPD931","MAMEUPD933","MAMEVotrax","MAMEYMF271","MAMEYMOPQ","MAMEVASynth"],()=>ja(()=>import("./mame-B4bH5H6S.js"),__vite__mapDeps([23,3,1,2,4])).then(()=>{})),Tg.registerLazy(["BuzzDTMF","BuzzFreqBomb","BuzzKick","BuzzKickXP","BuzzNoise","BuzzTrilok","Buzz4FM2F","BuzzDynamite6","BuzzM3","BuzzM4","Buzz3o3","Buzz3o3DF","Buzzmachine"],()=>ja(()=>import("./buzzmachines-B6hBq1Tu.js"),__vite__mapDeps([24,3,1,2,4])).then(()=>{})),Tg.registerLazy(["DexedBridge","Vital","Odin2","Surge","TonewheelOrgan","Melodica","Monique","Helm","Sorcer","Amsynth","OBXf","Open303"],()=>ja(()=>import("./vstbridge-DHs7iRfr.js"),__vite__mapDeps([25,1,2,3,4])).then(()=>{})),Tg.registerLazy(["WAM","WAMOBXd","WAMSynth101","WAMTinySynth","WAMFaustFlute"],()=>ja(()=>import("./wam-L6e-L2hU.js"),__vite__mapDeps([26,3,1,2,4])).then(()=>{})),Tg.registerLazy(["HarmonicSynth"],()=>ja(()=>import("./harmonicsynth-B3Om9RRt.js"),__vite__mapDeps([27,1,2,3,4])).then(()=>{})),Tg.registerLazy(["DubSiren","SpaceLaser","V2","V2Speech","Sam","Synare","Dexed","OBXd","CZ101","CEM3394","SCSP","MAMEVFX","VFX","D50","MAMEDOC","MAMERSA","MAMESWP30","DrumKit","Wavetable","ChiptuneModule"],()=>ja(()=>import("./misc-C-Bhc0_j.js"),__vite__mapDeps([28,3,1,2,4])).then(()=>{})),Tg.registerLazy(["ModularSynth"],()=>ja(()=>import("./modularsynth-CzNSrFUn.js"),__vite__mapDeps([29,11,1,2,3,4])).then(()=>{}));const cF=[{id:"Distortion",name:"Distortion",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const t=e.parameters,a=e.wet/100;return new b({distortion:Number(t.drive)||.4,oversample:t.oversample||"none",wet:a})},getDefaultParameters:()=>({drive:.4,oversample:"none"})},{id:"TapeSaturation",name:"Tape Saturation",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const{TapeSaturation:t}=await ja(async()=>{const{TapeSaturation:e}=await Promise.resolve().then(()=>Yr);return{TapeSaturation:e}},void 0),a=e.parameters;return new t({drive:(Number(a.drive)||50)/100,tone:Number(a.tone)||12e3,wet:e.wet/100})},getDefaultParameters:()=>({drive:50,tone:12e3})},{id:"BitCrusher",name:"BitCrusher",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const t=e.parameters,a=new U(Number(t.bits)||4);a.wet.value=e.wet/100;const n=a._bitCrusherWorklet;if(n)for(let s=0;s<50&&!n._worklet;s++)await new Promise(e=>setTimeout(e,20));return a},getDefaultParameters:()=>({bits:4})},{id:"Chebyshev",name:"Chebyshev",category:"tonejs",group:"Distortion",loadMode:"eager",create:async e=>{const t=e.parameters;return new z({order:Number(t.order)||50,oversample:t.oversample||"none",wet:e.wet/100})},getDefaultParameters:()=>({order:50,oversample:"none"})},{id:"Filter",name:"Filter",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const t=e.parameters;return new h({type:t.type||"lowpass",frequency:Number(t.frequency)||5e3,rolloff:Number(t.rolloff)||-12,Q:Number(t.Q)||1,gain:Number(t.gain)||0})},getDefaultParameters:()=>({type:"lowpass",frequency:5e3,rolloff:-12,Q:1,gain:0})},{id:"AutoFilter",name:"Auto Filter",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const t=e.parameters,a=new H({frequency:Number(t.frequency)||1,baseFrequency:Number(t.baseFrequency)||200,octaves:Number(t.octaves)||2.6,filter:{type:t.filterType||"lowpass",rolloff:-12,Q:1},wet:e.wet/100});return a.start(),a},getDefaultParameters:()=>({frequency:1,baseFrequency:200,octaves:2.6,filterType:"lowpass"})},{id:"AutoWah",name:"Auto Wah",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const t=e.parameters;return new G({baseFrequency:Number(t.baseFrequency)||100,octaves:Number(t.octaves)||6,sensitivity:Number(t.sensitivity)||0,Q:Number(t.Q)||2,gain:Number(t.gain)||2,follower:Number(t.follower)||.1,wet:e.wet/100})},getDefaultParameters:()=>({baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.1})},{id:"DubFilter",name:"Dub Filter",category:"tonejs",group:"Filter",loadMode:"eager",create:async e=>{const{DubFilterEffect:t}=await ja(async()=>{const{DubFilterEffect:e}=await Promise.resolve().then(()=>Ni);return{DubFilterEffect:e}},void 0),a=e.parameters;return new t({cutoff:Number(a.cutoff)||20,resonance:Number(a.resonance)||30,gain:Number(a.gain)||1,wet:e.wet/100})},getDefaultParameters:()=>({cutoff:20,resonance:30,gain:1})},{id:"Reverb",name:"Reverb",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const t=e.parameters,a=new g({decay:Number(t.decay)||1.5,preDelay:Number(t.preDelay)||.01,wet:e.wet/100});return await a.ready,a},getDefaultParameters:()=>({decay:1.5,preDelay:.01})},{id:"JCReverb",name:"JC Reverb",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const t=e.parameters,a=new j({roomSize:Number(t.roomSize)||.5,wet:e.wet/100}),n=a._feedbackCombFilters;if(n?.length)for(let s=0;s<50&&!n.every(e=>e._worklet);s++)await new Promise(e=>setTimeout(e,20));return a},getDefaultParameters:()=>({roomSize:.5})},{id:"Delay",name:"Delay",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["time"],create:async e=>{const t=e.parameters;return new _({delayTime:Number(t.time)||.25,feedback:Number(t.feedback)||.5,wet:e.wet/100})},getDefaultParameters:()=>({time:.25,feedback:.5})},{id:"FeedbackDelay",name:"Feedback Delay",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["time"],create:async e=>{const t=e.parameters;return new _({delayTime:Number(t.time)||.25,feedback:Number(t.feedback)||.5,wet:e.wet/100})},getDefaultParameters:()=>({time:.25,feedback:.5})},{id:"PingPongDelay",name:"Ping Pong Delay",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["time"],create:async e=>{const t=e.parameters;return new L({delayTime:Number(t.time)||.25,feedback:Number(t.feedback)||.5,wet:e.wet/100})},getDefaultParameters:()=>({time:.25,feedback:.5})},{id:"SpaceEcho",name:"Space Echo",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["rate"],create:async e=>{const{SpaceEchoEffect:t}=await ja(async()=>{const{SpaceEchoEffect:e}=await Promise.resolve().then(()=>ci);return{SpaceEchoEffect:e}},void 0),a=e.parameters;return new t({mode:Number(a.mode)||4,rate:Number(a.rate)||300,intensity:Number(a.intensity)||.5,echoVolume:Number(a.echoVolume)||.8,reverbVolume:Number(a.reverbVolume)||.3,bass:Number(a.bass)||0,treble:Number(a.treble)||0,wet:e.wet/100})},getDefaultParameters:()=>({mode:4,rate:300,intensity:.5,echoVolume:.8,reverbVolume:.3,bass:0,treble:0})},{id:"SpaceyDelayer",name:"Spacey Delayer",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["firstTap"],create:async e=>{const{SpaceyDelayerEffect:t}=await ja(async()=>{const{SpaceyDelayerEffect:e}=await Promise.resolve().then(()=>fi);return{SpaceyDelayerEffect:e}},void 0),a=e.parameters;return new t({firstTap:Number(a.firstTap)||250,tapSize:Number(a.tapSize)||150,feedback:Number(a.feedback)||40,multiTap:null!=a.multiTap?Number(a.multiTap):1,tapeFilter:Number(a.tapeFilter)||0,wet:e.wet/100})},getDefaultParameters:()=>({firstTap:250,tapSize:150,feedback:40,multiTap:1,tapeFilter:0})},{id:"RETapeEcho",name:"RE Tape Echo",category:"tonejs",group:"Reverb & Delay",loadMode:"eager",bpmSyncParams:["repeatRate"],create:async e=>{const{RETapeEchoEffect:t}=await ja(async()=>{const{RETapeEchoEffect:e}=await Promise.resolve().then(()=>wi);return{RETapeEchoEffect:e}},void 0),a=e.parameters;return new t({mode:null!=a.mode?Number(a.mode):3,repeatRate:Number(a.repeatRate)||.5,intensity:Number(a.intensity)||.5,echoVolume:Number(a.echoVolume)||.8,wow:Number(a.wow)||0,flutter:Number(a.flutter)||0,dirt:Number(a.dirt)||0,inputBleed:null!=a.inputBleed?Number(a.inputBleed):0,loopAmount:Number(a.loopAmount)||0,playheadFilter:null!=a.playheadFilter?Number(a.playheadFilter):1,wet:e.wet/100})},getDefaultParameters:()=>({mode:3,repeatRate:.5,intensity:.5,echoVolume:.8,wow:0,flutter:0,dirt:0,inputBleed:0,loopAmount:0,playheadFilter:1})},{id:"Chorus",name:"Chorus",category:"tonejs",group:"Modulation",loadMode:"eager",bpmSyncParams:["frequency"],create:async e=>{const t=e.parameters,a=new $({frequency:Number(t.frequency)||1.5,delayTime:Number(t.delayTime)||3.5,depth:Number(t.depth)||.7,wet:e.wet/100});return a.start(),a},getDefaultParameters:()=>({frequency:1.5,delayTime:3.5,depth:.7})},{id:"Phaser",name:"Phaser",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters;return new w({frequency:Number(t.frequency)||.5,octaves:Number(t.octaves)||3,baseFrequency:Number(t.baseFrequency)||350,wet:e.wet/100})},getDefaultParameters:()=>({frequency:.5,octaves:3,baseFrequency:350})},{id:"Tremolo",name:"Tremolo",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters,a=new q({frequency:Number(t.frequency)||10,depth:Number(t.depth)||.5,wet:e.wet/100});return a.start(),a},getDefaultParameters:()=>({frequency:10,depth:.5})},{id:"Vibrato",name:"Vibrato",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters;return new K({frequency:Number(t.frequency)||5,depth:Number(t.depth)||.1,wet:e.wet/100})},getDefaultParameters:()=>({frequency:5,depth:.1})},{id:"AutoPanner",name:"Auto Panner",category:"tonejs",group:"Modulation",loadMode:"eager",create:async e=>{const t=e.parameters,a=new W({frequency:Number(t.frequency)||1,depth:Number(t.depth)||1,wet:e.wet/100});return a.start(),a},getDefaultParameters:()=>({frequency:1,depth:1})},{id:"BiPhase",name:"Bi-Phase",category:"tonejs",group:"Modulation",loadMode:"eager",bpmSyncParams:["rateA"],create:async e=>{const{BiPhaseEffect:t}=await ja(async()=>{const{BiPhaseEffect:e}=await Promise.resolve().then(()=>Si);return{BiPhaseEffect:e}},void 0),a=e.parameters;return new t({rateA:Number(a.rateA)||.5,depthA:Number(a.depthA)||.6,rateB:Number(a.rateB)||4,depthB:Number(a.depthB)||.4,feedback:Number(a.feedback)||.3,routing:1===Number(a.routing)?"series":"parallel",wet:e.wet/100})},getDefaultParameters:()=>({rateA:.5,depthA:.6,rateB:4,depthB:.4,feedback:.3,routing:0})},{id:"Compressor",name:"Compressor",category:"tonejs",group:"Dynamics",loadMode:"eager",create:async e=>{const t=e.parameters;return new S({threshold:Number(t.threshold)||-24,ratio:Number(t.ratio)||12,attack:Number(t.attack)||.003,release:Number(t.release)||.25})},getDefaultParameters:()=>({threshold:-24,ratio:12,attack:.003,release:.25})},{id:"SidechainCompressor",name:"Sidechain Compressor",category:"tonejs",group:"Dynamics",loadMode:"eager",create:async e=>{const{SidechainCompressor:t}=await ja(async()=>{const{SidechainCompressor:e}=await Promise.resolve().then(()=>so);return{SidechainCompressor:e}},void 0),a=e.parameters;return new t({threshold:Number(a.threshold)??-24,ratio:Number(a.ratio)??4,attack:Number(a.attack)??.003,release:Number(a.release)??.25,knee:Number(a.knee)??6,sidechainGain:(Number(a.sidechainGain)??100)/100,wet:e.wet/100})},getDefaultParameters:()=>({threshold:-24,ratio:4,attack:.003,release:.25,knee:6,sidechainGain:100})},{id:"EQ3",name:"3-Band EQ",category:"tonejs",group:"EQ & Stereo",loadMode:"eager",create:async e=>{const t=e.parameters;return new f({low:Number(t.low)||0,mid:Number(t.mid)||0,high:Number(t.high)||0,lowFrequency:Number(t.lowFrequency)||400,highFrequency:Number(t.highFrequency)||2500})},getDefaultParameters:()=>({low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500})},{id:"StereoWidener",name:"Stereo Widener",category:"tonejs",group:"EQ & Stereo",loadMode:"eager",create:async e=>{const t=e.parameters;return new R({width:Number(t.width)||.5})},getDefaultParameters:()=>({width:.5})},{id:"FrequencyShifter",name:"Frequency Shifter",category:"tonejs",group:"Pitch",loadMode:"eager",create:async e=>{const t=e.parameters;return new V({frequency:Number(t.frequency)||0,wet:e.wet/100})},getDefaultParameters:()=>({frequency:0})},{id:"PitchShift",name:"Pitch Shift",category:"tonejs",group:"Pitch",loadMode:"eager",create:async e=>{const t=e.parameters;return new B({pitch:Number(t.pitch)||0,windowSize:Number(t.windowSize)||.1,delayTime:Number(t.delayTime)||0,feedback:Number(t.feedback)||0,wet:e.wet/100})},getDefaultParameters:()=>({pitch:0,windowSize:.1,delayTime:0,feedback:0})}];Ag.register(cF);const uF=[{id:"MoogFilter",name:"Moog Filter",category:"wasm",group:"Filter",loadMode:"eager",create:async e=>{const{MoogFilterEffect:t,MoogFilterModel:a,MoogFilterMode:n}=await ja(async()=>{const{MoogFilterEffect:e,MoogFilterModel:t,MoogFilterMode:a}=await Promise.resolve().then(()=>Oi);return{MoogFilterEffect:e,MoogFilterModel:t,MoogFilterMode:a}},void 0),s=e.parameters;return new t({cutoff:Number(s.cutoff)||1e3,resonance:(Number(s.resonance)||10)/100,drive:Number(s.drive)||1,model:Number(s.model)||a.Hyperion,filterMode:Number(s.filterMode)||n.LP4,wet:e.wet/100})},getDefaultParameters:()=>({cutoff:1e3,resonance:10,drive:1,model:0,filterMode:0})},{id:"MVerb",name:"MVerb Plate Reverb",category:"wasm",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const{MVerbEffect:t}=await ja(async()=>{const{MVerbEffect:e}=await Promise.resolve().then(()=>Li);return{MVerbEffect:e}},void 0),a=e.parameters;return new t({damping:Number(a.damping),density:Number(a.density),bandwidth:Number(a.bandwidth),decay:Number(a.decay),predelay:Number(a.predelay),size:Number(a.size),gain:Number(a.gain),mix:Number(a.mix),earlyMix:Number(a.earlyMix),wet:e.wet/100})},getDefaultParameters:()=>({damping:.5,density:.5,bandwidth:.5,decay:.7,predelay:0,size:.8,gain:1,mix:.4,earlyMix:.5})},{id:"Leslie",name:"Leslie Rotary Speaker",category:"wasm",group:"Modulation",loadMode:"eager",create:async e=>{const{LeslieEffect:t}=await ja(async()=>{const{LeslieEffect:e}=await Promise.resolve().then(()=>Wi);return{LeslieEffect:e}},void 0),a=e.parameters;return new t({speed:Number(a.speed),hornRate:Number(a.hornRate),drumRate:Number(a.drumRate),hornDepth:Number(a.hornDepth),drumDepth:Number(a.drumDepth),doppler:Number(a.doppler),width:Number(a.width),acceleration:Number(a.acceleration),wet:e.wet/100})},getDefaultParameters:()=>({speed:0,hornRate:6.8,drumRate:5.9,hornDepth:.7,drumDepth:.5,doppler:.5,width:.8,acceleration:.5})},{id:"SpringReverb",name:"Spring Reverb",category:"wasm",group:"Reverb & Delay",loadMode:"eager",create:async e=>{const{SpringReverbEffect:t}=await ja(async()=>{const{SpringReverbEffect:e}=await Promise.resolve().then(()=>Xi);return{SpringReverbEffect:e}},void 0),a=e.parameters;return new t({decay:Number(a.decay),damping:Number(a.damping),tension:Number(a.tension),mix:Number(a.mix),drip:Number(a.drip),diffusion:Number(a.diffusion),wet:e.wet/100})},getDefaultParameters:()=>({decay:.6,damping:.4,tension:.5,mix:.35,drip:.5,diffusion:.7})}];Ag.register(uF),Ag.registerLazy(["BuzzDistortion","BuzzSVF","BuzzDelay","BuzzChorus","BuzzCompressor","BuzzOverdrive","BuzzDistortion2","BuzzCrossDelay","BuzzPhilta","BuzzDist2","BuzzFreeverb","BuzzFreqShift","BuzzNotch","BuzzStereoGain","BuzzSoftSat","BuzzLimiter","BuzzExciter","BuzzMasterizer","BuzzStereoDist","BuzzWhiteChorus","BuzzZfilter","BuzzChorus2","BuzzPanzerDelay"],()=>ja(()=>import("./buzzmachine-ByKrzhi3.js"),__vite__mapDeps([30,1,2,3,4])).then(()=>{})),Ag.registerLazy(["WAMBigMuff","WAMTS9","WAMDistoMachine","WAMQuadraFuzz","WAMVoxAmp","WAMStonePhaser","WAMPingPongDelay","WAMFaustDelay","WAMPitchShifter","WAMGraphicEQ","WAMPedalboard"],()=>ja(()=>import("./wam-D-6AizHF.js"),__vite__mapDeps([31,1,2,3,4])).then(()=>{})),Ag.registerLazy(["Neural"],()=>ja(()=>import("./neural-C3FmZqAj.js"),__vite__mapDeps([32,1,2,3,4])).then(()=>{}));const dF=["ChiptuneModule","Player","Sampler","DrumKit"];async function pF(e){const t=A_[e],a={synthType:e,name:t?.name||e,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,loadTimeMs:0};if(dF.includes(e))return a.error="Skipped (requires external resources)",a;const n=performance.now();try{const t={id:999,name:`Test ${e}`,type:"synth",synthType:e,effects:[],volume:-12,pan:0},r=Fg.createInstrument(t);if(a.loadTimeMs=performance.now()-n,!r)return a.error="createInstrument returned null",a;a.loaded=!0;const i=new pe("waveform",256);if(is(r)){const e=hs(i);e&&r.output.connect(e)}else r.connect(i);i.toDestination();try{"triggerAttack"in r&&"function"==typeof r.triggerAttack?(r.triggerAttack("C4",Z(),.8),a.noteOnWorked=!0):"triggerAttackRelease"in r&&"function"==typeof r.triggerAttackRelease&&(r.triggerAttackRelease("C4","8n",Z(),.8),a.noteOnWorked=!0)}catch(s){a.error=`Note trigger error: ${s}`}await new Promise(e=>setTimeout(e,100));try{const e=i.getValue().some(e=>Math.abs(e)>.001);a.producedSound=e}catch{}try{"triggerRelease"in r&&"function"==typeof r.triggerRelease&&(r.triggerRelease("C4",Z()),a.noteOffWorked=!0)}catch{}await new Promise(e=>setTimeout(e,50));try{if(is(r))try{r.output.disconnect()}catch{}else r.disconnect();i.disconnect(),"dispose"in r&&"function"==typeof r.dispose&&r.dispose(),i.dispose()}catch{}}catch(s){a.error=`${s}`,a.loadTimeMs=performance.now()-n}return a}async function mF(e={}){const{verbose:t=!0,filter:a,timeout:n=5e3}=e;await ye();const s=a?I_.filter(a):I_,r=[];for(const u of s){const e=await Promise.race([pF(u),new Promise(e=>setTimeout(()=>e({synthType:u,name:A_[u]?.name||u,loaded:!1,producedSound:!1,noteOnWorked:!1,noteOffWorked:!1,error:"Timeout",loadTimeMs:n}),n))]);if(r.push(e),t){e.loaded&&e.producedSound}}const i=r.filter(e=>e.loaded&&e.noteOnWorked),o=r.filter(e=>!e.loaded&&!dF.includes(e.synthType)),l=r.filter(e=>dF.includes(e.synthType)),c={total:r.length,passed:i.length,failed:o.length,skipped:l.length,results:r,failedSynths:o.map(e=>e.synthType),passedSynths:i.map(e=>e.synthType),timestamp:(new Date).toISOString()};if(t){c.failedSynths.length>0&&c.failedSynths.forEach(e=>{r.find(t=>t.synthType===e)});const e=r.filter(e=>e.loaded&&!e.producedSound&&!dF.includes(e.synthType));e.length>0&&e.forEach(e=>{})}return c}if("undefined"!=typeof window){const e=window;e.testAllSynths=mF,e.testToneSynths=async function(){const e=["Synth","MonoSynth","DuoSynth","FMSynth","AMSynth","PluckSynth","MetalSynth","MembraneSynth","NoiseSynth","PolySynth"];return mF({filter:t=>e.includes(t)})},e.testCustomSynths=async function(){const e=["TB303","DubSiren","SpaceLaser","Synare","V2","Sam","Dexed","OBXd","SuperSaw","Organ","DrumMachine","ChipSynth","PWMSynth","WobbleBass","StringMachine","FormantSynth","GranularSynth","Wavetable"];return mF({filter:t=>e.includes(t)})},e.testFurnaceSynths=async function(){return mF({filter:e=>e.startsWith("Furnace"),timeout:1e4})},e.testBuzzmachineSynths=async function(){return mF({filter:e=>e.startsWith("Buzz")})},e.quickTestSynths=async function(){return mF({timeout:2e3})}}i(),Hg.subscribe(e=>{try{Qg().setAudioLatency(e.audioLatency)}catch{}}),window.addEventListener("error",e=>{e.error?.message?.includes("already disposed")&&e.preventDefault()}),window.addEventListener("unhandledrejection",e=>{"InvalidStateError"!==e.reason?.name||e.preventDefault()}),Da.createRoot(document.getElementById("root")).render(Ea.jsx(s.StrictMode,{children:Ea.jsx(HI,{children:Ea.jsx(BS,{children:Ea.jsx(WI,{})})})}));export{Zi as $,hn as A,mn as B,Mn as C,Dn as D,Sn as E,io as F,kn as G,qn as H,bn as I,I_ as J,A_ as K,bO as L,gv as M,Kn as N,Hn as O,Wn as P,Vv as Q,j_ as R,O_ as S,Zg as T,En as U,Bn as V,zn as W,Gn as X,Un as Y,jn as Z,vS as _,lo as a,Hg as a$,Qi as a0,ZA as a1,to as a2,bg as a3,ao as a4,Og as a5,Mx as a6,Gw as a7,gx as a8,CT as a9,nO as aA,zl as aB,Hb as aC,Wb as aD,Ul as aE,jl as aF,Ar as aG,Ya as aH,$g as aI,ja as aJ,RS as aK,gg as aL,wg as aM,pn as aN,Eo as aO,jr as aP,Rn as aQ,Cn as aR,yn as aS,fn as aT,On as aU,In as aV,kv as aW,Vn as aX,Vr as aY,qg as aZ,Eg as a_,Sx as aa,Rk as ab,Gk as ac,Oh as ad,cx as ae,_k as af,Ik as ag,Ok as ah,hS as ai,Hw as aj,pS as ak,uS as al,on as am,ln as an,Wa as ao,Ek as ap,HM as aq,KM as ar,qM as as,qk as at,Pk as au,fv as av,Ww as aw,L_ as ax,aO as ay,Tn as az,Bv as b,Ag as b$,V_ as b0,z_ as b1,G_ as b2,W_ as b3,H_ as b4,K_ as b5,q_ as b6,$_ as b7,X_ as b8,Y_ as b9,Zd as bA,Ud as bB,Wl as bC,Pg as bD,Sg as bE,us as bF,vs as bG,bs as bH,gs as bI,Wo as bJ,Ho as bK,Ll as bL,Vl as bM,Bl as bN,Ko as bO,Oc as bP,Pu as bQ,Ru as bR,$u as bS,Yu as bT,bd as bU,wd as bV,Or as bW,Fd as bX,Vd as bY,Bo as bZ,ni as b_,Z_ as ba,Q_ as bb,J_ as bc,BM as bd,Jn as be,Qn as bf,Tg as bg,mg as bh,sg as bi,Ly as bj,ky as bk,ef as bl,Uh as bm,Ih as bn,bh as bo,_m as bp,km as bq,mm as br,lm as bs,$p as bt,Hp as bu,Sp as bv,xp as bw,gp as bx,lp as by,ip as bz,Xv as c,Gl as c0,go as c1,oi as c2,Ep as c3,vg as c4,Mg as c5,Kv as d,Zv as e,$v as f,Qg as g,IT as h,OT as i,Ea as j,AT as k,TT as l,_T as m,px as n,ET as o,PT as p,F_ as q,Pn as r,An as s,_n as t,ob as u,Nn as v,wn as w,ss as x,xn as y,vn as z};
