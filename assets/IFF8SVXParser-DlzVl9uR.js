const t=[0,1,3,6,10,15,21,28,-28,-21,-15,-10,-6,-3,-1,0];function e(t){return Math.max(-128,Math.min(127,t))}function n(t,e){return String.fromCharCode(t.getUint8(e),t.getUint8(e+1),t.getUint8(e+2),t.getUint8(e+3))}function r(r){if(r.byteLength<12)throw new Error("File too short to be an IFF/8SVX file");const o=new DataView(r),a=new Uint8Array(r);if("FORM"!==n(o,0))throw new Error("Not an IFF file — missing FORM header");if("8SVX"!==n(o,8))throw new Error(`Not an 8SVX file — FORM type is "${n(o,8)}"`);const i=8+o.getUint32(4,!1);let f="",s=8287,h=0,g=0,l=0,c=1,b=1,m=null,w=12;for(;w+8<=i&&w+8<=r.byteLength;){const i=n(o,w),u=o.getUint32(w+4,!1),y=w+8,U=y+u;if(w=U+(1&u),U>r.byteLength)break;switch(i){case"VHDR":if(u<20)break;h=o.getUint32(y,!1),g=o.getUint32(y+4,!1),s=o.getUint16(y+12,!1),b=o.getUint8(y+14),l=o.getUint8(y+15);c=o.getUint32(y+16,!1)/65536;break;case"NAME":{let t=u;for(;t>0&&0===a[y+t-1];)t--;f=String.fromCharCode(...Array.from(a.subarray(y,y+t)));break}case"BODY":if(1===l){const n=new Int8Array(2*u);let r=0,o=0;for(let i=y;i<U;i++){const f=a[i];r=e(r+t[f>>4&15]),n[o++]=r,r=e(r+t[15&f]),n[o++]=r}m=n}else{const t=a.subarray(y,U);m=new Int8Array(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength))}}}if(!m)throw new Error("8SVX file has no BODY chunk — no sample data found");const u=h<m.length?h:0;return{name:f,sampleRate:s>0?s:8287,pcm:m,loopStart:u,loopEnd:g>0&&u+g<=m.length?u+g:0,hasLoop:g>1,volume:Math.min(1,Math.max(0,c)),octaves:Math.max(1,b)}}export{r as parseIFF8SVX};
