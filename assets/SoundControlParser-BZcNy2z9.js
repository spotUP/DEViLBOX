import{aB as t}from"./index-zx6LJBPK.js";import"./vendor-react-DkDaD07v.js";import"./vendor-utils-XMmR-oGw.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";function n(t,n){return t[n]}function e(t,n){return t[n]<<8|t[n+1]}function o(t,n){const o=e(t,n);return o<32768?o:o-65536}function r(t,n){return(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3])>>>0}function s(t,n,e){let o="";for(let r=0;r<e;r++){const e=t[n+r];if(0===e)break;o+=String.fromCharCode(e)}return o.trimEnd()}function l(t){return Math.round(3546895/(2*t))}const i=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113];function a(t){if(0===t)return 0;const n=t>>4&15,e=15&t;if(0===n||n>8||e>9)return 0;const o=12*(n-1)+Math.round(e/10*12)+13;return Math.max(1,Math.min(96,o))}function u(t){if(0===t)return 0;const n=t-1;return n<i.length?Math.max(1,Math.min(96,n+13)):Math.max(1,Math.min(96,t))}function f(t){if(t.length<576)return!1;const n=r(t,16);if(0===n||n>=32768)return!1;if(1&n)return!1;const o=n+64-2;return!(o+6>t.length)&&(65535===e(t,o)&&1024===r(t,o+2))}function m(i,m){if(!f(i))return null;const c=s(i,0,16).trim()||m.replace(/\.[^/.]+$/,""),h=r(i,16),g=r(i,20),d=r(i,24);r(i,28);const y=e(i,34);let v=6;y>=3&&(v=e(i,36)||6,(v<1||v>31)&&(v=6));const S=y>=3,C=64+h,M=C+g,T=[];for(let t=0;t<256;t++){const n=64+2*t;n+2>i.length?T.push(0):T.push(e(i,n))}const w=new Array(256).fill(null);for(let t=0;t<256;t++){const e=T[t];if(0===e)continue;const o=64+e;if(o+10>i.length)continue;let r=o+16;const s=[];for(;!(r+2>i.length);){const t=n(i,r++),e=n(i,r++);if(255===t){s.push({wait:0,note:0,sampleOrInstr:0,volume:0,isNote:!1,isEnd:!0,isWait:!1});break}if(0===t)s.push({wait:e,note:0,sampleOrInstr:0,volume:0,isNote:!1,isEnd:!1,isWait:!0});else{if(r+2>i.length)break;n(i,r++);const o=n(i,r++),l=128===o?64:Math.min(64,127&o),a=e;s.push({wait:0,note:t,sampleOrInstr:a,volume:l,isNote:!0,isEnd:!1,isWait:!1})}}w[t]=s}const I=[];for(let t=0;t<256;t++){const n=C+4*t;n+4>i.length?I.push(0):I.push(r(i,n))}const $=new Array(256).fill(null);let E=0;for(let t=0;t<256;t++){const n=I[t];if(0===n)continue;const l=C+n;if(l+64>i.length)continue;const a=s(i,l+0,16),u=e(i,l+16),f=e(i,l+18),m=e(i,l+20),p=o(i,l+42),c=r(i,l+60),h=c>64?c-64:0;let g=null;const d=l+64;h>0&&d+h<=i.length&&(g=i.slice(d,d+h)),$[t]={name:a,length:u,loopStart:f,loopEnd:m,noteTranspose:p,sampleData:g},E=t}const P=$.slice(0,E+1),x=Math.floor(d/12),A=[];for(let t=0;t<x;t++){const e=M+12*t,o=[];for(let t=0;t<6;t++)e+2*t+1>i.length?o.push(0):o.push(n(i,e+2*t));A.push(o)}const D=[];let O=1;const j=new Map;for(let n=0;n<=E;n++){const e=P[n];if(e){const o=l(214);if(e.sampleData&&e.sampleData.length>0){const r=e.loopEnd>e.loopStart,s=r?2*e.loopStart:0,l=r?2*e.loopEnd:0;D.push(t(O,e.name||`Sample ${n}`,e.sampleData,64,o,s,l))}else D.push({id:O,name:e.name||`Sample ${n}`,type:"synth",synthType:"Synth",effects:[],volume:0,pan:0})}else D.push({id:O,name:`Sample ${n}`,type:"synth",synthType:"Synth",effects:[],volume:0,pan:0});j.set(n,O),O++}function b(t){const n=w[t];if(!n)return[{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}];const e=[];for(const o of n){if(o.isEnd)break;if(o.isWait)for(let t=0;t<Math.max(1,o.wait);t++)e.push(p());else if(o.isNote){const t=S?u(o.note):a(o.note),n=o.sampleOrInstr,r=j.get(n)??0;e.push({note:t,instrument:r,volume:o.volume>0?o.volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0})}}return 0===e.length&&e.push({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}),e}const k=[],F=[-50,50,50,-50,-50,50];for(let t=0;t<x;t++){const n=A[t],e=[];let o=1;for(let t=0;t<6;t++){const r=b(n[t]??0);e.push(r),r.length>o&&(o=r.length)}for(let t=0;t<6;t++)for(;e[t].length<o;)e[t].push(p());k.push({id:`pattern-${t}`,name:`Position ${t}`,length:o,channels:e.map((t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:F[n]??0,instrumentId:null,color:null,rows:t})),importMetadata:{sourceFormat:"SC",sourceFile:m,importedAt:(new Date).toISOString(),originalChannelCount:6,originalPatternCount:x,originalInstrumentCount:D.length}})}return 0===k.length&&k.push(function(t,n,e){return{id:"pattern-0",name:"Pattern 0",length:e,channels:Array.from({length:n},(t,n)=>({id:`channel-${n}`,name:`Channel ${n+1}`,muted:!1,solo:!1,collapsed:!1,volume:100,pan:0,instrumentId:null,color:null,rows:Array.from({length:e},()=>({note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}))})),importMetadata:{sourceFormat:"SC",sourceFile:t,importedAt:(new Date).toISOString(),originalChannelCount:n,originalPatternCount:0,originalInstrumentCount:0}}}(m,6,64)),{name:c,format:"SC",patterns:k,instruments:D,songPositions:k.map((t,n)=>n),songLength:k.length,restartPosition:0,numChannels:6,initialSpeed:v,initialBPM:125,linearPeriods:!1}}function p(){return{note:0,instrument:0,volume:0,effTyp:0,eff:0,effTyp2:0,eff2:0}}export{f as isSoundControlFormat,m as parseSoundControlFile};
