!function(){"use strict";const e=80,t=["#06b6d4","#a855f7","#22c55e","#f59e0b","#ec4899","#3b82f6","#ef4444","#14b8a6","#f97316","#8b5cf6","#10b981","#eab308","#d946ef","#0ea5e9","#fb923c","#84cc16"],l="#64748b";let n=null,o=null,i=1,s=[],a=16,c=0,r=new Set,f=800,h=null,d=!0;function b(t){if(s=t.notes,a=t.horizontalZoom,c=t.scrollX,r=new Set(t.selectedNotes),f=t.containerWidth,n){const t=Math.ceil(f*i),l=Math.ceil(e*i);n.width===t&&n.height===l||(n.width=t,n.height=l)}}self.onmessage=g=>{const u=g.data;switch(u.type){case"init":n=u.canvas,i=u.dpr,b(u.state),n.width=Math.ceil(f*i),n.height=Math.ceil(e*i),o=n.getContext("2d"),d=!0,function(){const n=()=>{d&&function(){if(!o)return;d=!1;const n=f;o.setTransform(i,0,0,i,0,0),o.fillStyle="#1a1a1c",o.fillRect(0,0,n,e),o.strokeStyle="rgba(255,255,255,0.06)",o.lineWidth=.5;for(const t of[32,64,96,127]){const l=e-t/127*e;o.beginPath(),o.moveTo(0,l),o.lineTo(n,l),o.stroke(),o.fillStyle="rgba(255,255,255,0.15)",o.font="8px monospace",o.textAlign="left",o.textBaseline="bottom",o.fillText(String(t),2,l)}const b=a,g=c;let u=0;for(const i of s){const s=(i.startRow-g)*b,a=(i.endRow-i.startRow)*b;if(s+a<0||s>n)continue;u++;const c=i.velocity/127*e,f=Math.max(3,a-1),d=r.has(i.id),m=h===i.id,x=null!==i.instrument?t[i.instrument%t.length]:l;o.globalAlpha=d?1:m?.9:.7,o.fillStyle=x;const y=e-c,T=Math.min(3,f/2,c/2);o.beginPath(),o.moveTo(s+T,y),o.lineTo(s+f-T,y),o.quadraticCurveTo(s+f,y,s+f,y+T),o.lineTo(s+f,e),o.lineTo(s,e),o.lineTo(s,y+T),o.quadraticCurveTo(s,y,s+T,y),o.closePath(),o.fill(),d&&(o.strokeStyle="#ffffff",o.lineWidth=1,o.stroke()),o.globalAlpha=1}o.fillStyle="rgba(255,255,255,0.4)",o.font="bold 10px Inter, system-ui, sans-serif",o.textAlign="left",o.textBaseline="top",o.fillText("VELOCITY",6,6),(0===s.length||0===u)&&(o.fillStyle="rgba(255,255,255,0.3)",o.font="11px Inter, system-ui, sans-serif",o.textAlign="center",o.textBaseline="middle",0===s.length?o.fillText("No notes in pattern - add notes above to see velocity bars",n/2,40):o.fillText("Scroll to see velocity bars for notes",n/2,40))}(),requestAnimationFrame(n)};requestAnimationFrame(n)}(),self.postMessage({type:"ready"});break;case"state":b(u.state),d=!0;break;case"hover":h!==u.noteId&&(h=u.noteId,d=!0);break;case"resize":i=u.dpr,f=u.w,n&&(n.width=Math.ceil(f*i),n.height=Math.ceil(e*i)),d=!0}}}();
