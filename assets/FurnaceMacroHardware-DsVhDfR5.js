import{j as e}from"./index-zx6LJBPK.js";import{r as n}from"./vendor-utils-XMmR-oGw.js";import{a as r}from"./EffectChain-C3LgFJxX.js";import"./vendor-react-DkDaD07v.js";import"./vendor-tone-CADp_hfL.js";import"./vendor-ui-uomqNFY-.js";import"./useVisualizationAnimation-D37DdYyX.js";import"./sortable.esm-Nw3Rboz6.js";const a=0,t=1,o=2,c=3,s=4,i=5,m=6,u=7,d=0,f=1,l=2,h=3,p=4,g={[a]:{min:0,max:15},[t]:{min:-127,max:127},[o]:{min:0,max:3},[c]:{min:0,max:63},[s]:{min:-127,max:127},[i]:{min:0,max:15},[m]:{min:0,max:15},[u]:{min:0,max:15}};function _(e,n){const r=new Uint8Array(264),a=(t=e.macros,o=n,t.find(e=>e.type===o||e.code===o));var t,o;const c=g[n]??{min:0,max:15};if(r[0]=255&n,r[1]=a?Math.min(a.data.length,255):0,r[2]=a&&a.loop>=0&&a.loop<255?a.loop:255,r[3]=a&&a.release>=0&&a.release<255?a.release:255,a&&a.data.length>0){const e=Math.min(a.data.length,256);for(let n=0;n<e;n++)r[4+n]=255&a.data[n]}return r[260]=255&c.min,r[261]=255&c.max,r[262]=a?a.mode??0:0,r[263]=0,r}const x=({config:t,activeMacro:o,onChange:c})=>{const s=n.useRef(t),i=n.useRef(c),m=n.useRef(o??a);n.useEffect(()=>{s.current=t},[t]),n.useEffect(()=>{i.current=c},[c]),n.useEffect(()=>{void 0!==o&&(m.current=o)},[o]);const u=n.useMemo(()=>_(t,m.current),[t]),g=n.useCallback(e=>{e.onTabChange=n=>{if(n<0||n>=8)return;m.current=n;const r=_(s.current,n),a=e._furnace_macro_load_config;if("function"==typeof a){const n=e._malloc(r.length);n&&(e.HEAPU8.set(r,n),a.call(e,n,r.length),e._free(n))}},e.onMacroEdit=(e,n)=>{const r={...s.current},a=[...r.macros],t=m.current;let o=a.findIndex(e=>e.type===t||e.code===t);o<0&&(a.push({type:t,code:t,data:[],loop:-1,release:-1,mode:0}),o=a.length-1);const c={...a[o]},u=[...c.data];for(;u.length<=e;)u.push(0);u[e]=n,c.data=u,a[o]=c,r.macros=a,s.current=r,i.current(r)},e.onParamChange=(e,n)=>{const r={...s.current},a=[...r.macros],t=m.current;let o=a.findIndex(e=>e.type===t||e.code===t);if(o<0)return;const c={...a[o]};switch(e){case d:return;case f:c.loop=255===n?-1:n;break;case l:c.release=255===n?-1:n;break;case h:{const e=[...c.data];if(n<e.length)e.length=n;else for(;e.length<n;)e.push(0);c.data=e;break}case p:c.mode=n;break;default:return}a[o]=c,r.macros=a,s.current=r,i.current(r)}},[]);return e.jsxDEV(r,{imageRendering:"auto",moduleUrl:"/furnace/FurnaceMacro.js",factoryName:"createFurnaceMacro",canvasWidth:1280,canvasHeight:400,displayWidth:640,displayHeight:200,initFn:"_furnace_macro_init",startFn:"_furnace_macro_start",shutdownFn:"_furnace_macro_shutdown",loadConfigFn:"_furnace_macro_load_config",configBuffer:u,onModuleReady:g},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/hardware/FurnaceMacroHardware.tsx",lineNumber:251,columnNumber:5},void 0)};export{x as FurnaceMacroHardware};
