!function(){"use strict";let t=null,e=null,n=1,i=400,o=24,a=[],s=null,r=0,l=0,c=0,d=!0;self.onmessage=f=>{const h=f.data;switch(h.type){case"init":t=h.canvas,t.width=Math.round(h.width*h.dpr),t.height=Math.round(h.height*h.dpr),e=t.getContext("2d"),n=h.dpr,i=h.width,o=h.height,a=h.beatGrid,s=h.analysisBeatGrid,r=h.durationMs,l=h.audioPosition,c=h.positionFraction,function(){const t=()=>{d&&function(){if(!e)return;d=!1,e.setTransform(n,0,0,n,0,0),e.clearRect(0,0,i,o),s&&s.beats.length>0?function(){if(!e||!s)return;const t=s.beats,n=new Set(s.downbeats.map(t=>t.toFixed(3))),a=r>0?r/1e3:t[t.length-1]+1,d=r>0?l:c*a;for(const s of t){const t=s/a*i;if(n.has(s.toFixed(3)))e.fillStyle="rgba(255, 255, 255, 0.35)",e.fillRect(Math.round(t),0,1,o);else{e.fillStyle="rgba(255, 255, 255, 0.12)";const n=.3*o;e.fillRect(Math.round(t),o-n,1,n)}}if(t.length>0){let n=t[0],s=Math.abs(d-t[0]);for(const e of t){const t=Math.abs(d-e);t<s&&(s=t,n=e)}if(s<.1){const t=n/a*i,r=1-s/.1;e.fillStyle=`rgba(251, 191, 36, ${.15+.3*r})`,e.fillRect(Math.round(t)-2,0,5,o)}}}():a.length>0&&r>0&&function(){if(!e||0===a.length||r<=0)return;const t=r/1e3;for(let s=0;s<a.length-1;s++){const n=a[s],r=a[s+1];if(n.beatsUntilNextMarker<=0)continue;const l=(r.position-n.position)/n.beatsUntilNextMarker;if(!(l<=0))for(let a=0;a<n.beatsUntilNextMarker;a++){const s=(n.position+a*l)/t*i,r=a%4==0;e.fillStyle=r?"rgba(255,255,255,0.25)":"rgba(255,255,255,0.08)";const c=r?.5*o:.25*o;e.fillRect(Math.round(s),o-c,1,c)}}const n=l/t*i;e.fillStyle="rgba(255,200,0,0.4)",e.fillRect(Math.round(n)-1,0,2,o)}()}(),requestAnimationFrame(t)};requestAnimationFrame(t)}(),self.postMessage({type:"ready"});break;case"beatGrid":a=h.beatGrid,s=h.analysisBeatGrid,r=h.durationMs,d=!0;break;case"position":l=h.audioPosition,c=h.positionFraction,d=!0;break;case"resize":n=h.dpr,i=h.w,o=h.h,t&&(t.width=Math.round(i*n),t.height=Math.round(o*n)),d=!0}}}();
