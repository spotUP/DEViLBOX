import{j as e}from"./index-zx6LJBPK.js";import{r as t}from"./vendor-utils-XMmR-oGw.js";import{x as s,l as o,p as n,y as r,Z as i,k as l}from"./vendor-ui-uomqNFY-.js";const d=[{value:-12,label:"−Oct",color:"rgba(90, 180, 255, 0.45)"},{value:-7,label:"−5th",color:"rgba(90, 180, 255, 0.22)"},{value:0,label:"Root",color:"rgba(80, 255, 120, 0.65)"},{value:7,label:"5th",color:"rgba(90, 180, 255, 0.45)"},{value:12,label:"+Oct",color:"rgba(90, 180, 255, 0.45)"}];function m(e,t,s,o){if(s&&e>=0&&e<s.length)return s[e];if(o){const t=d.find(t=>t.value===e);return t?`${e>0?"+":""}${e} (${t.label})`:e>0?`+${e}`:`${e}`}switch(t){case"hex":return`$${(255&e).toString(16).toUpperCase().padStart(2,"0")}`;case"signed":return e>0?`+${e}`:`${e}`;default:return`${e}`}}const a=({label:a,data:c,onChange:u,min:p=0,max:x=15,bipolar:b=!1,loop:h=-1,onLoopChange:N,end:v=-1,onEndChange:f,playbackPosition:E,valueLabels:g,showNoteNames:D=!1,presets:V=[],fixedLength:S=!1,maxLength:C=256,color:L="#a78bfa",height:j=100,showCells:k=!1,cellFormat:y="dec"})=>{const U=t.useRef(null),B=t.useRef(null),[O,X]=t.useState(!1),[q,w]=t.useState(!1),[M,T]=t.useState(!1),[P,R]=t.useState(!1),[$,z]=t.useState(null),W=t.useRef(null),A=t.useRef(!1),F=x-p,I=Math.max(8,Math.min(24,400/Math.max(c.length,1))),K=Math.max(400,c.length*I),Y=t.useCallback(()=>{const e=U.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const s=window.devicePixelRatio||1;e.width=K*s,e.height=j*s,e.style.width=`${K}px`,e.style.height=`${j}px`,t.scale(s,s);const o=K,n=j;t.fillStyle="#1a1a2e",t.fillRect(0,0,o,n),t.strokeStyle="#2a2a4e",t.lineWidth=1;for(let i=0;i<=4;i++){const e=n/4*i;t.beginPath(),t.moveTo(0,e),t.lineTo(o,e),t.stroke()}if(b&&p<0){const e=n*(x/F);t.strokeStyle="#5a5a8e",t.lineWidth=1,t.beginPath(),t.moveTo(0,e),t.lineTo(o,e),t.stroke()}D&&(t.setLineDash([3,6]),d.forEach(e=>{if(e.value<p||e.value>x)return;const s=n-(e.value-p)/F*n;t.strokeStyle=e.color,t.lineWidth=1,t.beginPath(),t.moveTo(0,s),t.lineTo(o,s),t.stroke(),t.fillStyle=e.color,t.font="8px monospace",t.fillText(e.label,3,s-1)}),t.setLineDash([])),t.strokeStyle="#2a2a4e",t.lineWidth=1;for(let i=0;i<c.length;i+=4){const e=i/c.length*o;t.beginPath(),t.moveTo(e,0),t.lineTo(e,n),t.stroke()}if(h>=0&&h<c.length){const e=h/c.length*o,s=v>=0?v/c.length*o:o;t.fillStyle="rgba(59, 130, 246, 0.10)",t.fillRect(e,0,s-e,n)}const r=o/c.length;if(c.forEach((e,s)=>{const o=s*r,i=(e-p)/F*n,l=n-i,d=$?.step===s;t.fillStyle=d?"rgba(255,255,255,0.85)":L,t.strokeStyle=d?"rgba(255,255,255,0.4)":"rgba(255,255,255,0.12)",t.lineWidth=1,t.fillRect(o+1,l,r-2,i),t.strokeRect(o+1,l,r-2,i)}),h>=0&&h<c.length){const e=h/c.length*o;t.strokeStyle="#3b82f6",t.lineWidth=2,t.beginPath(),t.moveTo(e,0),t.lineTo(e,n),t.stroke(),t.fillStyle="#3b82f6",t.beginPath(),t.moveTo(e-6,10),t.lineTo(e,0),t.lineTo(e+6,10),t.closePath(),t.fill()}if(v>=0&&v<c.length){const e=v/c.length*o;t.strokeStyle="#ef4444",t.lineWidth=2,t.beginPath(),t.moveTo(e,0),t.lineTo(e,n),t.stroke(),t.fillStyle="#ef4444",t.fillRect(e-5,5,10,10)}if("number"==typeof E&&E>=0&&E<c.length){const e=(E+.5)/c.length*o;t.strokeStyle="rgba(255, 220, 0, 0.9)",t.lineWidth=2,t.beginPath(),t.moveTo(e,0),t.lineTo(e,n),t.stroke(),t.fillStyle="rgba(255, 220, 0, 0.9)",t.beginPath(),t.moveTo(e,4),t.lineTo(e-5,14),t.lineTo(e,24),t.lineTo(e+5,14),t.closePath(),t.fill()}},[c,p,x,F,b,D,h,v,E,$,L,K,j]);t.useEffect(()=>{Y()},[Y]);const Z=e=>{const t=U.current;if(!t)return{step:0,value:0};const s=t.getBoundingClientRect(),o=e.clientX-s.left,n=e.clientY-s.top;return{step:Math.max(0,Math.min(c.length-1,Math.floor(o/s.width*c.length))),value:Math.max(p,Math.min(x,Math.round(p+(1-n/s.height)*F)))}},G=t.useCallback((e,t,s,o)=>{const n=[...c],r=Math.min(e,s),i=Math.max(e,s);for(let l=r;l<=i;l++){const d=i===r?0:(l-r)/(i-r),m=e<=s?t+(o-t)*d:o+(t-o)*(1-d);n[l]=Math.max(p,Math.min(x,Math.round(m)))}u(n)},[c,p,x,u]);return e.jsxDEV("div",{className:"bg-dark-bgSecondary rounded-lg border border-dark-border overflow-hidden",children:[e.jsxDEV("div",{className:"flex items-center justify-between px-3 py-2 bg-dark-bg border-b border-dark-border",children:[e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("span",{className:"font-mono text-xs font-bold text-text-primary uppercase tracking-wider",children:a},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:392,columnNumber:11},void 0),e.jsxDEV("span",{className:"text-[10px] text-text-muted font-mono",children:[c.length," steps"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:395,columnNumber:11},void 0),e.jsxDEV("span",{className:"text-[9px] text-blue-400/60 font-mono hidden sm:inline",children:"shift+drag=line"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:396,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:391,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex items-center gap-1",children:[!S&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV("button",{onClick:()=>{c.length<=1||u(c.slice(0,-1))},className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-border/50 rounded",title:"Remove step",children:e.jsxDEV(s,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:406,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:403,columnNumber:15},void 0),e.jsxDEV("button",{onClick:()=>{c.length>=C||u([...c,c[c.length-1]??0])},className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-border/50 rounded",title:"Add step",children:e.jsxDEV(o,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:411,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:408,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:402,columnNumber:13},void 0),N&&e.jsxDEV("button",{onClick:()=>{w(!q),T(!1)},className:"p-1 rounded transition-colors "+(q?"bg-blue-500 text-white":"text-blue-400 hover:bg-blue-500/20"),title:q?"Click canvas to set loop":"Set loop point",children:e.jsxDEV(n,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:424,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:418,columnNumber:13},void 0),f&&e.jsxDEV("button",{onClick:()=>{T(!M),w(!1)},className:"p-1 rounded transition-colors "+(M?"bg-red-500 text-white":"text-red-400 hover:bg-red-500/20"),title:M?"Click canvas to set end":"Set end point",children:e.jsxDEV(r,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:436,columnNumber:15},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:430,columnNumber:13},void 0),V.length>0&&e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("button",{onClick:()=>R(!P),className:"p-1 rounded transition-colors "+(P?"bg-amber-500/30 text-amber-300":"text-amber-400 hover:bg-amber-500/20"),title:"Preset patterns",children:e.jsxDEV(i,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:449,columnNumber:17},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:443,columnNumber:15},void 0),P&&e.jsxDEV("div",{className:"absolute top-full right-0 mt-1 bg-dark-bg border border-dark-border rounded-lg shadow-xl z-30 min-w-[130px]",children:[e.jsxDEV("div",{className:"px-2 py-1 text-[9px] text-text-muted font-mono uppercase border-b border-dark-border",children:"Patterns"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:453,columnNumber:19},void 0),V.map((t,s)=>e.jsxDEV("button",{onClick:()=>{u([...t.data]),void 0!==t.loop&&N?.(t.loop),void 0!==t.end&&f?.(t.end),R(!1)},className:"w-full px-3 py-1.5 text-left text-[10px] font-mono text-text-primary hover:bg-dark-bgSecondary flex items-center justify-between gap-4",children:[e.jsxDEV("span",{children:t.name},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:467,columnNumber:23},void 0),e.jsxDEV("span",{className:"text-text-muted text-[9px]",children:[t.data.length,"st"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:468,columnNumber:23},void 0)]},s,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:457,columnNumber:21},void 0))]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:452,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:442,columnNumber:13},void 0),e.jsxDEV("button",{onClick:()=>{u(Array(c.length).fill(b?0:p))},className:"p-1 text-text-muted hover:text-text-primary hover:bg-dark-border/50 rounded",title:"Reset",children:e.jsxDEV(l,{size:12},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:480,columnNumber:13},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:477,columnNumber:11},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:399,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:390,columnNumber:7},void 0),e.jsxDEV("div",{ref:B,className:"relative overflow-x-auto",style:{height:j+20},children:[e.jsxDEV("canvas",{ref:U,style:{display:"block"},className:q||M?"cursor-crosshair":"cursor-pointer",onMouseDown:e=>{if(q||M){const{step:t}=Z(e);return void(q?(N?.(t),w(!1)):(f?.(t),T(!1)))}X(!0);const{step:t,value:s}=Z(e);if(W.current={step:t,value:s},A.current=e.shiftKey,!e.shiftKey){const e=[...c];e[t]=s,u(e)}},onMouseMove:e=>{const{step:t,value:s}=Z(e),o=U.current;if(o){const n=o.getBoundingClientRect();z({step:t,value:c[t]??s,x:e.clientX-n.left,y:e.clientY-n.top})}if(O)if(A.current&&W.current)G(W.current.step,W.current.value,t,s);else{const e=[...c];e[t]=s,u(e)}},onMouseUp:()=>{X(!1),W.current=null},onMouseLeave:()=>{X(!1),z(null)}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:487,columnNumber:9},void 0),$&&e.jsxDEV("div",{className:"absolute pointer-events-none z-20 bg-dark-bg/95 border border-dark-border rounded px-2 py-1 text-[10px] font-mono text-text-primary shadow-lg",style:{left:Math.min($.x+10,K-120),top:Math.max(4,$.y-30),whiteSpace:"nowrap"},children:[e.jsxDEV("span",{className:"text-text-muted mr-1",children:["#",$.step,":"]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:507,columnNumber:13},void 0),m($.value,y,g,D)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:499,columnNumber:11},void 0),e.jsxDEV("div",{className:"absolute bottom-0 left-0 right-0 flex items-center gap-4 px-2 py-0.5 bg-dark-bg/80 text-[9px] font-mono",children:[h>=0?e.jsxDEV("button",{onClick:()=>N?.(-1),className:"flex items-center gap-1 text-blue-400 hover:text-blue-300",children:[e.jsxDEV(n,{size:9},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:518,columnNumber:15},void 0)," Loop@",h," ",e.jsxDEV("span",{className:"text-text-muted ml-0.5",children:"×"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:518,columnNumber:47},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:515,columnNumber:13},void 0):e.jsxDEV("span",{className:"text-text-muted",children:"No loop"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:520,columnNumber:15},void 0),v>=0?e.jsxDEV("button",{onClick:()=>f?.(-1),className:"flex items-center gap-1 text-red-400 hover:text-red-300",children:[e.jsxDEV(r,{size:9},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:526,columnNumber:15},void 0)," End@",v," ",e.jsxDEV("span",{className:"text-text-muted ml-0.5",children:"×"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:526,columnNumber:43},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:523,columnNumber:13},void 0):e.jsxDEV("span",{className:"text-text-muted",children:"No end"},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:528,columnNumber:15},void 0),"number"==typeof E&&e.jsxDEV("span",{className:"text-yellow-400 ml-auto",children:["▶ ",E]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:531,columnNumber:13},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:513,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:486,columnNumber:7},void 0),k&&e.jsxDEV("div",{className:"overflow-x-auto border-t border-dark-border bg-dark-bg",children:e.jsxDEV("div",{className:"flex gap-0.5 p-2",children:c.map((t,s)=>e.jsxDEV("div",{className:"flex flex-col items-center gap-0.5 flex-shrink-0",children:[e.jsxDEV("span",{className:"text-[8px] font-mono text-text-muted",children:s.toString().padStart(2,"0")},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:542,columnNumber:17},void 0),e.jsxDEV("input",{type:"text",value:"hex"===y?(255&t).toString(16).toUpperCase().padStart(2,"0"):String(t),onChange:e=>((e,t)=>{const s="hex"===y?parseInt(t.replace(/^\$/,""),16):parseInt(t);if(isNaN(s))return;const o=[...c];o[e]=Math.max(p,Math.min(x,s)),u(o)})(s,e.target.value),className:"text-[10px] font-mono text-center border rounded py-0.5",style:{width:"36px",background:"#060a0f",borderColor:0!==t?"#1a2a3a":"#111",color:0!==t?"#7dd3fc":"#444"}},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:543,columnNumber:17},void 0)]},s,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:541,columnNumber:15},void 0))},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:539,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:538,columnNumber:9},void 0)]},void 0,!0,{fileName:"/Users/spot/Code/DEViLBOX/src/components/instruments/shared/SequenceEditor.tsx",lineNumber:388,columnNumber:5},void 0)};export{a as S};
